<!DOCTYPE html><html lang="en" ><head ><title >How to connect wxEVT_KEY_DOWN?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >How to connect wxEVT_KEY_DOWN?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=124" >Brucey's Modules</a>/<a href="#bottom" >How to connect wxEVT_KEY_DOWN?</a><br><br>
<a name="875745"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >d-bug</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>is it true, that I only can connect wxEVT_KEY_DOWN events with ConnectAny? I mean, I like to be able to connect it to a canvas or an other gadget. Am I missing something?<br><br>Whats the right way for doing that? <br><br></td></tr></table><br>
<a name="875922"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DavidDC</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think you do need to use ConnectAny - but like you I've had trouble figuring out exactly why. Apparently wxKeyEvents don't propagate from a child window back to a parent window - so if the gadget has keyboard focus (SetFocus) you should in theory just connect it up via ConnectAny without your other gadgets getting confused.<br><br>I know it works fine for gadgets that use the keyboard inherently - like a textfield - but am not so sure about plain windows and canvases.<br><br>Brucey has played around with this more than me. I think I recall him saying that with a canvas, he had to use an accelerator table. But that's just a vague memory and could easily be wrong. I'm sure he'll be along any day soon... <br><br></td></tr></table><br>
<a name="876136"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >d-bug</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thank you, thats working with some little workarounds, like catching wxEVT_MOUSE_ENTER and wxEVT_MOUSE_LEAVE events to check if it is the right canvas, SetFocus doesn't work on a glcanvas (not checked on max2d canvas nor other gadgets). <br><br>The only funny thing about it is, that when I use JEdit as the IDE (the better alternative on OSX) and compile it from there, keyhits will be produced in JEdits textarea. Quiet strange behaviour, I think. Maybe i forgot something while initializing wxMax (or its just a bug in JEdit or wxMax).<br><br>cheers <br><br></td></tr></table><br>
<a name="876257"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DavidDC</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm wondering if the behaviour (false keyhit in JEdit) occurs when you run your compiled app standalone ie by double clicking on it. My guess is not. This could be somehow related to the "app window beneath the IDE" issue that wxMax has in OSX, which is related wxWidget's use of Carbon I think. Again, Brucey would be the person to talk to... <br><br></td></tr></table><br>
<a name="876284"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >d-bug</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thank you again!<br><br>I think it's better to comment all userinput out until there is a solution for it. I'm still at the beginning of my LevelEditor, so there is much more to do then this! <br><br></td></tr></table><br>
<a name="878350"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you want to use Max2D style keyboard capture on a GLCanvas, you can do something like this :<br><br><pre class=code>
...
Type MyCanvas Extends wxGLCanvas


	Method OnInit()
		
		EnablePolledInput(Self)

		ConnectAny(wxEVT_KEY_DOWN, OnKeyDown)
		ConnectAny(wxEVT_KEY_UP, OnKeyUp)

	End Method

	Function OnKeyDown(event:wxEvent)
		Local evt:wxKeyEvent = wxKeyEvent(event)
		EmitEvent(CreateEvent( EVENT_KEYDOWN, event.parent, MapWxKeyCodeToBlitz(evt.GetKeyCode())))
		event.Skip()
	End Function

	Function OnKeyUp(event:wxEvent)
		Local evt:wxKeyEvent = wxKeyEvent(event)
		EmitEvent(CreateEvent( EVENT_KEYUP, event.parent, MapWxKeyCodeToBlitz(evt.GetKeyCode())))
		event.Skip()
	End Function

...

End Type
</pre><br><br>And then, in your OnPaint event, you can work much like you would with Max2D, using things like KeyDown() and KeyUp() to determine current key states.<br><br>Are you using the custom appstub for OS X? That fixes numerous problems with BRL's appstub and the fact it is designed to work with Cocoa. <br><br></td></tr></table><br>
<a name="878456"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DavidDC</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wow, that's excellent. Didn't know you could do that! <br><br></td></tr></table><br>
<a name="878567"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >d-bug</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Great tip, but I meant it like MaxGUI-Panel style keyboard capture. <br><br>Yes, I'm using your appstub wich is part of some problems I have had with wxMax on Leopard. Compiling with -b bah.appstub forces carbon wich leeds to unstartable apps. But they are much better then crashing apps while development without your appstub. ;)<br><br>cheers<br><br>(I have to write more english *stumble on each word*) <br><br></td></tr></table><br>
<a name="878736"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm currently working exclusively on Mac (while I await the ship to arrive in the UK with the rest of my stuff), and it works great here, both on 10.4 (PPC) and 10.5 (Intel). I am of course using David's slightly modified IDE which includes shortcuts for building/running apps using the custom appstub - you press cmd+shift-B/R. You can download the source from the maxmods site if you want to try it out.<br><br>Anyhoo... keyboard events should work by simply attaching the appropriate down/up connections to the control you wish to capture. Of course, your control will require focus.<br>My example above, assumed you wanted a Max2D-style of capture, but of course you can leave out the Max2D references and instead just use the OnKeyUp/Down functions if you wish.<br><br>If you have trouble connecting the event to a control (without first sub-classing it, as my above example shows), there is a second form of using ConnectAny which you may like to try. wxCodeGen uses this form extensively.<br><pre class=code>
myControl.ConnectAny(wxEVT_KEY_DOWN, OnKeyDown, Null, Self)
</pre><br>Code like this would normally appear in the parent control's OnInit() method, with the OnKeyDown Function belonging to the parent, not the Child.<br>If you use this form you need to be aware that event.parent will refer to the control raising the event, not the parent to which the OnKeyDown function belongs. In this case you can use the "sink" field of the event to access the parent :<br><pre class=code>
	Function OnKeyDown(event:wxEvent)
		TParentControl(event.sink).HandleSomeKeys(wxKeyEvent(event))
	End Function
</pre><br><br>If you want to code like MaxGUI, where all your events go to the same event callback function, you can still do that if you wish (you just point all your Connects to the same function), but I personally think it is easier to have it separated into individual functions.<br><br>I hope this was clear, about how some of this works?<br><br>btw, your English is far better than my German! When I was in Frankfurt, I think the best I could manage was to ask for a curry-wurst :-p <br><br></td></tr></table><br>
<a name="878827"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >d-bug</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thank you again, Brucey! The last one was exactly what I'm looking for! That also stops the JEdit issue. <br>I'm no friend of all those hacks on the original MaxIDE. Its still not my kind of IDE, but I will give it another try if this would help to fix the nonstartable apps thing!<br><br>...most germans can't speak german too they have horrible slangs. Saxony is my favorite... *shutter* ;)<br><br>~edit~<br>That nonstartable-carbon-app-issue is also related to JEdit. Id didn't use your custom IDE, but by compiling in a normal Terminal instead of compiling in JEdit.Console this issue is fixed. I think it's time to use another alternative for JEdit. What about your Eclipse plugin? (just kidding) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
