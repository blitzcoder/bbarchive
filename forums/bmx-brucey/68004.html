<!DOCTYPE html><html lang="en" ><head ><title >bah.database</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >bah.database</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=124" >Brucey's Modules</a>/<a href="#bottom" >bah.database</a><br><br>
<a name="759700"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Chris C</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> just been messing with Bruceys new database abstraction module and I have to say its up to Bruceys impeccable standards, from first sight it seem to have everthing you could possibly need wrapped in an easy and logical set of objects<br><br>very well done and thanks brucey ;)<br><br>and yes if its up to your usual standards you should build a  Date/Calendar module :p !!<br>(max is sadly lacking in this department...) <br><br></td></tr></table><br>
<a name="759707"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gman</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> i concur!  fantastic work. <br><br></td></tr></table><br>
<a name="759718"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ninjarat</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> wow.... 8) <br><br></td></tr></table><br>
<a name="759719"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks.<br><br>Have now added a PostgreSQL module too.<br><br>Finally managed to get some Mac testing done, so there's an update to the ODBC module (1.01) to fix a couple of pointer/cast issues (ack, I hate C :-p )<br><br>I can confirm that all my tests for each module perform the same on all platforms. That is, I get the same results :-)<br><br>Notes for Mac users. Some modules require it link to the database-client shared objects (.dylib) - like how Linux works. However, the current version of bmk doesn't support this without tweaking (the next version, when it arrives should be fixed). Follow <a href="/posts.php?topic=66565" target="_blank">this tweak</a> for a temporary fix.<br><br>Firebird next, I guess (via ibpp)... though there are more bmk issues to fix before most people will be able to use it.<br><br>:-) <br><br></td></tr></table><br>
<a name="759723"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >kronholm</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> very nice, will definitely try it out once I get to that part of my game <br><br></td></tr></table><br>
<a name="766218"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Added an mSQL database module to the site today. ( <a href="http://brucey.net/programming/blitz/" target="_blank">http://brucey.net/programming/blitz/</a> )<br><br>Takes the database support tally to 5 currently :<br><br>mSQL<br>MySQL<br>ODBC<br>PostreSQL<br>SQLite<br><br>(and scarily, the total module count to 20 !)<br><br>Haven't as yet tested mSQL on Win32, but it works great on Linux/Mac for now.<br><br>Still on my list of maybe's :<br><br>Informix<br>DB2<br>Oracle<br>Firebird<br><br>:o) <br><br></td></tr></table><br>
<a name="767247"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi People,<br><br>Another new Database module announcement....<br><br>This one is called <b>DBXbase</b>, an implementation of the open-source Xbase and xbSQL libraries.<br><br>Xbase is a <b>cross-platform</b> dBase, FoxPro, Clipper etc. compatible library (that is, .dbf files and the likes).<br>xbSQL wraps that library in SQL queries.<br>And of course, DBXbase wraps up all of that into yet another database module.<br><br>Tested and working on all three platforms.<br><br><br>All my modules are available from : <a href="http://brucey.net/programming/blitz/" target="_blank">http://brucey.net/programming/blitz/</a><br><br>Current Database module availability :<br><pre class=code>
* mSQL
* MySQL
* ODBC
* PostreSQL
* SQLite
* Xbase
</pre><br><br>Enjoy ;-) <br><br></td></tr></table><br>
<a name="767432"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Russell</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nice work!<br><br>Russell <br><br></td></tr></table><br>
<a name="771932"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >siread</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Brucey. I've been playing with bah.DBSQLite but have run into some problems.<br><br>If I have a table with no rows the following code gives me the error: "Attempt to access field or method of Null object." <br><br><pre class=code>
        Local id:Int
	Local query:TDatabaseQuery = db.executeQuery("SELECT * FROM fixtures")
	
	If db.hasError() Then
		errorAndClose(db)
	End If
	
	While query.nextRow() 	
		Local record:TQueryRecord = query.rowRecord()
---&gt;          id = record.value(0).getInt()
        Wend

</pre><br><br>If the table has no rows then the program shouldn't enter the While loop. Am I doing something wrong? <br><br></td></tr></table><br>
<a name="771937"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Am I doing something wrong? <br></div><br><br>No, I should probably fix that.<br><br>SQLite is "special" in that you need to retrieve the first row to get the field types etc. (internally that is... not that *you* have to).<br><br>Still... no excuse ;-) <br><br></td></tr></table><br>
<a name="771948"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> New version of dbsqlite is available from the website.<br><br>Sorry about the problems... <br><br></td></tr></table><br>
<a name="771961"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >siread</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wow, that's fast work. Excellent. <br><br></td></tr></table><br>
<a name="772002"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >siread</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Brucey. I keep getting errors from seemingly simple queries...<br><br><pre class=code>
Local query:TDatabaseQuery = db.executeQuery("SELECT * FROM club WHERE id=1")
If db.hasError() Then errorAndClose(db)
</pre><br>Produces...<br>DebugLog:(3) Error preparing statement : <br><br>If i run the same statement on the database in another app it's fine. Any ideas? <br><br></td></tr></table><br>
<a name="772003"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blueapples</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> You're missing a quotation mark there. <br><br></td></tr></table><br>
<a name="772009"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >siread</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ah, yes. That isn't the issue though, I just made a mistake copying the code from my program. <br><br></td></tr></table><br>
<a name="772058"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >siread</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh man. My bad. I've been going round in circles for hours, loading different dbs, trying different queries and stuff... <br><br>Turns out the error was from a previous statement which I hadn't error checked. I'd assumed that a new query would flush any existing error codes. (To assume makes an ass out of me.)<br><br>So, it's full steam ahead again. Great work Brucey! <br><br></td></tr></table><br>
<a name="772082"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I'd assumed that a new query would flush any existing error codes <br></div><br><br>It probably should...  I'll take a look at where it's resetting things.<br>Have you just been using ExecuteQuery ?<br><br>Sorry you've been having troubles with it. <br><br></td></tr></table><br>
<a name="772143"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >siread</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, the troubles are of my own making really. Things like calling "DROP TABLE" when a table doesn't exist throws an exception in bah.database, but the mod I was using before simply ignored these queries. I was happy to just let things run on as it was working ok but the consistent error checking in your bah.database has highlighted quite a few mistakes in my sql code. So it's been a day well spent. :)<br><br>It would be nice if the error messages were a little more descriptive though. Things like "Column does not exist". That would have saved me a headache. ;) <br><br></td></tr></table><br>
<a name="772203"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've just updated both BaH.Database and BaH.DBSQLite with some improvements, which are available from the usual place.<br><br>BaH.Database (1.03)<br><pre class=code>
 * Fixed clearing of lasterror after successful query prepare/execute.
</pre><br><br>BaH.DBSQLite (1.04)<br><pre class=code>
 * Improved error message details.
</pre><br><br>After calling executeQuery on the db, or prepare/execute on the query, if they are successful "hasError()" should return false.<br><br>For sqlite, I'm now returning the full error details, which should highlight the general location in the SQL that are broken - dunno why I wasn't doing this before.<br><br>:o) <br><br></td></tr></table><br>
<a name="773032"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >siread</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have a problem Brucey. If I open a connection to a database (SQLite), run a query, then close the connection, it's not possible to delete the file using DeleteFile(). <br><br>It's as if the file is still in use. I notice that if I take out the query on the database it can be deleted as normal. <br><br></td></tr></table><br>
<a name="773171"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Si,<br><br>Looks like a query was holding a lock on the database.<br>Changed now so that Close makes sure that all the it's queries are freed before itself attempts to close.<br><br>Yet another new version available from the usual place.<br><br>Perhaps my testing has a lot to be desired...  :-/ <br><br></td></tr></table><br>
<a name="773194"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >siread</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Perhaps my testing has a lot to be desired... :-/  <br></div><br><br>With support like this I'm happy to help iron out the bugs. :)<br><br>Sorry if I'm getting annoying, but I've been running some speed comparisons between bah.database and teamonkeys sqlite mod (with pyropixel's SQLiter).<br><br>When SELECTing 1650 rows with "SELECT * from person" I get the following results...<br><br>bah.database<br>------------------<br><pre class=code>
Local query:TDatabaseQuery = db.executeQuery("SELECT * from person")
While query.nextRow()
Local record:TQueryRecord = query.rowRecord()
Local name$ = record.getFieldByName("lastname").value.getString()
Wend
</pre>~410 millisecs <br><br><pre class=code>
Local query:TDatabaseQuery = db.executeQuery("SELECT * from person")
While query.nextRow()
Local name$ = Query.rowRecord().getFieldByName("lastname").value.getString()
Wend

</pre>~370 millisecs<br><br><pre class=code>
Local query:TDatabaseQuery = db.executeQuery("SELECT * from person")
While query.nextRow()
Wend
</pre>~160 millisecs<br><br>This suggests creating the TRecord is taking a while, but obviously it's needed to retrieve the data.<br><br><br><br>pyropixel.sqliter<br>--------------------<br><pre class=code>
db.Query("SELECT * FROM person")
     
	 While db.NextRecord()
        Local name$ = db.F("lastname")
    Wend
</pre>~38795 millisecs<br><br><pre class=code>
Local prepQ:Int = db.PrepareQuery("SELECT * FROM person")
     
	 While db.StepQuery(prepQ) = SQLITE_ROW
        Local name$ = db.P(prepQ, "lastname")
    Wend
</pre>~30 millisecs<br><br>The prepared querys with SQliter are lightning fast and I really need that sort of speed as the game often needs to retrieve 100s of records. I tried the bah.database prepared queries but they don't make any difference to the retrieval speed. Is there anything I can do to speed up selection?<br><br>BTW Bah.Database is faster at INSERTs. :D <br><br></td></tr></table><br>
<a name="773224"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> Are you using all fields from the SELECT ?<br><br>Because mine puts all the fields that you select, into the record.<br>In your test you SELECT *, but are only using the "lastname" field.<br>And it looks like, in the SQLiter example, you are only extracting "lastname" from the returned record data, which is a lot less work.<br><br>What kind of difference does the test timing look like if you change the SQL to  "SELECT lastname FROM person" ?<br>(just curious ;-)<br><br>I can have a look at it anyways, but my code doesn't do anything special that would cause it to take a significant amount of extra time, to my knowledge.<br>But remember the Framework is abstracted to an extent that allows it to work on different databases, rather than hitting the library directly. So you trade some time for extra error-checking, and ease of use.<br><br>... and Query.rowRecord().getFieldByName("lastname").value.getString() looks a bit messy, me thinks... I can have a look at that. <br><br></td></tr></table><br>
<a name="773242"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I tried the bah.database prepared queries but they don't make any difference to the retrieval speed. <br></div><br><br>The idea with prepared queries, is that you prepared them "somewhere", and when you need it, you just execute it... as many times as you like, without having the expense of "recompiling" the SQL each time you want to execute.<br>In theory, it's much more efficient to use the "prepare once, execute many" method.<br><br>The actual retrieval (nextRow) itself will be the same speed for prepared or non-prepared queries.<br><br>Here's an example from a project of mine, which shows caching of a query :<br><pre class=code>
	Function sqlAddRoute(id:Int)
		Global addRouteQuery:TDatabaseQuery
		
		If conn And conn.isOpen() Then
		
			If Not addRouteQuery Then
				addRouteQuery = TDatabaseQuery.Create(conn)
				sqlPrepareQuery(addRouteQuery, "INSERT INTO route (id) VALUES (?)")
			Else
				addRouteQuery.clearBindValues()
			End If
					
			sqlAddBindInt(addRouteQuery, id)
		
			addRouteQuery.execute()
							
		End If
		
	End Function
</pre><br><br>The query is prepared once, and reused after that. (this example is actually running on MySQL, but it doesn't matter, it would be the same for SQLite too)<br><br><br>Anyways, I'll be updating BaH.Database soon with some more helper methods, that let you do :<br><br>Local name:String = record.getStringByName("surname")<br><br>Which is a bit less coding. <br><br></td></tr></table><br>
<a name="773246"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >siread</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's a lot quicker (sub 10 millisecs) if I change it to SELECT lastname, however in my real code I often need all the fields to create a TList of people (and there are a lot of fields in my person table).<br><br>Using SQLiter was still very fast despite calling db.P() for every field. <br><br></td></tr></table><br>
<a name="773250"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> using "getFieldByName()" is also slower in my framework, because it's doing a lookup via the index (eg. if name = name[i]...), which is a tad crap ;-)<br><br>I'm changing it so that the name lookup comes off a TMap cache instead, so retrieving any field by name (whether it's the first or the last) will take the same amount of time.<br><br>I've always just used the "Index" lookup myself, which I suppose is why the "Name" lookup hasn't had much optimization done on it.<br><br>Still, thanks to your using it, it gets better :-) <br><br></td></tr></table><br>
<a name="773258"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> And... it's also doing UTF-8 string conversion.. on the fly ;-)<br><br><br>Anyhoo, I've uploaded a new BaH.Database (1.04) release, which has :<br><pre class=code>
 * Improved getFieldByName efficiency.
 * Added TQueryRecord helper methods for type/name retrieval - getXXXByName().
</pre><br><br><br>So, you could now change :<br><pre class=code>
While query.nextRow()
    Local name$ = Query.rowRecord().getFieldByName("lastname").value.getString()
Wend
</pre><br><br>to<br><br><pre class=code>
While query.nextRow()
    Local name$ = Query.rowRecord().getStringByName("lastname")
Wend

... or even

For Local record:TQueryRecord = eachin query
    Local name$ = record.getStringByName("lastname")
Next
</pre><br><br>If you decide that SQLiter is better for your needs, cool... but thanks for helping improve mine :-) <br><br></td></tr></table><br>
<a name="773559"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >siread</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'd prefer to use your mod as the support is great and it's more user friendly. However, speed is a very important issue. Now if there was a way to step through query results without populating an entire TSQLiteResultSet, and simply access the sqlite3_column directly then it would save a lot of time when dealing with 1000s of records.<br><br>I'll maybe add some methods for my own use, if you don't mind. I realise that kind of defeats the object of having a framework, but it means I can have the best of both worlds. :) <br><br></td></tr></table><br>
<a name="773580"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, if you ever want to discuss ways in which you can get the most of the framework, feel free to drop me a mail.<br><br>And remember, if you need to select a single column only, make an SQL just for that. Have another for selecting the entire row, etc...<br>Don't be afraid to have a few prepared SQLs lying around ready to be used. Think of it like creating an array of cached data that you can pull up at any time - it's quicker to create that array once, rather than recreate the same thing over and over again...<br><br>;-) <br><br></td></tr></table><br>
<a name="786414"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >mikkyx</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Brucey,<br>I've just downloaded your BaH.database module but it looks like I got v1.02 instead of v1.04? It's working but when I tried to use getStringByName it, of course, wasn't there. Can you stick 1.04 up somewhere? <br><br></td></tr></table><br>
<a name="786494"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>Not sure how that happened... but the correct version is up on the site again...<br><br>Sorry :-) <br><br></td></tr></table><br>
<a name="786660"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >mikkyx</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#32">[#32]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks :) <br><br></td></tr></table><br>
<a name="830289"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Vilu</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#33">[#33]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm having hard time getting two processes to update the same SQLite database file at the same time. I know it's not possible for two processes to commit exactly at the same time, but I'd love to have executeQuery() and/or commit() to return an error when a conflict happens. Currently they seem not to do it. <br><br>Here's a snippet I've been trying to demonstrate this with:<br><br><pre class=code>
SuperStrict

Framework bah.DBSQLite

Local db:TDBConnection = LoadDatabase("SQLITE", "test.db") 

If db.isOpen() Then
  db.executeQuery("Create TABLE tbl (id integer primary key AUTOINCREMENT, name varchar(30))") 
	
  For Local i:Int = 1 To 20
    Repeat
      db.executeQuery("INSERT INTO tbl values (NULL, 'Name " + i + "')") 
      If db.hasError() Then
        DebugLog db.error().ToString() 
        Delay(2000) 
      EndIf
    Until Not db.hasError() 
    Delay(2000) 
  Next
  db.Close() 
  DebugLog "Done"
End If
</pre><br><br>What it basically does is insert 20 records in 2 second intervals into the table, and if an update fails, it retries until it succeeds. The problem is that it never fails when the database is being updated by another process at the same time. It just happily moves on to the next record in the For-loop. Kinda makes it hard to create a foolproof record insertion method.<br><br>The following example program updates the first record 50 time per second and is guaranteed to cause update conflicts when the two programs are run at the same time:<br><br><pre class=code>
SuperStrict

Framework bah.DBSQLite
Import brl.timer

Local db:TDBConnection = LoadDatabase("SQLITE", "test.db") 

If db.isOpen() Then
  Local timer:Int = MilliSecs() 
  Repeat
	db.executeQuery("UPDATE tbl SET name = 'Updated name' WHERE id = 1") 
	If db.hasError() Then DebugLog db.error().toString() 
	Delay(20) 
  Until MilliSecs() - timer &gt; 40000
  
  db.Close() 
End If
</pre><br><br>The first program fails to insert on average every third record if the second program is running at the same time. <br><br>That would be OK if I had means to check whether or not the insertion succeeded. Any ideas? <br><br></td></tr></table><br>
<a name="830839"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Vilu</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#34">[#34]</a></td></tr></table></td></tr><tr ><td class="posttext"> I did not get this to work even with the prepare query approach. <br><br>Brucey, have you had time to look into this? <br><br></td></tr></table><br>
<a name="848238"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#35">[#35]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry for the rather late reply..<br><br>The latest version in SVN fixes the problem. I've also included your example into the tests to show that feature working as expected. <br><br></td></tr></table><br>
<a name="850099"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Vilu</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#36">[#36]</a></td></tr></table></td></tr><tr ><td class="posttext"> Great news! Thanks, Brucey! :) <br><br></td></tr></table><br>
<a name="882797"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >lotonah</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#37">[#37]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Brucey,<br><br>I'm using BlitzMax 1.28 on a Mac, and I'm trying to get sqlite to work.  It's in the mod folder (as is database.mod), and building the modules works fine.<br><br>Compiling date_test_01.bmx gives the error "Can't find interface for module 'bah.dbsqlite'.<br><br>I'm new to databases and modules, so obviously I'm at the stupid stage.  Please help.  Thanks! <br><br></td></tr></table><br>
<a name="882805"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DavidDC</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#38">[#38]</a></td></tr></table></td></tr><tr ><td class="posttext"> Try checking your file paths and case of the filenames. They should be:<br><br>BlitzMax/mod/bah.mod/database.mod<br>BlitzMax/mod/bah.mod/dbsqlite.mod <br><br></td></tr></table><br>
<a name="882831"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#39">[#39]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> building the modules works fine. <br></div><br>This is one of the BlitzMax quirks...  if the module is in the wrong place, it will simply ignore it completely.<br><br>As David says, check the location of the modules.<br><br>BlitzMax modules are split into two levels. One is like a "namespace", and the other is the specific module. So, for bah.dbsqlite, you should find one folder called bah.mod, and inside that another folder for the module itself, dbsqlite.mod.<br><br>It's actually quite a nice way to group modules together. <br><br></td></tr></table><br>
<a name="903625"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Artemis</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#40">[#40]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>I've just updated your modules via svn but when trying to build them I get this error:<br><br><pre class=code>Compiling:sqlite3.c
D:/BlitzMax/mod/bah.mod/dbsqlite.mod/src/sqlite3.c:18431:3: #error SQLite will not work correctly with the -ffast-math option of GCC.
Build Error: failed to compile D:/BlitzMax/mod/bah.mod/dbsqlite.mod/src/sqlite3.c</pre><br><br>svn updated the following sqlite-files.<br><br><pre class=code>U    dbsqlite.mod\src\sqlite3.c
U    dbsqlite.mod\src\sqlite3.h
U    dbsqlite.mod\src\sqlite3ext.h
U    dbsqlite.mod\dbsqlite.bmx</pre><br><br>I'm using a normal Mingw installation on Windows XP. <br><br></td></tr></table><br>
<a name="903640"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#41">[#41]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh... goody... I guess a new bmk tweak is required for this then. :-(<br><br>Didn't complain on OS X, so I'm guessing the fast-math option is Win32 only in BlitzMax. <br><br></td></tr></table><br>
<a name="903649"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#42">[#42]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've commented out the error message for now... ack... not sure how terrible it is to do that, but for now it compiles up.<br><br>Long term solution is to disable fast-math for that module compile - but atm bmk doesn't support that level on configuration. (well, the official one doesn't ;-) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
