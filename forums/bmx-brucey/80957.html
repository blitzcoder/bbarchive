<!DOCTYPE html><html lang="en" ><head ><title >bah.database feature request</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >bah.database feature request</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=124" >Brucey's Modules</a>/<a href="#bottom" >bah.database feature request</a><br><br>
<a name="911539"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Htbaa</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Brucey,<br><br>Could you add a GetTableInfo(tableName:String) method to bah.database?<br><br>It should return a data structure containing the TQueryField's of the given table.<br><br>Every driver could overload the method and perform the proper query to retrieve the table information.<br><br>MySQL<br><pre class=code>DESCRIBE `tablename`</pre><br>SQLite<br><pre class=code>pragma table_info(`tablename`)</pre><br><br>I don't know what the correct queries would be for the other databases.<br><br>Would this be possible? <br><br></td></tr></table><br>
<a name="911672"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sounds like a plan :-) <br><br></td></tr></table><br>
<a name="911720"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Htbaa</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> It would be really useful for the TQueryBuilder I'm working on. That way I can easily quote table- and column-names. The best place a table info retriever is of course in the database driver itself :-). <br><br></td></tr></table><br>
<a name="913648"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Htbaa</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't want to be pushy :-) But do you have any idea when you might add this feature? It's not that it's a absolute requirement for my TQueryBuilder type (which is shaping nicely now) but it would be nice if the column names were available. Even more for the ORM/ActiveRecord stuff. <br><br></td></tr></table><br>
<a name="913731"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, I'm away from home at the moment (Chargers vs Saints this weekend!!), so it won't be until the week.<br>I wonder if we should maybe have a TDBSchema type to represent a table and its fields? Just a thought... <br><br></td></tr></table><br>
<a name="913763"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Htbaa</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> As long as we're able to retrieve information about a given table it would be fine I guess. A TDBSchema should contain all tables, since a schema is your database layout. Instead of always requesting the table info it could make use of some form of lazy loading. For example, a TDBSchema will cache info for all tables from a given database schema, but will only execute a query to get the table info when the user asks for it. It can then put it in a cache so the next time the data will be there.<br><br>Generally a database layout is fixed within an application and is unlikely to change during runtime. Nonetheless it would be useful to have a Reset() method to reset the complete cache and a ResetTable(tableName:String) method.<br><br>.... Just now I was writing a simple prototype to demonstrate it but as my MaxIDE under Linux crashed I lost the source. But basically, it could contain these methods.<br><br><pre class=code>
Type TDBSchema Abstract
	Field tableInfo:TMap
	
	'Returns a TMap containing TQueryField
	'Method should check if the key tableName is already
	'inside the tableInfo TMap. If it isn't, it should call
	'a SetTableInfo(tableName:String)
	Method GetTableInfo:TMap(tableName:String) Abstract
	
	'Set table info
	'It should execute a query to retrieve table info
	'about the given table. It should then add a entry into
	'tableInfo with the key tableName
	Method SetTableInfo(tableName:String) Abstract
	
	'Reset given tablename
	'Since there's a cache you could just remove the entry
	'from the tableInfo TMap
	Method ResetTable(tableName:String) Abstract
	
	'Reset all tablenames
	'Just clear the TMap
	Method Reset() Abstract
End Type
</pre><br><br>I'm suggesting using TQueryField types because they look like they can contain the data. Or perhaps some other type. The data this Type should store about a column could be: data type, NULL allowed, column name, primary key?<br><br>Just some thoughts :-) <br><br></td></tr></table><br>
<a name="913988"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> A TDBSchema should contain all tables... <br></div><br>Good point. That's what happens when I'm half-asleep ;-) <br><br></td></tr></table><br>
<a name="913993"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Htbaa</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> My prototype name should be something like TDBSchemaTable or something like that. <br><br></td></tr></table><br>
<a name="914084"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay, I've knocked together something for starters...<br><br>connection now has a getTableInfo(tablename, withDDL) method.<br><br>It returns a TDBTable object, which currently contains name:String, columns:TDBColumn[] and ddl  fields.<br>A TDBColumn has, name, dbType, nullable and defaultValue fields. Probably wants the primary-key flag added (if I can get that from most of the databases).<br><br>The second (optional) param of getTableInfo(), if set to True, will populate the ddl field of TDBTable with the SQL you would use to create that table. Not sure if ODBC will have that available, but most of the rest appear to have some way of getting that.<br><br>Not thoroughly tested as yet - only SQLite and MySQL so far, which seem to work.. or at least, don't crash...<br><br>The other drivers in SVN, have been updated to support the revised API, but have not had that particular functionality implemented yet. <br><br></td></tr></table><br>
<a name="914091"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Htbaa</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Very nice! I'll update tomorrow! Need to go to bed now :-). For the time being the other drivers could just throw an exception when that method is called? <br><br></td></tr></table><br>
<a name="914100"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >byo</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks a lot, Brucey.<br>I'll update right now.<br><br>Do you think you could support SQL Server in the future? :)<br>My company user it a lot and it really has many professional uses.<br><br>Anyway your modules are awesome. <br><br></td></tr></table><br>
<a name="914140"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Do you think you could support SQL Server in the future? <br></div><br>SQL Server should be supported indirectly via the ODBC driver.<br>One of the ODBC examples shows how to connect to an Access database via ODBC, so it should be just as easy to do so to a "proper" database ;-) <br><br></td></tr></table><br>
<a name="914316"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Htbaa</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's working really nice! Thanks! <br><br></td></tr></table><br>
<a name="914322"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> the other drivers could just throw an exception when that method is called? <br></div><br>They should return Null at the moment... which is easy enough to test for.<br>Same would happen if the table was "not found".<br><br>Could possibly set the error state too, I suppose. <br><br></td></tr></table><br>
<a name="914334"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >byo</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Really great. I'll try that, thanks. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
