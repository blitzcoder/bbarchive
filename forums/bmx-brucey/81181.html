<!DOCTYPE html><html lang="en" ><head ><title >Problems understanding cURL multi-interface</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Problems understanding cURL multi-interface</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=124" >Brucey's Modules</a>/<a href="#bottom" >Problems understanding cURL multi-interface</a><br><br>
<a name="914372"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jtfrench</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey folks,<br><br>So I've been using the BlitzMax/cURL mod that Brucey put up, and it's been awesome. I've been working on a multiplayer game, and its awesome being able to deal with the less time-sensitive data transfers over simple HTTP as opposed to doing a low-level socket transfer.<br><br>I'm having trouble getting getting cURL to operate asynchronously by using the multi-interface, and I believe my problem stems from not understanding how to use the multiSelect() command.<br><br>Currently what I do is<br><br>a) create my multihandle<br>b) prepare my individual easy handles<br>c) call multiPerform() on the multihandle<br>d) check the return value of multiPerform(), as well as monitor how many running connections are in the variable it takes as an argument<br><br>No where do I use multiSelect(), mainly because I don't see why I should have to if multiPerform() can tell me if there is more data to be retrieved.<br><br>What I've noticed though is that it is possible for multiPerform(running) to return CURLM_OK event though running &gt; 0. This perplexed me because it looks like cURL finished processing the HTTP requests, yet still has pending operations lingering.<br><br>Looking at the sample code, I notice they suggest the following usage:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
' start performing the request 
Local status:Int = multi.multiPerform(running)

While status = CURLM_CALL_MULTI_PERFORM 
	status = multi.multiPerform(running)
Wend

'QUESTION!!!! How is status = CURLM_OK but process still running?
While running And status = CURLM_OK
	' wait for network 
	If multi.multiSelect() &lt;&gt; -1 Then
		' pull in any new data, or at least handle timeouts 
              'QUESTION!!! Why do we repeat calling multiPerform() all over again? Which call is the "real" call?
		status = multi.multiPerform(running)
		While status = CURLM_CALL_MULTI_PERFORM 
			status = multi.multiPerform(running)
		Wend
	End If
Wend
</textarea><br><br>I don't understand the usage of multiSelect(), and the documentation doesn't give much details on what exactly its purpose is, or how necessary it is. Additionally, I don't get why we perform several while loops on the same multi handle in order to complete *one* multi request. My understanding that you call multiPerform() as many times as you need until you get CURLM_OK, apparently that's not the case.<br><br>Can someone help me out with this?<br><br>Thanks,<br><br>Jason <br><br></td></tr></table><br>
<a name="914685"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> "select" simply indicates that a file is ready - or not... which implies that it is busy still. "select" allows you to test the file state without blocking.<br>"multiPerform" returns the current state of the connection, and whether or not it is ready for/with more data. Again this is non-blocking.<br><br>The idea is that you can call these in a normal loop, not have to worry about your app coming to a halt while you wait for files/connections, and therefore gain background file transfers, which otherwise you'd have to do manually.<br><br>This API is a bit crazy though. I do see there's a slightly less exciting version which simplifies things a bit. I'll have a look and see if I can get it implemented at some point. <br><br></td></tr></table><br>
<a name="915907"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jtfrench</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> So I think I understand that select() lets you know when the file stream is ready, but if so, then why do you loop on multiPerform() prior to that? It appears to me like the sample code does the following:<br><br>1) Calls the initial multiPerform() request<br><br>2) Checks that status, and if CURLM_CALL_MULTI_PERFORM, it keeps doing it until it changes to CURLM_OK<br><br>3) Use multiSelect() to determine if stream ready<br><br>4) if ready, we repeat steps 1) and 2)<br><br>I'm just confused why we (loop) call multiPerform() the first time, then do a multiSelect(), then do it all over again? what's the point of the first time we loop on multiPerform() versus the second time?<br><br>I hope that makes sense!<br><br>-jason <br><br></td></tr></table><br>
<a name="917083"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jtfrench</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Anyone has any insight to offer ?<br><br>:) <br><br></td></tr></table><br>
<a name="918167"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> what's the point of the first time we loop on multiPerform() versus the second time? <br></div><br>The multiPerform() return status indicates whether it is ready to accept new data, or if it is busy transferring it. Once it returns OK, then it requires more data, so we check if the file/stream is ready by calling multiSelect(). If that is ready, then we can safely call multiPerform again.<br><br>Why? Well, both functions are non-blocking... *if* things are in the correct state. If you were to attempt to read from a file that wasn't ready, the read would block, and your app would pause momentarily. By querying these in this order, you guarantee that the process of transferring a file/stream won't block, and therefore your app should run smoothly.<br><br>I believe there's a newer method to accomplish this task now, which I should have a look at at some point, which is a little less "technical" to use :-) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
