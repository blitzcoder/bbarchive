<!DOCTYPE html><html lang="en" ><head ><title >Clueless And Frameless</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Clueless And Frameless</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=124" >Brucey's Modules</a>/<a href="#bottom" >Clueless And Frameless</a><br><br>
<a name="1293442"></a>

<a name="1293443"></a>

<a name="1293444"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dw817</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Brucey:<br><br>I'm starting to look at the modules you've done. My, haven't you been busy ! :)<br><br>Cutting to the chase, have you written a MOD and example code that will give you a frameless window while leaving the taskbar visible below - and for any setting of resolution ?<br><br>For instance, my screen is 1024x768. I'd like to create a frame in it that is 1024x728. So your MOD will not only create a frameless window but also be able to retrieve the size of the taskbar below - no matter how it is configured or sized.<br><br>I have code for this already but it uses MaxGui.Drivers which to me is a pain to use. As you stated in one of your posts, wxMax should cover what you need and - the part I like, <b>your Max2D commands will "just work."</b> <br><br></td></tr></table><br>
<a name="1293453"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >grable</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here you go, no need to beg brucey for this ;) <br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">

SuperStrict

AppTitle = "Frameless"
WindowGraphics()

Repeat
	DrawRect MouseX()-16,MouseY()-16,32,32
	Flip
	Cls
Until AppTerminate() Or KeyHit(KEY_ESCAPE)
End


Function GetBlitzmaxWindow:Int()
?Win32
	Extern "Win32"
		Function FindWindowA:Int( classname$z, windowtitle$z)	
	EndExtern
	Local handle:Int
	handle = FindWindowA( "BBDX9Device Window Class", AppTitle)								' D3D9Max2D
	If Not handle Then handle = FindWindowA( "BlitzMax GLGraphics", AppTitle)			' GLMax2D
	If Not handle Then handle = FindWindowA( "BBDX7Device Window Class", AppTitle)	' D3D7Max2D
	If Not handle Then handle = FindWindowA( "BLITZMAX_WINDOW_CLASS", AppTitle)		' MaxGUI
	Return handle
?
EndFunction

Function WindowGraphics:TGraphics( depth:Int = 0, hz:Int = 60, flags:Int = 0)
	Extern "Win32"
		Const SPI_GETWORKAREA:Int = $30
		
		Function SystemParametersInfoW:Int( action:Int, param1:Int, param2:Byte Ptr, winini:Int)
	EndExtern

	' get size of desktop minus taskbar/toolbars
	Local rect:Int[4]
	SystemParametersInfoW( SPI_GETWORKAREA, 0, rect, 0)
	
	Local g:TGraphics = Graphics( rect[2], rect[3], depth, hz, flags)
	Local hwnd:Int = GetBlitzmaxWindow()
	Assert hwnd Else "unable to find BlitzMax window"

	' remove window frame
	Local wflags:Int = GetWindowLongW( hwnd, GWL_STYLE)	
	SetWindowLongW( hwnd, GWL_STYLE, wflags &amp; WS_SIZEBOX)

	' update window
	SetWindowPos( hwnd, HWND_TOP, rect[0],rect[1], rect[2], rect[3], SWP_FRAMECHANGED | SWP_NOZORDER | SWP_HIDEWINDOW)
	ShowWindow( hwnd, 1)

	Return g
EndFunction
</textarea> <br><br></td></tr></table><br>
<a name="1293456"></a>

<a name="1293457"></a>

<a name="1293528"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dw817</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Grable.<br><br>Thanks - I'm not liking the fact that my code is smaller though:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Strict
Import maxgui.drivers ' non-standard library For building 'gadgets'
Local deskrect[4]
GetDesktopArea(deskrect) '&lt;- Get Desktop size
Local a=deskrect[0],b=deskrect[1],c=deskrect[2],d=deskrect[3]

SetGraphicsDriver GLMax2DDriver(),0 ' zero forces front buffer
Local zvideo:tgadget=CreateWindow("",a,b,c,d,,0) ' special graphics
Local zframe:tgadget=CreateCanvas(a,b,c,d,zvideo,0) ' is frameless
SetGraphics CanvasGraphics(zframe)
ActivateGadget zframe ' necessary or you must click to activate
EnablePolledInput() ' necessary for normal key &amp; mouse reading
SetBlend alphablend ' black is transparent

DrawText "Hello world ! This is a FRAMELESS window.",10,10
glflush ' update screen
WaitKey ' press a key to exit

' &gt;&gt; GET DESKTOP AREA MINUS TASKBAR
' THANK YOU DAN UPRIGHT
Function getdesktoparea(lprect:Int Ptr)
  systemparametersinfoa(spi_getworkarea,0,lprect,0)
End Function
Extern "Win32"
  Function SystemParametersInfoA:Int(action:Int, param:Int, param2:Byte Ptr, winini:Int)
EndExtern
</textarea><br><br>About half the size. Still, Grable - yours is not even calling a module nor do I have to twinge the system in yours to get back my favored and normal keyboard and mouse input back. I like yours better.<br><br>Now how do I set it so I have the effect of this command ?<pre class=code>SetGraphicsDriver GLMax2DDriver(),0 ' zero forces front buffer</pre>So I can have my favored glflush() command back and working ?<br><br>And - is there a way to have frameless but from a set size say 640x480 and at any position on the screen ? <br><br></td></tr></table><br>
<a name="1293459"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >grable</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Now how do I set it so I have the effect of this command ?<br>SetGraphicsDriver GLMax2DDriver(),0 ' zero forces front buffer <br></div>Like you would when you normally call Graphics. Call it first.<br><br><div class="quote"> And - is there a way to have frameless but from a set size say 640x480 and at any position on the screen ? <br></div>If you read the code you would know how ;)<br>But il post it anyway.<br><pre class=code>
Function WindowGraphics:TGraphics( x:Int, y:Int, w:Int, h:Int, depth:Int = 0, hz:Int = 60, flags:Int = 0)
	Local g:TGraphics = Graphics( w,h, depth, hz, flags)
	Local hwnd:Int = GetBlitzmaxWindow()
	Assert hwnd Else "unable to find BlitzMax window"

	' remove window frame
	Local wflags:Int = GetWindowLongW( hwnd, GWL_STYLE)	
	SetWindowLongW( hwnd, GWL_STYLE, wflags &amp; WS_SIZEBOX)

	' update window
	SetWindowPos( hwnd, HWND_TOP, x,y, w, h, SWP_FRAMECHANGED | SWP_NOZORDER | SWP_HIDEWINDOW)
	ShowWindow( hwnd, 1)

	Return g
EndFunction
</pre> <br><br></td></tr></table><br>
<a name="1293463"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dw817</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Grable. As for the SetGraphicsDriver, I wouldn't be asking if I didn't know. If you try:<pre class=code>AppTitle = "Frameless"
SetGraphicsDriver GLMax2DDriver(),0 ' zero forces front buffer
WindowGraphics()</pre>You will see this does not work. The screen locks up. If you try this:<pre class=code>AppTitle = "Frameless"
WindowGraphics()
SetGraphicsDriver GLMax2DDriver(),0 ' zero forces front buffer</pre>It crashes. So no, that is why I am asking.<br><br>As for the function - thanks ! I see a bit needs to be added. if X Y W H are zero, then I can add code to instead use the standard values from rect[0 1 2 3].<br><br>Marvel of code to not use a MOD, really do appreciate it !<br><br>Still ... how difficult would it have been to ALREADY have a frameless option for graphics in default BlitzMAX ? :) <br><br></td></tr></table><br>
<a name="1293469"></a>

<a name="1293471"></a>

<a name="1293472"></a>

<a name="1293473"></a>

<a name="1293474"></a>

<a name="1293475"></a>

<a name="1293476"></a>

<a name="1293477"></a>

<a name="1293522"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >grable</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> It was working as expected, but the window didnt refresh properly and thus taking on whatever was behind it.<br>My guess is that GLGraphicsDriver doesnt refresh the window like D3D9 does before handing it over.<br><pre class=code>
Function WindowGraphics:TGraphics( depth:Int = 0, hz:Int = 60, flags:Int = 0)
	Extern "Win32"
		Const SPI_GETWORKAREA:Int = $30
		
		Function SystemParametersInfoW:Int( action:Int, param1:Int, param2:Byte Ptr, winini:Int)
	EndExtern

	' get size of desktop minus taskbar/toolbars
	Local rect:Int[4]
	SystemParametersInfoW( SPI_GETWORKAREA, 0, rect, 0)
	
	Local g:TGraphics = Graphics( rect[2], rect[3], depth, hz, flags)
	Local hwnd:Int = GetBlitzmaxWindow()
	Assert hwnd Else "unable to find BlitzMax window"

	' remove window frame
	Local wflags:Int = GetWindowLongW( hwnd, GWL_STYLE)	
	SetWindowLongW( hwnd, GWL_STYLE, wflags &amp; ~WS_CAPTION)
	SetWindowPos( hwnd, HWND_TOP, 0,0,0,0, SWP_FRAMECHANGED | SWP_NOMOVE | SWP_NOSIZE |  SWP_NOZORDER | SWP_HIDEWINDOW)

	' force window refresh
	Cls
	
	' update window
	SetWindowPos( hwnd, HWND_TOP, rect[0],rect[1], rect[2], rect[3], SWP_NOZORDER | SWP_SHOWWINDOW)
	
	Return g
EndFunction
</pre><br>EDIT: Btw, fixed border removal by removing the actual flags. <br><br></td></tr></table><br>
<a name="1293527"></a>

<a name="1293529"></a>

<a name="1293530"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dw817</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wait !<br><br>Nailed it. :D I needed a Delay 1 after the Glflush. Works ! Really do appreciate it. I'll use this model for future frameless.<br><br>Here is final model:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
SuperStrict

AppTitle = "Frameless"
SetGraphicsDriver GLMax2DDriver(),0 ' zero forces front buffer
WindowGraphics()

Repeat
	DrawRect MouseX()-16,MouseY()-16,32,32
	glflush
	Delay 1
	Cls
Until AppTerminate() Or KeyHit(KEY_ESCAPE)
End


Function GetBlitzmaxWindow:Int()
?Win32
	Extern "Win32"
		Function FindWindowA:Int( classname$z, windowtitle$z)	
	EndExtern
	Local handle:Int
	handle = FindWindowA( "BBDX9Device Window Class", AppTitle)								' D3D9Max2D
	If Not handle Then handle = FindWindowA( "BlitzMax GLGraphics", AppTitle)			' GLMax2D
	If Not handle Then handle = FindWindowA( "BBDX7Device Window Class", AppTitle)	' D3D7Max2D
	If Not handle Then handle = FindWindowA( "BLITZMAX_WINDOW_CLASS", AppTitle)		' MaxGUI
	Return handle
?
EndFunction

Function WindowGraphics:TGraphics( depth:Int = 0, hz:Int = 60, flags:Int = 0)
	Extern "Win32"
		Const SPI_GETWORKAREA:Int = $30
		
		Function SystemParametersInfoW:Int( action:Int, param1:Int, param2:Byte Ptr, winini:Int)
	EndExtern

	' get size of desktop minus taskbar/toolbars
	Local rect:Int[4]
	SystemParametersInfoW( SPI_GETWORKAREA, 0, rect, 0)
	
	Local g:TGraphics = Graphics( rect[2], rect[3], depth, hz, flags)
	Local hwnd:Int = GetBlitzmaxWindow()
	Assert hwnd Else "unable to find BlitzMax window"

	' remove window frame
	Local wflags:Int = GetWindowLongW( hwnd, GWL_STYLE)	
	SetWindowLongW( hwnd, GWL_STYLE, wflags &amp; ~WS_CAPTION)
	SetWindowPos( hwnd, HWND_TOP, 0,0,0,0, SWP_FRAMECHANGED | SWP_NOMOVE | SWP_NOSIZE |  SWP_NOZORDER | SWP_HIDEWINDOW)

	' force window refresh
	Cls
	
	' update window
	SetWindowPos( hwnd, HWND_TOP, rect[0],rect[1], rect[2], rect[3], SWP_NOZORDER | SWP_SHOWWINDOW)
	
	Return g
EndFunction
</textarea> <br><br></td></tr></table><br>
<a name="1293532"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >grable</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Great :)   <br><br>It should even handle vertical taskbars and other toolbars as well, so you can go all in!<br><br>Though i cant for the life of me understand why you insist on using single buffering and glFlush.. Unless your running on ancient hardware and or an intel gpu. Im guessing both ;)<br><br>For comparison, with glFlush i get 490 FPS, which is fast sure. But with "Flip 0" i get 7480!<br>I know what im using ;)  (which is "Flip 1", no need to render thousands or even hundreds of frames needlessly) <br><br></td></tr></table><br>
<a name="1293566"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dw817</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Grable, could you please post a working example of this ? The reason I'm using Glflush() is because of the following:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Strict
Local typ

typ=0
' typ=0 use normal graphics
' typ=1 use front buffer graphics

If typ=0
  SetGraphicsDriver GLMax2DDriver() ' necessary for busy pixel reading and writing
Else
  SetGraphicsDriver GLMax2DDriver(),0 ' zero forces front buffer
EndIf

Graphics 640,480

DrawOval 50,50,50,50

If typ=0
  Flip
Else
  glflush
EndIf

WaitKey

DrawOval 150,150,50,50

If typ=0
  Flip
Else
  glflush
EndIf

WaitKey

DrawOval 250,250,50,50

If typ=0
  Flip
Else
  glflush
EndIf

WaitKey
</textarea><br><br>As you can see, Flip() flips around the images making it difficult to lock anything down.<br><br>Now with Glflush() the images stay. I want this for my work. I hate calling Flip() and finding I haven't done it right or something and it messes up on me.<br><br>Still - code that shows 490 over 7480, I'd be very interested in seeing that. <br><br></td></tr></table><br>
<a name="1293567"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Using Flip is not difficult :<br><br>Draw all your stuff<br>Flip()<br>Draw all your stuff<br>Flip()<br>etc. <br><br></td></tr></table><br>
<a name="1293576"></a>

<a name="1293577"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >grable</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> As you can see, Flip() flips around the images making it difficult to lock anything down. <br></div>Then dont do it like that. Your way of alternating drawing and flushing is an ancient way of doing things.<br>And is infact slower on modern hardware and operating systems.<br><br>The normal way to do things today, as Brucey pointed out. Is to draw everything each frame.<br><br><div class="quote"> Still - code that shows 490 over 7480, I'd be very interested in seeing that. <br></div>That was using the code in this very thread. With an added function for measuring fps:<br><pre class=code>
Function FPS:Int()
	Const UPDATE:Float = 0.5
	Global count:Int, lastcount:Int, lastupdate:Int
	
	If (MilliSecs() - lastupdate) &gt; Int(UPDATE * 1000.0)
		lastcount = Float(count / UPDATE)
		count = 1
		lastupdate = MilliSecs()
	Else
		count :+ 1
	EndIf
	Return lastcount
EndFunction
</pre>So not a proper benchmark, but with a black screen and a 32x32 square it is indicative of the maximum frames your gpu is capable of pushing.<br><br>EDIT: To get a similar effect to single buffering, dont call Cls. <br><br></td></tr></table><br>
<a name="1293595"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dw817</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Brucey, that does not work if you have this command in place.<pre class=code>SetGraphicsDriver GLMax2DDriver() ' necessary for busy pixel reading and writing</pre><br><br>If I DON'T use this command then while Flip() works every time I read and write pixels - things will start to slow down until it crashes. This was discovered earlier HERE:<br><br><a href="/posts.php?topic=105546" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=105546</a><br><br>So, I need that SetGraphicsDriver command and I need a Flip() that will let me call it without swapping circles (as the example I posted above). I also do not want to use Flip() as it is inherently slower than Glflush(). Try this code:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Strict
SetGraphicsDriver GLMax2DDriver(),0 ' zero forces front buffer
Graphics 640,480

Global typ=1
' 0=Flip()
' 1=Glflush()

Local a$="Glflush()",c
If typ=0 Then a$="Flip()"

Local t=MilliSecs()

DrawOval 50,50,50,50
update
DrawOval 100,100,50,50
update
DrawOval 150,150,50,50
update

Repeat
  DrawRect 0,0,16,16
  update
  c:+1
Until MilliSecs()-t&gt;2000

Print"Did "+c+" "+a$+" in 2-seconds time."
WaitKey

Function update()
  If typ=0 Then Flip
  If typ=1 Then glflush
EndFunction
</textarea><br><br>Now you tell me what's going on here. <br><br></td></tr></table><br>
<a name="1293601"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TomToad</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Flip is deliberately slower.  It is supposed to sync with your monitor rate.  This is to prevent tearing.  Any higher is useless as your monitor will actually only show 60 frames every second.  All other frames are lost.  It is best to spend that extra time updating your logic instead of drawing frames that will never be seen.<br><br>If for some reason you need to flip as fast as possible, you can use Flip 0 (or Flip false).  This will prevent Flip from syncing to the refresh rate.  If you change the Flip to Flip 0 in your code above, you will notice you get almost exactly the same values. <br><br></td></tr></table><br>
<a name="1293615"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >grable</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> If I DON'T use this command then while Flip() works every time I read and write pixels - things will start to slow down until it crashes. <br></div>I tried the example in that post and could draw with the mouse until there was nothing left, and it didnt slow down or crash.<br><br>If it does that for you, again you must have old ass hardware and drivers. As the only reason i could see that example doing that would be running out of gpu memory, and the hardware then doesnt have enough and/or the drivers are unable to free the textures fast enough.<br><br><div class="quote"> Now you tell me what's going on here. <br></div>Well first of all, your still calling Flip 1 (1 being the default) and that V-SYNCS. so low framerates is expected. IE it will LOCK to your monitors refresh-rate, which is probably 60 if its an LCD.<br>So comparing it to only glFlush is wrong, for a fairer comparison you need to use Flip 0.<br><br>Here is my results for that test, with Flip 0:<pre class=code>
Did 19357 Flip(0) in 2-seconds time.
Did 22224 Glflush() in 2-seconds time.
</pre>And with double buffering:<pre class=code>
Did 32335 Flip(0) in 2-seconds time. -- DID display correctly
Did 3922442 Glflush() in 2-seconds time. -- did NOT display correctly
</pre>Even though this shows glFlush to be "faster" than Flip, it allso shows double buffering to be insanly "faster".<br>I say "faster" because at that point it doesnt really matter, all it serves to do is eat power and resources needlessly.<br><br>And btw, you do know that glFlush and Flip are not equivalent right? glFlush only flushes the command queues, but returns almost immediately. Which is why you seem to need "Delay 1" or more when the command queue takes longer to execute.<br>The more correct function to call would be glFinish, as that actually waits for the completion of the queued gl commands before returning. <br><br></td></tr></table><br>
<a name="1293625"></a>

<a name="1293627"></a>

<a name="1293628"></a>

<a name="1293629"></a>

<a name="1293637"></a>

<a name="1293641"></a>

<a name="1293642"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dw817</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Glfinish is it ??<br><br>*SIGH* Wow, LOL ! How many more ways are there to transfer a screen of graphics ? :D<br><br>Are you guyz okay with Glfinish over Glflush ?<br><br>There is still a problem. Let me refer to my "Nifty Scrolling Map"<br><br><a href="/post.php?topic=105731&amp;post=1293123" target="_blank">http://www.blitzbasic.com/Community/post.php?topic=105731&amp;post=1293123</a><br><br>Now if I replace the <b>Glflush</b> with <b>Flip</b> or <b>Flip -1</b>, I get very undesirable results.<br><br>Changing it to <b>Flip 0</b> or <b>Flip 1</b> it works. And, apparently because of the <b>SetGraphicsDriver GLMax2DDriver(),0</b> Flip() is not flickering. I tested it by putting one back to back with another in the code and there is no difference.<br><br>Awright, let's recap. So I shouldn't use Glflush nor Glfinish and instead should use <b>Flip 0</b> or <b>Flip 1</b>, yes ?<br><br>Essentially I want to create my own timer. If you try out the mapper as is, you will see I don't need Flip() at all and Glflush along with a perfect timer gives flawless pixel movement. At least it does here.<br><br><b>If it does that for you, again you must have old ass hardware and drivers</b><br><br>That's actually a good thing. That means if it runs on my system it should run on others. However =YOU= guys might be able to write code that WON'T run on my system because you're not taking into account <b>old ass hardware and drivers</b>. So I can test it for ya. :)<br><br><strike>Okay, now what is the difference between <b>Flip 0</b> and <b>Flip 1</b> ?<br><br>I inserted this code:<pre class=code>  For i=0 To 77
  Flip 1
  Next
  WaitTimer timer ' defined above, wait specified time</pre>And there is no difference then if I just used one <b>Flip 1</b>.</strike><br><br>I see it described in the help file:<br><br><b>If sync is 0, then the flip occurs as soon as possible. If sync is 1, then the flip occurs on the next vertical blank.</b><br><br>As soon as possible is what I want, so I can use <b>Flip 0</b> (zero) and build my own timers, like I did for the Mapper. Awright, I can adjust all my code to do that. Won't be the least bit surprised of <b>Flip 0</b> does the exact same thing <b>Glflush</b> does and <b>Flip 1</b> does the exact same thing <b>Glfinish</b> does. :)<br>. . .<br><br>:(<br><br>Actually no. I plugged in those commands, <b>Flip 0</b> and <b>Flip 1</b> and <b>Glfinish</b> in place of <b>Glflush</b> and so far Glflush is the fastest.<br><br>The main good news is I can use Flip() anywhere and it doesn't flicker or swap pages using <b>SetGraphicsDriver GLMax2DDriver(),0</b>.<br><br>And yet ... Glflush by itself with no timer is perfectly unusable. No screen can update with it until a timer is called, and even a Timer of 1 is slower than a single Flip 0.<br><br>Pondering ... Let's lay it out:<br><br><b>Flip -1</b> 117 cycles<br><b>Flip 0</b> 14911 cycles<br><b>Flip 1</b> 14896 cycles<br><b>Glflush w NO Timer</b> 515931 cycles (but unusable)<br><b>Glflush w Timer 1</b> 1060 cycles<br><b>Glfinish</b> 10448 cycles<br><br><img src="http://www.writerscafe.org/uploads/rte/df62a134d9e0124d02343b9d39cfcf7a.png"><br><br>Okay. That helps. Looks like <b>Flip 0</b> is the hero after all ! <br><br></td></tr></table><br>
<a name="1293660"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >grable</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Okay. That helps. Looks like Flip 0 is the hero after all! <br></div>So arguing on the internet pays off in the end?<br>Just kidding :P  im glad you figured something out atleast.<br>And its always nice to play well with the standard way of doing things.<br><br><div class="quote"> No screen can update with it until a timer is called <br></div>The reason for this is that GL never gets time to update it! By the time it is finished with its queue, you are already midway in another. So the driver gets confused and tries its best keep up, but to no avail.<br><br><div class="quote"> a Timer of 1 is slower than a single Flip 0. <br></div>And that is because of OS process scheduling, any Delay on the main thread will make the process yield its timeslice to another process, even one as low as 1ms. <br><br></td></tr></table><br>
<a name="1293667"></a>

<a name="1293670"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dw817</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> I can't emphasize the importance of using these commands however, Grable.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
SetGraphicsDriver GLMax2DDriver(),0
Graphics 640,480
Global timer:ttimer=CreateTimer(120) ' # of frames per second

For i=0 until 500
  Cls
  DrawOval i,200,50,50
  update
  If KeyDown(27)Then Exit
Next

Function update()
  Flip 0 ' fastest flip in town
  WaitTimer timer ' flawless timer
EndFunction
</textarea><br><br>Now if you change <b>Flip 0</b> to <b>Flip</b> and even put a remark symbol <b>'</b> in front of the WaitTimer, you will see it definitely slogs slower than before.<br><br>Now what surprises me is apparently flip all by itself is running at 60 frames-per-second where I was understanding games today were 120 frames-per-second.<br><br>It's not a problem. I can use <b>Flip 0</b> and <b>WaitTimer</b>. The added advantage too is I can run it even faster than that by doubling the top from <b>CreateTimer(120)</b> to <b>CreateTimer(240)</b>. Much better control over how fast any code I write runs.<br><br>But THIS code above should let people be aware of just how much Flip() is slowing them down and preventing them from seeing the real speed behind BlitzMAX when checked in place with an accurate timer ... <br><br></td></tr></table><br>
<a name="1293668"></a>

<a name="1293669"></a>

<a name="1293671"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dw817</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh, and here is the final model of Frameless Window. I'll be using this on TileMaster when I get around to finishing it.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Strict
AppTitle = "Frameless" ' not needed since window is "frameless." :)

Global scrnz[4] ' global screen coordinates - can use later in code
Local i,j,typ

SetGraphicsDriver GLMax2DDriver(),0 ' zero forces front buffer

typ=0
' typ=0 full-screen, any client
' typ=1 fixed and centered 640x480

If typ=0
  windowgraphics
Else
  windowgraphics 640,480
EndIf

For i=0 To scrnz[3] Step 2
  For j=0 To scrnz[2] Step 2
    Plot j,i ' plot every other pixel to see if there is any distortion in field
  Next
Next
Flip 0
WaitKey
DrawRect 0,0,scrnz[2],scrnz[3] ' fill screen with white
SetColor 0,0,0
DrawRect 2,2,scrnz[2]-4,scrnz[3]-4 ' hollow it out, 2-pixels in width, check for any pixels off edge
Flip 0
WaitKey
'Until AppTerminate() Or KeyHit(KEY_ESCAPE)
End

' FRAMELESS WINDOW OF ANY SIZE
' THANK YOU GRABLE
Function GetBlitzmaxWindow()
?Win32
  Extern "Win32"
    Function FindWindowA(classname$z,windowtitle$z)  
  EndExtern
  Local handle:Int
  handle=FindWindowA("BBDX9Device Window Class",AppTitle)                    ' D3D9Max2D
  If Not handle Then handle=FindWindowA("BlitzMax GLGraphics",AppTitle)      ' GLMax2D
  If Not handle Then handle=FindWindowA("BBDX7Device Window Class",AppTitle) ' D3D7Max2D
  If Not handle Then handle=FindWindowA("BLITZMAX_WINDOW_CLASS",AppTitle)    ' MaxGUI
  Return handle
?
EndFunction

Function WindowGraphics:TGraphics(h=0,v=0,x=0,y=0,depth=0,hz=0,flags=0)
  Extern "Win32"
    Function SystemParametersInfoW(action,param1,param2:Byte Ptr,winini)
  EndExtern
  If h+v+x+y ' we want a different size window other than max screen
    If x+y=0 ' only x &amp; y are given, place in center
      scrnz[0]=DesktopWidth()/2-h/2
      scrnz[1]=DesktopHeight()/2-v/2
      scrnz[2]=h
      scrnz[3]=v
    Else ' all 4-coordinates are different
      scrnz[0]=h ; scrnz[1]=v ; scrnz[2]=x ; scrnz[3]=y
    EndIf
  Else
    SystemParametersInfoW $30,0,scrnz,0 ' get size of desktop
  EndIf
  Local g:TGraphics=Graphics(scrnz[2],scrnz[3],depth,hz,flags)
  Local hwnd=GetBlitzmaxWindow()
  Assert hwnd Else "unable to find BlitzMax window"
  Local wflags=GetWindowLongW(hwnd,GWL_STYLE) ' remove window frame
  SetWindowLongW hwnd,GWL_STYLE,wflags &amp; WS_SIZEBOX
  SetWindowPos hwnd,HWND_TOP,scrnz[0],scrnz[1],scrnz[2],scrnz[3],SWP_FRAMECHANGED|SWP_NOZORDER|SWP_HIDEWINDOW ' update window
  ShowWindow hwnd,1
  Return g
EndFunction
</textarea><br><br>BTW, there's an initial hiccup which can definitely be seen if you choose a window smaller than your client's, Grable. It shows the frame and then removes it. Is there a way to prevent against this so when the window is created, it's already frameless ? <br><br></td></tr></table><br>
<a name="1293673"></a>

<a name="1293674"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >grable</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Now what surprises me is apparently flip all by itself is running at 60 frames-per-second where I was understanding games today were 120 frames-per-second. <br></div>As said more than once, Flip defaults to VSYNC so getting 60 is the expected behaviour IF your monitor refresh rate is 60hz, which it probably is then.<br>And no, games today run at whatever the hardware can manage unless VSYNC is on.<br><br><div class="quote"> It shows the frame and then removes it. Is there a way to prevent against this so when the window is created, it's already frameless ?  <br></div>Not without modifying GLGraphicsDriver, its an easy enough change though. But you would need MINGW to recompile it. <br><br></td></tr></table><br>
<a name="1293676"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dw817</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm ... Dare I ask ... how EASY ?<br><br>And yes, I tried a <b>Graphics 0,0</b> just to see if it would not appear, Grable. No, it does, ugly frame and all. <br><br></td></tr></table><br>
<a name="1293687"></a>

<a name="1293688"></a>

<a name="1293689"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >grable</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Hmm ... Dare I ask ... how EASY ? <br></div>Adding 3 lines to the C code.<br>Basically adding a new flag and checking for it before window creation..<br><br>EDIT: Heres a precompiled version og BRL.GLGraphics doing just that. <a href="https://drive.google.com/open?id=0BzVLNZSckvfhT1pwOFBTOGtucTQ" target="_blank">https://drive.google.com/open?id=0BzVLNZSckvfhT1pwOFBTOGtucTQ</a><br>usage:<pre class=code>
Graphics 640,480, 0,0, GLGRAPHICS_FRAMELESS
</pre> <br><br></td></tr></table><br>
<a name="1293694"></a>

<a name="1293696"></a>

<a name="1293697"></a>

<a name="1293698"></a>

<a name="1293699"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dw817</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> wait, I think it got it. I had to MOVE the original folder out of there.<br><br>... nope, still didn't work. Shows the frame. Here's the code: <pre class=code>Strict
Graphics 640,480,0,0,GLGRAPHICS_FRAMELESS
WaitKey</pre>Both debug and without. And because there is STRICT, that means GLGRAPHICS_FRAMELESS is a recognized constant. <br><br></td></tr></table><br>
<a name="1293704"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >grable</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> And because there is STRICT, that means GLGRAPHICS_FRAMELESS is a recognized constant. <br></div><br>Hmmm, it would seem to be installed correctly if so yes.<br><br>But you of course need to:<pre class=code>
SetGraphicsDriver GLMax2DDriver()
</pre>Because the default on windows is to use D3D9.<br><br>Btw, i accidentally left in some debug prints. You should redownload the file for an updated version. <br><br></td></tr></table><br>
<a name="1293711"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dw817</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> Capital ! That got it, Grable. Let me check w some other programs. Using <b>SetGraphicsDriver GLMax2DDriver(),0</b><br><br>Awright ... Hmm ... Now I'm wondering why the mass of code above if all I needed to do was update my GlGraphics library.<br><br>Any other tasty libraries I should know about ? Re-downloading the link you sent as you said it was updated.<br><br>Also, perhaps a list of what has been changed or updated in GlGraphics.mod ? <br><br></td></tr></table><br>
<a name="1293712"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >grable</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> The only thing i added was the GLGRAPHICS_FRAMELESS and frameless window creation.<br>If your talking about my second update to that file, it was some debug prints i forgot to remove.<br><br>Just be warned that you can not share code using GLGRAPHICS_FRAMELESS with others without that change. <br><br></td></tr></table><br>
<a name="1293713"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dw817</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah, that is the problem there. Hmm ... Is there an official rewrite of all of BlitzMAX or something that is used by most of the members I'm not aware of ?<br><br>And Frameless graphics is a visual preference of mine I just want to have - it's not required to demonstrate any visual code I might write for others. <br><br></td></tr></table><br>
<a name="1293718"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >grable</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well there is the Open Source version, and Bruceys updated ones he uses for BMX-NG.<br>But it seems most people stay with vanilla 1.50 still. Me included. <br><br></td></tr></table><br>
<a name="1293719"></a>

<a name="1293723"></a>

<a name="1293724"></a>

<a name="1293729"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dw817</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> Let me check my version ... I have:<br><br><div class="quote"> BCC Version: BlitzMax Release Version 1.50<br>BlitzMax Path: c:\David\BlitzMax-1.50<br>MinGW Path c:\TDM-GCC-32<br>FASM Version: 1.69.14<br>GCC Version: 5.1.0<br>G++ Version 5.1.0 <br></div><br>I know it says MinGW but I never could understand it - might be installed but darned if I know how to use it or really what it's for. :)<br><br>Welp, I have the ultimate Frameless window now. Both in code and Mods. Really do appreciate you getting this set up for me.<br><br>I'm going to open a conversation regarding BlitzMAX's <b>SeedRnd()</b> command. I hope you'll be there ! <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
