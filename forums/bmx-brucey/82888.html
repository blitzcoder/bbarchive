<!DOCTYPE html><html lang="en" ><head ><title >Box2d SetAngle Problem</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Box2d SetAngle Problem</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=124" >Brucey's Modules</a>/<a href="#bottom" >Box2d SetAngle Problem</a><br><br>
<a name="935316"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Armitage 1982</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Brucey<br><br>First I ask into the box2d forum because I think it was very related to the engine.<br>Then I discovered that the b2BodyDef::setAngle() is not present in the official API of Box2d.<br><br>My problem only happen with dynamic polygons object (created with b2PolygonDef).<br>Static or b2CircleDef give no freezing problem !<br><br>So, in my level editor when I modify any dynamic cube (for example) to change is b2BodyDef angle via setAngle(degrees:float) in order to re-create it after this new definition setting, my game freeze...<br><br>I look into the glue.cpp quickly and find this setter :<br><br><pre class=code>void bmx_b2bodydef_setangle(b2BodyDef * def, float32 angle) {
	def-&gt;angle = angle * 0.0174533f;
}</pre><br><br>Maybe there is a problem somewhere with this degrees=&gt;radians shortcut ?<br>I don't know, this is very strange since it works fine in any other situation.<br>And my code is using the exact same re-creation code for any definition.<br><br>Is this a bug ?? <br><br></td></tr></table><br>
<a name="935317"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Is this a bug ??  <br></div><br>Possibly.<br><br>I can instead create def specific functions rather than the shared one they are all using. It might fix it. <br><br></td></tr></table><br>
<a name="935322"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Armitage 1982</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Maybe...<br>I was thinking of this too.<br>I'll wait some answers at the box2d forum (http://www.box2d.org/forum/viewtopic.php?f=3&amp;t=2077) and double check my code until then.<br><br>Thanks <br><br></td></tr></table><br>
<a name="935448"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I had a closer look at bodydef, and it seems to be okay.<br>Are you sure your instance of the def object is still valid when you try to use it?<br><br>Or perhaps it is the polygondef which is causing problems? <br><br></td></tr></table><br>
<a name="935478"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Armitage 1982</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> The def object is still valid when used since it's part of a super-type.<br>It's probably coming from my code since I can't reproduce this bug :(<br><br>Maybe I have to forget the idea of rotating bodyDef in the level editor for a while and just go on. <br><br></td></tr></table><br>
<a name="935480"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> As long as the body def pointer is valid you should, presumably, be able to call any of the methods as often as you like - without issue.<br>And the only way that the pointer will be freed is when the BlitzMax object is GC'd.<br><br>At least, that's what should be happening :-) <br><br></td></tr></table><br>
<a name="935519"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Armitage 1982</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Since it's pretty hard to track internal box2d objects and since I'm only using the bodyDef as a values container I try to get rid of that problem by adding one more Field to my object called angle.<br><br>Instead of using bodyDef::setAngle() to save my angle before any object re-setuping I only set this new Field.<br><br>But the freeze problem is still there so there is probably something weird in my polygonDef finalization. <br><br></td></tr></table><br>
<a name="935524"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Armitage 1982</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think I find the problem :D<br><br>In fact I'm using a super-type b2ShapeDef.<br>This type is passed by reference in my set Object Definition function.<br><br>The problem reside in one of these initialisation (maybe all)<br><pre class=code>shapeDef.SetDensity(vDensity)
shapeDef.SetFriction(vFriction)
shapeDef.SetRestitution(vRestitution)
shapeDef.GetFilter().SetCategoryBits(vFilterCategoryBits)
shapeDef.GetFilter().SetGroupIndex(vFilterGroupIndex)
shapeDef.GetFilter().SetMaskBits(vFilterMaskBits)</pre><br><br>I suppose since there is new b2shapeDef (for circle, poly, etc.) that box2d setup those in a completely different way based on the type.<br>And since I'm not directly using b2PolygonDef or b2CircleDef, the default method present in b2ShapeDef just don't work correctly.<br><br>That was a difficult one ^^<br><br>But then ?<br>Does that mean that b2ShapeDef method are broken somewhere ? <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
