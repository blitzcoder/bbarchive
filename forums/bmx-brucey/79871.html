<!DOCTYPE html><html lang="en" ><head ><title >serialization question</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >serialization question</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=124" >Brucey's Modules</a>/<a href="#bottom" >serialization question</a><br><br>
<a name="897017"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Can the serialization module keep track of references to other objects within fields?<br><br>E.g.<br><br>Type box<br>field owner:character<br>endtype<br><br>or how about lists of objects within fields?<br><br>e.g.<br>type box<br>field item_list:tlist<br>endtype<br><br>how about 2 dimensional arrays? with a list in each cell<br><br>and where is the download?<br><br>cant find it here:<br><a href="http://code.google.com/p/maxmods/downloads/list" target="_blank">http://code.google.com/p/maxmods/downloads/list</a> <br><br></td></tr></table><br>
<a name="897021"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, yes, and no.<br><br>Any references to other objects in the object that you are serializing will be serialized too. On de-serializing, you will end up with exactly the same structure as you had before you serialized - albeit the object id's will be different. (where the object id is it's memory location).<br><br>All I can say really is, try it and see ;-)<br><br>Blitz's Reflection doesn't currently support arrays of more than one dimension, alas - so I'm bound by that too.<br><br>Oh, and it also handles circular Object references :-) <br><br></td></tr></table><br>
<a name="897024"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> thanks,<br>I looked here for the download but couldnt find it<br><a href="http://brucey.net/programming/blitz/" target="_blank">http://brucey.net/programming/blitz/</a><br><a href="http://code.google.com/p/maxmods/downloads/list" target="_blank">http://code.google.com/p/maxmods/downloads/list</a> <br><br>is the google protocol buffers any better? <br><br></td></tr></table><br>
<a name="897027"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah... it's currently available via SVN... but here's a zip of the latest source : <a href="http://brucey.net/programming/blitz/modules/persistence/persistence.zip" target="_blank"> persistence.zip</a> (5.9 kb).<br><br>There's only one example currently, but it should give you and idea of what it can do.<br><br>:o) <br><br></td></tr></table><br>
<a name="897028"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> thanks <br><br></td></tr></table><br>
<a name="897030"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh, you will need the libxml module btw... (for the nice xml output to work) :-) <br><br></td></tr></table><br>
<a name="897050"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> i had a look at the example...<br><br>how would you save and load some characters and their items?<br><br>e.g.<br><br>type character<br>field name$<br>field item_list:tlist<br>endtype<br><br>type item<br>field name$<br>endtype <br><br></td></tr></table><br>
<a name="897057"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is a small example showing how to serialize the object to a String<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
SuperStrict

Import BaH.Persistence

Type character
	Field name$
	Field item_list:TList
EndType

Type item
	Field name$
EndType 


' create a character with a sword

Local me:character = New character
me.name = "Fred"

me.item_list = New TList

Local sword:item = New item
sword.name = "Short Sword"

me.item_list.AddLast(sword)


' this will serialize "me" to a String
Local s:String = TPersist.Serialize(me)
' let's see what it looks like!
Print s

' just to prove that it serialized properly... we'll create a new character from the string!
Local you:character = character(TPersist.DeSerialize(s))

If you Then
	' if we get here, then "you" is a real object
	Print "name = " + you.name

End If
</textarea> <br><br></td></tr></table><br>
<a name="897058"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can also create a "TStream", and have the object save into the stream instead.<br><br>The module supports all writeable streams.<br><br>To use it this way, you need to create a TPersist object, and call the SerializeToStream() method :<br><br><pre class=code>
Local pers:TPersist = New TPersist

Local stream:TStream = WriteStream("example.bmo")
pers.SerializeToStream(the_object, stream)

stream.Close()
</pre><br><br>You can also use SerializeToFile(), which takes a filename as a param.<br><br>Hopefully that covers most options? :-) <br><br></td></tr></table><br>
<a name="897198"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> yeah I managed to save the game succesfully! this is a good module<br><br>not sure about loading though<br><br><br>EDIT-<br>I serialized each character in my character-list,<br>in the BMO file it says<br><br>&lt;?xml version="1.0"?&gt; every time there is a character(game character e.g. a person), (15 times)<br><br>this throws an error when I try to deserialize<br>"there should only be one reference to &lt;?xml version="1.0"?&gt; in the file"<br><br>EDIT- Im going to try serializing a list instead of individual objects<br><br>EDIT-<br>Hmm it seems you cant serialize a list<br><br>What now?<br>&gt;<br><br><br>So, to sum it up, how do you save more than 1 character? <br><br></td></tr></table><br>
<a name="897247"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> I put my character list inside an object and it worked!<br><br>good module man <br><br></td></tr></table><br>
<a name="897269"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> hmm I played my game near the start saved and loaded....and it worked,<br><br>I played the game a bit further SAVED and LOADED<br>and it threw a lot of errors like this<br><br><pre class=code>Entity: line 2: parser error : Couldn't find end of Start Tag String line 2</pre><br><br>looking at the error and the save game file, it happens when someone writes 'lines' on to a piece of paper in the game.<br><br>The words on the paper are represented by a list of arrays<br><br>every line of text on the paper is an array of words<br><br>this must be where it is messing up. <br><br>The arrays have only 1 dimension though.<br><br><br><br>I can see the errors: <br><br>lines that look like this are wrong<br><pre class=code>&lt;field name="_value" ref="33EK1K" type="Object"/&gt;</pre><br><br>they should have <pre class=code>&lt;/field&gt;</pre> on the end<br>here is the paper object when it is saved:<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
&lt;field name="relevant_item" type="game_item"&gt;
&lt;game_item ref="33UHAG"&gt;
&lt;field name="lines" type="TList"&gt;&lt;TList ref="2O1008"&gt;
&lt;field name="_head" type="TLink"&gt;&lt;TLink ref="33EK1K"&gt;
&lt;field name="_value" ref="33EK1K" type="Object"/&gt;
&lt;field name="_succ" type="TLink"&gt;&lt;TLink ref="32TXD4"&gt;
&lt;field name="_value" type="Object"&gt;&lt;String[] ref="338WFS"/&gt;&lt;/field&gt;
&lt;field name="_succ" type="TLink"&gt;&lt;TLink ref="32SZWO"&gt;
&lt;field name="_value" type="Object"&gt;&lt;String[] ref="338YSO"/&gt;&lt;/field&gt;
&lt;field name="_succ" type="TLink"&gt;&lt;TLink ref="33LT2W"&gt;
&lt;field name="_value" type="Object"&gt;&lt;String[] ref="3392WO"/&gt;&lt;/field&gt;
&lt;field name="_succ" type="TLink"&gt;&lt;TLink ref="33LSG8"&gt;
&lt;field name="_value" type="Object"&gt;&lt;String[] ref="338V20"/&gt;&lt;/field&gt;
&lt;field name="_succ" type="TLink"&gt;&lt;TLink ref="32VQQW"&gt;
&lt;field name="_value" type="Object"&gt;&lt;String[] ref="3391O8"/&gt;&lt;/field&gt;
&lt;field name="_succ" type="TLink"&gt;&lt;TLink ref="33M74O"&gt;
&lt;field name="_value" type="Object"&gt;&lt;String[] ref="33972W"/&gt;&lt;/field&gt;
&lt;field name="_succ" type="TLink"&gt;&lt;TLink ref="33DV6G"&gt;
&lt;field name="_value" type="Object"&gt;&lt;String[] ref="3395D4"/&gt;&lt;/field&gt;
&lt;field name="_succ" type="TLink"&gt;&lt;TLink ref="33Q17S"&gt;
&lt;field name="_value" type="Object"&gt;&lt;String[] ref="338ZHK"/&gt;&lt;/field&gt;
&lt;field name="_succ" type="TLink"&gt;&lt;TLink ref="2O7PWO"&gt;
&lt;field name="_value" type="Object"&gt;&lt;String[] ref="3394XK"/&gt;&lt;/field&gt;
&lt;field name="_succ" type="TLink"&gt;&lt;TLink ref="32Q5K8"&gt;
&lt;field name="_value" type="Object"&gt;&lt;String[] ref="338XG8"/&gt;&lt;/field&gt;
&lt;field name="_succ" type="TLink"&gt;&lt;TLink ref="33MGC8"&gt;
&lt;field name="_value" type="Object"&gt;&lt;String[] ref="3394MG"/&gt;&lt;/field&gt;
&lt;field name="_succ" type="TLink"&gt;&lt;TLink ref="33NEOO"&gt;
&lt;field name="_value" type="Object"&gt;&lt;String[] ref="338SY0"/&gt;&lt;/field&gt;
&lt;field name="_succ" type="TLink"&gt;&lt;TLink ref="32OGEG"&gt;
&lt;field name="_value" type="Object"&gt;&lt;String[] ref="3398DK"/&gt;&lt;/field&gt;
&lt;field name="_succ" type="TLink"&gt;&lt;TLink ref="33CH9K"&gt;
&lt;field name="_value" type="Object"&gt;&lt;String[] ref="338RUW"/&gt;&lt;/field&gt;
&lt;field name="_succ" type="TLink"&gt;&lt;TLink ref="330LJS"&gt;
&lt;field name="_value" type="Object"&gt;&lt;String[] ref="338TWO"/&gt;&lt;/field&gt;
&lt;field name="_succ" type="TLink"&gt;&lt;TLink ref="32W6FC"&gt;
&lt;field name="_value" type="Object"&gt;&lt;String[] ref="338UVS"/&gt;&lt;/field&gt;
&lt;field name="_succ" type="TLink"&gt;&lt;TLink ref="33M7X4"&gt;
&lt;field name="_value" type="Object"&gt;&lt;String[] ref="338S48"/&gt;&lt;/field&gt;
&lt;field name="_succ" type="TLink"&gt;&lt;TLink ref="32JW14"&gt;
&lt;field name="_value" type="Object"&gt;&lt;String[] ref="338TIG"/&gt;&lt;/field&gt;
&lt;field name="_succ" ref="33EK1K" type="TLink"/&gt;
&lt;field name="_pred" ref="33M7X4" type="TLink"/&gt;&lt;/TLink&gt;&lt;/field&gt;
&lt;field name="_pred" ref="32W6FC" type="TLink"/&gt;&lt;/TLink&gt;&lt;/field&gt;
&lt;field name="_pred" ref="330LJS" type="TLink"/&gt;&lt;/TLink&gt;&lt;/field&gt;
&lt;field name="_pred" ref="33CH9K" type="TLink"/&gt;&lt;/TLink&gt;&lt;/field&gt;
&lt;field name="_pred" ref="32OGEG" type="TLink"/&gt;&lt;/TLink&gt;&lt;/field&gt;
&lt;field name="_pred" ref="33NEOO" type="TLink"/&gt;&lt;/TLink&gt;&lt;/field&gt;
&lt;field name="_pred" ref="33MGC8" type="TLink"/&gt;&lt;/TLink&gt;&lt;/field&gt;
&lt;field name="_pred" ref="32Q5K8" type="TLink"/&gt;&lt;/TLink&gt;&lt;/field&gt;
&lt;field name="_pred" ref="2O7PWO" type="TLink"/&gt;&lt;/TLink&gt;&lt;/field&gt;
&lt;field name="_pred" ref="33Q17S" type="TLink"/&gt;&lt;/TLink&gt;&lt;/field&gt;
&lt;field name="_pred" ref="33DV6G" type="TLink"/&gt;&lt;/TLink&gt;&lt;/field&gt;
&lt;field name="_pred" ref="33M74O" type="TLink"/&gt;&lt;/TLink&gt;&lt;/field&gt;
&lt;field name="_pred" ref="32VQQW" type="TLink"/&gt;&lt;/TLink&gt;&lt;/field&gt;
&lt;field name="_pred" ref="33LSG8" type="TLink"/&gt;&lt;/TLink&gt;&lt;/field&gt;
&lt;field name="_pred" ref="33LT2W" type="TLink"/&gt;&lt;/TLink&gt;&lt;/field&gt;
&lt;field name="_pred" ref="32SZWO" type="TLink"/&gt;&lt;/TLink&gt;&lt;/field&gt;
&lt;field name="_pred" ref="32TXD4" type="TLink"/&gt;&lt;/TLink&gt;&lt;/field&gt;
&lt;field name="_pred" ref="33EK1K" type="TLink"/&gt;&lt;/TLink&gt;&lt;/field&gt;
&lt;field name="_pred" ref="32JW14" type="TLink"/&gt;&lt;/TLink&gt;&lt;/field&gt;
&lt;/TList&gt;
&lt;/field&gt;
&lt;field name="name" type="string"&gt;paper&lt;/field&gt;
&lt;field name="second_name" type="string"&gt;&lt;/field&gt;
&lt;field name="item_type" type="string"&gt;paper&lt;/field&gt;
&lt;field name="owner_first_name" type="string"&gt;David&lt;/field&gt;
&lt;field name="owner_second_name" type="string"&gt;Cook&lt;/field&gt;
&lt;field name="power" type="int"&gt;0&lt;/field&gt;
&lt;field name="x" type="int"&gt;-1&lt;/field&gt;
&lt;field name="y" type="int"&gt;-1&lt;/field&gt;
&lt;field name="image_handle" type="int"&gt;0&lt;/field&gt;
&lt;field name="value" type="int"&gt;2&lt;/field&gt;
&lt;field name="payed_for" type="int"&gt;0&lt;/field&gt;
&lt;field name="worn" type="int"&gt;0&lt;/field&gt;
&lt;field name="wearable" type="int"&gt;0&lt;/field&gt;
&lt;field name="item_list" type="TList"/&gt;
&lt;field name="object_rotation" type="int"&gt;0&lt;/field&gt;
&lt;field name="offset_x" type="int"&gt;0&lt;/field&gt;
&lt;field name="offset_y" type="int"&gt;0&lt;/field&gt;
&lt;/game_item&gt;
</textarea> <br><br></td></tr></table><br>
<a name="897276"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> That isn't a whole file is it?<br><br>What method are you using to save? <br><br></td></tr></table><br>
<a name="897285"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> no its not the whole file, just the code for an item in the game<br><br>im adding all game items to a list inside a type object<br><br>then im 'serializing to stream' the object <br><br></td></tr></table><br>
<a name="897560"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have trouble believing that it doesn't work for one item in a large list...  it would either work... or not - generally. <br><br></td></tr></table><br>
<a name="897567"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> its every time 1d arrays get added to a list <br><br></td></tr></table><br>
<a name="897571"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you want, you can mail me a complete xml example that is broken, and I'll try to work out what might be going wrong. <br><br></td></tr></table><br>
<a name="897695"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> I tried to make an example program but it creates a weird error:<br>this is probably related to the problems I am having<br><br><pre class=code>
'save
Import bah.persistence
Import bah.libXML

Type save_object
Field list:TList
EndType

Function savegame()
	Local s:save_object=New save_object
	Local array$[5]
	s.list=New TList
	s.list.addlast(array)
	Local pers:TPersist = New TPersist
	Local stream:TStream = WriteStream("savedgame1.bmo")
	pers.SerializeToStream(s, stream)
	stream.close()
EndFunction

Function loadgame()
	Local pers:TPersist = New TPersist
	Local stream:TStream = ReadStream("savedgame1.bmo")
	If stream&lt;&gt;Null
		If pers&lt;&gt;Null
			Local t:save_object=save_object(pers.DeSerializeFromStream(stream))
		EndIf
	EndIf
EndFunction

savegame()

loadgame()
</pre> <br><br></td></tr></table><br>
<a name="897704"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hokay, I see the problem... leave it with me.<br><pre class=code>
&lt;?xml version="1.0"?&gt;
&lt;bmo ver="1"&gt;
  &lt;save_object ref="037KY0"&gt;
    &lt;field name="list" type="TList"&gt;
      &lt;TList ref="037KZS"&gt;
        &lt;field name="_head" type="TLink"&gt;
          &lt;TLink ref="037L08"&gt;
            &lt;field name="_value" ref="037L08" type="Object"/&gt;
            &lt;field name="_succ" type="TLink"&gt;
              &lt;TLink ref="037L14"&gt;
                &lt;field name="_value" type="Object"&gt;
                  &lt;String[] ref="037KYG"/&gt;
                &lt;/field&gt;
                &lt;field name="_succ" ref="037L08" type="TLink"/&gt;
                &lt;field name="_pred" ref="037L08" type="TLink"/&gt;
              &lt;/TLink&gt;
            &lt;/field&gt;
            &lt;field name="_pred" ref="037L14" type="TLink"/&gt;
          &lt;/TLink&gt;
        &lt;/field&gt;
      &lt;/TList&gt;
    &lt;/field&gt;
  &lt;/save_object&gt;
&lt;/bmo&gt;
</pre> <br><br></td></tr></table><br>
<a name="897721"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Difference</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't know if this is related, but both Firefox and IE clams [] is not allowed as part of the XML tag name, so String[] should maybe replaced with something else (or encoded in some way) to allow editing/viewing/transforming with common XML tools?<br><br>[EDIT] Reading up on this, using square brackets in XML *does* seem to be allowed, so maybe it's an encoding problem, and the XML files sould be saved with &lt;?xml version="1.0" encoding="UTF-8"?&gt; or something?<br><br>But: I tried changing the incodeing in in Notepad++ and adding encoding="UTF-8", but that did not help. <br><br></td></tr></table><br>
<a name="897730"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've committed a new version of the persistence module, which now properly supports Array Objects (rather than simply Array Fields).<br><br>Turns out that the Reflection uses object identifiers such as "String[]" to indicate a string array. My code was (foolishly) just passing that through to the XML, which libxml refuses to parse.<br>It now determines whether the object is an array, and stores it properly, using the tag "_array_".<br><br><br>@Peter : "UTF-8" doesn't need to be specified, as it is assumed that the file is in that format unless you specify otherwise - for example "ISO-8859-1".<br><br><br>@Jeremy : You need to remember to close your output stream. If you don't it remains open until 1) your app closes, 2) you run out of file handles and your app crashes. ;-)<br><br><br>Thanks for the beta testing guys :-)<br><br>Unless there are any other major outstanding issues, I suppose this module looks about ready to go for Release. <br><br></td></tr></table><br>
<a name="897744"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Difference</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay it seems to work now, Cool<br><br>[EDIT] Took out example, testing some more... <br><br></td></tr></table><br>
<a name="897747"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> Interesting.. This is what I get, with TPersist.format = true ...<br><pre class=code>
&lt;?xml version="1.0"?&gt;
&lt;bmo ver="2"&gt;
  &lt;save_object ref="2GGQ9K"&gt;
    &lt;field name="list" type="TList"&gt;
      &lt;TList ref="2GGQBC"&gt;
        &lt;field name="_head" type="TLink"&gt;
          &lt;TLink ref="2GGQBS"&gt;
            &lt;field name="_value" ref="2GGQBS" type="Object"/&gt;
            &lt;field name="_succ" type="TLink"&gt;
              &lt;TLink ref="2GGQCO"&gt;
                &lt;field name="_value" type="Object"&gt;
                  &lt;_array_ ref="2GGQA0" type="String" size="5"&gt;
                    &lt;val&gt;&lt;/val&gt;
                    &lt;val&gt;&lt;/val&gt;
                    &lt;val&gt;&lt;/val&gt;
                    &lt;val&gt;&lt;/val&gt;
                    &lt;val&gt;&lt;/val&gt;
                  &lt;/_array_&gt;
                &lt;/field&gt;
                &lt;field name="_succ" ref="2GGQBS" type="TLink"/&gt;
                &lt;field name="_pred" ref="2GGQBS" type="TLink"/&gt;
              &lt;/TLink&gt;
            &lt;/field&gt;
            &lt;field name="_pred" ref="2GGQCO" type="TLink"/&gt;
          &lt;/TLink&gt;
        &lt;/field&gt;
      &lt;/TList&gt;
    &lt;/field&gt;
  &lt;/save_object&gt;
&lt;/bmo&gt;
</pre><br>...which is what I'd expect. <br><br></td></tr></table><br>
<a name="897748"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Difference</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry! It seems to be Notepad++ that is confused. Looking again it seems all good.<br><br>Should there/is there - an BOM in the beginning of the file even if it is optional? ref: <a href="http://www.opentag.com/xfaq_enc.htm?" target="_blank">http://www.opentag.com/xfaq_enc.htm?</a><br><br>It seems Notepad++ thinks it's an ANSI file. <br><br></td></tr></table><br>
<a name="897751"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> Libxml is kind enough to escape non-ascii characters, so if you were to say, include chinese text somewhere, you would would get encoding like this :<br><br>&lt;hello&gt;&amp;#24744;&amp;#22909;&amp;#24444;&amp;#24471;&lt;/hello&gt;<br><br>(thanks to the forum for encoding this example for me ;-)<br><br>The BOM is only useful, I suppose, if you intend having non-ascii characters in the file somewhere. <br><br></td></tr></table><br>
<a name="897753"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Difference</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> Makes sense. Thanks for taking the time to explain. <br><br></td></tr></table><br>
<a name="897826"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> thanks for the error-fix <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
