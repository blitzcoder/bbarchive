<!DOCTYPE html><html lang="en" ><head ><title >iPod support</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >iPod support</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=124" >Brucey's Modules</a>/<a href="#bottom" >iPod support</a><br><br>
<a name="929311"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Artemis</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Brucey,<br><br>I've thought for days for a ipod support in BlitzMax because I'm probably going to write a more or less little media player which completely fits my needs. Therefore I would need iPod support.<br><br>I went through the net and searched for iPod libraries but in the beginning I just found libraries which have not been developed since nearly 3 years like <a href="http://libipod.sourceforge.net/" target="_blank">http://libipod.sourceforge.net/</a> or which are not just iPod libraries like <a href="http://mlipod.sourceforge.net/" target="_blank">http://mlipod.sourceforge.net/</a><br><br>At least I found one which is still under development namely <a href="http://www.gtkpod.org/libgpod.html" target="_blank">http://www.gtkpod.org/libgpod.html</a> but when I had a look at it I realized that I would never be able to do a BlitzMax wrap because of my lack of more then rudimental c/c++ knowledge.<br><br>So why don't ask Brucey, he will do this in a couple of hours. ;-)<br><br>I just want to ask you whether you could have a look upon it or maybe anyone else knows a better iPod library around which one should have a look at?<br><br>EDIT:<br><br>Despite my little c knowledge I am trying to do this so please don't start this, too. ;-)<br>But please tell me if I can ask you questions sometimes about the c/c++ blitzmax integration. <br><br></td></tr></table><br>
<a name="929349"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sure. No problem :-)<br><br>You know this is LGPL?<br><br>I don't think it supports iPhone or Touch. <br><br></td></tr></table><br>
<a name="929358"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Artemis</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> You know this is LGPL? <br></div><br>I had a quick look at the LGPL conditions and there it is that I'm only allowed to use the library in my program if this is also distributed under the LGPL, is that correct?<br><br><div class="quote"> I don't think it supports iPhone or Touch.  <br></div><br>Yes and no, it only supports jailbreaked iPhone and Touch, but since I have neither of them I don't care. Or is there an other library out there which supports it? <br><br></td></tr></table><br>
<a name="929394"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I'm only allowed to use the library in my program if this is also distributed under the LGPL <br></div><br>If the library is a DLL/.dylib/.so then you can license your code any way you like.<br>If you want to compile the library INTO your code, then yes, your own code would need to be GPL.<br><br><div class="quote"> Or is there an other library out there which supports it? <br></div><br>Not that I know of. <br><br></td></tr></table><br>
<a name="929566"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Artemis</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm nearly finished…<br><br>…with my nerves and my knowledge.<br><br><br>Since including and building of the source code did not work as expected due to an gettext error I was not able to resolve (yes libgpod needs glib and gettext) I then got me windows libgpod binaries from the songbird ipod extension repository but when trying to include the .lib and .dll files together with some c-code there just more errors than with the source.<br><br>EDIT:<br><br>I just gave it another try: I just included the .lib file in BlitzMax put the .dll in root directory and now it seems to work. This way all work has to be done in BlitzMax rather c - not that I am not loving it but I may be hard to port the structs to BlitzMax.<br><br>I will post my advance here or tell you when I comletely fail.<br><br>BTW: Is there a way so I can put the dll file into a subdirectory or so because 5 dlls (1*libgpod, 2*glib, 1*gettext, 1*iconv) in the main directory disturbs me a bit. <br><br></td></tr></table><br>
<a name="929569"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Good fun, eh? :-)<br><br><div class="quote"> Is there a way so I can put the dll file into a subdirectory <br></div><br>As far as I know, you'd need to add the subdirectory to the PATH, on Windows.<br><br>I've also found glib to be a bit of a pain to use on Win32 and Mac, also thinking that just borrowing a dll is the easier option ;-) <br><br></td></tr></table><br>
<a name="930052"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Artemis</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm nearly finished getting this libgpod running *from source*. What I did was not building the needed libraries (glib, gdk-pixbuf, gettext)  but getting them es prebuilt .lib files from here: <a href="http://www.gtk.org/download-windows.html" target="_blank">http://www.gtk.org/download-windows.html</a> which really made it almost easy.<br><br>But now I still have a undefined reference in the code, namely to the function *sync*. This function as I have found out is defined in the <a href="http://linux.die.net/include/unistd.h" target="_blank">unistd.h</a> but not on windows, so i think this function (which flushes write operations to the disks) is linux-only. Is there a similar function on windows, too, or is it ok when i just create a little dummy function called *sync*? <br><br></td></tr></table><br>
<a name="930057"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> is it ok when i just create a little dummy function called *sync* <br></div><br>Yeh, based on this :<br>http://74.125.77.132/search?q=cache:ZfBkWYaLxJcJ:www.mail-archive.com/commit-grub%40gnu.org/msg00873.html+mingw+sync+unistd&amp;hl=en&amp;ct=clnk&amp;cd=5&amp;client=safari<br>(see near bottom of page - highlighted in yellow)<br><br>Looks like it's safe to add something like this :<br><pre class=code>
void sync(void)
{
}
</pre> <br><br></td></tr></table><br>
<a name="930060"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Artemis</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, that works now.<br><br>The only thing that disturbes me is that you need six dlls in your project for this ipod support. <br><br></td></tr></table><br>
<a name="930067"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Artemis</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just another question for the c functions I am going to create: Is it better to give a BBString as a parameter and handle the conversion in the c code or expect a const *char as parameter and handle the conversion in the blitzmax code. And what about string return values? BBString or const *char/byte ptr? <br><br></td></tr></table><br>
<a name="930068"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can pass a String directly into a function with a param such as  text:Byte Ptr. It works.<br>But I'm not so keen to use it like that, because if you ever need to change the string conversion, you  anyway need to go and change everything.<br>Which is why I tend to these days pass in String, and in C/C++ define as BBString * text.<br>You can then do bbStringToCString(), remembering to bbMemFree() the created char * pointer.<br><br>For returning back, I find it's better to try to return a BBString *. Recently, in CEGUI I found I had to, as the char* data that I was returning would sometimes be GC'd before my call to String.FromCString() ran... which was a little annoying.<br>At least if you do the conversion in the C/C++ you know the data is still in scope :-)<br><br>Of course, at the end of the day, it's up to you to implement it the way you think is best ;-) <br><br></td></tr></table><br>
<a name="930117"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Artemis</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> The next "problem" I'm thinking about is this:<br><br>There is a struct which represents an iPod database. This struct contains a list with tracks and a list with playlists and an other struct:<br><pre class=code>typedef struct {
    GList *tracks;
    GList *playlists;
    gchar *filename;
    Itdb_Device *device;
    ...
}</pre><br>A GList is somewhat a linked list in blitzmax: <a href="http://library.gnome.org/devel/glib/stable/glib-Doubly-Linked-Lists.html#GList" target="_blank">http://library.gnome.org/devel/glib/stable/glib-Doubly-Linked-Lists.html#GList</a> (and gchar* = char*).<br><br>My iPod database type will contain a pointer to the struct as field and all methods will call c helper functions which operate on the struct. (I think this is the best, and maybe only?, good way.)<br><br>So if want to access filename in BlitzMax I call <i>db.getFilename()</i>. But now, how to acess the list? Shall I make a copy the list in BlitzMax? I think having to call db.getTrack(id) is not very convenient. <br><br></td></tr></table><br>
<a name="933379"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Artemis</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok,<br><br>I've been working on it and now I am encountering an (I think) memory error but I don't know where it's coming from and how to eleminate it.<br><br>Maybe some of you can help me sorting this out? The only problem is that you need an iPod to help me. Or at least a copy of the content of an iPod.<br>And currently it is only for Windows.<br><br>Please get the module from <a href="https://svn.blitzforum.de/artemis.mod/ipod.mod/" target="_blank">https://svn.blitzforum.de/artemis.mod/ipod.mod/</a> - in the folder tests there is a test.bmx in which you should set you iPod path and then start it.<br><br>My problem is:<br>When you compile it as a release version and you ipod database is big enough at some point the memory usage (the number at beginning of the line) goes low and from that point on there are no real titles and artists but just random characters and sometimes real titles or paths of it.<br><br>Funny enough is that when you start it in debug mode no such problem occurrs.<br><br>I have a suspicion that the error might come from the Garbage Collector (the lowering memory indicates it?) so that the collector takes away some needed memory.<br><br><br>EDIT:<br>My second suspicion was correct. If i change my code this way it works both in release and debug mode. But why does it work now and where does the GC take the memory away where it's needed?<br><pre class=code>SuperStrict

Framework Artemis.iPod
Import Brl.StandardIO

GCSuspend()

Local database:TiPodDatabase = New TiPodDatabase.Create("I:\")

If Not database Then
	Print "ERROR: Please modify your iPod-Path"
	End
EndIf

Print "iPod:"
Print "~tFilename  : " + database.getFilename()
Print "~tVersion   : " + database.getVersion()
Print "~tId        : " + database.getId()
Print "~tMountpoint: " + database.getMountpoint()
Print "~tTracks    : " + database.getTrackNumber()
Print "~tPlaylists : " + database.getPlaylistNumber()

Print "Tracks:"

For Local track:TiPodTrack = EachIn database.tracks
	Print GCMemAlloced() + "~t~t" + track.getArtist() + " - " + track.getTitle()
Next

GCResume()</pre> <br><br></td></tr></table><br>
<a name="933667"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Artemis</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Addition to the above problem:<br><br>I've made a zip of the module available here: -url removed-<br>And for the ones without iPod: -url removed-<br>Extract this onto an usb stick and give it's device letter in the test program.<br><br>In hope that someone might help me ;-) <br><br></td></tr></table><br>
<a name="933906"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm a bit short of spare time at the moment, otherwise I would have had a look at this already...<br><br>You shouldn't be suspending the GC ;-) <br><br></td></tr></table><br>
<a name="934021"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Artemis</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, that was never my intention but just a test to verify that the GC is the cause of the strange output.<br><br><div class="quote"> I'm a bit short of spare time at the moment, otherwise I would have had a look at this already... <br></div><br>No problem, I appreciate that you are helping people and creating great modules at the same time ;-). <br><br></td></tr></table><br>
<a name="935875"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Artemis</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey, I don't want to bother you, but did you have a look at it?<br>If not and at the moment there is no good time, just tell me, when you think you'll have some time to look at it.<br><br>Thanks,<br>Artemis <br><br></td></tr></table><br>
<a name="935890"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Try this :<br><pre class=code>
SuperStrict

Framework Artemis.iPod
Import Brl.StandardIO

Local database:TiPodDatabase = New TiPodDatabase.Create("I:\")

If Not database Then
	Print "ERROR: Please modify your iPod-Path"
	End
EndIf

Print "iPod:"
Print "~tFilename  : " + database.getFilename()
Print "~tVersion   : " + database.getVersion()
Print "~tId        : " + database.getId()
Print "~tMountpoint: " + database.getMountpoint()
Print "~tTracks    : " + database.getTrackNumber()
Print "~tPlaylists : " + database.getPlaylistNumber()

Print "Tracks:"

fred(database)

Function fred(database:TiPodDatabase)
	For Local track:TiPodTrack = EachIn database.tracks
		Print GCMemAlloced() + "~t~t" + track.getArtist() + " - " + track.getTitle()
	Next
End Function
</pre> <br><br></td></tr></table><br>
<a name="935992"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Artemis</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wow, that works. But where is the difference? You just packed it into a function and called it, didn't you? Why does that make it work? <br><br></td></tr></table><br>
<a name="935994"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> It might be a bug with BlitzMax, with variables in the "application scope".<br><br>I admit, it is a bit strange. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
