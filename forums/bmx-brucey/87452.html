<!DOCTYPE html><html lang="en" ><head ><title >Open-sea hell !</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Open-sea hell !</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=124" >Brucey's Modules</a>/<a href="#bottom" >Open-sea hell !</a><br><br>
<a name="991170"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> The worst thing you want when you are stuck in a boat, thousands of miles out in the ocean, is a storm...  That would be open-sea hell !<br><br>Fortunately for the rest of us, we can sit here and do something fun with BlitzMax :-)<br><br>For this latest "module for a weekend" experiment, you will currently need a Mac with Snow Leopard, and perhaps an NVidia graphics card, although it works on my Mac Mini using its dual-core CPU.<br><br><b>BaH.OpenCL</b>, is a WIP wrapper for <a href="http://en.wikipedia.org/wiki/OpenCL" target="_blank">OpenCL</a>, which allows you to write BlitzMax apps which can run code on supporting GPUs :-)<br><br>Obviously, you can't sit and code a game on the GPU, since that's not what this library is designed for, but you can throw computation intensive calculations at it, and it will happily go off and throw lots of available processor cores at it.<br>Think of it a bit like having multi-threading without having to worry about the threads :-)<br><br>The second included example is using both cores on my Mac (using the very unscientific "top", which showed it running at 179% CPU).<br><br>The code you write for OpenCL is a variation of C99, and is compiled up at runtime by the framework.<br>It also has the capability to interact directly with OpenGL data, which might be useful for some texture manipulation or such things.<br><br>The OpenCL API is quite extensive, with many functions for manipulating ints, floats, vectors, etc in very efficient ways. Check out the <a href="http://www.khronos.org/opencl/" target="_blank">Quick Reference Card</a> (PDF link on that page, and API starts from the middle of the second page) for a summary of the commands.<br><br>In theory, the module should work on all platforms, but for non Mac platforms, you would need to set up the appropriate NVidia or AMD/ATI SDK - which I have not had time to look into at the moment.<br><br>Much of the Types and functions have been implemented, but it might take some work to get things just right - given the nature of the way it works.<br><br>Currently available from the SVN repository at googlecode.<br><br>Fun fun ;-) <br><br></td></tr></table><br>
<a name="991199"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> On a plus note, the module compiles without error on Windows - without having any SDKs installed.<br><br>:-) <br><br></td></tr></table><br>
<a name="991204"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >plash</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> The module compiles on XP-SP3 but neither examples will compile.<br><br>Here's the error log for example_01.bmx<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">C:\blitzmax/mod/bah.mod/opencl.mod/opencl.debug.win32.x86.a(glue.cpp.debug.win32.x86.o):glue.cpp:(.text+0x96): undefined reference to `_imp__clGetDeviceInfo'
C:\blitzmax/mod/bah.mod/opencl.mod/opencl.debug.win32.x86.a(glue.cpp.debug.win32.x86.o):glue.cpp:(.text+0xcd): undefined reference to `_imp__clGetDeviceInfo'
C:\blitzmax/mod/bah.mod/opencl.mod/opencl.debug.win32.x86.a(glue.cpp.debug.win32.x86.o):glue.cpp:(.text+0xe7): undefined reference to `_imp__clGetDeviceInfo'
C:\blitzmax/mod/bah.mod/opencl.mod/opencl.debug.win32.x86.a(glue.cpp.debug.win32.x86.o):glue.cpp:(.text+0x101): undefined reference to `_imp__clGetDeviceInfo'
C:\blitzmax/mod/bah.mod/opencl.mod/opencl.debug.win32.x86.a(glue.cpp.debug.win32.x86.o):glue.cpp:(.text+0x118): more undefined references to `_imp__clGetDeviceInfo' follow
C:\blitzmax/mod/bah.mod/opencl.mod/opencl.debug.win32.x86.a(glue.cpp.debug.win32.x86.o):glue.cpp:(.text+0x4dd): undefined reference to `_imp__clCreateContext'
C:\blitzmax/mod/bah.mod/opencl.mod/opencl.debug.win32.x86.a(glue.cpp.debug.win32.x86.o):glue.cpp:(.text+0x4f3): undefined reference to `_imp__clCreateCommandQueue'
C:\blitzmax/mod/bah.mod/opencl.mod/opencl.debug.win32.x86.a(glue.cpp.debug.win32.x86.o):glue.cpp:(.text+0x52f): undefined reference to `_imp__clCreateContext'
C:\blitzmax/mod/bah.mod/opencl.mod/opencl.debug.win32.x86.a(glue.cpp.debug.win32.x86.o):glue.cpp:(.text+0x545): undefined reference to `_imp__clCreateCommandQueue'
C:\blitzmax/mod/bah.mod/opencl.mod/opencl.debug.win32.x86.a(glue.cpp.debug.win32.x86.o):glue.cpp:(.text+0x560): undefined reference to `_imp__clReleaseCommandQueue'
C:\blitzmax/mod/bah.mod/opencl.mod/opencl.debug.win32.x86.a(glue.cpp.debug.win32.x86.o):glue.cpp:(.text+0x56f): undefined reference to `_imp__clReleaseContext'
C:\blitzmax/mod/bah.mod/opencl.mod/opencl.debug.win32.x86.a(glue.cpp.debug.win32.x86.o):glue.cpp:(.text+0x582): undefined reference to `_imp__clReleaseCommandQueue'
C:\blitzmax/mod/bah.mod/opencl.mod/opencl.debug.win32.x86.a(glue.cpp.debug.win32.x86.o):glue.cpp:(.text+0x591): undefined reference to `_imp__clReleaseContext'
C:\blitzmax/mod/bah.mod/opencl.mod/opencl.debug.win32.x86.a(glue.cpp.debug.win32.x86.o):glue.cpp:(.text+0x5ef): undefined reference to `_imp__clReleaseKernel'
C:\blitzmax/mod/bah.mod/opencl.mod/opencl.debug.win32.x86.a(glue.cpp.debug.win32.x86.o):glue.cpp:(.text+0x603): undefined reference to `_imp__clReleaseKernel'
C:\blitzmax/mod/bah.mod/opencl.mod/opencl.debug.win32.x86.a(glue.cpp.debug.win32.x86.o):glue.cpp:(.text+0x61d): undefined reference to `_imp__clSetKernelArg'
C:\blitzmax/mod/bah.mod/opencl.mod/opencl.debug.win32.x86.a(glue.cpp.debug.win32.x86.o):glue.cpp:(.text+0x650): undefined reference to `_imp__clEnqueueNDRangeKernel'
C:\blitzmax/mod/bah.mod/opencl.mod/opencl.debug.win32.x86.a(glue.cpp.debug.win32.x86.o):glue.cpp:(.text+0x6df): undefined reference to `_imp__clCreateProgramWithSource'
C:\blitzmax/mod/bah.mod/opencl.mod/opencl.debug.win32.x86.a(glue.cpp.debug.win32.x86.o):glue.cpp:(.text+0x6fb): undefined reference to `_imp__clBuildProgram'
C:\blitzmax/mod/bah.mod/opencl.mod/opencl.debug.win32.x86.a(glue.cpp.debug.win32.x86.o):glue.cpp:(.text+0x73d): undefined reference to `_imp__clCreateProgramWithSource'
C:\blitzmax/mod/bah.mod/opencl.mod/opencl.debug.win32.x86.a(glue.cpp.debug.win32.x86.o):glue.cpp:(.text+0x759): undefined reference to `_imp__clBuildProgram'
C:\blitzmax/mod/bah.mod/opencl.mod/opencl.debug.win32.x86.a(glue.cpp.debug.win32.x86.o):glue.cpp:(.text+0x7a7): undefined reference to `_imp__clCreateBuffer'
C:\blitzmax/mod/bah.mod/opencl.mod/opencl.debug.win32.x86.a(glue.cpp.debug.win32.x86.o):glue.cpp:(.text+0x7e1): undefined reference to `_imp__clCreateBuffer'
C:\blitzmax/mod/bah.mod/opencl.mod/opencl.debug.win32.x86.a(glue.cpp.debug.win32.x86.o):glue.cpp:(.text+0x7f9): undefined reference to `_imp__clReleaseMemObject'
C:\blitzmax/mod/bah.mod/opencl.mod/opencl.debug.win32.x86.a(glue.cpp.debug.win32.x86.o):glue.cpp:(.text+0x80d): undefined reference to `_imp__clReleaseMemObject'
C:\blitzmax/mod/bah.mod/opencl.mod/opencl.debug.win32.x86.a(glue.cpp.debug.win32.x86.o):glue.cpp:(.text+0x844): undefined reference to `_imp__clEnqueueWriteBuffer'
C:\blitzmax/mod/bah.mod/opencl.mod/opencl.debug.win32.x86.a(glue.cpp.debug.win32.x86.o):glue.cpp:(.text+0x870): undefined reference to `_imp__clEnqueueReadBuffer'
C:\blitzmax/mod/bah.mod/opencl.mod/opencl.debug.win32.x86.a(glue.cpp.debug.win32.x86.o):glue.cpp:(.text+0x89d): undefined reference to `_imp__clEnqueueCopyBuffer'
C:\blitzmax/mod/bah.mod/opencl.mod/opencl.debug.win32.x86.a(glue.cpp.debug.win32.x86.o):glue.cpp:(.text+0x8eb): undefined reference to `_imp__clCreateImage2D'
C:\blitzmax/mod/bah.mod/opencl.mod/opencl.debug.win32.x86.a(glue.cpp.debug.win32.x86.o):glue.cpp:(.text+0x93d): undefined reference to `_imp__clCreateImage2D'
C:\blitzmax/mod/bah.mod/opencl.mod/opencl.debug.win32.x86.a(glue.cpp.debug.win32.x86.o):glue.cpp:(.text+0x995): undefined reference to `_imp__clCreateImage3D'
C:\blitzmax/mod/bah.mod/opencl.mod/opencl.debug.win32.x86.a(glue.cpp.debug.win32.x86.o):glue.cpp:(.text+0x9ed): undefined reference to `_imp__clCreateImage3D'
C:\blitzmax/mod/bah.mod/opencl.mod/opencl.debug.win32.x86.a(glue.cpp.debug.win32.x86.o):glue.cpp:(.text+0xa05): undefined reference to `_imp__clReleaseMemObject'
C:\blitzmax/mod/bah.mod/opencl.mod/opencl.debug.win32.x86.a(glue.cpp.debug.win32.x86.o):glue.cpp:(.text+0xa19): undefined reference to `_imp__clReleaseMemObject'
C:\blitzmax/mod/bah.mod/opencl.mod/opencl.debug.win32.x86.a(glue.cpp.debug.win32.x86.o):glue.cpp:(.text+0xa5f): undefined reference to `_imp__clGetDeviceIDs'
C:\blitzmax/mod/bah.mod/opencl.mod/opencl.debug.win32.x86.a(glue.cpp.debug.win32.x86.o):glue.cpp:(.text+0xa8c): undefined reference to `_imp__clGetDeviceInfo'
C:\blitzmax/mod/bah.mod/opencl.mod/opencl.debug.win32.x86.a(glue.cpp.debug.win32.x86.o):glue.cpp:(.text+0xad9): undefined reference to `_imp__clFlush'
C:\blitzmax/mod/bah.mod/opencl.mod/opencl.debug.win32.x86.a(glue.cpp.debug.win32.x86.o):glue.cpp:(.text+0xaf1): undefined reference to `_imp__clFinish'
C:\blitzmax/mod/bah.mod/opencl.mod/opencl.debug.win32.x86.a(glue.cpp.debug.win32.x86.o):glue.cpp:(.text+0xb6d): undefined reference to `_imp__clCreateKernel'
Build Error: Failed to link C:\blitzmax\mod\bah.mod\opencl.mod\examples\example_01.debug.exe</textarea> <br><br></td></tr></table><br>
<a name="991206"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> The module compiles on XP-SP3 but neither examples will compile. <br></div><br>I wouldn't expect them to, without something to link to...<br>... like a DLL shipped with an SDK, or suchlike. <br><br></td></tr></table><br>
<a name="991207"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >plash</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hrm.. Looks like you have to be signed up as a developer to get the AMD SDK.<br>I won't bother then. <br><br></td></tr></table><br>
<a name="991208"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Example output from the example_01 :<br><pre class=code>
Executing:example_01.debug

Device Count = 1

OpenCL Device information :
    deviceType               : CL_DEVICE_TYPE_CPU
    vendorName               : Intel
    deviceName               : Intel(R) Core(TM)2 CPU         T7200  @ 2.00GHz
    driverVersion            : 1.0
    deviceVersion            : OpenCL 1.0
    maxComputeUnits          : 2
    maxWorkItemDimensions    : 3
    maxWorkItemSizes         : (1, 1, 1)
    maxWorkGroupSize         : 1
    maxClockFrequency        : 2000
    maxMemAllocSize          : 1073741824
    imageSupport             : 1
    maxReadImageArgs         : 128
    maxWriteImageArgs        : 8
    image2dMaxWidth          : 8192
    image2dMaxHeight         : 8192
    image3dMaxWidth          : 2048
    image3dMaxHeight         : 2048
    image3dMaxDepth          : 2048
    maxSamplers              : 16
    maxParameterSize         : 4096
    globalMemCacheSize       : 4194304
    globalMemSize            : 1610612733
    maxConstantBufferSize    : 65536
    maxConstantArgs          : 8
    localMemSize             : 16384
    errorCorrectionSupport   : 0
    profilingTimerResolution : 1
    endianLittle             : 1
    profile                  : FULL_PROFILE
    extensions               : cl_khr_fp64
                               cl_khr_global_int32_base_atomics
                               cl_khr_global_int32_extended_atomics
                               cl_khr_local_int32_base_atomics
                               cl_khr_local_int32_extended_atomics
                               cl_khr_byte_addressable_store
                               cl_APPLE_gl_sharing
                               cl_APPLE_SetMemObjectDestructor
                               cl_APPLE_ContextLoggingFunctions
                              
</pre><br>This is what you get when you don't have a "proper" graphics card :-p<br><br><br><div class="quote"> Looks like you have to be signed up as a developer to get the AMD SDK. <br></div><br>So I see. But at least it's free :-) <br><br></td></tr></table><br>
<a name="991209"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >plash</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> But at least it's free :-) <br></div>Yeah. <br><br></td></tr></table><br>
<a name="991239"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Win32 examples should now compile without the link errors.<br><br>They will expect a DLL called 'OpenCL.DLL' if you try to run them though...  That's the name of the DLL that comes with the ATI SDK. Hopefully it'll be the same for the NVidia SDK, or we'll have a problem :-p<br><br>Getting there... <br><br></td></tr></table><br>
<a name="991240"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> opencl is begging for a realtime ray-tracing engine to be written :) <br><br></td></tr></table><br>
<a name="991328"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jkrankie</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Looking forward to having the time to play with this :)<br><br>Cheers<br>Charlie <br><br></td></tr></table><br>
<a name="991359"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Don't get too excited... Calling functions against the ATI library results in all kinds of weird and wonderful data corruption.<br><br>This may be an issue of using MinGW.<br>For example, calling a function and populating an int, on returning, I print the value of the int. It prints 1. I print the value again. It prints a very large number.<br><br>I've read one report of a user having similar issues on the AMD forums, so it's hopefully not a Brucey issue per-say... but I also cannot rule that out :-p<br><br><br>Going to try the NVidia SDK now... sigh. <br><br></td></tr></table><br>
<a name="991378"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, I got the NVidia version to run without crashing, although it returns 0 devices here.<br><br>Quite understandable, given there's no NVidia graphics card, and Windows is running in Parallels... although I had hoped for perhaps CPU availability -but since none of the drivers install properly without a valid graphics card, I'm not overly concerned at this point.<br><br>Oh well :-) <br><br></td></tr></table><br>
<a name="1005643"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >beanage</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Excited to see there's already an attempt on this! Uh, is it still available at google code? I feel a bit stupid not finding it.. <br><br></td></tr></table><br>
<a name="1005686"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >theHand</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Awesome, man!<br>So this is your current focus, eh?  Looks great!<br>Oh, and ATI's stuff is maybe halfway between standards-compliant and "hacked up", I think.  Go figure.  I always buy Nvidia because they like standards. :) <br><br></td></tr></table><br>
<a name="1005713"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Apparently ATI have released (yet) another update to their SDK. Hopefully this has fixed the previous issues.<br>Although I don't have any of the requisite hardware, it should always at least let you call into the library without spewing crap back at you. So when you ask it - how many processors can I use? - it should at least say 0...<br><br>Of course, if it's a MinGW issue, then things will just need to be "worked around", I suppose... <br><br></td></tr></table><br>
<a name="1006178"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tachyon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> I would like to see this fluid simulation <a href="http://www.blitzbasic.com/Community/posts.php?topic=87491" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=87491</a> pushed through OpenCL. Unfortunately, I don't have the time to put it together. Maybe someone else can as a test? <br><br></td></tr></table><br>
<a name="1008864"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ker2x</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Friendly greetings !!<br><br>I'm new to BlitzMax (bought it yesterday), switched from Purebasic.<br>I'm not a programmer (linux sysadmin and postgresql DBA).<br>I know (more or less, as a full time sysad) various langage, played with openCL from Java and failed at using openCL from C/C++ ...<br><br>One of the main reason to switch to BlitzMax is your OpenCL module (and the wide range of supported game engine, and the fact that BlitzMax use FASM, like Purebasic, so i can optimize my code using SSE2/3 code).<br><br>Currently downloading the latest trunk of your impressive module list. I hope to be able to play with openCL (fractal, MonteCarlo, ...) without too much pain.<br><br>So, simply, Thank you ! I'll provide feedback as soon as possible :) <br><br></td></tr></table><br>
<a name="1008867"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ker2x</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> running the exemple 1, I got :<br>RUNTIME ERROR:Attempt to index array element beyond array length<br><br>According to the debug (using BLide free edition) :<br>	Function _setDevice:TCLDevice(list:TCLDevice[], index:Int, devicePtr:Byte Ptr, deviceType:Int)<br>		Local device:TCLDevice = _create(devicePtr)<br>		device.deviceType = deviceType<br>		list[index] = device   &lt;=== IT FAIL HERE<br>		Return device<br>	End Function<br><br>The debug console show : Local list:TCLDevice[0]=Null<br>I'd say that it fail a detecting an OpenCL Device.<br><br>Windows 7 64bits ultimate, NVidia 8800GTX, with openCL Driver and (unrelated) CUDA SDK installed. <br><br>OpenCL usually work on this computer. <br><br>Same problem with exemple 2.<br><br>Edit : Stacktrace :<br>~&gt;Unhandled Exception:Attempt to index array element beyond array length<br>~&gt;<br>~&gt;StackTrace{<br>~&gt;@...;<br>~&gt;Function example_01<br>~&gt;Local devices:TCLDevice[]=Null<br>~&gt;@...;<br>~&gt;Function GetDevices<br>~&gt;Local deviceType:Int=-1<br>~&gt;@...;<br>~&gt;Function _setDevice<br>~&gt;Local list:TCLDevice[]=$002c0770<br>~&gt;Local index:Int=4204125<br>~&gt;Local devicePtr:Byte Ptr=$001b2e50<br>~&gt;Local deviceType:Int=4204125<br>~&gt;Local device:TCLDevice=$002c0790<br>~&gt;} <br><br></td></tr></table><br>
<a name="1008868"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ker2x</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> more info about my card here (uploaded a few mn ago) : <a href="http://www.ozone3d.net/gpu/db/index.php?which=3a1322bb3d43f0e5d6f6f8c4f3e83698" target="_blank">http://www.ozone3d.net/gpu/db/index.php?which=3a1322bb3d43f0e5d6f6f8c4f3e83698</a> <br><br></td></tr></table><br>
<a name="1008874"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> My biggest problem is a lack of hardware to test the different drivers on Windows.<br>When you try to install the drivers, they expect a supporting gfx card.. if you don't have that installed, usually the drivers won't install. <br><br>On Mac, you just load the library and it all "just works", even if you don't have the supporting hardware, because it falls-back to the CPU. <br><br></td></tr></table><br>
<a name="1008875"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ker2x</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> I added some debug.<br><br>For some reason, in _setDevice : <br>Local deviceType:Int=4204125<br>So :<br>Local index:Int=4204125<br>But list.length = 1<br><br>Here is the patched code : <br>	Function _setDevice:TCLDevice(list:TCLDevice[], index:Int, devicePtr:Byte Ptr, deviceType:Int)<br>		Local device:TCLDevice = _create(devicePtr)<br>		device.deviceType = deviceType<br>		DebugLog "list length = " + list.Length<br>		DebugLog "index = " + index<br>		list[index] = device<br>		Return device<br>	End Function<br><br>And the debug output : <br>DebugLog:list length = 1<br>DebugLog:index = 4204125<br><br>Now why the deviceType is obviously wrong ? ... Debug in progress :) <br><br></td></tr></table><br>
<a name="1008877"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ker2x</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> As a workaround, i replaced :<br>list[index] = device<br>with<br>list[0] = device<br><br>OpenCL Device information :<br>    deviceType               : <br>    vendorName               : NVIDIA Corporation<br>    deviceName               : GeForce 8800 GTX<br>    driverVersion            : 195.62<br>    deviceVersion            : OpenCL 1.0 CUDA<br>    maxComputeUnits          : 16<br>    maxWorkItemDimensions    : 3<br>    maxWorkItemSizes         : (512, 512, 64)<br>    maxWorkGroupSize         : 512<br>    maxClockFrequency        : 1350<br>    maxMemAllocSize          : 201326592<br>    imageSupport             : 1<br>    maxReadImageArgs         : 128<br>    maxWriteImageArgs        : 8<br>    image2dMaxWidth          : 8192<br>    image2dMaxHeight         : 8192<br>    image3dMaxWidth          : 2048<br>    image3dMaxHeight         : 2048<br>    image3dMaxDepth          : 2048<br>    maxSamplers              : 16<br>    maxParameterSize         : 4352<br>    globalMemCacheSize       : 0<br>    globalMemSize            : 805306368<br>    maxConstantBufferSize    : 65536<br>    maxConstantArgs          : 9<br>    localMemSize             : 16384<br>    errorCorrectionSupport   : 0<br>    profilingTimerResolution : 1000<br>    endianLittle             : 1<br>    profile                  : FULL_PROFILE<br>    extensions               : cl_khr_byte_addressable_store<br>                               cl_khr_gl_sharing<br>                               cl_nv_compiler_options<br>                               cl_nv_device_attribute_query<br><br><br>As a first project... look like i didn't choose the easy way... *grins* <br><br></td></tr></table><br>
<a name="1008880"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ker2x</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> Exemple 2 fail too...<br>Not in the same place, but probably for the same reason.<br><br>	Function InitDevice:TCLPlatform(deviceType:Int)<br>		Local devices:TCLDevice[] = GetDevices(deviceType)<br>		If devices.length &gt; 0 Then<br>			Local device:TCLDevice = devices[0]<br>	<br>			Local this:TCLPlatform = New TCLPlatform<br>			this.platformPtr = bmx_ocl_platform_init(this, device.devicePtr)  &lt;= ERROR HERE<br>			this.device = device<br>			Return this<br>		End If<br>	End Function<br><br>bad refs:obj=$2023e80 refs=$20207e1 <br><br></td></tr></table><br>
<a name="1008888"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ker2x</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> It make no sense to me ...<br><br>in : bmx_ocl_platform_getdevices(...) {<br>...<br><br>BBArray * list = _bah_opencl_TCLDevice__newDeviceList(size);<br><br>When i add a debug in : Function _newDeviceList:TCLDevice[] (Count:Int)<br>It show that Count =1, so size = 1. Great !<br><br>Following :<br><br>	for (int n = 0; n &lt; size; n++) {<br>		cl_device_id device = devices[n];<br>		cl_device_type type;<br>		size_t s = 0;<br>	<br>		err = clGetDeviceInfo(device, CL_DEVICE_TYPE, sizeof(type), &amp;type, &amp;s);<br>	<br>		MaxCLDevice * dev = new MaxCLDevice(device);<br>		BBObject * obj = _bah_opencl_TCLDevice__setDevice(list, n, dev, type);<br>		dev-&gt;SetHandle(obj);<br>	}<br><br>Size should, obviously, still be "1"<br>and n = 1<br><br>Function _setDevice:TCLDevice(list:TCLDevice[], index:Int, devicePtr:Byte Ptr, deviceType:Int)<br><br>So, here, index should be = 1<br>But ... it's = 4204125<br><br>*sigh* <br><br></td></tr></table><br>
<a name="1008894"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  But ... it's = 4204125 <br></div><br>I know... welcome to my world... :-p<br><br>I'm not entirely sure what's going on with it.<br>It's almost as if the data is being corrupted along the way somewhere. <br><br></td></tr></table><br>
<a name="1008895"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ker2x</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> heh, thx :)<br><br>Could it be some 64bits oddity ?<br>Also... i'm compiling using MinGW<br><br>F:\MinGW\bin&gt;gcc.exe --version<br>gcc.exe (GCC) 3.4.5 (mingw-vista special r3) <br><br></td></tr></table><br>
<a name="1008897"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  Also... i'm compiling using MinGW <br></div><br>I'm also hoping that MinGW isn't the limiting factor here. <br><br></td></tr></table><br>
<a name="1008898"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ker2x</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> I bought BlitzMax to avoid doing OpenCL in C/C++ ... and the first thing i do is debbuging a BlitzMax library written in ... C !<br><br>Look like your world is in the same galaxy as mine ;) <br><br></td></tr></table><br>
<a name="1008900"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> It would probably be easier for me to work with if I had a box with Windows + NVidia... and a box with Windows + ATI...<br>Alas... that is not the case, but I'm working through it.<br><br>The fact that it does work as it should on Mac, means that I'm not going to give up on it :-p <br><br></td></tr></table><br>
<a name="1008903"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> I appear to have made a little progress...<br><br>In my debug... the size returned from clGetDeviceInfo() would be 1... then change to something else.<br>Some tweaking has it remaining as 1. But it's still crashing. Still, it *feels* like a step in the right direction... <br><br></td></tr></table><br>
<a name="1008907"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ker2x</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oops, i forgot to tell you that (line 351)  :<br><br>BBObject * obj = _bah_opencl_TCLDevice__setDevice(list, n, dev, type);<br><br>The bmx code see : 4204125 <br><br>But when i change to ! <br>		BBObject * obj = _bah_opencl_TCLDevice__setDevice(list, 1, dev, type);<br><br>The bmx code see : 1<br><br>If i keep : <br>		BBObject * obj = _bah_opencl_TCLDevice__setDevice(list, n, dev, type);<br><br>and change :<br>	for (int n = 0; n &lt; size; n++) {<br>with : <br>	for (int n = 0; n &lt; 1; n++) {<br><br>i still have 4204125 <br><br>... <br><br></td></tr></table><br>
<a name="1008909"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#32">[#32]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have got that bit working now... and it seems to work up to the point of the return from bmx_ocl_platform_getdevices() - at which point it crashes.<br><br>It is even detecting a "type 2" device, which I think is CPU.<br><br>I'll try and remove my debug and check in the changes, and see if you can get it to run a little further. <br><br></td></tr></table><br>
<a name="1008910"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#33">[#33]</a></td></tr></table></td></tr><tr ><td class="posttext"> Updated SVN. <br><br>I'm now investigating the crash out of bmx_ocl_platform_getdevices(). <br><br></td></tr></table><br>
<a name="1008912"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ker2x</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#34">[#34]</a></td></tr></table></td></tr><tr ><td class="posttext"> updated and tested with a clean exemple and module : 4204125 <br><br></td></tr></table><br>
<a name="1008920"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ker2x</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#35">[#35]</a></td></tr></table></td></tr><tr ><td class="posttext"> I found some info on : <a href="http://forums.nvidia.com/index.php?showtopic=96942" target="_blank">http://forums.nvidia.com/index.php?showtopic=96942</a> and <a href="http://www.khronos.org/message_boards/viewtopic.php?f=28&amp;t=2070" target="_blank">http://www.khronos.org/message_boards/viewtopic.php?f=28&amp;t=2070</a> <br><br></td></tr></table><br>
<a name="1008926"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ker2x</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#36">[#36]</a></td></tr></table></td></tr><tr ><td class="posttext"> I updated to the latest BETA NVidia Driver : Both exemple works \o/<br><br>Sorry about all the mess :) :) <br><br></td></tr></table><br>
<a name="1008942"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ker2x</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#37">[#37]</a></td></tr></table></td></tr><tr ><td class="posttext"> In your openCL code : <br><br>__kernel void inverseSquareroot(__global float *a, __global float *result) {<br>	int gid = get_global_id(0);<br>	result[gid] = 1.0f/sqrt(a[gid]);<br>}<br><br>It's faster if you use :<br>__kernel void inverseSquareroot(__global float *a, __global float *result) {<br>	int gid = get_global_id(0);<br>	result[gid] = rsqrt(a[gid]);<br>} <br><br></td></tr></table><br>
<a name="1008954"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#38">[#38]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  Sorry about all the mess <br></div><br>No problem. I'm just glad it's working for you now! :-)<br><br>The problem with OpenCL at the moment is that it is still very early in its development. And the drivers are developing with it. But at least we can see some forward progress!!<br><br>There may be some more things I am missing in the implementation... if you see anything important, let me know and I'll try to sort it out.<br><br>Thanks for your patience, and I hope the rest of your BlitzMax experience better than the beginning ! :-) <br><br></td></tr></table><br>
<a name="1009372"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ker2x</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#39">[#39]</a></td></tr></table></td></tr><tr ><td class="posttext"> i bought a nettop powered by a nvidia ION platforme.<br>Currently installing everything needed to play with openCL on it.<br>I'll tell you if it works, and how slow it is :) <br><br></td></tr></table><br>
<a name="1009550"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ker2x</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#40">[#40]</a></td></tr></table></td></tr><tr ><td class="posttext"> i can't find what i'm missing... i try to compile the module but it cannot find the opencl.lib <br><br></td></tr></table><br>
<a name="1009553"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ker2x</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#41">[#41]</a></td></tr></table></td></tr><tr ><td class="posttext"> Mmm nope, it's ok, the error was totally unrelated.<br>And i couldn't compile this module "normally" with bmk or the BLide IDE because i put the module into mod\opencl.mod instead of mod\bah.mod\opencl.mod<br><br>now it's ok :<br>penCL Device information :<br>    deviceType               : CL_DEVICE_TYPE_GPU<br>    vendorName               : NVIDIA Corporation<br>    deviceName               : ION LE<br>    driverVersion            : 190.89<br>    deviceVersion            : OpenCL 1.0<br>    maxComputeUnits          : 1           &lt;====== LOL :)<br>    maxWorkItemDimensions    : 3<br>    maxWorkItemSizes         : (512, 512, 64)<br>    maxWorkGroupSize         : 512<br>    maxClockFrequency        : 1100<br>    maxMemAllocSize          : 134217728<br>    imageSupport             : 1<br>    maxReadImageArgs         : 128<br>    maxWriteImageArgs        : 8<br>    image2dMaxWidth          : 8192<br>    image2dMaxHeight         : 8192<br>    image3dMaxWidth          : 2048<br>    image3dMaxHeight         : 2048<br>    image3dMaxDepth          : 2048<br>    maxSamplers              : 16<br>    maxParameterSize         : 4352<br>    globalMemCacheSize       : 0<br>    globalMemSize            : 131792896<br>    maxConstantBufferSize    : 65536<br>    maxConstantArgs          : 9<br>    localMemSize             : 16384<br>    errorCorrectionSupport   : 0<br>    profilingTimerResolution : 1000<br>    endianLittle             : 1<br>    profile                  : FULL_PROFILE<br>    extensions               : cl_khr_byte_addressable_store<br>                               cl_nv_compiler_options<br>                               cl_nv_device_attribute_query<br>                               cl_khr_global_int32_base_atomics<br>                               cl_khr_global_int32_extended_atomics <br><br></td></tr></table><br>
<a name="1009557"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ker2x</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#42">[#42]</a></td></tr></table></td></tr><tr ><td class="posttext"> exemple 2 :<br>Time elapsed for OpenCL run : 42219<br>Time elapsed for BlitzMax run : 33343<br><br>Yup... the CPU code is faster than the GPU. (probably because the ION share some/the memory with the system. and the exemple 2 is not computation intensive, but mostly IO Bound.<br><br>BUT .... it works !! That's all i want :)<br>I can play and crash everything, i'll never have to reboot my main desktop computer again :)<br><br>For reference, the exemple 2 on my main computer : <br>Time elapsed for OpenCL run : 1551<br>Time elapsed for BlitzMax run : 8238<br><br>a 8800GTX on Win7 64bits, Quadcore Q6600, 8GB of RAM.<br>(8800GTX opencl details posted 3 days ago on this forum)<br><br>My ion plateform is a Packard-Bell (ewww!) C1600 <br><br></td></tr></table><br>
<a name="1009559"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#43">[#43]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  Time elapsed for OpenCL run : 1551<br>Time elapsed for BlitzMax run : 8238 <br></div><br>Well, that at least shows some of the potential, even if that example is very simple. Given a "proper" test, I am sure CPU-based code will be blown away!<br><br>Nice to know that it works on different systems :-) <br><br></td></tr></table><br>
<a name="1009566"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ker2x</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#44">[#44]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oops, i forgot that i was in debug mode.<br>In release mode : <br><br>Time elapsed for OpenCL run : 1548<br>Time elapsed for BlitzMax run : 446<br><br>The cpu is faster on both computer.<br>But, again, the exemple code are very inefficient for GPU : too much memory access, not enough math :)<br><br>I will write a more complex openCL code and release it so you can provide a better exemple to unleash the massive power of GPGPU :) <br><br></td></tr></table><br>
<a name="1009569"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#45">[#45]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  But, again, the exemple code are very inefficient for GPU <br></div><br>Yeah. I didn't really want to implement anything very big... there's only so much time in my day ;-)<br><br>Thanks for testing it though. Your feedback helps a lot ! <br><br></td></tr></table><br>
<a name="1009575"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ker2x</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#46">[#46]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is there a way to pass a cl_int as kernel arguments instead of a cl_mem ?<br><br>i have a compile error : unable to convert int to TCLmem (obviously !) <br><br></td></tr></table><br>
<a name="1009576"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ker2x</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#47">[#47]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hehehe, i found why the openCL code was slow. it was not what i tought.<br><br>Change : <br>	kernelSquare.Execute(1, Size)<br>with :<br>	kernelSquare.Execute(1, Size,256)<br>Enjoy :<br><br>Time elapsed for OpenCL run : 59<br>Time elapsed for BlitzMax run : 450<br><br>1.00000000 : 1.00000000<br>4.00000000 : 4.00000000<br>9.00000000 : 9.00000000<br>16.0000000 : 16.0000000<br>25.0000000 : 25.0000000<br>36.0000000 : 36.0000000<br>49.0000000 : 49.0000000<br>64.0000000 : 64.0000000<br>81.0000000 : 81.0000000<br>100.000000 : 100.000000 <br><br></td></tr></table><br>
<a name="1009588"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ker2x</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#48">[#48]</a></td></tr></table></td></tr><tr ><td class="posttext"> I used the openCL profiler with exemple 2, with some modification : <br>Const Size:Int = 1024 * 1024 * 64<br>kernelSquare.Execute(1, Size, 512)<br>And removing the CPU square function.<br><br>~93% of total time is spent with memory transfert (Host&lt;-&gt;Device)<br>~6% of time in CPU time to "execute" the "Square" kernel<br>~1% in real GPU execution<br><br>And still around 10x  faster than cpu code :) <br><br></td></tr></table><br>
<a name="1009597"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#49">[#49]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  Is there a way to pass a cl_int as kernel arguments instead of a cl_mem ? <br></div><br>Yes... via SetArgInt() SetArgFloat() etc...   which I appear not to have implemented yet.<br>Will sort that oversight out ASAP :-/ <br><br></td></tr></table><br>
<a name="1009599"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DavidDC</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#50">[#50]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> And still around 10x faster than cpu code <br></div><br>Now there's a statement to catch the eye! Thanks for exploring this. <br><br></td></tr></table><br>
<a name="1009666"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ker2x</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#51">[#51]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I would like to see this fluid simulation <a href="http://www.blitzbasic.com/Community/posts.php?topic=87491" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=87491</a> pushed through OpenCL. Unfortunately, I don't have the time to put it together. Maybe someone else can as a test? <br></div><br><br>I'll try this weekend, if i can understand the code. :)<br>(remember that i discovered BlitzMax last weekend  and i'm not really a developper ^^ ) <br><br></td></tr></table><br>
<a name="1009672"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#52">[#52]</a></td></tr></table></td></tr><tr ><td class="posttext"> I found a bug...<br><br>workDim supports values of 1 - 3.<br>Anything more than 1, and globalWorkSize and localWorkSize should be "arrays" of the same size.<br><br>My plan for this, is to create a new Method, called ExecuteDim(), and for Execute() remove the workDim parameter. <br><br></td></tr></table><br>
<a name="1009675"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ker2x</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#53">[#53]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> My plan for this, is to create a new Method, called ExecuteDim(), and for Execute() remove the workDim parameter.  <br></div><br><br>look good :) <br><br></td></tr></table><br>
<a name="1009682"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ker2x</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#54">[#54]</a></td></tr></table></td></tr><tr ><td class="posttext"> I created a github repository to OpenCLize this nice fluid simulation, here : <a href="http://github.com/ker2x/BM_Fluid" target="_blank">http://github.com/ker2x/BM_Fluid</a> <br><br></td></tr></table><br>
<a name="1009976"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ker2x</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#55">[#55]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here is a patch for exemple 2 using executeDim, including some documentation :<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
' ExecuteDim (documentation inspired from clEnqueueNDRangeKernel() khronos.org documentation) :
' <a href="http://www.khronos.org/opencl/sdk/1.0/docs/man/xhtml/clEnqueueNDRangeKernel.html" target="_blank">http://www.khronos.org/opencl/sdk/1.0/docs/man/xhtml/clEnqueueNDRangeKernel.html</a>
'
' ExecuteDim:Int(workDim:Int, globalWorkSize:Int[], localWorkSize:Int[] = Null)
'
' workDim:Int = The number of dimensions used to specify the global 
'           work-items and work-items in the work-group. 
'           workDim must be greater than zero and less than or equal to three.
'
' globalWorkSize[]:Int : array of workDim unsigned values that describe the 
'                        number of global work-items in workDim dimensions that 
'                        will execute the kernel function. 
'
' localWorkSize[]:Int : array of workDim unsigned values that describe the number 
'                       of work-items that make up a work-group (also referred to as the size 
'                       of the work-group) that will execute the kernel specified by kernel.
'                       Note : * localWorkSize can also be a Null value in which Case the OpenCL 
'                                implementation will determine how To be break the Global work - items 
'                                into appropriate work - group instances.
'                              * Best practice : localWorkSize should be a multiple of gpu warp (i.e : 32)


Local workDim:Int
Local globalWorkSize:Int[1]
Local localWorkSize:Int[1]

workDim = 1
globalWorkSize[0] = SIZE
localWorkSize[0] = 128

Local startTime:Int = MilliSecs()

For Local i:Int = 0 Until 200
	'ExecuteDim exemple :
		'kernelSquare.ExecuteDim(1, globalWorkSize, localWorkSize)
	'Execute exemple (same as above) :
		kernelSquare.Execute(SIZE, 128)
Next
</textarea> <br><br></td></tr></table><br>
<a name="1009977"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ker2x</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#56">[#56]</a></td></tr></table></td></tr><tr ><td class="posttext"> oops, should be :<br><pre class=code>kernelSquare.ExecuteDim(workDim, globalWorkSize, localWorkSize)</pre><br><br>instead of : <br><pre class=code>kernelSquare.ExecuteDim(1, globalWorkSize, localWorkSize)</pre> <br><br></td></tr></table><br>
<a name="1009982"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Pete Rigz</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#57">[#57]</a></td></tr></table></td></tr><tr ><td class="posttext"> Really nice work all. I'd love to have a play with this, getting Device Count = 0 on the first example though. Have an nvidia 8800GTS with the latest beta drivers (on win7 64). I'd say it's finding the opencl.dll ok as first time I ran this it didn't do anything until I installed the latest drivers. Anything obvious you think I might be missing?<br><br>Guess I can just go play on the mac, but it'd be nice to get it working on my pc :) <br><br></td></tr></table><br>
<a name="1009983"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ker2x</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#58">[#58]</a></td></tr></table></td></tr><tr ><td class="posttext"> Try using the drivers provided here : <a href="http://developer.nvidia.com/object/opencl-download.html" target="_blank">http://developer.nvidia.com/object/opencl-download.html</a><br><br>I also suggest the openCL profiler and Sample+SDK :) <br><br></td></tr></table><br>
<a name="1009985"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#59">[#59]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you do this :<br><pre class=code>
Local workDim:Int = 1
Local globalWorkSize:Int[workDim]
Local localWorkSize:Int[workDim]
</pre><br>you only have to change one thing.<br><br>:-) <br><br></td></tr></table><br>
<a name="1009989"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ker2x</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#60">[#60]</a></td></tr></table></td></tr><tr ><td class="posttext"> Indeed ;) <br><br></td></tr></table><br>
<a name="1009998"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Pete Rigz</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#61">[#61]</a></td></tr></table></td></tr><tr ><td class="posttext"> Those drivers got it working, thanks! <br><br></td></tr></table><br>
<a name="1082173"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Samichan</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#62">[#62]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is this still being developed?<br><br>I got the module to build fine but examples crash with EAV at TCLPlatform.GetDevices()<br><br><br>both of these crash the same way<br><br>Windows 7 64<br>nvidia geforce gtx295<br><br>Windows 7 32<br>nvidia geforce 9600gt<br><br><br>Updated drivers and sdks today.<br>The example binaries (OCL and CUDA both) bundled with the sdk work fine on both machines, but the VC projects fail miserably as usual (trying to use VC++ 2008 E) <br><br></td></tr></table><br>
<a name="1158747"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BLaBZ</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#63">[#63]</a></td></tr></table></td></tr><tr ><td class="posttext"> Does this still work? Can I use OpenCL in BlitzMAX? <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
