<!DOCTYPE html><html lang="en" ><head ><title >FreeImage -&gt; PF_RGBA8888 pixmap?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >FreeImage -&gt; PF_RGBA8888 pixmap?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=124" >Brucey's Modules</a>/<a href="#bottom" >FreeImage -&gt; PF_RGBA8888 pixmap?</a><br><br>
<a name="1012028"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm using free image to load my pictures and do a resize since the internal resize functions are ugly ugly and my source pictures can be anything (jpeg, png, etc. etc.) of any size. Anywho I need to get back a pixmap in PF_RGBA8888 format and everything I'm trying is not working. What's the proper path to get back a PF_RGBA8888 pixmap directly from freeimage?<br><br>convertToType(PF_RGBA8888) throws up <br>FreeImage: FREE_IMAGE_TYPE: Only 24-/32-bit dib can be converted to type 6.<br><br>I'm sure I'm just missing something obvious <br><br></td></tr></table><br>
<a name="1012168"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> convertToType() doesn't use BlitzMax pixel formats for parameters, unfortunately.<br><br>However, you might want to try convertTo32Bits() instead. <br><br></td></tr></table><br>
<a name="1012184"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> As always, thanks for the response Brucey!<br><br>Done some more poking into exactly what/where/how I'm getting differences.<br><br>on mac (intel) if I do convertto32bits() (which I was doing previously) I get type 6 (PF_RGBA8888) on the returned pixmap format (32bit BIG endian RGB with alpha) which is what I need. Great, job done.<br><br>On Windows (vista x64 if it matters) convertto32bits() gives me type 5 back... which I think is PF_BGRA8888 (32bit LITTLE endian RGB with alpha) and still needs a conversion... dunno why the mac is giving me big endian on intel (haven't tried on my PPC but I would expect big endian there...) perhaps it's an OS flag in the FreeImage library for better compatability between PPC and intel macs?<br><br>either way I need a way to get big endian 32bit out of free image across platforms if possible. <br><br></td></tr></table><br>
<a name="1012247"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> A little more background. the reason I want to get freeimage to give me an RGBA8888 pixmap is because I've found in rare occasions that I can't pin down because it's too random my program will crash when converting a pixmap through pixmap.Convert(PF_RGBA8888). I've done more poking and it happens at somewhat random points durring the out[]=in[] copy in brl.mod/pixmap.mod/pixel.bmx in converttostdformat(). this is a straight buffer to buffer copy so it would make sense that one of the buffers is going bad during this process... my suspicion is the garbage collector is causing it to be moved. If I put a GCCollect() right before my pixmap.convert() it tends to crash much sooner. I wrapped my pixmap.convert() with GCSuspend() and GCResume() and I haven't gotten a crash yet, even when I throw GCCollect() right ahead of the suspend. The crash was happening on 1 intel mac and my x64 windows machine, but not on another identical intel mac. Identical hardware wise, they're all running different software, i.e. different memory footprint, therefore different firing on the GC.<br><br>So, 2 questions<br>1) I would still like to use FreeImage for the RGBA8888 conversion because I think it's likely to be faster, and my pictures already go through it for some scaling etc. so it's easy. is it possible to do that or is converto32bit() and it's OS difference the closest I can get.<br><br>2) Is it possible that pixmaps returned from FreeImage are able to be moved around by the garbage collector in a way that a pixmap created in bmax natively would not (is there some sort of lock?) or do you suspect this is a problem with how bmax handles pixmap conversion and I should post accordingly in the bugreports forum? <br><br></td></tr></table><br>
<a name="1013653"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> on mac (intel) if I do convertto32bits() (which I was doing previously) I get type 6 (PF_RGBA8888) on the returned pixmap format (32bit BIG endian RGB with alpha) which is what I need. Great, job done. <br></div><br>the pixmap that is returned by TFreeImage is just a static pixmap based on the internal data. Generally, that data is like this :<br><pre class=code>
				?win32
				format = PF_BGR888
				?macos
				format = PF_RGB888
				?linux
				format = PF_BGR888
				?
</pre><br><br>As far as I am aware, internal image data on Mac uses the same endianness on both PPC and Intel - someone can correct me if I'm wrong.<br><br>Note, that because it is a static pixmap, the next time you modify the image, or the image is GC'd the related pixmap data will be "undefined".<br><br>I can't see why you would have issues calling Convert() in BRL.Pixmap. I've never had any issues with it, on any platform. <br><br></td></tr></table><br>
<a name="1015683"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> The issues with converting pixmaps happens when the garbage collector trys to move the pixmap data while it's converting. If you disable the garbage collector (GCSuspend() does the trick) then there's no problem. It only happens when I'm really thrashing the memory (tons of pictures mostly quite big, along with lots of lists, etc etc., doesn't happen in a simple sample because there's not enough memory getting abused). So my current workaround is to just wrap pixmap.Convert() calls with GCSuspend() and GCResume(), since doing that I've had no conversion related problems on any platform.<br><br>A related problem I get on rare occasions is FreeImage will fail to load or resize a picture. It only happens again, in low memory situations when I've been thrashing memory. My work around for that is by monitoring the memory usage through the garbage collector again. On different platforms the max limit before I start seeing problems changes drastically but it's fairly reliable so I just make sure when I'm getting near the ceiling I look for stuff I can clear out before trying to load more. If you have time to take a look at how FreeImage handles itself when it fails to complete an action due to not enough memory that would be great, but I'm functional now. And, yet again, these kinds of things ONLY happen when I'm abusing the hell out of the memory, any normal/polite program is probably not going to thrash memory like I am unless they've made some typos :0) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
