<!DOCTYPE html><html lang="en" ><head ><title >NG bug with fields that are functions?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >NG bug with fields that are functions?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=124" >Brucey's Modules</a>/<a href="#bottom" >NG bug with fields that are functions?</a><br><br>
<a name="1301772"></a>

<a name="1301773"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I can't be sure of what I'm using, since I know of no official NG release.  I decided to try the unofficial one posted yesterday on bmax-ng.com.<br><br>I'm getting a compilation error on one of my modules related to this bit of code.<br><br><pre class=code>Type TWindow Abstract

	Field _id:Int
	Field _name:String
	Field _window:TGadget
	Field _x:Int, _y:Int, _w:Int, _h:Int

	Field _hook:Object
	Field _eventMove:Object( data:Object )
	Field _eventResize:Object( data:Object )
	Field _eventGadgetAction:Object( data:Object )

	Method New()

		_id = TWindowsMgr._windows.length
		TWindowsMgr._windows = TWindowsMgr._windows[ .._id + 1 ]
		TWindowsMgr._windows[ _id ] = Self

	End Method

End Type</pre><br>The compiler says: 'struct BBClass_meld_winmgr_TWindow' has no member named 'm__eventResize_TObject' ... among other things.  Am I right in guessing that the overloading is confused by my use of a field to store a function?<br><br>? for Brucey:  The .7z you posted (a few weeks ago, I think) was compiling this and almost everything else I use just fine.  Have recent releases gotten more strict? <br><br></td></tr></table><br>
<a name="1301777"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> recent releases changed behaviour because they now use that overloading-feature you already mentioned.<br><br>Internally it is mangling the function names:<br>bla(i:int,f:float) becomes bla_i_f and so on<br><br>My Assumption:<br>Now you are calling a function-pointer which confused bcc-ng indead. It thinks "calling a function heh? let me mangle the name for your call..." and bamm, error.<br><br>Maybe BCC-NG should lookup if there is a function-property in the class. No mangling needed there (overloading should not be available for it - should it?).<br><br><br>Maybe it is a good idea to file an issue for Brucey.<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1301780"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Do you happen to have a line of code where you get the actual error?<br><br>Thanks. <br><br></td></tr></table><br>
<a name="1301783"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> The line reported is in the generated C file.  It happens for all of the cases where I'm using a function pointer as a field:<br><br>Field _eventResize:Object( data:Object )  , etc. <br><br></td></tr></table><br>
<a name="1301786"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay, but this compiles and runs for me:<br><pre class=code>
SuperStrict

Framework brl.standardio


Local window:TGuiWindow = New TGuiWindow

window._eventMove = eventMove
window._eventResize = eventResize
window._eventGadgetAction = eventGadgetAction


window._eventMove(window)



Type TGuiWindow Extends TWindow


End Type


Type TWindow Abstract

	Field _id:Int
	Field _name:String
	Field _window:TGadget
	Field _x:Int, _y:Int, _w:Int, _h:Int

	Field _hook:Object
	Field _eventMove:Object( data:Object )
	Field _eventResize:Object( data:Object )
	Field _eventGadgetAction:Object( data:Object )

	Method New()

		_id = TWindowsMgr._windows.length
		TWindowsMgr._windows = TWindowsMgr._windows[ .._id + 1 ]
		TWindowsMgr._windows[ _id ] = Self

	End Method

End Type


Type TWindowsMgr

	Global _windows:TWindow[]

End Type

Type TGadget

End Type

Function eventMove:Object( data:Object )
	Print "eventMove"
End Function

Function eventResize:Object( data:Object )
	Print "eventResize"
End Function

Function eventGadgetAction:Object( data:Object )
	Print "eventGadgetAction"
End Function
</pre> <br><br></td></tr></table><br>
<a name="1301787"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  Have recent releases gotten more strict?  <br></div><br>No, but there may be a generation issue under certain conditions when using function pointers.<br><br>I need a reproducible example so that I can fix it :-)<br><br>Thanks! <br><br></td></tr></table><br>
<a name="1301788"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm, that's interesting.  As I said, I'm using the latest build from bmx-ng.com.  Perhaps that has an issue?<br><br>Here's the entire module, then!<br><br>The module grouping is meld.mod...<br><br>This file is winmgr.bmx<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">

'---------------------------------------------------------------------------------------------------'
'---------------------------------------------------------------------------------------------------'

'Basic window manager.  Supports graphics or console.

'---------------------------------------------------------------------------------------------------'
'---------------------------------------------------------------------------------------------------'

SuperStrict

Module meld.WinMgr

ModuleInfo "Version: 0.90"
ModuleInfo "Author: Lance Thornblad"

Import brl.Event
Import brl.EventQueue
Import brl.Timer
Import maxgui.Drivers

Include "__window.bmx"

'---------------------------------------------------------------------------------------------------'

Type TWindowsMgr Final

	Global _quit:Int = False
	Global _paused:Int = False
	Global _windows:TWindow[]
	Global _timer:TTimer

	Global _appsuspend() = AppSuspend
	Global _appresume() = AppResume
	Global _timerTick() = TimerTick

	Function Create:TWindowsMgr()
		Local this:TWindowsMgr = New TWindowsMgr
		If Not this._timer
			this._timer = CreateTimer( 500 )
			AddHook( EID_KEYBOARD, KeyboardHook )
			AddHook( EID_RESIZE, ResizeHook )
		EndIf
		Return this
	End Function

	Function Update()
		While Not TWindowsMgr._quit
			WaitEvent()
			Select EventID()
			Case EVENT_WINDOWACCEPT
				Local drop$ = String( EventExtra() )
				If drop Then Print "Dropped - " + drop
			Case EVENT_APPSUSPEND, EVENT_MOUSELEAVE
				TWindowsMgr._appsuspend()
			Case EVENT_APPRESUME, EVENT_MOUSEENTER
				TWindowsMgr._appresume()
			Case EVENT_WINDOWCLOSE
				TWindowsMgr._quit = True
			Case EVENT_GADGETACTION, EVENT_GADGETPAINT
				For Local si:Int = 0 Until TWindowsMgr._windows.Length
					Local g:TGadget = TGadget( EventSource() )
					If g And g.parent = TWindowsMgr._windows[ si ]._window
						If TWindowsMgr._windows[ si ]._eventGadgetAction
							TWindowsMgr._windows[ si ]._eventGadgetAction( TWindowsMgr._windows[ si ] )
						EndIf
					EndIf
				Next
			Case EVENT_TIMERTICK
				If Not TWindowsMgr._paused Then TWindowsMgr._timertick()
			End Select
			If KeyDown( KEY_ESCAPE ) Then TWindowsMgr._quit = True
		Wend
	End Function

End Type

'---------------------------------------------------------------------------------------------------'

Private

'Mimic the way 'GetChar' works:
'Global keyStates[256], keyHits[256]
Global charGet:Int, charPut:Int, charQueue:Int[256]
'Global mouseStates[4], mouseHits[4]
'Global mouseLocation[4], lastMouseLocation[4]
Global EID_KEYBOARD:Int = EmitEventHook
Global EID_RESIZE:Int = EmitEventHook

'This hook overrides EVENT_KEYDOWN and adds EVENT_KEYREPEAT.
Function KeyboardHook:Object( id:Int, data:Object, context:Object )
	Local evt:TEvent = TEvent( data )
	If Not evt Return data
	Select evt.id
	Case EVENT_KEYDOWN, EVENT_KEYREPEAT
		If evt.data &lt; 256
			If charPut - charGet &lt; 256
				charQueue[ charPut &amp; 255 ] = evt.data
				charPut :+ 1
			EndIf
		EndIf
	End Select
	Return data
End Function

'This hook allows for repeating resize events.
Function ResizeHook:Object( id:Int, data:Object, context:Object )
	Local evt:TEvent = TEvent( data )
	Select evt.id
	Case EVENT_WINDOWSIZE
		For Local si:Int = 0 Until TWindowsMgr._windows.Length
			If evt.source = TWindowsMgr._windows[ si ]._window
				If Not TWindowsMgr._windows[ si ]._eventResize Then Return data
				Return TWindowsMgr._windows[ si ]._eventResize( TWindowsMgr._windows[ si ] )
			EndIf
		Next
	Case EVENT_WINDOWMOVE
		For Local mi:Int = 0 Until TWindowsMgr._windows.Length
			If evt.source = TWindowsMgr._windows[ mi ]._window
				If Not TWindowsMgr._windows[ mi ]._eventMove Then Return data
				Return TWindowsMgr._windows[ mi ]._eventMove( TWindowsMgr._windows[ mi ] )
			EndIf
		Next
	Default
		Return data
	End Select
End Function

Function _SpecialFlush()
	FlushKeys
	For Local i:Int = 0 To 255
		charQueue[ i ] = 0
	Next
End Function

Function _SpecialGetChar:Int()
	If charGet = charPut Then Return 0
	Local n:Int = charQueue[ charGet &amp; 255 ]
	charGet :+ 1
	Return n
End Function

Function AppSuspend()
	'Hide mouse?
End Function
Function AppResume()
	'Show mouse?
End Function
Function TimerTick()
	'Do nothing!!
End Function

Public

'---------------------------------------------------------------------------------------------------'
'---------------------------------------------------------------------------------------------------'

</textarea><br><br>This file is __window.bmx<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">

'---------------------------------------------------------------------------------------------------'
'---------------------------------------------------------------------------------------------------'

Type TWindow Abstract

	Field _id:Int
	Field _name:String
	Field _window:TGadget
	Field _x:Int, _y:Int, _w:Int, _h:Int

	Field _hook:Object
	Field _eventMove:Object( data:Object )
	Field _eventResize:Object( data:Object )
	Field _eventGadgetAction:Object( data:Object )

	Method New()

		_id = TWindowsMgr._windows.length
		TWindowsMgr._windows = TWindowsMgr._windows[ .._id + 1 ]
		TWindowsMgr._windows[ _id ] = Self

	End Method

End Type

'---------------------------------------------------------------------------------------------------'

Type TGraphicsWindow Extends TWindow

	Field _canvas:TGadget				'Graphics canvas.
	Field _graphics:TGraphics			'Graphics lib.
	Field _wWidth:Int, _wHeight:Int		'Windowed-mode width and height.
	Field _fsWidth:Int, _fsHeight:Int	'Full-screen width and height.
	Field _hidden:Int = False			'Window hidden..................need this?
	Field _vWait:Int = -1				'Vertical wait.
	Field _depth:Int					'Depth, rate, and windows mode.
	Field _rate:Int						'...
	Field _mode:Int						'...
										'0 = Full Screen.

	Method New()
		_fsWidth = DesktopWidth()
		_fsHeight = DesktopHeight()
	End Method

	Function Create:TGraphicsWindow( wx:Int = 50, wy:Int = 50, ww:Int = 1024, wh:Int = 768, depth:Int = 32, mode:Int = 1, name:String = "" )

		Local this:TGraphicsWindow = New TGraphicsWindow
		If name Then this._name = name Else this._name = "MainWindow"
		this._x = wx
		this._y = wy
		this._w = ww
		this._h = wh
		this._wWidth = ww
		this._wHeight = wh
		this._depth = depth
		this._mode = mode
		this._rate = 60
		AppTitle = this._name

		If this._mode = 1
			this._graphics = Graphics( this._fsWidth, this._fsHeight, this._depth, this._rate, ..
				GRAPHICS_BACKBUFFER | GRAPHICS_DEPTHBUFFER | GRAPHICS_ACCUMBUFFER | GRAPHICS_STENCILBUFFER )

			'No need to call SetGraphics() or EnablePolledInput() since Graphics() already does it.

		Else
			this._window = CreateWindow( this._name, this._x, this._y, this._w, this._h, Null, ..
				WINDOW_TITLEBAR | WINDOW_RESIZABLE | WINDOW_CLIENTCOORDS | WINDOW_ACCEPTFILES )
			this._canvas = CreateCanvas( 0, 0, this._window.ClientWidth(), this._window.ClientHeight(), this._window, 0 )
			this._canvas.SetLayout( EDGE_ALIGNED, EDGE_ALIGNED, EDGE_ALIGNED, EDGE_ALIGNED )
			this._window.SetSensitivity( SENSITIZE_ALL )
			this._canvas.SetSensitivity( SENSITIZE_ALL )
			this._graphics = this._canvas.CanvasGraphics()
			SetGraphics( this._graphics )
			EnablePolledInput()
		EndIf

		Return this

	End Function

	Method SwitchGraphicsMode()

		EndGraphics()

		If _mode = 1
			_w = _wWidth
			_h = _wHeight
		'	If Not _window
				_window = CreateWindow( _name, _x, _y, _w, _h, Null, ..
					WINDOW_TITLEBAR | WINDOW_RESIZABLE | WINDOW_CLIENTCOORDS | WINDOW_ACCEPTFILES | WINDOW_HIDDEN )
				_window.SetSensitivity( SENSITIZE_ALL )
				_canvas = CreateCanvas( 0, 0, _window.ClientWidth(), _window.ClientHeight(), _window, 0 )
				_canvas.SetLayout( EDGE_ALIGNED, EDGE_ALIGNED, EDGE_ALIGNED, EDGE_ALIGNED )
				_canvas.SetSensitivity( SENSITIZE_ALL )
		'	EndIf
			_graphics = _canvas.CanvasGraphics()
			SetGraphics( _graphics )
			EnablePolledInput()
			_mode = 0

		Else
			HideGadget( _window )
			_w = _fsWidth
			_h = _fsHeight
			_graphics = Graphics( _fsWidth, _fsHeight, _depth, _rate, ..
				GRAPHICS_BACKBUFFER | GRAPHICS_DEPTHBUFFER | GRAPHICS_ACCUMBUFFER | GRAPHICS_STENCILBUFFER )
			'_canvas.Free()
			_window.Free()
			_mode = 1
		EndIf

	End Method

End Type

'---------------------------------------------------------------------------------------------------'

Type TConsoleWindow Extends TWindow

	Field _textarea:TGadget		'For drawing text.
	Field _cmd:String[]			'Current command.
	Field _line:String			'Current line.
	Field _data:Object[]		'Attached data.
	Field _taCount:Int			'Track character count.
								'Only process commands when count is increased.

	Field _cmap:TMap = New TMap							'
	Field _commands:String( con:TConsoleWindow )[]		'
	Field _default:String( con:TConsoleWindow )			'

	Method New()
		_x = 20 ; _y = 750 ; _w = 800 ; _h = 400	'Default size...
	End Method

	Function Create:TConsoleWindow( wx:Int = -1, wy:Int = -1, ww:Int = -1, wh:Int = -1, name:String = "" )

		Local this:TConsoleWindow = New TConsoleWindow
		If name Then this._name = name Else this._name = "Console"
		If wx &gt; -1 Then this._x = wx
		If wy &gt; -1 Then this._y = wy
		If ww &gt; -1 Then this._w = ww
		If wh &gt; -1 Then this._h = wh

		this._window = CreateWindow( name, ..
			this._x, this._y, this._w, this._h, Null, ..
			WINDOW_TITLEBAR | WINDOW_RESIZABLE | WINDOW_CLIENTCOORDS )
			this._window.SetSensitivity( SENSITIZE_ALL )
		this._textarea = CreateTextArea( 0, 0, ..
			this._window.ClientWidth(), this._window.ClientHeight(), this._window )
		SetGadgetLayout( this._textarea, EDGE_ALIGNED, EDGE_ALIGNED, EDGE_ALIGNED, EDGE_ALIGNED )
		SetGadgetColor( this._textarea, 0, 0, 0 )
		SetTextAreaFont( this._textarea, LookupGuiFont( GUIFONT_MONOSPACED, 10 ) )
		ActivateGadget( this._textarea )
		this.EConPrint( "MANA lives!~n~n", 0, 160, 0 )

		Return this

	End Function

	Method AddCommand:Int( key:String, cmd:String( con:TConsoleWindow ) )

		'TODO: Fail if key already exists!

		Local idx:Int = _commands.Length
		_commands = _commands[ ..idx + 1 ]
		_commands[ idx ] = cmd
		_cmap.Insert( key, [ idx ] )
		Return 0

	End Method

	Method EConPrint( txt:String, r:Int = 255, g:Int = 255, b:Int = 255 )
		Local clrs:String[1]
		Local bits:String[]
		Local pos:Int = 0
		Local cc:Int = 0
		Local pb:Int = 0
		Local pa:Int = txt.Find( "&amp;clr", pb )
		clrs[0] = String( r ) + " " + String( g ) + " " + String( b )
		If pa = -1 Then _EConPrint( txt, r, g, b ) ; Return
		While pa &gt; -1 And pb &lt; txt.length
			pb = txt.Find( ";", pa + 1 )
			If pb = -1 Then pb = txt.Length
			bits = bits[ ..cc + 1 ]
			clrs = clrs[ ..cc + 2 ]
			bits[ cc ] = txt[ pos..pa ]
			clrs[ cc + 1 ] = txt[ pa + 4..pb ].Trim()
			cc :+ 1
			pos = pb + 1
			pa = txt.Find( "&amp;clr", pb )
		Wend
		If pos &lt; txt.Length
			bits = bits[ ..cc + 1 ]
			bits[ cc ] = txt[ pos..txt.length ]
		EndIf
		For Local i:Int = 0 Until bits.Length
			Local c:String[] = clrs[ i ].Split( " " )
			'TODO: This is a temporary fix!
			If c.length &gt;= 3
				_EConPrint( bits[ i ], Int( c[0] ), Int( c[1] ), Int( c[2] ) )
			Else
				_EConPrint( bits[ i ], 255, 255, 0 )
			EndIf
		Next
	End Method

	Method _EConPrint( txt:String, r:Int = 255, g:Int = 0, b:Int = 0, flags:Int = TEXTFORMAT_BOLD )
		Local curs:Int = TextAreaCursor( _textarea )
		FormatTextAreaText( _textarea, r, g, b, flags, curs, txt.length )
		SetTextAreaText( _textarea, txt, curs, txt.length )
		FormatTextAreaText( _textarea, 255, 255, 255, 0, curs + txt.length + 1 )
		SelectTextAreaText( _textarea, curs + txt.Length, 0 )
	End Method

	Method EConGetLine:String()
		Local curs:Int = TextAreaCursor( _textarea ) - 1
		Local line:Int = TextAreaLine( _textarea, curs )
		Local cpos:Int = TextAreaChar( _textarea, line )
		Return TextAreaText( _textarea, cpos, curs - cpos ).Trim()
	End Method

	Method EConEvent()
		Local line:String, evt:TEvent = CurrentEvent
		'If evt.id &lt;&gt; EVENT_GADGETACTION Then Return
		Select evt.source
		'Case _canvas
		'	_Print "GadgetAction Event came from Main Window!!"
		Case _textarea
			Local taCount:Int = TextAreaLen( _textarea )
			Local curs:Int = TextAreaCursor( _textarea ) - 1
			'Print taCount + " : " + curs
			If curs = 0 Or _taCount &gt; taCount
				_taCount = taCount
			Else
				'Get previously typed character.
				Local char:String = TextAreaText( _textarea, curs, 1 )
				If char = "~n" Or Asc( char ) = 11	'Newline or Vertical Tab
					line = EConGetLine()
					'SetTextAreaText( _textarea, TextAreaText( _textarea, 0, curs + 1 ) )
					If line Then EConExecute( line )
				EndIf
				'Character count may have changed.
				_taCount = TextAreaLen( _textarea )
			EndIf
		End Select
	End Method

	Method EConExecute( line:String )
		Local res:String = ""
		_line = line
		_cmd = __SplitStringUsingChars( line, [" "] )
		Local fId:Object = _cmap.ValueForKey( _cmd[0].ToLower() )
		If fId
			res = _commands[ Int[]( fId )[0] ]( Self )
		Else
			If _default
				res = _default( Self )
			Else
				res = " &amp;clr 255 0 0;ERR: Unrecognized command.~n"
			EndIf
		EndIf
		If res Then EConPrint( res, 50, 180, 70 )
	End Method

End Type

'---------------------------------------------------------------------------------------------------'

'TODO: Remove need for these!!
Function __SplitStringUsingChars:String[]( str:String, chars:String[] = Null )
	If chars = Null Then chars = [" ","~t","~n","~r"]	'White space characters.
	Local bits:String[], c:String, word:Int = 0, isWord:Int = -1
	For Local i:Int = 0 Until str.length
		c = Chr( str[i] )
		If __FindString( c, chars ) = -1
			If isWord &lt;&gt; 1
				word :+ 1
				bits = bits[..word]
				bits[word - 1] = ""
			EndIf
			bits[word - 1] :+ c
			isWord = 1
		Else
			isWord = 0
		EndIf
	Next
	Return bits
End Function

Function __FindString:Int( str:String, list:String[] )
	For Local i:Int = 0 Until list.length
		If __strcmp( str, list[i] ) Then Return i
	Next
	Return -1
End Function

Function __strcmp:Int( a:String, b:String )
	Local la:String = a.ToLower()
	Local lb:String = b.ToLower()
	Return la = lb
End Function

'---------------------------------------------------------------------------------------------------'
'---------------------------------------------------------------------------------------------------'

</textarea> <br><br></td></tr></table><br>
<a name="1301789"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks.<br><br>This should be enough:<br><pre class=code>
TWindowsMgr._windows[ 0 ]._eventGadgetAction( TWindowsMgr._windows[ 0 ] )
</pre><br><br>:o) <br><br></td></tr></table><br>
<a name="1301792"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> FYI, if you use the -gdb option with bmk, it will conveniently generate line mappings in the C code to the original bmx lines.<br>Then, if there's a problem with the generated C code, it should refer you back to the line in your BlitzMax source :-) <br><br></td></tr></table><br>
<a name="1301795"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Apologies for the delay...<br><br>The latest bcc should generate the correct code now. <br><br></td></tr></table><br>
<a name="1301801"></a>

<a name="1301803"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> it should refer you back to the line in your BlitzMax source <br></div>Good to know!<br><br>Thank you!  No apologies necessary - that was fast!  Is the executable available somewhere?  I haven't gotten the hang of building it from source.  I'm running 32-bit Win7 atm and my attempts so far have crashed.  :( <br><br></td></tr></table><br>
<a name="1301804"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> You should just be able to download the zip from github, and build bcc.bmx using your normal version of BlitzMax (console/release/full build). That will give you a bcc.exe that you can drop into your NG bin dir. <br><br></td></tr></table><br>
<a name="1301805"></a>

<a name="1301806"></a>

<a name="1301809"></a>

<a name="1301810"></a>

<a name="1301811"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ah good, that worked.  Thanks!<br><br>However, now my gl module is just failing and doesn't give me a reason.  It just says "failed to compile .."  I was looking through the flags and tried -v, but it didn't help.  Is there some other way to get more information about what is happening?<br><br>EDIT: MaxIDE is giving me the old "module does not match command line module" message.  Searching my memory banks, but can't see any reason this is happening.  It has compiled before...<br><br>EDIT 2: Oh right, haven't used MaxIDE for a while and forgot you can't just compile a module.  So that error is bogus.  However, I still have a problem and no information as to how to correct it.  :/ <br><br></td></tr></table><br>
<a name="1301812"></a>

<a name="1301813"></a>

<a name="1301814"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> MaxIDE allows for a custom command line. If you really want to see _where_ it hangs in BCC, you would need to compile BCC in debug mode from your MaxIDE. The custom command line then contains the params to compile your code file.<br><br>Before writing wrong information I leave that open for Brucey.<br><br>Think he will squash that issue faster than I explained (while not knowing it for sure) debugging BCC.<br><br><br>Hints to narrow things down (and now, as you know how to compile BCC on your own ;-)):<br>Download the revision before the fix for your issue:<br><a href="https://github.com/bmx-ng/bcc/commit/aaa3a7c82f9ff05ebab6868041ee5b2aab5fcb23" target="_blank">https://github.com/bmx-ng/bcc/commit/aaa3a7c82f9ff05ebab6868041ee5b2aab5fcb23</a><br><br>If that compiled BCC also fails already then the error was introduced before.<br>If it just blames what your OP mentions, then the latest fix introduced the problem.<br><br>Using that you could "traverse back in time" to find revisions not having a certain bug. Sometimes this has at least a little chance to help Brucey. And taking him off some workload helps spending him more time for other things.<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1301815"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks, Derron.  I'll definitely want to learn more about how to do that.  <br><br>MaxIDE is reporting errors if I use Build Modules, but that doesn't really allow me to tackle one module at a time like the command line does.  I have learned that the overloading has introduced more strictness than I realized.  It no longer does implicit conversions - understandable, but inconvenient.  ;) <br><br></td></tr></table><br>
<a name="1301816"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Now that I think about it, it's odd that it doesn't fallback to implicit conversion, when there are no alternative functions to match up with. <br><br></td></tr></table><br>
<a name="1301817"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can use -w option with bmk which will show warnings rather than error.<br><br>The latest NG BRL and Pub modules should clean build without -w <br><br></td></tr></table><br>
<a name="1301818"></a>

<a name="1301819"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm afraid that didn't help.  Still just getting a "failed to compile" message.  I am getting messages from MaxIDE, though.  It's just slow-going fixing them... <br><br></td></tr></table><br>
<a name="1301820"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> What error messages are you getting, exactly? <br><br></td></tr></table><br>
<a name="1301822"></a>

<a name="1301823"></a>

<a name="1301824"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's the overloading ... it is more strict about arguments matching exactly.  If I passed a float into gl_viewport, it would still work because it would implicitly cast to an int.  There are lots of things like that are breaking now.  And they are slow to fix because, unlike in Blide, I can't zip around the source.<br><br>But the point is that the command line isn't returning these errors or warnings.  It's just telling me it failed. <br><br></td></tr></table><br>
<a name="1301825"></a>

<a name="1301826"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> bmk 3.12 supports the -w option which raises these as warnings instead of errors, allowing you to still build things - with the option of tidying up your code at a later date.<br>eg.<br><pre class=code>
./bmk makemods -a -w brl.stream
</pre><br><br>A typical example, taken from a TvTower build, looks like this:<br><pre class=code>
Compile Warning: In call to Method TRoomBoard.GetSignByOriginalXY:TRoomBoardSign(x:Int,y:Int). Argument #2 is "Float" but declaration is "Int". 
</pre><br>The build carries on. It will only stop when it finds an actual error. <br><br></td></tr></table><br>
<a name="1301827"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> I know that's what's supposed to happen, but it is not.  I have no idea why. <br><br></td></tr></table><br>
<a name="1301828"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> I assume you have the latest versions?<br><pre class=code>
$ ./bmk -v
bmk 3.12 mt-macos-osx-x64 / clang 700.1.81 (cpu x4)

$ ./bcc -v
bcc[ng] Release Version 0.76
</pre><br><br>On the command line, what error do you actually get? <br><br></td></tr></table><br>
<a name="1301830"></a>

<a name="1301831"></a>

<a name="1301832"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm using what was posted on bmx-ng.com, except that I recompiled bcc.  Interestingly, bcc -v does nothing...<br><br>bmk -v returns...<br><br> bmk 3.11 win32-x86 / gcc 050100 (cpu x4)<br><br>EDIT: Maybe it's not the debug version... heh.<br><br>EDIT: Debug or no doesn't seem to matter.  Still not getting anything when I type "bcc -v" on the command line.. <br><br></td></tr></table><br>
<a name="1301833"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> You need bmk 3.12<br><br>Presumably the stuff dabs put together isn't the latest of everything?<br><br>NG's bcc should always report the version number. The official one doesn't.<br>If it doesn't give you a version number I doubt it will even compile anything...<br><br>Btw, things will build faster if your bmk is built multi-threaded... <br><br></td></tr></table><br>
<a name="1301836"></a>

<a name="1301838"></a>

<a name="1301839"></a>

<a name="1301840"></a>

<a name="1301841"></a>

<a name="1301842"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, except bcc is the only thing I've built.  I grabbed the zip from github.  I thought it was alright to build using any version of BMX.  Is that not right?<br><br>EDIT: ...<br><br>EDIT 2: Disregard last edit.  I forgot to put -t console in the command line when I compiled bcc.<br><br>EDIT 3: Okay, I'm getting the compile errors in the console now.  Guess 3.11 is sufficient for that, at least. <br><br></td></tr></table><br>
<a name="1301844"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> 3.12 adds the -w option... Which would allow your code to build, with warnings. <br><br></td></tr></table><br>
<a name="1301845"></a>

<a name="1301846"></a>

<a name="1301850"></a>

<a name="1301851"></a>

<a name="1301863"></a>

<a name="1301864"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> That sounds great, but I just grabbed the zip off of github and recompiled and it's still coming up 3.11.  Is it not yet committed?<br><br>EDIT: Also had a question.  Is the lib/ directory still searched for static libs?  I was having another issue with my Bullet Physics library and wasn't sure if NG was finding it at all.  Got any tips for static libs? <br><br></td></tr></table><br>
<a name="1301873"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> BMK 3.11 ... is the latest<br>BCC 0.76 ... is the latest<br><br><br>Maybe it is a good option to add a hook to git to write the last commit hash to a file ... import this file and append it to the version string ("0.76 95e7568acf05fd"). Or each commit gets a pre-hook and adds to a counter. That way even little changes are tracked (the commits) and it is easier to narrow down which build is used.<br><br><br>@ -w<br>Like said in another thread it is even introduced in Brucey's MaxIDE variant. For now you need to use the console to fix the issues.<br><br>The slower option is to not use "-w" and fix each upcoming error step by step (which might mean coming back to a previous file multiple times). Best is "-w" and then adjust code according to the warnings.<br><br><br>@no failure output<br>It should have output problems regardless of that issue (eg. "Multiple definition of xyz"). Maybe there is a little bug hidden in the code which is still existent now but not triggered because some code is executed before now.<br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1301881"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> Indeed, please disregard any mention of version 3.12. I shouldn't post when I should be asleep ;-) <br><br></td></tr></table><br>
<a name="1301882"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Okay, I'm getting the compile errors in the console now. <br></div><br>You still haven't posted any errors yet, so I can't tell if there is an issue I need to fix or not.<br><br><div class="quote"> Got any tips for static libs? <br></div><br>Put it in a module, and link to it that way.<br>You can use the ModuleInfo option "LD_OPTS: -L%PWD%/relative/module/lib/path"  and an Import "-lfile.a" (assuming that the library is named libfile.a) <br><br></td></tr></table><br>
<a name="1301889"></a>

<a name="1301890"></a>

<a name="1301891"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dabhand</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#32">[#32]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just to note... I updated the package at bmx-ng.com just yesterday, and built all the base modules (well, what I regard as base modules brl, pub and maxgui) with "bmk makemods -a -w" and all was well it seemed, just tested versions:-<br><br>Bmk 3.11<br>Bcc 0.76<br><br>Dabz <br><br></td></tr></table><br>
<a name="1301905"></a>

<a name="1301908"></a>

<a name="1301909"></a>

<a name="1301911"></a>

<a name="1301921"></a>

<a name="1301922"></a>

<a name="1301923"></a>

<a name="1301924"></a>

<a name="1301925"></a>

<a name="1301928"></a>

<a name="1301929"></a>

<a name="1301930"></a>

<a name="1301931"></a>

<a name="1301932"></a>

<a name="1301934"></a>

<a name="1301935"></a>

<a name="1301936"></a>

<a name="1301938"></a>

<a name="1301939"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#33">[#33]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> You still haven't posted any errors yet <br></div>I described them and then <i>you</i> posted an example - <b>Argument #2 is "Float" but declaration is "Int"</b> - so I thought it was unnecessary to repeat what you'd said.  Sorry for not communicating that more effectively.<br><br>Since my version was 3.11 and you said the warnings flag -w was introduced in 3.12, I thought I needed to wait for it to be committed.  With 3.11, I'm still getting those warnings, but they are not just warnings - they are show stoppers.  The part where I said I'm getting the compile errors in the console now just confirms that they are being reported (they weren't before because I forgot to use -t console).<br><br>EDIT: Seems it's only "Unable to convert from Void to Int" errors now; at least that's all I'm encountering, atm.  I remember when I converted to SuperStrict, I was surprised those weren't being caught.  Guess now I actually have to fix them.  :P<br><br>EDIT 2: Still getting <b>Argument #1 is "Long" but declaration is "Int"</b> type errors that used to be implicit conversions.<br><br>EDIT 3: Here's another line that is now an error...<br><br>  Byte[]( GetBMaxObject( Byte Ptr ci + off ) )[ ary1 ] = mb  &lt;&lt;== Error: <b>Unable to convert from ManaInternalExtendable to Int</b> (ci is type ManaInternalExtendable)<br><br>  Byte[]( GetBMaxObject( Byte Ptr <b>(</b> ci <b>)</b> + off ) )[ ary1 ] = mb  &lt;&lt;== Now <i><b>ci</b></i> needs parentheses to work...<br><br>NOTE: I don't mind things being more explicit, but it seems these changes were unnecessary before the overloading stuff was added.<br><br><div class="quote"> I updated the package at bmx-ng.com just yesterday <br></div>Yes, Dabz, that's what I have, too.  3.11 and 0.76 respectively. <br><br></td></tr></table><br>
<a name="1301907"></a>

<a name="1301912"></a>

<a name="1301913"></a>

<a name="1301914"></a>

<a name="1301915"></a>

<a name="1301916"></a>

<a name="1301917"></a>

<a name="1301918"></a>

<a name="1301920"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#34">[#34]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Put it in a module, and link to it that way.  You can use the ModuleInfo option.. <br></div><strike>Does that mean <b>Import "-lBulletCollision"</b> is no longer the right way to do it?</strike>  Nevermind, I should read more carefully.  :)<br><br><div class="quote"> For now you need to use the console to fix the issues. <br></div>As I said, a few weeks ago, I snagged the .7z version Brucey posted (for a test) and everything, other than my Bullet module, was working without <i>any</i> changes.  I was most impressed and I hope I can get there again.  ;)<br><br>EDIT: I'm getting a "skipping incompatible &lt;blahblah&gt;.a when searching for -lblahblah" error with the Bullet module.  I believe this is unwind_resume errors and it is my understanding that this is because of objects compiled with different versions of MinGW.  However, I compiled the Bullet .a using CodeBlocks and the same version of MinGW.  Not sure what else to check - maybe there is some flag I need? <br><br></td></tr></table><br>
<a name="1301954"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#35">[#35]</a></td></tr></table></td></tr><tr ><td class="posttext"> Incompatible usually means one is 64-bit and the other is 32-bit.<br><br><div class="quote"> Byte[]( GetBMaxObject( Byte Ptr ( ci ) + off ) )[ ary1 ] = mb <br></div><br>Things like this.. probably an issue I can fix. <br><br></td></tr></table><br>
<a name="1301956"></a>

<a name="1301957"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#36">[#36]</a></td></tr></table></td></tr><tr ><td class="posttext"> <pre class=code>
Byte Ptr ci + off
</pre><br>This one doesn't appear to be a recently created problem, as I have tested it on an older release and it brings up the same error.<br><br>Presumably it should handle the plus at that point in a different way, so you end up with :<br><pre class=code>
(Byte Ptr ci) + off
</pre> <br><br></td></tr></table><br>
<a name="1301958"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#37">[#37]</a></td></tr></table></td></tr><tr ><td class="posttext"> And btw, code like this:<br><pre class=code>
Byte[]( GetBMaxObject( Byte Ptr ( ci ) + off ) )[ ary1 ] = mb
</pre><br>is probably rather dangerous with the new compiler, unless you really know what you are doing. Especially since "off" may need to be different when compiled between 32/64-bit.<br>Of course, YMMV...<br><br><br>I've patched the code so that only the left-hand-side of the binary expression is cast. Hopefully that doesn't break anything else :-p <br><br></td></tr></table><br>
<a name="1301959"></a>

<a name="1301960"></a>

<a name="1301961"></a>

<a name="1301962"></a>

<a name="1301963"></a>

<a name="1301964"></a>

<a name="1301965"></a>

<a name="1301966"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#38">[#38]</a></td></tr></table></td></tr><tr ><td class="posttext"> Which version was the one you posted as a result of "TomToad's 10 Step Guide to Misery?"  In that version, everything compiled and worked with no changes and with only two exceptions - my Bullet module and the sound in Digesteroids.<br><br>In any case, I don't mind adding the parentheses too much.  But thanks!<br><br><div class="quote"> Incompatible usually means one is 64-bit and the other is 32-bit. <br></div>Ah, that was it - this time (still have another issue with it, but I won't ask until I look it over more).  The Bullet module (and to a lesser extent, TheoraPlayer) was the reason I decided to try NG.  I've been messing around with so many different versions of MinGW and legacy BMX that I think I'm starting to get confused (even more than usual).  :(<br><br><div class="quote"> Especially since "off" may need to be different when compiled between 32/64-bit. <br></div>Indeed - one disaster at a time.  :p <br><br></td></tr></table><br>
<a name="1301977"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#39">[#39]</a></td></tr></table></td></tr><tr ><td class="posttext"> New issue:<br><pre class=code>Method GetFloatArray:Int( name:String, fa:Float[] Var )
	Local dn:ManaDataNode = GetNode( name )
	If Not dn Then Return False
	Local v:Float[] = Float[]( dn.GetObject() )
	If Not v Then Return False
	fa = v   &lt;&lt;&lt;&lt; THIS LINE IS REPORTED BY -gdb
	Return True
EndMethod
</pre>This function is part of a generic node serialization module.  I'm getting the following error:<br><br>incompatible types when assigning to type 'BBArray {aka struct BBArray}' from type 'BBARRAY {aka struct BBArray *}' <br><br></td></tr></table><br>
<a name="1301978"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#40">[#40]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  Which version was the one you posted as a result of "TomToad's 10 Step Guide to Misery?" <br></div><br>That was normal BlitzMax with my BMK. It wasn't the NG bcc/compiler. That's probably why mostly worked :-p<br><br>So, it seems you haven't actually tried NG until now - hence the issues you are getting.<br><br><div class="quote">  I don't mind adding the parentheses too much <br></div><br>The latest bcc on github has a fix for the casting - or at least it fixed the example you provided. If you find other related issues, please tell me about them. <br><br></td></tr></table><br>
<a name="1301979"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#41">[#41]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks, it fixed the casting.  I've reported a new one.  ^^<br><br><div class="quote"> It wasn't the NG bcc/compiler <br></div>Oooohhh, I thought that's what TomToad's post was about.  Now I feel silly. <br><br></td></tr></table><br>
<a name="1301980"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#42">[#42]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  New issue... <br></div><br>Interestingly, it generates and compiles okay on OS X... The generated code looks correct :<br><pre class=code>
parameter :
    ... ,BBSTRING bbt_name,BBARRAY* bbt_fa){

your error line :
    *bbt_fa=bbt_v;
</pre><br>both of which looks good. <br><br></td></tr></table><br>
<a name="1301982"></a>

<a name="1301983"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#43">[#43]</a></td></tr></table></td></tr><tr ><td class="posttext"> Tested on Win7, Mingw TDM 5.1, and it compiles okay too. This is what I am testing :<br><pre class=code>
SuperStrict

Framework brl.standardio

Type ManaDataNode

	Method GetObject:Float[]()
	End Method

Method GetFloatArray:Int( name:String, fa:Float[] Var )
	Local dn:ManaDataNode = GetNode( name )
	If Not dn Then Return False
	Local v:Float[] = Float[]( dn.GetObject() )
	If Not v Then Return False
	fa = v  ' &lt;&lt;&lt;&lt; THIS LINE IS REPORTED BY -gdb
	Return True
End Method


End Type

Function GetNode:ManaDataNode(name:String)
End Function
</pre> <br><br></td></tr></table><br>
<a name="1301986"></a>

<a name="1301988"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#44">[#44]</a></td></tr></table></td></tr><tr ><td class="posttext"> Should be ...Method GetObject:Object()  ...perhaps the cast is not functioning? <br><br></td></tr></table><br>
<a name="1302159"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#45">[#45]</a></td></tr></table></td></tr><tr ><td class="posttext"> I changed that, but it still compiles okay here. Does this example compile for you, or not? <br><br></td></tr></table><br>
<a name="1302171"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#46">[#46]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Does this example compile for you, or not? <br></div>It does.  Have no idea what is happening. <br><br></td></tr></table><br>
<a name="1302176"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#47">[#47]</a></td></tr></table></td></tr><tr ><td class="posttext"> Do you happen to have your code split into multiple files ?<br><br>Or does ManaDataNode extend from something defined in another file?<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1302183"></a>

<a name="1302184"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#48">[#48]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, it extends something.  I'll try to come up with a small test that breaks. <br><br></td></tr></table><br>
<a name="1302377"></a>

<a name="1302381"></a>

<a name="1302387"></a>

<a name="1302392"></a>

<a name="1302393"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#49">[#49]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here's the smallest test I could come up with - it involves two modules.<br><br>ManaNode.mod<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">SuperStrict

Module meld.ManaNode

Type ManaNode Abstract
EndType

Type ManaDataNode Extends ManaNode Abstract

	Method GetNode:ManaDataNode( name:String, n:Int = 0 ) Abstract
	Method GetFloatArray:Int( name:String, fa:Float[] Var ) Abstract
	Method GetObject:Object() Abstract

EndType</textarea><br><br>Test.mod<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">SuperStrict

Module meld.Test

Import meld.ManaNode

Type ManaBinaryNode Extends ManaDataNode

	Method GetObject:Object()
	EndMethod
	Method GetNode:ManaDataNode( name:String, n:Int = 0 )
	EndMethod

	Method GetFloatArray:Int( name:String, fa:Float[] Var )
		Local dn:ManaDataNode = GetNode( name )
		If Not dn Then Return False
		Local v:Float[] = Float[]( dn.GetObject() )
		If Not v Then Return False
		fa = v
		Return True
	EndMethod

EndType</textarea><br><br>ManaNode.mod compiles ...Test.mod brings up the error. <br><br></td></tr></table><br>
<a name="1302394"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#50">[#50]</a></td></tr></table></td></tr><tr ><td class="posttext"> Does not need to be a module, should fail with normal imports too.<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1302397"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#51">[#51]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for taking the time to get a working example :-)<br><br>The latest bcc on github fixes the problem. You'll need to rebuild everything. <br><br></td></tr></table><br>
<a name="1302407"></a>

<a name="1302408"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#52">[#52]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm, the test works, but my full module still produces the same error.  :(<br><br>Guess I'll have to come up with another test case. <br><br></td></tr></table><br>
<a name="1302409"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#53">[#53]</a></td></tr></table></td></tr><tr ><td class="posttext"> Also wondering why you do use something seemingly "game XY specific" as a module compared to normal imports.<br><br><br>Did you recompile all the modules (just to avoid potential other bugs) as Brucey wrote?<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1302421"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#54">[#54]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, there's nothing "game XY specific" above, so I'm not sure what you're asking.  Yes, I rebuilt all modules, but it's possible I missed something.  Like I said, I'll try to come up with another test case. <br><br></td></tr></table><br>
<a name="1302426"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#55">[#55]</a></td></tr></table></td></tr><tr ><td class="posttext"> Maybe I misinterpreted "Mana" in your modulename ... soundes RPGish :-)<br><br>If possible, you could mail Brucey the module (if you are not able to cut it down to something "small").<br><br>If I had "not that easily reproduceable" bugs, they often were connected to imports. So when trying to replicate it in a small sample, you might need to create multiple imports/modules (similar to your real world setup).<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1302428"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#56">[#56]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ah, I see.  Mana is the name of my game engine...nothing to do with the RPG.<br><br>I will put a test together, but it's a bit less of a priority at the moment because everything is working again with vanilla BMX. <br><br></td></tr></table><br>
<a name="1302431"></a>

<a name="1302432"></a>

<a name="1302433"></a>

<a name="1302434"></a>

<a name="1302435"></a>

<a name="1302436"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#57">[#57]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh, one thing I noticed:  If you remove the GetObject and GetNode methods from the ManaBinaryNode type, it compiles even though it should complain.<br><br>GetObject and GetNode are declared Abstract...unless there's been some change in NG, as far as that goes.  Perhaps it only checks that if the method is called somewhere? <br><br></td></tr></table><br>
<a name="1302439"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#58">[#58]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> If you remove the GetObject and GetNode methods from the ManaBinaryNode type, it compiles even though it should complain. <br></div><br>Why should it complain? You are simply declaring a type. Legacy BlitzMax doesn't complain either.<br>However, if you try to create an instance of it (with New), you will see an appropriate error. <br><br></td></tr></table><br>
<a name="1302440"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#59">[#59]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> if you try to create an instance of it <br></div>Ah, that's right.  Should've realized... <br><br></td></tr></table><br>
<a name="1302441"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#60">[#60]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  my full module still produces the same error <br></div><br>Perhaps it is several imports deep... <br><br>If you want you can look at the .i file in the module, find the relevant method and see if it parameter is declared with "Var" or not. If it isn't then I guess there's still something to fix somewhere... <br><br></td></tr></table><br>
<a name="1302449"></a>

<a name="1302450"></a>

<a name="1302453"></a>

<a name="1302485"></a>

<a name="1302486"></a>

<a name="1302487"></a>

<a name="1302488"></a>

<a name="1302491"></a>

<a name="1302492"></a>

<a name="1302494"></a>

<a name="1302495"></a>

<a name="1302498"></a>

<a name="1302501"></a>

<a name="1302502"></a>

<a name="1302503"></a>

<a name="1302504"></a>

<a name="1302505"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#61">[#61]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> see if it parameter is declared with "Var" or not <br></div><strike>It is not...good call.</strike>  Nevermind, I built the base module again and it worked.  Not sure what happened (perhaps I need more sleep).<br><br>Thanks a lot for your help.  I'll let you know if anything else comes up.<br><br>...<br><br>EDIT: Modules are all compiled, but when I tried to compile my test app, a number of TheoraPlayer undefined references came up...<br><br>...glue.cpp:151: undefined reference to 'bah_theoraplayer_common_TTheoraGenericException__create'  ...etc.<br><br>Any idea why? <br><br></td></tr></table><br>
<a name="1302553"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#62">[#62]</a></td></tr></table></td></tr><tr ><td class="posttext"> bah.theoraplayer has now been updated to support overloading. <br><br></td></tr></table><br>
<a name="1302557"></a>

<a name="1302558"></a>

<a name="1302559"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#63">[#63]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks, now it compiles!  Unfortunately, nothing happens when I run it.  Probably something I've missed.  :( <br><br></td></tr></table><br>
<a name="1302560"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#64">[#64]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you need a hand with debugging, my email address is on my user profile. <br><br></td></tr></table><br>
<a name="1302565"></a>

<a name="1302566"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#65">[#65]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks, that's nice of you.  I'll try to work it out on my own, first.  :)<br><br>One question ... how compatible are NG and vanilla?  Which changes that I make for NG's sake will make it incompatible with vanilla? <br><br></td></tr></table><br>
<a name="1302567"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#66">[#66]</a></td></tr></table></td></tr><tr ><td class="posttext"> At a high-level they are mostly compatible. Things like the casting for the recent NG overload work is fine for the old compiler too.<br>Other stuff that doesn't appear to work with the old compiler that you need to change for NG, you can wrap the code in<br>?bmxng<br>' new<br>?not bmxng<br>' old<br>?<br>And the code will then work with either.<br><br>NG prefers to work with Ptr rather than Int for all external pointers - since a pointer is NOT 4 bytes in 64-bit land. That's the biggest change concerning compatibility. So all the standard modules that used Int for pointers/handles needed to be updated. If any of your code interfaces with such code, you'll need to adapt it. <br><br></td></tr></table><br>
<a name="1302576"></a>

<a name="1302578"></a>

<a name="1302580"></a>

<a name="1302581"></a>

<a name="1302582"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#67">[#67]</a></td></tr></table></td></tr><tr ><td class="posttext"> But new bmk.exe is intended to be compatible with vanilla, no?<br><br>I thought before moving forward, I should put together a fresh vanilla build (but with new bmk) that works with my recent NG changes.  I'm still hitting snags, though, the most recent being undefined references in pub.libpng. :/<br><br>...brl.mod, pub.mod, and maxgui.mod are all vanilla, HOWEVER, I am using new bmk and MinGW 5.1... <br><br></td></tr></table><br>
<a name="1302583"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#68">[#68]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  But new bmk.exe is intended to be compatible with vanilla, no? <br></div><br>Yes, but that is just a tool like "make". I suppose "bmk" short for "blitzmax make" or something?<br><br><div class="quote">  undefined references in pub.libpng <br></div><br>Is this the official one?<br><br>The only thing I can think is that you are linking to other modules/files (perhaps your own) that have not been rebuilt properly (if they were the same files you were compiling with NG). <br><br></td></tr></table><br>
<a name="1302584"></a>

<a name="1302585"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#69">[#69]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Is this the official one? <br></div>Yes, it is.<br><br><div class="quote"> you are linking to other modules/files (perhaps your own) that have not been rebuilt properly <br></div>That's what I thought, too, but I've been double-checking them one by one.  I'll keep working on it.<br><br>I do have a vanilla backup where everything is working, but I really don't want to move forward with two code bases! <br><br></td></tr></table><br>
<a name="1302586"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#70">[#70]</a></td></tr></table></td></tr><tr ><td class="posttext"> bmk doesn't do anything clever. If you build it multi-threaded and you have a multi-core machine, it is very much more efficient at building things.<br>Otherwise, you should end up with the same binary at the end of your build as you would with the standard bmk. <br><br></td></tr></table><br>
<a name="1302661"></a>

<a name="1302663"></a>

<a name="1302674"></a>

<a name="1302678"></a>

<a name="1302682"></a>

<a name="1302683"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#71">[#71]</a></td></tr></table></td></tr><tr ><td class="posttext"> Seems to be a problem in MaxGui in win32maxguiex.bmx line 288.  Argument #1 is "Long" but declaration is "Byte Ptr."  Not sure what is to be done with it.  -w suppresses it, but could it be an issue?<br><br>My NG test app now pops up a window, but fails very quickly.  It looks like this might take a lot of effort to debug.  :(<br><br>Each of my modules publishes lua functions using ffi.  Most of that glue code is generated procedurally.  I wouldn't be surprised if that interferes with things that NG is doing (like generating function names) or vice versa.  Then again, it could be something else entirely.<br><br><strike>Incidentally, my NG-ified modules are compiling, but not working with vanilla bmax.  I'll start there.</strike><br><br>EDIT: My NG-ified modules were fine all along.  The problem (with compiling in vanilla) was because I copied over the NG version of zeke's luajit module and forgot a couple of small changes I'd made.  Vanilla compilation of the NG modules now works.  Still having issues with pure NG, though.  Think it might have something to do with win32maxguiex... <br><br></td></tr></table><br>
<a name="1302792"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#72">[#72]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, I'm still not sure what's happening.  I've tracked the problem to a specific line that is calling an external c function.  The c function is part of my luascript module and all it does is return an array's type.  I'm using that information to push the array to the lua stack.<br><br>The weird part is that when I step through and reach that line, there's no indication that it's failing.  It just takes me to a seemingly unrelated piece of code (in win32maxguiex) that is ClassWndProc.  Seems to be caught in an infinite loop or something, but it works fine in vanilla BMX. <br><br></td></tr></table><br>
<a name="1303452"></a>

<a name="1303454"></a>

<a name="1303455"></a>

<a name="1303456"></a>

<a name="1303457"></a>

<a name="1303458"></a>

<a name="1303459"></a>

<a name="1303460"></a>

<a name="1303461"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#73">[#73]</a></td></tr></table></td></tr><tr ><td class="posttext"> One issue (sort of) resolved, for now.  In order to push arrays to the lua stack, I needed to get the array type.  AFAIK, vanilla Blitz has no built-in way of doing this, so I was using a C function.  The C function was not compatible with the way NG is doing things, so I replaced it with a Blitz version that works, though it's a little slower.<br><br>There seems to be some difference in the way NG handles Byte Ptr or Varptr.  Admittedly, I'm a little fuzzy on the difference between the two.  In some cases, they seem interchangeable.  Anyway, a line that works fine in vanilla gives the following error in NG:<br><br>Debugger Error:Invalid scope kind<br><br>The odd thing is that here's the line where it happens:<br><br>Local bp:Byte Ptr = Byte Ptr ci<br><br>..but if I comment it out, the following line works:<br><br>Local p:ManaLink = ManaLink( GetBMaxObject( Byte Ptr ci + off ) )<br><br>That seems strange!<br><br><div class="quote"> code like this:  Byte[]( GetBMaxObject( Byte Ptr ( ci ) + off ) )[ ary1 ] = mb  ...is probably rather dangerous <br></div>Hmm, I'm wondering if member offsets are handled differently in NG?  More compact, perhaps? <br><br></td></tr></table><br>
<a name="1304031"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#74">[#74]</a></td></tr></table></td></tr><tr ><td class="posttext"> Bumping this with an example...<br><br>This is <b>extern.c</b> ...<br><pre class=code>#include &lt;brl.mod/blitz.mod/blitz.h&gt;

// Get object at pointer.
BBObject *GetBMaxObject( byte *bp ) {
	return *(BBObject**) bp;
}</pre><br>This is <b>test.bmx</b> ...<br><pre class=code>Import "extern.c"

Extern "C"
	Function GetBMaxObject:Object( bp:Byte Ptr )
EndExtern

Type manalink
	Field fo:Object
EndType

Type test
	Field fi:Int
	Field ff:Float
	Field fl:manalink
EndType

Local ml:manalink = New manalink
Local t:test = New test
t.fl = ml

Local off:Int = 8
Local bp:Byte Ptr = Byte Ptr t

Local pl:manalink = manalink( GetBMaxObject( bp + off ) )

'EXPECTING: pl == ml == t.fl

DebugStop</pre><br><b>The last assignment (pl) should be the same as (ml) and (t.fl).  This works in vanilla bmx, but causes an error in NG.</b><br><br>The <b>bp</b> assignment fails, for one.  There are possibly more issues, but this is a start. <br><br></td></tr></table><br>
<a name="1304032"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#75">[#75]</a></td></tr></table></td></tr><tr ><td class="posttext"> Error of your sample is the following:<br><br><pre class=code>
Building byteptr
[ 45%] Compiling:extern.c
/testcodes/extern.c:4:26: error: unknown type name &amp;#128;&amp;#152;byte&amp;#128;&amp;#153;
 BBObject *GetBMaxObject( byte *bp ) {
                          ^
Build Error: failed to compile (256) /testcodes/extern.c
</pre><br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1304033"></a>

<a name="1304034"></a>

<a name="1304035"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#76">[#76]</a></td></tr></table></td></tr><tr ><td class="posttext"> <pre class=code>
Import "byteptr.c"

Extern "C"
	Function GetBMaxObject:Object( bp:Byte Ptr )
EndExtern

Type manalink
	Field fo:Object
	Field val:String = "test"
EndType

Type test
	Field fi:Int
	Field ff:Float
	Field fl:manalink
EndType

Local ml:manalink = New manalink
ml.val = "dynamic"
Local t:test = New test
t.fl = ml

Local off:Int = 8
Local bp:Byte Ptr = Byte Ptr t

Local pl:manalink = manalink( GetBMaxObject( bp + off ) )
If pl Then Print "pl ok " + pl.val
If Not pl Then Print "pl failed"
'EXPECTING: pl == ml == t.fl

DebugStop
</pre><br><br>byteptr.c<br><pre class=code>
#include &lt;brl.mod/blitz.mod/blitz.h&gt;

// Get object at pointer.
//BBObject *GetBMaxObject(byte *bp) {
//	return *(BBObject**) bp;
//}


//taken from brl.mod-NG/reflection.mod/reflection.c
BBObject *GetBMaxObject( BBObject **p ){
	return *p;
}
</pre><br><br><br>Output:<br><pre class=code>
Building byteptr
[ 45%] Compiling:byteptr.c
[ 99%] Processing:byteptr.bmx
[ 99%] Compiling:byteptr.bmx.console.release.linux.x86.c
[100%] Linking:byteptr
Executing:byteptr
pl ok dynamic

Process complete
</pre><br><br><br>I think  Brucey will surely say something more useful for you, as NG allows for 64bit builds, with other sizes for numbers, so "+ 8" might better be replaced by something more dynamic (adding each's field-size to an offsetSum).<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1304092"></a>

<a name="1304093"></a>

<a name="1304094"></a>

<a name="1304095"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#77">[#77]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for your reply.  I don't get that compile error - it just gives an Exception Access Violation when it runs.<br><br>So the difference is in the C code, but I don't see why one should work and the other shouldn't.  I'll give your version a try, though.  :)<br><br><div class="quote"> "+ 8" might better be replaced by something more dynamic (adding each's field-size to an offsetSum) <br></div>This is a test case.  <i>Of course</i> I'm storing offsets and using field sizes. ;)<br><br>--<br><br>EDIT: New code made no difference for me.  Still get the Exception Access Violation.  I was wondering - are you testing on an actual Windows 32-bit machine or using an emulator? <br><br></td></tr></table><br>
<a name="1304096"></a>

<a name="1304097"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#78">[#78]</a></td></tr></table></td></tr><tr ><td class="posttext"> I tested on Linux  ... and adjusting "+8" with something wrong, I get an segfault, so I assumed it worked as it should.<br><br><br>This happens with NG on XP 32Bit:<br><pre class=code>
Building byteptr
[ 95%] Processing:byteptr.bmx
[ 97%] Compiling:byteptr.bmx.console.release.win32.x86.s
flat assembler  version 1.69.14  (1915406 kilobytes memory)
3 passes, 2775 bytes.
[100%] Linking:byteptr.exe
Executing:byteptr.exe
pl ok dynamic

Process complete
</pre><br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1304103"></a>

<a name="1304104"></a>

<a name="1304106"></a>

<a name="1304107"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#79">[#79]</a></td></tr></table></td></tr><tr ><td class="posttext"> On my machine, "pl ok dynamic" prints out and it SEEMS to work, but THEN I get the Exception Access Violation.<br><br>I'm using Win7 32-bit and this happens in MaxIDE.<br><br>EDIT: If I take the DebugStop out, the exception doesn't happen.  Weird... <br><br></td></tr></table><br>
<a name="1304198"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#80">[#80]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  There seems to be some difference in the way NG handles Byte Ptr or Varptr <br></div><br>Byte Ptr &lt;Object&gt; should give a pointer to the first field in the object.<br>VarPtr &lt;Object&gt; should give a pointer to the address of the object. (this was generating incorrectly in NG. Should be working now).<br><br>Correct field offsets are available in NG via the class debug scope array. This is the same metadata that reflection uses. <br><br></td></tr></table><br>
<a name="1304219"></a>

<a name="1304220"></a>

<a name="1304221"></a>

<a name="1304222"></a>

<a name="1304225"></a>

<a name="1304226"></a>

<a name="1304227"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#81">[#81]</a></td></tr></table></td></tr><tr ><td class="posttext"> Byte Ptr vs Varptr - Thank you for the explanation, that makes sense.  It also tells me that Varptr probably wasn't causing my problem, but if it led to a bug fix, great!  :)<br><br>What does "Debugger Error: Invalid scope kind" mean?<br><br>The following code (using same .c as above) results in the error.  If I take out the "DebugStop" - it seems to be okay.<br><pre class=code>Import "extern.c"

Extern "C"
	Function GetBMaxObject:Object( bp:Byte Ptr )
EndExtern

Type TOBJ
EndType

Type TA
	Field o:TOBJ
EndType

Type TT
	Method CD( ci:TA )
		Local bp:Byte Ptr = Byte Ptr ci
		Local o:TOBJ = TOBJ( GetBMaxObject( bp ) )
		DebugStop
	EndMethod
EndType

Local a:TA = New TA
a.o = New TOBJ
Local t:TT = New TT

t.CD( a )
</pre>Of course, I'm using the DebugStop to verify the value of 'o.' <br><br></td></tr></table><br>
<a name="1304338"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#82">[#82]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've fixed a debugger issue, which should clear up that "invalid scope kind" message. <br><br></td></tr></table><br>
<a name="1304346"></a>

<a name="1304347"></a>

<a name="1304349"></a>

<a name="1304356"></a>

<a name="1304359"></a>

<a name="1304360"></a>

<a name="1304361"></a>

<a name="1304362"></a>

<a name="1304363"></a>

<a name="1304364"></a>

<a name="1304365"></a>

<a name="1304366"></a>

<a name="1304368"></a>

<a name="1304369"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#83">[#83]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm, still happens with my project, but no longer with this example (still getting EAV with the DebugStop, though).  Only change was to brl.appstub?<br><br>I assume this error is supposed to occur under <i>some</i> circumstance..?<br><br>EDIT: On a hunch, I tried something...<br><br>I was expecting this...<br><pre class=code>
Local bp:Byte Ptr = ci
bp = bp + 4
</pre><br>To have the same result as this.<br><pre class=code>
Local bp:Byte Ptr = Byte Ptr ci
</pre><br>But it <i>seemed</i> to cause that "invalid scope kind" message.  Still happens, so I changed the 4 to 8...<br><pre class=code>
bp = bp + 8
</pre><br>And that works!  So I'm guessing there's some alignment issue?  I would expect bp:Byte Ptr = Byte Ptr ci to always return that first field pointer, as you said.<br><br>Sometimes (not always) it is off by 4. <br><br></td></tr></table><br>
<a name="1304388"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#84">[#84]</a></td></tr></table></td></tr><tr ><td class="posttext"> In this particular case, the "invalid scope kind" was caused by the debugger trying to determine the variable type of "bp".<br>It does this by testing if the pointer is "GC valid". In this case, "bp" is pointing to a location inside an object, so in effect the answer from the check is "yes, this is a GC valid location".<br>Unfortunately, "bp" is not a real object, but a pointer to the location of one. Think of it like a false-positive :-)<br>I added some additional validation into bbGCValidate() but obviously it wasn't very effective at catching the issue.<br>I need to have a look at either the way the debugger is handling variables, or improve the validation code.<br><br>This issue only occurs when you are messing around with pointers of objects in debug mode. <br><br></td></tr></table><br>
<a name="1304418"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#85">[#85]</a></td></tr></table></td></tr><tr ><td class="posttext"> I had another go at it. Maybe it will work better now.<br><br><div class="quote">  So I'm guessing there's some alignment issue? <br></div><br>There's no alignment issue with the generated code. There may be alignment issues with your assumption of offset values, but I don't recommend this way of digging into the objects anyway. So YMMV...<br><br>There's debugscope/metadata stored already for each type that you can use to look up fields and so forth - it's what the reflection stuff uses to resolve them. It's a much cleaner way of accessing these things, I think. <br><br></td></tr></table><br>
<a name="1304419"></a>

<a name="1304420"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#86">[#86]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> There may be alignment issues with your assumption of offset values <br></div>Uh, nope - I was referring to the line "Local bp:Byte Ptr = Byte Ptr ci" which was ALWAYS adding 4.  I could see it happen in MaxIDE's debugger right before it crashed and printed out the "invalid scope kind" message.  The other lines were just tests to see what would work...<br><br>I will give the new version a try. <br><br></td></tr></table><br>
<a name="1304421"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#87">[#87]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  ALWAYS adding 4 <br></div><br>I mentioned this previously - Byte Ptr &lt;object&gt; will return a pointer to the first field in the object. The first field, for x86, is generally 4 bytes into the object. <br><br></td></tr></table><br>
<a name="1304423"></a>

<a name="1304424"></a>

<a name="1304430"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#88">[#88]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> The first field, for x86, is generally 4 bytes into the object. <br></div>Yes, and as I just mentioned, 8 is what worked in this case.  I don't know why...<br><br>And yes, I am open to the possibility that I'm misinterpreting something, somewhere. <br><br></td></tr></table><br>
<a name="1304425"></a>

<a name="1304427"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#89">[#89]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> There's debugscope/metadata stored already for each type <br></div>Are you referring to getting a TField and accessing its _index?  I don't believe I've written anything about where my offsets are coming from.<br><br>If you're talking about just using reflection directly to get values, in vanilla that's too slow.  Perhaps that's not the case with NG, but right now I'm just moving things over.  In vanilla, it all works rather nicely.<br><br>If you're wondering what the point of this is...I want to be able to define types in a simple manner and have them be able to self clone and serialize (read and write) without writing additional code.  Took some effort to get that to work properly. <br><br></td></tr></table><br>
<a name="1304433"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#90">[#90]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I want to be able to define types in a simple manner and have them be able to self clone and serialize (read and write) without writing additional code <br></div><br><br>Make sure that extended types are handled properly <br><br>base: Method clone() <br>extended: Method clone() 'overridden<br><br>Serialization: Brucey's Peristence.mod might help here too. If speed is an requirement, custom solutions might be better (within my modded Persistence.mod I check for "SerializeClassNameToString()" methods to see if that individual class contains an adjusted serialization/deserialization-method.<br><br><br>Sorry for derailing ... back to your offset problems.<br><br>couldn't you check whether your "byte ptr" returns the correct offset to something or not? Eg. by adding the analyzed object to another one - and then checking the offset from "parent to children" in Vanilla, and in NG?<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1304434"></a>

<a name="1304435"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#91">[#91]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Make sure that extended types are handled properly <br></div>Yes, of course.  The beauty of storing the offsets and cloning them directly is that it's quite zippy and there is seldom a need to override the clone method.  Same thing goes for serialization.<br><br>The other thing I didn't mention is that objects can be defined in Lua and the data access methods are virtually identical between Blitz-defined and Lua-defined, except the Lua instances build meta-tables for faster JIT.<br><br><div class="quote"> Couldn't you check? <br></div>Maybe, but I figured if <i>Byte Ptr ci</i> wasn't giving me the correct result, it was something that NG needs to deal with.<br><br>EDIT:  Just realized bp + 8 didn't crash, but it's NOT actually doing what I expect, either.  Still trying to figure that out. <br><br></td></tr></table><br>
<a name="1304436"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#92">[#92]</a></td></tr></table></td></tr><tr ><td class="posttext"> Clone Method: this is like copying reference handles - it does not call "clone()" on child objects which are not "base objects" (int, string, ...). So cloning a "sprite" is maybe more a "copy content to another image".<br><br><br>@byte ptr ci<br>Yes, just assumed that it might help to see if there is a discrepance or not. <br><br>Am sure that you both will tinker it out really soon. Glad I am not the only one coming up with "rare bugs" :-)<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1304437"></a>

<a name="1304438"></a>

<a name="1304439"></a>

<a name="1304440"></a>

<a name="1304444"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#93">[#93]</a></td></tr></table></td></tr><tr ><td class="posttext"> Not following you on clone method - is there something built in to BMX now?  I thought it would do whatever you tell it to do...<br><br>My Clone method always makes a deep copy of the object.  It's not just a pointer or reference.  Incidentally, I'm pretty sure I wrote this system before Brucey's persistence mod existed.<br><br>EDIT: New version does seem to get further... <br><br></td></tr></table><br>
<a name="1304443"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#94">[#94]</a></td></tr></table></td></tr><tr ><td class="posttext"> @ deep copy<br>Ok, so you handle "copying" of elements already (so the "image" of a cloned object is showing the same content, but is having its own pixmap-data) - this is what I wanted you to keep in mind (as it creates a lot of hassle if missed ;-)). <br><br>Feel free to elaborate about in in an extra post (programming section), maybe it is of interest for some of us (at least me - as long as I understand it (a bit)).<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1304446"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#95">[#95]</a></td></tr></table></td></tr><tr ><td class="posttext"> I thought the programming section was for questions, not me blathering on...  ;)<br><br>This system is for Mana objects only - does not necessarily apply to pixmaps.  However, it's pretty simple.  The user defines an object, along with some extra meta-like data.  A field containing another object can be defined as "connected to" or "pointing to" and that changes whether it clones its data or merely points to it.  Same thing goes for when data is written.  If it's "connected," it writes all of that object's data.  If it's "pointed," it writes out the path only.<br><br>So, something like a pixmap that is part of say, a texture, would probably be pointed to and would therefore not get copied UNLESS there was a method explicitly for that purpose.  Textures are generally instanced, after all.<br><br>I'm actually in the middle of writing this up and putting together a pitch for a game - perhaps I'll post a link later.  :) <br><br></td></tr></table><br>
<a name="1304447"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#96">[#96]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ahh thanks for that small insight.<br>So it is kind of the "foreign key" in SQL. While "A links to B, C links to B" is working nicely there, how to post changes in "B" to all ones, using it? (A knows B, C knows B, but B does not know A or C). You could use some kind of "event propagation" (just telling the world, you changed a property) but this might be overhead - depending on the object's structure. Else you could store a "pointed from"-list for each property. Very memory consuming. Wasn't there something like "signals" in QT ... am sure others have tinkered with that problem too.<br><br><br>But regardless of my questions I better wait for your thread (maybe a write a "PR"-one, and a "tech"-one) as I try to not further derail the thread (albeit I am interested in that subject ... argh ;-))<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1304453"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#97">[#97]</a></td></tr></table></td></tr><tr ><td class="posttext"> You know that the generated source is there for you to examine yourself?<br><br>For example:<br><pre class=code>
Type TA
	Field o:TOBJ
EndType
</pre><br>becomes something like<br><pre class=code>
struct _m_test_TA_obj {
	struct BBClass__m_test_TA* clas;
	struct _m_test_TOBJ_obj* __m_test_ta_o;
};
</pre><br>So that Byte Ptr &lt;instance of TA&gt; will return a pointer which is essentially the address of TA plus the offset to the field __m_test_ta_o.<br>Actual offsets depend on the architecture you are building against.<br><br><div class="quote">  Are you referring to getting a TField and accessing its _index?  <br></div><br>I'm referring to the generated C code, which has things like this, stored directly in the "class" which is the first part of your object structure above:<br><pre class=code>
struct BBDebugScope_2 _m_test_TA_scope ={
	BBDEBUGSCOPE_USERTYPE,
	"TA",
	{
		{
			BBDEBUGDECL_FIELD,
			"o",
			":TOBJ",
			.field_offset=offsetof(struct _m_test_TA_obj,__m_test_ta_o)
		},
		{
			BBDEBUGDECL_TYPEMETHOD,
			"New",
			"()",
			&amp;__m_test_TA_New
		},
		BBDEBUGDECL_END
	}
};
</pre><br>This is what reflection uses to build up a picture of your type. <br><br></td></tr></table><br>
<a name="1304488"></a>

<a name="1304491"></a>

<a name="1304492"></a>

<a name="1304493"></a>

<a name="1304494"></a>

<a name="1304495"></a>

<a name="1304498"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#98">[#98]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> is there for you to examine <br></div>Yes, I am aware of that.  I looked through it before and hastily concluded it was hard to read, but I've changed my mind.  :)<br><br>The latest NG is no longer giving me the "invalid scope kind" message, but it's still hanging and worse, it's really hard to find out where exactly because there must be some state that it's getting into that causes the next DebugStop, wherever that may be, to fail.  Yes, I know - MMMV.<br><br>---<br><br>EDIT: I've just confirmed that...<br><pre class=code>Local bp:Byte Ptr = ci
Local bpp:Byte Ptr = Byte Ptr ci</pre>Both of these yield the same memory address in vanilla BMX, but in NG, bpp = bp + 4.  Is that difference intentional? <br><br></td></tr></table><br>
<a name="1304490"></a>

<a name="1304497"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#99">[#99]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> to not further derail the thread <br></div>It's just you and Brucey and me here.  Only danger is Brucey abandoning this thread out of boredom.  ;)<br><br>Anyway, the problem you mentioned isn't handled.  Changing "B" would not notify "A" or "C" - you're right, keeping a list would be massive overhead. <br><br></td></tr></table><br>
<a name="1304543"></a>

<a name="1304546"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#100">[#100]</a></td></tr></table></td></tr><tr ><td class="posttext"> Aha!!  I noticed there was a new version of bcc and tried it.  Whaddya know, it works 100% now!  Thanks, Brucey!  :) <br><br></td></tr></table><br>
<a name="1304560"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#101">[#101]</a></td></tr></table></td></tr><tr ><td class="posttext"> According to the size of changes the fix must have been found very quick ;-)).<br><br><br>wondering what other bugs are waiting to get exposed.<br><br>Bye<br>Ron <br><br></td></tr></table><br>
<a name="1304611"></a>

<a name="1304689"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#102">[#102]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> According to the size of changes the fix must have been found very quick <br></div><br>Haw haw... :-p <br><br></td></tr></table><br>
<a name="1304677"></a>

<a name="1304720"></a>

<a name="1304721"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#103">[#103]</a></td></tr></table></td></tr><tr ><td class="posttext"> Another one?<br><br>This works...<br><pre class=code>Local bp:Byte Ptr = Byte Ptr ci
Int Ptr( bp )[off] = i</pre><br>This doesn't...<br><pre class=code>Int Ptr( Byte Ptr ci )[off] = i</pre><br>I can live with doing things the first way, but why wouldn't the second work?<br><br>Of course, same for Float, Long, etc.<br><br>---<br><br>EDIT: Okay, now this is fixed, too.  Thanks! <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
