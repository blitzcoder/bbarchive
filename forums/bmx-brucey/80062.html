<!DOCTYPE html><html lang="en" ><head ><title >More distractions...</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >More distractions...</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=124" >Brucey's Modules</a>/<a href="#bottom" >More distractions...</a><br><br>
<a name="899518"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I blame Winni for this one...<br><br>Anyhoo... here's a screenshot from a "made-in-an-evening" module I started today :<br><img src="http://brucey.net/programming/blitz/misc/screenshots/blitzmax_movie_01.jpg"><br><br>It shows a movie playing at 2x zoom.... without sound for now, until I can work out how to feed the stream into somewhere - I'm sure it's easy enough.<br><br>Got to mess about with the framerate in the example too, but it's not bad for an evening.<br><br>Looks like it'll work on all three platforms too, which is kinda groovy.<br><br><br>But it's probably another of those niche modules... <br><br></td></tr></table><br>
<a name="899611"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Winni</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I feel so innocent and have been mostly offline for almost two weeks... What did I do when to get you working on this one? <br><br></td></tr></table><br>
<a name="899633"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah... you indirectly mentioned avbin ;-) <br><br></td></tr></table><br>
<a name="899634"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Video is working... properly... now... using what I suppose is delta timing to keep the video running in real-time.<br><br>So I've discovered that FreeAudio doesn't do anything other than play normal samples. Even creating a "static" sample doesn't work properly - I have a fix for the module, but to be honest I'm not bothered that it sucks eggs. Moving on.... <br><br></td></tr></table><br>
<a name="899642"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tachyon</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nice Brucey! I'd love to see this module finished and working on all platforms! <br><br></td></tr></table><br>
<a name="899661"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ooooh... I appear to have sound playing with the video... although it's not quite in sync... which is a bit of a problem...<br><br>Not sure how I'm going to get them sync'd up properly... <br><br></td></tr></table><br>
<a name="899662"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm, so currently the video is sync'd to "real time"... and the sound is just playing...<br><br>Should I sync the video to the audio timestamp?  I suppose that sounds better... <br><br></td></tr></table><br>
<a name="899677"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorted :-) <br><br></td></tr></table><br>
<a name="899681"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here's another little screenie...<br><img src="http://brucey.net/programming/blitz/misc/screenshots/blitzmax_movie_02.jpg"><br>You'll have to take my word for it on the audio playback ;-)<br>This particular example is Ogg Theora 854x480 w/ 48khz stereo. Sounds sweet!<br><br>I've found that a "hacked" version of the DrawPixmap function works great, although I guess your mileage will vary depending on what you want to do.<br>Since I'm getting back RGB8 images, there's little point in converting them to RGBA8 as you are only going to be blitting (you know what I mean) them to the screen anyway. If you want to do fancy  alpha effects and what not, I guess you'd have to work out something else.<br><br>Since my running draw routine is using this :<br><pre class=code>
	glRasterPos2i 0,0
	glBitmap 0,0,0,0,x,-y-t.height,Null
	glDrawPixels t.width,t.height,GL_RGB,GL_UNSIGNED_BYTE,t.pixels
</pre><br>I've no idea if one could apply scaling etc to it, or if those functions are effectively like a blit. I'm not an expert.<br><br>Anyhoo... it's been quite fun.. these last 24 hours or so :-)<br><br>Thanks to Winni for the heads-up on the library that he didn't really mention. I have to say.. open source really rocks! (if you know where to look, apparently). <br><br></td></tr></table><br>
<a name="899790"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay... committed..<br><br>I've tried testing the example on Win32 (on Parallels), but it can't chuck the stuff around fast enough to work very well - however, I can see that it is trying to do it, so I'm guessing it works :-p<br><br>Things you will need to install (once you've built the module - via SVN)...<br><br><a href="http://code.google.com/p/avbin/downloads/list" target="_blank">AVbin</a> (link to the downloads page).<br><br>AVbin comes in the form of a DLL / .dylib, that needs to be installed.<br>For Mac, in theory, you could ship it in the app bundle, but I haven't tried it yet.<br><br>and to try the example app on Win32,<br><a href="http://connect.creativelabs.com/openal/Downloads/oalinst.zip" target="_blank">OpenAL</a> (link to the setup .zip)<br>...if you don't already have it installed.<br><br><br>Your mileage may, as usual, vary considerably. But I'm happy enough with what it is doing so far - playing video with sound.<br>You may have issues running the example with different types of media... as I may not be using the library in the correct way for the start of a stream... I think you are meant to use the "start timestamp" stuff to determine when things are meant to kick off. I ain't no expert by a long way.<br><br>The example also doesn't handle the end of the stream properly. In reality the streams should be closed, and then the file closed. And of course, have OpenAL stopped.<br><br>Some work could be done on the "drawing" stuff. BlitzMax by default prefers to draw on RGBA8 textures. It would have been nice if we got a choice. And therefore less data copying. But it's all a bit fuzzy to me this GL thing, so I've done what I could to get it working so-so.<br><br>But, given a lack of integrated video+audio in BlitzMax, this appears to be the best there is for now.<br><br>Comments, suggestions, feedback (and patches) always welcome :-)<br><br>I'll do a proper release once things settle down a bit...<br><br>:o) <br><br></td></tr></table><br>
<a name="899824"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Latest commit adds support for Linux, which I'm very happy to say is working too :-)<br><br>One note for OpenAL on Linux. There is a bug with the library loader in Pub.OpenAL that requires you to have the OpenAL devel package installed to be able to run apps with it.<br>Hopefully this will be fixed by BRL shortly.<br><br>Have fun...<br><br>:o) <br><br></td></tr></table><br>
<a name="899897"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Can't you pass GL_RGBA to the format parameter to get RGBA8 images back?<br><pre class=code>glDrawPixels t.width,t.height,GL_RGBA,GL_UNSIGNED_BYTE,t.pixels</pre><br>Edit: oh that's the draw pixel code, sorry. <br><br></td></tr></table><br>
<a name="899917"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >plash</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey! that was a good short film (Blender ftw!)<br><br>What library is this based on?? <br><br></td></tr></table><br>
<a name="899938"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> I suppose the idea behind using RGB8 instead of RGBA8 is that for a video stream, you don't really need an alpha channel?<br><br><div class="quote"> What library is this based on??  <br></div><br><br>FFmpeg :-) <br><br></td></tr></table><br>
<a name="899956"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can use glPixelZoom to scale the image, glDrawPixels is a blit operation. It can be slow on some cards (<a href="http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=5020009" target="_blank">see here</a>) but I don't think there's an alternative. FFmpeg seems to support up to 32-bit data, maybe the file you used was 24-bit? Btw, this <a href="http://www.dranger.com/ffmpeg/" target="_blank">tutorial</a> was quite interesting. <br><br></td></tr></table><br>
<a name="899960"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> I was using AVbin rather than FFmpeg directly, because it simplifies the process of aqcuiring data somewhat.<br>I suppose what is really needed, to speed things up somewhat, is, as that tutorial points out, to run the various parts in their own threads.<br>I can see that the audio decoding could be better done in a separate thread, since I am not really doing anything BlitzMax specific in there. All we'd need to do is feed it with packets and let it take care of itself.<br>That would give the rest of the code a few more cycles per frame...<br><br>Maybe I should return to my old ffmpeg attempt from a year-or-so ago...  but I'm reasonably happy with progress so far with AVbin.<br><br>I would prefer if in BlitzMax we had a bit more control over what "kind" of textures we could create - without having to code directly in OGL. Perhaps we need a new Max2D with more choices.. :-) <br><br></td></tr></table><br>
<a name="900044"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Heh... runs like a three-legged dog on my work PC... Sure I wasn't expecting much, but I thought it might handle my test video.<br><br>So, where does one start looking for bottlenecks in my crappy example code?<br><br>:-p <br><br></td></tr></table><br>
<a name="900164"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> No idea as I'm not looking at the code. glDrawPixels doesn't perform well on some OS/video card setups so that might be it, and if it is that then there's not much you can do about it as the video card drivers are the problem in that case, according to the sun bug report I linked to. <br><br></td></tr></table><br>
<a name="900330"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've got a workaround which uses glTexSubImage2D, via a modified version of GLMax2D. Works great. I can now run the test video on my work PC in debug mode without stutter.. yay.<br><br>What my version of GLMax2D does is to allow you to use PF_RGB888 format pixmaps as well as PF_RGBA8888. Rather than converting the passed in pixmap to RGBA, it will let you use the pixmap in its original form.<br>Which removes a whole level of pixel conversions along the way.<br><br>And I suppose that I can now perform all those funky effects on the image now that it is a texture rather than a straight blit to the card.<br><br><br>I still fancy a go at threading off the decoding routines though, but it'll take me a while to get a module set up to use threading mixed in with BlitzMax - I only intend running threads in C++, so it shouldn't be a problem with the GC. <br><br></td></tr></table><br>
<a name="900413"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Lord Danil</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> Video stops, before the record end. <br><br></td></tr></table><br>
<a name="900417"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't doubt it for a moment.<br><br>It seems there are better ways to sync the video with audio than my example uses. Ideally they both sync via a "current" time, which I haven't done with the example.<br><br>Still, it's early days yet, and I've never really played with time-critical streams before. <br><br></td></tr></table><br>
<a name="900724"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> Would it be possible to use this with my own 3D engine? I can change the data within a texture just by providing a pointer to the new data, and I don't need audio. Would I have to modify much, given that you're (understandably) wrapping it up for use with Max2D. <br><br></td></tr></table><br>
<a name="900732"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> Only the example has anything to do with Max2D... the module itself is render-agnostic :-)<br><br>If you don't need audio, it's a lot easier to manage the streams.<br>Each video packet contains a timestamp which you can use to determine when that particular frame should be shown. <br><br></td></tr></table><br>
<a name="975266"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tachyon</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> Brucey- did this module ever become "official"? I re-discovered it because of another post someone made. Is it ready-to-go...i.e. stable and complete enough to use on a commercial product? <br><br></td></tr></table><br>
<a name="1048921"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sadly, I have not been able to get this to compile.  :( <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
