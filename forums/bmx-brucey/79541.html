<!DOCTYPE html><html lang="en" ><head ><title >GtkAccelMap paths - discussion</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >GtkAccelMap paths - discussion</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=124" >Brucey's Modules</a>/<a href="#bottom" >GtkAccelMap paths - discussion</a><br><br>
<a name="893065"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I thought I'd put this up for discussion before I dive in and start to hack the code apart.<br><br>Mr Tiffany notes that accelerator groups, once set, can't be modified. The other alternative are accelerator maps. However, these require you to provide some kind of unique "path" reference for each accelerator you add.<br><br>Notes from the docs :<br><div class="quote"> <br>The accelerator path must consist of "&lt;WINDOWTYPE&gt;/Category1/Category2/.../Action", where &lt;WINDOWTYPE&gt; should be a unique application-specific identifier, that corresponds to the kind of window the accelerator is being used in, e.g. "Gimp-Image", "Abiword-Document" or "Gnumeric-Settings". The Category1/.../Action portion is most appropriately chosen by the action the accelerator triggers, i.e. for accelerators on menu items, choose the item's menu path, e.g. "File/Save As", "Image/View/Zoom" or "Edit/Select All". So a full valid accelerator path may look like: "&lt;Gimp-Toolbox&gt;/File/Dialogs/Tool Options...".<br> <br></div><br><br>Now, I dunno how closely these guidelines are meant to be followed, or if it is just a guideline, and we can please ourselves, but from what I understand, the GtkAccelMap is some kind of system-wide singleton...<br><br>So... any ideas?<br><br>Remember, this is MaxGUI, which is generic, so we are coding below the exposed APIs...<br><br>:o) <br><br></td></tr></table><br>
<a name="893079"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mark Tiffany</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Remember, this is MaxGUI, which is generic, so we are coding below the exposed APIs... <br></div><br>Stating the obvious for any other readers - ths also means that the need to change current behaviour arises because current GTK behaviour differs from other maxgui implementations.<br><br><div class="quote"> So... any ideas? <br></div><br>First a question, then some thoughts - is this information used anywhere?  It almost looks like the purpose of this is for there to exist a single system-wide app that is used to define hotkeys - is that the case?  (Not aware of one).  Is this information ever visible to anyone to the best of our knowledge?<br><br>Okay, so there's no means to pass additional data in to use for the key maps, so it will have to be generated from existing information.<br><br>The most obvious starting point is the AppTitle - use this as at least part of the &lt;WINDOWTYPE&gt;.  I guess ideally we would categorise all other windows used by an app, but no idea how we could do that.  So maybe just use the window title used when first created?  Or would it be simpler to use some kind of window ID (if such a concept exists in gtk?).<br><br>As for categories, a hotkey can always be linked to a gadget, e.g. a menu, a button, or for non specific hotkeys, presumably in effect linked to the base window? So category could be type of gadget.<br><br>Finally, the action can be derived from the gadget text, e.g. interrogate the menu structure to determine the menu item the key relates to is "File/Save As...", or just take the text of a button "Ok" or "Cancel".  the problem will be what to name these...maybe just the name of the keyboard combo?<br><br>The issue with some of the above is that it could vary during runtime (e.g. window tile changes).  Is that an issue?  You'd probably have to track changes to the names of all the gadgets that could be affected and amend the hotkeys then - yuck:<br><br>Anyway, in summary:<br><br>&lt;WINDOWTYPE&gt; = AppTitle-WindowName<br>Category1 = GadgetType<br>Category2 = ~GadgetText <br><br>Examples:<br><br>MaxIDE-MaxIDE/Menu/File/Save As...<br>MaxIDE-Find/Button/Find Next<br>MaxIDE-MaxIDE/Window/Ctrl-Tab <br><br></td></tr></table><br>
<a name="893083"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> It almost looks like the purpose of this is for there to exist a single system-wide app that is used to define hotkeys - is that the case? <br></div><br>I can't seem to find any information on that, so who knows. It certainly implies something when it states "a unique application-specific identifier".<br><br>Maybe we can use the appname, rather than apptitle? (I think that's the first entry of appargs? Which could get us around AppTitle change issues.<br><br>You are right in saying it might be hard to track gadget titles for paths during runtime. Perhaps we can hang onto the initial value and use that forever.<br><br>I wonder if the path even is a proper path, or is just there as some "help" to indicate a unique string. Perhaps one can get away with generating unique ids... <br><br></td></tr></table><br>
<a name="893084"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ah. I see...<br><br>gtk_accel_map_save() : Saves current accelerator specifications (path, key and modifiers) to filename. The file is written in a format suitable to be read back in by gtk_accel_map_load().<br><br>So, the paths are good for persisting your customised hotkey settings between runs of your app.<br><br>But I we'll not be needing that for MaxGUI.<br><br>Maybe we can do :<br><br>&lt;appname&gt;-&lt;windowtitle&gt;/&lt;gadget&gt;/&lt;some-generated-id&gt;<br><br>I wonder if we shouldn't follow child heirarchy in the path? Perhaps that's a wee bit of overkill though :-)<br><br>&lt;appname&gt;-&lt;windowtitle&gt;/&lt;panel1&gt;/&lt;panel2&gt;/&lt;gadget&gt;/&lt;some-generated-id&gt; <br><br></td></tr></table><br>
<a name="893086"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mark Tiffany</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> probably overkill to worry about all of the hierarchy.  <br><br>As the concept is to persist across ultiple runs, the other (unmentioned above) thought of using object refs wouldn't be entirely consistent, even if it would yield a simple unique and persistent "name" for each item.<br><br>It probably is best to go with storing the original name of the gadget in every gadget that can gain a hotkey (I'm guessing it only holds the current text at present), and then use that stored value whenever you set the hotkey on the gadget.<br><br>Another alternative option could be to change the maxgui API, add a "hotkeyid" tag to SetGadgetHotkey, and then add a "HotkeySave" and "HotkeyLoad" function across all platforms - neatly solving the gtk issue, but creating one for other platforms (albeit that once implemented enables users to very easily save &amp; load hotkeys?<br><br>Not convinced, but worth a passing thought... <br><br></td></tr></table><br>
<a name="893107"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Not sure we want to affect changes to the core API...  am always wary of tinkering with things like that if I can help it.<br><br>Although Seb seems to enjoy throwing in a new function here or there ;-)<br><br>Perhaps if all the platforms gained something in its addition, but otherwise, I suppose I'm happy (interesting choice of word?) enough to try it out by only changing GTK.<br><br>Doing my head in at the moment tho... I think I'll start again :-p <br><br></td></tr></table><br>
<a name="893117"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, I made the acceleration errors go away from the CEIDE... but there's lots more I notice... plenty of noise in the treeview, by the looks, and it seg-faults with ease elsewhere too...<br><br>It's a start, I suppose... <br><br></td></tr></table><br>
<a name="893125"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mark Tiffany</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I wouldn't be surprised about errors in the treeview.  I think treeviews could do with some cross-platform love, as there's code in there to deal with macos working differently...so wouldn't be surprised if that hack for macos is also needed for gtk?<br><br>The seg faults are weird - first of all it used to do it every time when calling bmk (for version info in startup), and commenting it out would get it working fully.  Then Seb fixed freeprocess, and that error went away, but then I'd added hotkey config, and it errored on hotkeys, and then hangs regardless of whether I turned off the hotkey stuff.  I think I then hacked out all treeview business (I think the easiest way was to Return immediately inside the datanode Sync code), but even then it was still unstable... <br><br></td></tr></table><br>
<a name="893126"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> But I thought the whole point of MaxGUI was we didn't have to hack in anything ;-)<br><br>Anyhoo. There's one small caveat to this new accelerator implementation... which is the shortcuts don't appear in the menus. I've as yet been unable to work out how to get them back in there *sigh*. (although I've found GtkAction, which seems to be yet another way of doing this kind of thing...)<br><br>Checked in anyway, for your amusement. <br><br></td></tr></table><br>
<a name="893127"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think the only problem I have with tracking down these errors, is knowing whereto start :-p<br><br>I'll try to have a rummage anyway. <br><br></td></tr></table><br>
<a name="893130"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mark Tiffany</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ta.  I'll take a look at ce ide on gtk later, but probably not the best place for you to start when trying to find a bug.  Does the official IDE compile okay with gtk? <br><br></td></tr></table><br>
<a name="893132"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm running the official IDE as my IDE now, so yes, it all seems to work fine. I've not had any issues with it since I sorted out those other things. :-)<br><br>Even the splash screen works :-p <br><br></td></tr></table><br>
<a name="893151"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SebHoll</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wow, you've certainly been busy.<br><br><div class="quote"> But I thought the whole point of MaxGUI was we didn't have to hack in anything ;-) <br></div><br>Precisely, which is why I don't think I like the idea of having to tweak <b>SetGadgetHotKey()</b> just for GTK. If we could get away with it, I think it would be better to keep the same API the other platforms use.<br><br>Am I missing something here? Is all this work needed just to remove a gadget hot key? Couldn't we just re-assign it to a internal invisible gadget (effectively disabling it) or am I being stupid?<br><br><div class="quote"> I wouldn't be surprised about errors in the treeview. I think treeviews could do with some cross-platform love <br></div><br>This is probably because of the different ways each platform handles treeviews. <b>Win32</b> API has a dedicated treeview control (nice and simple!), <b>Cocoa</b> uses an <b>NSTableView</b> control and so is really a table with a few extras for hiding/showing indented items. <b>FLTK</b> (lol), well that doesn't actually have a treeview control, so it is actually a listbox with some of Skid's magic code that hide and shows items, recreating lists, and intercepting events to process item collapsing/expansion.<br><br>You're right though, Mark, the platform behavior should be consistent in MaxGUI, so if you get a chance, could you post some bug reports? <br><br></td></tr></table><br>
<a name="893159"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mark Tiffany</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>Am I missing something here? Is all this work needed just to remove a gadget hot key? Couldn't we just re-assign it to a internal invisible gadget (effectively disabling it) or am I being stupid? <br></div><br>There are (at least) two ways of assigning a hotkey to a gadget in gtk.  Either when you create the gadget (in which case gtk does not let you change it in any way whatsoever after creating it), or by using the above mentioned gtk api.  So yes, it's painful, but unfortunately it appears to be necessary to duplicate behaviour on other platforms.<br><br>And I basically agree on the "don't change the API" point, just thought I'd offer up the thought in case it sounded like an easier way through.<br><br>And apologies, but I didn't get time to fire up linux this evening (finally decided to sit down and watch atonement on DVD with the wife - she might stop moaning about time on the computer for a couple of days now...)<br><br>As for treeview bug reports, not sure where to start, and have never really dug into it to be honest : but I've seen enough to have my suspicions!  The one thing I know for sure causes some kind of issue is free-ing / removing nodes.  Look in the official ide code for wherever it sync's datanodes &amp; treenodes.  I think you'll find a FreeTreeViewNode wrapped in a ?macos construct.  TBH, I've tended to leave well alone, so never tried to isolate the problem, which doesn't help you I'm afraid... <br><br></td></tr></table><br>
<a name="893161"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SebHoll</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> There are (at least) two ways of assigning a hotkey to a gadget in gtk. Either when you create the gadget (in which case gtk does not let you change it in any way whatsoever after creating it), or by using the above mentioned gtk api. So yes, it's painful, but unfortunately it appears to be necessary to duplicate behaviour on other platforms. <br></div><br>OK, well couldn't we just get GTKMaxGUI to free the gadget and recreate an identical one without a hot key? Would that not be easier and would avoid all this low-level accelerator map stuff? <br><br></td></tr></table><br>
<a name="893170"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, the gadget hotkey stuff appears to be working, sort of, maybe... at least the errors in the CEIDE went away.<br><br>I could probably do with a small example for any issues, rather than trying to debug a big app - you know how it is ;-)<br><br>Sure, it might be possible to drop and create the gadget, but that seems to be a bit overkill, plus you'll need to remember location/size/etc to get it back into the same place - which may, or may not work as expected.<br><br>But everything should be able to be done without a change to the API.. which perhaps wasn't clear above?<br>"all this low-level" stuff is already being done in the GTK wrapper anyway :-p What's a little more?<br>Funny though, that those bloody little angle-brackets &lt;MyApp-Window&gt; are actually a requirement in the path :-p<br><br><br>I had a go at digging out the treeview errors for CEIDE/GTK, but I got lost along the way, so rolled back my first attempt (one of the joys of SVN!)...<br>I wonder what the CEIDE is up to that the official IDE doesn't have issues with - since it works apparently perfectly using GTK in its current form. <br><br></td></tr></table><br>
<a name="893241"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mark Tiffany</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I wonder what the CEIDE is up to that the official IDE doesn't have issues with - since it works apparently perfectly using GTK in its current form. <br></div><br>I rewrote a chunk of code in the treeviewnode stuff as it was (is) a real spiders web of horribleness.  Major issues found with the order things were freed in and memory leaks from nodes not being freed when they should be, etc, not to mention very poor performance because it would often re-build everything every time.  I still don't like that area of code one little bit, but it is stable on Windows now.<br><br>Possible causes of errors I can think of without going into the code:<br> - Trying to do something to a treeview node that has been freed<br> - Trying to do something to a treeview node that has bene hidden<br> - hiding / showing / collapsing nodes<br><br>The above could probably be tested in a simple app (may be worth extending the treeview sample code a bit to create a test harness we can prove across all four gui implementations. <br><br></td></tr></table><br>
<a name="893245"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SebHoll</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Sure, it might be possible to drop and create the gadget, but that seems to be a bit overkill, plus you'll need to remember location/size/etc to get it back into the same place - which may, or may not work as expected. <br></div><br>Well size and location is stored inside the <b>TGadget</b> instance anyway. <b>TGTKGadget</b> appears to store its visibility and style, font and tooltip. The text could be retrieved and temporary stored by the gadget before it is recreated. All doable, and perhaps worthy of consideration if this other method becomes too difficult. Arguably, all these maps seen overkill for just a few simple hotkeys. Ah well, it's up to you. ;-) <br><br></td></tr></table><br>
<a name="893249"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Trying to do something to a treeview node that has been freed <br></div><br>That's probably not a good idea.<br><br>Should I be checking for this myself, or should an app have more sense?<br>I would prefer the latter... <br><br></td></tr></table><br>
<a name="893256"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SebHoll</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Trying to do something to a treeview node that has been freed <br></div><br>You're right, MaxGUI apps should not attempt to access gadgets once they have been freed. If anything, its bad practice.<br><br>Mark T:<br><br><div class="quote"> Look in the official ide code for wherever it sync's datanodes &amp; treenodes. I think you'll find a FreeTreeViewNode wrapped in a ?macos construct. <br></div><br>Just had a look now, and can't seem to find anything like that in <i>maxide.bmx</i>. Maybe it was one of the things that I ripped out when I replaced the debugger tree stuff, although I can't remember my changes having anything to do with the the creation/freeing of nodes (this was handled automatically by <b>TNode</b> iirc). <br><br></td></tr></table><br>
<a name="893260"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mark Tiffany</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> That's probably not a good idea.<br><br>Should I be checking for this myself, or should an app have more sense?<br>I would prefer the latter...  <br></div><br>Agreed, but I recall it failing silently on Windows, but gtk is (rightly) more noisy about it. <br><br><div class="quote"> <br>Just had a look now, and can't seem to find anything like that in maxide.bmx <br></div><br><br>I was utterly convinced this was in the original maxide code, but can't see it in current versions.  May no longer be necessary?<br><br><pre class=code>
?MacOS ' MacOS doesn't allow "adding" TreeView nodes by "inserting" them after the last node
</pre> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
