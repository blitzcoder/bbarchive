<!DOCTYPE html><html lang="en" ><head ><title >HOWTO: Including data in the application bundle</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >HOWTO: Including data in the application bundle</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=112" >BlitzMax Tutorials</a>/<a href="#bottom" >HOWTO: Including data in the application bundle</a><br><br>
<a name="823454"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JazzieB</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> For those of us working on Mac titles, and in particular those wanting to produce universal binaries at the end of it, the use of IncBin is not exactly ideal.  The reason for this is that when you then come to create your universal binary you end up with your media being included twice!  Not good, as this turns a 16MB app into a 32MB one, which should just be around the 18MB mark.  So, you can either have all this data stored externally, which is messy, or you can put the data into the application bundle itself, where both the PPC and Intel binaries can access the same data.<br><br>This is actually quite easy to do, so a lot of you may already have figured it out.  But for those who haven't, this is how you go about doing it.<br><br>NOTE: I only do this for static game data, i.e. media and other files that I only need to read.  Anything that needs to be written to I store in the "/Users/Shared/" folder.  You should be able to write to the application bundle as well, although I haven't tested it, and it's generally not recommended.<br><br>1. If you haven't already built your app, go ahead and build one.  There's no need to worry about making any code changes at this stage.<br><br>2. Now go to your application, right-click on it, and select "Show package contents".<br><br>3. A window will pop-up that will just show a folder called "Contents".  Open this folder.<br><br>4. Now you will see two folders ("MacOS" and "Resources").  Open the "Resources" folder.  By default, the only thing in here is your app's icon file.<br><br>5. Create a new folder and call it "Data" (or anything of your choosing).<br><br>6. Copy all of your game's media and other files into this new "Data" folder.<br><br>7. Highlight the "Data" folder and press Command+I (or right-click and select "Show info").<br><br>8. At the bottom of this dialogue box you will notice that the file permissions say "read and write" for you.  Click on the drop-down arrow to reveal the permissions for the other types of user.  You'll notice that these say "No access", which is obviously no good if you want your app to run from other accounts.  Simply select each type of user and change the permissions to "read only"<br><br>9. With the above dialogue still open, click on the "Apply to sub-folders" button.  You will be asked for confirmation and to then enter your admin password.<br><br>10. If you want to attempt writing to some files/folders, highlight each of the relevant files and/or folders and change the permissions to "read and write".<br><br>You may now close the application bundle's window, as you've now got all your data in place.  The best bit is you don't need to do all of this again the next time you build your app as it isn't overwritten.<br><br>NOTE: If you later need to change any of the files that you have in the bundle, first change the original files and then copy them back into the bundle.  You WILL need to change the permissions for any new files for the other users once you've copied the updated files into the bundle.<br><br>Now all you need to do is make some small changes to your code in order to load the data from the bundle instead of an external folder.  This basically just means finding the correct path for the data.<br><br>1. First you need to find the filename of your app, as you can't assume the end-user won't have changed it.  The following will do just that.<br><br><pre class=code>
Global appName:String=StripDir(AppFile)+".app"
</pre><br>2. Next all you need to do is add the path to the data.<br><br><pre class=code>
Global appData:String=appName+"/Contents/Resources/Data/"
</pre><br>3. Now just add the data path to the beginning of all your loading functions, for example...<br><br><pre class=code>
Global gameLogo:TImage=LoadImage(appData+"Gfx/GameLogo.png")
</pre><br>If you're making your app for more than one OS then you may need to have different loading sections between the compiler directives ?macos, ?win32, ?linux, etc.<br><br>And that's it.  Just remember to change the permissions again for any files you later update and there's no need to re-copy data for every rebuild of your app.  The only things that get overwritten when an app is built are the binary in the "MacOS" folder and the icon in the "Resources" folder.<br><br>For information on creating universal binaries and changing the icon, check <a href="/posts.php?topic=65180" target="_blank">here</a>. <br><br></td></tr></table><br>
<a name="823489"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Cool man, thanks for the nice clear and well explained steps. I will definitely refer to your tutorial when I get to that point in development.<br><br>Thanks! <br><br></td></tr></table><br>
<a name="823537"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xlsior</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I suppose you could also use Koriolis' zipstream module to use streamed password protected zips containing the resources if you want to keep people from ripping your resources too easily. <br><br></td></tr></table><br>
<a name="823573"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JazzieB</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I suppose you could, although I haven't tried.  I see no reason why not. <br><br></td></tr></table><br>
<a name="831393"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Excellent thanks.  Using this today!<br><br>Works like a charm, now I've added a flag to my framework called DataInAppBundle which handles the path change automatically. <br><br></td></tr></table><br>
<a name="978663"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >mulawa1</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Pure Gold JazzieB!<br><br>My eMac arrived yesterday and by the end of the day I had my first app fully operational - even managed all the dmg stuff!<br><br>Have you found a way to stop Blitz overwriting your icon every time you recompile? I tried making it "read only" but that stopped Blitz from completing the compile.<br><br>Peter <br><br></td></tr></table><br>
<a name="978664"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >mulawa1</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> PS This item should be Sticky! <br><br></td></tr></table><br>
<a name="978696"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >mulawa1</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think I've answered my own question about the icon. Obviously the executable and the data have to be copied to a separate folder which will be made into the dmg. After recompiling just copy the executable into the package which is in Contents/MacOS.<br><br>Just in case someone is struggling with dmg creation, I did it by using Terminal, moving to my app's directory and then issuing a command like this<br><br>hdiutil create XXX.dmg -volname "YYY" -fs HFS+ -srcfolder "ZZZ"<br><br>where<br><br>XXX = disk image file name<br>YYY = window title displayed when DMG is opened<br><br>Here's mine:<br><br>hdiutil create pj.dmg -volname "PJ Special" -fs HFS+ -srcfolder "pj"<br><br>Peter <br><br></td></tr></table><br>
<a name="979495"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JazzieB</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Have you found a way to stop Blitz overwriting your icon every time you recompile? I tried making it "read only" but that stopped Blitz from completing the compile. <br></div><br>I don't think there is a way of stopping this from happening.  There are, however, ways of having BM use a different icon.  This has been discussed before, although I can't remember if this was Windows only or whether it worked on the Mac as well.  I generally don't worry about the icon until I'm ready for the final build.<br><br><div class="quote"> PS This item should be Sticky!  <br></div><br>I agree :)<br><br>Glad you found this useful. <br><br></td></tr></table><br>
<a name="979496"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm from the camp that says you shouldn't be doing everything by hand... but anyway.<br><br><div class="quote"> I don't think there is a way of stopping this from happening. <br></div><br>Indeed not, but my BMK can run post build scripts, which allows you to do extra stuff after a build.<br><br>For example, with Grisu's PRP Mac build, it's set up to copy both a icns file, and the FMOD dll into the application bundle. Given the number of releases he comes out with, I cannot comprehend doing this by hand every time.<br><br>The same goes for making it a Universal app - doing this by hand for each release? No thanks!<br><br>So, for me, I just have a file, "post.bmk" in the application folder, which is processed as part of the build.<br><br>The contents look like this :<br><pre class=code>
# MacOS post build script
#
#
@define doPostInstall

	# only interested for Mac platform
	
	if bmk.Platform() == "macos" then

		local path = utils.ModulePath("bah.fmod") .. "/lib/" .. bmk.Platform() .. "/"
		local file = "libfmodex.dylib"

		# copy FMOD
		sys.CopyFile(path .. file, %exepath% .. "/" .. file)
		
		#copy icons
		sys.CopyFile(%buildpath% .. "/data/prp.icns", %exepath% .. "/../Resources/" .. %outfile% .. ".icns")

	end

@end

# run the post install
doPostInstall
</pre><br>The code inside the @define block is basic Lua, with some enhancements. For example variables wrapped in %% are automatically translated by BMK at runtime.<br><br>Obviously, you could have it set up to do anything, like copying any files, ftp'ing, etc.<br><br>But of course, for everyone that prefers to do it manually, they can follow the 10 steps above.  :-) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
