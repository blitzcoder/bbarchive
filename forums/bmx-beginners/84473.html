<!DOCTYPE html><html lang="en" ><head ><title >AddHook</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >AddHook</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=101" >BlitzMax Beginners Area</a>/<a href="#bottom" >AddHook</a><br><br>
<a name="954444"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Naughty Alien</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> ..what this command is used for?? I couldnt find it in help file, but I saw it in few examples..what it does? Can someone explain it and eventually post some simple example just to get it on correct way..thanks.. <br><br></td></tr></table><br>
<a name="954449"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jesse</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="http://www.2dgamecreators.com/maxgui/T15-Eventhooks.html" target="_blank">http://www.2dgamecreators.com/maxgui/T15-Eventhooks.html</a><br>it can be used for other things too, not just GUI. <br><br></td></tr></table><br>
<a name="954451"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SebHoll</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hooks are basically a BlitzMax system for managing <a href="http://en.wikipedia.org/wiki/Callback_(computer_science)" target="_blank">callbacks</a>.  In short, callbacks provide a mechanism for getting your own project-specific functions called at key points in a program.  A 'callback' is a name used to refer to any function that is called from an otherwise separate part of a program.  They are extrememly useful when we are coding programs that use modal loops or wanting to handle situations where we need to run code immediately *as it happens*.<br><br>There are two types of hooks, which are available out-of-the-box (although more can be added, by third party modules etc.):<br><br>1. <b>EmitEventHook</b><br>This hook allows you to set-up a callback whenever the <b>EmitEvent()</b> function is called (i.e. whenever a BlitzMax event is generated, whether it be a mouse move event by a Max2D graphics window, or a MaxGUI gadget event generated when a button is clicked).  This allows you to receive and respond to events exactly as they happen, instead of you picking them out the event queue at a later point, typically once your event loop has finished its current cycle.<br><br>2. <b>FlipEventHook</b><br>This hook allows you to set-up a callback for whenever the <b>Flip()</b> command is used to flip the buffers of your graphics context.  I'm not really a game programmer, but I would imagine that this is very useful if ever you want to measure things like frames-per-second as the calculations can be calculated whenever the <b>Flip</b> command is called.<br><br>Ok, so let's say you would like a function we coded to be called whenever the mouse moves or a key is pressed.  This is done using the <b>AddHook()</b> command.  If you look at the docs, the <b>AddHook()</b> command takes four parameters - two of which are compulsary:<br><br><pre class=code>AddHook( id,func:Object( id,data:Object,context:Object ),context:Object=Null,priority=0 )</pre><b>id</b>:  This is the constant that represents the type of hook we want (either <b>FlipEventHook</b> or <b>EmitEventHook</b>).  In this case we want a function to be called whenever an event is emitted, so we will use the latter.<br><br><b>func:Object( id,data:Object,context:Object )</b>:  This tells us that <b>AddHook</b> is also expecting us to pass to it the function that we want to be called.  It must accept the three parameters (id, data:Object, context:object) and return an <b>Object</b>.  Bearing this in mind, let's code a suitable function now...<br><br><pre class=code>Function myEventHookFunction:Object( pID:Int, pData:Object, pContext:Object)
    '...
    Print "An event has been emitted."
    '...
    Return pData
    '...
EndFunction</pre>As you can see, this function conforms to the specification required by <b>AddHook</b>.  Now we have our function, we register it with <b>EmitEventHook</b> by calling:<br><br><pre class=code>AddHook EmitEventHook, myEventHookFunction</pre>Now, whenever an event is emitted from anywhere in our program, the function <b>myEventHookFunction()</b> will be called (i.e. text will be printed to standard output).  It is up to the specific hook type we are using to decide what it passes to the function as <b>pData</b>, but <b>pID</b> will be the constant of the hook type (in this case <b>EmitEventHook</b>) and <b>pContext</b> will point to the object that can be optionally specified as the third parameter in the <b>AddHook</b> call.  As we didn't explicitly specify a <b>context</b> in our <b>AddHook</b> call, this will default to <b>Null</b>.<br><br>Hooks really are quite a big subject, but I've tried to give a brief general explanation of the concept of a hook.  A fantastic tutorial concerning the use of hooks with MaxGUI events (including a full example) can be found here:<br><br><a href="http://www.2dgamecreators.com/maxgui/T15-Eventhooks.html" target="_blank">Tutorial 15: EventHooks</a> (Edit: This is the same one Jesse has posted.)<br><br>I hope this helps. <br><br></td></tr></table><br>
<a name="954456"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mark Tiffany</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> we really ought to get those maxgui tutorials added to the official maxgui package... <br><br></td></tr></table><br>
<a name="954486"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AdamRedwoods</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is it possible to extend EmitEventHook, so that you can create a new AddHook for exclusive id's, such as, MouseEventHook for mouse only events, or KeyEventHook for keyboard only events?<br><br>This way the function passed to AddHook doesn't need to check the id everytime? Or is it just good practice to check the ID all the time? <br><br></td></tr></table><br>
<a name="954597"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Naughty Alien</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> @SebHoll<br><br>Thank you A LOT..it was really useful post for me and I hope many other bmaxers...very nice...thanks guys..beautiful..i see use for this A LOT in my game.. <br><br></td></tr></table><br>
<a name="954641"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >degac</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> My stupidest example to understand (for me...) AddHookId, RunHooks ...<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Rem
	Personal Hook Function
End Rem
SuperStrict
'create a new EVENT HOOK (personal)
Global movemouse_eventhook:Int=AllocHookId()
'This Function will be automagically called every MovedMouse()
Function MyHook:Object( id:Int,data:Object,context:Object )
	Print "Mouse moved!!! "+CurrentTime()
End Function
'Add our hook to the system
AddHook movemouse_eventhook,MyHook
'Some simple graphics
Graphics 640,480,0
While Not KeyHit( KEY_ESCAPE )
	Cls
	DrawText MouseX()+","+MouseY(),0,0
	Flip
	If MouseMoved()
		RunHooks movemouse_eventhook,Null
	End If
Wend
Function MouseMoved:Int()
	Global oldx:Int,oldY:Int
	If MouseX()&lt;&gt;oldx And MouseY()&lt;&gt;oldy 
		oldx=MouseX()
		oldy=MouseY()
		Return 1
	End If
	Return 0	
End Function
</textarea><br>The (stupid) idea is: when you move the mouse Bmax creates an 'event' intercepeted by hook and run a specific function (myhook).<br>Of course in this example I could print mouse coordinates immediately in the MouseMoved() function...<br>Any better implementation?<br><br>I was thinking to different 'events' that can be useful to have out-of-the-box with BlitzMax, but at the moment I can think only to 'file-stream reading/writing/closing or copy/move a file events - Tprocess running/stopping...' (I don't know if these events can be useful or not...) <br><br></td></tr></table><br>
<a name="954692"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TaskMaster</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Careful hooking the MouseMove event.  The mouse can generate a crazy number of events in a very short time. <br><br></td></tr></table><br>
<a name="996781"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RustumScammell</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> @degac<br>Nice example! I think I finally understand hooks because of it! Yes!! I'd like to contribute a small correction though. The line:<br><pre class=code>If MouseX()&lt;&gt;oldx And MouseY()&lt;&gt;oldy</pre><br>in the function MouseMoved() should read:<br><pre class=code>If MouseX()&lt;&gt;oldx Or MouseY()&lt;&gt;oldy </pre><br>to allow for any movement along either the x-axis OR the y-axis. Once I changed this it worked like a charm! I'm on my way to making my own hook functions. Awesome! <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
