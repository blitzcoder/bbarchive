<!DOCTYPE html><html lang="en" ><head ><title >can't get basic mask to work</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >can't get basic mask to work</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=101" >BlitzMax Beginners Area</a>/<a href="#bottom" >can't get basic mask to work</a><br><br>
<a name="695838"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm, OK so in BlitzPlus if I had an image and it had a black background, I could set the mask colour to black and then when I drew it, all the pixels would be drawn except for the black ones, which were drawn as transparent.<br><br>I know I can achieve the same thing in BMax by having a proper png with transparency info and drawing it with SetBlend AlphaBlend, fine.<br><br>BUT, what if I have a bitmap with a black background that I don't want drawn, and I don't want to convert it into a png.  I've tried using SetMaskColor 0,0,0 and loading it with the MASKEDIMAGE flag, and then drawing with SOLIDBLEND, but that still draws the black.  Drawing with MASKBLEND looks horrible has it filters out all pixels &lt; 0.5 alpha, and I don't want to use AlphaBlend.  Any ideas what I'm doing wrong?  Maybe I'm misinterpreting how MASKEDIMAGE works and it doesn't work like BlitzPlus?  Thanks in advance. <br><br></td></tr></table><br>
<a name="695897"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >WendellM</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Playing with a non-alpha-ed PNG with a black background in BMax, I was able to get decent masking with both ALPHABLEND and MASKBLEND.  Are you not wanting to use either of these modes because you're wanting the image to have two different sets of mask/blend info at the same time that can be displayed separately (i.e. black mask and alpha)?  Otherwise a masked image works with either as long as it doesn't also have alpha information in it (is full alpha throughout). <br><br></td></tr></table><br>
<a name="695907"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TomToad</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> It has to do with the differences betwen the way DirectDraw(B+) and Direct3D(BMax) handle masking.  In DirectDraw, every time you draw an image, the pixels are examined to see if it matches the mask color.  If it matches, the pixel isn't drawn.  If it doesn't match, then the pixels are drawn.  In Direct3D, the alpha channel is examined.  When the alpha bit is greater than 0.5, then the pixel is drawn, otherwise it is masked.  When you load the image in BMax with the MASKEDIMAGE flag, BMax will examine the image and set it's alpha bit to 0 if it matches the SetMaskColor color.<br>If your image already has alpha information, then anything which matches the mask color, as well as anything with an alpha &lt;= 0.5 will be masked.  You either need to save the image without alpha information or make sure that anything you want to have drawn has an alpha &gt; 0.5. <br><br></td></tr></table><br>
<a name="695911"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Can you post the image as loading and drawing a bitmap image with the defaults (maskimage, mask colour 0,0,0 and<br>blend mode maskblend) works fine for me? <br><br></td></tr></table><br>
<a name="695937"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> hmm thanks for the info people.  It's true I'm using a png with an alpha channel already and a black area that I wanted not drawn.  I guess I could save it as a bmp and try again...I'm afraid I can't post the image as it would give away the game and I'm under an NDA.<br><br>Basically I have a png with alpha info, that I'm actually drawing with solid blend so the transparent areas come out dark.  But I'm moving it vertically and drawing a non-integer coords which gives a juddery effect on the edge of the image.  I discovered a while ago that adding an empty row of pixels around the edge of an image means it can anti-alias better when drawing at sub-pixel coords.  So I added a black row on the edge and hoped that SetMaskColor 0,0,0 with Solidblend would just not draw it, but it didn't and MaskBlend looked horrible due to the &lt;0.5 thing.  IT's not critical, I was just being picky.  May try as a bmp right now... <br><br></td></tr></table><br>
<a name="695941"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> yep that worked, saved as bmp and the black is now masked out.  Interestingly, when using SolidBlend it still juddered at the edges whereas using Alphablend it looked much more smooth (even though the image has no alpha info), weird...<br><br>It's worth noting that when you export a png as bmp in Gimp, it turns the transparent are into your current background colour (mine was white at first, so I changed it to black).<br><br>Now I'm going to try converting it back to png to save disk space and see if it still works...<br><br>Yep that totally work.  thanks all. <br><br></td></tr></table><br>
<a name="695975"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> The main difference between BM masking and Blitz3d / BB+ is that the later two didn't support alpha as directDraw does not ... and BM does.<br><br>Originally, masking worked as with those two in BM as well ... but with 1.14 or 1.16 it was changed so alpha was taken into account as well. <br><br></td></tr></table><br>
<a name="696001"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah I knew BPlus couldn't do alpha support which is why I changed to BMax (one of the main reasons). I was just trying to get my drawing to work in that old way for a specific purpose and finally got it sorted. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
