<!DOCTYPE html><html lang="en" ><head ><title >Plash: duct.mod shader error</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Plash: duct.mod shader error</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=101" >BlitzMax Beginners Area</a>/<a href="#bottom" >Plash: duct.mod shader error</a><br><br>
<a name="995360"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xlsior</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I came across duct.mod the other day, which includes the interesting looking protog2d.mod which supposedly has some 2D shaders for Blitzmax.<br>URL: <a href="http://www.komiga.com/?q=node/25" target="_blank">http://www.komiga.com/?q=node/25</a><br><br>However, attempting to run the enclosed shaders example, it consistently errors out on compiling the blur.glsl shader:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Building shaders
Compiling:shaders.bmx
flat assembler  version 1.68  (1016274 kilobytes memory)
3 passes, 22469 bytes.
Linking:shaders.debug.exe
Executing:shaders.debug.exe
Shader source:
1:	// Shader header
2:	//@common
3:	#version 120
4:	#extension GL_ARB_texture_rectangle : enable
5:	
6:	uniform vec2 p2d_windowsize;
7:	uniform vec2 p2d_viewportposition;
8:	uniform sampler2DRect p2d_rendertexture;
9:	uniform vec2 p2d_viewportsize;
10:	
11:	//@fragment
12:	vec2 blurscale = vec2(2.0, 2.0);
13:	
14:	//float blurfactors[15] = float[15](0.0044, 0.0115, 0.0257, 0.0488, 0.0799, 0.1133, 0.1394, 0.1494, 0.1394, 0.1133, 0.0799, 0.0488, 0.0257, 0.0115, 0.0044);
15:	9
16:	4
17:	,
18:	 
19:	0
20:	.
21:	1
22:	3
23:	9
24:	4
25:	,
26:	 
27:	0
28:	.
29:	1
30:	1
31:	3
32:	3
33:	,
34:	 
35:	0
36:	.
37:	0
38:	7
39:	9
40:	9
41:	,
42:	 
43:	0
44:	.
45:	0
46:	4
47:	8
48:	8
49:	,
50:	 
51:	0
52:	.
53:	0
54:	2
55:	5
56:	7
57:	,
58:	 
59:	0
60:	.
61:	0
62:	1
63:	1
64:	5
65:	,
66:	 
67:	0
68:	.
69:	0
70:	0
71:	4
72:	4
73:	)
74:	;
75:		0.1394,
76:		0.Kˇ#cdH
77:	ˆ&amp;#152;oˆ¿§J
78:	
79:	
80:	
81:	&amp;#128;ù
82:	
83:	
84:	/
85:	/
86:	f
87:	l
88:	o
89:	a
90:	t
91:	 
92:	b
93:	l
94:	u
95:	r
96:	f
97:	a
98:	c
99:	t
100:	o
101:	r
102:	s
103:	[
104:	1
105:	5
106:	]
107:	 
108:	=
109:	 
110:	f
111:	l
112:	o
113:	a
114:	t
115:	[
116:	1
117:	5
118:	]
119:	(
120:	0
121:	.
122:	0
123:	0
124:	4
125:	4
126:	,
127:	 
128:	0
129:	.
130:	0
131:	1
132:	1
133:	5
134:	,
135:	 
136:	0
137:	.
138:	0
139:	2
140:	5
141:	7
142:	,
143:	 
144:	0
145:	.
146:	0
147:	4
148:	8
149:	8
150:	,
151:	 
152:	0
153:	.
154:	0
155:	7
156:	9
157:	9
158:	,
159:	 
160:	0
161:	.
162:	1
163:	1
164:	3
165:	3
166:	,
167:	 
168:	0
169:	.
170:	1
171:	3
172:	9
173:	4
174:	,
175:	 
176:	0
177:	.
178:	1
179:	4
180:	9
181:	4
182:	,
183:	 
184:	0
185:	.
186:	1
187:	3
188:	9
189:	4
190:	,
191:	 
192:	0
193:	.
194:	1
195:	1
196:	3
197:	3
198:	,
199:	 
200:	0
201:	
202:	
203:	
204:	
205:	
206:	
207:	
208:	
209:	
210:	
211:	
212:	
213:	
214:	
215:	
216:	
217:	
218:	
219:	
220:	
221:	
222:	
223:	
224:	
225:	
226:	
227:	
228:	
229:	
230:	
231:	
232:	
233:	
234:	
235:	
236:	
DebugLog:Exception caught: 
(TShaderAssist.CompileShader) Failed to compile shader
Infolog:
Fragment shader failed to compile with the following errors:
ERROR: 0:15: error(#132) Syntax error: '9' parse error
ERROR: error(#273) 1 compilation errors.  No code generated
</textarea><br><br>It seems like the enclosed blur.glsl is somehow broken, but looking at it I have no idea what the problem would be.<br><br>Plash? Anyone? <br><br></td></tr></table><br>
<a name="995769"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >CyBeRGoth</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> You are lucky to get that far, I still can't get the module to compile :P <br><br></td></tr></table><br>
<a name="995785"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I couldn't get it to compile the modules either, gave up, couldn't be bothered. <br><br></td></tr></table><br>
<a name="995792"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xlsior</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Heh.<br><br>Compiling the actual module was no problem at all, no errors there... Just bombs out the shader.bmx example with the error above when I try to run it.<br><br>The others (like the text alignment one) work OK. <br><br></td></tr></table><br>
<a name="995828"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jkrankie</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> The modules compile, but you have a dependency on one of Noels modules that isn't explained. Shaders worked fine on my dev box.<br><br>Cheers<br>Charlie <br><br></td></tr></table><br>
<a name="995853"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yah I noticed that, couldn't be bothered/didn't want to install his modules as well. Oh well. Doesn't the error code clue you into something? <br><br></td></tr></table><br>
<a name="995870"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >plash</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yikes! I've had this issue come up a few times before..<br>I don't know whether it's OpenGL freaking out because of the line-endings or simply the module not setting up the shader correctly.<br><br>I'll look into it..<br><br><div class="quote"> The modules compile, but you have a dependency on one of Noels modules that isn't explained. <br></div>That is correct. Keep in mind the entire duct branch is no where near complete, and I have not had to deal with issues other developers have had with it.. because it's been just me up until this point.<br><br>EDIT: I don't check the forums so often anymore, so if you'd like to get ahold of me faster (I only knew of this thread by reference from Noel), hop on irc.blitzed.org/#blitzbasic. <br><br></td></tr></table><br>
<a name="995871"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xlsior</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I'll look into it.. <br></div><br><br>Thanks.<br><br>Oh, one other thing I'm wondering: What happens if you're trying to call one of those shader functions on a card that doesn't support shaders? Does it fail gracefully, or blow up?<br><br>Is it possible to check in advance whether or not a card supports shaders before trying to call them? <br><br></td></tr></table><br>
<a name="995874"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >plash</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Oh, one other thing I'm wondering: What happens if you're trying to call one of those shader functions on a card that doesn't support shaders? Does it fail gracefully, or blow up? <br></div>It'll likely blow up. There is not much error-checking in Protog2D.<br><br><div class="quote"> Is it possible to check in advance whether or not a card supports shaders before trying to call them? <br></div>Pretty sure that's possible.. I'll look into that too. <br><br></td></tr></table><br>
<a name="995895"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >plash</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well.. I'm not really sure what to do about the shader 'issue'. I cannot reproduce it on my machine, but I <b>do</b> recall having to fix this in the past.<br>Also, I think OpenGL gets cocky about line endings in shaders (particularly if you stick a bunch of empty lines at the end of the source).<br><br>@xlsior: What OS are you testing it on?<br>I'm pretty sure OpenGL on Linux doesn't accept a shader program without both the vertex and the fragment shaders present (Protog2D currently only works with fragment shaders, due to some strange view matrix issues [I think that's the issue anyhow]).<br><br>Could you try this in place of blur.glsl (make sure to clear the entire file before pasting)?<br><pre class=code>//@fragment
vec2 blurscale = vec2(2.0, 2.0);
float blurfactors[15] = float[15](0.0044, 0.0115, 0.0257, 0.0488, 0.0799, 0.1133, 0.1394, 0.1494, 0.1394, 0.1133, 0.0799, 0.0488, 0.0257, 0.0115, 0.0044);

void main() {
	vec4 color = vec4(0.0);
	for(int i = 0; i &lt; 15; ++i) {
		vec2 tc = min(gl_TexCoord[0].st + blurscale * float(i - 7), p2d_viewportsize);
		color += texture2DRect(p2d_rendertexture, tc) * blurfactors[i];
	}
	gl_FragColor = color;
}</pre> <br><br></td></tr></table><br>
<a name="995916"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xlsior</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> @xlsior: What OS are you testing it on? <br></div><br><br>Windows 7 64 bit, with ATI Radeon HD4670 video card.<br><br>After trying the blur.glsl you mention above, I no longer get the original error, but now get this instead:<br><br><div class="quote"> Executing:shaders.debug.exe<br>DebugLog:1<br>DebugLog:Exception caught: <br>(TShaderAssist.LinkProgram) Failed to link program<br>Infolog:<br>Fragment shader(s) failed to link, no vertex shader(s) defined. <br>ERROR: error(#280) Not all shaders have valid object code <br></div><br><br>Are you sure that the other files on the repository are the latest versions as well? <br><br></td></tr></table><br>
<a name="995967"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >plash</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> After trying the blur.glsl you mention above, I no longer get the original error, but now get this instead <br></div>Interesting. It runs fine on XP, but not on Linux (same error you get).<br>I disabled vertex shaders because they were messing up the entire render.. I think it had something to do with the projection matrix in OpenGL getting all mangled up.<br><br><div class="quote"> Are you sure that the other files on the repository are the latest versions as well? <br></div>Yes.<br><br>I guess I'll have to try getting vertex shaders working again. <br><br></td></tr></table><br>
<a name="996066"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >plash</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Righto. I think I got it working now (it's working in Linux at least)..<br>Pull the repo again or amend the changes yourself: <a href="http://github.com/komiga/duct/commit/11dd900efea8ff90d1f918eddfa906672636fcd8" target="_blank">http://github.com/komiga/duct/commit/11dd900efea8ff90d1f918eddfa906672636fcd8</a><br><br>EDIT: Oh yeah, the blur shader was sorta stolen from Max3D, and it does this strange tearing in the bottom-left corner of the screen.. <br><br></td></tr></table><br>
<a name="996070"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xlsior</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, looks like that did the trick, it's running now!<br><br><div class="quote"> EDIT: Oh yeah, the blur shader was sorta stolen from Max3D, and it does this strange tearing in the bottom-left corner of the screen..  <br></div><br><br>It has bigger problems than that -- there a lot of tiny glitches throughout the screen, but most of them are very small. The bottom left one is just the most obvious one of all... But the other two shaders do seem to work great without any weirdness. Very nice!<br><br>There currently isn't a way to verify beforehand that shaders are indeed supported on the video card, correct? <br><br></td></tr></table><br>
<a name="996074"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >plash</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> There currently isn't a way to verify beforehand that shaders are indeed supported on the video card, correct? <br></div>Ah yes, this..<br>I'm pretty certain the GL_ARB_vertex_shader, GL_ARB_fragment_shader and GL_ARB_shading_language_### (e.g. 100, 110, 120, etc.) constants (in pub.glew) can be used to check for shader support.<br><br>EDIT: But I have not implemented it yet.<br>EDIT2: They're not actually constants btw, they're just globals initiated by GLEW. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
