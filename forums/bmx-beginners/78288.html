<!DOCTYPE html><html lang="en" ><head ><title >Pixmap Difficulties</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Pixmap Difficulties</h1><a href="forums.php" >Archives Forums</a>/<a href="topics.php?forum=105" >BlitzMax Bug Reports</a>/<a href="#bottom" >Pixmap Difficulties</a><br><br>
<a name="877947"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mordax_Praetorian</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've been having difficulties with Pixmaps in my game engine, so I decided to try isolating different parts of the code to figure out what was causing it<br><br>the following does nothing (I get a black window):<br><pre class=code>
Graphics(800,600,0,0)
TestPix:TPixmap=CreatePixmap(15,15,PF_RGBA8888)
White% = (255 Shl 24)|(255 Shl 16)|(255 Shl 8)|255
Black% = (0 Shl 24)|(0 Shl 16)|(0 Shl 8)|0
For X = 0 To 14
	For Y = 0 To 14
		WritePixel(TestPix,X,Y,Black)
	Next
Next
WritePixel(TestPix,0,0,White)
WritePixel(TestPix,0,14,White)
WritePixel(TestPix,14,0,White)
WritePixel(TestPix,14,14,White)
DrawPixmap(TestPix,200,200)
Flip
Delay(4000)
</pre><br><br>This makes no sense to me, there should be 4 white pixels there and there arent<br><br>The documentation is as always, utterly useless<br><br>What is the deal with pixmaps? how do I get them to actually show up? what is the mysterious command that I'm somehow missing here? <br><br></td></tr></table><br>
<a name="877953"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jesse</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> it works fine here:<br>windows xp sp2 <br>AMD Athlon 64 x2 dual 4200+<br>Nvidia GeForce 7300GT<br>Bmax 1.28<br><br>what is your system specs? <br><br></td></tr></table><br>
<a name="877956"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mordax_Praetorian</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm on:<br><br>Windows Vista Sp1 (No I don't like it and I'm saving up for an XP CD)<br>Intel Core2 Duo<br>NVIDIA GeForce 8600M<br>Bmax 1.28 <br><br></td></tr></table><br>
<a name="877958"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jesse</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> to be honest, I think, even though I don't like it either, BRL needs to do something about this or we will be programming a dinosaur pretty soon. :-). <br>And I don't think the next operating system is going to make it any easier either. <br><br></td></tr></table><br>
<a name="877959"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mordax_Praetorian</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, so Pixmaps don't work on Vista?<br><br>Can I get around this by making them into images after construction? <br><br></td></tr></table><br>
<a name="877960"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jesse</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> . <br><br></td></tr></table><br>
<a name="877961"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jesse</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> you can allways try.<br>image:timage = loadimage(pixmap:tpixmap) <br><br></td></tr></table><br>
<a name="877962"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mordax_Praetorian</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I suppose, thankyou for the help<br><br>I envy other countries where XP is still the norm, but its nearly impossible to get a new comp with it in this country anymore<br><br>Sadly since I'm mostly programming with other people in my country and will likely have an initial player base comming mostly from here, I must keep Vista in mind <br><br></td></tr></table><br>
<a name="878000"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Azathoth</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Using PF_BGRA8888 gets it working here <br><br></td></tr></table><br>
<a name="878123"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TomToad</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Interesting.  Azathoth, what OS are you using?<br>I'm using Vista sp1 and PF_RGBA8888 isn't working but PF_BGRA8888 is working.<br>But I am also using a GeForce 8800 GT.  I've noticed that those who are not getting it to work are all using 8000 series GeForce cards.<br>Fact is, BMax is still using DirectX 7, possibly 8000+ cards are not fully compatible with it.<br>The only way to tell is to try it on Vista machines with other cards (ATI and &lt; 8000 NVidias) and also try it on non-vista machines with 8000+ cards. <br><br></td></tr></table><br>
<a name="878135"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >grable</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have an 8800GT and using XP SP2, both pixel formats work for me. <br><br></td></tr></table><br>
<a name="878145"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SebHoll</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've just tried on my Vista x86 PC, which has a nVidia 7600GTS Go graphics card. Works perfectly when using OpenGL, but DirectX doesn't work - it seems as though the pixmap isn't drawn. <br><br></td></tr></table><br>
<a name="878146"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dawlane</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> PF_RGBA8888 doesn't work here, but PF_BGRA8888 does. But using GLMax2DDriver with PF_RGBA8888 works.<br>It could be a DirectX/Driver issue.<br><br><div class="quote"> Fact is, BMax is still using DirectX 7, possibly 8000+ cards are not fully compatible with it. <br></div><br>I had a game quite a few years ago that worked well with DX5/6 but screwed the sound up something terrible when used with DX7. MS have a habbit of breaking Directx once in a while.<br><br>OS Vista Ultimate 32bit<br>nVidia 8800 Ultra<br>Current Driver is 175.16<br>DirextX 10 <br><br></td></tr></table><br>
<a name="878155"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SebHoll</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've stepped through the code and it's the...<br><br><pre class=code>surf.GetDC(srcdc)</pre>...in <i>d3d7max2d.bmx</i> which seems to be causing the trouble as it is giving simply 0 as the DC for alpha pixmaps.<br><br>Although it seems that Microsoft have removed a lot of their DirectX 7 docs from MSDN, the following page refers to the DirectX 9 equivalent:<br><br><a href="http://msdn.microsoft.com/en-us/library/bb205894(VS.85).aspx" target="_blank">http://msdn.microsoft.com/en-us/library/bb205894(VS.85).aspx</a><br><br>This might be our problem:<br><div class="quote"> Formats that contain Alpha are not supported because the GDI implementations don't have a well-defined behavior on the alpha channel. <br></div><br>Although, that doesn't really explain why it's working on Windows XP but not Vista. <br><br></td></tr></table><br>
<a name="878245"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mordax_Praetorian</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Perhapse something to do with DX10 which XP (as far as I'm aware) doesn't support? <br><br></td></tr></table><br>
<a name="879046"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yahfree</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> works for me..<br><br>NVIDIA 9600 GT Video card, windows XP OS, P4 3GHz processer <br><br></td></tr></table><br>
<a name="978465"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >impixi</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've just encountered this bug myself (or something similar). Vista (64bit), Nvidia GeForce GTS 250, latest certified drivers. BlitzMax 133rc5.<br><br>DrawPixmap fails to display anything in DirectX but works as expected in OpenGL.<br><br>Example:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
SuperStrict

'SetGraphicsDriver GLMax2DDriver()	
SetGraphicsDriver D3D7Max2DDriver()

Graphics 1024, 768

Local pm:TPixmap = CreateSamplePixmap() 

'Local img:TImage	 = LoadImage(pm)		

While Not KeyHit(KEY_ESCAPE)

	Cls
	
	DrawPixmap pm, 0, 0
	
	'DrawImage img, 0, 0
	
	Flip

Wend

End


Function CreateSamplePixmap:TPixmap()

	Local pm:TPixmap = CreatePixmap(256, 256, PF_RGB888)
	
	Local r:Byte, g:Byte, b:Byte, x:Int, y:Int
	
	For x = 0 Until pm.width
		For y = 0 Until pm.height
			r = Rand(0, 255)
			g = Rand(0, 255)
			b = Rand(0, 255)
			WritePixel pm, x, y, Int((r Shl 16) | (g Shl 8) | b)
		Next
	Next
	
	Return pm

EndFunction
</textarea><br><br>The workaround is to load the pixmap into an image and use drawimage instead of drawpixmap. <br><br></td></tr></table><br>
<a name="978475"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_Skully</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> or...<br><br><pre class=code>
Graphics(800,600,0,0)
Global img:TImage=CreateImage(15,15,,DynamicIMAGE|maskedimage)   
TestPix:TPixmap=CreatePixmap(15,15,PF_RGBA8888)
White% = (255 Shl 24)|(255 Shl 16)|(255 Shl 8)|255
Black% = (0 Shl 24)|(0 Shl 16)|(0 Shl 8)|0
For X = 0 To 14
	For Y = 0 To 14
		WritePixel(TestPix,X,Y,black)
	Next
Next
WritePixel(TestPix,0,0,White)
WritePixel(TestPix,0,14,White)
WritePixel(TestPix,14,0,White)
WritePixel(TestPix,14,14,White)

DrawPixmap(TestPix,200,200)
img.SetPixmap(0,testpix)
DrawImage img,216,200

Flip
Delay(4000)
</pre><br><br>setpixmap might be faster than loadimage...<br><br>I only get the right hand box... vista <br><br></td></tr></table><br>
<a name="978477"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't recommend using DrawPixmap anyway. It's generally very slow in OpenGL because of the way drivers implement glDrawPixels.<br><br>DrawImage FTW :-p <br><br></td></tr></table><br>
<a name="978479"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >impixi</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> I agree Brucey, but DrawPixmap is a BlitzMax command and it should perform error-free in all cases. Personally, I'd never use it for performance-critical applications, either. :) <br><br></td></tr></table><br>
<a name="978486"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> I google search reveals people have all kinds of issues using glDrawPixels() on different hardware. The same code will work on one card, but not on another...<br><br>eg.<br><br><a href="http://stackoverflow.com/questions/25646/what-could-prevent-opengl-gldrawpixels-from-working-on-some-video-cards" target="_blank">http://stackoverflow.com/questions/25646/what-could-prevent-opengl-gldrawpixels-from-working-on-some-video-cards</a> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
