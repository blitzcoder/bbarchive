<!DOCTYPE html><html lang="en" ><head ><title >Are images kept when you EndGraphics and reopen?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Are images kept when you EndGraphics and reopen?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=101" >BlitzMax Beginners Area</a>/<a href="#bottom" >Are images kept when you EndGraphics and reopen?</a><br><br>
<a name="921723"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Quick question about the graphics context keeping images in video ram between close and open ..... does it work now? If I do EndGraphics or CloseGraphics and then do GLGraphics or Graphics afterwards, are the Images I was using still in video ram and useable by OpenGL or do I have to reupload them all? Wasn't there some bug with this? Was it fixed? What is the correct method to shut a screen down and reopen it (perhaps switching to a window and back) without losing the loaded images? <br><br></td></tr></table><br>
<a name="921745"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >verfum</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> All graphics are derived from a built in Blitz base class called Object, so I would imagine it would have it's own de-constructor which is initialised on termination, so everything derived from Object would also be de-constructed when EndGraphics is called.<br><br>That's my guess anyways. <br><br></td></tr></table><br>
<a name="921771"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MGE</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> In my game to switch from window/full and back again, I make a call to EndGraphics() and then create the new screen using Graphics(). I do not have to load media again. However, I'm using Dx and do not go back and forth between dx/opengl, etc, etc. I would guess as long as you're not switching graphics drivers you don't have to reload your media. <br><br></td></tr></table><br>
<a name="921805"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks. Anyone else have a difinitive tested answer? It sounds from what you said MGE that the graphics are kept in memory. I suppose this is one of those things I'll just have to test myself. I thought there was some issue with this not working properly a while ago, like some images would get corrupted or turn into white squares? <br><br></td></tr></table><br>
<a name="921807"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >plash</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="/posts.php?topic=81359" target="_blank">Blobulos</a> has the option for changing the graphics driver (and resolution), neither require reloading any media. <br><br></td></tr></table><br>
<a name="921812"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jkrankie</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Bullet Candy doesn't reload images after a graphics mode change and it doesn't seem to have any adverse affect.<br><br>Cheers<br>Charlie <br><br></td></tr></table><br>
<a name="921822"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >orgos</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> To enable and disable the full screen and windows mode, you can reinitialize the Graphic mode and in respective way 0-&gt; Windows Mode 16, 24, 32 -&gt; FullScreen, and other the representation of sprites or others goes normal. <br><br></td></tr></table><br>
<a name="921904"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ahh good, so it sounds like everything is working correctly now. That's nice to know. I thought maybe it was based on the graphics `context` object, like when getting the canvasgraphics object in maxgui? ie if you free the context, would it not lose everything? <br><br></td></tr></table><br>
<a name="921923"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dmaz</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> they stay in main memory in case the display context is lost.  you do not have to reload any of images but when the display context is lost they will need to be pushed back to vram.  now this is usually not a concern especially in blitz because it's automatic.  if you have a lot of media that you need on the card you may want to pre-stage it (again).  there have been topics on this site that discussed doing this at start up.  it would be the same for these switches. <br><br></td></tr></table><br>
<a name="921937"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay so at what point and under what conditions do the graphics gets flushed from video ram? If a person is writing custom GL code they need to know when to upload textures to video ram, and whether they will stay there between screen changes. What you wrote suggests they are no longer in video ram after a screen close? <br><br></td></tr></table><br>
<a name="921953"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dmaz</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> ok, I guess I'm just speaking from Direct experience but I would assume that opengl has to be the same...  the graphics will get flushed by either a loss of it's display or even by some other graphics, possibly another app pushing it out.  you would get a draw failure when this would happen or even a message... now again, this is DX and just dx7 maybe 8 at that.  I haven't done anything beside Blitz since 01 so this might all be different now so forget what I said ;) <br><br></td></tr></table><br>
<a name="921954"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >plash</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> I suppose we could test this by loading your media then ending the graphics for a good while before opening it again (with different resolution/driver/fullscreen-windowed). <br><br></td></tr></table><br>
<a name="922085"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MGE</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Regarding DX mode. (I don't use OGL) I've tested this 100's of times in my game framework. You only lose device in full screen mode when someone presses the windows button or another program pops up. But... the graphics are stored in system ram, so only the device is lost, and recovered automagically via bmax code. The textures do not need to be loaded again, but the gpu does copy from system ram back into vram when the device is restored. This is via the "managed" flag set by the internal code that loads textures. I think older versions of the code loaded directly into vram only, causing the need to re-load when a device was lost. <br><br></td></tr></table><br>
<a name="922110"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Interesting. <br><br>Plash - I don't think I'd feel comfortable with ever assuming that the graphics will be around `on the offchance` that they didn't get flushed out by some other application. Waiting a given period of time shouldn't even be considered, either we need to know that the graphics definitely are `officially` there and we're pointing to them and controlling them still, or they have been released and we can't trust that they'll still be there.<br><br>MGE - The gpu does not copy texture data from main memory to video memory, it doesn't have access to main memory at all, it's the CPU which copies from main memory into video memory so that the gpu can see it. This is perhaps part of how Max2D is set up to work - it keeps the image as a pixmap in main memory even after it's been uploaded to video ram, so that if the time comes to need to re-upload it it's already in main memory and doesn't have to be loaded from disk. But even if it's doing that, that doesn't mean the video-ram texture is being kept inbetween screen changes. That's mainly what I'm asking, do I need to re-transfer images to video memory after reopening a screen.<br><br>I think I will just do a little test, opening a screen, loading a pixmap, uploading it to an OpenGL texture (bypassing Max2D), rendering it, closing the screen, reopening the screen and then see what happens when i try to render the texture. But then... that may not prove it if the graphics are just hanging around in video ram due to another app not flushing them out. I'd like to know from Blitz's perspective whether it lets go of opengl state when the screen is closed. <br><br></td></tr></table><br>
<a name="922121"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MGE</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> oops.....I should have said the D3D Driver loads the data back into vram as needed. This is why you can load all of your textures at the start of the game and have the D3D driver swap from sram to vram as needed. One of the nice things of "managed" texture usage. The only drawback is if you don't pre-cache what you need at the start of a level, etc,etc, you will see some stuttering as the game pulls from sram into vram. <br><br></td></tr></table><br>
<a name="922129"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jesse</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have done some test in my machine, where I load the images before I set the graphics mode/driver and it works fine with DX and OGL. My conclusion is that all data is kept in RAM and fed to the GPU as needed but, it might not be the same on all computers.<br><pre class=code>
s:timage = LoadImage("spif.png")
SetGraphicsDriver GLMax2DDriver()
Graphics 800,600
DrawImage s,100,100
Flip()
WaitKey()
</pre> <br><br></td></tr></table><br>
<a name="922139"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> bit late in replying but my framework switches from full to windowed and DX to GL and the gfx are never lost.  They are kept in RAM and will be re-uploaded to VRAM automatically by Blitz, even after and Alt+Tab or whatever (this used to crash but was fixed a while back) <br><br></td></tr></table><br>
<a name="922216"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dmaz</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> yep, that's what I said.  ;) <br><br></td></tr></table><br>
<a name="922419"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> well I'm happy to add weight to that then ;-) <br><br></td></tr></table><br>
<a name="922459"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MGE</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> Interesting! Because technically when loading a texture via DX7 they are stored in system memory and then pooled into the vram when needed. This is the "managed texture" flag being set when the texture is created. <br><br>If we can create TImages regardless of graphics driver being used, then Blitzmax must be storing the (TImage) data in a format that can be used or copied to internally created DX or OpenGL surfaces. Which leads me to think there must be 2 copies of every texture in memory then? One for Blitzmax (pixmaps?) , one for managed DX (textures). <br><br>? ? ? <br><br></td></tr></table><br>
<a name="922498"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yah it refers to them as frames, where it stores the pixmap and occasionally uploads it as a texture. That's also how it deals with locking the image, I am guessing - ie it doesn't re-download the texture into a pixmap, it just uses the pixmap that it has stored, lets it be edited, and reuploads it as a texture when you unlock the image.<br><br>Anyway, thanks for all your input guys. However we've veered slightly off track from what I wanted to know.<br><br>I don't need to know how BlitzMax handles textures via Max2D. I know already that it keeps them in pixmaps and reuploads them as textures *at some point*. My question is, if you are not using Max2D and are writing your own OpenGL code to upload textures, at what point is it necessary to re-upload from main memory to video ram? You can't say that Blitz handles it for you because I'm not talking about using Max2D.<br><br>Let's say you skip Max2D altogether, you load image data into a memory bank, then you create a texture handle in OpenGL, then you upload the memory bank to the texture with something glTexImage2D(). The data is copied from the memory bank to a video ram `texure` within the OpenGL system. The question now arises - if I close the screen, close the graphics object, switch to a windowed display, or close the windowed display, am I going to need to re-upload from the memory bank to the texture? Does it lose any data? Does it lose only the texture data? Does all OpenGL state get lost when you close the screen/window? <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
