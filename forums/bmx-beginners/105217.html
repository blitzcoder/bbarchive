<!DOCTYPE html><html lang="en" ><head ><title >My Classic 2D-Tile-Map-Editor</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >My Classic 2D-Tile-Map-Editor</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=101" >BlitzMax Beginners Area</a>/<a href="#bottom" >My Classic 2D-Tile-Map-Editor</a><br><br>
<a name="1280459"></a>

<a name="1280460"></a>

<a name="1280461"></a>

<a name="1280462"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SidAntic</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I still working on my oldschool 2D-Tile-Editor, a little tool to create 2D-Tile-Based Level-Maps including a little Tile-Paint-Application, so I can change any Tile Images on the fly. The main layout (amout of Tiles ... Colors) is inspired by the NES system. One Tile-Set (256 Tiles) for Background-Tiles, and another Tile-Set (256 Tiles) for Sprite-Objects. The Tile dimensions are 8x8 Pixel. Later I will add an Sprite-Paint-Animation Tool, and a special Layer for editing and positioning movable Objects.<br> <br>I look forward for any kind of comments :)<br><br>Every Day I will upload a updated Version on my webspace.<br>(source-code and all Data)<br><br>Some parts of my source-code are little bit chaotic.<br><br><a href="http://www.axgs.de/blitzmax/MapEditor.zip" target="_blank">http://www.axgs.de/blitzmax/MapEditor.zip</a><br><br>Happy Coding :)<br>Alex <br><br></td></tr></table><br>
<a name="1280564"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SidAntic</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I made some major changes. slowly it goes forward. <br><br>:)<br><br><br><a href="http://www.axgs.de/blitzmax/MapEditor.zip" target="_blank">http://www.axgs.de/blitzmax/MapEditor.zip</a> <br><br></td></tr></table><br>
<a name="1280740"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dan</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Not Found<br>The requested URL /blitzmax/MapEditor.zip was not found on this server.<br><br>^^; <br><br></td></tr></table><br>
<a name="1280756"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SidAntic</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh sorry,<br>so I restored the download.<br><br>Not all features are implemented yet, but tile-paint works (only with pixel), load/saving <br>Map &amp; Tile Data into one file.<br><br><a href="http://www.axgs.de/blitzmax/MapEditor.zip" target="_blank">http://www.axgs.de/blitzmax/MapEditor.zip</a> <br><br>Alex <br><br></td></tr></table><br>
<a name="1280765"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> As I always say, you can never have too many global variables :-) <br><br></td></tr></table><br>
<a name="1280768"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SidAntic</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I know, global variables is a bad coding style :)<br><br>perhaps I fix this and make my Code more object-orientated. <br><br></td></tr></table><br>
<a name="1280770"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SidAntic</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I killed some global vars .... yuhu<br><br>I made a Type (Class)  for the Map-Data itself ... and some methods to operate with the map-data.<br><br><a href="http://www.axgs.de/blitzmax/MapEditor.zip" target="_blank">http://www.axgs.de/blitzmax/MapEditor.zip</a> <br><br></td></tr></table><br>
<a name="1280771"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SidAntic</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> thanks Brucey for the hint.<br><br>The Code is much cleaner !!!<br><br>Friendly Greetings<br>Alex <br><br></td></tr></table><br>
<a name="1280772"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Heh,<br><br>I've tried it on debian8, win7 and win10 and they all take over a second to 'refresh' the tile under the mouse. The mouse pointer is fluid but the tile updating under the mouse is dog slow :/<br><br>Looks like the beginnings of a cool little editor :^) <br><br></td></tr></table><br>
<a name="1280774"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SidAntic</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> on my machine it is not slow (win 8.1)<br><br>I only have a intel g3220 CPU (very cheap one) and only Intel-HD GFX Onboard. <br><br></td></tr></table><br>
<a name="1280780"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Programming is fun isn't it. Works ok on one machine and not on another :D<br><br>Both computers here ( asus nv56z with debian and win10 and the other custom machine with an i5 that has win7 ) have nvidia gpus, the laptop has a gt650m and the box has a gtx750. They have the latest gpu drivers etc. Strange eh. <br><br></td></tr></table><br>
<a name="1280804"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Your DrawTile() function uses DrawPixmap(), which is exceptionally slow at rendering.<br><br>On my 2.7 Ghz i7, it spends on average 55ms in your DrawTile() function alone. To run at 60fps, you generally expect the *whole* frame rendering to be performed in well under 16.6ms. <br><br></td></tr></table><br>
<a name="1280828"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SidAntic</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> I am little bit confused.<br><br>On my Intel g3220 (dualcore 3.0 Ghz CPU) the mainloop takes 16 - 22 ms.<br><br>On my Latop Intel i3 = max, 22 ms<br><br>hhhmmmmmmmmm. I Dont know. <br><br></td></tr></table><br>
<a name="1280829"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SidAntic</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> I set my Build-Options to "non-Debug", with Debug it takes 100 ms. <br><br></td></tr></table><br>
<a name="1280830"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SidAntic</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> I never use Debug-Build. <br><br></td></tr></table><br>
<a name="1280832"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JBR</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Same speed here. Takes over 1000ms. i7cpu <br><br></td></tr></table><br>
<a name="1280833"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Without a doubt the problem will be the use of drawing pixmaps. If you can convert to using TImage(s) then all will be good. <br><br></td></tr></table><br>
<a name="1280834"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SidAntic</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> and how I can write a Pixel to an Offscreen Image, I found no solution. <br><br></td></tr></table><br>
<a name="1280835"></a>

<a name="1280836"></a>

<a name="1280837"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SidAntic</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> I set my Flip() Statement to Flip(0) and the mainloop runs at 9 ms, with DrawPixMap.<br>I have no performance problem. <br><br></td></tr></table><br>
<a name="1280838"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I have no performance problem. <br></div><br>DrawPixmap is notorious for really (really) poor performance on different GPUs. One card may be fine, the next it is terrible. Therefore, use something other than DrawPixmap. <br><br></td></tr></table><br>
<a name="1280839"></a>

<a name="1280840"></a>

<a name="1280841"></a>

<a name="1280842"></a>

<a name="1280846"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>and how I can write a Pixel to an Offscreen Image, I found no solution. <br> <br></div><br><br>There's always a solution ;-)<br><br>Let's first start with the underlying mechanics of TPixmap and TImage...<br><br>A TImage represents a handle to a gpu texture. The inital underlying pixel data of a TImage would have come from a TPixmap. Even with LoadImage then pixel data is loaded as TPixmap. When it comes to drawing a TImage for the first time then the TPixmap is converted and uploaded to the gpu - giving the TImage a gpu texture handle. Any successive drawing of the TImage will then merely set the gpu to use that already now existing texture to be rendered.<br><br>Moving on to the TPixmap...<br>A TPixmap is cpu side memory to represent pixels of an image. They are fast to manipulate with cpu code but cannot be used by the gpu without being converted to a gpu texture ( as above ) - in fact they are the best way to create you own custom images, as you are doing in your editor. Now, each time you use DrawPixmap then the whole process of converting, creating and sending pixel data to gpu to create a texture to be rendered has to be done. Multiplying that process by any amount gives a significant speed loss.<br><br>Knowing that information...<br>A solution would then be to use TPixmap only for actually manipulating pixel data, but then use DrawImage to draw everything. I've not looked at your code so I don't where you would make changes to take advantage of my suggestion. I don't mean for you to convert every TPixmap to a TImage every frame, but only convert the single TPixmap that has been changed during that frame. Everything else on screen would then be drawn using TImages.<br><br>I believe you can use LoadImage(myPixmap,....) to quickly get a TImage from a TPixmap, then you can use DrawImage to render it each frame. <br>Once you work out a clean method using the suggestion above then that 9ms will become 0ms - and probably very close to ( if not ) 0ms for everyone else too. <br><br></td></tr></table><br>
<a name="1280843"></a>

<a name="1280844"></a>

<a name="1280845"></a>

<a name="1280847"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SidAntic</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> I took a look into the Modules-Source (that I never done before) ... and I saw that the TImage Type has a member of "pixmaps".<br><br>My solution is following:<br><br> LockImage(tileImg)<br>   WritePixel(tileImg.pixmaps[0],xpos,ypos)  <br> UnlockImage(tileImg)<br><br>now I can paste my Tile with "DrawImage" at amazing speed. (8 times faster then before).<br><br>But there is a fault with MASKED blitting (but I can fix them)<br><br>Thanks for testing my source :)<br><br>Alex <br><br></td></tr></table><br>
<a name="1280848"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> 8 times faster then before <br></div><br>Yay! ;-) <br><br></td></tr></table><br>
<a name="1280849"></a>

<a name="1280851"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SidAntic</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> But I saw that the "LockImage" Function returns the pixmap.<br><br>ehh cool.<br><br><br><br>So I fixed it !!!!!<br><br>I am using now "DrawSubImageRect" instead of "DrawPixMap". <br><br></td></tr></table><br>
<a name="1280868"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> Woohoo! Well done!<br><br>I now have 0 ~ 1 ms per frame on both machines, and all OSs ;-) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
