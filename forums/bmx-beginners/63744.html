<!DOCTYPE html><html lang="en" ><head ><title >GIF handling in Blitzmax?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >GIF handling in Blitzmax?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=101" >BlitzMax Beginners Area</a>/<a href="#bottom" >GIF handling in Blitzmax?</a><br><br>
<a name="711537"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >mikelandzelo</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey,<br>I'm new to BlitzMax and tried a few things out today. I'm really keen on getting more knowledge because BlitzMax is a wonderful language. But now there's a problem: I can't load GIF graphics / display them.<br><br>----------------------------------------<br>Here's the code:<br>----------------------------------------<br>SuperStrict<br>Graphics 320, 240, 0<br><br>IncBin "images/sample.gif"<br>Local myGif:TImage = LoadImage("incbin::images/sample.gif")<br><br>While not KeyHit(KEY_ESCAPE)<br>	Cls<br>	DrawImage myGif, 10, 10<br>	Flip<br>Wend<br>----------------------------------------<br><br><br>So what's wrong?<br><br>Thanks in advance <br><br></td></tr></table><br>
<a name="711542"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> There's no GIF support in Bmax <br><br></td></tr></table><br>
<a name="711543"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jesse</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> it support png and bmp.<br>in case you don't know, you can save your image into a png or a bmp image with microsoft paint program.  Just load it in to the paint program and use "save as"  and choose the format in the save as type. <br><br></td></tr></table><br>
<a name="711550"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mordax_Praetorian</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Gif is an aweful image format anyway, unless its a photograph, png is your friend <br><br></td></tr></table><br>
<a name="711558"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yan</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Import - BMP, JPG, PNG and TGA<br>Export - PNG and JPG <br><br></td></tr></table><br>
<a name="711564"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> PNG was designed to succeed GIF and does pretty much everything better, except animation frames. <br><br></td></tr></table><br>
<a name="711602"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >mikelandzelo</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think this answeres my question...<br><br>So in order to get a full animation I'll need an animation-sprite-strip and load it with LoadAnimImage() ? <br><br></td></tr></table><br>
<a name="711603"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> yep <br><br></td></tr></table><br>
<a name="711604"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm not quite ready but there should be gif support added to the axe modules shortly. Here is the reader in it's current state, use LoadImage(pixmap) with the pixmap result in my test code if you want to play with it:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
' readgif.bmx

Strict

Global CODEMASK[]=[0,$0001,$0003,$0007,$000F,$001F,$003F,$007F,$00FF,$01FF,$03FF,$07FF,$0FFF]

Const MAXCODES=4096

Const HASALPHA=1

Global stack:Short[MAXCODES]
Global suffix:Short[MAXCODES]
Global prefix:Short[MAXCODES]

Global lzhbuffer:Byte[256]
Global bbptr,bits,bytes,bval

rem

'this is my testcode...

Local stream:TStream
Local pixmaps:TList
Local pix:TPixmap
stream=ReadFile("tweety.gif")
'stream=ReadFile("acidsoftware.gif")
'stream=ReadFile("grid.gif")
pixmaps=ReadGifPixmaps(stream)
pix=TPixmap(pixmaps.valueatindex(0))
SavePixmapPNG pix,"testpng.png"

endrem

Function ReadGifPixmaps:TList(stream:TStream)
	Local pixmaps:TList=New TList
	Local pix:TPixmap
	Local pal:Int Ptr
	Local bgcol
	Local aspect
	Local i,r,g,b,w,h,f,n,t
	Local _delay,_start,_end,_loop,_flags

	Local hdr:Byte[6]

	If stream.Read(hdr,6)&lt;&gt;6 Return
	If hdr[0]&lt;&gt;Asc("G") Or hdr[1]&lt;&gt;Asc("I") Or hdr[2]&lt;&gt;Asc("F") Return
' 89A	
	Print hdr[3]+Chr(hdr[3])
	Print hdr[4]+Chr(hdr[4])
	Print hdr[5]+Chr(hdr[5])
	w=stream.ReadShort()
	h=stream.ReadShort()
	f=stream.ReadByte()
	bgcol=stream.ReadByte()
	aspect=stream.ReadByte()
	If f&amp;128
		n=2Shl(f&amp;7)
		pal=New Int[n]
		For i=0 Until n
			r=stream.ReadByte()
			g=stream.ReadByte()
			b=stream.ReadByte()
			pal[i]=$ff000000|(r Shl 16)|(g Shl 8)|(b)
		Next
	EndIf
	_delay=-1
	While True
		n=stream.ReadByte()
		Select n
		Case -1
			Return pixmaps
		Case $2c
			parsegif(pixmaps,stream,pal,0)
			DebugLog "gif $2c complete pixmaps.count()="+pixmaps.count()
			Return pixmaps		
'			DebugStop
		Case $21
			n=stream.ReadByte()
			Select n
				Case $f9'graphic control block
					n=stream.ReadByte()
					f=stream.ReadByte()
					_delay=stream.ReadShort()
					t=stream.ReadByte()
					If f&amp;1 
						pal[t]:&amp;$ffffff
						_flags=HASALPHA
					EndIf
					stream.seek(stream.pos()+n-4)
					While True
						n=stream.ReadByte()
						If n=0 Exit
						stream.seek(stream.pos()+n)
					Wend
			Default
				n=stream.ReadByte()
				stream.Seek stream.pos()+n
				While True
					n=stream.ReadByte()
					If n=0 Exit
					stream.seek(stream.pos()+n)
				Wend				
			End Select
		End Select
	Wend
End Function

Function lzhread(stream:TStream,currsize)
	Local	i,r
	If bits=0
		If bytes&lt;=0
			bbptr=0
			bytes=stream.readbyte()
			For i=0 Until bytes
				lzhbuffer[i]=stream.ReadByte()
			Next
		EndIf
		bval=lzhbuffer[bbptr]
		bbptr:+1
		bits=8
		bytes:-1
	EndIf
	r=bval Shr(8-bits)
	While bits&lt;currsize
		If bytes&lt;=0
			bbptr=0
			bytes=stream.ReadByte()
			For i=0 Until bytes
				lzhbuffer[i]=Stream.ReadByte()
			Next
		EndIf
		bval=lzhbuffer[bbptr]
		bbptr:+1
		r:|(bval Shl bits)
		bits:+8
		bytes:-1
	Wend
	bits:-currsize
	Return r&amp;CODEMASK[currsize]
End Function

Function parsegif(pixmaps:TList,stream:TStream,pal:Int Ptr,flags,squash=False)
	Local x,y,w,h,f	'i,r,g,b,n
	Local size,csize,topslot,clear
	Local ending,slot,newcodes,avail,bitsleft
	Local c,code,oc,fc,sp,bptr
	Local yinc,lpass
	Local pix:TPixmap

	x=stream.ReadShort()
	y=stream.ReadShort()
	w=stream.ReadShort()
	h=stream.ReadShort()
	f=stream.ReadByte()

	yinc=1
	If (f&amp;64) yinc=8

	DebugLog "createpixmap("+w+","+h+")"
	
	If flags&amp;HASALPHA
		pix=CreatePixmap(w,h,PF_BGRA8888)
	Else
		pix=CreatePixmap(w,h,PF_BGR888)
	EndIf
	pixmaps.addlast pix
'	can-&gt;SetHandle(-x,-y)
'	If (squash)
'		can-&gt;resize(w,(h+1)&gt;&gt;1,canflags,False)
'	Else
'		can-&gt;resize(w,h,canflags,False)
' image data

	size=stream.readbyte()'system.debug("size="+size)
	csize=size+1
	topslot=1 Shl csize
	clear=1 Shl size
	ending=clear+1
	slot=ending+1
	newcodes=ending+1
	bbptr=0
	bits=0
	bytes=0
	bval=0
	
	While True
		c=lzhread(stream,csize)
		If c=ending Exit
		If c=clear
			csize=size+1
			slot=newcodes
			topslot=1 Shl csize
			While True 
				c=lzhread(stream,csize)
				If c&lt;&gt;clear Exit
			Wend
			If c=ending Exit
			If c&gt;=slot c=0
			oc=c
			fc=c
'			If (squash)
'				If ((x&amp;1)=(y&amp;1)) WritePixel(x,y Shr 1,pal[c])
'			Else
				WritePixel(pix,x,y,pal[c])
'			EndIf
			x:+1
			If x=w
				x=0
				y:+yinc
				If y&gt;=h 
					y=4 Shr lpass
					yinc=y*2
					lpass:+1
				EndIf
			EndIf
		Else
			code=c
			If code&gt;=slot
				code=oc		
				stack[sp]=Short(fc)	'simon was here
				sp:+1
			EndIf
			While code&gt;=newcodes
				stack[sp]=suffix[ code]
				sp:+1
				code=prefix[ code]
			Wend
			stack[sp]=Short(code)	'simon was here
			sp:+1
			If slot&lt;topslot
				fc=code
				suffix[slot]=Short(fc)
				prefix[slot]=Short(oc)
				slot:+1
				oc=c
			EndIf	
			If slot&gt;=topslot And csize&lt;12
				topslot=topslot Shl 1
				csize:+1
			EndIf
			While sp&gt;0
				sp:-1
				c=stack[sp]
				If squash
					If (y=h-1) Or (x&amp;1)=(y&amp;1)
						WritePixel(pix,x,y Shr 1,pal[c])
					EndIf
				Else
					WritePixel(pix,x,y,pal[c])
				EndIf
				x:+1
				If x=w 
					x=0
					y:+yinc
					If y&gt;=h
						y=4 Shr lpass
						yinc=y*2
						lpass:+1
					EndIf
				EndIf
			Wend
		EndIf
	Wend
End Function
</textarea><br><br>or try the following untested wrapper:<br><pre class=code>
Function LoadGif:TImage(url:Object)
	Local stream:TStream
	Local pixmaps:TList
	Local pix:TPixmap
	stream=ReadFile(url)
	If stream
		pixmaps=ReadGifPixmaps(stream)
		CloseFile stream
		If pixmaps
			pix=TPixmap(pixmaps.valueatindex(0))
			Return LoadImage(pix)
		EndIf
	EndIf
End Function
</pre> <br><br></td></tr></table><br>
<a name="711617"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> saving too? <br><br></td></tr></table><br>
<a name="711677"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xlsior</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Interesting enough:<br><br>The last patents on the GIF file format expire on october 1st, 2006, making GIF truly 'free' to use again just 2 days from now.<br><br><a href="http://www.freesoftwaremagazine.com/node/1772" target="_blank">http://www.freesoftwaremagazine.com/node/1772</a> <br><br></td></tr></table><br>
<a name="711756"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >mikelandzelo</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> @skidracer:<br>Thanks for the code. I haven't tried it out yet, but I will do today. I'll post my success here in this topic.<br><br>@xlsior:<br>Interesting. Could this mean that Mark will include a GIF support within the next Updates of BlitzMax? <br><br></td></tr></table><br>
<a name="711834"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I'm not quite ready but there should be gif support added to the axe modules shortly <br></div> <br><br></td></tr></table><br>
<a name="712530"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >mikelandzelo</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> @skidracer:<br>Your code works fine. The gif images are displayed correctly but there is just on problem: There is no transparency, instead of this a magenta color is shown.<br><br>I guess I can remove the magenta color by setting the mask color, correct? Anyone got a little piece of code for me? <br><br></td></tr></table><br>
<a name="712607"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> It should already support alpha, if you can, please email me your gif so I can test.<br><br>The loader still needs per frame palette support which I can put in soon and there may be a bug with the background color support, will test. <br><br></td></tr></table><br>
<a name="712812"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >mikelandzelo</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is the gif picture:<br><img src="http://temp.zelda-universe.at/HylianSymbol.gif"> <br><br></td></tr></table><br>
<a name="712925"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> oops change ReadGifPixmaps at ~ line 84 to:<br><br><pre class=code>
			parsegif(pixmaps,stream,pal,_flags)
</pre> <br><br></td></tr></table><br>
<a name="713373"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >mikelandzelo</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> yep, that works!<br>Thank you very much <br><br></td></tr></table><br>
<a name="751010"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Teddyfles</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I'm not quite ready but there should be gif support added to the axe modules shortly. <br></div><br><br>Hi, sorry for bumping an old thread like this, but might this still happen? I just synched with axe enabled but all I see is a module to load jpg2000.<br><br>(Don't worry, I'm not planning on using gif files as game graphics, it's for a program that can load image files from the user, so the more supported formats the better.) <br><br></td></tr></table><br>
<a name="751112"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah gif would be nince since it is still in use quite a bit on the web, even though png is in most cases much nicer (then then png is nicer than bmp but we have that too). Anyone want to do an IFF/ILBM loader? I did one in basic a while ago, wasn't too hard. <br><br></td></tr></table><br>
<a name="779099"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Chroma</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm...I can't get simon's code to work at all.  Anyone have a clear example? <br><br></td></tr></table><br>
<a name="779222"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> Another option, if you need GIF support... there is always my freeimage module - which supports GIF load and save, as well as conversion to lots of other file formats.<br><br>See link for more details...<br><br><a href="http://brucey.net/programming/blitz/index.php#bahfreeimage" target="_blank">http://brucey.net/programming/blitz/index.php#bahfreeimage</a><br><br>Even supports loading IFF/ILBM (whatever those are)... ;-) <br><br></td></tr></table><br>
<a name="779263"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> Brucey, was your smiley there to indicate that you know what ILBM is from (Amiga), or a serious question?<br><br>Of note, IFF is the Interchangeable File Format developed by Electronic Arts for Deluxe Paint, but which is meant to be able to store several types of data including audio. It's kind of a flexible file format able to store multiple items - images, sounds, palettes, etc. ILBM is the InterLeaved BitMap which is the format for images that IFF uses. <br><br></td></tr></table><br>
<a name="779382"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> IFF was probably a bit ahead of its time, as far as having the capability to store information other than images in it.<br>Clever idea, but sadly under-exploited. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
