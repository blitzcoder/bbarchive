<!DOCTYPE html><html lang="en" ><head ><title >Object Oriented Function Pointers?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Object Oriented Function Pointers?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=101" >BlitzMax Beginners Area</a>/<a href="#bottom" >Object Oriented Function Pointers?</a><br><br>
<a name="537303"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I can't find any reference to function pointers anywhere in the docs, but I'm sure we have them. I'd like to get them competely encapsulated within an object though. I'm not sure this is even possible but it sure would be nice.<br><br>Let's say my object is a GUI Buttono of some kind. It has a Method called Action() which is called whenever the button is clicked. Now I'd like to be able to change that action to anything else in the game, including standard functions, functions of the same object or a different object and methods of the same object or a different object.<br><br>The GUI Object has a method called SetTarget() which is where I'd like to set what the object does when Action() is triggered.<br><br>So Something like this ( pseudo code )<br><br>Button1=CreateButton()<br>Button2=CreateButton()<br>Button2.Hide()<br>Button1.SetTarget(Button2.Show())<br><br>Then when I click on Button 1, Button 1's Action() method is triggered, which by now points to Button 2's Show() method and button 2 is unhidden.<br><br>As I say, it need not always be a method of the same type and it might just be a function, so hopefully it's possible to do it each way?<br><br>Possible? <br><br></td></tr></table><br>
<a name="537385"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >CoderLaureate</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'd like to know this too.<br><br>Guess the best way to find out is just to experiment.  I know you can set a pointer inside of an object to a function outside of the object.  I don't know about 'Method Pointers' though.<br><br>When setting up a function pointer you have to make sure the signatures match:<br><br>*this code is untested, I just put it there to show how to use the function pointers.*<br><br><pre class=code>
Type foo
   'Declare Function Pointer
   'This can be any name, I just chose the text 'FunctionPointer'
   'for demonstration purposes.
   Field FunctionPointer(Sender:foo)
   Field Name$
   Field Age
   Function Create:foo(Name$, Age)
      Local f:foo = new foo
      f.Name = Name; f.Age = Age
      return f
   End Function
   Method Update()
      'Check if the function pointer has been assigned.
      If FunctionPointer &lt;&gt; null Then 
          'If so, call the function and pass the parameters
          FunctionPointer(Self)
      End If
      Print "Name: " + Name
      Print "Age: " + Age
   End Method
End Type

Function FooFunction(Sender:foo)
   'Sender refers to the current foo object that's
   'calling this function.
   Sender.Age:+25
End Function

Local f:foo = foo.Create("Jim",39)
f.FunctionPointer = FooFunction

f.Update()

Should print:
Name:  Jim
Age:  64

</pre><br><br>Hope this helps. <br><br></td></tr></table><br>
<a name="537481"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> There is currently no such thing as a method pointer and no way to access it.<br><br>To create a function pointer you define it as a dummy function:<br><br>Local myfunctionpointer()<br><br>Then you can treat it like a variable, although it mainly only can interact with other function pointers. All functions that you actually create in your program have a function pointer - which is the name of the function. For example:<br><br>Function myfunction()<br>   print "yes, by Jesus!"<br>End Function<br><br>There is now a function pointer in existence called myfunction.<br><br>So you can create a dummy function pointer and then make it point to any other existing function at your leisure, for example:<br><br>Local myfunctionpointer()<br><br>Function myfirstfunction()<br>   print "one is where it all starts!"<br>End Function<br><br>Function mysecondfunction()<br>   print "two makes for a good game!"<br>End Function<br><br>myfunctionpointer=myfirstfunction 'WITHOUT THE ()!<br>myfunctionpointer() 'CALLS THE `FIRST` FUNCTION!<br><br>myfunctionpointer=mysecondfunction 'WITHOUT THE ()!<br>myfunctionpointer() 'CALLS THE `SECOND` FUNCTION!<br><br>myfunctionpointer=myfirstfunction 'WITHOUT THE ()!<br>myfunctionpointer() 'CALLS THE FIRST ONE AGAIN.<br><br>You can I think change a function pointer into a byte pointer with Byte Ptr(myfunctionpointer), but that is the only translation allowed. If you want an Int pointer it has to be Int Ptr(Byte Ptr(myfunctionpointer)).<br><br>To assign a function to a function pointer, refer to the function you want to use without the `()` on the end, otherwise the function would actually be called.<br><br>To call the function assigned to your function pointer, just use your function pointer as if it's calling that function ie myfunctionpointer().<br><br>You can set up parameters for your functions. If you create a function that you want to use and it has an Int and a Float as the parameters, you also must define your function pointer variable with the same parameters. They must map onto the same params and variable types! e.g.<br><br>Function actualfunction(Param1:Int,Param2:Float)<br>   Print "doing stuff"<br>End Function<br><br>Local myfunctionpointer(Thing:Int,Thing2:Float)<br>myfunctionpointer=actualfunction<br>myfunctionpointer(15, 25.934)<br><br>You can get the function pointer of a function that is defined within a custom Type, but you can't get the function pointer of a Method. Also you will notice if you manage to print out the function pointer, that there is only one instance of a `function within a type` that is shared amongst all instances of that type. The memory address is the same as used by all instances, even though it appears that each instance has its own function.<br><br>If you get some problem whereby it seems like the function is actually called rather than just returning the function pointer, make sure you don't use the () on the end and make sure to simplify the operation on its own line with no other fancy combinations of operations at once. Just do myfunctionpointer=realfunctionpointer on a line by itself, so as not to confuse things.<br><br>You can create an instance of a type at runtime, and then equate the function pointer of one of its functions to your own function pointer variable declared elsewhere. However, again, all instances of that type share the same actual function, so there is no way to create custom functions at runtime. Believe my I tried! ;-)<br><br>I hope this helps. I think that about covers it. <br><br></td></tr></table><br>
<a name="537500"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thank you both for the information. That all makes sense now. <br><br>If the function address of a type instance returns the same address, that would explain why method pointers are out. It's not unreasonable to expect this though, is it? I mean, I'm not an experienced C++ programmer, but I understood that C++ supports method pointers, along with Delphi and Java.<br><br>It's messy having to go outside of the object to do things. <br><br></td></tr></table><br>
<a name="537558"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> C++ is no language to compare as it has no managed and type safe system.<br><br>But some kind of method pointer would be nice, thats right ...<br>The only reason I could see that they should not work might be that the memory manager of BM moves around type instances which would break method pointers ...<br><br>Perhaps we will see that somewhen later ... <br><br></td></tr></table><br>
<a name="537684"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, the reason the function pointer for a function within a type is the same, is that it creates one function for the `type`, not for the instances. You reference it with mytype.function() rather than something like myinstance.function(). They all share the same function.<br><br>Thing is, even if you had a method pointer, there probably also would only be one method for the type shared amongst all the instances of the type. Otherwise, to have an actual piece of machine code for every type instance, you'd have to be able to move chunks of code around at runtime, relocate them, reassign any changes in for example the address of labels, get the cache flushed out so that it can be executed, etc... plus what Dreamora said about the pointers moving and not being kept consistent. I'm sure there's other issues too. It would be cool though. <br><br></td></tr></table><br>
<a name="537688"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I understand that, but that's because you only pass the address of the function. From what I've read, languages which support proper method pointers ( per instance ) do so by passing *two* 32 bit ints, one for the address of the function and one for the instance. You still only have one function, it's just that the instance address gets passed too. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
