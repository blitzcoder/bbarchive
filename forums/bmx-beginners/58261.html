<!DOCTYPE html><html lang="en" ><head ><title >collisions optimization</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >collisions optimization</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=101" >BlitzMax Beginners Area</a>/<a href="#bottom" >collisions optimization</a><br><br>
<a name="647951"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >hub</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi !<br>in my game a use collideimage to determine if my ship collide with an enemy.<br><br><pre class=code>
If ImagesCollide(j.hImage,j.PosX,j.PosY,j.Frame,hImage,PosX,PosY,Frame) Then
				TExplosion.Creer(PosX, PosY)
endif
</pre><br><br>see the screenshoot, in this case  the enemy checked is far the player...<br><br>1) so is ImagesCollide perform a rect or oval check before test perfect pixel collision ?<br><br>2) or should i code my own check before call imagescollide to increase my game performance ?  For example :<br><br>a) check if i've the ennemy is inside the 'player oval' (radius collision test, there are some formulaes posted somewhere)...<br><br>b) ... if it's the case call imagescollide for perfect collision check<br><br>Need your suggestions and your experience !<br>Thanks !<br><br><br><img src="http://www.bayre.com/zigwigwis/capt_400.jpg"> <br><br></td></tr></table><br>
<a name="647957"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TartanTangerine (was Indiepath)</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> In the interests of speed<br><br>1) Check to see if bounding rectangles overlap.<br>2) Check to see if bounding circles overlap (you can miss this).<br>3) Perform Collision check proper.<br>4) Report collision.<br><br>Step 1 is very fast as this can be calculated using very simple boolean logic. Step 2 take a little longer as you need to use multiplication and square root calculations. <br><br></td></tr></table><br>
<a name="647966"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >QuietBloke</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> step 2 shouldnt really need square root calculations. Instead of storing the radius of the bounding circle for each sprite you can store the radius squared.<br>That way when you want to see if the bounding circles have collided you simply calculate the distance between the two sprites and square it and compare the result with the sum of the stored 'raduis squared' of the sprites.<br><br>Did that make sense ? <br><br></td></tr></table><br>
<a name="647968"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >hub</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> for 1) this ?<br><br>Function RectsOverlap%(x0, y0, w0, h0, x2, y2, w2, h2)<br>	If x0 &gt; (x2 + w2) Or (x0 + w0) &lt; x2 Then Return False<br>	If y0 &gt; (y2 + h2) Or (y0 + h0) &lt; y2 Then Return False<br>	Return True<br>End Function<br><br>for 2 this ?<br>(stored for each sprite)<br><br>local radius# = sqr( ImageWidth(img)*ImageWidth+ImageHeight(Img)*Imageheight)<br><br><br>and for 3 ImagesCollide;-) <br><br></td></tr></table><br>
<a name="647975"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >hub</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> 1) so is ImagesCollide perform a rect or oval check before test perfect pixel collision ? <br></div><br>answer seems to be 'no' ? <br><br></td></tr></table><br>
<a name="648016"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> well I found this was the case in Blitz PLus, I *assumed* it would check and was amazed to find out it didn't, or at least it was faster with my own checks! <br><br></td></tr></table><br>
<a name="648197"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I would not use ImagesCollide unless you have no static objects and you really need to check everything against everything.<br><br>BMs new way with the collision layers is more powerfull and its ability to return any given object you give it, as the collision result gives you more power than ever. <br><br></td></tr></table><br>
<a name="648300"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >hub</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Dreamora i use also the system with the collision layer (to test collision between :<br>map tiles, map static object and players. <br><br>else i now use imagescollides after my own tests. For example, i test an ennemy collision box with the player and after call imagescollide. For the projectiles (for example the player shoot), before the call to imagescollides, i compute the distance between the shoot and the ennemy.<br><br>The thing i don't know how to with bmax collision system layer is to return the 'projectile id' when for example it collide with a maptile, and remove it from my projectiles list. <br><br></td></tr></table><br>
<a name="648310"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Urgs ...<br><br>Do not use distance checks unless you do distance square tests!<br>using SQRT will cost you an "extreme" amount of time, that is not really be needed in a 2D game (you can't make worlds large enough as screens can't have that high resolutions ;-) ) <br><br></td></tr></table><br>
<a name="648319"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >hub</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> no use sqr function for distance. i just use this test :<br><br>(dx-ox)(dx-ox)+(dy-oy)(dy-oy) &lt; d*d<br><br>but agree with you, i should use a box check... <br><br></td></tr></table><br>
<a name="648343"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> local radius# = sqr( ImageWidth(img)*ImageWidth+ImageHeight(Img)*Imageheight) <br></div><br><br>That's what you posted above.<br>Use Squared Radius instead, ie without the sqr ... Or did you change that and mean that? In that case ignore this posting :D <br><br></td></tr></table><br>
<a name="648346"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >hub</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> oups... sorry, i not use radius ;-) i'm modified my code to use check box and not use (dx-ox)(dx-ox)+(dy-oy)(dy-oy) &lt; d*d. <br><br>(for small projectile center_x, center_y)<br><br>Function Checkbox(x0, y0, w0, h0, center_x, center_y)<br>If x0 &gt; center_x Or (x0 + w0) &lt; center_x Then Return False<br>If y0 &gt; center_y Or (y0 + h0) &lt; center_y Then Return False<br>Return True<br>End Function <br><br></td></tr></table><br>
<a name="648444"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Haramanai</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Looks like you are trying to use AABB ( Axis-aligned Bounding Boxes)<br>Check this out.<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Type AABB
	Field MinX:Int
	Field MinY:Int
	Field MaxX:Int
	Field MaxY:Int
End Type

Function TestAABBAABB:Int( a:AABB , b:AABB)
	If a.MaxX &lt; b.minX Or a.MinX &gt; b.MaxX Return 0
	If a.MaxY &lt; b.minY Or a.MinY &gt; b.MaxY Return 0
	Return 1
End Function
</textarea><br>Test the two AABB and if returns 1(true) check pixelPerfect.<br>The problem with that is that you will have to reposition in every frame the AABB Fields.<br>For example if the handle of you picture is at the middle of the image and the position of the image is at x , y.<br>MinX = x - ImageWidth/2 , MinY = y - ImageHeight/2 , MaxX = x + imageWidth/2 , MaxY = y + imageHeight/2.<br>The best is to store somewhere the ImageWidth/2 and ImageHeight/2.<br>The problem with this is that you will have to check for collisions for all your objects in the game. For example if you have in the level 300 enemies you will have to run 300 times the TestAABBAABB and to update all AABB.<br>One good solution (I haven't checked this yet) is to split your map in AABBs. Put a byte in your enemies’ types that will tell them if they are going to be Active.<br>Then you will have active only the enemies of the AABB that you are in and the neighbours of it. Also it's good to have a (pointer) of the AABB that your enemies are belongs to before you make them active. After that if an enemy goes beyond the neighbours AABB change the pointer to the current AABB and deactivate him.<br>I believe that this will speed up your game. Just make a test with a small map to see how it’s going to look like. <br><br></td></tr></table><br>
<a name="648460"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >hub</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Many thanks for your explanations. fi you want you can test my first try to increase my game speed.<br><br>download it from this page : <a href="http://www.bayre.com/zigwigwis/telech.php" target="_blank">http://www.bayre.com/zigwigwis/telech.php</a><br><br>during the game press 'f' to show the fps and 'm' to show the 'main code loop execution time'. You can see the boxes, cones by pressing 'c' (but it slowdown the game). <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
