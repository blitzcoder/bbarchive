<!DOCTYPE html><html lang="en" ><head ><title >Economic Saving of an Array or bank</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Economic Saving of an Array or bank</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=101" >BlitzMax Beginners Area</a>/<a href="#bottom" >Economic Saving of an Array or bank</a><br><br>
<a name="1133896"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >CandlestoneDave</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi All<br><br>I am trying to save a tremendous amount of data to a disk. It is essentially a 'save game' file, but it needs to record the entire state of the game world.<br><br>The game world is 1000 x 1000 x 200 blocks.<br><br>The method I am using currently is as follows:<br><br>Local linestring:String<br>Local out:TStream<br>linestring = "savegame/" + "save1" + ".bin"<br>out=WriteStream("savegames/save1.Bin")<br>i = 0<br>For z = 1 To 200<br>For y = 1 To 1000<br>For x = 1 To 1000<br>i = i + 1<br>PokeByte (Myworld:TBank,i,world[x,y,z])<br>WriteBank(MyWorld:TBank, out:TStream,i,1)<br>Next<br>Next<br>Next<br><br>Where the data I am saving is held during the game as an array, world [x,y,z]. The above converts it to a bank, then saves it to a stream.<br><br>It works, but the problem is that it takes a very long time to save and then load again. It also creates a save file of 200MB, which seems ridiculously huge.<br><br>Does anyone have any ideas of a more time/space economical way of saving the data?<br><br>Thanks<br><br>Dave <br><br></td></tr></table><br>
<a name="1133912"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jesse</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> writing one byte of data at a time is the slowest. you can write the whole file to the bank stream then write the whole bank at once with FlushStream. Also, you might want to compress the file before writing to a file. you can use the zlib included with Bmax or us a third party one like gman's zip engine:<br><a href="http://www.blitzmax.com/Community/posts.php?topic=97329#1132795" target="_blank">http://www.blitzmax.com/Community/posts.php?topic=97329#1132795</a> <br><br></td></tr></table><br>
<a name="1133926"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >matibee</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Do your game 'blocks' begin with some default value; ie from a map, or even empty?  Then you could just write the blocks that are different from the default.<br><br>A simple method would be to write [x,y,z,block value] for each changed block, a better way would be to find a chain of changed blocks and write:<br><br>x,y,z (start position of chain)<br>n (length of chain)<br>n[] values<br><br>Compression will also help as Jesse said.  Further hints might depend on the world your working with.  Perhaps it's a minecraft-a-like?  How many types of block are there? If there's 16 or less, two blocks could be written as one byte. etc. <br><br></td></tr></table><br>
<a name="1133936"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Run length encoding would probably be better if youre saving a lot repetitive data, which is generally the case with arrayed game worlds. when combined at the bit level you could  potentiallly squeeze your 200mb down to about 2mb upwards.<br><br>If you tell us a bit more about the kind of data in each array slot then we can give you a more detailed suggestion. <br><br></td></tr></table><br>
<a name="1133958"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >CandlestoneDave</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks a lot for the comments. I'll go through each one in detail after work today. Col, the data in each slot is simply a number between 1 and 256. Thanks. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
