<!DOCTYPE html><html lang="en" ><head ><title >DrawImage Optimisation</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >DrawImage Optimisation</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=101" >BlitzMax Beginners Area</a>/<a href="#bottom" >DrawImage Optimisation</a><br><br>
<a name="695421"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tafty</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello All,<br><br>I'm coming close to finishing my first BlitzMax project and have started testing it on a few friends PCs.  They've expereinced a bit of slow down particularly when there's a significant amount of images being drawn.<br><br>What I'm wondering is does BlitzMax optimise the order in which images are drawn using DrawImage?  Or would it improve performance to implement my own SpriteEngine type that stores the images to be drawn during the program loop, orders them by z-order, image name (i.e. texture), y-order and then draws them prior to the call to Flip?<br><br>Or would all the above be massively over complicating the matter and I should just accept the fact that I should try and reduce the number of particle images in my explosions?!<br><br>Cheers,<br><br>Gareth. <br><br></td></tr></table><br>
<a name="695423"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> What makes you think it is the image drawing that is slowing the process down?<br>There's lots of possible optimisations but they'd be redundant if you're already following them.<br>As a test, what have you done to reduce the number of particles and what were the results? <br><br></td></tr></table><br>
<a name="695428"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grisu</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> A source code to observe is mostly helpful... :) <br><br></td></tr></table><br>
<a name="695429"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FlameDuck</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Tell them to upgrade their drivers. <br><br></td></tr></table><br>
<a name="695439"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tafty</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> @tonyg:<br>Thank you that's a very good point.  I really need to benchmark various parts of the logic too.  This is a basic and I feel a little silly for not having tried it already but I've been programming in a bit of a void on this so your comment really is very helpful!<br><br>During some of the explosions there is also a release of a game object (TAnitFluff) that would increase the number of collision detections occuring so this could also contribute.  I'll check this out later.<br><br>@grisu:<br>I'm at work right now and my source code is at home but a general overview of my processing would be as follows:<br><br>My TGame type has a render() method called after all game logic is complete that calls the render() methods on each of the currently active TGameState types.  There is only actually only one TGameState type active during gameplay - the game itself - called TGameStatePlay.<br><br>TGameStatePlay calls the render() methods of the following objects (with further objects called by these render() methods indented):<br><br>TParticleManager:<br>--&gt;TStarfield (three layers, about 60 stars in total): Iterates through a TList Of TImages<br>--&gt;TExhaust (the player ships exhaust): Iterates through a TList of TImages<br>--&gt;TExplosion(s): Iterates through a TList of TImages<br>TFluffoid(s):<br>--&gt;Iterates through a TList of TFluffoid with one associated TImage<br>TAnitFluff:<br>--&gt;Iterates through a TList of TAntiFluff with one associated TImage<br>TPlayer:<br>--&gt;Iterates through a TList of TFluff (a bullet class; upto 5 bullets allowed each with one associated TImage)<br>--&gt;The player's TImage<br>THUD<br>--&gt;Draws the score, etc<br><br>Do you know what?  The above has been an excellent exercise because laying it out like that has made me realise that I'm more or less sorting by the image name already due to the fact that each object type is iterated through sequentially.  There are differences in colour, rotation and scale though.  So chances are that when I get to try some benchmarking tonight I'll find a delay in the logic cycle...<br><br>Many thanks - I'll let you know how I get on!<br><br>@FlameDuck:<br>The battle cry of developers everywhere - I'll be sure to do that too!<br><br>However, I am still interested in a generalised answer to my original question: has anyone found positive performance impact by strictly sorting calls to DrawImage?  Perhaps using the criteria I originally specified or some other criteria?  Maybe even taking into account changes in rotation, scaling and colour (which would make some sense as this would reduce the number of programmatic calls to the rendering pipeline)? <br><br></td></tr></table><br>
<a name="695446"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> The impact is little unless you are changing images. BM only sets new states if they changed (and even if it does, the gain you get by batching is normally smaller than if you just used regular setcolor etc without batching code)<br><br>Chance is higher that they have no real 3D card (Intel, SiS, S3) or that they have a low bandwidth card like Radeon 9000 or ATI IGP ...<br>Another potential factor is the driver you used. For that reason i would add an option at the beginning that ask if the player wants to use OpenGL or DirectX. Because DX7 is quite a little old, NVidia user might have the better performance with OpenGL ... <br><br></td></tr></table><br>
<a name="695450"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="/posts.php?topic=51647#578284" target="_blank"> This </a> might help. <br>In addition, a couple of years ago, it was found quicker to draw objects sharing the same image in groups. Unfortunately that post was <a href="/posts.php?topic=48587#540427" target="_blank"> lost </a>.<br>You can have 1000's of rotated, scaled, coloured, alpha'd images displayed at the same time.<br>The rules change a bit when you get 1000's of particles as well. Depends on their size, whether you delete/create them or pool them. <br>Check a current thread for pooling objects as it might help. The same pool is valid for particles. <br><br></td></tr></table><br>
<a name="695486"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I benchmark logic separately from drawing.  In Bmax the drawing seems very fast on my setup unless I chuck out tons of particles, but I think the delay is more down to the processing required to loop through, process and send each particle image to the graphics card rather than the actual drawing.  In the past, with non-accelerated graphics, the delay *was* caused by drawing, but that's rare now imho. <br><br></td></tr></table><br>
<a name="696181"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tafty</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well it turns out that when you explode everything on screen and create 1500 new particles plus assorted detritus all at once it leads to a noticeable dip in performance - who'd-a-thunk-it!?<br><br>But following the implementation of some object pooling and cutting out the unnecessary collision detection that was taking place it's now behaving much better.  I may yet try and reduce the number of particles too.<br><br>Just a couple of tweaks to do and I'll have version to post soon.<br><br>Many thanks to all that took the time to reply! <br><br></td></tr></table><br>
<a name="696213"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> On Collision: there is one important thing on this topic: Only put receive collisions on those objects that REALLY need it. There is no intelligent reason for example in most cases, why bullets should receive collisions. They only send it when they hit something. In that scenario, most likely only player and targets have receive.<br>If you have walls on which the projectiles explode: let the walls receive the collision, they are static and you know exactly how many of them are there and you can it often even optimize quite far by using the rect command instead of the image based! <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
