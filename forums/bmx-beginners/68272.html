<!DOCTYPE html><html lang="en" ><head ><title >Plot vs. Writepixel</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Plot vs. Writepixel</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=101" >BlitzMax Beginners Area</a>/<a href="#bottom" >Plot vs. Writepixel</a><br><br>
<a name="762736"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >NickFalk</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just reading through the 2D section of the Blitz3D docs in order to increase my general knowledge of possible uh, possibilities, in BlitzMax.<br><br>Does anyone have an opinion about the plot command compared to the writepixel command? As far as I understand if I use writepixel i will not change the setcolor parameter which affects all graphics? Is there any difference in speed between the two? Is writepixel even viable in BlitzMax?<br><br>Any light shed on the subject would be greatly appreciated. <br><br></td></tr></table><br>
<a name="762738"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >grable</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> WritePixel only works on Pixmaps, so youd have to do a DrawPixmap later.<br><br>I would imagine Plot being slower, but i havent tested it. <br><br></td></tr></table><br>
<a name="762777"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> What is it you are trying to do? <br><br></td></tr></table><br>
<a name="762792"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >NickFalk</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's not so much that I have a specific task I need to do, as I'm trying to get some bearings of the different possibilities.<br><br>I do however already have a working paralax-starfield created with the plot-command and was curious whether writepixel would for some reason be a better solution. <br><br></td></tr></table><br>
<a name="762794"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wouldn't it be better to use drawoval? Writepixel would involve too much image manipulation for a parallax starfield while plot is slow.<br>&lt;edit&gt; It might even be OK to use a single image. <br><br></td></tr></table><br>
<a name="762799"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >NickFalk</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Could be, I have the handicap of owning a 4x3,00Ghz Xeon and it really doesn't show any sign of strugling with this stuff.<br><br>In either case, I'm really just experimenting (while creating a small shmup) just to see what's possible. <br><br></td></tr></table><br>
<a name="762807"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >NickFalk</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Another related question: Does plot use OpenGL or is OpenGL only used for commands related to "image" I guess this would make all the diference in the world... <br><br></td></tr></table><br>
<a name="762838"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> The commands use whatever driver you have specified in the setgraphicsdriver command. Default is DX driver.<br>Personally, I would use drawoval but, depending on the task and fi you're trying to squeeze every ms out of the process, might use multiple images from the same texture using SetUV. Could be OTT but search using 'setuv' if you're interested. <br><br></td></tr></table><br>
<a name="762843"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >EOF</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nick,<br>Have a look at the code samples here (which use OpenGL) ..<br><br>The first example demonstrates <b>Plot</b> using two methods:<br><br> First, using the standard BLitzMax <b>Plot</b><br> Then, using an unwrapped version with <b>glBegin</b> and <b>glEnd</b> being called at the start and end of a batch of pixels to plot (instead of every plot)<br><br>The speed difference only shows up if you plot 1000's of stars per frame.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
' faster plotting

SuperStrict
Framework BRL.GLMax2D
Import BRL.Random


SetGraphicsDriver GLMax2DDriver()
Const width%=640 , height%=480
Const NUMPLOTS%=500000
Local t%

Graphics width,height,0


t=MilliSecs()
FastPlot NUMPLOTS
Local t1%=MilliSecs()-t

t=MilliSecs()
NormalPlot NUMPLOTS
Local t2%=MilliSecs()-t

' _________________________________________________

Cls
DrawText "Number of plots = "+String(NUMPLOTS),10,10
DrawText "  Fast plot (m/secs)= "+String(t1),10,40
DrawText "Normal plot (m/secs)= "+String(t2),10,60
Flip
WaitKey
End

' _________________________________________________

Function FastPlot(num%)
	glDisable GL_TEXTURE_2D	
	glBegin GL_POINTS
	For Local p%=1 To num
		glVertex2f Rand(width),Rand(height)
	Next
	glEnd
	glEnable GL_TEXTURE_2D
	Flip
End Function


Function NormalPlot(num%)
	For Local p%=1 To num
		Plot Rand(width),Rand(height)
	Next
	Flip
End Function
</textarea><br><br><br><br><br>This code is more complicated (using the <b>WritePixel</b> command)<br>Its certainly pretty damn fast but you need to run it with Debug Off:<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Strict

Framework BRL.GLMax2D
Import BRL.Pixmap
Import BRL.Bank
Import BRL.Random
Import BRL.System


SetGraphicsDriver GLMax2DDriver()
Graphics 640,480 , 0


Global particle_list:TList=New TList
Const glevel1=1
Const glevel2=2
Const glevel3=4

Const maxx=239
Const maxy=239

Const particle_life=1000

Global firepix:TPixmap=CreatePixmap(480 , 480 , PF_RGBA8888)
Global cfb:TBank = CreateBank(57600)
Global hfb:TBank = CreateBank(57600)

SeedRnd MilliSecs()

AppTitle = "BlitzMax Firedemo"

Global gradient[256] , col[5]

col[0]=$000000
col[1]=$400040
col[2]=$000080
col[3]=$C00000
col[4]=$FFFF00

SetupGradient()


Local angl:Double = 0

Type Particle
	Field x#,y#
	Field speed#,direction,angle,life
	Global pcount=0
	'
	Method New()
		x=0
		y=0
		speed#=Rnd (.2 , .6)
		direction=Rand(0,359)
		angle=direction
		life=particle_life
		pcount:+1
		particle_list.AddLast(Self)
	End Method
	'
	Method Update()
		If x &lt; -120 Then x = -120
		If x &gt;  119 Then x =  119
		If y &lt; -120 Then y = -120
		If y &gt;  119 Then y =  119

		Local bofs= Int(x+120) + Int(y+120)*240
		Local myPtr:Byte Ptr = BankBuf (cfb)

		Local valu=myPtr[bofs]
		valu=valu+20

		If valu&lt;80
			life:-1
		EndIf

		If life &lt;=0
			x=0
			y=0
			speed#=Rnd (.2 , .6)
			direction=Rand(0,359)
			angle=direction
			life=particle_life
		Else
			If valu&gt;255 Then valu=255
			myPtr [bofs] = valu

			Local surfangle = ATan2 ( y , x )
			x = x + speed * Cos( direction )
			y = y + speed * Sin( direction )

			If (x*x + y*y)&gt;10000
				angle = surfangle - 180
			Else
				If angle = direction
					angle=Rand(0,359)
				EndIf
			EndIf

			angle=(angle + 360) Mod 360
			direction=(direction + 360) Mod 360

			Local angc:Double
			If angle&lt;direction
				angc=360+angle-direction
			Else
				angc=angle-direction
			EndIf

			If angc&gt;180
				direction=direction-1
			ElseIf angc&gt;0
				direction=direction+1
			EndIf
		EndIf
	EndMethod
	'
End Type



Repeat
	Flip 0
	Cls
	Local startime = MilliSecs()

	For Local p:Particle = EachIn particle_list
		p.update
	Next

	For Local yco=0 To maxy
		For Local xco=0 To maxx
			Local myPtr:Byte Ptr = BankBuf(cfb)

			Local rb:Byte = myPtr [xco + yco*240]
			If rb&gt;0
				Local valu=rb*glevel3

				Local x1 = xco-1
				If x1&lt;0 Then x1=x1+maxx

				Local x3 = xco+1
				If x3&gt;maxx Then x3=x3-maxx

				Local y1 = yco-1
				If y1&lt;0 Then y1=y1+maxy

				Local y3 = yco+1
				If y3&gt;maxy Then y3=y3-maxy

				rb=myPtr [x1 + y1 * 240]
				valu=valu+rb*glevel1

				rb=myPtr [xco + y1 * 240]
				valu=valu+rb*glevel2

				rb=myPtr [x3 + y1 * 240]
				valu=valu+rb*glevel1

				rb=myPtr [x1 + yco * 240]
				valu=valu+rb*glevel2

				rb=myPtr [ x3 + yco * 240 ]
				valu=valu+rb*glevel2


				rb=myPtr [x1 + y3 * 240]
				valu=valu+rb*glevel1

				rb=myPtr [xco + y3 * 240]
				valu=valu+rb*glevel2

				rb=myPtr [x3 + y3 * 240]
				valu=valu+rb*glevel1

				valu=valu Shr 4
				
				PokeByte hfb,xco + yco * 240 , valu

			EndIf
		Next
	Next

	For Local yco=0 To maxy
		For Local xco=0 To maxx
			Local bofs=yco*240+xco
			Local valu=PeekByte(hfb,bofs)
			If valu&gt;0
				If valu&gt;4
					valu=valu-4
				Else
					valu=0
				EndIf
				PokeByte hfb,bofs,valu
				WritePixel firepix , xco*2 , yco*2 , gradient[valu]
				WritePixel firepix , xco*2+1 , yco*2 , gradient[valu]
				WritePixel firepix , xco*2+1 , yco*2+1 , gradient[valu]
				WritePixel firepix , xco*2 , yco*2+1 , gradient[valu]
			EndIf
		Next
	Next

	Local temp:TBank = cfb
	cfb = hfb
	hfb = temp
	
	FastDrawPixmap firepix , 160 , 0

	'One beat each 14.4 frames = 12.5 angles a frame

	angl=angl+12.5
	If angl&gt;180 Then angl=angl-180

	Local frametime=MilliSecs()-startime

	If frametime&lt;30
		For Local i = 0 To 9
			New Particle
		Next
	EndIf

	If Particle.pcount&gt;0
		Local part:String="Featuring "+Particle.pcount+" real-time blurred particles."
		DrawText part , 640-TextWidth(part$),0
	EndIf

	If KeyHit(KEY_ESCAPE)
		particle_list.Clear()
		Particle.pcount = 0
		Exit
	EndIf

	While frametime&lt;33
		frametime=MilliSecs()-startime
	Wend

Forever

End

Function SetupGradient()
	Local ofs,grad,i
	While ofs&lt;255
		For i=0 To 63
			Local perc#=i/63.0
			Local x1=col[grad] Shr 16 &amp; $FF
			Local xco=col[grad] Shr 8 &amp; $FF
			Local x3=col[grad] &amp; $FF
			Local y1=col[grad+1] Shr 16 &amp; $FF
			Local yco=col[grad+1] Shr 8 &amp; $FF
			Local y3=col[grad+1] &amp; $FF
			gradient[i+ofs]=$FF000000 + Int(x1*(1-perc)+y1*perc) Shl 16 + Int(xco*(1-perc)+yco*perc) Shl 8 + Int(x3*(1-perc)+y3*perc)
		Next
		ofs=ofs+i;grad=grad+1
	Wend
EndFunction

Function FastDrawPixmap(p:TPixmap,x,y,scalex#=1.0, scaley#=1.0)
	Local blend%=GetBlend()
	glDisable GL_TEXTURE_2D 'DisableTex
	SetBlend SOLIDBLEND
	Local t:TPixmap=p
	If t.format&lt;&gt;PF_RGBA8888 t=ConvertPixmap(p, PF_RGBA8888 )
	glpixelzoom scalex#,-scaley#
	glRasterPos2i 0,0
	glBitmap 0,0,0,0,x,-y,Null
	glPixelStorei GL_UNPACK_ROW_LENGTH, p.pitch Shr 2
	glDrawPixels p.width, p.height, GL_RGBA, GL_UNSIGNED_BYTE, p.pixels
	glEnable GL_TEXTURE_2D
	SetBlend blend
End Function
</textarea> <br><br></td></tr></table><br>
<a name="762852"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FlameDuck</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Like the man says, if you intend on using plot in any significance, you really need to batch process your plots, so you aren't calling glBegin/glEnd all the time. Very wasteful.<br><br>WritePixel certainly executes faster, but the time taken to DrawPixmap (or LoadImage/DrawImage) might offset the speed gain some what.<br><br>In either case, like tony said, it depends a lot on what you want to do (and probably what hardware you want to do it on). <br><br></td></tr></table><br>
<a name="762855"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >NickFalk</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Jim, I'll keep that GL-bit in mind for when I feel ready to jump onto the GL-bandawagon... ;) <br><br></td></tr></table><br>
<a name="762899"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >EOF</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Forgot to mention the particle demo is using a <b>FastDrawPixmap()</b> routine which, on my Sony craptop, boosts the realtime blured particles from 2770 to 3810! <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
