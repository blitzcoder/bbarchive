<!DOCTYPE html><html lang="en" ><head ><title >Global Variable Speed up/down</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Global Variable Speed up/down</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=101" >BlitzMax Beginners Area</a>/<a href="#bottom" >Global Variable Speed up/down</a><br><br>
<a name="661272"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I was bored so I went though the archive and found a c++ vrs Blitz comparison by Nikko<br><br>;--------------------------------------Blitz<br>t=MilliSecs()<br>For i=1 To 1000000<br>If i=1 Then j=2<br>If j=2 Then j=4 Else j=5<br>j=j+256<br>y#=y#+Cos(i)/100      'Changed to y:Float for max<br>Next<br>Print MilliSecs()-t<br><br>So, I copied it over to blitz max and ran it, without debug (110 Blitzmax, 105 Blitz3D)<br>Odd I thought, so I put some Globals at the start<br><br>Global t:Int,j:Int,y:Float,i:int (Global t,j,y#,i)<br>113 BlitzMax, 102 Blitz3d<br><br>So I deleted the y:float and Y# from the global<br>(BlitzMax 93, Blitz3d 102)<br><br>Deleting I:int<br>(max 114, 3d 103)<br><br>Putting y:float back (global t:int,j:int,Y:float) and (global t,j,y#)<br>(max 89, 3D 103)<br><br>etc<br><br>Conclution,<br><br>Blitz 3d is about the same result if I declare globals or not<br><br>BlitzMax on the other hand slowdown or speedsup depending.<br><br>Questions.<br>1) In Strict mode, is the program going to run slower because I have declared my variables?<br>2) Whats going on? <br><br></td></tr></table><br>
<a name="661275"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> 1) Not really. It even has some very important Pros: locals only exist in the global you declare them. Thats something that non strict won't do (at least did not in earlier versions)<br><br>2)BM is higher optimized. This means that it tries to hold locals directly within CPU which will make them much faster. globals on the other side are held within RAM and need to be transfered to CPU first.<br><br><br>B3D did not make this distinction and was always on the same speed. <br><br></td></tr></table><br>
<a name="661297"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> The thing here is that you should declare that your variables are Local, otherwise they will be assumed to be Global from what I understand. At the moment your code is not using Locals at all.<br><br>Local t:int,j:int,Y:float<br>Local t,j,y#<br><br>That should be even faster. <br><br></td></tr></table><br>
<a name="661325"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> No.<br>If I declare them as all local, its the same speed as if I had not declared them at all.<br><br>But, as local outside the loop and global are the same thing, I didnt expect it to make a difference<br><br>BUT... If I do declare T J and Y as Global its faster<br><br>The reason for my post, is that I tend to declare Loop Variables as Global (i.e. Loop1,Loop2,Loop3), Obviuosly (after reading these posts) its quicker with<br>For Local Loop1 =1 to ......<br>But, does loop1 exist after the end of the loop? <br><br></td></tr></table><br>
<a name="661339"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> no it does not exist. It only exists within the scope of the loop.<br>But you could declare it local outside the loop <br><br></td></tr></table><br>
<a name="661346"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Why cannot it be optimaised to Hold the loop in the cpu wheather its a global or a local?<br>But Ha, its not realy a problem <br><br></td></tr></table><br>
<a name="661349"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Because globals are on a different stack than locals ... If this would not be done this way, BM would end as slow as B3D. <br><br></td></tr></table><br>
<a name="661366"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> But if you look at the numbers in the test above BMAX is SLOWER than Blitz3D.<br>I agree that there is some form of optimation going on in the background. But Surly it shouldn't optimize to slower than Blitz3D.<br>One way to solve this would be COPY the loop variable to the Local Stack from the Global Stack. So that a loop variable is always conciderd a Local Variable, even tho its has Global Scope. <br><br></td></tr></table><br>
<a name="661373"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Note that Cos() returns a Double. I'm not sure how Blitz3D did variables or whether it had the Double type, but a Double is twice the size of a Float which might have something to do with it.<br><br>Try precalculating Cos() into a lookup table on each version and see how they compare. <br><br></td></tr></table><br>
<a name="661377"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Define i as float or give it to the cos as float at least *float(i)*, in that case it should operate on float arithmetic which is highly optimized (not possible for double on the same level, as it is twice as large as what the CPU on 32bit systems accepts) and thus several times faster. <br><br></td></tr></table><br>
<a name="661382"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> I had been forcing float arithmatic with /100.0<br>And if you define I as Float it slows down. <br><br></td></tr></table><br>
<a name="661491"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FlameDuck</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> But if you look at the numbers in the test above BMAX is SLOWER than Blitz3D. <br></div>The test (and the variances) are statisticly insignificant.<br><br>First of all, it contains 2 'empty' if statements (If i=1 and If j=2) so is a better indication of how often a branch prediction misses (and thus the CPU pipeline has to be flushed), rather than of which is better at crunching numbers.<br><br><div class="quote"> And if you define I as Float it slows down. <br></div>From what I understand, the instruction cache does not cache FP instructions.<br><br>If you want to test speed with a more reliable benchmark, try Jim Browns collection of "<a href="http://homepage.ntlworld.com/config/share/sieve.zip" target="_blank">Sieve of Eratosthenes</a>" programs. In short, BlitzMAX is about twice as good at crunching numbers as Blitz3D and PureBasic,  and about 80% as fast as C++. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
