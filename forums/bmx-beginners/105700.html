<!DOCTYPE html><html lang="en" ><head ><title >The Error Of My Ways</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >The Error Of My Ways</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=101" >BlitzMax Beginners Area</a>/<a href="#bottom" >The Error Of My Ways</a><br><br>
<a name="1291760"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dw817</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Likely this question has been asked before so I thought I would put it in the beginner's section.<br><br>Most BASIC languages have the ability of catching errors when they occur. I'd like to be able to have this in BlitzMAX - but I don't think it's available. It works like this.<br><br>ON ERROR GOTO 1000<br>100 .. 900 .. code<br><br>1000 {{ Handle error, tell which line it occurred on AND the error code it gave }} Option to continue code.<br><br>In BASIC once you went to the error routine you can say RESUME to repeat the same line (possibly repeating the error again), OR you could say RESUME NEXT and it would SKIP over the line that had the error in it and continue back to the program.<br><br>Thus,<br><br>100 .. 900 .. code<br>Let's say line 450 has an error, an out of range<br>You already have the 'ON ERROR' routine active so instead of showing an error it jumps to 1000<br><br>At line 1000 (or label or what have you), it says error occurred in line 450, it was error #16 (let's say, out of range), and line 1010 has a wait for a key pause and then RESUME NEXT, which will return back but to the line JUST AFTER the one that made an error, let's say 460.<br><br>Is this feature available in BlitzMAX - the ability to catch any error and act on it ? <br><br></td></tr></table><br>
<a name="1291764"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GW</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Bmax doesn't have any resume mechanism like the older basic languages, but it does 'Exceptions'. <br>I've never really used them myself, I prefer my programs to halt on errors, but you can find some details in the Bmax help under 'Language'-&gt;'Exceptions' or searching for 'Exceptions' here in the forums. <br><br></td></tr></table><br>
<a name="1291776"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bobysait</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can surround codes with Try/Catch to catch "thrown" errors.<br><br><br><pre class=code>
Function do()
	Throw "stop me now !"
End Function



Function test:Byte()
	
	Try
		do()
		Return True;
	Catch err:String
		Print err
		Return False;
	End Try
	
End Function

Print "test : "+test()
</pre> <br><br></td></tr></table><br>
<a name="1291822"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dw817</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Bobysait. I'm not understanding this example. There are no errors in it ?<br><br>How about catching this,<pre class=code>Global deck[51]
For i=0 To 51
  Print deck[i]
Next</pre><br><br>Where it's clear it will crash because DECK[] is not big enough. How would you catch this with TRY/CATCH ? <br><br></td></tr></table><br>
<a name="1291830"></a>

<a name="1291832"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Try / Catch catches explicitly thrown errors (hence Bobysait's emphasis on 'thrown'). This means when code executes the Throw function (check the Bmax documentation on that).<br><br>You cannot recover from SEGFAULT (memory access errors, like invalid pointers etc.) in any way, be it in BlitzMax or C &amp; C++. When the error happens, your program has already been put in an invalid stage. The program is terminated. <br><br></td></tr></table><br>
<a name="1291835"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dw817</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Kryzon, wow that bites. Guess I'll have to write some work-arounds.<br><br>Was really hoping BlitzMAX could handle a case like this. I know it would help a lot of programmers who are putting out commercial games and software and don't want the end user to see any error messages or crashes at any time. <br><br></td></tr></table><br>
<a name="1291853"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wiebo</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you want to make that happen, write code that checks the situation before execution, or insert fail saves for user input.  Improve the quality of your code. <br><br></td></tr></table><br>
<a name="1291872"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bobysait</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think you really prefer the user to run a runtime error.  It's much better than having the application running with random behaviors that could be dangerous in the long run.<br><br>You can obviously track every instance and check "if null" / "If index&gt;0 and index&lt;length" etc ... anytime, but the code will be slow.<br><br>If your code is well writen, the only errors that will happen should be some impredictible random OS/GC Drivers errors.<br><br>If you're familiar with the debugger, you can also make the debugmode very slow using "?Debug" pre-processor, then check everything that can be checked in "?debug"<br>Your release won't care of the checks while your debug version should prevent you from lots of unexpected errors <br><br></td></tr></table><br>
<a name="1291873"></a>

<a name="1291874"></a>

<a name="1291876"></a>

<a name="1291877"></a>

<a name="1291879"></a>

<a name="1291880"></a>

<a name="1291881"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I know it would help a lot of programmers <br></div><br><br>Yeah I wanna jump in and emphasize what Wiebo said. It wouldn't help anyone at all.<br><br>Out-of-bounds errors and null-reference-exceptions are a <i>debug</i> feature. BlitzMax will help you find the error so you can fix it and make a release build that doesn't do that. Code that depends on debug mode being active has no right or reason to <b>ever</b> leave your workstation.<br><br>The way to ensure the user never sees crashes is to <i>write code that doesn't crash</i>. Anything less is completely unacceptable to deliver to a customer.<br><br><br>You can minimize the errors in your code by using generally better programming practice. For instance, you can ensure your array accesses never go out of bounds by avoiding explicit access to an array:<br><br><pre class=code>Global deck:Int[51]

' read-only
For Local c:Int = Eachin deck   'places the values directly into c
    Print c
Next

' writable
Function ForEach(arr:Int[], modify(i:Int Var))
    For Local k:Int = 0 Until arr.Length
        modify(arr[k])
    Next
End Function

Function AddOne(i:Int Var)
    i :+ 1
End Function

ForEach(deck, AddOne)  'no explicit loop either = even less room for error</pre><br>Arrays are a low-level data structure, anyway - if there's the slightest chance that this could be a problem, it's probably a sign that you should consider using a more semantically-relevant data structure in the array's place. <br><br></td></tr></table><br>
<a name="1291886"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yasha, while your code might save you from some trouble, it adds a big pile of function calls (imagine array being a dataset of 100k entries).<br><br>For me the biggest trouble is to distinguish between "to" and "until" (that is better written as "&lt;" or "&lt;="  like in a while loop or in C-for-loops).<br><br>I think problematic data is most often coming from dynamic data (user input, media data, ..) so you could sanitize it when it enters your application. Within the application problems should be avoidable by running them with debug once in a while (MaxIDE...*shivering*).<br><br><br>Nonetheless: programmers are just human, so be ready to face imperfection.<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1291893"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Function calls are dirt cheap on modern hardware. 100k function calls per frame is nothing, won't have any observable effect (if it does, it's because the function was actually doing something and is therefore inescapable). And if you use NG, the function gets inlined away and is therefore literally free anyway.<br><br>Worst thing you can possibly do when coding is let trivial concerns about optimization get in the way of writing clean code. If the compiler generates slow code when you use lots of functions, you need a better compiler. Worrying about that sort of thing is not a human's job.<br><br>Programmers are indeed human, and that's precisely why it's important to use tricks that make it difficult or impossible to express an error in the first place. The machine won't let you use ForEach above in a way that goes out of bounds, and thus it never will. Humans make mistakes when they decide not to leverage design in this way and try to do the machine's job for it, keeping track of sizes and indices manually and so on. <br><br></td></tr></table><br>
<a name="1291932"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dw817</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> You guys are going at it. :) Let me toss this into the pile and see what you think. One advantage of being able to catch errors is, you can generate your own error messages.<br><br>Who wants commercial code to CRASH with a nasty BlitzMAX message box ? Or - if you could catch the error, you could make a nice error box - like I saw someone working on a cooking in the kitchen game earlier I think ?<br><br>You could show a background picture of a woman cooking showing smoke coming out of her skillet, a comical look of surprise on her face and a message like, "Oops ! Cook-A-Lot ran into a problem. This has been logged in ERROR.TXT. Please try running this game again or if the error persists, contact our company and we will be glad to help you." <br><br></td></tr></table><br>
<a name="1291937"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Or - if you could catch the error <br></div><br><br>...I'm not seeing what the logic is in delivering code that you know has errors in it. The time you spent on that animation could have been spent looking at the source of the exception and dealing with it.<br><br>This is never excusable no matter how pretty you make it look. Heck, this isn't even primarily about the customer's experience - as a professional, how can <i>you</i> live with the thought of doing that?<br><br>Yes, in the real world, we make mistakes, things sometimes crash. But this happens ONCE, and then you fix it. You don't need to plan for the long haul, because if more than one customer ever sees the error, or they see it twice, something's gone seriously badly wrong with your entire process. If you can't deal with it, you pull the program. It's not ready to face the public in that state.<br><br>The important thing to keep at the front of your mind is that the "nasty BlitzMax message box" is <i>not BlitzMax's fault</i>. It is yours. <br><br></td></tr></table><br>
<a name="1291942"></a>

<a name="1291969"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dw817</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yasha, there is no such thing as fool-proof code. One way or another, you or I will write code that will crash on a PC some day. And the most likely culprit won't be ourselves, it will be Microsoft who keeps changing the rules with their new OS's and system libraries.<br><br><img src="http://media.meltyfan.it/article-2778846-ratio_203-f1448034202/i-10-film-che-harry-styles-renderebbe-epici.jpg"><br><br>As Inspector Gadget says, <b>"Better safe than sore."</b> :) <br><br></td></tr></table><br>
<a name="1291997"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> When you work with outside code (DLLs or whatever) you are free to run it in a try-catch-block.<br><br>So if something fails to calculate X there ... you are able to present a dialogue to the user telling him that someone borked a 3rd party dll you failed to provide with your app but relied on being available in c:\Windows\System(32)<br><br>Another example is: you externed your AI to some lua scripts - now the lua script was modified and is no longer working (old API calls or so). In that case you inform the user (or ai dev) that this is the case and the AI should be upgraded.<br><br>But, this does not count for your code, your "internal code" could be error free. Exception is dynamic code (evaluated inputs, scripts...) they should be sanitized/checked.<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1292076"></a>

<a name="1292077"></a>

<a name="1292078"></a>

<a name="1292079"></a>

<a name="1292080"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> there is no such thing as fool-proof code <br></div><br><br>Sure there is. For a start, code written in a non-Turing-complete language, or language subset (like <a href="https://en.wikipedia.org/wiki/The_Power_of_10%3A_Rules_for_Developing_Safety-Critical_Code" target="_blank">P10</a> for C), can always be fully analyzed and mathematically <i>proven</i> to be error-free at compile time (Turing-completeness is the enemy of the engineer). It's also possible to rule out large classes of errors even when using generally Turing-complete languages, e.g. the errors you describe above are guaranteed never to occur when writing in an <a href="https://en.wikipedia.org/wiki/ML_%28programming_language%29" target="_blank">ML-derived language</a>; and even if you work in a very liberal language like C, there are powerful tools that can analyze your code and identify the possible error sites for you (<a href="https://en.wikipedia.org/wiki/Frama-C" target="_blank">[1]</a>, <a href="https://en.wikipedia.org/wiki/QA-C" target="_blank">[2]</a>, <a href="https://en.wikipedia.org/wiki/CompCert" target="_blank">[3 for verifying the compiler itself]</a>).<br><br>Not all software is games. Code written for the automotive/defence/aerospace/etc. sectors doesn't have the liberty of making mistakes even once. <i>So it doesn't</i>. We should all strive to be at least that good. <br><br></td></tr></table><br>
<a name="1292148"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dw817</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yasha, BlitzMAX does not meet P10. A simple example of a crash. Someone earlier wrote code to work on their maximum resolution, and they wanted to hardware snap it for display.<br><br>Not only did that not work for me but I had to Ctrl-Alt-Del to remove the task from executables as it royally hung with a black and badly flickering pixeled screen. I thought it would damage my monitor.<br><br>You can write code that is error-proof on your computer, sure. But once you distribute it, anything goes. Someone may or may not have the same version of DirectX, OpenGL - and that's just for graphics.<br><br>Audio could be a whole new bag. Maybe they formatted their Windows on drive F instead of C ? That's the way mine upstairs is.<br><br>All these little 'nuisances' would have to be accounted for to make a 'less' error-prone model. But I cannot see at any point a program, even with just one line that will not crash or refuse to run entirely on every possible computer that was compiled to an EXE &lt;-- that's the kicker.<br><br>Yes you can write code that is error free, and send me or anyone a copy.<br>But once it is compiled to an EXE - anything goes. :) <br><br></td></tr></table><br>
<a name="1292186"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> - you can find out on which drive Windows was installed <br>- ctrl-alt-del: do you remember that Screen-resolution-change-window-countdown of 15seconds to press "OK", if not the old resolution is set again (might have helped)<br><br>If something like above stalls your app, this is not always _your_ code but a bug in an 3rd party (module) code. So this code then is not written error-prone. Nonetheless it is possible.<br><br>Something you cannot stop is broken hardware (you send data, this incarnation of a GPU does not like, that is why it powers down) - again this is not your code's fault then (it does what it is expected to do).<br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1292710"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> if you use NG, the function gets inlined away <br></div>I would like to understand this better, because I've not seen this mentioned anywhere else.<br><br>Does this happen to ALL function calls (or is there some tagging)?  Seems like it would make the executables rather bloated... <br><br></td></tr></table><br>
<a name="1292715"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> the inline-optimisations depend on some params you give to the c-compiler.<br><br>For gcc:<br>-O2 only inlines functions if it does not increase filesize<br>-O3 inlines functions if the compiler thinks it improves execution (ignoring filesize)<br><br>In all cases it inlines functions, which are only called once at all.<br><br><br>Inlining is not a direct decision of BMX-NG (but it could enforce it, or give hints like the "inline" command) but of the used C-Compiler.<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1292716"></a>

<a name="1292717"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks, Derron.  Are you saying it happens in regular BMX?  Is more information on this somewhere that I've missed?  Just wondering if those switches are made as CC_OPTS?<br><br>Would be great to have an inline hint to force it in certain cases... <br><br></td></tr></table><br>
<a name="1292740"></a>

<a name="1292741"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> vanilla BMX translates to ASM and compiles using FASM (Flat Assembler). I think this does not do such "automagically done" optimi<i>z</i>ations.<br><br>If you are talking about used C-code in the modules (compiled with gcc/minGW) then this optimization is done there too if the compiler options allow it (hope the "big brains" of the forum won't correct me now :-)).<br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1292772"></a>

<a name="1292773"></a>

<a name="1292775"></a>

<a name="1292776"></a>

<a name="1292778"></a>

<a name="1292779"></a>

<a name="1292780"></a>

<a name="1292788"></a>

<a name="1292831"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> BRL BlitzMax never inlines anything. It's not an optimizing compiler, and doesn't significantly change the code you wrote. <i>In practice</i>, this is fine for 99% of real-world uses - machine code is fast, and the BlitzMax runtime powering the backend stuff is well-written. (A huge amount of real-world code is interpreted anyway and still fast enough.)<br><br>C is compiled via GCC (unless you hacked the backend to use something else). GCC is a ludicrously powerful optimizing compiler, and thus has a whole rack of things it can do to code, of which inlining is just one small option among many. These optimizations are not available to BlitzMax code compiled with the BRL compiler, because that code goes straight from BMX to binary without passing through C in between (it passes through an x86 text representation, but this is 1:1 to final code, you can ignore it). The NG compiler uses C as its assembly language, and thus has the option to insert an "extra" optimization step <i>after</i> compilation, when the C is "assembled" by GCC.<br><br><div class="quote"> Would be great to have an inline hint <br></div><br><br>Look back up at post #9. Notice what's interesting about `modify`? It's not a function, it's a <i>function pointer</i>. GCC isn't just identifying inlinable candidate functions and marking them, then expanding at call sites - it's doing complex dataflow analysis to see that the entire indirection structure can be unwound and replaced with something simpler. You can't even come close to this level of optimization with a simple "inline" directive attached to function definitions in your code!<br><br><br>Inline hint directives are <i>totally</i> obsolete in modern programming, and C and C++ compilers will completely ignore them when optimizing normally (for code generation, anyway: they do have an unrelated semantic meaning too). The compiler simply doesn't need or want your help for this task. That's in addition to inlining becoming less relevant as a single optimization as compiler technology moves forward (e.g. modern function calls are dirt-cheap anyway; x64 has builtin support for "leaf functions", which have all of the speed of inlining with none of the drawbacks; and a decent optimizer will heavily rewrite your code, making it difficult for you to tell which calls will even remain in the final product, or what structure it will have, or whether any of the calls and jumps that do exist are to anything that was ever defined as a "function" in your source). <br><br></td></tr></table><br>
<a name="1292783"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> <i>Under the assumption of Yasha telling "the truth" (I think so :-)).</i><br><br><br>Got my "Yasha teaches us something" for today, cannot await to see what comes next.<br><br>Thanks ...again.<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1292801"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh, I thought vanilla BMX was doing <i>some</i> translation to C.  My misunderstanding...<br><br>How do we know which function calls get optimized and which don't?  I suspect your answer is that we don't care because we should just trust the compiler.  I'm not sure that's good enough...not because I'm unwilling to take your word for it but because it seems that would make it hard to find and especially fix bottlenecks.<br><br>However, your example (in post #9) does make me wonder if passed in function pointers are <i>always inlined</i>...?  That would cover the use case I was most concerned about.  I have a bunch of functions that share similar code.  I'd like to simplify them by having them call sub-functions with the shared code, but they're somewhat speed critical and I've refrained over fears of adding functions calls. <br><br></td></tr></table><br>
<a name="1292815"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just for fun, I wrote up a quick test with passed in function pointers.  Legacy BlitzMax definitely does not inline them...NG optimization was smart enough to know that I was doing the same thing a million times and gave a 0 ms result no matter how many iterations.  Heh... <br><br></td></tr></table><br>
<a name="1292837"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> does make me wonder if passed in function pointers are always inlined...? <br></div><br><br>Given that the, um, point, of function pointers is that you don't generally know until runtime what the destination of the call is going to be (the whole point of the example is that it's GCC doing something quite smart, finding a case where it can know it), this wouldn't really be possible. You could add a language feature that asked for "static function pointers only" as an argument type, but that's basically be more like macros, or C++ templates, than a normal function.<br><br>Some ideas for benchmarking optimized code without the compiler removing your test:<br><br>- put the test and the test executor in separate translation units, so the compiler can't see (at least, without LTO enabled) that the million iterations of the loop achieve nothing<br><br>- write the test loop in C so you can mark its control variables as `volatile`, which is specifically designed to disable optimizations<br><br>- in the worst-case, pass the tested function in as a volatile pointer itself; this should help defeat even LTO or putting the functions in the same translation unit<br><br>You should definitely at least try out the cleaner version of your code.<br><br><div class="quote"> How do we know which function calls get optimized and which don't? <br></div><br><br>You can always examine the emitted assembly...<br><br>More importantly, you shouldn't be thinking in terms of individual optimizations or the application of individual optimizations (e.g. a compiler might generate multiple versions of a function depending on context: an unoptimized one for external calls, a "leaf" version for fast calls within this unit, a specialized one because it's seen you often use it with "1" as the second argument, and fully inlined it in two other places that were deepest within nested loops). Instead, try profiling at a higher level. There's a profiling framework in BlitzMax floating around the forums somewhere (I think by grable?), and if you're using NG, you might be able to work out something with gprof or similar.<br><br>This will tell you what the <i>results</i> are, rather than what it's doing to get those results. You only really need to actually know what it's doing if you can see that the results are not good enough <i>and</i> don't understand which part of the code as you wrote it would account for that. <br><br></td></tr></table><br>
<a name="1292841"></a>

<a name="1292846"></a>

<a name="1292849"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> You should definitely at least try out the cleaner version of your code. <br></div>Well, "cleaner" is a bit subjective.  But smaller and easier to maintain is slower in my tests with vanilla Blitz.  It's probably fine with NG, but I haven't switched yet.<br><div class="quote"> the point of function pointers is that you don't generally know until runtime what the destination of the call is going to be <br></div>Uh, yeah...um, duh.<br><div class="quote"> that's basically more like macros <br></div>That's probably more like what I'm after here.  Some kind of pre-processing of the functions.  OTOH, I think those tend to be confusing to anyone else looking at the code. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
