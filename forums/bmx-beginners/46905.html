<!DOCTYPE html><html lang="en" ><head ><title >Makpaint.. sloooow</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Makpaint.. sloooow</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=101" >BlitzMax Beginners Area</a>/<a href="#bottom" >Makpaint.. sloooow</a><br><br>
<a name="521722"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Snarty</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi, any reason the makpaint example is pathetically slow. Before you ask, no build options are selected (ie not debug build). Makes no difference either way though.<br><br>Spec in sig <br><br></td></tr></table><br>
<a name="521723"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Perturbatio</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> driver related maybe?  it runs fine for me. <br><br></td></tr></table><br>
<a name="521733"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Snarty</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> No idea, latest Catalyst drivers. Every other OpenGL program I run is fine. Could be driver related, though a bit of an "easy way out".<br><br>Oh, plus some more "complex" examples run very smooth, and fast. <br><br></td></tr></table><br>
<a name="521768"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BlitzSupport</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Welcome back Snarty!<br><br>I'm on basically the same card and it's running properly for me. <br><br></td></tr></table><br>
<a name="521773"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >QuickSilva</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Mak Paint, I do not have that example. Where is it?<br><br>Jason. <br><br></td></tr></table><br>
<a name="521817"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Snarty</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks James :)<br><br>Hmm, no idea then. <br><br></td></tr></table><br>
<a name="521823"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Perturbatio</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> incidentally, I don't seem to have the makpaint sample in 1.09, I had to use it from 1.06 <br><br></td></tr></table><br>
<a name="521834"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Snarty</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've uploaded it for those who don't have it.<br><br><a href="http://snarty.f2o.org/examples/makpaint.zip" target="_blank">http://snarty.f2o.org/examples/makpaint.zip</a> <br><br></td></tr></table><br>
<a name="522097"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Snarty</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, I just added an fps counter, and without moving/drawing anything, it's running at 2fps, something is clearly very, very wrong!<br><br>Or is it that Pixmaps are generally a no-no for real-time stuff? <br><br></td></tr></table><br>
<a name="522102"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Pixmaps are most for creating OpenGL textures and grabbing, but they are about 10 to 100 times slower in drawing than TIMAGE <br><br></td></tr></table><br>
<a name="522103"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Snarty</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ahh, so this is generally a bad example of how to "pratically" use pixmaps. :)<br><br>Hence why it no longer appears in the examples with the dirsto I guess.<br><br>I'm guessing it's still possible to create a memory block representing image data and block copy to the backbuffer? (at a minimum of B+ speeds) <br><br></td></tr></table><br>
<a name="522110"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BlitzSupport</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> They're not generally a good idea for heavy realtime pixel manipulation, but that still doesn't stop it running smooth as silk here.<br><br>You can't directly access the back buffer memory in 'plain' OpenGL as far as I'm aware. Perhaps with extensions it's possible... <br><br></td></tr></table><br>
<a name="522112"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Snarty</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just out of interest James, are you using the same Catalyst drivers as me? (5.3)<br><br>I guess it could be the fact I run PC100 ram, but, if that were the case ProPixel would crawl on my machine since that is 100% system ram rendering. <br><br></td></tr></table><br>
<a name="522131"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Floyd</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Works fine here, even with debug on.<br><br>I have the same speed CPU and RAM as you and graphics card is much worse. <br><br></td></tr></table><br>
<a name="522135"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Perturbatio</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't know how accurate this is (nor whether it could be more efficient), but I only get 1fps more when drawing directly to the backbuffer (via plot).<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Graphics 800,600,0,0

Const ALPHABITS=$FF000000


Type TRGB
	Field Red:Int 'could use byte but int is faster
	Field Green:Int
	Field Blue:Int
	Field Alpha:Int
	
	Method AsInt:Int()
		Return ( Red| (Green Shl 8) | (Blue Shl 16))
	End Method
	
	Method FromInt(col:Int)
		Red = col Shr 16 &amp; $FF
		Green = col Shr 8  &amp; $FF
		Blue = col &amp; $FF
	End Method
	
	Method SetCol()
		SetColor Red, Green, Blue
	End Method
End Type


Local tempImage = CreateImage(256,256)
Local pMap : TPixmap
Local RGB : TRGB = New TRGB

Local LastTime:Int
Local TimeDiff : Int
Local StartTime:Int
Local timecount:Int = 0
Local counter :Int =0


While Not KeyDown(KEY_ESCAPE)

StartTime = MilliSecs()

	Cls

	'Local tempImage = CreateImage(256,256)
	pMap = LockImage(tempImage)
	
	For Local X:Int = 0 To 255
		For Local Y:Int = 0 To 255
			RGB.Red = Rand(0,255)
			RGB.Green = Rand(0,255)
			RGB.Blue = Rand(0,255)
			
			WritePixel(pMap, X,Y,ALPHABITS|RGB.AsInt())
		Next
	Next
	UnlockImage(tempImage)
			
	'DrawImageRect(tempImage, 0, 0, GraphicsWidth(),GraphicsHeight()) 
	DrawImage(tempImage,0, 0)

	

	Flip

TimeDiff = MilliSecs()-StartTime
TimeCount :+TimeDiff
counter :+ 1
FlushMem

Wend


Print TimeCount/counter +"ms/frame"
Print "FPS: "+1000/(TimeCount/counter)
tempImage = Null
pMap = Null

FlushMem()
FlushKeys()
Cls
DrawText("press any key for plot test", 10,10)
Flip

WaitKey()

LastTime = 0
TimeDiff = 0
StartTime = 0
timecount = 0
counter = 0


'plot test
'Local RGB:TRGB = New TRGB

While Not KeyDown(KEY_ESCAPE)
StartTime = MilliSecs()
Cls

	For Local X2:Int = 0 To 255
		For Local Y2:Int = 0 To 255
			RGB.Red = Rand(0,255)
			RGB.Green = Rand(0,255)
			RGB.Blue = Rand(0,255)
			RGB.SetCol
			Plot(X2,Y2)
		Next
	Next
FlushMem

Flip

TimeDiff = MilliSecs()-StartTime
TimeCount :+TimeDiff
counter :+ 1

Wend

Print TimeCount/counter +"ms/frame"
Print "FPS: "+1000/(TimeCount/counter)

End
</textarea> <br><br></td></tr></table><br>
<a name="522136"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Snarty</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, this is just plain annoying then! If I take out the main DrawPixmap pic, 0, 0 it obviously runs full pelt. But why on earth is my system choking on drawing these "pixmaps" or what ever they really are. <br><br></td></tr></table><br>
<a name="522137"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Snarty</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, I tested your "plot" test, and it gave me 10fps (4 fps with debug on), for both tests. So, that screws things up royally, considering your system is far, far faster than mine. Go figure! <br><br></td></tr></table><br>
<a name="522138"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Perturbatio</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> I should point out that I only get 20fps with the first test and 21fps with the second. <br><br></td></tr></table><br>
<a name="522146"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Snarty</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Any word on a "technical" front would be appreciated here. As this really needs addressing before I consider coding anything.<br><br>What could possibly be causing such a dramatic slowdown? Do I need to be wearing special socks or something? (as this is about as good guess as any from the feedback so far). <br><br></td></tr></table><br>
<a name="522232"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> DrawPixmap renders using the CPU, not the graphics card hardware, because it has to transfer the pixmap data over the graphics-card bus every time you render it. It's the same as uploading a texture. You would be better off turning the Pixmap into an IMAGE, and then using DrawImage - on my system for example DrawImage is at least 10x faster than DrawPixmap. <br><br></td></tr></table><br>
<a name="522233"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> So Snarty, are you considering writing a new paint package in Max? <br><br></td></tr></table><br>
<a name="522299"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Snarty</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> I may be migrating ProPixel to BMax, though it certainly wouldn't be full screen and I would probably stick to using DIB's as these are fast enough.<br><br>Btw, no idea who coded that macpaint thing. I personally wouldn't use pixmaps considering the appauling performance. Must be some very "odd" code which pushes the data to the graphic's memory. Never known anything so slow. (sorry, yes I have, plot in Spectrum BASIC :p ) <br><br></td></tr></table><br>
<a name="522325"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah if you use DrawPixmap it uses the CPU to move the data over the bus at draw-time. It's much better to cache the image on the graphics card as a texture/`image`.<br><br>Why wouldn't you be able to do a fullscreen paint program? What is a DIB? <br><br></td></tr></table><br>
<a name="522327"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Snarty</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> DIB's (Device independant Bitmaps) are what Windows friendly applications use to store graphics data in system memory, manipulate it using the system bus (usually faster) then dump to graphics memory. In the case of Windows API you can BitBlt to a selected DC (Device Context) with a few hardward tricks.<br><br>ProPixel currently uses BlitzPlus' flag 4 images (which I'm guessing are also DIB's, or System memory DirectDraw surfaces). This method is really fast, why the same performance is not available in BlitzMax is beyond me. I'm a little disheartend currently, but then I've not had a play with Max myself, just ran some examples (general image stuff is very nice), but got to my favourite example, memory manipulation (system &gt; vid) and oh dear.<br><br>Sigh.. <br><br></td></tr></table><br>
<a name="522359"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thats because the way OpenGL works. It has simply no surfaces as DirectX has which has to do with the fact that it does not have any 2D at all like DirectX.<br><br>But Mark mentioned a DirectX7 module for 2D so hopefully this kind of problems will be over, at least on windows. <br><br></td></tr></table><br>
<a name="522715"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> You could probably get around all the issues by just coming up with a different way to implement things under OpenGL. If you can work with hardware textures they are going to be plenty fast enough. It is only in areas of `reading data` that OpenGL isn't entirely friendly, like reading the backbuffer. <br><br></td></tr></table><br>
<a name="523243"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Snarty</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, sorted the problem, and in a way I'm glad the problem existed in the first place.<br><br>The problem? I needed to re-install my AGP drivers as they had reverted back to PCI mode.. sigh. Runs full speed now. :)<br><br>If anyone else has slow pixmaps in the future, check dxdiag &gt; Display and if AGP Texture Acceleration is disabled or greyed out this will cause slowdown. Go in to Device Manager and update the PCI driver to an AGP one. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
