<!DOCTYPE html><html lang="en" ><head ><title >Two types need to know about each other</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Two types need to know about each other</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=101" >BlitzMax Beginners Area</a>/<a href="#bottom" >Two types need to know about each other</a><br><br>
<a name="807674"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Czar Flavius</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Let's say I have type A and type B, and the two types need to know about each other. For a simple example:<br><br>Type A<br> Field aB:B<br>End Type<br><br>Type B<br> Field anA:A<br>End Type<br><br>How can I do this, or if this can't be done, what are the alternatives? <br><br></td></tr></table><br>
<a name="807682"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Who was John Galt?</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> It can be done. You just did it. As far as I can remember, there are no forward declaration requirements as you would get in C. Try it. <br><br></td></tr></table><br>
<a name="807687"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >CS_TBL</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is this the right thing to do however? It does make these types kinda dependent on each other. I guess it's not really a problem for one type holding a ref to another type. But what if a type must know or access more than 10 other types? 10 fields in such a type? <br><br></td></tr></table><br>
<a name="807688"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Czar Flavius</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have each type in a seperate Inlude file, and in the first file it complains it can't find the type from the second file. <br><br></td></tr></table><br>
<a name="807702"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >CS_TBL</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> you can include a file in an include file eh..<br><br><b>include1.bmx:</b><br><br>include"include2.bmx"<br><br>codeblahblah<br>codeblahblah<br><br><br><b>include2.bmx:</b><br><br>include"include1.bmx"<br><br>codeblahblah<br>codeblahblah<br><br><br><br>But of course this is all prone to chaos if you ask me..<br><br>Actually I often bump onto the same situation, I'd like some more experienced programmers to comment on this issue as well. <br><br></td></tr></table><br>
<a name="807705"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Czar Flavius</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry. I made a typo in my code. My bad.<br><br>But any design suggestions or comments would still be appreciated :) <br><br></td></tr></table><br>
<a name="807722"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I have each type in a seperate Inlude file <br></div>Dont. Simple as that. If you need this sort of cyclic refferances, then <b>put them in the same file</b> simple as.<br><br>Mind you it is stupid. Type A contains a Type B, which contains a Type A, which contains a Type B, which contains a Type A, which contains a Type B, which conatains a Type A, which etc (But I assume that it was just your example to show each type referanceing the other) <br><br></td></tr></table><br>
<a name="807732"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> But any design suggestions <br></div><br>Cyclic references can imply a bad design. <br><br></td></tr></table><br>
<a name="807774"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Czar Flavius</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well I have a game type and a shape type for my tetris game. Perhaps because I'm not an expert programmer, the two types need to know about each other for it to work. As far as I can tell, there aren't any cyclic references.<br><br>The game type has a list of shapes in play, and the shape methods need to know about what game they are updating when they do stuff. <br><br></td></tr></table><br>
<a name="807778"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sledge</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> The game type has a list of shapes in play, and the shape methods need to know about what game they are updating when they do stuff. <br></div><br><br>That does sound pretty bad*. Putting my procedural cap on, I could say that Tetris is an example of something that it's pretty safe to hard-code -- why have a 'game' type when you're only going to need one instance of it and that's what the compiler will spit out? Why modularise shapes via the type system when you're never going to plug them into any other sort of game? It's worth coming up with answers to these questions -- not because it's wrong to use OOP for Tetris but because it will help make OOP work better for you  if its remit is clearly defined in your head.<br><br>OOP hat on: Personally I would be tempted to use the type system to make a 'game' namespace containing a (global-to-the-type) list of shapes. The shapes would be a separate type but you would access them through the 'game' namespace -- ie game.shapeList.currentShape.doStuffMethod() or game.processShapesFunction()<br><br>That way 'game' and its shapes fall naturally within each other's scope without cyclic referencing.<br><br><br>* EDIT: I don't want that to sound discouragingly negative -- ultimately it looks like you simply need to firmly decide which type wears the trousers and which is subordinate. Once you have that the rest should fall into place (no pun intended).<br><br>EDIT 2!<br><div class="quote"> As far as I can tell, there aren't any cyclic references <br></div><br>If you have a game object with a list of shapes and those shapes have a field that points right back at the game instance then I think you have an unavoidably cyclic reference or two. I'd <u>guess</u> that manually setting the cyclic fields to NULL would let the garbage collector do its work, but designing code that confounds the GC in the first place should set alarm bells off. It's really about minimising, by design, the number of places in your code that mistakes can creep in. <br><br></td></tr></table><br>
<a name="807788"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Czar Flavius</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> If you have a game object with a list of shapes and those shapes have a field that points right back at the game instance <br></div><br><br>Nope. The game type has fields for the shapes. The shapes don't point at a game. Their update methods (place, rotate etc) take a game type as a parameter so they know which game to modify. The shapes themselves don't point back to the game.<br><br><div class="quote"> why have a 'game' type when you're only going to need one instance of it <br></div><br><br>I was planning to have 2-player "competitive" tetris ie two games side by side. Is it still a bad idea? <br><br></td></tr></table><br>
<a name="807798"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think that you are wrong to do it the way you are.<br><br>Sledge is totaly right, in that the shape Type shouldnt be dependent apon the Game type at all, otherwise there is no point in making it a full object.<br><br>I dont have your game design document, so obviously Im shooting in the dark, but the shape type shouldnt modify <b>anything</b> other than the shapes, it shouldnt even be aware of what its drawing the shapes to.<br><br>I would sit down and think again about how you have split your game design up into its types, and see if there are places that type "Shape" is doing things that Tyep "Game" or Type "GameDisplay" shouuld be doing.<br><br><div class="quote"> why have a 'game' type when you're only going to need one instance of it <br></div>Its a singleton, and the most basic reason is to hold all the globals in a seperate name space<br><br><div class="quote"> I was planning to have 2-player "competitive" tetris ie two games side by side. Is it still a bad idea? <br></div>Thats not a bad idea at all, I would be tempted to have a "Game" type for the single globals and a "Player" type for things that each player would need to have different from the other players ie Display, score etc<br><br>I agree with the ppl above who said that they dont like cyclic referenceing, but that doesnt mean that its wrong, just that probably one or both of the types were written/concieved before the full design doc was written. However I have a type "Chicken", which becomes a type "Egg", which becomes a type "Chicken" etc.<br><br>As a General rule, think what parameters an old fashioned subprogram would need, so for example the Update you mentioned.<br>Update needed Shape info and game info.<br>Well we know that Game is going to contain shapes so the main update should be in Game, which does all the stuff Shape cannot do <b>because it doesnt know game exists</b> then game passes update to each shape, which does its update stuff.<br><br>All this stuff depends totaly on how youve organised the whole game, but I would try when whenever possible to ensure that any type/object is as idependent of all the other objects that might contain it, as possible <br><br></td></tr></table><br>
<a name="807803"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> What you might want to try is to give your game object a ShapeManager object ( a new type. ) Each game instance has a ShapeManager and anything which involves both games and shapes is done through the ShapeManager. The shapes themselves may be controlled or read by the ShapeManager, and because the ShapeManager belongs to the game, it can do other stuff with the game too. The shapes themselves cannot and won't need to. <br><br></td></tr></table><br>
<a name="807893"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FlameDuck</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> I would do what Gabe suggests, and have a "broker" object that manages communication between the two. <br><br></td></tr></table><br>
<a name="807899"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  The game type has a list of shapes in play, and the shape methods need to know about what game they are updating when they do stuff. <br> <br></div><br>I don't fully understand why this is wrong and how it fits with the advice given or the initial question asked.<br>Isn''t this simply<br><pre class=code>
type Tgame
   field shapes_inplay:tlist   ' pointing to tshape.list
end type
type tshape
  global list:tlist=createlist()
  field parent:tgame
end type
</pre><br>I do this and don't have a problem (unless I am missing something). It matches the statement I quoted but not the original posted question so I must have confused something. <br><br></td></tr></table><br>
<a name="807974"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Czar Flavius</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for all the advice. I'll give you a simple overview of how the game works thus far.<br><br>The game type contains a list of shapes in play, as well as a 2d grid of the game board. The grid contains the information whether there is a block here, and what colour it is. It doesn't know which blocks belong to which shape.<br><br>The shape type contains a list of ie 4 points. (Point itself being a simple type with x, y.) It contains fields to know whether it is the active (player-moving) shape and the x/y position of its centre-block on the board. There are <b>no</b> fields of game type.<br><br>The shape's methods, such as rotate and place, takes game as a parameter so that it can access the grid. After looking at my code perhaps it should be the grid I'm passing rather than the actual game. The shape needs to know what's on the grid so that a. it can see if it can rotate/go there and b. it can update the block information on the grid if the action is ok.<br><br>As for the manager and broker objects, they sound really complicated for such a simple game. The system I have now works, so I don't want to make fundamental changes that might introduce bugs due to my lack of skill, just to make it more "elegant" a program without any other advantages.<br><br><div class="quote"> the shape type shouldnt modify <b>anything</b> other than the shapes, it shouldnt even be aware of what its drawing the shapes to. <br></div><br><br>In that case I don't see how else to do it, other than move all the grid-needing rotate/place/etc methods from the shape type to the game type, so shape type is now simply a list of points and a few fields and no methods. Is that what you are suggesting? <br><br></td></tr></table><br>
<a name="807986"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Difference</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Czar Flavius : What you're doing sounds perfectly fine.<br>It's perfectly ok to have a parent reference. It's usefull for all sorts of stuff.<br>I'd usually put the list in the parent type like this:<br><br><pre class=code>type Tgame
   field shapes_inplay:tlist = New tlist 
end type</pre><br>I don't get tonyg's "' pointing to tshape.list" comment.<br><br>The usefull thing is that each Tgame type can have its own list of shapes.<br>As far as I can tell tonyg ends up with only one list for the tshape type. <br><br></td></tr></table><br>
<a name="807991"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Czar Flavius</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Should I move the grid to the shape type as a global? That why the shapes won't need to ask about game at all. <br><br></td></tr></table><br>
<a name="807997"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  As far as I can tell tonyg ends up with only one list for the tshape type.  <br></div><br>Yes, that's right. I believe the design changed to have a single instance of game so there would be a single list of shapes. If there are more instances of game then they should each have a list. <br><br></td></tr></table><br>
<a name="808000"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> In that case I don't see how else to do it, other than move all the grid-needing rotate/place/etc methods from the shape type to the game type, so shape type is now simply a list of points and a few fields and no methods. Is that what you are suggesting?  <br></div>Well rotate for one could stay in the shape type. However I agree with Gab, and an intermeadiate "Display" type (or whatever) would deal with the stuff you couldnt get in TShape.<br><br>I think possibly there has been some confustion in this thread as to if we mean that "TShape" is a type of all the shapes possible, or a Type of all the Shapes in play at the moment. (At least from my part) <br><br></td></tr></table><br>
<a name="808001"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Czar Flavius</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ah. TShape..s are the shapes in play at the moment. I have a whole other TShapeTemplate ;) <br><br></td></tr></table><br>
<a name="808051"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sledge</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> The shapes don't point at a game. Their update methods (place, rotate etc) take a game type as a parameter so they know which game to modify. <br></div><br>I see. To be honest, although I understand why some will tell you not to do this, I don't think it's so awful an approach. There's a temptation to chase perfect modularity in objects but if you want to actually finish anything then at some point you have to draw a line in the sand and direct all the component parts to the specific task at hand. If 'game' and 'shape' are hopelessly interdependent but ultimately destined never to exist outside of this context then knock yourself out if that's what makes finishing easier. If that's what works for you and you've no reason to be concerned about how accessible your code is for anyone else then don't be guilted into giving it up.<br><br>Do try out a plethora of design strategies, though, as you may find to your surprise that other approaches make for even more expedient development.<br><br><div class="quote"> <br>I was planning to have 2-player "competitive" tetris ie two games side by side. Is it still a bad idea?  <br></div><br>No that sounds fine, 'game' being more analogous to 'session' than 'application'. It was just hard to tell from the word 'game' alone where your head was at.<br><br><div class="quote"> Its a singleton, and the most basic reason is to hold all the globals in a seperate name space <br></div><br>It's worth mentioning that where you would normally have single instance of a type (with fields and methods) in Max you can instead just have a namespace (with globals and functions). I find it helps me construct more semantically pleasing code but, obviously, other folks' mileage may vary. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
