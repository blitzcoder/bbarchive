<!DOCTYPE html><html lang="en" ><head ><title >Socket optimisation</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Socket optimisation</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=101" >BlitzMax Beginners Area</a>/<a href="#bottom" >Socket optimisation</a><br><br>
<a name="830496"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >spacerat</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> So I am using TCP sockets and currently I am doing it something like this:<br><pre class=code>
'---------SENDING------------
BankStream.WriteDouble(something) 
BankStream.WriteLine(somethingelse) 
Sock.Send(BankStream._bank._buf, BankStream._bank._size) 
'--------RECIEVING--------------
Local Buf:Byte[Sock.ReadAvail()] 
sock.Recv(Buf, sock.ReadAvail) 
BankStream.Write(Buf, sock.ReadAvail) 
 
BankStream.Seek(0) 
'interpret
Print BankStream.ReadDouble() 
Print Bankstream.ReadLine() </pre><br><br>Notice how I send off the whole message in one send() function, and same with receiving. I have a feeling that this is faster for the network put possible slower on the cpu because I am using the bank streams.<br><br>The other way is simply this:<br><pre class=code>
'---------SENDING------------
SockStream.WriteDouble(something) 
SockStream.WriteLine(somethingelse) 
'--------RECIEVING--------------
Print SockStream.ReadDouble() 
Print Sockstream.ReadLine()</pre><br><br>What I want to know is this: is this any slower (..or faster) than my top method? <br><br></td></tr></table><br>
<a name="830576"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >deps</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Doesn't you have to check the return value from Socket.Send, to see if there is still things left to send? If I remember correctly you should not send more than 512 bytes at a time. But that might be different on different platforms.<br>But it looks like you are sending much less than that. :)<br><br><br>I believe that the "other way" is faster, since the computers doesn't have to work with the banks. No middle hands, just the stuff and the internet tubes. <br><br></td></tr></table><br>
<a name="830583"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FlameDuck</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> If I remember correctly you should not send more than 512 bytes at a time. But that might be different on different platforms. <br></div>You shouldn't send LESS than 512 bits (64 bytes). There isn't really an upper limit to packet side since there's no way you can know the MTU (or congestion) of every device on the way to your destination (although a qualified guess would be a MTU of 1300 bytes).<br><br>It depends on whether the SocketStream is buffered, or whether it simply sends off packets as they arrive. The buffered operation is clearly faster, since you're wasting much less bandwidth. (Sending a double for instance is only 4 bytes, the minimum frame size of an Ethernet frame is 64 bytes, I don't recall if the headers down through the TCP/IP stack add 60 bytes worth of overhead, but if they don't the Ethernet driver will automatically pad the frame before sending out on the interface). <br><br></td></tr></table><br>
<a name="830594"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paposo</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello.<br><br>If you use the code inside a bucle the creation of receiving buffer need free the bank after use it.<br>Make you the send and receive buffer before the bucle and reuse it.<br>If you not use bucle not need speed up the code. the time consumed is very small.<br><br>Bye,<br>    Paposo <br><br></td></tr></table><br>
<a name="830920"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >spacerat</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Flameduck, how come you shouldn't send less than 64 bytes?    I always thought it didn't _really_ matter, and just stuck by the rule "if you can send less packets without screwing anything up, do it.".<br><br>Also I think that I'm going to use my first method now anyway, especially for reading. I've found that reading everything into a buffer then reading out of that buffer causes a lot less problems than reading from a socket stream when something goes wrong. To be honest, using the banks in order to speed up the actual network stuff is a good trade-off... I think. <br><br></td></tr></table><br>
<a name="830935"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FlameDuck</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Flameduck, how come you shouldn't send less than 64 bytes? <br></div>Because the Ethernet interface, will pad it to a 64 byte frame anyway, which is the smallest frame allowed on an Ethernet interface. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
