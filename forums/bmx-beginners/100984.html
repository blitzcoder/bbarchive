<!DOCTYPE html><html lang="en" ><head ><title >Encrypt and Unencrypt a text file</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Encrypt and Unencrypt a text file</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=101" >BlitzMax Beginners Area</a>/<a href="#bottom" >Encrypt and Unencrypt a text file</a><br><br>
<a name="1196649"></a>

<a name="1196651"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Takis76</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello my friends,<br>I am looking some idea how to encrypt one text file.<br><br>I have my level editor which generates the game adventure which saved and is readable and the player can cheat the adventure.<br><br>The file contents are similar to .ini file contents and you easily able to read the contents (I want the adventure file created my the level editor be easy readable) to able to make easy changes in the exported game adventure, during the construction of the adventure only.<br><br>But when you have finish and want to distribute your adventure with the game you don't want your adventure be readable because the (Players cheaters) when they will stuck playing your adventure created from the level editor easily will change the map, or remove some door or add some item.<br><br>So is it possible to encrypt my exported adventure.txt file and then when my editor will load the adventure will unencrypt the file (Back to its original readable format) will load the adventure and then will delete the the unencrypted file, but the adventure will be loaded in the memory and the player will play the game and there will not be any unencrypted file because the file will be delete after load.<br>Also if is possible to use some key encryption code will be very nice. So the cheater will must know the key to unencrypt the file.<br>Also need to know which was the encryption algorithm.<br> <br>Sure players will not bother to unencrypt and cheat the adventure then.<br><br>The file is a plain text file like:<br><br><pre class=code>
[PARTY ENTRY]
Party start level:01
Party start map x:01
Party start map y:01
Party start direction:EAST

[LEVEL01]
Level Description:Level Discription
02020202.01010101.02020202.01010101.02020202.01010101.02020202.01010101.02020202.01010101.02020202.01010101.02020202.01010101.02020202.01010101.02020202.01010101.02020202.01010101.02020202.01010101.02020202.01010101.02020202.01010101.02020202.01010101.02020202.01010101.02020202.01010101.02020202.01010101.02020202.01010101.02020202.01010101.02020202.01010101.02020202.01010101.
01010101.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.02020202.
02020202.00000000.02020202.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.01010101.
01010101.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.02020202.
02020202.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.01010101.
01010101.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.02020202.
02020202.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.01010101.
.
.
.

[DOORS]
blah blah
</pre><br><br>I use WriteFile("adventure.txt")<br>WriteString(my_file, "Party start direction:NORTH")<br>and<br>WriteLine(my_file,"")<br>commands to save my adventure.<br>My length of lines are more than 256 characters long.<br>And I use ReadString() and ReadLine() commands to load the data back to viariables<br><br>Any easy idea? (Thank you very much). :) <br><br></td></tr></table><br>
<a name="1196748"></a>

<a name="1196749"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Henri</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello,<br><br>there was similar discussion in <a href="/posts.php?topic=100874" target="_blank">this</a> thread.<br><br><br>-Henri <br><br></td></tr></table><br>
<a name="1196752"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Takis76</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes I saw this one, but I haven't understood how is working and I manage to encrypt and decrypt my text file, but I after decrypting there are garbage at the end of the file.<br>Also after decrypting the file loses all line return chr(13) at the end of each line and I see the file as row.<br><br><pre class=code>
[PARTY ENTRY]Party start level:01Party start map x:01Party start map y:01Party startdirection:EAST
</pre><br>Do you know how to fix the line return at the end of each line and how to remove the garbage at the end of the file? <br><br></td></tr></table><br>
<a name="1196753"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Takis76</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I found another one nice code and it seems my problem was solved.<br><br>The example with the text file in original exported format from the level editor.<br>Creates another one text file the encrypted one which is scrambled.<br>And the load the scrambled file back to the original.<br><br><pre class=code>
Global encryption_key:String = "some key"

Local Bank:TBank = Cipher.Encrypt(LoadBank("adventure.txt"), "some key")
SaveBank(Bank, "encrypted.txt")

Bank = Cipher.Decrypt(LoadBank("encrypted.txt"), "blah")
SaveBank(Bank, "adventure22.txt")


</pre><br><br>Encryption and Decryption code:<br><br><pre class=code>
Type Cipher

	Function Encrypt:TBank(Bank:TBank, Key$)
		Local t:Int=10, n:Int, ki:Int
		Local Out:TBank = CreateBank(Bank.Size())
		Local inptr:Byte Ptr = BankBuf(Bank)
		Local outptr:Byte Ptr = BankBuf(Out)
		For n=0 Until key.length
			Select n Mod 2
		 		Case 0 ; t:*key[n]
				Case 1 ; t:+key[n]
			EndSelect
			t:Mod 360
		Next
		For n=0 Until Bank.Size()
			outptr[n]=inptr[n]+Floor(Cos(t)*255)
			t:+(inptr[n]*key[ki])+n
			t:Mod 360+inptr[n]
			ki:+1
			If ki=&gt;key.length ki=0
		Next
		Return Out
	EndFunction

	Function Decrypt:TBank(Bank:TBank, Key$)
		Local t:Int=10, n:Int, ki:Int
		Local Out:TBank = CreateBank(Bank.Size())
		Local inptr:Byte Ptr = BankBuf(Bank)
		Local outptr:Byte Ptr = BankBuf(Out)
		For n=0 Until key.length
			Select n Mod 2
		 		Case 0 ; t:*key[n]
				Case 1 ; t:+key[n]
			EndSelect
			t:Mod 360
		Next
		For n=0 Until Bank.Size()
			outptr[n]=inptr[n]-Floor(Cos(t)*255)
			t:+(outptr[n]*key[ki])+n
			t:Mod 360+outptr[n]
			ki:+1
			If ki=&gt;key.length ki=0
		Next
		Return Out
	EndFunction

EndType





Function RC4:String(inp:String, key:String)
    Local S%[512+Ceil(inp.Length*.55)]
    Local i%, j%, t%, x%
    Local outbuf@@ Ptr = Short Ptr(Varptr s[512])
    
    j = 0
    For i = 0 To 255
        S[i] = i
        If j &gt; (Key.length-1) Then
            j = 0
        EndIf
        S[256+i] = key[j]&amp;$ff
        j:+ 1
    Next
    
    j = 0
    For i = 0 To 255
        j = (j + S[i] + S[256+i]) &amp; $ff
        t = S[i]
        S[i] = S[j]
        S[j] = t
    Next
    
    i = 0
    j = 0
    For x:Int = 0 To inp.Length - 1
        i = (i + 1) &amp; $ff
        j = (j + S[i]) &amp; $ff
        t = S[i]
        S[i] = S[j]
        S[j] = t
        t = (S[i] + S[j]) &amp; $ff
        outbuf[x] = (inp[x] ~ S[t])
    Next
    
    Return String.FromShorts(outbuf, inp.Length)
End Function
</pre> <br><br></td></tr></table><br>
<a name="1196754"></a>

<a name="1196755"></a>

<a name="1196756"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Henri</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Alright, I modified the original function a bit. Here is a example:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Strict

Local crypted:String,decrypted:String
Local key:String = "iniwwldlkk2352534"
Local text:String =	"[PARTY ENTRY]~n"+..
"Party start level:01~n"+..
"Party start map x:01~n"+..
"Party start map y:01~n"+..
"Party start direction:EAST~n"+..
"~n"+..
"[LEVEL01]~n"+..
"Level Description:Level Discription~n"+..
"02020202.01010101.02020202.01010101.02020202.01010101.02020202.01010101.02020202.01010101.02020202.01010101.02020202.01010101.02020202.01010101.02020202.01010101.02020202.01010101.02020202.01010101.02020202.01010101.02020202.01010101.02020202.01010101.02020202.01010101.02020202.01010101.02020202.01010101.02020202.01010101.02020202.01010101.02020202.01010101.02020202.01010101.~n"+..
"01010101.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.02020202.~n"+..
"02020202.00000000.02020202.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.01010101.~n"+..
"01010101.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.02020202.~n"+..
"02020202.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.01010101.~n"+..
"01010101.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.02020202.~n"+..
"02020202.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.01010101.~n"+..
".~n"+..
".~n"+..
".~n"+..
"~n"+..
"[DOORS]~n"+..
"blah blah"

'Crypt original text
crypted = RC4(text,key)

'Save crypted text to file
SaveString(crypted,"crypted.txt")

'Load crypted textfile
decrypted = RC4(LoadString("crypted.txt"),key)
Print decrypted




' This function encrypts and decrypts a string with the use of a key
Function RC4:String(inp:String, key:String)
	Local S:Byte[256] ' 255 byte Arrays
	Local K:Byte[256]

	Local i:Int,j:Int,t:Int,temp:Int,y:Int
	Local Output:String

	For i = 0 To 255
		S[i] = i
	Next

	j = 1
	For i = 0 To 255
		If j &gt; key.length
 			j = 1
		EndIf
		K[i] = Asc(Mid(key,j,1))
		j:+ 1
	Next

	j = 0
	For i = 0 To 255 '
		j = ( j + S[i] + K[i] ) &amp; 255
		temp = S[i]
		S[i] = S[j]
		S[j] = temp
	Next

	i = 0
	j = 0
	For Local x = 1 To Len(inp)
		i = (i + 1) &amp; 255
		j = (j + S[i]) &amp; 255
		temp = S[i]
		S[i] = S[j]
		S[j] = temp
		t = (  S[i] + ( S[j] &amp; 255 )  ) &amp; 255
		y = S[t]
		Output:+ Chr(Asc(Mid(inp,x,1)) ~ Y)
	Next
	
	Return Output$
EndFunction
</textarea><br><br><br>This is a generic way of doing this, but should be easily adapted.<br><br>-Henri<br><br>EDIT: Seems you where faster by a minute :-) <br><br></td></tr></table><br>
<a name="1196819"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Takis76</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Your second code loaded my file correctly without garbage at the end but there is no return character in each line "~n"<br><br>I used the code you have above for RC4 algorithm with the example bellow.<br><pre class=code>
Global my_file1:TStream = ReadFile("adventure.txt")
Global my_encrypted:String, my_decrypted:String
Global my_data1:String
While Not Eof(my_file1)
	my_data1:+ReadLine(my_file1) + "~n"
Wend
CloseStream(my_file1)
'Crypt original text
my_encrypted = RC4(my_data1, "key")
'Save crypted text to file
SaveString(my_encrypted, "crypted.txt")
'Load crypted textfile
my_decrypted = RC4(LoadString("crypted.txt"), "key")
'Save decrypted text to file
SaveString(my_decrypted, "decrypted.txt")
</pre><br><br>The code worked but the "~n" characters wasn't written after decrypting.<br>I see continuous row file again.<br>Also with your code I don't have the encryption and decryption codes separately.<br>As I understood your code reads the encrypted code and decrypt it automatically.<br>If the code is not crypted, encrypts and if is it crypted , decrypts.<br>But never mind.<br><br>Why are you using savestring instead of writefile? <br><br></td></tr></table><br>
<a name="1196861"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Henri</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello,<br><br>the newline character is there even if notepad shows everything in one line (try opening with notepad++ to see).<br><br>To show your text correctly in notepad modify this code line:<br><pre class=code>my_data1:+ReadLine(my_file1) + "~n"</pre><br>...to this:<br><pre class=code>my_data1:+ReadLine(my_file1) + "~r~n"</pre><br><div class="quote"> Why are you using savestring instead of writefile?  <br></div><br>No particular reason.It just fitted in my example, but you can use what ever fits your needs.<br><br>-Henri <br><br></td></tr></table><br>
<a name="1197019"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Takis76</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> What is the difference between ~r and ~n<br>Suppose -n adds a newline.<br>And -r returns a new line.<br>Do both return a new line?<br>Or ~n adding a new line must return it.<br>If I will put ~r only?<br><br>Your code worked. I load my data in notepad and I would like to see them in notepad.<br>Thank you for correction of the code.<br>Which lines of codes do the encryption only and which lines do the decryption only? <br><br></td></tr></table><br>
<a name="1197025"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Henri</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> What is the difference between ~r and ~n <br></div><br>In historical sense ~r (Carriage return) tell's printer to return printhead back to left side and ~n (new line) tell's printer to anvance paper by one line.<br>Different systems might implement line break a little bit differently, but in Windows enviroment the standard way is ~r~n in unison and in this order. Of course it's up to viewing software to implement this correctly (usually the ~n is sufficient).<br><br><div class="quote"> Which lines of codes do the encryption only and which lines do the decryption only?  <br></div><br>The way the RC4-function operates it essentially flips the source text. so if the text is crypted then the function decypher's the text and vice versa. You could easily make supporting functions like crypt() and decrypt() and add a marker at the start of your file to signify wether it is crypted or not if you'd like.<br><br>-Henri <br><br></td></tr></table><br>
<a name="1197363"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Takis76</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> SO every time you run the function flips (Encrypted/Decrypted)<br><br>It works and I see the lines correctly with notepad too.<br><br>Thank you very much. <br><br></td></tr></table><br>
<a name="1199338"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BLaBZ</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Whoa! Use LoadText() instead of reading it line by line. You'll then have the data exactly how you saved it. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
