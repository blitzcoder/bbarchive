<!DOCTYPE html><html lang="en" ><head ><title >Memory error when setting up an array</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Memory error when setting up an array</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=101" >BlitzMax Beginners Area</a>/<a href="#bottom" >Memory error when setting up an array</a><br><br>
<a name="1134613"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >CandlestoneDave</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Guys<br><br>I have been getting an error message after writing a new function. I have narrowed it down to one line of code, which is setting up a new array. I have some very large arrays in the code:<br><br>Global world [1100,1100,210]<br>Global light [1100,1100,210]<br>Global state[1050,1050,210]<br><br>It doesn't matter what order they are in, it is always the last one that triggers the error.<br><br>Is there a maximum amount of memory allowable for arrays? Must they be a certain size, or is it possible to allocate more memory to them?<br><br>Thanks<br><br>Dave<br><br>The error message was:<br><br>mygame(791,0xa074e540) malloc: *** mmap(size=926101504) failed (error code=12)<br>*** error: can't allocate region<br>*** set a breakpoint in malloc_error_break to debug<br>mygame(791,0xa074e540) malloc: *** mmap(size=926101504) failed (error code=12)<br>*** error: can't allocate region<br>*** set a breakpoint in malloc_error_break to debug <br><br></td></tr></table><br>
<a name="1134618"></a>

<a name="1134619"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Is there a maximum amount of memory allowable for arrays? <br></div><br><br>There's a maximum amount of memory available to 32-bit applications, and it looks like you've gone over it. That's a <i>huge</i> amount of memory... do you really intend to have two hundred million objects in your scene?<br><br>(This is one reason why there's a thread asking for 64-bit support.)<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1134627"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xlsior</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Those arrays take up about one gigabyte each (1100*1100*210*4). The three of them will require ~3GB total.<br><br>Under 32-bit, windows will allow a single application to access up to 2GB of RAM, total. The only way around that is to either apply some windows tweaks that can extend it to 3GB (but your app still wouldn't work on 'stock' windows), or  monkey around with some special virtual memory approach.<br><br>Realistically, there is no way you'll be able to use arrays that large from a 32-bit application. <br><br></td></tr></table><br>
<a name="1134628"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >CandlestoneDave</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the feedback. I really appreciate it. <br><br>It's time I started to think less ambitiously, or start being smarter about how I handle the data. <br><br></td></tr></table><br>
<a name="1134697"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TaskMaster</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just stream sections of your map to/from the disk in much smaller chunks.<br><br>That seems unnecessary, makes me wonder what you are actually doing?!?! <br><br></td></tr></table><br>
<a name="1134739"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Azathoth</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Why do you need them this large? <br><br></td></tr></table><br>
<a name="1134743"></a>

<a name="1134744"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jesse</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yea, that's ridiculously large specially considering that they are objects. If you post a description of what you are doing maybe we can figure out an alternative for you.<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1134839"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SystemError51</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wow man, you're trying to put a square into a circle with those super-arrays O_O . So far there's not going to be a 64-bit B/Max. Like Jesse said, if you're telling us what you're trying to pull, we may be able to figure out another way. <br><br></td></tr></table><br>
<a name="1134840"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >CandlestoneDave</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Guys. Thanks for the help. You are right. I am trying to squeeze too much out of an array. I have reduced the size of them by half, and ditched one of them and I am fine.<br><br>But there is probably a much better way to do what I am doing, if you have some ideas.<br><br>Basically, I have a 3D world displayed in an isometric graphics. 1000 x 1000 x 120 high.<br><br>I would like to move around the world without stopping for load times. I have accomplished this already, but no doubt it isn't managing memory effectively. <br><br>The first array stores the value that dictates what kind of block it is.<br><br>The second array is storing the data for the level of light on each block. I can probably add another notch in the first array to hold this data, but I don't know if it would use less memory anyway. - Oh just had an idea. I don't need to know the light for every block in the whole world, only the world we can see. A big saving there already.<br><br>Cheers<br><br>Dave <br><br></td></tr></table><br>
<a name="1134864"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jesse</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> do you really need it 120 high? it's king of a lot considering its an isometric tile map.<br><br>also instead of saving all of your data in objects why don't you save it in an integer array.<br>use the first 8 bits(0-255), the next 8 bits(0-255) for the light and the next 8 bits... for the state, and it will also leave you 8 bits... for anything else you want to do with it. <br><br>I mentioned the values between 0-255 because thats what you mentioned in a previous thread. <br><br><div class="quote"> <br>I would like to move around the world without stopping for load times.<br> <br></div><br>if you use threading you wont have to wait but you will have to be creative at loading the various parts. you can load a certain segment only when approaching close to it. that way it will look fluid, not worry about load time,  and you can make it the map any size you want. <br><br></td></tr></table><br>
<a name="1134929"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >CandlestoneDave</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Threading? Just read up on it, and it opens up a world of possibility. Thanks so much. <br><br></td></tr></table><br>
<a name="1134945"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SystemError51</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> 120 elevations is quite a big high. My maps are probably gonna be a maximum of 1024x1024 grids, with maybe 4 or 5 elevations tops (units move up a cliff or something).<br><br>You could do this with<br><br><pre class=code>Field   Game_Grid  : Int[1024,1024,5]</pre><br><br>Each of those values has either True or False, depending if a tile is occupied or not.<br><br>The field above produces and array of 5,242,880 integers.<br><br>This saves a lot of memory and you can easily create methods to manipulate the state of a tile on the fly. <br><br></td></tr></table><br>
<a name="1134954"></a>

<a name="1134955"></a>

<a name="1134956"></a>

<a name="1134957"></a>

<a name="1134958"></a>

<a name="1134959"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hiya,<br><br>@SystemError51<br><br>As you're only storing true or false in your array, for an instant memory saving just declare the array as :Byte, if you wanted maximum saving then store each entry at the bit level.<br><br>:-<br><pre class=code>
Global IntegerArray:Int[1024,1024,5]	' 5 levels up
Global ByteArray:Byte[256,256,5]	' 5 levels up
Global BitArray:Int[32,32,1]		' 32 levels up

Print SizeOf(IntegerArray)
Print SizeOf(ByteArray)
Print SizeOf(BitArray)
</pre><br><br>To be honest what with all computers having thousand of meg of memory, it's probably not worth the saving to go to the bit level, but it would make a difference in speed when saving and loading files. Food for thought.<br><br><font class="tiny">Last edited 2012</font><br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1135142"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'd imagine you have a lot of empty cells in this array meaning an entirely different data structure is probably going to be better in the long run for memory efficiency... <br><br></td></tr></table><br>
<a name="1135148"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="http://www.fileformat.info/mirror/egff/ch09_03.htm" target="_blank">Run Length Encoding 1</a><br><a href="http://wiki.multimedia.cx/index.php?title=Run_Length_Encoding" target="_blank">Run Length Encoding 2</a> <br><br></td></tr></table><br>
<a name="1136561"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BLaBZ</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Why don't you do some sort of post array initialization?<br><br>Something like <br><br>World.AddTile(x)<br>World.AddTile(z)<br>etc.<br><br>World.Initialize() 'Count all of the tiles added and create array based off of this data <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
