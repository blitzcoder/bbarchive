<!DOCTYPE html><html lang="en" ><head ><title >Drawing tiles in fractional coords, nasty flick</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Drawing tiles in fractional coords, nasty flick</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=101" >BlitzMax Beginners Area</a>/<a href="#bottom" >Drawing tiles in fractional coords, nasty flick</a><br><br>
<a name="976512"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rixarn</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi!<br><br>I'm doing a simple tile engine that draws itself nice when i scrolling using integer number, but when i use floating numbers for scrolling i get a nasty flickering while drawing.<br><br>I've searched the forums and it seems this is a know problem, but havent found a know solution. Is there any?<br><br>So far, the best workaround i have done is setting the image flag to maskedimage only, and it disables the antialias of the image... but that's the best i could do...any advice?<br><br>Thanks! <br><br></td></tr></table><br>
<a name="976516"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_Skully</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is there a particular reason you need fractional scrolling?  why not just store the number as a float but cast it to int when drawing?  Generally speaking, no-one is going to notice fractions of scroll anyway unless things move incredibly slowly <br><br></td></tr></table><br>
<a name="976529"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rixarn</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey man, thanks for asking :)<br><br>Well, the main reason is because i want the character to travel the same distance per cicle, no matter what direction he's moving. If he moves in diagonals, he moves faster! <br><br>A quick example:<br><br>Let's set the start point at 0,0 and character speed at 3, and let's assume i move my character for 1 cicle to the right..<br><br>he landed at 3,0 so, the total distance made is 3<br><br>Now ill move my character to bottomright.<br><br>Each cicle the code will check if keydown(key_blah) = true then move character to that direction. So far so good, but in the same cicle the character will move 3 pixels to the right, and 3 pixels to the bottom since both keys are pressed. <br><br>so at the end of the cicle, he lands at 3,3<br><br>the distance from 0,0 to 3,3 is as much as 40% longer than the distance to either 0,3 or 3,0<br><br>In other words, if my tile is made of 2 triangles, and you start moving from 0,0 to bottomright ,you actually move over the long line of the triangles. The character ended up moving 4.2426blah pixels while moving in diagonal vs 3 pixels while moving in straight lines ... so technically the character moves faster when moving in diagonal, as much as 40% faster.<br><br>The only way of making the character travel the same distance if he moves in diagonals is decreasing it's speed in the move logic. In the previous example, if the character is moving bottomright then the speed should be set to 1.7573blah instead of 3.<br><br>This way, landing at 1.75blah,1.75blah he's trully traveling the same distance...<br><br>If i don't use floats then i cant use that fix , that's why i cant cast :( <br><br></td></tr></table><br>
<a name="976531"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_Skully</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh I get that...but why not render the map at an integer location and use that offset to place the character instead of trying to render your map at a float value? <br><br></td></tr></table><br>
<a name="976537"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rixarn</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Because at some point, the thing that will be "moving" it's the map and not the character (when camera is chasing the character for example) If the character "moves" in diagonal, the resulting cords for the map have to be floating values if i want to use that fix..<br><br>Or..I don't know if i understand what you´re trying to tell me, lol ... <br><br></td></tr></table><br>
<a name="976540"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_Skully</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Lets say your "camera" is at 5.123235, 32.37<br><br>When you call to render the map just int them... 5,32 and then draw your player relative to 5,32 rather than 5.123235,32.37 since you already have a "chasing" camera it shouldn't be an issue really. <br><br></td></tr></table><br>
<a name="976542"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nate the Great</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I am not sure if you are farmiliare with it but the int function always comes in handy... do everything at floating values except this... in each of your drawimage img,x#,y# functions chang it to<br><br>drawimage img,int(x#),int(y#)<br><br>problem solved :) <br><br></td></tr></table><br>
<a name="976553"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rixarn</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Nate, I'm familiar with casting variables, and that was also the solution _Skully suggested too... but i'm afraid that solution doesn't work for mi tile engine. I tried to cast the floats to int and see if that works. But the scrolling is not working quite right. As soon as i move in diagonals the thing is messed up. :( the top row of tiles are 1 pixel off from the correct location, dunno why...<br><br>BTW, so far i can't notice a big diference between FILTEREDIMAGE's and non Filtered ones when drawing them all together for the tilemap, perhaphs i'm not paying attention? if there is no easy solution i'm think i'll just leave it that way :| <br><br></td></tr></table><br>
<a name="976631"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Use doubles?<br><br>I am presuming maybe it's because floats are not quite accurate enough and maybe when you want to say 0.9 it's really saying 1.0 or whatever. <br><br></td></tr></table><br>
<a name="976646"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_Skully</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> not really seeing any code its hard to determine what might be causing that... are you drawing your map from left to right and giving it starting coordinates... and that starting coordinate is what is "off?" <br><br></td></tr></table><br>
<a name="976659"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rixarn</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> @ImaginaryHuman haven't tried with doubles but i think i will and see what happens, thanks.<br><br>@_Skully You´re right man, without any code is hard, so...I'll post some of it, but i need to change my comments to English because they are in Spanish :) and i'm still working on the collision system. As soon as i finish that i'll post it :) <br><br></td></tr></table><br>
<a name="976681"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Floyd</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you are using PNGs with alpha then maybe they just need to be <a href="/posts.php?topic=83445#941454" target="_blank">defringed</a>. <br><br></td></tr></table><br>
<a name="976690"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rixarn</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Floyd yes, i'm using PNGs with alpha. I'll do the defringe thing then and see how that works, then post the results back, thanks! <br><br></td></tr></table><br>
<a name="976886"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rixarn</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Floyd i've used the code to defringe my png's. It looks better, but there´s still a flickering in the tiles (it's less evident now, but still there im afraid). Think I can live with the images being drawn with maskedimage flag only, because I didn't noticed a big difference removing the filteredimage flag.<br><br>@ImaginaryHuman Doubles didn't worked for me. I'm think this has to do with the way i designed the engine...<br><br>Anyways, i'm almost done with what i need the engine to do for now... I'll still post the code when i'm done in the showcase area. (I'm sure mine is at the most, Yet Another regular TileEngine :) )<br><br>Thank you all guys for your help :) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
