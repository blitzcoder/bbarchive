<!DOCTYPE html><html lang="en" ><head ><title >Image scaling</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Image scaling</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=101" >BlitzMax Beginners Area</a>/<a href="#bottom" >Image scaling</a><br><br>
<a name="875239"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AltanilConard</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm trying to write a method that scales an image file. As SetScale gives a bit of a blurry and anti-aliased effect and the images I'm trying to scale have very few pixels I think it would be better to write a custom method. What I want is that every pixel in the image gets multiplied by a given amount; so when you're scaling an image by the factor 4, every pixel in the image will turn into a 4x4 rectangle. <br>I hope this does not sound to confusing. I think the function I have works, but that I'm doing something wrong with the reading/writing/creating of pixmaps/images. I don't have much experience with the modification of pixmaps, so could someone please have a glance at my method and look what is wrong?<br><pre class=code>
	Method scaleImage(_im:TImage, _sx:Int, _sy:Int)
		Local im:TImage, pm:TPixmap, pm2:TPixmap, w:Int, h:Int
		Local x:Int, y:Int, x2:Int, y2:Int, pix:Int
		
		w = _im.width
		h = _im.height
		im = TImage.Create(w, h, 1, 0, 0, 0, 0)
		pm2 = CreatePixmap(w * _sx, h * _sy, PF_RGB888)
		
		DrawImage(_im, 0, 0)
		pm = GrabPixmap(0, 0, w, h);Cls
		
		For x = 0 Until w
			For y = 0 Until h
				For x2 = 0 Until _sx
					For y2 = 0 Until _sy
						WritePixel(pm2, pm.ReadPixel(x,y), x * _sx + x2, y * _sy + y2)
					Next
				Next
			Next
		Next
				
		im.pixmaps[0] = pm2
		DrawImage(im,0,0);Flip;WaitKey()
	End Method
</pre><br>I'm getting the error: "Unhandled exception: Pixmap coordinates out of bounds" (highlighting the WritePixel line). <br><br></td></tr></table><br>
<a name="875243"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> You need <b>For x = 0 To w - 1</b>, and <b>For y = 0 to h - 1</b>. <br><br></td></tr></table><br>
<a name="875248"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AltanilConard</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Isn't that the same as <i>For x = 0 Until w?</i><br>It didn't work, I think there is something wrong with the pixmaps but I really can't figure out what. When I change <i>"WritePixel(pm2, pm.ReadPixel(x,y), x * _sx + x2, y * _sy + y2)"</i> to <i>"WritePixel(pm2, pm.ReadPixel(1,1), 1, 1)"</i> I'm getting the same error. <br>When I draw <i>pm</i> after grabbing it from screen it draws the image correct, so there's probably something wrong with <i>pm2</i>.<br>Thanks for the help Gfk, any idea what else it can be? <br><br></td></tr></table><br>
<a name="875249"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SebHoll</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> You need For x = 0 To w - 1, and For y = 0 to h - 1.  <br></div><br>There is nothing wrong with the <b>Until</b> Conard has used - it does the same thing.<br><br>You are going to kick yourself, but I think the actual problem you have is simply from you writing the parameters in the wrong order for <b>WritePixel</b> (from the docs): ;-)<br><br>WritePixel( pixmap:TPixmap,x,y,argb )<br><br>You have put the pixel before the coordinates in your line, therefore, it should be changed to:<br><br><pre class=code>WritePixel(pm2, x * _sx + x2, y * _sy + y2, pm.ReadPixel(x,y))
</pre> <br><br></td></tr></table><br>
<a name="875251"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AltanilConard</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks a lot, it works perfectly now! Yes, I do feel stupid ^^. <br><br></td></tr></table><br>
<a name="875274"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AltanilConard</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've got some more problems. In my code I'm turning the original image into a Pixmap by drawing the image and then using <i>GrabPixmap</i>. For this however, I will have to clear the screen so all the things that are allready there won't come on the image. This means I will lose what ever there was on the screen before the scale... Ofcourse I could save the entire screen in an image and then draw it again at the end of the method; but is it also possible to turn an image directly into a pixmap?<br>Also, the scaled image doesn't get 'maskblended' anymore, it has a black background when I draw it (blend is set to MASKBLEND, image flag also contains MASKEDIMAGE, maskcolor is set to (0, 0, 0)). Anyone know what the problem might be? <br><br></td></tr></table><br>
<a name="875276"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Vilu</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> As SetScale gives a bit of a blurry and anti-aliased effect and the images I'm trying to scale have very few pixels I think it would be better to write a custom method. <br></div><br><br>I believe AutoImageFlags defaults to "MASKEDIMAGE | FILTEREDIMAGE | MIPMAPPEDIMAGE". Take out the FILTEREDIMAGE and I see if it gets rid of the anti-aliasing.<br><br><pre class=code>AutoImageFlags MASKEDIMAGE | MIPMAPPEDIMAGE</pre> <br><br></td></tr></table><br>
<a name="875278"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >QuickSilva</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Conard, correct me if I am wrong but try using the command AutoImageFlags 0 at the beginning of your program and then try scaling your image up. It will then retain its full pixel quality.<br><br>If this s not what you are aiming for then please ignore me ;)<br><br>Jason. <br><br></td></tr></table><br>
<a name="875279"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Guys.  If an image is 100 pixels wide, then you read the pixels from 0-99 - not 0-100.  That's what I was getting at - you clearly just didn't read it properly.  Whether you use To or Until is personal preference. <br><br></td></tr></table><br>
<a name="875281"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nope, Until runs 1 less than To. <br><br></td></tr></table><br>
<a name="875294"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AltanilConard</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Vilu and QuickSilva: Editing the image flags indeed does the job :). <br><br>Just out of curiosity, <i>is</i> it possible to turn an image into a pixmap?<br><br>Thanks for the help all. <br><br></td></tr></table><br>
<a name="875307"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jesse</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> not directly but you can get the pixmap from the image with lockimage. note that whatever you do to the pixmap will affect the image. <br><br></td></tr></table><br>
<a name="875541"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> See the thread here: <a href="http://www.blitzbasic.com/Community/posts.php?topic=73042#816959" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=73042#816959</a><br><br>See the post(s) by me, I submitted code for doing simultaneous zooming and rotating of an image. It doesn't do any kind of filtering/smoothing but you can zoom in or out properly and rotate at the same time. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
