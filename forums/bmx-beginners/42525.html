<!DOCTYPE html><html lang="en" ><head ><title >An array slices question</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >An array slices question</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=101" >BlitzMax Beginners Area</a>/<a href="#bottom" >An array slices question</a><br><br>
<a name="476290"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I quote the documentation:<br><br>BlitzMax also does not support a 'Redim' operation. Instead, you can use slices. For example:<br>Global my_array$[100]           'create a 100 element string array<br>my_array=my_array[..200]        'now a 200 element array!<br><br>My question:<br><br>Does resizing the array, where my_array=my_arrays[..oldsize+extra], keep the original contents of the array, or does it just give you a bigger empty array that forgets what was stored in it?<br><br>If I store 100 numbers in the array and use [..200] to make it bigger, will those 100 numbers still be there?<br><br>Does doing this involve some kind of a memory copy - ie does it make a new 200 element array and copy the content from the old one? If it makes a new array but *doesn't* copy the content, do I have to do that myself?<br><br>Also, on the topic of arrays.... I notice you can't use EachIn as a loop counter where the array is an array of function pointers? ie<br><br>where myfunctions[] is an array of function pointers...<br><pre class=code>
	For counter=EachIn myfunctions
		myfunctions[counter](param)
	Next
</pre><br>doesn't compile. ??? <br><br></td></tr></table><br>
<a name="476295"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh, I figured out the EachIn part ... should be:<br><br><pre class=code>
Local tempfunc(param:Int)
For tempfunc=EachIn myfunctions
   tempfunc(param)
Next
</pre><br>Hey, that's a nice little speedup. 72 millisecs for 1 million calls, compared to 80 millisecs for a regular for-next numerical loop. The only drawback is that since the `loopcounter` is tied into the EachIn thing, there can only be one value for the tempfunc per iteration. It'd be nice to be able to do a procedural EachIn such as:<br><br><pre class=code>
For counter=0 to 9
    NextIn(myfunctions)(param)
Next
</pre><br>ie to keep track of where I am in reading the myfunctions array rather than recomputing the offset for every call. Or maybe an EachIn loop should also let you define a To amount, to stop somewhere? And maybe a From ... ie<br><br><pre class=code>
Local tempfunc(param:int)
For tempfunct=EachIn myfunctions[18] To 49
   tempfunct(param)
Next
</pre><br>would be nice :-D<br><br>But anyway, I still need someone to explain the array resize thing. :-) <br><br></td></tr></table><br>
<a name="476393"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PowerPC603</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> When you resize an array using slices, the contents of the array are copied also.<br><br>I do this in my game too.<br>I'm trying to create a spacesim (like Freelancer), which needs info about each object in space (location, price, name, description, cargospace needed = for commodities to trade, ...).<br>I'm loading a textfile, which holds all this data, into arrays.<br>In this file, there are datablocks (parts of the file which identify each object).<br>Every time a datablock has been found, the appropriate array is resized (size increased by 1).<br>Contents are not lost.<br><br>If you want to take a look at the source-code:<br><a href="http://users.pandora.be/vge/SG/SG.zip" target="_blank">http://users.pandora.be/vge/SG/SG.zip</a> <br><br></td></tr></table><br>
<a name="476438"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm ok.  Just out of curiosity, why don't you make your array a whole lot bigger like add on an extra 20 entries, and then just resize it when you reach the limit by adding 20 more? hardly any memory loss and much less resizing needed? <br><br></td></tr></table><br>
<a name="476675"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PowerPC603</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> If a sector has only 3 stations, then it would be too big.<br>I can imagine that four bytes (an Int to hold the memory-pointer to a type-instance) per index isn't much for computers these days, but if you have about 100 sectors, then it really can eat some memory that would be usefull for something else.<br><br>And also, each time a new station is found in the datafile, a field is increased by 1.<br>The resizing uses this field to resize the array to it's new size, and in other functions (when the 3D module is out and I can really fly in space), those functions will use that field for a for-next loop, to process all stations inside a sector.<br>If the size is too big (and no type-instances are linked to each index), then I would get errors, stating that there is no object present at that index (the ones that aren't used).<br><br>Okay, I could use some extra checks to detect if an instance is linked, but that's extra work for the computer.<br><br>Now it's just looping from index 1 to the number of stations inside that sector, and I'm sure that each station exists.<br>No need to check references and much less errors.<br>Little more time for the processor to do other things. <br><br></td></tr></table><br>
<a name="476677"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Pickford</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'd be tempted to start the array off very large and shrink it once you've loaded all the data.  Only one resize compared to resizing it for each element. <br><br></td></tr></table><br>
<a name="476690"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PowerPC603</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'll see to that, that's a better option, thanks.<br><br>That way my loading loading would be a bit faster.<br>It's fast now, because the datafile holds just a small bit of data, but will be bigger eventually, much bigger.<br><br>So, ...<br><br>When a new sector has been created, just set the size of the stations-array to 20 (default setting), and increase the field "NumStat" (variable to hold the number of stations inside current sector) by 1 if a station has been found, add it's data to the array at index "NumStat" and move on to the next one.<br><br>Once the datafile reached EOF, close the file and resize all arrays at once.<br><br>I kinda like it.<br><br>When I find the time, I'll rewrite the entire loading-routine.<br><br>It took me about 7 rewrites in B3D to get the most efficient (to me anyways) loading-routines.<br>But each time, adding more functionality and flexibility.<br>Now each field in the datafile can be in any order inside a datablock, non-recognised fields and statements in the file are ignored and unknown datablocks are also ignored.<br>Spacing and indentation is also processed automatically now.<br><br>I've converted those loading routines to BMax as soon as I got BMax Beta, so this was my first project in BMax.<br>No bad job if I may say so myself.<br><br>But thanks again John. <br><br></td></tr></table><br>
<a name="476912"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >teamonkey</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> @PowerPC603<br>Have you found any advantage of using this method over TList? <br><br></td></tr></table><br>
<a name="477043"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PowerPC603</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Direct access to a station.<br>That way I only have to let the game remember some numbers, which are stored automatically inside the player-type (which isn't present yet).<br><br>The player-type will hold the fields:<br>- SectorNumber (number of the sector where the player is located)<br>- StationNumber (number of the station where the player is docked)<br>- CommodityNumber (number of the commodity the player just bought or sold or whatever)<br><br>The I can do this for example:<br><pre class=code>
Universe.ASectors[SectorNumber].AStations[StationNumber].AComm[CommodityNumber].Name$
</pre><br>to access a specific commodity inside a specific station, in the sector where the player is located.<br><br>But it will take another rewrite to get everything going, when the 3D module is published.<br><br>I'll consider the use of TLists when I'm rewriting the game.<br>This was just some first exercise for getting to know BMax.<br>In B3D I didn't have TLists (ones you could define separately anyways), so I just converted to routines from B3D to BMax, using the same approach (arrays of types).<br><br>I've never used linked lists before, so I avoided it.<br>In B3D I always used arrays of types and no For...Each loop, to loop through all type instances.<br><br>But I can already see the benefit of using TLists, now that they can be defined separately, and inside types. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
