<!DOCTYPE html><html lang="en" ><head ><title >pixelmap mirror.</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >pixelmap mirror.</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=101" >BlitzMax Beginners Area</a>/<a href="#bottom" >pixelmap mirror.</a><br><br>
<a name="1059630"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ssdw</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> hello everyone,<br><br>it is possible to turn (mirror) a pixelmap (horizontal).<br>it must be fast, because many pictures must be mirrored!<br>does anyone know my answer?<br><br>Thanks! <br><br></td></tr></table><br>
<a name="1059631"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you're talking about when you draw an image itself I think the fastest and easiest method is likely using SetScale(-1, 1) which will draw the image inverted along the X axis but still normally along the Y (basically left/right are reversed).<br><br>If you actually want to invert the pixmap data itself the easiest way would be to do the mirrored drawing of an image and then use GrabPixmap() to pickup the mirror into a new pixmap.<br><br>A less graphics-centric method would be to create a new pixmap and copy the existing pixmap into it 1 pixel at a time but inverting the x offset of either source or destination.<br><br>A less memory intensive verison of the pixel copy could go line by line through a pixmap, store the value of a pixel along X, copy it's contents from the oposite side, then place the stored value in that oposite side postion, this will be less memory intensive as you wouldn't need 2 pixmaps...<br><br>I'm sure there are plenty of other methods as well these just come to mind.<br><br>But I suspect all you want to do it draw an image mirrored in which case just SetScale() :0) This also means you won't need a normal AND flipped copy of the image in memory (and then texture memory as well), and it's fully accelerated by the graphics card so it will be fast. I suspect that's the easiest/fastest/least resource intensive way to do what I think you want to do. <br><br></td></tr></table><br>
<a name="1059632"></a>

<a name="1059633"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Oddball</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Or use the function<br><pre class=code>XFlipPixmap(yourpixmap)</pre><br><br><font class="tiny">Last edited 2010</font> <br><br></td></tr></table><br>
<a name="1059642"></a>

<a name="1059643"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ssdw</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> they do it all, but it's about the speed.<br>The game uses a camera, the frames are loaded as a pixelmap, but it can also be an image. because it must can detect movements, I chose pixelmap.<br>Each frame should be mirrored, hence the speed is important.<br><br>Now I use XFlipPixmap, unless someone has a faster way.<br>Thanks for the help!<br><br><font class="tiny">Last edited 2010</font> <br><br></td></tr></table><br>
<a name="1059651"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wow, never even noticed XFlipPixmap() before... then again I've never had to flip one myself before... still nice to know :0) <br><br></td></tr></table><br>
<a name="1059682"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you use the setscale -1,1 it'll be faster than fliping the pixmap. <br><br></td></tr></table><br>
<a name="1059686"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ya, but depends on what you want it flipped for... Drawing you're best off with images for speed, but saving editing etc you may need pixmaps... Good to have options, just gotta think through what's best for a given goal. <br><br></td></tr></table><br>
<a name="1059790"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ssdw</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> how do I put SetScale -1,-1 in the code?<br>I put SetScale -1,-1 in the loop but nothing happened! <br><br></td></tr></table><br>
<a name="1059793"></a>

<a name="1059794"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jesse</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> it doesn't work for Tpixmap only for Timage.<br><br><font class="tiny">Last edited 2010</font> <br><br></td></tr></table><br>
<a name="1059809"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ssdw</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> then I use XFlipPixmap()<br>thanks <br><br></td></tr></table><br>
<a name="1059822"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> if you go the image route (query: why are you drawing pixmaps directly especially if speed is a concern?) you want SetScale(-1,1). SetScale(-1,-1) would invert along both X and Y... <br><br></td></tr></table><br>
<a name="1059825"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ssdw</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> is there another way to draw a pixelmap? a faster way. <br><br></td></tr></table><br>
<a name="1059827"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> make a timage out of it... images are stored in vram and have full graphics acceleration, and can be modified when drawn through all the max2d commands (setscale, setrotation, etc.) but since they exist on the graphics card essentially they are harder to manipulate on the pixel level. Pixmaps have to essentialy be pushed through the graphics card every time they are drawn, additionally they don't draw as reliably since how you get them to the screen varies from os to os and graphics system (opengl vs. directx). and they don't respond to the graphics commands (as you've seen with setscale not working). So they take much longer to draw, and are much harder to manipulate on the fly. However since you have pixel level access, and they exist in normal memory space you can easily modify them on a pixel level, and do other things with the raw data (like save it).<br><br>You can make an image out of a pixmap with LoadImage(a_pixmap_as_the_source), and if you create an "editable" image, you can also extract the pixmap back from the image if needed with LockImage(an_editable_TImage). You can load images directly from files as well... To generalize pixmaps are intended for editing pixels, images are intended for drawing. <br><br></td></tr></table><br>
<a name="1059839"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ssdw</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> I need pixelmap, because each time must (a few) pixels read.<br>If I use an image for the screen. and use SetScale(-1,1) to mirron it.<br>and use the pixelmap for the information, is that faster?<br>The pixelmap need not be mirrored! <br><br></td></tr></table><br>
<a name="1059840"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Should be much faster since you won't be drawing the pixmap. It will be higher memory usage since you will essentially have 2 copies of the data in memory. Depends which resource you have more room with, CPU or ram as to which would be better. <br><br></td></tr></table><br>
<a name="1059868"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Pixmax = Fast pixel information for calculations, etc. SLOW draw operations<br>Image = Fast accelerated draw operations, including alpha, scales, transforms, rotations, etc. Not valid for pixel information requests.<br>If you need both, you would be better off using both at the same time. <br><br></td></tr></table><br>
<a name="1059874"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> My clarifications can get... muddied :0)<br>Thanks ziggy, sums it up nicely. <br><br></td></tr></table><br>
<a name="1059954"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TomToad</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> haven't tested anything, but I would think that using a TImage, and then LockImage()/UnlockImage() whenever you need to read or modify pixel data would be best. <br><br></td></tr></table><br>
<a name="1059956"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TomToad</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just ran some tests.  On a test program I wrote, I got 74 FPS with Pixmaps only.  I got 120 FPS using Pixmaps, then LoadImage(Pixmap) to draw the pixmap.  I got 247 FPS by using TImage and LockImage(Image) to modify the pixels. <br><br></td></tr></table><br>
<a name="1059964"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Oddball</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you are only reading the pixel data then it's much faster to keep a copy of the pixmap and the image. Just use the pixmap for reading pixels and the image for rendering to the screen. No need to lock/unlock anything.<br><br>Also on another note unlock doesn't actually do anything. It's just an empty function. You only need to lock a TImage there is no need to unlock it again. Also, if you keep a pixmap reference of the TImages pixmap, that's the one you get from lock, then you don't even need to lock it before altering the pixmap. You only need to lock it at some point before you draw it. I occasionally do this if I'm performing lots of pixel pushing on an image. When it comes time to draw the image I check if the pixmap has changed and if it has I perform the LockImage before I draw it. <br><br></td></tr></table><br>
<a name="1059977"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> re tom:<br>I wouldn't suggest using LoadImage(pixmap) every frame (implication I got from your post) but it's interesting that even that is faster than drawing pixmaps directly...<br><br>If you want maximum speed, and you don't need to MODIFY the pixmaps, only read them (i.e. no visible changes), and you can afford the overhead then having a pixmap to "look at", and a seperate TImage (loaded once at startup) is going to be fastest since you are only loading once, and drawing only TImages.<br><br>Also interesting how fast the lock/unlock swapping apparently is for taking a peak, but it's still going to create overhead vs. just having a pixmap (disconnected) ready to go at all times.<br><br><br>re oddball:<br>despite unlock being empty I would personally still follow the documented "flow" since all of bmax's graphics functions are interface masks for driver/os specific things, you never know when the substructure might change in the future... e.g. this might be totally 100% fine for windows directx7, but what about dx 9, or opengl, or linux opengl? etc. If speed right now is your concern it's an interesting optimization but it could come back to cause some serious headaches down the road... <br><br></td></tr></table><br>
<a name="1060036"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ssdw</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> The image must be repeatedly loaded, because The picture is always different. therefore the speed is important..<br>If I use loadimage() and nothing happens. no error and no picture on the screen.<br>Timage and Tpixmap works, but is not faster. <br><br></td></tr></table><br>
<a name="1060041"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jesse</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> if you can post the code maybe we can figure out the best  way or an alternative route. <br><br></td></tr></table><br>
<a name="1060077"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Oddball</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> @ima747: All LockImage does is remove the texture from graphics memory so that next time it is drawn it must be recreated from the edited pixmap. In that respect it is not so unlike LoadImage(pixmap) the main difference being that with LoadImage the pixmap is copied and resized first which accounts for it being slower. The way Max2D handles image textures means that the LockImage internal code is unlikely to change dramatically. I'd consider UnlockImage deprecated at this point. I don't quite get your point about it working differently with each driver as there is absolutely no code at all in the UnlockImage source. I don't see how no code can run differently on different systems. <br><br></td></tr></table><br>
<a name="1060085"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> Not having dipped into the source proper in many many months I'll defer to your assessment. My interest in sticking with the prescribed cycle is for future proofing. There's nothing in unlock image now, but what about bmax 1.5? Maybe there will be to support some new improvements etc. It could also be overridden in future. Basically it's the old "it's probably there for a reason" syndrome, but I've gotten myself in trouble in the past for ignoring that :0) if it gets officially depreciated I'll be revising all my code accordingly. <br><br></td></tr></table><br>
<a name="1060258"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TomToad</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm not certain that LoadImage(pixmap) is faster than drawing pixmaps directly.  My test would load a png, modify 10 pixels each frame, flip the image then draw it.  Drawing pixmaps directly, I need to first use XFlipPixmap(), but using LoadImage, I can just use SetScale -1,1 instead.  That probably explains why it is faster.<br><br>As for using LoadImage() each frame,  I was under the impression that the pixmap will need to be modified every frame, so my test reflects that.<br><br>For using UnlockImage(), it's true that it is an empty do-nothing function, but I tend to use it anyway for the same reason that ima747 does.  Just in case in the future, it actually does something. <br><br></td></tr></table><br>
<a name="1060321"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> Regardless of what's being done it's pretty clear that drawing images (even if they have to be modified through lock, or for some reason re-loaded entirely) is way faster than drawing pixmaps (also more reliable, and gives you access to more modifications such as scaling, rotation, etc. and of course collision detection etc. etc. etc.) So long story short, no matter how much you're messing with things it seems faster to draw with images and do your flipping there.<br><br>And just to re-state, if you don't need to MODIFY the pixmap, but just peek at the data, having an image for drawing and a pixmap for looking at is going to be the fastest option as there will be no overhead at all compared to any other method (even the very very quick lockimage() is going to cause the data to get re-loaded because that's kind of it's purpose).<br><br>I think without code from ssdw to see exactly what he's trying to do, and why he's not seeing improvements we're just playing with applied theory that Tom already tested out :0) <br><br></td></tr></table><br>
<a name="1060358"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ssdw</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here is the code, <br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">Repeat

	image:TPixmap = CaptureFrame (cap,200) 'pixelmap
	toon:TImage =   CaptureimageFrame (cap,200) 'image
	
	If image = Null
		Notify "Image don't exist"
		End
	EndIf
	'XFlipPixmap (image)
	
	
	' -------------------------------------------------------------------------
	' Draw...
	' -------------------------------------------------------------------------

	If Not toon = False Then DrawImage toon,0,0'(400-target_width/2), (300-target_height/2)
	'DrawPixmap image, (400-target_width/2), (300-target_height/2)
	'SetScale -1,1

	
	'vieuw
	Flip
	Cls

Until KeyHit (KEY_ESCAPE)

cap = CloseCaptureDevice (cap)

End</textarea><br><br>I'll do what ima747 says it's faster.<br>Thanks everyone! <br><br></td></tr></table><br>
<a name="1060523"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> Aaah, it looks like you're actually grabbing a fresh pixmap to use as a drawing source via captureframe every cycle. What you have is probably the best combination of simplicity and speed given that. One option that might give slightly better performance (or maybe worse I don't know) would be to just keep one timage, lock it and overwrite it's pixmap every frame, but you will need a very fast method of copying the pixmap data and at best it would not give a huge improvement as the image is still going to have to be pushed to the graphics card. <br><br></td></tr></table><br>
<a name="1061356"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ssdw</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think this is best!<br>thanks <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
