<!DOCTYPE html><html lang="en" ><head ><title >Paint program help - drawing rectangles, restoring</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Paint program help - drawing rectangles, restoring</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=101" >BlitzMax Beginners Area</a>/<a href="#bottom" >Paint program help - drawing rectangles, restoring</a><br><br>
<a name="613027"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wellmt</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm trying to write a simple drawing program like MS-Paint, just to learn Blitzmax. I'm a bit stuck though.<br><br>Imagine the user has drawn a load of stuff on the screen. Now the user draws a rectangle by clicking and dragging the mouse button. As the user moves the mouse with the button down, the rectangle can grow or shrink until the button is released.<br><br>I can draw the rectangle fine but how to I restore the stuff behind the rectangle if the user shrinks the size of the rectangle? I've tried copying the whole screen into a buffer and restoring that before redrawing the rectangle but it doesn't seem to work. <br><br>Is this the best approach?<br><br>(I'm using regular Max2D functions)<br><br>Thanks <br><br></td></tr></table><br>
<a name="613055"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm guessing you're not using cls.<br>How about...<br>1) cls<br>2) Draw background<br>3) Draw rect<br>4) loop to 1)<br>When the mouse is released for drawing the rectangle then make that part of the background. <br><br></td></tr></table><br>
<a name="613057"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >CS_TBL</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I wonder whether restoring a part of the screen (where you're editing) is more clever. I recently made some testprogram which had a 512x512 canvas, drawing an even larger image on it with some selector rect over it @ event x/y. The movement was quite slugish, caused by redrawing the whole image again and again..<br><br>(98se, amd 2ghz, geforce4mx) <br><br></td></tr></table><br>
<a name="613068"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wellmt</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the replies:<br><br>tonyg<br><br>That's neat and you're right I'm not using CLS. Practically I can't find a way of storing the background before the rect is being drawn, which is kind of my problem. Should I just store the whole canvas into a buffer and then re-store the canvas in the buffer after the mouse is released?<br><br><br>so <br><br>1. CLS<br>2. Draw contents of buffer on canvas (DrawImage)<br>3. Draw rect<br>4. Flip<br>5. Loop to 1<br><br>When mouse is released store canvas using GrabImage. on a hires screen that can be a massive canvas to grab and draw each loop.<br><br>Thanks <br><br></td></tr></table><br>
<a name="613216"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> There is no point considering only restoring the part of the screen which you are `uncovering` by shrinking the rectangle, because with every frame, the entire backbuffer is wiped or relocated and basically does not keep its contents. After every Flip you have to completely redraw the entire screen anyway, so trying to only restore the part that changed won't save you any time. That technique would have been useful if the backbuffer were being kept, or if you were rendering it in main memory with custom drawing routines, but with the way Max is set up using OpenGL there is no point.<br><br>As was mentioned, you start off, draw stuff, grab it into an image, then use that same image for the duration of scaling the rectangle - each frame draw the whole screen image, draw the rectangle at the appropriate size, then flip. That's all.<br><br>If you do away with the backbuffer, which may be a possibility, and render directly to the `front` buffer, it might possibly be useful to preserve some of the background and restore only the parts being seen. It's questionable whether you really need a double buffered system for a paint program. <br><br></td></tr></table><br>
<a name="613268"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wellmt</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> OK thanks everyone. I got it working - well under Windows anyway. It seems I had it working already, I just didn't know it as there seems to be a bug in the Blitzmax Linux version. The same code works under one OS and not the other.<br><br>Thanks again for your help.<br><br>I'll post the code here just incase anyone can spot the problem. It's the drawimage line with the *** comment ** that causes problems under Linux, an exception error occurs.<br><br>-------- cut here ----------------------------<br><br>Strict<br><br>' ------------ vars --------------------<br>' Screen res<br>Local screenwidth=800<br>Local screenheight=600<br><br>' Mouse coords<br>Global ox,oy, mx, my<br><br>' shape <br>Local width, height<br><br>' Colour<br>Global red, green, blue<br><br>' types of tools<br>Const PEN=1, RECTANGLE=2<br>' current tool<br>Local currenttool = PEN<br>' holds current keypress<br>Local key<br><br><br>'set graphics mode<br>'Graphics screenwidth,screenheight,16<br>Graphics screenwidth,screenheight,0<br><br>' set a buffer up big enough to hold the whole screen (so we can restore the image during drawing ops such as rectangle<br>Local  screenbuf:timage = CreateImage(screenwidth,screenheight)<br><br><br>' ------------ main loop --------------------<br><br>red = 255<br>green = 100<br>blue = 100<br><br>'set the default colour<br>SetColor (red,green, blue)<br><br>' take an initial snapshot of the canvas<br>GrabImage screenbuf,0,0<br><br>While Not KeyHit(KEY_ESCAPE)<br><br><br>	' See if key has been pressed or a tool clicked on<br>	key = GetChar()<br>		<br>	Select key<br>		' p or P pressed, PEN mode<br>		Case 80<br>			currenttool = PEN<br>		Case 112<br>			currenttool = PEN	<br>		' r or R pressed, RECTANGLE mode<br>		Case 82<br>			currenttool = RECTANGLE<br>		Case 114<br>			currenttool = RECTANGLE<br>	End Select<br>			<br><br>	'update previous mouse coords<br>	ox = MouseX()<br>	oy = MouseY()<br>			<br>	' Left mouse button pressed<br>	While MouseDown(1)	<br>		<br>		' Get mouse coords<br>		mx = MouseX()<br>  		my = MouseY()<br>		<br>		Select currenttool<br>			Case PEN		 <br>			 	'Plot a pixel<br>				Plot mx,my<br>			Case RECTANGLE<br>				' draw a rect<br>				width = mx-ox<br>				If width &lt; 0 Then width = 1<br>				height = my-oy<br>				If height &lt; 0 Then height = 1<br>				Cls<br>				'  **** comment/uncomment this next line for a crash under linux *****<br>				DrawImage screenbuf ,0,0,0<br>				DrawRect(ox,oy,width,height)<br>		End Select<br><br>		' Flip the buffers<br>		Flip<br>	<br>	EndWhile<br><br>	Select currenttool<br>			Case RECTANGLE<br>				' take a snapshot of the screen proir to the next draw operation if drawing rects, ovals etc<br>				GrabImage screenbuf,0,0,0<br>	End Select<br>	<br>' end of main loop<br>Wend <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
