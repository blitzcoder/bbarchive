<!DOCTYPE html><html lang="en" ><head ><title >Display issue when keeping key or mousebutton down</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Display issue when keeping key or mousebutton down</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=101" >BlitzMax Beginners Area</a>/<a href="#bottom" >Display issue when keeping key or mousebutton down</a><br><br>
<a name="974541"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Pierrou</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello,<br>I am relatively new to Blitzmax and I must say I love it. These days I am developing a program that displays text files at various sizes in a viewport on the main graphics object (it will be part of a reading game intended for speech therapists [I am a speech therapist myself). It seemed quite easy to let the text scroll inside that viewport by displaying the text a little bit higher or lower on the viewport (ex to scroll 4 pixels down I display the whole text 4 pixels higher). <br>It almost works, using KeyDown(KEY_DOWN) or Mousedown on a button drawn somewhere on the screen. But when the key or the mousebutton is down for too long, the text disappears instead of keeping on scrolling, and never appears again whatever I try to do. It doesn't seem to happen when keeping the key or the mouse button down more briefly. <br>I hope these explainations are clear enough despite my poor English and all. <br>Thanks in advance for your help, <br><br></td></tr></table><br>
<a name="974547"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TaskMaster</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Without a code snippet, we can't really help you.  but, you are probably just adding too many pixels too quickly and making it shoot way off the screen?!?! <br><br></td></tr></table><br>
<a name="974549"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Pierrou</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> This code adds or substracts 4 pixels to the starting point of the display<br>and then calls function "affiche" (which displays the text) when holding one button or the other. <br>All variables except sourisx and sourisy are global<br><pre class=code>If MouseDown(1)
			sourisx=MouseX()
			sourisy=MouseY()
			If sourisx&gt;margex
				If sourisy&gt;margeh-2*bordure And sourisy&lt;margeh-bordure Then decal=decal+4 affiche
				If sourisy&gt;graphicsy-3*bordure And sourisy&lt;graphicsy-2*bordure Then decal=decal-4 affiche
			EndIf
		EndIf
</pre><br><br>And this is the main part of the affiche function that displays text : <br><pre class=code>
Function affiche()

DrawRect margex,margeh,graphicsx-margex-bordure,graphicsy-margeh-4*bordure ' affichage texte
nombreligne=0
affichefic=ReadFile("temp.txt")
	If affichefic
		While Not Eof(affichefic)
			ligneaffichee$=ReadLine(affichefic)
			SetColor 255,255,255
			SetViewport margex,margeh,graphicsx-margex-bordure,graphicsy-margeh-4*bordure
			DrawText ligneaffichee$,(affichaged/2-300)+margex,margeh+hauteurligne+decal
			hauteurligne=hauteurligne+espacevert
		Wend
	EndIf
	Flip
SetViewport 0,0,graphicsx,graphicsy
End Function
</pre><br>It reads each line of the text file and displays it at the bottom of the previous one ("hauteurligne increases each time, espacevert being in fact the font height). <br>I hope it's quite clear...?<br>NB : margex, margeh , bordure, graphicsx, graphicsy are dimensions set at the beginning and don't vary. <br><br></td></tr></table><br>
<a name="974593"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TaskMaster</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmmm, you are doing some things you probably shouldn't.<br><br>Like reading that file every time the function is called.  You should just read it once at program startup.  Unless that file is being changed somewhere else.<br><br>Also, you do not show where you are calling your if MouseDown code.  If it is in a loop that is called on every frame, then it is possibly getting called tens if not hundreds of times per second. <br><br></td></tr></table><br>
<a name="974602"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Pierrou</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thank you for your help<br>1/ It might not be the best way to do it but the "temp.txt" file is a file generated each time the user changes the font size : the program reads the original text file (which might have very long lines), cuts each line depending on the font size to fit into the viewport and saves the lines into the "temp.txt". Then the temp.txt file is displayed. I probably should not open it if the font size remains the same, right.<br>2/ Indeed the mousedown is part of a small loop contaning that code and and the code relative to keyboard commands. That small loop is repeated forever, and is probably repeated hundreds of times per second. Seems as if you have something much better in mind...?<br>Thank you again, <br><br></td></tr></table><br>
<a name="974606"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Couldn't you just use a String[] array or TList to hold your lines, rather than messing around in the file-system?<br><br>Memory is generally faster than accessing disks :-)<br><br>If you add some DebugLog messages, it may give you an idea of offsets and suchlike when everything disappears... like "oh, why is 'y' such a big number suddenly?" <br><br></td></tr></table><br>
<a name="974611"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Pierrou</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I probably could indeed :)<br>In fact, I expected the file-system method to be much slower. But it "quite" worked....<br>I will try the string array and see what happens. Thank you! <br><br></td></tr></table><br>
<a name="974738"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Pierrou</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Aaaah! It works much better that way... It obviously had something to do with the over-repeated file accesses. I mean, thanks to you it became obvious. Great language, great community.... ! <br><br></td></tr></table><br>
<a name="974807"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_Skully</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> What I would recommend is to pull the whole text file into a string then take enough of the string each time to fill a line (by font size) and remember your "cursor" position for the next line. <br><br></td></tr></table><br>
<a name="974839"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Pierrou</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'll think of it. Thank you! <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
