<!DOCTYPE html><html lang="en" ><head ><title >SocketStream.WriteBytes</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >SocketStream.WriteBytes</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=101" >BlitzMax Beginners Area</a>/<a href="#bottom" >SocketStream.WriteBytes</a><br><br>
<a name="990253"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Retimer</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> <pre class=code>
Method WriteBytes( buf:Byte Ptr,count )
		Local t=count
		While count&gt;0
			Local n=Write( buf,count )
			If Not n Throw New TStreamWriteException
			count:-n
			buf:+n
		Wend
		Return t
	End Method
</pre><br><br>Is <br><pre class=code>
If Not n Throw New TStreamWriteException
</pre><br><br>Really a good thing? <br><br>I'm trying to run a server, and even though it checks if the connection is still alive before sending anything, I still get that runtime on a rare occasion - which crashes the server. <br><br></td></tr></table><br>
<a name="990254"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >plash</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I still get that runtime on a rare occasion - which crashes the server. <br></div>So slap a Try block around it. <br><br></td></tr></table><br>
<a name="990329"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Czar Flavius</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wanna play Catch? <br><br></td></tr></table><br>
<a name="990332"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Wanna play Catch?  <br></div><br>Heh :-)<br><br>Do like what Plash says. <br><br></td></tr></table><br>
<a name="990338"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >plash</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Really it should not be removed. There are many other cases where you'd rather <i>want</i> to get that exception. <br><br></td></tr></table><br>
<a name="990347"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> For server code you must catch all exceptions on all socket calls, having your server crash because a client disconnects / time-outs is not industry practice:)<br><br>Another issue you may have if you want to send large amounts of data is having buffers become full. IMHO the Write behavior of a socket (now blitzmax does  multithreading) should be modified to block with timeout by default.<br><br>A SendBytes style method is possibly what you want in a single threaded environment, with this the condition of n&lt;&gt;count (or maybe just n=0) after the Write means REMAINING data should be scheduled for later transmission and exceptions for "socket no longer open" etc. can still be transmitted. <br><br></td></tr></table><br>
<a name="990646"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Retimer</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry for late response - I did just throw a try/catch within the writebytes function. <br><br>My post is more of a complaint that it raises a runtime error rather then raising an event, or returning an error. Instead, by <b>default</b> it is set to completely crash the app with the runtime error.<br><br>It's likely just me, but it seems like an inflexible way to have it set up.<br><br>This is the first time i've ever used a try/catch in blitzmax, as all my previous apps had more optimistic work-arounds, and were coded to not have to 'try' around errors, instead preventing them all together.<br><br>A check should be possible - but the only apparent way to check is failing 'socket.connected()'. <br><br></td></tr></table><br>
<a name="990648"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> it is set to completely crash the app <br></div><br>The only reason it appears to "crash" the app, is because you are not handling a raised exception.<br><br>I'm actually disappointed that the core BlitzMax modules don't utilise exceptions more than they do...<br>...and as a consequence, most of its users don't find them as useful as they should. <br><br></td></tr></table><br>
<a name="990654"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Retimer</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> The only reason it appears to "crash" the app, is because you are not handling a raised exception. <br></div><br><br>Fast response as usual Brucey.<br><br>I'm not sure I understand what you mean though. How am I to handle the exception, if even though a check is made, that there is still the possibility for it to raise the exception? Is that not something you can consider a bug?<br><br>You can handle the exception with a try, but why not prevent it from happening? Would that not be more professional?<br><br>I'm just confused that there appears to be a more global agreement FOR using try, when i've always thought it was frowned upon to use in any language (as a lazy way to prevent bigger issues). <br><br></td></tr></table><br>
<a name="990659"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> As skid alludes to, it may be that the buffer is full, and therefore, although the connection is open, you can't send any more data at that precise moment.<br><br>Of course, if the raised exception is bothering you so much, don't call WriteBytes :-)<br>Call Write() instead, and handle the "zero bytes written" issue yourself.<br><br>Otherwise, if the exception is thrown, you can either choose to ignore it and re-issue the call to WriteBytes() (it might succeed the next time, but if it continues to fail, maybe there is a fault), or perhaps handle it as a bigger problem in some way. <br><br></td></tr></table><br>
<a name="990661"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> i've always thought it was frowned upon to use in any language (as a lazy way to prevent bigger issues).  <br></div><br>Certainly, you wouldn't normally use them for simple error checking in many cases, as they tend to carry a small overhead (I'm not sure what that is in BlitzMax's case though).<br>But imagine you have a function call which at some point could fail in several different ways, and you'd like to know in which particular way the call failed. One method might be to return an "error" object, which holds various status information - but then you can't return a value in your function. Another method might be to pass into the call that error object - so you have an extra param for each call. The other option, is to throw different exception from inside the function. You can catch-all, catch some, or catch none (and have it throw further up the chain if you need it to).<br><br>I've seen different APIs which handle errors in all these ways. I suppose it's just down to designer preference much of the time.<br><br>As an example of one API which prefers to raise exceptions - CEGUI, a call to addChildWindow(), can possibly throw - TCEUnknownObjectException, TCEInvalidRequestException or a TCEException (which is a catch-all, raised in case I've missed handling one thrown by the library).<br>FMOD, on the other hand, returns an Int, indicating the type of error (or zero for none), during the function call.<br><br>Each to their own :-) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
