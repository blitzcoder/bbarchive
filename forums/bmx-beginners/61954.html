<!DOCTYPE html><html lang="en" ><head ><title >Multiplication Vrs Power</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Multiplication Vrs Power</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=101" >BlitzMax Beginners Area</a>/<a href="#bottom" >Multiplication Vrs Power</a><br><br>
<a name="692388"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Peeps.<br><br>There was a quite interesting thread about which was better, Sin/cos directly or pre calculated arrays<br><br>I would like to ask a similar question. I dont use ^ very much, but whenever I do, there are atleat three ways.<br><br>1) I just use ^<br>2) I use multiplication and divition to fake ^<br>3) I pre calculate. (Ie, I could have field of the common powers I want <i>Number.Power3</i>)<br><br>I use 1) except when its ^2, then I just Multiply 2).<br><br>Does anyone have preference, and or advice? <br><br></td></tr></table><br>
<a name="692393"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I never noticed a difference. <br>Maybe using it 100000's of times per frame but I get the feeling they get compiled to the same code.<br>(in fact, it looks like they do). <br><br></td></tr></table><br>
<a name="692395"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I use 1) except when its ^2, then I just Multiply 2). <br></div>Are you having unexplained problems?  Because that's incorrect.<br><br>10 ^ 2 = 100<br>10 * 2 = 20 <br><br></td></tr></table><br>
<a name="692397"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> 10^2 or 10*10<br>the 2) was to say point 2 <br><br></td></tr></table><br>
<a name="692514"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FlameDuck</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Multiplication is faster for lower orders. <br><br></td></tr></table><br>
<a name="692700"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Lower order means: ^2<br>Above that GCC is that highly optimized that multiplication will be slower. And that although the used compiler is a quite outdated one. <br><br></td></tr></table><br>
<a name="692953"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Defoc8</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> if your multiplying an int by 2..<br>  10*2, then you can use shl 1,<br>  and for int division by 2, use shr 1..<br> (if you dont know how the shift operator works)<br> (check the docs or ask on the forums..)<br><br>for powers..i dont think your really going to save yourself<br>any time by not using the "^" operator.<br><br>var=sqr(x^2+y^2), might better be presented as<br> var=sqr(x*x+y*y), but the sqr function is costly anyway,<br>so whos to say its going to make much difference here?<br><br>.. i personally dont think its worth worrying about..<br><br>Dreamora = "Above that GCC is that highly optimized that multiplication will be slower"<br> so your saying, that 2*2*2 under gcc is slower than<br>say, 2^3 under gcc? - heh..i dont believe you ;) <br><br></td></tr></table><br>
<a name="692968"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TomToad</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Tried this out<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">Strict
Local t:Int = 0
Local a:Int = 0
Local b:Int = 4
Local startTime:Int = 0
Local EndTime:Int = 0
Delay 3000
StartTime = MilliSecs()
For t = 0 To 100000
	a = b^3
Next
EndTime = MilliSecs()
Print a + " " + (EndTime - StartTime)

Delay 3000
StartTime = MilliSecs()
For t = 0 To 100000
	a = b*b*b
Next
EndTime = MilliSecs()
Print a + " " + (EndTime - StartTime)
</textarea><br>Results were <br>63 28<br>64 4<br>Notice not only was b*b*b 7 times faster, but also gave the correct answer.  That's because the ^ opperator works with doubles.  So it must first convert the Ints to Doubles which not only takes time, but also creates rounding errors.<br><br>Changing a and b to doubles result in<br>63.999999999999979 24<br>64.000000000000000 5<br>Once again, the result of ^ gives rounding errors, and is still slower than b*b*b<br>Comparing b^10 vs b*b*b*b*b*b*b*b*b*b gives<br>1048576.0000000000 25<br>1048576.0000000000 5<br>Next, adding Local c:Double = 0 to the top (a and b are still declared doubles) and changing the formulas to<br>a = Sqr(b^2 + c^2) and a = Sqr(b*b+c*c) gives this result:<br>7.2111025509279782 47<br>7.2111025509279782 4<br><br>So what does this show?  The ^ opperator is significantly slower than using * and also intruduces rounding errors even when using Ints.<br>You might be thinking that 40 ms per 100000 loops isn't large enough to worry about, but if you were checking the distance of each of 1000 objects from each other, that'd be 500500 checks assuming that if you check distance a to b, then you don't check distance b to a.  A test shows that 500500 checks with ^ takes 252 ms, way too much time.  Using * takes 29 ms.  Enough for 30fps, if you break up the checks and do half each frame, you can get 60 fps. <br><br></td></tr></table><br>
<a name="692973"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thats no really usefull test. You mix int and double and don't even test float which is the normal type for this kind of operations.<br><br>Using the same but a and b float, then the result is:<br><br><div class="quote"> <br>64.0000000 25<br>64.0000000 0 <br></div><br><br>Accuraccy: No problem<br>Speed: A significant difference :-)<br><br>Btw: If you wanted to test it truely on Float, you would have to use b^(3:float) to declare 3 as float. Otherwise it goes to double as well. But this does not make a real speed difference in this case.<br><br>Note: I'm using MingW 5, not the stoneage one proposed by BRL. <br><br></td></tr></table><br>
<a name="692977"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> @ Dream.<br><br>Please can you explain<br><div class="quote"> Note: I'm using MingW 5, not the stoneage one proposed by BRL. <br></div><br><br>Thanks in advance <br><br></td></tr></table><br>
<a name="692992"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, seeing as MingW is not even a requirement for BlitzMax programming I'm interested also. <br><br></td></tr></table><br>
<a name="692999"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Floyd</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> BlitzMax has its own hacked together version of exponentiation because the MingW pow() function was so horrendously slow.<br><br>I always hoped this was a temporary measure until the MingW guys fixed pow(). Does anyone know if they did? <br><br></td></tr></table><br>
<a name="693003"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TomToad</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Dreamora: Actually I did try float.  It was marginally slower than Doubles.  When using the ^ opperator, the arguments are passed to the function double bbFloatPow( double x,double y ) in blitz_cclib.c.  There isn't a Float nor an Int version.  Anything you use will be converted to double, including Floats.<br><br>Now I tried doing b^(3:Float) and b^(3:double) and didn't see any change.<br><br>The fact is, ^ is still significantly slower than *.<br><br>Here's a real world example.<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">Strict 
Type TSprite
	Field x
	Field y
End Type

Local Sprites:TSprite[200]

For Local t:Int = 0 To 199
	Sprites[t] = New TSprite
	Sprites[t].x = Rand(0,1023)
	Sprites[t].y = Rand(0,767)
Next

Graphics 1024,768,32
Local Frames:Int = 0
Local FPS:Int = 0
Local Power:Int = True
Local Distance:Float
Local Time:Int = MilliSecs()

While Not KeyHit(KEY_ESCAPE)
	Cls
	If KeyHit(KEY_ENTER) Then Power = Not Power
	For Local t:Int = 0 To 198
		SetColor 255,255,255
		For Local u:Int = t+1 To 199
			If Power
				Distance = Sqr((Sprites[t].x-Sprites[u].x)^2+(Sprites[t].y-Sprites[u].y)^2)
			Else
				Distance = Sqr((Sprites[t].x-Sprites[u].x)*(Sprites[t].x-Sprites[u].x)+..
								(Sprites[t].y-Sprites[u].y)*(Sprites[t].y-Sprites[u].y))
			End If
			If Distance &lt; 50 Then SetColor 255,255,0
		Next
		DrawOval Sprites[t].x-5,Sprites[t].y-5,10,10
	Next
	SetColor 255,255,255
	DrawRect 9,9,100,30
	SetColor 0,0,255
	If Power
		DrawText "Sqr(x^2+y^2)",10,10
	Else
		DrawText "Sqr(x*x+y*y)",10,10
	End If
	
	DrawText FPS,10,20
	Flip 0
	If MilliSecs() - Time &gt;= 1000
		FPS = Frames
		Frames = 0
		Time = MilliSecs()
	End If
	Frames :+ 1
Wend
</textarea><br>Press ENTER to toggle from using ^ to using *  Notice a huge jump?  On my machine it went from 53 fps to 200 fps.  Makes a huge difference, and this was just checking the distance between 200 objects. <br><br></td></tr></table><br>
<a name="693018"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> The difference with MingW5 is: When I rebuild the modules the take advantage of the current version of the GCC compiler on windows (as it does on Linux and Apple as well so I think its only fair to have the current version on windows).<br><br>This one has got some work in the last 2+ years since the 3.1 came out (you see, V3 to V5 now).<br>A£s you see with the comparision: Using the multiplications takes 0 ms on my CoreDuo 2Ghz, while the ^ uses the strange BM version which stays as slow as with the original MingW build ...<br><br>So if mark came around using the current GCC on Windows as well (not only on Linux and Apple), the ^ workaround wouldn't be needed (at least thats what I think as there is a reason we are 2 major versions further)<br><br>Beside that, my BM (all modules rebuild) is capable of using more than 1 core. Don't ask me why but thats what happens when I let it work with high load. <br><br></td></tr></table><br>
<a name="693028"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> We still are forcing gcc3.3 on Linux due to 4.0's refusal to allow statically linking to c++ standard lib meaning a big drop in compatability for blitzmax produced binaries. <br><br></td></tr></table><br>
<a name="693069"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Defoc8</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> "Multiplication is faster for lower orders. "<br> - coudnt the compiler be made to expand low order values?<br> - 2^3 to c/c++ = 2*2*2<br> (oops!, didnt think about problems with unknown)<br> (quantities..ignore me ;)) x^y<br><br>i dont know at what point using loops or special intructions<br>in assembly would benefit such a method? - i mean at<br>what point would expansion, register1*register2,<br>                                               register1*register2...<br>start causing problems?.. i dont know much about modern<br>processors, and no doubt this is complicated by ppc chips<br>perhaps not even offering a "mult" opcode?<br><br>anyway point taken.. for intances were "power" would<br>be used to process large quantities of data, and were <br>mults can easily be used in place of this operator..choose<br>mult.. - i honestly didnt think it would make a big <br>difference..heh..wrong as usual ;) <br><br></td></tr></table><br>
<a name="693070"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm<br>With "current" on Linux I meant more like 3.4.6 and the like that is normally on the Distri Disks.<br>I know of GCC 4 but as heard well of some problems with it.<br><br>On windows, MingW 5 (-&gt; GCC 3.4.2) is working great unless you own MaxGUI. (I got around the build errors but get the calling errors when trying to execute an app so I started to resync the latest win32gui.mod after I rebuild everything which at least seems to work)<br>I know that this isn't supported officially.<br>But as the most recent still is 3.4.X based, I didn't and still don't see a problem in using it.<br>But I might be wrong or have missed something ...<br><br>If so, I'm happy to know what the problem is (beside the win32gui intersection between max and mingw 5 GCC install) *I'm always happy to get my errors shown to make it better in future* <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
