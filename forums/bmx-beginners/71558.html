<!DOCTYPE html><html lang="en" ><head ><title >apply shadow mask to sprite ?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >apply shadow mask to sprite ?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=101" >BlitzMax Beginners Area</a>/<a href="#bottom" >apply shadow mask to sprite ?</a><br><br>
<a name="800033"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dax Trajero</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> What's the best way in blitz mask to apply a shadow mask to a spite ?<br><br>eg. <br>draw background<br>draw sprite<br>overlay shadow mask over sprite (and not background) <br><br></td></tr></table><br>
<a name="800123"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> What is a shadow mask.<br><br>Just make it darker?<br><br>Draw the sprite with solid or masked blend mode and draw the shadow mask with shadeblend<br><br>if you mean a shadow: alphablend and correct color information in the image<br><br>Both needs TImage and won't work with pixmaps <br><br></td></tr></table><br>
<a name="800209"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Probably asking to draw a shadow beneath the sprite using the sprite's mask as the shape of it, but drawing it with something like ShadeBlend.<br><br>You could simply try drawing the sprite in shadeblend at an offset from the real sprite position then draw the real sprite normally on top of it. To use the sprite's mask is a whole other ball game for which you'll need to know how to write your own OpenGL/DX code. <br><br></td></tr></table><br>
<a name="800327"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dax Trajero</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> sorry - to elaborate...<br><br>Think Speedball (late 80's game on the Amiga) - the background image shows an arena with walls on each side. Some of the walls project shadows, which I've drawn on the background image.<br><br>Whenever a sprite moves around the arena surface and passes close to a wall, it moves into this shadowed area.<br><br>I want to darken the sprite as it moves into this area.<br><br>Incidentally, when I had Blitz3D, I used drawImageRect when I want to draw a 32x32 area of a say an 800x600 image. What replaces this in BlitzMax ? I tried drawImageRect in BMax, but it doesn't seem to work the same? <br><br></td></tr></table><br>
<a name="800331"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I want to darken the sprite as it moves into this area.<br> <br></div><br>Draw the sprite, then draw the shadow with alphablend?<br><div class="quote"> Incidentally, when I had Blitz3D, I used drawImageRect when I want to draw a 32x32 area of a say an 800x600 image. What replaces this in BlitzMax ? I tried drawImageRect in BMax, but it doesn't seem to work the same? <br> <br></div><br>Do a search as there has been lots of discussion. There are about 4 implementations in the Code Archives, some easier than others, some quicker. <br><br></td></tr></table><br>
<a name="800356"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dax Trajero</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> tonyg<br><br>when you say draw the sprite, then draw the shadow with alphablend - this is my current solution but here's why I don't like it...<br><br>when I do the last part of what you said - draw the shadow with alphablend, its also darkening the transparent area of the sprite<br><br>how do I draw the shadow onto the sprite so it doesn't darken the transparent area of the sprite ? <br><br></td></tr></table><br>
<a name="800360"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Then you need to show some example code as that is wrong.<br><pre class=code>
Graphics 800 , 600
Local image1:timage = LoadImage("max.png")
SetClsColor 0,0,255
While Not KeyHit(KEY_ESCAPE)
	Cls
	SetColor 255 , 255 , 255
	SetAlpha 1.0
	SetBlend maskblend
	DrawImage image1 , MouseX() , MouseY() 
        setcolor 255,0,0
	SetBlend alphablend
	SetAlpha 0.6
	DrawRect 100 , 100 , 100 , 100
	Flip
Wend
</pre> <br><br></td></tr></table><br>
<a name="800363"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dax Trajero</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> tonyg,<br><br>Thanks for the code, I'll test it and try and incorporate it. <br><br></td></tr></table><br>
<a name="800364"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dax Trajero</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> tonyg<br><br>here's the code I was using (posted on this website by someone)<br><br>Function DrawImagePart(Image:TImage, DrawX#, DrawY#, PartX#, PartY#, PartWidth#, PartHeight#, Frame# = 0)<br>		<br>	Local OldX:Int<br>	Local OldY:Int<br>	Local OldWidth:Int<br>	Local OldHeight:Int<br>	<br>	Local ViewportX:Int = DrawX<br>	Local ViewportY:Int = DrawY<br>	<br>	' Save current viewport settings<br>	GetViewport(OldX, OldY, OldWidth, OldHeight)<br>	<br>	' Calculate viewport coordinates based on image's handle	<br>	If Image.Handle_X Then<br>		Local PercentX:Float<br>		PercentX = Float(Image.Handle_X) / Float(Image.Width)<br>		ViewportX = DrawX - (PercentX * PartWidth)<br>	EndIf<br>	If Image.Handle_Y Then<br>		Local PercentY:Float<br>		PercentY = Float(Image.Handle_Y) / Float(Image.Height)<br>		ViewportY = DrawY - (PercentY * PartHeight)<br>	EndIf<br>	<br>	SetViewport(ViewportX, ViewportY, PartWidth, PartHeight)<br>	DrawImage(Image, DrawX-PartX, DrawY-PartY, Frame)<br>	<br>	' Restore old viewport settings<br>	SetViewport(OldX, OldY, OldWidth, OldHeight)<br><br>End Function <br><br></td></tr></table><br>
<a name="800366"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don 't understand. <br>Is that code not working or something?<br>Is it related to the shadow question or a seperate topic on your drawimagerect query?<br>I did a search and there's a large number of results which might help plus <a href="/posts.php?topic=66050#738035" target="_blank"> this </a> one which you opened.<br>Have a browse through those results and you should have as good an understanding of Bmax DrawImageRect possibilities as many of the people here. <br><br></td></tr></table><br>
<a name="800371"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dax Trajero</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry, here's what i'm doing...<br><br>1) I'm using the above to draw my 32x32 sprite (from an 800x600 image)<br><br>2) I'm then using the same code to draw the 32x32 shadow (from an 800x600 image) "on top" of the sprite, alphablended to 0.75 <br><br>The problem is , I only want the shadow to cover the sprite - not the transparent areas around the sprite as it currently is doing.<br><br>Imagine the sprite was 32x32 frame and was a ball shape. I only want the shadow to cover the ball and not transparent areas around the ball in the same 32x32 sprite frame.<br><br>I need some way to mask off the unused (eg. transparent) area of the 32x32 sprite frame so only the actual sprite is shaded. <br><br></td></tr></table><br>
<a name="800373"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you only want to cover the sprite create a seperate shadow texture that does not have anything in the "transparent" area.<br><br>you can not selective disable stuff with blending unless you modify the texture information itself. <br><br></td></tr></table><br>
<a name="800378"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dax Trajero</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, so you can't do some kind of logic operation, combining the sprite 32x32 and the shadow image 32x32 and only darken the sprite - leaving the sprites transparent area untouched ?<br><br>in theory all I need do is take the non-transparent pixels from the 32x32 sprite and use this to mask off the shadow texture<br><br>so this can't be done ?<br><br>"If you only want to cover the sprite create a seperate shadow texture that does not have anything in the "transparent" area." - I'd need to do this dynamically each frame <br><br></td></tr></table><br>
<a name="800385"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes and no<br><br>Not with max2d blend modes<br><br>Yes because I think there might be a combination in opengl src,dst settings for the blend that might work.<br><br>That or you have to make the shadow alpha 0 where it shall not have an effect.<br><br>Texture blending is no boolean filter nor can you normally do that operations, like you can do in graphic apps <br><br></td></tr></table><br>
<a name="800437"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dax Trajero</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> ok<br><br>for now then, it leaves me with the only solution of drawing the 800x800 background, drawing the 4 32x32 sprites, then drawing the 800x600 shadow image over the top of everything. <br><br>It works perfectly, but I was worried about the performance hit of needlessly drawing the whole 800x600 shadow image.<br><br>Oh well, I'll come back to it when my game is finished and see if I can optimise it somehow.<br><br>Thanks all <br><br></td></tr></table><br>
<a name="800438"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dax Trajero</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Incidentally, why did BlitzMax neglect / change the drawImageRect command ?<br><br>Surely its a commonly used command to draw individual sprites from a larger strip of sprite frames ?! I can't understand why they'd change it ? <br><br></td></tr></table><br>
<a name="800781"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> no idea, thats why there are drawimagearea commands and the like to get the old functionality back <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
