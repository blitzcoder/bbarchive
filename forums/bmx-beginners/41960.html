<!DOCTYPE html><html lang="en" ><head ><title >A little byte problem</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >A little byte problem</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=101" >BlitzMax Beginners Area</a>/<a href="#bottom" >A little byte problem</a><br><br>
<a name="470765"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Algo</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Whats going on here?<br><br>This code runs forever.<br><br><pre class=code>
Global b:byte
For b=0 To 255
	Print b
Next
</pre><br>It seems to be reseting back to 0 too soon. <br><br></td></tr></table><br>
<a name="470768"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skn3</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Very stange. <br><br></td></tr></table><br>
<a name="470781"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Works fine on the Mac!<br><br>Must be a bug in the x86 code... <br><br></td></tr></table><br>
<a name="470787"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ashmantle</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> yep, runs forever on x86 version here too <br><br></td></tr></table><br>
<a name="470805"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FlameDuck</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well here it does count up to 255, but then it just starts over, much like what would happen in the following code:<pre class=code>Global b:Byte = 0
While b &lt; 256
	Print b
	b:+1
End While</pre>Interestingly, this doesn't work either:<pre class=code>Global s:Short
For s = 0 To 65535
	Print s
Next</pre> <br><br></td></tr></table><br>
<a name="470848"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Panno</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> yes it will only run up to 254 <br>without the print  get follow asm code<br><br><br>look here<br>_3:<br>	add	byte [edx],1<br>_9:<br>	movzx	eax,byte [edx]<br>	cmp	eax,255         ! <br>	jle	_5              !<br>_4:<br>	mov	eax,0<br>	jmp	_6<br>_6:<br>	pop	ebp<br>	ret <br><br></td></tr></table><br>
<a name="470866"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hotcakes</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hehehehee bmx on x86 adds one to the variable and then checks to see if it is over the loop's count limit.  By that time, the variable has reset to 0 ;] <br><br></td></tr></table><br>
<a name="470874"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Floyd</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's the same for regular integers. <br><br>Apparently this bug was always in Blitz, but nobody noticed.<br>I guess there's not much call for loops that go up to 2147483647. <br><br></td></tr></table><br>
<a name="470877"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >EOF</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> *EDIT* Working now .. see post below.<br><br>This only prints 2,3,4,5 (missing the 1) ...<br><pre class=code>framework brl.basic

Local b:Byte

For b=1 To 5
 Print b
next</pre> <br><br></td></tr></table><br>
<a name="470878"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> ive not come across this, and ive written a simple emulator that did 0-255.... <br><br>oh wait.. there were no "bytes" in blitz.. so it would work with those values.. hmm...<br>I must say, this is interesting. Mark, whats the plan? ^.^ <br><br></td></tr></table><br>
<a name="470879"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> ive not come across this, and ive written a simple emulator that did 0-255.... <br><br>oh wait.. there were no "bytes" in blitz.. so it would work with those values.. hmm...<br>I must say, this is interesting. Mark, whats the plan? ^.^<br><br>its okay for this to wrap forever as its understandable, (well, as a programmer used to 6502, 8 bit assembler)<br><pre class=code>
Global b:Byte = 0
While b &lt; 256
	Print b
	b:+1
End While
</pre><br><br>however the following realy should work. maybe a simple clause will fix it in the compiler? i dont know. i know as much about Bmax's infrastructure as i do x86 assembly... hehehe. (nothing by the way)<br><br><pre class=code>
Global b:byte
For b=0 To 255
	Print b
Next
</pre> <br><br></td></tr></table><br>
<a name="470884"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Floyd</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> @JimB<br><br>The 1 to 5 loop works here. Are you sure the 1 was missing? <br><br>I've gotten seriously confused by apparently missing console output. Sometimes the window will scroll down even when the output is nowhere near the bottom. <br><br></td></tr></table><br>
<a name="470885"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Panno</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> @jimb  <br>will work here<br><br>framework brl.basic<br>Local b:Byte<br><br>For b=1 To 5<br> Print b<br>next<br>1<br>2<br>3<br>4<br>5 <br><br></td></tr></table><br>
<a name="470991"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FlameDuck</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  yes it will only run up to 254  <br></div>Huh? Runs up to 255 here...<br><br>JimBs example also prints the one here.<br><br>What kind of CPU's has everyone got? <br><br></td></tr></table><br>
<a name="471019"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >EOF</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Floyd,<br>Mmmm, bizzare. it works now.<br>Restarting the IDE (Win32 Beta) must have cured the output fault.<br><br>@FD,<br>CPU=Pentium 4 Mobile 3.06Ghz <br><br></td></tr></table><br>
<a name="471052"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BODYPRINT</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> if you make it a local it works here, but global keeps looping??<br><br>CPU=3.2Ghz P4 <br><br></td></tr></table><br>
<a name="471106"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FlameDuck</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  if you make it a local it works here, but global keeps looping??  <br></div>Yeah same here. Wierd that.<br><br>CPU = 3.6 GHz Prescott. <br><br></td></tr></table><br>
<a name="471118"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Michael Reitzenstein</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> It kind of makes sense, because I bet globals are being written to memory and read in again, whereas the local version will be stored in a register pernamently. <br><br></td></tr></table><br>
<a name="471173"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hotcakes</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> That's exactly what's happenning. <br><br></td></tr></table><br>
<a name="471225"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> My interpretation is this:<br><br>Because you are asking for your loop variable to be a byte, and the biggest value you can store in a byte is 255, I think the For..Next loop perhaps adds 1 to the loop value PRIOR to testing to see if it is *greater than* the highest amount of the loop counter ie 255. So it would go something like this:<br><br>Counter is at 253<br>Do the loop with counter at 253<br>Add 1 to the loop counter<br>Is the counter&gt;255? no, its 254, loop round<br>Counter is at 254<br>Do the loop with counter at 254<br>Add 1 to the loop counter<br>Is the counter &gt;255 .... counter is now 255 but not &gt;255, loop around<br>Counter is at 255<br>Do the loop with counter at 255<br>Add 1 to the loop counter - should be 256 but 256 in binary is %100000000 and since the variable is only a byte, the `1` bit is ignored - it thinks counter=%00000000<br>Is the counter&gt;255?  ... should be yes but it only reads Counter as a byte which has gone beyond its numerical range, so Counter=0, keep looping<br>and looping<br>and loping forever because this keeps happening.<br><br>That's my take on it. The loop counter is checking for a number greater than the loop limit, and adds the step to the counter at the END of each loop, BEFORE deciding whether to do another iteration. So if your loop limit is equal to the maximum number that can be stored in a variable of a given type (ie byte word long etc), there is an `overflow` that accidentally produces a value of 0 again, keeping the loop going.<br><br>If this is true, you could *probably* test it by also doing a short/word sized loop, going from 0 to 65535, and when it reaches 65535 the counter should internally become %10000000000000000 (65536), even though only the lower 16-bits are recognized (=0).<br><br>Maybe someone can test if this is the reason behind it. If so, maybe the Blitz developers need to come up with a fix to this design flaw.<br><br>I am also expecting that when you define the Counter as a Local, it works, because Locals are kept in registers which are usually 32-bit, and I expect there is no difference in speed between comparing a byte value and comparing a long value, so it probably knows that the number reaches 256 instead of seeing it as 0?<br><br>If this isn't exactly the reasoning behind it my second guess is perhaps the loop-counter value is held in an `immediate` value in assembly language, ie something like cmp #255,register, and really it needs to be a 16-bit compare in order to avoid the overflow problem?<br><br>Feedback please. <br><br></td></tr></table><br>
<a name="471280"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FlameDuck</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I am also expecting that when you define the Counter as a Local, it works, because Locals are kept in registers which are usually 32-bit, and I expect there is no difference in speed between comparing a byte value and comparing a long value, so it probably knows that the number reaches 256 instead of seeing it as 0?  <br></div>I'm thinking this sounds probable. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
