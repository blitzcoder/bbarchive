<!DOCTYPE html><html lang="en" ><head ><title >Projection Matrix</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Projection Matrix</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=101" >BlitzMax Beginners Area</a>/<a href="#bottom" >Projection Matrix</a><br><br>
<a name="696359"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Smurftra</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Not sure if this is the right place to ask.<br><br>But i was reading the thread about indiepath's modules and was wondering:<br><br>what is that thing called projection matrix, what is its purpose, what does it eat in winter?<br><br>Thank you,<br><br>Smurftra <br><br></td></tr></table><br>
<a name="696440"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TartanTangerine (was Indiepath)</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you know Blitz3D then think of the Matrix as your Camera. Basically the matrix defines your view on the digital world - a matrix can make your image look constant across multiple resolutions/ratios. <br><br></td></tr></table><br>
<a name="696512"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Smurftra</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok this triggers a new question for me:<br><br>(I'm a blitzmax user but i understand the 3d concept you explained)<br><br>I'm making a 2d game. So far i've settled for a 800x600 resolution.<br><br>If i used the projection matrix, i could make the resolution whatever the user wants because everything would be scaled accordingly (this is what i understand from your explanation)<br><br>Now, lets say in my game i have a sprite that is a 32x32 square fill with blue, with a white line on the four edge (1 pixel width). I guess if the user lowers the resolution the sprite might be distorted so we dont see the white line? Same if we up the resolution one edge could stay 1pixel while the other edge becomes 2 pixel width?<br><br>I'm not sure how to explain, what i mean is does a projection matrix try to ensure that details in the graphics stay visible or is it just a zoom/unzoom algorithm? <br><br></td></tr></table><br>
<a name="696534"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> In Bmax, if you are using the Standard stuff you can simply use setScale(Float,float) to get the same effect.<br><br>Lets say your normal screen is 800 by 600, this is scale 1.0,1.0. If you suddenly wanted a resolution of (say), 400 by 300, you SetScale (0.5,0.5). Now when you DrawLine from 0,0 to 800,600, the computer draws 0,0 to 400,300, so it looks the same. And for 1024,768 setscale (1.28,1.28)<br><br>You really need to have planned to do this, because it doesnt work with DrawPixmap, only with DrawImage. <br><br></td></tr></table><br>
<a name="696553"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Smurftra</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok so my question is answered: its sure to give ugly results as its not intelligent (meaning there are good odds it will skip a 1 pixel width line if you half the resolution) <br><br></td></tr></table><br>
<a name="696578"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> No, I dont think it will, my understanding is that this is happening anyway, and that the screen driver is making the value Percentage values.<br><br>That is the screen coords you give are already being converted to numbers between 0 and 1.0<br><br>But simply try it. Increae the screen size, set a scale, and have a look. <br><br></td></tr></table><br>
<a name="696588"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Smurftra</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> ok, use this file:<br><br><img src="http://www.picpile.net/ims/pic_216YyF96/4332.jpg"><br><br>and use this code (remember to replace the line where it loads the image to your image's path):<br><br>switch between:<br><br>graphics 800,600<br>SetScale 1,1<br><br>and:<br><br>graphics 400,300<br>SetScale 0.5,0.5<br><br><br>Local Img:TImage<br><br>Img = LoadImage ("C:\TEMP\BlitzMax\Garbage\test1.bmp")<br><br>While not KeyHit(KEY_ESCAPE)<br>	DrawImage img, 50,50<br>	Flip 0<br>Wend<br><br><br>----------------------------<br><br>So in 800x600 the picture is drawn ok (1 black line, 1 red line, and so on)<br><br>in 400x300 the picture is not drawn ok (only red line are drawn because it skips 1 in every line)<br><br>Now there are many intelligent approach to this problem, i was wondering if the projection matrix took that into account.<br><br>Its because of that problem that i decided that my game would be 800x600 and thats too bad for those who want higher res cuz it would be too much work.<br><br>smurftra <br><br></td></tr></table><br>
<a name="696595"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thats what would happen whatever you did, either that or the red and the black would make a new red half as bright.<br><br>No matrix method, no matter how brilliant could make detail smaller than a pixel appear correct. To be honest I think that you are just expecting too much. All the projection matrix would do, is scale depending on Depth.<br><br>Explain to me exactly how you would like the Redbox drawn. Unlike you who have just stuck to one resolution, I have simply not used stupid textures. (ie one like that one)<br><br>Edit: Thats sounds nasty. But what I mean is that I dont use a texture that has been specificaly designed not to work. <br><br></td></tr></table><br>
<a name="696628"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Smurftra</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, i does sound nasty ;)<br><br>1) I'm not asking for much since im not asking that it works like i expect. I figured: why use a proj matrix if i simply can use Scale. I dont see the point. So i though that maybe it is more intelligent than a simple scale.<br><br>2) There are several ways to acheive what im talking about:<br><br>A) Scale with 'blur'<br>B) Scale while keeping details. (look for 1 pixel width lines and keep them and scale the areas that are bigger than that). It is time consuming but there are methods that make it fast enough to implement in real time, and you can always pre-render your sprites.<br><br><br><br>As far as stupid images, the image i linked too was just to make my point clear.<br><br>Now imagine yuo make a game that is 'cartoonish'. In cartoons, characters/objects often have a black outline. If you were to make your sprite and make that outline 1 pixel width, half of it would disapear making it look weird.<br><br>I'm always willing to learn so, could you help me out and tell me a way to avoid that in the making of the sprites?<br><br>Like, how would you do a game like mario bros and assure that mario doesnt lose his mustache? (without making the sprites ugly my having all the lines be 2pixel width, cuz then you lose the possibility of fine details).<br><br>1 idea i think its to make the sprites for the smallest possible resolution, scaling upwards doesnt lose info. But a doubled sprite looks kinda pixelated.<br><br>Vector graphics maybe? Pre-rendered at game boot?<br><br>Smurftra <br><br></td></tr></table><br>
<a name="696641"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> 1) Yep, A projection matrix is just, (in basic terms;- so dont flame me), a way to auto scale with depth.<br><br>2) (Just using your stupid Image ;)<br><br>a) Blur to what? It cannot blur less than a pixel, so a pixel is half red half black. so... Red or darker red. But all the pixels would blur the same, so you would just get the same as in the test.<br>b) You cannot. The detail on your image is too fine to keep any detail when shunk<br><br>Its not a stupid image in the sence of at least it is an image, But its an image you wouldnt use.<br><br>1) You dont want to make your game on a lower resotution. So why are you saying "Look, it looks bad on a lower res"?<br><br>2) I am using it, with 1024 *768 as MIN,<br>If I wanted "a mario" then His BlackOut Line would be bigger than 1 pixel at 1024*768 (Or Pos 512,384), and then scaled <i>up</i> with blend. I accept you dont want to do it. And fair enough your doing a Pre-sprite game, where as Im building them at run time.<br><br>But the image you posted is stupid. It cannot be scalled down at all and keep any detail in <b>any</b> scaling engine. It is at the lower limit of its size. <br><br></td></tr></table><br>
<a name="696685"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Smurftra</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> of course its stupid i wouldnt use such an image it was just to show what i meant, hence the other idea with the character with a black outline, that one would like to keep at 1 pixel width no matter the res <br><br></td></tr></table><br>
<a name="696760"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Abomination</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Why enable the user to choose an other resolution, if the result will look the same?<br>Unless you want to zoom certain areas and keep others the same, as in f.e. Settlers IV? <br><br></td></tr></table><br>
<a name="696772"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> ha Yes like settlers, but whereby the "Info" bit can contain more information at higher resoluions, but the game screen looks the same. (Or Homeworld, etc) As apposed to sat Diablo which at higher game res gives "more" game screen <br><br></td></tr></table><br>
<a name="696936"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Smurftra</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Possibly to accomodate LCD user where res &lt;&gt; native res = ugly <br><br></td></tr></table><br>
<a name="697043"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Why let the user choose: 800x600 looks on my screen like a game boy window as my native is 1680x1050 with stretching disabled to prevent the crappy effect that happens when scaling 4:3 -&gt; 16:10<br><br>games not allowing to choose the res find their way of my system faster than I can download them with 3MB/s at university. <br><br></td></tr></table><br>
<a name="697675"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Smurftra</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> dream:<br><br>i never toyed with widescreen monitors. so i have a question: if you have a game that is 800x600 full screen, will it still look ok (like having a portion on both side of the screen that stays black) or will it be stretched (convering the entire screen)? <br><br></td></tr></table><br>
<a name="717259"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's my understanding that it will do both of your suggestions on different monitors. Some will leave borders left and right, and some will stretch it, making it look nasty. <br><br></td></tr></table><br>
<a name="717384"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FlameDuck</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is not only an issue with widescreen LCDs. It is also a problem with most other LCDs that have a 5:4 aspect ratio (like say one with a native resolution of 1280x1024). <br><br></td></tr></table><br>
<a name="719302"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> This answers some hassles I was having with successfully doing image manipulation in a 'simple 'BMax exe, but upon trying to incorporate it into a more complex framework I couldn't fathom why my image manipulation was not working. <br><br></td></tr></table><br>
<a name="719445"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> I haven't seen much mention of the viewport in this discussion but it's very closely tied into the projection matrix and I think it needs a clearer description.<br><br>BlitzMax's SetViewport() is misleading. It is used to stencil areas of the screen or window so that you can draw only to particular regions of your display. The way it is presented it has nothing to do with changing the size of the display or the size of the objects within the display. SetViewport() could otherwise be called SetDrawingArea() or SetScissorBox() or SetCanvasRectangle() etc. If you look at the OpenGL code for SetViewport() it doesn't even contain the glViewport() command to change the viewport, all it does is set a clipping window to make sure only pixels within the defined area are drawn. It's a practical use of `setting a viewport` and presumably because BRL doesn't want users to have to mess around with the more complicated scenario of actually setting up a real viewport. To know what a real viewport is for you need to know what the projection matrix is for.<br><br>The projection matrix contains a perspective transformation operation that converts the apperance of objects from 3D coordinates to 2D. The values in the matrix actually define the `shape` of 3D space ie how `wide an angle of view' you have vertically and horizontally - your field of view. It defines this `volume` of 3D space, which is called a frustum (frustrum?), as a pyramid whose base is flat against the camera and whose peak is the vanishing point in perspective, off in the distance. The projection matrix is therefore what defines the amount of perspective effect that the game world will be viewed with. You can set it up to seem like a wide angle lense or a narrow zoom lense or something close to `normal real life perspective`.<br><br>You can also set it up to have no perspective at all, which is called an orthographic projection. In the orthographic projection, rather than lines of sight converging at a vanishing point, they are all in parallel and just go straight out, so no matter how far in the `distance` something is, it doesn't get any smaller - as if there is no perspective at all. An orthographic projection is ideal for 2D games and gives you the pixel-perfect representation of objects on a totally flat surface with no warping at the corners of the `camera lense`. So the projection matrix contains the definition of 3D space, be it a cone/pyramid or an infinite column/rectangle. You could presumably set it up so that as objects get farther away they get bigger!<br><br>When the viewing frustum is set up, ie the projection matrix is set up, you also define what coordinate system you want to use to represent the far left, far right, far bottom and far top edges of the camera lense. Ie, at the extremes of what you can see, it defines what value that coordinate will have. Typically for 3D space you might have -1 to +1 for the horizontal space, and -1 to +1 for the vertical space. Any object you then place with an X coordinate of -1.0 is going to be right on the left edge of what the camera can see, for example. So then to define an object at the left of the screen you have to give it an X coordinate of -1. You could set up the frustum with other values, you could say that the left edge is 0 and the right edge is 800. Then, approximately, for what eventually might be an 800x600 screen, an object at a given X coordinate will be roughly at the pixel coordinates given, provided it hasn't been scaled with perspective.<br><br>So the projection matrix does NOT define at what pixel coordinates object appear. It only defines where within the *camera's view* the object apears, based on the camera's coordinate space. Within the perspective projection there is nothing to say how each coordinate in the frustrum/camera MAPS TO the screen or window. Screen coordinates certainly don't go from -1 to 1. You could be putting an object at 1,1 in spacial coordinates and it will appear in the bottom right corner of the camera's view, but this doesn't mean it's going to appear at pixel coordinate 1,1 or 799,599 or anything else. This is where the viewport comes in.<br><br>A viewport is a definition of screen/window space based on a value of 1 for each pixel. A viewport is a *scaling* operation that is applied on top of the perspective transformation, within the projection matrix. If you tell the system that you have an 800,600 viewport, which may or may not be within an 800,600 screen (which is also a separate thing), then the coordinates from the frustrum/camera are scaled to fit within that viewport area. If you had set up a projection matrix for 3D perspective projection and had put an object at -1,0 (on the left edge of the camera view), it would now show on the left edge of the viewport in the middle. X=-1 is converted to X=0 in the viewport, and Y=0 is converted to Y=300 in the viewport. The viewport scales the camera to a given size.<br><br>You could summarize by saying the objects in the game world are relative to the camera's coordinates, and the camera's coordinates are relative to the viewports coordinates, and the relative position of the viewport coordinates are relative to the screen coordinates. Object coordinates turn into camera coordinates which turn into viewport coordinates which are pixel coordinates.<br><br>You can use exactly the same perspective projection, and have your objects still defined in a -1 to +1 space, and have it scale the output to a 400x300 size viewport, which may be within an 800x600 screen. You could position this viewport wherever you like within the screen. Wherever you put it, it's as if you are dragging a window around - you are dragging the window onto the game world. You don't change WHERE in the game world you are looking, by moving the window, you are moving where on the screen the camera's output ends up, and at what size.<br><br>By adjusting the real viewport you can do what you were trying to achieve - to scale the output to fit a given screen resolution, or to even fit a given window or area within the screen. This doesn't change the aspect ratio, as far as I know. To change the aspect ratio you have to define that the camera's coordinate system is able to see more or less of the game world, e.g the coordinates might range from -1.3 to +1.3, and -1 to +1 vertical. Then with a widescreen viewport of say 1440x900 you would then see an extra strip of the game world at each side and the proportions/aspect ratio of the whole thing would not squash or stretch.<br><br>So you need to adjust the frustrum to adjust the aspect ratio, and you need to adjust the viewport to adjust how much of the screen is covered with the output. And BlitzMax's SetViewport() will do neither. SetViewport() will define a standard orthographic projection for 2D graphics, will set up a viewport the same size as the screen so all pixels are used, and then will define a clipping window within that full screen in the dimensions given. It restrains drawing to a given area of pixels, but it doesn't change which part of the game world is viewed or at what size or aspect ratio.<br><br>The perspective transformation to convert from 3D coords to 2D coords, and the spacial scaling to convert from 2D camera space to screen space, all takes place using the projection matrix. The matrix is applied to all geometry ie all objects you place in the scene that are within view, and all graphics primitives that you draw, so they end up being the appropriate size.<br><br>I don't know if this is the same for DirectX but this is how OpenGL does it. Maybe DX has a single projection matrix and doesn't separate it out into frustrum and viewport? In GL the viewport and the perspective projection are all done together in one matrix - the projection matrix. You could also do other things to the projection matrix - apply extra scaling, rotate it, squash it, translate it, etc If you can do something with a matrix you can do it with the projection matrix and alter the shape of space. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
