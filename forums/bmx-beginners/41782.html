<!DOCTYPE html><html lang="en" ><head ><title >Input (Getkey ?)</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Input (Getkey ?)</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=101" >BlitzMax Beginners Area</a>/<a href="#bottom" >Input (Getkey ?)</a><br><br>
<a name="468926"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AdrianT</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thought I'd start programming now that Bmax is out (been 20 years lol). Anyway starting from the beginning I've been doing the usual starter tutorials only printing them to the screen with drawtext rather than just checking the output console.<br><br>At the moment I'm stuck on input and having searched on the BB and BC forums, it seems the best way to draw input on the screen in previous blitz languages was to use the GetKey command. <br><br>Doesn't seem to be an equivalent to Getkey  in Bmax so I thought I'd ask what the Bmax solution would be. <br><br></td></tr></table><br>
<a name="469107"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kanati</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nobody seems to have an answer to this one...  I've been peeking around in the bmx and c files and it does appear to have just vanished... <br><br></td></tr></table><br>
<a name="469116"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kanati</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have a working System mod with GetKey now...  I think.  :)<br><br>Still tweaking the C and BMX stuffs...  But I don't think I'm gonna hand it out.  This is something Mark could add in a few minutes and my hacking about in his module probably isn't a good idea.   :)<br><br>Eh...  It works, but it doesn't handle multiple keys down at once or control-keys right now.  Mark really needs to add this one himself but mine will hold me over til he does.<br><br>Kanati <br><br></td></tr></table><br>
<a name="469122"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AdrianT</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> heh, maybe it should go in the bug section if Mark is more likely to look at stuff there. I just don't like posting stuff in the bug section when I havent got a clue what I'm doing most of the time lol. <br><br></td></tr></table><br>
<a name="469128"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Diordna</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Post your routine please! <br><br></td></tr></table><br>
<a name="469129"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >flying willy</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Could it be that BRL actually forgot this one? <br><br></td></tr></table><br>
<a name="469134"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> The bpaint sample has a keyboard input routine but yes, we need a better solution. <br><br></td></tr></table><br>
<a name="469157"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kanati</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Mine is really a kludge I added into the system.win32.c, system.win32.bmx, system.bmx and ummm...  I think something had to go into driver.bmx too.  It's sitting on my laptop at work and if there's something that will work in the bpaint thingy (I'll look tomorrow) that might work better...  You'd be better off using that.  <br><br>I *will* post the changes I made tomorrow if you want them, but I really really really don't think futzing about in the system mod is a great idea.  As soon as Mark makes changes to it and you synch up...  it'll be broke. <br><br></td></tr></table><br>
<a name="469166"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AdrianT</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah I think I'll wait, I can't imagine that it will be that long. <br><br></td></tr></table><br>
<a name="469497"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bradford6</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> try this:<br>not perfect but does the job<br><br><pre class=code>

Graphics 640,480,0

foo$ = gl_input$(10,10,"what is your name? ")

SetColor 255,255,0 ; SetScale(2,2) 

DrawText "hello "+foo$+", how are you?",100,100

flip
waitmouse

End 


'-------------------------------------
Function gl_input$(x,y,prompt$ = "?")

	Repeat
	
		Cls
		DrawText prompt$+m$,10,10
		DrawText key,10,50
		hit_key = 0
		For key = 1 To 226
		
			hit_key = KeyHit(key)
			If hit_key 
				m$ = m$ + Chr(key)
			
				If key = KEY_ENTER
					Return m$
				EndIf
				If key = KEY_BACKSPACE
					l = Len(m$)
					m = m[..l-2]
				EndIf
			EndIf 
		Next
	
 	Flip
	Until KeyHit(KEY_ESCAPE)

End Function
</pre> <br><br></td></tr></table><br>
<a name="469511"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AntonyWells</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here's a public module, i knocked up earlier. <br>You can drop into a folder called input.mod in the mod\pub folder. <br>Call update once per frame, then getkey to get the key returned. should be faster than doing it every getkey in big apps with lots of seperate checks.<br><br><pre class=code>
Module pub.input

ModuleInfo "Version: 1.00"
ModuleInfo "Author:Antony Wells"
ModuleInfo "License:Public Domain"
ModuleInfo "Copyright:Poblic Domain" 
ModuleInfo "Modserver: BRL/Anyone"

Type GetKey
   Method Update:()
     lastKey=0
     For j=1 To 255
         KeyMap[j]=KeyHit(j)
         If KeyMap[j] LastKey=J
     Next
     FlushKeys 'Needed?
   End Method
   Method GetKey:Int()
       Return LastKey
   End Method
   'Returns how many times the key was hit since last update. 
   Method KeyHit:Int(Key:Int)
       Return KeyMap[Key]
   End Method
   Local LastKey
   Local KeyMap:Int[255]
End Type
</pre> <br><br></td></tr></table><br>
<a name="469604"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kanati</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Those are certainly workable for the short term...  But you really need to do what I did without breaking into Mark's system module...  By that I mean you need to hook windows and intercept the messages as Mark does by grabbing WM_KEYDOWN and WM_KEYUP messages.  You definitely don't want to be looping 255 times through the KeyHit() routine.  I can't imagine that being very fast in comparison to simply checking the windows messages and reporting it back once. <br><br></td></tr></table><br>
<a name="469615"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kanati</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> What I did to the C code is super simple...  I just added <br><br><pre class=code>
static unsigned int getkeycode[2];

unsigned int  *bbSystemGetKey=getkeycode;
</pre><br><br>to the declares...<br><br>In the select for WM_KEYDOWN and WM_SYSKEYDOWN I added <br><br><pre class=code>
getkeycode[1] = wp;
</pre><br><br>In the select for WM_KEYUP and WM_SYSKEYUP I added<br><pre class=code>
getkeycode[1] = 0;
</pre><br><br>That's it for System.Win32.c<br><br>Just like in Blitz3D and Blitz+, it doesn't handle shift, ctrl, etc, though it does return their keycodes when they are hit by themselves.  It just doesn't handle multiple combinations.  Anyway...  The other changes...<br><br>In driver.bmx in the TSystemDriver I added...<br><br><pre class=code>
Method GetKey( ) Abstract
</pre><br><br>In System.bmx I added...<br><br><pre class=code>
Rem
bbdoc: Check for general key down state
returns: keycode of key pressed
End Rem
Function GetKey( )
  If auto_poll PollSystem
  Return Driver.GetKey( )
End Function
</pre><br><br>In System.Win32.bmx I added the following to the Extern block...<br><br><pre class=code>
Global bbSystemGetKey:Int Ptr="bbSystemGetKey"
</pre><br><br>And I added this as well to System.win32.bmx<br><br><pre class=code>
Method GetKey()
  Return bbSystemGetKey[1]
End Method

</pre><br><br>Craptacular code I know (why I used a 2 position array I don't know but I didn't feel like going back and redoing it.) but it does work...  If someone wants to take a look at that handleMsg() routine in System.Win32.c and break it out or whatever into their own public module, THAT would be the way to do it.  I haven't had time to look into it myself yet but if we don't see one from BR soon I'll have a go at it.  Just been quite some time since I've done much with C.   :)<br><br>I was thinking...  return an int containing the keycode in the rightmost 8 bits with the leftmost bits containing flags for the special keys like shift, ctrl, alt, etc.<br><br>Of course I haven't even GLANCED at the mac code yet, but I would have to believe it would be SOMEWHAT similar.<br><br>Kanati <br><br></td></tr></table><br>
<a name="477801"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Warren</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Has anyone been able to come up with something that is cross platform and works the same as GetKey() used to?  It's pretty irritating that we can't do something as simple as keyboard input... <br><br></td></tr></table><br>
<a name="477808"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bruZard</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> oh my god, now very ugly english:<br><br>i've get the code from the sample by simon armstrong ... but: it only let me use english keybord settings (where's my Ä, Ö, Ü, ß?) ... i dont want to use the winapi to do that ... where is the solution of that? help me ... please! :) <br><br></td></tr></table><br>
<a name="477810"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Panno</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> ah bruz  ...<br><br>no ä,ü,ß support by Bmax this time  see this<br><br>drawtext "BMÄX",100,100<br><br>is BMX  @ 100,100 <br><br></td></tr></table><br>
<a name="477859"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kanati</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> WarrenM<br><br>I don't know if this works or not...  But someone in the thread said it did.  If so, consider it a kanati-special as it was my first attempt and writing a mod.  And I *think* that it should probably be cross platform compatible.<br><br><a href="http://www.blitzbasic.com/Community/posts.php?topic=42128" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=42128</a> <br><br></td></tr></table><br>
<a name="478084"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Warren</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Interesting, I must have missed that!  Thanks, I'll check that out over the weekend... <br><br></td></tr></table><br>
<a name="479026"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ghislain</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Another variant...<br><br><pre class=code>
WaitKeyArray ( [key_left, key_right, key_up, key_down] )
 ' returns true if one of the keys in the array pressed

function KeyHitByArray ( a[] )
 for local b = eachin a
  if keyhit (b) = true then return b
 next
end function

function WaitKeyByArray ( a[] )
 local i = waitkey()
 for local b = eachin a
  if i = b then return b
 next
end function
</pre><br><br>I don't know if it is of any use...<br>Ghislain <br><br></td></tr></table><br>
<a name="479111"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kanati</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> anyone try the mod I posted?  I don't feel like messing with it but if it doesn't work I won't keep pointing to it when someone asks about getkey.  :) <br><br></td></tr></table><br>
<a name="479113"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >fredborg</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> Kanati: It doesn't work for me :)<br><br>When using graphics mode, there is no return value ie. it's 0 all the time.<br><br>When using a real console window it returns 1 on every key. <br><br></td></tr></table><br>
<a name="479131"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TeaVirus</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> I get the same results that fredborg does. <br><br></td></tr></table><br>
<a name="479161"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kanati</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> well then...  that solves that.  :) <br><br></td></tr></table><br>
<a name="479269"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Warren</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> Grrr... <br><br></td></tr></table><br>
<a name="479282"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dirk Krause</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> Kanatis code does work - at least in the console. I didn't try in Graphics mode. Unfortunately I don't have the code anymore, but I'll check right away. <br><br></td></tr></table><br>
<a name="479288"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dirk Krause</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> ok, here goes.<br><br>I created a directories dirk.mod\test.mod in the mod main directory.  Then I put the getkey.c into it with<pre class=code>
#include &lt;conio.h&gt;

int bbGetKey(void) {
  return kbhit();
}</pre><br>Then another file test.bmx with<pre class=code>
Module dirk.test

Import "getkey.c"

Extern
  Function bbGetKey:Int()
End Extern

Function GetKey:Int()
  Return bbGetKey()
End Function
</pre><br>Then I ran my test code <pre class=code>
Repeat
  a = bbGetKey:Int()
  If a &lt;&gt; 0 Then
    Print a
  EndIf
Forever</pre>which worked fine on the console.<br>[EDIT]I was refering to Kanati's code in <a href="http://www.blitzbasic.com/Community/posts.php?topic=42128," target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=42128,</a> the other thread. I didn't try the code above. <br><br></td></tr></table><br>
<a name="479323"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kanati</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm looking at hooking windows messages like Mark did in his system32 mod...  But it definitely won't be cross platform.  :( <br><br></td></tr></table><br>
<a name="479331"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Warren</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is BRL even reading these GetKey threads?  I mean, it really is pretty irritating to not be able to accept simple keyboard input from the player. <br><br></td></tr></table><br>
<a name="479352"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hopefully they read the bug reports...<br><a href="http://www.blitzbasic.com/Community/posts.php?topic=41822" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=41822</a><br>I know an updated beta is due soon so it might be a case of wait and see before bringing it to BRL attention again. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
