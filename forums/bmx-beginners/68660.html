<!DOCTYPE html><html lang="en" ><head ><title >space shooter collision detection</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >space shooter collision detection</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=101" >BlitzMax Beginners Area</a>/<a href="#bottom" >space shooter collision detection</a><br><br>
<a name="767255"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Pragun</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> hi guys. i'm making a space shooter w/minib3d (irrelevant to my issue). i have two types of objects: enemies and bullets. ideas how i would go about doing collision detection? i have the following code but on the school macs (which is what i have to work with), well, it really sucks. i know it's not efficient too ( O(n^2) ), which is why i'm asking if anyone has any better ideas? enemies and bullets are TLists storing...enemies and bullets. thanks in advance! <br><br></td></tr></table><br>
<a name="767266"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TartanTangerine (was Indiepath)</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> chop you playfield up into a grid, if two objects are in the same grid then perform a collision check, if not then ignore them. You may also want to flag an object as "CHECKED ALREADY" to save further iterations. <br><br></td></tr></table><br>
<a name="767297"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >computercoder</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you go the route Indiepath suggests, be sure to reset that flag after each flip cycle. That way it could eventually be checked for collisions. <br><br></td></tr></table><br>
<a name="767396"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ryan Burnside</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Most shooters use a rectangle slightly smaller than the player ship. Games like DoDonPachi did this and they were not a problem at all. If you are going to be spewing out hundreds of shots at once, go for a simple algorithem like rect collision or circular collision. It's traditional not to use sprite based collisions. Sprite perfect collsions are often a waste. What kind of shooter are you making? If you're going with a bullet hell or danmaku shooter you just use point distance sice the hitbox is tiny. If you are going with a horizontal shooter like R-Type or Gradius go with the rectangle method. Same with vertical.<br><br>Here is a good link from our shooter creation forum...<br><a href="http://www.shmup-dev.com/forum/index.php?cat=18" target="_blank">http://www.shmup-dev.com/forum/index.php?cat=18</a> <br><br></td></tr></table><br>
<a name="767484"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jkrankie</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> If it's a 2d on a 3d plane shooter like Ikaruga, i would suggest just doing rect collisions. simple and works.<br><br>Cheers<br>Charlie <br><br></td></tr></table><br>
<a name="767492"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Along the lines that Indiepath suggests, a method I often use is similar but also checks adjacent grid zones for those times when the objects being tested are near the boundaries of the zones.  This may result in a few more checks but should not be enough to impact performance I would think. <br><br></td></tr></table><br>
<a name="767523"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bradford6</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> i have two types of objects: enemies and bullets. ?<br><br>I would like to help. could you elaborate?<br><br>are the enemies firing bullets too?<br>how many player bullets are on screen at once?<br><br>no matter what, collisions are expensive to compute. using the grid idea will speed things up. i think using sphere to sphere collisions are fastest too.  (you lose some granularity, but make up alot in speed)<br><br>can you post some code? <br><br></td></tr></table><br>
<a name="767598"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> "i know it's not efficient too ( O(n^2)"<br><br>The only way it should be O(n^2) is if you were checking bullets vs bullets.  If you're just checking player vs enemy bullets, and enemy vs player bullets, then it should be O(n).<br><br><br><br>If you MUST check bullets vs bullets, then one way as others have mentioned is to use a grid to speed things up.  <br><br>The grid would be an array of pointers to lists.  <br><br>(You could use a 3D array but it might require a lot of ram if you have a lot of bullets) <br><br>Create the array then create a list for each square.<br><br>Clear the grid each frame by clearing the lists, then determine which squares a bullet overlaps and stick a pointer to it in the list for each square it overlaps.<br><br>Then go through the array and for each square test all objects in that square that may collide with one another against eachother.  (A typical square might have no bullets, one bullet, or two bullets, though many more are possible.)<br><br>For each pair that collides, place that pair in a list.<br><br>Once you have all the colliding pairs, go through the list, and for each pair, swap their pointers so the smaller pointer is the first one.  <br><br>Then sort the list such that you sort first by the pointer of the first object in the collision, and second by the pointer to the second object.<br><br>Ie, if we use letters to represent pointers, then your collision list initially might look like this:<br><br>D-E<br>B-C<br>A-D<br>A-C<br>C-B<br>A-D<br><br>After swapping it would look like this:<br><br>D-E<br>B-C<br>A-D<br>A-C<br>B-C &lt;- This one changed<br>A-D<br><br>And after sorting it would look like this:<br><br>A-C<br>B-C<br>A-D<br>A-D<br>B-C<br>D-E<br><br>Now, go through the list, and check each pair with the next pair in the list.  If the pair is the same as the next pair, then remove it from the list, leaving only one copy. (You could have three copies in a row, so don't skip checking slot 2 against slot 3 if slot 1 matched slot 2 and you removed slot 1.)<br><br>NOW we have a list where we have each pair of objects that are potentially colliding listed only once.  We can now loop  through this list and do a pixel perfect comparison between each pair of objects, or test their bounding rectangles or whatever you want to do, but there'll only be a few objects to test so the complexity of the test won't be so important, and there won't be millions of possible combiations to look at.<br><br>You might ask how many tiles you should have in your initial array.  A good place to start would be making the grid squares twice the size of a bullet.  This would give you a reasonably fine grid, and reduce the number of bullets that end up in more than one square by quite a bit.  Four times the size of a bullet might be better.  The only way to know is to test.  There may be no noticable speed difference between the two though.  If four is no faster than two, then you don't need to bother testing eight.<br><br>Btw, the reason you can't just stick each bullet in one square is if you do that, two bullets might be overlapping, but be in different squares so they wouldn't be tested.  Or a large object might overlap many squares on the screen but would only end up in one.  You can just use the objects bounding rect to decide which squares to put it in.  If the top left corner is at 0,0 and the bottom right is at 2,3 then loop x 0 to 2 and loop y 0 to 3 and stick it in each of those squares. <br><br></td></tr></table><br>
<a name="767653"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Regarding the grid method:<br><br>You don't have to clear the grid each frame.  Another way is to simply remove objects from a grid square when they move out of it or are eliminated and then to add objects to a grid square when they are created or move across a grid boundary. <br><br></td></tr></table><br>
<a name="767687"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> To remove objects when they move out of a grid square if you're using a linked list for each square would require you to either search that list to find the object's pointer, or store the link to the object within the object itself.  Which you would have to store in a list.  Which you would have to search to find the right link for that grid square's linked list...  Which would defeat the purpouse of saving the list pointer. :-)<br><br>So to avoid the cost of the search, just null the grid.  It'll probably be less expensive, and it's a lot simpler. <br><br></td></tr></table><br>
<a name="767736"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> sswift - not really, I use this method all the time in blitzplus in the following manner:<br><br>All objects, bullets, space craft, big green aliens etc, are part of a single 'type' structure, with similar properties (movement speed, collision radius, hit points etc).<br><br>Each frame you are going to iterate through each object and perform actions on it such as moving it in the case of bullets (and checking for collisions when the bullets move), or responding to player input (detected earlier) in the case of player controlled objects.  So you are already going to be going through their list each frame anyway.  When an object moves across a boundary (simple math check detects this) simply reference the appropriate grid square, either in a bank or an array which holds a reference to a bank which contains the handles (does Blitzmax use handle/object commands? maybe that's why it wouldn't work) of the objects within that zone/grid square.  Simply run through the list of handles within that bank and remove the entry as well as moving all the following handles down one slot in the bank and resizing it so that it is 4 bytes smaller (size of a handle=int).  If there are no objects left in that grid square then free the bank as well.  Then proceed to go to the grid square that is being moved to and add the object's handle to the bank for that grid square. <br><br>One of the points I don't really like about refreshing the list at the start of the next frame is that if an object moves out of the grid square, or into the grid square during the 'updatebullets' section of the code then the data being held in the grid square is suddenly out of date/incorrect.  Whereas with the method I outlined above it is always accurate.  In some ways it can be quicker too as you are only modifying the bank when movement occurs rather than refreshing every grid square every frame - a bit of a waste if most of them are empty or if most of the objects are slow moving/stationary.  I don't know how much difference it would make with a low end PC since that is what Pragun is running it on. <br><br></td></tr></table><br>
<a name="767869"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Pragun</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> wait just wondering matty why wouldn't this be O(n^2) (i dont have the code on front of me but...)<br><br>for each bullet in the bullet tlist<br> for each enemy in the enemy tlist<br>  check if the bullet and enemy are within a certain distance of each other<br>  if so, remove both<br> next<br>next <br><br></td></tr></table><br>
<a name="767903"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> "Each frame you are going to iterate through each object and perform actions on it such as moving it in the case of bullets (and checking for collisions when the bullets move), or responding to player input (detected earlier) in the case of player controlled objects. So you are already going to be going through their list each frame anyway. When an object moves across a boundary (simple math check detects this) simply reference the appropriate grid square,"<br><br><br>I don't think you understand the method I've outlined.  In the method I've outlined, there is no single "appropriate grid square" per object.  There can be two.  Or four.  Or many.  <br><br>To do what you suggest, each object would need to keep a list of all the link pointers in the grid that point back to it.  Then you would iterate through each object, and each item in that object's list, and remove the links those items point to in the grid square lists.<br><br>This is a lot more complicated and unlilkely to be significantly faster than simply nulling all the lists on the grid.<br><br>As for the data being out of date at the start of the frame,  why do you care?  If you move a bullet, why do you care if you know where the other bullets are currently, which is to say, where they were last frame, or where they have been moved to this frame before you got to moving this bullet?  You can't act on that information.  That way leads to madness. :-)  <br><br>If you want to act on the information from a previous frame, then you should copy that information to a scratch buffer that won't get modified as you iterate through it.<br><br>Only in rare cases have I needed to modify a buffer whilst simultaneously reading the data from said buffer.  And that wa when doing a box blur on an image.  I can't imagine why you would need to do that in this case.  I could see why you might want an enemy's prior position, to say, draw a motion blur, but why would you care what squares it occupied when testing for collisionsm, which you finished doing last frame?<br><br><div class="quote"> <br>In some ways it can be quicker too as you are only modifying the bank when movement occurs rather than refreshing every grid square every frame - a bit of a waste if most of them are empty or if most of the objects are slow moving/stationary.<br> <br></div><br><br>The amount of data we are talking about here is so small that even a "low end pc" would have no difficulty dealing with it.  We're talking about the equivalent of clearing a 64x64 image to black, in software.  I drew screens full of sprites with alpha in software at 60fps in Blitplus.  And that was slowed down by readpixels.  <br><br>You're just talking about a miniscule amount of data.  It wouldn't make a lick of difference in speed to do it the more complicated way.  <br><br>The method I outlined is already complicated enough. :-) <br><br></td></tr></table><br>
<a name="767936"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't think either of us understands the method the other is suggesting (well I am certainly confused with how yours works - and mine is a lot more simple than what you seem to think), but that's okay if Pragun has found a method that works I guess. <br><br></td></tr></table><br>
<a name="767943"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FlameDuck</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="http://en.wikipedia.org/wiki/Collision_detection" target="_blank">Here</a> you go. <br><br></td></tr></table><br>
<a name="767999"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="/codearcs.php?code=1065" target="_blank"> This </a> might be useful and not too difficult to convert from BB to Bmax. <br><br></td></tr></table><br>
<a name="768240"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> I just thought of something... <br><br>Weren't the internal BlitzMax collision commands designed to get around the issue with colliding lots of onscreen objects with one another?<br><br>I don't know how it is supposed to work, because it seems too simple to work properly, but it seems like you're able to call collide image multiple times to add images to a collision buffer and then check an image against the end result.<br><br>If I understand what it's doing correctly, then only the topmost image at the first detected colliding pixel would be returned, (Ie, if two bullets overlapped one pixel, and that pixel was overlapped by your ship, then only the last bullet drawn at that pixel would be returned.) but this may be enough for your purpouses.  It probably won't be as fast as the method I outlined, (since you're drawing each object in software, rather than just those ones that collided to do the pixel perfect test) but it would be linear time, and should be fast enough. <br><br></td></tr></table><br>
<a name="769718"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Pragun</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> here's my code:<br><br><a href="http://www.mytempdir.com/1300200" target="_blank">http://www.mytempdir.com/1300200</a><br>download password: bmax<br><br>if you hold down spacebar and move around a bit...every few seconds or so the game crashes for a split second. any ideas? the collision code is there too now. i was able to get to my code again (classes alternate at school..diff on diff days and my flashdrive is broken...so i just got access to my code).<br><br>if anyone can help w/the freezing issue/can tell me a way to speed up the collision detection, thanks in advance! <br><br></td></tr></table><br>
<a name="771666"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Pragun</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> bump, anyone? <br><br></td></tr></table><br>
<a name="773165"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Pragun, although I use blitzplus not blitzmax I tried downloading your file from the site listed above but it just goes to some 'party poker' ad. <br><br></td></tr></table><br>
<a name="773167"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >impixi</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I tried downloading your file from the site listed above but it just goes to some 'party poker' ad <br></div><br>Yep, same here. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
