<!DOCTYPE html><html lang="en" ><head ><title >Suggestions for porting old sequential BASIC code?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Suggestions for porting old sequential BASIC code?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=101" >BlitzMax Beginners Area</a>/<a href="#bottom" >Suggestions for porting old sequential BASIC code?</a><br><br>
<a name="888950"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >pmc</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm looking for suggestions on how best to port some very old sequential BASIC code. It looks like something like this:<br><br><div class="quote"> <br>var=1<br>print "what now?"<br>input q<br>if q=2 then goto 500<br>if q=3 then var=var+1<br>print "that's nice, now what?"<br>input q<br>if q=1 then gosub 700<br>var2=var+var*2<br>goto 300<br>etc.<br> <br></div><br><br>I flow-charted the program and it's pretty nutty with subroutines and goto statements. I can rewrite alot of it, but would rather just try to preserve the logic to make it easier.<br><br>So what I did was to put each of the response lines (the print statements) into a list. I rewrite the list in response to the input from the user (the input statements). I use a regular While Not KeyDown(KEY_ESCAPE) loop to refresh the graphics window. The only thing moving on the screen is the input command line (my code for "input q"). You enter a command, hit enter, and based on what you entered, I refresh the list and the screen gets refreshed (the output "print" stuff). <br><br>What I'm not sure about is how get the sequential flow control logic (if then, goto gosub etc.) to fit in the context of the continuous While loop.<br><br>What I'm thinking is that I need to write a command parser and then just jump out to a function depending on what the input command is. So the original code (minus the input and output parts) just gets mapped to a series of functions. Then I'd have to write some code to determine where in the original program logic I am at any given time.<br><br>I don't see a need to oopify this.<br><br>Is there a standard approach for something like this?<br><br>-pmc <br><br></td></tr></table><br>
<a name="888961"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >CS_TBL</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'd just ditch the old geeky code and do a complete rewrite in Max in a proper style. I even do that with older Blitz code sometimes, let alone stone-age BASIC. <br><br></td></tr></table><br>
<a name="888976"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Xerra</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> It took me ages to get used to dumping goto and gosub when I first came to Blitz but it does encourage neater programming. In fact I think you can't even use those commands in strict mode. I'm with what the previous poster said. It's far easier to just rewrite the program than try and write some kind of structure to run it with few changes.<br><br>From a quick glance you could adapt what i can see with some if/endif statements and still keep it both readable and tidy. <br><br></td></tr></table><br>
<a name="888988"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >CS_TBL</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Goto and Gosub are just legacy from a time when there was no real procedural programming in BASIC and no neat scopes for programflow, no need to have those museum pieces around these days..<br><br>If a<br>..<br>..<br>Endif<br><br>beats<br><br>10 If a=0 goto 40<br>20 ..<br>30 ..<br>40 (continue)<br><br>if you ask me.. <br><br></td></tr></table><br>
<a name="889005"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >pmc</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah... well that's one reason I wanted to try this. I used to write BASIC code back in the day. I had forgotten how crazy the flow control could get. My question is more about what to consider when doing the rewrite: how to move from a top down flow and map that into a modern event loop. The two are so different that I wasn't sure how to even approach it. Modern games are all user driven. But the old ones were generally top down with pauses to get user input to influence flow control.<br><br>I thought about it some more and it occurs to me that I'm approaching it backwards. I was going to build a main event loop and then jump out to several functions to execute the game logic. But I think it makes more sense to just jump out to an event loop function that draws the graphics and does the IO whenever I need user input. That function loops until I get a response. Then I go back to main procedural code. The old procedural BASIC code will execute so fast that you wouldn't notice the time outside of the event loop function.<br><br>I can still use a "While Not KeyDown(KEY_ESCAPE)" loop for overall application, and "While Not KeyDown(KEY_ENTER)" loop while waiting for user input.<br><br>And yeah, I'm dumping all the GOTO and GOSUBs and all that and converting to modern code. But the logic remains the same because I want the same application in the end.<br><br>-pmc <br><br></td></tr></table><br>
<a name="889238"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sledge</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> What I'm thinking is that I need to write a command parser and then just jump out to a function depending on what the input command is. So the original code (minus the input and output parts) just gets mapped to a series of functions. <br></div><br>That's not an unreasonable solution -- one possible way to (begin to) implement it has been discussed <a href="/posts.php?topic=42089#471839" target="_blank">here</a>. <br><br></td></tr></table><br>
<a name="889515"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >pmc</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the link. It got me thinking about alternatives -- some of the examples could work for me.<br><br>So far I've created a list for outputs. And based on the program logic, I just change the elements of the list which gets displayed at the next screen update. Works like a champ.<br><br>The real problem continues to be how to nest the sequential logic into an event loop. I continue to try variants and so far haven't had success. <br><br>Bottom-line: the event loop goes round and round a zillion times per second to keep everthing on-screen current. But the code logic goes top to bottom and branches left and right based on the input of the user. These two concepts seem incompatible.<br><br>I had no idea this would become such a puzzle for me but I'm enjoying the challenge despite that.<br><br>-pmc <br><br></td></tr></table><br>
<a name="889554"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sledge</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> The real problem continues to be how to nest the sequential logic into an event loop. I continue to try variants and so far haven't had success. <br></div><br>That's because you've moved on from hard-coding logic to thinking about something that's more like an engine from which you can make your content distinct, which is a significant leap.<br><br>I made progress on something in a similar vein (a multiple choice adventure thingy) and it worked by using TMap entries as function pointers, each function being a 'location' that was allowed to use a set of sub-functions as a sort of scripting language. (Scripting within BlitzMax source files is obviously not ideal as having to compile scripts defeats part of the object of using them but it was more expedient than writing a LUA interface). BUT ANYWAY, for something like that the game-loop basically goes...<br><br>While...<br>&gt;Run the script for the current location.<br>&gt;(The location script says 'show <i>this</i> text and present <i>these</i> options').<br>&gt;Check if the user picked an option and if so alter the current location.<br>...Wend<br><br>...which is very simple because the system was essentially a retarded form of hypertext, but hopefully it gives you a sense of how to start separating the engine from the content. The first step is really to plan out and identify everything that needs to be supported by the engine (much as it is tempting to just dive in and code) because once you know that you're in a much better position to decide how the content should be stored and processed. <br><br></td></tr></table><br>
<a name="889596"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >pmc</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yup. I wound up doing something similar. I wrote a function for each section of the original code and then just used a variable to track the current "place" in the game. Not a location like you, but the place in the sequential program. Then I just run the event loop continuously just like an arcade game. Every time the user hits Enter, it sends the current input off to the correct function for processing. I update the output list as part of the function and the event loop dutifully keeps the graphics up to date. <br><br>So in the end, I actually just mapped the sequential logic into a series of functions and just call them from the event loop every time the user hits Enter.<br><br>Took me a while to get my head wrapped around how to get those two concepts to work together. Too long writing arcade stuff I guess.<br><br>Maybe I'll start to work on Zork when I'm done with this one. :)<br><br>Thanks for the help.<br><br>-pmc <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
