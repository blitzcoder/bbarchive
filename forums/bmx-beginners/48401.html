<!DOCTYPE html><html lang="en" ><head ><title >When are Images in video memory?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >When are Images in video memory?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=101" >BlitzMax Beginners Area</a>/<a href="#bottom" >When are Images in video memory?</a><br><br>
<a name="538228"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Are they using video memory when I load/create them or only when i actually draw them? I'd test but.. well.. there doesn't seem to be a command to report vid mem usage. <br><br></td></tr></table><br>
<a name="538240"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> When you use CreateImage() or LoadImage() or, I think there's also something like bglTextureFromPixmap() or something like that .. .When you use those, what you're doing is `uploading` an image into videoram. They then sit there in video ram for as long as the OpenGL context is present, or until you delete them. In some cases if you don't have enough video ram to hold all of the images that you are trying to use at once, it may spool some of the lesser used ones off to main memory and swap back and forth to try and accomodate you, which of course produces slowdown.<br><br>When you use DrawImage you are just taking the pixels from one location in video ram, pushing it through the OpenGL pipeline and squirting it out the other end usually into the backbuffer, which is also in video ram. I would say the front buffer is also in video ram, although in window mode I'm not sure how that exactly works.<br><br>If your hardware doesn't support any implimentation of OpenGL routines, ie it's just sitting there as a basic display device and not much else, you might have an OpenGL driver which does everything in software. In that case you might find that the images are `uploaded` from main memory TO main memory. The OpenGL system will then likely run at the same speed using DrawPixmap() as it does using DrawImage(), because both are using the CPU. In most cases your hardware and driver and OpenGL implimentation will support using the hardware to do stuff, in which case DrawImage is a lot faster.<br><br>At the moment we don't have functionality to get the address in video ram of the OpenGL buffer or images. Btw Images are the same thing as `textures` - ie uploaded graphics stored in video ram. OpenGL can only USE graphics that are considered `uploaded`, ie usually in video ram. It isn't usually able to work with graphics in main memory. You can transfer the backbuffer to/from main memory but it uses the CPU and is generally slow. Only when the image is stored in video ram can OpenGL use it to draw to/from. Pixmaps are a BlitzMax-invented object, which is alluded to in the OpenGL documentation, to provide `offline` CPU-based handling of graphics data that isn't `active` in the OpenGL system. Because OpenGL *manages* the textures/images, BlitzMax currently doesn't very well know what it's doing with it. Once Max asks OpenGL to do something, it's kind of like passing the baton. OpenGL then does its thing, or tries to, and returns to BlitzMax.<br><br>So at the moment we don't really have a way to get that memory address, and it may change every time you do a Flip. You can `lock` an image, which basically means download it to main memory, work on it as a pixmap, and then re-upload it. It would be GREAT to be able to get a lock on the backbuffer, plus get the actual memory address of the locked graphic. I don't think we currently have access to that.<br><br>I had been thinking that you could draw a small image to the backbuffer, like just an 8x8 image. Then you could get the base address of video ram and do a `search` through all of video ram trying to find the image data. Then if you find it, you might have the base address of the backbuffer. But I'm sure the memory may move a lot and is unpredictable, plus I don't really know what format the data is stored in. <br><br></td></tr></table><br>
<a name="538860"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm ok, thanks for that. I'm just noticing odd memory fluctuations when objects are hidden and shown, after they've been loaded. I can't really follow why hiding and unhiding an image would make any difference to system memory if it's in video memory already. <br><br></td></tr></table><br>
<a name="538894"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GW</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Im pretty sure that when a new image is created or loaded, it is not resident in video memory until it is first called to draw. <br>Even with plenty of video memory available, there is always a performance hit when you drawimage() the first time (from moving from main memory to video memory). <br><br></td></tr></table><br>
<a name="538955"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Umm, I don't think it does that. Looking at the code for LoadImage and such, they actually upload the image to the graphics card as a texture.<br><br>However, when you SWITCH between two different textures, you might notice a performance decrease because it has to `bind` the texture in order to select it. It's extra overhead so maybe that's what you're seeing. When you thereafter use that same image, without switching to another image, it would render faster. I don't think it has anything to do with what memory it's located in.<br><br>I also wonder if the fluctuating main memory that Sybixsus mentioned is just because OpenGL is writing something to it. <br><br></td></tr></table><br>
<a name="538969"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GW</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> As an example, take a huge image, something like 5k by 5k, break it up into tiles, 512x512 or so, write some code to draw all the tiles  each loop, and some functions to scroll around the entire image. you will notice that as each new tile comes into view for the first time, there will be a performance hit for each one (as its moved into vidmem). but (assuming you have plenty of vidmem) once they have all been shown once, everything will be smooth. This works for BB3D as well as BMax using both drivers.<br><br>BTW: there was a thread a few months back about having to do a 360^ RenderWorld() in b3d at the beginning of a 3d game before the main loop just for this reason. Otherwise the player will experience lots of choppyness the first time looking around. <br><br></td></tr></table><br>
<a name="539201"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Some kind of caching problem? <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
