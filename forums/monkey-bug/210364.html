<!DOCTYPE html><html lang="en" ><head ><title >[HTML5] Synchronous XMLHttpRequest deprecated</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >[HTML5] Synchronous XMLHttpRequest deprecated</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=501" >Monkey Bug Reports</a>/<a href="#bottom" >[HTML5] Synchronous XMLHttpRequest deprecated</a><br><br>
<a name="2115953"></a>

<a name="2115954"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shinkiro1</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> "Synchronous XMLHttpRequest on the main thread is deprecated because of its detrimental effects to the end user's experience. For more help, check https://xhr.spec.whatwg.org/."<br><br>is the warning I am getting in chrome 48. This affects LoadString() because it uses XMLHttpRequest. As a result I can no longer correctly load some files.<br><br>Worked fine on chrome 47, tested on firefox and works there as well. <br><br></td></tr></table><br>
<a name="2115979"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Difference</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I just ran into this too, while trying to load the same file twice in two different functions called from OnCreate(), when testing in HTML5 <br><br></td></tr></table><br>
<a name="2115992"></a>

<a name="2115993"></a>

<a name="2115994"></a>

<a name="2115996"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> This warning has always occurred for as long as I can remember, however it doesn't seem to adversely affect anything. This works here anyway...<br><br><pre class=code>
Import mojo

Function Main()

	Local str:=mojo.LoadString( "versions.txt" )
	
	Print str
End
</pre><br><br>Tested on Chrome 48 on both Windows/Mac.<br><br>The angelfont sample also seems to work fine (the only banana I could find that uses LoadString).<br><br> If you are having problems with LoadString, please post some runnable/testable code etc. <br><br></td></tr></table><br>
<a name="2115999"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Difference</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> The above code on fresh monkey 86d , Windows 10, Chrome Version 48.0.2564.97 m gives me: <br><br>Synchronous XMLHttpRequest on the main thread is deprecated because of its detrimental effects to the end user's experience. For more help, check <a href="https://xhr.spec.whatwg.org/." target="_blank">https://xhr.spec.whatwg.org/.</a><br><br>but fails on:<br><br>http://localhost:59922/main.js Failed to load resource: the server responded with a status of 404 (Not Found)BBGame.LoadString @ main.js:366<br><br>Tell me If I should try to make a mojo example. <br><br></td></tr></table><br>
<a name="2116003"></a>

<a name="2116004"></a>

<a name="2116005"></a>

<a name="2116006"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> &gt; Synchronous XMLHttpRequest on the main thread is deprecated because of its detrimental effects to the end user's experience. For more help, check <a href="https://xhr.spec.whatwg.org/." target="_blank">https://xhr.spec.whatwg.org/.</a><br><br>What do you mean by 'gives me'? Here, I get this printed in the developer console - but that's always happened.<br><br>&gt; http://localhost:59922/main.js Failed to load resource: the server responded with a status of 404 (Not Found)BBGame.LoadString @ main.js:366<br><br>You need a 'versions.txt' file in a data folder somewhere - I just copied in the monkey VERSIONS.TXT file (renamed to lowercase).<br><br>Does the beaker/angelfont_example demo work?<br><br>As far as I can tell, everything is working the same in chrome 48 as it always has. <br><br></td></tr></table><br>
<a name="2116058"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >k.o.g.</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Confirmed, working here too in Chrome 48 <br><br></td></tr></table><br>
<a name="2116059"></a>

<a name="2116060"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Difference</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry for the sloppy first test.<br>With a versions.txt (content: "Hello form versions text.) The code below Prints:<br>25<br>0<br><br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">Strict
Import mojo

Function Main:Int()

	Local str:=mojo.LoadString( "versions.txt" )
	Local strnumbertwo:=mojo.LoadString( "versions.txt" )

	Print str.Length()
	Print strnumbertwo.Length()
	
	Return 0
End</textarea> <br><br></td></tr></table><br>
<a name="2116081"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImmutableOctet(SKNG)</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have no problems using 'LoadString' twice with MServer, but I think I remember this issue. <b>It's likely the server returning 304 instead of the usual 200</b>. This is an issue with a lot of synchronous XMLHttpRequest code, and it's something that caused many headaches when making WebCC.<br><br>The best thing I've found to do is to use <a href="https://github.com/Regal-Internet-Brothers/virtualos/blob/68b1281ad4ce4b69ccc0276e0986ea48a5a18902/native/filesystem.js#L467" target="_blank">these header entries</a> for consistent results. Technically, "If-Modified-Since" isn't the most proper way to do this, but it helps with maximizing compatibility. The only other options are to either keep track of response-strings, or use "ETags", like what 'regal.virtualos' does when they're available. <br><br></td></tr></table><br>
<a name="2116064"></a>

<a name="2116065"></a>

<a name="2116066"></a>

<a name="2116068"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Fred</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br>I confirm that since Chrome 48, we have a lot file loading issues here at Gloomywood (HTML5) . We revert to Chrome 47 waiting to fix it. <br>If a file is loaded twice (or reloaded later like levels data) the second time gives an error and the file is not loaded. <br><br></td></tr></table><br>
<a name="2116122"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, I can confirm that LoadString twice fails the second time with both mserver and a real server, and that it does indeed appear to be a chrome (48?) specific issue.<br><br>&gt; The best thing I've found to do is to use these header entries for consistent results.<br><br>That works - thanks! I'll upload a v86f update soon.<br><br>&gt; Technically, "If-Modified-Since" isn't the most proper way to do this<br><br>Actually, it appears to be the key thing that fixes it for chrome. <br><br></td></tr></table><br>
<a name="2116120"></a>

<a name="2116123"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> ...and I guess I should add this to all XMLHttpRequests? <br><br></td></tr></table><br>
<a name="2116134"></a>

<a name="2116135"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImmutableOctet(SKNG)</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> @marksibly: Yeah, that's probably your best bet. Either that, or you cache the results. Again, '<a href="https://github.com/Regal-Internet-Brothers/virtualos" target="_blank">regal.virtualos</a>' has a lot of this covered, and it's still making me think I should make a hybrid target. I already did most of the work in WebCC's data-folder, so it's not out of the question. This would also fix the problems <a href="http://www.monkey-x.com/Community/posts.php?topic=10045" target="_blank">some people</a> have with resource loading. The codebase is modular now, so there's not much holding it back. I just haven't had the time or the need to make the target yet. <br><br></td></tr></table><br>
<a name="2116137"></a>

<a name="2116138"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Fix coming Thursday apparently!<br><br><a href="https://code.google.com/p/chromium/issues/detail?id=570622&amp;q=label%3AArch-x86_64&amp;colspec=ID%20Pri%20M%20Stars%20ReleaseBlock%20Cr%20Status%20Owner%20Summary%20OS%20Modified" target="_blank">https://code.google.com/p/chromium/issues/detail?id=570622&amp;q=label%3AArch-x86_64&amp;colspec=ID%20Pri%20M%20Stars%20ReleaseBlock%20Cr%20Status%20Owner%20Summary%20OS%20Modified</a><br><br>Perhaps I should do some user agent detection kludge? I suspect this problem will vanish for good very soon, and it seems a shame to effectively disable caching forever to fix it. <br><br></td></tr></table><br>
<a name="2116139"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, adding this to LoadString and LoadData in gametarget.js just before the xhr.send()'s fixes it for me.<br><br><pre class=code>
	if( navigator.userAgent.indexOf( "Chrome/48." )&gt;0 ){
		xhr.setRequestHeader( "If-Modified-Since","Sat, 1 Jan 2000 00:00:00 GMT" );
	}
</pre><br><br>Think I'll go with this for now and see what happens with the next Chrome update. <br><br></td></tr></table><br>
<a name="2116148"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImmutableOctet(SKNG)</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> @marksibly: I'm using Opera Developer, which is Chromium based. Given, it'll likely be patched here as well, but it's still an issue at the moment. It's probably best to keep that header addition as the default for a little while. For reference, <a href="https://code.google.com/p/chromium/issues/detail?id=583310" target="_blank">this says "All is well."</a> every time on FireFox nightly, but not Chrome or Opera.<br><br>It kind of sucks, but maximum compatibility is usually the best answer. I find it weird that the other options don't work in more situations, but if it doesn't work, there's not much you can do about it. <br><br></td></tr></table><br>
<a name="2116245"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Fred</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Problem fixed with the last Chrome Version 48.0.2564.103 m<br>Yes Mark, disabling the cache would not be a good solution. <br><br></td></tr></table><br>
<a name="2116274"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shinkiro1</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, the problem is fixed in the latest Chrome version. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
