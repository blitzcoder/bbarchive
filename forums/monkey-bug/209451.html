<!DOCTYPE html><html lang="en" ><head ><title >MonkeyStore: handling interrupted purchases</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >MonkeyStore: handling interrupted purchases</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=501" >Monkey Bug Reports</a>/<a href="#bottom" >MonkeyStore: handling interrupted purchases</a><br><br>
<a name="2098218"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >secondgear</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> As far as I can tell, there is a deficiency in BBMonkeyStore design:<br><br>If a user purchases a consumable item and for some reason doesn't return to the game, the store doesn't receive the fulfillment confirmation. The next time the game is launched, this purchase is consumed in <b>OpenStoreAsync</b> without notifying the rest of the game, so the game has no way of delivering purchased items to the user.<br><br>Although this is an unlikely scenario, this issue was noticed by Microsoft testers, and they asked me to fix my Windows Phone game. Here is my least invasive fix: I'll set <b>BBProduct-&gt;owned</b> even for consumables and query the results in the game code after BBMonkeyStore is successfully opened.<br><br>The issue isn't limited to WinRT target, so maybe a more permanent solution is needed. <br><br></td></tr></table><br>
<a name="2098248"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Will this work though? <br><br>Since you can buy consumables multiple times, wont checking for 'owned' result in multiple purchases? How will the app be able to test if 'owned' is related to a successful purchase or not?<br><br>For some weird reason, none of these store APIs seem to track how many consumables you've bought (I think) so I'm not sure what the right way to handle this is. <br><br></td></tr></table><br>
<a name="2098249"></a>

<a name="2098251"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, looking at the winrt code, I think what's supposed to happen is that user can make the purchase again, but wont be charged for it.<br><br>This is not ideal, but at least the user isn't ripped off!<br><br>I'll have a look for a better solution... <br><br></td></tr></table><br>
<a name="2098250"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >secondgear</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> My ugly plug relies on the game to reset "owned" to False after the item is awarded to the user. This way when BBMonkeyStore opens and detects an unfinished purchase, it notifies the app store that the purchase is finalized, and sets "owned" field to True. After my game code gets a callback from BBMonkeyStore, it retrieves consumable products and checks if any one of them is "owned". If it finds one, the game awards coins to the user and sets "owned" to False (I had to add a getter and a setter to the Product class).<br><br>Maybe a better approach would be to have a separate field for "unfinished" and reset in internally in MonkeyStore in some king of GetUnfinishedPurhcases() method? I don't know, I just went for a quick and dirty fix. <br><br></td></tr></table><br>
<a name="2098252"></a>

<a name="2098253"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> &gt; GetUnfinishedPurchases()<br><br>Yeah, that sounds pretty good.<br><br>Actually, there will only ever potentially be one unfinished purchase at most, correct? I guess it could be passed to IOnOpenStoreComplete, eg:<br><br>Method OnOpenStoreComplete:Void( result:Int,unfinished:Product ) <br><br></td></tr></table><br>
<a name="2098254"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >secondgear</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> &gt; Method OnOpenStoreComplete:Void( result:Int,unfinished:Product )<br><br>There should be only one, but to be on the safe side, it could be<br>Method OnOpenStoreComplete:Void( result:Int,unfinished:Product[] )<br><br>Otherwise, this is more elegant approach. Thank you, Mark. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
