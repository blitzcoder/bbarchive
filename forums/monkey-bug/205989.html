<!DOCTYPE html><html lang="en" ><head ><title >Android and Select</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Android and Select</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=501" >Monkey Bug Reports</a>/<a href="#bottom" >Android and Select</a><br><br>
<a name="2068452"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >eme64</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi everyone<br><br>I have now tryed debugging my long code for over 3 hours and don't quite understand what the problem is. I however suspect it must have to do with some sort of limit on the Android platform as to how many select-commands (or case) I used.<br><br>My App crashes only on Android (and not on HTML5), before any code of mine is even executed. I have been commenting out some big blocks of code and if they are big enaugh, the problem does not occour.<br><br>The Debug Log sais this:<br>java.lang.VerifyError: com/eme64/dingko001/c_TCode_String_Function<br>at com.eme64.dingko001.bb_.bbInit(MonkeyGame.java:16403)<br>at com.eme64.dingko001.MonkeyGame.onCreate(MonkeyGame.java:1499)<br><br>I am working with Version 74a, will soon try it with 75d.<br><br>Thanks in advance<br>eme64<br><br><br>Something else that worries me:<br>[javac] Note: C:\Users\Emanuel\Dropbox\Game Project\Monkey Dingko New\game.build\android\src\com\eme64\dingko001\MonkeyGame.java uses unchecked or unsafe operations <br><br></td></tr></table><br>
<a name="2068453"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >eme64</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> No difference with 75d unfortunately.<br><br>I would like to give you code, but I cannot give you 6648 Lines of code. <br><br></td></tr></table><br>
<a name="2068457"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Can you try to comment more lines to narrow down the problem? <br><br></td></tr></table><br>
<a name="2068458"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Goodlookinguy</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Select-Case statements are converted to if-else blocks by Monkey. So a select-case limit on Android is not your problem. <br><br></td></tr></table><br>
<a name="2068464"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >eme64</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well I would like to narrow it down, but unfortunately I was not able to do so. As I said, not one line of my code is being run (tested it with print). If I run it with HTML5 it works just fine.<br>Now, I have tryed to comment some "case"s out, and have done it multiple times at multiple locations, that do not have much to do with each other. When I remove enaugh Code, it works, but it seems not to depend on which code in particular I remove and that is the problem. So I concluded since it is not because the code does somthing wrong it must be somehow too much, and if some code is cut out, it is no longer too much. But of course it could still be, that there is a connection between these locations, that I missed.<br>Maybe someone can tell me what this meens:<br>java.lang.VerifyError: com/eme64/dingko001/c_TCode_String_Function<br><br>That could narrow down the possible locations that could cause the problem.<br><br>Many thanks<br>eme64 <br><br></td></tr></table><br>
<a name="2068466"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SLotman</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Are you trying to load or even draw stuff on OnCreate? <br><br>You shouldn't - and your program is crashing exactly on OnCreate... what exactly are you doing on OnCreate?<br>(Note that some targets are more forgiving than others, so if something works on HTML5 or even on GLFW, doesn't mean it will work on iOS or Android, where memory and speed resources are much lower) <br><br></td></tr></table><br>
<a name="2068465"></a>

<a name="2068478"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >eme64</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is my main():<br><pre class=code>
Function Main:Int()
	#If EME_DEBUG = "true" then
	Print "#############"
	Print ""
	Print "Debug Mode On"
	Print ""
	Print "#############"
	#endif
	
	Print "WASD - F1 for Debug-View"
	
	New Game()
	
	Return true
End Function
</pre><br><br>This my onCreate:<br><pre class=code>
 Method OnCreate:Int()
    	
    	'Debug Log
		Game.debug_log_list = New String[Game.debug_log_max]
		
    	For Local i:Int = 0 To Game.debug_log_max-1
    		Game.debug_log_list[i] = String.FromChar(0)
    	Next
    	
    	'Mouse
    	MOUSE.init()
    	
    	
    	#If TARGET="android" Or TARGET="ios" 'admob !
    	Self.admob=Admob.GetAdmob()
        Self.admob.ShowAdView 1,Self.ad_layout
        #Endif
        
        
    	SetVirtualDisplay Game.res_x, Game.res_y
    	
		SetUpdateRate 30
		
		Self.last_minute = Millisecs()
		
		Return true
    End Method
</pre><br><br>This the MOUSE.init()<br><pre class=code>
Function init:Int()
		MOUSE.x = New Float[3]
		MOUSE.y = New Float[3]
		MOUSE.typ = New Int[3]
		Return true
	End function
</pre><br><br>I do not see the app crash in any of that, at least I should get the<br><pre class=code>
Print "WASD - F1 for Debug-View"
</pre><br><br>The app crashes because of code in the OnUpdate(), or at least if I remove parts of it it does noch crash any more. In all the Bugs that I created myself the app at least started to run and I could find out where with stragegically placed "print"s.<br><br>Could anyone please tell me what this means?<br><pre class=code>
java.lang.VerifyError: com/eme64/dingko001/c_TCode_String_Function
</pre> <br><br></td></tr></table><br>
<a name="2068479"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >eme64</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> ah, I now see what it meens:<br>TCode_String_Function<br>it is a Class in my code.<br><br>How I "fixed" the problem now. Pseudocode:<br><pre class=code>
Method get:string(someinput)
	select txt
		case "a"
		case "b"
		...
		case "n"
		'crashed with case "n+1"
		default
			self.get2(someinput)
	endselect
end Method

Method get2:string(someinput)
	select txt
		case "n+1"
		
	endselect
end Method
</pre><br><br>The "solution" was simply to move the code that seems to create the problem. But remember, this code is not even run once, and it is even in the OnUpdate(). What could cause this?<br><br>One thing I could think of:<br>I reuse variablenames and redefine them for different Classes within one Select-Block<br>Example:<br><pre class=code>
Select True
	Case TSkin_Collision_Rect(TSkin.skins[skin].collision) &lt;&gt; null
		Local p:TSkin_Collision_Rect = TSkin_Collision_Rect(TSkin.skins[skin].collision)
		Return String(y + scale_y*(p.y1 + p.y2)/2.0)
	Case TSkin_Collision_Circle(TSkin.skins[skin].collision) &lt;&gt; null
		Local p:TSkin_Collision_Circle = TSkin_Collision_Circle(TSkin.skins[skin].collision)
		Return String(y + scale_y*p.y)
	Case TSkin_Collision_Points(TSkin.skins[skin].collision) &lt;&gt; null
		Local p:TSkin_Collision_Points = TSkin_Collision_Points(TSkin.skins[skin].collision)
		Local y1:Float = p.yl[0]
		Local y2:Float = p.yl[p.yl.Length()/2]
	Return String(y + scale_y*(y1 + y2)/2.0)
End Select
</pre><br><br>So "p" is reused for different Classes. And I do this a lot. How is this translated? Could this possibly be the problem? <br><br></td></tr></table><br>
<a name="2068481"></a>

<a name="2068483"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Goodlookinguy</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here's something interesting: <a href="http://stackoverflow.com/questions/100107/reasons-of-getting-a-java-lang-verifyerror" target="_blank">http://stackoverflow.com/questions/100107/reasons-of-getting-a-java-lang-verifyerror</a><br><br><div class="quote"> You would get this error if the bytecode size of your method exceeds the 64kb limit; but you would probably have noticed that. <br></div>This might be your problem. Refactor your code into more reusable chunks. <br><br></td></tr></table><br>
<a name="2068486"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SLotman</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Why you're doing this:<br><br><pre class=code>
	Game.debug_log_list = New String[Game.debug_log_max]
		
    	For Local i:Int = 0 To Game.debug_log_max-1
    		Game.debug_log_list[i] = String.FromChar(0)
    	Next
</pre><br><br>Strings as far as I know are initialized with zero length, so you don't need to do a Game.debug_log_list[i] = anything. I would at least comment out everything with this debug_log_list first and foremost, since this is a string, and your error shows a problem with strings on OnCreate.<br><br>Secondly... I really think this should be on OnUpdate. You can't guarantee admob will be initialized when your program is being created. Comment it out to see if your program runs.<br><br><pre class=code>
	#If TARGET="android" Or TARGET="ios" 'admob !
    	Self.admob=Admob.GetAdmob()
        Self.admob.ShowAdView 1,Self.ad_layout
        #Endif
</pre><br><br>Third...<br><br>This one, for sure must be on OnRender, and should be always called on every render frame.<br><pre class=code>
    	SetVirtualDisplay Game.res_x, Game.res_y
</pre> <br><br></td></tr></table><br>
<a name="2068485"></a>

<a name="2068484"></a>

<a name="2068487"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >eme64</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Goodlookinguy: Thank you for your help!<br>I think that it is the limitation of the size of the method.<br>game.build\android\bin\classes\com\eme64\dingko001\c_TCode_String_Function.class<br>This is the file of my Class that contains the Method that created the error and it is 97.8 KB big. Now that I split the Method into 2 Parts it just works fine. This is a bit unsatisfying though. What purpose serves this limit? Memory-saving?<br><br>@SLotman: I have all that code and it runs just fine, never had any problem with it.<br>You are right, the strings do not have to be iniciated.<br>In the examples Admob is also started in the OnCreate, and when there is no Internet then it just does not show any Ads.<br>And also with Autofit, I just took it from the demo-code, and there it was also in the OnCreate.<br>But thanks anyway :) <br><br></td></tr></table><br>
<a name="2068488"></a>

<a name="2068489"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Goodlookinguy</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> I looked up about the limitation and from Oracle's documentation it appears the limit is just some arbitrary value they chose. The same limitation is imposed on the number of interfaces a class can implement.<br><br><b>Edit:</b> Nevermind, <a href="http://stackoverflow.com/questions/5689798/why-does-java-limit-the-size-of-a-method-to-65535-byte/5689834#5689834" target="_blank">http://stackoverflow.com/questions/5689798/why-does-java-limit-the-size-of-a-method-to-65535-byte/5689834#5689834</a> <br><br></td></tr></table><br>
<a name="2068512"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >eme64</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> It would be cool if there was some sort of <b>Error-Detection</b> for this problem, could save some hours. But it is now at least <b>no Monkey-Bug</b>. This limit may seem high, but if you have big tables (select-case-block) it is stupid to cut it into multiple methods. This is just <b>spaghetti code</b> in the end. And isn't the reason of our modern Languages to prevent this? <br><br></td></tr></table><br>
<a name="2068511"></a>

<a name="2068517"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >computercoder</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't disagree about having some error handling capabilities. <br><br>In well written code, everything is broken down so the a higher level method relies on many smaller methods specialized at single tasks. It has a few different advantages in coding this way, one in particular is being able to read and follow the code easier. Maintaining the code is simpler to do as well, which in turn makes tracking bugs far easier in the long run. Each method you make is now callable by others, depending upon the scope you give it, and that allows you to make very re-usable code, and effectively you writen far less of it.<br><br>You can call it whatever you like, but if you design and structure your code right, its no where near spaghetti code. This is true of both procedural and object oriented code styles. We have <b><i>MILLIONS</i></b> of lines of code in the projects I work on at work. All of it is object oriented and we follow the practice I just described. When a bug appears within the code, we are able to locate the issue and have it rectified the same day (unless its a larger issue that needs some more time). The code is lightning fast as well.<br><br>In the end, its all bout how well you put your code together if its spaghetti code or its easy to read, understand, and maintain. <br><br></td></tr></table><br>
<a name="2068516"></a>

<a name="2068515"></a>

<a name="2068526"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >rIKmAN</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> This one, for sure must be on OnRender, and should be always called on every render frame.    	<br><pre class=code>SetVirtualDisplay Game.res_x, Game.res_y</pre> <br></div><br>If he is using autofit, then SetVirtualDisplay is called in OnCreate just once.<br>UpdateVirtualDisplay should be called in OnRender every frame, I think you may have mixed them up. <br><br></td></tr></table><br>
<a name="2068539"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SLotman</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> @rlKmAn: probably, I automated everything here on my side so I only wrote this stuff ages ago :)<br><br>If I were to trace this bug, I would look at MonkeyGame.java, line 1499... since that's where the Java VM crashed. I still think it is something within OnCreate. <br><br></td></tr></table><br>
<a name="2070358"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Samah</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> We had this problem at work too.  Button/menu item definitions are stored in a huge HashMap so that user permissions can be applied to them.  Some smart cookie thought it'd be a good idea to call map.put() 8000 times in the constructor.  I changed it to read from a .dat file instead and all is well. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
