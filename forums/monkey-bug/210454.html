<!DOCTYPE html><html lang="en" ><head ><title >glfw: GL_STENCIL_TEST no longer working</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >glfw: GL_STENCIL_TEST no longer working</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=501" >Monkey Bug Reports</a>/<a href="#bottom" >glfw: GL_STENCIL_TEST no longer working</a><br><br>
<a name="2117992"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nobuyuki</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello,<br><br>I don't know when this happened, but on my Windows 10 machine, the glfw target doesn't seem to want to cooperate and let me do arbitrary stencil operations.  Example code can be downloaded here:<br><br><a href="https://github.com/nobuyukinyuu/nDrawExts2" target="_blank">https://github.com/nobuyukinyuu/nDrawExts2</a><br><br>Check the screenshot on the Github page for what the arbitrary stencil SHOULD look like.  When compiling to Android (API_10), the code works just like in the screenshot, and in previous versions of Monkey, this also worked (although needed a bit of a workaround to get it to work on MacOS;  re-initializing the window with 8 bit depth allocated to the stencil buffer, I'm assuming because it defaulted to a nonsupported value).  In the new version of Monkey, I had to use SetDeviceWindow, but I <i>think</i> the code was working even then, although I could be wrong, because it was updated "in a hurry" just to get it to compile again.<br><br>Here's what it looks like now;  the behavior's clearly broken, and the stencil mask is clearly passing everything to be drawn.<br><img src="https://i.imgur.com/V1soKB1.png"><br><br>I tried it without SetDeviceWindow(), and the result was the same.  Am I missing some voodoo here, or did the change over to this as a documented feature disable stencil bit processing entirely? <br><br></td></tr></table><br>
<a name="2117991"></a>

<a name="2117994"></a>

<a name="2117995"></a>

<a name="2117996"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nobuyuki</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Figured out the issue.  My current workaround involves editing the GLFW3 target.  Please consider a patch!<br><br>In \targets\glfw3\modules\native\glfwgame.cpp , line 579, change the following line:<br><pre class=code>glfwWindowHint( GLFW_STENCIL_BITS,0 );</pre><br><br>to this:<br><pre class=code>glfwWindowHint( GLFW_STENCIL_BITS,8 );</pre><br><br>A new flag for SetDeviceWindow could also do, if you don't want the stencil channel to be enabled by default.... <br><br></td></tr></table><br>
<a name="2118375"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nobuyuki</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've created a pull request for this issue, with a conservative approach just in case there's a reason to have the default stencilbits hint set at 0.  Please consider...<br><a href="https://github.com/blitz-research/monkey/pull/89" target="_blank">https://github.com/blitz-research/monkey/pull/89</a> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
