<!DOCTYPE html><html lang="en" ><head ><title >Since v84d Android AdmobInterstitial Fails</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Since v84d Android AdmobInterstitial Fails</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=501" >Monkey Bug Reports</a>/<a href="#bottom" >Since v84d Android AdmobInterstitial Fails</a><br><br>
<a name="2117637"></a>

<a name="2117638"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Mark,<br><br>Since this change in v84d, the AdmobInterstitial module fails:<br><br><pre class=code>Tweaked android_new target so OnUpdate always happens on render thread.</pre><br><br>What did this fix?<br><br>Going back to v84b version of androidgame.java fixes the AdmobInterstitial module (I havent got v84c).<br><br>SilientShark reported this a few months ago, here is his debug log:<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">E/dalvikvm(20570): No JIT support for bytecode f0 at offsetPC 0
E/dalvikvm(20570): JIT implementation not found
I/dalvikvm(20570): codeGenBasicBlockJit returns negative number
D/dalvikvm(20570): GC_CONCURRENT freed 1903K, 53% free 8597K/17923K, paused 0ms+0ms
I/[Monkey](20570): Monkey Runtime Error : isLoaded must be called on the main UI thread.
I/[Monkey](20570): C:/Users/tom/Dropbox/MonkeyXPro85e/tom/tanks.monkey&lt;2836&gt;
I/[Monkey](20570): C:/Users/tom/Dropbox/MonkeyXPro85e/tom/tanks.monkey&lt;1713&gt;
I/[Monkey](20570): C:/Users/tom/Dropbox/MonkeyXPro85e/modules/mojo/app.monkey&lt;105&gt;
W/dalvikvm(20570): threadid=12: thread exiting with uncaught exception (group=0xb2c4e180)
D/BstCommandProcessor-Application(19085): Application crash has been observed.
I/Process (20570): Sending signal. PID: 20570 SIG: 9
D/AndroidRuntime(20570): procName from cmdline: com.silentshark.tanks
E/AndroidRuntime(20570): in writeCrashedAppName, pkgName :com.silentshark.tanks
D/AndroidRuntime(20570): file written successfully with content: com.silentshark.tanks StringBuffer : ;com.silentshark.tanks
E/AndroidRuntime(20570): FATAL EXCEPTION: GLThread 133
E/AndroidRuntime(20570): java.lang.IllegalStateException: isLoaded must be called on the main UI thread.
E/AndroidRuntime(20570):        at com.google.android.gms.common.internal.bx.b(SourceFile:251)
E/AndroidRuntime(20570):        at com.google.android.gms.ads.internal.a.c(SourceFile:193)
E/AndroidRuntime(20570):        at com.google.android.gms.ads.internal.client.aa.onTransact(SourceFile:66)
E/AndroidRuntime(20570):        at android.os.Binder.transact(Binder.java:297)
E/AndroidRuntime(20570):        at com.google.android.gms.internal.ap$a$a.isReady(Unknown Source)
E/AndroidRuntime(20570):        at com.google.android.gms.internal.au.isLoaded(Unknown Source)
E/AndroidRuntime(20570):        at com.google.android.gms.ads.InterstitialAd.isLoaded(Unknown Source)
E/AndroidRuntime(20570):        at com.silentshark.tanks.AdmobInterstitial.ShowAd(MonkeyGame.java:2911)
E/AndroidRuntime(20570):        at com.silentshark.tanks.c_game.m_see_if_dead(MonkeyGame.java:3650)
E/AndroidRuntime(20570):        at com.silentshark.tanks.c_game.p_OnUpdate(MonkeyGame.java:5035)
E/AndroidRuntime(20570):        at com.silentshark.tanks.c_GameDelegate.UpdateGame(MonkeyGame.java:6104)
E/AndroidRuntime(20570):        at com.silentshark.tanks.BBGame.UpdateGame(MonkeyGame.java:596)
E/AndroidRuntime(20570):        at com.silentshark.tanks.BBAndroidGame.UpdateGame(MonkeyGame.java:1267)
E/AndroidRuntime(20570):        at com.silentshark.tanks.BBAndroidGame.onDrawFrame(MonkeyGame.java:1334)
E/AndroidRuntime(20570):        at android.opengl.GLSurfaceView$GLThread.guardedRun(GLSurfaceView.java:1462)
E/AndroidRuntime(20570):        at android.opengl.GLSurfaceView$GLThread.run(GLSurfaceView.java:1216)
W/InputDispatcher(18891): channel 'b337cdd0 com.silentshark.tanks/com.silentshark.tanks.MonkeyGame (server)' ~ Consumer closed input channel or an error occurred.  events=0x8
E/InputDispatcher(18891): channel 'b337cdd0 com.silentshark.tanks/com.silentshark.tanks.MonkeyGame (server)' ~ Channel is unrecoverably broken and will be disposed!
W/InputDispatcher(18891): Attempted to unregister already unregistered input channel 'b337cdd0 com.silentshark.tanks/com.silentshark.tanks.MonkeyGame (server)'
I/WindowManager(18891): WINDOW DIED Window{b337cdd0 com.silentshark.tanks/com.silentshark.tanks.MonkeyGame paused=false}
W/WindowManager(18891): Force-removing child win Window{b322ec40 SurfaceView paused=false} from container Window{b337cdd0 com.silentshark.tanks/com.silentshark.tanks.MonkeyGame paused=false}
I/ActivityManager(18891): Process com.silentshark.tanks (pid 20570) has died.
W/ActivityManager(18891): Force removing ActivityRecord{b3271d70 com.silentshark.tanks/.MonkeyGame}: app died, no saved state
D/ActivityManager(18891): TopActivityInfo, pkgName: com.bluestacks.gamepophome activityName: com.bluestacks.gamepophome/tv.gamepop.home.GamePopMain_  bstSpecialAppKeyboardHandlingEnabled = false
D/ActivityManager(18891): Showing guidance for pkgName: com.bluestacks.gamepophome
D/GuidanceScreen(19035): hiding guidance
D/GuidanceScreen(19035): hardKeyboard = 1</textarea><br><a href="http://www.monkey-x.com/Community/posts.php?topic=8002" target="_blank">http://www.monkey-x.com/Community/posts.php?topic=8002</a><br><br>Could you please have a look at a solution for this as I would like to use the latest Monkey/Mojo code.<br><br>Cheers,<br>Steve <br><br></td></tr></table><br>
<a name="2117690"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> OnUpdate got moved to the render thread because mojo2 allows you to draw 'offscreen' at any time.<br><br>As far as I know, there is no reliable way to share GL contexts between threads on android, so there is no easy solution to this. Either the module will have to be updated so that isLoaded etc are called on the main thread (if it's got an onLoaded method, this could just set a global var...) or mojo2 loses the ability to render off screen outside of OnRender. <br><br></td></tr></table><br>
<a name="2117750"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Mark,<br><br>Been away for a couple of days. Here is the module code, its pretty small:<br><br>Java:<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
import com.google.android.gms.ads.*;

/**
 * Simple Admob Interstitial support for Monkey
 *
*/
class AdmobInterstitial implements Runnable{

	// the kind of "singleton"
	static AdmobInterstitial _admob;
	// the ad
	InterstitialAd interstitialAd;
	// ad Unit ID
	String adUnitId;
	
	// creates an instance of the object and start the thread
	static public AdmobInterstitial GetAdmobInterstitial(String adUnitId){
		if( _admob==null ) _admob=new AdmobInterstitial();
		_admob.startAd(adUnitId);
		return _admob;
	}

	// displays the ad to the user if it is ready
	public void ShowAd( ){
		if (interstitialAd != null ) {
			if (interstitialAd.isLoaded()) {
				interstitialAd.show();
			}
		}
	}
	
	// start the thread 
	private void startAd(String adUnitId){
		this.adUnitId = adUnitId;
		BBAndroidGame.AndroidGame().GetGameView().post(this);
	}
	
	// loads an ad
	private void loadAd(){
		if (interstitialAd != null ) {
			AdRequest.Builder adRequest = new AdRequest.Builder();
			interstitialAd.loadAd(adRequest.build());
		}
	}
	
	// the runner
	public void run(){
		Activity activity = BBAndroidGame.AndroidGame().GetActivity();
		interstitialAd = new InterstitialAd( activity );
		interstitialAd.setAdUnitId(adUnitId);
		
		// set listener so we load a new ad when the user closes one
		interstitialAd.setAdListener(new AdListener() {
		
			public void onAdFailedToLoad(int errorCode) {
			}			
			
			public void onAdClosed() {
				loadAd();
			}
			
			public void onAdLeftApplication() {
			}
			
			public void onAdLoaded() {
			}
			
			public void onAdOpened() {
			}

		});
		
		// load the first ad
		loadAd();
	}
}
</textarea><br><br>Monkey:<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">#If TARGET&lt;&gt;"android"
#Error "The AdmobInterstitial module is only available on the Android"
#End

#If TARGET="android"
	Import brl.admob
	Import "native/admobInterstitial.java"
#End

Extern

Class AdmobInterstitial Extends Null = "AdmobInterstitial"
	Function GetAdmobInterstitial:AdmobInterstitial(adUnitId:String)
	Method ShowAd:Void()
End
</textarea><br><br><div class="quote"> if it's got an onLoaded method, this could just set a global var... <br></div><br>How would we do this? With the above code? It would be great to be able to use the module with Mojo2.<br><br>Cheers,<br>Steve <br><br></td></tr></table><br>
<a name="2117749"></a>

<a name="2117748"></a>

<a name="2117799"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> This may or may not work!<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">

import com.google.android.gms.ads.*;

/**
 * Simple Admob Interstitial support for Monkey
 *
*/
class AdmobInterstitial implements Runnable{

	// the kind of "singleton"
	static AdmobInterstitial _admob;
	// the ad
	InterstitialAd interstitialAd;
	// ad Unit ID
	String adUnitId;
	
	boolean loaded;
	
	// creates an instance of the object and start the thread
	static public AdmobInterstitial GetAdmobInterstitial(String adUnitId){
		if( _admob==null ) _admob=new AdmobInterstitial();
		_admob.startAd(adUnitId);
		return _admob;
	}

	// displays the ad to the user if it is ready
	public void ShowAd( ){
		if (interstitialAd != null ) {
			if( loaded ){
				loaded=false;
				BBAndroidGame.AndroidGame().GetGameView().post(this);
			}
		}
	}
	
	// start the thread 
	private void startAd(String adUnitId){
		this.adUnitId = adUnitId;
		BBAndroidGame.AndroidGame().GetGameView().post(this);
	}
	
	// loads an ad
	private void loadAd(){
		if (interstitialAd != null ) {
			AdRequest.Builder adRequest = new AdRequest.Builder();
			interstitialAd.loadAd(adRequest.build());
		}
	}
	
	// the runner
	public void run(){
	
		if( interstitialAd != null ){
			interstitialAd.show();
			return;
		}
		
		Activity activity = BBAndroidGame.AndroidGame().GetActivity();
		interstitialAd = new InterstitialAd( activity );
		interstitialAd.setAdUnitId(adUnitId);
		
		// set listener so we load a new ad when the user closes one
		interstitialAd.setAdListener(new AdListener() {
		
			public void onAdFailedToLoad(int errorCode) {
			}			
			
			public void onAdClosed() {
				loadAd();
			}
			
			public void onAdLeftApplication() {
			}
			
			public void onAdLoaded() {
				loaded=true;
			}
			
			public void onAdOpened() {
			}

		});
		
		// load the first ad
		loadAd();
	}
}
</textarea> <br><br></td></tr></table><br>
<a name="2117856"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Mark, nearly works... after the Ad is displayed the game input freezes and produces this log:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">I/[Monkey](26162): onAdClosed

I/[Monkey](26162): loadAd...

E/MPL-storeload(  462): calData from inv_save_mpl_states, size=2

E/MPL-storeload(  462): calData from inv_save_mpl_states, size=2

E/MPL-storeload(  462): calData from inv_save_mpl_states, size=2

I/[Monkey](26162): DebugPrint - Playing sound STAR1

I/[Monkey](26162): DebugPrint - Playing sound STAR2

I/[Monkey](26162): DebugPrint - Playing sound STAR3

E/WifiHAL (  462): Error polling socket

E/WifiStateMachine(  462): WifiStateMachine CMD_START_SCAN source -2 txSuccessRate=3.79 rxSuccessRate=7.31 targetRoamBSSID=c0:4a:00:99:b5:06 RSSI=-19

E/ActivityManager(  462): ANR in com.therevillsgames.csusatripeaks (com.therevillsgames.csusatripeaks/.MonkeyGame)

E/ActivityManager(  462): PID: 26162

E/ActivityManager(  462): Reason: Input dispatching timed out (Waiting to send non-key event because the touched window has not finished processing certain input events that were delivered to it over 500.0ms ago.  Wait queue length: 3.  Wait queue head age: 7834.1ms.)

E/ActivityManager(  462): Load: 1.3 / 1.23 / 1.1

E/ActivityManager(  462): CPU usage from 2840ms to -6604ms ago:

E/ActivityManager(  462):   95% 3453/com.google.android.gms: 92% user + 3.4% kernel / faults: 1991 minor

E/ActivityManager(  462):   48% 462/system_server: 32% user + 16% kernel / faults: 3722 minor 4 major

E/ActivityManager(  462):   31% 26162/com.therevillsgames.csusatripeaks: 24% user + 7.9% kernel / faults: 1057 minor 2 major

E/ActivityManager(  462):   13% 118/surfaceflinger: 8.9% user + 4.7% kernel / faults: 1 minor

E/ActivityManager(  462):   13% 124/mediaserver: 9.4% user + 4% kernel / faults: 2 minor

E/ActivityManager(  462):   0.3% 122/debuggerd: 0% user + 0.2% kernel / faults: 2182 minor 3 major

E/ActivityManager(  462):   7.7% 595/com.android.systemui: 6% user + 1.6% kernel / faults: 1426 minor

E/ActivityManager(  462):   4% 85/irq/409-inv_irq: 0% user + 4% kernel

E/ActivityManager(  462):   3.7% 1008/com.android.phone: 2.8% user + 0.8% kernel / faults: 908 minor

E/ActivityManager(  462):   0.3% 971/com.android.nfc: 0.1% user + 0.1% kernel / faults: 976 minor 2 major

E/ActivityManager(  462):   1.8% 25794/kworker/u:4: 0% user + 1.8% kernel

E/ActivityManager(  462):   0% 989/com.nuance.xt9.input: 0% user + 0% kernel / faults: 768 minor

E/ActivityManager(  462):   1.4% 113/logd: 1.3% user + 0.1% kernel

E/ActivityManager(  462):   1.2% 16520/irq/214-host_sp: 0% user + 1.2% kernel

E/ActivityManager(  462):   0.2% 82/mmcqd/0: 0% user + 0.2% kernel

E/ActivityManager(  462):   0.4% 21686/kworker/0:0: 0% user + 0.4% kernel

E/ActivityManager(  462):   0.2% 94/dhd_dpc: 0% user + 0.2% kernel

E/ActivityManager(  462):   0.2% 16521/irq/218-host_sp: 0% user + 0.2% kernel

E/ActivityManager(  462):   0% 90/irq/77-tegra_ac: 0% user + 0% kernel

E/ActivityManager(  462):   0% 93/dhd_watchdog: 0% user + 0% kernel

E/ActivityManager(  462):   0% 2112/com.google.android.apps.plus: 0% user + 0% kernel / faults: 307 minor

E/ActivityManager(  462):   0% 3382/com.google.android.gms.persistent: 0% user + 0% kernel / faults: 9 minor

E/ActivityManager(  462):   0.1% 16522/irq/210-host_sp: 0% user + 0.1% kernel

E/ActivityManager(  462):   0.1% 16573/wpa_supplicant: 0% user + 0.1% kernel

E/ActivityManager(  462):   0.1% 25113/kworker/u:2: 0% user + 0.1% kernel

E/ActivityManager(  462):   0% 26584/kworker/2:2: 0% user + 0% kernel

E/ActivityManager(  462):   0% 26781/kworker/3:1: 0% user + 0% kernel

E/ActivityManager(  462):  +0% 26907/kworker/0:1: 0% user + 0% kernel

E/ActivityManager(  462): 60% TOTAL: 45% user + 14% kernel + 0.1% iowait

E/ActivityManager(  462): CPU usage from 5746ms to 6333ms later:

E/ActivityManager(  462):   115% 3453/com.google.android.gms: 112% user + 3.5% kernel / faults: 356 minor

E/ActivityManager(  462):     85% 16677/Thread-5124: 82% user + 3.5% kernel

E/ActivityManager(  462):     29% 3467/GCDaemon: 29% user + 0% kernel

E/ActivityManager(  462):   37% 462/system_server: 18% user + 18% kernel / faults: 19 minor

E/ActivityManager(  462):     11% 482/ActivityManager: 1.6% user + 10% kernel

E/ActivityManager(  462):     8.4% 480/SensorService: 3.3% user + 5% kernel

E/ActivityManager(  462):     5% 473/FinalizerDaemon: 5% user + 0% kernel

E/ActivityManager(  462):     5% 485/android.ui: 5% user + 0% kernel

E/ActivityManager(  462):     1.6% 747/Binder_4: 0% user + 1.6% kernel

E/ActivityManager(  462):     1.6% 1006/Binder_9: 0% user + 1.6% kernel

E/ActivityManager(  462):     1.6% 1059/Binder_B: 0% user + 1.6% kernel

E/ActivityManager(  462):     1.6% 2961/Binder_E: 1.6% user + 0% kernel

E/ActivityManager(  462):   29% 26162/com.therevillsgames.csusatripeaks: 17% user + 12% kernel / faults: 3 minor

E/ActivityManager(  462):     22% 26183/GLThread 1261: 14% user + 8.7% kernel

E/ActivityManager(  462):     5.2% 26162/s.csusatripeaks: 1.7% user + 3.5% kernel

E/ActivityManager(  462):   15% 118/surfaceflinger: 8.3% user + 6.6% kernel

E/ActivityManager(  462):     11% 118/surfaceflinger: 6.6% user + 5% kernel

E/ActivityManager(  462):     1.6% 145/DispSync: 0% user + 1.6% kernel

E/ActivityManager(  462):     1.6% 147/Binder_2: 0% user + 1.6% kernel

E/ActivityManager(  462):     1.6% 237/hwc_eventmon: 1.6% user + 0% kernel

E/ActivityManager(  462):     1.6% 245/EventThread: 0% user + 1.6% kernel

E/ActivityManager(  462):     1.6% 643/Binder_4: 1.6% user + 0% kernel

E/ActivityManager(  462):   15% 124/mediaserver: 10% user + 5% kernel

E/ActivityManager(  462):     3.3% 26762/NPDecoder: 1.6% user + 1.6% kernel

E/ActivityManager(  462):     3.3% 26763/NPDecoder-CL: 3.3% user + 0% kernel

E/ActivityManager(  462):     1.6% 460/FastMixer: 0% user + 1.6% kernel

E/ActivityManager(  462):     1.6% 514/AudioOut_2: 1.6% user + 0% kernel

E/ActivityManager(  462):     1.6% 26761/NuPlayerRendere: 1.6% user + 0% kernel

E/ActivityManager(  462):     1.6% 26764/.vorbis.decoder: 1.6% user + 0% kernel

E/ActivityManager(  462):   5% 85/irq/409-inv_irq: 0% user + 5% kernel

E/ActivityManager(  462): 55% TOTAL: 42% user + 12% kernel

E/WifiStateMachine(  462): WifiStateMachine CMD_START_SCAN source -2 txSuccessRate=0.14 rxSuccessRate=1.94 targetRoamBSSID=c0:4a:00:99:b5:06 RSSI=-20

E/WifiStateMachine(  462): WifiStateMachine starting scan for "TP-LINK_2.4GHz_99B506"WPA_PSK with 2437

E/WifiStateMachine(  462): WifiStateMachine CMD_START_SCAN source -2 txSuccessRate=0.31 rxSuccessRate=2.48 targetRoamBSSID=c0:4a:00:99:b5:06 RSSI=-20

E/WifiStateMachine(  462): WifiStateMachine starting scan for "TP-LINK_2.4GHz_99B506"WPA_PSK with 2437</textarea><br><br>And then dies after a few seconds... <br><br></td></tr></table><br>
<a name="2117873"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paul - Taiphoz</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Daft question but why is a change for mojo2 affecting monkey1 are you planning on having mojo2 work on monkey1 and 2 ? or am I not reading this thread correctly. <br><br></td></tr></table><br>
<a name="2117886"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tiresius</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Mojo2 is part of Monkey1.<br>Monkey2 will have something similar to Mojo2.<br>Hopefully it's not called Mojo3. <br><br></td></tr></table><br>
<a name="2117898"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I tried a different approach yesterday:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">import com.google.android.gms.ads.*;

/**
 * Simple Admob Interstitial support for Monkey
 *
*/
class AdmobInterstitial{

	// the kind of "singleton"
	static AdmobInterstitial _admob;
	// the ad
	InterstitialAd interstitialAd;
	// ad Unit ID
	String adUnitId;
	
	// creates an instance of the object
	static public AdmobInterstitial GetAdmobInterstitial(String adUnitId){
		if( _admob==null ) _admob = new AdmobInterstitial();
		_admob.startAd(adUnitId);
		return _admob;
	}

    public void ShowAd() {
        final Activity activity = BBAndroidGame.AndroidGame().GetActivity();
        final Runnable runnable = new Runnable() {
            public void run() {
                activity.runOnUiThread(new Runnable() {
                    @Override
                    public void run() {
                        interstitialAd = new InterstitialAd(activity);
                        interstitialAd.setAdUnitId(adUnitId);
                        AdRequest adRequest = new AdRequest.Builder().build();
                        interstitialAd.loadAd(adRequest);
                        interstitialAd.setAdListener(new AdListener() {
                            public void onAdLoaded() {
                                DisplayInterstitial(interstitialAd);
                            }
                        });
                    }
                });
            }
        };
	runnable.run();
	}
	
	public void DisplayInterstitial( InterstitialAd interstitialAd ){
		if (interstitialAd != null ) {
			if (interstitialAd.isLoaded()) {
				interstitialAd.show();
			}
		}
	}
	
	private void startAd(String adUnitId){
		this.adUnitId = adUnitId;
	}
}
</textarea><br><br>Which displays the ad using the latest Monkey/Mojo... but I still get the ANR when returning to the game afterwards :(<br><br><pre class=code>E/ActivityManager(  462): ANR in com.therevillsgames.csusatripeaks (com.therevillsgames.csusatripeaks/.MonkeyGame)

E/ActivityManager(  462): Reason: Input dispatching timed out (Waiting to send non-key event because the touched window has not finished processing certain input events that were delivered to it over 500.0ms ago.  Wait queue length: 3.  Wait queue head age: 7834.1ms.)</pre> <br><br></td></tr></table><br>
<a name="2117897"></a>

<a name="2117895"></a>

<a name="2117896"></a>

<a name="2117894"></a>

<a name="2117899"></a>

<a name="2117900"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I did a adb pull to get the full log and the place where the ANR happens is in MouseEvent (line 674):<br><br><pre class=code>ALVIK THREADS (45):
"main" prio=5 tid=1 Blocked
  | group="main" sCount=1 dsCount=0 obj=0x73665eb8 self=0x400ce600
  | sysTid=5338 nice=-6 cgrp=default sched=0/0 handle=0x400a4bec
  | state=S schedstat=( 2986155000 801129000 11511 ) utm=205 stm=93 core=3 HZ=100
  | stack=0xbe68f000-0xbe691000 stackSize=8MB
  | held mutexes=
  at com.therevillsgames.csusatripeaks.BBGame.MotionEvent(MonkeyGame.java:674)
  - waiting to lock &lt;0x30ab1fe1&gt; (a com.therevillsgames.csusatripeaks.c_GameDelegate) held by thread 13
  at com.therevillsgames.csusatripeaks.BBAndroidGame.onSensorChanged(MonkeyGame.java:1402)
  at android.hardware.SystemSensorManager$SensorEventQueue.dispatchSensorEvent(SystemSensorManager.java:405)
  at android.os.MessageQueue.nativePollOnce(Native method)
  at android.os.MessageQueue.next(MessageQueue.java:143)
  at android.os.Looper.loop(Looper.java:122)
  at android.app.ActivityThread.main(ActivityThread.java:5254)
  at java.lang.reflect.Method.invoke!(Native method)
  at java.lang.reflect.Method.invoke(Method.java:372)
  at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:903)
  at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:698)</pre><br><br>Here is the full ADB log:<br><br><a href="http://pastebin.com/uMiqLBLz" target="_blank">http://pastebin.com/uMiqLBLz</a><br><br>Line 647 is the "Try" block:<br><pre class=code>	void MouseEvent( int event,int data,float x,float y ){

		if( !_started ) return;
		
		try{
			synchronized( _delegate ){
				_delegate.MouseEvent( event,data,x,y );
			}
		}catch( RuntimeException ex ){
			Die( ex );
		}
	}</pre> <br><br></td></tr></table><br>
<a name="2117910"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> G'ah! Just been testing for the past couple of hours trying different things... and the ANR happens on "proper" ads only! When using a test device and/or the test ad unit ID it works fine! <br><br></td></tr></table><br>
<a name="2117918"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is the app getting suspended/resumed properly? Try sticking some Prints in OnSuspend/OnResume. <br><br></td></tr></table><br>
<a name="2117922"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Is the app getting suspended/resumed properly? Try sticking some Prints in OnSuspend/OnResume. <br></div><br>Yes, the game reappears after the ad and after a few seconds I touch the screen the ANR happens (sometimes after a few touches). Added tracing "OnResume" and "OnSuspend" logs:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">I/OMXClient(  677): Using client-side OMX mux.
I/SoftAAC2(  677): Reconfiguring decoder: 0-&gt;44100 Hz, 0-&gt;2 channels
W/ActivityManager(  462): Activity pause timeout for ActivityRecord{13e45f4b u0 com.therevillsgames.csusatripeaks/.MonkeyGame t159}
I/ClearcutLoggerApiImpl(13527): disconnect managed GoogleApiClient
I/art     (  677): Clamp target GC heap from 83MB to 80MB
I/art     (  677): Background partial concurrent mark sweep GC freed 65569(2MB) AllocSpace objects, 1(2MB) LOS objects, 15% free, 67MB/80MB, paused 2.133ms total 109.565ms
E/WifiStateMachine(  462): WifiStateMachine CMD_START_SCAN source -2 txSuccessRate=374.53 rxSuccessRate=661.55 targetRoamBSSID=c0:4a:00:99:b5:06 RSSI=-36
W/ActivityManager(  462): Launch timeout has expired, giving up wake lock!
I/Keyboard.Facilitator.LanguageModelFlusher(25232): run()
I/Keyboard.Facilitator(25232): flushDynamicLanguageModels()
I/InputDispatcher(  462): Dropping event because there is no touchable window at (936, 265).
I/[Monkey](  677): DebugPrint - OnSuspend...
D/DynamitePackage(  677): Instantiating com.google.android.gms.ads.ChimeraAdOverlayCreatorImpl
I/Ads     (  677): Ad opening.
V/WindowManager(  462): Adding window Window{38040c2e u0 com.therevillsgames.csusatripeaks/com.google.android.gms.ads.AdActivity} at 5 of 11 (after Window{49f45b1 u0 com.therevillsgames.csusatripeaks/
com.therevillsgames.csusatripeaks.MonkeyGame})
V/PhoneStatusBar(  595): setLightsOn(true)
D/cr_Ime  (  677): [ImeAdapter.java:358] onViewFocusChanged: gainFocus [true]
I/ActivityManager(  462): Displayed com.therevillsgames.csusatripeaks/com.google.android.gms.ads.AdActivity: +19s947ms
I/MPL-storeload(  462): mpl state size = 5584
E/MPL-storeload(  462): calData from inv_save_mpl_states, size=2
I/MPL-storeload(  462): cal data size to write = 5584
I/MPL-storeload(  462): Bytes written = 5584
D/cr_Ime  (  677): [ImeAdapter.java:140] onCreateInputConnection returns null.
I/Keyboard.Facilitator(25232): onFinishInput()
D/cr_Ime  (  677): [ImeAdapter.java:553] focusedNodeChanged: isEditable [false]
D/cr_Ime  (  677): [ImeAdapter.java:253] updateKeyboardVisibility: type [0-&gt;0], flags [0], show [true],
D/cr_Ime  (  677): [ImeAdapter.java:326] hideKeyboard
D/cr_Ime  (  677): [InputMethodManagerWrapper.java:56] isActive: true
D/cr_Ime  (  677): [InputMethodManagerWrapper.java:65] hideSoftInputFromWindow
D/cr_Ime  (  677): [ImeAdapter.java:358] onViewFocusChanged: gainFocus [false]
D/cr_Ime  (  677): [ImeAdapter.java:326] hideKeyboard
D/cr_Ime  (  677): [InputMethodManagerWrapper.java:56] isActive: true
D/cr_Ime  (  677): [InputMethodManagerWrapper.java:65] hideSoftInputFromWindow
W/ActivityManager(  462): Duplicate finish request for ActivityRecord{202d2271 u0 com.therevillsgames.csusatripeaks/com.google.android.gms.ads.AdActivity t159 f}
I/Ads     (  677): Ad closing.
I/MPL-storeload(  462): mpl state size = 5584
E/MPL-storeload(  462): calData from inv_save_mpl_states, size=2
I/MPL-storeload(  462): cal data size to write = 5584
I/MPL-storeload(  462): Bytes written = 5584
I/MPL-storeload(  462): mpl state size = 5584
E/MPL-storeload(  462): calData from inv_save_mpl_states, size=2
I/MPL-storeload(  462): cal data size to write = 5584
I/MPL-storeload(  462): Bytes written = 5584
I/MPL-storeload(  462): mpl state size = 5584
E/MPL-storeload(  462): calData from inv_save_mpl_states, size=2
I/MPL-storeload(  462): cal data size to write = 5584
I/MPL-storeload(  462): Bytes written = 5584
D/cr_Ime  (  677): [ImeAdapter.java:553] focusedNodeChanged: isEditable [false]
W/cr_BindingManager(  677): Cannot call determinedVisibility() - never saw a connection for the pid: 677
V/PhoneStatusBar(  595): setLightsOn(true)
D/NuPlayerDriver(  124): start(0x411c6e48)
I/[Monkey](  677): DebugPrint - OnResume...
I/Keyboard.Facilitator(25232): onFinishInput()
I/art     (  677): Alloc sticky concurrent mark sweep GC freed 74145(2MB) AllocSpace objects, 5(4MB) LOS objects, 10% free, 71MB/79MB, paused 1.202ms total 46.939ms
I/art     (  677): Alloc partial concurrent mark sweep GC freed 4384(231KB) AllocSpace objects, 17(16MB) LOS objects, 20% free, 62MB/78MB, paused 1.210ms total 49.710ms
I/art     (  677): Alloc sticky concurrent mark sweep GC freed 7(288B) AllocSpace objects, 6(14MB) LOS objects, 11% free, 62MB/70MB, paused 1.124ms total 12.675ms
E/WifiStateMachine(  462): WifiStateMachine CMD_START_SCAN source -2 txSuccessRate=11.04 rxSuccessRate=15.11 targetRoamBSSID=c0:4a:00:99:b5:06 RSSI=-16
E/WifiStateMachine(  462): WifiStateMachine starting scan for "TP-LINK_2.4GHz_99B506"WPA_PSK with 2437
W/ActivityManager(  462): Launch timeout has expired, giving up wake lock!
I/InputDispatcher(  462): Application is not responding: Window{49f45b1 u0 com.therevillsgames.csusatripeaks/com.therevillsgames.csusatripeaks.MonkeyGame}.  It has been 5002.3ms since event, 5001.9ms
since wait started.  Reason: Waiting to send non-key event because the touched window has not finished processing certain input events that were delivered to it over 500.0ms ago.  Wait queue length: 4
.  Wait queue head age: 6401.4ms.
I/WindowManager(  462): Input event dispatching timed out sending to com.therevillsgames.csusatripeaks/com.therevillsgames.csusatripeaks.MonkeyGame.  Reason: Waiting to send non-key event because the
touched window has not finished processing certain input events that were delivered to it over 500.0ms ago.  Wait queue length: 4.  Wait queue head age: 6401.4ms.
I/Process (  462): Sending signal. PID: 677 SIG: 3
I/art     (  677): Thread[5,tid=686,WaitingInMainSignalCatcherLoop,Thread*=0x60acf158,peer=0x12c000a0,"Signal Catcher"]: reacting to signal 3
I/Process (  462): Sending signal. PID: 462 SIG: 3
I/art     (  462): Thread[5,tid=471,WaitingInMainSignalCatcherLoop,Thread*=0x60ac8318,peer=0x12c020a0,"Signal Catcher"]: reacting to signal 3
I/art     (  677): Wrote stack traces to '/data/anr/traces.txt'
E/WifiHAL (  462): Error polling socket
I/Process (  462): Sending signal. PID: 1008 SIG: 3
I/art     ( 1008): Thread[5,tid=1017,WaitingInMainSignalCatcherLoop,Thread*=0x41d8bae0,peer=0x12c000a0,"Signal Catcher"]: reacting to signal 3
I/Process (  462): Sending signal. PID: 989 SIG: 3
I/art     (  989): Thread[5,tid=998,WaitingInMainSignalCatcherLoop,Thread*=0x41d8bae0,peer=0x12c000a0,"Signal Catcher"]: reacting to signal 3
I/art     (  462): Wrote stack traces to '/data/anr/traces.txt'
I/Process (  462): Sending signal. PID: 971 SIG: 3
I/art     (  971): Thread[5,tid=981,WaitingInMainSignalCatcherLoop,Thread*=0x41d8bae0,peer=0x12c000a0,"Signal Catcher"]: reacting to signal 3
I/art     (  989): Wrote stack traces to '/data/anr/traces.txt'
I/Process (  462): Sending signal. PID: 595 SIG: 3
I/art     (  595): Thread[5,tid=604,WaitingInMainSignalCatcherLoop,Thread*=0x41d7f008,peer=0x12c000a0,"Signal Catcher"]: reacting to signal 3
I/art     (  971): Wrote stack traces to '/data/anr/traces.txt'
I/art     ( 1008): Wrote stack traces to '/data/anr/traces.txt'
I/Choreographer(  595): Skipped 54 frames!  The application may be doing too much work on its main thread.
I/art     (  595): Wrote stack traces to '/data/anr/traces.txt'
I/InputDispatcher(  462): Application is not responding: Window{49f45b1 u0 com.therevillsgames.csusatripeaks/com.therevillsgames.csusatripeaks.MonkeyGame}.  It has been 9312.5ms since event, 5004.8ms
since wait started.  Reason: Waiting to send non-key event because the touched window has not finished processing certain input events that were delivered to it over 500.0ms ago.  Wait queue length: 4
.  Wait queue head age: 11436.6ms.
I/WindowManager(  462): Input event dispatching timed out sending to com.therevillsgames.csusatripeaks/com.therevillsgames.csusatripeaks.MonkeyGame.  Reason: Waiting to send non-key event because the
touched window has not finished processing certain input events that were delivered to it over 500.0ms ago.  Wait queue length: 4.  Wait queue head age: 11436.6ms.
I/art     (  462): Explicit concurrent mark sweep GC freed 117791(5MB) AllocSpace objects, 19(1457KB) LOS objects, 33% free, 23MB/35MB, paused 4.188ms total 386.900ms
E/ActivityManager(  462): ANR in com.therevillsgames.csusatripeaks (com.therevillsgames.csusatripeaks/.MonkeyGame)
E/ActivityManager(  462): PID: 677
E/ActivityManager(  462): Reason: Input dispatching timed out (Waiting to send non-key event because the touched window has not finished processing certain input events that were delivered to it over</textarea><br><br>Edit: Uploading a video of the issue to youtube.... <br><br></td></tr></table><br>
<a name="2117921"></a>

<a name="2117919"></a>

<a name="2117924"></a>

<a name="2117925"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Video of the crash (cheat mode activated):<br><br><iframe width="560" height="345" src="http://www.youtube.com/embed/P8d7EizbaPc" frameborder="0" allowfullscreen></iframe><br><br>(Sorry for the quality...) <br><br></td></tr></table><br>
<a name="2124190"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Soap</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ever figure this out? <br><br></td></tr></table><br>
<a name="2124201"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Not really... to get around it I used an old version (v84b) of androidgame.java... which is okay if you dont use Mojo2. <br><br></td></tr></table><br>
<a name="2124203"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Xaron</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> But with that old version you won't get any ads anymore due to the request of the newest admob SDK by mid of september? <br><br></td></tr></table><br>
<a name="2124207"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Soap</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'll try to find a solution over this next week. <br><br></td></tr></table><br>
<a name="2124214"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> But with that old version you won't get any ads anymore due to the request of the newest admob SDK by mid of september? <br></div><br><br>I dont think so, the only difference between the latest 87b (fixed admob) and 85a (old admob) version of androidgame.java is fixes for some keyboards:<br><pre class=code>
public InputConnection onCreateInputConnection( EditorInfo outAttrs ){

private class BackspaceInputConnection extends BaseInputConnection {
</pre><br><br>Nothing to do with with AdMob... oh and the deadline has been changed to October now (17th).<br><br>I'm really busy in a BlitzMax project at the moment which hopefully (it better be!) will be finished this month, then I need to go thru all my Monkey Android games and update them to the latest version of Monkey for the Admob fixes... <br><br></td></tr></table><br>
<a name="2124219"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Xaron</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah maybe Mark could take a second look? :) I know it's probably not that exciting than on working on monkey 2:) <br><br></td></tr></table><br>
<a name="2124225"></a>

<a name="2124226"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Soap</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> I just tested 87b with admob and it does work fine just FYI. <br><br>"There are actually 2 versions of admob in monkey - the old android target uses the standalone SDK, while the new android target uses 'google play services'."<br><br><a href="http://www.monkey-x.com/Community/posts.php?topic=12351&amp;post=123109" target="_blank">http://www.monkey-x.com/Community/posts.php?topic=12351&amp;post=123109</a><br><br>I am doing a new test for interstitial ads today. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
