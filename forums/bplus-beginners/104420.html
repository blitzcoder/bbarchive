<!DOCTYPE html><html lang="en" ><head ><title >FontName corruption?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >FontName corruption?</h1><a href="forums.php" >BlitzPlus Forums</a>/<a href="topics.php?forum=95" >BlitzPlus Beginners Area</a>/<a href="#bottom" >FontName corruption?</a><br><br>
<a name="1264977"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> My debug log when reaching the UnInitialiseTitleTypeface() function, reports the UI_TIT_GAD_FONT_NAME as the same as Str(UI_TIT_GAD_TYPEFACE)<br><br>There's no logical reason why this should happen and certainly nowhere in the entire program is UI_TIT_GAD_FONT_NAME set to equal ANYTHING OTHER than the FontName() of a font handle OR A null string.<br><br>The only thing I can think is that somehow, the actual memory addresses are being affected?<br><br><br><pre class=code>
Function PickTitleFont()
	Local NewFont=RequestFont()
	
	If (Not(NewFont))
		Debug("TITLE (PICK TYPEFACE): Invalid / null selection or request cancelled. No Typeface change applied.")
		Return
	End If
	
	Debug("TITLE (PICK TYPEFACE): Picked 0x"+Str(NewFont))
	Local PickedName$=FontName(NewFont)
	
	If (UI_TIT_GAD_TYPEFACE)
		If (PickedName=UI_TIT_GAD_FONT_NAME)
			If (FontSize(NewFont)=FontSize(UI_TIT_GAD_TYPEFACE))
				If (FontStyle(NewFont)=FontStyle(UI_TIT_GAD_TYPEFACE))
					If (FontAscent(NewFont)=FontAscent(UI_TIT_GAD_TYPEFACE))
						If (FontDescent(NewFont)=FontDescent(UI_TIT_GAD_TYPEFACE))
							FreeFont NewFont
							Debug("TITLE (PICK TYPEFACE): Selection is identical to current Typeface. No change applied.")
							Return
						End If
					End If
				End If 
			End If
		End If
		
		Debug("TITLE (PICK TYPEFACE): Plugging memory leaks for previous Typeface 0x"+Str(UI_TIT_GAD_TYPEFACE))
		UnInitialiseTitleTypeface
		
	End If
	
	UI_TIT_GAD_TYPEFACE=NewFont
	UI_TIT_GAD_FONT_NAME=PickedName
	UI_TIT_GAD_FONT_FLAGS=GetFontFlags(NewFont)
	
	Debug("TITLE (PICK TYPEFACE): Loaded new Typeface "+Chr(34)+UI_TIT_GAD_FONT_NAME+Chr(34)+" Size: "+Str(FontSize(UI_TIT_GAD_TYPEFACE))+" to reference: 0x"+Str(UI_TIT_GAD_TYPEFACE)+" with flags: 0x"+Str(UI_TIT_GAD_FONT_FLAGS))
	
	SetTitle
	UpdateWYSIWYG
End Function


Function UnInitialiseTitleTypeface()
	If (UI_TIT_GAD_TYPEFACE)
		Debug("INIT (TITLE): Release Typeface Data "+Chr(34)+UI_TIT_GAD_FONT_NAME+Chr(34)+" 0x"+Str(UI_TIT_GAD_TYPEFACE))
		UI_TIT_GAD_FONT_NAME=""
		FreeFont UI_TIT_GAD_TYPEFACE
		UI_TIT_GAD_TYPEFACE=0
	End If
End Function

</pre><br><br><br>DEBUG Output:<br><pre class=code>
11:16:00       | TITLE (PICK TYPEFACE): Picked 0x52211760
11:16:00       | TITLE (PICK TYPEFACE): Plugging memory leaks for previous Typeface 0x52240776
11:16:00       | INIT (TITLE): Release Typeface Data "52240776" 0x52240776</pre><br><br><br><br>An almost identical couple of functions that deal with a separtate text gadget and its associated font and parameters is below - I never encounter the same issue with this part:<br><br><pre class=code>
Function PickTextFont()
	Local NewFont=RequestFont()
	
	If (Not(NewFont))
		Debug("TEXT (PICK TYPEFACE): Invalid / null selection or request cancelled. No typeface change applied.")
		Return
	End If
	
	Debug("TEXT (PICK TYPEFACE): Picked 0x"+Str(NewFont))
	Local PickedName$=FontName(NewFont)
	
	If (TEXT_TYPEFACE)
		If (PickedName=TEXT_FONT_NAME)
			If (FontSize(NewFont)=FontSize(TEXT_TYPEFACE))
				If (FontStyle(NewFont)=FontStyle(TEXT_TYPEFACE))
					;If (FontAscent(NewFont)=FontAscent(TEXT_TYPEFACE))
					;	If (FontDescent(NewFont)=FontDescent(TEXT_TYPEFACE))
							FreeFont NewFont
							Debug("TEXT (PICK TYPEFACE): Selection is identical to current Typeface. No change applied.")
							Return
					;	End If
					;End If
				End If 
			End If
		End If
		
		Debug("TEXT (PICK TYPEFACE): Plugging memory leaks for previous Typeface 0x"+Str(TEXT_TYPEFACE))
		UnInitialiseTextTypeface
		
	End If
	
	TEXT_TYPEFACE=NewFont
	TEXT_FONT_NAME=PickedName
	TEXT_FONT_FLAGS=GetFontFlags(TEXT_TYPEFACE)
	
	Debug("TEXT (PICK TYPEFACE): Loaded new Typeface "+Chr(34)+TEXT_FONT_NAME+Chr(34)+" Size: "+Str(FontSize(TEXT_TYPEFACE))+" to reference: 0x"+Str(TEXT_TYPEFACE)+" with flags: 0x"+Str(TEXT_FONT_FLAGS))
	UpdateTextParams
End Function

Function UnInitialiseTextTypeface()
	If (TEXT_TYPEFACE)
		Debug("INIT (TEXT): Release Typeface data "+Chr(34)+TEXT_FONT_NAME+Chr(34)+" 0x"+Str(TEXT_TYPEFACE))
		FreeFont TEXT_TYPEFACE
		TEXT_TYPEFACE=0
		TEXT_FONT_NAME=""
		TEXT_FONT_FLAGS=0
	End If
End Function
</pre> <br><br></td></tr></table><br>
<a name="1264980"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Floyd</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> The mistaken name "52240776" is a font handle converted to a string. Somewhere this was assigned instead of a font name.<br><br>I would look for places where a value is assigned to UI_TIT_GAD_FONT_NAME and DebugLog that immediately, looking for numbers rather than names. <br><br></td></tr></table><br>
<a name="1264981"></a>

<a name="1264982"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Floyd, thanks for the quick response.<br>I know there was quite a large code block and it may not have been clear enough but I DID mention in the original post that <br>"nowhere in the entire program is UI_TIT_GAD_FONT_NAME set to equal ANYTHING OTHER than the FontName() of a font handle OR A null string."<br><br>(Incidentally, in case it's not obvious) UI_TIT_GAD_FONT_NAME is of course, a Global string variable <br><br></td></tr></table><br>
<a name="1264986"></a>

<a name="1264987"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay, I've found the root point at where the corruption occurs.<br>It was at the point at which a new font is set and text area updated:<br><br><br>As you can see I put a few very noticeable checks in:<br><pre class=code>
Function SetTitleFont()
	
	Debug("TEST::::::::: Current Font: "+Chr(34)+UI_TIT_GAD_FONT_NAME+Chr(34)+" 0x"+Str(UI_TIT_GAD_TYPEFACE))
	
	Local CurrentString$=TextAreaText(UI_TIT_GAD_TEXTBOX)
	
	SetTextAreaFont UI_TIT_GAD_TEXTBOX,UI_TIT_GAD_TYPEFACE
	
	UI_TIT_GAD_FONT_NAME=FontName(UI_TIT_GAD_TYPEFACE)
	;UI_TIT_GAD_FONT_FLAGS=GetFontFlags(UI_TIT_GAD_TYPEFACE)
	
	Debug("TEST::::::::: Current Font: "+Chr(34)+UI_TIT_GAD_FONT_NAME+Chr(34)+" 0x"+Str(UI_TIT_GAD_TYPEFACE))
	
	SetTextAreaText UI_TIT_GAD_TEXTBOX,CurrentString
	
	Debug("TITLE (SET TYPEFACE): Typeface Set to "+Chr(34)+UI_TIT_GAD_FONT_NAME+Chr(34)+" Size: "+Str(FontSize(UI_TIT_GAD_TYPEFACE))+" to reference: 0x"+Str(UI_TIT_GAD_TYPEFACE)+" with flags: 0x"+Str(UI_TIT_GAD_FONT_FLAGS))
	
End Function</pre><br><br>And the resulting debug output:<br><br><pre class=code>
| TITLE (UPDATE): Lock textbox gadget 0x51947360
16:18:03       | TESTING:::::::::::::: FONTNAME Blitz
16:18:03       | TESTING:::::::::::::: FONTNAME Blitz
16:18:03       | TESTING:::::::::::::: FONTNAME ┤Ж
16:18:03       | TITLE (SET TYPEFACE): Typeface Set to "TITLE (SET TYPEFACE): Typeface Set to "68 With Dimens" Size: 27 to reference: 0x51947712 with flags: 0x1
16:18:03       | TESTING:::::::::::::: FONTNAME шк 5ET TYPEFACE): Typeface Set to "TITLE (SET TYPEFACE): Typeface Set to "68 With Dimens
16:18:03       | 
</pre><br><br><br>So you can see something VERY odd is happening here, and I can only suspect it may be something to do with the compiler running in debug mode and the debugging output perhaps eating into some memory that it maybe shouldn't???<br><br>Possibly something to do with the memory space for the default 'built-in' Blitz font? <br><br></td></tr></table><br>
<a name="1265007"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Floyd</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Why does debug code say TEST: while the output says TESTING: ? <br><br></td></tr></table><br>
<a name="1265068"></a>

<a name="1265071"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry I was using a separate snippet with duplicate functions to try and reproduce the error, I had posted the wrong snippetr or the wrong output, but it shouldn't make any difference ultimately. It shouldn't matter to the point of the topic because the debug output is just a string that is written to the file. The word "TEST" or "TESTING" is really just that literal and has no bearing on the actual issue.<br><br>It's quite irrelevant considering the problem is to do with the variable which holds the FontName() value is being 'overwritten' with other data.<br><br>_<br><br>Anyway, there is an element of inconsistency in trying to reproduce the error faithfully.<br><br>I Have posted a full debug output (until it finally crashed since the Font Handle no longer pointed to a valid object)<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
18:13:19       | DEBUG: Logging now opened
18:13:20       | INIT: Initialise User Interface
18:13:20       | INIT (DISPLAY): Initialise Screen
18:13:20       | INIT (DISPLAY): Windows DPI registered as 96
18:13:20       | INIT (UI): Initialise Main Window
18:13:20       | INIT (UI): Created UI Window Reference 0x46965560
18:13:20       | UI: Initialise Main Menu
18:13:20       | UI: Creating Main Menu Reference 0x46952800
18:13:20       | UI: Created File SubMenu Reference 0x46952560
18:13:20       | UI: Created Title SubMenu Reference 0x46954640
18:13:20       | UI: Created Text SubMenu Reference 0x46953600
18:13:20       | UI: Created Image SubMenu Reference 0x46953720
18:13:20       | UI: Created Template Style (Amray) SubMenu Item: 0x46954920 
18:13:20       | UI: Created Template Style (Jewel) SubMenu Item: 0x46955600 
18:13:20       | UI: Applying Template Slimline flag as per Configuration file C:\Users\PJ\AppData\Roaming\EKD Studios\LabelStar\Config.ini
18:13:20       | UI: Created Template SubMenu Reference 0x46955720
18:13:20       | UI: Created Print SubMenu Reference 0x46955920
18:13:20       | UI: Applying Version AutoUpdate flag as per Configuration file C:\Users\PJ\AppData\Roaming\EKD Studios\LabelStar\Config.ini
18:13:20       | UI: Created Help SubMenu Reference 0x46956920
18:13:20       | INIT (UI): Setting About... Text
18:13:20       | UI: Created Main Menu Reference 0x46952800
18:13:20       | INIT (PAGE): Initialise Page sizes
18:13:20       | INIT: Initialise Template schema
18:13:20       | INIT (GUIDE): Calculating Template guideline dimensions
18:13:20       | GUIDE: Guidelines set for Template (amray)
18:13:20       | GUIDE: Dimensions set to 267.0mm x 188.0mm With 7.75mm Spine
18:13:20       | INIT (WYSIWYG): Initialise Canvas
18:13:20       | UI: Created Canvas Reference 0x46965912 Size 1024 x 724
18:13:20       | WYSIWYG: Updating Display
18:13:20       | TEMPLATE: Drawing Template Front at 487 , 0 Dims: 460 x 648
18:13:20       | TEMPLATE: Drawing Template Rear at 0 , 0 Dims: 460 x 648
18:13:20       | TEMPLATE: Drawing Template Spine at 459 , 0 Dims: 29 x 648
18:13:20       | INIT (TEXT): Initialise Summary Text.
18:13:20       | TEXT: Setting textbox gadget dimensions
18:13:20       | TEXT: Textbox gadget reference 0x46966320 created at 1, 1 With dims: 458 X 646
18:13:20       | INIT (TEXT): Initialise Typeface
18:13:20       | INIT (TEXT): Loaded new Typeface "Blitz" Size: 10pt to reference 0x46966504 with flags: 0x1
18:13:20       | TEXT (UPDATE): Lock textbox gadget 0x46966320
18:13:20       | TEXT (SET TYPEFACE): Typeface set to "Blitz" Size: 10 to reference: 0x46966504 with flags: 0x1
18:13:20       | TEXT (SET COLOUR): Colours set to FOREGROUND: 0 BACKGROUND: -1
18:13:20       | TEXT (UPDATE): UnLock textbox gadget 0x46966320
18:13:20       | INIT: Initialise Title.
18:13:20       | TITLE: Setting textbox gadget dimensions
18:13:20       | TITLE: Textbox gadget reference 0x46966624 created with dims: 646 X 37
18:13:20       | INIT (TITLE): Initialise Typeface
18:13:20       | INIT (TITLE): Loaded new Typeface "Blitz" Size: 27 to reference: 0x46966976 with flags: 0x1
18:13:20       | TITLE (UPDATE): Lock textbox gadget 0x46966624
18:13:20       | TITLE (SET TYPEFACE): Typeface Set to "Blitz" Size: 27 to reference: 0x46966976 with flags: 0x1
18:13:20       | TITLE (SET COLOUR): Colours set to FOREGROUND: 0 BACKGROUND: -1
18:13:20       | TITLE (UPDATE): UnLock textbox gadget 0x46966624
18:13:20       | WYSIWYG (TITLE): No memory to release
18:13:20       | WYSIWYG (TITLE): Image created 0x46930904 With Dimensions: 80 x 26
18:13:20       | INIT: Initial image memory snap 0x3039788
18:13:20       | INIT: Initialisation complete.
18:13:20       | VERS: LabelStar v15.0 ready...
18:13:20       | UI: Commence Main Menu operation
18:13:22       | UI (TITLE MENU): FontPicker selected
18:13:39       | TITLE (PICK TYPEFACE): Picked 0x46967392
18:13:39       | TITLE (PICK TYPEFACE): Plugging memory leaks for previous Typeface 0x46966976
18:13:39       | INIT (TITLE): Release Typeface Data "Blitz" 0x46966976
18:13:39       | TITLE (PICK TYPEFACE): Loaded new Typeface "Arial" Size: 10 to reference: 0x46967392 with flags: 0x1
18:13:39       | TITLE (UPDATE): Lock textbox gadget 0x46966624
18:13:39       | TITLE (SET TYPEFACE): Typeface Set to "Arial" Size: 10 to reference: 0x46967392 with flags: 0x1
18:13:39       | TITLE (SET COLOUR): Colours set to FOREGROUND: 0 BACKGROUND: -1
18:13:39       | TITLE (UPDATE): UnLock textbox gadget 0x46966624
18:13:39       | WYSIWYG (TITLE): Release memory for 0x46930904
18:13:39       | WYSIWYG (TITLE): Image created 0x46931336 With Dimensions: 33 x 16
18:13:39       | WYSIWYG: Updating Display
18:13:39       | TEMPLATE: Drawing Template Front at 487 , 0 Dims: 460 x 648
18:13:39       | TEMPLATE: Drawing Template Rear at 0 , 0 Dims: 460 x 648
18:13:39       | TEMPLATE: Drawing Template Spine at 459 , 0 Dims: 29 x 648
18:13:39       | WYSIWYG (TITLE): Drawing Image at 471.85 , 324.094
18:13:42       | UI (TITLE MENU): Edit Selected
18:13:43       | UI (Title Edit): Title unchanged
18:13:46       | UI (TITLE MENU): FontPicker selected
18:14:07       | TITLE (PICK TYPEFACE): Picked 0x46966976
18:14:07       | TITLE (PICK TYPEFACE): Plugging memory leaks for previous Typeface 0x46967392
18:14:07       | INIT (TITLE): Release Typeface Data "Arial" 0x46967392
18:14:07       | TITLE (PICK TYPEFACE): Loaded new Typeface "Times New Roman" Size: 10 to reference: 0x46966976 with flags: 0x1
18:14:07       | TITLE (UPDATE): Lock textbox gadget 0x46966624
18:14:07       | TITLE (SET TYPEFACE): Typeface Set to "Times New Roman" Size: 10 to reference: 0x46966976 with flags: 0x1
18:14:07       | TITLE (SET COLOUR): Colours set to FOREGROUND: 0 BACKGROUND: -1
18:14:07       | TITLE (UPDATE): UnLock textbox gadget 0x46966624
18:14:07       | WYSIWYG (TITLE): Release memory for 0x46931336
18:14:07       | WYSIWYG (TITLE): Image created 0x46931336 With Dimensions: 35 x 15
18:14:07       | WYSIWYG: Updating Display
18:14:07       | TEMPLATE: Drawing Template Front at 487 , 0 Dims: 460 x 648
18:14:07       | TEMPLATE: Drawing Template Rear at 0 , 0 Dims: 460 x 648
18:14:07       | TEMPLATE: Drawing Template Spine at 459 , 0 Dims: 29 x 648
18:14:07       | WYSIWYG (TITLE): Drawing Image at 471.85 , 324.094
18:14:10       | UI (TITLE MENU): ColourPicker Selected
18:14:14       | TITLE (PICK COLOUR): Picked 13717545
18:14:14       | TITLE (UPDATE): Lock textbox gadget 0x46966624
18:14:14       | TITLE (SET TYPEFACE): Typeface Set to "Times New Roman" Size: 10 to reference: 0x46966976 with flags: 0x1
18:14:14       | TITLE (SET COLOUR): Colours set to FOREGROUND: 13717545 BACKGROUND: -1
18:14:14       | TITLE (UPDATE): UnLock textbox gadget 0x46966624
18:14:14       | WYSIWYG (TITLE): Release memory for 0x46931336
18:14:14       | WYSIWYG (TITLE): Image created 0x46930544 With Dimensions: 35 x 15
18:14:14       | WYSIWYG: Updating Display
18:14:14       | TEMPLATE: Drawing Template Front at 487 , 0 Dims: 460 x 648
18:14:14       | TEMPLATE: Drawing Template Rear at 0 , 0 Dims: 460 x 648
18:14:14       | TEMPLATE: Drawing Template Spine at 459 , 0 Dims: 29 x 648
18:14:14       | WYSIWYG (TITLE): Drawing Image at 471.85 , 324.094
18:14:17       | UI (TITLE MENU): Edit Selected
18:14:24       | UI (Title Edit): Title unchanged
18:14:26       | UI (TITLE MENU): Edit Selected
18:14:30       | UI (Title Edit): Title text updated
18:14:30       | TITLE (UPDATE): Lock textbox gadget 0x46966624
18:14:30       | TITLE (SET TYPEFACE): Typeface Set to "М" Size: 10 to reference: 0x46966976 with flags: 0x1
18:14:30       | TITLE (SET COLOUR): Colours set to FOREGROUND: 13717545 BACKGROUND: -1
18:14:30       | TITLE (UPDATE): UnLock textbox gadget 0x46966624
18:14:30       | WYSIWYG (TITLE): Release memory for 0x46930544
18:14:30       | WYSIWYG (TITLE): Image created 0x46931336 With Dimensions: 24 x 15
18:14:30       | WYSIWYG: Updating Display
18:14:30       | TEMPLATE: Drawing Template Front at 487 , 0 Dims: 460 x 648
18:14:30       | TEMPLATE: Drawing Template Rear at 0 , 0 Dims: 460 x 648
18:14:30       | TEMPLATE: Drawing Template Spine at 459 , 0 Dims: 29 x 648
18:14:30       | WYSIWYG (TITLE): Drawing Image at 471.85 , 324.094
18:14:36       | UI (TITLE MENU): FontPicker selected
18:14:49       | TITLE (PICK TYPEFACE): Picked 0x46967392
18:14:49       | TITLE (PICK TYPEFACE): Plugging memory leaks for previous Typeface 0x46966976
18:14:49       | INIT (TITLE): Release Typeface Data "INIT (TITLE): Release Typeface Data "" 0x46966976
18:14:49       | TITLE (PICK TYPEFACE): Loaded new Typeface "Arial" Size: 10 to reference: 0x46967392 with flags: 0x1
18:14:49       | TITLE (UPDATE): Lock textbox gadget 0x46966624
18:14:49       | TITLE (SET TYPEFACE): Typeface Set to "Arial" Size: 10 to reference: 0x46967392 with flags: 0x1
18:14:49       | TITLE (SET COLOUR): Colours set to FOREGROUND: 13717545 BACKGROUND: -1
18:14:49       | TITLE (UPDATE): UnLock textbox gadget 0x46966624
18:14:49       | WYSIWYG (TITLE): Release memory for 0x46931336
18:14:49       | WYSIWYG (TITLE): Image created 0x46931192 With Dimensions: 25 x 16
18:14:49       | WYSIWYG: Updating Display
18:14:49       | TEMPLATE: Drawing Template Front at 487 , 0 Dims: 460 x 648
18:14:49       | TEMPLATE: Drawing Template Rear at 0 , 0 Dims: 460 x 648
18:14:49       | TEMPLATE: Drawing Template Spine at 459 , 0 Dims: 29 x 648
18:14:49       | WYSIWYG (TITLE): Drawing Image at 471.85 , 324.094
18:14:52       | UI (TITLE MENU): ColourPicker Selected
18:14:55       | TITLE (PICK COLOUR): Picked 12142116
18:14:55       | TITLE (UPDATE): Lock textbox gadget 0x46966624
18:14:55       | TITLE (SET TYPEFACE): Typeface Set to "TITLE (SET TYPEFACE): Typeface Set to "" Size: 10 to reference: 0x46967392 with flags: 0x1
18:14:55       | TITLE (SET COLOUR): Colours set to FOREGROUND: 12142116 BACKGROUND: -1
18:14:55       | TITLE (UPDATE): UnLock textbox gadget 0x46966624
18:14:55       | WYSIWYG (TITLE): Release memory for 0x46931192
18:14:55       | WYSIWYG (TITLE): Image created 0x46930544 With Dimensions: 25 x 16
18:14:55       | WYSIWYG: Updating Display
18:14:55       | TEMPLATE: Drawing Template Front at 487 , 0 Dims: 460 x 648
18:14:55       | TEMPLATE: Drawing Template Rear at 0 , 0 Dims: 460 x 648
18:14:55       | TEMPLATE: Drawing Template Spine at 459 , 0 Dims: 29 x 648
18:14:55       | WYSIWYG (TITLE): Drawing Image at 471.85 , 324.094
18:14:57       | UI (TITLE MENU): FontPicker selected
18:15:00       | TITLE (PICK TYPEFACE): Picked 0x46966976
18:15:00       | TITLE (PICK TYPEFACE): Plugging memory leaks for previous Typeface 0x46967392
18:15:00       | INIT (TITLE): Release Typeface Data "" 0x46967392
18:15:00       | TITLE (PICK TYPEFACE): Loaded new Typeface "Arial" Size: 10 to reference: 0x46966976 with flags: 0x1
18:15:00       | TITLE (UPDATE): Lock textbox gadget 0x46966624
18:15:00       | TITLE (SET TYPEFACE): Typeface Set to "Arial" Size: 10 to reference: 0x46966976 with flags: 0x1
18:15:00       | TITLE (SET COLOUR): Colours set to FOREGROUND: 12142116 BACKGROUND: -1
18:15:00       | TITLE (UPDATE): UnLock textbox gadget 0x46966624
18:15:00       | WYSIWYG (TITLE): Release memory for 0x46930544
18:15:00       | WYSIWYG (TITLE): Image created 0x46931192 With Dimensions: 25 x 16
18:15:00       | WYSIWYG: Updating Display
18:15:00       | TEMPLATE: Drawing Template Front at 487 , 0 Dims: 460 x 648
18:15:00       | TEMPLATE: Drawing Template Rear at 0 , 0 Dims: 460 x 648
18:15:00       | TEMPLATE: Drawing Template Spine at 459 , 0 Dims: 29 x 648
18:15:00       | WYSIWYG (TITLE): Drawing Image at 471.85 , 324.094
18:15:04       | UI (TITLE MENU): Edit Selected
18:15:08       | UI (Title Edit): Title text updated
18:15:08       | TITLE (UPDATE): Lock textbox gadget 0x46966624
18:15:08       | TITLE (SET TYPEFACE): Typeface Set to "TITLE (SET TYPEFACE): Typeface Set to "" Size: 10 to reference: 0x46966976 with flags: 0x1
18:15:08       | TITLE (SET COLOUR): Colours set to FOREGROUND: 12142116 BACKGROUND: -1
18:15:08       | TITLE (UPDATE): UnLock textbox gadget 0x46966624
18:15:08       | WYSIWYG (TITLE): Release memory for 0x46931192
18:15:08       | WYSIWYG (TITLE): Image created 0x46930112 With Dimensions: 36 x 16
18:15:08       | WYSIWYG: Updating Display
18:15:08       | TEMPLATE: Drawing Template Front at 487 , 0 Dims: 460 x 648
18:15:08       | TEMPLATE: Drawing Template Rear at 0 , 0 Dims: 460 x 648
18:15:08       | TEMPLATE: Drawing Template Spine at 459 , 0 Dims: 29 x 648
18:15:08       | WYSIWYG (TITLE): Drawing Image at 471.85 , 324.094
18:15:11       | UI (TITLE MENU): FontPicker selected
18:15:14       | TITLE (PICK TYPEFACE): Picked 0x46967392
18:15:14       | TITLE (PICK TYPEFACE): Plugging memory leaks for previous Typeface 0x46966976
18:15:14       | INIT (TITLE): Release Typeface Data "`л╠ FICK TYPEFACE): Plugging memory leaks for previous Typeface 0x46966976" 0x46966976
18:15:14       | TITLE (PICK TYPEFACE): Loaded new Typeface "Arial" Size: 14 to reference: 0x46967392 with flags: 0x1
18:15:14       | TITLE (UPDATE): Lock textbox gadget 0x46966624
18:15:14       | TITLE (SET TYPEFACE): Typeface Set to "Arial" Size: 14 to reference: 0x46967392 with flags: 0x1
18:15:14       | TITLE (SET COLOUR): Colours set to FOREGROUND: 12142116 BACKGROUND: -1
18:15:14       | TITLE (UPDATE): UnLock textbox gadget 0x46966624
18:15:14       | WYSIWYG (TITLE): Release memory for 0x46930112
18:15:14       | WYSIWYG (TITLE): Image created 0x46929968 With Dimensions: 53 x 22
18:15:14       | WYSIWYG: Updating Display
18:15:14       | TEMPLATE: Drawing Template Front at 487 , 0 Dims: 460 x 648
18:15:14       | TEMPLATE: Drawing Template Rear at 0 , 0 Dims: 460 x 648
18:15:14       | TEMPLATE: Drawing Template Spine at 459 , 0 Dims: 29 x 648
18:15:14       | WYSIWYG (TITLE): Drawing Image at 471.85 , 324.094
18:15:17       | UI (TITLE MENU): Edit Selected
18:15:22       | UI (Title Edit): Title text updated
18:15:22       | TITLE (UPDATE): Lock textbox gadget 0x46966624
18:15:22       | TITLE (SET TYPEFACE): Typeface Set to "TITLE (SET TYPEFACE): Typeface Set to "" Size: 14 to reference: 0x46967392 with flags: 0x1
18:15:22       | TITLE (SET COLOUR): Colours set to FOREGROUND: 12142116 BACKGROUND: -1
18:15:22       | TITLE (UPDATE): UnLock textbox gadget 0x46966624
18:15:22       | WYSIWYG (TITLE): Release memory for 0x46929968
18:15:22       | WYSIWYG (TITLE): Image created 0x46929968 With Dimensions: 50 x 22
18:15:22       | WYSIWYG: Updating Display
18:15:22       | TEMPLATE: Drawing Template Front at 487 , 0 Dims: 460 x 648
18:15:22       | TEMPLATE: Drawing Template Rear at 0 , 0 Dims: 460 x 648
18:15:22       | TEMPLATE: Drawing Template Spine at 459 , 0 Dims: 29 x 648
18:15:22       | WYSIWYG (TITLE): Drawing Image at 471.85 , 324.094
18:15:24       | UI (TITLE MENU): FontPicker selected
18:15:30       | TITLE (PICK TYPEFACE): Picked 0x46966976
18:15:30       | TITLE (PICK TYPEFACE): Plugging memory leaks for previous Typeface 0x46967392
18:15:30       | INIT (TITLE): Release Typeface Data "INIT (TITLE): Release Typeface Data "" 0x46967392
18:15:30       | TITLE (PICK TYPEFACE): Loaded new Typeface "Quartz" Size: 10 to reference: 0x46966976 with flags: 0x1
18:15:30       | TITLE (UPDATE): Lock textbox gadget 0x46966624
18:15:30       | TITLE (SET TYPEFACE): Typeface Set to "Quartz" Size: 10 to reference: 0x46966976 with flags: 0x1
18:15:30       | TITLE (SET COLOUR): Colours set to FOREGROUND: 12142116 BACKGROUND: -1
18:15:30       | TITLE (UPDATE): UnLock textbox gadget 0x46966624
18:15:30       | WYSIWYG (TITLE): Release memory for 0x46929968
18:15:30       | WYSIWYG (TITLE): Image created 0x46930616 With Dimensions: 31 x 15
18:15:30       | WYSIWYG: Updating Display
18:15:30       | TEMPLATE: Drawing Template Front at 487 , 0 Dims: 460 x 648
18:15:30       | TEMPLATE: Drawing Template Rear at 0 , 0 Dims: 460 x 648
18:15:30       | TEMPLATE: Drawing Template Spine at 459 , 0 Dims: 29 x 648
18:15:30       | WYSIWYG (TITLE): Drawing Image at 471.85 , 324.094
18:15:32       | UI (TITLE MENU): FontPicker selected
18:15:34       | TITLE (PICK TYPEFACE): Invalid / null selection or request cancelled. No Typeface change applied.
18:15:36       | UI (TITLE MENU): Edit Selected
18:15:42       | UI (Title Edit): Title text updated
18:15:42       | TITLE (UPDATE): Lock textbox gadget 0x46966624
18:15:42       | TITLE (SET TYPEFACE): Typeface Set to "TITLE " Size: 10 to reference: 0x46966976 with flags: 0x1
</textarea><br><br>And the relevant "Title" functions:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Const DEF_TIT_TEXT$="Movie"
Const TIT_WYSIWYG_IMAGE_FLAG_DYNAMIC=2

Global TIT_WYSIWYG_IMAGE%

Function InitialiseTitle()
	Debug("INIT: Initialise Title.")
	SetTitleAreaDims
	InitialiseTitleEditButton
	InitialiseTitleTypeface
	InitialiseTitleText
	SetTitle
End Function

Function SetTitle()
	UpdateTitleParams
	UpdateTitleImage
End Function

Function SetTitleAreaDims()
	Debug("TITLE: Setting textbox gadget dimensions")
	
	If (UI_TIT_GAD_TEXTBOX)
		Debug("TITLE: Release previous textbox gadget 0x"+Str(UI_TIT_GAD_TEXTBOX))
		FreeGadget UI_TIT_GAD_TEXTBOX
		UI_TIT_GAD_TEXTBOX=0
	End If
	
	Local W=(GUIDELINE_HEIGHT*CANVAS_Y_RATIO)-2
	Local H=(((GUIDELINE_SPINE_WIDTH*CANVAS_X_RATIO)-2)*1.5)
	
	UI_TIT_GAD_TEXTBOX=CreateTextArea(0,0,W,H,UI_MAIN_WINDOW,UI_TIT_WORDWRAP)
	Debug("TITLE: Textbox gadget reference 0x"+Str(UI_TIT_GAD_TEXTBOX)+" created with dims: "+Str(W)+" X "+Str(H))
End Function

Function InitialiseTitleEditButton()
;	SetGenericFont
	
	UI_GAD_BUTTON_X=CANVAS_OFFSET_X
	UI_GAD_BUTTON_Y=CANVAS_OFFSET_Y + (GUIDELINE_SPINE_WIDTH*CANVAS_X_RATIO)*2
	UI_GAD_BUTTON_W=StringWidth(UI_TIT_GAD_BUTTON_TEXT)*1.5
	UI_GAD_BUTTON_H=StringHeight(UI_TIT_GAD_BUTTON_TEXT)*1.5
	UI_TIT_GAD_BUTTON=CreateButton(UI_TIT_GAD_BUTTON_TEXT,UI_GAD_BUTTON_X,UI_GAD_BUTTON_Y,UI_GAD_BUTTON_W,UI_GAD_BUTTON_H,UI_MAIN_WINDOW)
	HideGadget UI_TIT_GAD_BUTTON
	
;	UnSetGenericFont
End Function

Function InitialiseTitleText()
	SetTextAreaText UI_TIT_GAD_TEXTBOX,DEF_TIT_TEXT$
	HideGadget UI_TIT_GAD_TEXTBOX
End Function

Function InitialiseTitleTypeface()
	Debug("INIT (TITLE): Initialise Typeface")
	
	Local Size=(GUIDELINE_SPINE_WIDTH*CANVAS_X_RATIO)
	If (Not(GetTemplateSlimline()))
		Size=Size*0.5
	End If
	
	UI_TIT_GAD_TYPEFACE=LoadFont(FONT_DEFAULT_TYPEFACE,Size);*FONT_DEF_LINE_SPACING#)
	UI_TIT_GAD_FONT_NAME$=FontName(UI_TIT_GAD_TYPEFACE)
	UI_TIT_GAD_FONT_FLAGS=GetFontFlags(UI_TIT_GAD_TYPEFACE)
	
	Debug("INIT (TITLE): Loaded new Typeface "+Chr(34)+UI_TIT_GAD_FONT_NAME+Chr(34)+" Size: "+Str(FontSize(UI_TIT_GAD_TYPEFACE))+" to reference: 0x"+Str(UI_TIT_GAD_TYPEFACE)+" with flags: 0x"+Str(UI_TIT_GAD_FONT_FLAGS))
	
;	SetFont UI_TIT_GAD_TYPEFACE
;	SetTextAreaFont UI_TIT_GAD_TEXTBOX,UI_TIT_GAD_TYPEFACE
End Function

Function UnInitialiseTitleTypeface()
	If (UI_TIT_GAD_TYPEFACE)
		Debug("INIT (TITLE): Release Typeface Data "+Chr(34)+UI_TIT_GAD_FONT_NAME+Chr(34)+" 0x"+Str(UI_TIT_GAD_TYPEFACE))
		UI_TIT_GAD_FONT_NAME$=""
		FreeFont UI_TIT_GAD_TYPEFACE
		UI_TIT_GAD_TYPEFACE=0
	End If
End Function

Function SetTitleColours()
	Local TextR=Red(UI_TIT_GAD_COLOUR)
	Local TextG=Green(UI_TIT_GAD_COLOUR)
	Local TextB=Blue(UI_TIT_GAD_COLOUR)
	
	Local BackR=Red(TEMPLATE_SPINE_COLOUR)
	Local BackG=Green(TEMPLATE_SPINE_COLOUR)
	Local BackB=Blue(TEMPLATE_SPINE_COLOUR)
	
	SetTextAreaColor UI_TIT_GAD_TEXTBOX, TextR, TextG, TextB, FONT_FORE_FLAG
	SetTextAreaColor UI_TIT_GAD_TEXTBOX, BackR, BackG, BackB, FONT_BACK_FLAG
	
	Debug("TITLE (SET COLOUR): Colours set to FOREGROUND: "+Str(UI_TIT_GAD_COLOUR)+" BACKGROUND: "+Str(TEMPLATE_SPINE_COLOUR))
	
End Function

Function ClearTitle()
	If (GetTitleClear())
		Debug("TITLE (CLEAR): Title Text already null")
	Else
		SetTitleClear
	End If
End Function

Function PickTitleColour()
	Local Col=RequestColor(Red(UI_TIT_GAD_COLOUR),Green(UI_TIT_GAD_COLOUR),Blue(UI_TIT_GAD_COLOUR))
	Local RGB=RGBa(RequestedRed(),RequestedGreen(),RequestedBlue())
	If (Not(Col))
		Debug("TITLE (PICK COLOUR): Pick cancelled")
	Else
		Debug("TITLE (PICK COLOUR): Picked "+Str(RGB))
	End If
	
	If (RGB&lt;&gt;UI_TIT_GAD_COLOUR)
		UI_TIT_GAD_COLOUR=RGB
		SetTitle
		UpdateWYSIWYG
		Return 
	End If
	Debug("TITLE (PICK COLOUR): No change in Colour")
End Function

Function PickTitleFont()
	Local NewFont=RequestFont()
	
	If (Not(NewFont))
		Debug("TITLE (PICK TYPEFACE): Invalid / null selection or request cancelled. No Typeface change applied.")
		Return
	End If
	
	Debug("TITLE (PICK TYPEFACE): Picked 0x"+Str(NewFont))
	Local PickedName$=FontName(NewFont)
	
	If (UI_TIT_GAD_TYPEFACE)
		If (PickedName=UI_TIT_GAD_FONT_NAME)
			If (FontSize(NewFont)=FontSize(UI_TIT_GAD_TYPEFACE))
				If (FontStyle(NewFont)=FontStyle(UI_TIT_GAD_TYPEFACE))
					If (FontAscent(NewFont)=FontAscent(UI_TIT_GAD_TYPEFACE))
						If (FontDescent(NewFont)=FontDescent(UI_TIT_GAD_TYPEFACE))
							FreeFont NewFont
							Debug("TITLE (PICK TYPEFACE): Selection is identical to current Typeface. No change applied.")
							Return
						End If
					End If
				End If 
			End If
		End If
		
		Debug("TITLE (PICK TYPEFACE): Plugging memory leaks for previous Typeface 0x"+Str(UI_TIT_GAD_TYPEFACE))
		UnInitialiseTitleTypeface
		
	End If
	
	UI_TIT_GAD_TYPEFACE=NewFont
	UI_TIT_GAD_FONT_NAME=PickedName
	UI_TIT_GAD_FONT_FLAGS=GetFontFlags(NewFont)
	
	Debug("TITLE (PICK TYPEFACE): Loaded new Typeface "+Chr(34)+UI_TIT_GAD_FONT_NAME+Chr(34)+" Size: "+Str(FontSize(UI_TIT_GAD_TYPEFACE))+" to reference: 0x"+Str(UI_TIT_GAD_TYPEFACE)+" with flags: 0x"+Str(UI_TIT_GAD_FONT_FLAGS))
	
	SetTitle
	UpdateWYSIWYG
End Function

Function SetTitleFont()
	SetTextAreaFont UI_TIT_GAD_TEXTBOX,UI_TIT_GAD_TYPEFACE
	
	UI_TIT_GAD_FONT_NAME=FontName(UI_TIT_GAD_TYPEFACE)
	UI_TIT_GAD_FONT_FLAGS=GetFontFlags(UI_TIT_GAD_TYPEFACE)
	
	Debug("TITLE (SET TYPEFACE): Typeface Set to "+Chr(34)+UI_TIT_GAD_FONT_NAME+Chr(34)+" Size: "+Str(FontSize(UI_TIT_GAD_TYPEFACE))+" to reference: 0x"+Str(UI_TIT_GAD_TYPEFACE)+" with flags: 0x"+Str(UI_TIT_GAD_FONT_FLAGS))
End Function

Function GetTitleClear()
	Return (TextAreaText(UI_TIT_GAD_TEXTBOX)="")
End Function

Function SetTitleClear()
	Debug("TITLE (RELEASE): Content released from: 0x"+Str(UI_TIT_GAD_TEXTBOX))
	SetTextAreaText UI_TIT_GAD_TEXTBOX,""
End Function

Function UpdateTitleParams()
	Debug("TITLE (UPDATE): Lock textbox gadget 0x"+Str(UI_TIT_GAD_TEXTBOX))
	LockTextArea UI_TIT_GAD_TEXTBOX
	SetTitleFont
	SetTitleColours
	UnlockTextArea UI_TIT_GAD_TEXTBOX
	Debug("TITLE (UPDATE): UnLock textbox gadget 0x"+Str(UI_TIT_GAD_TEXTBOX))
End Function

Function UpdateTitleImage()
	ClearTitleWYSIWYGImage
	
	SetTextAreaFont UI_TIT_GAD_TEXTBOX,UI_TIT_GAD_TYPEFACE
	SetFont UI_TIT_GAD_TYPEFACE
	
	Local TextString$=TextAreaText(UI_TIT_GAD_TEXTBOX)
	
	Local W=StringWidth(TextString)
	Local H=StringHeight(TextString)
	
	If (W*H)
	
		If W&gt;(GUIDELINE_HEIGHT*CANVAS_Y_RATIO) Then W=GUIDELINE_HEIGHT*CANVAS_Y_RATIO
		If H&gt;(GUIDELINE_SPINE_WIDTH*CANVAS_X_RATIO)Then H=GUIDELINE_SPINE_WIDTH*CANVAS_X_RATIO
		
		TIT_WYSIWYG_IMAGE=CreateImage(W,H,1,TIT_WYSIWYG_IMAGE_FLAG_DYNAMIC)
		
		Local Buffer=GraphicsBuffer()
		Local IBuffer=ImageBuffer(TIT_WYSIWYG_IMAGE)
		
		Local X=Floor(W Shr True)
		Local Y=Floor(H Shr True)
		
		SetBuffer(IBuffer)
		
		SetBufferColor(TEMPLATE_SPINE_COLOUR)
		
		If (UI_TIT_GAD_COLOUR=0) 
			;Fix for Masked 0,0,0
			SetColour(1)
		Else
			SetColour(UI_TIT_GAD_COLOUR)
		End If
		
		Text X,Y,TextString,True,True
		
		SetBuffer(Buffer)
		
		RotateImage TIT_WYSIWYG_IMAGE,90
		MidHandle TIT_WYSIWYG_IMAGE
		
		Debug("WYSIWYG (TITLE): Image created 0x"+Str(TIT_WYSIWYG_IMAGE)+" With Dimensions: "+Str(W)+" x "+Str(H))
		
	Else
		TIT_WYSIWYG_IMAGE=0
		Debug("WYSIWYG (TITLE): Image not created due to invalid dimensions: "+Str(W)+" x "+Str(H))
		
	End If
	
End Function

Function ClearTitleWYSIWYGImage()
	If (TIT_WYSIWYG_IMAGE)
		Debug("WYSIWYG (TITLE): Release memory for 0x"+Str(TIT_WYSIWYG_IMAGE))
		FreeImage TIT_WYSIWYG_IMAGE
		TIT_WYSIWYG_IMAGE=0
	Else
		Debug("WYSIWYG (TITLE): No memory to release")
	End If
End Function

Function DrawTitleImage()
	If (TIT_WYSIWYG_IMAGE)
		Local OFFSET_X=(GUIDELINE_REAR_WIDTH+(GUIDELINE_SPINE_WIDTH*0.5))
		Local OFFSET_Y=(GUIDELINE_HEIGHT*0.5)
		Local X#=GUIDELINE_X+OFFSET_X
		Local Y#=GUIDELINE_Y+OFFSET_Y
		
		X=X*CANVAS_X_RATIO
		Y=Y*CANVAS_Y_RATIO
		
		X=X-0.5	; Fix for floating point calculations and 0.5mm
		
		FocusOnWYSIWYGBuffer()
		
		Debug("WYSIWYG (TITLE): Drawing Image at "+Str(X)+" , "+Str(Y))
		DrawImage TIT_WYSIWYG_IMAGE,X,Y
	End If
End Function

Function RemoveInvalidTitleCharacters$(Title$)
	Title=Trim(Title)
	Local Iter
	Local Check
	Local Ascii
	For Check= 0 To 31
		For Iter=Len(Title) To 1 Step -1
			Ascii=Asc(Mid(Title,Iter,1))
			If (Ascii=Check)
				Title=TrimStringMid(Title,Iter,1)
			End If
		Next
	Next
	Return Title
End Function

Function GetTitleFontFlags()
	Return (GetFontFlags(UI_TIT_GAD_TYPEFACE))
End Function
</textarea> <br><br></td></tr></table><br>
<a name="1265070"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you look particularly between:<br><br><pre class=code>
18:14:30       | TITLE (SET TYPEFACE): Typeface Set to "М" Size: 10 to reference: 0x46966976 with flags: 0x1
18:14:30       | TITLE (SET COLOUR): Colours set to FOREGROUND: 13717545 BACKGROUND: -1
18:14:30       | TITLE (UPDATE): UnLock textbox gadget 0x46966624
18:14:30       | WYSIWYG (TITLE): Release memory for 0x46930544
18:14:30       | WYSIWYG (TITLE): Image created 0x46931336 With Dimensions: 24 x 15
18:14:30       | WYSIWYG: Updating Display
18:14:30       | TEMPLATE: Drawing Template Front at 487 , 0 Dims: 460 x 648
18:14:30       | TEMPLATE: Drawing Template Rear at 0 , 0 Dims: 460 x 648
18:14:30       | TEMPLATE: Drawing Template Spine at 459 , 0 Dims: 29 x 648
18:14:30       | WYSIWYG (TITLE): Drawing Image at 471.85 , 324.094
18:14:36       | UI (TITLE MENU): FontPicker selected
18:14:49       | TITLE (PICK TYPEFACE): Picked 0x46967392
18:14:49       | TITLE (PICK TYPEFACE): Plugging memory leaks for previous Typeface 0x46966976
18:14:49       | INIT (TITLE): Release Typeface Data "INIT (TITLE): Release Typeface Data "" 0x46966976
</pre><br><br>Already it is clear that there is something happening to the memory for the variable UI_TIT_GAD_FONT_NAME <br><br></td></tr></table><br>
<a name="1265148"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I apologise for making numerous posts. I didn;t want to edit earlier ones since it may just confuse the issue further due to the logical flow of my investigations.<br><br>From what I can gather in trying to reproduce the error and narrow down precisely where the issue occurs I think it may be at the point of the "title image update" in which the textbox text is copied onto an image buffer so that it may be rotated and displayed vertically.<br><br>Somewhere during this process the font in memory is somehow corrupted and therefore FoontName is not returned accurately.<br><br>I suspect now, that perhaps it may be something to do with the use of the same font handle across different buffers AND the TextAreaGadget?<br>I understand normally that SetFont requires a valid graphics buffer, whilst SetTextAreaFont only requires the gadget despite them both referring to the same Loaded font handle... <br><br></td></tr></table><br>
<a name="1265653"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Floyd's gone rather quiet recently, and I'm no further to solving this issue - I only seem to find the problem becoming stranger.<br><br>I made a few adjustments to prevent the TextArea gadget from being accessed when the GraphicsBuffer() is set to the ImageBuffer() and also added a few more debug checks on the actual result of FontName() at various places:<br><br>Here's the Title-specific functions now, with the added debug checks [see especially "UpdateTitleParams()"] <br>and the relevant debug output:<br><br><pre class=code>Const DEF_TIT_TEXT$="Default"
Const TIT_WYSIWYG_IMAGE_FLAG_DYNAMIC=2

Global TIT_WYSIWYG_IMAGE%

Function InitialiseTitle()
	Debug("INIT: Initialise Title")
	InitialiseTitleTextArea
	InitialiseTitleEditButton
	InitialiseTitleTypeface
	InitialiseTitleText
	SetTitle
	CompleteTitleInitialisation
End Function

Function SetTitle()
	UpdateTitleParams
	UpdateTitleImage
End Function

Function InitialiseTitleTextArea()
	Debug("INIT (TITLE): Initialise textbox gadget dimensions")
	
;	If (UI_TIT_GAD_TEXTBOX)
;		Debug("TITLE: Release previous textbox gadget 0x"+Str(UI_TIT_GAD_TEXTBOX))
;		FreeGadget UI_TIT_GAD_TEXTBOX
;		UI_TIT_GAD_TEXTBOX=0
;	End If
	
	Local W=(GUIDELINE_HEIGHT*CANVAS_Y_RATIO)-2
	Local H=(((GUIDELINE_SPINE_WIDTH*CANVAS_X_RATIO)-2)*1.5)
	
	UI_TIT_GAD_TEXTBOX=CreateTextArea(0,0,W,H,UI_MAIN_WINDOW,UI_TIT_WORDWRAP)
	Debug("TITLE: Textbox gadget reference 0x"+Str(UI_TIT_GAD_TEXTBOX)+" created with dims: "+Str(W)+" X "+Str(H))
End Function

Function InitialiseTitleEditButton()
;	SetGenericFont
	
	UI_GAD_BUTTON_X=CANVAS_OFFSET_X
	UI_GAD_BUTTON_Y=CANVAS_OFFSET_Y + (GUIDELINE_SPINE_WIDTH*CANVAS_X_RATIO)*2
	UI_GAD_BUTTON_W=StringWidth(UI_TIT_GAD_BUTTON_TEXT)*1.5
	UI_GAD_BUTTON_H=StringHeight(UI_TIT_GAD_BUTTON_TEXT)*1.5
	UI_TIT_GAD_BUTTON=CreateButton(UI_TIT_GAD_BUTTON_TEXT,UI_GAD_BUTTON_X,UI_GAD_BUTTON_Y,UI_GAD_BUTTON_W,UI_GAD_BUTTON_H,UI_MAIN_WINDOW)
	HideGadget UI_TIT_GAD_BUTTON
	
;	UnSetGenericFont
End Function

Function InitialiseTitleText()
	SetTextAreaText UI_TIT_GAD_TEXTBOX,DEF_TIT_TEXT$
End Function

Function InitialiseTitleTypeface()
	Debug("INIT (TITLE): Initialise Typeface")
	
	Local Size=(GUIDELINE_SPINE_WIDTH*CANVAS_X_RATIO)
	If (Not(GetTemplateSlimline()))
		Size=Size*0.5
	End If
	
	UI_TIT_GAD_TYPEFACE=LoadFont(FONT_DEFAULT_TYPEFACE,Size);*FONT_DEF_LINE_SPACING#)
	UI_TIT_GAD_FONT_NAME=FontName(UI_TIT_GAD_TYPEFACE)
	UI_TIT_GAD_FONT_FLAGS=GetFontFlags(UI_TIT_GAD_TYPEFACE)
	
	Debug("INIT (TITLE): Loaded new Typeface "+Chr(34)+UI_TIT_GAD_FONT_NAME+Chr(34)+" Size: "+Str(FontSize(UI_TIT_GAD_TYPEFACE))+" to reference: 0x"+Str(UI_TIT_GAD_TYPEFACE)+" with flags: 0x"+Str(UI_TIT_GAD_FONT_FLAGS))
End Function

Function CompleteTitleInitialisation()
	HideGadget UI_TIT_GAD_TEXTBOX
	Debug("INIT (TITLE): Title Initialised")
End Function

Function UnInitialiseTitleTypeface()
	If (UI_TIT_GAD_TYPEFACE)
		Debug("INIT (TITLE): Release Typeface Data "+Chr(34)+UI_TIT_GAD_FONT_NAME$+Chr(34)+" 0x"+Str(UI_TIT_GAD_TYPEFACE))
		UI_TIT_GAD_FONT_NAME$=""
		FreeFont UI_TIT_GAD_TYPEFACE
		UI_TIT_GAD_TYPEFACE=0
	End If
End Function

Function SetTitleColours()
	Local TextR=Red(UI_TIT_GAD_COLOUR)
	Local TextG=Green(UI_TIT_GAD_COLOUR)
	Local TextB=Blue(UI_TIT_GAD_COLOUR)
	
	Local BackR=Red(TEMPLATE_SPINE_COLOUR)
	Local BackG=Green(TEMPLATE_SPINE_COLOUR)
	Local BackB=Blue(TEMPLATE_SPINE_COLOUR)
	
	SetTextAreaColor UI_TIT_GAD_TEXTBOX, TextR, TextG, TextB, FONT_FORE_FLAG
	SetTextAreaColor UI_TIT_GAD_TEXTBOX, BackR, BackG, BackB, FONT_BACK_FLAG
	
	Debug("TITLE (SET COLOUR): Colours set to FOREGROUND: "+Str(UI_TIT_GAD_COLOUR)+" BACKGROUND: "+Str(TEMPLATE_SPINE_COLOUR))
	
End Function

Function ClearTitle()
	If (GetTitleClear())
		Debug("TITLE (CLEAR): Title Text already null")
	Else
		SetTitleClear
	End If
End Function

Function PickTitleColour()
	Local Col=RequestColor(Red(UI_TIT_GAD_COLOUR),Green(UI_TIT_GAD_COLOUR),Blue(UI_TIT_GAD_COLOUR))
	
	Local RGB=RGBa(RequestedRed(),RequestedGreen(),RequestedBlue())
	If (Not(Col))
		Debug("TITLE (PICK COLOUR): Pick cancelled")
	Else
		Debug("TITLE (PICK COLOUR): Picked "+Str(RGB))
	End If
	
	If (RGB&lt;&gt;UI_TIT_GAD_COLOUR)
		UI_TIT_GAD_COLOUR=RGB
		SetTitle
		UpdateWYSIWYG
		Return 
	End If
	
	Debug("TITLE (PICK COLOUR): No change in Colour")
End Function

Function PickTitleFont()
	
	Debug("TITLE (BEFORE PICK): Previous: "+FontName(UI_TIT_GAD_TYPEFACE))
	Local NewFont=RequestFont()
	
	If (Not(NewFont))
		Debug("TITLE (PICK CANCELLED): Previous "+FontName(UI_TIT_GAD_TYPEFACE))
		Debug("TITLE (PICK TYPEFACE): Invalid / null selection or request cancelled. No Typeface change applied.")
		Return
	End If
	
	Debug("TITLE (PICK TYPEFACE): Picked 0x"+Str(NewFont))
	
	Debug("TITLE (AFTER PICK): Previous: "+FontName(UI_TIT_GAD_TYPEFACE))
	
	Local PickedName$=FontName(NewFont)
	
	If (UI_TIT_GAD_TYPEFACE)
		If (PickedName=UI_TIT_GAD_FONT_NAME)
			If (FontSize(NewFont)=FontSize(UI_TIT_GAD_TYPEFACE))
				If (FontStyle(NewFont)=FontStyle(UI_TIT_GAD_TYPEFACE))
					If (FontAscent(NewFont)=FontAscent(UI_TIT_GAD_TYPEFACE))
						If (FontDescent(NewFont)=FontDescent(UI_TIT_GAD_TYPEFACE))
							FreeFont NewFont
							Debug("TITLE (PICK TYPEFACE): Selection is identical to current Typeface. No change applied.")
							Return
						End If
					End If
				End If 
			End If
		End If
		
		Debug("TITLE (PICK TYPEFACE): Plugging memory leaks for previous Typeface 0x"+Str(UI_TIT_GAD_TYPEFACE))
		UnInitialiseTitleTypeface
		
	End If
	
	UI_TIT_GAD_TYPEFACE=NewFont
	UI_TIT_GAD_FONT_NAME=PickedName
	UI_TIT_GAD_FONT_FLAGS=GetFontFlags(NewFont)
	
	Debug("TITLE (PICK TYPEFACE): Loaded new Typeface "+Chr(34)+UI_TIT_GAD_FONT_NAME+Chr(34)+" Size: "+Str(FontSize(UI_TIT_GAD_TYPEFACE))+" to reference: 0x"+Str(UI_TIT_GAD_TYPEFACE)+" with flags: 0x"+Str(UI_TIT_GAD_FONT_FLAGS))
	
	SetTitle
	UpdateWYSIWYG
End Function

Function SetTitleFont()
	Debug("TITLE (SETFONT): Typeface is: "+FontName(UI_TIT_GAD_TYPEFACE))
	SetTextAreaFont UI_TIT_GAD_TEXTBOX,UI_TIT_GAD_TYPEFACE
	
	UI_TIT_GAD_FONT_NAME$=FontName(UI_TIT_GAD_TYPEFACE)
	UI_TIT_GAD_FONT_FLAGS=GetFontFlags(UI_TIT_GAD_TYPEFACE)
	
	Debug("TITLE (SET TYPEFACE): Typeface Set to "+Chr(34)+UI_TIT_GAD_FONT_NAME+Chr(34)+" Size: "+Str(FontSize(UI_TIT_GAD_TYPEFACE))+" to reference: 0x"+Str(UI_TIT_GAD_TYPEFACE)+" with flags: 0x"+Str(UI_TIT_GAD_FONT_FLAGS))
End Function

Function GetTitleClear()
	Return (TextAreaText(UI_TIT_GAD_TEXTBOX)="")
End Function

Function SetTitleClear()
	Debug("TITLE (RELEASE): Content released from: 0x"+Str(UI_TIT_GAD_TEXTBOX))
	SetTextAreaText UI_TIT_GAD_TEXTBOX,""
End Function

Function UpdateTitleParams()
	
	Debug("TITLE (UPDATE): Typeface is: "+FontName(UI_TIT_GAD_TYPEFACE))
	
	Debug("TITLE (UPDATE): Lock textbox gadget 0x"+Str(UI_TIT_GAD_TEXTBOX))
	LockTextArea UI_TIT_GAD_TEXTBOX
	Debug("TITLE (UPDATE): Typeface is: "+FontName(UI_TIT_GAD_TYPEFACE))
	SetTitleFont
	Debug("TITLE (UPDATE): Typeface is: "+FontName(UI_TIT_GAD_TYPEFACE))
	SetTitleColours
	Debug("TITLE (UPDATE): Typeface is: "+FontName(UI_TIT_GAD_TYPEFACE))
	UnlockTextArea UI_TIT_GAD_TEXTBOX
	
	Debug("TITLE (UPDATE): Typeface is: "+FontName(UI_TIT_GAD_TYPEFACE))
	
	Debug("TITLE (UPDATE): UnLock textbox gadget 0x"+Str(UI_TIT_GAD_TEXTBOX))
End Function

Function UpdateTitleImage()
	ClearTitleWYSIWYGImage
	Local TextString$=RemoveInvalidTitleCharacters(TextAreaText(UI_TIT_GAD_TEXTBOX))
	
	If (Replace(TextString," ","")&lt;&gt;"")
		
		Local Buffer=GraphicsBuffer()
		
		Local Image=CreateImage(1,1,1,TIT_WYSIWYG_IMAGE_FLAG_DYNAMIC)
		Local IBuffer=ImageBuffer(Image)
		
		SetBuffer(IBuffer)
		SetFont UI_TIT_GAD_TYPEFACE
		
		Debug("FONT: Main Typeface Set to "+Chr(34)+FontName(UI_TIT_GAD_TYPEFACE)+Chr(34)+" reference 0x"+Str(UI_TIT_GAD_TYPEFACE))
		
		Local W=StringWidth(TextString)
		Local H=StringHeight(TextString)
		
		If (W*H)
			If W&gt;(GUIDELINE_HEIGHT*CANVAS_Y_RATIO) Then W=GUIDELINE_HEIGHT*CANVAS_Y_RATIO
			If H&gt;(GUIDELINE_SPINE_WIDTH*CANVAS_X_RATIO)Then H=GUIDELINE_SPINE_WIDTH*CANVAS_X_RATIO
			SetBuffer(Buffer)
			
			ResizeImage Image,W,H
			
			TIT_WYSIWYG_IMAGE=Image
			
			SetBuffer(IBuffer)
			
			Local X=Floor(W Shr True)
			Local Y=Floor(H Shr True)
			
			LockBuffer IBuffer
			
			SetBufferColor(TEMPLATE_SPINE_COLOUR)
			
			If (UI_TIT_GAD_COLOUR=0) 
				;Fix for Masked 0,0,0
				SetColour(1)
			Else
				SetColour(UI_TIT_GAD_COLOUR)
			End If
			
			Text X,Y,TextString,True,True
			
			UnlockBuffer IBuffer
			
			SetBuffer(Buffer)
			
			RotateImage TIT_WYSIWYG_IMAGE,90
			MidHandle TIT_WYSIWYG_IMAGE
			
			Debug("WYSIWYG (TITLE): Image created 0x"+Str(TIT_WYSIWYG_IMAGE)+" With Dimensions: "+Str(W)+" x "+Str(H))
			
			Return
		Else
			FreeImage Image
			SetBuffer(Buffer)
			
		End If
	End If
		TIT_WYSIWYG_IMAGE=0
		Debug("WYSIWYG (TITLE): Image not created due to invalid dimensions: "+Str(W)+" x "+Str(H))
End Function

Function ClearTitleWYSIWYGImage()
	If (TIT_WYSIWYG_IMAGE)
		Debug("WYSIWYG (TITLE): Release memory for 0x"+Str(TIT_WYSIWYG_IMAGE))
		FreeImage TIT_WYSIWYG_IMAGE
		TIT_WYSIWYG_IMAGE=0
	Else
		Debug("WYSIWYG (TITLE): No memory to release")
	End If
End Function

Function DrawTitleImage()
	If (TIT_WYSIWYG_IMAGE)
		Local OFFSET_X=(GUIDELINE_REAR_WIDTH+(GUIDELINE_SPINE_WIDTH*0.5))
		Local OFFSET_Y=(GUIDELINE_HEIGHT*0.5)
		Local X#=GUIDELINE_X+OFFSET_X
		Local Y#=GUIDELINE_Y+OFFSET_Y
		
		X=X*CANVAS_X_RATIO
		Y=Y*CANVAS_Y_RATIO
		
		X=X-0.5	; Fix for floating point calculations and 0.5mm
		
		;FocusOnWYSIWYGBuffer()
		
		Debug("WYSIWYG (TITLE): Drawing Image at "+Str(X)+" , "+Str(Y))
		DrawImage TIT_WYSIWYG_IMAGE,X,Y
	End If
End Function

Function RemoveInvalidTitleCharacters$(Title$)
	Title=Trim(Title)
	Local Iter
	Local Check
	Local Ascii
	For Check= 0 To 31
		For Iter=Len(Title) To 1 Step -1
			Ascii=Asc(Mid(Title,Iter,1))
			If (Ascii=Check)
				Title=TrimStringMid(Title,Iter,1)
			End If
		Next
	Next
	Return Title
End Function

Function GetTitleFontFlags()
	Return (GetFontFlags(UI_TIT_GAD_TYPEFACE))
End Function
</pre><br><br><pre class=code>
13:38:23       | INIT: Initialise Title
13:38:23       | INIT (TITLE): Initialise textbox gadget dimensions
13:38:23       | TITLE: Textbox gadget reference 0x52078448 created with dims: 646 X 37
13:38:23       | INIT (TITLE): Initialise Typeface
13:38:23       | INIT (TITLE): Loaded new Typeface "Blitz" Size: 27 to reference: 0x52078800 with flags: 0x1
13:38:23       | TITLE (UPDATE): Typeface is: Blitz
13:38:23       | TITLE (UPDATE): Lock textbox gadget 0x52078448
13:38:23       | TITLE (UPDATE): Typeface is: Blitz
13:38:23       | TITLE (SETFONT): Typeface is: TITLE</pre> <br><br></td></tr></table><br>
<a name="1265662"></a>

<a name="1265670"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Floyd</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've gone quiet because I don't know what to say.<br><br><div class="quote"> trying to reproduce the error and narrow down <br></div><br>That's the right attitude, but your posted code has grown to 324 lines and is still a fragment that nobody can actually run. <br><br></td></tr></table><br>
<a name="1265690"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> I thought it best to post the full "Title" functionality which show all the relevant functions and any SetFont or SetTextAreaFont (includiing any FreeFont) commands <br><br>I can try to produce a runnable snippet that contains the same features and hopefully reproduce the error, but as from my recent bug-forumm post - I think it is almost definitely related to changing buffers and fonts without a graphics window. <br><br></td></tr></table><br>
<a name="1265696"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay here's a straightforward, procedural copy of all the relevant funcitonality which I only changed to remove calls to functions that were unnnecessary (such as getting the RGB colour components or determining certain sizes - which I'm pretty sure have no bearing on the issue)<br><br>This compiles as-is and will produce the error, but it is intermittent and inconsistent so you may need to compile a few times and check the last line of the ddebug output each time to see when it happens (should be within 20 times - at least, it was around 10 for me)<br><br>There's no logical explanation I can find as to why FontName should be giving a different result between each call at the end.<br><br><br>I really hope this highlights the issue I'm having and sorry it's not been easy to describe or narrow it down, but I do thank you for looking into it!<br><br><pre class=code>
Global UI_MAIN_WINDOW=CreateWindow("Window",0,0,800,600)
Const UI_TIT_WORDWRAP=1

Const FONT_DEFAULT_TYPEFACE$="Blitz"

Const DEF_TIT_TEXT$="Movie"
Const TIT_WYSIWYG_IMAGE_FLAG_DYNAMIC=2
Global TIT_WYSIWYG_IMAGE%

Global UI_TIT_GAD_TEXTBOX
Global UI_TIT_GAD_BUTTON
Global UI_TIT_GAD_TYPEFACE
Global UI_TIT_GAD_FONT_NAME$
Global UI_TIT_GAD_FONT_FLAGS=1

Const FONT_FORE_FLAG=0
Const FONT_BACK_FLAG=1

DebugLog("INIT: Initialise Title")
DebugLog("INIT (TITLE): Initialise textbox gadget dimensions")

Local W=768
Local H=20

UI_TIT_GAD_TEXTBOX=CreateTextArea(0,0,W,H,UI_MAIN_WINDOW,UI_TIT_WORDWRAP)
DebugLog("TITLE: Textbox gadget reference 0x"+Str(UI_TIT_GAD_TEXTBOX)+" created with dims: "+Str(W)+" X "+Str(H))

UI_GAD_BUTTON_X=20
UI_GAD_BUTTON_Y=50
UI_GAD_BUTTON_W=50
UI_GAD_BUTTON_H=30
UI_TIT_GAD_BUTTON=CreateButton("OK",UI_GAD_BUTTON_X,UI_GAD_BUTTON_Y,UI_GAD_BUTTON_W,UI_GAD_BUTTON_H,UI_MAIN_WINDOW)
HideGadget UI_TIT_GAD_BUTTON

If (UI_TIT_GAD_TYPEFACE)
	DebugLog("INIT (TITLE): Release Typeface Data "+Chr(34)+UI_TIT_GAD_FONT_NAME$+Chr(34)+" 0x"+Str(UI_TIT_GAD_TYPEFACE))
	UI_TIT_GAD_FONT_NAME$=""
	FreeFont UI_TIT_GAD_TYPEFACE
	UI_TIT_GAD_TYPEFACE=0
End If

DebugLog("INIT (TITLE): Initialise Typeface")

Local Size=27

UI_TIT_GAD_TYPEFACE=LoadFont(FONT_DEFAULT_TYPEFACE,Size);*FONT_DEF_LINE_SPACING#)
UI_TIT_GAD_FONT_NAME=FontName(UI_TIT_GAD_TYPEFACE)

DebugLog("INIT (TITLE): Loaded new Typeface "+Chr(34)+UI_TIT_GAD_FONT_NAME+Chr(34)+" Size: "+Str(FontSize(UI_TIT_GAD_TYPEFACE))+" to reference: 0x"+Str(UI_TIT_GAD_TYPEFACE)+" with flags: 0x"+Str(UI_TIT_GAD_FONT_FLAGS))

SetTextAreaText UI_TIT_GAD_TEXTBOX,DEF_TIT_TEXT$

DebugLog("TITLE (UPDATE): Typeface is: "+FontName(UI_TIT_GAD_TYPEFACE))

DebugLog("TITLE (UPDATE): Lock textbox gadget 0x"+Str(UI_TIT_GAD_TEXTBOX))
LockTextArea UI_TIT_GAD_TEXTBOX
DebugLog("TITLE (UPDATE): Typeface is: "+FontName(UI_TIT_GAD_TYPEFACE))

; SOMEHOW THE FONTNAME IS CORRUPTED BETWEEN THE LINE ABOVE AND THE LINE BELOW INTERMITTENTLY

DebugLog("TITLE (SETFONT): Typeface is: "+FontName(UI_TIT_GAD_TYPEFACE))

; YOU MAY NEED TO RUN MULTIPLE TIMES FOR THE EFFECT TO BE APPARENT
</pre> <br><br></td></tr></table><br>
<a name="1265711"></a>

<a name="1265712"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Floyd</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> No idea what's happening, but this is amusing.<br><br>The first thing that happens is I get *****INTERNAL ERROR***** Attempt to release &lt;unknown&gt; object.<br><br>The error is apparently at the last line of code:<br><pre class=code>DebugLog("TITLE (SETFONT): Typeface is: "+FontName(UI_TIT_GAD_TYPEFACE))</pre>If I delete that the INTERNAL ERROR goes away.<br><br>Now the good part, I replace the deleted line with<br><pre class=code>fname$ = FontName(UI_TIT_GAD_TYPEFACE)</pre><br>and the error is back, except it is Attempt to retain &lt;unknown&gt; object.<br><br>I also thought LockTextArea UI_TIT_GAD_TEXTBOX might be to blame, since there is no matching UnLockTextArea. That must be mistake, but it doesn't seem to affect the release/retain error, whatever that is. <br><br></td></tr></table><br>
<a name="1265799"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> The Lock/UnLock doesn't actually seem to affect anything at all - there was initially an UnLock line (Can be put in again, even right after the Lock line), but since the "&lt;unknown&gt; object"  error halts execution right there and then at the last line, I just removed everything afterwards.<br><br>Whilst also something intriguing and problematic, the &lt;unknown object&gt; errors aren't the reason for this thread, though it may be they are connected in some way - Did you at all repeat running the test a few times until you saw the FontName() returned (in the DebugLog) actually change and become corrupted?<br><br>At least, I am beginnning to feel slightly more reassured it's not just my code!<br><br>Any and all suggestions for alternative methods gladly appreciated!!! <br><br></td></tr></table><br>
<a name="1265802"></a>

<a name="1265815"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Floyd</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think I saw "Blitz" change to "TITLE", but not sure since I got distracted by the internal error, which I still don't understand.<br><br>As for the Lock/Unlock I think the general advice is to lock, do whatever it was you wanted to the buffer and then immediately unlock. This is to avoid possible interactions with other commands. They may seem unrelated but who knows.<br><br>My only other vague advice is that you are not using the normal form of a BlitzPlus program with GUI elements. Maybe that's causing trouble.<br><br>What I mean by normal form is this general structure:<br><pre class=code>
Set things up

Repeat
   Wait for event
   Deal with event
Forever</pre>If you haven't done it already take a look at the BlitzPlus User Guide. To find it click the Home icon in the IDE, just below the menu bar. You may want to start with Appendix A1 which summarizes some differences from previous Blitzes.<br><br>Disclaimer: Despite the fact that I'm here handing out advice I really don't know a lot about the features of BlitzPlus which were not already in Blitz3D. <br><br></td></tr></table><br>
<a name="1265805"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> "I think I saw "Blitz" change to "TITLE", but not sure"<br>Yes, that would be it. <br>Incidentally, it seems to sometimes actually take on the value of something like "TITLE (SETFONT): Typeface is:" - which is interestingly the string passed to the debuglog.<br><br>There may be a connection, since (part of my initial suspicion) if you remove references to FontName within the DebugLines, the "&lt;unknown object&gt;" error disappears:<br><pre class=code>Global UI_MAIN_WINDOW=CreateWindow("Window",0,0,800,600)
Const UI_TIT_WORDWRAP=1

Const FONT_DEFAULT_TYPEFACE$="Blitz"

Const DEF_TIT_TEXT$="Movie"
Const TIT_WYSIWYG_IMAGE_FLAG_DYNAMIC=2
Global TIT_WYSIWYG_IMAGE%

Global UI_TIT_GAD_TEXTBOX
Global UI_TIT_GAD_BUTTON
Global UI_TIT_GAD_TYPEFACE
Global UI_TIT_GAD_FONT_NAME$
Global UI_TIT_GAD_FONT_FLAGS=1

Const FONT_FORE_FLAG=0
Const FONT_BACK_FLAG=1

Local W=768
Local H=20

UI_TIT_GAD_TEXTBOX=CreateTextArea(0,0,W,H,UI_MAIN_WINDOW,UI_TIT_WORDWRAP)

UI_GAD_BUTTON_X=20
UI_GAD_BUTTON_Y=50
UI_GAD_BUTTON_W=50
UI_GAD_BUTTON_H=30
UI_TIT_GAD_BUTTON=CreateButton("OK",UI_GAD_BUTTON_X,UI_GAD_BUTTON_Y,UI_GAD_BUTTON_W,UI_GAD_BUTTON_H,UI_MAIN_WINDOW)
HideGadget UI_TIT_GAD_BUTTON

Local Size=10;27

UI_TIT_GAD_TYPEFACE=LoadFont(FONT_DEFAULT_TYPEFACE,Size);*FONT_DEF_LINE_SPACING#)
UI_TIT_GAD_FONT_NAME=FontName(UI_TIT_GAD_TYPEFACE)

SetTextAreaText UI_TIT_GAD_TEXTBOX,DEF_TIT_TEXT$

x$=FontName(UI_TIT_GAD_TYPEFACE)
DebugLog(x)
stop
</pre><br><br><br><br>"As for the Lock/Unlock I think the general advice is to lock, do whatever it was you wanted to the buffer and then immediately unlock. This is to avoid possible interactions with other commands. They may seem unrelated but who knows."<br>Yes, I pretty much tried this, but didn't seem to affect anything at all.<br><br><br><br><br>"My only other vague advice is that you are not using the normal form of a BlitzPlus program with GUI elements. Maybe that's causing trouble."<br><br>In my actual program, this is how the program flow operates, only prior to the loop, the initial defaults and gadgets need to be set up and the functions here represent a small part of that. The main window and menu system initialisation are elsewhere in my program code and function correctly, but do not seem to be a factor in this issue. <br><br></td></tr></table><br>
<a name="1268869"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think there might be some workaround for this issue if QueryObject(hn,3) is used for the font. <br>I'm working on it and will update as I have more info... <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
