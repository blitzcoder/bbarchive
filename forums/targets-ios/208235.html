<!DOCTYPE html><html lang="en" ><head ><title >Admob Interstitial on ios</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Admob Interstitial on ios</h1><a href="forums.php" >Monkey Targets Forums</a>/<a href="topics.php?forum=505" >iOS</a>/<a href="#bottom" >Admob Interstitial on ios</a><br><br>
<a name="2083183"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >erebel55</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I am attempting to get Admob Interstitial working on ios.  I have absolutely <b>zero </b>objective c experience, so please be kind.<br><br><b>FINAL code</b><br>admobInterstitial.ios.cpp<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
// Simple Admob Interstitial support for Monkey - IOS

// admobInterstitial.ios.h

#import "GADInterstitial.h"


class AdmobInterstitial {

	// the kind of "singleton"
	static AdmobInterstitial *_admob;

	// the ad
	GADInterstitial *_interstitialAd;
	// ad Unit ID
	NSString *adUnitId;
	
	void loadAd();
	
public:
	AdmobInterstitial();
	
	// creates an instance of the object and start the thread
	static AdmobInterstitial *GetAdmobInterstitial(String adUnitId);
	
	// displays the ad to the user if it is ready
	void ShowAd();

};


// admobInterstitial.ios.cpp

AdmobInterstitial *AdmobInterstitial::_admob;

AdmobInterstitial::AdmobInterstitial():_interstitialAd(0) {

}

AdmobInterstitial *AdmobInterstitial::GetAdmobInterstitial(String adUnitId) {
	if( !_admob ) _admob=new AdmobInterstitial();
	_admob-&gt;adUnitId = adUnitId.ToNSString();
	_admob-&gt;loadAd();
	return _admob;
}

void AdmobInterstitial::loadAd() {

	_interstitialAd = [[GADInterstitial alloc] init];
	
	if (_interstitialAd) {
		_interstitialAd.adUnitID = adUnitId;
		[_interstitialAd loadRequest:[GADRequest request]];
	}

}

void AdmobInterstitial::ShowAd() {
	// create ad (should this go here or earlier?)
	//_interstitialAd = [[GADInterstitial alloc] init];
	
	if (_interstitialAd) {
		//_interstitialAd.adUnitID = adUnitId;
		//[_interstitialAd loadRequest:[GADRequest request]];
		
		if (_interstitialAd.isReady) {
			BBMonkeyAppDelegate *appDelegate=(BBMonkeyAppDelegate*)[[UIApplication sharedApplication] delegate];
			UIViewController *rootViewController = appDelegate-&gt;viewController;
			[_interstitialAd presentFromRootViewController:rootViewController];
			
			// load the next ad
			_admob-&gt;loadAd();
		}
	}
}
</textarea><br><br><b>FINAL code</b><br>therevills' admobInterstitial.monkey file modified:<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
#If TARGET&lt;&gt;"android" And TARGET&lt;&gt;"ios"
	#Error "The AdmobInterstitial module is only available on the Android and ios"
#End

#If TARGET="android"
	Import brl.admob
	Import "native/admobInterstitial.java"
#End

#If TARGET="ios"
	Import brl.admob
	Import "native/admobInterstitial.ios.cpp"
#End

Extern

Class AdmobInterstitial Extends Null = "AdmobInterstitial"
	Function GetAdmobInterstitial:AdmobInterstitial(adUnitId:String)
	Method ShowAd:Void()
End
</textarea> <br><br></td></tr></table><br>
<a name="2083181"></a>

<a name="2083180"></a>

<a name="2083178"></a>

<a name="2083082"></a>

<a name="2083080"></a>

<a name="2083015"></a>

<a name="2083014"></a>

<a name="2083012"></a>

<a name="2082997"></a>

<a name="2082989"></a>

<a name="2082988"></a>

<a name="2082987"></a>

<a name="2082986"></a>

<a name="2082971"></a>

<a name="2082963"></a>

<a name="2082962"></a>

<a name="2082959"></a>

<a name="2082960"></a>

<a name="2082958"></a>

<a name="2082946"></a>

<a name="2082944"></a>

<a name="2082945"></a>

<a name="2083013"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >erebel55</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is compiling successfully, however I am not seeing the Interstitial ad in the simulator.<br><br>Can someone with more experience please help me finish this? <br><br></td></tr></table><br>
<a name="2082961"></a>

<a name="2083028"></a>

<a name="2083031"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >erebel55</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I am calling showAd after the player dies and clicks on the replay button.<br><br>_interstitialAd.isReady is coming back False.<br><br>I assume that is because of this<br>"You may invoke loadRequest: at any time, however, you must wait for GADInterstitialDelegate's interstitialDidReceiveAd: to be called before displaying the creative."<br><br>Can someone with objective-c knowledge look at this? <br><br></td></tr></table><br>
<a name="2083032"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Good on you for trying! :)<br><br>What does your game monkey code look like? <br><br></td></tr></table><br>
<a name="2083033"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >erebel55</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I will write up a simple example right now, instead of posting all of my game. :) <br><br></td></tr></table><br>
<a name="2083055"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >erebel55</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here is my monkey code, I apologize for the horribly written button class. That is still a work in progress. I didn't include the Ad Unit ID in the paste below.  I just replaced the digits with x characters.<br><br>Edit: Added autofit back into the example<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Strict

Import mojo

'Import brl.admob
Import admobInterstitial

Import autofit

Global game:MyGame

Function Main:int()
	game = new MyGame()
	return 0
End Function

Class MyGame Extends App 
	Field frameRate# = 200
	Field ms# = 0
	Field tmpMs#
	Field numTicks#
	Field lastNumTicks#
	Field maxMs% = 50
	Field lastTime#
	
	Field restartButton:Button
	
	' admob
	'Field admob:Admob
	
	#If TARGET="android" Or TARGET="ios"
		Field admobI:AdmobInterstitial
	#End

	Method OnCreate:Int()
	
		' admob ads
		'admob=Admob.GetAdmob()
        'admob.ShowAdView 1,2
        
        #If TARGET="android" Or TARGET="ios"
        	admobI = AdmobInterstitial.GetAdmobInterstitial("ca-app-pub-xxxxxxxxxxxxxxxx/xxxxxxxxxx")
        #End

		SetUpdateRate 60
		
		SetVirtualDisplay 960, 640
		
		restartButton = New Button("retry_placeholder.png", 400, 400, True)
		
		' timing
		ms = 1000 / frameRate
		numTicks = 0
		lastNumTicks = 1
		lastTime = Millisecs()
		
		return 0
	End Method
	
	Method OnUpdate:Int()
		local now% = Millisecs()
		
		If now &lt; lastTime
			numTicks = lastNumTicks
		Else
			tmpMs = now - lastTime
			If tmpMs &gt; maxMs tmpMs = maxMs
			numTicks = tmpMs / ms
		Endif
	
		lastTime = now
		lastNumTicks = numTicks
	
		For Local i% = 1 to Floor(numTicks)
            ' update button
            restartButton.CheckClick()
            
            If restartButton.clicked = True
				#If TARGET="android" Or TARGET="ios"
	            	game.admobI.ShowAd()
	            #End
	        Endif
		Next
		
		Return 0
	End Method
	
	Method OnRender:Int()
		UpdateVirtualDisplay()
		Cls
		PushMatrix
			restartButton.Draw()
		PopMatrix
		return 0
	End Method	
End Class

Class Button
    Field image:Image
    Field x:Int, y:Int
    Field width:Int, height:Int
    Field clickSound:Sound
    Field visible:Bool
    
    ' kind of sloppy
   ' Field isFirstClick:Bool
   Field clicked:Bool
    
    Method New(image:String, x:Int, y:Int, visible:Bool=False, clickSound:String="")
        Self.image = LoadImage(image)
        Self.x = x
        Self.y = y
        width = Self.image.Width()
        height = Self.image.Height()
        If clickSound &lt;&gt; "" Then Self.clickSound = LoadSound(clickSound)
        Self.visible = visible
        
        'isFirstClick = True
        clicked = False
    End Method
    
    Method Draw:Void()
        If visible = True
            DrawImage image, x, y
        Endif
    End Method
    
    ' button is being held down
    Method Down:Bool()
        For Local i:Int = 0 To 1
	        Local tx:Int = VTouchX(i)
	        Local ty:Int = VTouchY(i)
        
	        Local td:Int = TouchDown(i)
	        
	        If td = True
	            If tx &gt; x And tx &lt; x + width
	                If ty &gt; y And ty &lt; y + height
	                	Print "Down"
	                    Return True
	                Endif
	            Endif
	        Endif
	    Next
        
        Return False
    End Method
    
    ' FIX THIS HORRIBLNESS
    ' button is clicked
    'Method Clicked:Bool()
    Method CheckClick:Void()
        If visible = True
	        Local tx:Int = VTouchX(0)
	        Local ty:Int = VTouchY(0)
        
	        Local th:Int = TouchHit(0)
	        
	        If th = True
	            If tx &gt; x And tx &lt; x + width
	                If ty &gt; y And ty &lt; y + height
	                	Print "Click"
	                    'Return True
	                    clicked = True
	                    Return
	                Endif
	            Endif
	        Endif
	        
	        clicked = False
	    Endif
    End Method
End Class
</textarea><br><br>Also, here is the "retry_placeholder.png" image, I apologize for not making the code imageless.<br><img src="https://dl.dropboxusercontent.com/u/106998981/retry_placeholder.png"> <br><br></td></tr></table><br>
<a name="2083046"></a>

<a name="2083045"></a>

<a name="2083044"></a>

<a name="2083039"></a>

<a name="2083036"></a>

<a name="2083037"></a>

<a name="2083038"></a>

<a name="2083053"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sometimes Ads do take a bit of time to load, so if it isn't ready you might have to wait a bit.<br><br>Also when your showing the ad:<br><pre class=code>For Local i% = 1 to Floor(numTicks)
	' update button
	restartButton.CheckClick()

	If restartButton.clicked = True
		#If TARGET="android" Or TARGET="ios"
			game.admobI.ShowAd()
		#End
	Endif
Next
</pre><br><br>Can you check how many times you are calling ShowAd? Make sure you are only calling it once. <br><br></td></tr></table><br>
<a name="2083058"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >erebel55</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> It looks like ShowAd is being called three times for some reason.  However, I don't think that is the main issue.  In the native code I don't think _interstitialAd.isReady will ever be True; because it is being called directly after loadRequest.<br><br>Also, I have waited for about 5 min and no ad shows. <br><br></td></tr></table><br>
<a name="2083057"></a>

<a name="2083056"></a>

<a name="2083083"></a>

<a name="2083084"></a>

<a name="2083085"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >erebel55</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have updated the native code again, now it shows the Ad the 1st time I call ShowAd().  However, doesn't show it anytime I call ShowAd() after this.  In other words, the 1st time the player dies they see an Ad, but it isn't showing the Ad the 2nd time they die or anytime after that.<br><br>I think it is almost there tho :)<br><br>I'm thinking I need to call loadAd again when the following event occurs interstitialDidDismissScreen <br><br></td></tr></table><br>
<a name="2083081"></a>

<a name="2083100"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I'm thinking I need to call loadAd again when the following event occurs interstitialDidDismissScreen <br></div><br>That sounds right. With the Android one, I call LoadAd again once the Ad has been closed (onDismissScreen):<br><pre class=code>		// set listener so we load a new ad when the user closes one
		interstitialAd.setAdListener(new AdListener() {
		
			public void onDismissScreen(Ad ad) {
				loadAd();
			}
</pre> <br><br></td></tr></table><br>
<a name="2083101"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >erebel55</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah, I have been trying to figure out how to replicate that in my ios.cpp.<br><br>I'm not experienced in this native stuff tho <br><br></td></tr></table><br>
<a name="2083105"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Try importing GADInterstitialDelegate.h, into your native code and implementing interstitialDidDismissScreen, something like this:<br><br><pre class=code>// Simple Admob Interstitial support for Monkey - IOS

// admobInterstitial.ios.h

#import "GADInterstitial.h"
#import "GADInterstitialDelegate.h"

class AdmobInterstitial {

    // the kind of "singleton"
    static AdmobInterstitial *_admob;
    // the ad
    GADInterstitial *_interstitialAd;
    // ad Unit ID
    NSString *adUnitId;
    
    void loadAd();
    
public:
    AdmobInterstitial();
    
    // creates an instance of the object and start the thread
    static AdmobInterstitial *GetAdmobInterstitial(String adUnitId);
    
    // displays the ad to the user if it is ready
    void ShowAd();
};


// admobInterstitial.ios.cpp

AdmobInterstitial *AdmobInterstitial::_admob;

AdmobInterstitial::AdmobInterstitial():_interstitialAd(0) {

}

AdmobInterstitial *AdmobInterstitial::GetAdmobInterstitial(String adUnitId) {
    if( !_admob ) _admob=new AdmobInterstitial();
    _admob-&gt;adUnitId = adUnitId.ToNSString();
    _admob-&gt;loadAd();
    return _admob;
}

void AdmobInterstitial::loadAd() {
    _interstitialAd = [[GADInterstitial alloc] init];
    
    if (_interstitialAd) {
        _interstitialAd.adUnitID = adUnitId;
        [_interstitialAd loadRequest:[GADRequest request]];
    }
}

- (void)interstitialDidDismissScreen:(GADInterstitial *)interstitial {
    _admob-&gt;loadAd();
}

void AdmobInterstitial::ShowAd() {
    // create ad (should this go here or earlier?)
    //_interstitialAd = [[GADInterstitial alloc] init];
    
    if (_interstitialAd) {
        //_interstitialAd.adUnitID = adUnitId;
        //[_interstitialAd loadRequest:[GADRequest request]];
        
        if (_interstitialAd.isReady) {
            BBMonkeyAppDelegate *appDelegate=(BBMonkeyAppDelegate*)[[UIApplication sharedApplication] delegate];
            UIViewController *rootViewController = appDelegate-&gt;viewController;
            [_interstitialAd presentFromRootViewController:rootViewController];
        }
    }
}</pre><br><br>This code has not been tested... <br><br></td></tr></table><br>
<a name="2083104"></a>

<a name="2083111"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >erebel55</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> GADInterstitial.h already imports GADInterstitialDelegate.h<br><br>But the rest of this looks good :)<br><br>I will play around with this, thanks!! <br><br></td></tr></table><br>
<a name="2083110"></a>

<a name="2083106"></a>

<a name="2083109"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> I was going off this example:<br><br><a href="https://github.com/googleads/googleads-mobile-ios-examples/blob/master/admob/InterstitialExample/Classes/MainController.m" target="_blank">https://github.com/googleads/googleads-mobile-ios-examples/blob/master/admob/InterstitialExample/Classes/MainController.m</a><br><br>BTW I hate Objective C and how the whole work flow is set up for iOS... that's the reason I have stopped developing for it :) <br><br></td></tr></table><br>
<a name="2083119"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >erebel55</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the link.  I hate Objective-C as well.<br><br>I am getting the following.<br>error: missing context for method declaration<br>- (void)interstitialDidDismissScreen:(GADInterstitial *)interstitial<br><br>I don't think it can be free floating like that.  I think i need @implementation? <br><br></td></tr></table><br>
<a name="2083115"></a>

<a name="2083112"></a>

<a name="2083182"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >erebel55</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> I never figured out how to use interstitialDidDismissScreen in my ios.cpp code.<br><br>However, I realized I could just call loadAd() at the end of my ShowAd() method and everything would be fine.<br><br>So it is working now :)  My 1st post on this thread has the final code.<br><br>This has only been tested in the simulator as I don't have an apple dev account yet. <br><br></td></tr></table><br>
<a name="2083179"></a>

<a name="2083281"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >rIKmAN</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey erebel,<br><br>First well done on getting this to work! :)<br><br>I tried this on my device last night, using your new final code, and while the ad does indeed show the first time, once you dismiss it and try to show another advert it crashes.<br><br>I was using your final admobInterstitial.ios.cpp and your modified admobInterstitial.monkey, but I tried it along with the example code from therevills android demo where you tap the screen to show the ad - could this be the issue? <br><br></td></tr></table><br>
<a name="2083282"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >erebel55</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> I will give it a go with therevills example code and see what is going on. <br><br></td></tr></table><br>
<a name="2083286"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >erebel55</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here is the example code I am using.  I am not getting any crash, however I can only test this in the simulator (not a real device).<br>I replaced the digits in my Ad ID with x's.<br><br>Let me know if this crashes, if so can you let me know what error you are getting?<br><br>Also, I am compiling using version 78c of Monkey.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Strict

Import mojo

#If TARGET="android" Or TARGET="ios"
	Import admobInterstitial
#End

Function Main:Int()
	New AdmobInterstitialExample()
	Return True
End

Class AdmobInterstitialExample Extends App
	#If TARGET="android" Or TARGET="ios"
		Field admob:AdmobInterstitial
	#End
	
	Method OnCreate:Int()
		#If TARGET="android" Or TARGET="ios"
			admob = AdmobInterstitial.GetAdmobInterstitial("ca-app-pub-xxxxxxxxxxxxxxxx/xxxxxxxxxx")
		#End
		SetUpdateRate(60)
		Return True
	End
	
	Method OnUpdate:Int()
		If TouchHit()
			#If TARGET="android" Or TARGET="ios"
				admob.ShowAd()
			#End		
		End
		Return True
	End

	Method OnRender:Int()
		Cls
		DrawText("Testing Admob Interstitial...", 10, 10)
		DrawText("Touch to Show Ad!", 10, 30)
		Return True
	End
		
End
</textarea> <br><br></td></tr></table><br>
<a name="2083285"></a>

<a name="2083424"></a>

<a name="2083425"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >rIKmAN</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> I am using Monkey v76d, and the latest XCode, and it works to show the first advert.<br>Then you close it, press the screen again and I get a hard crash, as in the app quits and I get returned to the iPad home screen.<br><br>I will try and run it through XCode in debug mode and see if I can catch an error message with the crash, but the code below is essentially the same as yours except I use different AdMob IDs to serve ads depending on the target.<br><br>This is the example code I am using...<br><pre class=code>
Strict

Import mojo

#If TARGET="android" OR TARGET="ios"
        Import admobInterstitial
#End

Function Main:Int()
	New AdmobInterstitialExample()
	Return True
End

Class AdmobInterstitialExample Extends App
	#If TARGET="android" OR TARGET="ios"
		Field admob:AdmobInterstitial
	#End
	
	Method OnCreate:Int()
		#If TARGET="android"
			admob = AdmobInterstitial.GetAdmobInterstitial("ca-app-pub-xxxxxxxxxxxxxx/xxxxxxxxx")
			DebugLog "GetAdmobInterstitial() Android"
		#End
		
		#If TARGET="ios"
			admob = AdmobInterstitial.GetAdmobInterstitial("ca-app-pub-xxxxxxxxxxxxxx/xxxxxxxxx")
			DebugLog "GetAdmobInterstitial() IOS"
		
		#End
		
		SetUpdateRate(60)
		Return True
	End
	
	Method OnUpdate:Int()
		If MouseHit()
			#If TARGET="android" OR TARGET="ios"
				admob.ShowAd()
			#End		
		End
		Return True
	End

	Method OnRender:Int()
		Cls
		DrawText("Testing Admob Interstitial...", 10, 10)
		DrawText("Touch to Show Ad!", 10, 30)
		Return True
	End
		
End
</pre><br><br>I use separate AdMob ID's for iOS/Android as within AdMob you have to specify which target you are creating ads for.<br>Does it work on both devices with your code for iOS or android showing the same ads / using the same AdMob ID? <br><br></td></tr></table><br>
<a name="2083426"></a>

<a name="2083427"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >erebel55</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> No, you should use separate Ad IDs like you are doing there.<br><br>Are you testing this with the simulator or on a real device?  I'm not seeing any crash on my end.  I am using the latest XCode as well.<br><br>Also, any chance you could try with the latest version of Monkey? <br><br></td></tr></table><br>
<a name="2083428"></a>

<a name="2083429"></a>

<a name="2083437"></a>

<a name="2083438"></a>

<a name="2083439"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >rIKmAN</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here is a screenshot of the error when running through XCode onto my device.<br>It's an iPad Air 16gb running iOS7.<br><br>Here is what happens:<br><br>1) Run app<br>2) Touch screen<br>3) Ad appears correctly<br>4) Press X button to close the ad<br>5) Ad closes correctly<br>6) Touch the screen again<br>7) Crash<br><br> <a href="https://dl.dropboxusercontent.com/u/26955697/admobTouchError.png" target="_blank">Linky to screenshot</a> <br><br></td></tr></table><br>
<a name="2083430"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >erebel55</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> The error is thrown in the touch events.  I don't think this has to do with my admob code.<br><br>Can you please try upgrading to the latest Monkey? <br><br></td></tr></table><br>
<a name="2083431"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >rIKmAN</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yep I am just about to do that, but I'm going slow as I'm watching the football at the same time (Man Utd fan here!)<br>Will report back once I've tested with the latest stable version. <br><br></td></tr></table><br>
<a name="2083440"></a>

<a name="2083444"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >rIKmAN</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey erebel,<br><br>I retried using version 78c, and it does indeed run without crashing - I think I need to keep my eye out for updates a little more, sorry about that!<br><br>One thing I noticed is that after closing the ad, I have to press the screen twice for the next ad to show.<br>Looking at the example code the ad should show on the first touch?<br><br>Just to add to the above:<br><br>1) On first run, the ad shows on the first touch<br>2) Press X to close the ad<br>3) From now on you have to touch the screen twice for an ad to show after closing it. <br><br></td></tr></table><br>
<a name="2083436"></a>

<a name="2083443"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >erebel55</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> I get the same results and I'm not sure why.  If you find out why let me know. <br><br></td></tr></table><br>
<a name="2083445"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >rIKmAN</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> Will do, although I won't be using touch events to show my ads so it won't be high on my priority list unfortunately.<br><br>Great work! :) <br><br></td></tr></table><br>
<a name="2083446"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >erebel55</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> That is why I haven't looked into it ;)<br><br>Thanks :D <br><br></td></tr></table><br>
<a name="2083468"></a>

<a name="2083470"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >rIKmAN</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> haha, I thought that might be the case :)<br><br>Just one thing, are your interstitials updating properly?<br>I have added interstitials to my game code and the ad shows and displays fine, but it always shows the same ad.<br>It does the same with the example code.<br><br>I have 3 providers set in admob, and the banners seem to be working fine.<br>This is on iOS, on an iPad Air. <br><br></td></tr></table><br>
<a name="2083473"></a>

<a name="2083474"></a>

<a name="2083476"></a>

<a name="2083477"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >erebel55</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm I was getting a few different ads earlier; but now I am just getting a Clash of Clans ad.  May want to contact admob support and see if they have any ideas?  Is the therevills android version giving different ads?<br><br>Also, feel free to take a look through my native code and let me know if you see anything wrong.<br><br>Edit:<br>Actually, I clicked through about 40 times and I did see a few other ads. I got a verizon ad, a samsung ad, and some Filipino girls ad.  But 95% of the time it was the Clash of Clans ad.<br><br>Also, if you are adding different Mediation networks I don't think those will work without the adapter? I could be wrong on that though.<br><a href="https://developers.google.com/mobile-ads-sdk/docs/admob/mediation-networks" target="_blank">https://developers.google.com/mobile-ads-sdk/docs/admob/mediation-networks</a> <br><br></td></tr></table><br>
<a name="2083480"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >rIKmAN</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah I'm just constantly getting Empire: Four Kingdoms on iPad and a McLaren 650s one on iPhone.<br>I can't remember the ad but it also did the same on Android when I just tested, so I maybe it is Admob problem?<br><br>When I mentioned mediation networks, I just added the Admob eFloor beta and iAds to the default admob provider in the admob settings. <br><br></td></tr></table><br>
<a name="2083489"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >erebel55</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#32">[#32]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah, I just tested on android and am getting the same behavior. Most of the time it's the same ad. <br><br></td></tr></table><br>
<a name="2089494"></a>

<a name="2089505"></a>

<a name="2089507"></a>

<a name="2089508"></a>

<a name="2089509"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SLotman</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#33">[#33]</a></td></tr></table></td></tr><tr ><td class="posttext"> Edit: Never mind - I see the crash is removed in the latest monkey.<br><br>Now thinking about it: maybe the problem of "having to touch twice" is because the app/view is losing its focus and its not restored once the ad is closed?<br><br>Edit2: Its something along those lines, alright. Just added a Print "showad" in the mousehit() and it only shows once - when touching the screen for the second time!<br><br>Edit3: Now I'm lost again... I added a counter in the test example, and while showing the ad, the counter keeps increasing! So the game does *not* pause while showing the ads (and it should, the android version does that).<br><br>This is the test code I'm working here:<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">

Import mojo

#If TARGET="android" Or TARGET="ios"
	Import admobInterstitial
#End

Function Main:Int()
	New AdmobInterstitialExample()
End

Class AdmobInterstitialExample Extends App
	Global contador:Int=0
	
	#If TARGET="android" Or TARGET="ios"
		Field admob:AdmobInterstitial
	#End
	
	Method OnCreate:Int()
		#If TARGET="android" Or TARGET="ios"
			admob = AdmobInterstitial.GetAdmobInterstitial("publisher_id_here")
		#End
		SetUpdateRate(60)
	End
	
	Method OnUpdate:Int()
		If MouseHit(MOUSE_LEFT)
			Print "&gt;&gt; SHOW AD!"
			admob.ShowAd()
		End If
		contador+=1
		Print "contador:"+contador
	End
	
	Method OnSuspend()
		Print "&gt;&gt; APP SUSPENDED!!"
	End
	
	Method OnResume()
		Print "&gt;&gt; APP RESUMED!!"
	End 

	Method OnRender:Int()
		Cls
		DrawText("Testing Admob Interstitial...", 10, 10)
		DrawText("Touch to Show Ad!", 10, 30)
		Return True
	End
		
End
</textarea> <br><br></td></tr></table><br>
<a name="2089513"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SLotman</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#34">[#34]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just confirmed that the "touch twice to show ads" bug happens on real devices too: tested on my iPad2, and the app doesn't pause either when showing the interstitial ad :( <br><br></td></tr></table><br>
<a name="2089524"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >rIKmAN</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#35">[#35]</a></td></tr></table></td></tr><tr ><td class="posttext"> I never looked into the "two click" problem as they were shown in my game based on game conditions (# of player deaths), and it was before a menu / stats screen so the not pausing wasn't an issue either.<br><br>For the pausing, not sure if it will work on iOS, but have you tried using:<br><pre class=code>MOJO_AUTO_SUSPEND_ENABLED=True</pre> <br><br></td></tr></table><br>
<a name="2089529"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SLotman</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#36">[#36]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, you can reproduce the "two click" problem with the code above... I've spent all night trying to find some sort of fix, but nothing I tried worked; The only option left I see is to implement a "delegate" and see when the ads loads and gets removed from the screen.<br><br>But I'm going to test the auto_suspend thing, good call! :) <br><br></td></tr></table><br>
<a name="2089557"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SLotman</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#37">[#37]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nope, #MOJO_AUTO_SUSPEND_ENABLED=True does not stop the app when the ad is visible... and the "two clicks" problem persists :( <br><br></td></tr></table><br>
<a name="2089583"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >rIKmAN</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#38">[#38]</a></td></tr></table></td></tr><tr ><td class="posttext"> Its not ideal, but as a workaround you could set a bool when you display the ads.<br>Then enclose your game code within an if test and if the ads are showing, do not update.<br><br>Just curious, but why would u want ads to appear while the game is still in play? <br><br></td></tr></table><br>
<a name="2089592"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SLotman</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#39">[#39]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's not while the game is on play - it's when I show my level selection screen. But this "having to touch twice" worries me.<br>The only way I know to check if the ad is on screen or not is to set a "delegate", but I'm not really sure how to implement it :/ <br><br></td></tr></table><br>
<a name="2089629"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >rIKmAN</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#40">[#40]</a></td></tr></table></td></tr><tr ><td class="posttext"> If it is a level selection screen, then why does it matter if it pauses or not when the ads show?<br><br>Show the ads based off game logic (rather than a touch), then the user has to close the ad or click to follow the link, then the ad closes and you are back to your level selection screen.<br><br>This is exactly how I used ads in my game and it worked great. <br><br></td></tr></table><br>
<a name="2089687"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SLotman</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#41">[#41]</a></td></tr></table></td></tr><tr ><td class="posttext"> For once, I think my game checks for touches to start a level - what if when the player touches the screen, if it starts a level and the ad remains on screen?<br>Or worse, the ad opens, and at the same time, the game starts?<br><br>I'm not very comfortable dealing with unknown variables :( <br><br></td></tr></table><br>
<a name="2089705"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >rIKmAN</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#42">[#42]</a></td></tr></table></td></tr><tr ><td class="posttext"> Have you tested that - is that what happens?<br><br>I've just tested my game on my iPad and I can't seem to get a click on the full screen ad to press the game buttons behind, although I only tested a few times as I don't want to be banned from AdMob, and am roughly guessing the locations of the buttons as they are behind the ad. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
