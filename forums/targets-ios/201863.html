<!DOCTYPE html><html lang="en" ><head ><title >Not forcing AudioStream to initialize</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Not forcing AudioStream to initialize</h1><a href="forums.php" >Monkey Targets Forums</a>/<a href="topics.php?forum=505" >iOS</a>/<a href="#bottom" >Not forcing AudioStream to initialize</a><br><br>
<a name="2017747"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >anawiki</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi<br>Currently Monkey on initialize starts audio device (or whatever it is) and you can see in debug something like that:<br><br>AudioStreamBasicDescription:  2 ch,  44100 Hz, 'lpcm' (0x00000C2C) 8.24-bit little-endian signed integer, deinterleaved<br><br>This happens even in programs that don't use audio at all (like clock example).<br><br>The problem is that this behavior stops iPod playback and we can't make programs that won't use music (or will mute music if iPad is playing something) and let player/user listed to iPod program.<br><br>Unfortunately, such behavior is one of requirements from top iOS publishers.<br><br>Can we do something about it?<br><br>cheers<br>Roman <br><br></td></tr></table><br>
<a name="2017751"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >anawiki</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> We can use this function to check if iPod is playing anything:<br><br><br>bool isIPODMusicPlaying () {<br>        BOOL isPlaying = NO;<br>        MPMusicPlayerController* iPodMusicPlayer = [MPMusicPlayerController iPodMusicPlayer];<br>        if (iPodMusicPlayer.playbackState == MPMusicPlaybackStatePlaying) {<br>            isPlaying = YES;<br>        }<br>	   #ifndef NDEBUG<br>        NSLog(@"Music is %@.", isPlaying ? @"on" : @"off");<br>	   #endif<br>        return isPlaying;<br>}   <br><br><br>(don't forget to add MediaPlayer framework to your project).<br><br>From what I reengineered it looks like Monkey initialize audio in <br><br>didFinishLaunchingWithOptions<br><br>with this line:<br><br><br>		if( !alcMakeContextCurrent( alcContext ) ) RuntimeError( "alcMakeContextCurrent failed" );<br><br><br>so we would need to modify this line to check if iPod is playing music, and if so, not make context current. Later, whenever we call Play sfx/music funtions we would need to check again if music is playing and if no if current context is Monkey context. <br><br></td></tr></table><br>
<a name="2017780"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >anawiki</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> OK, so it's easy to not turn sound engine on while iPod is playing, but it's black magic so far to turn off music engine after your app has been suspended, iPod music turned on, and your app resumed (in this case your app resumes audio and kills iPod playback). <br><br></td></tr></table><br>
<a name="2017818"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >anawiki</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> There is hope for us Monkeys... I found solution (thanks to www.ovogame.com). I'll send the code changes to Mark after giving it a bit more testing. <br><br></td></tr></table><br>
<a name="2017825"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TMK</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Awesome, good work! :)<br><br>I used to comment out the 3 "alcMakeContextCurrent" etc. calls to fix this (in a game that doesn't use sound), but will be great to have this support already in Monkey. <br><br></td></tr></table><br>
<a name="2017994"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >anawiki</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> OK, I finished the job. Files that changed have been sent to Mark. Hopefully he can add it to next release. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
