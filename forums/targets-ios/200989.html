<!DOCTYPE html><html lang="en" ><head ><title >Why AngelFont on iPad is so slow?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Why AngelFont on iPad is so slow?</h1><a href="forums.php" >Monkey Targets Forums</a>/<a href="topics.php?forum=505" >iOS</a>/<a href="#bottom" >Why AngelFont on iPad is so slow?</a><br><br>
<a name="2008512"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >anawiki</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi<br>I am using AngelFont in our game and it looks like it is real performance killer. Our game is quite graphics intensive, but not that much per game stage (stage = title screen, map screen or game screen). For example on title screen we get just 30 FPS and title screen draws one 512x512 texture stretched to 1024x768, one fullscreen texture with transparent parts and just 5 calls to AngelFont.DrawText, printing Play, Freeplay, Options, Exit and "Hello Player, if that's not you click here". We use 2 font textures for that (256x256). That's less that 10MB for that stage.<br><br>In game stage where we draw background image 1024x768, gui from 1024x768, cards from 1024x768 texture (sometimes two textures) we are able to get &gt;40 FPS up to 60 FPS when there is lower amount of cards to draw (but there is not much text drawn). So why title screen would be sooo slow? Or actually Angel Font?<br><br>Any ideas how we can improve performance?<br><br>cheers<br>Roman <br><br></td></tr></table><br>
<a name="2008524"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> AngelFont creates an Image per character, so the more letters you have on screen the more images, the more images the slower the game gets...<br><br>I found the same issue with Pirates - I decided on "hard" drawing my text into images... <br><br></td></tr></table><br>
<a name="2008545"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >anawiki</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, it's not quite true. AngelFont draws each letter separately, but it uses just one texture for all letters and DrawImageRect to draw them. That's why I am surprised it is slower than expected. <br><br></td></tr></table><br>
<a name="2008552"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah thats right - but each DrawImage will cost you some performance, it doesnt matter that it is using the same texture. <br><br></td></tr></table><br>
<a name="2008554"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MikeHart</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> One thing I find suspiscious is the local definition of variables inside the for loops when Angelfont draws a text. <br>While that shouldn't be a problem with compiled targets like C++, I imagine that this could be a problem on targets like Android. Are JAVA's scope rules the same like LUA's? There a local definition inside a FOR loop is local to that loop. So if you define each loop a new local var, then the garbage collector could kick in easily. But that could be easily testet. Move the var definitions to the top of the methods and just set them inside the loop. <br><br>The texture size for the font is 512x512, so that should be fine. <br><br></td></tr></table><br>
<a name="2008555"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MikeHart</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry, forgot that you are using it on the IPAD. So GC is not that much of a problem. Still, I would test this. <br><br></td></tr></table><br>
<a name="2008562"></a>

<a name="2008564"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >anawiki</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I just run another test. Magic store: two 1024x768 textures drawn + some texts. With 6 texts drawn (total of 30 letters) it still draws near 60 FPS, but adding one more text "You can't afford that" with SetColor 255, 0, 0 drops frame rate to 30 FPS. Weirdly with SetColor 255, 255, 255 it slows down just a bit to 55 FPS.<br><br>Could it be that SetColor is sooooooo slow on iPad? <br><br></td></tr></table><br>
<a name="2008569"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Dont know? I released PS before we got SetColor for images ;) <br><br></td></tr></table><br>
<a name="2008573"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dopeyrulz</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> with SetColor 255, 0, 0 drops frame rate to 30 FPS. Weirdly with SetColor 255, 255, 255 it slows down just a bit to 55 FPS. <br></div><br><br>I'd imagine that would have to be the image coloring... <br><br></td></tr></table><br>
<a name="2008578"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >anawiki</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> What a crap :D I coded font manager to make it easier managing loading fonts. Because there are many "LoadFont" calls the function searched if font was already loaded or not (we can like 30 calls to LoadFont for one font). But trying to optimize the function a bit I used wrong variable name for searching for fonts, so the function always loaded new font.<br><br>In the end we had like 50 256x256 fonts loaded, almost every element used different font (since LoadFont returned new pointer) and this caused a low of memory swapping and huge performance drop.<br><br>Once I fixed font manager we gained performance and title screen and other parts are 60 FPS again!<br><br>Hurrayyy.<br><br><br>So the lesson here is to make sure you don't use too much RAM and that you load things properly. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
