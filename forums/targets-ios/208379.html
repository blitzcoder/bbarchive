<!DOCTYPE html><html lang="en" ><head ><title >Facebook module, iOS. Login, scores etc.</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Facebook module, iOS. Login, scores etc.</h1><a href="forums.php" >Monkey Targets Forums</a>/<a href="topics.php?forum=505" >iOS</a>/<a href="#bottom" >Facebook module, iOS. Login, scores etc.</a><br><br>
<a name="2085186"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Alex</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello!<br><br>Check out the Facebook module I created.<br>I'm not a good programmer, but for now, for me it works :)<br>I think there's many unnecessary in the code, so I post it here.<br><br>I will appreciate any fixes and additions.<br><br>Here it is.<br><a href="https://dl.dropboxusercontent.com/u/71223199/fbMonkey.zip" target="_blank">https://dl.dropboxusercontent.com/u/71223199/fbMonkey.zip</a><br><br><br>Example/how to use:<br><pre class=code>
Strict

Import fbMonkey

Global friendsNames:String[]
Global friendsIDs:String[]
Global friendsScore:Int[]
Global friendsIDsOld:String[]

Global fbYourPlace:Int, loginFlowInProgress:Bool, loadingFBLeaderboardData:Bool, isLeaderboardFetched:Bool
Global bestResult:Int, lastPosted:Int

Global monkeyFB := New MonkeyFacebook

Class MonkeyFacebook Implements IOnFBLoginComplete, IOnFBFetchComplete, IOnFBFetchFriendsComplete, IOnFBOpenNewSessionComplete, IOnFBSendScoreComplete, IOnFBShareComplete
	
	Field openNewSession:MonkeyOpenNewSessionFB
	Field login:MonkeyLoginFB
	Field fetch:MonkeyFetchFB
	Field fetchFriends:MonkeyFetchFriendsFB
	Field share:MonkeyShareFB
	Field sendScore:MonkeySendScoreFB

	'Do at OnCreate, checks if user is already logged in'
	Method OpenNewSession:Void()
		openNewSession = New MonkeyOpenNewSessionFB
		openNewSession.FBOpenNewSessionAcync(Self)
	End

	Method Login:Void()
		login = New MonkeyLoginFB
		login.FBLoginAsync(Self)
		loginFlowInProgress = True
	End

	'fetches your data'
	Method Fetch:Void()
		fetch = New MonkeyFetchFB
		fetch.FBFetchAsync(Self)
	End

	'fetches friends data and score'
	Method FetchFriends:Void()
		fetchFriends = New MonkeyFetchFriendsFB
		fetchFriends.FBFetchFriendsAsync(Self)
		isLeaderboardFetched = False
	End

	Method SendScore:Void(theScore:Int)
		sendScore = New MonkeySendScoreFB
		sendScore.FBSendScoreAsync(Self, theScore)
		sendingScoreFlow = True
		isLeaderboardFetched = False
	End

	Method Share:Void(theScore:Int, theName:String, theCaption:String, theLink:String, thePicLink:String, thePhrase1:String, thePhrase2:String)
		share = New MonkeyShareFB
		share.FBShareAsync(Self, theScore, theName, theCaption, theLink, thePicLink, thePhrase1, thePhrase2)
	End

	Method OnFBOpenNewSessionComplete:Void( result:Int )
		Print "OnFBOpenNewSessionComplete, result=" + result

		If result&lt;&gt;0 
			Print "Failed to Open New Session"
			login=Null
			loginFlowInProgress = False
		Endif

		If result = 1
			loginFlowInProgress = False
			Print "New Session Failed To Open"
		End

		'success'
		If result = 0
			'fetching your data if login was successful'
			Self.Fetch()
		End
	End

	Method OnFBLoginComplete:Void( result:Int )
		Print "FBLoginComplete, result=" + result

		If result&lt;&gt;0 
			Print "Failed to Login or Canceled"
			login=Null
			loginFlowInProgress = False
		Endif

		If result = 1
			Print "Login Cancelled"
			loginFlowInProgress = False
		End

		'success'
		If result = 0
			'fetching your data if login was successful'
			Self.Fetch()
		End
	End

	Method OnFBFetchComplete:Void( result:Int )
		Print "FBFetchComplete, result=" + result

		If result&lt;&gt;0 
			Print "Failed to Fetch"
			fetch=Null
			loginFlowInProgress = False
		Endif

		If result = 1
			Print "Fetch Cancelled"
			loginFlowInProgress = False
		End

		'success'
		If result = 0
			Print fbUserName
			Print fbUserID
			'fetching friends' data if fetching your data was successful'
			Self.FetchFriends()
		End
	End

	Method OnFBFetchFriendsComplete:Void( result:Int )
		Print "FBFetchFriendsComplete, result=" + result

		If result&lt;&gt;0 
			Print "Failed to FetchFriends"
			fetchFriends=Null
		Endif

		If result = 1
			Print "FetchFriends Cancelled"
		End

		If result = 0
			Print "Friends Fetched"

			'resizing all arrays to your friends count'
			friendsNames = friendsNames.Resize(friendsCount)
			friendsIDs = friendsIDs.Resize(friendsCount)
			friendsScore = friendsScore.Resize(friendsCount)
			friendsPics = friendsPics.Resize(friendsCount)
			friendsIDsOld = friendsIDsOld.Resize(friendsCount)

			For Local fr:Int = 0 Until friendsCount
				friendsNames[fr] = GetFriendName(fr)

				'OPTIONAL, getting only Name without a last name'
				For Local frn$=Eachin friendsNames[fr].Split( " " )
					friendsNames[fr] = frn
					Exit
				Next

				'OPTIONAL, shorting the name if it's too long'
				Local neededNameLenght:Int = 13
				If friendsNames[fr].Length() &gt; neededNameLenght
					friendsNames[fr] = friendsNames[fr][..(neededNameLenght - 1)] + "..."
				End

				friendsIDs[fr] = GetFriendID(fr)
				friendsScore[fr] = GetFriendScore(fr)

				Print friendsIDs[fr]
				Print friendsNames[fr] + " has a score of:" + friendsScore[fr]

				'Check if we need to update ava picture from the last time'
				If friendsIDsOld[fr] &lt;&gt; friendsIDs[fr]

					'LOADING THE AVATAR'

					'!!!Please, use the LoadImageAcync, because you'll have a lot of trouble
						'when the picture will be loaded from a device with Cellular internet.
						'The game will freeze until all your friends' images are loaded!!!

					'You'll fing my own Method below, use it if it feets your needs
					imageLoad.LoadFBPicAsync(fr)

					Print "Image is updating..."
				Else
					Print "No need to load a new image"
				End

				friendsIDsOld[fr] = friendsIDs[fr]

				'Assigning your place in the leaderboard
				'Updating the best result from the leaderboard to current device (if you are logged in on your other device)'
				'And also, if your result on the device is higher, later we will post it on Facebook (here, I use the variable lastPosted to
					post it on Facebook later, in my code flow; you can update the score your way)'
				If friendsIDs[fr] = fbUserID
					fbYourPlace = fr
					If friendsScore[fr] &gt; bestResult
						bestResult = friendsScore[fr]
					Else
						lastPosted = friendsScore[fr]
					End
				End
			End
		End

		isLeaderboardFetched = True
		loginFlowInProgress = False

	End

	Method OnFBSendScoreComplete:Void( result:Int )
		Print "FBSendScoreComplete, result=" + result

		If result&lt;&gt;0 
			Print "Failed to Send Score"
			sendScore=Null
		Endif

		If result = 1
			Print "SendScore Cancelled"
		End

		If result = 0
			Print "Score sent" + sendScore.scoreSent
			lastPosted = sendScore.scoreSent
			Print "the last posted: " + lastPosted
			sendingScoreFlow = False
			UpdateLeaderBoardData()
		End

	End

	Method OnFBShareComplete:Void( result:Int )
		Print "FBShareComplete, result=" + result

		If result&lt;&gt;0 
			Print "Failed to Share"
			sendScore=Null
		Endif

		If result = 1
			Print "Share Cancelled"
		End

		If result = 0
			Print "Shared!"
		End

	End

End



Global imageLoad := New ImageLoadClass

Class ImageLoadClass Implements IOnLoadImageComplete

	Method LoadFBPicAsync:Void(num:Int)
		Local neededPicSize:Int = 50
		LoadImageAsync(	"https://graph.facebook.com/" + friendsIDs[num] + "/picture?width=" + neededPicSize + "&amp;height=" + neededPicSize, 
						1, 
						Image.MidHandle, 
						Self)
	End
	
	Method OnLoadImageComplete:Void( img:Image, path:String, source:IAsyncEventSource )
		If img
			Print "Image Loaded!"

			'Checking the appropriate friend for loaded pic =)'
			For Local fr:Int = 0 Until friendsCount
				If path.Contains(friendsIDs[fr])
					friendsPics[fr] = img
				End
			End
		Else
			Print "Error loading image async"
		End
	End
End
</pre> <br><br></td></tr></table><br>
<a name="2085185"></a>

<a name="2085187"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >erebel55</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Alex, I will have a look :) <br><br></td></tr></table><br>
<a name="2085188"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Alex</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Great! Thanks!<br><br>Forgot to mention, I tested it with bad connection and no connection at all.<br>Everything worked so far.<br><br>I implemented it in one of my games. Now it's waiting for review in Apple App Store.<br>I will post here if it's accepted or rejected by Apple =) <br><br></td></tr></table><br>
<a name="2085418"></a>

<a name="2085419"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Alex</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Found a bug.<br>Link updated.<br><a href="https://dl.dropboxusercontent.com/u/71223199/fbMonkey.zip" target="_blank">https://dl.dropboxusercontent.com/u/71223199/fbMonkey.zip</a><br><br>Had some problems with userID.<br>However, now there's some problems during validation (<br><br>If Apple founds a variable in your code that you use as non-public and they use as public, validation says:<br><pre class=code>The app references non-public selectors in Payload/MonkeyGame.app/MonkeyGame : id</pre><br><br>I don't know how this will affect the approval.<br><br>I tried to change Facebook's "id" for fbUserID, doesn't work (I don't know, if it's appropriate to change the SDK code, or maybe forgot to change in every place)<br><br>Trying to get the approval, will post here the result =) <br><br></td></tr></table><br>
<a name="2085417"></a>

<a name="2085423"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Alex</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Fixed )<br>Updated link:<br><a href="https://dl.dropboxusercontent.com/u/71223199/fbMonkey.zip" target="_blank">https://dl.dropboxusercontent.com/u/71223199/fbMonkey.zip</a><br><br><a href="http://stackoverflow.com/questions/14448056/the-app-references-non-public-selector-in-id-facebook-sdk-ios" target="_blank">http://stackoverflow.com/questions/14448056/the-app-references-non-public-selector-in-id-facebook-sdk-ios</a><br><br><pre class=code>
The workaround for the moment is to use these:

[user objectForKey:@"id"]
[friend objectForKey:@"id"]
instead of user.id and friend.id as shown in the different Facebook samples.
</pre><br><br>Now there's no problems during validation. <br><br></td></tr></table><br>
<a name="2085732"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >erebel55</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Are you planning on supporting android as well? <br><br></td></tr></table><br>
<a name="2085738"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >rIKmAN</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> This looks great Alex, thanks for sharing.<br><br>Did your app that uses this module get approved on the app store yet? <br><br></td></tr></table><br>
<a name="2085754"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Alex</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> erebel55, sorry, not yet. I have zero android experience at the moment (<br>Maybe I'll have some time to try to port one of my apps on android this summer.<br><br>rIKmAN, thanks! ;) Due to the bug I found, I had to resubmit my app April 27th, so it may go live (or rejected) on May ~4th. I'll post here the result! <br><br></td></tr></table><br>
<a name="2086046"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Alex</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Great news!<br>My app has been approved! ) <br><br></td></tr></table><br>
<a name="2086085"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Alex</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Little tutorial based on my tests or "Where and when to do something to integrate Facebook in your game."<br><br>Firstly, we have to check the internet connection.<br>I tried different ways to do that. But this module I've created from one of the StackOverflow topics:<br><a href="https://dl.dropboxusercontent.com/u/71223199/checkConnection.zip" target="_blank">https://dl.dropboxusercontent.com/u/71223199/checkConnection.zip</a><br>It's the fastest I ever used.<br><br>So this function checks the internet.<br><pre class=code>
Global connectionSuccessful:Bool

Function CheckConnection:Void()
	connectionSuccessful = isConnected()
	If connectionSuccessful Print "Internet connected" Else Print "No internet"
End
</pre><br><br>1. OnCreate Method:<br><pre class=code>
CheckConnection()

#If TARGET="ios"
	monkeyFB.OpenNewSession()
#End
</pre><br><br>That's it. We don't need to cancel session opening if there's no internet.<br><br>2. Login<br><pre class=code>
#If TARGET="ios"
	If fbLoginBtn.Pressed()
		If Not isLoggedIn And connectionSuccessful
			monkeyFB.Login()
		End

		If Not connectionSuccessful
			//tell player that there's no internet
		End
	End
#End
</pre><br><br>3. OnResume Method<br>It's good time to update the leaderboard when the player suspends the app.<br><pre class=code>
CheckConnection()

If connectionSuccessful And isLoggedIn And LoginFlowActive = False
	monkeyFB.FetchFriends()
End

FBAtResume()
</pre><br><br>4. Posting the score.<br><pre class=code>
Global currentResult:Int, isResultUpgraded:Bool

'checking if the score is best, then post
If currentResult &gt; bestResult
	bestResult = currentResult
	isResultUpgraded = True
	Print "New record!"
End

scoreToPost = currentResult

If isLoggedIn And connectionSuccessful
	If isResultUpgraded
		monkeyFB.SendScore( scoreToPost )
	End
End
</pre><br>Note: you have to reset the isResultUpgraded var to False before posting the score<br><br>5. OnUpdate Method<br><br><pre class=code>
'Important!!!
UpdateAsyncEvents()

#If TARGET = "ios"

'freezing the update if login is in progress (I suggest you to draw something like "Connecting..." on the screen while this is happening)
If LoginFlowActive
	Return
End

'checking if the best score is higher than has ever been posted on this device.
If lastPosted &lt; bestResult
	If isLoggedIn And connectionSuccessful And LoginFlowActive = False And isLeaderboardFetched = True And sendingScoreFlow = False
		Print "score is old, updating from: " + lastPosted
		monkeyFB.SendScore( bestResult )
	End
End

#End
</pre><br><br>6. Logout is simple ) Just don't forget not to draw Facebook leaderboard after logout<br><pre class=code>
FBLogout()
</pre><br><br>7. Sharing<br><pre class=code>
If fbShareBtn.Pressed()

	If isResultUpgraded

		'the last two phrases are actually one, the var scoreToPost is inserted between those phrases, so you may include your score into your post.
		monkeyFB.Share(	scoreToPost,
						theNameOfApp,
						smallCaption,
						iTunesURL,
						iconURL,
						anyText "I've got a score of ",
						anyTextContinue "! Can you score more?")
						'the whole text will look like "I've got a score of 125! Can you score more?"

	End

End
</pre><br><br>And some pseudo code for drawing the leaderboard.<br>I know, it's obvious, but, I hope, will save you some time.<br><pre class=code>
If isLeaderboardFetched
	For Local fr:Int = 0 Until friendsCount
		'draw fb pics
		
		'highlighting YOU with yellow
		If fr = 'your place
			SetColor(255,205,0)	
		End

		'draw friends' names and score

		SetColor(255,255,255)
	End
Else
	'Draw something like "Updating leaderboard data..."
End
</pre><br><br>Hope, I didn't forget anything )<br>Waiting for your comments, notes and corrections! <br><br></td></tr></table><br>
<a name="2086082"></a>

<a name="2086080"></a>

<a name="2086069"></a>

<a name="2086070"></a>

<a name="2086071"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Alex</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> sorry, double post <br><br></td></tr></table><br>
<a name="2086066"></a>

<a name="2086064"></a>

<a name="2086061"></a>

<a name="2086059"></a>

<a name="2086058"></a>

<a name="2087186"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raul</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> does this require Facebook SDK for IOS and must create an id for your app? <br><br></td></tr></table><br>
<a name="2087187"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Alex</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, it does. I'm planning to drop a few lines in this thread about iOS Facebook SDK integration into xCode project.<br>If I have some free time, I will try do it this week. <br><br></td></tr></table><br>
<a name="2095863"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raul</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> if someone still using this, any idea why I receive this message when I try to compile?<br><pre class=code>
1 error generated.

** BUILD FAILED **


The following build commands failed:
TRANS FAILED: Error executing 'xcodebuild -configuration Debug -sdk iphonesimulator', return code=16640
	CompileC build/MonkeyGame.build/Debug-iphonesimulator/MonkeyGame.build/Objects-normal/i386/main.o main.mm normal i386 objective-c++ com.apple.compilers.llvm.clang.1_0.compiler
(1 failure)
</pre> <br><br></td></tr></table><br>
<a name="2095862"></a>

<a name="2095868"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Alex</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Raul,<br><br>I did not get compile error. However, sdk has updated and my old apps stopped working.<br><br>My steps:<br>Delete FacebookSDK.framework from project.<br>Update SDK on my Mac.<br>Drag FacebookSDK.framework to my project (Copy to project option UNCHECKED! Don't know if this is important.)<br><br>Made some changes with getting friends score and login.<br><a href="https://dl.dropboxusercontent.com/u/71223199/fbMonkey.zip" target="_blank">https://dl.dropboxusercontent.com/u/71223199/fbMonkey.zip</a><br><br>Share doesn't work though.<br>I use URL. Works perfectly for me!<br><pre class=code>
Local varAppName:String = "My great game!"
Local varCaption:String = "Greatest adventure ever!"
Local varMessage:String = "blah-blah My score is %%. Can you do better?"

varMessage = varMessage.Replace( "%%", bestResult )

Local URL:String = "https://www.facebook.com/dialog/feed?app_id="+fbAppID+"&amp;link="+fbAppURL+"&amp;picture="+fbAppLogo+"&amp;name="+ varAppName + "&amp;caption="+varCaption+"&amp;description="+varMessage+"&amp;redirect_uri="+ fbAppURL+"&amp;display=popup"

URL = URL.Replace(" ", "%20")

OpenUrl(URL)
</pre><br>* fbAppLogo. You have to upload the pic to your site. Can't get fb standard pic to work =( <br><br></td></tr></table><br>
<a name="2095866"></a>

<a name="2095872"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Alex</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> 1. Login permissions changed. (You have to do it <b>2</b> times in the code, be careful.)<br><pre class=code>
NSArray *permissions = [[NSArray alloc] initWithObjects:
                            @"email",
                            @"public_profile",
                            @"user_friends",
                            nil];
</pre><br><br>2. Function <b>mFBFetchFriendsAsync</b>:<br>Replaced hardcoded variable <b>theAppID</b>.<br>Changed the way the function get friends count.<br><pre class=code>
void mFBFetchFriendsAsync(String theAppID){
    
    isFetchFriendsRunning = YES;
    fetchFriendsResult = -1;
    
    [FBRequestConnection startForMyFriendsWithCompletionHandler:^(FBRequestConnection *connection, id result, NSError   *error) {
     
     NSArray* fetchedFriendData;
     
     if (!error &amp;&amp; result)
     {
     
     fetchedFriendData = [[NSArray alloc] initWithArray:[result objectForKey:@"data"]];
     
     NSLog(@"Total friends: %i",fetchedFriendData.count);
     //friendsCount = fetchedFriendData.count;
     
     
     
     NSMutableDictionary* params =   [NSMutableDictionary dictionaryWithObjectsAndKeys:
                                      [NSString stringWithFormat:@"%d", 100], @"score",
                                      nil];
     
     
     // NSString *appID = @"1385349258404782";
     NSString *appID = theAppID.ToNSString();
     
     [FBRequestConnection startWithGraphPath:[NSString stringWithFormat:@"%@/scores", appID] parameters:params HTTPMethod:@"GET" completionHandler:^(FBRequestConnection *connection, id result, NSError *error){
      
      friendNum = 0;
      
      isFetchFriendsRunning = NO;
      fetchFriendsResult = 0;
      
      int frCnt = [[result objectForKey:@"data"] count];
      
      for (int i=0;i&lt;frCnt;i++){
      
      NSObject * friendUser = [[[result objectForKey:@"data"] objectAtIndex:i] objectForKey:@"user" ];
      NSString * friendName = [friendUser valueForKey:@"name"];
      NSString * friendId = [friendUser valueForKey:@"id"];
      
      int friendScore = [[[[result objectForKey:@"data"] objectAtIndex:i] objectForKey:@"score"] integerValue];
      
      //NSLog(@"Score of %c is %i", friendName, friendScore);
      
      friendsNames[friendNum] = friendName;
      friendsIDs[friendNum] = friendId;
      friendsScore[friendNum] = friendScore;
      
      friendNum += 1;
      friendsCount = friendNum;
      
      }
      
      }];
     
     }else{
     
     isFetchFriendsRunning = NO;
     fetchFriendsResult = 1;
     
     }
     
     }];
    
    
}
</pre> <br><br></td></tr></table><br>
<a name="2095870"></a>

<a name="2095867"></a>

<a name="2095869"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raul</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Alex,<br><br>This is the first time when I try using facebook into my apps so:<br>- already downloaded the lastest SDK from facebook developer page - DONE<br>- Drag FacebookSDK.framework to my project (Copy to project option UNCHECKED! Don't know if this is important.) - DONE<br>- copy the example from your post - DONE<br><br>tried to compile, receive the error posted by me. <br><br></td></tr></table><br>
<a name="2095871"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Alex</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Can you please, show the full log?<br>Where is the error in code?<br><br>You can go to your xCode project. And look for the trouble there. Your error will be marked as red there. <br><br></td></tr></table><br>
<a name="2095873"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raul</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> the error is from Ted.<br><br>I cannot compile to xcode:<br><br><pre class=code>
"/MonkeyXPro79e/bin/transcc_macos" -target=iOS_Game -config=Debug "/Users/raulgogescu/Documents/teste/fb.monkey"
TRANS monkey compiler V1.72
Parsing...
Semanting...
Translating...
Building...
Build settings from command line:
    SDKROOT = iphonesimulator8.1

=== BUILD TARGET MonkeyGame OF PROJECT MonkeyGame WITH CONFIGURATION Debug ===

Check dependencies
2014-11-14 17:34:30.778 xcodebuild[3433:40641]  DeveloperPortal: Using pre-existing current store at URL (file:///Users/raulgogescu/Library/Developer/Xcode/DeveloperPortal%206.1.db).

CpResource data build/Debug-iphonesimulator/MonkeyGame.app/data
    cd /Users/raulgogescu/Documents/teste/fb.buildv79e/ios
    export PATH="/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneSimulator.platform/Developer/usr/bin:/Applications/Xcode.app/Contents/Developer/usr/bin:/usr/bin:/bin:/usr/sbin:/sbin"
    builtin-copy -exclude .DS_Store -exclude CVS -exclude .svn -exclude .git -exclude .hg -resolve-src-symlinks /Users/raulgogescu/Documents/teste/fb.buildv79e/ios/data /Users/raulgogescu/Documents/teste/fb.buildv79e/ios/build/Debug-iphonesimulator/MonkeyGame.app

CompileC build/MonkeyGame.build/Debug-iphonesimulator/MonkeyGame.build/Objects-normal/i386/main.o main.mm normal i386 objective-c++ com.apple.compilers.llvm.clang.1_0.compiler
    cd /Users/raulgogescu/Documents/teste/fb.buildv79e/ios
    export LANG=en_US.US-ASCII
    export PATH="/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneSimulator.platform/Developer/usr/bin:/Applications/Xcode.app/Contents/Developer/usr/bin:/usr/bin:/bin:/usr/sbin:/sbin"
    /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang -x objective-c++ -arch i386 -fmessage-length=0 -fdiagnostics-show-note-include-stack -fmacro-backtrace-limit=0 -Wno-trigraphs -fpascal-strings -O0 -Wno-missing-field-initializers -Wno-missing-prototypes -Wno-implicit-atomic-properties -Wno-receiver-is-weak -Wno-arc-repeated-use-of-weak -Wno-non-virtual-dtor -Wno-overloaded-virtual -Wno-exit-time-destructors -Wno-missing-braces -Wparentheses -Wswitch -Wno-unused-function -Wno-unused-label -Wno-unused-parameter -Wunused-variable -Wunused-value -Wno-empty-body -Wno-uninitialized -Wno-unknown-pragmas -Wno-shadow -Wno-four-char-constants -Wno-conversion -Wno-constant-conversion -Wno-int-conversion -Wno-bool-conversion -Wno-enum-conversion -Wno-shorten-64-to-32 -Wno-newline-eof -Wno-selector -Wno-strict-selector-match -Wno-undeclared-selector -Wno-deprecated-implementations -Wno-c++11-extensions -isysroot /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator8.1.sdk -fexceptions -fasm-blocks -fstrict-aliasing -Wprotocol -Wdeprecated-declarations -Winvalid-offsetof -g -fvisibility=hidden -fvisibility-inlines-hidden -Wno-sign-conversion -fobjc-abi-version=2 -fobjc-legacy-dispatch -mios-simulator-version-min=4.3 -iquote /Users/raulgogescu/Documents/teste/fb.buildv79e/ios/build/MonkeyGame.build/Debug-iphonesimulator/MonkeyGame.build/MonkeyGame-generated-files.hmap -I/Users/raulgogescu/Documents/teste/fb.buildv79e/ios/build/MonkeyGame.build/Debug-iphonesimulator/MonkeyGame.build/MonkeyGame-own-target-headers.hmap -I/Users/raulgogescu/Documents/teste/fb.buildv79e/ios/build/MonkeyGame.build/Debug-iphonesimulator/MonkeyGame.build/MonkeyGame-all-target-headers.hmap -iquote /Users/raulgogescu/Documents/teste/fb.buildv79e/ios/build/MonkeyGame.build/Debug-iphonesimulator/MonkeyGame.build/MonkeyGame-project-headers.hmap -I/Users/raulgogescu/Documents/teste/fb.buildv79e/ios/build/Debug-iphonesimulator/include -Ilibs -I/Users/raulgogescu/Documents/teste/fb.buildv79e/ios/build/MonkeyGame.build/Debug-iphonesimulator/MonkeyGame.build/DerivedSources/i386 -I/Users/raulgogescu/Documents/teste/fb.buildv79e/ios/build/MonkeyGame.build/Debug-iphonesimulator/MonkeyGame.build/DerivedSources -F/Users/raulgogescu/Documents/teste/fb.buildv79e/ios/build/Debug-iphonesimulator -include /var/folders/9h/s149kt_533xcr_hw7_p9nwdc0000gn/C/com.apple.DeveloperTools/6.1-6A1052d/Xcode/SharedPrecompiledHeaders/MonkeyGame_Prefix-ftjxddvuucynplhihsewwuatavwq/MonkeyGame_Prefix.pch -MMD -MT dependencies -MF /Users/raulgogescu/Documents/teste/fb.buildv79e/ios/build/MonkeyGame.build/Debug-iphonesimulator/MonkeyGame.build/Objects-normal/i386/main.d --serialize-diagnostics /Users/raulgogescu/Documents/teste/fb.buildv79e/ios/build/MonkeyGame.build/Debug-iphonesimulator/MonkeyGame.build/Objects-normal/i386/main.dia -c /Users/raulgogescu/Documents/teste/fb.buildv79e/ios/main.mm -o /Users/raulgogescu/Documents/teste/fb.buildv79e/ios/build/MonkeyGame.build/Debug-iphonesimulator/MonkeyGame.build/Objects-normal/i386/main.o
/Users/raulgogescu/Documents/teste/fb.buildv79e/ios/main.mm:4302:9: fatal error: 'FacebookSDK/FacebookSDK.h' file not found
#import &lt;FacebookSDK/FacebookSDK.h&gt;
        ^
1 error generated.

** BUILD FAILED **


The following build commands failed:
TRANS FAILED: Error executing 'xcodebuild -configuration Debug -sdk iphonesimulator', return code=16640
	CompileC build/MonkeyGame.build/Debug-iphonesimulator/MonkeyGame.build/Objects-normal/i386/main.o main.mm normal i386 objective-c++ com.apple.compilers.llvm.clang.1_0.compiler
(1 failure)
Done.
</pre> <br><br></td></tr></table><br>
<a name="2095874"></a>

<a name="2095875"></a>

<a name="2095876"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Alex</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can look at your xCode project anyway, even with errors in Ted.<br>Here's the path to it:<br><b>/Users/raulgogescu/Documents/teste/fb.buildv79e/ios/</b><br>Open MonkeyGame.xcodeproj there.<br>Do you see this?<br><img src="https://dl.dropboxusercontent.com/u/71223199/articles/scr1.png"><br><br>Also, there shouldn't be any *red-marked* frameworks. If so, left-click on it and choose Delete. <br><br></td></tr></table><br>
<a name="2095877"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raul</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> yeah, jsut wanted to wrote it down.<br><br>so, i opened the xcode project, and tried now to compile after added the FB SDK. Find this error now in xcode:<br><br>/Users/raulgogescu/Desktop/exoRail cu fb/exorail.buildv79e/ios/main.mm:5203:24: Assignment to readonly property<br><br>and this is the code:<br><pre class=code>
    params.description = [NSString stringWithFormat:@"%@%i%@ ", gamePhrase1, nScore, gamePhrase2];
</pre> <br><br></td></tr></table><br>
<a name="2095878"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Alex</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> Comment it!<br>This is not the latest version of fbMonkey. <br><br></td></tr></table><br>
<a name="2095881"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raul</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> I took the version from your dropbox folder.<br><br> Anyway, commented that line code, added the appid in the plist and compiled. The app stared and now I receive in the debug: MonkeyGame[3671:49460] Facebook: opening new session.<br><br>I am in the emulator right now. I assume the process will work fine on the device.<br><br>Question:<br>You said for sharing you are using:<br><pre class=code>
Local URL:String = "https://www.facebook.com/dialog/feed?app_id="+fbAppID+"&amp;link="+fbAppURL+"&amp;picture="+fbAppLogo+"&amp;name="+ varAppName + "&amp;caption="+varCaption+"&amp;description="+varMessage+"&amp;redirect_uri="+ fbAppURL+"&amp;display=popup"
</pre><br> fbAppLogo should be an image from my site, but fbAppURL must be from FB right? How do I get it? <br><br></td></tr></table><br>
<a name="2095890"></a>

<a name="2095891"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raul</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> tested on a real device:<br><br>I tried the login feature:<br><pre class=code>
2014-11-14 19:00:02.007 railcartrace[1158:391493] Login button pressed.
Logging...
2014-11-14 19:00:02.059 railcartrace[1158:391493] Login button pressed.
2014-11-14 19:00:02.102 railcartrace[1158:391493] Facebook: session created.
2014-11-14 19:00:12.127 railcartrace[1158:391493] Getting login result...
1
2
Login is about to finish...
FBLoginComplete, result=1
Failed to Login or Canceled
Login Cancelled
</pre><br><br>I setup the AppID in developers.facebook.com.<br>I enabled IOS and Single Sign On<br><br>Then I exit my game, opened FB from my telephone, log in and retest the game. I was able to launch it and login from the app.<br><br>The only question is now... how do I share something? :D <br><br></td></tr></table><br>
<a name="2095903"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Alex</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> Glad it worked! =)<br><br>If you mean to share your best score, use OpenURL like I posted earlier.<br><b>fbAppURL</b> is the URL of your app on the App Store which is:<br><a href="https://itunes.apple.com/us/app/idXXXXXXXXX" target="_blank">https://itunes.apple.com/us/app/idXXXXXXXXX</a><br>Where <b>XXXXXXXX</b> - is your Application ID from iTunes Connect.<br><br>If you mean to share the score with friends and see their score, please, see my tutorial at #11th post of this topic.<br>If you will have any questions, write them here!<br><br>Good luck! <br><br></td></tr></table><br>
<a name="2095916"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raul</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> No. :))<br><br>a lot of issues here:<br>1. If I am trying to run my app from xcode with the phone connected will always crash when trying to login:<br><pre class=code>
railcartrace[1309:422104] Getting login result...
1
2
Login is about to finish...
FBLoginComplete, result=1
Failed to Login or Canceled
Login Cancelled
Logging...
2014-11-15 02:47:55.041 railcartrace[1309:422104] Login button pressed.
2014-11-15 02:47:55.057 railcartrace[1309:422104] Facebook: session created.
(lldb) 
</pre><br><br>those are the last lines I receive in debug console. the phone screen turns black and nothing is happening.<br><br><pre class=code>
int main( int argc,char *argv[] ){

	NSAutoreleasePool *pool=[[NSAutoreleasePool alloc] init];
	
    UIApplicationMain( argc,argv,nil,nil );
    
    [pool release];
	
	return 0;
}
</pre><br><br>2. If I am running my game from the phone, i was able to login ( as i said earlier) the problem is that when I want to 'share' something using the OpenURL:<br>The game is switching to FB for a few 1 second, than back to menu. Nothing else is happening.<br><br>Any thoughts? Can you please explain more about how to make this work? I mention that I also enabled this: Do you want to make this app and all its live features available to the general public?<br><br>THanks, <br><br></td></tr></table><br>
<a name="2095937"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Alex</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> 2. For OpenUrl issue.<br>Forgot to mention, you have to make Facebook own the URL.<br>Go to Facebook dashboard -&gt; Settings -&gt; Add platform -&gt; Web<br>and paste your <b>fbAppURL</b> to both lines.<br><br>1. I spend a lot of time having the same issue =)<br>Maybe the project is configured wrong.<br>Maybe you don't create a new session.<br>Do you use FBAtResume()? <br><br></td></tr></table><br>
<a name="2095939"></a>

<a name="2095940"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raul</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> Alex, I appreciate you are trying to help me. I dont think we are gonna solve this :))<br><br>So, lets start from over:<br>- I made the app on facebook and assigned the Web and iOS app: <img src="http://rvlgames.com/facebook1.png"><br>- From some reason, during the tests these days the app managed to appears in my FaceBook profile list in Settings -&gt; Apps<br><br>In Monkey code, just to for testing I made a button that, when is pressed does this:<br><br><pre class=code>
If Not isLoggedIn
     Print "no login, trying to login to fb"     

     monkeyFB.Login()
 
     Print "login finished"
End

If isLoggedIn
     Print "trying to share"
     shareOnFB()
     Print "share finished"
Endif
</pre><br><br>I am running the game from xcode and wathc the debug console.<br>After the app is started I press the FB button. This is what I receive in xcode debug:<br><pre class=code>
no login, trying to login to fb
Logging...
2014-11-16 03:09:42.003 railcartrace[1485:475727] Login button pressed.
login finished

no login, trying to login to fb
Logging...
2014-11-16 03:09:42.122 railcartrace[1485:475727] Login button pressed.
2014-11-16 03:09:42.148 railcartrace[1485:475727] Facebook: session created.
login finished

2014-11-16 03:09:52.175 railcartrace[1485:475727] Getting login result...
1
2
Login is about to finish...
FBLoginComplete, result=1
Failed to Login or Canceled
Login Cancelled
2014-11-16 03:09:52.176 railcartrace[1485:475727] Getting login result...
1
2
Login is about to finish...
FBLoginComplete, result=1
Failed to Login or Canceled
Login Cancelled

no login, trying to login to fb
Logging...
2014-11-16 03:09:52.177 railcartrace[1485:475727] Login button pressed.
2014-11-16 03:09:52.223 railcartrace[1485:475727] Facebook: session created.
login finished

2014-11-16 03:09:53.008 railcartrace[1485:475727] Getting login result...
1
2
Login is about to finish...
FBLoginComplete, result=1
Failed to Login or Canceled
Login Cancelled

no login, trying to login to fb
Logging...
2014-11-16 03:09:53.008 railcartrace[1485:475727] Login button pressed.
2014-11-16 03:09:53.026 railcartrace[1485:475727] Facebook: session created.
login finished

(lldb) 
</pre><br><br>and is crashing:<br><pre class=code>
argv	char **	0x16fde79c8	0x000000016fde79c8
argc	int	1	1
pool	NSAutoreleasePool *	0x17405eed0	0x000000017405eed0
</pre><br><br>it seams that from some reason, it cannot continue and is crashing :(<br>FBLoginComplete, result=1<br>Failed to Login or Canceled<br><br>But in the log I see that there is a session created message and after that.. another fail..<br><br>If I am running the app from the phone (and not from xcode), as I said earlier is just going to FB for a second, than the screen is turning black and comes into the game..<br><br>I added the FBAtResume() in OnResume() <br><br></td></tr></table><br>
<a name="2095947"></a>

<a name="2095948"></a>

<a name="2095949"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Alex</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> You did not mention <b>monkeyFB.OpenNewSession()</b> in OnCreate() method. You should call it! <br><br></td></tr></table><br>
<a name="2095950"></a>

<a name="2095951"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Alex</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> If this was all you did, you should also do this:<br><a href="https://www.dropbox.com/s/s87koykptzqvjoq/Screenshot%202014-11-16%2018.28.24.png?dl=0" target="_blank">https://www.dropbox.com/s/s87koykptzqvjoq/Screenshot%202014-11-16%2018.28.24.png?dl=0</a><br><br>Taken from here:<br><a href="https://developers.facebook.com/docs/ios/getting-started" target="_blank">https://developers.facebook.com/docs/ios/getting-started</a> <br><br></td></tr></table><br>
<a name="2095952"></a>

<a name="2095953"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raul</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Alex: regarding monkeyFB.OpenNewSession() I though this is visible from the logs. I call it at the start of OnCreate()<br><br>also I update the plist file (mention in a post earlier). <br><br></td></tr></table><br>
<a name="2095973"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raul</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#32">[#32]</a></td></tr></table></td></tr><tr ><td class="posttext"> Alex, do you have a small example that you are 100% sure is working? I could try comparing the code with mine.. <br><br></td></tr></table><br>
<a name="2095981"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Alex</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#33">[#33]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, I should make one! I'll post it here! <br><br></td></tr></table><br>
<a name="2095988"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Alex</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#34">[#34]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here's the xCode project.<br><a href="https://dl.dropboxusercontent.com/u/71223199/temp/ios.zip" target="_blank">https://dl.dropboxusercontent.com/u/71223199/temp/ios.zip</a><br><br>See the log.<br>If you add me as a friend on fb, there will be two of us in the leadearboard and I will know you have succeeded! =)<br><br>Here's the full monkey code that works:<br><pre class=code>
Import fbMonkey
Import brl

Global friendsNames:String[]
Global friendsIDs:String[]
Global friendsScore:Int[]
Global friendsAvas:Image[], noAva:Image

Global friendsIDsOld:String[]

Global fbYourPlace:Int, LoginFlowActive:Bool, loadingFBLeaderboardData:Bool

Global isLeaderboardFetched:Bool

Global sendingScoreFlow:Bool, lastPosted:Int, fbAppID:String

'Global isFBLoggedIn:Bool

Global monkeyFB := New MonkeyFacebook

Class MonkeyFacebook Implements IOnFBLoginComplete, IOnFBFetchComplete, IOnFBFetchFriendsComplete, IOnFBOpenNewSessionComplete, IOnFBSendScoreComplete, IOnFBShareComplete
	
	Field openNewSession:MonkeyOpenNewSessionFB
	Field login:MonkeyLoginFB
	Field fetch:MonkeyFetchFB
	Field fetchFriends:MonkeyFetchFriendsFB
	Field share:MonkeyShareFB
	Field sendScore:MonkeySendScoreFB

	Method InitAll:Void()

		#If TARGET = "ios"
			FBStart()
		#End

	End

	Method LoginInit:Void()

	End

	Method OpenNewSession:Void()

		openNewSession = New MonkeyOpenNewSessionFB
		openNewSession.FBOpenNewSessionAcync(Self)
		'OpenFlowActive = True

	End

	Method Login:Void()

		login = New MonkeyLoginFB
		login.FBLoginAsync(Self)
		LoginFlowActive = True

	End

	Method Fetch:Void()

		fetch = New MonkeyFetchFB
		fetch.FBFetchAsync(Self)

	End

	Method FetchFriends:Void()

		fetchFriends = New MonkeyFetchFriendsFB

		fetchFriends.FBFetchFriendsAsync(fbAppID, Self)

		isLeaderboardFetched = False

	End

	Method SendScore:Void(theScore:Int)

		sendScore = New MonkeySendScoreFB
		sendScore.FBSendScoreAsync(Self, theScore)
		sendingScoreFlow = True
		isLeaderboardFetched = False

	End

	Method Share:Void(theScore:Int, theName:String, theCaption:String, theLink:String, thePicLink:String, thePhrase1:String, thePhrase2:String)

		share = New MonkeyShareFB
		share.FBShareAsync(Self, theScore, theName, theCaption, theLink, thePicLink, thePhrase1, thePhrase2)

	End

	Method OnFBOpenNewSessionComplete:Void( result:Int ) '-1 - failed, 0 - success, 1 - cancelled'

		Print "OnFBOpenNewSessionComplete, result=" + result

		If result&lt;&gt;0 
			Print "Failed to Open New Session"
			login=Null
			LoginFlowActive = False
		Endif

		If result = 1

			LoginFlowActive = False
			Print "New Session Failed To Open"

		End

		If result = 0

			Self.Fetch()

		End

	End

	Method OnFBLoginComplete:Void( result:Int ) '-1 - failed, 0 - success, 1 - cancelled'

		Print "FBLoginComplete, result=" + result

		If result&lt;&gt;0 
			Print "Failed to Login or Canceled"
			login=Null
			LoginFlowActive = False
		Endif

		If result = 1

			Print "Login Cancelled"
			Self.LoginInit()
			LoginFlowActive = False

		End

		If result = 0

			Self.Fetch()

		End

	End

	Method OnFBFetchComplete:Void( result:Int ) '-1 - failed, 0 - success, 1 - cancelled'

		Print "FBFetchComplete, result=" + result

		If result&lt;&gt;0 
			Print "Failed to Fetch"
			fetch=Null
			LoginFlowActive = False
		Endif

		If result = 1

			Print "Fetch Cancelled"
			LoginFlowActive = False

		End

		If result = 0

			Print fbUserName
			Print fbUserID

			Self.FetchFriends()

			'ClearLeaderboardData()

		End

	End

	Method OnFBFetchFriendsComplete:Void( result:Int ) '-1 - failed, 0 - success, 1 - cancelled'

		Print "FBFetchFriendsComplete, result=" + result

		If result&lt;&gt;0 
			Print "Failed to FetchFriends"
			fetchFriends=Null
		Endif

		If result = 1

			Print "FetchFriends Cancelled"

		End

		If result = 0

			Print "Friends Fetched"

			friendsNames = friendsNames.Resize(friendsCount)
			friendsIDs = friendsIDs.Resize(friendsCount)
			friendsScore = friendsScore.Resize(friendsCount)

			friendsAvas = friendsAvas.Resize(friendsCount)

			friendsIDsOld = friendsIDsOld.Resize(friendsCount)

			For Local fr:Int = 0 Until friendsCount

				friendsNames[fr] = GetFriendName(fr)

				For Local frn$=Eachin friendsNames[fr].Split( " " )

					friendsNames[fr] = frn
					Exit
					
				Next

				If friendsNames[fr].Length() &gt; 13

					friendsNames[fr] = friendsNames[fr][..10] + "..."

				End

				friendsIDs[fr] = GetFriendID(fr)

				friendsScore[fr] = GetFriendScore(fr)

				Print friendsIDs[fr]
				Print friendsNames[fr] + " score:" + friendsScore[fr]

				If friendsIDsOld[fr] &lt;&gt; friendsIDs[fr] Or friendsAvas[fr].Width() = 48 * Retina 'for noAvaImage'

					friendsAvas[fr] = noAva
					imageLoad.LoadFBAvaAsync(fr)
					Print "Image updating..."
					Print ""

				Else

					Print "No need to load a new image"

				End

				friendsIDsOld[fr] = friendsIDs[fr]

				If friendsIDs[fr] = fbUserID

					fbYourPlace = fr
					If friendsScore[fr] &gt; bestResult
						bestResult = friendsScore[fr]
					Else
						lastPosted = friendsScore[fr]
					End

				End

			End

		End

		isLeaderboardFetched = True

		LoginFlowActive = False

	End

	Method OnFBSendScoreComplete:Void( result:Int ) '-1 - failed, 0 - success, 1 - cancelled'

		Print "FBSendScoreComplete, result=" + result

		If result&lt;&gt;0 
			Print "Failed to Send Score"
			sendScore=Null
		Endif

		If result = 1

			Print "SendScore Cancelled"

		End

		If result = 0

			Print "Score sent" + sendScore.scoreSent
			lastPosted = sendScore.scoreSent
			'SaveGame()
			Print "the last posted: " + lastPosted
			sendingScoreFlow = False
			monkeyFB.FetchFriends()

		End

	End

	Method OnFBShareComplete:Void( result:Int ) '-1 - failed, 0 - success, 1 - cancelled'

		Print "FBShareComplete, result=" + result

		If result&lt;&gt;0 
			Print "Failed to Share"
			sendScore=Null
		Endif

		If result = 1

			Print "Share Cancelled"

		End

		If result = 0

			Print "Shared!"

			'window.Init(["menu/yes"], text[71], text[72])

		End

	End

	Method Deinit:Void()



	End

End

Global imageLoad := New ImageLoadClass

Class ImageLoadClass Implements IOnLoadImageComplete

	Method LoadFBAvaAsync:Void(num:Int)
		Local avasize:Int = 50 * Retina
		LoadImageAsync(	"https://graph.facebook.com/" + friendsIDs[num] + "/picture?width=" + avasize + "&amp;height=" + avasize, 
						1, 
						Image.MidHandle, 
						Self)
	End
	
	Method OnLoadImageComplete:Void( img:Image, path:String, source:IAsyncEventSource )
		If img
			Print "Image Loaded!"
			For Local fr:Int = 0 Until friendsCount
				If path.Contains(friendsIDs[fr])
					friendsAvas[fr] = img
				End
			End
		Else
			Print "Error loading image async"
		End
	End
End

'END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART'
'END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART'
'END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART'
'END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART'
'END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART'
'END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART'
'END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART'
'END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART'
'END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART'
'END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART'
'END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART'
'END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART'
'END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART'
'END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART''END FB PART'

Global Retina, bestResult:Int

Class GameGW Extends App
	
	Method OnCreate()
	
		monkeyFB.OpenNewSession()

		Retina = 2 'calculate as you always do
		bestResult = Rnd(100)' your score you will post to leaderboard

		noAva = LoadImage("noAva.png") 'must be 48px for update code to work'

		fbAppID = "552474708216230"

	End
	
	Method OnUpdate()

		UpdateAsyncEvents()

		If LoginFlowActive
			Return
		End

		If TouchHit() And TouchX() &lt; DeviceWidth() * .2 And TouchY() &lt; DeviceHeight() * .2

			If isIntenetConnected
				If isLoggedIn
					monkeyFB.SendScore( bestResult )
					bestResult += 1
				Else
					monkeyFB.Login()
				End
			End

		End

		
	End
	
	Method OnRender()

		DrawRect(0,0, DeviceWidth() * .2, DeviceHeight() * .2)
		If Not isLoggedIn
			DrawText("Login", 10, 10)
		Else
			DrawText("Share" + bestResult + " points", 10, 10)
		End

		For Local fr := 0 Until friendsCount

			DrawImage(friendsAvas[fr], DeviceWidth() * .21, DeviceHeight() * .3 + 20 * fr, 0, .4, .4)
			DrawText(friendsNames[fr], DeviceWidth() * .3, DeviceHeight() * .3 + 20 * fr)
			DrawText(friendsScore[fr], DeviceWidth() * .5, DeviceHeight() * .3 + 20 * fr)

		End

	End

	Method OnSuspend()

		isIntenetConnected()

	End

	Method OnResume()

		isIntenetConnected()
		FBAtResume()

	End

End

Function Main:Int()
        New GameGW
End

'This Is Fake, see my first posts on this'
Function isIntenetConnected:Bool()
	Return True
End
</pre> <br><br></td></tr></table><br>
<a name="2095990"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raul</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#35">[#35]</a></td></tr></table></td></tr><tr ><td class="posttext"> with the help of Alex I managed to achieve what I wanted. thank you again man.<br><br>this is one module which is a must for every mobile game these days. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
