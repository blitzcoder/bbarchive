<!DOCTYPE html><html lang="en" ><head ><title >In App Purchase module :)</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >In App Purchase module :)</h1><a href="forums.php" >Monkey Targets Forums</a>/<a href="topics.php?forum=505" >iOS</a>/<a href="#bottom" >In App Purchase module :)</a><br><br>
<a name="2010828"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >anawiki</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi all,<br>I finally made it :) The code for making in app purchases on appstore is working. It's surprising how much time one can waste getting such thing to work.<br><br>Let me just put some docs into the mod and I'll upload it somewhere for you all. <br><br>cheers<br>Roman <br><br></td></tr></table><br>
<a name="2010832"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Uncle</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sounds great :)  Will be useful to many Im sure. <br><br></td></tr></table><br>
<a name="2010864"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >NoOdle</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ohh this is awesome news, good job! :) <br><br></td></tr></table><br>
<a name="2010885"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Aman</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Great news. Can't wait to check it out <br><br></td></tr></table><br>
<a name="2010887"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xlsior</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Cool...<br><br>Just one word of warning though: Lodsys has been sueing several (small bit) app makers for adding this functionality to their programs, because they claim it violates one of their patents.<br>More info: <a href="http://news.cnet.com/8301-27076_3-20063253-248.html" target="_blank">http://news.cnet.com/8301-27076_3-20063253-248.html</a> <br><br></td></tr></table><br>
<a name="2010891"></a>

<a name="2010892"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MikeHart</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> And Apple dealed with Lodsys because IOS devs (if they use Apples API) are covered by Apples license of these patents. <br><br></td></tr></table><br>
<a name="2010978"></a>

<a name="2010979"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >pantson</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> are you sure Mike?<br>Rovio now added to the list of patent infringers by Lodsys<br><a href="http://fosspatents.blogspot.com/2011/07/lodsys-sues-rovio-over-angry-birds-for.html" target="_blank">http://fosspatents.blogspot.com/2011/07/lodsys-sues-rovio-over-angry-birds-for.html</a><br>Looks like they are also going after Android platform too... <br><br>its a dangerous world out there. <br><br></td></tr></table><br>
<a name="2010980"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MikeHart</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> You're right. It is more than ever very risky to add these features. Hell, even without stuff like that, you will never know which patent you are already codig against or even if someone will patent something tommorow that will bring you trouble. <br><br>Today I saw someone posting on twitter that it is the best not to publish into markets anymore, where patent you can patent software mechanics. Software patents are evil. EVIL!!! Apple might want to protect you, but Google stays quite. And even if they want, no on  knows if they will be successful. I read alot today and so far I get the feeling that it is the best to pull my application from the net and quit developing software. Because there will be ALWAYS a patent that you would need to get a license for. And how to find out which ones you need? Impossible. <br><br></td></tr></table><br>
<a name="2010982"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >pantson</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I fully disagree with patents that have no invention..<br>just because I draw a car and then the ground a meter beneath it, doesn't mean I own the patent for flying cars.<br><br>I agree that software patents are EVIL<br><br>On the original point..<br>great work anawiki<br>Sorry for hijacking this thread.<br><br>conversation moved to <a href="http://www.monkeycoder.co.nz/Community/posts.php?topic=1233" target="_blank">http://www.monkeycoder.co.nz/Community/posts.php?topic=1233</a> <br><br></td></tr></table><br>
<a name="2010983"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >anawiki</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> One of the top USA publishers taught me a lesson that comes down to this: if you're not in the USA we can do nothing to you. I believe the same will apply here.<br><br>It sucks for what they do. <br><br></td></tr></table><br>
<a name="2010991"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xzess</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> indeed! <br><br></td></tr></table><br>
<a name="2011005"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Aman</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> @anawiki<br><br>Sorry man. Looks like that's not the case with this company. They sued Illusion Labs AB of Malmö, Sweden for their game Labyrinth on both android and iPhone. Wulven Games of Hanoi, Vietnam is also accused of infringement of Lodsys's patents with at least Shadow Era for iPhone.<br><br>If you are not in USA, the least they can do is prevent you from distributing your apps and games in countries where their patent is effective. That include at least North America and most of Europe which is nearly 90% of your targeted markets.<br><br>You have two choices: play safe or try your luck. The more your apps and games get successful the less luck you have. <br><br></td></tr></table><br>
<a name="2015691"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Soap</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> So despite all this, I'm working on implementing this. My question is on implementation. After purchasing, what's the best way to check to see if the purchase when through? Right now the only thing that I can think of is to use a timer to reload the InitInAppPurchases() function then to call isProductPurchased() <br><br></td></tr></table><br>
<a name="2015694"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MikeHart</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> I would let the user decide and implement its own logic. Just have InitInAppPurchases() and isPrductPurchased available for the user. <br><br></td></tr></table><br>
<a name="2015731"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Soap</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is what I'm talking about the best/only method? <br><br></td></tr></table><br>
<a name="2015905"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Soap</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ugh, for some reason it crashes when I try to implement it. I've added this function:<br>String getFailedTransactionError(void) {<br>	return String(failedTransactionError);<br>}<br>But I'm pretty sure this wouldn't cause it to crash. failedTransactionError is a string that I use to check the progress. I don't think that this would cause it to crash. Testing it with a sandbox account it crashed after pressing the button to verify the payment info.<br>After that it says, "You've already purchased this In-App Purchase but it hasn't been downloaded. [Environment Sandbox]"<br>Any thoughts? <br><br></td></tr></table><br>
<a name="2016004"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Soap</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> I found the problem. This is what I've had to do to get it working.<br>- (void) completeTransaction: (SKPaymentTransaction *)transaction<br>{		<br>	<br>	//[[MKStoreManager sharedManager] provideContent:transaction.payment.productIdentifier <br>	//									forReceipt:transaction.transactionReceipt];	<br>	<br>	[[SKPaymentQueue defaultQueue] finishTransaction: transaction];	<br>} <br><br></td></tr></table><br>
<a name="2016033"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MikeHart</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> I am glad you keep working on it. <br><br></td></tr></table><br>
<a name="2016059"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Soap</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> NSException raise:format:arguments:] + 62<br>[NSException raise:format:] + 28<br>[NSString substringFromIndex:] + 86<br>According to this, there's a problem with the way the NSString is formated. I haven't worked with Objective C before so I don't know how to fix it.<br><br>I wonder however, if this problem comes from itunes connect. I haven't submitted a binary but submitting the IAP to open it up. I think my app was rejected. I'll have to see about that but I wonder if not receiving a proper receipt would cause it to crash. <br><br></td></tr></table><br>
<a name="2016341"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dabz</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> Would be great to this working, keep going! :)<br><br>Dabz <br><br></td></tr></table><br>
<a name="2016475"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >anawiki</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm getting back to working on this module again. I regret that I got a brake. It seemed to work fine 2 months ago, now I have to find out the reasons what's wrong again :( <br><br></td></tr></table><br>
<a name="2016479"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >anawiki</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh, iOS seems to be a bit like Windows when it comes to IAP. Reinstalling your app helps to solve issues. I lost one day trying to figure out why my IAP are returning invalid ID's, just to find out that after deleting app from iPad and reinstalling it through xcode solved this issue. <br><br>Don't you love this... :D <br><br></td></tr></table><br>
<a name="2016480"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dabz</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh, so it is working, is there a guide/code or anything laid about for me to peek at, as I'm now 100% committed to going this route on iOS with my new game! :)<br><br>Dabz <br><br></td></tr></table><br>
<a name="2016483"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >anawiki</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm making some changes to this module. While it's triggering purchase functions it fails to check "isProductPurchased" as Soap already found out. It looks like I found a solution, but before I upload new code I want to give it a bit more testing. I would just have to answer all those support emails, and believe me, IAP causes a lot of support issues (just check on net how many people struggle with IAP). <br><br></td></tr></table><br>
<a name="2016549"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dabz</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> Rightio... But, when you've sussed it, any chance you can throw a linky up! :)<br><br>Dabz <br><br></td></tr></table><br>
<a name="2017156"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >anawiki</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here's the latest version of IAP module. I tested it and it works with both consumables and non consumables. Make sure to set up everything in iTunes correctly and copy it to your code without mistakes.<br><br><a href="http://innotech.pl/anawiki/4people/iap.zip" target="_blank">http://innotech.pl/anawiki/4people/iap.zip</a><br><br>You need to init app store first like that:<br><br>InitInAppPurchases("com.mycompany.bundleid.", ["com.mycompany.bundleid.prod1", "com.mycompany.bundleid.prod2"])<br><br><br>and then you can call buyProduct("com.mycompany.bundleid.prod1")<br><br>and check if it was purchased with isProductPurchased("com.mycompany.bundleid.prod1")<br><br>isProductPurchased doesn't work for consumables.<br><br>There are also other functions that might be helpful for you, but I didn't have time to document them.<br><br>If you see "Problem in itunes configuration" in console, make sure your iPad is connected to internet, or try to delete app from device, clean build in xcode, make sure you have right bundleid in plist.<br><br>You are free to send me gifts, etc. ;-) <br><br></td></tr></table><br>
<a name="2017309"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dabz</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> Cor... Thanks for putting work into that, I'll have a looksy ASAP! :)<br><br>Dabz <br><br></td></tr></table><br>
<a name="2017324"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bladko</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> i think that this info about Store Kit should be written somewhere :) <br><br>it would be wise to just add StoreKit and GameKit to monkeys target template project for iOS as a standard i think<br><br>anyway great job !! <br><br></td></tr></table><br>
<a name="2018622"></a>

<a name="2018623"></a>

<a name="2018624"></a>

<a name="2018625"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Alex</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey!<br><br>Can somebody please give a simple three-line example on how to use consumables? Should I use buyProduct anyway?<br><br>Can I name my consumable product "com.mycompany.appname.productname". Product name is not numbers.<br><br>And what should I change here?<br><pre class=code>// CONFIGURATION STARTS -- Change this in your app
//#define kConsumableBaseFeatureId @"com.mycompany.myapp."
//#define kFeatureAId @"com.mycompany.myapp.featureA"
//#define kConsumableFeatureBId @"com.mycompany.myapp.005"
// consumable features should have only number as the last part of the product name
// MKStoreKit automatically keeps track of the count of your consumable product</pre><br><br>By the way, the <pre class=code>Function consumeProduct:Bool(product$, quantity)</pre> should be like <pre class=code>Function consumeProduct:Bool(product$)</pre>. Yes?<br><br>My english is not so good, so I'd appreciate your help! <br><br></td></tr></table><br>
<a name="2018632"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Spacebuddy</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> Have you started working on Game Center? :) <br><br></td></tr></table><br>
<a name="2018636"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Alex</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here's Game Center module:<br><a href="http://www.monkeycoder.co.nz/Community/posts.php?topic=1823" target="_blank">http://www.monkeycoder.co.nz/Community/posts.php?topic=1823</a><br><br>It works fine for me :) <br><br></td></tr></table><br>
<a name="2018749"></a>

<a name="2018750"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Alex</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#32">[#32]</a></td></tr></table></td></tr><tr ><td class="posttext"> And also it gves me this when I build in monkey:<br><br><pre class=code>
/main.build/ios/main.mm: In function 'void -[MKStoreObserver completeTransaction:](MKStoreObserver*, objc_selector*, SKPaymentTransaction*)':
/main.build/ios/main.mm:3754: warning: 'MKStoreManager' may not respond to '-provideContent:forReceipt:'
/main.build/ios/main.mm:3754: warning: (Messages without a matching method signature
/main.build/ios/main.mm:3754: warning: will be assumed to return 'id' and accept
/main.build/ios/main.mm:3754: warning: '...' as arguments.)
/main.build/ios/main.mm: In function 'void -[MKStoreObserver restoreTransaction:](MKStoreObserver*, objc_selector*, SKPaymentTransaction*)':
/main.build/ios/main.mm:3766: warning: 'MKStoreManager' may not respond to '-provideContent:forReceipt:'
/main.build/ios/main.mm: In function 'void -[MKStoreManager buyFeature:](MKStoreManager*, objc_selector*, NSString*)':
/main.build/ios/main.mm:3998: warning: 'MKStoreManager' may not respond to '-canCurrentDeviceUseFeature:'
/main.build/ios/main.mm:4008: warning: 'MKStoreManager' may not respond to '-enableContentForThisSession:'
/main.build/ios/main.mm: In function 'void -[MKStoreManager provideContent:forReceipt:](MKStoreManager*, objc_selector*, NSString*, NSData*)':
/main.build/ios/main.mm:4078: warning: 'MKStoreManager' may not respond to '-verifyReceipt:'
/main.build/ios/main.mm: At global scope:
/main.build/ios/main.mm:4258: warning: property 'productsList' requires method '-productsList' to be defined - use @synthesize, @dynamic or provide a method implementation
/main.build/ios/main.mm: In function 'bool consumeProduct(String)':
/main.build/ios/main.mm:4345: warning: 'MKStoreManager' may not respond to '-consumeProduct:'
</pre><br><br>Everything compiles, but doesn't work.<br><br>Maybe someone had something like this? <br><br></td></tr></table><br>
<a name="2018812"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >anawiki</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#33">[#33]</a></td></tr></table></td></tr><tr ><td class="posttext"> Warnings aren't that important, though I may fix them at some point. The mod works but you need to make sure that you init IAP with proper function and that you have your iTunes connect and other things set up correctly. If you don't, it will never give you right results. If it compiles on device, then it should display some comments, like "Product blah" or "Problem in configuration" etc.  Do you get that? <br><br></td></tr></table><br>
<a name="2018836"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Alex</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#34">[#34]</a></td></tr></table></td></tr><tr ><td class="posttext"> No, no comments.<br>Okay, warnings are unimportant, so they are not causing my trouble.<br><br>Can you please explain, how to use consumables?<br>I didn't figured out how to use functions.<br>Should my code goes like this?<br><pre class=code>

If double_btn.Pressed
	
	consumeProduct("com.company.app.001")
					
Endif

If canConsumeProduct("com.company.app.001")

	Coins = Coins * 2

EndIf

</pre><br><br>Or should I use isProductPurchased() or buyProduct() for consumables too? <br><br></td></tr></table><br>
<a name="2018893"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >anawiki</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#35">[#35]</a></td></tr></table></td></tr><tr ><td class="posttext"> You need to use buyProduct() and it will give you results similar to buying non consumables.<br><br>The version on the server has a little bug with consumables, I will upload newer version later.<br><br>Do you use InitInAppPurchases("com.company.app.", ["com.company.app.001"]) in OnCreate() in your App?<br><br>(it's possible that Init function is named different, but you know what I mean)<br><br>And it's best to start with non-comsumables. Once you get that working, you'll be able to get consumables without problems. <br><br></td></tr></table><br>
<a name="2018920"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Alex</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#36">[#36]</a></td></tr></table></td></tr><tr ><td class="posttext"> I got buyProduct() working! Thanks!<br><br>I have a button in my app that allows you to double your game coins.<br><br><pre class=code>

If double_btn.Pressed		
	
      *consumeProduct or buyProduct?*

Endif
			
If *what function to check if it was bought?*

      Coins = Coins * 2

Endif

</pre><br><br>Can you, please, write three lines example where should I use canConsumeProduct() and consumeProduct() functions? And what are they for?<br>I simply can't figure out their meaning. <br><br></td></tr></table><br>
<a name="2019111"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >anawiki</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#37">[#37]</a></td></tr></table></td></tr><tr ><td class="posttext"> I uploaded new version to the same URL:<br><br><a href="http://innotech.pl/anawiki/4people/iap.zip" target="_blank">http://innotech.pl/anawiki/4people/iap.zip</a><br><br>It has fixed a bug with consumables.<br><br>You buy consumables via buyProduct, and if it's just one unit, you can proceed with it just like with non-consumable.<br><br>If q &gt; 1 then you can use canConsumeProduct or consumeProduct function to handle consumables (but still you need to buy them first).<br><br>canConsumeProduct() checks if there are any units available (from already purchased. consumeProduct() "eats" them. <br><br></td></tr></table><br>
<a name="2019153"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Alex</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#38">[#38]</a></td></tr></table></td></tr><tr ><td class="posttext"> It works!<br><br>Thank you! =) <br><br></td></tr></table><br>
<a name="2019155"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Xaron</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#39">[#39]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm could you please provide a Monkey example?<br><br>I mean let's say I have a lite version and want to buy a full version. I guess I have to do the following?<br><br>Somewhere during onCreate?<br><pre class=code>
InitInAppPurchases( "com.mycompany.bundleid.", ["com.mycompany.bundleid.prod1"] )
</pre><br><br>After pressing the appropriate button:<br><pre class=code>
buyProduct( "com.mycompany.bundleid.prod1" )
</pre><br><br>So what then? What exactly is "prod1" here? I mean I know my com.mycompany.bundleid but that is .prod1 after that?<br><br>If I have a lite version and an extra full version how do I let him/her buy that full version? Or is it better to have the full version integrated into the lite version and just enable the features?<br><br>Thanks! <br><br></td></tr></table><br>
<a name="2019563"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Alex</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#40">[#40]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'd make a full version with restriction.<br>Create a product in iTunes connect.<br>"com.yourcompany.yourapp.fullversion" for example<br><br>In the code I'd make it like this:<br>(actually I did, instead of my code was for permanent coin doubling)<br><br><br><pre class=code>
-------main cycle

If buyfullversion_btn.Pressed		
	
	buyProduct("com.yourcompany.yourapp.fullversion")
	CheckBuy = True
	
Endif
		
If CheckBuy And isProductPurchased("com.yourcompany.yourapp.fullversion")
	
	CheckBuy = False
	
	'Code to unlock full version
	FullVersion = True
	
Endif

-------main cycle
</pre><br><br><br>Edit: Oops. just made a mistake :/ <br><br></td></tr></table><br>
<a name="2019484"></a>

<a name="2019512"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >anawiki</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#41">[#41]</a></td></tr></table></td></tr><tr ><td class="posttext"> Why do you call buyProduct 2 times in your code? <br><br></td></tr></table><br>
<a name="2019564"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Alex</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#42">[#42]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, my bad. Fixed. <br><br></td></tr></table><br>
<a name="2023109"></a>

<a name="2023110"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >siread</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#43">[#43]</a></td></tr></table></td></tr><tr ><td class="posttext"> Am I right in thinking that this mod cannot return descriptions or prices of your products? So if you want to list items in an in-game store you would have to hard-code the description/prices? <br><br></td></tr></table><br>
<a name="2023108"></a>

<a name="2023158"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >anawiki</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#44">[#44]</a></td></tr></table></td></tr><tr ><td class="posttext"> Itprobably does not have functions to return prices or descriptions, but it doesn't mean you can nnot add them to it. At the start of your game the mod lists products and prices in debug console, so for sure it is doable. <br><br></td></tr></table><br>
<a name="2023163"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >siread</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#45">[#45]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, thanks Anawiki. I'm currently getting this error:<br>"Problem in iTunes connect configuration for product: com.newstargames.newstarsoccer.fullversion"<br><br>After calling:<br>InitInAppPurchases("com.newstargames.newstarsoccer.", ["com.newstargames.newstarsoccer.fullversion"])<br><br>It's been over 12 hours since I set up my non-consumable products. I have new provisioning ids. I submitted an app then rejected it. Do I have to do anything with this section?<br><br><pre class=code>// CONFIGURATION STARTS -- Change this in your app
//#define kConsumableBaseFeatureId @"com.mycompany.myapp."
//#define kFeatureAId @"com.mycompany.myapp.featureA"
//#define kConsumableFeatureBId @"com.mycompany.myapp.005"
// consumable features should have only number as the last part of the product name
// MKStoreKit automatically keeps track of the count of your consumable product</pre> <br><br></td></tr></table><br>
<a name="2023162"></a>

<a name="2023161"></a>

<a name="2023160"></a>

<a name="2023159"></a>

<a name="2023171"></a>

<a name="2023172"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >anawiki</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#46">[#46]</a></td></tr></table></td></tr><tr ><td class="posttext"> That section is irrelevant, I replaced it with InitInAppPurchases because I thought that data driven behavior is much more pro than in code settings.<br><br>Sign out of iStore on device. Delete app from device. Select Clean build in xcode. Reinstall. If it doesn't help and you have all correctly set up then you need to wait. <br><br></td></tr></table><br>
<a name="2023189"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >siread</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#47">[#47]</a></td></tr></table></td></tr><tr ><td class="posttext"> I believe it is all set up correctly, although I can't really say that I understand all the certificates and provisioning profile stuff for iOS. :/<br><br>I'll give it some more hours. <br><br></td></tr></table><br>
<a name="2023304"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >siread</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#48">[#48]</a></td></tr></table></td></tr><tr ><td class="posttext"> Still not working. I've decided to delete the old consumable product and create a new one. Have uploaded a new binary (won't cancel it just yet) so App and IAP are both 'Waiting for review'. Now I play the waiting game again. :( <br><br></td></tr></table><br>
<a name="2023331"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >siread</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#49">[#49]</a></td></tr></table></td></tr><tr ><td class="posttext"> OMG, I think it's working. Instead of this...<br><br>InitInAppPurchases("com.newstargames.newstarsoccer.", ["com.newstargames.newstarsoccer.fullversion"])<br><br>I did this...<br><br>InitInAppPurchases("com.newstargames.newstarsoccer.", ["fullversion"])<br><br>I just spent 2 days figuring that out. Now to get the actual purchasing part sorted... <br><br></td></tr></table><br>
<a name="2023329"></a>

<a name="2023397"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >anawiki</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#50">[#50]</a></td></tr></table></td></tr><tr ><td class="posttext"> Funny thing is that you typed it correctly in the forum post :D <br><br></td></tr></table><br>
<a name="2023459"></a>

<a name="2023460"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >siread</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#51">[#51]</a></td></tr></table></td></tr><tr ><td class="posttext"> No I think you misunderstood. InitInAppPurchases only works if I use the short version (without the bundle id) for the product name:<br>InitInAppPurchases("com.newstargames.newstarsoccer.", ["fullversion"])<br><br>It's the same with buyProduct. Only this format works:<br>buyProduct("fullversion")<br><br>However, it crashed after attempting to buy:<br>*** Terminating app due to uncaught exception 'NSRangeException', reason: '*** -[__NSCFString substringFromIndex:]: Range or index out of bounds'<br><br>And now InitAppPurchases does nothing, when trying to buy it does nothing at all (no sign-in request, no error) and isProductPurchased("fullversion") returns 0. <br><br></td></tr></table><br>
<a name="2023429"></a>

<a name="2023430"></a>

<a name="2023499"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >anawiki</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#52">[#52]</a></td></tr></table></td></tr><tr ><td class="posttext"> It crashes because it needs long version (the bug complains about lack of dot in the name). Don't know why long version doesn't work for you. At least long version works for me. <br><br></td></tr></table><br>
<a name="2023562"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >siread</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#53">[#53]</a></td></tr></table></td></tr><tr ><td class="posttext"> I THINK I've sorted it. Basically I set up a new product id like this "noncon.fullgame". Then got results using the following methods...<br><br>InitInAppPurchases("com.newstargames.newstarsoccer.", ["noncon.fullgame"])<br>buyProduct("noncon.fullgame")<br><br>A dot in the product id seems to have fixed the crash. So did you set up your own product ids in iTunes Connect with the full bundle id or just with a single name? <br><br></td></tr></table><br>
<a name="2023560"></a>

<a name="2023556"></a>

<a name="2023554"></a>

<a name="2023555"></a>

<a name="2023553"></a>

<a name="2023566"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >siread</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#54">[#54]</a></td></tr></table></td></tr><tr ><td class="posttext"> *sigh* I spoke too soon. Everytime I start the app I need to purchase a non-consumable again. I presume calling restorePurchasedProducts() after Init should mean that isProductPurchased() would return true, but it doesn't. <br><br>I'm nearly at the end of my tether with this. Has anyone used it successfully for a game actually on the store? <br><br></td></tr></table><br>
<a name="2023563"></a>

<a name="2023561"></a>

<a name="2023565"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >anawiki</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#55">[#55]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, I used it successfully for The Perfect Tree on iPad (and unreleased yet Avalon Legends Solitaire). I set up IAP with full bundle name and IAP name, like this:<br><br>IAP-non-con: com.anawiki.perfecttree.unlock<br>bundle id: com.anawiki.perfecttree<br><br>I call InitInAppPurchases in OnCreate(). To check if product was purchased I use isProductPurchased(). restorePurchase() should be used only if app was deleted from device and previously purchased. You should not call restore every time your app starts. <br><br></td></tr></table><br>
<a name="2023569"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >siread</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#56">[#56]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ahh, I give up. I only get any hint of success by using the short ids (init app returns the price ok) but then it causes nothing but trouble after that. Maybe I'll try again after releasing a straight forward, paid app. <br><br></td></tr></table><br>
<a name="2023576"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >siread</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#57">[#57]</a></td></tr></table></td></tr><tr ><td class="posttext"> Aha! So you DO have to set it up the product id in iTunes with the full bundleid! Finally I think I have it working. :)<br><br>PS I lied earlier. I hadn't given up. ;) <br><br></td></tr></table><br>
<a name="2024823"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >EdzUp</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#58">[#58]</a></td></tr></table></td></tr><tr ><td class="posttext"> does anyone have a simple code example for this as it would be a great help :) All I need is initialisation, checking purchases and purchasing an item :) <br><br></td></tr></table><br>
<a name="2024855"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Xaron</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#59">[#59]</a></td></tr></table></td></tr><tr ><td class="posttext"> I second that. Would love to see a simple example! Please! :) <br><br></td></tr></table><br>
<a name="2024856"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >siread</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#60">[#60]</a></td></tr></table></td></tr><tr ><td class="posttext"> Very hectic times for me at the moment after releasing my game yesterday but I will try to write up a full description if no-one else does. :) <br><br></td></tr></table><br>
<a name="2024857"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >EdzUp</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#61">[#61]</a></td></tr></table></td></tr><tr ><td class="posttext"> @siread: Thanks it will be a great help :) <br><br></td></tr></table><br>
<a name="2024858"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Xaron</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#62">[#62]</a></td></tr></table></td></tr><tr ><td class="posttext"> I appreciate it as well! :) <br><br></td></tr></table><br>
<a name="2056468"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >siread</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#63">[#63]</a></td></tr></table></td></tr><tr ><td class="posttext"> Si's guide to using Anawiki's IAP module...<br><br>Ok, I'm assuming that you  have your app and bundle id all set up in iTunes Connect. So the first thing to do is create an in-app-purchase product. There are two types, both of which can be used via the Monkey module... <br><br><u>Non-consumable</u> <br>Non-consumable products are items that are purchased once, then the customer should never have to purchase them again. For instance my game has a career mode that you need to unlock to play, but once unlocked the customer can re-install the game, download on another device or whatever and so long as he is using the same iTunes username he should be able to access the career mode. (I'll go into how you restore consumable purchases at the end.)<br><br><u>Consumable</u><br>Consumable products are things like in-game currency, fish food, ammo, whatever. The customer can purchase the item, use it up in the game, then purchase some more. In New Star Soccer I have in-game currency called 'Star Bux' which you can buy in packs of 25, 50, 100, 250, 500, 1000. (Surprisingly the 1000 pack has sold the most units even though it costs the most! I will need to include some higher priced packs in the next version!)<br><br><u>Setting up your products</u><br><b>IMPORTANT!</b> The product id must include your FULL bundle id. For instance, my bundle id is com.newstargames.newstarsoccer. Therefore my (non-consumable) career mode product id is <b>com.newstargames.newstarsoccer.careermode</b>. You need to enter that complete id when setting up the product in iTunes Connect (which is where I went wrong and was left completely stumped for days!)<br><br>The original code from Mugunth Kumar on which the IAP module is based can handle how many units that the customer has purchase and how many he has left to consume, but the IAP module cannot do this so you need to assume that they are buying one unit (ie one pack of 25 star bux, rather than 25 individual star bux). This is fine because your game code can simply add the number of units purchased to the game file keep track of how many units (star bux) he has left.<br><br>So when setting up a consumable product ID you need to do it this way:<br><b>com.newstargames.newstarsoccer.starbux_1.1</b><br><br>I also have:<br><b>com.newstargames.newstarsoccer.starbux_2.1</b><br><b>com.newstargames.newstarsoccer.starbux_3.1</b><br><b>com.newstargames.newstarsoccer.starbux_4.1</b><br><b>com.newstargames.newstarsoccer.starbux_5.1</b><br><b>com.newstargames.newstarsoccer.starbux_6.1</b><br><br>The .1 at the end is used by the mod to determine that this is a 1 unit product. The player will purchase it and consume it immediately, but of course his save file will be updated with 25 bux or whatever. (My game knows that com.newstargames.newstarsoccer.starbux_1.1 refers to the 25 bux pack. com.newstargames.newstarsoccer.starbux_2.1 refers to the 50 bux pack and so on.)<br><br><b>IMPORTANT!</b> When you create your IAP do not upload a screenshot. This will mean that you can test your IAPs in Sandbox mode without having to upload a game binary. (You will need to create a test user in iTunes Connect. Also you need to go to Settings &gt; Store in your iOS device and sign out of your normal iTunes account, then sign-in with your Test User account when prompted in the game.)<br><br><u>The Code</u><br>Ok, so you have your products set up. Obviously you need to:<br><pre class=code>Import iap</pre><br><br>Then in OnCreate you need to do something like this:<br><pre class=code>#If TARGET="ios"
	'Initialise the mod with your bundle id and the list of products
	InitInAppPurchases("com.newstargames.newstarsoccer.", ["com.newstargames.newstarsoccer.careermode", 
"com.newstargames.newstarsoccer.starbux_1.1"])

	'gIAP_CareerMode is just a flag to record if the career mode is locked or not
	If isProductPurchased("com.newstargames.newstarsoccer.careermode")	
		gIAP_CareerMode = True
		TPlayer.SaveGlobalData()
	End
#End</pre><br><br>Note: I am just showing the code for career mode and star bux 25, to keep it simple.<br><br>It is important that you set up InitAppPurchases precisely, so that your bundle id has a dot at the end, and your product ids include the full id, and your consumables products have .1 at the end.<br><br>Ok, so now you have to create the code to allow the player to purchase items. I have a shop screen where the player can browse the items. When they click BUY on an item you call the code:<br><pre class=code>buyProduct("com.newstargames.newstarsoccer.careermode")</pre><br>Or<br><pre class=code>buyProduct("com.newstargames.newstarsoccer.starbux_1.1")</pre><br><br>Your game should then wait whilst the mod does it's thing. The isPurchaseInProgress() call will return true if the mod is displaying the "Do you want to buy this item for 69p?" window of if it is connecting with iTunes, so whilst that is happening you should probably disable the game interface or at least show a spinning icon. I do this by drawing a spinning star and my button clicks do nothing if isPurchaseInProgress() returns true.<br><br><pre class=code>Function Update()
	If isPurchaseInProgress()
		spinner += 1.0				' Rotate spinning star
		If spinner &gt; 360 Then spinner = 1
	Elseif spinner &gt; 0
		' Purchase was initiated but is no longer in progress, so check for purchase
		If Not gIAP_CareerMode And isProductPurchased("com.newstargames.newstarsoccer.careermode")
			gIAP_CareerMode = True
			PlayMySound(sndCash, CHN_FX)
			TPlayer.SaveGlobalData()
			
		Elseif canConsumeProduct("com.newstargames.newstarsoccer.starbux_1") ' Note! .1 is not needed here
			' Consumable products should be consumed
			consumeProduct("com.newstargames.newstarsoccer.starbux_1")

			' And the "units" should be stored in the save file
			PlayMySound(sndCash, CHN_FX)
			player.UpdateBank(25)
		End
		
		spinner = 0	' Reset spinner
		RefreshShop()	' This will update the shop items and bank label to show what has been purchased
	End
End

Function Draw()
	If spinner &gt; 0
		' Darken screen
		SetAlpha(0.5)
		SetColor(0,0,0)
		DrawRect(0, 0, gGuiW, gGuiH)
		
		' Draw spinning star
		SetAlpha(1)
		SetColor(255,255,255)
		DrawImage(imgStar128, gGuiW - 72, 72, spinner, 1, 1)
	End
End
</pre><br><br>And that is pretty much about it. The only other thing you need to worry about is when a customer has purchased a non-consumable product and has re-installed the game or is installing it on a new iOS device. Then you need to have a button to restore their purchases. I display a message explaining to the player what the restore button is for, and if they click proceed it calls restorePurchasedProducts(). This is a bit flakey, because calling isPurchaseInProgress() has no effect even though the mod is connecting to iTunes to check their purchase history. That means you can't display a spinner or disable the interface reliably because you don't know when the restore function completes. I just have an Update function that continually checks isProductPurchased("com.newstargames.newstarsoccer.careermode") until the player backs out of the screen. isProductPurchased will eventually return true if the customer has purchased that product in the past. As I say, not ideal but it does work at least.<br><br><b>Important!</b> I should also point out that when you have finished coding and testing your game, make sure you upload screenshot to iTunes Connect for your products. Then go into 'View Details' for your app and make sure your IAPs are all included BEFORE you upload the binary.<br><br>I hope that all helps! Massive thanks to Anawiki for creating this mod, and to Mugunth Kumar who created the original storekit code. Oh, and you can check out my game here... <br><a href="http://itunes.apple.com/us/app/new-star-soccer/id498973162" target="_blank">http://itunes.apple.com/us/app/new-star-soccer/id498973162</a><br><br>I will post some sales stats soon. :) <br><br></td></tr></table><br>
<a name="2025143"></a>

<a name="2025142"></a>

<a name="2025141"></a>

<a name="2025140"></a>

<a name="2025139"></a>

<a name="2025138"></a>

<a name="2025137"></a>

<a name="2025136"></a>

<a name="2025135"></a>

<a name="2025134"></a>

<a name="2025133"></a>

<a name="2025132"></a>

<a name="2025131"></a>

<a name="2025130"></a>

<a name="2025129"></a>

<a name="2025128"></a>

<a name="2025127"></a>

<a name="2025126"></a>

<a name="2025125"></a>

<a name="2025124"></a>

<a name="2025123"></a>

<a name="2025122"></a>

<a name="2025121"></a>

<a name="2025120"></a>

<a name="2025119"></a>

<a name="2025164"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >EdzUp</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#64">[#64]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks siread a rather comprehensive explanation :) <br><br></td></tr></table><br>
<a name="2028978"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Fred</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#65">[#65]</a></td></tr></table></td></tr><tr ><td class="posttext"> Implemented a working IAP system in one day !<br>It seems that I had to renew my provisionning profiles to make it work. <br><br>Many thanks to siread and anawiki ! <br><br></td></tr></table><br>
<a name="2029625"></a>

<a name="2029629"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >benmc</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#66">[#66]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't really understand the requirement that the product ID have your app ID in it.  Mine has a dash, for example, which means that I cannot use it for an IAP product ID.  Am I dead in the water?  I'm guessing that you can't change your product ID for an update or everyone will lose their saved state data.<br><br>EDIT: I don't seem to be having any problems getting this to work if my IAP ID is not exactly the same as my Bundle ID.  So far so good. <br><br></td></tr></table><br>
<a name="2048895"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >frank</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#67">[#67]</a></td></tr></table></td></tr><tr ><td class="posttext"> Does anyone know if this code is still working or it should be updated? I would like to use it , but if someone already knows that it's not working... <br><br></td></tr></table><br>
<a name="2049037"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >York</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#68">[#68]</a></td></tr></table></td></tr><tr ><td class="posttext"> I just updated my app for iOs 6 and the code runs. There is no update needed. <br><br></td></tr></table><br>
<a name="2050569"></a>

<a name="2050573"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >frank</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#69">[#69]</a></td></tr></table></td></tr><tr ><td class="posttext"> Does someone with more iOS / iAP experience know what skerrorunknown means? <br><br>When testing my app, I click on the purchase, spinner comes up, but then it says, in the NSLog: <br><br>skerrorunknown<br><br>and <br><br>Error: LibMobileGestalt computeUniqueDeviceId <br><br>I have no clue...<br><br>Edit: Partly fixed, apparently I needed to make a Test User BEFORE trying the app (makes some sense :). So small part solved... See my next message. <br><br></td></tr></table><br>
<a name="2050572"></a>

<a name="2050580"></a>

<a name="2050598"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >frank</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#70">[#70]</a></td></tr></table></td></tr><tr ><td class="posttext"> What IAP ID am I supposed to use? I see very conflicing stories online, some say<br><br>BUNDLEID.IAPREFERENCE<br><br>others say to never do that, but do <br><br>IAPREFERENCE <br><br>only. <br><br>I tried both. The error changed from: <br><br>Error: LibMobileGestalt computeUniqueDeviceId <br><br>to <br><br>Problem with your iTunes connect setup. <br><br>But I don't get what it could be, I tried all combinations and they all give that skerrorunknown and then the iTunes connect setup error.<br><br>Edit; I 'm reading the manual now and see I'm supposed to use the Product ID (again, makes sense) ; testing now.<br><br>Edit2: As quite so often it was a matter of reading and trying. <br><br>TL;DR to save other people from hassle: <br><br>- in Itunes connect make a Test User <br>- logout from the Appstore on your test device<br>- add one or more IAP products via Itunes connect to your app =&gt; Reference name can be anything, the Product ID is what you need <br>- Add the product IDs in your app like above and everything works like a charm<br><br>If you did any of the above wrong, you'll get that nice Unknown error; not sure why they just cannot tell me what is wrong in a normal error message I can use ... <br><br>For buying credits (over and over again), use Consumables, for switching off ads (for instance), use non-consumables. <br><br></td></tr></table><br>
<a name="2061073"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SLotman</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#71">[#71]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm just looking at IAP now, and found this thread... this looks promising, but one thing got me worried:<br><br><div class="quote"> <br>The original code from Mugunth Kumar on which the IAP module is based can handle how many units that the customer has purchase and how many he has left to consume, but the IAP module cannot do this so you need to assume that they are buying one unit (ie one pack of 25 star bux, rather than 25 individual star bux). This is fine because your game code can simply add the number of units purchased to the game file keep track of how many units (star bux) he has left.<br> <br></div><br><br>This is a BIG problem for consumables! If a player buy 25 star bux, then go and install the game on another device, he won't have those credits anymore.<br><br>Is there a link to the original code, said to actually deal with this? Maybe the module could be updated to handle this as it should be, querying the server if the product can be consumed or not. <br><br></td></tr></table><br>
<a name="2062818"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shinkiro1</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#72">[#72]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just wanted to let everybody know that this module still works :)<br>I had nearly the same problems as frank but after a few hours of battling they go away.<br><br>Some useful info:<br>getPurchaseResult() will return a number between 0 and 4 which represents the last state of the transaction.<br>0 or 1: no purchase happend yet<br>2: transaction succeded<br>3: transaction failed<br>4: restore purchases (not sure what this does but i assume you can restore purchases from other devices)<br><br>Sometimes you just have to wait. Seriously! I was testing the same game without recompiling and suddenly it was all up and running.<br><br>Thanks to anawiki for this great module.<br>Also I wouldn't have done it without sireads tutorial :) <br><br></td></tr></table><br>
<a name="2062817"></a>

<a name="2062858"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Xaron</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#73">[#73]</a></td></tr></table></td></tr><tr ><td class="posttext"> Great. Hope so, Mark will have this soon in the official Monkey release. :) <br><br></td></tr></table><br>
<a name="2063035"></a>

<a name="2063036"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raul</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#74">[#74]</a></td></tr></table></td></tr><tr ><td class="posttext"> hey, I tried to make a test and I receive this error:<br><br>** BUILD FAILED **<br><br><br>The following build commands failed:<br>	Ld build/Debug-iphonesimulator/MonkeyGame.app/MonkeyGame normal i386<br>TRANS FAILED: Error executing 'xcodebuild -configuration Debug -sdk iphonesimulator', return code=16640<br>(1 failure)<br><br>If I remove the code for IAP is working fine.. <br><br></td></tr></table><br>
<a name="2063038"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >rIKmAN</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#75">[#75]</a></td></tr></table></td></tr><tr ><td class="posttext"> Did you delete the iOS .build folder when compiling with the new code from Monkey? <br><br></td></tr></table><br>
<a name="2063040"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raul</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#76">[#76]</a></td></tr></table></td></tr><tr ><td class="posttext"> I did not even had a previously iOS build folder.. <br><br></td></tr></table><br>
<a name="2063041"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raul</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#77">[#77]</a></td></tr></table></td></tr><tr ><td class="posttext"> also before that error I receive this one:<br><br><pre class=code>
/Users/User/Desktop/monkeySundao/Sundao/main.build/ios/main.mm:4354:1: warning: autosynthesized property 'productsList' will use synthesized instance variable '_productsList', not existing instance variable 'productsList' [-Wobjc-autosynthesis-property-ivar-name-match]
@implementation MKStoreManager
^
/Users/User/Desktop/monkeySundao/Sundao/main.build/ios/main.mm:4209:25: note: property declared here
@property (copy) NSSet *productsList;
** BUILD FAILED **

</pre> <br><br></td></tr></table><br>
<a name="2063046"></a>

<a name="2063047"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shinkiro1</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#78">[#78]</a></td></tr></table></td></tr><tr ><td class="posttext"> Open the project in xcode and try adding i386 and armv6 as valid architectures.<br>It's under the "Build Settings" tab in "Architectures" and then add them to "Valid Architectures".<br>Be sure to clean your product, delete the app from your device and then run again.<br><br>Further reading: <a href="http://stackoverflow.com/questions/3549478/iphone-compiler-fails-no-architectures-to-compile-for" target="_blank">http://stackoverflow.com/questions/3549478/iphone-compiler-fails-no-architectures-to-compile-for</a><br><br><br>Edit: And make sure the AppID you use for building has IAP rights/entitlements. <br><br></td></tr></table><br>
<a name="2063048"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raul</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#79">[#79]</a></td></tr></table></td></tr><tr ><td class="posttext"> cannot do that.<br><br>All I have in Architectures in Standard (armv7) <br><br></td></tr></table><br>
<a name="2063072"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Xaron</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#80">[#80]</a></td></tr></table></td></tr><tr ><td class="posttext"> Then remove that line and add armv6 with your keyboard. :) <br><br></td></tr></table><br>
<a name="2063075"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raul</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#81">[#81]</a></td></tr></table></td></tr><tr ><td class="posttext"> Actually the issue was for missing the StoreKit framework..<br><br>I added and tried to run on simulator. When I want to purchase an item I receive the message: IAP is not running in simulator. I assume I can only test on a real device, right? <br><br></td></tr></table><br>
<a name="2063081"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Xaron</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#82">[#82]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, that's true. <br><br></td></tr></table><br>
<a name="2063363"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raul</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#83">[#83]</a></td></tr></table></td></tr><tr ><td class="posttext"> I had the same skerrorunknown error.<br><br>I signed out from Settings-&gt;Store.<br>I created an IAP for my testing app from store.<br>I compiled the code from Monkey<br>I opened xcode, I added the StoreKit Framework..<br>I changed the product name to match the product ids from store..<br><br>and when I try to purcahse, in xcode console I receive the skerrorunknown.. and that the itunnes setup is wrong<br><br>EDIT:<br>My IAP has status: Waiting for Screenshot. I hope this is ok for sandboxing, right? <br><br></td></tr></table><br>
<a name="2063362"></a>

<a name="2063375"></a>

<a name="2063376"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >rIKmAN</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#84">[#84]</a></td></tr></table></td></tr><tr ><td class="posttext"> In sireads mini-tutorial post above he says...<br><br><div class="quote"> <br>IMPORTANT! When you create your IAP do not upload a screenshot. This will mean that you can test your IAPs in Sandbox mode without having to upload a game binary. (You will need to create a test user in iTunes Connect. Also you need to go to Settings &gt; Store in your iOS device and sign out of your normal iTunes account, then sign-in with your Test User account when prompted in the game.)<br> <br></div><br>...so I assume waiting for screenshot is correct.<br><br>Have you setup the Test User in iTunes Connect? <br><br></td></tr></table><br>
<a name="2063374"></a>

<a name="2063383"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raul</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#85">[#85]</a></td></tr></table></td></tr><tr ><td class="posttext"> @rIKmAN:<br>Yes I have it.<br><br>I talked to a friend of mine who is an xcode developer and he helped me.<br><br>I have to share here with you my experience:<br>-It doesnt matter if you have a screenshot or not of the IAP<br>-Also in the iap.monkey it says: <br><pre class=code>
' IMPORTANT: If your app is not "Waiting for review" in iTunes Connect you won't be able to test In App Purchases. Once you get that status you can reject your binary and test peacefully. How weird! 
</pre><br>not more applicable. In fact the status of my application is now: Binary Rejected.<br><br>- The target iOS must be 6.0. Initially I tested on my friends iPhone 4 which has iOS.5. That's why I receive that Unkown Error message.<br>Anyway from September Apple will not support anymore iOS&lt;6 so if it is working on 6.0 it is ok.<br><br>- Also to run the IAP in simulator, just open "MKStoreKit.cpp" and search for:<br><pre class=code>
NSLog(@"You are running in Simulator MKStoreKit runs only on devices");
</pre><br>and remove the "#if TARGET_IPHONE_SIMULATOR"<br><br>This is usefull if you do not have always a device.. like me.<br><br>Hope this will help other, too.<br><br>BUT, there is also an issue here:<br>While trying to upload my app to the itunnes connect we received in that 'Package Maker and verification' an error which told us that we cannot continue because of using the 'uniqueID' I have no idea what should be the next step. I just removed the features from MKStoreKit.cpp <br><br></td></tr></table><br>
<a name="2080177"></a>

<a name="2080178"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Alex</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#86">[#86]</a></td></tr></table></td></tr><tr ><td class="posttext"> Does anyone tested the module on iOS 7?<br><br>I have this in debug:<br><pre class=code>
2014-02-26 18:00:59.112 MonkeyGame[5111:60b] state failed
2014-02-26 18:00:59.114 MonkeyGame[5111:60b] SKErrorUnknown
</pre> <br><br></td></tr></table><br>
<a name="2080179"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Xaron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#87">[#87]</a></td></tr></table></td></tr><tr ><td class="posttext"> Not needed anymore. Monkey has its own cross platform in app stuff now! <br><br></td></tr></table><br>
<a name="2080297"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Alex</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#88">[#88]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Xaron!<br><br>I just leave this link here:<br><a href="http://www.monkeycoder.co.nz/Community/posts.php?topic=7708" target="_blank">http://www.monkeycoder.co.nz/Community/posts.php?topic=7708</a> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
