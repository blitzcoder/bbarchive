<!DOCTYPE html><html lang="en" ><head ><title >Input lag on iPhone 4</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Input lag on iPhone 4</h1><a href="forums.php" >Monkey Targets Forums</a>/<a href="topics.php?forum=505" >iOS</a>/<a href="#bottom" >Input lag on iPhone 4</a><br><br>
<a name="2079322"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi all, I've recently been testing my game on a variety of iDevices and discovered a weird problem.<br><br>I'm using SetUpdateRate 60 and on iPhone 4S and iPad 2 and higher the game runs at 60FPS and the slider control I've made to move the player left/right is super-smooth.<br><br>On iPhone 4 the framerate is also 60FPS but with the occasional dropped frame when a lot is going on, which is to be expected.<br><br>However, something weird is happening to the input.  Whenever the action hots up the input becomes increasingly laggy and then even when the FPS returns to normal the input *remains* laggy!  By laggy I mean that as you slide your finger across this control I've made the player (ship) moves in large chunks maybe only about 4-5 times a second instead of 60 times a second. It only reverts to normal when I start a new level (a shop screen is shown in between).<br><br>I can understand why the input might be laggy while the FPS is reduced but input should return to normal when the FPS returns to normal.  For example, I can play a level with lots of aliens and shoot them all except one then that last alien and all my bullets are running at 60FPS but the input has dropped to like 4FPS.<br><br>I tried an experiment where I used SetUpdateRate 30 and this seemed to solve the problem, but obviously it didn't look very smooth.  So I reverted back to SetUpdateRate 60 and modified my slider input code to only be called every other frame (so at 30FPS) but that didn't work.  Perhaps I'd need to make ALL my input code (for other buttons etc on screen) also run at 30FPS (every other frame) so that the input system isn't overloaded, but that might not work if Monkey is still polling the input system at 60FPS.<br><br>Maybe I need to just speed up my game so that it never drops frames and then the input rate won't drop down and stay low.<br><br>So has anyone else encountered anything like this before?  It's it a Monkey issue or an iDevice issue I wonder?<br><br>Any thoughts welcome, thanks. <br><br></td></tr></table><br>
<a name="2079321"></a>

<a name="2079320"></a>

<a name="2079319"></a>

<a name="2079318"></a>

<a name="2079317"></a>

<a name="2079316"></a>

<a name="2079315"></a>

<a name="2079314"></a>

<a name="2079325"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nobuyuki</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Render thread has real-time priority on ios so maybe the system is just choking? <br><br></td></tr></table><br>
<a name="2079700"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I just noticed this on my iPhone 4S too.  This only occurred since I upgraded to XCode 5 and Monkey 077f, although the game code has changed too (but not the input code).  May try to downgrade Monkey to see if it goes away. <br><br></td></tr></table><br>
<a name="2079770"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >rIKmAN</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you can get it onto TestFlight or similar I will give it a spin on my iPod 4G and report back?<br><br>I am using Monkey76d, XCode5 etc and have never had any input lag issues, but have only tested my game on iPod 4Gs and iPad 2/3/4, sp maybe it is an iPhone specific issue?<br><br>Does your input loop just use standard Monkey Touch() commands? <br><br></td></tr></table><br>
<a name="2079769"></a>

<a name="2079774"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yep it uses standard Monkey Touch() commands.  I actually have an iPod 4G too but haven't got round to testing on it yet.  As it only has 256Mb RAM and is quite slow I was considering trying to filter it out by making the game iOS 7 only. <br><br></td></tr></table><br>
<a name="2079778"></a>

<a name="2079779"></a>

<a name="2079780"></a>

<a name="2079781"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >rIKmAN</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> What are you iOS versions are you setting as the target in XCode when building, just iOS7?<br><br>Have you run it through Instruments to see if there are any memory leaks?<br>I know you said it fixes itself after you reload a new level - are you resetting anything in this time that may be resetting the leak (so to speak)?<br><br>Just thinking out loud, I know you are an experienced coder so sorry if I'm teaching you to suck eggs.<br><br>PS. You are Jake, right?<br>I watched a talk on indie dev the other day with you on the panel with a couple of other people, was really interesting, so thanks. :) <br><br></td></tr></table><br>
<a name="2079786"></a>

<a name="2079787"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Actually I haven't set a target in XCode yet so it's whatever the default is for Monkey builds.<br>Yep done a lot of testing on memory leaks including running it through instruments in multiple ways.<br><br>This used to work fine and I haven't changed the input code so I'm thinking that it's like Nobuyuki said and the input thread is getting starved and somehow throttled down.  It returns to normal if I pause the game and resume, or just stop pressing my slider control, or beat the level. So it feels like once there's been no input for a short time then the input becomes unthrottled again.<br><br>I should add that this lag doesn't exist on the PC version.<br><br>No worries, I appreciate the help. I am experienced but I'm not an expert, especially on iOS. So there are still many things I could easily overlook.<br><br>Yep I'm Jake!  I guess that was the panel I did in 2011 in Seattle at Casual Connect? Been on some other ones but I'm not sure they are online. <br><br></td></tr></table><br>
<a name="2079862"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Still doing research and asking around. People seem to think the input thread is being starved (some people said dropping FPS to 30 worked, but that's not an option for this game) and are asking if there's a way to reduce the priority of the update thread, OR do some kind of sleep on the main thread (I guess so the input thread can catch up and process stuff).<br><br>Is there a Sleep command in Monkey? Couldn't find anything obvious. <br><br></td></tr></table><br>
<a name="2079950"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skid</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Looking at the target source, SetUpdateRate 0 will use DisplayLink which is best practise on iOS for syncing to display. Not sure if this will affect your update lag problem. <br><br></td></tr></table><br>
<a name="2079986"></a>

<a name="2079987"></a>

<a name="2079988"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> OK I'll try that thanks skid.  The game is relying on a 60Hz update loop for logic/animations though.  Will that be affected? I'm not using delta timing/tweening or anything at the moment. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
