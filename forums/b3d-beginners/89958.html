<!DOCTYPE html><html lang="en" ><head ><title >Reading bytes in particular order</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Reading bytes in particular order</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=5" >Blitz3D Beginners Area</a>/<a href="#bottom" >Reading bytes in particular order</a><br><br>
<a name="1022277"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry for the crappy thread title.<br><br>The problem I have here ,isn't so much how to do something, but how to do it in a sensible, efficient way.<br><br>The principle idea of the code, is to do with mp3 sound data. In the file, the sound data can be either mono or stereo.<br>In the case of mono sounds, the data is as you'd expect, in consecutive bytes, yet in the case of stereo sound, the bytes alternate between left then right.<br><br>This isn't so much of a big deal in itself, but with the data, I wish to draw a kinda waveform image. This reuquires (thanks to the Line command ) needing to track the last and current, or current and next points of data so the line can be drawn between the two. That's where my problems start.<br><br>I have tried to read bytes in chunks of 4 at a time, this way, I can capture two bytes worth of data even for a stereo sound (two for each channel). If it's a mono sound, then of course, 4 bytes are captured in this way, so the line drawing is just repeated to draw the additional bytes.<br><br>Here's what I have so far, the actual drawing routine and other aspects aren't so relevant to the issue, so don't worry if there's functions which aren't available here, the crux of the matter is really just in the For/Next and reading of the data which is all presented below:<br><br><br><pre class=code>		Local nChannelBytes=(nChannels Shl True)
		Local nChannelStep=nChannelBytes-1
		Dim Bytes(nChannelBytes)
		Local nLastLByte=-1
		Local nLastLX=0
		Local nLastRByte=-1
		Local nLastRX=0
		For nIterByte=0 To (WaveFormResolutionWidth-nChannelStep)
			For nIterReadBytes=0 To (nChannelStep)
				Bytes(nIterReadBytes)=PeekByte(bBank,nIterByte+nIterReadBytes)
				If (nChannels=1)
					If (nLastLByte&lt;1)Then nLastLByte=Bytes(0)
					DrawLine(LeftChannelColour,nLastLX,nIterByte,nLastLByte,Bytes(nIterReadBytes))
					nLastLX=nIterByte+nIterReadBytes
					nLastLByte=Bytes(nIterReadBytes)
				Else
					If (nChannels=2)
						DrawLine(LeftChannelColour,nLastLX,nIterByte,nLastLByte,Bytes(nIterReadBytes))
						nLastLX=nIterByte+nIterReadBytes
						nLastLByte=Bytes(nIterReadBytes)
						If (nIterReadBytes)
							If (nLastLByte&lt;1)Then nLastLByte=Bytes(0)
							DrawLine(RightChannelColour,nLastRX,nIterByte+1,nLastRByte,Bytes(nIterReadBytes+1))
							nLastRX=nIterByte+nIterReadBytes+1
							nLastRByte=Bytes(nIterReadBytes+1)
						End If
					End If
				End If
				nIterReadBytes=nIterReadBytes+nChannels
			Next
			nIterByte=nIterByte+nChannelBytes
		Next
</pre><br><br>If anyone has any advice on how to smarten/speed this up, I'd be realyl grateful. Thanks :) <br><br></td></tr></table><br>
<a name="1022363"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Charrua</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> hi<br><br>one aproach should be to get the first sample and then repeat from the second to the last drawing from prvious to current:<br><br>Previous = GetNextSample()<br>for Count=SecondSample to LastSample<br>   Current = GetNextSample<br>   drawline fromPrevious to Current<br>   Previous = Current<br>next<br><br>Juan <br><br></td></tr></table><br>
<a name="1022440"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> The difficult part, is reading the "Previous" and "Next" data in the correct order, since the order changes depending on the channels:<br><br>i.e.<br><br>MONO:<br><br>byte1= Left Channel byte1<br>byte2= Left Channel byte2<br>byte3= Left Channel byte3<br>byte4= Left Channel byte4<br><br>STEREO:<br><br>byte1= Left Channel byte1<br>byte2= Right Channel byte1<br>byte3= Left Channel byte2<br>byte4= Right Channel byte2<br><br>Sorry if i wast being so clear :)<br><br>Of course I could write out separate routines depending on the channels, but I would prefer to be able to 'automatically' sort the bytes if you know what I mean? <br><br></td></tr></table><br>
<a name="1022456"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Charrua</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> only one byte per sample?<br>normally the samples 8/16 bits and mono/stereo<br><br>any way, i think that is more easy to read if you construct a NextSample function that evaluates mono/stereo and the like and a higher routine that doesn't care about that. isn't it?<br><br>be aware of 16 bit samples, they normally are stored lo/hi litle endiand style, so the actual 16 bit value must constructed by: First + Second shl 8, being the first the one in lower memory addres and the Second the next in the up adjacent memory address.<br><br>is it necesary to draw a line?, why not simply plot the dots, or draw a vertical line from 0 to SampleValue, in this way you still has a good graph of the wave.<br><br>Juan <br><br></td></tr></table><br>
<a name="1022827"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PowerPC603</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> You could also create a 2-dimentional array.<br><br>Dim ArraySamples(10000, 2)<br><br>Read the left channel into ArraySamples(xxx, 1) and the right channel into ArraySamples(xxx, 2).<br>The xxx is the counter you use to increment the arrayindex after you've read both left and right bytes.<br><br>If you want to draw the left channel, you only use ArraySamples(xxx, 1), looping throuhg the entire array and you're done.<br><br>So:<br>byte1 =&gt; ArraySamples(1, 1)<br>byte2 =&gt; ArraySamples(1, 2)<br>byte3 =&gt; ArraySamples(2, 1)<br>byte4 =&gt; ArraySamples(2, 2)<br>byte5 =&gt; ArraySamples(3, 1)<br>byte6 =&gt; ArraySamples(3, 2)<br>byte7 =&gt; ArraySamples(4, 1)<br>byte8 =&gt; ArraySamples(4, 2)<br>byte9 =&gt; ArraySamples(5, 1)<br>byte10 =&gt; ArraySamples(5, 2)<br>...<br><br>Use the first index as the byte-counter, use the second index as the channel (1 = left, 2 = right). <br><br></td></tr></table><br>
<a name="1022839"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>be aware of 16 bit samples, they normally are stored lo/hi litle endiand style, so the actual 16 bit value must constructed by: First + Second shl 8, being the first the one in lower memory addres and the Second the next in the up adjacent memory address.<br><br>is it necesary to draw a line?, why not simply plot the dots, or draw a vertical line from 0 to SampleValue, in this way you still has a good graph of the wave.<br><br> <br></div><br>Thanks, Charrua  yes the number of bits is important. I'd not considered tht yet (oops!) although the basic format is the same, since the bytes themselves are still ordered left than right in stereo, (then of course, there's spdif 24-bit sounds.... )<br><br>so a 16-bit sample would just mean:<br><br>MONO<br>byte 1 - left channel bigendian1<br>byte 2 - left channel littleendian1<br><br>byte 3 - left channel bigendian2<br>byte 4 - left channel littleendian2<br><br>byte 5 - left channel bigendian3<br>byte 6 - left channel littleendian3<br><br>byte 7 - left channel bigendian4<br>byte 8 - left channel littleendian4<br><br>STEREO<br>byte 1 - left channel bigendian1<br>byte 2 - left channel littleendian1<br><br>byte 3 - right channel bigendian1<br>byte 4 - right channel littleendian1<br><br>byte 5 - left channel bigendian2<br>byte 6 - left channel littleendian2<br><br>byte 7 - right channel bigendian2<br>byte 8 - right channel littleendian2<br><br><br>________________________________________________<br><br>PowerPC -<br>thanks, that's a really smart way of dealing with it :) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
