<!DOCTYPE html><html lang="en" ><head ><title >Reading/Writing &amp; Types</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Reading/Writing &amp; Types</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=5" >Blitz3D Beginners Area</a>/<a href="#bottom" >Reading/Writing &amp; Types</a><br><br>
<a name="539874"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> That's TWICE now I've been caught out by the strange 'quirkiness' of ReadLine/Int etc. and Types. It's just annoying how I have been struggling with all sorts of other code until I finally remembered about this issue, so I thought Id post here to help anyone else that may have the same difficulty in the future!<br><br>Blitz will not read the data whilst trying to populate the Type field.<br><br>i.e<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">

File=OpenFile ("Myfile.txt")

NewType.MyType = New MyType

NewType\FieldX=ReadInt (File)

CloseFile File

</textarea><br><br>Will result in NewType\FieldX=0 regardless of the data in the file.<br><br>I have had to overcome this by a very simple workaround of:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">

File=OpenFile ("Myfile.txt")

NewType.MyType = New MyType

temp=ReadInt (File)

NewType\FieldX=temp

CloseFile File

</textarea> <br><br></td></tr></table><br>
<a name="539879"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> maybe can't create a type inside a file read/write<br>operation? <br><br></td></tr></table><br>
<a name="539890"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Im not sure, but I think it maybe to do with the order that Blitz compiles things (i.e. Types first), so it tries to populate the type fields before the values are resolved, effectively filling them with '0's as other undeclared vars...<br><br>not sure though ;) <br><br></td></tr></table><br>
<a name="539914"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sledge</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Glad you mentioned this - just about to start doing similar. <br><br></td></tr></table><br>
<a name="540032"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Odd, reading values directly into type fields works fine here. :/ <br><br></td></tr></table><br>
<a name="540036"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DH</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Odd, reading values directly into type fields works fine here. :/ <br> <br></div><br><br>Works fine here as well. <br><br></td></tr></table><br>
<a name="540534"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Heh... never worked for me, even from v1.83 <br><br></td></tr></table><br>
<a name="540571"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> This works on 1.90<br><pre class=code>
Type mytype
  Field x
End Type
File=OpenFile ("Myfile.txt")
WriteInt(file,5)
CloseFile file
file=ReadFile("myfile.txt")

NewType.MyType = New MyType

NewType\x=ReadInt(File)

CloseFile File
Print newtype\x
</pre> <br><br></td></tr></table><br>
<a name="540847"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay, well - I seem to have another problem then...<br><br>I believe it's connected to Global Types. I think I'm not declaring the Type as global properly so that when I come to populate it within the function, the main program doesn't record the instance...<br><br><br>My function is:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Function Loadship(shipname$,scale#,pitch,yaw,roll,shininess#,alpha#,x,y,z)

Decal=OpenFile("Visual\3D\Ships\"+shipname$+"\Decals.DAT")

Dim a(24)

For f=1 To 24
	temp=ReadInt(Decal)
	a(f)=temp
Next
	
CloseFile(Decal)

LoadDecal.Shiplights = New shiplights

LoadDecal\FS_Sprite=CopyEntity (LightSprite)
LoadDecal\FS_x=a(1)
LoadDecal\FS_y=a(2)
LoadDecal\FS_z=a(3)

LoadDecal\FP_Sprite=CopyEntity (LightSprite)
LoadDecal\FP_x=a(4)
LoadDecal\FP_y=a(5)
LoadDecal\FP_z=a(6)

LoadDecal\U_Sprite=CopyEntity (LightSprite)
LoadDecal\U_x=a(7)
LoadDecal\U_y=a(8)
LoadDecal\U_z=a(9)

LoadDecal\T_Sprite=CopyEntity (LightSprite)
LoadDecal\T_x=a(10)
LoadDecal\T_y=a(11)
LoadDecal\T_z=a(12)

LoadDecal\AP_Sprite=LoadSprite("Visual\3D\Ships\"+shipname$+"\Aerial Port.bmp")
LoadDecal\AP_x=a(13)
LoadDecal\AP_y=a(14)
LoadDecal\AP_z=a(15)

ScaleSprite LoadDecal\AP_Sprite,(scale#/10),(scale#/10)

LoadDecal\AS_Sprite=LoadSprite("Visual\3D\Ships\"+shipname$+"\Aerial Starboard.bmp")
LoadDecal\AS_x=a(16)
LoadDecal\AS_y=a(17)
LoadDecal\AS_z=a(18)

ScaleSprite LoadDecal\AS_Sprite,(scale#/10),(scale#/10)

LoadDecal\AT_Sprite=LoadSprite("Visual\3D\Ships\"+shipname$+"\Aerial Top.bmp")
LoadDecal\AT_x=a(19)
LoadDecal\AT_y=a(20)
LoadDecal\AT_z=a(21)

ScaleSprite LoadDecal\AT_Sprite,(scale#/10),(scale#/10)

LoadDecal\H_Sprite=CopyEntity (LightSprite)
LoadDecal\H_x=a(22)
LoadDecal\H_y=a(23)
LoadDecal\H_z=a(24)

		logfile("GRAPHICS: POPULATED DECAL TABLE")

	
	mesh=LoadMesh("Visual\3D\Ships\"+shipname$+"\Mesh.x")
	
	logfile("GRAPHICS: LOADED MESH "+mesh)
	
	texture=LoadTexture("Visual\3D\Ships\"+shipname$+"\Texture.bmp")
	
	logfile("GRAPHICS: LOADED TEXTURE "+texture)
	
	ScaleMesh mesh,scale#,scale#,scale#
	
	logfile("GRAPHICS: SCALED MESH")
	
	EntityTexture mesh,texture
	
	logfile("GRAPHICS: PAINTED MESH WITH TEXTURE")
	
	temp=texture
	
	FreeTexture texture
	
	logfile("GRAPHICS: TEXTURE "+temp+" FREED")
	
	EntityShininess mesh,shininess#
	
	logfile("GRAPHICS: ADDED LIGHT REFLECTION TO MESH "+mesh)
	
	EntityAlpha mesh,alpha#
	
	logfile("GRAPHICS: SET TRANSPARENCY LEVEL TO MESH "+mesh)
	
	EntityType mesh,1
	
	PositionEntity mesh,x,y,z,1

	logfile("GRAPHICS: POSITIONED MESH "+mesh+ "AT X:"+x+" Y:"+y+" Z:"+z)
	
	PositionEntity LoadDecal\FS_Sprite,x,y,z
	PositionEntity LoadDecal\FP_Sprite,x,y,z
	PositionEntity LoadDecal\AP_Sprite,x,y,z
	PositionEntity LoadDecal\AS_Sprite,x,y,z
	PositionEntity LoadDecal\AT_Sprite,x,y,z
	PositionEntity LoadDecal\U_Sprite,x,y,z
	PositionEntity LoadDecal\T_Sprite,x,y,z
	PositionEntity LoadDecal\H_Sprite,x,y,z
	
MoveEntity LoadDecal\FS_Sprite,(FS_x*scale#),(FS_y*scale#),(FS_z*scale#)
EntityParent LoadDecal\FS_Sprite,mesh,1

MoveEntity LoadDecal\FP_Sprite,(FP_x*scale#),(FP_y*scale#),(FP_z*scale#)
EntityParent LoadDecal\FP_Sprite,mesh,1

MoveEntity LoadDecal\U_Sprite,(U_x*scale#),(U_y*scale#),(U_z*scale#)
EntityParent LoadDecal\U_Sprite,mesh,1

MoveEntity LoadDecal\T_Sprite,(T_x*scale#),(T_y*scale#),(T_z*scale#)
EntityParent LoadDecal\T_Sprite,mesh,1

MoveEntity LoadDecal\AP_Sprite,(AP_x*scale#),(AP_y*scale#),(AP_z*scale#)
EntityParent LoadDecal\AP_Sprite,mesh,1

MoveEntity LoadDecal\AS_Sprite,(AS_x*scale#),(AS_y*scale#),(AS_z*scale#)
EntityParent LoadDecal\AS_Sprite,mesh,1

MoveEntity LoadDecal\AT_Sprite,(AT_x*scale#),(AT_y*scale#),(AT_z*scale#)
EntityParent LoadDecal\AT_Sprite,mesh,1

MoveEntity LoadDecal\H_Sprite,(H_x*scale#),(H_y*scale#),(H_z*scale#)

EntityParent LoadDecal\H_Sprite,mesh,1

	logfile("GRAPHICS: PLACED DECALS RELATIVE TO "+(H_x*scale#)+" , "+(H_y*scale#)+" , "+(H_z*scale#))
	
		RotateEntity mesh,pitch,yaw,roll
	
	logfile ("GRAPHICS: SET MESH "+mesh+" FACING P:"+pitch+" Y: "+yaw+" R:"+roll)
	
Return mesh

End Function
</textarea><br><br><br>and my Type declaration goes very simply like this:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Global ShipLights

Type ShipLights

Field FS_Sprite
Field FS_x
Field FS_y
Field FS_z

Field FP_Sprite
Field FP_x
Field FP_y
Field FP_z

Field U_Sprite
Field U_x
Field U_y
Field U_z

Field T_Sprite
Field T_x
Field T_y
Field T_z

Field AP_Sprite
Field AP_x
Field AP_y
Field AP_z

Field AS_Sprite
Field AS_x
Field AS_y
Field AS_z

Field AT_Sprite
Field AT_x
Field AT_y
Field AT_z

Field H_Sprite
Field H_x
Field H_y
Field H_z

End Type
</textarea> <br><br></td></tr></table><br>
<a name="540852"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rhyolite</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Gah, see below - double posted myself!! <br><br></td></tr></table><br>
<a name="540853"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> You should consider outputting debuglog or text statements as you type fields get populated. At least you'll know whether they are set within the function or not. <br>If they are set in the function and the debuglog statements suggest it's 0 outside then it's likely to be a global <br>issue.<br>BTW : Isn't it the type handle that needs to be global and not the type name?<br><pre class=code>Type mytype
  Field x
End Type
Global newtype.mytype
writing()
reading()
Print "Out function : " + newtype\x
WaitKey()
Function writing()
	File=WriteFile ("Myfile.txt")
	WriteInt(file,5)
	CloseFile file
End Function
Function reading()
	file=ReadFile("myfile.txt")
	NewType.MyType = New MyType
	NewType\x=ReadInt(File)
	CloseFile File
	Print "In function : " + newtype\x
End Function
</pre> <br><br></td></tr></table><br>
<a name="540854"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rhyolite</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think you may have fallen for the common misunderstanding of how TYPES work in Blitz (I know I did!).<br><br>Whenever you create a new instance of a TYPE ie.<br><br>(LoadDecal.Shiplights = New shiplights)<br><br>then the instance is ALWAYS global. Each instance of a TYPE you create is global and exists in your main routine and all functions.<br><br>However!!! The pointer to that instance ('LoadDecal') is only local to your function. If you want to access this instance in your main code or another function, you will need to get a new pointer to that instance!<br><br>Try doing this in your main code after (and maybe before!) calling your function:<br><br>for test.shiplights = each shiplights<br>    ;test some 'type' data here<br>next<br><br>Hope that helps a bit,<br>Rhy :) <br><br></td></tr></table><br>
<a name="540857"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, in the Globals tab on the right of the 'debug' window, Shiplights always = 0 that's how I know it's not being populated....<br><br>But thanks, now that you mention it, Types have to be global because they can be iterated from wherever within a program! <br><br></td></tr></table><br>
<a name="540859"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rhyolite</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think the debug window only shows you the current instance?? Not sure, cos I use Protean IDE. What does it show if you put a stop in your function after populating the type?<br><br>Rhy :) <br><br></td></tr></table><br>
<a name="540862"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>Well, in the Globals tab on the right of the 'debug' window, Shiplights always = 0 that's how I know it's not being populated.... <br></div><br>but the debuglog/text messages would have suggested that shiplights wasn't the problem. Never mind. <br><br></td></tr></table><br>
<a name="540863"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> DOH!!!<br><br>Sussed it! In my PositionEntity commands, I forgot to enter 'MyType\.....'<br>resulting in the Compiler assuming null values for undeclared variables such as 'My_Field' etc. etc.<br><br>Changed to 'MyType\My_Field' and it's working fine! :) <br><br></td></tr></table><br>
<a name="540963"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> ah! the infamous "i forgot to do this" trick! :)<br><br>rem: if you get a coding problem, <br>break it down to the simplest example<br>possible, test that out, make sure you<br>know whats going wrong, <br>(and of course how to fix it!), then go <br>back to your big code and add it.<br><br>saves alot of hassle. <br><br></td></tr></table><br>
<a name="540994"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> The biggest problem I have, is where "Galactic" has grown into a modular project with all the functions and routines etc. split across several files for 'Include' this is great for adding/changing bits, but very difficult to test small portions as so much relies on prior configurations. It's a shame that the compiler cannot be fed values at run-time, i.e. set a load of variables. I am currently trying to implement a debugging tool which will essentially be a copy of part of the code which will read relevant data from an editable file...<br><br>It's a lot of work, and its tough because I wanna get back on with the flight engine :)<br><br>thanks for the help &amp; advice!!! <br><br></td></tr></table><br>
<a name="541242"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ozak</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ahh. The blitzmax strict command would be handy to have in Blitz3D :) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
