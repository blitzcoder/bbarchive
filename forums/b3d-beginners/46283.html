<!DOCTYPE html><html lang="en" ><head ><title >3D\ starfield</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >3D\ starfield</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=5" >Blitz3D Beginners Area</a>/<a href="#bottom" >3D\ starfield</a><br><br>
<a name="514744"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Teffo</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> How does one make a Moving 3D starfield (textured quads) to orient themselves using a ships constantly changing angles?<br><br>I'm using coords- x and z (=left,right) and y=height<br><br>Or - what's the best approach to this problem?<br><br>Thanks<br>Teff <br><br></td></tr></table><br>
<a name="514754"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Teffo</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just FYI -<br>I'mm looking for something like this - except in 3D<br>When My ship turns, I would like to see the stars appear to look like a ship's turning etc..<br><br>Const MAX_STAR=5000,STAR_SPEED=2,WIDTH=640,HEIGHT=480<br><br>Dim star_x(MAX_STAR),star_y(MAX_STAR),star_z(MAX_STAR)<br><br>Graphics WIDTH,HEIGHT<br>SetBuffer BackBuffer()<br><br>setup_stars()<br><br>While Not KeyDown(1)<br>	Cls<br>	UpdateStar()<br>	Flip<br>Wend<br>End<br><br>Function setup_stars()<br>  	For c=0 To MAX_STAR<br>	star_x(c)=Rnd(-(WIDTH/2),(WIDTH/2))Shl 8<br>	star_y(c)=Rnd(-(HEIGHT/2),(HEIGHT/2))Shl 8<br>    star_z(c)=Rnd(STAR_SPEED,255)<br>	Next <br>End Function<br><br>Function UpdateStar()<br>	For c=0 To MAX_STAR<br>	star_z(c)=star_z(c)-STAR_SPEED<br>	If star_z(c)&lt;=STAR_SPEED Then star_z(c)=255<br>	s_x=(star_x(c)/star_z(c))+(WIDTH/2)<br>	s_y=(star_y(c)/star_z(c))+(HEIGHT/2)<br>	col=255-star_z(c)<br>	Color col,col,col<br>	Plot s_x,s_y<br>	Next<br>End Function <br><br></td></tr></table><br>
<a name="515013"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> How do you mean "textured quads"? One star on one quad, or lots of stars on one quad? <br><br></td></tr></table><br>
<a name="515096"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Teffo</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> ...a star texture was used on a single quad (2 tris) to keep poly count low.<br><br>Actually it works up to a point - i.e. the star objects appear to 'move' because the camera moves towards them, but what I wanted was to 'reuse' the unseen star objects behind the camera and move them forward again to be used again - much like recycling/redrawing lots of grass objects around as a player moves on terrain.<br><br>I cannot see how I could find out if the stars were behind the camera - because one second they are ahead, after turning 180, they are behind. Entity distance did not work there - as did DeltaZ.<br><br>So far I have not suceeded after trying about 6 methods.<br>What works the best is the 2D code above, but the stars overwrite the 3D enemy ships and the 3D hud display and secondly, it's just 2D (but that may be the best solution)<br><br>I even tried a skycube starfield pivoted to the camera, but that introduced other problems.<br><br>Yikes - what to do?<br>Teff <br><br></td></tr></table><br>
<a name="515099"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DJWoodgate</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> You could do a cameraproject or a tformpoint to find out if stars are behind the camera.  If the first case ProjectedZ will be zero, in the second tformedz will be less than zero.  Not sure which is faster.  My guess is Cameraproject may be a bit quicker. <br><br></td></tr></table><br>
<a name="515109"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here is how to find out if a point is in front of a camera, or any other object:<br><br>TFormPoint EntityX#(Blah, 0), EntityY#(Blah, 0), EntityZ#(Blah, 0), 0, Camera<br><br>If TformedZ() is positive, then the point is in front of the camera.  If it is negative, then the point is behind the camera.  <br><br>The trick is that the point is transformed from global space into camera space.  So the point returned is on a grid which is aligned with the camera.  You can also use this point to tell if an object is to the left or right, top or bottom as well, just by checking the sign on the X or Y axis.<br><br>Keep in mind though that if you use this for an entity, then it will only tell you if the center of the entity is behind the camera.  You will want to check all eight corners of the entity to see if they are all behind the camera before you hide the entity.<br><br>You can also project those corners with camera project, and if all corners have coordinates which are above the top of the screen, of below the bottom, or beyond the left, or beyond the right, then the entity is not on the screen.  Keep in mind though that all the points have to be on one side of a particular side of the screen.  Having some points off the top and some points off the bottom does not mean the entity is not on the screen, for example. <br><br></td></tr></table><br>
<a name="515168"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Teffo</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> sswift tried that and created the following code. It spawns new stars only if the camera is not being rotated. Once the Yangle&lt;&gt;0 then hell breaks loose.<br><br>Here's the example - <br>Hope ya can assist in this as I'm about to lose more hair<br><br>Teff<br><br><br>Graphics3D 1024,768,32 : SetBuffer BackBuffer() : SeedRnd MilliSecs() <br>Global x#,y#,z#,camera,light : camera=CreateCamera() : light=CreateLight() <br><br><br>Global speed=40 : Global numstars = 1000 : Global fardistance = 10000 : CameraRange camera,1,fardistance*2 : obj_scale=6<br>Dim stars(numstars) : master_star=CreateCube() : ScaleEntity master_star,obj_scale,obj_scale,obj_scale<br>d=fardistance<br>For i=1 To numstars <br>stars(i)=CopyEntity(master_star)  : EntityColor stars(i),255,255,255 : PositionEntity stars(i),Rand(-d,d),Rand(-d,d),Rand(-d,d)<br>Next<br><br><br><br>timer1=MilliSecs()<br>While Not KeyDown( 1 ) <br><br>get_keys()<br>rotate_ship()<br>update_stars()<br><br><br>UpdateWorld : RenderWorld<br>Text 0,0,"y#=" + y# : Text 1,75,"Triangles Rendered: "+TrisRendered() <br><br>Flip :Wend :End<br><br><br><br><br>Function update_stars()<br><br>For i=1 To numstars <br>st=stars(i)<br>TFormPoint EntityX#(st, 0), EntityY#(st, 0), EntityZ#(st, 0), 0, Camera<br>;behind camera then respawn in front of cam<br>If TFormedZ() &lt;0<br>d=fardistance<br>xX# = TFormedX()<br>yY# = TFormedY()<br>zZ# = TFormedZ()<br><br>PositionEntity stars(i),EntityX(camera)+Rand(-d,d),EntityY(camera)+Rand(-d,d),EntityZ(camera)+d*0.5+Rand(d)<br>;PositionEntity stars(i),xX+Rand(-d,d),yY+Rand(-d,d),zZ+Rand(d)+d*0.5<br><br>EndIf<br>Next<br><br><br><br>End Function<br><br><br><br><br>Function get_keys()<br>If KeyDown( 203 )=True Then y#=+1<br>If KeyDown( 205 )=True Then  y#=-1 <br>If KeyDown( 200 )=True Then x#=+0.2<br>If KeyDown( 208 )=True Then x#=-0.2<br><br>If MilliSecs() &gt; timer1 + 100<br>timer1=MilliSecs()<br>If y#&gt;0 Then y#=y#-0.01<br>If y#&lt;0 Then y#=y#+0.01<br>If x#&gt;0 Then x#=x#-0.01<br>If x#&lt;0 Then x#=x#+0.01<br>EndIf<br><br><br>End Function<br><br><br>Function rotate_ship()<br>;RotateEntity camera,x#,y#,z#,1<br>TurnEntity camera,x#,y#,z#,1<br>MoveEntity camera,0,0,speed<br>End Function <br><br></td></tr></table><br>
<a name="515247"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >grindalf</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> cant you just use entityinview as in<br>if entityinview(camera,stars)=false repositionstar() <br><br></td></tr></table><br>
<a name="515356"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Teffo</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes that's another good idea.<br>Went ahead and tried "if entityinview(camera,stars)"<br>and it did work. I may have to check to see the performance hit for using that command every 100ms for 1000 stars.<br><br>Teff <br><br></td></tr></table><br>
<a name="515422"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Teffo</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok got the stars appearing infront of the camera very effectively. I have 200 sprites now and the effect when turning is very realistic.<br><br>I understand there's likely a faster way, but after 24 hours, this is where it stands.<br><br>Teff<br><br><br>Function update_stars()<br><br>If MilliSecs() &gt; timer2 + 100<br>timer2=MilliSecs() : theta=50<br><br>For i=1 To numstars <br>st=stars(i)<br>If EntityInView(st,camera)=0<br>	EntityParent st,camera<br>	PositionEntity st,EntityX(camera),EntityY(camera),EntityZ(camera),1<br>	RotateEntity st,EntityX(st)+Rand(-theta,theta),EntityY(st)+Rand(-theta,theta),1<br>	EntityParent st,0<br>	MoveEntity st,0,0,Rand(500)+1500<br>EndIf<br>Next<br><br>EndIf<br><br>End Function <br><br></td></tr></table><br>
<a name="515742"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> I wouln't now anything better than a particle system like this, be it sprites based or single surface. Of course, you should reuse the stars around the ship. You could position them using the current space cluster as random seed, so they are real stationary.<br><br>Then I'd add a sky sphere with a zillion of nice stars. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
