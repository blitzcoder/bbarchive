<!DOCTYPE html><html lang="en" ><head ><title >DLL's - HELP ME</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >DLL's - HELP ME</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=5" >Blitz3D Beginners Area</a>/<a href="#bottom" >DLL's - HELP ME</a><br><br>
<a name="552209"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dr. Wildrick</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I am very confised, while I have seen a number of examples of code that call windows API function and custom DLL's as well, I cant get any of my own code to work.<br>Can someone- please - explain to me how you set up a DLL call, pass parameters to it and get them back. Please keet the example SIMPLE - Im a newbie to this language.<br>Thanks! <br><br></td></tr></table><br>
<a name="552380"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >fraggle</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> 1.: You should declare your function in your dll with declspec like this:<br>__declspec (dllexport) int initjava(LPCTSTR  jvmpath, LPCTSTR classpath, LPCTSTR classname);<br>2.: You have to write a .decls file:<br>blitzjava.decls:<br>.lib "blitzjava.dll"<br>initjava%(jvmpath$, classpath$, classname$)<br><br>place this file in your userlibs directory (default c:\Program Files\Blitz3d\userlibs)<br><br>3. restart Blitz3d editor and call your function with:<br>result%=initjava("path", "classpath","classname")<br><br><br>As you see, you declare function prototypes in the decls file with " functionname[returntype%/$/#](params[%/$/#])"<br>If you want to return a string or other sort of array/buffer you should use blitz-buffers.<br>E.g.:<br>.c:<br>__declspec (dllexport) void convertName(char*buffer,int size);<br><br>.decls:<br>convertName(bank,bankSize)<br><br>Blitz:<br>bankSize=128<br>bank=CreateBank(bankSize)<br>Poke...(bank)<br>convertName(bank,bankSize)<br>Peek...(bank)<br><br>P.S. not doing this a long time. if your computer explodes, it's not my fault. I warned you *g* <br><br></td></tr></table><br>
<a name="552560"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BlackJumper</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> You should also be aware that some compilers may 'mangle' your function name (e.g. truncating it to 8 characters, etc.) so you need to know what function name was <b>actually</b> exported in the compiled dll, rather than just assume that it remains what you named it in your code.<br><br>Many compilers will have 'switches' that may allow you to switch off name-mangling. Others have it off by default. <br><br></td></tr></table><br>
<a name="552563"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Lane</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> What kind of Doctor are you? <br><br></td></tr></table><br>
<a name="553145"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dr. Wildrick</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> My PhD is in imaging sciences.<br><br>So let me see if I have this straint then? I put my DLL in the userlibs folder, create a function declaration in the same name containg the function call(s)  starting the line ,lib "mydll.dll" and then follow that with the declarations of the functions in the DLL.<br>am I on track so far?<br>So then in my main Blitz program, how do I tell it what I want to call or will it just do the function if I call it and it finds it is a Decls file?<br>So for example if I tried to call the windows API of Setprocesspriority(processid#,value#)<br>and it should do it finne as long as I declared the Decls file with the .lib the DLL name in quotes and then a function declaration in it.<br>That right?<br>Its important - very omportant that I get this working. Does anyone have anouther simple example - I aleady have the DLL's that I need. <br>Please give me an exampe of how I would set this up:<br>My DLL name is say "convolve.dll"<br>and my function is filter$(a#,B#) where to long int's are expected as params and a string is returned. How do I set this sample up. I'm not sure I follow the need to create banks and peek or poke to them. Is the no "Pass by value"????<br>So the above example is just a made up one but if I have a refrence starting point, I can figure out why what is being done needs to be. Please tell me how, if I just get code thrown at me its the same as lookig at other programs. I need the "WHY" as much as the HOW"<br>Any suggestions??? Please????<br>I appreciate your example Fraggle, Thanks, Could you toss in some more whys in there?<br>Thanks in advance all.<br>-T <br><br></td></tr></table><br>
<a name="553154"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BlackJumper</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Have a look at the <a href="/sdkspecs/sdkspecs/userlibs_specs.txt" target="_blank">specs and utils</a> section.<br><br>decls should be...<br><br><pre class=code>
.lib "convolve.dll"
filter$(a%,b%)
</pre><br><br>the "convolve.dll" file should then reside in the same folder as the .bb file you are calling it from. {It can live elsewhere, but it is safest to avoid path problems if your code can find it locally. }<br><br>Note the "two long int parameters" are specified using the '%' tag... If you use the '#' tag Blitz will expect floats... although I would guess that automatic conversion <b>may</b> occur.<br><div class="quote"> All integer values in your program must be in the range -2147483648 to +2147483647 <br></div><br>...can't remember offhand if this equates to a long int! <br><br></td></tr></table><br>
<a name="553210"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >fraggle</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> To clarify the use of banks: you create a string in your dll dynamically with malloc or in the data/code segment of your dll with char buffer[255]. This allocation can not be freed. Thats why you call windows functions like GetUserName (example in Protean, code archives,userlibs) with a pointer to your buffer and the buffer size. The function then fills the buffer and it is your responsibility to free the buffer then. If you return strings in your dll you will have a memory leak, if you do not reuse your buffer. With memory banks, you give the responsibility to the executing program. <br>If blitz can't find the function, I use the program "nm" from the cygwin tools (www.cygwin.com). Then you are able to use even a c++ dll.<br>Another problem you could get: the dll has to be in the same directory as your workingdir or in windows\system32 folder. You could get problems, starting your application from an ide. If, e.g. you create your executable from Protean and let Protean start your exe after creation, the workdir is set to protean home dir. That means, you can't load your resources with a relative path and neither a dll. <br><br></td></tr></table><br>
<a name="553528"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dr. Wildrick</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Blackjumper and Fraggle. I think I got it now.<br>Very much apreciated.<br>Oh, and blackjumper... I find a few good grumbles a day to be quite refreshing. lol<br>I run a film studio so you can imiagine the characters I have to deal with on a daily basis. When I see contracts with clauses like "And the party of the second part shall, at all times, be within 10 feet of a half full 1 LB bag of M&amp;M plain candies while on any hot set." I just hit my head and say "Oy!"<br>So grumble away my friend, im right there with ya.<br>lol<br>thanks all for the help, you all have  been invaluable. <br>But, im out of M&amp;M's. (Sorry)<br>Peace<br>-T<br><br>PS - Hey Fraggle - it that a refrence to Fraggle Rock? or a refrence to the Techno/ neo-punk band? <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
