<!DOCTYPE html><html lang="en" ><head ><title >Dropping a bomb with deforming terrain</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Dropping a bomb with deforming terrain</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=5" >Blitz3D Beginners Area</a>/<a href="#bottom" >Dropping a bomb with deforming terrain</a><br><br>
<a name="1315777"></a>

<a name="1315778"></a>

<a name="1315779"></a>

<a name="1315780"></a>

<a name="1315781"></a>

<a name="1315782"></a>

<a name="1315783"></a>

<a name="1315784"></a>

<a name="1315785"></a>

<a name="1315786"></a>

<a name="1315787"></a>

<a name="1315789"></a>

<a name="1316107"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello,<br><br>[EDIT]<br><br>All files for solution available here:<br><br><br><a href="http://www.wishingwellsoftware.co.uk/setup_3bombs_Blitz3D.exe" target="_blank">http://www.wishingwellsoftware.co.uk/setup_3bombs_Blitz3D.exe</a><br><br>[end EDIT]<br><br>I've been trying to join some code together about dropping bombs and deforming the terrain, with a view to better understanding terrain deformation(s), the following is code from the forums by Yue and RickNasher and David Bird:<br><br>I cannot seem to find the thread which was discussing the various methods I've found to possibly create 'craters' in a terrain.<br><br>the files that need to be used in conjunction with this code are located within the :<br><br>{your drive}\Program Files\Blitz3D\samples\birdie\Terrain Tiling<br><br>The bomb doesn't fall through the terrain (which is a mesh... I reckon) It sits 'on it' when the collision is detected:<br><br><img src="http://www.wishingwellsoftware.co.uk/bomba.png"><br><br><br><br>I suspect the problem I (may) be having here is I am not using a 'proper' terrain in the strict sense of the word? Any help appreciated - can a 'mesh' be deformed - or does it have to be a terrain type of entity ?<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">

;This is the TERRAIN TILING demo from the Blitz examples folder
; it is eluding me how to destruct the scenery, if indeed it is at all possible...

;Terrain Tiling 2
;David Bird
;dave@...
;use of u/v coords for tileset
;also example of texture coords set

;size of map
Const Gridx=64
Const Gridz=64

bomberx=22
bombery=59
bomberz=20

Graphics3D 640,480
SetBuffer BackBuffer()

lit=CreateLight()
cam=CreateCamera()

CameraRange cam,.1,1000
PositionEntity cam,32,20,50
TurnEntity cam,0,90,0


;Load brush with 16tiles
b1=LoadBrush("16tex.bmp")

Const Texture_Grid=4			;4x4 square texture grid

;Create and store map heights from a hightmap
Dim map#(Gridx,Gridz)
hmap=LoadImage("hmap.bmp")
DrawImage hmap,0,0

For z=0 To Gridz
	For x=0 To Gridx
		GetColor x,z
		map(x,z)=Float(ColorRed())/255
	Next
Next

;make a bomb carrier

Sphere = CreateSphere(25)
PositionEntity Sphere,bomberx,bombery,bomberz
ScaleEntity Sphere,4,4,4

;make a bomb

bomb = CreateSphere(25)
PositionEntity bomb,bomberx,bombery-5,bomberz
ScaleEntity bomb,0.5,1.5,0.5

;bomb vars

bombs=0
Global bombstext=0






;Create a map mesh and scale to size
mesh=Create_Map(Gridx,Gridz,b1,3)
ScaleMesh mesh,1,6,1

;do next level of texturing using second
;set of texture coords

tex1=LoadTexture("mask.bmp")
TextureCoords tex1,1

tex2=LoadTexture("tex0.bmp")
TextureCoords tex2,1
TextureBlend tex2,3

EntityTexture mesh,tex1,0,1		;remember texture index 0 is for tileset
EntityTexture mesh,tex2,0,2

Color 255,255,255

pl=CreatePlane()
tex3=LoadTexture("tex0.bmp"):ScaleTexture tex3,64,64
EntityTexture pl,tex3
EntityOrder pl,1
EntityFX pl,1

EntityType bomb, 1
EntityType mesh, 2

Collisions 1,2,2,2 


MoveEntity Cam,0,0,-40

;WireFrame True
While Not KeyDown(1)
	
	If KeyDown(203) MoveEntity cam,-1,0,0
		If KeyDown(205) MoveEntity cam,1,0,0
			If KeyDown(200) MoveEntity cam,0,0,1
				If KeyDown(208) MoveEntity cam,0,0,-1
					
			
					If KeyDown(16) ;q
				
				TurnEntity cam,1,0,0
				
				Flip
				
			EndIf
			
			If KeyDown(30) ;a
					
				TurnEntity cam,-1,0,0
				
			EndIf
			
			
			If KeyDown(44) 
				
				TurnEntity cam,0,1,0
				
			EndIf
			
			
			If KeyDown(45) 
				
				TurnEntity cam,0,-1,0
				
			EndIf
			
			If KeyDown(48)   ;  B
				
				bombs=1
				
			EndIf
			
			
			If bombs = 1
				
				dropbombs()
				
			Else
				
				stopbombs()
				
			EndIf
	
	If KeyHit(57) Then
		For y=0 To Gridz-1
			For x=0 To Gridx-1
				tl=Rand(15)
				Paint_Tile(x,y,tl,mesh)
			Next
		Next
	End If
			
	UpdateWorld
	RenderWorld
	Text 0,0,"Press &lt;Space&gt; to randomize tiles"
	
	
	If bombstext=1
		Text 20,20,"Dropping a bomb...."
		
		MoveEntity bomb,0,-0.1,0
		
	Else
		Text 20,20,"Press B to drop a bomb."
		
	EndIf
	
	bombstext=0
	
	x = EntityX(bomb)
	y = EntityY(bomb)
	z = EntityZ(bomb)
	TFormPoint (x, y, z,  0, mesh  )
	
	h# = TerrainHeight(mesh,TFormedX(),TFormedY())
	
	If h &gt; 0 Then
		h = h -.1
		If h &lt; .5  Then  h = .5
		
		ModifyTerrain ( mesh, TFormedX()+ Rnd(-2,2), TFormedZ()+Rnd(-2,2),h#,True)	
		
		MakeTerrainCrater(bomb,mesh,radius#=2.5,th#=10,hardness#=0.5)
		
	End If 	
	
	
	Text 40,40," h is: "+h+" Bombs y is: "+y
	
	Flip
Wend

FreeEntity mesh
FreeEntity lit
FreeEntity cam
EndGraphics
End

;
;   Drop Bombs from the sphere
;
Function dropbombs()
	
	bombstext=1
	
End Function

Function stopbombs()
	
	bombstext=0
	
End Function

;
;	Create a flat plane all with tile 1
;
Function Create_Map(tilex,tilez,brush1,tile)
	mesh=CreateMesh()
	surf=CreateSurface(mesh,brush1)
	wid#=Float(1)/Float(Texture_Grid)
	u0#=wid*Float(tile Mod Texture_Grid)
	v0#=wid*Float(tile/Texture_Grid)
	u1#=u0+wid
	v1#=v0
	u2#=u1
	v2#=v0+wid
	u3#=u0
	v3#=v2
	u#=0
	v#=0
	stp#=1.0/Float(tilex)
	For z#=0 To tilez-1
		u=0
		For x#=0 To tilex-1
			h1#=map(x,z)
			h2#=map(x+1,z)
			h3#=map(x+1,z+1)
			h4#=map(x,z+1)
			AddVertex surf,x,h1,z,u0,v0
			VertexTexCoords surf,cnt,u,v,0,1
			
			AddVertex surf,x+1,h2,z,u1,v1
			VertexTexCoords surf,cnt+1,u+stp,v,0,1
			
			AddVertex surf,x+1,h3,z+1,u2,v2
			VertexTexCoords surf,cnt+2,u+stp,v+stp,0,1
			
			AddVertex surf,x,h4,z+1,u3,v3
			VertexTexCoords surf,cnt+3,u,v+stp,0,1
			
			AddTriangle surf,cnt,cnt+2,cnt+1
			AddTriangle surf,cnt,cnt+3,cnt+2
			cnt=cnt+4
			u=u+stp
		Next
		v=v+stp
	Next
	UpdateNormals mesh
	Return mesh
End Function

;paint one tile with new tile texture
Function Paint_Tile(tx,tz,texture_index,mesh)
	;firstly find texture coords
	wid#=Float(1)/Float(Texture_Grid)
	u0#=(wid*Float(texture_index Mod Texture_Grid))
	v0#=(wid*Float(texture_index/Texture_Grid))
	u1#=u0+wid
	v1#=v0
	u2#=u1
	v2#=v0+wid
	u3#=u0
	v3#=v2
	;retrieve the surface from the mesh
	surf=GetSurface(mesh,CountSurfaces(mesh))
	;find triangle at grid position tx,tz
	cnt=((tz*Gridz)+tx)*2
	;Now reset its texture coords
	index=TriangleVertex(surf,cnt,0)
	VertexTexCoords surf,index,u0,v1
	VertexTexCoords surf,index+1,u1,v1
	VertexTexCoords surf,index+2,u2,v2
	VertexTexCoords surf,index+3,u3,v3
End Function




Function MakeTerrainCrater(entity,Terrain,radius#=.5,th#=10,hardness#=0.5)
	
; ex#,ez#,x#,z#,terrainscale ,radius# , hardness#,d#,h#,scale#
	
; A righthandy function that easily makes a nice round crater. 
; Assumes terrain sections are 1x1 Blitz units (add Step to change). 
; Also fun to tinker with, and easy to add particles, crater ring, etc.
;
; entity=entity crater is created around
; terrain=terrain in which the crater is formed
; radius=crater's radius (default is 1)
; th=maximum height of any terrain section (default is 100)
; hardness=hardness of the ground, 1 is completely soft, 0 is completely solid (default is 1) 
	
	
	ex#=EntityX#(entity)/terrainscale ; added /terrainscale to make work
	ey#=EntityY#(entity)
	ez#=EntityZ#(entity)/terrainscale
	
	;=============================
	; generate the crater
	;=============================
	For x#=-radius# To radius#
		For z#=-radius To radius#
			If Sqr(x#^2+z#^2)&lt;=radius# And hardness#&lt;&gt;0
				d#=Sqr(x#*x#+z#*z#)	
				h#=TerrainHeight#(Terrain,ex+x#,ez+z#)
				scale#=th#/hardness#
				h#=h#+d#/scale#-radius#/scale#
				If h#&lt;0 Then h#=0
				ModifyTerrain(Terrain,ex+x#,ez+z#,h#,True)
				
				;ScorchTerrain(ex+x#,ez+z#) ;generate the black scorch 
				;ScorchTerrain(EntityX(marker2)/terrainscale,EntityZ(marker2)/terrainscale)	
			EndIf
		Next
	Next
	
End Function




</textarea><br><br>Provided in all its glory:<br><br><pre class=code>


;This is the TERRAIN TILING demo from the Blitz examples folder
; it is eluding me how to destruct the scenery, if indeed it is at all possible...

;Terrain Tiling 2
;David Bird
;dave@...
;use of u/v coords for tileset
;also example of texture coords set

;size of map
Const Gridx=64
Const Gridz=64

bomberx=22
bombery=59
bomberz=20

Graphics3D 640,480
SetBuffer BackBuffer()

lit=CreateLight()
cam=CreateCamera()

CameraRange cam,.1,1000
PositionEntity cam,32,20,50
TurnEntity cam,0,90,0


;Load brush with 16tiles
b1=LoadBrush("16tex.bmp")

Const Texture_Grid=4			;4x4 square texture grid

;Create and store map heights from a hightmap
Dim map#(Gridx,Gridz)
hmap=LoadImage("hmap.bmp")
DrawImage hmap,0,0

For z=0 To Gridz
	For x=0 To Gridx
		GetColor x,z
		map(x,z)=Float(ColorRed())/255
	Next
Next

;make a bomb carrier

Sphere = CreateSphere(25)
PositionEntity Sphere,bomberx,bombery,bomberz
ScaleEntity Sphere,4,4,4

;make a bomb

bomb = CreateSphere(25)
PositionEntity bomb,bomberx,bombery-5,bomberz
ScaleEntity bomb,0.5,1.5,0.5

;bomb vars

bombs=0
Global bombstext=0






;Create a map mesh and scale to size
mesh=Create_Map(Gridx,Gridz,b1,3)
ScaleMesh mesh,1,6,1

;do next level of texturing using second
;set of texture coords

tex1=LoadTexture("mask.bmp")
TextureCoords tex1,1

tex2=LoadTexture("tex0.bmp")
TextureCoords tex2,1
TextureBlend tex2,3

EntityTexture mesh,tex1,0,1		;remember texture index 0 is for tileset
EntityTexture mesh,tex2,0,2

Color 255,255,255

pl=CreatePlane()
tex3=LoadTexture("tex0.bmp"):ScaleTexture tex3,64,64
EntityTexture pl,tex3
EntityOrder pl,1
EntityFX pl,1

EntityType bomb, 1
EntityType mesh, 2

Collisions 1,2,2,2 


MoveEntity Cam,0,0,-40

;WireFrame True
While Not KeyDown(1)
	
	If KeyDown(203) MoveEntity cam,-1,0,0
		If KeyDown(205) MoveEntity cam,1,0,0
			If KeyDown(200) MoveEntity cam,0,0,1
				If KeyDown(208) MoveEntity cam,0,0,-1
					
			
					If KeyDown(16) ;q
				
				TurnEntity cam,1,0,0
				
				Flip
				
			EndIf
			
			If KeyDown(30) ;a
					
				TurnEntity cam,-1,0,0
				
			EndIf
			
			
			If KeyDown(44) 
				
				TurnEntity cam,0,1,0
				
			EndIf
			
			
			If KeyDown(45) 
				
				TurnEntity cam,0,-1,0
				
			EndIf
			
			If KeyDown(48)   ;  B
				
				bombs=1
				
			EndIf
			
			
			If bombs = 1
				
				dropbombs()
				
			Else
				
				stopbombs()
				
			EndIf
	
	If KeyHit(57) Then
		For y=0 To Gridz-1
			For x=0 To Gridx-1
				tl=Rand(15)
				Paint_Tile(x,y,tl,mesh)
			Next
		Next
	End If
			
	UpdateWorld
	RenderWorld
	Text 0,0,"Press &lt;Space&gt; to randomize tiles"
	
	
	If bombstext=1
		Text 20,20,"Dropping a bomb...."
		
		MoveEntity bomb,0,-0.1,0
		
	Else
		Text 20,20,"Press B to drop a bomb."
		
	EndIf
	
	bombstext=0
	
	x = EntityX(bomb)
	y = EntityY(bomb)
	z = EntityZ(bomb)
	TFormPoint (x, y, z,  0, mesh  )
	
	h# = TerrainHeight(mesh,TFormedX(),TFormedY())
	
	If h &gt; 0 Then
		h = h -.1
		If h &lt; .5  Then  h = .5
		
		ModifyTerrain ( mesh, TFormedX()+ Rnd(-2,2), TFormedZ()+Rnd(-2,2),h#,True)	
		
		MakeTerrainCrater(bomb,mesh,radius#=2.5,th#=10,hardness#=0.5)
		
	End If 	
	
	
	Text 40,40," h is: "+h+" Bombs y is: "+y
	
	Flip
Wend

FreeEntity mesh
FreeEntity lit
FreeEntity cam
EndGraphics
End

;
;   Drop Bombs from the sphere
;
Function dropbombs()
	
	bombstext=1
	
End Function

Function stopbombs()
	
	bombstext=0
	
End Function

;
;	Create a flat plane all with tile 1
;
Function Create_Map(tilex,tilez,brush1,tile)
	mesh=CreateMesh()
	surf=CreateSurface(mesh,brush1)
	wid#=Float(1)/Float(Texture_Grid)
	u0#=wid*Float(tile Mod Texture_Grid)
	v0#=wid*Float(tile/Texture_Grid)
	u1#=u0+wid
	v1#=v0
	u2#=u1
	v2#=v0+wid
	u3#=u0
	v3#=v2
	u#=0
	v#=0
	stp#=1.0/Float(tilex)
	For z#=0 To tilez-1
		u=0
		For x#=0 To tilex-1
			h1#=map(x,z)
			h2#=map(x+1,z)
			h3#=map(x+1,z+1)
			h4#=map(x,z+1)
			AddVertex surf,x,h1,z,u0,v0
			VertexTexCoords surf,cnt,u,v,0,1
			
			AddVertex surf,x+1,h2,z,u1,v1
			VertexTexCoords surf,cnt+1,u+stp,v,0,1
			
			AddVertex surf,x+1,h3,z+1,u2,v2
			VertexTexCoords surf,cnt+2,u+stp,v+stp,0,1
			
			AddVertex surf,x,h4,z+1,u3,v3
			VertexTexCoords surf,cnt+3,u,v+stp,0,1
			
			AddTriangle surf,cnt,cnt+2,cnt+1
			AddTriangle surf,cnt,cnt+3,cnt+2
			cnt=cnt+4
			u=u+stp
		Next
		v=v+stp
	Next
	UpdateNormals mesh
	Return mesh
End Function

;paint one tile with new tile texture
Function Paint_Tile(tx,tz,texture_index,mesh)
	;firstly find texture coords
	wid#=Float(1)/Float(Texture_Grid)
	u0#=(wid*Float(texture_index Mod Texture_Grid))
	v0#=(wid*Float(texture_index/Texture_Grid))
	u1#=u0+wid
	v1#=v0
	u2#=u1
	v2#=v0+wid
	u3#=u0
	v3#=v2
	;retrieve the surface from the mesh
	surf=GetSurface(mesh,CountSurfaces(mesh))
	;find triangle at grid position tx,tz
	cnt=((tz*Gridz)+tx)*2
	;Now reset its texture coords
	index=TriangleVertex(surf,cnt,0)
	VertexTexCoords surf,index,u0,v1
	VertexTexCoords surf,index+1,u1,v1
	VertexTexCoords surf,index+2,u2,v2
	VertexTexCoords surf,index+3,u3,v3
End Function




Function MakeTerrainCrater(entity,Terrain,radius#=.5,th#=10,hardness#=0.5)
	
; ex#,ez#,x#,z#,terrainscale ,radius# , hardness#,d#,h#,scale#
	
; A righthandy function that easily makes a nice round crater. 
; Assumes terrain sections are 1x1 Blitz units (add Step to change). 
; Also fun to tinker with, and easy to add particles, crater ring, etc.
;
; entity=entity crater is created around
; terrain=terrain in which the crater is formed
; radius=crater's radius (default is 1)
; th=maximum height of any terrain section (default is 100)
; hardness=hardness of the ground, 1 is completely soft, 0 is completely solid (default is 1) 
	
	
	ex#=EntityX#(entity)/terrainscale ; added /terrainscale to make work
	ey#=EntityY#(entity)
	ez#=EntityZ#(entity)/terrainscale
	
	;=============================
	; generate the crater
	;=============================
	For x#=-radius# To radius#
		For z#=-radius To radius#
			If Sqr(x#^2+z#^2)&lt;=radius# And hardness#&lt;&gt;0
				d#=Sqr(x#*x#+z#*z#)	
				h#=TerrainHeight#(Terrain,ex+x#,ez+z#)
				scale#=th#/hardness#
				h#=h#+d#/scale#-radius#/scale#
				If h#&lt;0 Then h#=0
				ModifyTerrain(Terrain,ex+x#,ez+z#,h#,True)
				
				;ScorchTerrain(ex+x#,ez+z#) ;generate the black scorch 
				;ScorchTerrain(EntityX(marker2)/terrainscale,EntityZ(marker2)/terrainscale)	
			EndIf
		Next
	Next
	
End Function


</pre> <br><br></td></tr></table><br>
<a name="1315790"></a>

<a name="1315791"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> You have an example on how to deform a terrain in the castle demo Blitz3D\samples\mak\castle <br><br></td></tr></table><br>
<a name="1315795"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> @RemiD, thanks I'll refer to that. I wasn't sure if I could treat a 'mesh' as a 'terrain' and whether the 2 were interchangeable. <br><br></td></tr></table><br>
<a name="1315796"></a>

<a name="1315797"></a>

<a name="1315798"></a>

<a name="1315800"></a>

<a name="1315801"></a>

<a name="1315802"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> For what you want to do a terrain is better, because you can modify one (or several) height(s) at X,Z, and the ROAM algorithm will manages the recreation of the terrain depending on where the camera is and depending on the maximum LOD (level of detail) that you have defined (more details around the camera, less details far away)<br><br>Take a look at what effect you can achieve with 2 terrains : <a href="http://www.blitzbasic.com/gallery/view_pic.php?id=2478&amp;gallery=hr&amp;page=1" target="_blank">http://www.blitzbasic.com/gallery/view_pic.php?id=2478&amp;gallery=hr&amp;page=1</a><br><br>I have never seen a game where you can digg in the ground like i demonstrated in this demo ;) (but the ambiance was very dark (i was listening a bit too much at Marilyn Manson's music at the time :P)) <br><br></td></tr></table><br>
<a name="1315799"></a>

<a name="1315803"></a>

<a name="1315804"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thankyou, I was beginning to suspect I had made an error trying to deform a simple mesh with a function that I suspect was designed to be used with Terrains.<br><br>The code here leads me to suspect 'LoadTerrain' may do some trick stuff when loading the heightmap to allow it be be deformed afterwards.<br><br><a href="http://jnoodle.com/Blitz3D/lesson10.html" target="_blank">http://jnoodle.com/Blitz3D/lesson10.html</a> <br><br></td></tr></table><br>
<a name="1315811"></a>

<a name="1315813"></a>

<a name="1315815"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> @RemiD<br>It's looking pretty cool. But I don't quite get why you have to use 2 terrains for this and how you would apply that?<br><br>I've done one in which I could throw grenades and then it would create a relatively nice crater in the terrain(also possible to dig in that fashion), but as I like my terrains pretty big &amp; high they could come across a bit less round. I had to make a compromise in details. <br><br></td></tr></table><br>
<a name="1315830"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Rick&gt;&gt;in order to be able to deform a terrain precisely you need it to scale it on the y axis not too much, for example i used a scale of 25.5 on the y axis. Why ? Because you can have a maximum of 255 heights in a heightmap (between 0 and 255), so if the scale on the y axis is 25.5, this means that you can have a height precision of 0.1, so you can digg in the ground by 0.1 step, so it looks convincing.<br><br>For this demo, i used 2 terrains because one represents the grass and the other represents the dirt... Only when you digg you can see the dirt, but you can probably achieve a similar effect using a color texture... <br><br></td></tr></table><br>
<a name="1315839"></a>

<a name="1315840"></a>

<a name="1315841"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> @RemiD, yeah the ambience is pretty dark, used to great effect.<br><br><div class="quote"> For this demo, i used 2 terrains because one represents the grass and the other represents the dirt... Only when you digg you can see the dirt, but you can probably achieve a similar effect using a color texture...  <br></div> ingenius !<br><br>I've had a look at the castle demo, and it whilst it puts hole 'sprites' on the landscape it doesn't seem to deform the terrain whcih is what I was hoping for. The Castle demo is a good example of what can be achieved with Blitz3D nevertheless. <br><br></td></tr></table><br>
<a name="1315844"></a>

<a name="1315845"></a>

<a name="1315846"></a>

<a name="1315847"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Making progress, although my terrain currently 'grows' towards the bomber before its released:<br><br><img src="http://www.wishingwellsoftware.co.uk/bomb2.png"><br><br>More investigation required, pleasant progress though, thanks for the help. <br><br></td></tr></table><br>
<a name="1315849"></a>

<a name="1315850"></a>

<a name="1315852"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Blitzplotter <br>If dropping the bomb then when bomb entity collided with the terrain then you stop it moving, store it's x,y,z, hide the bomb entity(and/or let it explode using particles or sprite animation with a nice boom sound) and run the modify terrain function on that spot to create a nice crater.<br><br>@RemiD<br>Ah, yeah indeed in that sense it's a great idea. I was using a scorch texture for it, but this might be better looking combined with that.<br><br>-Does having multiple terrains impact fps a lot? <br><br></td></tr></table><br>
<a name="1315854"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Rick, thanks for the fb, that was an approach I was considering prior to the green terrain code, within my first attempt (the rocky image at the top).<br><br>The modify terrain function seems to make the terrain grow upwards at the moment before the bomb is even released, (hence the green spike in the image) I suspect I need to play around with the collision vars as the bomb falls straight through the terrain on the green snapshot.<br><br>I'm just pleased the terrain is deforming at all ;) <br><br></td></tr></table><br>
<a name="1315862"></a>

<a name="1315866"></a>

<a name="1315867"></a>

<a name="1315868"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Perhaps this example helps in understanding the whole modify terrain thingy:<br><br><b>ModifyTerrain.bb</b><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Graphics3D 640, 480,32
SetBuffer BackBuffer()

light = CreateLight()
RotateEntity light, 90, 0, 0

Global terrainscale=1
Global height#=0.0

; Create/Load terrain **
terrain=LoadTerrain( "terrain_hmap.jpg" ) ;512x512x256 heightmap so terra_size=512. 
; Texture terrain
grass_tex=LoadTexture("media/mossyground.bmp")
EntityTexture terrain,grass_tex
ScaleTexture grass_tex,10,10

; Create terrain (if not loading)
;terrain = CreateTerrain(16)
;grass_tex = LoadTexture("terrain_tex.jpg")
;EntityTexture terrain, grass_tex

ScaleEntity terrain, terrainscale, 8, terrainscale
TerrainDetail terrain,2000*terrainscale,True : TerrainShading terrain,True
ModifyTerrain terrain, 8, 8, 1 ; put in test spike

pivot=CreatePivot()
;PositionEntity pivot at middle of terrain at groundlevel
PositionEntity pivot,TerrainSize(terrain)/2,TerrainHeight(terrain,EntityX(pivot),EntityZ(pivot)) ,TerrainSize(terrain)/2


ball=CreateSphere(10,pivot) ; create a marker on terrain that shows our current position on terrain
ScaleEntity ball,.1,.1,.1 
EntityColor ball,255,0,0

camera=CreateCamera(pivot)
PositionEntity camera, 0, 1, -5 ; position camera so we can see



While Not KeyHit(1) ;main loop until Esc pressed.

	; Toggle wireframe enable value between true and false when spacebar is pressed 		
	If KeyHit( 57 )=True Then enable=1-enable : Delay 100 : Wireframe enable ; Enable/disable wireframe rendering 


	; Move ball+camera (using pivot) with  cursorkeys
	If KeyDown(205) = 1 Then TurnEntity pivot, 0, -1, 0
	If KeyDown(203) = 1 Then TurnEntity pivot, 0, 1, 0
	If KeyDown(208) = 1 Then MoveEntity pivot, 0, 0, -0.05
	If KeyDown(200) = 1 Then MoveEntity pivot, 0, 0, 0.05


	
	; Get terrain height at marker position
	height#=TerrainHeight(terrain,EntityX(pivot)/terrainscale,EntityZ(pivot)/terrainscale)  ; shouldnt be divided?
	

	; If PgUp pressed then increase height# value and modify terrain
	If KeyDown(201)=True
		If height#&lt;=0.8
			height#=height#+0.01
			ModifyTerrain terrain,EntityX(pivot)/terrainscale,EntityZ(pivot)/terrainscale,height#;,True
		EndIf
	EndIf
	
	; If PgDn pressed then decrease height# value and modify terrain
	If KeyDown(209)=True
		If height#&gt;=.01
			height#=height#-0.001
			ModifyTerrain terrain,EntityX(pivot)/terrainscale,EntityZ(pivot)/terrainscale,height#;,True
		EndIf
	EndIf

	; Position ball, taking into account x, y and z scales of terrain
	PositionEntity pivot,EntityX(pivot),TerrainY(terrain,EntityX(pivot),EntityY(pivot),EntityZ(pivot)),EntityZ(pivot)

	;Study: perhaps do manual heightcalc conversion would be more accurate.(try without scaling First)
	;Tried below: no satisfying results,too jurky. Jumps from one tri to another.	
	;PositionEntity pivot,EntityX(pivot),256/100*height#*4 ,EntityZ(pivot) ; height of terrain / 100 = 1% * height(=%tage) *4?=TerrainY??
	
	
	UpdateWorld	
	RenderWorld

	; Update HUD
	info$=EntityX(pivot)+", "+EntityZ(pivot)+", "+ height#
	LabelEntity (camera, pivot, info$)
	Text 0, 0, "Use Cursorkeys to move arround..."
	
	Flip


Wend
End 


Function LabelEntity (camera, entity, label$) ;entity label (txt at entity position)
	If EntityInView (entity, camera)
		CameraProject camera, EntityX (entity), EntityY (entity)+1, EntityZ (entity)
		w = StringWidth (label$)
		h = StringHeight (label$)
		x = ProjectedX () - (w / 2) - 1
		y = ProjectedY () - (h / 2) - 1
		Color 0, 0, 0
		Rect x, y, w + 2, h + 2, 1
		Color 255, 255, 255
		Text x, y, label$
	EndIf
End Function




;HUD

; load HUD
;	aim_sprite=LoadImage( "aim.bmp" )	
;	MidHandle aim_sprite
;   DrawImage aim_sprite,320,240+50 ; aim image in center of screen ;in main after render
</textarea><br><br>Also some bits of code I pulled out of my own game(haven't got time to rework it for it all to be working outside of it, so hope is clear and usefull to you:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
;----------------------------initialization section----------------------

;
bom =LoadMesh("Media\3D_Models\Weapons\bom.3ds")
ScaleMesh bom ,.3,.3,.3 ; (whatever is suitable)
bom_tex=LoadTexture("media\blasted.png")

ScaleTexture bom_tex,.3,.3
TextureFilter bom_tex,1
EntityTexture bom,bom_tex

Collisions col_bom,col_terrain,2,1


Type bom
	Field entity
	Field inflight
	Field velocity#
End Type
	
For ammount=1 To 20
	b.bom= New bom
	b\entity=CopyEntity(bom)
Next
	
HideEntity bom


;----------------------------functions---------------------------------

Function UpdateGrenade() ; &lt;&lt; to be called in main loop..

	For b.bom = Each bom
		If b\inflight=1 ; 1 = true

			If b\velocity&gt;1;1.1 ;Then cycle is at 0; do no longer turn grenade(iaw keep it pointing downwards)
			
				RotateMesh b\entity,4,1,1 
				b\velocity#=b\velocity# * air_friction#
				TurnEntity b\entity,1,0,0 :fall=0
				
			Else 
				;fall=-.5

			EndIf	
	
			MoveEntity b\entity,0,0,b\velocity
	
			
			bomx#=EntityX(b\entity)
			bomy#=EntityY(b\entity)
			bomz#=EntityZ(b\entity)
				
			PositionEntity b\entity,bomx#,bomy#+fall,bomz#	;fall to earth when velocity gets below threshold 
				
			; if bom is at terrainheight then explode &amp; hide
			If bomy#&lt;TerrainY(terrain,bomx#,bomy#,bomz#)+4 Or EntityCollided(b\entity,col_terrain) ; create different response for what has been hit later..

				b\inflight=0 ;flight has finished, so set flag &amp; a MakeBomExplosion

			
				;MakeBomExplosion(b\entity)
				MakeTerrainCrater(e\ent,terrain,1.5,10*5,.5) ;crater(entity,Terrain,radius#=5,th#=10,hardness#=0.5)

				
				HideEntity b\entity ; hide the collided bom
		
			EndIf

			If bomy# &lt; 0 Then b\inflight=0 ; 0=heightlevel, usefull for when hit water

						
		EndIf
	Next 
End Function


Function MakeTerrainCrater(entity,Terrain,radius#=.5,th#=10,hardness#=0.5)

; ex#,ez#,x#,z#,terrainscale ,radius# , hardness#,d#,h#,scale#

; A righthandy function that easily makes a nice round crater. 
; Assumes terrain sections are 1x1 Blitz units (add Step to change). 
; Also fun to tinker with, and easy to add particles, crater ring, etc.
;
; entity=entity crater is created around
; terrain=terrain in which the crater is formed
; radius=crater's radius (default is 1)
; th=maximum height of any terrain section (default is 100)
; hardness=hardness of the ground, 1 is completely soft, 0 is completely solid (default is 1) 


	ex#=EntityX#(entity)/terrainscale ; added /terrainscale to make work
	ey#=EntityY#(entity)
	ez#=EntityZ#(entity)/terrainscale
	
	;=============================
	; generate the crater
	;=============================
	For x#=-radius# To radius#
		For z#=-radius To radius#
			If Sqr(x#^2+z#^2)&lt;=radius# And hardness#&lt;&gt;0
				d#=Sqr(x#*x#+z#*z#)	
				h#=TerrainHeight#(Terrain,ex+x#,ez+z#)
				scale#=th#/hardness#
				h#=h#+d#/scale#-radius#/scale#
				If h#&lt;0 Then h#=0
				ModifyTerrain(Terrain,ex+x#,ez+z#,h#,True)
				
				;ScorchTerrain(ex+x#,ez+z#) ;generate the black scorch 
			EndIf
		Next
	Next
	
End Function

</textarea> <br><br></td></tr></table><br>
<a name="1315865"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br> it doesn't seem to deform the terrain whcih is what I was hoping for.<br> <br></div><br>yes it does, search for "modifyterrain" <br><br></td></tr></table><br>
<a name="1315869"></a>

<a name="1315870"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> What can be confusing is which value to put in the height parameter of ModifyTerrain()<br>You can know the y# at x,z by using TerrainY at x,z (or by picking it from top to down at x,z)<br>You also know the scale on the y axis that you have defined when creating your terrain (i suggest to use 25.5 so that you can have a precision of 0.1unit when you digg in it)<br><br>So for a terrain with a max height of 25.5units, the height 0 corresponds to 0y and the height 1.0 corresponds to 25.5y<br>if you know that the y at x,z is 3.0y, and you want to digg a hole of 0.5 unit, how do you calculate the height (for modifyterrain())<br>3.0/25.5 = 0.117647 (the current height)<br>0.5/25.5 = 0.019607 (the height of the hole you want to digg)<br>0.117647 - 0.019607 =  0.09804 or (3.0-0.5)/25.5 = 0.09804 (the new height after having digged the hole)<br><br>That's what i remember, but test it just to be sure...<br><br><br>Another reason to choose a scale of 25.5 on the y axis is that then each shade of grey of each pixel on your heightmap represents a height with a 0.1 precision. <br><br></td></tr></table><br>
<a name="1315875"></a>

<a name="1315984"></a>

<a name="1316071"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Rick and RemiD, thanks for the feedback, I'll try it as soon as my son vacates (my...) PC. I really appreciate it.<br><br>[edit] Am considering an a, b and c-bomb approach to learning my terrain deformations.<br><br><img src="http://www.wishingwellsoftware.co.uk/abc.jpg"> <br><br></td></tr></table><br>
<a name="1316072"></a>

<a name="1316073"></a>

<a name="1316090"></a>

<a name="1316091"></a>

<a name="1316093"></a>

<a name="1316094"></a>

<a name="1316095"></a>

<a name="1316098"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> @RemiD and [EDIT] Rick Nasher, thank you for your assistance, its been a (minor) journey, enjoyable and really quite gratifying nonetheless ;)<br><br>I even dug out my printed B3D manual, which although has seen better days, still also helps.<br><br><img src="http://www.wishingwellsoftware.co.uk/coolio.png"><br><br><img src="http://www.wishingwellsoftware.co.uk/success.png"><br><br>the code (not too pretty - but it works):<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">

Global screen_width = 800, screen_height = 600

Graphics3D screen_width, screen_height, 32,1
SetBuffer BackBuffer() 

;the following creates a terrain of 64 triangles 

;createdTerrain = CreateTerrain(32)  ; a terrain of 0 to 32 along x and z axis
									 ; a scale of 0 to 1 on the y-axis
									 ; 32 x 1 x 32 - now possibly 640 x 1 x 640
light = CreateLight()
RotateEntity light, 90, 0, 0

Global terrainscale=4
Global height#=0.0

createdTerrain = LoadTerrain( "terrain_hmap.jpg" )

tex_A = LoadTexture( "A.png" )

ScaleTexture tex_A, 1, 1

EntityTexture createdTerrain, tex_A



ScaleEntity createdTerrain, terrainscale, 25.5, terrainscale
TerrainDetail createdTerrain,2000*terrainscale,True : TerrainShading createdTerrain,True


ModifyTerrain createdTerrain, 8, 8, 1, 1 ; put in test spike
ModifyTerrain createdTerrain, 13, 8, 1, 1 ; put in test spike
ModifyTerrain createdTerrain, 18, 8, 1, 1 ; put in test spike
ModifyTerrain createdTerrain, 24, 8, 1, 1 ; put in test spike
ModifyTerrain createdTerrain, 33, 8, 1, 1 ; put in test spike

ModifyTerrain createdTerrain, 5, 10, 1, 1; put in test spike
ModifyTerrain createdTerrain, 5, 20, 1, 1; put in test spike



;Bravo's terrain------------------------------

landTerrain = CreateTerrain(4)

ScaleEntity landTerrain,3,25.5,3

MoveEntity landTerrain,190,0,-30

tex_B = LoadTexture( "B.png" )

ScaleTexture tex_B, 5, 5

EntityTexture landTerrain, tex_B


;Chariles terrain-----------------------------

ClandTerrain = CreateTerrain(4)


ScaleEntity ClandTerrain,3,25.5,3

MoveEntity ClandTerrain,390,0,-30

tex_C = LoadTexture( "C.png" )

ScaleTexture tex_C, 5, 5

EntityTexture ClandTerrain, tex_C



;---------------------------------------
;insertions;
;---------------------------------------

lit=CreateLight()
cam=CreateCamera()

CameraRange cam,.1,1000
PositionEntity cam,32,20,25
TurnEntity cam,0,90,0





Const BEAKS=9
Const PEAKS=3

riseup=0

Global raiseBy#=0.2

bomberx=20
bombery=150
bomberz=50
bombSpeed#=0.2


;Bbomberx=204
;Bbombery=100
;Bbomberz=6
;BbombSpeed#=2.2

Bbomberx=25
Bbombery=200
Bbomberz=100
BbombSpeed#=0.4


;Cbomberx=404
;Cbombery=150
;Cbomberz=9
;CbombSpeed#=2.2



Cbomberx=16
Cbombery=220
Cbomberz=350
CbombSpeed#=0.8

Global bomb_a_falling=0
Global bomb_b_falling=0
Global bomb_c_falling=0

Global bomb_a_exploding=0
Global bomb_b_exploding=0
Global bomb_c_exploding=0

xDivide=5.2
zDivide=4.2

Bsize=6


;make a bomb carrier

Blimp = CreateSphere(25)
PositionEntity Blimp,bomberx,bombery,bomberz
ScaleEntity Blimp,Bsize,Bsize,Bsize

;make a  A bomb

bomb = CreateSphere(25)
PositionEntity bomb,bomberx,bombery-5,bomberz
ScaleEntity bomb,0.9,1.5,0.9

;make a Bravo bomb carrier

BBlimp = CreateSphere(25)
PositionEntity BBlimp,Bbomberx,Bbombery,Bbomberz
ScaleEntity BBlimp,Bsize,Bsize,Bsize

;make a B bomb

Bbomb = CreateSphere(25)
PositionEntity Bbomb,Bbomberx,Bbombery-5,Bbomberz
ScaleEntity Bbomb,0.9,1.5,0.9

;make a C bomb carrier

CBlimp = CreateSphere(25)
PositionEntity CBlimp,Cbomberx,Cbombery,Cbomberz
ScaleEntity CBlimp,Bsize,Bsize,Bsize

;make a C bomb

Cbomb = CreateSphere(25)
PositionEntity Cbomb,Cbomberx,Cbombery-5,Cbomberz
ScaleEntity Cbomb,0.9,1.5,0.9

;bomb vars

bombs=0
Global bombstext=0


;Assign collision numbers to items

EntityType bomb, 1
EntityType createdTerrain, 3    ; A
EntityType Blimp, 4

;-------------------------------------

EntityType Bbomb,7
EntityType BBlimp,8
EntityType landterrain, 2       ; B

;--------------------------------------

EntityType Cbomb,5
EntityType CBlimp,6
EntityType CLandTerrain,9       ; C


;------------------------------------------------------------
;
; Collisions 1 sph to sph, 2 sph to poly, 3 sph to box
; response 1:stop,  2:full sliding collision,   
; 3:slide 2 - prevent entities from sliding down slopes?
;
;----------------------------------------------------------

Collisions 1,2,2,1

Collisions 1,3,2,1     ;makes bomb A land on the terrain



;---------------------------
; bBomb collisions
;---------------------------

Collisions 7,2,2,1

Collisions 7,3,2,1  ;lets B Bomb collide with A Terrain


;------------------------
; cBomb collisions
;------------------------

Collisions 5,9,2,1

;------------------------

MoveEntity Cam,0,90,-340


;MoveEntity createdTerrain,20,15,10



While Not KeyDown(1)
	
	If KeyDown(203) MoveEntity cam,-1,0,0
		If KeyDown(205) MoveEntity cam,1,0,0
			If KeyDown(200) MoveEntity cam,0,0,1
				If KeyDown(208) MoveEntity cam,0,0,-1
					
					
					If KeyDown(16) ;q
						
						TurnEntity cam,1,0,0
						
						Flip
						
					EndIf
					
					If KeyDown(30) ;a
						
						TurnEntity cam,-1,0,0
						
					EndIf
					
					
					If KeyDown(44) 
						
						TurnEntity cam,0,1,0
						
					EndIf
					
					
					If KeyDown(45) 
						
						TurnEntity cam,0,-1,0
						
					EndIf
					
					If KeyDown(48)   ;  B
						
						bombs=1
						
					EndIf
					
					If KeyDown(19)   ;  R  -  Rise the terrain up
						
						riseup=1
						
					Else
						
						riseup = 0
						
					EndIf
					
					
					If riseup = 1
						
						pickgrid=TerrainSize(createdTerrain)
						
						raiseTerrain(createdTerrain,pickgrid)
						
					EndIf
					
					
					
					If bombs = 1
						
						dropbombs()
						
					Else
						
						stopbombs()
						
					EndIf
					
					UpdateWorld
					RenderWorld
					
					If bombstext=1
						Text 20,20,"Dropping A, B and C bombs...."
						
						;---------- bomb A --------------------------
						
						If bomb_a_falling=1
							
							
							MoveEntity bomb,0,-bombSpeed,0
							
							bomx#=EntityX(bomb)
							bomy#=EntityY(bomb)
							bomz#=EntityZ(bomb)
							
							Text 40,100,"bomy#: "+bomy#
							
							Text 40,120,"TerrainY#:  "+TerrainY#(createdTerrain,bomx#,bomy#,bomz#)
							
							;TerrainY is 15.0
							;15.0/25.5 = 0.588
							;lets say I want to dig a 4 unit hole, this'll equate to 4x0.588
							;0.5/25.5 = 0.019607
							; 0.588 - 0.08 = 0.50 (new heightnafter hole dig)
							
							If bomy#-3&lt;TerrainY#(createdTerrain,bomx#,bomy#,bomz#)
								
								bomb_a_exploding=1
								
								TFormPoint (x, y, z,  createdTerrain, bomb  )
							
							Else
								
								Text 40,160,"Bomb a still intact with bomy#:"+bomy#+" not less than TerrainY#: "+TerrainY#(createdTerrain,bomx#,bomy#,bomz#)
								
								
								
							EndIf
							
							
						EndIf
						
						If bomb_a_exploding=1
							
							x = EntityX(bomb)
							y = EntityY(bomb)
							z = EntityZ(bomb)
							
							ModifyTerrain createdTerrain, x/xdivide, (z/zdivide), 0.02, 1; 
							ModifyTerrain createdTerrain, (x/xdivide)+1, (z/zdivide)+1, 0.02, 1; 
							ModifyTerrain createdTerrain, (x/xdivide)+1, (z/zdivide)+1, 0.02, 1; 
							ModifyTerrain createdTerrain, x/xdivide, (z/zdivide)+1, 0.02, 1; 
							
							;if bomb is at terrain level explode and hide
							;Text 40,40,"Exploding Bomb A"
							
						EndIf
						
						
						
						;---------- bomb B --------------------------
						
						If bomb_b_falling=1
							
						
							MoveEntity Bbomb,0,-BbombSpeed,0    
							
							bombx#=EntityX(Bbomb)
							bomby#=EntityY(Bbomb)
							bombz#=EntityZ(Bbomb)
							
							If bomby#-3&lt;TerrainY#(createdTerrain,bombx#,bomby#,bombz#); Or ; Failing to crater, commented
								
								bomb_b_exploding=1
								
								Text 40,180,"Bomb B Booming............"
								
							Else
								
								Text 40,180,"Bomb B still intact with bomby#:"+bomby#+" not less than TerrainY#: "+TerrainY#(createdTerrain,bombx#,bomby#,bombz#)
								
								
								
							EndIf
							
						EndIf
						
						;If 0
						
						If bomb_b_exploding=1
							
							
							Text 40,60,"Attempting to Crater where bomb B was"
							
							bx = EntityX(Bbomb)
							by = EntityY(Bbomb)
							bz = EntityZ(Bbomb)
							
							ModifyTerrain createdTerrain, bx/xdivide, (bz/zdivide), 0.02, 1; 
							ModifyTerrain createdTerrain, (bx/xdivide)+1, (bz/zdivide)+1, 0.02, 1; 
							ModifyTerrain createdTerrain, (bx/xdivide)+1, (bz/zdivide)+1, 0.02, 1; 
							ModifyTerrain createdTerrain, bx/xdivide, (bz/zdivide)+1, 0.02, 1; 
							
							
							;Text 40,40,"Exploding Bomb B"
							
						EndIf
						
					;EndIf
						
						
						;---------- bomb C --------------------------
						
						If bomb_c_falling=1
							
							
							MoveEntity Cbomb,0,-CbombSpeed,0    
							
							bomcx#=EntityX(Cbomb)
							bomcy#=EntityY(Cbomb)
							bomcz#=EntityZ(Cbomb)
							
							If bomcy#-3&lt;TerrainY#(createdTerrain,bomcx#,bomcy#,bomcz#); Or ; Failing to crater, commented
								
								bomb_c_exploding=1
								
								;Text 40,220,"bomc c Booming............"
								
							Else
								
								;Text 40,220,"bomc c still intact with bomcy#:"+bomcy#+" not less than TerrainY#: "+TerrainY#(createdTerrain,bomcx#,bomcy#,bomcz#)
								
								
								
							EndIf
							
						EndIf
						
						;If 0
						
						If bomb_c_exploding=1
							
							
							Text 40,60,"Attempting to Crater where bomc B was"
							
							bx = EntityX(Cbomb)
							by = EntityY(Cbomb)
							bz = EntityZ(Cbomb)
							
							ModifyTerrain createdTerrain, bx/xdivide, (bz/zdivide), 0.02, 1; 
							ModifyTerrain createdTerrain, (bx/xdivide)+1, (bz/zdivide)+1, 0.02, 1; 
							ModifyTerrain createdTerrain, (bx/xdivide)+1, (bz/zdivide)+1, 0.02, 1; 
							ModifyTerrain createdTerrain, bx/xdivide, (bz/zdivide)+1, 0.02, 1; 
							
							
							;Text 40,40,"Exploding bomb C"
							
						EndIf
						
					Else
						Text 20,20,"Press B to drop a bomb., Press R to raise the terrain - set peaks required by PEAKS variable."
						Text 20,1,"                              Cursors, Q, A, Z, W manipulate camera"
					EndIf
					
					Text 300,40,"Raising Terrain by: "+raiseBy+" thru a grid of : "+pickgrid
					
					bombstext=0
					
					Flip
					
				Wend
				
				
				FreeEntity createdTerrain
				FreeEntity landterrain
				FreeEntity lit
				FreeEntity cam
				EndGraphics
				End
				
				
				
Function dropbombs()
	
	bombstext=1
	
	bomb_a_falling=1
	bomb_b_falling=1
	bomb_c_falling=1
	
	
End Function

Function stopbombs()
	
	bombstext=0
	
End Function

Function MakeTerrainCrater(entity,Terrain,radius#=.5,th#=10,hardness#=0.5)
	
; ex#,ez#,x#,z#,terrainscale ,radius# , hardness#,d#,h#,scale#
	
; A righthandy function that easily makes a nice round crater. 
; Assumes terrain sections are 1x1 Blitz units (add Step to change). 
; Also fun to tinker with, and easy to add particles, crater ring, etc.
;
; entity=entity crater is created around
; terrain=terrain in which the crater is formed
; radius=crater's radius (default is 1)
; th=maximum height of any terrain section (default is 100)
; hardness=hardness of the ground, 1 is completely soft, 0 is completely solid (default is 1) 
	
	
	ex#=EntityX#(entity)/terrainscale ; added /terrainscale to make work
	ey#=EntityY#(entity)
	ez#=EntityZ#(entity)/terrainscale
	
	;=============================
	; generate the crater
	;=============================
	For x#=-radius# To radius#
		For z#=-radius To radius#
			If Sqr(x#^2+z#^2)&lt;=radius# And hardness#&lt;&gt;0
				d#=Sqr(x#*x#+z#*z#)	
				h#=TerrainHeight#(Terrain,ex+x#,ez+z#)
				scale#=th#/hardness#
				h#=h#+d#/scale#-radius#/scale#
				If h#&lt;0 Then h#=0
				;ModifyTerrain(Terrain,ex+x#,ez+z#,h#,True)
				
				ModifyTerrain(Terrain,ex+x#,ez+z#,0.5,True)
				
				;ScorchTerrain(ex+x#,ez+z#) ;generate the black scorch 
			EndIf
		Next
	Next
	
End Function


Function raiseTerrain(createdTerrain,pickgrid)
	
	raiseBy=raiseBy+0.02
	
	If raiseBy=1 Then raiseBy=0.01
	
	For x=1 To pickgrid Step PEAKS
		
		For z=1 To pickgrid Step BEAKS
	
			ModifyTerrain(createdTerrain,x,z,raiseBy,True)
	
		Next
		
	Next
	
End Function






</textarea> <br><br></td></tr></table><br>
<a name="1316096"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RustyKristi</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=3284" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=3284</a><br><div class="quote"> Generated with help from RemiD and Rusty <br></div><br><br>Hey BP, Looks interesting, though I should correct you to credit Rick Nasher and not me, but thanks for thinking of me though and I hope you're not confused. ;-) <br><br></td></tr></table><br>
<a name="1316097"></a>

<a name="1316100"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ooops, thanks Rusty for pointing out my typo - all the RRrrrr s ;)<br><br>Sorry Rick, thanks again for your help. I'm recovering from right knee ACL surgery and am using B3D to help see me through ;)<br><br>Next, dig out some of my old JV-ODE physics lib stuff and integrate some outlandish explosions with smoke and some sonic booms..... <br><br></td></tr></table><br>
<a name="1316099"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RustyKristi</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> haha np. oh hey, feel better soon. :-) <br><br></td></tr></table><br>
<a name="1316102"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Blitzplotter&gt;&gt;curious to test your code, but please provide the necessary files... <br><br></td></tr></table><br>
<a name="1316103"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> Will wrap the necessary files later, thx for your help. <br><br></td></tr></table><br>
<a name="1316106"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> @RemiD, here you go:<br><br><a href="http://www.wishingwellsoftware.co.uk/setup_3bombs_Blitz3D.exe" target="_blank">http://www.wishingwellsoftware.co.uk/setup_3bombs_Blitz3D.exe</a><br><br>All the files required to run the code ;)<br><br>I'd to use Innossetup as I don't have Winzip installed or 7zip for that matter, enjoy. <br><br></td></tr></table><br>
<a name="1316111"></a>

<a name="1316112"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yue</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> <img src="http://i64.tinypic.com/nl21k1.png"><br><br>Something tells me that is the 1106 version of Blitz3D. <br><br></td></tr></table><br>
<a name="1316113"></a>

<a name="1316114"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> The code is available to compile yourself within the installed prog directory,  sorry if I'm running and old B3d, I believe the one I'm using is compatible with fastlibs,  if not W10, I'm on W7 and works fine for moi. <br><br></td></tr></table><br>
<a name="1316117"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yue</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello, I commented that Nvidia released a new update drivers for my graphics card . 341.96 WHQL, and apparently the closure problem in Blitz3D 1,106 apliacacin I was solved , I will make more evidence. <br><br></td></tr></table><br>
<a name="1316118"></a>

<a name="1316130"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh, alright,  the code is only one file plus a heightmap and 3 textures. I'd imagine it should compile ok on your own machine as that should have the requisite resources to draw in.<br><br>Just fired up my sons creaky laptop (it blue screens now and then), managed to download the exe and run it no problems. I appreciate that does not help you Yue, however, the code to compile it yourself is installed in something like the following directory:<br><br>C:\Program Files (x86)\3bombs<br><br>Rgds,<br><br>BP <br><br></td></tr></table><br>
<a name="1316180"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> Seems to work well here.<br>However i am a bit disappointed because you have not even used the math formula to calculate a precise height that i explained in post#14... So don't credit me ;) <br><br></td></tr></table><br>
<a name="1316190"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> However i am a bit disappointed because you have not even used the math formula <br></div><br><br>On my TO DO list ;) I was struggling with getting the TerrainDetail variable to compile for a bit - then I confess I was trial and error with correlating the Terrains X znd Z co-ords with where the craters should be. <br><br></td></tr></table><br>
<a name="1316202"></a>

<a name="1316203"></a>

<a name="1316207"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> TerrainDetail is to define the number of triangles that the terrain will be made of each frame. So you want to have a high enough value but not too high either...<br>for a 100x100z terrain (not scaled on x or z), the max amount is 100x100x2=20 000tris<br>so i usually use 2 000tris (but this is arbitrary, do some tests and see how it looks and how much time it takes to build it) <br><br></td></tr></table><br>
<a name="1316212"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the additional info RemiD, I was wondering why it was failing to compile above a certain number of tri's, however my terrain is rather big.<br><br>My array of discs - only dropped the one missile so far - but the logic is good ;)<br><br><img src="http://www.wishingwellsoftware.co.uk/discs.png"> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
