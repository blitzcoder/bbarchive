<!DOCTYPE html><html lang="en" ><head ><title >health above enemy head?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >health above enemy head?</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=5" >Blitz3D Beginners Area</a>/<a href="#bottom" >health above enemy head?</a><br><br>
<a name="992126"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi all. This code works SORTA, the problem is if the enemy is too big, it wont ALWAYS display the health above the enemy's head. i need it to ALWAYS stay above the enemy's head no matter HOW big the enemy is. and if the enemy moves, the y position of the label stays the same no matter what height the enemy is at.<br><br>code: <br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">Function LabelEntitys(camera, label$, entity)
 If EntityInView(entity, camera)
 CameraProject camera, EntityX(entity), EntityY(entity), EntityZ(entity)
 w = StringWidth(label$)
 h = StringHeight(label$)
 x = ProjectedX () - (w Shr 1) - 1
 y = ProjectedY () - (h Shr 1) - 1
		Color 0, 0, 0
		Rect x, y-40, w + 2, h + 2, 1
		Color 255, 255, 255
		Text x, y-40, label$
 EndIf
End Function</textarea><br><br>Thanks for the help as usual! :) <br><br></td></tr></table><br>
<a name="992131"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Position a pivot above his head in 3D space where you want the label to be, parent it to the player entity, and use that as a point of reference instead of the player entity itself. <br><br></td></tr></table><br>
<a name="992517"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> You could also try 2d and camera projest i suppose. That would keep the graphic the same size. Mixing 2d and 3d can give slowdowns though... <br><br></td></tr></table><br>
<a name="992526"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> i like the entity parent thing better. i tried it, im not having problems w/ the entityparent pivot above the players head, im having trouble where the labelentity text is located. <br><br></td></tr></table><br>
<a name="992542"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> What you mean? Why don't you just center the text?<br><br>Since you are getting the projection for the <b>center</b> of the "name pivot", only makes sense to center your text (by using <b>Text txt$,x,y,TRUE,TRUE</b>). <br><br></td></tr></table><br>
<a name="992550"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> right, b/c if the enemy say jumps up and down, the text of the enemy doesnt stay above his head and jump with it. it stays in the middle of the enemy's body if close up, and only stays at the top of his head when far away. but i will try this. ill let u know the results <br><br></td></tr></table><br>
<a name="992621"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> If it stays in the middle of the enemy's body when close up that means that the pivot is wrongly placed.<br><br>Don't you have a "Head Bone" or something that you can project the coordinates into screen?<br>I'm guessing you are using skeletal animation here. If your enemies are simpler (simple primitives or shapes that don't need bones), then you really need to go testing out what works and what doesn't.<br><br>Don't mind the far away distance. Focus on testing the text's position when it's <b>close up</b> to the camera (it's when the position will be more accurate). <br><br></td></tr></table><br>
<a name="992635"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> o i fixed the pivot. i just have to fix the position of the text now <br><br></td></tr></table><br>
<a name="992670"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> To do that, make sure the text label is 'projected' onto the Pivot, not the entity.<br><br><pre class=code>
LabelEntitys(camera, label$, PIVOTHANDLE)
</pre> <br><br></td></tr></table><br>
<a name="992675"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> working on it as we speak ^^ <br><br></td></tr></table><br>
<a name="992680"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> not working..<br><br>also, its only positioning the pivot above small enemy's heads. not large scale enemies.<br><br>so far, i have this above updateworld in the main loop: <br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">For b2.hostile = Each hostile
LabelEntitys(Camera, "Enemy: "+b2\model+"|"+b2\hp+"/"+b2\maxhp, healthpoint)
Next</textarea><br><br>this here is the labelentitys function: <br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">Function LabelEntitys(camera, label$, entity)
 If EntityInView(entity, camera)
 CameraProject camera, EntityX(entity), EntityY(entity), EntityZ(entity)
 w = StringWidth(label$)
 h = StringHeight(label$)
 x = ProjectedX () - (w Shr 1) - 1
 y = ProjectedY () - (h Shr 1) - 1
		Color 0, 0, 0
		Rect x, y, w + 2, h + 2, 1
		Color 255, 255, 255
		Text x, y, label$
 EndIf
End Function</textarea><br><br>i have this inside createhostile() : <br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">Function CreateHostile.hostile(spec,x,z)
		A.hostile = New hostile
		
		Select spec
			Case 1
				A\model = CopyEntity(enemymesh(Rnd(0,2)))
				healthpoint = CreateSphere(4)
				EntityParent healthpoint, A\model
				PositionEntity healthpoint, EntityX(A\model), MeshHeight(A\model)+2, EntityZ(A\model)
EntityType A\model,1
EntityRadius A\model,2
				A\maxhp = 200
				A\hp = A\maxhp
				If A\hp &lt;= 0 Then A\hp = 1
				A\attack = Rnd(200)
				A\attackrange = 20
				A\state = IDLE
				A\maxtime# = 5.0
				A\cooled = True
				A\current# = 0.0
		End Select
											
		A\ox = x
		A\oz = z
		A\fleepivot = CreatePivot()
        PositionEntity A\fleepivot,x,1,z
;		PositionEntity A\fleepivot,x,TerrainY(t,x,0,z),z
		PositionEntity A\model,x,EntityY(A\fleepivot),z
		Return A
				
End Function</textarea><br><br>the viewable pivot (a sphere for now so i can see it), is under the line where i defined "A\model = "..<br><br>i call createhostile() like this: <br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">.reset
For x = 1 To maxenemies
CreateHostile(1,Rnd(125, Rnd(x*250)), Rnd(125, Rnd(x*250)))
enemiesleft = x
Next</textarea><br><br>i call the gosub reset like this in the main loop:  <br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
	Cls
	If RESETR = True
		RESETR = False
		Goto reset
	EndIf</textarea><br><br>and finally, i call RESETR from inside updateplayer() like this:  <br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">Function UpdatePlayer()

	For P.player = Each player
		P\current# = P\current# + 0.1
		If P\maxtime# &lt;= P\current#
			P\cooled = True
			P\current# = 0.0
		EndIf
		If P\hp &gt; P\maxhp
			P\hp = P\maxhp
		EndIf
		
		If P\hp &lt; 1
			For A.Item = Each Item
				If A\inv = False
				FreeEntity A\model
				EndIf
				Delete A
			Next
			For H.hostile = Each hostile
				FreeEntity H\model
				Delete H
			Next
			
			For I.icon = Each icon
				Delete I
			Next
			INVENTORYITEMS = 0
			RESETR = True
			Cls
			Flip
			Color 255,0,0
			Text GraphicsWidth() Shr 1-StringWidth("You have died!") Shr 1,GraphicsHeight() Shr 1-StringHeight("You have died!") Shr 1,"You have died!"
			Color 255,255,255
			PlaySound losesound
			Flip
			Delay(500)
			Cls
			Text GraphicsWidth() Shr 1-StringWidth("Reloading the game..") Shr 1,GraphicsHeight() Shr 1-StringHeight("Reloading the game..") Shr 1,"Reloading the game.."
			Flip
			P\hp = P\maxhp
			Color 255,255,255
			Delay(2000)
		EndIf
		
		If KeyHit(57)
			For H.hostile = Each hostile
				If EntityDistance(H\model,P\model) &lt; 5 And P\cooled = True
					PlaySound hitsound
					P\cooled = False
					H\hp = H\hp - Rand(P\attack,P\maxattack)
				EndIf
			Next
		EndIf
		If P\experience &gt;= P\nextlvl
		
			LevelUpPlayer(P)
		EndIf
	Next
End Function</textarea><br><br>and last but not least, i call updateplayer() inside of the main loop<br><br>i hope this is enough information to figure out what is going on here ^^ <br><br></td></tr></table><br>
<a name="992755"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Two things:<br><br>1) Is your UpdateWorld after the Renderworld?<br>Ideally you should have the updateworld before the renderworld, then the LabelEntity call, then the Flip after that.<br><br>2)<br><pre class=code>For b2.hostile = Each hostile
LabelEntitys(Camera, "Enemy: "+b2\model+"|"+b2\hp+"/"+b2\maxhp, healthpoint)
Next</pre><br>You are applying this label only to a single entity multiple times.<br><br><pre class=code>
Select spec
			Case 1
				A\model = CopyEntity(enemymesh(Rnd(0,2)))
				healthpoint = CreateSphere(4)
				EntityParent healthpoint, A\model
				PositionEntity healthpoint, EntityX(A\model), MeshHeight(A\model)+2, EntityZ(A\model)
</pre><br>Here, healthpoint is an entity on its own which you overwrite with new copies and assign new parents with every a\model you create (at spec = 1).<br><br><br>I would suggest, that you include the healthpoint into the Type.<br>For example:<br><br><pre class=code>
Type hostile
Field blah
field blahblah
field blahblahblah
field healthpoint
End Type</pre><br><br>Then amend the labelentitys code to:<br><br><pre class=code>
For b2.hostile = Each hostile
LabelEntitys(Camera, "Enemy: "+b2\model+"|"+b2\hp+"/"+b2\maxhp,b2\ healthpoint)
Next
</pre><br><br>Finally, if the b2\model b2\hp and b2\maxhp are declared as integers, then it might be best to ensure they are displayed correctly as:<br><br><pre class=code>
For b2.hostile = Each hostile
LabelEntitys(Camera, "Enemy: "+Str(b2\model%)+"|"+Str(b2\hp%)+"/"+Str(b2\maxhp%),\healthpoint)
Next
</pre><br><br>That should help with the immediate issue :) <br><br></td></tr></table><br>
<a name="992808"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> that didnt work. the problem lays within the labelentitys() function. its not positioning the text onto the healthpoint correctly..<br><br>here: <br><br>labelentitys():<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">Function LabelEntitys(camera, label$, entity)
 If EntityInView(entity, camera)
 CameraProject camera, EntityX(entity), EntityY(entity), EntityZ(entity)
 w = StringWidth(label$)
 h = StringHeight(label$)
 x = ProjectedX () - (w Shr 1) - 1
 y = ProjectedY () - (h Shr 1) - 1
		Color 0, 0, 0
		Rect x, y, w + 2, h + 2, 1
		Color 255, 255, 255
		Text x, y, label$
 EndIf
End Function</textarea><br><br>here's how it's called: <br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">Function CreateHostile.hostile(spec,x,z)
		A.hostile = New hostile
		
		Select spec
			Case 1
				A\model = CopyEntity(enemymesh(Rnd(0,2)))
				A\healthpoint = CreateSphere(4)
                LabelEntitys(Camera, "Enemy: "+A\model%+"|"+A\hp%+"/"+A\maxhp%, A\healthpoint%)
				EntityParent A\healthpoint, A\model
				PositionEntity A\healthpoint, EntityX(A\model), MeshHeight(A\model)+2, EntityZ(A\model)
EntityType A\model,1
EntityRadius A\model,2
				A\maxhp = 200
				A\hp = A\maxhp
				If A\hp &lt;= 0 Then A\hp = 1
				A\attack = Rnd(200)
				A\attackrange = 20
				A\state = IDLE
				A\maxtime# = 5.0
				A\cooled = True
				A\current# = 0.0
		End Select
											
		A\ox = x
		A\oz = z
		A\fleepivot = CreatePivot()
        PositionEntity A\fleepivot,x,1,z
;		PositionEntity A\fleepivot,x,TerrainY(t,x,0,z),z
		PositionEntity A\model,x,EntityY(A\fleepivot),z
		Return A
				
End Function</textarea><br><br>its positioning the healthpoint correctly. not the text. <br><br></td></tr></table><br>
<a name="992874"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Where's your Renderworld?<br><br>There's little point in applying the  function efore the scene's updated as the camera projection won't work correctly. <br><br></td></tr></table><br>
<a name="992882"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> renderworld tween# ? i tween it cuz on some pcs its 1400+ fps <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
