<!DOCTYPE html><html lang="en" ><head ><title >Limit number of surfaces per Mesh?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Limit number of surfaces per Mesh?</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=5" >Blitz3D Beginners Area</a>/<a href="#bottom" >Limit number of surfaces per Mesh?</a><br><br>
<a name="1073959"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Abomination</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm working on a pixelperfect gui in a 3d world.<br>I wanted to make it singlesurface, but I've come to use too <br>many vertices for just one surface. (more than 3200?)<br>Also wanting to add more textures, will require more surfaces.<br>Now what to doo?<br>I could just add more surfaces to the mesh.<br>Or add more meshes with just one surface. locating them all in one location.<br>Or add up to 3 surfaces per mesh (because more would slowdown graphics?), then create an other mesh, etc. etc.<br>i.o.w. Is there (speedwise) a limit to the number of surfaces per mesh, or to the number of meshes in view?(since they are all located in the same location here.)<br>A few tips will be greatly appreciated. ;) <br><br></td></tr></table><br>
<a name="1073991"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's good that you're doing it single-surface from the beginning. Saves you the hassle you would get later on when things start to slow down from the lack of optimization.<br>Your goal is to keep a steady and fast frame rate. If you can reach this frame rate by having only 3 surfaces per-mesh, I don't see why you should be trying to join everything in the same mesh. <br><br>To help with that you should make your system very generic in the sense that a Const could define how many surfaces per mesh you want max. If you need another element\surface and the current mesh's surface count has topped, then you build another mesh to populate with surfaces.<br><br>I believe there isn't a limit on surfaces per mesh - <a href="/b3ddocs/command.php?name=CreateSurface&amp;ref=3d_cat" target="_blank">the help file is quite clear on this</a>. Another useful piece of information (this one isn't on the help file AFAIK) is that a surface cannot hold more than 64 thousand vertices. If you notice you are about to add a collection of vertices that would break this limit, make sure to put them on a different surface (even if you have to create another mesh + surface for this). <br><br></td></tr></table><br>
<a name="1073995"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Warner</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> This may be a silly question, but why are you using so much vertices for your GUI? If each control uses say 4 vertices, are you trying to draw 800 controls? <br><br></td></tr></table><br>
<a name="1074000"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> It also sounds strange to me to have so many vertices in your gui, maybe you want to make it real 3D, not only 2D on a texture?<br><br>However, there are some facts about surfaces and vertices:<br><br>Officially there may be 64k Vertices, but a lot of older cards will support only up to 40'000. And: the max number of triangles may be 32k. I would suggest to stay below 30k with both, vertices as well as triangles.<br><br>I don't know the max number of surfaces, but I would not be surprised if it is limited to 32k as well (signed 16t bit, good old DOS limits), but 32'000 surfaces for sure is more than you ever (?) need.<br><br>There is one thing you should know: if you use Addmesh and both meshes are using identic surfaces (for example two surfaces with the same texture and all settings are the same) then DitectX will merge-optimze the surface count, resulting in a mesh with only one surface. If each surface already had eg. 35'000 vertices then this may result in a MAV on renderworld, due to 70'000 Vertices after AddMesh. You can prevent this Merging when you use very small diffrences in the brush settings. For example in the brushcolor: 255,255,255 vs 255,255,254. This can hardly be seen, but will allow to have an almost unlimited number of Vertices in one texture. <br><br></td></tr></table><br>
<a name="1074006"></a>

<a name="1074007"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Abomination</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Kryzon: Thank for this advice. <br>I thought this limit of vertices per surface was 3200, because I came across this number in a few examples on these forums.<br><br>@Warner: Not a silly question at all, old fruit ;)<br>1. you never know what someone wants to do with your gui. Perhaps create a few dozen windows the same time?<br>2. Most of the controls only use 4 vertices, but some have more, so I can add some "special effects". Who knows what I will think of next.<br>3. I want to give the program, that will work together with this gui,<br>the possibility to "share" the use of the surfaces of the gui.<br>4. I thank you for thinking along...<br><br>@jfk: Thanks for this info. I don't think my gui, or the use of it, will top those limits. But perhaps the graphics could slowdown before that?<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1074021"></a>

<a name="1074023"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> That's hard to say if we don't know your gui. Example: if you have 10 quads, each one with 4 vertices and 2 triangles, each one covering the screen (pixelperfect, if you want), using alphablending, then you only got 40 Vertices, but there will be a serious slowdown. So using big (screen-filling) alpha objects will slow rendering down, no matter how many tris you got. It's even worse when every quad is using an individual brush/texture.<br><br>32 kTris as opaque, non-alpha, normally textured 3D gui (like some buttons made of boxes  and stuff) at the other hand may render quickly and be acceptable on a card that isn't real ancient.<br><br>Normaly people use a 2D gui on a quad, only to be able to have it semitranslucent onscreen, like many modern games (as well as to scale the 2D gui automaticly, tho this may blur the gui). For this kind of "2D in 3D" gui ONE single (screen-covering) quad should however be enough.<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1075197"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >lauri</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> My game-project works still with ~60 000 tris with another surface with alpha. Coluld there be problems with older computers if I use so much tris? And how I can make very large terrain? LoadTerrain() doesn't work because I need caverns, tunnels and things like that in my wold. <br><br></td></tr></table><br>
<a name="1075285"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> There are two things, alpha and non-alpha tris. With alpha the size on screen as well as the number of alpha layers the renderer has to go trough does matter more than the number of trianlges, where of course the number of triangles is always critical as well. Nonalpha meshes do not really care about the number of layers in ZSpace. But 60k Tris is still a lot for older cards. You maybe get 15 fps or so on a tyical DX7 card.<br><br>Not only the number of triangles matters, but also the number of surfaces in the scene. 60k Tris on 1000 Surfaces is much slower than 60k Tris on 2 surfaces. At the other hand a single surface with 60 kTris will always be rendered, even if there is only a few triangles of it visible on the screen, so for a landscape it's better to have several fragments, allowing the renderer to skip things behind the cameras back, as well as things out of the camerarange.<br><br>No matter how smart you are, you'll reach certain limits when you try to do superhuge worlds with high details on old hardware. When you watch older titles, they used a lot of tricks. For example levels where designed in a way that prevented the player from climbing up hills and watch the whole region, instead the player was locked in canyons and valleys. An other approach is radical LOD. Level Of Detail is using multiple versions of every mesh and will display only a low poly version when it is far away. It is radical when you are using simple quads for complex distant scenery. Eg. a hill with many trees, far away from the camera: render it once then hide it and show only the render on a quad as long as the players view angle to the hill remains within a certain range. You can do extremly detailed world this way.<br><br>Nevertheless, the complexity of worlds is limited by the level loading time. You don't want to load for hours, do you? Many modern games have a streaming world architecture, the enviroment is loaded in the background by a seperate process while the player is moving, depending on where he's going to. So far this isn't possible with Blitz, since Multithreading isn't really possible whith the DX7 Surface (at least not with the LoadMesh command, as far as I know).<br><br>So the conclusion may be: if you want complex and detailed outdoor scenes, there's no way around a powerful LOD system. You maybe gonna find something in the archives.<br><br>BTW. I repeat, make sure to get only 40k Vertices and 31k Tris in one surface. Some cards will not support 64k Vertices or 64K Tris. <br><br></td></tr></table><br>
<a name="1075307"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Jfk,<br><br>Do you have any links to learn about how to code a streaming engine ?<br><br>I have my ideas on how to code it, but i'm curious of how others are doing it.<br><br>Thanks ! <br><br></td></tr></table><br>
<a name="1075704"></a>

<a name="1075706"></a>

<a name="1075707"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> No, I never tried that so far. <br><br>You sure will find some infos in the web, but if you want to do it in B3D then you maybe should first try to get multithreading working in Blitz3D. That's not so hard (wasn't there a Userlib for multithreading?), but you need to be able to load a Mesh to a handle that the primary thread knows. So basicly you need to reserve Ram and a handle then run an additional process thread that will load the mesh to that handle while the main game process continues. If the mesh is loaded, a flag is set and the entity becomes valid in the main process.<br><br>One problem is: you have to load the entity to a known address, contrary to LoadMesh, that will return the address/handle that was autocreated. That's the tricky part IMHO. You maybe could load it using LoadMesh, then RTLMemoryMove it as a Block of Ram to a dummy entity that was created with LoadMesh and has the same number of Surfs, Verts and Tris. But moving Ram requires the child thread to have access to the parent thread's ram - that might be restricted by the OS..<br><br>A lot of hacking is however needed when you do it in Blitz3D. Maybe there is a simpler way to do it, but I can't see it right now.<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1075772"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> In fact i wasn't thinking about managing the memory.<br><br>I was thinking about using a grid to load/unload progressively the meshes, the textures, the sounds depending on the Player position and orientation.<br><br>I guess the best way to know if it works is to try :) <br><br></td></tr></table><br>
<a name="1075773"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can do this sort of thing with a single thread as long as you have:<br><br> - a counter to keep an eye on the time elapsed each frame, so you know how much spare there is for loading<br> - a dynamic system that "learns" how long it take to load assets so that as the game goes on, they fit better into the time available<br> - render tweening, so that if there is a slight overrun, the gameplay will seamlessly absolrb it without skipping.<br><br>If you write your own loading routines, rather than relying on the builtin commands, you can also add verts and polys to single large meshes in more than one burst, splitting it up over several frames. <br><br></td></tr></table><br>
<a name="1075775"></a>

<a name="1075780"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >lauri</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Fastpointer library from fastlibraries, maybe?<br>But how I use it to loading meshes correctly?<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1075940"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yasha - I agree, to use your own loading routines makes it easier, but there are certain things that you cannot do with code, you can only LoadMesh it, eg.  weighted vertices in animations, probably Mesh animations at all, unless you want to rewrite the entire Animation handler - not a simpe task.<br>Lauri - you have to try, be the first... This thing is however no longer something for the beginners section. So don't expect it's going to be easy.<br><br>I think it would be rather easy to do it for terrain and plants environment only, static meshes only. Just use your own loading routine that will seek the required data inside a huge file of the worlds vertex, tris and material data. It might gonna be a little tricky to add triangles with perfect smoothing and seamless to the existing geometry. Probably not very obvious when you load patches of a certain size. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
