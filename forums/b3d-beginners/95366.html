<!DOCTYPE html><html lang="en" ><head ><title >Managing Player fall and gravity.</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Managing Player fall and gravity.</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=5" >Blitz3D Beginners Area</a>/<a href="#bottom" >Managing Player fall and gravity.</a><br><br>
<a name="1097910"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi, :)<br><br>I have made a small demo of tomb raider like controls and gameplay in the past and it was working well, watch this video :<br><a href="http://www.youtube.com/watch?v=_dk0hrtgquo" target="_blank">http://www.youtube.com/watch?v=_dk0hrtgquo</a><br>The animations are bad, i know...<br><br>My problem is that the code i'm using is working because the terrain is quite flat.<br><br>Here is the concept of the code :<br><br>Each loop :<br>-&gt;The program launches a linepick below the player feet so that i know if the player is on the ground or not.<br>-&gt;If the player is on the ground, the player can move, jump.<br>-&gt;If the player is not on the ground, and is not grabbing a ledge, the player falls and the gravity is activated.<br><br>The problem with my code is that if the terrain has many irregularities, the player keeps falling when moving.<br>I can't really use a variable to check if player is in jump mode or not before activating the gravity because i also want player to fall when  he is moving away from a platform.<br><br>Do you have any idea on how to proceed ?<br><br>Thanks, <br><br></td></tr></table><br>
<a name="1097921"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >stayne</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Not sure if it matters but is the start point of your linepick somewhere around the middle of your player? <br><br></td></tr></table><br>
<a name="1097935"></a>

<a name="1097936"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi stayne,<br><br>The linepick starts at player feet Y# + 10 and goes to -100 on the Y axis.<br><br>I don't have a problem with the linepick.<br><br>My problem is to know when to enable the gravity, knowing that player can jump and fall or simply fall from a platform.<br><br>Let me give you two examples :<br><br>If i enable the gravity each time the Y# coordinate of player feet is higher than the Y# coordinate of the picked ground (terrain or platform), the gravity is working properly, but you understand that the player is always falling when the picked ground is going downward.<br><br>If i enable the gravity only when player press the jump key, i can easily position player on the Y# coordinate of the picked ground (terrain or platform) when player is not jumping, but imagine if player moves away from a platform without jumping, he will stay in the air because the gravity is not activated.<br><br>That's my problem. I don't know how to activate gravity so the player can fall but without making him fall when he is walking on a ground which is going downard.<br><br>I hope my explanations are more clear this time.<br><br>Thanks for your ideas :)<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1097941"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Have you experimented with, or taken a look at, the collision system?<br><br>This is pretty much what B3D's collisions, especially sliding collisions, were built for. Collision detection checks when one object is intersecting with another (well, not quite - for speed, one of them always has to be a sphere) and will interrupt the entity movement commands so that they can't pass through one another. If the second object (collision is one-way - there are tricks for two-way collision which you can learn later) is slanted relative to the first, it's also possible to choose "sliding" collisions, that move the first object along the surface of the second without penetrating it.<br><br>So the classic way to handle gravity in simple games is actually to never turn it off; you can simply have your player get move downward by a constant amount each frame, and with collision against the level turned on, it won't move through it.<br><br>Sliding collision is also handy; you can simply move your character in X and Z, and if there's a hill, it will walk up the hill as it slides up the surface. You can prevent gravity from dragging your character down the side of the hill again with a special option designed to help with that.<br><br>Then deciding when to jump becomes a matter of using the collision test functions to see if a collision happened between your player and the ground; if it did, that's your OK flag for jumping and movement. As long as gravity is applied before the collision check, the player will have moved down and be contacting the ground that frame (or maybe they ran off the edge too fast, and count as jumping!).<br><br>Collisions are powered by UpdateWorld, so you may need to rearrange things a bit, but they're designed to be very simple to use; they're Blitz3D's prebuilt system for doing what you've been trying to accomplish with LinePick, and will be much faster and more robust for it. <br><br></td></tr></table><br>
<a name="1097961"></a>

<a name="1097962"></a>

<a name="1097974"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RifRaf</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> What I usually do is have two gravity values, one is applied when the entity is colliding with the ground, the other is applied when the player is not in touch with the ground.<br><br>The ground enabled gravity value is very low, while the in air gravity would be much greater<br><br>You can have a counter that increments while the entity is not in touch with the ground to time how long its in the air, and use that as you see fit.  I have used it to increase the air gravity the longer the entity is in the air up to a max gravity value.  <br><br> Using these two values can help with players going slower up hills as well.<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1098073"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for your suggestions, i'm going to code a small demo with a sphere collider instead of using linepick and see if it works better. <br><br></td></tr></table><br>
<a name="1098360"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just to let you know that i have resolved my problem by using a sphere collider rather than a linepick (thanks Yasha :)) and by applying 2 kinds of movements to the character :<br><br>First, i check if the character collider is colliding with the level collider (terrain, buildings, rocks)<br><br>If the character collider is colliding with the level collider,<br> -&gt;The character can move according to the input keys (forward, backward, left step, right step)<br> -&gt;Then the character moves downward with a constant gravity of a length of half the previous vector (Thanks RifRaf :))<br> -&gt;Then  the player is able to jump.<br> <br>Else the character is falling<br>Depending if Player has jumped or not, a force is added or not to the movement vectors<br>Finally i calculate an increasing gravity speed to pull the character toward the ground.<br><br>I avoid the previous jerky movements i had, by always moving the character in a direction when he is on the ground or when he is falling or when he is jumping.<br><br>If it can inspire someone :) <br><br></td></tr></table><br>
<a name="1262344"></a>

<a name="1262345"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>because i also want player to fall when he is moving away from a platform.<br> <br></div><br>Ok i answer to past me : <br>one way to do this is to first check if the character is OnAir or OnGround, (with a linepick from the middle of the character to down)<br>If the character feet is near enough the picked point<br> Position the character feet at this picked position<br> YVelocity = 0<br> Player is OnGround<br> Player can use the controls to turn move the character or to jump<br> Turn Move the character<br> Animate the character<br>Else if the character feet is too far the picked point<br> Player is OnAir<br> Calculate the YVelocity of the character (YVelocity - GravityForce)<br> Translate the character with the YVelocity<br> Animate the character<br><br>Also please note that my problem with linepick on terrain was due to what seem to be a bug see : <a href="http://www.blitzbasic.com/Community/posts.php?topic=101836" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=101836</a> <br><br></td></tr></table><br>
<a name="1262371"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Even though technically it should work (but obviously it doesn't) I would never rely on a line pick with a terrain and would always use the terrainy function (as you mentioned in the bug report) simply because a simple calculation as terrainy does (interpolate the height inside a triangle) is always going to be an order of magnitude faster than calculating the intersection point between a ray and a triangle. <br><br></td></tr></table><br>
<a name="1262399"></a>

<a name="1262400"></a>

<a name="1262401"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>a simple calculation as terrainy does (interpolate the height inside a triangle) is always going to be an order of magnitude faster than calculating the intersection point between a ray and a triangle. <br> <br></div><br>Maybe, but if you use irregular shapes for obstacles (buildings, rocks, trees, containers, devices), there is no way to know if an obstacle is between the character and the terrain, so the obstacles must be considered before considering the terrain.<br>A way to speed up the calculation is to use low tris pickables and also to first calculate which obstacles are near enough the character, and only set these obstacles as pickable. In this way, only the near enough obstacles and the terrain will be considered for the calculation. <br><br></td></tr></table><br>
<a name="1334471"></a>

<a name="1334474"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> 5 years later and still the same problem, caused by a bug of Blitz3d : camerapick/linepick sometimes fails on a blitz3d terrain... I have found another workaround : have a transparent (alpha 0.0) plane at the level of the ground and set it as pickable instead of the terrain) but this works only for flat enough terrains. <br><br></td></tr></table><br>
<a name="1334495"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Use the X and Z coordinates of the pick with TerrainHeight.<br><br><a href="http://www.blitzbasic.com/b3ddocs/command.php?name=TerrainHeight&amp;ref=3d_cat" target="_blank">http://www.blitzbasic.com/b3ddocs/command.php?name=TerrainHeight&amp;ref=3d_cat</a> <br><br></td></tr></table><br>
<a name="1334509"></a>

<a name="1334511"></a>

<a name="1334513"></a>

<a name="1334514"></a>

<a name="1334515"></a>

<a name="1334517"></a>

<a name="1334519"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> not possible if the linepick/camerapick is not from top to down (this is the case for the video game i am working on, since i use an isometric view), but yes, this is a workaround if the linepick/camerapick is from top to down, i already mentioned it here : <a href="http://www.blitzbasic.com/Community/posts.php?topic=101836" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=101836</a> (#2)<br><br>But having an invisible plane (entityalpha/brushalpha 0.0) at the level of the ground if the terrain is rather flat, (no hills/deeps), and picking the plane instead of the terrain is a workaround which works well.<br><br>Another workaround that i am looking for is a way to get the mesh produced by the ROAM algorithm and use this as the pickable (it must exist somewhere since it is rendered), or code my own terrain ROAM algorithm, or create a high details version of the terrain (with one vertex each 1x1zunit and 2 triangles for each cell) and then use a triangles reduction algorithm such as : <a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=1285" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=1285</a><br>to produce a low details version that i can use as the pickable) <br><br></td></tr></table><br>
<a name="1335663"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gpete</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> far be it from me to offer solutions to Remi-  ;-) .. but I always add a low value "downward" translate to the player..forward movement is greater to allow climbing ramps etc.... <br><br></td></tr></table><br>
<a name="1335670"></a>

<a name="1335671"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BlitzMan</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> . <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
