<!DOCTYPE html><html lang="en" ><head ><title >Help with Collision?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Help with Collision?</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=5" >Blitz3D Beginners Area</a>/<a href="#bottom" >Help with Collision?</a><br><br>
<a name="1125706"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've taken it to the next level. I changed the enemies to Dwarves. I added player to object collision, player to land collision, and object to object collision. I fixed a rotation glitch when the enemy returns to its waypoint, due to collision.<br><br><br><br>PROBLEM is, the enemies wont pursue the player anymore....<br><br><br><br>Here's the project: <br><br><br><br><a href="http://www.mediafire.com/?do051b8fw2h5tyj" target="_blank">http://www.mediafire.com/?do051b8fw2h5tyj</a><br><br><br><br>Thanks for any help! :)<br><br><br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">;Waypoint Example By Drak, 3/8/2010
;UPDATED 2/4/2012
;************************************************************
;THIS PROGRAM WILL:											*
;Create a player mesh (a square)							*
;Create some enemies (some spheres)							*
;Make on-the-fly waypoints for the enemies to return to		*
;Return the enemies to the waypoints						*
;Also shows some some rudimentary AI						*
;Shows some very simple particle effects as well			*
;************************************************************



;-------------------------------------------------------------------------------------------------------
;INITIALIZATION
;-------------------------------------------------------------------------------------------------------
Graphics3D 800,600,0,2
SetBuffer BackBuffer()
SeedRnd MilliSecs()

AmbientLight 255, 255, 255

Global type_player 	= 1
Global type_land 	= 2
Global type_obj 	= 3

Collisions type_player, type_land, 2, 3
Collisions type_player, type_obj, 2, 2
Collisions type_obj, type_obj, 2, 3

Global player = LoadAnimMesh("models\dwarf1.b3d")	;create a cube for the player
EntityColor player, 0,0,200		;we'll make the player blue
ScaleEntity player, .1, .1, .1
EntityType player, type_player

Global player_hp = 10			;give the player 10 hit points
Global player_alive = 1			;player is indeed alive

Global camera = CreateCamera()	;create a camera
CameraRange camera, .1, 999999999

Global sky = CreateCube()
ScaleEntity sky, 10000, 10000, 10000
EntityColor sky, 102, 102, 255
FlipMesh sky

Global Land = CreatePlane()
EntityColor Land, 0, 64, 0
EntityType Land, type_land

;-------------------------------------------------------------------------------------------------------
;TYPES
;-------------------------------------------------------------------------------------------------------
Type enemy
	Field mesh				;will hold the actual mesh
	Field return_waypoint	;will hold the handle of the return waypoint
	Field status			;holds a # referring to the enemies status
	Field speed#			;this will hold the speed of the enemy
	Field timer				;2/3/12 This will be a counter
	Field timer_max			;2/3/12 This is the counter's maximum
	Field steer_angle#		;2/3/12 This holds the enemy's steering angle
End Type

Type particle				
	Field mesh				;holds mesh
	Field alpha#			;holds alpha
	Field speed_x#			;speed x
	Field speed_y#			;same
	Field speed_z#			;same...
	Field fade_speed#		;fade_speed
End Type

;-------------------------------------------------------------------------------------------------------
;LETS CREATE SOME PRIMITIVES TO USE LATER	
;-------------------------------------------------------------------------------------------------------

Global spark = CreateCube()
ScaleEntity spark, .25,.25,.25
EntityColor spark, 255,168,0
HideEntity spark

Global waypoint = CreateSphere()
ScaleEntity waypoint, .5,.5,.5
EntityColor waypoint, 0,200,0
HideEntity waypoint

;-------------------------------------------------------------------------------------------------------
;CREATE SOME ENEMIES
;-------------------------------------------------------------------------------------------------------
For num = 1 To 5
	e.enemy = New enemy				;new enemy
	e\mesh = LoadAnimMesh("models\dwarf1.b3d") ;CreateSphere(16)		;create a sphere and store it in e\mesh
	e\speed = .1					;set the speed of each enemy
	e\status = 1					;set status to 1
	e\timer = 0						;2/3/12	set timer to 0
	e\timer_max = Rand(400,1000)	;2/3/12	pick a maximum timer
	PositionEntity e\mesh, Rand(-20,20),0,Rand(-20,20)	;place the enemies randomly
	;EntityAlpha e\mesh, .5
	RotateEntity e\mesh, 0,Rand(360),0
	ScaleEntity e\mesh, .1, .1, .1
	EntityType e\mesh, type_obj
Next

Global turnonanim = False

;-------------------------------------------------------------------------------------------------------
;MAIN LOOP
;-------------------------------------------------------------------------------------------------------
While Not KeyHit(1)
	For e.enemy = Each enemy
		If turnonanim  = True Then Animate e\mesh, 1, .1, 1, 15
	Next
	SuperCam(camera,player,.02,200,4,0,0)
	py# = EntityY#(player, True)
	If py# &lt; 1.0 Then py# = 1.0
	If py# &gt; 1.0 Then gravity# = gravity# - .1
	PositionEntity player, EntityX#(player, True), py#+gravity#, EntityZ#(player, True)
	get_input()
	run_enemies()
	run_particles()
	check_hp()
	
	
	UpdateWorld
	RenderWorld
	
	gui()
	Flip
	
Wend
;-------------------------------------------------------------------------------------------------------
;END MAIN LOOP
;-------------------------------------------------------------------------------------------------------


;-----------------------------------------------------------------------------------------------------
;FUNCTION GET_INPUT &lt;--- GRABS INPUT FOR THE PLAYER
;-----------------------------------------------------------------------------------------------------
Function get_input()
	If player_alive = 1
		MoveEntity player, 0, 0, (KeyDown(17)-KeyDown(31) Or KeyDown(200)-KeyDown(208))*.5
		TurnEntity player, 0, (KeyDown(30)-KeyDown(32) Or KeyDown(203)-KeyDown(205))*1, 0
	End If 
End Function 


;-----------------------------------------------------------------------------------------------------
;FUNCTION RUN_ENEMIES   &lt;---EXOCUTES ACTIONS FOR EACH ENEMY
;-----------------------------------------------------------------------------------------------------
Function run_enemies()
	For e.enemy = Each enemy	;for each enemy
		;regardless of case, the distance to the player must be known, so we'll check it here
		Local dist# = EntityDistance(e\mesh,player)
		Select e\status			;select it's status
				
			Case 1 ;ON GUARD
				EntityColor e\mesh, 200,200,0
				If dist# &lt;= 10		;if the distance is less than 10 or equal to it
					If player_alive = 1
						e\status = 2	;switch to state 2
					End If
					Else e\timer = e\timer + 1
					If e\timer &gt;= e\timer_max
						e\status = 6 ;switch to quick wander
						e\timer = 0	 ;reset the timer to 0
					End If
				End If 
				
			Case 2 ;DROP NEW WAYPOINT
				Local x# = EntityX(e\mesh)	;grab the enemies' coordinates
				Local y# = EntityY(e\mesh)
				Local z# = EntityZ(e\mesh)
				
						;place the waypoint at the location
				e\return_waypoint = CopyEntity(waypoint)
				PositionEntity e\return_waypoint,x#,y#,z#
				
				e\status = 3	;then switch to case 3, which is pursue
				
			Case 3 ;PURSUE THE PLAYER
				EntityColor e\mesh, 200,0,0	;red
				If dist# &lt; 1	;then attack!
					e\status = 4;change to attack
					Exit 		;exit the loop
				End If 
				
				If dist# &lt; 12	;first, check to see if we're 12 units away or less....
					PointEntity e\mesh, player		;point enemy at the player
					MoveEntity e\mesh, 0,0,e\speed	;then make the enemy move in the pointed direction
				Else
					e\status = 5	;set to status 5, which is return to waypoint
				End If 	
				
			Case 4 ;ATTACK
				player_hp = player_hp - 1	;take 1 hp from the player
				Local s_x# = EntityX(player)
				Local s_y# = EntityY(player)
				Local s_z# = EntityZ(player)
				Local num = Rand(3,8)
						;create some effects
				create_particles(num,s_x,s_y,s_z)
				e\status = 5				;now return to the waypoint
				
			Case 5	;RETURN TO WAYPOINT
				EntityColor e\mesh, 200,0,200
				Local dist_home# = EntityDistance(e\mesh,e\return_waypoint)	;get the distance home
				If dist_home# &gt; .2							;If we're further than .2 away...
					PointEntity e\mesh, e\return_waypoint	;point at home waypoint
					MoveEntity e\mesh, 0,0,e\speed			;move them forward
				Else If dist_home# &lt;= .2
					RotateEntity e\mesh, 0, 0, 0
					FreeEntity e\return_waypoint			;get rid of the waypoint mesh
					e\status = 1							;and return to idle again
				End If
				
				;CASE 6 ADDED ON 2/3/12
			Case 6	;WANDER
				EntityColor e\mesh, 0,200,0	;turn it green
						;KEEP THE WANDERING SIMPLE!!!! DON'T OVERCOMPLICATE THIS!!!!!
				
				e\timer = e\timer + 1
				If e\timer &lt;= e\timer_max
					e\steer_angle = e\steer_angle + Rnd(-.1,.1)
					If e\steer_angle &gt; 1 Then e\steer_angle = 1
					If e\steer_angle &lt; -1 Then e\steer_angle = -1
					TurnEntity e\mesh, 0,e\steer_angle,0
					MoveEntity e\mesh, 0,0,e\speed/5
				Else 
					e\timer = 0
					RotateEntity e\mesh, 0,Rand(360),0
					e\status = 1
				End If 
				
					;keep checking to see if the player is close enough to follow
				If dist# &lt;= 10		;if the distance is less than 10 or equal to it
					If player_alive = 1
						e\status = 2	;switch to state 2
					End If
				End If 
				
				
			Default
				e\status = 1	;if somehow e\status = anything else, we'll set it to 1
				
				
		End Select
	Next
End Function 

;-----------------------------------------------------------------------------------------------------
;GRAPHIC READOUTS   &lt;---This function prints readouts to the screen
;-----------------------------------------------------------------------------------------------------
Function gui()
	Text 0,0, "Use WASD keys to move around."
	Text 0,10,"Don't let the spheres touch you or you'll lose hitpoints."
	Text 0,20,"Remaining HP: " + player_hp
	
	If player_alive = 0
		Text 350,290,"You are DEAD!"
	End If 
End Function 


;-----------------------------------------------------------------------------------------------------
;RUN PARTICLES	   &lt;---This function runs the particles if there are any
;-----------------------------------------------------------------------------------------------------
Function run_particles()
	For p.particle = Each particle
		p\alpha = p\alpha - p\fade_speed	;take fade speed from alpha
		EntityAlpha p\mesh, p\alpha			;set alpha to p\alpha
		If p\alpha &lt;= 0					;if alpha is &lt;= 0
			FreeEntity p\mesh			;free it
			Delete p				
			Exit						;exit the loop
		Else
			p\speed_y = p\speed_y - .01							;subtract from y speed
			MoveEntity p\mesh, p\speed_x, p\speed_y,p\speed_z	;move the particle
		End If
		
		
	Next
End Function  


;-----------------------------------------------------------------------------------------------------
;CREATE PARTICLES	&lt;--- THis is called when we need to create particles
;-----------------------------------------------------------------------------------------------------
Function create_particles(num,x#,y#,z#)
	For s = 1 To num
		p.particle = New particle
		p\mesh = CopyEntity(spark)
		p\speed_x# = Rnd(-.2,.2)
		p\speed_y# = Rnd(.3)
		p\speed_z# = Rnd(-.2,.2)
		p\alpha = 1
		p\fade_speed# = Rnd(.1)
		PositionEntity p\mesh, x,y,z
	Next
End Function 

;-----------------------------------------------------------------------------------------------------
;CHECK HP	&lt;---This checks the player's HEALTH each frame
;-----------------------------------------------------------------------------------------------------
Function check_hp()
	If player_hp &lt;= 0
		player_hp = 0
		If player_alive = 1
			Local s_x# = EntityX(player)
			Local s_y# = EntityY(player)
			Local s_z# = EntityZ(player)
			Local num = Rand(15)
		;create some effects
			create_particles(num,s_x,s_y,s_z)
			player_alive = 0
		End If
	End If 
End Function 



Function SuperCam(cam,ent,cspeed#,dist#,hite#,xrot#,tilt#)
	
	TFormPoint 0,hite#,-dist#,ent,0
	
	cx#=(TFormedX()-EntityX(cam))*cspeed#
	cy#=(TFormedY()-EntityY(cam))*cspeed#
	cz#=(TFormedZ()-EntityZ(cam))*cspeed#
	
	TranslateEntity cam,cx,cy,cz
	PointEntity cam,ent
	RotateEntity cam,xrot#,EntityYaw(cam),tilt#
	
End Function</textarea><br><br><br><br>Thanks to anyone who helps with this! :) <br><br></td></tr></table><br>
<a name="1125707"></a>

<a name="1125708"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ginger Tea</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Isn't this just a C+P from one of your posts in the Drak waypoint thread?<br><br>Cos I'm sure you or he fixed the pursuit problem and the fact that you were asking about collision towards the end and that THIS thread is called "Help with Collision?"<br><br><div class="quote"> PROBLEM is, the enemies wont pursue the player anymore.... <br></div><br><br>Shouldn't this be talking about any problems with collision.<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1125709"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> U misread it... Problem is the enemies won't pursue the player anymore, DUE TO collision -.- <br><br></td></tr></table><br>
<a name="1125720"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Drak</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> What are you talking about Rez?  I downloaded the whole thing this time and the pursuit works absolutely fine!  I didn't even change anything... <br><br></td></tr></table><br>
<a name="1125721"></a>

<a name="1125722"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Try to make 2 or more enemies collide with the player at the same time. they point in the wrong direction and end up under the ground if theyre close to the player and have collided with the player...<br><br><br>I just need them to ALWAYS stay on the land. even during collision. and point the correct way<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1125726"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Drak</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> The problem lies in your gravity command.  Some simple debugging commands tell me that the variable dist# gets WAY out of whack soon after the player purposely collided with an enemy.  Get rid or change your gravity code in the main loop. <br><br></td></tr></table><br>
<a name="1125727"></a>

<a name="1125728"></a>

<a name="1125729"></a>

<a name="1125730"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, that clears THAT up, but for SOME reason, when the enemy gets close to the player, he randomly starts pointing towards the ground, and moves towards the ground, then just stops.... o.o<br><br>Here's the code: <br><br><br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">;Waypoint Example By Drak, 3/8/2010
;UPDATED 2/4/2012
;************************************************************
;THIS PROGRAM WILL:											*
;Create a player mesh (a square)							*
;Create some enemies (some spheres)							*
;Make on-the-fly waypoints for the enemies to return to		*
;Return the enemies to the waypoints						*
;Also shows some some rudimentary AI						*
;Shows some very simple particle effects as well			*
;************************************************************



;-------------------------------------------------------------------------------------------------------
;INITIALIZATION
;-------------------------------------------------------------------------------------------------------
Graphics3D 800,600,0,2
SetBuffer BackBuffer()
SeedRnd MilliSecs()

AmbientLight 255, 255, 255

Global type_player 	= 1
Global type_land 	= 2
Global type_obj 	= 3

Collisions type_player, type_land, 2, 3
Collisions type_player, type_obj, 2, 2
Collisions type_obj, type_obj, 2, 3

Global player = LoadAnimMesh("models\dwarf1.b3d")	;create a cube for the player
EntityColor player, 0,0,200		;we'll make the player blue
ScaleEntity player, .1, .1, .1
EntityType player, type_player

Global player_hp = 10			;give the player 10 hit points
Global player_alive = 1			;player is indeed alive

Global camera = CreateCamera()	;create a camera
CameraRange camera, .1, 999999999

Global sky = CreateCube()
ScaleEntity sky, 10000, 10000, 10000
EntityColor sky, 102, 102, 255
FlipMesh sky

Global Land = CreatePlane()
EntityColor Land, 0, 64, 0
EntityType Land, type_land

;-------------------------------------------------------------------------------------------------------
;TYPES
;-------------------------------------------------------------------------------------------------------
Type enemy
	Field mesh				;will hold the actual mesh
	Field return_waypoint	;will hold the handle of the return waypoint
	Field status			;holds a # referring to the enemies status
	Field speed#			;this will hold the speed of the enemy
	Field timer				;2/3/12 This will be a counter
	Field timer_max			;2/3/12 This is the counter's maximum
	Field steer_angle#		;2/3/12 This holds the enemy's steering angle
End Type

Type particle				
	Field mesh				;holds mesh
	Field alpha#			;holds alpha
	Field speed_x#			;speed x
	Field speed_y#			;same
	Field speed_z#			;same...
	Field fade_speed#		;fade_speed
End Type

;-------------------------------------------------------------------------------------------------------
;LETS CREATE SOME PRIMITIVES TO USE LATER	
;-------------------------------------------------------------------------------------------------------

Global spark = CreateCube()
ScaleEntity spark, .25,.25,.25
EntityColor spark, 255,168,0
HideEntity spark

Global waypoint = CreateSphere()
ScaleEntity waypoint, .5,.5,.5
EntityColor waypoint, 0,200,0
HideEntity waypoint

;-------------------------------------------------------------------------------------------------------
;CREATE SOME ENEMIES
;-------------------------------------------------------------------------------------------------------
For num = 1 To 5
	e.enemy = New enemy				;new enemy
	e\mesh = LoadAnimMesh("models\dwarf1.b3d") ;CreateSphere(16)		;create a sphere and store it in e\mesh
	e\speed = .1					;set the speed of each enemy
	e\status = 1					;set status to 1
	e\timer = 0						;2/3/12	set timer to 0
	e\timer_max = Rand(400,1000)	;2/3/12	pick a maximum timer
	PositionEntity e\mesh, Rand(-20,20),0,Rand(-20,20)	;place the enemies randomly
	;EntityAlpha e\mesh, .5
	RotateEntity e\mesh, 0,Rand(360),0
	ScaleEntity e\mesh, .1, .1, .1
	EntityType e\mesh, type_obj
Next

Global turnonanim = False

;-------------------------------------------------------------------------------------------------------
;MAIN LOOP
;-------------------------------------------------------------------------------------------------------
While Not KeyHit(1)
	For e.enemy = Each enemy
		If turnonanim  = True Then Animate e\mesh, 1, .1, 1, 15
	Next
	SuperCam(camera,player,.02,200,80,0,0)
	py# = EntityY#(player, True)
	For e.enemy = Each enemy
		ey# = EntityY#(e\mesh, True)
		If ey# &lt; 1.0 Then ey# = 1.0
		PositionEntity e\mesh, EntityX#(e\mesh, True), ey#, EntityZ#(e\mesh, True)
	Next
	If py# &lt; 1.0 Then py# = 1.0
	;If py# &gt; 1.0 Then gravity# = gravity# - .1
	;PositionEntity player, EntityX#(player, True), py#+gravity#, EntityZ#(player, True)
	get_input()
	run_enemies()
	run_particles()
	check_hp()
	
	
	UpdateWorld
	RenderWorld
	
	gui()
	Flip
	
Wend
;-------------------------------------------------------------------------------------------------------
;END MAIN LOOP
;-------------------------------------------------------------------------------------------------------


;-----------------------------------------------------------------------------------------------------
;FUNCTION GET_INPUT &lt;--- GRABS INPUT FOR THE PLAYER
;-----------------------------------------------------------------------------------------------------
Function get_input()
	If player_alive = 1
		MoveEntity player, 0, 0, (KeyDown(17)-KeyDown(31) Or KeyDown(200)-KeyDown(208))*.5
		TurnEntity player, 0, (KeyDown(30)-KeyDown(32) Or KeyDown(203)-KeyDown(205))*1, 0
	End If 
End Function 


;-----------------------------------------------------------------------------------------------------
;FUNCTION RUN_ENEMIES   &lt;---EXOCUTES ACTIONS FOR EACH ENEMY
;-----------------------------------------------------------------------------------------------------
Function run_enemies()
	For e.enemy = Each enemy	;for each enemy
		;regardless of case, the distance to the player must be known, so we'll check it here
		Local dist# = EntityDistance(e\mesh,player)
		Select e\status			;select it's status
				
			Case 1 ;ON GUARD
				EntityColor e\mesh, 200,200,0
				If dist# &lt;= 10		;if the distance is less than 10 or equal to it
					If player_alive = 1
						e\status = 2	;switch to state 2
					End If
					Else e\timer = e\timer + 1
					If e\timer &gt;= e\timer_max
						e\status = 6 ;switch to quick wander
						e\timer = 0	 ;reset the timer to 0
					End If
				End If 
				
			Case 2 ;DROP NEW WAYPOINT
				Local x# = EntityX(e\mesh)	;grab the enemies' coordinates
				Local y# = EntityY(e\mesh)
				Local z# = EntityZ(e\mesh)
				
						;place the waypoint at the location
				e\return_waypoint = CopyEntity(waypoint)
				PositionEntity e\return_waypoint,x#,y#,z#
				
				e\status = 3	;then switch to case 3, which is pursue
				
			Case 3 ;PURSUE THE PLAYER
				EntityColor e\mesh, 200,0,0	;red
				If dist# &lt; 1	;then attack!
					e\status = 4;change to attack
					Exit 		;exit the loop
				End If 
				
				If dist# &lt; 12	;first, check to see if we're 12 units away or less....
					PointEntity e\mesh, player		;point enemy at the player
					MoveEntity e\mesh, 0,0,e\speed	;then make the enemy move in the pointed direction
				Else
					e\status = 5	;set to status 5, which is return to waypoint
				End If 	
				
			Case 4 ;ATTACK
				player_hp = player_hp - 1	;take 1 hp from the player
				Local s_x# = EntityX(player)
				Local s_y# = EntityY(player)
				Local s_z# = EntityZ(player)
				Local num = Rand(3,8)
						;create some effects
				create_particles(num,s_x,s_y,s_z)
				e\status = 5				;now return to the waypoint
				
			Case 5	;RETURN TO WAYPOINT
				EntityColor e\mesh, 200,0,200
				Local dist_home# = EntityDistance(e\mesh,e\return_waypoint)	;get the distance home
				If dist_home# &gt; .2							;If we're further than .2 away...
					PointEntity e\mesh, e\return_waypoint	;point at home waypoint
					MoveEntity e\mesh, 0,0,e\speed			;move them forward
				Else If dist_home# &lt;= .2
					RotateEntity e\mesh, 0, 0, 0
					FreeEntity e\return_waypoint			;get rid of the waypoint mesh
					e\status = 1							;and return to idle again
				End If
				
				;CASE 6 ADDED ON 2/3/12
			Case 6	;WANDER
				EntityColor e\mesh, 0,200,0	;turn it green
						;KEEP THE WANDERING SIMPLE!!!! DON'T OVERCOMPLICATE THIS!!!!!
				
				e\timer = e\timer + 1
				If e\timer &lt;= e\timer_max
					e\steer_angle = e\steer_angle + Rnd(-.1,.1)
					If e\steer_angle &gt; 1 Then e\steer_angle = 1
					If e\steer_angle &lt; -1 Then e\steer_angle = -1
					TurnEntity e\mesh, 0,e\steer_angle,0
					MoveEntity e\mesh, 0,0,e\speed/5
				Else 
					e\timer = 0
					RotateEntity e\mesh, 0,Rand(360),0
					e\status = 1
				End If 
				
					;keep checking to see if the player is close enough to follow
				If dist# &lt;= 10		;if the distance is less than 10 or equal to it
					If player_alive = 1
						e\status = 2	;switch to state 2
					End If
				End If 
				
				
			Default
				e\status = 1	;if somehow e\status = anything else, we'll set it to 1
				
				
		End Select
	Next
End Function 

;-----------------------------------------------------------------------------------------------------
;GRAPHIC READOUTS   &lt;---This function prints readouts to the screen
;-----------------------------------------------------------------------------------------------------
Function gui()
	Text 0,0, "Use WASD keys to move around."
	Text 0,10,"Don't let the spheres touch you or you'll lose hitpoints."
	Text 0,20,"Remaining HP: " + player_hp
	
	If player_alive = 0
		Text 350,290,"You are DEAD!"
	End If 
End Function 


;-----------------------------------------------------------------------------------------------------
;RUN PARTICLES	   &lt;---This function runs the particles if there are any
;-----------------------------------------------------------------------------------------------------
Function run_particles()
	For p.particle = Each particle
		p\alpha = p\alpha - p\fade_speed	;take fade speed from alpha
		EntityAlpha p\mesh, p\alpha			;set alpha to p\alpha
		If p\alpha &lt;= 0					;if alpha is &lt;= 0
			FreeEntity p\mesh			;free it
			Delete p				
			Exit						;exit the loop
		Else
			p\speed_y = p\speed_y - .01							;subtract from y speed
			MoveEntity p\mesh, p\speed_x, p\speed_y,p\speed_z	;move the particle
		End If
		
		
	Next
End Function  


;-----------------------------------------------------------------------------------------------------
;CREATE PARTICLES	&lt;--- THis is called when we need to create particles
;-----------------------------------------------------------------------------------------------------
Function create_particles(num,x#,y#,z#)
	For s = 1 To num
		p.particle = New particle
		p\mesh = CopyEntity(spark)
		p\speed_x# = Rnd(-.2,.2)
		p\speed_y# = Rnd(.3)
		p\speed_z# = Rnd(-.2,.2)
		p\alpha = 1
		p\fade_speed# = Rnd(.1)
		PositionEntity p\mesh, x,y,z
	Next
End Function 

;-----------------------------------------------------------------------------------------------------
;CHECK HP	&lt;---This checks the player's HEALTH each frame
;-----------------------------------------------------------------------------------------------------
Function check_hp()
	If player_hp &lt;= 0
		player_hp = 0
		If player_alive = 1
			Local s_x# = EntityX(player)
			Local s_y# = EntityY(player)
			Local s_z# = EntityZ(player)
			Local num = Rand(15)
		;create some effects
			create_particles(num,s_x,s_y,s_z)
			player_alive = 0
		End If
	End If 
End Function 



Function SuperCam(cam,ent,cspeed#,dist#,hite#,xrot#,tilt#)
	
	TFormPoint 0,hite#,-dist#,ent,0
	
	cx#=(TFormedX()-EntityX(cam))*cspeed#
	cy#=(TFormedY()-EntityY(cam))*cspeed#
	cz#=(TFormedZ()-EntityZ(cam))*cspeed#
	
	TranslateEntity cam,cx,cy,cz
	PointEntity cam,ent
	RotateEntity cam,xrot#,EntityYaw(cam),tilt#
	
End Function</textarea><br><br><br><br>Thanks, Drak<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1125732"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Drak</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok.<br><br>First of all you are creating your dwarves so that their EntityRadius is BELOW the ground plane, meaning they will fall below the plane when collided with and get screwed up.<br><br>Second, you don't have any collision between the enemies and the ground, either.<br><br>Third, you need to create enemies and the player ABOVE the ground plane and let gravity set them down onto it.<br><br>Fourth, (edited)<br><br>Fifth, you aren't applying gravity to the enemies.<br><br>Sixth, the player was before getting pushed down below the ground plane as well because the player was also created with it's EntityRadius below the ground plane.<br><br>Seventh, your gravity code you were using did not have desired effect of actually producing gravity.<br><br>Eighth, I fixed this in about 15 minutes with very little effort.  Try some problem solving debugging commands first when you have problems.<br><br>Now until the next problem heres the code:<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
;Waypoint Example By Drak, 3/8/2010
;UPDATED 2/4/2012
;************************************************************
;THIS PROGRAM WILL:											*
;Create a player mesh (a square)							*
;Create some enemies (some spheres)							*
;Make on-the-fly waypoints for the enemies to return to		*
;Return the enemies to the waypoints						*
;Also shows some some rudimentary AI						*
;Shows some very simple particle effects as well			*
;************************************************************



;-------------------------------------------------------------------------------------------------------
;INITIALIZATION
;-------------------------------------------------------------------------------------------------------
Graphics3D 800,600,0,2
SetBuffer BackBuffer()
SeedRnd MilliSecs()

AmbientLight 255, 255, 255

Global type_player 	= 1
Global type_land 	= 2
Global type_obj 	= 3

Collisions type_player, type_land, 2, 3
Collisions type_player, type_obj, 2, 3
Collisions type_obj, type_obj, 2, 3
Collisions type_obj, type_land, 2,3

;WireFrame 1
Global player = LoadAnimMesh("models\dwarf1.b3d")	;create a cube for the player
EntityColor player, 0,0,200		;we'll make the player blue
ScaleEntity player, .1, .1, .1
EntityType player, type_player
PositionEntity player, 0,2,0

Global player_hp = 10			;give the player 10 hit points
Global player_alive = 1			;player is indeed alive

Global camera = CreateCamera()	;create a camera
CameraRange camera, .1, 999999999

Global sky = CreateCube()
ScaleEntity sky, 10000, 10000, 10000
EntityColor sky, 102, 102, 255
FlipMesh sky

Global Land = CreatePlane()
EntityColor Land, 0, 64, 0
EntityType Land, type_land

;-------------------------------------------------------------------------------------------------------
;TYPES
;-------------------------------------------------------------------------------------------------------
Type enemy
	Field mesh				;will hold the actual mesh
	Field return_waypoint	;will hold the handle of the return waypoint
	Field status			;holds a # referring to the enemies status
	Field speed#			;this will hold the speed of the enemy
	Field timer				;2/3/12 This will be a counter
	Field timer_max			;2/3/12 This is the counter's maximum
	Field steer_angle#		;2/3/12 This holds the enemy's steering angle
End Type

Type particle				
	Field mesh				;holds mesh
	Field alpha#			;holds alpha
	Field speed_x#			;speed x
	Field speed_y#			;same
	Field speed_z#			;same...
	Field fade_speed#		;fade_speed
End Type

;-------------------------------------------------------------------------------------------------------
;LETS CREATE SOME PRIMITIVES TO USE LATER	
;-------------------------------------------------------------------------------------------------------

Global spark = CreateCube()
ScaleEntity spark, .25,.25,.25
EntityColor spark, 255,168,0
HideEntity spark

Global waypoint = CreateSphere()
ScaleEntity waypoint, .5,.5,.5
EntityColor waypoint, 0,200,0
HideEntity waypoint

;-------------------------------------------------------------------------------------------------------
;CREATE SOME ENEMIES
;-------------------------------------------------------------------------------------------------------
For num = 1 To 5
	e.enemy = New enemy				;new enemy
	e\mesh = LoadAnimMesh("models\dwarf1.b3d") ;CreateSphere(16)		;create a sphere and store it in e\mesh
	e\speed = .1					;set the speed of each enemy
	e\status = 1					;set status to 1
	e\timer = 0						;2/3/12	set timer to 0
	e\timer_max = Rand(400,1000)	;2/3/12	pick a maximum timer
	PositionEntity e\mesh, Rand(-20,20),2,Rand(-20,20)	;place the enemies randomly
	;EntityAlpha e\mesh, .5
	RotateEntity e\mesh, 0,Rand(360),0
	ScaleEntity e\mesh, .1, .1, .1
	EntityType e\mesh, type_obj
Next

Global turnonanim = False

;-------------------------------------------------------------------------------------------------------
;MAIN LOOP
;-------------------------------------------------------------------------------------------------------
While Not KeyHit(1)
	For e.enemy = Each enemy
		If turnonanim  = True Then Animate e\mesh, 1, .1, 1, 15
	Next
	SuperCam(camera,player,.02,200,4,0,0)
	
	;-------------------------------------------
	;This crap was screwing up the collisions:
	;py# = EntityY#(player, True)
	;DebugLog "py# = " + py
	;If py# &lt; 1.0 Then py# = 1.0
	;If py# &gt; 1.0 Then gravity# = gravity# - .1
	;PositionEntity player, EntityX#(player, True), py#+gravity#, EntityZ#(player, True)
	;-------------------------------------------
	
	;simple gravity:
	MoveEntity player , 0,-.1,0
	For e.enemy = Each enemy
		MoveEntity e\mesh, 0,-.1,0
	Next
	
	
	get_input()
	run_enemies()
	run_particles()
	check_hp()
	
	
	UpdateWorld
	RenderWorld
	
	gui()
	Flip
	
Wend
;-------------------------------------------------------------------------------------------------------
;END MAIN LOOP
;-------------------------------------------------------------------------------------------------------


;-----------------------------------------------------------------------------------------------------
;FUNCTION GET_INPUT &lt;--- GRABS INPUT FOR THE PLAYER
;-----------------------------------------------------------------------------------------------------
Function get_input()
	If player_alive = 1
		MoveEntity player, 0, 0, (KeyDown(17)-KeyDown(31) Or KeyDown(200)-KeyDown(208))*.5
		TurnEntity player, 0, (KeyDown(30)-KeyDown(32) Or KeyDown(203)-KeyDown(205))*1, 0
	End If 
End Function 


;-----------------------------------------------------------------------------------------------------
;FUNCTION RUN_ENEMIES   &lt;---EXOCUTES ACTIONS FOR EACH ENEMY
;-----------------------------------------------------------------------------------------------------
Function run_enemies()
	For e.enemy = Each enemy	;for each enemy
		;regardless of case, the distance to the player must be known, so we'll check it here
		
		Local dist# = EntityDistance(e\mesh,player)
		;This also tells you ALOT:
		DebugLog "e\status is " + e\status + " Dist is " + dist
		Select e\status			;select it's status
				
			Case 1 ;ON GUARD
				EntityColor e\mesh, 200,200,0
				If dist# &lt;= 10		;if the distance is less than 10 or equal to it
					If player_alive = 1
						e\status = 2	;switch to state 2
					End If
					Else e\timer = e\timer + 1
					If e\timer &gt;= e\timer_max
						e\status = 6 ;switch to quick wander
						e\timer = 0	 ;reset the timer to 0
					End If
				End If 
				
			Case 2 ;DROP NEW WAYPOINT
				Local x# = EntityX(e\mesh)	;grab the enemies' coordinates
				Local y# = EntityY(e\mesh)
				Local z# = EntityZ(e\mesh)
				
						;place the waypoint at the location
				e\return_waypoint = CopyEntity(waypoint)
				PositionEntity e\return_waypoint,x#,y#,z#
				
				e\status = 3	;then switch to case 3, which is pursue
				
			Case 3 ;PURSUE THE PLAYER
				EntityColor e\mesh, 200,0,0	;red
				If dist# &lt; 1	;then attack!
					e\status = 4;change to attack
					Exit 		;exit the loop
				End If 
				
				If dist# &lt; 12	;first, check to see if we're 12 units away or less....
					PointEntity e\mesh, player		;point enemy at the player
					MoveEntity e\mesh, 0,0,e\speed	;then make the enemy move in the pointed direction
				Else
					e\status = 5	;set to status 5, which is return to waypoint
				End If 	
				
			Case 4 ;ATTACK
				player_hp = player_hp - 1	;take 1 hp from the player
				Local s_x# = EntityX(player)
				Local s_y# = EntityY(player)
				Local s_z# = EntityZ(player)
				Local num = Rand(3,8)
						;create some effects
				create_particles(num,s_x,s_y,s_z)
				e\status = 5				;now return to the waypoint
				
			Case 5	;RETURN TO WAYPOINT
				EntityColor e\mesh, 200,0,200
				Local dist_home# = EntityDistance(e\mesh,e\return_waypoint)	;get the distance home
				If dist_home# &gt; .2							;If we're further than .2 away...
					PointEntity e\mesh, e\return_waypoint	;point at home waypoint
					MoveEntity e\mesh, 0,0,e\speed			;move them forward
				Else If dist_home# &lt;= .2
					RotateEntity e\mesh, 0, 0, 0
					FreeEntity e\return_waypoint			;get rid of the waypoint mesh
					e\status = 1							;and return to idle again
				End If
				
				;CASE 6 ADDED ON 2/3/12
			Case 6	;WANDER
				EntityColor e\mesh, 0,200,0	;turn it green
						;KEEP THE WANDERING SIMPLE!!!! DON'T OVERCOMPLICATE THIS!!!!!
				
				e\timer = e\timer + 1
				If e\timer &lt;= e\timer_max
					e\steer_angle = e\steer_angle + Rnd(-.1,.1)
					If e\steer_angle &gt; 1 Then e\steer_angle = 1
					If e\steer_angle &lt; -1 Then e\steer_angle = -1
					TurnEntity e\mesh, 0,e\steer_angle,0
					MoveEntity e\mesh, 0,0,e\speed/5
				Else 
					e\timer = 0
					RotateEntity e\mesh, 0,Rand(360),0
					e\status = 1
				End If 
				
					;keep checking to see if the player is close enough to follow
				If dist# &lt;= 10		;if the distance is less than 10 or equal to it
					If player_alive = 1
						e\status = 2	;switch to state 2
					End If
				End If 
				
				
			Default
				e\status = 1	;if somehow e\status = anything else, we'll set it to 1
				
				
		End Select
	Next
End Function 

;-----------------------------------------------------------------------------------------------------
;GRAPHIC READOUTS   &lt;---This function prints readouts to the screen
;-----------------------------------------------------------------------------------------------------
Function gui()
	Text 0,0, "Use WASD keys to move around."
	Text 0,10,"Don't let the spheres touch you or you'll lose hitpoints."
	Text 0,20,"Remaining HP: " + player_hp
	
	If player_alive = 0
		Text 350,290,"You are DEAD!"
	End If 
End Function 


;-----------------------------------------------------------------------------------------------------
;RUN PARTICLES	   &lt;---This function runs the particles if there are any
;-----------------------------------------------------------------------------------------------------
Function run_particles()
	For p.particle = Each particle
		p\alpha = p\alpha - p\fade_speed	;take fade speed from alpha
		EntityAlpha p\mesh, p\alpha			;set alpha to p\alpha
		If p\alpha &lt;= 0					;if alpha is &lt;= 0
			FreeEntity p\mesh			;free it
			Delete p				
			Exit						;exit the loop
		Else
			p\speed_y = p\speed_y - .01							;subtract from y speed
			MoveEntity p\mesh, p\speed_x, p\speed_y,p\speed_z	;move the particle
		End If
		
		
	Next
End Function  


;-----------------------------------------------------------------------------------------------------
;CREATE PARTICLES	&lt;--- THis is called when we need to create particles
;-----------------------------------------------------------------------------------------------------
Function create_particles(num,x#,y#,z#)
	For s = 1 To num
		p.particle = New particle
		p\mesh = CopyEntity(spark)
		p\speed_x# = Rnd(-.2,.2)
		p\speed_y# = Rnd(.3)
		p\speed_z# = Rnd(-.2,.2)
		p\alpha = 1
		p\fade_speed# = Rnd(.1)
		PositionEntity p\mesh, x,y,z
	Next
End Function 

;-----------------------------------------------------------------------------------------------------
;CHECK HP	&lt;---This checks the player's HEALTH each frame
;-----------------------------------------------------------------------------------------------------
Function check_hp()
	If player_hp &lt;= 0
		player_hp = 0
		If player_alive = 1
			Local s_x# = EntityX(player)
			Local s_y# = EntityY(player)
			Local s_z# = EntityZ(player)
			Local num = Rand(15)
		;create some effects
			create_particles(num,s_x,s_y,s_z)
			player_alive = 0
		End If
	End If 
End Function 



Function SuperCam(cam,ent,cspeed#,dist#,hite#,xrot#,tilt#)
	
	TFormPoint 0,hite#,-dist#,ent,0
	
	cx#=(TFormedX()-EntityX(cam))*cspeed#
	cy#=(TFormedY()-EntityY(cam))*cspeed#
	cz#=(TFormedZ()-EntityZ(cam))*cspeed#
	
	TranslateEntity cam,cx,cy,cz
	PointEntity cam,ent
	RotateEntity cam,xrot#,EntityYaw(cam),tilt#
	
End Function
;~IDEal Editor Parameters:
;~C#Blitz3D
</textarea> <br><br></td></tr></table><br>
<a name="1125735"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> That works almost. Thanks, Drak. The only problem I seem to notice now, is if u have 2 enemies following u at the same time, and the player is too close to both their waypoints, when they go back to their waypoints, they rotate weird. <br><br></td></tr></table><br>
<a name="1125737"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Drak</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> C'mon man put some effort into it!  At least TRY to figure out why that's happening.  Do some problem solving!<br><br>We know that:<br>1. The models will sometimes rotate onto their backs when homing in on the waypoint.<br><br>2. We are using the PointEntity() command to home them in on that waypoint.<br><br>3. This can only mean that the return waypoint is slightly above the model.<br><br>4. If you wait a few seconds before moving, it won't happen.<br><br>This can mean only that since gravity is pulling the meshes down -.1 an iteration, that the models have not settled down onto the ground plane yet. <br><br>Solution:  Wait longer before moving. <br><br></td></tr></table><br>
<a name="1125739"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Fixed it! Thanks, Drak! :) Turns out that the enemies were positioned at 2Y, rather than 1Y...<br><br><br>PositionEntity e\mesh, Rand(-20,20),1,Rand(-20,20)	;place the enemies randomly <br><br></td></tr></table><br>
<a name="1125740"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Drak</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes I know because I typed in the 2.  Simply running the program and letting it run for 5 seconds while the enemies come down to the ground plane also fixes it. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
