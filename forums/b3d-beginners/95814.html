<!DOCTYPE html><html lang="en" ><head ><title >Floats vs. Doubles</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Floats vs. Doubles</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=5" >Blitz3D Beginners Area</a>/<a href="#bottom" >Floats vs. Doubles</a><br><br>
<a name="1105874"></a>

<a name="1105876"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rob the Great</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm aware that Blitz3D only supports floats, but I've never really seen the problem with floats until just now where I'm getting a weird result. As an example:<br><pre class=code>
Local testfloat# = 1.1

While Not KeyDown(1)

   If KeyHit(200)
      testfloat# = testfloat# + 0.1
   EndIf
   If KeyHit(205)
      testfloat# = testfloat# - 0.1
   EndIf

Wend
</pre><br>When I cycle through the numbers, everything is fine until testfloat# becomes 0.1 or 0.0. When it should be 0.1, Blitz will skip from 0.2 to 0.0999999, and when it should be 0.0, it turns into a very small exponent just below 0 (-0.0000000745058). These are both close enough to the real value that I don't care if they're handled this way, I was mostly just wondering if a double would have the same results.<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1105881"></a>

<a name="1105882"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, but the error would be smaller.<br><br>The problem: IEEE floating-point numbers are stored as a <i>binary fraction</i>, which unfortunately isn't capable of representing numbers like 0.1 accurately as they happen to be infinitely recurrent in that representation. Operations involving that number will thus actually become operations involving the nearest representable value.<br><br>The solution: don't ever write code that relies on floating-point numbers returning an exact result. e.g. Never compare the values of two floats, but instead compare their <i>difference</i>:<br><br><pre class=code>
Local f1# = 0.1, f2# = (f1 + 0.2) - 0.1

Print (f1 = f2)    ;BAD

Const EPSILON = 0.001
Print Abs(f1 - f2) &gt; EPSILON    ;GOOD
</pre><br><br>When you want to do things like have a nice printable version of the number, you effectively have to clean it up first. The only real advantage of doubles for this is that the errors might be small enough that if the value is cast back to a float for printing, it will clean itself.<br><br>Oh and for the love of all that is good in the world, <i>don't use floats or doubles to store financial values</i>!<br><br>Basically... yes, this is arguably a bug, but nothing to do with Blitz. The general assumption is that floats are "good enough" for most high-speed purposes (e.g. 3D graphics - who can see the difference?) and if you really need an accurate value, you can afford to sacrifice speed and use a bignum of some kind instead, or perhaps a fixed-point fractional number (i.e. an int, but move the decimal place by a known amount when it's time to print the value).<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1105887"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rob the Great</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm.......This actually explains a lot of some very frustrating problems in the past. I've run into problems where I would be comparing two floats, but I could never get them to be the same in some situations. Many debugging hours later, I eventually resolved this by just giving a little bit of error range, such as (much like your example):<br>"If number1# &lt;= number#2 + 0.05 And number1# &gt;= number2# - 0.05".<br>I like the ABS comparison, though. It looks cleaner. <br><br></td></tr></table><br>
<a name="1105889"></a>

<a name="1105890"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Learned some interesting stuff myself. In wondering why this Doubles DLL: <a href="http://www.blitzbasic.com/Community/posts.php?topic=94852" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=94852</a><br><br>...is so large and complicated, I discovered the issue of FPU modes, which I never knew about before. Interesting reading here: <a href="http://stereopsis.com/FPU.html" target="_blank">http://stereopsis.com/FPU.html</a><br><br>So simple solutions like simply writing a C function to accept a couple of 8-byte objects, do something to them, and return a result, wouldn't actually work. Fascinating.<br><br>I would have just used a one-liner function through <a href="/posts.php?topic=92323" target="_blank">TCC</a> for this... and likely wouldn't have worked at all! Although as it happens TCC does support the mode switch function too, so it could be made to work. (Not much point in this tangent unless you also have a use for TCC, note.)<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1105970"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rob the Great</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Interesting stuff, but most of this is above my knowledge in programming. I kinda-sorta get what's going on, but I'm only vaguely familiar with C based languages. I just never spent the time to learn anything outside of Blitz3D. I even tried reading the MIT book regarding LISP that you provded a while back, and I had a rough time getting through the first ten pages. lol. <br><br></td></tr></table><br>
<a name="1105991"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xlsior</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Realistically, you can never assume that a float is identical in comparisons, they are only good up to a certain number of digits of accuracy.<br><br>When comparing floats, you should always compare against a range:<br><br>in stead of: if x=0 then...<br><br>you should use something like:<br>if x&gt;= -0.001 and x&lt;= 0.001<br><br>to make sure you don't run into the rounding issue. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
