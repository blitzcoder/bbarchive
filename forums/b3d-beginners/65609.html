<!DOCTYPE html><html lang="en" ><head ><title >Placing 3d objects on a rotating/tilting map</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Placing 3d objects on a rotating/tilting map</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=5" >Blitz3D Beginners Area</a>/<a href="#bottom" >Placing 3d objects on a rotating/tilting map</a><br><br>
<a name="732913"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >hockings</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is my first attempt at a 3d project so bear with me (the concepts are taking a while to sink in :D<br><br>I'm programming a racing game. My "map" on which I build my track is an 8x8 grid. On this grid I plan to put track pieces (each made of 3 meshes - a top then two sides which are the support beams) and these pieces are created dynamically depending what the player picks. <br><br>So far I have my map which I can rotate and zoom and select individual squares on. I also have track pieces I can create (push a button and I get my 3 dynamic meshes created). What I can't figure out is this...<br><br>If the map was stationary, putting a piece at an X,Y location and elevating it a bit to put it "on" the map (rather than "in" or "underneath" it) would be easy. Instead though, my map can be tilted and rotated. I want to know how I can rotate/tilt my track, then when I select a new piece have it end up in the correct spot. <br>The yaw/tilt/roll I figure I match to whatever the map is, but I can no longer just add 1 to the Z location on the map to make sure the piece ends up "on" the map (rather than in or underneath it). If the map has tilted towards the player, the piece now needs to be moved +Z and -Y from where it started to be put "on" the map. It might also have rotated which further changes X, Y and Z coords.<br><br>1) Any takers on how I can work out where to put my piece so it's 1 3D-space unit above the map regardless of how the map has tilted/rotated? It will be a vector command of some description, but I'm not sure what.<br>2) Also, rather than having to move up to 64 pieces every time I manipulate the map, can I "glue" the piece to the map so rotating the map correctly places the pieces? I'd need to be able to "unglue" the piece afterwards if the player deleted it.<br><br>Thanks a bunch people!!! <br><br></td></tr></table><br>
<a name="732921"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SoggyP</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello.<br><br>I'm not too conversant with 3d side of things and will probably be shot down for the following:<br><br>2) Parent the pieces to the main map.<br>1) Could you have 64 individual map sections (again parented to a main map pivot so they all rotate/tilt together) and use a collision/pick command to select which one you're editing?<br><br>Just suggestions.<br><br>Best of luck.<br><br>Goodbye. <br><br></td></tr></table><br>
<a name="733029"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >hockings</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the reply soggyp.<br>The map sections are individual sections, and I've managed to get it so you can select an individual tile out of the 64. They pivot together nicely, but they are all part of the same mesh so that makes that easy.<br><br>I can't figure out how to parent other meshes to the main map mesh (such that they can be deleted later if needed), and how to place one on the other at the right location.<br><br>I'm sure this'll all click once I've done it once :D <br><br></td></tr></table><br>
<a name="733038"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >b32</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can calculate the right position by using TFormPoint:<br><br>TFormPoint 0, 1, 0, scene, 0<br>means: transform point (0,1,0) from "scene" to "0" (=global world). <br>(0,0,0) is the objects position itself. Any rotations/scaling is taking in account using TFormPoint.<br>After that, read TFormedX(), TFormedY() and TFormedZ() to get the transformed position:<br>PositionEntity obj, TFormedX(), TFormedY() and TFormedZ()<br><br>You can schtick objects to the scene using EntityParent:<br>EntityParent obj, scene<br>To detach them, use EntityParent obj, 0 (&lt;-global world) <br><br></td></tr></table><br>
<a name="733039"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SoggyP</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello.<br><br>Ok, how about having 64 pivots 1 unit above each block parented to the block so that they'll rotate and tilt with it, then parenting the new block to that?<br><br>Also, you might want to check out the local and world(?) values of the objects and also the pitch, yaw and roll functions.  I think I've got that right :o)<br><br>Goodbye. <br><br></td></tr></table><br>
<a name="733078"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> It as easy as ....<br><br>entityparent section, map<br>rotateentity section, 0, 0, 0<br>positionentity section, Xpos, 1, Zpos<br><br>Where Xpos and Zpos should already be known depending on which grid square is being changed.  How exactly are you determining which part of the 8x8 grid is being edited/changed?  CameraPicking?<br><br>All sections will move with the map when rotated.<br><br>Stevie <br><br></td></tr></table><br>
<a name="733144"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >hockings</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the replys guys.<br><br>I'm camera picking to determine which square on the 8x8 grid is being acted on (and that bit's working fine). <br><br>Thanks for the info on entityparent and tformpoint  - I'll have a play with them tonight and see how it goes.<br><br>Stevie G - Will positionentity X,1,Z work if the plane is pointing towards you at a 45 degree angle for example? (ie to get the piece 1 unit above the ground but perpendicular to it, it would need to go a little bit up and a little towards you, not just 1 unit straight up) <br><br></td></tr></table><br>
<a name="733206"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>Stevie G - Will positionentity X,1,Z work if the plane is pointing towards you at a 45 degree angle for example? (ie to get the piece 1 unit above the ground but perpendicular to it, it would need to go a little bit up and a little towards you, not just 1 unit straight up) <br> <br></div><br><br>Yes, because you're positioning it within the maps local space, rather than global.  It therefore takes into consideration the map's rotation when positioning.<br><br>No need for tform commands here.<br><br>Stevie <br><br></td></tr></table><br>
<a name="733421"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >hockings</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Cheers Stevie!!! I'll give it a whirl. <br><br></td></tr></table><br>
<a name="735350"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >hockings</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Stevie G, that worked perfectly. Much appreciated.<br><br>Loving the look of your verlet physics engine test game - looking forward to the final product! <br><br></td></tr></table><br>
<a name="736468"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >hockings</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Any takers on how I rotate a mesh around its centre rather than 0,0,0? I'm looking through the docs for something like mesh origin but can't find anything that looks right.<br><br>*EDIT* CreatePivot seems to be heading in the right direction, but doesn't look quite right... <br><br></td></tr></table><br>
<a name="736524"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >b32</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Objects rotate around their own centre, so their own (0, 0, 0). To change this (on static objects), use PositionMesh/FitMesh. For animated objects, I believe a pivot it best. There is a routine in the archives: <a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=732" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=732</a><br>or you could use this:<br><pre class=code>
Function CenterMesh(mesh)

	a_minx# = 100000
	a_maxx# = -100000
	a_miny# = 100000
	a_maxy# = -100000
	a_minz# = 100000
	a_maxz# = -100000

	validmesh = (mesh &lt;&gt; 0)
	If validmesh Then validmesh = EntityClass$(mesh) = "Mesh"
	If validmesh Then
		For i = 1 To CountSurfaces(mesh)
			s = GetSurface(mesh, i)
			For v = 0 To CountVertices(s) - 1
				TFormPoint VertexX(s, v), VertexY(s, v), VertexZ(s, v), mesh, 0
				If TFormedX() &lt; a_minx Then a_minx = TFormedX()
				If TFormedX() &gt; a_maxx Then a_maxx = TFormedX()
				If TFormedY() &lt; a_miny Then a_miny = TFormedY()
				If TFormedY() &gt; a_maxy Then a_maxy = TFormedY()
				If TFormedZ() &lt; a_minz Then a_minz = TFormedZ()
				If TFormedZ() &gt; a_maxz Then a_maxz = TFormedZ()
			Next
		Next
	End If
	
	PositionMesh mesh, -(a_minx+a_maxx)/2, -(a_miny+a_maxy)/2, -(a_minz + a_maxz)/2
	
End Function	
</pre> <br><br></td></tr></table><br>
<a name="736694"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hockings, I'm a wee bit pissed but ...<br><br>Mw# = messhwidth( mymesh )<br>Mh# = meshheight( mymesh )<br>Md# = meshdepth( mymesh )<br>fitmesh mymesh, -.5*mw, -.5*mh, -.5*md, mw,mh,md<br><br>Will recenter your mesh a wee bit quicker than the above ;)<br><br>Stevie <br><br></td></tr></table><br>
<a name="738332"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >hockings</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> b32 and Stevie G, thanks muchly!!!! This 3d stuff is a bit hard to get your head around. <br><br></td></tr></table><br>
<a name="739132"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >hockings</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've just tried Stevie G's method and it didn't work - any thoughts while I try b32's method?<br><br>My mesh is a flat grid (effectively a plane) with vertex's in the X and Z coords, height is 0.<br><br>FitMesh with a height of 0 completes, but when you then do a MeshHeight on the Mesh, the debugger returns "NaN" rather than 0. I've tried hard coding the height to either 0 or 1, but it keeps happening. Thoughts?<br><br>In the meantime I might try PositionMesh (Mesh, -0.5*Width, -0.5*Height,-0.5*Depth). <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
