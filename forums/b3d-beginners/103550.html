<!DOCTYPE html><html lang="en" ><head ><title >Interprocess comm - newbie query</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Interprocess comm - newbie query</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=5" >Blitz3D Beginners Area</a>/<a href="#bottom" >Interprocess comm - newbie query</a><br><br>
<a name="1247800"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mikorians</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Never EVER had much luck in Visual Basic 6 doing this in the past...<br>I come to learn that a dummy network connection is how it's done?<br><br>Ancient History: What I've used has been open text files. Tried something called DDS.  I forget...  Tried to SendMessage with FindWindow / FW Ex<br><br>Anyway, so writing shared files is causing 3D frame hiccup issues between my apps...<br>Will writeline with the network solve this if I go through all the trouble?<br>My messages - semaphore? - are brief.<br><br>FYI: It's for a SPECIAL force-feedback device not supported in blitz - non joystick.<br>Medical application. <br><br></td></tr></table><br>
<a name="1247801"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I know this is blitz but a "regular" language like java can do this very easily...<br><br>With blitz3d you are going to have troubles with applications hogging the cpu.<br><br>However with blitzplus you may be able to do it since you can use events. <br><br></td></tr></table><br>
<a name="1247802"></a>

<a name="1247803"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mikorians</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> What I'm wondering is IF the network pipe is going to work any better than the harddrive-based one because even without any client application, there seems to be a DEFINITE frame stutter every time I issue a writeline to any open disk file.<br><br>I'm only assuming it will be because multiplayer gamedevs would be up in arms if we couldn't escape this sort of stuttering- it's significant.<br>So is my semaphore gonna work or am I outta luck? <br><br></td></tr></table><br>
<a name="1247812"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I would think using network commands to communicate between two apps on same device would be much faster than opening, writing and closing a file...<br><br>However it sounds like you would be better off simply copying areas of memory between the two apps.  There are windows system functions in the kernel et copy memory or something which I vaguely remember being good for this sort of thing. <br><br></td></tr></table><br>
<a name="1247813"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Eg <a href="http://www.boost.org/doc/libs/1_41_0/doc/html/interprocess/sharedmemorybetweenprocesses.html" target="_blank">http://www.boost.org/doc/libs/1_41_0/doc/html/interprocess/sharedmemorybetweenprocesses.html</a> <br><br></td></tr></table><br>
<a name="1247915"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mikorians</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thank you for the link, Matty, but it's not for vb.net.<br>I'd need a vb6 example of its use.<br>I note also a lack of blitz3d example.<br>We old timer basic types aren't as flexible as you. <br><br></td></tr></table><br>
<a name="1247924"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah...the link I was showing was more for the general idea than a specific example of how to code it.<br><br>I think this blitz code archives entry may come in handy.<br><br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=1180" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=1180</a> <br><br></td></tr></table><br>
<a name="1247932"></a>

<a name="1247933"></a>

<a name="1247934"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mikorians</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> That's a good list of the relevant API functions.<br>Now, without me crashing my system...<br><br>I might possibly be able to write a peer ap in vb6 if I had a blitz ap to examine.<br>All I saw was a daunting bmax post.<br>Does nobody else need IPC or am I the only one?<br>Heh. <br><br></td></tr></table><br>
<a name="1247950"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="http://www.vbforums.com/showthread.php?696123-VB6-MMapper-Memory-Mapped-File-Demo" target="_blank">http://www.vbforums.com/showthread.php?696123-VB6-MMapper-Memory-Mapped-File-Demo</a><br><br>and the google query:<br><br>vb6 memory mapped files<br><br>.... if you are after vb6 that may be a start. <br><br></td></tr></table><br>
<a name="1248052"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mikorians</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wow!  Thanks for the VB6 sample page!<br>Am I going to have any trouble making the Blitz3D version?<br>I have a LOOSE understanding of using the decls API files (I collected them all). <br><br></td></tr></table><br>
<a name="1248304"></a>

<a name="1248306"></a>

<a name="1248360"></a>

<a name="1248362"></a>

<a name="1248561"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mikorians</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here we go!<br><br>-Ah, You're WELCOME.-<br><br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
;Memory-Mapped File IPC Demonstration Application
;================================================
;This library/test application can be used for IPC
;(Inter-Process Communications)
;Adapted from an internet Visual Basic 6 Demo Source Code
;Adaptation to Blitz3D by Mikorians (2014)
;
;This application doesn't guarantee bug-free operation!
;Some errors don't seem to be trappable, and unlike the
;VB6 source claim, the "page-memory-mapped file" seems to
;be semi-permanent and is NOT released upon closure of
;the file. But at least in XP 32 Bit, rebooting clears
;the page memory and the file dissapears.

;Kernel32.decls file (customized in my case):
;api_CreateFileMapping% (hFile%, lpFileMappingAttributes%, flProtect%, dwMaximumSizeHigh%, dwMaximumSizeLow%, lpName$) : "CreateFileMappingA"
;;(changed from pointer: lpFileMappingAttributes* unless you're using the type structure)
;api_RtlCopyMemory(Destination,Source*,Length):"RtlMoveMemory"
;apiRtlCopyMemory(Destination*,Source%,Length%):"RtlMoveMemory"
;;(my custom bi-directional pointer duplicator methods)

;This program will work just fine with the VB6
;Read and Write applications in the .zip file
;from this Web page:
;www.vbforums.com/showthread.php?696123-VB6-MMapper-Memory-Mapped-File-Demo

Const API_NULL = 0
Const API_FALSE = 0
Const INVALID_HANDLE_VALUE% = -1
Const PAGE_READWRITE = 4
Const SECTION_MAP_WRITE = 2
Const FILE_MAP_WRITE = 2
Const ERROR_ALREADY_EXISTS = 183

Type SECURITY_ATTRIBUTES
    Field nLength
    Field lpSecurityDescriptor
    Field bInheritHandle
End Type

Global MemPool=CreateBank(104)
Global hObj
Global lpMap
Const mSize = 104

OpenMap("MMDemo")
WriteMap(0,"Initialization")
While Not KeyHit(1)
a$=ReadMap$()
DebugLog (PeekInt(MemPool,0))+","+a$
Wend
CloseMap()
End

Function CloseMap()
	api_UnmapViewOfFile(lpMap)
	api_CloseHandle hObj
	hObj=0
	Delay 1500
End Function

Function CreateMap%(Name$)
	hObj=api_CreateFileMapping(INVALID_HANDLE_VALUE%,API_NULL%,PAGE_READWRITE%,API_NULL%,mSize%,Name$)
 If hObj = API_NULL Then
		RuntimeError 	"CreateFileMapping system error!"
		Return ERROR_ALREADY_EXISTS
	End If
	lpMap = api_MapViewOfFile(hObj, FILE_MAP_WRITE, 0, 0, 0)
	If lpMap = API_NULL Then
		RuntimeError "MapViewOfFile system error!"
	End If
End Function

Function OpenMap(Name$)
	hObj=api_OpenFileMapping(FILE_MAP_WRITE,API_FALSE,Name$)
 If hObj = API_NULL Then
		CreateMap%(Name$)
		Return
		;RuntimeError 	"Filename might be non-existent or error!?"
	End If
	lpMap = api_MapViewOfFile(hObj, FILE_MAP_WRITE, 0, 0, mSize)
	If lpMap = API_NULL Then
		RuntimeError "MapViewOfFile system error!"
	End If
End Function

Function ReadMap$()
	If hObj = API_NULL Then RuntimeError "ReadMap: Map not open"
	;Loop steps by 2 because VB6 sends UNICODE 2 byte pairs
	;and every odd byte was a 0 (0x00)
	;(This would truncate our string short)
	;If you don't need unicode, you can use all of the bank.
	;Change ReadMap AND WriteMap to match.
	apiRtlCopyMemory(MemPool,lpMap%,mSize%)
	t=4:a$=""
	Repeat
	i=PeekByte(MemPool,t)
	a$=a$+Chr$(i)
	t=t+2
	Until (i=0 Or t=&gt;mSize)
	Return Trim$(a$)
End Function

Function WriteMap(N%,lpData$)
	If hObj = API_NULL Then RuntimeError "WriteMap: Map not open"
	;Loop steps by 2 because VB6 expects UNICODE 2 byte pairs
	;and every odd byte was a 0 (0x00)
	;(This would truncate our string short)
	;If you don't need unicode, you can use all of the bank.
	;Change ReadMap AND WriteMap to match.
	PokeInt MemPool,0,N%
	lpData$=Left$(lpData$,(mSize-4)*.5)
	o=0:For t=1 To Len(lpData$)
		PokeByte MemPool,4+o,Asc(Mid$(lpData$,t,1))
		PokeByte MemPool,5+o,0
		o=o+2
	Next
	for t=4+o to mSize-3 step 4:PokeInt MemPool+t, 0:next
	api_RtlCopyMemory(lpMap%,MemPool,mSize%)
End Function
</textarea> <br><br></td></tr></table><br>
<a name="1248358"></a>

<a name="1248560"></a>

<a name="1248572"></a>

<a name="1248573"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mikorians</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hm. When added to my larger program, it seems to crash on exit sometimes (!)<br>Aha! With modern process concurrency, Blitz was 'END' ing too quickly.<br>My bug fix has been added to counter this!<br><br>Moreover-<br>Make sure to end in one of 3 ways:<br><br>1. The last thing you do.<br>CloseMap()<br>End<br><br>Or (if needed)<br><br>2. The last thing you do.<br>Delay 500<br>ExecFile f$<br>CloseMap()<br>End<br><br>Try-<br><br>3. Almost the last thing you do.<br>CloseMap()<br>Delay 1000<br>End<br><br>Pernicious when used in conjunction with com port.<br>Pre-delay before as in #2 with com port closing<br>-Before the delay-<br><br>ALL FYI <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
