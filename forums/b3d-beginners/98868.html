<!DOCTYPE html><html lang="en" ><head ><title >Correct z-ordering of tris near others ?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Correct z-ordering of tris near others ?</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=5" >Blitz3D Beginners Area</a>/<a href="#bottom" >Correct z-ordering of tris near others ?</a><br><br>
<a name="1158061"></a>

<a name="1158063"></a>

<a name="1158064"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello, :)<br><br>I am trying to add a glow effect to some parts of the meshes, for example some windows of a building, or some parts of a lamp.<br><br>My method for now is to use 2 separate meshes : 1 mesh for the material parts, 1 mesh for the glowing parts.<br>This way, each frame i can color the material parts in black (with EntityColor), render the scene, and apply a blur routine to this image in order to have the glowing effect.<br><br>However it seems it produces a problem of z-ordering :<br><img src="http://imageshack.us/a/img715/1291/dwtest001.jpg"><br><br>As you can see, some windows are drawn behind the walls, it is strange because there is an offset of 0.01 between the wall and each window. <br>Also i don't use the alpha flag or the mask flag, all the windows are meshes colored with vertex colors.<br><br>Do you think it will be possible to avoid this z-ordering problem if i use one mesh with 2 surfaces instead of 2 separate meshes ? (1 surface for the walls, 1 surface for the windows)<br><br>Else, do you have any idea about what to do to avoid this ?<br><br>I want to be able to change the color of each window when i want, i don't know if using a texture is a better way ? What do you think ?<br><br>Also please note that it is just a test, i want to add more details to each building and window.<br><br>Thanks for your suggestions,<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1158082"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> One thing I've found is that if you manually place vertices using VertexCoords, as long as you put one polygon <i>exactly</i> on top of another, you can force the drawing order: the most-recently-placed one will be drawn first without Z-fighting. They have to be dead-on-top for this though... I assume it disables sorting somehow. This only works if they're within the same mesh.<br><br>The other thing is that it depends on your camera range. Depending on how far away those building are, it may not have enough precision left for 0.01 to be a meaningful distance. There's a nice little Z-calculator here: <a href="http://www.sjbaker.org/steve/omniv/love_your_z_buffer.html" target="_blank">http://www.sjbaker.org/steve/omniv/love_your_z_buffer.html</a><br><br>...that shows that with Blitz3D's default camera range settings (1:1000), 0.01 is too small to represent in the Z-buffer at distances of greater than around 400 units.<br><br>You could either 1) dynamically increase the offset with distance from the camera, as the camera moves (which may cause some problems of its own); or 2) have a separate render for distant objects like the buildings, with a more appropriate camera range (since most Z-values are clustered nearer to the camera, this mainly means extending the <i>minimum</i> range to be as close to the target as possible so that the most precision is brought to bear on what you want); or 3) use a full-on skybox and have the buildings actually be very small. <br><br></td></tr></table><br>
<a name="1158084"></a>

<a name="1158085"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>1) dynamically increase the offset with distance from the camera, as the camera moves<br> <br></div><br>Good idea. But i don't think it will be appropriate when i will add more details to the walls and the windows.<br><br><div class="quote"> <br>2) have a separate render for distant objects like the buildings, with a more appropriate camera range<br> <br></div><br>Ok and maybe i can use a quad with a texture for the far away buildings, i have thought about that.<br><br><div class="quote"> <br>3) use a full-on skybox and have the buildings actually be very small. <br> <br></div><br>What do you mean ? To reduce the size of the buildings and the size of the world ?<br>How can this affect the z-ordering problem ?<br><br><br>About the skybox, if i want to have a skybox of 2048 * 2048 * 2048 units, then how am i suppose to render it, if i set the max CameraRange at less than 2048 ?<br>With EntityOrder() ?<br>With 2 Renderworld() ?<br><br>Thanks,<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1158090"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> What do you mean ? To reduce the size of the buildings and the size of the world ?<br>How can this affect the z-ordering problem ?<br><br><br>About the skybox, if i want to have a skybox of 2048 * 2048 * 2048 units, then how am i suppose to render it, if i set the max CameraRange at less than 2048 ? <br></div><br><br>If you have two cameras, in two scenes, each hidden when the other is rendered:<br><br>-- buildings and background can be made into a single scene with an appropriate scale/camera range combination. The camera's movement is scaled to match the player camera's movement in the main scene<br><br>-- the background camera renders first<br><br>-- either 1) render it directly, then disable the clearing of the colour buffer for the scene camera (in which case the background will just be "there"), or 2) render three views that match the player's orientation to a cubemap, and paste this cubemap onto a literal box around the player camera (option 2 is more demanding on resources, but option 1 may not work well with all rendering setups)<br><br>So the answer to your skybox question is: you don't. The skybox image isn't static, and the whole point is that it doesn't have to be 2048 units away (assuming it even has to exist): the image cubemapped onto it gives the illusion of much greater depth. The skybox only has to be just big enough to fit around every visible part of the main scene. <br><br></td></tr></table><br>
<a name="1158097"></a>

<a name="1158098"></a>

<a name="1158099"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>The other thing is that it depends on your camera range. Depending on how far away those building are, it may not have enough precision left for 0.01 to be a meaningful distance. There's a nice little Z-calculator here<br> <br></div><br>I have tried to set the CameraRange to 1,1000 and it seems to be rendered correctly. The render is also correct with 0.5,512<br>So it think that i will follow your suggestion to do several renders with different CameraRange<br><br>Maybe something like this :<br>1)Hide all components of the 3D scene<br>2)Show the skybox<br>3)Set the CameraRange to 100,2049<br>4)Render the scene and i keep this image in memory<br>5)Show all components of the 3d scene<br>6)Hide the skybox<br>7)Set the CameraRange to 1,1000 with a CameraClsColor of 000,000,000<br>8)Render the scene and i keep this image in memory<br>9)Set the CameraRange to 0.1,100 with a CameraClsColor of 000,000,000<br>10)Render the scene and i keep this image in memory<br>11)Draw the image of the skybox<br>12)Draw the image of the components of the 3d scene 1,1000<br>13)Draw the image of the components of the 3d scene 0.1,100<br><br>Because the pixels with a rgb or 000,000,000 are considered invisible by the function DrawImage(), this should work.<br>But i have to code a routine so that i only render the 3D components of the scene once.<br><br>Ok thank you for this suggestion, i will try.<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1158121"></a>

<a name="1158128"></a>

<a name="1158129"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Why don't you do a multipass render? this is something Ross C. used to suggest:<br><br>[bbcode]<br>;Multi-pass, Z-fighting free render method:<br><br>Const RANGE_INCREMENT# = 250 ;A smaller value will make it even more precise.<br><br>;[...]<br><br>;When rendering the camera:<br>CameraCLSMode camera,False,False ;Keep color and depth information for all passes, so they composite.<br><br>For i = 1 to 4<br>	CameraRange(camera, (1+RANGE_INCREMENT*(i-1)), (1+RANGE_INCREMENT*i))<br>	RenderWorld()<br>Next<br>[/bbcode]<br><br>What you're doing is this:<br><img src="http://i47.tinypic.com/nyd8c3.png"><br>So you keep a precise Z-buffer for every 'shot' of the scene.<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1158392"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Kryzon&gt;&gt;Interesting technique, thanks.<br><br>But i am wondering if it will calculate the render for some meshes twice...<br><br>I guess i have to try <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
