<!DOCTYPE html><html lang="en" ><head ><title >Collision Q</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Collision Q</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=5" >Blitz3D Beginners Area</a>/<a href="#bottom" >Collision Q</a><br><br>
<a name="1123591"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Happy Llama</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'll right, i'm back with ANOTHER question. I have a type snowball in which has the variable: id. I tried to set up collisions but how can I make it so that when id=1 it is set to playersnowball and when id=2 the collisions are set to enemy snowball.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">

Graphics3D 800,600,0,1
SetBuffer BackBuffer()

gametimer=MilliSecs()

;variables
Global spacebar=57,escape=1,leftkey=208,rightkey=205
Global gravity=0.3
Global cam_y#=-3
Global cam_x#=0 
Global magazine	= 25
Global health=100

HidePointer

shoosh=LoadSound("swoosh.wmv")

;Types

Type snowball
	Field mesh	
	Field id	
	Field damage
End Type

Type player
Field health
End Type
 
Type enemy
Field health
End Type

type_player=1
type_enemy=2
type_playersnowball=3
type_enemysnowball=4
type_playerfort=5
type_enemyfort=6

AmbientLight 255,255,255


;Light
sun=CreateLight()

;Player
player=CreateCamera()
CameraFogRange player,0.1,400
CameraFogMode player,True
CameraClsColor player,100,130,150
CameraFogColor player,100,130,150
EntityType player,type_player

;Terrain
ground=CreatePlane()
PositionEntity ground,0,-5,0
EntityColor ground,200,200,200


;Sky
sky=CreatePlane()
PositionEntity sky,0,100,0
RotateEntity sky,-180,0,0
;Sky texture
skytex=LoadTexture("sky.jpg")
EntityTexture sky,skytex
ScaleTexture skytex,5,5
ScaleTexture skytex,500,500

;Load the enemy

enemy=LoadMesh("enemy.3ds")
PositionEntity enemy,0,-4,30
ScaleEntity enemy,0.5,0.5,0.5
EntityType enemy,type_enemy

;Create the bullets
bullet=CreateSphere(36)
ScaleEntity bullet,0.2,0.2,0.2
HideEntity bullet


;Make the snow forts:

;Fort 1
fort1=LoadMesh("snowfort.3ds")
PositionEntity fort1,0,-3.5,4
EntityColor fort1,255,255,255
ScaleEntity fort1,1,1,2.5
RotateEntity fort1,0,-90,0


;Fort 2
fort2=CreateCube()
PositionEntity fort2,0,-4,30
EntityColor fort2,255,255,255
ScaleEntity fort2,2,1,1



;Making it snow!

Dim snowflake(1000)

For p=0 To 1000

snowflake(p)=CreateSphere()

ScaleEntity snowflake(p),0.05,0.05,0.05

PositionEntity snowflake(p),Rnd(-50,50),Rnd(1,100),Rnd(-50,50)

Next


;###############
;#  Main Loop  #
;###############
While Not KeyDown (escape)


If MouseHit(1) And magazine &gt; 0	
	s.snowball = New snowball 		
	s\mesh = CopyEntity(snowball)		
	s\id = 1						
	s\damage = 5				
	PositionEntity s\mesh,EntityX(player),EntityY(player),EntityZ(player)			
	RotateEntity s\mesh, EntityPitch(player),EntityYaw(player),EntityRoll(player)	
	magazine = magazine -1			
End If 


For s.snowball = Each snowball		
	MoveEntity s\mesh, 0,0,1		
	If Abs(EntityZ(s\mesh)) &gt; 400 	
	    FreeEntity s\mesh			
		Delete s					
	End If
Next

If KeyHit(18)&gt;0 And magazine &lt; 1 Then 
	magazine = 25
EndIf 



;Move the snow downwards
For l=0 To 1000
MoveEntity snowflake(l),0,Rnd(-0.002,-0.1),0
Next

;duck 

If KeyDown(57) Then  
cam_y=-3.7
Else
cam_y=-3
EndIf

PositionEntity player,cam_x,cam_y,3

;straffting  

If KeyDown(30) Then cam_x=cam_x-0.1

If KeyDown(32) Then cam_x=cam_x+0.1


If cam_x &gt; 0.5 Then cam_x=0.5
If cam_x &lt; -0.5 Then cam_x=-0.5 

;point the enemy at the player
PointEntity enemy,player

;FPS Camera Stuff
mxs#=mxs#+MouseXSpeed()
mys#=mys#+MouseYSpeed()

If mxs# &gt; 100 Then mxs# = 100
If mxs# &lt; -100 Then mxs# = -100

If mys# &gt; 40 Then mys# = 40
If mys# &lt; -80 Then mys# = -80

RotateEntity player,mys#,-mxs#,0



RenderWorld

UpdateWorld 

Color 0,0,0

Rect 10,10,200,100,False

Text 20,20,"Snowballs left: "+ magazine
Text 20,40,"Health: "+health


Flip




Wend



End

</textarea> <br><br></td></tr></table><br>
<a name="1123643"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Drak</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> You'll need to specify that in your code when the snowballs are created.  You can use the s\id field to specify whether a snowball is friendly or harmful. I'm suggesting 1 = friendly and 2 = harmful.  So:<br><br><pre class=code>
;change this:
s\id = 1 
entitytype s\mesh, type_playersnowball
;to this:
s\id = 2
entitytype s\mesh, type_enemysnowball
</pre><br><br>Then later in your code you will check ALL snowballs at once to see if they had a collision. THEN for the ones that DO have a collision you can easily check if the collision was friendly, or harmful.<br><br><pre class=code>
;pseudocode!
if collided_entity = type_enemy and s\id = 1
     damage_enemy
else if collided_entity = type_player and s\id = 2
     damage_player
end if 
</pre><br><br>I can give you some more specific help on the collision detection if needed, but give it a shot! <br><br></td></tr></table><br>
<a name="1123651"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rob the Great</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just a tip, not really related to your question, but:<br><pre class=code>
;Making it snow!

Dim snowflake(1000)

For p=0 To 1000

snowflake(p)=CreateSphere()

ScaleEntity snowflake(p),0.05,0.05,0.05

PositionEntity snowflake(p),Rnd(-50,50),Rnd(1,100),Rnd(-50,50)

Next
</pre><br>This may not be the best way to approach this. You've got the right idea using arrays and For loops to create snowflakes, but 1000 spheres, each containing 224 polygons (default), results in having to render 112,000 backface culled triangles per loop, which could cause some slowdown. Depending on my setup, I can usually get around 20-100 thousand before I notice slowdown, but I have a relatively old system too.<br><br>Instead, I would consider using artificial sprites in place of the spheres. Artificial sprites use a quad mesh (2 triangles) with an image for a texture, and they have neat functions like always being able to face the camera so they appear to be 3D rather than 2D images. I say "artificial" because Blitz's native sprite commands aren't much better regarding speed, but there's some good replacements in the archives. I'm using JFK's <a href="/codearcs.php?code=2786" target="_blank">Sprites Substitute</a>, which basically uses the same function names as Blitz's, so it's easy to implement.<br><br>Instead of creating 1000 spheres, you should draw a picture of a white snowflake on a black or alpha channel background, and then load the image as a sprite with the alpha flag. Then just copy the sprite 1000 times in place of your sphere, and by doing so, you will reduce the amount of triangles from 112,000 to 2,000, and that should help speed up your game and reduce the amount of stress on the CPU. Plus, you can have a complex snowflake shape without it having any effect on your processing time.<br><br>I've never thought about making a game about a snowball fight, but that sounds like it would be a lot of fun to play. Good luck! <br><br></td></tr></table><br>
<a name="1123654"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Happy Llama</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> What command would I use to check if the snowball had collided with the enemy? <br><br></td></tr></table><br>
<a name="1123720"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rob the Great</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> <pre class=code>
If EntityCollided(enemymesh,type_playersnowball)
   ;Take enemy's life away
EndIf
If EntityCollided(playermesh,type_enemysnowball)
   ;Take player's life away
EndIf
</pre><br>This is essentially the same thing as Drak's pseudo above with the lines:<br><pre class=code>
;pseudocode!
if collided_entity = type_enemy and s\id = 1
     damage_enemy
else if collided_entity = type_player and s\id = 2
     damage_player
end if 
</pre> <br><br></td></tr></table><br>
<a name="1123739"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Happy Llama</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Tell me why this isn't working!<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">

Graphics3D 800,600,0,1
SetBuffer BackBuffer()

gametimer=MilliSecs()

;variables
Global spacebar=57,escape=1,leftkey=208,rightkey=205
Global gravity=0.3
Global snowball_y=0
Global cam_y#=-3
Global cam_x#=0 
Global magazine=25
health=100
enemyheath=100

HidePointer

shoosh=LoadSound("swoosh.wmv")

;Types

Type snowball
	Field mesh	
	Field id	
	Field damage
End Type

Type player
Field health
End Type
 
Type enemy
Field health
End Type

type_player=1
type_enemy=2
type_playersnowball=3
type_enemysnowball=4
type_playerfort=5
type_enemyfort=6

AmbientLight 255,255,255


;Light
sun=CreateLight()

;Player
player=CreateCamera()
CameraFogRange player,0.1,400
CameraFogMode player,True
CameraClsColor player,100,130,150
CameraFogColor player,100,130,150
EntityType player,type_player

;Terrain
ground=CreatePlane()
PositionEntity ground,0,-5,0
EntityColor ground,200,200,200


;Sky
sky=CreatePlane()
PositionEntity sky,0,100,0
RotateEntity sky,-180,0,0
;Sky texture
skytex=LoadTexture("sky.jpg")
EntityTexture sky,skytex
ScaleTexture skytex,5,5
ScaleTexture skytex,500,500

;Load the enemy

enemy=LoadMesh("enemy.3ds")
PositionEntity enemy,0,-4,30
ScaleEntity enemy,0.5,0.5,0.5
EntityType enemy,type_enemy

;Create the bullets
snowball=CreateSphere(36)
ScaleEntity snowball,0.2,0.2,0.2
HideEntity snowball


;Make the snow forts:

;Fort 1
fort1=LoadMesh("snowfort.3ds")
PositionEntity fort1,0,-3.5,4
EntityColor fort1,255,255,255
ScaleEntity fort1,1,1,2.5
RotateEntity fort1,0,-90,0


;Fort 2
fort2=CreateCube()
PositionEntity fort2,0,-4,30
EntityColor fort2,255,255,255
ScaleEntity fort2,2,1,1



;Making it snow!

Dim snowflake(1000)

For p=0 To 1000

snowflake(p)=CreateSphere()

ScaleEntity snowflake(p),0.05,0.05,0.05

PositionEntity snowflake(p),Rnd(-50,50),Rnd(1,100),Rnd(-50,50)

Next


;###############
;#  Main Loop  #
;###############
While Not KeyDown (escape)
;enemy snowballs
If MouseHit(2) Then
	a.snowball = New snowball
	a\mesh = CopyEntity(snowball)
	a\id = 2
	a\damage = 5
	PositionEntity a\mesh,EntityX(enemy),EntityY(enemy),EntityZ(enemy)
	RotateEntity a\mesh, EntityPitch(enemy),EntityYaw(enemy),EntityRoll(enemy)
	EntityType a\mesh,type_enemysnowball 
End If

For a.snowball = Each snowball
	MoveEntity a\mesh,0,0,0.00005
	If Abs(EntityZ(a\mesh)) &gt; 400
	FreeEntity a\mesh
	Delete a
	End If
Next	 





;player snowballs
If MouseHit(1) And magazine &gt; 0	And cam_y=-3.0
	s.snowball = New snowball 		
	s\mesh = CopyEntity(snowball)		
	s\id = 1						
	s\damage = 5				
	PositionEntity s\mesh,EntityX(player),EntityY(player),EntityZ(player)			
	RotateEntity s\mesh, EntityPitch(player),EntityYaw(player),EntityRoll(player)	
	magazine = magazine -1
	EntityType s\mesh,type_playersnowball			
End If 


For s.snowball = Each snowball		
	MoveEntity s\mesh, 0,0,1		
	If Abs(EntityZ(s\mesh)) &gt; 400 	
	    FreeEntity s\mesh			
		Delete s					
	End If
Next

If KeyHit(18)&gt;0 And magazine &lt; 1 Then 
	magazine = 25
EndIf 



;Collisions:
If EntityCollided(enemy,type_playersnowball)
	enemyhealth=enemyhealth-5
EndIf
If EntityCollided(player,type_enemysnowball)
	health=health-5
EndIf
 

;Move the snow downwards
For l=0 To 1000
MoveEntity snowflake(l),0,Rnd(-0.002,-0.1),0
Next

;duck 

If KeyDown(57) Then  
cam_y=-3.7
Else
cam_y=-3
EndIf

PositionEntity player,cam_x,cam_y,3

;straffting  

If KeyDown(30) Then cam_x=cam_x-0.1

If KeyDown(32) Then cam_x=cam_x+0.1


If cam_x &gt; 0.5 Then cam_x=0.5
If cam_x &lt; -0.5 Then cam_x=-0.5 

;point the enemy at the player
PointEntity enemy,player

;FPS Camera Stuff
mxs#=mxs#+MouseXSpeed()
mys#=mys#+MouseYSpeed()

If mxs# &gt; 100 Then mxs# = 100
If mxs# &lt; -100 Then mxs# = -100

If mys# &gt; 40 Then mys# = 40
If mys# &lt; -80 Then mys# = -80

RotateEntity player,mys#,-mxs#,0



RenderWorld

UpdateWorld 

Color 0,0,0

Rect 10,10,200,100,False

Text 20,20,"Snowballs left: "+ magazine
Text 20,40,"Health: "+health


Flip




Wend



End

</textarea> <br><br></td></tr></table><br>
<a name="1123754"></a>

<a name="1123755"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rob the Great</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I glanced over your code, and the logic seems like it should work. The only thing missing is letting Blitz know what should collide with what and what happens when they do.<br><br>To do this, you need to add in a "Collisions" command for each type of collision you want.<br><br>I typically do this right before the main loop so that I don't mistakenly add new collision types later and forget to add a corresponding "Collisions" command.<br><br>Also, if you're planning on using an imaginary bubble around your entity for collision detection (such as the player camera), you need to also use EntityRadius().<br><br>For your purposes, this should help:<br><pre class=code>
;Change this spot of code for your player loading
;Player
player=CreateCamera()
CameraFogRange player,0.1,400
CameraFogMode player,True
CameraClsColor player,100,130,150
CameraFogColor player,100,130,150
;HERE'S A NEW COMMAND, ENTITYRADIUS
EntityRadius player,1,2 ;Play around with the values until it looks right
EntityType player,type_player

;Then, right before you call the Main, add these lines
Collisions type_player,type_enemysnowball,1,1
Collisions type_enemy,type_playersnowball,2,1
;###############
;#  Main Loop  #
;###############
;....
</pre><br>Read up on the <a href="/b3ddocs/command.php?name=Collisions&amp;ref=3d_cat" target="_blank">Collisions</a> command in the manual if this is confusing.<br><br>Basically, if you add in those lines, it should work (I think it will, I haven't tested it, I've just read over the logic).<br><br>EDIT: The way this is set up, you will need some way to let Blitz know that once a snowball collides, it should not be checked for damage again. Otherwise, one hit from a snowball will continually drain your health until the game ends. You can either delete the snowball, or better yet, add in an additional field for the snowball type that keeps track if that particular snowball has already taken life away. If you use the latter, then you have more options such as making the snowball splat on the screen and then gradually melt away.<br><br>If you need help, feel free to ask.<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1124022"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> First create a sorta "Collision type" or.. a variable which defines which objects u will be colliding.<br><br><br>IE: <br><br><br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">Const type_player% = 1
Const type_baddy%  = 2</textarea><br><br><br>Then, afterwords, define which type of collision it is. Is it a 1: sphere-to-sphere collision, 2: sphere-to-polygon collision, or 3: sphere-to-box collision ?<br><br><br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">Const sphere_to_sphere_collision%     = 1
Const sphere_to_polygon_collision%    = 2
Const sphere_to_box_collision%        = 3</textarea><br><br><br>Next, you need to define whether it's a 1: stop collision, 2: a full sliding collision, or 3: a non-sliding slope collision.<br><br><br>IE: <br><br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">Const collision_stop%       = 1
Const collision_slide%      = 2
Const collision_stop_slope% = 3</textarea><br><br><br>Now, what you want to do, is apply an "EntityType" to each object.<br><br><br>Here's an example: <br><br><br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">Graphics3D 800, 600, 0, 2
SetBuffer BackBuffer()
SeedRnd MilliSecs()



;Set Collision types



Const type_player% = 1
Const type_land%   = 2
Const type_baddy%  = 3



Const sphere_to_sphere_collision%     = 1
Const sphere_to_polygon_collision%    = 2
Const sphere_to_box_collision%        = 3



Const collision_stop%       = 1
Const collision_slide%      = 2
Const collision_stop_slope% = 3



;Create Camera
Global cam% = CreateCamera()
PositionEntity cam%, 0, 1, 0
CameraRange cam%, .1, 50000



;Create Sky
Global Sky% = CreateCube()
EntityColor Sky%, 102, 102, 255
ScaleEntity Sky%, 10000, 10000, 10000
FlipMesh Sky%




;Create Landscape
Global Land% = CreatePlane()
EntityColor Land%, 0, 64, 0



;Turn on collision for "Player"



EntityType cam%, type_player%



;Turn on the lights :P
AmbientLight 255, 255, 255



;Turn on the actual collision for player colliding with baddy
Collisions type_player%, type_baddy%, sphere_to_polygon_collision%, collision_slide%



;Turn on the actual collision for player colliding with landscape
Collisions type_player%, type_land%, sphere_to_polygon_collision%, collision_stop_slope%



;Turn on the actual collision for baddy colliding with another baddy
Collisions type_baddy%, type_baddy%, sphere_to_polygon_collision%, collision_slide%



;Create a whole onslaught of baddies



Global baddies%



Global maximumbaddies% = 150



For x = 1 To maximumbaddies%
	
	
	
	oldbaddies% = baddies%
	
	
	
	baddies% = CreateCube()
	
	
	
	EntityColor baddies%, Rnd(0, 255), Rnd(0, 255), Rnd(0, 255)
	
	
	
	x1# = EntityX#(baddies%, True)
	y1# = EntityY#(baddies%, True)
	z1# = EntityZ#(baddies%, True)
	
	
	
	minimum#       = 15
	maximum#       = 75
	totaldistance# = 10
	
	
	If oldbaddies%&lt;&gt;0 And baddies%&lt;&gt;0 And baddies%&lt;&gt;oldbaddies%
	
		
		
		If EntityDistance(baddies%, oldbaddies%) &lt;= totaldistance# Or EntityDistance(oldbaddies%, baddies%) &lt;= totaldistance# Or EntityDistance(baddies%, baddies%) &lt; totaldistance# Or EntityDistance(oldbaddies%, oldbaddies%) &lt;= totaldistance#
		
		
			
			PositionEntity baddies%, maximumbaddies%/(maximumbaddies%/2)*(x1#*x1#+Rnd(minimum#, maximum#)), 1, maximumbaddies%/(maximumbaddies%/2)*(z1#*z1#+Rnd(minimum#, maximum#))
			
		
		
		Else
		
		
		
			PositionEntity baddies%, maximumbaddies%/(maximumbaddies%/2)*(x1#*x1#+Rnd(minimum#, maximum#)), 1, maximumbaddies%/(maximumbaddies%/2)*(z1#*z1#+Rnd(minimum#, maximum#))
			
		
			
		EndIf
		
		
		
	EndIf
	
	
	
	ScaleEntity baddies%, Rnd(1, 5), Rnd(1, 5), Rnd(1, 5)
	
	
	
	RotateEntity baddies%, 0, Rnd(-180, 180), 0
	
	
	
	EntityAlpha baddies%, Rnd(0.5, 1.0)
	
	
	
	;Turn on collision for ALL baddies
	
	
	
	EntityType baddies%, type_baddy%
	
	
	
Next



Global movespeed#
Global turnspeed#
Global flyspeed#



While Not KeyDown(1)
	
	
	
	If Not KeyDown(42) Or KeyDown(54)
	
		
		
		movespeed# = 0.5
		turnspeed# = 1.0
		flyspeed#  = 1.0
		
		
		
	Else
		
		
		
		movespeed# = 1.0
		turnspeed# = 2.0
		flyspeed#  = 2.0
		
		
		
	EndIf
	
	
	
	MoveEntity cam%, 0, (KeyDown(44)-KeyDown(45))*flyspeed#, (KeyDown(17)-KeyDown(31) Or KeyDown(200)-KeyDown(208))*movespeed#
	TurnEntity cam%, 0, (KeyDown(30)-KeyDown(32) Or KeyDown(203)-KeyDown(205))*turnspeed#, 0
	
	
	
	UpdateWorld()
	RenderWorld()
	
	
	
	Flip
	
	
	
Wend



End</textarea><br><br><br><br>Hope this helps! :) <br><br></td></tr></table><br>
<a name="1124065"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Drak</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Rez you didn't add anything useful to his code.  You're still missing the actual Collision command that sets up the actual collisions, as Rob said. <br><br></td></tr></table><br>
<a name="1124067"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> My name is Thundros now -.-<br><br><br><br>Here's a fix: <br><br><br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">Graphics3D 800, 600, 0, 2
SetBuffer BackBuffer()
SeedRnd MilliSecs()



;Set Collision types



Const type_player% = 1
Const type_land%   = 2
Const type_baddy%  = 3



Const sphere_to_sphere_collision%     = 1
Const sphere_to_polygon_collision%    = 2
Const sphere_to_box_collision%        = 3



Const collision_stop%       = 1
Const collision_slide%      = 2
Const collision_stop_slope% = 3



;Create Camera
Global cam% = CreateCamera()
PositionEntity cam%, 0, 1, 0
CameraRange cam%, .1, 50000



;Create Sky
Global Sky% = CreateCube()
EntityColor Sky%, 102, 102, 255
ScaleEntity Sky%, 10000, 10000, 10000
FlipMesh Sky%




;Create Landscape
Global Land% = CreatePlane()
EntityColor Land%, 0, 64, 0



;Turn on collision for "Player"



EntityType cam%, type_player%



;Turn on the lights :P
AmbientLight 255, 255, 255



;Turn on the actual collision for player colliding with baddy
Collisions type_player%, type_baddy%, sphere_to_polygon_collision%, collision_slide%



;Turn on the actual collision for player colliding with landscape
Collisions type_player%, type_land%, sphere_to_polygon_collision%, collision_stop_slope%



;Turn on the actual collision for baddy colliding with another baddy
Collisions type_baddy%, type_baddy%, sphere_to_polygon_collision%, collision_slide%



;Create a whole onslaught of baddies



Global baddies%



Global maximumbaddies% = 150



For x = 1 To maximumbaddies%
	
	
	
	oldbaddies% = baddies%
	
	
	
	baddies% = CreateCube()
	
	
	
	EntityColor baddies%, Rnd(0, 255), Rnd(0, 255), Rnd(0, 255)
	
	
	
	x1# = EntityX#(baddies%, True)
	y1# = EntityY#(baddies%, True)
	z1# = EntityZ#(baddies%, True)
	
	
	
	minimum#       = 15
	maximum#       = 75
	totaldistance# = 10
	
	
	If oldbaddies%&lt;&gt;0 And baddies%&lt;&gt;0 And baddies%&lt;&gt;oldbaddies%
		
		
		
		If EntityDistance(baddies%, oldbaddies%) &lt;= totaldistance# Or EntityDistance(oldbaddies%, baddies%) &lt;= totaldistance# Or EntityDistance(baddies%, baddies%) &lt; totaldistance# Or EntityDistance(oldbaddies%, oldbaddies%) &lt;= totaldistance#
			
			
			
			PositionEntity baddies%, maximumbaddies%/(maximumbaddies%/2)*(x1#*x1#+Rnd(minimum#, maximum#)), 1, maximumbaddies%/(maximumbaddies%/2)*(z1#*z1#+Rnd(minimum#, maximum#))
			
			
			
		Else
			
			
			
			PositionEntity baddies%, maximumbaddies%/(maximumbaddies%/2)*(x1#*x1#+Rnd(minimum#, maximum#)), 1, maximumbaddies%/(maximumbaddies%/2)*(z1#*z1#+Rnd(minimum#, maximum#))
			
			
			
		EndIf
		
		
		
	EndIf
	
	
	
	ScaleEntity baddies%, Rnd(1, 5), Rnd(1, 5), Rnd(1, 5)
	
	
	
	RotateEntity baddies%, 0, Rnd(-180, 180), 0
	
	
	
	EntityAlpha baddies%, Rnd(0.5, 1.0)
	
	
	
	;Turn on collision for ALL baddies
	
	
	
	EntityType baddies%, type_baddy%
	
	
	
Next



Global movespeed#
Global turnspeed#
Global flyspeed#



While Not KeyDown(1)
	
	
	
	If Not KeyDown(42) Or KeyDown(54)
		
		
		
		movespeed# = 0.5
		turnspeed# = 1.0
		flyspeed#  = 1.0
		
		
		
	Else
		
		
		
		movespeed# = 1.0
		turnspeed# = 2.0
		flyspeed#  = 2.0
		
		
		
	EndIf
	
	
	
	If EntityCollided(cam%, type_baddy%) Then collided$ = "yes" : Else collided$ = "no"
	
	
	
	MoveEntity cam%, 0, (KeyDown(44)-KeyDown(45))*flyspeed#, (KeyDown(17)-KeyDown(31) Or KeyDown(200)-KeyDown(208))*movespeed#
	TurnEntity cam%, 0, (KeyDown(30)-KeyDown(32) Or KeyDown(203)-KeyDown(205))*turnspeed#, 0
	
	
	
	UpdateWorld()
	RenderWorld()
	
	
	
	Text GraphicsWidth()/2, GraphicsHeight()/2, "Did cam collide with a baddy? : "+collided$, 1, 1
	
	
	
	Flip
	
	
	
Wend



End</textarea> <br><br></td></tr></table><br>
<a name="1124099"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Happy Llama</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> The snowball hits the enemy but slides over it and does not decrease the variable enemyhealth. Why! Why!!  <br><br>P.S Thanks for all your help! <br><br></td></tr></table><br>
<a name="1124120"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rob the Great</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> The first thing to assume is that the snowball is not colliding. In the If statement where you decrease the player's health, either add in a DebugLog command, or if your not familiar how that works, just add in an "End" command. For example:<br><pre class=code>
If EntityCollided(enemy,type_playersnowball)
   End
   enemyhealth = enemyhealth - 1
EndIf
</pre><br>If the snowball is successfully colliding, the program should end on its own as soon as the player snowball touches the enemy. If the program never ends, then you know the snowball is not colliding with the enemy.<br><br>Start with that, and let me know what the results are. It might be a while before I respond, but go with that for now. <br><br></td></tr></table><br>
<a name="1124201"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Happy Llama</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> ok cool ill try it. <br><br></td></tr></table><br>
<a name="1124216"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Happy Llama</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> No the program does not end. <br><br></td></tr></table><br>
<a name="1124232"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rob the Great</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Then what we've gathered from this is that something is wrong with the collision system. Things to check are:<br><br>1. Does every entity involved in collisions have an EntityType() assigned to it? I know you're using types for your snowballs, which is perfect, but make sure whenever you create a new snowball, you give it a collision type. e.g.<br><pre class=code>
s.snowball = New snowball
s\entity = CreateSphere()
EntityType(s\snowball,type_playersnowball)
</pre><br><br>2. Have you called a Collisions() command at least once in your program? You can assign entity's their collision types until you're blue in the face, but it won't mean anything unless you tell Blitz that you want two types to collide with each other. e.g.<br><pre class=code>
Collisions type_player,type_level,2,3
Collisions type_snowball,type_enemy,2,1
Collisions type_this,type_that,1,1
;ect.
</pre><br>As a sub note, make sure you call them in the correct order. For your program, your snowballs are round, and therefore, you want to use EntityRadius() on them. Then, when you check for collisions with them, make sure their entity type is first in the list, such as "Collisions type_playersnowball,type_enemy,2,1". This is because you want Blitz to use their radius against either the radius, exact shape, or bounding box of the enemy, and if it was reversed, it may not collide successfully.<br><br>3. Are you calling UpdateWorld() before RenderWorld()? If you neglect to include an UpdateWorld() command, no collisions with ever be checked.<br><br>4. Are you using EntityRadius() at all, and if so, is your radius too large or too small? If you aren't using this command, it's OK because Blitz will assume an object has an EntityRadius of 1 unit surrounding it. I imagine that your snowballs are fine, but they might pass through other objects if the radius is too small. For complex geometry, it would be even better to use mode 2 in the Collisions() command (radius against polygons), and this ensures that the snowball will hit the enemy. But, if you're using collision mode 1 (radius against a radius), the enemy radius might be small enough where it will pass right through the enemy except for the 1x1 sphere right in the center of mass of your enemy.<br><br>5. Do other collision commands work? Instead of this:<br><pre class=code>
If EntityCollided(enemy,type_snowball)
     End
EndIf
</pre><br>Try this:<br><pre class=code>
If MeshesIntersect(enemy,s\snowball)
      End
EndIf
</pre><br>The second option will check if ANY part of the snowball is within any part of the enemy. Take caution, because MeshesIntersect() is a very slow command, but it is useful to know for sure whether or not you are receiving any kind of collision at all.<br><br>6. If all the above fails, try this:<br><pre class=code>
Global type_playersnowball = 1
Global type_enemy = 2
enemy = LoadMesh("enemy.b3d")
EntityType enemy,type_enemy
s.snowball = New snowball
s\entity = CreateSphere()
EntityType(s\snowball,type_playersnowball)
Collisions type_playersnowball,type_enemy,2,3
While Not KeyDown(1)

   PointEntity s\entity,enemy
   MoveEntity s\entity,0,0,0.1
   If EntityCollided(enemy,type_playersnowball)
      End
   EndIf
   UpdateWorld
   RenderWorld
   Flip

Wend

End
</pre><br>This will ensure that the snowball will touch the enemy if the program runs long enough. Eventually, it will end, but if it doesn't, then it's time to post some code and we'll see if we can't figure out what's going wrong.<br><br>Hopefully this all helps. <br><br></td></tr></table><br>
<a name="1124234"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Drak</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> I believe you have to discern which snowball is colliding with the enemy to fix this.  <br><br>The EntityCollided() command only tells you that ONE of the snowballs collided with an enemy, and not which one.  You'll have to have your coding figure out which snowball hit the enemy, then act accordingly.  If you could edit your code so it contains no loaded media and repost it, I could help out better.  You can always load your media after you get everything working with primitives. <br><br></td></tr></table><br>
<a name="1124240"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Can't you CountCollisions() and return the collision entity involved? <br><br></td></tr></table><br>
<a name="1124244"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Drak</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes that's exactly how it's done.  With that command you can pick out which entity (of the Type snowball) had the collision.  Let me switch computers and I'll post an example for LLama. <br><br></td></tr></table><br>
<a name="1124245"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Drak</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok try adding this:<br><br>For this to work you need 2 global variables initiated at the beggining of the program:<br><pre class=code>
Global collision_id
Global collision_entitiy
</pre><br>And add this function into your program instead of the other entitycolided() commands:<br><br><pre class=code>
Function snowball_collisions()	;This will work for various collisions that can be added later, example if you want a different collision for the snowfort, etc
	For s.snowball = Each snowball						;For EACH snowball
		For collision_id = 1 To CountCollisions(s\mesh)	;Assign a temporary collision id# to each collision this particular snowball has
			collision_entity = CollisionEntity(s\mesh, collision_id)	;Now we store WHICH entity the snowball collided with
				If GetEntityType(collision_entity) = type_enemy			;If the collided entity is a TYPE_ENEMY
					enemyhealth = enemyhealth - s\damage				;reduce the enemie's health by the snowball damage factor
						FreeEntity s\mesh	;delete the snowball mesh
						Delete s			;delete the reference to it
							If enemyhealth &lt;= 0 Then FreeEntity enemy	;delete the enemy if it's dead
						Exit
				End If
		Next
	Next
End Function 
</pre> <br><br></td></tr></table><br>
<a name="1124255"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Drak</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> I added a few things and altered a few things.  I replaced all the media with primitive objects to get things working.  There were a number of small errors, some as small as a spelling error, but you should be able to build off of this.  The collision does work now.  Let us know if there's anything else we can help with!<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">

Graphics3D 800,600,0,1
SetBuffer BackBuffer()

gametimer=MilliSecs()

;variables
Global spacebar=57,escape=1,leftkey=208,rightkey=205
Global gravity=0.3
Global snowball_y=0
Global cam_y#=-3
Global cam_x#=0 
Global magazine=25
Global health=100
Global enemyhealth=100
Global score = 0

HidePointer

;shoosh=LoadSound("swoosh.wmv")

;Types

Type snowball
	Field mesh	
	Field id	
	Field damage
End Type

Type player
Field health
End Type
 
;Type enemy
;Field health
;End Type

Const type_player=1
Const type_enemy=2
Const type_playersnowball=3
Const type_enemysnowball=4
Const type_playerfort=5
Const type_enemyfort=6

AmbientLight 255,255,255


;Light
sun=CreateLight()

;Player
player=CreateCamera()
CameraFogRange player,0.1,400
CameraFogMode player,True
CameraClsColor player,100,130,150
CameraFogColor player,100,130,150
EntityType player,type_player

;Terrain
ground=CreatePlane()
PositionEntity ground,0,-5,0
EntityColor ground,200,200,200


;Sky
sky=CreatePlane()
PositionEntity sky,0,100,0
RotateEntity sky,-180,0,0
;Sky texture
;skytex=LoadTexture("sky.jpg")
;EntityTexture sky,skytex
;ScaleTexture skytex,5,5
;ScaleTexture skytex,500,500

;Load the enemy

Global collision_id
Global collision_entity


;enemy=LoadMesh("enemy.3ds")
Global enemy=CreateCylinder()
EntityColor enemy, 255,0,0
PositionEntity enemy,0,0,25
ScaleEntity enemy,5,5,5
EntityType enemy,type_enemy

;Create the bullets
snowball=CreateSphere()
;ScaleEntity snowball,0.2,0.2,0.2
HideEntity snowball




;Make the snow forts:

;Fort 1
;fort1=LoadMesh("snowfort.3ds")
;fort1=CreateCube()
;PositionEntity fort1,0,-3.5,4
;EntityColor fort1,255,255,255
;ScaleEntity fort1,1,1,2.5
;RotateEntity fort1,0,-90,0


;Fort 2
;fort2=CreateCube()
;PositionEntity fort2,0,-4,30
;EntityColor fort2,255,255,255
;ScaleEntity fort2,2,1,1



;Making it snow!

Dim snowflake(1000)

For p=0 To 1000

snowflake(p)=CreateSphere()

ScaleEntity snowflake(p),0.05,0.05,0.05

PositionEntity snowflake(p),Rnd(-50,50),Rnd(1,100),Rnd(-50,50)

Next

Collisions type_playersnowball, type_enemy, 2,2

;###############
;#  Main Loop  #
;###############
While Not KeyDown (escape)
;enemy snowballs
If MouseHit(2) Then
	a.snowball = New snowball
	a\mesh = CopyEntity(snowball)
	a\id = 2
	a\damage = 5
	PositionEntity a\mesh,EntityX(enemy),EntityY(enemy),EntityZ(enemy)
	RotateEntity a\mesh, EntityPitch(enemy),EntityYaw(enemy),EntityRoll(enemy)
	EntityType a\mesh,type_enemysnowball 
End If

For a.snowball = Each snowball
	MoveEntity a\mesh,0,0,0.00005
	If Abs(EntityZ(a\mesh)) &gt; 400
	FreeEntity a\mesh
	Delete a
	End If
Next	 





;player snowballs
If MouseHit(1) And magazine &gt; 0	And cam_y=-3.0
	s.snowball = New snowball 		
	s\mesh = CopyEntity(snowball)		
	s\id = 1						
	s\damage = 5				
	PositionEntity s\mesh,EntityX(player),EntityY(player),EntityZ(player)			
	RotateEntity s\mesh, EntityPitch(player),EntityYaw(player),EntityRoll(player)	
	magazine = magazine -1
	EntityType s\mesh,type_playersnowball
	EntityRadius s\mesh, 2			
End If 


For s.snowball = Each snowball		
	MoveEntity s\mesh, 0,0,1		
	If Abs(EntityZ(s\mesh)) &gt; 400 	
	    FreeEntity s\mesh			
		Delete s					
	End If
Next

If KeyHit(18)&gt;0 And magazine &lt; 1 Then 
	magazine = 25
EndIf 



;Collisions:

snowball_collisions()


;Move the snow downwards
For l=0 To 1000
MoveEntity snowflake(l),0,Rnd(-0.002,-0.1),0
Next

;duck 

If KeyDown(57) Then  
cam_y=-3.7
Else
cam_y=-3
EndIf

PositionEntity player,cam_x,cam_y,3

;straffting  

If KeyDown(30) Then cam_x=cam_x-0.1

If KeyDown(32) Then cam_x=cam_x+0.1


If cam_x &gt; 0.5 Then cam_x=0.5
If cam_x &lt; -0.5 Then cam_x=-0.5 

;point the enemy at the player
If enemyhealth &gt; 0
	PointEntity enemy,player
End If 

;FPS Camera Stuff
mxs#=mxs#+MouseXSpeed()
mys#=mys#+MouseYSpeed()

If mxs# &gt; 100 Then mxs# = 100
If mxs# &lt; -100 Then mxs# = -100

If mys# &gt; 40 Then mys# = 40
If mys# &lt; -80 Then mys# = -80

RotateEntity player,mys#,-mxs#,0



RenderWorld

UpdateWorld 

Color 0,0,0

Rect 10,10,200,100,False

Text 20,20,"Snowballs left: "+ magazine
Text 20,40,"Health: "+health
Text 20,60,"Score: " + score

Flip




Wend



End

;-------------------------------------------------------------------
Function snowball_collisions()	;This will work for various collisions that can be added later, example if you want a different collision for the snowfort, etc
	For s.snowball = Each snowball						;For EACH snowball
		For collision_id = 1 To CountCollisions(s\mesh)	;Assign a temporary collision id# to each collision this particular snowball has
			collision_entity = CollisionEntity(s\mesh, collision_id)	;Now we store WHICH entity the snowball collided with
				If GetEntityType(collision_entity) = type_enemy			;If the collided entity is a TYPE_ENEMY
					enemyhealth = enemyhealth - s\damage				;reduce the enemie's health by the snowball damage factor
						DebugLog "enemyhealth " + enemyhealth
						score = score + 1
						FreeEntity s\mesh	;delete the snowball mesh
						Delete s			;delete the reference to it
							If enemyhealth &lt;= 0 Then FreeEntity enemy	;delete the enemy if it's dead
						Exit
				End If
		Next
	Next
End Function 
						
;-------------------------------------------------------------------

</textarea> <br><br></td></tr></table><br>
<a name="1124833"></a>

<a name="1124834"></a>

<a name="1125885"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Happy Llama</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> Edit: Figured it out on my own! Ha Ha!<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
