<!DOCTYPE html><html lang="en" ><head ><title >FlipMesh Lighting Issue</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >FlipMesh Lighting Issue</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=5" >Blitz3D Beginners Area</a>/<a href="#bottom" >FlipMesh Lighting Issue</a><br><br>
<a name="425995"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzed090604</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've been doing pretty good learning Blitz3D without any help but I've come across something I'm just plain not figuring out. <br><br>I have "Earth" as a sphere with a second sphere in the same spot but larger and Alpha'd for a cheap atmosphere/clouds effect. However when I FlipMesh upon the camera entering the "atmosphere", the light from the "sun" is on the wrong side of the planet...is there a way to correct this? RotateEntity, TurnEntity, and UpdateNormals all seemed to not work. Am I just messing up?<br><br>Thanks for any input. <br><br></td></tr></table><br>
<a name="426003"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> You have to flip the normals.  The only way to do this is to loop through each vertex in the mesh, and get it's normal, and the multiply the X, Y, and Z of the normal each by -1, then reset the vertex normal with this new normal. <br><br></td></tr></table><br>
<a name="426047"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> an other method would be to make an exact copy of the mesh by recursively going trough all childs,surfaces and tris, but then use the order of vertices of the tris in the opposite way of the original, and then updatenormals. Well, in theory this should work. <br><br></td></tr></table><br>
<a name="426101"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Do it sswifts way, JFK doubt yours would work... wouldnt it just be the same as flipmesh? <br><br></td></tr></table><br>
<a name="426141"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> maybe :) but then I ask myself why flipmesh doesn't automaticly invert the normals. <br><br></td></tr></table><br>
<a name="426173"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzed090604</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for your responses...I'll let you know what happens! <br><br></td></tr></table><br>
<a name="426184"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wouldn't a RotateMesh sort this? <br><br></td></tr></table><br>
<a name="426209"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzed090604</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Believe it or not I think I tried that too. I'm thinking maybe my thinking might be wrong. <br><br>Once you enter the atmosphere and FlipMesh occurs, the other side of the atmosphere IS the side that is facing the light(sun). I can RotateMesh, RotateEntity, TurnEntity all I want but the light SHOULD be falling on the other side of the atmosphere. <br><br>So I guess the question is, without lightmapping it, (because I'm using AmbientLight 2,2,0-it's SPACE :) ) can I spin the lit side of an entity around or will the light always fall where it should? <br><br></td></tr></table><br>
<a name="426231"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzed090604</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here's some example code to help you guys see my lighting problem :<br><pre class=code>
Graphics3D 640,480
SetBuffer BackBuffer()

Global earthAtmosFlipped = 0
Global speed# = 0

Global camera=CreateCamera()
CameraRange camera, 1,3000

Global light=CreateLight()
AmbientLight 2,2,0

Global earth=CreateSphere(100)
Global earthAtmos=CreateSphere(100)

ScaleEntity earth, 200,200,200
ScaleEntity earthAtmos, 300,300,300

PositionEntity earth,0,0,1000
PositionEntity earthAtmos,0,0,1000

EntityAlpha earthAtmos,.25

While Not KeyDown(1) 

	atmosFlip()
	controlCamera()
	
	UpdateWorld
	RenderWorld
	
	Text 10,10, "[a] and [z] controls speed," 
	Text 10,25, "arrow keys To turn camera/ship,"
	Text 10,40, "NumPad 0 To stop"
	Text 10,55, "speed: "+speed#
	Text 10,70, "Enter the atmosphere and then go to the other side"
	Text 10,85, "of the planet to see my lighting dilemma"

	Flip

Wend

End

Function atmosFlip()

	If EntityDistance (camera,earth)-200 &lt; 50 And earthAtmosFlipped = 0 Then
		FlipMesh earthAtmos
		earthAtmosFlipped = 1
	EndIf
	
	If EntityDistance (camera,earth)-200 &gt; 50 And earthAtmosFlipped = 1 Then
		FlipMesh earthAtmos
		earthAtmosFlipped = 0
	EndIf
	
End Function

Function controlCamera()

	If KeyDown(205)
		TurnEntity camera,0,-.5,0
	EndIf 
	If KeyDown(203)
		TurnEntity camera,0,.5,0
	EndIf 
	If KeyDown(200)
		TurnEntity camera,-.5,0,0
	EndIf 
	If KeyDown(208)
		TurnEntity camera,.5,0,0
	EndIf 
	If KeyDown(30)
			speed# = speed# + .1
	EndIf 
	If KeyDown(44)
			speed# = speed# - .1
	EndIf
	If KeyDown(82)
		speed# = 0
	EndIf 
	
	MoveEntity camera,0,0,speed#
	
End Function
</pre><br><br>Is there a way to spin the lit side around or will the light always behave like it should and not the way I want? :) <br><br></td></tr></table><br>
<a name="426237"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> "maybe :) but then I ask myself why flipmesh doesn't automaticly invert the normals."<br><br>It does.  That's the problem.  He is inside a sphere which he is using as an atmosphere.  It is transparent.<br><br>Imagine the sun is to the right of his planet.<br><br>He has two spheres.  One, the planet, which is opaque.  It is lit from the right side.<br><br>Then he has another, the atmosphere, slightly bigger, and semi transparent.  Also lit from the right, with faces facing outwards.<br><br>When his ship enters the atmosphere, he flips the atmosphere sphere, so that he can see the atmosphere behind the planet.  <br><br>But this also flips the normals.  So now, the atmosphere is lit as if it is the inside side of a two sided sphere shell.  Which it is.  But that means that the light from the sun now   falls on the atmosphere which is to the left in the image, and that on the right is in shadow, because those faces face away from the sun.<br><br>So he needs to flip the normals so they face the WRONG WAY to create the effect he wants to see.<br><br><br><br>An alternative to this Blitzed, would be to set the EntityFX flag which makes an entity two sided.  This would make it so you don't need to flip the sphere when you enter it.  It will always have two sides, and always be lit with the normals on the outside. <br><br></td></tr></table><br>
<a name="426254"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ashmantle</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> An alternative to this Blitzed, would be to set the EntityFX flag which makes an entity two sided. This would make it so you don't need to flip the sphere when you enter it. It will always have two sides, and always be lit with the normals on the outside. <br></div><br>That was a smart suggestion! <br><br></td></tr></table><br>
<a name="426489"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzed090604</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> <pre class=code>
EntityFX earthAtmos,16
</pre><br><br>Yeah I think that's going to be the best solution for the time being. Thanks sswift and everyone!<br><br>BTW, the community here is awesome...to think I was THIS <br>--------&gt;  &lt;--------<br>close to buying DarkBasic Professional before I found Blitz3D. I'll be here for a long time. <br><br></td></tr></table><br>
<a name="427270"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BlackD</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> and remember to use UPDATENORMALS <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
