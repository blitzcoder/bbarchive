<!DOCTYPE html><html lang="en" ><head ><title >SPI_GETMOUSE : goto wits(end)</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >SPI_GETMOUSE : goto wits(end)</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=5" >Blitz3D Beginners Area</a>/<a href="#bottom" >SPI_GETMOUSE : goto wits(end)</a><br><br>
<a name="375618"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stoop Solo</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I crave wisdom. I just cannot seem to suss this thing out.<br><br>I am needing to retrieve and set mouse acceleration from within Blitz. Basically this functionality is available via user32.dll's <a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/sysinfo/base/systemparametersinfo.asp" target="_blank">SystemParametersInfo</a> function, using SPI_GETMOUSE and SPI_SETMOUSE :<br><br><div class="quote"> <br><b>SystemParametersInfo</b><br><br><br>BOOL SystemParametersInfo(<br>  UINT uiAction,<br>  UINT uiParam,<br>  PVOID pvParam,<br>  UINT fWinIni<br>);<br><br>Parameters<br><br>uiAction<br>    [in] System-wide parameter to be retrieved or set. This parameter can be one of the following values. They are organized in tables of related parameters.<br><br>uiParam<br>    [in] Depends on the system parameter being queried or set. For more information about system-wide parameters, see the uiAction parameter. If not otherwise indicated, you must specify zero for this parameter.<br><br>pvParam<br>    [in, out] Depends on the system parameter being queried or set. For more information about system-wide parameters, see the uiAction parameter. If not otherwise indicated, you must specify NULL for this parameter.<br><br>fWinIni<br>    [in] If a system parameter is being set, specifies whether the user profile is to be updated, and if so, whether the WM_SETTINGCHANGE message is to be broadcast to all top-level windows to notify them of the change.<br><br>    This parameter can be zero if you don't want to update the user profile or broadcast the WM_SETTINGCHANGE message, or it can be one or more of the following values.<br><br>    Value 	Meaning<br>    SPIF_UPDATEINIFILE 	Writes the new system-wide parameter setting to the user profile.<br>    SPIF_SENDCHANGE 	Broadcasts the WM_SETTINGCHANGE message after updating the user profile.<br>    SPIF_SENDWININICHANGE 	Same as SPIF_SENDCHANGE.<br> <br></div><br><br><br>the uiAction parameters I am interested in are:<br><br><div class="quote"> <br>SPI_GETMOUSE - Retrieves the two mouse threshold values and the mouse acceleration. The pvParam parameter must point to an array of three integers that receives these values. See mouse_event for further information.<br><br>SPI_SETMOUSE - Sets the two mouse threshold values and the mouse acceleration. The pvParam parameter must point to an array of three integers that specifies these values. See mouse_event for further information.<br> <br></div><br><br><br>I have a user32.decls containing the following:<br><br><div class="quote"> <br>.lib "user32.dll"<br><br>SystemParametersInfo%(uAction%, uParam%, lpvParam*, fuWinIni%) : "SystemParametersInfoA"<br> <br></div><br><br><br>and finally, a bit of test blitz code:<br><br><pre class=code>


Type mouseparams
Field amouse
Field bmouse
Field cmouse
End Type


workdammit.mouseparams=New mouseparams

SystemParametersInfo(????????, 0, workdammit, 0)

Print workdammit\amouse
Print workdammit\bmouse
Print workdammit\cmouse
</pre><br><br>I've done dll calls before, but this one just seems to be getting the better of me. Everything else seems to pretty much make sense except the uiAction. I cannot suss out how to retrieve the SPI_GETMOUSE and SPI_SETMOUSE parameters. I'm probably off the mark here, but isn't 'uiAction' an integer, as denoted by the '%'? In which case, how on earth can it equal SPI_GETMOUSE?<br><br>To cut a long story short, what do I have to change '????????' in the example in order for it to work? <br><br>SystemParametersInfo hates me.<br><br>Thanks. <br><br></td></tr></table><br>
<a name="375623"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Perturbatio</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> <pre class=code>
const SPI_GETMOUSE = 3
const SPI_SETMOUSE = 4
</pre> <br><br></td></tr></table><br>
<a name="375634"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stoop Solo</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Much obliged to you, Perturbatio.<br><br>Just out of interest, where did those figures come from?<br><br>And am I doing something else wrong, as the only values I seem to get back from the function call are zero? <br><br></td></tr></table><br>
<a name="375680"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >soja</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> As it says at the bottom of the documentation, they're declared in winuser.h.  That is an include file that comes with the Win32 SDK (included with Visual C++, for example).  You can get the SDK by itself here (for free):<br><a href="http://www.microsoft.com/msdownload/platformsdk/sdkupdate/" target="_blank">http://www.microsoft.com/msdownload/platformsdk/sdkupdate/</a><br><br>Alternatively, you can get something like APIViewer to tell you the values of constants.  <a href="http://www.activevb.de/rubriken/apiviewer/index-apiviewer.html#anchor3." target="_blank">http://www.activevb.de/rubriken/apiviewer/index-apiviewer.html#anchor3.</a> <br><br></td></tr></table><br>
<a name="375684"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >soja</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> As for your example, it works fine on my system:<br><br><pre class=code>
;SystemParametersInfo%(uiAction%, uiParam%, pvParam*, fWinIni%):"SystemParametersInfoA"

Type mouseparams
Field amouse
Field bmouse
Field cmouse
End Type


workdammit.mouseparams=New mouseparams

Print SystemParametersInfo(3, 0, workdammit, 0)

Print workdammit\amouse
Print workdammit\bmouse
Print workdammit\cmouse
WaitKey
</pre> <br><br></td></tr></table><br>
<a name="375693"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stoop Solo</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ah, I missed that bit of the document. Thanks for the info. I'll check APIViewer out at a more sociable hour.<br><br>Unfortunately, on my system, that example still produces:<br><br>----------------------------------------<br>1 (indicating successful call)<br>0<br>0<br>0<br>----------------------------------------<br><br>Curses! Still no closer to temporarily disabling mouse acceleration within Dragon Chaser... <br><br></td></tr></table><br>
<a name="375710"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >soja</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> So the function call is working, but you probably specified 4 (SPI_SETMOUSE) as the first parameter once, and set the values to workdammit\amouse, ..\bmouse, and ..\cmouse (which were all 0).  So now whenever you use 3 (SPI_GETMOUSE), it returns 0, 0, and 0 like it should, but not as you're expecting.<br><br>Doesn't your mouse movement seem weird or a little different than it used to now?  =) <br><br></td></tr></table><br>
<a name="375786"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stoop Solo</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> My mouse is unaffected. Unfortunately, I definitely tried '3'; I copied and pasted the above example you quoted. <br><br>I'll have to see what it does on another machine, although if I cannot rely on it to work on all systems, I cannot... er... rely on it to work on all systems...<br><br>How odd... <br><br></td></tr></table><br>
<a name="375864"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Perturbatio</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> it works for me, I get :<br><br>1<br>6<br>10<br>1 <br><br></td></tr></table><br>
<a name="375942"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >soja</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Why don't you go into the control panel, change your mouse settings, and try it again just to make sure? <br><br></td></tr></table><br>
<a name="375991"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stoop Solo</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm...<br><br>It seems to produce results on a different machine.<br><br>Interestingly, it seems if I turn mouse acceleration off on the other machine, all the results are returned as zero. If I turn it back on again, the results change.<br><br>As fas as my machine is concerned, the results remain as zero whatever I do to it. If I SETMOUSE them to something else, I get those values back, although it makes no alteration to any of the parameters in the control panel, nor to the mouse.<br><br>I wonder if this is something to do with not using MS mouse drivers? <br><br></td></tr></table><br>
<a name="376154"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >soja</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Strange indeed.  I'm stumped; I got the same results as Perturbatio (I guess we both use the defaults).<br><br>My mouse driver is just the standard PS/2 mouse driver included with Windows XP. <br><br></td></tr></table><br>
<a name="376162"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stoop Solo</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> If its behavior is uncertain, I'd best leave alone. I could just set them to zero upon game launch and put them back to whatever upon exit, and satisfy probably the majority of windows configurations, but I guess that still brings the possibility of adverse effects. Perhaps I'll just stick with the note in dragon chaser's readme file.<br><br>Thanks Perturbatio / soja. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
