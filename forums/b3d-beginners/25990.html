<!DOCTYPE html><html lang="en" ><head ><title >floats misbehaving?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >floats misbehaving?</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=5" >Blitz3D Beginners Area</a>/<a href="#bottom" >floats misbehaving?</a><br><br>
<a name="270286"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Adam_128</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> hi, I am using some floating point variables in my game, but it seem that after a while, some very irregular (and crazy) numbers can come out of just simple float math. I created a small program to show off my problem. You can use the up/down arrow key's to increase/decrease the value.. if you hit up and down a few times, you will notice that instead of<br><br>27.05<br><br>you will get<br><br>27.8999 &lt;-???<br><br>or<br><br>-40.04  &lt;-???<br><br>why is this? The program is only adding .05, but somehow I get weird numbers. Its very frustrating<br><br><br>here's the code:<br><br><br><br>x#=1.05<br>SetBuffer(BackBuffer())<br>Graphics 640,480<br>Color 255,255,255<br><br>While Not KeyDown(1)<br> Cls<br><br> If KeyDown(200) Then x#=x#-.05<br> If KeyDown(208) Then x#=x#-.05<br><br> Text 150,150,Str$(x#)<br> Flip()<br><br>Wend<br><br>End <br><br></td></tr></table><br>
<a name="270293"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've alos noticed this. I did code once that was subtracting and adding 0.1 to a number, and it would sometimes give weird numbers like 0.29999999. And when the number was supposed to be 0, it was 4.97263e-07 or something. <br><br></td></tr></table><br>
<a name="270296"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is a rounding error due to the limited range of 32 Bit Floating Point. But you were wrong when you said 27.05 will be 27.8999. The rounding error is only 0.0001, so 27.05 might be 27.0499.<br><br>You can fix this using INT - which will round the number, so you would have to<br>x=int(x*1000)/1000<br><br>I agree, 32 Bit floating Point Numners are not the perfect choice for mathematically advanced stuff, but in the games and Multimedia Design it's ok. <br><br></td></tr></table><br>
<a name="270298"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ice9</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Never trust a floating point math for accuracy.<br>I think AMD processors are less accurate for floating point math than Intel but AMD is a little faster doing it.<br><br><br>x#=105.0 <br>SetBuffer(BackBuffer()) <br>Graphics 640,480 <br>Color 255,255,255 <br><br>While Not KeyDown(1) <br>Cls <br><br>If KeyDown(200) Then x#=x#-5.0 <br>If KeyDown(208) Then x#=x#-5.0 <br><br>Text 150,150,Str$(x#*0.01) <br>Flip() <br><br>Wend <br><br>End <br><br></td></tr></table><br>
<a name="270870"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> so....<br><br>how would one perform mathematical operations reliably with fractions? <br><br></td></tr></table><br>
<a name="270920"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >soja</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Usually the difference is so insignificant, it doesn't matter.  If you really wanted precision, you would have to use doubles (which aren't supported natively by Blitz, as I understand it).  <br><br>When it does (generally) matter, it's because you want to compare a float to another number.  If that were the case, you could convert it to an Int like jfk suggests above.  You could also subtract the two numbers and verify that the difference is less than .0001 or something. <br><br></td></tr></table><br>
<a name="272158"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PowerPC603</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> You could try this instead:<br><br>If KeyHit(200) Then x#=x#+.05<br>If KeyHit(208) Then x#=x#-.05<br><br>If you used KeyDown, then every time the main loop executes,<br>0.05 if added or substracted from x#.<br>As long as you're holding the keys, the numbers will change.<br><br>Using KeyHit, it will only happen once for each keypress. <br><br></td></tr></table><br>
<a name="272169"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AbbaRue</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think the "Then x#=x#-5.0" being used in both lines was just a typo error. <br><br></td></tr></table><br>
<a name="272204"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Adam_128</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> yea sorry, I meant x#=x#-.05<br><br>The big issue here is that my number seem to be off for some darn reason.. <br><br>In order to create a wrapping map, I use a grid of 4x4 320x200 tiles.. the tiles swap position based on where you are scrolling, so at anyone time, you are either on  or between tiles 1-4.<br><br>each tile gets its on var (til1x#,til2x# etc..) and each one is incremented/decremented with the same value, however they seem to not want to move together properly.. when scrolling around the tiles will be out of sync with one another, and you can see gaps in between the four tiles. if you stop scrolling at the right place, the gaps dissapear. Also the objects on the screen do not move at the same rate it seems, and everything just jumps around... any ideas?? I can email code if anyone is intersted in looking :) <br><br></td></tr></table><br>
<a name="272211"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> You could increment only one tiles position and move the other tiles relative to that one tile. Something like:<br><br>t1#=t1#+.1<br><br>for i=0 to 20<br> drawblock tile(i),t1#+(tilewidth#*i),whatever#<br>next <br><br></td></tr></table><br>
<a name="272256"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >soja</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Could this be as simple as a rounding problem (since pixels are indexed by integers)??  i.e. are you sure you have Ints and Floats and % and # all in the right spot? <br><br></td></tr></table><br>
<a name="272271"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MadMax</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's a problem with Floats. If you use floats, you'll have to accept it. The 3d part of Blitz seems designed to use floats, and they usualy work very well.<br><br>There are ways to avoid using floats, but one has to be aware of certain rules.<br><br>The way I go about it is, use floats only if necessary. But then, this actitude for some strange reason that escapes me completely is not welcome. So if you want to avoid useless arguments stick with floats. <br><br></td></tr></table><br>
<a name="272473"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Adam_128</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> hmm, Wish I could use integers, but I am using floats for physics.. like speed up, slow down, and various speeds. I think that all the float manipulation is what is putting the sprites/ 4tiles in different locations. <br><br></td></tr></table><br>
<a name="272474"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Adam_128</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> I just thought of something...<br><br><br> int (3.9) = 4<br> int (3.4) = 3<br><br>Perhaps since the int function is rounding, a couple of the tiles get offset by an extra pixel.. <br><br>Would using an int function that does not round work? also is there such a thing? <br><br></td></tr></table><br>
<a name="272482"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Floyd</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> A different Int function would not help. The 'off by one' problem would crop up somewhere else.<br><br>The real solution was suggested earlier.<br><br>Use your current system to find the location of *one* tile. Then draw the others based on that.<br><br>If this one tile is at location i,j and a tile has width 50 then<br>the tile immediately to the right would be at i+50,j. <br><br></td></tr></table><br>
<a name="272553"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Oldefoxx</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> A regular fraction is actually one integer divided by another.  An irregular fraction cannot be reduced to this<br>form.<br><br>Thne answer in most cases is simple.  If you had a grid of say 200x200 elements, than any X or Y position would be considered to be a fraction where 200 is the divisior.  But if you do not divide by 200 until you need the fractional value, you can treat the value representing the X or Y as being an integer, and use INT() to get the nearest integer value.  IN the final step of determining precisely where you are on the grid, you would divide both X and Y by 200 to get the proportional results.<br><br>The only problem could be in the manner in which the FPU resolves fractional values into integers.  It does not exactly follow the rule that anything from .0 up to but less than .5 is equal to .0, and that anything from .5 up to but less than the next integer value is equal to the next integer value.  Rather, it holds that any value that is .5x, is either truncated to the integer value our rounded up by 1 to the next integer value based on whether the x value is found to be either even or odd.  It is a strange fule, apparently pressed by the financial community that wanted to ensure no one got cheated by financial transactions that involved fractional values, but it can play havoc with some mathematical computations. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
