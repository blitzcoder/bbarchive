<!DOCTYPE html><html lang="en" ><head ><title >Trigger combat for RPG game</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Trigger combat for RPG game</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=5" >Blitz3D Beginners Area</a>/<a href="#bottom" >Trigger combat for RPG game</a><br><br>
<a name="1174560"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Giuliani</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi all,<br>I'm working on a little RPG game and I would like to know how I could proceed to launch randomly (timer) a combat like old school-RPG.<br>I already have the worldmap and the character and I would like that, randomly, between 30s and 2min, (only if the player is moving) a combat begins, the player is loaded on a new map based on the same "environment" where the player was on the worldmap) (for instance, if the players is crossing a desert, so it loads the combat map "Desert") I'm sorry if I'm not clear ^^<br><br>Thanks in advance for your help <br><br></td></tr></table><br>
<a name="1174603"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Are you moving on a tile grid (even an invisible one), or any other system that lets you measure the number of "steps" - not necessarily literal animation steps - the character has taken?<br><br>If so, just set a lower bound (you don't want it to be zero or it might get nasty on the player) and an upper bound, so say "between ten and fifty steps", and select a random number within that range on entering a stage or after the last random battle. Set a counter to this, and decrement the counter on each step until (counter - lowerbound) = 0. If you make the upper and lower bounds properties of the current level, you can have more and less aggressive areas.<br><br>If you don't have an obvious way to measure steps, that's where the real magic will lie. For a system that allows more or less "analog" movement in any directions, instead of a grid (think FF7-10), you could poll the player position each frame, and consider a "step" to have been taken each time the player has moved more than 1 metre away from their last recorded position (then record the new position and measure from there next frame). <br><br></td></tr></table><br>
<a name="1174634"></a>

<a name="1174635"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes i agree with Yasha, counting the number of steps or the total length of movements since the last encounter is probably better for a FF7 random encounter effect, because if you rely on a timer, an encounter may happen even if the player does not move or is away.<br><br><font class="tiny">Last edited 2013</font> <br><br></td></tr></table><br>
<a name="1174637"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> About the desert: you should know what chipset\tileset the current level is using. Whenever a random fight is to be enacted, query what kind of tile the player is standing on.<br>If the player is lying on top of a desert-related tile then you can show the desert scene etc.<br><br>What you use to find the tile the player is currently stepping on depends on your map configuration. If it's standard square tiles stored in a two-dimensional array:[bbcode]<br>tileRow% = Int(PlayerY / TileSize)<br>tileColumn% = Int(PlayerX / TileSize)<br><br>Map(tileRow, tileColumn)[/bbcode]If it's a 3D RPG you can get the texture for whatever surface the player is stepping on. <br><br></td></tr></table><br>
<a name="1174666"></a>

<a name="1174667"></a>

<a name="1174668"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Giuliani</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks a lot for your help.<br><br>For the "steps", I think I understand, but I thought to something simplier like <i> If keyHit then timer/WaitTimer</i><br><br>I thought to something like that too, by changing of camera.<br>By searching on this forum, I found this example:<br><br> <div class="quote"> 1) The characters stay exactly where they are but are frozen.<br>2) Their 'combat' counterparts are unfrozen. <br>3) The opponents are added.<br>4) The world camera is hidden.<br>5) The main combat camera is unhidden (I have four cameras for combat).<br>6) Combat begins<br><br>When over:<br>1) View switches back to world map.<br>2) Character positions reset<br>3) Monsters removed. <br></div><br><br>What do you think about this way to proceed? Isn't it "too heavy"? <br><br>I have forgot to precise, this is a 3D RPG.<br>So it means that I have to check the texture first in the program, and then load the map related to this texture?<br><br>Thanks in advance<br><br><font class="tiny">Last edited 2013</font><br><br><font class="tiny">Last edited 2013</font> <br><br></td></tr></table><br>
<a name="1174686"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I would agree with RemiD or Yasha regarding the use of actual number of "steps" taken, rather than a timer, since this would ensure a reasonable amount of distance is actually travelled between combats.<br><br><div class="quote"> So it means that I have to check the texture first in the program, and then load the map related to this texture? <br></div><br>The idea of checking the "Tile" was specifically for 2D RPG's (Like the old Zelda/FF style) so for 3D, a direct comparison would be checking the Texture beneath the character's feet (i.e. downwards on the Y axis)<br>Something like:<br><div class="quote"> <br>LinePick(EntityX(Char,True),EntityY(Char,True)EntityZ(Char,True),0,-1,0,1.0)<br>Ground=PickedEntity()<br>Surface=GetSurface(Ground)<br><br>Brush=GetSurfaceBrush(Surface)<br>Texture=GetBrushTexture(Brush)<br>File$=TextureName(Texture)<br> <br></div><br><br>However, there may be better ways of doing this, since, presuming you are still working from the World Map idea, you may have split the world map into regions which each have an invisible mesh that can be checked for distance/collision and it is these regional meshes which can determine the type of enemies encountered.<br><br><div class="quote"> <br><br><br>1) The characters stay exactly where they are but are frozen.<br>2) Their 'combat' counterparts are unfrozen. <br>3) The opponents are added.<br>4) The world camera is hidden.<br>5) The main combat camera is unhidden (I have four cameras for combat).<br>6) Combat begins<br><br>When over:<br>1) View switches back to world map.<br>2) Character positions reset<br>3) Monsters removed. <br><br><br><br>What do you think about this way to proceed? Isn't it "too heavy"? <br> <br></div><br><br>This would seem to be a good standard way to proceed generally, sure. <br><br></td></tr></table><br>
<a name="1174690"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Giuliani</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> thanks for your precious advices, guys.<br>And sorry for my misunderstood, english is not my native language ^^<br><br>But one thing that I didn't understand with the "number of steps", if I proceed with the frames system, I will have to include the number of frame for the animation "idle" too?<br>because I would like that the combat begins only and only if the player is walking on the map, if he doesn't walk, so his position is idle, so the combat cannot begins as if the game is in pause.<br>How can I measure the numbers of steps differently?<br><br>For the world I will follow your advice PJ, i will create several mesh for each different region.<br>Does the LinePick function work at the same for the region mesh?<br><br>Thanks again <br><br></td></tr></table><br>
<a name="1174704"></a>

<a name="1174707"></a>

<a name="1174708"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>How can I measure the numbers of steps differently?<br> <br></div><br>I see 2 ways of doing this :<br><br>1)With number of steps :<br>If you use 3d animated meshes, you can use these commands to know when the animated mesh put a foot on the ground : <br><pre class=code>
If(AnimSeq(Mesh) = SequenceWalkForward)
 If(AnimTime(Mesh) = 10)
  ;Character has put his left foot on the ground
 Elseif(AnimTime(Mesh) = 20)
  ;Character has put his right foot on the ground
 Endif
Endif
</pre><br><br>2)With the total length of movements<br>Simply store a variable where you add all the lengths between the old position and the new position of the player each time the player moves. <br>For example :<br>Let say your player can move at a speed of 1m per second when he is walking forward.<br>Each time you move the player, you add this 1m to a counter and when the counter is equal or superior to a desired value (which can be chosen randomly at the end of each encounter) an encounter happens.<br><br><font class="tiny">Last edited 2013</font> <br><br></td></tr></table><br>
<a name="1174710"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Giuliani</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I see,<br>thanks a lot remiD for your help. <br><br></td></tr></table><br>
<a name="1174840"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> I was looking at Chrono Cross, a 3D RPG from Square. They pick a specific battle scene based on the whole level you're in, not the piece of ground you're standing on.<br><br>That is, if you're in a desert world, every single fight you have there will take place in a desert-like arena.<br>If you're in a forest, the arena used is one full of vegetation, trees, grass etc.<br><br>It's really easy for the player to immerse, and the arenas don't look bad. <br>The fighting arenas follow the themes of the whole levels, not the ground textures - so I take it back; you don't really need to fiddle with textures at all.<br><br>Reference:<br><br><iframe width="560" height="345" src="http://www.youtube.com/embed/-xgm9mFwgIg" frameborder="0" allowfullscreen></iframe> <br><br></td></tr></table><br>
<a name="1174867"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Giuliani</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Kryzon, this is exactly what I mean and what I want to do.<br>But you are only talking about a battle based to a scene, a specific map.<br>My problem was about the worldmap, when only one player (not the others members or the team) is running on a scaled worldmap. The fact is that this player will cross desert, forest, volcano only in a few minutes, the environnment will be very different.<br>My best example is the worldmap in Sony's RPG "the Legend of dragoon", this is exactly what I want to do (without the linear path) or peek in Dragon quest's worldmap too<br><br>Thanks for your help <br><br></td></tr></table><br>
<a name="1174894"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is a screenshot from that Legend of Dragoon world map you're talking about, just to establish some context:<br><br><img src="http://i45.tinypic.com/167unbr.jpg"><br><br>There are various ways to do it without handling textures. For optimization reasons with the PS1 they probably had to texture all that ground in the entire 3D map with a single texture - something you could do as well - and that would render any texture methods not good for this.<br><br>• I was thinking you could use polygonal zones that you tag with a battle arena value (plot a polygonal zone enclosing your desert area, tag it with "desert battle arena"), then at the moment a fight is called, test your character's [X,Z] position against all polygons in the world with <a href="/codearcs.php?code=2137" target="_blank">this code archive entry</a>, and call for the battle arena of the polygon he's currently standing inside.<br>However, this can lead to empty holes if all the polygonal zones aren't placed in an adjacent manner (easily fixed with an editor you can build, but anyway).<br><br>• So an easier - and just as fast - way is to draw a 2D map.<br>First, choose what RGB colors are associated with what types of arenas (one color to be associated with one type of arena), then paint the zones.<br>Say your entire 3D world spans 300x200 3D units in the [X,Z] plane; you would then create a 300x200 pixel bitmap in MS-Paint or whatever, and according to the regions in your world (ruins, deserts, forests, secret places), paint appropriate zones.<br><br><img src="http://i47.tinypic.com/s62dlu.png"><br><br>When the step counter finishes and a battle is to be carried out, ReadPixel the map a single time with the player's rounded coordinates: <br><pre class=code>ReadPixel(Int(PlayerX), Int(PlayerZ), ImageBuffer(world1_battle_map))</pre>Considering your 3D world having its top-left corner at [0,Y,0]. <br><br></td></tr></table><br>
<a name="1174899"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Giuliani</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Waow, Thanks a lot for all these explanations Kryzon.<br>I don't get everything yet^^ because I need a little more experience and practise with Blitz but I will try to understand and apply your advices. and methods, these systems seem to be perfect for my project.<br><br>Thanks again <br><br></td></tr></table><br>
<a name="1174903"></a>

<a name="1174904"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>ReadPixel(Int(PlayerX), Int(PlayerZ), ImageBuffer(world1_battle_map))<br> <br></div><br>I have done something similar in the past.<br>If the bottom left corner is the origine (0X,0Y,0Z), and if each pixel on your image represents one unit,  then i suggest :<br>PX% = floor(PlayerX#) <br>PY% = ImageHeight%-1 (or MapDepth%-1) - floor(PlayerY#)<br>ReadPixel or GetColor at PX,PY <br><br></td></tr></table><br>
<a name="1174906"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Giuliani</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks RemiD<br><br>Something that I don't understand is that the Pixelmap need t o be apply to the worldmap mesh as a texture, right?<br>But it should be masked, or place under the terrain texture? <br><br></td></tr></table><br>
<a name="1174909"></a>

<a name="1174910"></a>

<a name="1174911"></a>

<a name="1174918"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>Something that I don't understand is that the Pixelmap need t o be apply to the worldmap mesh as a texture, right?<br> <br></div><br>Giuliani&gt;&gt;<br>You can use a quad to have a flat map as in Legend of Dragoon or you can use a Terrain with reliefs.<br>On this quad or on this terrain you add a texture with colors, shades, details to make it beautiful, and you use another image with only the colors that represents the differents zones of your map.<br>For example if the map measures 100units in width and 100units in depth, you can use a texture of 1024*1024pixels to add many colors, shades, details to the map mesh (quad or terain), and also use a 100*100pixels image with the different zones colored with different colors.<br><br>Or you can use the same resolution for the texture with colors, shades, details and the image with the colors of the zones because with the code mentionned above you will analyze only one pixel of the image so this will be fast.<br><br>What is important is that the width and depth of the map mesh (quad or terrain) corresponds to the width and height of the image. This way you will be able to know precisely the pixel to analyze on the image. <br><br></td></tr></table><br>
<a name="1174912"></a>

<a name="1174914"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Giuliani</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> yes I understand<br><br>But The image with colors will not be show ingame, so i will need to mask it, right? <br><br></td></tr></table><br>
<a name="1174913"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> You're converting the player's position in the 3D world to 2D coordinates that you use to pick a corresponding pixel in the battle map. <br><br>I was thinking the "battle map" as something unrelated to the worldmap mesh. While the world mesh can have any kind of Brushes coloring it (texture layers, blending etc.), the battle map is kept separate.<br><br>This battle map is a standard blitz image loaded with LoadImage(), and it's used more like a guide for consulting every time you need to start a battle. So it doesn't need to be "applied" to the world mesh. <br><br></td></tr></table><br>
<a name="1174915"></a>

<a name="1174916"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> There is also another way to detect in which zone the player is on the map.<br><br>You can use one map mesh (quad or terrain) + one texture for the colors, shades, details for the render.<br>And several low tris meshes which represent the different zones on the map.<br>Use NameEntity(Mesh,"Zone"+Str(ZId%)) to set the name of each zone mesh.<br>Set all these zones meshes to pickable.<br>Do a linepick from above the feet of Player to below.<br>Check the picked mesh<br>Retrieve the Name$ of the picked mesh<br>Retrieve the Id% of the picked mesh<br>And you know in which zone the player is.<br><br>This should be fast if you use low tris meshes for the zones and if there are not too many zones (to make it faster you can do a preselection by checking which zones are near enough player and set only these zones to pickable) <br><br></td></tr></table><br>
<a name="1174917"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Giuliani</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> So if I well understood,<br><br>the "battle map" (= the image with colors) won't be applied to the worldmap.<br>It just a "guide", and I will just convert the player position to 2D coordinates, so that The battle on a specific map could begin.<br><br>Thanks again <br><br></td></tr></table><br>
<a name="1174920"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> The image with the colors of the zones will be stored in memory, you don't need to show it or to hide it, you only read it when you need. <br><br></td></tr></table><br>
<a name="1174924"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Giuliani</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, I got it ^^<br><br>thanks <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
