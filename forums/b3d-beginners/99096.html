<!DOCTYPE html><html lang="en" ><head ><title >Memory usage (freeimage) 2</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Memory usage (freeimage) 2</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=5" >Blitz3D Beginners Area</a>/<a href="#bottom" >Memory usage (freeimage) 2</a><br><br>
<a name="1161546"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ILonion</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello!<br>Some time ago i created topic (http://www.blitzbasic.com/Community/posts.php?topic=98842) about "strange" freeimage working.<br>But today, i see something strange again :)  and i'm confused.<br><br>Yasha wrote in previous topic:<br>&lt;&lt;&lt;A slightly better test is to see what happens to the Task Manager figure when you reload the images. Does usage jump up to 140MB? Or does it reuse that space, indicating that the system was just being conservative? &gt;&gt;&gt;<br><br>Well, memory usage increase and not stop.<br>(i used Process Explorer, and default windows Task Manager)<br><br>tasks:<br>1. load image data<br>2. decode data<br>3. load image<br>4. free image.<br><br>if you run a cycle (0...n) of these points, then memory usage will continue to increase...<br><br>Process Explorer (start program):<br>Private Bytes: 34556K<br>Working Set: 19244K<br><br>(after 1500 loop repeat):<br>Private Bytes: 61576K<br>Working Set: 46600K<br><br>+loop again: more... more... more... memory usage, up to 100+ MB RAM and more again...<br><br>I hope this is my last topic about it :) but i want to clarify just in case: is it OK for windows too or...? :)<br>P.S. Sorry for my English.<br><br><br><br><br><br><br><br><br>image data: <a href="http://rghost.ru/download/41085413/12e31f88fa53374e9f1520dd2ab0ed3a6e77e2ea/menu.dat" target="_blank">http://rghost.ru/download/41085413/12e31f88fa53374e9f1520dd2ab0ed3a6e77e2ea/menu.dat</a><br><br>test-unit:<br>;---------------------------------------------------------------------------------------------<br>Global nsl_form_menu<br>;---------------------------------------------------------------------------------------------<br>;---------------------------------------------------------------------------------------------<br>;---------------------------------------------------------------------------------------------<br>Graphics 640,480,16,2<br>SetBuffer BackBuffer()<br>;---------------------------------------------------------------------------------------------<br>;---------------------------------------------------------------------------------------------<br>;---------------------------------------------------------------------------------------------<br>While Not KeyHit(1)<br>Cls<br><br>	If KeyHit(57) ;space<br>								;For k = 0 To 3000<br>								;Cls<br>				If order = 0<br>						;<br>						load_graphic()<br>						;<br>					order = 1<br>				Else<br>					FreeImage nsl_form_menu<br>					order = 0<br>				End If<br>								;Text 10,10,k<br>								;Flip<br>								;Next<br>	End If<br><br><br>	;If order = 1<br>	;	DrawImage nsl_form_menu,30,30<br>	;	Text 5,5,"image loaded"<br>	;Else<br>	;	Text 5,5,"no image"<br>	;End If<br>Flip<br>Wend<br>;---------------------------------------------------------------------------------------------<br>;---------------------------------------------------------------------------------------------<br>;---------------------------------------------------------------------------------------------<br>;---------------------------------------------------------------------------------------------<br>;---------------------------------------------------------------------------------------------<br>;---------------------------------------------------------------------------------------------<br>Function load_graphic()<br>		<br>		im_order = 1<br>		For k = 1 To 1<br>			<br>			Select True<br>				;<br>				Case im_order = 1<br>					im_handler$ = "menu.dat"<br>						;<br>						decrypt_graphic(im_handler$)<br>						;<br>					;handler:<br>					nsl_form_menu = LoadImage("image.bin")<br>					;<br>					DeleteFile ("image.bin")<br>					<br>				;Case im_order = ...<br>					;<br>					;<br>					<br>			End Select<br>			im_order = im_order + 1<br>		Next<br>		<br>End Function<br>;---------------------------------------------------------------------------------------------<br>;---------------------------------------------------------------------------------------------<br>;---------------------------------------------------------------------------------------------<br>Function decrypt_graphic(im_handler$)<br><br>	;put image to temp bank:<br>	file = OpenFile(im_handler$)<br>	size = FileSize(im_handler$)<br>	bank = CreateBank(size)<br>	ReadBytes bank,file,0,size	<br>	CloseFile file<br>	<br>	;decrypt file:<br>	For k = 0 To size - 4 Step 4<br>		value = (255 - PeekByte(bank,k))<br>		PokeByte bank,k,value<br>	Next<br>	<br>	;put image to temp file:<br>	file = WriteFile("image.bin")<br>	WriteBytes bank,file,0,size<br>	CloseFile file<br>	FreeBank bank<br>	<br>End Function <br><br></td></tr></table><br>
<a name="1161581"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> This example actually runs with constant memory use on my system, according to Task Manager.<br><br>Perhaps the problem is in some of the code you cut...? <br><br></td></tr></table><br>
<a name="1161666"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ILonion</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yasha, i'm sorry! This is my fault. this is not "bug". In this time everything is ok.<br>My brain is exploded....) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
