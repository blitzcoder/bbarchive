<!DOCTYPE html><html lang="en" ><head ><title >Manipulate child meshes</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Manipulate child meshes</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=5" >Blitz3D Beginners Area</a>/<a href="#bottom" >Manipulate child meshes</a><br><br>
<a name="1174173"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gazza69</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have downloaded a free Apache gunship model in 3ds format.  <br>I don't think it has any animation (no animation file)<br>It has 8 children when I used CountChildren.<br>I am loading the mesh using loadanimmesh("chopper.3ds")<br>I then want to manipulate child1 and child2 (tailblade and rotarblade)<br>I can do this by setting variables :<br>tailblade = getchild(chopper,1)<br>rotablade=getchild(chopper,2)<br><br>I then use :<br><br>Moveentity chopper, 0,0,1<br>turnentity tailblade, 0,10,0<br>turnentity rotarblade, 0,0,10<br><br>this moves the chopper nicely and turns the blades in.<br><br>I have tried to take this one step further and set up a type for the chopper:<br><br>Type helicopter<br>  field body<br>  field tailblade<br>  field rotarblade<br>end type<br><br>I have then made a new global variable:<br><br>Global chop1.helicopter<br><br>and I use this function (below) to make the chopper:<br><br>loadchopper()  <br>=========================================<br><br>Function loadchopper()<br>   chop1.helicopter = New helicopter<br>   <br><br>  chopmodel =LoadAnimMesh("gunship.3ds")<br>  ScaleEntity chopmodel, 3,3,3<br> chop1\ID = CopyEntity(chopmodel)<br> chop1\rotorblade =GetChild(chopmodel,1)<br> chop1\tailblade=GetChild(chopmodel,2)<br> FreeEntity chopmodel<br> PositionEntity chop1\id,30,40,10<br> RotateEntity chop1\id,90,0,0<br>End Function<br><br><br><br>The first example works, but when I set it up as a type, the chopper still moves in the correct direction, but the blades don't rotate.  No errors are reported. <br><br></td></tr></table><br>
<a name="1174175"></a>

<a name="1174176"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> That's because you've set chop1\rotorblade and chop1\tailblade to the child components of the original entity, but you've set chop1\ID to a newly copied entity which has its own copies of the child components. After you free the original, the child entities reference by chop1\rotorblade and chop1\tailblade no longer exist.<br><br>So you need to get the children of the specific entity you intend to use - of the copy, if you want to use a copy. Try GetChild(chop1\ID, 1) instead.<br><br><font class="tiny">Last edited 2013</font> <br><br></td></tr></table><br>
<a name="1174204"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gazza69</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh yes, that works.  I can see how that makes sense.<br>But why wouldn't I get a MAV when manipulating the chop1\rotorblade if it no longer existed after freeing the entity/child it pointed to? <br><br></td></tr></table><br>
<a name="1174207"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> While getting a MAV always means something has gone wrong, something going wrong doesn't always mean an error will be generated.<br><br>Due to an intricacy of how memory is allocated by the OS, a B3D entity doesn't immediately become invalid once it's freed, and most likely will never become invalid at all (the memory will be a priority area for reuse). You can therefore continue to use simple entity commands like EntityX, TurnEntity etc. that only manipulate the base entity struct, as long as this is the case. It's actually a (ridiculously minor) potential exploit, since if anything else were ever allocated over the same area as the old entity, you could use commands like EntityX to read data from it.<br><br>The reason for this is the fact that the OS has no understanding of "objects" (in the memory sense, not the 3D sense). It would be grossly inefficient to expect the OS's "real" memory management system to respond every time a program needs a new 16-byte block of memory. Instead, the OS allocates only entire "pages", which on most current operating systems are never less than 4KB, and passes these to the program; the program than allocates space out of the pages (for big objects, spanning many pages) using a higher-level memory library utility such as C++'s "new" or the famous "malloc", which maintains various hidden internal information structures to keep track of which parts of which pages are currently in use; so when you call a Free command, what that actually does is give the memory back to <i>the malloc library</i>, which is still within your program; the library will <i>only</i> return memory to the system if it can return complete empty pages. Most likely it will never do this since those pages will just get reused the next time an object needs to be allocated anyway.<br><br>A MAV can only be detected when the OS intercepts an attempt to access memory that the application hasn't been given permission to use. This means the memory address in question needs to map to somewhere that would be on an unallocated page from that program's perspective. Because of the above process where anything that was once an entity is almost certainly still on an allocated page, it's out of the OS's hands and won't be reported as a MAV. There are other ways to check for object validity, but in general they're incredibly inefficient and would ruin your program's performance (this is one reason why there's no "EntityExists"; the other is that if you ever need it, you're doing something terribly wrong anyway). <br><br></td></tr></table><br>
<a name="1174223"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gazza69</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for response Yasha, appreciate it. I can follow what you say, gets a bit in depth for my understanding, but I can follow the logic.  I was thinking FreeEntity is totally deleting the object, I can see that is not the case now.<br>Nonetheless, I will avoid using them once I have used FreeEntity.  <br><br>Cheers<br><br>Gazza <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
