<!DOCTYPE html><html lang="en" ><head ><title >help with dll</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >help with dll</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=5" >Blitz3D Beginners Area</a>/<a href="#bottom" >help with dll</a><br><br>
<a name="377785"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >David</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> i need help with call dll, i need call dll with undefined type parameter and before get this undefined type.<br>example beacuse i am spanish and my english is not very good ;)<br><br><br>type user<br> field year<br>end type<br><br>; Insert<br>one.user = new user<br>one.year = 1977<br>insertLib "test", one ; This is a call dll<br><br>; Get<br>one.user = getLib "test" ; This is a call dll<br><br><br>the idea is create a tree indexed for searchs and get/set pointer of types.<br>in de file decls the integer is %, float is # and string is $, but the type? <br><br></td></tr></table><br>
<a name="377821"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Perturbatio</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> a type parameter should have a * at the end of it. <br><br></td></tr></table><br>
<a name="378005"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >David</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> thanks perturbatio, but i cant get pointer<br>this is the code of file decls<br><br>; dibLib.decls<br><br>.lib "dibLib.dll"<br><br>; Funciones para controlar arboles binarios<br>libTree_Insert%( index$, dato* ):"_libTree_Pointer@8"<br>libTree_Get*( index$ ):"_libTree_GetPointer@4"<br><br><br>the decls libTree_Insert work, but libTree_Get no work, blitz3d show me a error message and crash, i cant use return a pointer? <br><br></td></tr></table><br>
<a name="378047"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >soja</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can't return a pointer * from a library function.  You must return an int%.<br><br>That int% will be the actual memory address of what you need.  Then you must use RtlMoveMemory from kernel32.dll to copy the data at the memory address into a structure that Blitz can read, like a custom type or a bank.  Like this:<br><br>In your decls file:<br><pre class=code>
; .lib "dibLib.dll"
; Functions to control binary trees
; libTree_Insert%( index$, dato* ):"_libTree_Pointer@8"
; libTree_Get%( index$ ):"_libTree_GetPointer@4"

; .lib "kernel32.dll"
; CopyMemory(Dest*, Src%, Length%):"RtlMoveMemory"
</pre><br>In your Blitz code:<br><pre class=code>
bnk = CreateBank(length) ; This should be big enough to get the data at the memory address
addr = libTree_Get("test")
CopyMemory(bnk, addr, BankSize(bnk))
</pre><br>You could also use a custom type instead of a bank. <br><br></td></tr></table><br>
<a name="378074"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >David</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> this is two problems, copy data and pointers is 32bits but the dll crashed with windows 64bits, the .net show me warning with this, if i can set/get int_64 the solution is easy but i cant, if i copy data the blitz3d app have two or more equals data by call libTree_Get and is very slow with huge data, i need set/get pointers or int64<br><br>i need help!!! :(<br><br>i make a tree indexed in blitz3d if i no found solution, but is posible call a function in blitz3d with undefined type and return this?<br><br>example for my query<br>--------------------<br>; types<br>type fich1<br>field str$<br>end type<br>type fich2<br>field inte%<br>end type<br><br>; get data, ??? what type for the function is correct for fich1 and fich2?<br>function get.????( str$, dato.???? )<br>....<br>end function<br><br>; test<br>test0.fich1 = new test0<br>test1.fich1 = get( "test", test0 )<br>test2.fich2 = get( "test", test1 <br><br></td></tr></table><br>
<a name="378096"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >David</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> i find solution my problem with undocument functions, this resolve the problem:<br><br>; declaration type<br>Type prueba<br>	Field nombre$<br>End Type<br><br>; set values<br>test.prueba = New prueba<br>test\nombre$ = "a ver si rula.... works!!"<br><br>; get the handle of type and set null, the handle is always 32bits in blitz3d :)<br>; i call dll with this integer value<br>phandle% = Handle( test )<br>test = Null<br><br>; get type from handle, i get int in call dll and convert this int to type<br>testfinal.prueba = Object.prueba( phandle )<br><br>; test message<br>Print testfinal\nombre$<br>WaitKey <br><br></td></tr></table><br>
<a name="378182"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >David</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> i make the dll, in worklogs find it ;)<br>the dll have the name of dibLib.dll <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
