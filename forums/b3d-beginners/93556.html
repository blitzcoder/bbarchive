<!DOCTYPE html><html lang="en" ><head ><title >a quickey about TypeFields vs Local variables</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >a quickey about TypeFields vs Local variables</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=5" >Blitz3D Beginners Area</a>/<a href="#bottom" >a quickey about TypeFields vs Local variables</a><br><br>
<a name="1070426"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Abomination</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have the habit of transfering the fields of types to local variables<br>, when I use them more then once in a function.<br>So:<br>var1=type\field1<br>var2=type\field2<br>var3=var1*var2 : etc.<br><br>instead of:<br>var3=type\field1*type\field2 : etc.<br><br>In the assumption that a Local would be faster in calculations.<br>(and it types faster)<br>But putting something in a local also takes some time, so...<br>What method is better? (in general) <br><br></td></tr></table><br>
<a name="1070432"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't think it really makes a lot of difference. <br><br></td></tr></table><br>
<a name="1070459"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Zethrax</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Locals should be much faster as there's a fair amount of indirection involved with Types. I'm not sure about Blitz3D, but locals are also often stored in CPU registers and other optimized memory so they are usually faster than standard memory access.<br><br>If you're only accessing a field a few times per function call, then it's probably not worth transferring it to a local. If you're accessing it more than a few times, then it may be worth transferring it. Try doing some time-tests to see what gives you the best results. <br><br></td></tr></table><br>
<a name="1070514"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Abomination</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I just did some tests  :P<br>it seems that just using locals is 4-times faster than just fields.<br>and even taking in account the transfering of fields to locals first, its <br>still more than twice as fast.<br>(well as far as a fps-test means anything(cache etc.))<br>----------------------------------<br>tes=typ\j\qwerty+typ\a+typ\b+typ\c+typ\d+typ\e+typ\f+typ\g+typ\h+typ\i<br><br>FPS:121<br>---------------------------------- <br>a=typ\a<br>b=typ\b<br>c=typ\c<br>d=typ\d<br>e=typ\e<br>f=typ\f<br>g=typ\g<br>h=typ\h<br>i=typ\i<br>j=typ\j\qwerty<br>tes=j+a+b+c+d+e+f+g+h+i<br><br>FPS:340<br>---------------------------------<br>tes=j+a+b+c+d+e+f+g+h+i<br><br>FPS:550<br>--------------------------------- <br><br></td></tr></table><br>
<a name="1075419"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> orry to hijack this and resurrect it, but something I've been wondering about, kinda related is when using Type objects,<br><br><br>COnsider this simple situation below:<br><pre class=code>
Type MyType
Field AField
Field AnotherField
EndType

Function DoStuffToInstanceOfMyType(ThisInstance.MyType)
Print Str(ThisInstance\AField)</pre><br>End Function<br><br>Are ALL the fields of that instance automatically converted to locals for the compiler, or just any that may be actually used within the function scope?<br><br>My gut instinct tells me yes, and this may be best for quickly being able to retrieve the field values, but if there's a lot of fiel;ds, and if these fields are themselves instances of other types with lots of fields, it can kinda add up... <br><br></td></tr></table><br>
<a name="1075422"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Are ALL the fields of that instance automatically converted to locals for the compiler, or just any that may be actually used within the function scope? <br></div><br><br>Neither. Blitz3D doesn't perform such optimisations (especially because in this case, it wouldn't be an optimisation at all). The above conversation is about doing it manually. <br><br></td></tr></table><br>
<a name="1075595"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Not sure I quite understand you or you me, Yasha :) <br><br>I know my post wasn't directly concerned with the original topic, it was semi-related, though in terms of the efficiency of BB when it comes to dealing with Types and their fields.<br><br>Are you saying that in passing Types, the actual field values are used? That's optimal in itself, since there's no localisation and no duplication, right? <br><br></td></tr></table><br>
<a name="1075602"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Type objects are structs passed by reference (if you know C). When passing a type object to a function, the actual parameter is a four-byte pointer. To get at a field, the pointer is dereferenced (i.e. go to the type object's memory location, plus the offset in bytes of the desired field).<br><br>This happens every time a field is accessed or mutated: the only thing that was passed to the function as a local was the original parameter, which is equivalent in size to an integer. At no point are any of the object's fields "cached" in the function's local storage, as there are few instances where this would give an obvious benefit (and generally identifying situations like the above, where there would be a benefit, is quite an advanced optimisation). <br><br></td></tr></table><br>
<a name="1075605"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ah that makes sense! Thanks,m Yasha! <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
