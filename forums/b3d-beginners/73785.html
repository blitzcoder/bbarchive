<!DOCTYPE html><html lang="en" ><head ><title >Help with Texture Manipulation</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Help with Texture Manipulation</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=5" >Blitz3D Beginners Area</a>/<a href="#bottom" >Help with Texture Manipulation</a><br><br>
<a name="824513"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >-Rick-</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm trying to program in a "pointer" onto my game map that will match the underlying texture. First I created a heightmap and saved it as a .bmp. Then I used LoadTerrain to create a terrain. Next I've created 2 textures for that terrain - Texture one is an actual texture of grass/mountain/water/etc while texture 2 is a simple hexgrid overlay.<br><br>My plan is to highlight the hex that that player's pointer is on.<br><br>My thought was to create a 3rd texture level that was the same size at the terrain textures and place a single colored hex on it. Then I could just use PositionTexture to move the texture around so that the single hex image on it would align with whatever hex the player pointer was on. The problem is that when I draw that 3rd layer it tiles the entire terrain with hexes.<br><br>Here is the relevant code I've used in making that 3rd texture and applying it :<br><pre class=code>
Global gfxSelect		= CreateTexture(SCALE,SCALE)

skin = LoadImage ("graphics\selector.png")
	If Not skin Then RuntimeError "Missing graphics\selector.png file"
SetBuffer TextureBuffer(gfxSelect)
	DrawImage skin,0,0
SetBuffer BackBuffer()

EntityTexture Terrain,gfxMap,0,0
	EntityTexture Terrain,gfxHex,0,1
	EntityTexture Terrain,gfxSelect,0,2
	TextureBlend gfxMap,2
	TextureBlend gfxHex,3
	TextureBlend gfxSelect,3
</pre><br><br>SCALE is the size of the terrain (512)<br>selector.png is an image of a single hex<br><br>Here is the Normal Image :<br><img src="http://w3site.us/Images/Normal.jpg"><br><br>Here it is when I try to put on the selector<br><img src="http://w3site.us/Images/Corrupt.jpg"><br><br>Obviously I don't want all those little ones, just one big one that I can move around to the selected Hex. I know how to resize the texture, but how can I have it so Only 1 texture of the right size appears? How can i get it as a texture without tiling?<br><br>Thanks! <br><br></td></tr></table><br>
<a name="824537"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >-Rick-</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm...I thought I had a solution, but I keep getting a memory access violation with this :<br><br><pre class=code>
LockBuffer()
For x = 1 To ImageWidth(skin)
	For z = 1 To ImageHeight(skin)
		CopyPixelFast x,z,ImageBuffer(skin),x,z,TextureBuffer(gfxSelect)
	Next
Next
UnlockBuffer()
</pre><br><br>The size of the Image is 375x311 and the size of the texture gfxSelect is 512x512. The method I used to create my other textures was similar with the only difference being that I used 'writepixelfast' after converting the rgb codes from a value in an array :<br><pre class=code>
r# = oilfield(x,z,0); And $FF0000/$1000
g# = oilfield(x,z,1); And $FF00/$100 
b# = oilfield(x,z,2); And $FF
rgb = Int(r)*65536 + Int(g)*256 + Int(b)
WritePixelFast x-1,z-1,rgb,TextureBuffer(gfxGeo)
</pre><br><br>Can I not read from an image and draw into a texture while using writepixelfast or copypixelfast? <br><br></td></tr></table><br>
<a name="824547"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GitTech</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> <pre class=code>
LockBuffer()
For x = 0 To ImageWidth(skin)-1
	For z = 0 To ImageHeight(skin)-1
		CopyPixelFast x,z,ImageBuffer(skin),x,z,TextureBuffer(gfxSelect)
	Next
Next
UnlockBuffer()
</pre><br><br>? <br><br></td></tr></table><br>
<a name="824559"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> You need to make sure you're locking both buffers.<br><br>lockbuffer on it's own just locks the current buffer.<br><br>Use ..<br><br>lockbuffer imagebuffer( skin )<br>lockbuffer texturebuffer( gfxselect )<br><br>and the same when unlocking them.<br><br>Would you not be quicker using copyrect?<br><br>Stevie <br><br></td></tr></table><br>
<a name="824601"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >-Rick-</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> And there I just learned something! Thank you Stevie! I was unaware that you could lock more than one buffer at a time! I thought that the last called lock command was the one that was active and any previous ones were automatically 'unlocked' as the new one was called. <br><br>I just tried locking both buffers and the program ran without the "memory access violation" error I've been getting. The results were not what I wanted, but at least I got to the point where I could see something without the error!<br><br>I'll tinker with this a bit more and see if I can now make some head way. <br><br>Thanks a million for helping me out :) <br><br></td></tr></table><br>
<a name="846165"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Axel Wheeler</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have the same problem, but I'm confused about the above solutions.  I wouldn't think the way the texture is drawn would affect whether it repeats across the terrain.  <br><br>I found that using flags 16 and 32 (Clamp U and V) in the CreateTexture or LoadTexture stopped the repeating - although I had to make sure the texture's edges were empty as it did bleed the last row of texels across otherwise.<br><br>My problem is that blending just doesn't seem to work.  I've tried various modes and colors.<br><br>Here's my question; given Rick's scenario above (mine is similar) what blend modes should be used on the terrain, and on each of the various textures?<br><br>And, what color should the background of the top texture (the selection) be for the layer beneath to show through?<br><br>Is an alpha flag set somewhere?<br><br>I've seen this done in other blitz programs, I just don't know how it's done.<br><br>Thanks! <br><br></td></tr></table><br>
<a name="846184"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you set the backround to white, and use the multiply blend it will work fine. Multiply blend will blend white as invisible, all the way to pure black being totally see through, with RGB values in between with varying alpha. <br><br></td></tr></table><br>
<a name="847359"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Axel Wheeler</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the reply Ross.  <br><br>It still isn't working for me, but I have to much going on in my program to tell what's really going on.  I'll write a simplified version and do some testing.<br><br>Was I right about the clamping?  In which case you wouldn't need a large texture, just one the size of the hex or target or whatever the image is being placed (plus one x and one y).<br><br>Do you feel this is generally the best approach, or are those guys above doing it a better way with copypixelfast()/writepixelfast()/copyrect() each frame?<br><br>I've just ordered the new version of the Blitz3D manual from Lulu; hopefully it has some guidance on best practices in general.<br><br>Thanks again! <br><br></td></tr></table><br>
<a name="847523"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Clamping should be fine. Remember your vertex texture coords will determine which parts of the mesh are mapped with a texture.<br><br>A few other points. If your texture is manually created, then you will need to manually write alpha values for masking/alpha textures to work.<br><br>If you use this:<br><br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=1013" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=1013</a><br><br>to give your texture a mask colour (it will write alpha values and enable masking on a specific colour you choose), and give your texture the mask flag from when it's created. I'm not sure about the blend modes, but a couple of them should work. Just make sure your texture cursor is on the *highest* layer. <br><br>EntityTexture cursor_texture,0,4&lt;&lt; 4 being the 5th texture layer. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
