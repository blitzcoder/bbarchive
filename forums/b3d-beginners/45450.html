<!DOCTYPE html><html lang="en" ><head ><title >Another ARGB bit shifting Q</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Another ARGB bit shifting Q</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=5" >Blitz3D Beginners Area</a>/<a href="#bottom" >Another ARGB bit shifting Q</a><br><br>
<a name="505335"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> In the past I've asked how to use bit shifting to reduce a pixel color by half .. and got this reply .. which works great.  <br><br>ARGB = ( ARGB And $FEFEFE) Shr 1<br><br>What I want to do is only reduce a pixel color to 75% or 80% of it's original color ( a sort of fade )but using a method similar to above.  I know I can multiply the rgb components by .75 to do this.  For some reason all this shifting left / right is beyond me .. anyone got something which can help? <br><br></td></tr></table><br>
<a name="505349"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Who was John Galt?</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Bit shifting only divides by powers of 2, so you're out of luck. <br><br></td></tr></table><br>
<a name="505353"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here is why that works:<br><br>Lets say the value of each byte is 255.<br><br>Let's also look only at the last two bytes, G and B.<br><br>In memory, the bits for G and B would look as follows:<br><br>11111111 11111111<br><br>Now, the trick you're using first masks each of the bytes with $FE.  <br><br>$FE looks like this in binary: 11111110<br><br>If we then AND (mask) our two bytes with this, we will get 0's wherever our mask is 0.<br><br>So for our two 255 values, we get:<br>11111110 11111110<br><br>This is the trick...<br><br>Shifting right divides a number.  Shifting right by 1 divides it by 2. Shifting right by 2 divides it by 4... 3 divides by 8... etc.  Powers of 2.<br><br>But if we want to shift all the bytes at once, we don't want the bits from teh green byte overflowing into the blue byte.<br><br>For example, if our bytes looked like this:<br><br>00000001 00000001<br><br>And we shifted right by 1, we would get:<br><br>00000000 10000000<br><br>Which is wrong, because now green is 0, but blue has become 128!<br><br>If we first mask off the bits that will overflow with 0 though, we can divide without worrying about the overflow, because the overflows will be 0 and will not affect the value of the bytes below!<br><br><br>What this means for you is that you can only do this particular trick if you want to divide by 2, 4, 8, etc.<br><br>Masking the TWO lowest bits of each byte and dividing by 4 would be equivalent to multiplying by .25.  <br><br>But there is no equivalent to .75.<br><br>I don't think there is any way you could shift the bits that would be faster than masking off the bits and multiplying them individually for such values.  Modern processors pretty much multiply as fast as they shift. <br><br></td></tr></table><br>
<a name="505366"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the explanation.  You gave me the answer there add 50% and 25% of the original colour..  Cheers!<br><br>RGB1 = ( ReadPixelFast ( x, y ) ) And $FEFEFE) Shr 1 <br>RGB2 = RGB1 Shr 1<br>Mix = RGB1 + RGB2<br>writepixelfast x, y, Mix <br><br></td></tr></table><br>
<a name="505383"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Don't you need to mask the second operation too though like the first?  Otherwise you might get that overflow. <br><br></td></tr></table><br>
<a name="505395"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Looks fine to me :) <br><br></td></tr></table><br>
<a name="505673"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> In fact I'm start getting strange colours after a while ... I'll try what you say Sean.  So I should mark RGB2 as ( RGB1 and $FEFEFE ) shr 1 and then add.  Will this work?  At work ATM. <br><br></td></tr></table><br>
<a name="505679"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think it will work, but I'm not positive. <br><br></td></tr></table><br>
<a name="505698"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Pah ... it doesn't ....  In fact is does for 16bit color depth but just not for 32.  Any ideas how I can deal with both? <br><br></td></tr></table><br>
<a name="505710"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>Thanks for the explanation. You gave me the answer there add 50% and 25% of the original colour.. Cheers!<br><br> <br></div><br><br>I thought this as I read through although all this shifting stuff makes my brain hurt!<br><br>Thanks for the explanation, Sswift, that was really simple to understand and is good to know. <br><br></td></tr></table><br>
<a name="505711"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Are you saying it works for 16 bit color, but not for 32 bit color?<br><br><br>It should work for 32 bit color.  16 bit color though...  I forget if Blitz3D returns colors in a different format when you're reading fro a 16 bit display, but I'm pretty sure it doesn't.  I'm pretty sure it converts it to the same format as 32, just with less precision.<br><br>I made this test and it appears to work for all numbers:<br><br><pre class=code>
For Loop = 0 To 255
   
	RGB = Loop + Loop Shl 8 + Loop Shl 16
	Print (RGB And $FF)
   
	RGB1 = (RGB And $FEFEFE) Shr 1
	Print (RGB1 And $FF)

	RGB2 = (RGB1 And $FEFEFE) Shr 1
	Print (RGB2 And $FF)
	
	Print ""
	
	RGB3 = RGB1 + RGB2
	Print (RGB3 And $FF)
	Print Floor((RGB And $FF) * 0.75)
	
	Print ""
	Print ""

Next	
	
WaitKey()
</pre> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
