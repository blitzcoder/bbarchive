<!DOCTYPE html><html lang="en" ><head ><title >My pixel by pixel 2D scrolling example with layers</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >My pixel by pixel 2D scrolling example with layers</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=5" >Blitz3D Beginners Area</a>/<a href="#bottom" >My pixel by pixel 2D scrolling example with layers</a><br><br>
<a name="650980"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >puredave</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey all!<br><br>Well i have been coding with darkbasic and darkbasic pro for a cpl of years. to be honest havent used it for quite a while due to the horrid bugs + stability issues.<br><br>Anyway i just bought Blitz3d to see what it is like, so i guessed the first thing to do would be to convert some darkbasic pro code! (so far very impressed with Blitz)<br><br>you can grab my example from here:<br><br><a href="http://users.tpg.com.au/puredave/code/PxP_Tile_Engine.zip" target="_blank">http://users.tpg.com.au/puredave/code/PxP_Tile_Engine.zip</a><br><br>This is my version of a 2D scrolling play area. It features the folowing:<br><br>Pixel based rather than tile based movement<br>3 layers for the scenery (ground level, leg level, above level) (walk behind a tree to see this)<br>animated tiles (check out the water to see this)<br>collision detection (walk into a tree, bush or rock to see this)<br>can be controlled by cursor keys.<br><br>note i cant draw so i grabbed some scenery gfx and the character gfx from the internet (was so long ago cant remeber where i got them, so i take no credit at all for the gfx!)<br><br>please grab the zip file extract and compile and check it out, i would be interested to hear what some more experienced coders could do better or ways to optimise etc<br><br>note there is no delta timing etc in this example its just the bare bones for my scrolling tile engine, everything not essential was stripped out (well except for the ability to scroll around of course)<br><br>thanx! <br><br></td></tr></table><br>
<a name="651073"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sir Gak</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> One way to speed up your drawing, is to use the LockBuffer and Unlockbuffer commands, just before and after your image drawing loops.  Here is an example I made.  Commenting out the commands the first time through, I measured around 2476 milliseconds.  Putting in the lock commands, I measured about 385 millseconds.<br><pre class=code>
Graphics 800,600

tile=CreateImage (32,32)
SetBuffer ImageBuffer(tile)

Rect 0,0,32,32,True
SetBuffer BackBuffer()

start=MilliSecs()
LockBuffer BackBuffer()
For loop=0 To 100000
	DrawImage tile,100,100
	Flip False
Next
UnlockBuffer BackBuffer()

SetBuffer FrontBuffer()
Print MilliSecs()-start
MouseWait()
End
</pre><br>So, if you want a significant speed boost, try the lock/unlock buffer commands.  Cheers!<br><br>(Oh, BTW, the hero looks very much like the McDohl character from Suikoden I.) <br><br></td></tr></table><br>
<a name="651163"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Buggy</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Does this lockbuffer thing work for RenderWorld too? <br><br></td></tr></table><br>
<a name="651196"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sir Gak: Using commands like DrawImage on locked buffers is not recommended. It may work on your machine but there's a chance it could cause other machines to crash. From the docs:<br><div class="quote"> <br>After you use LockBuffer on a buffer, the only graphics commands you can use are the read/write pixel commands ReadPixel, WritePixel, ReadPixelFast, WritePixelFast, CopyPixelFast, and CopyPixel. You must UnlockBuffer before using other graphics commands or API calls, and you are advised to only keep the buffer locked for as long as it is needed. <br> <br></div> <br><br></td></tr></table><br>
<a name="651240"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >puredave</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmmm, sounds like it may be a bit iffy to do that Sir Gak, so i think i will avoid it, thanx for the info tho!<br><br>Wouldnt be suprised about that hero graphic, i went to an anime gfx site that had alot of character animations, they prolly ripped all of them from old games :)<br><br>So anybody else got some tips on better ways of handling the tile engine? or at least some comments on the way i have done mine?<br><br>thanx <br><br></td></tr></table><br>
<a name="651368"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I had a quick look at your code, Dave. The way you're doing things seems fine to me - it works well. I noticed you're setting all your type fields/arrays to zero at the start of the code. This isn't strictly necessary as blitz does this automatically. I also think you can make your north,south,east,west variables constants. <br><br></td></tr></table><br>
<a name="651425"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sir Gak</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> big10p: You are correct in that the command documentation says that, but I have never run into a crash or other problem using Lockbuffer with DrawImage.  DrawImage is, after all, a command that changes pixels, just in a group instead of singly.<br><br>Has anyone else ever tried the LockBuffer/UnlockBuffer with DrawImage/DrawBlock and experienced any problems? <br><br></td></tr></table><br>
<a name="651476"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Drawimage doesn't work on this computer when drawing to a locked buffer with anything other than writepixel/fast. Doesn't work on a good few computers i've tried. <br><br></td></tr></table><br>
<a name="651504"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sir Gak</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Guess what.  I tried it on my PC at work.  Doesn't work either.  Oh, well, just goes to show you that you can think you're right, and still be very wrong.  The docs were correct after all. <br><br></td></tr></table><br>
<a name="651517"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Andy</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> &gt;So anybody else got some tips on better ways of handling <br>&gt;the tile engine? or at least some comments on the way i <br>&gt;have done mine?<br><br>When I bought B2D, I only had a 200 Mhz Pentium. This meant that I couldn't draw layers upon layers of tiles, without dropping frames left and right.<br><br>So after some experimentation, I developed the following technique.<br><br>-create a buffer which is larger than your screen in both axii(let's say 12x10 tiles, but atleast the screenres + one extra tile in every direction). Do all of the background drawing on this buffer. before the game begins, draw all tiles from the camera viewpoint on the buffer.<br><br>when the game is running and the cameraview reaches the last tile in a direction(let's say you are moving upwards), you copyrect the upper 12x9 rows of data to the lower 12x9 rows, and draw the upper row of tiles. Then you just copyrect to backbuffer and add trees etc. before starting over.<br><br>This means that instead of drawing 20x15 tiles plus objects(trees etc.), you make at most two copyrects plus draw 20 tiles.<br><br>I also limited the system to only draw in one direction at a time, ie. if the player moved up and to the right, and by chance you need to refresh both down and left, the system would go down,render,go left, render.<br><br>I also used a technique where I masked the characters, using a buffer, so that they were drawn on top of, but appeared to be behind a tree or a car etc., which meant that everything was drawn on the buffer and then copyrected to the screen. This saved bundles of time on my P200.<br><br>Something to think about. If the tile and object images can reside in memory, then use tilefiles to describe each tile. Use a flat fileformat including data like this...<br><br>filename 2334.dat<br><br>tilenumber of tile to the north; 4399<br>tilenumber of tile to the south; 1499<br>tilenumber of tile to the east;  9999<br>tilenumber of tile to the west;  6577<br><br>Tile background; 244<br>object foreground; 15<br><br><br>This mean that you can make a world as large as the media the game resides on... ie. hundreds of megabytes or gigabytes if you need it. And these files can be loaded on the fly, one byte at a time, meaning that the player will never have to worry about loading times.<br><br>You can see how to emulate threading here:<br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=1531" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=1531</a><br><br>I am not saying that your demo is slow, but if you can draw more tiles, you can build a richer and more diverse environment for your player. Possibly even one where noone would have guessed it a tileengine which is behind it all.<br><br>Andy <br><br></td></tr></table><br>
<a name="651919"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sir Gak</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nice tips, Andy.  Thanks!  When I checked out the link, then loader took about a minute.  At that point, after waiting so (relatively) long, I half expected to see gorgeous graphics, stunning landscapes and lifelike animations.  Whew! <br><br></td></tr></table><br>
<a name="651959"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Andy</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> &gt;Nice tips, Andy. Thanks!<br><br>You're welcome!<br><br>&gt;When I checked out the link, then loader took about a <br>&gt;minute. At that point, after waiting so (relatively) long, <br>&gt;I half expected to see gorgeous graphics, stunning <br>&gt;landscapes and lifelike animations. Whew! <br><br>Well, for 15 minutes of work, it's not bad.<br><br>The point of course, is that emulating threading will lead to slower loading, but that must be put up against the game completely halting and displaying a load screen.<br><br>I hate load screens, and I have yet to encounter a situation where I couldn't load the data fast enough to create the scenario on the fly. <br><br>Andy <br><br></td></tr></table><br>
<a name="653342"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >puredave</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanx Andy! I will see if i can implement that method :) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
