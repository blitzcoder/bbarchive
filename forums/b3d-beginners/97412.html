<!DOCTYPE html><html lang="en" ><head ><title >A dll to know when there is a beat in a music ?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >A dll to know when there is a beat in a music ?</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=5" >Blitz3D Beginners Area</a>/<a href="#bottom" >A dll to know when there is a beat in a music ?</a><br><br>
<a name="1131787"></a>

<a name="1131788"></a>

<a name="1131789"></a>

<a name="1131790"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi, :)<br><br>For one of my games, there is a strobe light, and i want the strobe light to be shown or to be hidden depending on the kind of sound emitted by the sound card.<br>Basically i want to show the light when there is a beat and hide it otherwise.<br><br>What i plan to do is to code a routine that analyzes the sounds of a music and that stores in an array the time (millisecs) when there is a beat so that the program doesn't have to analyze the sounds in realtime but know when the beats happen.<br><br>Do you know if there is a dll or software able to analyze the sounds of a music and to track when there is a beat ?<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1131826"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Adam Novagen</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Look for "BlitzBass Studio" in the toolbox here on this site. BBS does require a license to use, though, for commercial projects, so be aware of this. <br><br></td></tr></table><br>
<a name="1131850"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the suggestion Adam, i will take a look at Blitz Bass Studio.<br><br>Do you think it is possible to analyze a sound with the windows functions ? <br><br></td></tr></table><br>
<a name="1132386"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey RemCoder,<br><br>I'm really not sure anything exists currently to do what you're asking for - I was looking for something similar myself.<br><br>I'm sure there must be a solution around, since there's a few (non-Blitz I should mention) programs that analyse sounds in such a way. However, I've never come across anything that was readily avbailable/usable by Blitz :(<br><br>As for Windows, well, even the simpple Windows Sound Recoreder (SndRec.exe) can analyse a simple waveform of a sound, but whether this is an accessable feature,. or just a bult-in part of the recorder, I don't know...<br><br>In the end, I decided to abandon the search and try to code something myself. It's a difficult process, and, I've not gotten anything finished yet - Thoiough I have a plan of action, which may be of help?<br><br>Basically, I need to go through the following steps. Personally, I'm starting with MP3 files but they are really complicated, so I would recommend maybe starting with something like an uncompressed WAV file if possible.<br><br>1) Determine which file type (encoder used) you will work with. Since the format of the code within each will vary greatly depending on this type.<br><br>2) Look up around the web (wikipedia is actually pretty handy for this) to obtain the HEADER aqnd file-structure details for that particular type. You will need this information to be able to decode the actual data in the file<br><br>3) From the Header and structure code, you should hopefully have aqn idea of the following aspect of the particular file:<br> a) SampleRate (Sound Resolution)<br> b) BitRate (Data Resolution)<br> c) Duration<br> d) Channels (Mono/Stereo)<br> e) Depth (8-bit, 16-bit etc.) <br><br>4) There's no way to 'analyse' the particular sound without the above values. some encoding formats may vary the bitrate too (mp3 for example) meaning you need to locate the bitrate for each 'Audio Frame'...<br><br>In theory, once you have these values, you should then be able to take the block of code that represents the sound itself, and identify the sequences of bytes that make it up.<br>Beware here, some formats use a Little-Endian and others may use Big-Endian words for groups of bytes. This means that if, say, the sound is 16-Bit depth, then it refers to a short integer, or 2 x 8-bit bytes which can represent a value from 0-65535<br><br>LittleEndian will mean the first byte will represent (0 to 255) and the second byte will represent ((0 to 255)*256) <br>The LEAST Important Byte is the First Byte.<br><br>LittleEndian will mean the first byte will represent ((0 to 255)*256)  and the second byte will represent (0 to 255)<br>The MOST Important Byte is the First Byte.<br> <br>5.) Check on Wikipedia or somewhere again, and you should be able to ascertain the format of the byte structure.<br><br>It may be that any stereo channels are processed 'simultaneously', i.e.:<br><br>BYTE1: 1st Byte LEFT CHANNEL<br>BYTE2: 2nd Byte LEFT CHANNEL<br>BYTE3: 1st Byte RIGHT CHANNEL<br>BYTE4: 2nd Byte RIGHT CHANNEL<br><br>or, a more confusing structure such as:<br><br>BYTE1: 1st Byte LEFT CHANNEL<br>BYTE2: 1st Byte RIGHT CHANNEL<br>BYTE3: 2nd Byte LEFT CHANNEL<br>BYTE4: 2nd Byte RIGHT CHANNEL<br><br>Either way, you'll probably want to extract the bytes into an array or Type that can separate the LEft channel from Right channel bytes in the correct order.<br><br>6.) Next is to deal with the bitrate and sample rate.<br>The bitrate is generally the 'speed' of the data when converted into sound. If the bitrate is, say, 128kbps (kilo-BITS per second) then around 131072 bits make one second. That's 16384 8-bit bytes or, if the depth is 16-bits like the example above, then it's 8192 short-integer 16-bit-bytes.<br><br>7) Now we know how much data there is per second, we need to know how much of that data is used to represent the amplitude of the sound at what frequency.<br><br>The Sample rate is suually written as 44.1 or 22.050 etc. this is in kHz. Meaning 44.1 (which is typical sampling rate for CDs)  per second. This frequency is the actual range of frequencies that can be represented by the data.<br><br>8) So wat does it mean for our 16384 Bytes to represent 441 00 different  frequencies?<br>Well, instead of looking at the whole 'one second' for a moment, let's consider the smallest amount of data we can : Since we're using 16-bit bytes for this example, our smallest data 'block' is 2 8-bit-bytes. 16 bits in total.<br>This single 2-byte-short-integer can store any value from 0 to 65535. There are way more than 44100 values!<br>(Actually, some bits of each byte may be used for other purposes - again, check wikipoedia or similar for details!)<br><br>9) We should now be able to convert each byte into a value representing the proportionate frequency. Once we have done this for every group of 8192 bytes (or 16384 perhaps for stereo) then we have groups of sound frequencies for each second!<br><br>10) At this point, the dataq may best be viewed or analysed by plotting it on a graph, or some other means of identifying particularly low-frequency sounds (i.e. representing a bass drum beat for instance) <br><br>11) You could then ;calculate the tempo according to the repetition of patterns discovered in the sounds by the time intervals at which they occur.<br><br>PHEW!<br>So you can see, it's quite a big task - You can understand why I'm stiulll not finished with trying to get it going myself - though I am not about to give up any time soon!<br><br>If you have enough patience to wait for me - which could be months to be honest - then I have no problem sharing the code - otherwise, this is the best I can offer right now. <br><br></td></tr></table><br>
<a name="1132580"></a>

<a name="1132581"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi _PJ_, :)<br><br>Interesting but it seems to be really complicated and time consuming to do.<br><br><br><br>I have found another possible way to track the beats in a music :<br>To track the millisecs when playing the music and to press a key manually when a beat occurs.<br>The program creates a file in realtime where for each millisec, either a normal state or a beat state is saved.<br><br>Then when playing the sound during the game, the program reads the file to know when there is a beat or not.<br><br>I know this is not a programmer way, but for a game it only need to be perceived as a good effect not a perfect effect.<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1132587"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Couldn't you monitor the sound, and detect any sharp volume increases? <br><br></td></tr></table><br>
<a name="1132716"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm glad you have an easy way that works, RemCoder.<br><br>Ross, even though it would be a whole lot simpler than the method mentioned above (which I must admit was based mainly on the ability to identify the complete waveform of the entire sound rather than JUST the beats) - 'Monitoring'  the sound would still need some kinda DLL or ability to read the sound as it's playing - something which seems to be sorely absent from anything I've seen so far regarding Blitz!<br><br>It's good to see that there's some workarounds and such for dealiong with more "esoteric" sound functionality within B3D though :) <br><br></td></tr></table><br>
<a name="1132772"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> True! Stupid suggestion really, if there's no blitz way of doing it. <br><br></td></tr></table><br>
<a name="1132773"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ross&gt;&gt; You give me an idea, thanks :) :<br><br>Maybe i can use a strobe light when playing the music in a pitch black room and record a video of the wall of the room.<br><br>With this i will have two kinds of images, either a black image or a bright image.<br>Then i can analyse each  image of the video to determine when there is a beat or not.<br>By analyzing only a few pixels of each image, it should be fast enough to analyze all the frames.<br><br>The limitation is that i have a camera which can only records at 30fps so i don't know if it will be really precise. 30fps &lt;&gt; 1000 millisecs !<br><br><br><br>Oh this gives me another idea !<br>Maybe i can use a usb port to receive a signal from the strobe light and to record it depending on the millisecs passed. (easy to say, but i don't really have the electronic skills, maybe i can outsource this task) <br><br></td></tr></table><br>
<a name="1318525"></a>

<a name="1318526"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Any new way to achieve this ?<br><br>I suppose that the best way would be to analyze the file... But how ?<br><br>Also is there a way to detect the "volume" of the low pitch melody and of the high pitch melody ?<br><br>Thanks, <br><br></td></tr></table><br>
<a name="1318601"></a>

<a name="1318602"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Charrua</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>I suppose that the best way would be to analyze the file... But how ?<br> <br></div><br><br>if you have the raw audio data you may try some "low pass filter algorithm" play somewhat with the smooth factor.<br><br>i did a small search an find this article, i do not read it, simply the image on it is very clear about the results of a low pass filter on audio data.<br><br><a href="https://kiritchatterjee.wordpress.com/2014/11/10/a-simple-digital-low-pass-filter-in-c/" target="_blank">https://kiritchatterjee.wordpress.com/2014/11/10/a-simple-digital-low-pass-filter-in-c/</a><br><br><br>low pass filters may range from simple averaging samples to more complicated algos (look for kalman filter for example)<br><br><a href="https://en.wikipedia.org/wiki/Kalman_filter" target="_blank">https://en.wikipedia.org/wiki/Kalman_filter</a><br><br>[edit]<br>lookin forward... perhaps this software is usabel for you<br><br><a href="http://vamp-plugins.org/sonic-annotator/" target="_blank">http://vamp-plugins.org/sonic-annotator/</a><br><br><a href="https://code.soundsoftware.ac.uk/projects/sonic-annotator/wiki" target="_blank">https://code.soundsoftware.ac.uk/projects/sonic-annotator/wiki</a><br><br>don't know how hard/help it be!<br>[/edit] <br><br></td></tr></table><br>
<a name="1318615"></a>

<a name="1318616"></a>

<a name="1318617"></a>

<a name="1318626"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Charrua&gt;&gt;Thanks for the links, but a little too complicated for me.<br><br><br>I have found this : <a href="https://www.youtube.com/watch?v=jZoQ1S73Bac" target="_blank">https://www.youtube.com/watch?v=jZoQ1S73Bac</a><br><br><br>and also i may have found a way to detect the beats in a music track by using a combination of a windows media player visualization plugin + an audio/video capture software + a custom procedure in Blitz3d. Not tried but i think it can work. The idea is to detect when there is a beat by capturing a small area of the visualization effects (vertical bars) and if the color is black there is no beat, and if the color is green, there is a beat.<br>An ugly macgyver workaround i have to admit :P <br><br></td></tr></table><br>
<a name="1318618"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flanker</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Some time ago I tried to draw the wave audio from a .wav file with B3D, it worked but I didn't manage to sync it with the audio. I may give it a try with MP3. <br><br></td></tr></table><br>
<a name="1318619"></a>

<a name="1318620"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> With the method i describe, there should be no synchronization problem...<br>But there may be a synchronization problem when the fps drops too low compared to the music which is playing, so my idea is to have a variable for each 100ms step to know if it corresponds to a beat or not.<br>But i am not sure if Blitz3d has a function to get the current time of a music/sound in milliseconds... <br><br></td></tr></table><br>
<a name="1318622"></a>

<a name="1318623"></a>

<a name="1318624"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bobysait</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> using bass.dll you should be able to analyze the spectrum.<br>if you just check the low frequency, you'll get what you need.<br>It's not a hard task and has been used for tons of spectrum vizualizer.<br>I really think you can get it working easily<br><br><div class="quote"> <br>But i am not sure if Blitz3d has a function to get the current time of a music/sound in milliseconds... <br> <br></div><br>There is nothing that can do that with the natives blitz commands. But all you need to do is start a timer when you start the music. Then just check the current time (MilliSecs()) and substract to the start time. You'll get the current track time. <br><br></td></tr></table><br>
<a name="1318625"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>But all you need to do is start a timer when you start the music. Then just check the current time (MilliSecs()) and substract to the start time. You'll get the current track time. <br> <br></div><br>good idea, thanks.<br><br><br>I will take a look at the bass.dll, second time it is mentioned to help me with that. <br><br></td></tr></table><br>
<a name="1318635"></a>

<a name="1318636"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flanker</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here's something to access samples value from a .wav file : <a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=3287" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=3287</a><br>Only works with 16bits stereo PCM .wav for the moment. <br><br></td></tr></table><br>
<a name="1321443"></a>

<a name="1321444"></a>

<a name="1321445"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> finally, i have chosen another weak but good enough approach :<br>i have coded a system where i can play the music and track the mstime and i can press/hold/release some keys depending on the different kinds of sounds played in a music (beat, clap, bass, melody, voice) and depending on my input this will store these input states in arrays (using the mstime), and then when i play the music, i can use access these input states (using the mstime) to trigger specific graphics effects associated to the specific sounds played...<br>the advantage is that i can have different graphics effects triggered depending on different kinds of sounds (not only beats)<br>macgyver style, i know :P <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
