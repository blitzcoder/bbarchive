<!DOCTYPE html><html lang="en" ><head ><title >Speed Question</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Speed Question</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=5" >Blitz3D Beginners Area</a>/<a href="#bottom" >Speed Question</a><br><br>
<a name="434932"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gauge</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Say you 500 examples of player, is there any faster way to do this?<br><br>time1=millisecs()<br>For p.player=each player<br>For px.player=each player<br>writeline p\stream, px\x#+","+px\y#+","+px\z#+","+px\rot#<br>next<br>next<br>time2=millisecs()<br>time#-time2-time1<br><br><br>I get anywehre between 700 and 1200 for my time#<br><br>Will while be faster then two for next or two whiles, or? any suggestions? Or perhaps i can cut it down to one long line?  Thanks for any input. <br><br></td></tr></table><br>
<a name="434954"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >WolRon</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Perhaps if you changed this line:<pre class=code>writeline p\stream, px\x#+","+px\y#+","+px\z#+","+px\rot#</pre>into a line that writes a static string (as opposed to a dynamically concatenated one), it may improve the speed.  Something like:<pre class=code>Dim coords$(500)
num = 0
For px.player = Each player
  coords$(num) =  px\x#+","+px\y#+","+px\z#+","+px\rot#
  num = num + 1
Next
total = num

time1 = Millisecs()
For p.player = Each player
  For num = 0 to total
    WriteLine p\stream, coords$(num)
  Next
Next 
time2 = Millisecs() 
time# = time2 - time1 
</pre> <br><br></td></tr></table><br>
<a name="435140"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Floyd</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> No matter how the strings are handled that's still a quarter of a million lines of text.<br><br>Was this really the intention? I would have expected something like<pre class=code>For p.player = Each player 
	WriteLine p\stream, p\x#+","+p\y#+","+p\z#+","+p\rot# 
Next</pre><br>which writes each player's data once, to the stream indicated in p\stream. <br><br></td></tr></table><br>
<a name="435155"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gauge</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the input guys.  I think i'm gonna try making one giant line/string.  I'll have to see how slow it is though.  <br><br>p.s. Floyd, its for multiplaer, so it has to write each player to each player. <br><br></td></tr></table><br>
<a name="435412"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >NewtSoup</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> That looks like server code to me. And it is sending the position of every player to all the players , your fragment on its own, Floyd, would only send the update to one client. Whats more all your code is doing is sending the data of one client to itself.<br><br>perhaps sending a singler bigger packet to each player might be more efficient? IE compile the currrent position update into a single packet. Assuming a float is 8 bytes thats 500*8*4 = 16k of data minimum to send to each client on position alone assuming there are 500 clients (which is a lot and do they REALLY all need to know everyone elses position?)<br><br>Also I would use writeFloat() to the stream rather than cating a string together as a string of "2.1242455236" (12 bytes) takes longer to send than writeFloat(2.124245523) because the Float takes up fewer bytes, 4 or 8 I can't remember what blitz uses for floating point math.<br><br>anyway what you are trying to do is send 500*500*8*4 = 7.8Mb (or 61Mbit) of data each program cycle. (update 500 positions to 500 clients each with 4 variables at 8 bytes each.)<br>Seeing as you say this is a multiplayer game with a max of (I hope :P ) 500 players I am guessing this is for internet play (unless you are having a truly massive lan party). Even with a 100mb leased line this is going to take at least 620ms to send so you really really need to think about the following things:<br><br>Reduce the data as much as possible IE reduce the precision of your floats to what is actually needed perhaps ints will do that will halve the data size for each player.<br><br>Reduce Max_Players (works every time that one.. I find with max_players = 1 the data goes so fast, kind of boring tho)<br><br>I think then compile a single large packet to send. Then compress the packet. (look at huffman encoding/binary space partitioning) and then send the compressed packet down the stream, probably have to do it in writebytes() with a header containing the length of the data you are about to send so that the client knows when to stop reading. (thats kind of gnarly but it will work most of the time) <br><br></td></tr></table><br>
<a name="435415"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >NewtSoup</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> That probably sounds like a lot of pre-processing but I promise you your machine can crunch the numbers faster than it can read/write them off the net. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
