<!DOCTYPE html><html lang="en" ><head ><title >“Function can only appear in the main loop. " Ques</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >“Function can only appear in the main loop. " Ques</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=5" >Blitz3D Beginners Area</a>/<a href="#bottom" >“Function can only appear in the main loop. " Ques</a><br><br>
<a name="1077055"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Galdy</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I’m having a problem where i get the error “Function can only appear in the main loop. "<br>I suppose it is kind of self explanatory, but I was wondering... <br> <br>During the Main loop one of the mouse checks will gosub to the label “.SavePoject” which has <br>it’s own small loop for checking mouse clicks in the file operations GUI. However, I can’t call <br>any functions from it as a result.   So, can the secondary loop go inside the main loop and be able to call functions? <br><br></td></tr></table><br>
<a name="1077057"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> ??<br><br>That's really weird. Blitz3D isn't supposed to have any concept of a main loop - it's a common game-design idiom but there's inbuilt requirement for it (heck, how would it even recognise it?).<br><br>Can you post some code that generates that error? <br><br></td></tr></table><br>
<a name="1077081"></a>

<a name="1077082"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Galdy</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I assume by loop it is talking about the while-wend loop that i'm using.<br>Din't you typicaly set up a main loop that cycles?<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1077086"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Din't you typicaly set up a main loop that cycles? <br></div><br><br>Yes but there are plenty of other ways to design a program (not all programs are games, not all programs have just one event loop, not all loops are While/Wend), so this is an odd restriction for a compiler to make, and in any case the compiler has no way to identify which part that main loop would be.<br><br>At a guess I would say look to your use of Gosub ... but really that's just a guess without seeing a code snippet. <br><br></td></tr></table><br>
<a name="1077103"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Galdy</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Everything was functioning fine until i added the "The File Operations section" section of code about half way down. <br>    I tried a small snippet of code to simulate what my larger code was trying to do and it worked so i'm not sure what i'm doing wrong to get the "Function can only appear in the main loop" error. It points to the "Function SaveFile()" at the bottom when it does.<br><br><br><br><br><br>;While for the main Loop<br>While Not KeyDown(1)<br><br>If MouseX()&gt;20 And MouseX()&lt;980 And MouseY()&gt;20 And MouseY()&lt;980 And Tool=7 Then ;Keeps the delete curser drawn where the mouse pointer is.<br>DrawMap()  <br>EndIf<br><br><br>;***********************************************************************************<br>;This section produces tool tip floaters  <br>;***********************************************************************************<br><br>;Save-------------------------------------------------------------------------------------<br>If MouseX()&gt;1013 And MouseX()&lt;1044 And MouseY()&gt;823 And MouseY()&lt;854 And HoverStatus&lt;&gt;1  Then<br>HoverStatus=1<br>DrawMap()<br>EndIf<br>If MouseX()&lt;1014 Or MouseX()&gt;1043 Or MouseY()&lt;824 Or MouseY()&gt;853 And HoverStatus=1  Then<br>HoverStatus=0<br>DrawMap()<br>EndIf<br><br>;NewProject--------------------------------------------------------------------------------<br>If MouseX()&gt;1054 And MouseX()&lt;1085 And MouseY()&gt;823 And MouseY()&lt;854 And HoverStatus=0 Then<br>HoverStatus=2<br>DrawMap()<br>EndIf<br>If MouseX()&lt;1055 Or MouseX()&gt;1084 Or MouseY()&lt;824 Or MouseY()&gt;853 And HoverStatus=2 Then<br>HoverStatus=0<br>DrawMap()<br>EndIf<br><br>;Delete----------------------------------------<br>If MouseX()&gt;999 And MouseX()&lt;1030 And MouseY()&gt;771 And MouseY()&lt;791 And HoverStatus=0 Then<br>HoverStatus=3<br>DrawMap()<br>EndIf<br>If MouseX()&lt;100 Or MouseX()&gt;1029 Or MouseY()&lt;772 Or MouseY()&gt;790 And HoverStatus=3 Then<br>HoverStatus=0<br>DrawMap()<br>EndIf<br><br>;*****************************************************************************************************<br>;Selects and assigns a number to the "Tool" variable.   <br>;*****************************************************************************************************<br>.CheckMenu   <br> If MouseDown(1)=0 Then <br> ClickStatus=0<br> EndIf<br><br> If MouseDown(1)=1 And ClickStatus=0 And MouseX()&gt;1074 And MouseX()&lt;1095 And MouseY()&gt;96 And MouseY()&lt;117 Then<br> Tool=1 ;Wall<br> ClickStatus=1<br> PlaySound Click<br> DrawMap()<br> EndIf<br> If MouseDown(1)=1 And ClickStatus=0 And MouseX()&gt;1074 And MouseX()&lt;1095 And MouseY()&gt;159 And MouseY()&lt;178 Then<br> Tool=2 ;Door Unlocked<br> ClickStatus=1<br> PlaySound Click<br> DrawMap()<br> EndIf<br> If MouseDown(1)=1 And ClickStatus=0 And MouseX()&gt;1074 And MouseX()&lt;1095 And MouseY()&gt;223 And MouseY()&lt;244 Then<br> Tool=3 ;Door Locked<br> ClickStatus=1<br> PlaySound Click<br> DrawMap()<br> EndIf<br> If MouseDown(1)=1 And ClickStatus=0 And MouseX()&gt;1074 And MouseX()&lt;1095 And MouseY()&gt;287 And MouseY()&lt;308 Then<br> Tool=4 ;Special<br> ClickStatus=1<br> PlaySound Click<br> DrawMap()<br> EndIf<br> If MouseDown(1)=1 And ClickStatus=0 And MouseX()&gt;1067 And MouseX()&lt;1107 And MouseY()&gt;340 And MouseY()&lt;381 Then<br> Tool=5 ;NPC<br> ClickStatus=1<br> PlaySound Click <br> DrawMap()<br> EndIf<br> If MouseDown(1)=1 And ClickStatus=0 And MouseX()&gt;1067 And MouseX()&lt;1107 And MouseY()&gt;407 And MouseY()&lt;448 Then<br> Tool=6 ;Chest<br> ClickStatus=1<br> PlaySound Click<br> DrawMap()<br> EndIf<br> If MouseDown(1)=1 And ClickStatus=0 And MouseX()&gt;999 And MouseX()&lt;1030 And MouseY()&gt;771 And MouseY()&lt;791 Then<br> Tool=7 ;Delete---Don't need to gosub to DrawMap at this point since we don't need a check mark<br> ClickStatus=1<br> PlaySound Click<br> EndIf<br> If MouseDown(1)=1 And ClickStatus=0 And MouseX()&gt;1013 And MouseX()&lt;1044 And MouseY()&gt;823 And MouseY()&lt;854 Then<br> Tool=8<br> ClickStatus=1<br> PlaySound Click<br> Gosub SaveProject<br> EndIf<br> <br><br><br><br><br>;*********************************************************************************************************<br>;Checks work area (the grid) of the screen for activity.<br>;*********************************************************************************************************<br><br>.CheckWorkArea<br> If MouseDown(1)=0 Then <br>  ClickStatus=0 <br> EndIf<br><br> If MouseDown(1)=1 And ClickStatus=0 And MouseX()&gt;20 And MouseX()&lt;980 And MouseY()&gt;20 And MouseY()&lt;980 Then <br>  Select Tool<br>   Case 1<br>   GetCoordinates()<br>   RecordData()<br>   DrawMap()<br>   Case 2<br>   GetCoordinates()<br>   RecordData()<br>   DrawMap()<br>   Case 3<br>   GetCoordinates()<br>   RecordData()<br>   DrawMap()<br>   Case 4<br>   GetCoordinates()<br>   RecordData()<br>   DrawMap()<br>   Case 5<br>   GetCoordinates()<br>   RecordData()<br>   DrawMap()<br>   Case 6<br>   GetCoordinates()<br>   RecordData()<br>   DrawMap()<br>   Case 7<br>   GetCoordinates()<br>   RecordData()<br>   DrawMap()<br><br> End Select<br>EndIf<br> <br><br>Wend ;Wend for the main Loop<br>End<br><br><br><br><br><br>;****************************************************************************************************<br>;After it is determined that the work area (grid) was clicked on with the mouse via ".CheckWorkArea," <br>;the following Function call determines what element of the array LevelOne(50,50,2) was clicked on. <br>;**************************************************************************************************** <br><br>Function GetCoordinates()<br> CurrentMouseX#=Float#(MouseX())/20<br> CurrentMouseY#=Float#(MouseY())/20<br> CurrentMouseX=Ceil#(CurrentMouseX)<br> CurrentMouseY=Ceil#(CurrentMouseY)<br>End Function  <br><br>;****************************************************************************************************<br>;The following Function determines if and what element is written into the array LevelOne(50,50,2). <br>;**************************************************************************************************** <br><br>Function RecordData()<br> If Tool=1 Then<br> LevelOne(CurrentMouseX,CurrentMouseY,1)=1<br> EndIf<br> ;---------------------------------------------------------------------------------------<br> If CurrentMouseX-1&gt;0 And CurrentMouseY-1&gt;0 And CurrentMouseX+1&lt;51 And CurrentMouseY+1&lt;51 Then<br> If Tool=2 And LevelOne(CurrentMouseX,CurrentMouseY,1)&gt;0 Or LevelOne(CurrentMouseX+1,CurrentMouseY,1)=1 And LevelOne(CurrentMouseX-1,CurrentMouseY,1)=1 And LevelOne(CurrentMouseX,CurrentMouseY+1,1)=1 And LevelOne(CurrentMouseX,CurrentMouseY-1,1)=1 Then<br> ;Nothing is Written to the array<br> ElseIf Tool=2 And LevelOne(CurrentMouseX+1,CurrentMouseY,1)=1 And LevelOne(CurrentMouseX-1,CurrentMouseY,1)=1 And LevelOne(CurrentMouseX,CurrentMouseY+1,1)&lt;&gt;1 And LevelOne(CurrentMouseX,CurrentMouseY-1,1)&lt;&gt;1 Then<br> LevelOne(CurrentMouseX,CurrentMouseY,1)=2   ;Writes a east/west unlocked door to the array<br> LevelOne(CurrentMouseX,CurrentMouseY,2)=0   ;Door is unlocked<br> ElseIf Tool=2 And LevelOne(CurrentMouseX,CurrentMouseY+1,1)=1 And LevelOne(CurrentMouseX,CurrentMouseY-1,1)=1 And LevelOne(CurrentMouseX+1,CurrentMouseY,1)&lt;&gt;1 And LevelOne(CurrentMouseX-1,CurrentMouseY,1)&lt;&gt;1 Then<br> LevelOne(CurrentMouseX,CurrentMouseY,1)=3   ;Writes a North/South door to the array<br> LevelOne(CurrentMouseX,CurrentMouseY,2)=0   ;Door is unlocked<br> EndIf<br> EndIf<br> ;_____________________________________________________________________________________<br> If CurrentMouseX-1&gt;0 And CurrentMouseY-1&gt;0 And CurrentMouseX+1&lt;51 And CurrentMouseY+1&lt;51 Then<br> If Tool=3 And LevelOne(CurrentMouseX,CurrentMouseY,1)&gt;0 Or LevelOne(CurrentMouseX+1,CurrentMouseY,1)=1 And LevelOne(CurrentMouseX-1,CurrentMouseY,1)=1 And LevelOne(CurrentMouseX,CurrentMouseY+1,1)=1 And LevelOne(CurrentMouseX,CurrentMouseY-1,1)=1 Then<br> ;Nothing is Written to the array<br> ElseIf Tool=3 And LevelOne(CurrentMouseX+1,CurrentMouseY,1)=1 And LevelOne(CurrentMouseX-1,CurrentMouseY,1)=1 And LevelOne(CurrentMouseX,CurrentMouseY+1,1)&lt;&gt;1 And LevelOne(CurrentMouseX,CurrentMouseY-1,1)&lt;&gt;1 Then<br> LevelOne(CurrentMouseX,CurrentMouseY,1)=2 ;Writes a east/west door to the array<br> LevelOne(CurrentMouseX,CurrentMouseY,2)=1; Writes that the door is locked (1)<br> ElseIf Tool=3 And LevelOne(CurrentMouseX,CurrentMouseY+1,1)=1 And LevelOne(CurrentMouseX,CurrentMouseY-1,1)=1 And LevelOne(CurrentMouseX+1,CurrentMouseY,1)&lt;&gt;1 And LevelOne(CurrentMouseX-1,CurrentMouseY,1)&lt;&gt;1 Then<br> LevelOne(CurrentMouseX,CurrentMouseY,1)=3;Writes a North/South door to the array<br> LevelOne(CurrentMouseX,CurrentMouseY,2)=1; Writes that the door is locked (1)<br> EndIf<br> EndIf<br><br>;Erases the array location<br> If Tool=7 Then <br> LevelOne(CurrentMouseX,CurrentMouseY,1)=0 <br> LevelOne(CurrentMouseX,CurrentMouseY,2)=0<br> EndIf<br>End Function<br><br><br><br><br><br>;*********************************************************************<br>;DrawMap Draws everything in the correct z order.<br>;*********************************************************************<br><br>Function DrawMap()<br> ;Draws User interface and grid<br> SetBuffer BackBuffer()<br> DrawImage GUI,0,0<br> Color 192,192,192<br> a=0:x=0:y=0<br> For a=1 To 51<br> Line 0,y,1000,y <br> y=y+20<br> Line x,0,x,1000<br> x=x+20<br> Next<br><br><br><br> ;Draws CheckMarks by Menu selections<br> If Tool=1 Then <br> DrawImage CheckMark,1017,76<br> EndIf<br> If Tool=2 Then <br> DrawImage CheckMark,1017,138<br> EndIf<br> If Tool=3 Then <br> DrawImage CheckMark,1017,200<br> EndIf<br> If Tool=4 Then <br> DrawImage CheckMark,1017,266<br> EndIf<br> If Tool=5 Then <br> DrawImage CheckMark,1017,330<br> EndIf<br> If Tool=6 Then <br> DrawImage CheckMark,1017,398<br> EndIf<br><br> ;Draws the floating Toll tips<br> If MouseX()&gt;1013 And MouseX()&lt;1044 And MouseY()&gt;823 And MouseY()&lt;854 And HoverStatus=1 Then<br> DrawImage Save,1007,805   <br> EndIf<br> If MouseX()&gt;1054 And MouseX()&lt;1085 And MouseY()&gt;823 And MouseY()&lt;854 And HoverStatus=2 Then<br> DrawImage NewProject,1034,805<br> EndIf<br> If MouseX()&gt;999 And MouseX()&lt;1030 And MouseY()&gt;771 And MouseY()&lt;791 And HoverStatus=3 Then<br> DrawImage Delete1,1008,753<br> EndIf<br><br><br><br> ;Translates the values in the array LevelOne(50,50,2) into graphic elements,i.e., Walls,doors, etc. <br> a=0:x=0:y=0:b=0:<br> For yy=1 To 50 ;y coordinates loop<br>  For xx=1 To 50 ;x coordinates loop<br>    If LevelOne(xx,yy,1)=1 Then<br>     DrawImage Wall,x,y<br>      EndIf <br>      ;East-West doors<br>       If LevelOne(xx,yy,1)=2 And LevelOne(xx,yy,2)=0 Then<br>         DrawImage DoorEW,x,y<br>         EndIf<br>          If LevelOne(xx,yy,1)=2 And LevelOne(xx,yy,2)=1 Then<br>          DrawImage DoorLockedEW,x,y<br>           EndIf<br>         ;North-south doors<br>        If LevelOne(xx,yy,1)=3 And LevelOne(xx,yy,2)=0 Then<br>       DrawImage DoorNS,x,y<br>      EndIf<br>     If LevelOne(xx,yy,1)=3 And LevelOne(xx,yy,2)=1 Then<br>    DrawImage DoorLockedNS,x,y<br>   EndIf<br>  x=x+20<br> Next<br> x=0<br> y=y+20<br> Next<br> <br> If Tool=7 And MouseX()&gt;20 And MouseX()&lt;980 And MouseY()&gt;20 And MouseY()&lt;980 Then <br> DrawImage DeleteCurser,MouseX(),MouseY()<br> EndIf<br> <br> ;If Tool=8 Then<br> ;Cls<br> ;DrawImage FileOpGUI,0,0<br> ;End If<br><br> Flip<br>End Function<br><br><br><br><br>;****************************************************************************************************<br>;The File Operations section<br>;****************************************************************************************************<br><br><br>.SaveProject<br>Cls<br>DrawFileOpGUI()<br>Leave=0<br><br>While Leave=0 ; As long as Exit has not been clicked<br>If MouseDown(1)=0 Then<br>ClickStatus=0<br>EndIf<br><br>;NewProject <br>If MouseDown(1)=1 And ClickStatus=0 And MouseX()&gt;73 And MouseX()&lt;137 And MouseY()&gt;610 And MouseY()&lt;713 Then<br> PlaySound Click<br> ClickStatus=1<br> Gosub NewProject<br>EndIf<br><br>;Save<br>If MouseDown(1)=1 And ClickStatus=0 And MouseX()&gt;73 And MouseX()&lt;139 And MouseY()&gt;753 And MouseY()&lt;776 Then<br> PlaySound Click <br> ClickStatus=1<br> Gosub Save<br> EndIf<br><br>;Load<br>If MouseDown(1)=1 And ClickStatus=0 And MouseX()&gt;73 And MouseX()&lt;137 And MouseY()&gt;818 And MouseY()&lt;841 Then<br> PlaySound Click <br> ClickStatus=1<br> Gosube Load<br>EndIf<br><br>;DeleteFiles<br>If MouseDown(1)=1 And ClickStatus=0 And MouseX()&gt;73 And MouseX()&lt;224 And MouseY()&gt;885 And MouseY()&lt;907 Then<br> PlaySound Click <br> ClickStatus=1<br> Gosub DeleteFiles<br>EndIf<br><br>;SaveAs<br>If MouseDown(1)=1 And ClickStatus=0 And MouseX()&gt;231 And MouseX()&lt;336 And MouseY()&gt;753 And MouseY()&lt;776 Then<br> PlaySound Click <br> ClickStatus=1<br> Gosub SaveAs<br>EndIf<br><br>;Exit<br>If MouseDown(1)=1 And ClickStatus=0 And MouseX()&gt;73 And MouseX()&lt;133 And MouseY()&gt;847 And MouseY()&lt;972 Then<br> PlaySound Click <br> ClickStatus=1 <br> Leave=1<br>EndIf<br>Wend ;Main Loop<br>Return<br><br><br><br><br>;***********************************************************************************<br>;Draws the screen,sets drawing to the backbuffer and draws the GUI.<br>;***********************************************************************************<br><br>Function DrawFileOpGUI()<br> SetBuffer BackBuffer()<br> DrawImage FileOpGUI,0,0<br> Flip<br>End Function<br> <br>;*************************************************************************************<br>;This Calls Up the directory of projects<br>;*************************************************************************************<br>;<br><br>Function ListFiles()<br>Cls<br>myDir=ReadDir(folder$)<br><br>Repeat<br>; Assign the next entry in the folder to file$<br>file$=NextFile$(myDir)<br><br>; If there isn't another one, let's exit this loop<br>If file$="" Then Exit<br><br>; Use FileType to determine if it is a folder (value 2) or a file and print  results<br>If FileType("C:\DungeonCrawlGame\Map editor\"+file$) = 2 Then<br>Print "Folder:" + file$<br>Else<br>Print "File:" + file$<br>End If<br>Forever<br><br>;Properly close the open folder<br>CloseDir myDir<br><br>; We're done!<br>Print "Done listing files!" <br>End Function<br><br>;****************************************************************************************<br>;Creates a new Project.<br>;****************************************************************************************<br><br>.NewProject<br>SetBuffer BackBuffer()<br>Levels=0<br>Condition=0<br>Cls<br>ListFiles()<br>DrawFileOpGUI()<br>Text 454,665,"Enter name of Project"<br>Locate 454,680<br>ProjectFile$=Input()<br>If ProjectFile$="" Then<br>Text 454,695,"Not a valid Name"<br>Condition=0<br>Else <br>Condition=1 <br>EndIf<br>If Condition=1 Then<br>Text 454,695,"How many Levels? Maximum of 20"<br>Locate 454,710<br>Levels=Input() ;Make Levels Global<br>If Levels&gt;0 And Levels&lt;21 Then<br>Dim Dungeon(50,50,20,Levels)<br>Else<br>Text 454,725, "Not a valid number of levels. Select NEW again"<br>EndIf<br>EndIf<br>Return<br><br><br>;****************************************************************************************<br>;Saves the current Project if there is a current one underway.<br>;****************************************************************************************<br><br><br>.Save<br>Cls<br>ListFiles()<br>DrawFileOpGUI()<br>If ProjectFile$&lt;&gt;"" Then <br>SaveFile()<br>Else<br>Text 454,665,"You need to create a NEW project"<br>EndIf<br>Return<br><br>;**************************************************************************************<br>;If you want to save the current project under a new name<br>;**************************************************************************************<br><br>.SaveAs<br>Cls<br>ListFiles()<br>DrawFileOpGUI()<br>If ProjectFile$&lt;&gt;"" Then<br>Text 454,665, "Enter new file mame."<br>Locate 454,680<br>NewProjectFiles$=Input()<br>If NewProjectFile$="" Then<br>Text 454,695, "Not a valid name.Try again."<br>Else<br>ProjectFile$=NewProjectFile$<br>SaveFile()<br>EndIf<br>Return<br><br> <br><br>;*************************************************************************************<br>;Loads in a Previously saved project.<br>;*************************************************************************************<br><br>.Load<br>Cls<br>ListFiles()<br>DrawFileOpGUI()<br>Text 454,665, "Enter Project Name"<br>ProjectFile$=Input()<br><br>Infile=ReadFile("C:\DungeonCrawlGame\Map editor\MyDungeons\"+ProjectFile$) <br>Levels=ReadInt(InFile)<br>Dim Dungeon(50,50,20,Levels)<br>For TotalLevels=1 To Levels<br>For y=1 To 50<br>For x=1 To 50<br>Dungeon(x,y,1,TotalLevels)=ReadInt(InFile)<br>Dungeon(x,y,2,TotalLevels)=ReadInt(InFile)<br>Dungeon(x,y,3,TotalLevels)=ReadInt(InFile)<br>Dungeon(x,y,4,TotalLevels)=ReadInt(InFile)<br>Dungeon(x,y,5,TotalLevels)=ReadInt(InFile)<br>Dungeon(x,y,6,TotalLevels)=ReadInt(InFile)<br>Dungeon(x,y,7,TotalLevels)=ReadInt(InFile)<br>Dungeon(x,y,8,TotalLevels)=ReadInt(InFile)<br>Dungeon(x,y,9,TotalLevels)=ReadInt(InFile)<br>Dungeon(x,y,10,TotalLevels)=ReadInt(InFile)<br>Dungeon(x,y,11,TotalLevels)=ReadInt(InFile)<br>Dungeon(x,y,12,TotalLevels)=ReadInt(InFile)<br>Dungeon(x,y,13,TotalLevels)=ReadInt(InFile)<br>Dungeon(x,y,14,TotalLevels)=ReadInt(InFile)<br>Dungeon(x,y,15,TotalLevels)=ReadInt(InFile)<br>Dungeon(x,y,16,TotalLevels)=ReadInt(InFile)<br>Dungeon(x,y,17,TotalLevels)=ReadInt(InFile)<br>Dungeon(x,y,18,TotalLevels)=ReadInt(InFile)<br>Dungeon(x,y,19,TotalLevels)=ReadInt(InFile)<br>Dungeon(x,y,20,TotalLevels)=ReadInt(InFile)<br>Next<br>Next<br>CloseFile(Infile)<br>Return<br><br>;*****************************************************************************<br>;This is the function that is called from the labels ".Save" and ".SaveAs"<br>;*****************************************************************************<br><br>Function SaveFile()<br>FileOut=WriteFile("C:\DungeonCrawlGame\Map editor\MyDungeons\"+ProjectFile$)<br>If FileOut=0 Then<br> RuntimeError "Could not open file for writing."<br>EndIf<br>Dungeon(0,0,0,0)=Levels<br>WriteInt(FileOut,Dungeon(0,0,0,0)) ;Store the number of levels here.<br>For TotalLevels=1 To Levels<br>For y=1 To 50<br>For x=1 To 50<br>WriteInt(FileOut,Dungeon(x,y,1,TotalLevels))<br>WriteInt(FileOut,Dungeon(x,y,2,TotalLevels))<br>WriteInt(FileOut,Dungeon(x,y,3,TotalLevels))<br>WriteInt(FileOut,Dungeon(x,y,4,TotalLevels))<br>WriteInt(FileOut,Dungeon(x,y,5,TotalLevels))<br>WriteInt(FileOut,Dungeon(x,y,6,TotalLevels))<br>WriteInt(FileOut,Dungeon(x,y,7,TotalLevels))<br>WriteInt(FileOut,Dungeon(x,y,8,TotalLevels))<br>WriteInt(FileOut,Dungeon(x,y,9,TotalLevels))<br>WriteInt(FileOut,Dungeon(x,y,10,TotalLevels))<br>WriteInt(FileOut,Dungeon(x,y,11,TotalLevels))<br>WriteInt(FileOut,Dungeon(x,y,12,TotalLevels))<br>WriteInt(FileOut,Dungeon(x,y,13,TotalLevels))<br>WriteInt(FileOut,Dungeon(x,y,14,TotalLevels))<br>WriteInt(FileOut,Dungeon(x,y,15,TotalLevels))<br>WriteInt(FileOut,Dungeon(x,y,16,TotalLevels))<br>WriteInt(FileOut,Dungeon(x,y,17,TotalLevels))<br>WriteInt(FileOut,Dungeon(x,y,18,TotalLevels))<br>WriteInt(FileOut,Dungeon(x,y,19,TotalLevels))<br>WriteInt(FileOut,Dungeon(x,y,20,TotalLevels))<br>Next<br>Next<br>Next<br>CloseFile(FileOut)<br>Text 454,665, "Finished saving."+ProjectFile$<br>End Function <br><br></td></tr></table><br>
<a name="1077105"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Charrua</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> i never get an error like that, but it is likely:<br><br>const can only apperar in main program (same for global), but obviously isn't related with a Main Loop!<br><br>probably Gosub is sending the program control to "don't know where" and there is something that doesn't supose to be there...<br><br>please: post some code or the exact error message<br><br>Juan <br><br></td></tr></table><br>
<a name="1077112"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Galdy</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> The problem starts after it gosubs from the Section that Selects and assigns a number to the "Tool" variable. <br><br>This line..<br><br><br>If MouseDown(1)=1 And ClickStatus=0 And MouseX()&gt;1013 And MouseX()&lt;1044 And MouseY()&gt;823 And MouseY()&lt;854 Then<br>Tool=8<br>ClickStatus=1<br>PlaySound Click<br>Gosub SaveProject<br>EndIf <br><br></td></tr></table><br>
<a name="1077115"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Galdy</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> hmm, I should check to see if i missed a global. That could very well be it. <br><br></td></tr></table><br>
<a name="1077123"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Charrua</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> you are getting a:<br><br>Function Can only appear in main program:<br><br>you can't start the definition o a new functions inside one, you must enclose a function with: <br><br>Function Bla()<br> ..Sentences of function Bla<br>End Function <br><br>the following gives you an error:<br><br>Function Bla()<br>    Function BlaBla()<br>End Function<br><br><br>so is a problem of structured programing... (a job for super Yasha!!lol)<br><br>Juan <br><br></td></tr></table><br>
<a name="1077127"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Galdy</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> I need to correct  number of things and then i'll post the code again. There were some variabe changes i made that need to carried through out the code. <br><br></td></tr></table><br>
<a name="1077129"></a>

<a name="1077130"></a>

<a name="1077132"></a>

<a name="1077134"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Warner</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> You get that error when doing this:<br><pre class=code>
For i = 1 to 10

	Function Test2()
	End Function
	
Next
</pre><br>And the error reads: "Function can only appear in main program".<br>It seems that in the part labeled '.load', there is a Next missing (right above CloseFile(InFile))<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1077133"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well I can see one possible error: the very last function "SaveFile" is defined before one of the preceding loops is closed (the loop "For TotalLevels=1 To Levels" is never closed with a "Next".<br><br>However, the code posted above seems to be missing some bits (one of the arrays is never defined so it doesn't run?) so I could be wrong.<br><br>If you're wondering, Blitz3D does allow some really ugly shortcuts - you don't need to close loops or If blocks within "superior" structures like functions, because since functions can't nest, the compiler knows the block must have closed. I guess you can do the same with the end of a program file, and the function defined at the very end therefore falls within what should be the scope of the block.<br><br>This all hinges on - is Charrua's guess right, that it's actually a different error message about main <b>program</b>, not main <b>loop</b>? Because they're quite opposite things - when it says main program, it means the very outermost scope, outside all functions and loops. Functions can only be defined in the outermost level in B3D - no nesting of any kind permitted.<br><br>In yet another case, I would recommend you consider IDEal editor. It has auto-indentation support (indents and dedents correctly without you needing to tab), which makes this sort of thing immediately obvious.<br><br>(Also, why are you using both Gosub and real functions?) <br><br></td></tr></table><br>
<a name="1077167"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Galdy</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> I need to correct a number of mistakes and repost if I'm still having the same problem. The actual error message was "Function can only appear in the main program" not  "loop." Sorry. I'll check that iDEal Yash. Thanks. <br><br></td></tr></table><br>
<a name="1077172"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Who was John Galt?</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Functions declarations should not be in the middle of executing code.<br><br>Stick all your function definitions at the top or bottom of the code, not inside a loop or any other logic. <br><br></td></tr></table><br>
<a name="1077173"></a>

<a name="1077178"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Charrua</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> hi<br>when posting code, is a good practice to use the code, /code or codebox to enclose in a small window lot of lines, shows better and makes the thread more readable, every time you write a post, there is a (forum codes) link avobe the text area, read it, its very helpful<br><br>(the Warners post uses Code ... /Code markers<br><br> and it look diferent. isn' it? )<br><br>regards<br><br>Juan<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1077230"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Galdy</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wow! The IDEal is so much better to work with.  Charrua, so when posting the code put / before and after the code I take it? <br><br></td></tr></table><br>
<a name="1077231"></a>

<a name="1077234"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Charrua</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> you have to write the word "code" enclosed with square brackets!<br><br>the first is a marker to signal the begining of code (that folows)<br>[ code ]<br><br>here you code<br><br>[ / code ]<br> and with the slash signals the end<br><br>i put spaces inbetween so they dont work in this post this forum codes are hidden by the software that manages our posts, are like commands<br><br>for a long picece of code, [codebox] is better<br><br>when doing a post, use "Preview" before POST.<br><br>and IDEAL is a very handy tool<br><br>Juan<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1077316"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rob the Great</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Put simply, here's how the error comes about, the wrong way to code this:<br><pre class=code>
Graphics 800,600,0,2

SetBuffer BackBuffer()

While Not KeyDown(1)
	
	DoSomething()
	
	Function DoSomething()
		x = x + 1
	End Function
	
	Cls
	Text 0,0,x
	Flip
	
Wend
</pre><br>Here's the right way:<br><pre class=code>
Graphics 800,600,0,2

SetBuffer BackBuffer()

While Not KeyDown(1)
	
	DoSomething()
	
	Cls
	Text 0,0,x
	Flip
	
Wend

Function DoSomething()
   x = x + 1
End Function
</pre><br>Functions cannot be defined inside of any loop, which includes While/Wend, Repeat/Until/Forever, and For/Next. Functions cannot be defined inside of another function definition, nor can they be defined inside any If statements or Type definitions. Basically, the Function command can only appear by itself, not inside anything else. You can call functions from anywhere, but you can only define them outside of any loop or subroutine.<br><br>I learned this the hard way by trying to define a function inside of the main loop, very similar to the example above. After I figured that out, I later couldn't figure out why this message popped up again even though all functions were where they need to be. Come to find out, it was because I forgot to end an If statement which was directly in front of the functions.<br><br>In this situation, Warner and Yasha are right about why this would be happening. Without the last Next command, the next thing to appear is the Function command. Take a look at this example:<br><pre class=code>
For x = 0 to 10
   For y = 0 to 10
      For z = 0 to 10
         ;Do some stuff here
      Next
   Next

;There should be another Next command here. Without it, you're still in the x = 0 to 10 Loop.

Function Whatever()

   ;As soon as Blitz sees the line above, it's going to throw out that error because you are still in the loop, and you can't do that.

End Function
</pre> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
