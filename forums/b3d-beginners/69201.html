<!DOCTYPE html><html lang="en" ><head ><title >EntityParent? Something I don't know?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >EntityParent? Something I don't know?</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=5" >Blitz3D Beginners Area</a>/<a href="#bottom" >EntityParent? Something I don't know?</a><br><br>
<a name="773738"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Lordon</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, this is a bit hard to explain, and the code is a bit messy, but I'm going to do my best...<br><br>The game is networked with BlitzPlay, but the entire problem happens on the server side so it's not really relevant.<br><br>The basic idea with the following code is that it's invoked when the client fires the Bow weapon. it then creates and Arrow object which has it's own pivot point. the pivot is placed halfway between the place it was shot(p\arr) and the target the bow was aimed at (temp), below the ground.<br><br>Then the arrow is parented to the pivot and the pivot is gradually turned along its x-axis, thus creating an arc effect.<br><br>fyi, several lines in this code are excess, and are for other parts of the program I haven't gotten to yet.<br><br>------------------------------------------------------<br><br>arr.Arrow = New Arrow<br>p = find_pdata(msg\msgFrom);the person who fired the bow<br>arr\archer = p<br>p\fireMeter = BP_StrToFloat(Mid(msg\msgData,13,4))<br>arr\id = arrowCounter<br>arrowCounter = arrowCounter + 1<br>temp = CreatePivot() ;the target<br>PositionEntity temp,BP_StrToFloat(Mid(msg\msgData,1,4)),BP_StrToFloat(Mid(msg\msgData,5,4)),BP_StrToFloat(Mid(msg\msgData,9,4))<br>PointEntity temp,p\mesh<br>TurnEntity temp,0,180,0<br><br>arr\piv = CreatePivot()<br>PositionEntity arr\piv,EntityX(p\arr,True),EntityY(p\arr,True),EntityZ(p\arr,True)<br>PointEntity arr\piv,temp<br><br>dist# = EntityDistance(arr\piv,temp)<br>If dist# &gt; p\fireMeter/5 dist# = p\fireMeter/5<br>MoveEntity arr\piv,0,-1*dist/2,dist/2<br><br>arr\mesh = LoadMesh("Models\Arrow.3ds")<br>TurnEntity arr\mesh,-30,EntityYaw(temp),0<br>PositionEntity arr\mesh,EntityX(p\arr,True),EntityY(p\arr,True),EntityZ(p\arr,True)<br>EntityType arr\mesh,3<br>ScaleEntity arr\mesh,.02,.02,.02<br>EntityRadius arr\mesh,.075<br>EntityParent arr\mesh,arr\piv<br>arr\flying = True<br>If p\fireMeter &lt; 50 p\fireMeter = 50<br>arr\force# = (50) / (dist# + 1)<br>arr\dmg = p\fireMeter / 3<br><br>BP_UDPMessage(0,21,BP_IntToStr(Int(arr\id)))<br><br>FreeEntity temp<br><br>--------------------------------------------------<br><br>The above code places all the entities in the right spot, and parents the arrow to the pivot.<br><br>However, after the EntityParent arr\mesh,arr\piv is called, arr\mesh is REpositioned close to the origin(0,0,0) of the map.<br><br>What's more is the exact coordinates of the arrow after repositioning are 0,-1*dist/2,dist/2. In fact, changing the:<br>MoveEntity arr\piv,0,-1*dist/2,dist/2<br>to:<br>MoveEntity arr\piv,1,2,3<br>changes the reposition location to (1,2,3).<br><br>I really hope I feel dumb after this, because I'm so sick of this bug :( <br><br></td></tr></table><br>
<a name="773763"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Lordon</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry to bother you guys, figured it out. For those interested it had nothing to do with the code i posted, it worked fine.<br><br>While I used the global option on EntityX/Y/Z() on creation, when i was transferring the packets I had it disabled, which is why it jumped to the origin, it was giving the client the location of the arrow relative to the pivot.<br><br>To make matters worse i did the same for displaying the information for debugging purposes, which is why i got the "jump" glitch after parenting. I knew better, but alas. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
