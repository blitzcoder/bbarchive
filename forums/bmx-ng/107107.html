<!DOCTYPE html><html lang="en" ><head ><title >Import Visual Studio .lib</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Import Visual Studio .lib</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=126" >BlitzMax NG</a>/<a href="#bottom" >Import Visual Studio .lib</a><br><br>
<a name="1324201"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Can BMXNG import a Visual Studio lib that has C functions exposed?  (Regular BlitzMax can.)  Right now I am getting a lot of undefined reference errors when I try it. <br><br></td></tr></table><br>
<a name="1324236"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RustyKristi</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> As far as I know you have to use the same MinGW as your NG version. I have a simple tutorial/question thread for that.<br><br>or maybe try this one<br><br><a href="http://visualgdb.com/tutorials/mingw/mingw64/" target="_blank">http://visualgdb.com/tutorials/mingw/mingw64/</a> <br><br></td></tr></table><br>
<a name="1324244"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> It should be possible with MINGW:<br><a href="http://www.mingw.org/wiki/msvc_and_mingw_dlls" target="_blank">http://www.mingw.org/wiki/msvc_and_mingw_dlls</a> <br><br></td></tr></table><br>
<a name="1324256"></a>

<a name="1324257"></a>

<a name="1324258"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RustyKristi</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes I have read that part and actually I did some external DLL test (not lib) with NG and MinGW. Looks like the same procedure, just different way of doing it. <br><br></td></tr></table><br>
<a name="1324280"></a>

<a name="1324281"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> My lib is a VS lib with a DLL, all cdecl functions.  Not sure about the exact details of that, but I am pretty sure it is possible, and it even works with the VS debugger.  Feedback, Brucey? <br><br></td></tr></table><br>
<a name="1324282"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RustyKristi</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I see and I already told you to look into my threads. Anyway, I'll just pull them up for you so here is Brucey's response that I think is related to your problem:<br><br><div class="quote"> <br>You have a C++ DLL that you want to use with BlitzMax?<br><br>If it has been built with VS++ then you'll need to build a C-glue dll in VS and link your BlitzMax code to that - because VS and GCC C++ ABIs on Windows are not compatible.  <br></div><br><br>My thread and actual Link here:<br><br><a href="http://www.blitzbasic.com/Community/post.php?topic=106468&amp;post=1310380" target="_blank">http://www.blitzbasic.com/Community/post.php?topic=106468&amp;post=1310380</a> <br><br></td></tr></table><br>
<a name="1324348"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> That's exactly how I have always done it.  Functions are declared with "__declspec".  However, I get errors as if the functions are not detected.<br><br>This same setup works fine with regular BMX. <br><br></td></tr></table><br>
<a name="1324354"></a>

<a name="1324355"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can try a test here:<br><a href="http://www.leadwerks.com/buildtest.zip" target="_blank">http://www.leadwerks.com/buildtest.zip</a><br><br><pre class=code>Import "Leadwerks.lib"

Extern "c"
	Function leMat4FromRotation(pitch:Float,yaw:Float,roll:Float,result:Byte Ptr)
EndExtern

Local mat:Float[16]
leMat4FromRotation(0,0,0,mat)</pre><br>Output:<br><div class="quote"> Building buildtest<br>[ 99%] Processing:buildtest.bmx<br>[ 99%] Compiling:buildtest.bmx.gui.debug.win32.x86.c<br>[100%] Linking:buildtest.debug.exe<br>C:/Users/Josh/Desktop/.bmx/buildtest.bmx.gui.debug.win32.x86.o: In function `bb_main':<br>C:/Users/Josh/Desktop/.bmx/buildtest.bmx.gui.debug.win32.x86.c:60: undefined reference to `leMat4FromRotation'<br>Build Error: Failed to link C:/Users/Josh/Desktop/buildtest.debug.exe<br>Process complete <br></div><br>Works fine with regular BMX. <br><br></td></tr></table><br>
<a name="1324362"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GW</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> You might have to define an '.x' file containing the c version of your declaration.  <br>It's all a bit nebulous about when and why it's needed with NG. <br><br></td></tr></table><br>
<a name="1324363"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> The .x-file os there in need it you mention/declare an external function again when it already was mentioned by an previously imported module.<br><br>At least this is what people have had trouble with.<br><br>Bye<br>Ron <br><br></td></tr></table><br>
<a name="1324437"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> More info, please? <br><br></td></tr></table><br>
<a name="1324459"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >eagle54</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Try this example :<br><br><a href="http://www.blitzbasic.com/Community/post.php?topic=105537&amp;post=1296080" target="_blank">http://www.blitzbasic.com/Community/post.php?topic=105537&amp;post=1296080</a> <br><br></td></tr></table><br>
<a name="1325887"></a>

<a name="1325888"></a>

<a name="1325889"></a>

<a name="1325891"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Try this example :<br><br><a href="http://www.blitzbasic.com/Community/post.php?topic=105537&amp;post=1296080" target="_blank">http://www.blitzbasic.com/Community/post.php?topic=105537&amp;post=1296080</a>  <br></div><br>This example works correctly, but I am unable to get it working with a VS lib file.<br><br>I created a file named "buildtest.x" and added this line:<br><pre class=code>void leMat4FromRotation(float, float, float, void*)!</pre><br>I still get the same linking error.  I know the .x file is being read because I had to mess around with the syntax before I got it right.<br><div class="quote"> Building buildtest<br>[ 99%] Processing:buildtest.bmx<br>[ 99%] Compiling:buildtest.bmx.gui.debug.win32.x86.c<br>[100%] Linking:buildtest.debug.exe<br>C:/Users/Josh/Desktop/buildtest/.bmx/buildtest.bmx.gui.debug.win32.x86.o: In function `bb_main':<br>C:/Users/Josh/Desktop/buildtest/.bmx/buildtest.bmx.gui.debug.win32.x86.c:60: undefined reference to `leMat4FromRotation'<br>Build Error: Failed to link C:/Users/Josh/Desktop/buildtest/buildtest.debug.exe<br>Process complete <br></div> <br><br></td></tr></table><br>
<a name="1325910"></a>

<a name="1325911"></a>

<a name="1325912"></a>

<a name="1325913"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Indeed this should work. It works using the legacy compiler but not in BlitzmaxNG.<br><br>I currently have this working with a standalone .lib, as opposed to one with a .dll<br><br>Even then it gives a warning so there's still more investigating to do... <br><br></td></tr></table><br>
<a name="1325914"></a>

<a name="1325915"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> I updated the test program with my .x file for testing:<br><a href="http://www.leadwerks.com/buildtest.zip" target="_blank">http://www.leadwerks.com/buildtest.zip</a><br><br>I also tried with a Visual Studio static lib, with the same result.  I'm using VS 2013 right now. <br><br></td></tr></table><br>
<a name="1325916"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> For the static lib to kind of work I needed to turn off a linking optimisation in vstudio and compile the 'max code via the command line adding .lib on the command line - its not an automated build process but if finding a solution works out then I'm sure in would get included to be automatic. <br><br></td></tr></table><br>
<a name="1325917"></a>

<a name="1325918"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the info. That is consistent with the information here:<br><a href="http://www.mingw.org/wiki/msvc_and_mingw_dlls" target="_blank">http://www.mingw.org/wiki/msvc_and_mingw_dlls</a><br><br>How do I add a command line parameter to the build? <br><br></td></tr></table><br>
<a name="1325920"></a>

<a name="1325921"></a>

<a name="1325923"></a>

<a name="1325924"></a>

<a name="1325926"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm sure this isn't a robust solution just yet but this is what I did so far...<br><br>In the NG compatible maxIDE:<br>Turn on verbose output program menu -&gt; build options -&gt; developer options -&gt; verbose build<br><br>a fair warning is that it is quite verbose in that the full paths are output so it can look a little much at first.<br><br>This will give you the command line used to compile the file(s). There are some steps to look out for for .bmx files:<br>bcc.exe compiles from .bmx to .h &amp; .c<br>gcc.exe compiles from .c to .o<br>ld.exe links .o to .exe<br><br>for a module you'll also get<br>ar.exe used for .o to .a<br><br>ld.exe is the linker command that you need to tack the .lib onto the end of. Add something along the lines of <b>-Lfolder/to/library -lLeadwerks</b>. Notice no need for the .lib extension.<br><br>In VS dll project in VS:<br>Project properties -&gt; configuration properties -&gt; general -&gt; project defaults -&gt; whole program optimization -&gt; no whole program optimization<br><br>It's very rough - ld.exe warns about an incomplete def table or similar, so I guess something still isn't right.<br>Also I've only tested by returning a simple integer from a function in the .lib, no parameters. <br><br></td></tr></table><br>
<a name="1325922"></a>

<a name="1325925"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've also been playing with dlltool and reimp, x86, x64 and I can't get them to link just yet. They do produce a libLeadwerks.a file but linking is still a no-no. Strangely all of the gcc tools will examine the dll and .lib file giving in-depth information about it. But linking gives an invalid format error, which is usually an error ouput for mixing x86 and x64... <br><br></td></tr></table><br>
<a name="1326199"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> I added some missing DLLs.  I didn't think they would matter during linking, but maybe it does somehow.<br><a href="http://www.leadwerks.com/buildtest.zip" target="_blank">http://www.leadwerks.com/buildtest.zip</a> <br><br></td></tr></table><br>
<a name="1328845"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> Will this be supported? <br><br></td></tr></table><br>
<a name="1328868"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> You might better open an issue on github for thia...to keep track on progress/potential regressions etc.<br><br>This also raises awareness of Brucey regarding the problem.<br><br>Bye<br>Ron <br><br></td></tr></table><br>
<a name="1329153"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> Reported here:<br><a href="https://github.com/bmx-ng/bmk/issues/26" target="_blank">https://github.com/bmx-ng/bmk/issues/26</a> <br><br></td></tr></table><br>
<a name="1329749"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> I couldn't get my gcc to link the .lib...<br><br>But it's easy to create a compatible .a file instead. There are several ways to achieve this, as listed in the above github issue.<br><br>Note that the .x file is not required.<br>The .x file inhibits the generation of extern function definitions. Generation of such definitions are only a problem if some other included header already defines them - for example, if you are declaring an export of a system function on Windows that would be visible via windows.h. Then you would see an "already defined" error or some such. In such cases you need to prevent the generation of the already defined function.<br>If you use a .x file to inhibit the generation of a function definition that is not already included via some other header, then you will have no definition of that function. This results in the function being declared with int return type and int arguments - which is probably not what you want. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
