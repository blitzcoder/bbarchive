<!DOCTYPE html><html lang="en" ><head ><title >NG Structs and Types</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >NG Structs and Types</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=126" >BlitzMax NG</a>/<a href="#bottom" >NG Structs and Types</a><br><br>
<a name="1314666"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey,<br><br>I'm sure you've been waiting for this question so I may as well ask it :p<br><br>I know that structs are generally allocated on the stack. So how are you handling things if you want to allocate the exact same data structure on the heap? Just duplicate everything within a Type? If that's the case how do we go about functions/methods that use them as parameters. Or are they intended purely for simple fast local allocations only? <br><br></td></tr></table><br>
<a name="1314689"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello what?<br><br>You'll need to write a wee example of what you think you want to do ;-) <br><br></td></tr></table><br>
<a name="1314705"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Never mind,<br><br>I've been working in c++ all day and was thinking about the way that you can create an instance of a class/struct on the stack and then also an instance of the same class/struct on the heap using the 'new' operator. I was just thinking of the same paradigm using structs in NG. <br><br></td></tr></table><br>
<a name="1314714"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've been working in Java all day, so not to worry ;-)<br><br>Structs are stack only. You can create them on the heap (perhaps via memalloc, or from C/C++) but you'll be using them via a Ptr, and they won't be GC managed.<br>Struct methods are basically functions that take a ptr to the struct as the first argument. (similar to how Type methods work, but Structs don't track them as function pointers, as they aren't inheritable.) <br><br></td></tr></table><br>
<a name="1314776"></a>

<a name="1314780"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Can you confirm something for me please...<br><br>Say I have a Type with a Field, and that Field is a Struct instance. In an 'Init' method I create the struct instance and then directly copy the Struct to the Field, does it copy as I'd expect or is there going to be trouble further down the line with possible stack corruption? I would expect the Field instance to be safe until the Type instance is no longer 'reachable' and gets collected. When the Init method returns then the Local 'temp' would go out of scope - that doesn't mean that the values for the Field one has gone out of scope too does it?<br><br>The reason I take this opportunity to ask is that I'm getting a stack corruption when using the Vulkan module with Structs ( I've now changed the code back to Types for stability ) but I don't want to blame the Structs feature if I'm doing something obviously wrong. I'm well aware that it could be other areas of my code but things aren't working how I'm expect them to and, typical that, I can't reproduce the corrupted stack with a small example :p<br><br><pre class=code>
Struct TestStruct
	Field value:Int
EndStruct

Type TTestType
	Field _inst:TestStruct
	
	Method Init()
		Local temp:TestStruct
		temp.value = 20
		
		_inst = temp
	EndMethod
EndType
</pre> <br><br></td></tr></table><br>
<a name="1314790"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Since Structs are pure C-Structs, if you want to pass them around and be referring to the original instance, you will need to pass by reference - when you pass by value, the struct is copied.<br>The copy will be invalid when scope is lost.<br>When you pass by reference, the contents should be valid for as long as the instance stays in scope - if it is a field of a type, that should be until the object is collected. <br><br></td></tr></table><br>
<a name="1314801"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah that's how I thought they would be. Thanks for confirming. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
