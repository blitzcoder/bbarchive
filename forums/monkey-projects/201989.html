<!DOCTYPE html><html lang="en" ><head ><title >Real-Time 2D HTML5 Lighting FX</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Real-Time 2D HTML5 Lighting FX</h1><a href="forums.php" >Monkey Archive Forums</a>/<a href="topics.php?forum=511" >Monkey Projects</a>/<a href="#bottom" >Real-Time 2D HTML5 Lighting FX</a><br><br>
<a name="2019056"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Richard Betson</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Real-Time 2D HTML5 Lighting FX<br><a href="http://redeyeware.uphero.com/monkey/HTML5_2d_realtime_lighting/html5/MonkeyGame.html" target="_blank">http://redeyeware.uphero.com/monkey/HTML5_2d_realtime_lighting/html5/MonkeyGame.html</a><br><br>Hi,<br>This is a 2D real-time lighting effect for HTML5 using 'impixi's' canvas wrapper mod (http://www.monkeycoder.co.nz/Community/posts.php?topic=1885). It uses the radial gradient fill for a poly (the size of the canvas) to simulate a lighting effect over a background. This is a bit of a hack but would work for game lighting perhaps.<br><br>Cycles through 4 effects.<br><br>* EDIT *<br>Fixed for IE9 and FireFox <br><br></td></tr></table><br>
<a name="2019014"></a>

<a name="2019019"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Beaker</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> 13fps on iPad2.<br>60fps in Safari.<br>Doesn't seem to run in Firefox (v8.0.1).<br><br>Looks good. <br><br></td></tr></table><br>
<a name="2019022"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DruggedBunny</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nice -- 36 FPS in Chrome here, on XP, which looks perfectly smooth. <br><br></td></tr></table><br>
<a name="2019082"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Goodlookinguy</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Neat effects. I'm getting 60/61 FPS on all tests on Chrome (version 17.0.942.0 dev-m). In FireFox 8.0.1, I'm also not able to get it to run.<br><br>Edit/Update: I tested this in FireFox (Aurora) 10.0a2 (2011-12-06) and it also didn't run. <br><br></td></tr></table><br>
<a name="2019035"></a>

<a name="2019024"></a>

<a name="2019027"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >impixi</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nice. 59/61 FPS Chrome 16. Doesn't do anything in IE9. <br><br></td></tr></table><br>
<a name="2019028"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> How long does it take to load? I've left it for a few minutes and all I get is a blank screen with the text: RedEyeWare - Go Back to Monkey Demos<br><br>Running FF 8. <br><br></td></tr></table><br>
<a name="2019030"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I get the blank screen with FF9 <br><br></td></tr></table><br>
<a name="2019042"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >NoOdle</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> works fine with safari, solid 60fps on my macbook. Very nice :) <br><br></td></tr></table><br>
<a name="2019044"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Blank screen with IE9 too...<br><br>Just tried Chrome and works fine there - cool! <br><br></td></tr></table><br>
<a name="2019054"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Richard Betson</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yup, this 'does not run' on FireFox or IE9, interesting.. but rocks on Chrome/Safari I will try to get Impixi to see if he can help get it IE9/FF comaptible. I'll poke around a bit too, I am sure it's something I got wrong as impixi's gradient-poly demo works on all browsers.<br><br>Here is the source for this:<br><br>* EDIT * - Fixed for IE9 and FireFox<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">

'******************************************************************
'*	2D Lighting Example
'*	Author: Richard R Betson
'*	Date: 12/07/11
'*	Language: Monkey
'*  Tagets: HTML5
'*  License - Public Domain							  
'******************************************************************
'   Canvas Wrapper Mod by Impixi - <a href="http://www.monkeycoder.co.nz/Community/posts.php?topic=1885" target="_blank">http://www.monkeycoder.co.nz/Community/posts.php?topic=1885</a>
'******************************************************************

Import monkey
Import mojo
Import mojo.app
Import canvaswrapper

Global fps:Int,fp:Int,fps_t:Int
Global polyArr1:Float[]
Global polyArr2:Float[]
Global zz:Int,zz2:Int
Global zz_sw:Int,fx:Int=-1




Function Main:Int()
	New PolyExperiment
End Function


Class PolyExperiment Extends App
	Field htmlImage:HTMLImageElement
	Field textureCreated:Bool=False
	Field fxttl:Int
	Field myimage:Image
	Field texture:CanvasPattern
	Field gradLinear:CanvasGradient
	Field gradRadial:CanvasGradient

	
	Method OnCreate()
		htmlImage =  loadHTMLImage("bg3.png")
		polyArr2 = [0.0, 0.0, 640.0, 0.0, 640.0, 480.0, 0.0, 480.0, 0.0, 0.0]
		SetUpdateRate(60)
	End Method
	
	Method OnUpdate()
	
	End Method
	
	Method OnRender()
		Local mxx:Int,ms:String
		Local mtime:Int=Millisecs()
		fps=fps+1
		If fps_t&lt;mtime'Millisecs()
		fp=(fps)
		fps_t=1000+mtime'Millisecs()
		fps=0
		Endif
		
		If fxttl&lt;mtime'Millisecs()
			fxttl=mtime+5000'Millisecs+3000
			fx=fx+1
			If fx&gt;3 Then fx=0
		Endif
		
		If (htmlImage.complete) And (Not textureCreated)
			texture = xCanvas.CreatePattern(htmlImage, "repeat")
			textureCreated = True
		Endif 
		Local dx:Int = Sin(mtime*.2)*199
		Local centreXY:Float[] = PolyCentroid(polyArr2)

		If fx=0
		gradRadial = xCanvas.CreateRadialGradient(centreXY[1]+70+dx, centreXY[1], 0, centreXY[1]+70+dx, centreXY[1],200)
		mxx=(  255 + ( 255  Shl 8)   + ( ( (255-dx)) Shl 16 ) + (255 Shl 24)  )
		ms=DecToHex(mxx)
		gradRadial.addColorStop(0.0,"#ffffff")
      	gradRadial.addColorStop(0.2,"#"+ms)
      	gradRadial.addColorStop(1.0, "#000000")
		Else If fx=1
		gradRadial = xCanvas.CreateRadialGradient(centreXY[1]+70-dx, centreXY[1], 0, centreXY[1]+70, centreXY[1],200)
		mxx=(  ( 255  Shl 8)   + ( ( (195)) Shl 16 ) + (195 Shl 24)  )
		ms=DecToHex(mxx)
		gradRadial.addColorStop(0.0,"#8f8fff")
      	gradRadial.addColorStop(0.3,"#"+ms)
     	gradRadial.addColorStop(1.0, "#000000")
		Else If fx=2
		gradRadial = xCanvas.CreateRadialGradient(centreXY[1]+70, centreXY[1], 0, centreXY[1]+70+dx, centreXY[1],200)
		mxx=(  ( 255  Shl 8)   + ( ( (255-dx)) Shl 16 ) + (255 Shl 24)  )
		ms=DecToHex(mxx)
		gradRadial.addColorStop(0.0,"#ffffff")
      	gradRadial.addColorStop(0.2,"#"+ms)
      	gradRadial.addColorStop(1.0, "#000000")
		Else If fx=3
		gradRadial = xCanvas.CreateRadialGradient(centreXY[1]+70, centreXY[1], 0, centreXY[1]+70, centreXY[1],200+dx)      	
		gradRadial.addColorStop(0.0,"#8a8aff")
      	gradRadial.addColorStop(1.0, "#000000")
		Endif

		SetBlend(0)
		xCanvas.SetFillStyle(texture)
		xCanvas.DrawPoly polyArr2, True, True
		SetBlend(1)
		xCanvas.SetFillStyle gradRadial
		xCanvas.DrawPoly polyArr2, True,True
		DrawText("HTML5 Real-Time 2D Lighting FX - Richard Betson - <a href="http://redeyeware.uphero.com" target="_blank">http://redeyeware.uphero.com</a> - FPS:"+fp,10,465)

	End Method
	
	
Function DecToHex:String(v:Int)
	Const hex:String = "0123456789ABCDEF"
	Local n:String
	For Local i:Int = 0 Until 6
		n += String.FromChar(hex[(v Shr (28-(i*4))) &amp; $F])
	Next
	Return n
End Function		


'Get the centre point of a polygon
Function PolyCentroid:Float[](poly:Float[])

	Local result:Float[2]	'i0 = x, i1 = y
    result[0] = 0
    result[1] = 0

    For Local i:Int = 0 Until (poly.Length - 2) Step 2
		
		result[0] += (poly[i] + poly[i+2]) * ((poly[i] * poly[i+3]) - (poly[i+2] * poly[i+1]))
		result[1] += (poly[i+1] + poly[i+3]) * ((poly[i] * poly[i+3]) - (poly[i+2] * poly[i+1]))
    Next

    Local area:Float = PolygonArea(poly)

    result[0] = Abs(result[0] / 6.0 / area)
    result[1] = Abs(result[1] / 6.0 / area)

	Return result

End

'FROM:
'http://www.monkeycoder.co.nz/Community/posts.php?topic=1659
Function PolygonArea:Float(polyPoints:Float[])

	Local accum:Float
	Local  j:Int = polyPoints.Length()-2

	For Local i:Int =0 Until polyPoints.Length() Step 2
		accum += polyPoints[j] * polyPoints[i+1] - polyPoints[i] * polyPoints[j+1]
    	j=i 
	Next

	Return accum / 2

End


End Class



</textarea><br><br>L8r, <br><br></td></tr></table><br>
<a name="2019050"></a>

<a name="2019049"></a>

<a name="2019048"></a>

<a name="2019055"></a>

<a name="2019057"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Richard Betson</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> OK,<br><br>I fixed the problem and this should work with IE9 and FireFox. I was passing the Hex string incorrectly.<br><br>Let me know if it works for you:)<br><br>L8r,<br>- Rich - <br><br></td></tr></table><br>
<a name="2019061"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >semar</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> 30-33 FPS on Firefox 4.0b12 (on a openSUSE 11.4 O.S.)<br><br>Sergio. <br><br></td></tr></table><br>
<a name="2019062"></a>

<a name="2019063"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> yep it works now, FF9<br>I got 8FPS with a celeron from 2003<br><br>Nice demo <br><br></td></tr></table><br>
<a name="2019072"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Why0Why</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> 61 FPS for me in Chrome.  I love how it looks. <br><br></td></tr></table><br>
<a name="2019074"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bruZard</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> very cool, 61 FPS in Firefox 8.0.1 <br><br></td></tr></table><br>
<a name="2019076"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jayparker</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> 32-36 FPS in Firefox 8.0.1 and smooth.<br><br>30-61 FPS in Chrome 15.0.874.121 <br><br></td></tr></table><br>
<a name="2019138"></a>

<a name="2019139"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Goodlookinguy</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Main Computer (Stats In Signature)<br>Firefox 10.0a2 (2011-12-07) : 61 FPS Steady<br>Chrome (version 17.0.942.0 dev-m) : 61 FPS Steady<br><br>Computer 2 (2.7GHz 6-cores, ATI HD 5770, 8GB DDR3 RAM)<br>Firefox 10.0a2 (2011-12-06)<br> - Test 1 : 50-52 FPS<br> - Test 2 : 50-52 FPS<br> - Test 3 : 48-54 FPS<br> - Test 4 : 50-51 FPS<br><br>Chrome (version 17.0.942.0 dev-m)<br> - Test 1 : 61 FPS<br> - Test 2 : 38-39 FPS<br> - Test 3 : 37-38 FPS<br> - Test 4 : 61 FPS<br><br>iMac (3.4GHz 4 Cores, AMD Radeon HD 6970M, 16GB DDR3)<br>Chrome (version 17.0.963.2 dev): 61 FPS Steady<br><br>It's interesting. Firefox was more consistent overall VS Chrome which was faster at certain parts and quite a bit slower at others. Regardless of the number of frames, to the eye, all tests looked very smooth. <br><br></td></tr></table><br>
<a name="2019085"></a>

<a name="2019083"></a>

<a name="2019084"></a>

<a name="2019086"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Richard Betson</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> ^Thanks for testing. :)<br><br><div class="quote"> Chrome which was faster at certain parts and quite a bit slower at others <br></div><br><br>I have noticed this too and I have wondered why this happens. I have even tried different canvas sizes, optimization's and alike trying to adapt to it. It feels like it's threading issues, not sure. <br><br></td></tr></table><br>
<a name="2019092"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dopeyrulz</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Working fine in IE9 - 39 FPS on my laptop <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
