<!DOCTYPE html><html lang="en" ><head ><title >Pixel Font module</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Pixel Font module</h1><a href="forums.php" >Monkey Archive Forums</a>/<a href="topics.php?forum=511" >Monkey Projects</a>/<a href="#bottom" >Pixel Font module</a><br><br>
<a name="2083452"></a>

<a name="2083453"></a>

<a name="2083454"></a>

<a name="2083455"></a>

<a name="2083456"></a>

<a name="2083457"></a>

<a name="2083458"></a>

<a name="2083469"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >chrisc2977</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> PixelFont is my attempt at a different approach to text/fonts in monkey.<br><br>Html5 Example: <a href="http://www.challenger-arts.com/html5/pixelfont/" target="_blank">http://www.challenger-arts.com/html5/pixelfont/</a><br><br><b>Features so far</b><br>Draws text fast - on the above example I was getting 230+fps on local html5<br>Use mojo's SetColor() to set font drawing colour - got this working fast, even on html5! (see example) <br>Smooth rendering - Uses alpha - does NOT use readpixel <br>Multiline text<br>Vertical text<br>Align Left, center and right - Even for vertical text<br>Included is a basic homemade convertor for ttf/oft fonts<br><br>If your interested downlad it here:<br><a href="http://www.challenger-arts.com/wp-content/uploads/pixelfont.zip" target="_blank">http://www.challenger-arts.com/wp-content/uploads/pixelfont.zip</a><br><br>Thoughts / Comments / Issues? <br><br></td></tr></table><br>
<a name="2083461"></a>

<a name="2083462"></a>

<a name="2083463"></a>

<a name="2083464"></a>

<a name="2083467"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >chrisc2977</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I should Probably mention basic HowTo:<br><br><pre class=code>
Global MyFont:PixelFont = New PixelFont(FilePath.txt)

SetColor(Whatever)
MyFont.DrawText(Text, X, Y, Align=0, Vertical=0)
'Align - 0:Left  1:Centered  2:Right
'Vertical - 0:Normal Left to right  1: Vertical Down to up

MyFont.TextWidth(Text)

MyFont.TextHeight(Text)
</pre> <br><br></td></tr></table><br>
<a name="2083471"></a>

<a name="2083472"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wow, now thats thinking outside of the box!<br><br>I'm going thru your module trying to understand it.<br><br>1. You convert the TTF to a massive text file containing the name of the TTF, size and the character data<br>2. You load the text file into MonkeyX where you parse the file and store them into arrays<br>3. You draw the line of text on screen using writepixels and the data stored in the arrays<br>4. You store the image you have created for future use<br><br>When you are creating the image, does it draw it to the screen and then store it? If so, how do you deal with a busy background?<br><br>Any chance that you can share the code you created for the TTF to text file? <br><br></td></tr></table><br>
<a name="2083488"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nice ideas indeed. I like how it can pre-cache lines of text but, have you considered a way to prevent filling the whole vram on small devices? Also, while the idea behind is nice, I see the problem that rendering speed is not predictable when a text that has never been drawn before gets drawn. So I see like a good complementary algorithm to a regular atlas based text drawing routine. As an example, making a game that shows a timer with a good resolution could just be slowing down because it's creating and pre-rendering images at almost every frame! also, not always lots of images from different textures are drawn faster than much more images from the same texture, so it'll depend on the number of characters being rendered, and the ability of the underlying renderer to handle coloring of textures, changes of contexts and big amounts of images.<br>I would suggest you to also add a function to draw uncached text for the situations where there's a highly dynamic text on screen, or the situations where you have limited VRam <br><br></td></tr></table><br>
<a name="2083490"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I would suggest you to also add a function to draw uncached text for the situations where there's a highly dynamic text on screen, or the situations where you have limited VRam <br></div><br>Yeah good point, should be pretty easy to add.<br><pre class=code>Method DrawText(Text:String, X, Y, Align = 0, Vertical = 0, cacheImage:Bool = True)</pre><br>And in FastDrawLine:<br><pre class=code>Method FastDrawLine:Image(Line:String, cacheImage:Bool = True)</pre> <br><br></td></tr></table><br>
<a name="2083513"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >chrisc2977</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> <b>@therevills (1st post)</b><br>Yes thats all correct, when creating the font it draws each char to the backbuffer (white text on black) reads the pixels and sets the alpha based on level of red. I will include bmx file on next upload if you want. Im also looking at ways to reduce the file size :)<br><br><b>@ziggy</b><br>I agree vram is a bit of an issue :s will have a think on that. A for creating a new line, I THINK, although unpredictable, creating a previously unwritten line of text isnt much slower than the std method of drawing single chars to the screen. The problem occurs when the lists start filling up and it has to search though a load to find the correct string.<br>But I def agree especially for ever changing text that an uncached method would be good (easily done and I did this when I was testing different ways).<br><br>Cheers guys, a bit more work to do, but im glad you like the principles, the main goal was to have setColor() on all platforms. Am thinking about having different chardata for colours used. dunno. <br><br></td></tr></table><br>
<a name="2083523"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nobuyuki</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I agree vram is a bit of an issue :s will have a think on that. A for creating a new line, I THINK, although unpredictable, creating a previously unwritten line of text isnt much slower than the std method of drawing single chars to the screen. The problem occurs when the lists start filling up and it has to search though a load to find the correct string. <br></div><br><br>could be one particular place where a splay tree automatically pruned to a set maximum might improve performance, if you really need to cache stuff like that. <br><br></td></tr></table><br>
<a name="2083530"></a>

<a name="2083531"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think this can't be right:<br><pre class=code>	Method CreateLineImage:Image(Line:String)
		Local Img2:Image = CreateImage(Line.Length * FontHeight, FontHeight)
		Local XPos = 0
		For Local i:Int = EachIn Line.ToChars()
			Local Data:Int[] = ChangeColor(CharData[i])
			Img2.WritePixels(Data, XPos, 0, FontHeight, FontHeight)
			XPos = XPos + CharWidth[i]
		Next
		Return Img2
	End Method</pre><br>Why are you using the FontHeight * Line.Length to determine image size? Each character can have different width, and there are fonts that can be wider than higher, also, you could be reserving too much room and wasting resources in narrow or condensed fonts<br><br>Also,how are you handling fonts with overlapping characters like this one:<br>http://www.dafont.com/en/holiday-home.font?text=Overlapping+Chars&amp;psize=l&amp;back=theme (btw, this forum does not like this link? )<br>I see no way a difference between char drawing width and char horizontal kerning, it would be nice if the font description that is generated could provide this information or, if you're not doing it like this way, is there anything I'm missing? I'm curious, and I haven't bothered reading the txt font parser, as it seems there are too many numbers for my liking (like in FontMachine!) <br><br></td></tr></table><br>
<a name="2083527"></a>

<a name="2083528"></a>

<a name="2083529"></a>

<a name="2083526"></a>

<a name="2083525"></a>

<a name="2083533"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Also,how are you handling fonts with overlapping characters like this one: <br></div><br>Quick screenie:<br><img src="https://dl.dropboxusercontent.com/u/35103024/ScreenShots/pixelfont.png"><br><br>Yeah its not perfect, how does FontMachine handle them?<br><br>Also if you haven't seen I've created a module to load in TTF for HTML5 and Android, but a full target solution would be great:<br><a href="http://www.monkeycoder.co.nz/Community/posts.php?topic=8190" target="_blank">http://www.monkeycoder.co.nz/Community/posts.php?topic=8190</a> <br><br></td></tr></table><br>
<a name="2083545"></a>

<a name="2083547"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Yeah its not perfect, how does FontMachine handle them? <br></div>By measuring character spacing in addition to character face image size. Current implementation does not support for negative values on character spacing, so overlapping that happens on the left of characters could get cut and I'm working on a fix for the next editor version, but more regular ones (at the right of each character) are currently properly measured so script with legatto fonts are supported. You need to keep separate information for both the image itself, and the offset at which next character is meant to be drawn.<br><br>EDIT: Here's an old sample of a script font under FontMachine <a href="http://www.jungleide.com/fontmachine/demo01/MonkeyGame.html" target="_blank">http://www.jungleide.com/fontmachine/demo01/MonkeyGame.html</a> <br><br></td></tr></table><br>
<a name="2083566"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >chrisc2977</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Right! Thank for all the into and links :) will have a proper look at all this tonight :D<br>I feel inspired to make this much better lol <br><br></td></tr></table><br>
<a name="2083605"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >chrisc2977</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> God ttf files are a pain!<br>Im trying to parse one just using monkey ... So far I have just managed to extract the directory table and successfully listed all the table tags... only took a bunch of research and around 4 hrs :( This was done in html.<br>Am I right in thinking ':DataStream' works on all targets? if so. good. <br><br></td></tr></table><br>
<a name="2083617"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> God ttf files are a pain! <br></div>Yes they are! If you're taking thi route, you'll find (if I don't recall wrong) there are several formats for subpixel interpolation. I would plainly ignore this part if you really don't need this <br><br></td></tr></table><br>
<a name="2083624"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >chrisc2977</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> At the moment I can read the table tags, but their offset appears wrong :( maybe something to do with PeekInt instead of Long datatype :s <br><br></td></tr></table><br>
<a name="2083687"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >chrisc2977</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just figured out how the ttf file works, The numbers are unsigned and the bytes for the numbers are in reverse order! <br><br></td></tr></table><br>
<a name="2083680"></a>

<a name="2083679"></a>

<a name="2083688"></a>

<a name="2083689"></a>

<a name="2083690"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >chrisc2977</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Managed to get as far as loading up all the data in the 'name' table - this was in html so I think it should work on most targets?<br>I managed to make functions to extract unsigned floats and ints from a Big edian datasrteam! :)<br>Tested with oft and ttf files<br>Next is to extract the other tables and try to do something with them... :s<br><br><img src="http://www.challenger-arts.com/wp-content/uploads/fontloaded.png"><br><br>ps. screenshot was a test using a completly unmodified .ttf plonked straight into the data folder :D <br><br></td></tr></table><br>
<a name="2083694"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DruggedBunny</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nice work... I fear your task is monumental if you're going to try and render TTF by hand, but that's still an impressive result for only a few hours' effort! I wouldn't even have thought we could do such low-level file-parsing in HTML5... hmmm... <br><br></td></tr></table><br>
<a name="2083695"></a>

<a name="2083696"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >chrisc2977</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just about... Im pretty much at the limit if not beyond my skill level lol I diddnt even know what an unsigned int was before today! Learning as I go. <br>All kudos to monkey for being so versitile :)<br>Ill post code when I have the file completly parsed, so hopefully if I cant work out how to draw the font, all the data will be availible from the file for someone more skilled to have a go! <br><br></td></tr></table><br>
<a name="2083697"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Beaker</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Chris - your demo in the first post repeatedly crashes Safari on my iPad 2 after running for about 10 seconds. Runs about 8 fps. I rarely see a crash like this on iOS. <br><br></td></tr></table><br>
<a name="2083726"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >chrisc2977</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Beaker - I must have a leak somewhere :s, thanks <br><br></td></tr></table><br>
<a name="2083727"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >nikoniko</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>What is about international chars?<br><br>I generated font from arial.ttf, put some russian text to TextOut() and got error in the browser<br><br><div class="quote"> Monkey Runtime Error : Array index out of range<br>D:/MonkeyPro/NikoGames/pixelfont/Examples/pixelfont.monkey&lt;110&gt;<br>D:/MonkeyPro/NikoGames/pixelfont/Examples/pixelfont.monkey&lt;63&gt;<br>D:/MonkeyPro/NikoGames/pixelfont/Examples/Test.monkey&lt;39&gt;<br>D:/MonkeyPro/modules/mojo/app.monkey&lt;113&gt;<br><br> <br></div> <br><br></td></tr></table><br>
<a name="2083739"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >chrisc2977</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> Heres the code so for for parsing a ttf file.<br><a href="http://www.challenger-arts.com/wp-content/uploads/TFont.zip" target="_blank">http://www.challenger-arts.com/wp-content/uploads/TFont.zip</a><br><br>tables done are: name, head, cmap<br>I am really struggling to get the right glyph offsets/table data, but the rest seems to load ok :( <br><br></td></tr></table><br>
<a name="2083825"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >chrisc2977</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just managed to get it to retrieve the <b>correct</b> Glyph Id for a given unicode :) <br>I was having loads of trouble until I noticed I was feeding it int char codes lol not unicode chars. *Oops<br>I re-wrote the parser as well, including a 'Datastream' Class and improved the way it handles unsigned data<br>Next will be to get the glyph Id fot each glyph, find its location in the loca table and retrieve the x and y points in the glyph table.<br><br>Anyone got any ideas on how to handle the xy point data and to create letter filled shapes??? bezier curves? <br><br>Getting there slowly <br><br></td></tr></table><br>
<a name="2083857"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> These pages might help:<br><br><a href="http://www.microsoft.com/typography/otspec/TTCH01.htm" target="_blank">http://www.microsoft.com/typography/otspec/TTCH01.htm</a><br><a href="http://www.microsoft.com/typography/otspec/glyf.htm" target="_blank">http://www.microsoft.com/typography/otspec/glyf.htm</a> <br><br></td></tr></table><br>
<a name="2083919"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >CopperCircle</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Chris, check out my SVG parser, it has some functions for drawing the points, I have been experimenting with rendering SVG fonts.<br><br><a href="http://www.monkeycoder.co.nz/Community/posts.php?topic=7898" target="_blank">http://www.monkeycoder.co.nz/Community/posts.php?topic=7898</a> <br><br></td></tr></table><br>
<a name="2083935"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >chrisc2977</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks guys, very helpful :)<br>Im at a stage now where I can render the outline points onto the screen :)<br>I.e I have successfully managed to extract char glyph data :D and it gives me corner points / curve points for each letter<br>Did not think I would get this far at all! <br><br></td></tr></table><br>
<a name="2083937"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >chrisc2977</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> Quick Screenie showing the char verticies and joined by 'DrawLine'<br>(Not the final way the ttf chars will be drawn, just a representation showing that the verticies are in the right place)<br><br><img src="http://www.challenger-arts.com/wp-content/uploads/tfont2.jpg"> <br><br></td></tr></table><br>
<a name="2083936"></a>

<a name="2084229"></a>

<a name="2084230"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >chrisc2977</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok... Progress!<br>I have just managed to get it to work out the angles of all the points in the outline of each glyph and work out if they are interior/exterior angles (convex/concave)<br>ready for triangulation :D <br>I think I have set up the contours right for triangulation that will exclude interior contours... I think...<br><br>I also re-wrote the datastream class, and altered the font loading code, so the entire font loads almost instantly (all glyphs, their outline data and working out the angle stuff) <br><br></td></tr></table><br>
<a name="2084233"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> Excellent! Looking forward to see how you progress with this... I looked at the TTF format and decided it wasn't for me to even try to load it into MonkeyX, so I congratulate you on your work so far :) <br><br></td></tr></table><br>
<a name="2084252"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DruggedBunny</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wow, I'm amazed even at that... really well done. <br><br></td></tr></table><br>
<a name="2085644"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >chrisc2977</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> A bit of a breakthrough :)<br><br>Image below shows text drawn from three different ttf files loaded directly from the data folder at runtime :) no external program needed to convert beforehand!<br>Also , as you can see from the middle font it also handles left side bearing and advance width :)<br><br><img src="http://www.challenger-arts.com/wp-content/uploads/tfont21.jpg"><br><br>As you can see in the top font there is a slight line where they are triangulated, think this is due to antialias? will have to look into this.<br><br>Next up is to use a bezier curve style method to smooth the rounded edges.<br><br>At the moment this can only handle ttf outlines and NOT otf outlines hopefully I can implement this too at some point <br><br></td></tr></table><br>
<a name="2085631"></a>

<a name="2085630"></a>

<a name="2085629"></a>

<a name="2085632"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#32">[#32]</a></td></tr></table></td></tr><tr ><td class="posttext"> That's awesome! keep up the good work! Are you handling UTF chars in any way? Great module! <br><br></td></tr></table><br>
<a name="2085633"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#33">[#33]</a></td></tr></table></td></tr><tr ><td class="posttext"> Excellent! What targets will support this in the end? <br><br></td></tr></table><br>
<a name="2085645"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >chrisc2977</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#34">[#34]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks :)<br><br>@ziggy<br>I think it handles UTF, from my limited understanding. Depending on the ttf file obiously, it looks up the glyphId from extended ascii , I managed to get the copyright symbol to display, is that utf?<br><br>@therevills<br>The only imports are mojo and brl.databuffer<br>Is this compatible with most targets? (I purposely DID NOT use datastream) <br><br></td></tr></table><br>
<a name="2085643"></a>

<a name="2085646"></a>

<a name="2085647"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#35">[#35]</a></td></tr></table></td></tr><tr ><td class="posttext"> Try some japanese text on a font that supports it: 世界こんにちは！(that's hello world!) <br><br></td></tr></table><br>
<a name="2086116"></a>

<a name="2086117"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >chrisc2977</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#36">[#36]</a></td></tr></table></td></tr><tr ><td class="posttext"> <img src="http://www.challenger-arts.com/wp-content/uploads/ttfexample.jpg"><br><br>Starting to look like it should now :)<br>I really want to have a crack at otf fonts and ttf fonts with ot outlines before release, as currently this only loads ttf files with tt outlines.<br>Also looks smooth as hell on flash and html, but due to triangulation of concave polys it looks a bit bitty on other targets. Dont know what to do about this.<br><br>Next update I will probably start a new thread as the heading 'pixel font' is a bit misleading now. <br><br></td></tr></table><br>
<a name="2086110"></a>

<a name="2086112"></a>

<a name="2086113"></a>

<a name="2086180"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#37">[#37]</a></td></tr></table></td></tr><tr ><td class="posttext"> Top job :) Any chance of the source code? I'm very interested in seeing it running on my Android devices. <br><br></td></tr></table><br>
<a name="2086532"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >chrisc2977</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#38">[#38]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="http://www.challenger-arts.com/wp-content/uploads/tfont.zip" target="_blank">http://www.challenger-arts.com/wp-content/uploads/tfont.zip</a><br><br>For flash and html5 I know I can use the inbuilt drawpoly without my triangulation, but I wanted you to see how much faster it is to triangulate on html5/flash rather than android.<br>It takes 600ms on html and 26000ms on my android. And I dont know why :(<br><br>Other than that. I have a working ttf loader and drawer. How to below.<br><br><pre class=code>Import tfont
Global MyFont:TFont

MyFont = New TFont(Path:String, PixelHeight,[R, G, B])

MyFont.DrawText(Text:String, X, Y, CenterX=0, CenterY=0, AdditionalLetterSpace=0, AdditionalLineSpace=0)

MyFont.TextWidth(Text:String, AdditionalLetterSpace=0)

MyFont.TextHeight(Text:String, AdditionalLineSpace = 0)</pre><br><br>Any help appreciated. <br><br></td></tr></table><br>
<a name="2086538"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#39">[#39]</a></td></tr></table></td></tr><tr ><td class="posttext"> Are you creating garbage on the calculations? This could be the first thing to look at. <br><br></td></tr></table><br>
<a name="2086572"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Samah</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#40">[#40]</a></td></tr></table></td></tr><tr ><td class="posttext"> There's an insane amount of Lists being created there, and some programming patterns that can be done much more efficiently without resizing arrays.  I had a quick go at changing these and managed to halve the time on HTML5 (haven't tried Android yet).  I'm pretty sure if I have some time tonight I could cut that down to a few milliseconds on both targets.<br><br>Something else you should do is to avoid the List class like the plague.  Use Stack instead, because it uses an internal array rather than node objects.<br><br>Personally I wouldn't bother splitting xyList into XArr and YArr, I'd just index it with [i*2] and [i*2+1].<br><br>Reversing the arrays can be done like this:<br><pre class=code>For Local i:Int = 0 Until XArr.Length / 2
	Local temp:Float = XArr[i]
	XArr[i] = XArr[XArr.Length-i-1]
	XArr[XArr.Length-i-1] = temp
	temp = YArr[i]
	YArr[i] = YArr[YArr.Length-i-1]
	YArr[YArr.Length-i-1] = temp
Next</pre><br><br>Edit: Summary:<br>* Don't split xyList, just access it with [i*2] and [i*2+1].<br>* Don't reverse the array, just loop backwards when drawing it.<br>* Don't shrink the array when removing points, just keep track of how many elements are in use.<br>* Use Stack anywhere you would have used List.<br>* Avoid Resize as much as possible.  Take a guess at the size and Resize*2 if it needs to increase (Stack will do this for you automatically).<br><br>Edit 2:<br>I went through and rewrote a heap of the tesselation stuff and managed to get about a 5x speed improvement on HTML5.  Android is still a bit slow, but not unbearably so.  I'm sure there's more optimisation I can do. <br><br></td></tr></table><br>
<a name="2086562"></a>

<a name="2086561"></a>

<a name="2086560"></a>

<a name="2086559"></a>

<a name="2086580"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Aman</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#41">[#41]</a></td></tr></table></td></tr><tr ><td class="posttext"> Might not be that effective but you could try it and see if it would help or not.<br><br>instead of this:<br><pre class=code>
'Set Alpha &amp; Color
For Local i:Int = 0 Until pixels.Length
	Local argb:Int = pixels[i]
	Local a:Int = (argb Shr 24) &amp; $ff
	Local r:Int = (argb Shr 16) &amp; $ff
	Local g:Int = (argb Shr 8) &amp; $ff
	Local b:Int = argb &amp; $ff
	a = 255 - r
	r = Color[0]
	g = Color[1]
	b = Color[2]
	argb = (a Shl 24) | (r Shl 16) | (g Shl 8) | b
	pixels[i] = argb
Next
</pre><br>you could have this:<br><pre class=code>
'Set Alpha &amp; Color
For Local i:Int = 0 Until pixels.Length
	'if pixel is white, then make it transparent, otherwise set the color
	if pixels[i] = $FFFFFFFF Then pixels[i] = $00000000 Else pixels[i]=$FF000000 | (Color[0] Shl 16) | (Color[1] Shl 8) | Color[2]
Next
</pre><br><br>Great work by the way. <br><br></td></tr></table><br>
<a name="2086579"></a>

<a name="2086578"></a>

<a name="2086577"></a>

<a name="2086576"></a>

<a name="2086595"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >CopperCircle</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#42">[#42]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is great and coming along really well, good work!<br><br>Edit:<br>Having a look through the code it seems you are scaling the matrix when drawing the polys to get the correct font size, this is giving the fonts a jagged edge.  Maybe we could look at a way to scale and reposition the poly so every stays smooth? <br><br></td></tr></table><br>
<a name="2086592"></a>

<a name="2086613"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >chrisc2977</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#43">[#43]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wow Samah! 5x, using your suggestions I managed to get 2x and cound not fathom how to do better than that :)<br>I dont suppose you could let me have the code :) ill be stumbling around for weeks otherwise!<br><br>I also did a test, seeing the time it took for android to only parse the ttf file and it looks like its struggling (thats without triangulating and drawing to image) :s so there's something in there that android doesnt like! I will have to look deeper into this now.<br><br>Thanks for the invaluable help all! <br><br></td></tr></table><br>
<a name="2086611"></a>

<a name="2086704"></a>

<a name="2086705"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nobuyuki</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#44">[#44]</a></td></tr></table></td></tr><tr ><td class="posttext"> @297chrisc<br><br>if there's 2 things android doesn't like, it's  1. creating tons of new objects in block scope only to have to run a GC inside a loop,  and 2.  string manipulation outside of a stringbuilder.  Make sure you're not playing games with immutable strings by using monkey's built-in operator appending in a loop, things like that.  Each time you modify a string, you create a new one (because strings are immuatable), and that means doing it in a loop goes back to problem 1.  More thrash causes runaway load times.  Instead, in some of those places, if you have raw char data, manipulate an int array instead, and build a string FromChars at the end. <br><br></td></tr></table><br>
<a name="2086714"></a>

<a name="2086715"></a>

<a name="2086716"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Samah</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#45">[#45]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> @297chrisc: I dont suppose you could let me have the code :) ill be stumbling around for weeks otherwise! <br></div><br><a href="https://dl.dropboxusercontent.com/u/20511758/tfonttesselate.monkey" target="_blank">https://dl.dropboxusercontent.com/u/20511758/tfonttesselate.monkey</a><br>:)<br><br>Edit 2: Cleaned up source code and updated link.<br><br>Summary of changes:<br>Triangles is now a Stack instead of a List<br>Removed XArr and YArr arrays.<br>CleanUp has been renamed to BuildPoints and pushes all the X,Y values to a global Stack called "points".<br>Clockwise is now calculated before BuildPoints so that the points can be added in reverse (rather than reversing the list afterward).<br>All references to XArr and YArr now reference points.Get(p*2) and points.Get(p*2+1) instead.<br><br>Note that I made points Global because it's unused once the Triangles list is built, so we can reuse it later without having to create another Stack. <br><br></td></tr></table><br>
<a name="2086706"></a>

<a name="2086707"></a>

<a name="2086709"></a>

<a name="2086712"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >chrisc2977</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#46">[#46]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, I have rewritten a bit of the loading stuff.<br>html and flash is now smooth like the image posted #36<br>I have greatly reduced Parsing times : for loading a singe font is around:<br>html5: 41ms<br>flash: 81ms<br>desktop: 10ms<br>android: 600ms<br><br>which is now acceptable ( just about for android, but I cant get it any lower lol)<br><br>All that remains is the tessalation/triangulation for non html/flash targets.<br>I have been trying most of day with no sucess :( it either doesnt work or is unbearably slow.<br><br>[Edit]<br>Just seen a post from Samah, Works like a charm :) Thank you!!<br>Android now loads a font in around 4 secs (it was 26!)<br><br>I will put an update up tomorrow evening <br><br></td></tr></table><br>
<a name="2086708"></a>

<a name="2086770"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#47">[#47]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just to highlight in case you didn't see it, Samah updated his post again (I reckon another post would have been fine and easy to spot ;)):<br><b>Samah writes</b><br><div class="quote"> <a href="https://dl.dropboxusercontent.com/u/20511758/tfonttesselate.monkey" target="_blank">https://dl.dropboxusercontent.com/u/20511758/tfonttesselate.monkey</a><br>:)<br><br>Edit 2: Cleaned up source code and updated link.<br><br>Summary of changes:<br>Triangles is now a Stack instead of a List<br>Removed XArr and YArr arrays.<br>CleanUp has been renamed to BuildPoints and pushes all the X,Y values to a global Stack called "points".<br>Clockwise is now calculated before BuildPoints so that the points can be added in reverse (rather than reversing the list afterward).<br>All references to XArr and YArr now reference points.Get(p*2) and points.Get(p*2+1) instead.<br><br>Note that I made points Global because it's unused once the Triangles list is built, so we can reuse it later without having to create another Stack.<br> <br></div> <br><br></td></tr></table><br>
<a name="2086838"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >chrisc2977</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#48">[#48]</a></td></tr></table></td></tr><tr ><td class="posttext"> Creating new thread due to 'pixel font' title not really applicable<br><a href="http://www.monkey-x.com/Community/posts.php?topic=8470#86837" target="_blank">http://www.monkey-x.com/Community/posts.php?topic=8470#86837</a> <br><br></td></tr></table><br>
<a name="2086833"></a>

<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
