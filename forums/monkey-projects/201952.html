<!DOCTYPE html><html lang="en" ><head ><title >HTML5 Diffusion FX</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >HTML5 Diffusion FX</h1><a href="forums.php" >Monkey Archive Forums</a>/<a href="topics.php?forum=511" >Monkey Projects</a>/<a href="#bottom" >HTML5 Diffusion FX</a><br><br>
<a name="2019052"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Richard Betson</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> HTML5 - Diffusion FX<br><br>This is a diffusion effect done with Monkey an 'impixi's' canvas wrapper. It should hopefully hit the max 30 fps on your browser. Let me know how it works. :) It will cycle through five effects's.<br><br><a href="http://redeyeware.uphero.com/monkey/HTML5_diffusion_example/html5/HTML5_Diffusion_Example.html" target="_blank">http://redeyeware.uphero.com/monkey/HTML5_diffusion_example/html5/HTML5_Diffusion_Example.html</a><br><br>I'll post some code soon.<br><br>-=&gt; - EDIT -<br><br>&gt;Source code listed below.&lt;<br><br>Here is a new version of this demo with optimization's to math and display. Hit 'F1' to change the screen to 1/4 size or 1/4 x 4 (quad) and full size with four modes of quality (pixel dropout). Hit 'F2' to toggle/change the display to a wide (mid third) of full size.<br><br>Hopefully this will run a bit faster.<br><br><a href="http://redeyeware.uphero.com/monkey/HTML5_diffusion_example_2/html5/HTML5_Diffusion_Example.html" target="_blank">http://redeyeware.uphero.com/monkey/HTML5_diffusion_example_2/html5/HTML5_Diffusion_Example.html</a><br><br>Thanks for testing. :p <br><br></td></tr></table><br>
<a name="2018692"></a>

<a name="2018576"></a>

<a name="2018577"></a>

<a name="2018580"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shinkiro1</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> 25 fps on Safari. Nice effects though. <br><br></td></tr></table><br>
<a name="2018581"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >okee</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> 31 fps in chrome, nice effects <br><br></td></tr></table><br>
<a name="2018582"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DruggedBunny</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Solid 31 FPS here. Good to see this stuff is workable! <br><br></td></tr></table><br>
<a name="2018584"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Beaker</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Solid 3 fps on my iPad2 but it works. :) <br><br></td></tr></table><br>
<a name="2018585"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I got 5 FPS on my Celeron PC from 2003,<br>looks great <br><br></td></tr></table><br>
<a name="2018587"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bruZard</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> 31FPS in FF and Chrome. Really nice FX! <br><br></td></tr></table><br>
<a name="2018588"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TheRedFox</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> 21 FPS on Chrome on my Core Duo. <br><br></td></tr></table><br>
<a name="2018597"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >CopperCircle</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> 31 FPS on IE9 on my VAIO Z1 <br><br></td></tr></table><br>
<a name="2018600"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >matty</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Steady 29fps on Chrome on my work pc (not sure of specs). <br><br></td></tr></table><br>
<a name="2018603"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Armitage1982</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> 8 FPS on Chrome and on my Acer Aspire One D255 (but the Atom N550 is not the fastest thing around ;).<br>Nice one <br><br></td></tr></table><br>
<a name="2018609"></a>

<a name="2018610"></a>

<a name="2018611"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >wiebow</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> 1 FPS on my ASUS Transformer tablet. I doubt the browser is up to it though.<br><br>31 FPS on my laptop with Chrome. Nice! <br><br></td></tr></table><br>
<a name="2018615"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Floyd</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> 31 FPS with Chrome, but only 6 with IE 9. <br><br></td></tr></table><br>
<a name="2018616"></a>

<a name="2018617"></a>

<a name="2018618"></a>

<a name="2018619"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Samah</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> iPad2 (Safari): 3 fps<br>iPad2 (iCabMobile): 1 fps<br>iPod Touch (Safari): 4 seconds per frame...<br>iPod Touch (iCabMobile): 4 seconds per frame...<br>Xoom (Default Browser): 1 fps<br>Xoom (Dolphin Browser HD): 1 fps<br>Xoom (Firefox): 4 fps<br>Desire HD (Default Browser): 5 seconds per frame...<br>Desire HD (Dolphin Browser HD): 4 seconds per frame...<br>PC (Firefox 8): 30 fps with occasional stuttering (might be other tabs lagging it)<br>PC (Chrome 15): 30 fps<br>PC (IE8): Nothing... XD<br><br>Specs are in my sig. <br><br></td></tr></table><br>
<a name="2018637"></a>

<a name="2018638"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >impixi</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Looks like the tablet and mobile platforms' browsers do not yet feature hardware acceleration for the HTML5 canvas object. That or they just lack the  power regardless. A shame. <br><br></td></tr></table><br>
<a name="2018639"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Neuro</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> 13in 2011 MacBook Pro on Firefox - 31 FPS<br>iPad 2 - 1 FPS<br>iPhone 4s - Staggering 1 FPS <br><br></td></tr></table><br>
<a name="2018676"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AdamRedwoods</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Looks like the tablet and mobile platforms' browsers do not yet feature hardware acceleration for the HTML5 canvas object. That or they just lack the power regardless. A shame.  <br></div><br>I expected better from iPad with all the anti-Flash touting.... a shame indeed. <br><br></td></tr></table><br>
<a name="2018682"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Volker</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Samsung Galaxy Tab Android 7" 1Ghz<br>(Default Browser): 1 fps<br>(Dolphin Browser): 1 fps<br>(Firefox): 3 fps <br><br></td></tr></table><br>
<a name="2018691"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Richard Betson</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wow,<br><br>Cool to see this tested on so many different devices.:)<br><br>Here is a new version of this demo with optimization's to math and display. Hit 'F1' to change the screen to 1/4 size or 1/4 x 4 (quad) and full size with four modes of quality (pixel dropout). Hit 'F2' to toggle/change the display to a wide (mid third) of full size.<br><br>Hopefully this will run a bit faster.<br><br><a href="http://redeyeware.uphero.com/monkey/HTML5_diffusion_example_2/html5/HTML5_Diffusion_Example.html" target="_blank">http://redeyeware.uphero.com/monkey/HTML5_diffusion_example_2/html5/HTML5_Diffusion_Example.html</a><br><br>Thanks for testing. :p <br><br></td></tr></table><br>
<a name="2018742"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Beaker</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> 4fps on iPad2 now. Yay! <br><br>AdamRedwoods - I suspect Flash running the same app (without using Alchemy) on a similar specced Android device would yield similar results, ie. a low fps. This effect  is quite demanding. <br><br></td></tr></table><br>
<a name="2018769"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Richard Betson</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> ^This effect is all 2D (pixel writes), so it looks as if tablets and mobile devices are out. It 'does run well' on a PC or Mac desktop/laptop but even then should have couple of cores and descent video.<br><br>I am impressed by the speed at which I can write to a canvas using 'impixi's' mod. As soon as I see a clear path for webGL and Monkey I am pretty sure I could do this effect on a mobile device (phone/tablet) at a reasonable fps. <br><br></td></tr></table><br>
<a name="2019051"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Richard Betson</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here is the source code for this project. Enjoy :p<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">

'******************************************************************
'* Diffusion Example
'* Author: Richard R Betson
'* Date: 11/25/11
'* Language: Monkey
'* Target: HTML5						  
'******************************************************************
' Linsence - Public Domain
'******************************************************************
' Web Site - <a href="http://redeyeware.uphero.com" target="_blank">http://redeyeware.uphero.com</a>
'******************************************************************
' Canvas Wrapper Mod by Impixi - <a href="http://www.monkeycoder.co.nz/Community/posts.php?topic=1885" target="_blank">http://www.monkeycoder.co.nz/Community/posts.php?topic=1885</a>
'******************************************************************


Import monkey
Import mojo
Import canvaswrapper

Global flag=0
Global clra:Int
Global ang_index_1:Int[360],ang_index_2:Int[360],ang_index_3:Int[360],ang_index_4:Int[360]


Function Main()
	New Diffusion
End Function



Class Diffusion Extends App
Field imd:ImageData


Global fps,fp,fps_t
Global mapx:Int[77900]
Global mapx1:Int[77900]
Global mapx2:Int[77900]
Global mapx3:Int[77900]
Global mapx4:Int[77900]

Global clrr:Int[77900]
Global clrb:Int[77900]

Global clrr1:Int[77900]
Global clrb1:Int[77900]

Global ii
Global fxsel_ttl
Global fxsel

Global fred:Int=1,fblue:Int=2
Global qtext:String="Highest Quality",qt:Int=3,widetext:String=""

Global xa:Int=1,xb:Int=319,ya:Int=1,yb:Int=239



	Method OnCreate()
		fxsel_ttl=Millisecs()+16000
		SetUpdateRate(60)
		SetLookUp()
		imd = xCanvas.CreateImageData(640,480)'640,480)
Local i2:Int
	For i2=0 To 359
		ang_index_1[i2]=(160 + (Sin(i2)*40) )
		ang_index_2[i2]=(120 + (Cos(i2)*40) )
		ang_index_3[i2]=(160 + (-Sin(i2)*40) )
		ang_index_4[i2]=(120 + (-Cos(i2)*40) )
	Next

	End Method
	
	
	Method OnUpdate()
		If KeyHit(KEY_F1)
		For Local y=0 To 240
			'Local y1:Int=320 *y
			For Local x= 0 To 320
				xCanvas.SetImageDataPixel(imd, x*2,(y*2), 0, 0, 0, 255)
				xCanvas.SetImageDataPixel(imd, (x*2)+1,(y*2) ,0, 0, 0, 255)
				xCanvas.SetImageDataPixel(imd, (x*2),((y*2)+1), 0, 0, 0, 255)
				xCanvas.SetImageDataPixel(imd, ((x*2)+1),((y*2)+1) ,0, 0, 0, 255)
			Next
		Next
'Cls		
			qt=qt+1
			If qt&gt;5 Then qt=0
			If qt=0 Then qtext="Low Quality"
			If qt=1 Then qtext="Med Quality"
			If qt=2 Then qtext="Med-High Quality"
			If qt=3 Then qtext="Highest Quality"
			If qt=4 Then qtext="1/4 Screen H-Quality"	
			If qt=5 Then qtext="1/4 Screen x 4 H-Quality"
		Endif
		


		If KeyHit(KEY_F2)
			For Local y=0 To 240
				'Local y1:Int=320 *y
				For Local x= 0 To 320
					xCanvas.SetImageDataPixel(imd, x*2,(y*2), 0, 0, 0, 255)
					xCanvas.SetImageDataPixel(imd, (x*2)+1,(y*2) ,0, 0, 0, 255)
					xCanvas.SetImageDataPixel(imd, (x*2),((y*2)+1), 0, 0, 0, 255)
					xCanvas.SetImageDataPixel(imd, ((x*2)+1),((y*2)+1) ,0, 0, 0, 255)
				Next
			Next
	
			If widetext=""
				ya=60
				yb=180
				widetext="WIDE -"
			Else
				ya=1
				yb=239
				widetext=""
			Endif
		Endif





		If fxsel_ttl&lt;Millisecs()
			fxsel=fxsel+1
			fxsel_ttl=Millisecs()+14000
			If fxsel&gt;4 Then fxsel=0
			Select fxsel
			Case 0
				fred=1
				fblue=2
				
			Case 1
				fred=50
				fblue=4
			Case 2
				fred=3
				fblue=3
			Case 3
				fred=2
				fblue=4
			Case 4
				fred=3
				fblue=4
		End Select


		Endif 
	

	End Method


	
	Method OnRender()

		fps=fps+1
		If fps_t&lt;Millisecs()
		fp=(fps)
		fps_t=1000+Millisecs()
		fps=0
		Endif
		
		ii=ii+1
		If ii&gt;359 Then ii=0
		
		Local x2:Int=ang_index_1[ii]
		Local y2:Int=ang_index_2[ii]
		Local x3:Int=ang_index_3[ii]
		Local y3:Int=ang_index_4[ii]
		
		'Draw Line
		LineB(160,120,x2,y2)
		LineB(160,120,x3,y3)
		
		For Local zz=0 To 100
			Local xz=Int(Rnd(50))+135
			Local yz=Int(Rnd(50))+95
			clrb1[ ( 320 *yz ) +xz ]=255
			
		Next


		For Local y=ya To yb
				Local y2:Int=(320 *y)
			For Local x= xa To xb 
				Local y1:Int=y2+x
				'Apply mapping via lookup table
				If fxsel=0
				clrr[  y1  ] = clrr1[ mapx[ y1 ] ]
				clrb[  y1  ] = clrb1[ mapx[ y1 ] ]
				Else If fxsel=1
				clrr[  y1   ] = clrr1[ mapx1[ y1  ] ]
				clrb[  y1   ] = clrb1[ mapx1[ y1  ] ]
				Else If fxsel=2
				clrr[  y1   ] = clrr1[ mapx2[ y1  ] ]
				clrb[  y1   ] = clrb1[ mapx2[ y1  ] ]
				Else If fxsel=3
				clrr[  y1   ] = clrr1[ mapx3[ y1  ] ]
				clrb[  y1   ] = clrb1[ mapx3[ y1  ] ]
				Else If fxsel=4
				clrr[  y1   ] = clrr1[ mapx4[ y1  ] ]
				clrb[  y1   ] = clrb1[ mapx4[ y1  ] ]
				Endif

			Next
		Next



Local sumr,sumb,b,r

		For Local y=ya To yb
			Local y1:Int=320 *y
			Local yn1:Int=y*2
			For Local x= xa To xb
				Local yn2:Int=y1+x
				'Blur Image and Fade Color
				
				r=clrr[yn2]
				sumr = ((r*4) + clrr[ yn2+1   ] + clrr[ yn2-1   ] + clrr[ ( y1-1 ) + x   ] + clrr[ ( y1+1 ) + x   ] ) Shr 3  
				
				b=clrb[yn2]
				sumb = ((b*4) + clrb[ yn2+1   ] + clrb[ yn2-1   ] + clrb[ ( y1-1 ) + x   ] + clrb[ ( y1+1 ) + x   ] ) Shr 3 
					
				r=sumr-fred
				b=sumb-fblue
				

				If r&lt;0 Then r=0
				If r&gt;255 Then r=255
				If b&lt;0 Then b=0
				If b&gt;255 Then b=255

				
				clrr1[ yn2 ]=r
				clrb1[ yn2 ]=b



				Local xn1:Int=x*2
				
				If qt=0
						xCanvas.SetImageDataPixel(imd, xn1,yn1, r, 0, b, 255)					
					Else If qt=1
						xCanvas.SetImageDataPixel(imd, xn1,yn1, r, 0, b, 255)					
						xCanvas.SetImageDataPixel(imd, xn1,yn1+1, r, 0, b, 255)
					Else If qt=2
						xCanvas.SetImageDataPixel(imd, xn1,yn1, r, 0, b, 255)
						xCanvas.SetImageDataPixel(imd, xn1+1,yn1 ,r, 0, b, 255)
						xCanvas.SetImageDataPixel(imd, xn1,yn1+1, r, 0, b, 255)					
					Else If qt=3
						xCanvas.SetImageDataPixel(imd, xn1,yn1, r, 0, b, 255)
						xCanvas.SetImageDataPixel(imd, xn1+1,yn1 ,r, 0, b, 255)
						xCanvas.SetImageDataPixel(imd, xn1,yn1+1, r, 0, b, 255)
						xCanvas.SetImageDataPixel(imd, xn1+1,yn1+1 ,r, 0, b, 255)
					Else If qt=4
						xCanvas.SetImageDataPixel(imd, x,y, r, 0, b, 255)
					Else If qt=5
						xCanvas.SetImageDataPixel(imd, x,y, r, 0, b, 255)
						xCanvas.SetImageDataPixel(imd, (x+319),y ,r, 0, b, 255)
						xCanvas.SetImageDataPixel(imd, x,(y+239), r, 0, b, 255)
						xCanvas.SetImageDataPixel(imd, (x+319),(y+239) ,r, 0, b, 255)
					Endif


Next
Next

		
		
		xCanvas.DrawImageData imd, 0, 0
		DrawText("Hit F1/F2 Change Qualtity-Size/Wide Screen: "+widetext+" "+qtext,10,440)
		DrawText("HTML5 Diffusion - Richard Betson, <a href="http://redeyeware.uphero.com" target="_blank">http://redeyeware.uphero.com</a> - FPS:"+fp,10,460)

	End Method

	Function LineB(x1,y1,x2,y2)
		'Ported
		'Bresenham Line Algorithm 
		'Source - GameDev.Net - Mark Feldman
		'Public Domain
		
		Local deltax = Abs(x2 - x1)
		Local deltay = Abs(y2 - y1)  
		
		Local numpixels,d,dinc1,dinc2,xinc1,xinc2,yinc1,yinc2,x,y,i
		
		If deltax &gt;= deltay 
			numpixels = deltax + 1
			d = (2 * deltay) - deltax
			dinc1 = deltay Shl 1
			dinc2 = (deltay - deltax) Shl 1
			xinc1 = 1
			xinc2 = 1
			yinc1 = 0
			yinc2 = 1
		Else 
			numpixels = deltay + 1
			d = (2 * deltax) - deltay
			dinc1 = deltax Shl 1
			dinc2 = (deltax - deltay) Shl 1
			xinc1 = 0
			xinc2 = 1
			yinc1 = 1
			yinc2 = 1
		Endif
		
		If x1 &gt; x2
			xinc1 = -xinc1
			xinc2 = -xinc2
		Endif
		
		If y1 &gt; y2 
			yinc1 = -yinc1
			yinc2 = -yinc2
		
		Endif
		
		x = x1
		y = y1
		
		For i = 1 To numpixels 
			
			If d &lt; 0 
				d = d + dinc1
				x = x + xinc1
				y = y + yinc1
			Else
				d = d + dinc2
				x = x + xinc2
				y = y + yinc2
			Endif
			
			'Draw line 
			If x&gt;xa And x&lt;xb And y&gt;ya And y&lt;yb
				clrr1[ (( 320 *y )+x) ]=255
			Endif
			
		
		Next

	End Function

	
	Method SetLookUp()
	Local ang
	
	For Local lui=0 To 4
	
	ang=0
		For Local y=0 To 240
		
			For Local x= 0 To 320
				ang=0
				Local rad#=Abs((x-160)*(x-160)) + Abs( (y-120)  * (y-120) )
				If rad&gt;0
					rad= Sqrt(rad)
				Else
					rad=0
				Endif
				If rad=0 Then rad=1

				Local dx#=((x-160)/(rad))
				Local dy#=((y-120)/(rad))
				If lui=1
					rad= ( ( (  ((Sin(rad*.2)*29.5) ) * (  ((Cos(rad*.81)*9.5) ) ) ) )   )
		
					dx=(dx*Cos(ang) - dy*Sin(ang))
					dy=(dy*Cos(ang) + dx*Sin(ang))
		
					Local x1=Int(dx*rad)+(160)
					Local y1=Int(dy*rad)+(120)
		
					If y1&lt;1 Then y1=1
					If y1&gt;240 Then y1=240
					If x1&lt;1 Then x1=1
					If x1&gt;320 Then x1=320
					
					mapx1[ ( 320 *y ) +x ] = ( 320 *y1 ) +x1'Int(x1)
				Endif
				
				If lui=2
					'Free Float
					ang=1
					rad= 1-( ( rad- (Sin(rad*900)*-Cos(rad*900)*.5 )*3.1415926 ) *  (-Cos((3.1415926) ) )*.9  )
					Local x1=Int(dx*rad)+(160)
					Local y1=Int(dy*rad)+(120)
					x1= ( x1*Cos(ang) - y1*Sin(ang) )
					y1= ( x1*Sin(ang) + y1*Cos(ang) )
		
					If y1&lt;1 Then y1=1
					If y1&gt;240 Then y1=240
					If x1&lt;1 Then x1=1
					If x1&gt;320 Then x1=320
					
					mapx2[ ( 320 *y ) +x ] = ( 320 *y1 ) +x1
				Endif
				
				If lui=3
					rad= rad-(  (Sin(rad*PI)*3)- ((Cos(rad*PI)*3) )  )

					dx=(dx*Cos(ang) - dy*Sin(ang))
					dy=(dy*Cos(ang) + dx*Sin(ang))
		
					Local x1=Int(dx*rad)+(160)
					Local y1=Int(dy*rad)+(120)
		
					If y1&lt;1 Then y1=1
					If y1&gt;240 Then y1=240
					If x1&lt;1 Then x1=1
					If x1&gt;320 Then x1=320
					
					mapx3[ ( 320 *y ) +x ] = ( 320 *y1 ) +x1

				Endif
				If lui=0
					ang=-3

					Local yq:Int=y
					If yq&lt;=120
					rad= rad-(  (Sin(yq))    )
					rad= rad-(  (Cos(yq)) )
					Else
					rad= rad-(  (Sin((240-yq)) )    )
					rad= rad-(  (Cos((240-yq)) )    )
					Endif



					
					dx=(dx*Cos(ang) - dy*Sin(ang))
					dy=(dy*Cos(ang) + dx*Sin(ang))
		
					Local x1=Int(dx*rad)+(160)
					Local y1=Int(dy*rad)+(120)
		
					If y1&lt;1 Then y1=1
					If y1&gt;240 Then y1=240
					If x1&lt;1 Then x1=1
					If x1&gt;320 Then x1=320
					
					mapx[ ( 320 *y ) +x ] = ( 320 *y1 ) +x1



				Endif
				If lui=39
					'Orb
					rad= 2-( ( rad- (Sin(rad)*(Cos(rad)) )*3.1415926 ) *  (-Cos((3.1415926) ))*.97  )
					dx=(dx*Cos(ang) - dy*Sin(ang))
					dy=(dy*Cos(ang) + dx*Sin(ang))
		
					Local x1=Int(dx*rad)+(160)
					Local y1=Int(dy*rad)+(120)
		
					If y1&lt;1 Then y1=1
					If y1&gt;240 Then y1=240
					If x1&lt;1 Then x1=1
					If x1&gt;320 Then x1=320
					
					mapx3[ ( 320 *y ) +x ] = ( 320 *y1 ) +x1
				Endif
				If lui=4
					'Swirl
					 ang=-3
					rad= 1-( ( rad- (Sin(rad)*-Cos(rad)*.9 )*3.1415926 ) *  (-Cos((3.1415926) ) )*.9  )
					dx=(dx*Cos(ang) - dy*Sin(ang))
					dy=(dy*Cos(ang) + dx*Sin(ang))
		
					Local x1=Int(dx*rad)+(160)
					Local y1=Int(dy*rad)+(120)
		
					If y1&lt;1 Then y1=1
					If y1&gt;240 Then y1=240
					If x1&lt;1 Then x1=1
					If x1&gt;320 Then x1=320
					
					mapx4[ ( 320 *y ) +x ] = ( 320 *y1 ) +x1
			Endif

			
			Next
		Next
	Next
	
	End Method

End Class

</textarea><br><br>L8r,<br>- Rich - <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
