<!DOCTYPE html><html lang="en" ><head ><title >Harpl language</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Harpl language</h1><a href="forums.php" >Monkey Archive Forums</a>/<a href="topics.php?forum=511" >Monkey Projects</a>/<a href="#bottom" >Harpl language</a><br><br>
<a name="2025338"></a>

<a name="2025339"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> In the form of an academic/learning project I'm writing a language (compiler, assembler and VM) from scratch using Monkey. It is just a personal learning project, but I wish to get something usable at some point. The idea is to have a script language that is written in Monkey so it can provide scripting for a wide range of platforms without having to rewrite anything. The project is on very early status, but as this is a big project and I think others may find it interesting, I've opensourced the development. I'm sure it won't have any nice speed whenn used from JavaScript on an HTML5 application, but I'm curious to see how far it can go (if it goes anywhere at the end!)<br><br>The project page is here:<br><br><a href="http://code.google.com/p/harpl-project/" target="_blank">http://code.google.com/p/harpl-project/</a><br><br>Mainly, I have a proper lexer, a small limited expression compiler and a small idea of how the whole compilation process will be done and some draft ideas of the language virtual assembler/bytecode. Everything in the project is open source under the new BSD license, but not yet usable for anything. <br><br></td></tr></table><br>
<a name="2025340"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Xaron</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wow, that's awesome. Haven't looked at it yet but building an own language isn't that easy as it sounds. :) <br><br></td></tr></table><br>
<a name="2025373"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, it's long and complicated but that's where the fun begins. Also I need a big decent project to really stress test Jungle Ide, so all in all, I hope we'll get some useful things from this work. <br><br></td></tr></table><br>
<a name="2025371"></a>

<a name="2025372"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> interesting project, what kind of language will it be similar to?<br>BASIC? <br><br></td></tr></table><br>
<a name="2025390"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, my idea is it will be a very strict procedural basic, The idea is to produce a language that is easy to code with and easy to maintain and integrate into your own applications and APIs. Later I'll add arrays and I hope to be able to add some OO capabilities too, but time will tell. Now it understand something as simple as:<br><br><pre class=code>Var MyVariable as Integer = 45, MyVariable2 as Integer = MyVariable * 4, Another as String = 'Hello World!';</pre><br><br>Nothing that you can do with it! But it'll be (hopefully) growing slowly. Ideas are welcome of course, dev is open. Just take into account this is not meant to be faster than any other JIT languages or the like, this is a sort of personal research project, we'll see where it ends. <br><br></td></tr></table><br>
<a name="2025376"></a>

<a name="2025375"></a>

<a name="2027253"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've been making some progress and I'll soon have a first compilable Hello World! program. It's incredible the amount of work a simple VM compiler can have in its background. The good news is that I expect the current structure to allow a fast "grow" of the language itself (we'll see). I'm planing on adding functions soon in a way that any script can define and call a Monkey function, and also the Monkey host program will be able to call any Harpl function. (a sort of dynamic runtime link system will be required here).<br>Also, the whole engine can expose its global variables to Monkey and allow the host program to modify them.<br>I don't expect this language to be the fastest in the world, but I think it can perform quite decently on some targets as it is using direct memory addresses (internally arrays) to store its data instead of any reflection or hashtable approach. This should make data access quite fast, and data allocation is designed to be pre-measured on the compilation process, so it should be faster than some alternatives... we'll see... <br><br></td></tr></table><br>
<a name="2027349"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Managed to compile and run a Hello World! program. Incredible long process to just output a string but... it's starting to shape. Hope to have something usable soon. <br><br></td></tr></table><br>
<a name="2027629"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> The joy of complex-large developments. I've just realised I would need a template precompiler for Monkey in order to finish this in a sane way. Well.. Time for a small additional dev... I will make it also as part of the Harpl language project, but as a separate thing. <br><br></td></tr></table><br>
<a name="2030068"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> After using a template parser, everything has started to be faster.<br>Now the Harpl language is able to compile and execute programs that declare local variables of type Integer, String, Float or Boolean and it is able to make some basic arithmetic operations with the data. Hurray!<br><br>If anyone is needed a template parser for Monkey, this is mine:<br>[monkeycode]Import os<br>Global Error:Bool = False<br>Function Main()<br>	if AppArgs.Length&lt;&gt;2 Then<br>		PrintInfoHeader<br>		Print "Wrong parameters number."<br>		Return -1<br>	EndIf<br>	Local filePath:String = AppArgs[1]<br>	<br>	if filePath.StartsWith(".") or filePath.Contains(":") = false Then filePath = os.RealPath(filePath)<br>	<br>	if FileType(filePath)&lt;&gt;1 Then<br>		PrintInfoHeader<br>		Print "Wrong file. File was not found or it is not a file."<br>		Return -1<br>	endif<br>	<br>	Local text:String = LoadString(AppArgs[1])<br>	if text = "" Then<br>		PrintInfoHeader<br>		Print "File was empty"<br>		Return -1<br>	EndIf<br>	<br>	'Print "Parsing document: " + os.StripAll(filePath)<br>	'Print "Located at: " + GetDir(filePath )<br>	Print "Harpl-Monkey template parser."<br>	Print "Parsing " + filePath<br>	text = ParseDoc(text,GetDir(filePath))<br>	if Error = 0 then<br>		SaveString(text,filePath)<br>		Print "File properly parsed."<br>		Return 0<br>	Else<br>		Print "Error procesing source code. File was not modified"<br>		Return 4<br>	End if<br>End<br><br>Function PrintInfoHeader()<br>	Print "Monkey template parser for the Harpl source code."<br>	Print "This is a simple parser app, pass the file to be pre-compiled as the first paramter, and you're good to go!"<br>End<br><br>Function GetPath:String(file1:String, relative:String)<br>	Return os.RealPath(file1 + relative)<br>End<br><br>Function GetDir:String(filename:String)<br>	filename = filename.Replace("/","\")<br>	Local lastIndex:Int = filename.FindLast("\")<br>	Return filename[.. lastIndex+1]<br>End<br><br>Function ParseDoc:String(text:String, replaces:Replacer[], fileLocation:String, prefix:String, level:Int)<br>	Local lines:String[] = text.Split("~n")<br>	Local lines2:list.List&lt;String&gt; = new list.List&lt;String&gt;<br>	Local ignore:Int = 0<br>	For Local i:Int = 0 until lines.Length<br>		Local teststring:String = lines[i].Trim()<br>		if teststring.ToLower.StartsWith("'loadtemplate ") <br>			if ignore = 0 then<br>				'Print "Template load requested!"<br>				Local line:String = prefix+lines[i]<br>				For Local rep:Replacer = EachIn replaces<br>					line = line.Replace("{%" + rep.find.Trim + "%}",rep.replace.Trim)<br>				next<br>				lines2.AddLast(line)<br>				Local prefix2:String = prefix + lines[i][.. lines[i].Find("'")]<br>				local data:String[] = line.Trim.Split(",")<br>				Local repList:List&lt;Replacer&gt; = new List&lt;Replacer&gt;<br>				For Local i:Int = 1 until data.Length<br>					Local repData:String[] = data[i].Split("=")<br>					Local rep:Replacer = new Replacer<br>					if repData.Length = 2<br>						rep.find = repData[0]<br>						rep.replace = repData[1]<br>						repList.AddLast(rep)<br>					endif<br>				Next<br>				local repArray:Replacer[] = repList.ToArray()<br>				Local filelocation:String = os.RealPath(fileLocation + data[0][14..].Trim()).Replace("/","\")<br>				'Print "Requesting template located at: " + filelocation<br>				if level = 0 then lines2.AddLast(prefix2 + "'#Region Code generated by the Harpl-Monkey template. Loaded from: " +data[0][14..].Trim() )<br>				if FileType(filelocation) &lt;&gt;1 Then<br>					Print "The file [" + filelocation + "] can't be found."<br>					Error = true<br>				else<br>					lines2.AddLast(ParseDoc(LoadString(filelocation),repArray,GetDir(filelocation),prefix2,level+1))<br>				EndIf<br>				if level = 0 then lines2.AddLast(prefix2 + "'#End Region")<br>			endif<br>			ignore+=1<br>		<br>		ElseIf lines[i].Trim().ToLower = "'endtemplate"<br>			ignore-=1<br>		end<br>		if ignore = 0 Then <br>			Local line:String = prefix+lines[i]<br>			For Local rep:Replacer = EachIn replaces<br>				line = line.Replace("{%" + rep.find.Trim + "%}",rep.replace.Trim)<br>			next<br>			lines2.AddLast(line)<br>		endif<br>	Next<br>	Local result:String, first:Bool = true<br>	For Local s:String = eachin lines2<br>		if first Then<br>			result = s<br>			first = false<br>		else<br>			result = result + "~n" + s<br>		EndIf<br>	Next<br>	if ignore&lt;&gt;0 Then Error = true<br>	Return result<br>End<br><br>Class Replacer<br>	Field find:String<br>	Field replace:String<br>End<br><br>Function ParseDoc:String(text:String, fileLocation:String)<br>	Return ParseDoc(text,[], fileLocation,"",0)<br>End[/monkeycode]<br>It parser a document looking for 'loadtemplate sentence, and places or updates the source code contained in the template into the actual source code document. It has this syntax:<br><br>'LoadTemplate myfile.monkey, argument1 = value, argument2 = value<br><br>Templates can define custom arguments, as long as they're enclosed into {% and %}. So you can import this template:<br><br>File simpletemplate.monkey<br><pre class=code>
For I = {%startindex%} to {%endindex%} step 5
    Print I
Next
</pre><br><br>File samplefile.monkey:<br><pre class=code>
Function Main()
    'loadtemplate simpletemplate.monkey, startindex = 5, endindex = 100
    'endtemplate
End Function
</pre><br><br>After appling the template parser:<br><pre class=code>
Function Main()
    'loadtemplate simpletemplate.monkey, startindex = 5, endindex = 100
    For I = 5 to 100 step 5
        Print I
    Next
    'endtemplate
End Function
</pre><br>If you modify the template file, and call the parser again, the parser will reflect changes accordingly.<br>I've been using this in the Harpl virtual machine as a sort of "inliner" and it allows a good level of modularization of source code. Also, notice that this parser supports recursivenes, so a template can itself load secondary templates. <br><br></td></tr></table><br>
<a name="2028160"></a>

<a name="2028277"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Added support for a PowerOf operator Yay! Working now on the data comparisong operators and then... program flow! <br><br></td></tr></table><br>
<a name="2028281"></a>

<a name="2028282"></a>

<a name="2028283"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shinkiro1</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> You seem to come along nicely.<br><br>I've also built a scripting language for my monkey project and it went without troubles (didn't expected that).<br>Maybe when you finished writing harpl you could reflect on it (what were big obstacles, overview, design, etc.)? <br><br></td></tr></table><br>
<a name="2028447"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, It's starting to look like a language, but it's too simple right now. In fact, you can't create any real program yet but the more advanced the basis is, the easier it gets to make it grow. today I've added support for bitwise operators (I'm still at this low-level area of the design). No objects, no structs, no arrays yet, no functions. By now, it's only able to compile and execute just chunks of procedural unstructured code, but it works very fast. I hope to have something usable very soon. <br><br></td></tr></table><br>
<a name="2030109"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've just finished the data-conversion operator, sich is "as" followed by the datatype. Now all primitive types can be converted from one to another. When converting a boolean to a string, I've opted for "1" for true and "0" for false, instead of using the words "true" or "false". I think numbers are much more universal. I'm going to add parentesis support soon (it should be very easy) and start working on control flow and nested data scopes.<br><br>Conversion examples (in Harpl):<br><pre class=code>
Define Name as String = "Joseph", Age as Integer = 34
Define Major as Boolean = Age &gt; 18
Output Name ++ ", are you older than 18? = " ++ Major as String</pre><br>That's a very silly example, but show the syntax involved. (++ is string concatenation) <br><br></td></tr></table><br>
<a name="2031013"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> While I'm working on the runtime side of this, I'm now considering a full change on the Harpl direction, in order to make it generate LLVM assembler, so it can be compiled to pure machine code, and generate EXEs, or CLI/CLR executables, or Mac executables, or any other architecture supported by the LLVM, wich would include both 32 and 64 bits processors etc etc, but this increases the complexity of the language a bit... But as a learning project it might be interesting...<br>Any suggestion/advice from any fellow developer would be welcome. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
