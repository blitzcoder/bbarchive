<!DOCTYPE html><html lang="en" ><head ><title >Monkey Blog Stuff</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Monkey Blog Stuff</h1><a href="forums.php" >Monkey Archive Forums</a>/<a href="topics.php?forum=513" >Monkey Tutorials</a>/<a href="#bottom" >Monkey Blog Stuff</a><br><br>
<a name="2025786"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm not sure if this really fits with what simonh wanted from this forum, but it seems to be a good match for what I'm doing and it's pretty quiet in here. Feel free to move or delete this if you wish.<br><br>Anyway, I'm starting to write some blog posts about Monkey. Tips, lessons learned, that sort of thing. They might be of interest to people here (and if not then I've no idea who else would care!) so I thought I'd start dropping links in here.<br><br>So, here's one on how performance varies across targets:  <a href="http://pointlessdiversions.blogspot.co.nz/2012/03/monkey-tip-relative-target-performance.html" target="_blank">http://pointlessdiversions.blogspot.co.nz/2012/03/monkey-tip-relative-target-performance.html</a><br><br>Feel free to comment here or on the blog if you think I'm getting something wrong. Or right. <br><br></td></tr></table><br>
<a name="2025843"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >c.k.</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Good stuff, muddy! Keep it up! <br><br></td></tr></table><br>
<a name="2025844"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks. <br><br>Coincidentally, I've just put up a new post about box classes: <a href="http://pointlessdiversions.blogspot.co.nz/2012/03/monkey-tip-be-careful-around-unboxing.html" target="_blank">http://pointlessdiversions.blogspot.co.nz/2012/03/monkey-tip-be-careful-around-unboxing.html</a> <br><br></td></tr></table><br>
<a name="2026188"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Why0Why</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for posting.  Thorough and well written. <br><br></td></tr></table><br>
<a name="2028886"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Additions:<br><br><a href="http://pointlessdiversions.blogspot.co.nz/2012/04/monkey-tips-default-types-and-implicit.html" target="_blank">http://pointlessdiversions.blogspot.co.nz/2012/04/monkey-tips-default-types-and-implicit.html</a><br><br><a href="http://pointlessdiversions.blogspot.co.nz/2012/05/1d-vs-2d-arrays-performance-reality.html" target="_blank">http://pointlessdiversions.blogspot.co.nz/2012/05/1d-vs-2d-arrays-performance-reality.html</a> <br><br></td></tr></table><br>
<a name="2028891"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> These are great to read muddy shoes, keep it up :)<br><br>Re: monkey-tips-default-types-and-implicit.html<br><br>My write up would just be: Just use "Strict" mode - The End ;)<br><br><br>Re: 1d-vs-2d-arrays-performance-reality.html <br><br>It would be good to see your testing code. <br><br></td></tr></table><br>
<a name="2028889"></a>

<a name="2028890"></a>

<a name="2028894"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> My write up would just be: Just use "Strict" mode - The End ;) <br></div><br><br>Well that is the take home. The thing is that if you don't understand the issues with not using Strict it just seems like it's an annoyance.<br><br><div class="quote"> It would be good to see your testing code. <br></div><br><br>I'll sort something out with attaching code to relevant posts at some point. Most of these tests aren't written as code for public consumption though. Tidying things up and making them into neat packages for posting is an additional time burden. If someone created a test that showed something very different I'd be happy to revisit the code to see what's up, of course.<br><br>I'll probably write a post about performance testing for Monkey in general and post some template code for that. <br><br></td></tr></table><br>
<a name="2028893"></a>

<a name="2028911"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DruggedBunny</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm with therevills -- these are really good reads, thanks. <br><br></td></tr></table><br>
<a name="2029927"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> This post isn't really about Monkey, but it's about something written in Monkey and there's code linked so it might be of interest: <a href="http://pointlessdiversions.blogspot.co.nz/2012/05/tetris-in-how-long.html" target="_blank">http://pointlessdiversions.blogspot.co.nz/2012/05/tetris-in-how-long.html</a> <br><br></td></tr></table><br>
<a name="2029929"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >NoOdle</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> good read.  And of course, challenge accepted!! Will have a bash at Tetris later after I've sorted out a few errands in town. I'll let you know how I fair... 2 hr is going to be a challenge, I tend to slip off into dream land for at least 15 mins every hour and spend far too long playing, err i mean 'testing' my code! <br><br></td></tr></table><br>
<a name="2029928"></a>

<a name="2029948"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >wiebow</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> The last post is fun! Thanks for your insights :) <br><br></td></tr></table><br>
<a name="2031661"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Got around to writing something again:<br><br><a href="http://pointlessdiversions.blogspot.co.nz/2012/06/monkeys-garbage-collection-on-ios.html" target="_blank">http://pointlessdiversions.blogspot.co.nz/2012/06/monkeys-garbage-collection-on-ios.html</a><br><br>Just a cautionary note about garbage collection behaviour on iOS. <br><br></td></tr></table><br>
<a name="2031663"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Another great read Muddy :)<br><br>On the topic of GC, you need to be careful with Android too... try not to create any new objects during your game and preallocate all your game objects beforehand (note: using the default Monkey List when you iterate over it you will create a new object!) <br><br></td></tr></table><br>
<a name="2031664"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sure, GC can be an issue on any platform that implements it. The problem with iOS is that the default behaviour will be made worse by taking your suggestion of pre-allocating. Further, even if you have zero allocations the iOS GC will probably still be doing pretty much the same amount of work as marking the objects generally takes much longer than sweeping.<br><br>Zero allocation is a nice thing to have but not always practical to achieve. If you're down to worrying about list iterators then you'd have to be almost done though as they're both small and unlikely to be numerous. Most GCs don't trigger until a certain amount of allocation has taken place and a few list iterators per frame certainly aren't at the top of my list of trouble makers. <br><br></td></tr></table><br>
<a name="2031669"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> On how the Android GC works, every time you create a "new" object you are saying "Hey GC, go for collect for me and kill me game!".<br><br>With iOS I never had an issue with the GC, but all I did was a simple card game :D <br><br></td></tr></table><br>
<a name="2031672"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Why0Why</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Excellent.  Thorough and well written, as usual.  Thanks for taking the time. <br><br></td></tr></table><br>
<a name="2031703"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> On how the Android GC works, every time you create a "new" object you are saying "Hey GC, go for collect for me and kill me game!". <br></div><br><br>Any given allocation might result in a collection event but GCs aren't generally written so naively that they try to collect as soon as you allocate an object. There's obviously no benefit in attempting to recover memory based on the demand of a single allocation so they don't.<br><br>Here's the Android GC activity using a version of the test from my post that allocates and releases 20,000 objects at a time:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
'initial GC from startup
06-23 10:17:11.350: D/dalvikvm(312): GC_CONCURRENT freed 62K, 45% free 3114K/5639K, external 0K/0K, paused 5ms+7ms
06-23 10:17:11.370: I/[Monkey](312): Numobjects now:
06-23 10:17:11.370: I/[Monkey](312): 20001
06-23 10:17:46.480: I/[Monkey](312): Numobjects now:
06-23 10:17:46.480: I/[Monkey](312): 40001

'GC doesn't fire until 40,000 objects/500+KBytes have been allocated
06-23 10:17:54.070: D/dalvikvm(312): GC_CONCURRENT freed 18K, 41% free 3661K/6151K, external 0K/0K, paused 4ms+8ms
06-23 10:17:54.090: I/[Monkey](312): Numobjects now:
06-23 10:17:54.100: I/[Monkey](312): 60001
06-23 10:17:59.010: I/[Monkey](312): Numobjects now:
06-23 10:17:59.030: I/[Monkey](312): 80001

'Again, 40K+ objects
06-23 10:17:59.150: D/dalvikvm(312): GC_CONCURRENT freed 11K, 38% free 4092K/6599K, external 0K/0K, paused 4ms+6ms
06-23 10:18:02.780: I/[Monkey](312): Numobjects now:
06-23 10:18:02.780: I/[Monkey](312): 100001
'This time fires between 20-40,000
06-23 10:18:14.240: D/dalvikvm(312): GC_CONCURRENT freed 2K, 35% free 4636K/7111K, external 0K/0K, paused 4ms+8ms

'now deallocating
06-23 10:18:14.260: I/[Monkey](312): Numobjects now:
06-23 10:18:14.260: I/[Monkey](312): 120001
06-23 10:18:19.570: I/[Monkey](312): Numobjects now:
06-23 10:18:19.570: I/[Monkey](312): 100001
06-23 10:18:22.130: I/[Monkey](312): Numobjects now:
06-23 10:18:22.130: I/[Monkey](312): 80001
06-23 10:18:23.830: I/[Monkey](312): Numobjects now:
06-23 10:18:23.830: I/[Monkey](312): 60001
06-23 10:18:25.300: I/[Monkey](312): Numobjects now:
06-23 10:18:25.310: I/[Monkey](312): 40001
06-23 10:18:26.450: I/[Monkey](312): Numobjects now:
06-23 10:18:26.450: I/[Monkey](312): 20001
06-23 10:18:34.650: I/[Monkey](312): Numobjects now:
06-23 10:18:34.650: I/[Monkey](312): 40001
'GC doesn't fire until allocations occur 
06-23 10:18:35.370: D/dalvikvm(312): GC_CONCURRENT freed 1575K, 52% free 3767K/7815K, external 0K/0K, paused 8ms+12ms
</textarea><br><br>Yes, if you've got some internal method call that uses a list iterator and gets called dozens or hundreds of times a frame then it'll be adding to your GC burden. On the other hand I think it's a little misleading/over-simplified to talk about using them at all as a big no-no or that any object allocation will result in the GC monster stomping through your living room.<br><br>Obviously, if you want absolutely no GC at all guaranteed over long play sessions then you're going to have to remove all allocations. Unfortunately the nature of mobile OSes means that other processes will come along and mess up your timing anyway so expending a lot of effort removing all allocations might not gain you much in terms of user experience on Android (at least on 2.3+ where the GC is pretty fast but then anything less is rapidly becoming legacy). If you're targeting XBox or PS Vita then there's probably more reason to put the time into avoiding any collection costs. <br><br></td></tr></table><br>
<a name="2031738"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Having said that I had a bit of a think and decided there's no reason not to have the best of both worlds. I've altered the monkey parser to call a Discard method on the ObjectEnumerator after it creates a While loop for the Eachin. A simple cache array for enumerators in the collection and you have no GC issues and no need to lose the syntactic sugar. <br><br></td></tr></table><br>
<a name="2061440"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Time flies... a year since I added to this? Wow.<br><br>Anyway. A recent Twitter conversation with Raph and head-desk debugging experience led me to revisit the topic of autoboxing and add a further warning: <a href="http://pointlessdiversions.blogspot.co.nz/2013/07/boxes-sneaky-buggers.html" target="_blank">http://pointlessdiversions.blogspot.co.nz/2013/07/boxes-sneaky-buggers.html</a> <br><br></td></tr></table><br>
<a name="2061443"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raph</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> Aha, now I can connect you to the Twitter handle! :) <br><br></td></tr></table><br>
<a name="2061444"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AdamRedwoods</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> nice blog post. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
