<!DOCTYPE html><html lang="en" ><head ><title >iMiniB3D: remove entity parent occasional crash.</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >iMiniB3D: remove entity parent occasional crash.</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=119" >MiniB3D Module</a>/<a href="#bottom" >iMiniB3D: remove entity parent occasional crash.</a><br><br>
<a name="1049860"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Haven't had a chance to put together a tiny demo of this yet but if it will help I can try to find the time.<br><br>When an entity changes parents in iMiniB3D sometimes it will crash in entity.mm line 95 <pre class=code>Entity* ent=*it;</pre> I suspect it's a problem with the lists.<br><br>This happens most in my app when 2 things are going on:<br>1) I'm creating and releasing a number of pivots and entity's.<br>2) The memory is being thrashed due to a large number of things being loaded.<br><br>Is it possible the low memory warning (not always near this) could be causing something to get released/deleted?<br><br>Also, maybe I'm missing something I don't think the looping done in this area looking for the entity is needed... elsewhere when the entity needs to get removed from it's parent's list it just uses <pre class=code>
if(parent!=NULL){
		parent-&gt;child_list.remove(this);
	}
</pre> which should save both time and resolve the list digging crash... I will be playing around with this to see if I low anything up with that. <br><br></td></tr></table><br>
<a name="1049947"></a>

<a name="1049948"></a>

<a name="1049949"></a>

<a name="1049950"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jhocking</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm pretty sure I encountered this bug too, but fortunately for me I didn't really need to reparent the object so I just removed that command. Specifically, while messing around with the FreeEntity crash from the other thread I experimented with reparenting entities before freeing them.<br><br>Also, there is another place in the code where reparenting works fine, so it's clearly not all situations.<br><br><font class="tiny"><i>Last edited 2010</i></font> <br><br></td></tr></table><br>
<a name="1050316"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> It seems that when you change an entity's parent it first removes it from the parent entity's child list. To do this it loops through the parent' entity's children looking for the targeted child, and when it find it it tell the parent to remove itself... but removing itself doesn't require being found in the list first (as it it just removed directly in other locations). And it's the looping through the list in the first place that causes the crash. I've had no problems since making the change so far. <br><br></td></tr></table><br>
<a name="1050428"></a>

<a name="1050429"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jhocking</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Now I'm paranoid that my game's moving platforms (which are done by temporarily parenting the player to the platform, and then unparenting when the player steps off) are gonna cause crashes. How is your fix implemented?<br><br><font class="tiny"><i>Last edited 2010</i></font> <br><br></td></tr></table><br>
<a name="1050520"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> in entity.mm starting at line 91:<br><br><pre class=code>
// remove self from parent's child list
	if(parent){
		/*list&lt;Entity*&gt;::iterator it;
		for(it=parent-&gt;child_list.begin();it!=parent-&gt;child_list.end();it++){
			Entity* ent=*it;
			if(ent==this) parent-&gt;child_list.remove(this);
		}*/
		parent-&gt;child_list.remove(this);
		parent=NULL;
	}
</pre><br>I just commented out the entity list iterator loop, and replaced it with just strait up parent-&gt;child_list.remove(this); not sure if it nulled the parent before but I did that too to ensure consistency.<br><br>As I mentioned above it was really rare and mainly happened when I was thrashing memory... not really sure why the iterator went wrong in the first place but it seems un-needed. Haven't seen any leaking (which I would expect if I was wrong about not needing the iterator) and haven't seen any crashing (which I would expect if the strait remove didn't work the way I think it does). <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
