<!DOCTYPE html><html lang="en" ><head ><title >iminib3d bug with moving parented entity</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >iminib3d bug with moving parented entity</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=119" >MiniB3D Module</a>/<a href="#bottom" >iminib3d bug with moving parented entity</a><br><br>
<a name="1032093"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jhocking</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm running into a really frustrating problem with moving the player after parenting them to a moving platform. I'm not sure this is a bug with iminib3d because I haven't isolated down what exactly causes the issue and thus I can't reproduce it outside of my game's code, but I've been working for almost two days straight to figure out what mistake I made and I can't see any yet.<br><br>Basically, I just started implementing moving platforms in my game, and so I put in code to parent the player to a platform when they collide with one. I use TranslateEntity every frame to move the player down with gravity. What's happening is, well, let me show you the console output from a debug statement I put in.<br><br>Here's a report of the player's position every frame (the issue is visible in the last number, the Z coordinate) using local coordinates. I've copy-pasted the part when the player walks onto platform:<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
2010-06-16 11:14:23.116 aerth[2000:207] after 0.036577 0.669465 74.150688
2010-06-16 11:14:23.149 aerth[2000:207] after 0.033800 0.668426 74.284004
2010-06-16 11:14:23.182 aerth[2000:207] after 0.035479 0.668426 74.417336
2010-06-16 11:14:23.216 aerth[2000:207] after 0.036771 0.681220 -1.802858
2010-06-16 11:14:23.249 aerth[2000:207] after 0.041873 0.668016 74.693336
2010-06-16 11:14:23.283 aerth[2000:207] after 0.049911 0.334435 74.826523
</textarea><br><br>To help clarify what's going on, here's that same information but reporting global coordinates:<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
2010-06-16 11:41:35.616 aerth[2610:207] after 0.108532 0.667985 74.336449
2010-06-16 11:41:35.650 aerth[2610:207] after 0.111167 0.668535 74.469719
2010-06-16 11:41:35.683 aerth[2610:207] after 0.113018 0.677956 74.593109
2010-06-16 11:41:35.717 aerth[2610:207] after 0.112166 0.668426 151.093781
2010-06-16 11:41:35.750 aerth[2610:207] after 0.109170 0.335386 151.226959
2010-06-16 11:41:35.783 aerth[2610:207] after 0.104452 0.002866 151.359879
</textarea><br><br>So what's happening is that the player is around 74 units on the Z axis when they walk up to the platform. Then they are parented to the platform and positioned correctly for one frame (-1.8 local to the platform is about 74 in global coordinates) and then in the next frame they are catapulted out to 151 (that's the player's position in global coordinates plus the platform's position.)<br><br>Now after seeing this result I figured "oh well then I can work around this bug by saving the player's position right after parenting and then force them to that position next frame." Here's the result after doing that (switching back to local coordinates):<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
2010-06-16 11:31:58.674 aerth[2427:207] after -0.023623 0.668376 74.203453
2010-06-16 11:31:58.708 aerth[2427:207] after -0.049782 0.668046 74.334358
2010-06-16 11:31:58.741 aerth[2427:207] after -0.065366 0.669146 74.466499
2010-06-16 11:31:58.774 aerth[2427:207] after -0.076440 0.676707 -1.772588
2010-06-16 11:31:58.808 aerth[2427:207] after -0.076440 0.676707 -1.772588
2010-06-16 11:31:58.841 aerth[2427:207] after 0.024876 31.896847 86.012001
2010-06-16 11:31:58.874 aerth[2427:207] after 0.158160 31.563007 86.020195
2010-06-16 11:31:58.907 aerth[2427:207] after 0.280553 31.230368 85.968002
</textarea><br><br>doh! That time it got the position correct for 2 frames instead of 1, but after that it still catapulted the character away, and not just on the Z axis this time.<br><br><br><br>Does anyone have any idea what could be going on here? Again, I'm not sure this is a bug in iminib3d, I just suspect that. I do know the problem isn't as simple as a bug moving a parented entity, because I've tried parenting cubes to the player to test and those move around no problem.<br><br>I also guessed that maybe the problem was doing collision detection against a parent object (ie. detecting the player colliding with the platform after parenting the player to the platform) but I tried parenting the player to a pivot that moves along with the platform, rather than parented to the platform itself, but still got the positioning problem. My next troubleshooting step right now will probably be to repeat that last test, in case I just didn't do it right the first time. <br><br></td></tr></table><br>
<a name="1032170"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jhocking</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Another hypothesis occurred to me: perhaps the problem is with doing collision detection on a parented entity separate from the entity it is parented to. In other words, if a child entity has collision detection but the parent does not, that could make the child's position all screwy.<br><br>Ultimately however I didn't bother to test this hypothesis, because it occurred to me I didn't actually need to parent the player to the platform anyway, just move the player too when moving the platform every frame. This avoided any tricky positioning bugs due to parenting, and now the characters in my game ride moving platforms perfectly. yay <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
