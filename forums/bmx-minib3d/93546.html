<!DOCTYPE html><html lang="en" ><head ><title >Creating bones in miniB3D</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Creating bones in miniB3D</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=119" >MiniB3D Module</a>/<a href="#bottom" >Creating bones in miniB3D</a><br><br>
<a name="1070322"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AdamRedwoods</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I noticed there isn't really a function to create bones on their own in miniB3D.<br><br>Looking through the code, it isn't that explanatory. Does anyone have any knowledge regarding how miniB3D creates bones and what information is needed to create one from scratch?<br><br>What I understand thus far, is that bones are created when the B3D files is loaded. Each bone is a bunch of information, but closely linked with a surface as well. The surface relates to vertices that have bone influence on them. Then, to move these points in the bone space, there is a quaternion associated with the bone.<br><br>The fields: vert_bone1_no:int and vert_weight1:Float   --I don't understand exactly how these values (why 4 of them?) are being used or what goes into them.<br><br>I also don't know the fields, aside from the obvious "n_qw#" quaternion values (I'm guessing they are a start and end):<br>n_px#,n_py#,n_pz#,n_sx#,n_sy#,n_sz#,n_rx#,n_ry#,n_rz#,n_qw#,n_qx#,n_qy#,n_qz#<br><br>Can anyone help clarify? Ultimately, I'd like to add bones via a function and have them animate programmaticaly, for use in say, a tentacle. <br><br></td></tr></table><br>
<a name="1070386"></a>

<a name="1070387"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> There are only four values because that's a common value for many engines to support. Imagine having more than four bones influencing the same vertex - one of them is prone to having a neglectable influence. Even having 5 bones, 20% of influence for each is very little. <br>Four is mostly enough; however, since we are dealing with a software solution I don't see why it couldn't be more (we could have 'n' influences), if that's what you are asking.<br><br>A 'TMesh' has a 'bones:TBone' array which stores all the bones that influence this mesh.<br><br><b>vert_boneN_no[ vertIndex ]</b> -&gt; The index of the Nth bone affecting the vertex of index 'vertIndex'.<br><b>vert_weightN[ vertIndex ]</b> -&gt; Weight this Nth bone has over vertex of index 'vertIndex'. Weight are ordered and the 4th bone is always the one to have the weakest. This is done at model load-time.<br><br>The "n_something" values are back from when the bone had its NODE chunk read ('n' for Node, see? if you go up in the TModel.BMX you'll see that when the code detects a NODE chunk it fills these 'n_' variables). <br>Bones are nodes as well. They have a name, position (p values), rotation (q values - they are converted to euler and become r values) and scale (s values).<br><br>Adding bones through code is most likely going to be a pain. I'd suggest adding them through modelling software (export the mesh with the bind pose), and then animating them programatically; you could read up on how to calculate real-time solvers for that great tentacle-like IK.<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1070485"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AdamRedwoods</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the info, I'm going to work on it some more and see what I can come up with. I know it's a nasty task.<br><br>I also found this:<br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=2485" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=2485</a> <br><br></td></tr></table><br>
<a name="1083434"></a>

<a name="1083435"></a>

<a name="1083436"></a>

<a name="1083442"></a>

<a name="1083443"></a>

<a name="1083444"></a>

<a name="1083448"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AdamRedwoods</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've gotten pretty far with making bones in miniB3D, the problem is I've encountered a slight oddity.<br><br>The code from TAnimation.bmx under VertexDeform():<br><pre class=code>
' transform vertex position with transform mat
x= ( bone.tform_mat.grid[0,0]*ovx + bone.tform_mat.grid[1,0]*ovy + bone.tform_mat.grid[2,0]*ovz + bone.tform_mat.grid[3,0] ) * weight
y= ( bone.tform_mat.grid[0,1]*ovx + bone.tform_mat.grid[1,1]*ovy + bone.tform_mat.grid[2,1]*ovz + bone.tform_mat.grid[3,1] ) * weight
z= ( bone.tform_mat.grid[0,2]*ovx + bone.tform_mat.grid[1,2]*ovy + bone.tform_mat.grid[2,2]*ovz + bone.tform_mat.grid[3,2] ) * weight
</pre><br><br><strike>seems to be wrong. If I put a weight of "0" in, the vertexes collapse to 0. I suspect it should be ovx, ovy, ovz instead of "0".</strike><br><br><strike><b>Has anyone heard of problems with importing weights into miniB3D? I don't want to "fix anything that ain't broke".</b></strike><br><br>UPDATE:<br>I added "+ (1.0-weight)*ovx" and "+ (1.0-weight)*ovy"  and "+ (1.0-weight)*ovz"<br>to the above sections in VertexDeform() and it worked ok for the zombie example, but not for a separate .b3d file example. I'll keep hacking...<br><br><font class="tiny">Last edited 2011</font><br>UPDATE:<br>I remember now that all the weights should equal =1.<br><br>That explains why when I use only one bone with less than 1 weight why it fails.<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
