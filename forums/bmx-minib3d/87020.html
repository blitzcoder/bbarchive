<!DOCTYPE html><html lang="en" ><head ><title >MiniB3d bird demo, cruption on my machine</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >MiniB3d bird demo, cruption on my machine</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=119" >MiniB3D Module</a>/<a href="#bottom" >MiniB3d bird demo, cruption on my machine</a><br><br>
<a name="986224"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shagwana</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> *** Managed to solve it, check down the page ***<br><br>As you can see under I have a problem with minib3d on my rig;<br><br><img src="http://www.sublimegames.com/images/31.jpg"><br><br>As you can see the textures are not drawn correctly<br><br>When I try and build a standard texturemapped cube, i get the same results with the UV's getting all screwed up. <br><br>I suspect that this is an issue with my gfx card drivers, but hope its not!.<br><br>Gfx card = radeon 4870, drivers 9.8<br>Vista machine, 32bit<br><br>Anyone with any ideas on how to solve this issue?<br><br><br>To add to this, loading a b3d mesh as in the 'loadanimseq.bmx' example works as expected! <br><br></td></tr></table><br>
<a name="986252"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shagwana</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> After further investigation;<br><br>VertexU() and VertexV() return the correct values set for the UV of the verts in question.<br><br>I also updated to the latest ati drivers, this did not solve the problem. <br><br></td></tr></table><br>
<a name="986262"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shagwana</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> More information!. The flag demo works as expected, the uv of the b3d logo is all find and groovy on that one.<br><br>Looks like there maybe something special going on with this example?.<br><br>Does anyone else have this problem with the latest build of minib3d? <br><br></td></tr></table><br>
<a name="986331"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Have you tried the other examples, specifically anything that loads a textured  mesh? If memory serves, the flag demo textures a surface and alters the vertexes rather than the bird demo which is loading textured meshes. <br><br></td></tr></table><br>
<a name="986341"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Midimaster</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have also a problem in loading textures and sprites, See the other topic next to yours...<br><a href="/posts.php?topic=87017" target="_blank"><br><a href="http://www.blitzbasic.com/Community/posts.php?topic=87017" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=87017</a><br></a><br>At first I thought it is a problem with sprites only, but now also textures do not work... <br><br></td></tr></table><br>
<a name="986345"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shagwana</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> In short...<br><br>'loadanimseq.bmx' example works as expected! <br>'flag.bmx' example works as expected<br><br>The bird demo and the code I made myself does not. <br><br></td></tr></table><br>
<a name="986504"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shagwana</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> After having a look at the minib3d code, looks like its a problem to do with only non-animated meshes. <br><br></td></tr></table><br>
<a name="986506"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> What happens if you use load a non animated mesh as an animated one? <br><br></td></tr></table><br>
<a name="986515"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shagwana</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>What happens if you use load a non animated mesh as an animated one?<br> <br></div><br>Problem is still there<br><br>While poking around in minib3d, I see the flag demo uses 'vbo' for rendering the textures. This appears to work as expected here.<br><br>However the bird demo uses some sort of uv list that gets passed. From what I can tell is inside this list, it looks to be spot on and as expected.<br><br>I dont really understand enought about OpenGL in order to diagnose this problem any further, im going to keep hacking at it tho. <br><br></td></tr></table><br>
<a name="986601"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shagwana</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Right I have fudged together the simplest example of this happening on my machine.<br><br><pre class=code>
'
' Simple problem show
'

Import "minib3d/minib3d.bmx"

Local width=1024,height=800,depth=32,mode=0
'Graphics3D width,height,depth
Graphics3D width,height,depth,mode


Local cam:TCamera=CreateCamera()
PositionEntity cam,0,0,-5
Local light:TLight=CreateLight()



Local n:Int
Local m:TMesh=CreateMesh()
Local s:TSurface=CreateSurface(m)

Local b:TBrush=LoadBrush("engine.jpg") '256x256 texture image

n=AddVertex(s,-1,+1,-1,0,0)
Print VertexU(s,n,0)+" "+VertexV(s,n,0)

n=AddVertex(s,+1,+1,-1,1,0)
Print VertexU(s,n,0)+" "+VertexV(s,n,0)

n=AddVertex(s,+1,-1,-1,1,1)
Print VertexU(s,n,0)+" "+VertexV(s,n,0)

n=AddVertex(s,-1,-1,-1,0,1)
Print VertexU(s,n,0)+" "+VertexV(s,n,0)


AddTriangle s,0,1,2
AddTriangle s,0,2,3

PaintSurface s,b

While Not KeyDown(KEY_ESCAPE)		
  If KeyHit(KEY_ENTER) Then DebugStop
  ' control camera
  MoveEntity cam,KeyDown(KEY_D)-KeyDown(KEY_A),0,KeyDown(KEY_W)-KeyDown(KEY_S)
  TurnEntity cam,KeyDown(KEY_DOWN)-KeyDown(KEY_UP),KeyDown(KEY_LEFT)-KeyDown(KEY_RIGHT),0


  renders=renders+1
  ' calculate fps
  If MilliSecs()-old_ms&gt;=1000
    old_ms=MilliSecs()
    fps=renders
    renders=0
    EndIf
	
  UpdateWorld
  RenderWorld	
  Text 10,0,"FPS: "+fps

  Flip
	
Wend
End

</pre><br><br>This is what I get;<br><br><img src="http://www.sublimegames.com/images/32.jpg"><br><br><br>Does this happen for anyone else? <br><br></td></tr></table><br>
<a name="986603"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shagwana</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> The plot thickens, I just tried my 256x256 texture in the flag demo and it comes back as above.<br><br>Flag demo texture is 400x197<br>My texture is 256x256<br><br>Maybe this is a problem with the loading of textures then! <br><br></td></tr></table><br>
<a name="986609"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shagwana</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> The same texture saved as a 256 col bitmap works<br><br>On looking a little deeper into the loadbrush command, I see that it wraps the textureloading that ends up wrapping the load pixmap command<br><br>Some stuff goes on in behind to do with changing the format of textures and I think that this is now were the problem lies! <br><br></td></tr></table><br>
<a name="986617"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shagwana</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Now digging even deeper, if i save the loaded 24bit or 32bit textures pixmap to a png file...<br><pre class=code>
SavePixmapPNG tex.pixmap,"savedpixmap.png"
</pre><br>The image is fine, so maybe its opengl not understanding the format the data is in?. <br><br>I feel lost! <br><br></td></tr></table><br>
<a name="986647"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> interesting, what happens if you the load the breaking image in bmax (2d)? does it display OK there? if so what happens if you switch bmax to using the opengl driver instead of the default directx? <br><br></td></tr></table><br>
<a name="986650"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shagwana</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> minib3d is opengl only.<br><br>The exported pixmap from the texture is a valid file and looks as expected<br><br>However, the 256 color one works fine in minib3d the 24bit one does not (and 32bit)<br><br>If I load a 256 colour texture, then manualy overwrite the pixmap with the 24bit data (using LoadPixmapPNG)- then it works!. The pixmap that textures refer to is a 32bit pixmap (RGBA8888) so i am able to load a 24bit texture over the top of the 8bit (256 cols).<br><br>When I get sometime i will have a further play <br><br></td></tr></table><br>
<a name="986708"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shagwana</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> W00t! Well I managed to fix it...<br><img src="http://www.sublimegames.com/images/33.jpg"><br><br>Thats what it should look like. The problem I had was with ...<br><br>In TTexture.bmx...<br><pre class=code>
  Local mip_level=0
  Repeat
  'glPixelStorei GL_UNPACK_ROW_LENGTH,pixmap.pitch/BytesPerPixel[pixmap.format] 'BAD LINE!
    glPixelStorei 2,pixmap.pitch/BytesPerPixel[pixmap.format]    'THE FIX!
    glTexImage2D GL_TEXTURE_2D,mip_level,GL_RGBA8,width,height,0,GL_RGBA,GL_UNSIGNED_BYTE,pixmap.pixels
    If Not mipmap Then Exit
    If width=1 And height=1 Exit
    If width&gt;1 width:/2
    If height&gt;1 height:/2

    pixmap=ResizePixmap(pixmap,width,height)
    mip_level:+1
  Forever
</pre> <br><br></td></tr></table><br>
<a name="986804"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shagwana</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> After further investion, I understand the fix is this;<br><pre class=code>
glPixelStorei GL_UNPACK_ROW_LENGTH,(pixmap.pitch/BytesPerPixel[pixmap.format])-width  
glPixelStorei GL_UNPACK_ALIGNMENT,4
</pre><br><br>Anyone who really knows there OPENGL out there?, could you have a look at my fiddlings and point out what I am doing wrong (if anything?) <br><br></td></tr></table><br>
<a name="986829"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >simonh</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> No idea why that screws up on your machine. Thanks for the fix though, I'll add it to future releases. <br><br></td></tr></table><br>
<a name="986839"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shagwana</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think my fix will need a little testing on those machines that did not have this problem to begin with. <br><br></td></tr></table><br>
<a name="986853"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >outsider</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi, <br>your fix work very well (same like previous version with 'BAD LINE') on my old Intel card laptop (XP). <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
