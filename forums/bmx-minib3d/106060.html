<!DOCTYPE html><html lang="en" ><head ><title >Hardware Multisampling (MSAA) with OpenB3D/OpenGL</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Hardware Multisampling (MSAA) with OpenB3D/OpenGL</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=119" >MiniB3D Module</a>/<a href="#bottom" >Hardware Multisampling (MSAA) with OpenB3D/OpenGL</a><br><br>
<a name="1301617"></a>

<a name="1301618"></a>

<a name="1301619"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RustyKristi</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Continuing this topic <a href="/posts.php?topic=106056" target="_blank">here</a> about AA with OpenB3D and going back to ARB, I did some snooping around and found out that this is somehow related to Hardware Multisampling with OpenGL?<br><br>So basically this is just enabling Hardware MSAA and just thought they did the same with MiniB3D's Antialias command if I'm not mistaken.<br><br>glEnable(GL_MULTISAMPLE)<br>or<br>glEnable(GL_MULTISAMPLE_ARB)<br><br>I'm sure they are more steps on that, but that is basically the setup.<br><br>further reading:<br><br><a href="http://nehe.gamedev.net/tutorial/fullscreen_antialiasing/16008/" target="_blank">http://nehe.gamedev.net/tutorial/fullscreen_antialiasing/16008/</a><br>http://www.learnopengl.com/#!Advanced-OpenGL/Anti-aliasing<br><br>It's kind of irky that MiniB3d got this antialiasing available and the shaders with OpenB3D. Given that you can do PostFX AA using shaders but hardware multisampling seems to be efficient, at least for a default AA. <br><br></td></tr></table><br>
<a name="1301621"></a>

<a name="1301622"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> In order for the multisampling feature to be available at all, the OpenGL context (the "graphics mode") needs to be created with a specific multisample amount (2x, 4x, 16x etc.).<br>If you don't do that, using the glEnable or glDisable commands will make no difference.<br><br><a href="http://www.blitzbasic.com/Community/posts.php?topic=64265" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=64265</a> <br><br></td></tr></table><br>
<a name="1301623"></a>

<a name="1301624"></a>

<a name="1301625"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RustyKristi</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I agree, that's why I mentioned that there are more steps on that. Thanks for the link. :D<br><br>Do you think this will work with OpenB3D? It looks like it should work<br><br><a href="http://www.leadwerks.com/werkspace/topic/5143-blitzmax-arb-fsaa-ready-to-use-modules-real-antialias/" target="_blank">http://www.leadwerks.com/werkspace/topic/5143-blitzmax-arb-fsaa-ready-to-use-modules-real-antialias/</a> <br><br></td></tr></table><br>
<a name="1301627"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> The way of implementing anti alias in original MiniB3D was to call the camera render function many times, shifting the picture by one pixel, and using the accumulation buffer to implement a convolution filter. This was not an efficient solution,  because all entities were checked for visibility many times, with no need.<br><br>But implementing the same solution on OpenB3D  (I remind OOpenB3D was originally based on iMiniB3D , that had no anti alias support, too) would have caused issues with the new functionalities I added, mainly terrains and shadows.  In fact, terrain geometry is built from scratch at each frame,  to provide the best LOD for current view.  By calling the render routine many times, it would have been unnecessarily rebuilt many times, with a serious slowdown. The same applies to shadows (a volumetric shadow needs to be rebuilt each time the mesh or the light are moved). So, I needed to find another solution anyway, and the simplest one was to rely on the existing features of opengl. The right solution would be to render to a texture, then render the texture on the accumulation buffer many times to simulate a convolution filter; it would work like in MiniB3D,  with the benefit of rendering the scene only once per frame, and use the same image. Actually, would be a sort of post processing without shaders. But I haven't implemented that in the core of the library, because there are many other ways a textured quad could be used, and I still am not sure on how implementing  a generic all purposes  solution. <br><br></td></tr></table><br>
<a name="1301637"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RustyKristi</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the info angros47, so does this mean that it is more practical and efficient to implement or work on something like a antialias shader/postfx with OpenB3D?<br><br>I have not tested yet the Nvidia control panel to do this manually but figured if this can be done without external setup. <br><br></td></tr></table><br>
<a name="1301692"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> A well programmed shader would be more efficient, because it will use the GPU (that works with parallel processing) while the CPU can do other things. But you need a system with a programmable GPU: some drivers (like Mesa) provide a software fall back, but if the processor has to emulate a GPU (in a very inefficient way, since emulating a parallel execution cannot be fast) it would cause a serious slow down. So, it's better to just "hint" the driver to use multisampling: if the hardware supports it, you get multisampling, otherwise, the image will have some artifacts, but will still be rendered in acceptable time.<br><br>It's always possible to use the accumulation buffer, as in MiniB3D, but rendering in two steps (as it's done in post processing), to avoid repeating the most time-consuming operation. A convolution filter in theory should allow much more tricks, not only antialiasing. Maybe I could consider adding some feature like that... but not now. At the moment, my priority is a version that can replace the fixed function pipeline (as MiniB3D for Monkey did some years ago), otherwise there will be no future for OpenB3D. <br><br></td></tr></table><br>
<a name="1301695"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> From what I've read, multisampling is the fastest and safest choice for antialiasing since it's built-in.<br><br><div class="quote"> Do you think this will work with OpenB3D? <br></div><br>Whether it's OpenB3D or another open source engine, you need to [test for compatibility and if available,] create a graphics context using a pixel format with one of the multisampling modes. <br><br></td></tr></table><br>
<a name="1301698"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RustyKristi</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok with the postfx camera features already in place, I'm glad there is still a great option here. Either way, setting it via the GPU's control panel is still my second fallback if that would work.<br><br>I agree, I was about to ask for using deferred rendering with openb3d so there's a possibility to create some shaders like PSSM shadows.<br><br>@Kryzon<br><br>Thanks, I was referring to JoshK's old code if that would work out of the box. I see a sample posted with a cube being anti-aliased (I dont know if thats minib3d or openb3d) but I'm curious to see the bottom result. <br><br></td></tr></table><br>
<a name="1301699"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> It should work with the BlitzMax wrapper module for OpenB3D, since that uses the Graphics command from the BRL modules.<br><a href="https://github.com/markcwm/openb3d.mod/blob/master/openb3d.mod/inc/TGlobal.bmx#L147" target="_blank">https://github.com/markcwm/openb3d.mod/blob/master/openb3d.mod/inc/TGlobal.bmx#L147</a><br><br>JoshK's modification affects that Graphics function, adding the multisampling flags.<br>It would be necessary to change the Graphics3D function from the OpenB3D module to accept those flags as well. <br><br></td></tr></table><br>
<a name="1301705"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RustyKristi</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Kryzon! :) I assume by that thread where you have participated that you have tried this before? <br><br>Anyways, this would be awesome if it really work without any complex modification. <br><br></td></tr></table><br>
<a name="1301708"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RustyKristi</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok so adding the latest modules by Joshk, I get these errors when I try to build my app:<br><br>C:/BlitzMax/mod/brl.mod/glgraphics.mod/glgraphics.release.win32.x86.a(glgraphics.bmx.release.win32.x86.o):(code+0xb13): undefined reference to `bbGLGraphicsShareContexts'<br><br>No problems rebuilding all modules, just the app with this error. <br><br></td></tr></table><br>
<a name="1301709"></a>

<a name="1301713"></a>

<a name="1301714"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RustyKristi</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> It looks like the .C file is already outdated.<br><br>Made some changes but it is not enough. Maybe somebody can pick it up. It looks like it is close I can't get this wglChoosePixelFormatARB part to work<br><br><pre class=code>static BOOL _wglChoosePixelFormatARB( int hDC, const int *intAttribs, const FLOAT *floatAttribs, unsigned int maxFormats, int *lPixelFormat, unsigned int *numFormats)
{
	//Define function pointer datatype
	typedef BOOL (APIENTRY * WGLCHOOSEPIXELFORMATARB) (int hDC, const int *intAttribs, const FLOAT *floatAttribs, unsigned int maxFormats, int *lPixelFormat, unsigned int *numFormats);

	//Get the "wglChoosePixelFormatARB" function
	WGLCHOOSEPIXELFORMATARB wglChoosePixelFormatARB = (WGLCHOOSEPIXELFORMATARB)wglGetProcAddress("wglChoosePixelFormatARB");
	if(wglChoosePixelFormatARB)
		return wglChoosePixelFormatARB(hDC, intAttribs, floatAttribs, maxFormats, lPixelFormat, numFormats);
	else
		MessageBox(0,"wglChoosePixelFormatARB() function not found!","Error",0);
		return 0;
}</pre><br><br><a href="http://s000.tinyupload.com/index.php?file_id=78441440943726650095" target="_blank">http://s000.tinyupload.com/index.php?file_id=78441440943726650095</a> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
