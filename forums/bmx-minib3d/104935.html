<!DOCTYPE html><html lang="en" ><head ><title >Need Help With Water</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Need Help With Water</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=119" >MiniB3D Module</a>/<a href="#bottom" >Need Help With Water</a><br><br>
<a name="1274662"></a>

<a name="1274663"></a>

<a name="1274664"></a>

<a name="1274666"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FBEpyon</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello,<br><br>I was hoping someone can help me with getting a water shader..<br><br>Here is a picture of my project so far using perlin noise to create random island terrains, and was looking online for information on water shaders and I couldn't find anything.<br><br><img src="http://i270.photobucket.com/albums/jj119/fbepyon/project_island_1_zpstb8euxe5.png"><br><br>Any help would be great!! <br><br></td></tr></table><br>
<a name="1274895"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have just added a water shader to Openb3d examples, sorry no picture. <br><br>It's pretty simple, no clever stuff like caustics, just a specular cubemap and water texture with uv scrolling and mesh wave deformation. <br><br>One issue is reflections, they are really big for anything in the water so those need hidden and anything directly above the surface needs moved up a bit before rendering. Also, I tried diffuse cubemap but it doesn't seem to work at all on flat surfaces. <br><br></td></tr></table><br>
<a name="1274937"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just updated this with a second version with pixel lighting. The first one just ignores lighting, just in case someone wants that. <br><br></td></tr></table><br>
<a name="1274938"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FBEpyon</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks,<br><br>I will look at I as soon as I get a chance to get back on to my computer. I was having problems with MinGW so I'm in the process of fixing that now. <br><br></td></tr></table><br>
<a name="1275525"></a>

<a name="1275526"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've updated my sl_water.bmx example again with stencil reflections which looks much better. Now cubemapping is just used for the sky reflection. <br><br></td></tr></table><br>
<a name="1275557"></a>

<a name="1275558"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FBEpyon</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I worked with the sl_water, and it ended up be to much for trying to keep this working on low end hardware.<br><br>Soooo I came up with this instead :<br><br><img src="http://i270.photobucket.com/albums/jj119/fbepyon/cap2_zpse0ny6wjy.png"><br><br>Thanks for all the help, and let me know what you think...<br><br>BTW this is all done in OpenB3d using shaders for all the texturing and water movement (which you can't see..) <br><br></td></tr></table><br>
<a name="1275612"></a>

<a name="1275613"></a>

<a name="1275614"></a>

<a name="1275615"></a>

<a name="1275616"></a>

<a name="1275617"></a>

<a name="1275618"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I was experimenting with water and an isometric heightmap a little while ago and came up with something I was almost happy with heh.<br>I've not used any shaders for this and it runs quite well on lower end machines.<br><br><img src="http://puu.sh/k302Q/7dcb2bd0db.jpg"><br><br><img src="http://puu.sh/k309X/efb19dc9aa.jpg"><br><br>It sparkles a bit as it moves heh. <br><br></td></tr></table><br>
<a name="1275708"></a>

<a name="1275709"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> FBEpyon, looks nice, not top quality but quite passable if it matches the graphical style of your game.<br><br>It looks like you may be doing a caustic effect, are you? The simplest way is probably an animated texture, but a bit harder and probably better is to multitexture with two similar water textures and then fade in from one to the other, which could be done by a shader. I'll see if I can add that to sl_water.bmx.<br><br>Hezkore, looks really good. It looks almost bumpmapped, which is another good idea for a nice water shader. Are you using an animated texture? Can you explain how you achieved that? <br><br></td></tr></table><br>
<a name="1275797"></a>

<a name="1275798"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> It was meant to used as ponds and small water holes in the terrain.<br>So I wanted very calm and still water, which means it's got no waves or anything like that.<br>It's also made to be used with an orthographic projection, so this might not be the perfect water for every situation.<br>I'm also drawing some "fake" sun to the screen to lighten it all up a bit.<br><br>It feels like I'm giving away trade secrets here hehe, but it's just water and it's not that special.<br>So here's the source code to a quickly thrown together demo of it - <a href="https://dl.dropboxusercontent.com/u/2842751/water_example.zip" target="_blank">water_example.zip</a><br>It's pretty messy and has a lot of stuff it doesn't need in this situation, but you get the basic idea.<br>Just some texture blending and a few planes layered above each other. <br><br></td></tr></table><br>
<a name="1275885"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Hezkore! Very kind of you to share your textures and source. I'm still trying to work out what is going on, it seems quite complex. Shows you don't always need shaders though.<br><br>Also, I noticed your comment about jpg/png loader so I double checked this and Openb3d doesn't import either jpg, png or even bmp loaders whereas Minib3d does. I think I should add them though as the wrapper is meant to behave as much like Minib3d as it can. <br><br></td></tr></table><br>
<a name="1275911"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> @munch <br>What do you mean? OpenB3D can open jpg/png/bmp. <br><br>@Hezkore: if you are going to create ponds, you could use a stencil mesh for thems: you can scale the camera with a factor of -1, and it will render a mirror image; by combining the two effects, you could have reflections on water (It's a way to replicate the "CreateMirror" command of Blitz3D, that is not available in MiniB3D or OpenB3D) <br><br></td></tr></table><br>
<a name="1275917"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> What I meant was, as in Hezkore's demo, when using the Max2d commands you need to import the image loaders or it will error out.<br><br>So I guess there's no CreateMirror in Minib3d because you can't really automate that but Blitz3d could as it used a built-in Dx7 render function. <br><br></td></tr></table><br>
<a name="1275919"></a>

<a name="1275920"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> What I meant was, as in Hezkore's demo, when using the Max2d commands you need to import the image loaders or it will error out. <br></div><br><br>Uh, ok. That's because OpenB3D has its own internal loader (stbi image loader), to be able to work with other languages, too, while MiniB3D uses the loader provided with BlitzMax. If you use Max2D with MiniB3D, the loader code is already imported, if you use OpenB3D, it is not (and Max2D cannot access the loader included in OpenB3D)<br><br><br><div class="quote"> So I guess there's no CreateMirror in Minib3d because you can't really automate that but Blitz3d could as it used a built-in Dx7 render function.<br> <br></div><br><br>Actually, it could be automated: you just need to reverse camera view matrix and perform another render; but it could be easily done with current version (to reverse camera matrix, just use ScaleEntity: Blitz3D ignores scaling operations on cameras, while MiniB3D and OpenB3D allow that).<br><br>So, simulating a Blitz3D mirror is not difficult, and can be done with two or three commands (two "ScaleEntity" and one extra "RenderWorld")... it's not even worth adding a new command just for that. <br><br>Also, CreateMirror has too many limitations: <br><br>- it works only for horizontal mirrors (it's ok for water and ice, not for wall mirrors), while most mirrors are vertical<br>- the mirror size is infinite (you'd need stencils to restrict it, and in Blitz3D stencils are not available): it's ok for sea, or for a lake that is in the lowest place of a scene (the terrain will hide the rest of the mirror) but it's bad if I just want a puddle, or a sheet of ice, or a pool that are above the ground level<br>- the mirror works on both sides, and there is no clipping: everything that is above the mirror is reflected below it, but everything is below is also reflected above, so it's not possible to have fishes, or a sea bed, because you'd see it reversed in the air (imagine: you are on a boat, and you see a shoal of fishes flying upside down in the air)<br><br>These limits restricts the use of CreateMirror to iced landscapes, and not much more (in fact, even in Blitz3D, reflections were usually achieved with cube mapping, not with CreateMirror); with a wise use of stencils, in OpenB3D a better mirror could be achieved <br><br></td></tr></table><br>
<a name="1275921"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> I tried all the tricks to make water reflections, but in the end I found none that worked well in all situations.<br>One problem was that the world/heightmap was very optimized for the ortho projection, it had no surfaces at the back or bottom, so rendering it from any other point of view would make it invisible (and flip mesh would't help).<br>At one point I even generated a custom reflections mesh that would only be seen in the stencil, but it took a lot of extra time to generate and since the heightmap would change ingame it needed to be fast.<br><br>In a different situation I could have used reflections (and I'd love to see that), but for the isometric heightmap demo shown above I decided that it was best to leave them out. <br><br></td></tr></table><br>
<a name="1275922"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is the world a terrain entity (made with CreateTerrain, or LoadTerrain)? If so, you can't use FlipMesh because it's not a mesh, but you can still disable backface culling using EntityFX ent, 16. <br><br></td></tr></table><br>
<a name="1275930"></a>

<a name="1275932"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Neither, it's created with my own CreateIsoTerrian(), returned as a mesh.<br>I can flip it (disabling backface culling works too) but it doesn't look correct in the end.<br><br>It doesn't really matter anymore though as I've changed the entire thing and started a new project. <br><br></td></tr></table><br>
<a name="1275959"></a>

<a name="1275960"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> (and Max2D cannot access the loader included in OpenB3D) <br></div><br>Yes, but we can use Pixmap with TexToBuffer/BufferToTex commands which is enough.<br><br>I tried the ScaleEntity trick to simulate CreateMirror and got it working, then I realized doing that makes it more complex than it needs to be. I had to render twice, use a second camera, hide/show the mesh and their copies (I had to use copies or else use ScaleEntity on each mesh because camera rotation caused meshes to move) all to achieve an effect that can be done just by positioning inverted copies below the ground/plane. So I can see why CreateMirror was never added to Minib3d! I have uploaded a mirror example for anyone who is looking for a simple and fast alternative to the stencil example (my framerate was twice as fast). <br><br></td></tr></table><br>
<a name="1276005"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, I've deleted the mirror example and just added the ability to enable/disable stenciling in the stencil example. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
