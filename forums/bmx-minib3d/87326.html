<!DOCTYPE html><html lang="en" ><head ><title >vram management</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >vram management</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=119" >MiniB3D Module</a>/<a href="#bottom" >vram management</a><br><br>
<a name="989591"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> The project I'm working on needs to load a fairly large number of the user's pictures and keep them all on screen at once. I can manage the size of the textures loaded and reduce quality of images on load as needed, however I don't know if there's a way to determine how much more space is available for textures so I have to guess at a quality level before hand...<br><br>So is there's any way to determine how much texture space is available (so I can make an accurate quality guess at the start, and stop loading pictures if I hit the top so it doesn't have to swap them around which sends the performance down to &lt; 1fps which is obviously a bad thing) <br><br></td></tr></table><br>
<a name="989609"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> the only way that I know of is to have the pictures as bitmaps and use their size, a bit primitive I know. <br><br></td></tr></table><br>
<a name="989615"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SLotman</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> There's no way to find how much VRAM you have. The only solution is to set a minimum value as a requirement to your program, and work with that number.<br><br>But actually, you're not limited to system VRAM. Once that one gets filled (at least Direct-X, don't know about Open GL) will upload things to RAM, and transfer them to VRAM as necessary. It's way slower, but still, better than failing due to no available VRAM.<br><br>As to picture size in VRAM, if you're using texture compression there's now way to tell it that I know. If you're just loading BMPs, PNGs, etc - you should multiply width x height x bytes per color to get the memory size.<br><br>For example: a 256 x 256 textures in 32bpp = 256 x 256 x 4 = 256kb in VRAM.<br><br>Also remember that the VRAM is used in the front buffer/back buffer so you'll have to subtract the screen resolution from the available memory. <br><br></td></tr></table><br>
<a name="989640"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mr. Write Errors Man</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Things like mipmapping will multiply texture memory footprint by 1.33 or so. <br><br></td></tr></table><br>
<a name="989662"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the great replys!<br><br>I am aiming with a minimum in mind however it's more the images that's I'm working with, since they can be user supplied they can range wildly and that causes problems.<br><br>I'm aware the system doesn't crash if I load too many, however they are all on screen at once, so if I hit a point  where it starts swapping with ram, it has to do it a large number of times for every frame...<br><br>I was trying to track my memory usage by adding the pictures together but in retrospect my math was all wrong and I have no idea what I was thinking. Currently I'm loading them to pixmaps so I can grab their dimensions before converting them.<br><br>Query related to the memory size. TextureHeight/Width don't return the value of the image used for the texture but a scaled number above it. I'm thinking I should be using these numbers since they represent the dimensions of the actual texture rather than the picture in the texture... maybe I'm wrong and the pictures are stored in their original size still. <br><br></td></tr></table><br>
<a name="989710"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xlsior</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> . If you're just loading BMPs, PNGs, etc - you should multiply width x height x bytes per color to get the memory size. <br></div><br><br>...Except you don't.<br><br>- Blitzmax rounds up the height and width to the nearest power-of-two dimension, since many videocards aren't compatible with odd sizes<br>- Even if the source format is different, all images will be converted to 32 bit internally<br>- files like BMP and especially PNG will be compressed, but the files will be stored uncompressed in video memory -- so the actual file size has nothing to do with the memory requirements<br><br>in the end:<br><br>height (rounded to nearest power-of-2) * width (rounded to nearest power-of-2) * 4 (always stored in 32 bit) <br><br></td></tr></table><br>
<a name="989719"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> That was my understanding xlsior, you can grab that power of 2 rounded hight and width using textureheight() and texturewidth(). I'm loading pixmaps scaling them down to reduce the texture size, then making a texture from the pixmap, so this should work well, assuming I don't forget about the screen and back buffers as well... <br><br></td></tr></table><br>
<a name="994532"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> sorry to dredge up an aging post but I'm still working on this, so I thought it better than starting a new one.<br><br>Tracking the vram usage by calculating a rough size for my textures is working as well as could be hoped for.<br><pre class=code>textureVramSize = TextureHeight(tex) * TextureWidth(tex) * 4</pre> works quite well, just gotta remember to track every single texture that could be on screen at once, plus the front and back buffers, and a little overhead for opengl to play with etc.<br><br>So tracking it is working well enough, as long as you give some wiggle room to the card. i.e. I'm trying not to use more than around 230mb of calculable space (loaded textures + front and back buffers) on a 256mb card it it works well. However this brings me back to the second half of my initial question. How does one determine the size of the card. I've read a number of places including this thread that you can't, however I think it's more accurate that you shouldn't be looking at card size, not that it's impossible. It has to exist in the computer somewhere. There are numerous threads on other forums for other languages (e.g. <a href="http://lists.apple.com/archives/mac-opengl/2001/May/msg00022.html" target="_blank">here for example</a> regarding the same thing and all have mixed responses (and aren't blitzmax centered) so I've come home to ask again.<br><br>You can make the following assumptions.<br>1) I know every single texture that I would LIKE to have on screen at once and I know it's size in memory.<br>2) I intend to remove things from this list of targets down to a threshold safely bellow whatever the actual physical size is to allow for OS/Driver/Background process etc. overhead.<br>3) I will be targeting graphics cards with a reasonable minimum to begin with, probably 128mb, though support for 64mb would be lovely. This is primarily to allow larger than average cards (512 and up) to get more out of my app without having to make a manual change to a config file.<br>4) The textures will be scaled to fit a power of 2 texture space of no less than 256x256 and no more than 1024x1024. As an extension of this I haven't found anything relating to any card that stores it's textures in a minimum power of 2 space larger than 256x256 (as that would chew HUGE amounts of vram on a structural level) so odd memory handling for speed done by the cards themselves is a mute point.<br>5) It needs to be graphics card independent and preferably OS independent, though its not that big of a deal if a viable method can be found for mac and PC independently. But it can't be (as I've found on other forums) graphics card dependent such as looking up the registry value for ATI cards on windows (once solution I found) or digging out the nvidia driver function to query the onboard memory size (another solution).<br><br>Basically the point of finding out the vram size is so I don't have to ask the user (and most users wouldn't know anyway) something that the computer should know about itself. I can hard code for 128 and say that's a minimum and that's fine, but what about the guy with a 2gb card, no bonus for all that extra hardware. <br><br></td></tr></table><br>
<a name="994551"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xlsior</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I know that the ATI drivers store the amount of onboard VRAM in the registry, which you can retrieve... I have some code in the code archives that does this for the older ATI cards, haven't tested it yet with newer generation cards.<br>It is ATI specific though, and won't tell you anyhting for other manufacturers... presumably there should be a universal method of digging this up from the registry, since applications like DXDiag can tell you... <br><br></td></tr></table><br>
<a name="994554"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Exactly, it's gotta be somewhere... since openGL moves things back and forth it has to know somewhere.<br><br>The thread I linked before<br><a href="http://lists.apple.com/archives/mac-opengl/2001/May/msg00022.html" target="_blank">http://lists.apple.com/archives/mac-opengl/2001/May/msg00022.html</a><br>Looks like opengl functions to get the max memory size for opengl, along with current used memory... but I don't know enough about OpenGL to be able to get anything working along those lines. Especially  since there's no defined constants involving memory in opengl.mod... <br><br></td></tr></table><br>
<a name="994556"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Something mac based that could be of use.<br><a href="http://developer.apple.com/mac/library/qa/qa2004/qa1168.html" target="_blank">http://developer.apple.com/mac/library/qa/qa2004/qa1168.html</a><br>I haven't worked with C for mac in a long time so no idea if I can get this up and running but it could be start... anyone more practiced? <br><br></td></tr></table><br>
<a name="994557"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Additional googling turned up this blitmax thread, and specifically your post (#8) is of interest to me xlsior. And more specifically your mention of TotalVidMem() from B3d. never having used B3D proper, I don't know, and assume there is no way to have a look at what that function does (I'm willing to accept that it's probably flawed, but atleast it's something)... I thought I heard mention at some point that simon was given access to the B3D source to help with MiniB3D...<br><br><a href="/posts.php?topic=60505#674955" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=60505#674955</a><br><br>So scrapping opengl as a source for this information, and looking OS specific, it sounds like a directx query on windows and and IOKit/Core Graphics function on mac may return the magic number, or atleast a good guess.<br><br>It does bear repeating that I'm not looking for a flawless, byte perfect implementation of a texture memory handling system here, all I want is a guess at how many textures of a known size and bit depth I can use at one time before the memory swapping will start to destroy performance. <br><br></td></tr></table><br>
<a name="994582"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> After some more fiddling and reading here's what I've got for a dirty vram size calculator.<br><br>THardwareInfo.MaxTexSize * THardwareInfo.MaxTexSize * 4<br><br>Only tested it on a couple of cards so far but it seems promising. Here's the assumptions I'm running under for this to be a viable option.<br><br>1) The maximum texture size a system can handle is &lt;= the systems physical vram. (unconfirmed that this is compliant with opengl standards, but I don't think any current system would allow larger than vram images to be used, as it would have to do a HUGE memory swap mid render every frame...)<br>2) The system will never use 1 single texture that matches the limit. There are plenty of documented bugs with trying to use 1 maximum size texture, but I intend to use many smaller than max textures, I'm only interested in how many can I use at once.<br>3) the older the system the less likely this is to be a semi accurate number. Since I am targeting at the VERY lowest end 64mb cards, and may drop them as a minimum in favor of 128mb, I think one would be much harder pressed to find a 128 or greater graphics card that reports a minimum texture size that is a small fraction of it's vram size (e.g. it only allows up to 512x512 textures, but it  can hold 32 of them at once...) as compared to older cards. This is related to the chipset of the cards themselves but again, I want as close to the vram size without going over as possible.<br>4) There will be an override in the program's settings for power users to customize if the system is detecting a much lower value than what they are sure their card has.<br><br>It's far far far from perfect but it's better than assuming a min requirement value and giving nothing to those that exceed it without them being power users which seems to be the only other viable option. <br><br></td></tr></table><br>
<a name="994712"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> For further discussion check <a href="/posts.php?topic=87696" target="_blank">http://blitzmax.com/Community/posts.php?topic=87696</a> as I'm considering this a 3d graphics system query, not just minib3d.<br><br>I can pull the vram size on a mac, would love some help querying directx or wherever one might look on linux if anyone cares to follow. <br><br></td></tr></table><br>
<a name="995080"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flemmonk</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> I had a quick glance through here I couldn't see it mentioned, but OpenGL has a feature to determine which textures are loaded into memory. Naturally it will try to determine which textures to keep in its memory if they're frequently used, but you can manually specify this. This might be what you're after. <br><br></td></tr></table><br>
<a name="995217"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> while not being quite what I need, loading a bunch of textures and then testing to see how many are in memory would give one a rough guess at the memory capacity... how do you go about determining if they're in memory? <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
