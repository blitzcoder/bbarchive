<!DOCTYPE html><html lang="en" ><head ><title >Shaders and Effects.</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Shaders and Effects.</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=119" >MiniB3D Module</a>/<a href="#bottom" >Shaders and Effects.</a><br><br>
<a name="1012608"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FBEpyon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello,<br><br>I know this is like beating a dead horse with a stick, but i need some help, I have been working on a terrain system for the last year off and on between computers and losing source, but now that I have most of my code back I have been working on my game again, I have most of the terrain system back up which is nice, but I'm wanting to start with some new stuff like water and reflected surfaces.<br><br>I have seen a lot of different codes and what not, but nothing that I can see about making normal maps work in raw MiniB3D with out using a dll extension or completely re-writing the game out of c++, but the main reason I got Blitz was because of the coding easy and not needing additional content to make things happen (well at least super large header files and complex APIs).<br><br>Is there anything or any source that would help me with my problem I'm having, I'm looking for a bit of code that will help make the terrain and objects reflect on the waters surface but not kill the over all game's frame rate.<br><br>:GAME IDEA:<br><br>The over all game will end up being a RPG with a 3/4 view, I'm needing the reflective services and maybe some new ideas into how it would be possible to do vertex shading (vertex shadowing).<br><br>Currently I have a shadowing system for my terrain which works nice, but its very basic and I'm wanting to add shadows to my tree meshes and other buildings and such.<br><br>:EXAMPLE CODE FOR TERRAIN LIGHTING:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">

Function SetLighting:Float(x:Float, z:Float, sx:Float=.10, sz:Float=.50, max_b:Float=0.80, min_b:Float=0.3, soft:Float=.60)
	Local fs:Float

	If x&gt;=sx And z&gt;=sz
		fs = 1.0 - (terrain.hdata[x-sx,z-sz] - terrain.hdata[x,z]) / soft
	Else
		fs = 1.0
	EndIf
	If fs &gt; max_b Then fs=max_b
	If fs &lt; min_b Then fs=min_b
	
	'VertexColor terrain.hsurface,terrain.vdata[x,z],fs,fs,fs
	Return fs*255

End Function

</textarea><br><br>:EXAMPLE CODE FOR TERRAIN LIGHTING:<br><br>The code will color the vertex based on the height and light direction, but it took me a while to get it to work again as when I original code back I forgot how it worked, but since I lost the code and recently got it thanks to the grace of "WINGS", I have forgotten what it even does but it works LOL. <br><br>:GAME IDEA:<br><br>I was looking at this as well : <br><br><a href="http://en.wikipedia.org/wiki/Shadow_mapping/" target="_blank"> Shadow Mapping </a><br><br><a href="http://www.devmaster.net/articles/shadow_techniques/" target="_blank"> Shadow Techniques </a><br><br>Anyways above is the research and information I have found, now I'm just asking for help :(<br><br>Thanks for any information <br><br></td></tr></table><br>
<a name="1012657"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Try exploring the Extended version by Klepto, until you can understand the way he set things up and then you can use a similar approach.<br><br>I don't really know what's the current opinion on the Extended version shader support, but it's said to work.<br><br>As for the shadows, the good thing is that there are plenty tutorials on how to implement them with OpenGL (but with other languages) - at least shadow maps (<a href="http://www.paulsprojects.net/tutorials/smt/smt.html" target="_blank">example</a>). The only problem is adapting it to BMax and MiniB3D. <br><br></td></tr></table><br>
<a name="1012661"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jkrankie</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Didn't Klepto's version support shadows too? Anyway, the extended version is fairly out of date, but you should be able to glean the info you require from it.<br><br>Cheers<br>Charlie <br><br></td></tr></table><br>
<a name="1012678"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FBEpyon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the responce, I have gone thru the extended edition I will be looking at it more tonight when I get home from work, I'm hoping to break it apart and start adapting the current version of MiniB3D to better support shaders.<br><br>Let me know if anyone is wanting to help, email: fbepyon@... <br><br></td></tr></table><br>
<a name="1012731"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jkrankie</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Don't have time to help, but if you get shaders working with the current version then please share :)<br><br>Cheers<br>Charlie <br><br></td></tr></table><br>
<a name="1012824"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FBEpyon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello,<br><br>Thanks for all the support so far, I have one other question for everyone, I was looking at the GLSL (opengl shaders), and I noticed the vert and frag files, can anyone explain the difference of theses?<br><br>From what I have gathered its VERT for vertex shaders, as far as I can tell.  FRAG looks to stand for fragmented (pixel shader), but I don't understand how the file system would work after looking at MiniB3D Ext. <br><br></td></tr></table><br>
<a name="1013623"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FBEpyon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello (Sorry for the double post),<br><br>I'm interested in this as well, the only problem I'm having is attaching the shaders to the object or texture however it works, I got ahold of tom speeds module well the start of it.<br><br>I'm trying to get it to link to my mesh and shade it..<br><br>The current files I have are terrain_shade.vert and terrain_shade.frag, but when attached its just a black mesh. <br><br></td></tr></table><br>
<a name="1013805"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> See this:<br><a href="http://www.blitzforum.de/forum/viewtopic.php?t=30247" target="_blank">http://www.blitzforum.de/forum/viewtopic.php?t=30247</a><br><br>Kudos to ShadowTurtle for pointing out the link previously.<br><br>PS: Use translate.google.com if you can't read german, ja? <br><br></td></tr></table><br>
<a name="1013830"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SLotman</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Can someone use that code and post a sample program/shader to test?<br><br>Since it says it works with miniB3D, I would love to see if it can achieve effects like Bloom and others through shaders, instead of "basic coding" like in B3D... but I have no idea how to write pixel shader code :(<br><br>Edit: I tried this, but couldn't get it to work.... am I doing something wrong, or my card just can't run those shaders? (it does says on the debug mode it compiled successfully to run on hardware, so I assume it must be supported by the card, right?)<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Import sidesign.miniB3D
Import pub.glew

graphics3d 640,480,0,2
glewInit()

Local cam:TCamera=CreateCamera()
Local cube:TMesh=CreateCube()
Local light:TLight=CreateLight(3)

lightcolor light,0,0,255
LightRange light, 20
PositionEntity light, -10, 10,-10
pointentity light, cube

MoveEntity cam, 0,0,-5
TurnEntity cube,0,45,0
loadShader("flatten.vert","flatten.frag")

While Not KeyHit(KEY_ESCAPE)
	Cls
	turnentity cube,0,1,1
	updateworld

	glUseProgramObjectARB(ProgramObject)
	renderworld
	
	Flip
Wend

End
</textarea><br><br>flatten.vert and flatten.frag are both from <a href="http://www.lighthouse3d.com/opengl/glsl/index.php?flatten" target="_blank">this page</a> (look at the page bottom for the download link)<br><br>flatten.frag:<br><pre class=code>
void main(void)
{
	gl_FragColor = vec4(0.8,0.3,0.3,1);
}
</pre><br><br>flatten.vert:<br><pre class=code>
uniform float time;

void main(void)
{
	vec4 v = vec4(gl_Vertex);
	v.z = sin(5.0*v.x+time)*0.5;
	gl_Position = gl_ModelViewProjectionMatrix * v;
} 
</pre> <br><br></td></tr></table><br>
<a name="1013887"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FBEpyon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> I tried the code as well, and the only thing I can think of is there is missing Uniform Code, but I don't know where that goes..? <br><br></td></tr></table><br>
<a name="1013902"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SLotman</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> 'uniform float' is not a code missing, it's a variable type.<br><br>I think this won't work as the guy said on the post, just by putting the glUseProgram before renderworld. I will try to write some pure ogl code to test it, and see the results :/ <br><br></td></tr></table><br>
<a name="1013933"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SLotman</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Got it working... sorta.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Import sidesign.miniB3D
Import pub.glew

graphics3d 640,480,0,2
glewInit()

Local cam:TCamera=CreateCamera()
Local cube:TMesh=CreateCube()
Local light:TLight=CreateLight(3)

lightcolor light,0,0,255
LightRange light, 20
PositionEntity light, -10, 10,-10
pointentity light, cube

MoveEntity cam, 0,0,-5
TurnEntity cube,0,45,0
Local myShader:Int = loadShader("flatten.vert","flatten.frag")

While Not KeyHit(KEY_ESCAPE)
	Cls
	turnentity cube,0,1,1
	updateworld

	glUseProgramObjectARB(myShader)
	renderworld
	
	Flip
Wend

End
</textarea><br><br>The important thing I was missing was to read the return value from loadshader, and use that on glUse...;<br><br>The bad thing is, instead of flatening, the cube became a plane... bug in the shader? in the loader? ATI's faulty implementation? :( <br><br></td></tr></table><br>
<a name="1013949"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FBEpyon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> See I tried that as well, and got nothing from it, I think I might be doing something wrong as well, I'm using a Nivida GTS 240 and it supports all the shaders needed, I'm at work and will look again, maybe its working I just need to move the camera..<br><br>P.S if you are using the small fix version of Minib3d, you don't need the glewInit() in the top its part of the Graphics3D command now.<br><br>Also:<br><br>Try not rotating the cube by 45 when you first make it, just let the turnentity code after words handle that for you instead.  I have a feeling its just the prospective you are looking at the model, but in my case I still get nothing from the above code for a Nvidia Card. <br><br></td></tr></table><br>
<a name="1013992"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SLotman</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> The problem is (as far as I could gather) GLSL isn't that well supported on drivers, so there are lots of issues on different cards. <br><br>Probably using CG would be a better idea, I don't know. I guess that's why most people go to Direct-X, much easier to get shaders going there.<br><br>I can guarantee that the code is working and running the shaders. If the shader itself doesn't work, it's a driver issue. (I tested several shaders here, I could only get 1 to work as intended...)<br><br>As for miniB3D, I'm using my own version (I'm the one who gathered and posted about all 'small fixes' on that thread - even fixed a couple of problems myself, and I keep looking for more improvements here and there all the time); I just posted the glewInit() there to be on the safe side. <br><br></td></tr></table><br>
<a name="1014008"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FBEpyon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay,<br><br>I was looking at the Small Fixes and I was wanting to know why Minib3D is using the SEtGraphicsDriver GLMax2DDriver() and not using the GLGraphicsDriver(), I would think that if you are trying to use OpenGL u would set the Graphics3D() command to mix with the GLGraphicsDriver() not the GLMax2DDriver().<br><br>I was just looking thru the commands. <br><br></td></tr></table><br>
<a name="1014018"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SLotman</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> It uses it, so you can use normal bmax commands to draw 2D on top of everything. <br><br></td></tr></table><br>
<a name="1014023"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FBEpyon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> WOW you must be surfing the web lol..<br><br>Anyways so I was looking at this thread : <a href="http://www.blitzmax.com/Community/posts.php?topic=88944" target="_blank">http://www.blitzmax.com/Community/posts.php?topic=88944</a><br><br>I see there are something not added into the minib3d that might be cause the problems, we might want to look into adding something the other ENABLE COMMANDS. <br><br></td></tr></table><br>
<a name="1015635"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >nrasool</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey there,<br><br>Even though this is a week old, I tested it out and it works for me, I even tested your example with the following shader and again it works for me, see <a href="http://www.clockworkcoders.com/oglsl/tutorial4.htm" target="_blank">http://www.clockworkcoders.com/oglsl/tutorial4.htm</a> <br><br></td></tr></table><br>
<a name="1015696"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SLotman</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> nrasool: I never said it wouldn't work... but get it working on all cards, that's the problem, since GLSL isn't all that well supported as CG for example.<br><br>I got *some* shaders working here on ATI, but most of them ran and didn't produce the desired result, like that 'flatten' shader I posted.<br><br>(Which is a shame really, this would be fairly easy to integrate into miniB3D) <br><br></td></tr></table><br>
<a name="1015783"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FBEpyon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have a very good Video Card and I can't seem to get any of the examples to work..<br><br><div class="quote"> <br><br>nrasool<br> <br>Hey there,<br><br>Even though this is a week old, I tested it out and it works for me, I even tested your example with the following shader and again it works for me, see <a href="http://www.clockworkcoders.com/oglsl/tutorial4.htm" target="_blank">http://www.clockworkcoders.com/oglsl/tutorial4.htm</a>  <br><br> <br></div><br><br>I have a GTS 240 Nvidia 1Gb, but I will try that shader. <br><br></td></tr></table><br>
<a name="1015813"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >nrasool</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey there, <br><br>Weird as both examples work for me, very strange. My graphics card is Nvidia Geforce 8500 GT 1gb<br><br>One thing for FBEpyon is have you updated to the latest driver? I'm using 6.14.11.8122 which is working well so far<br><br>@SLotman I take what you meant, sorry if I was not clear, it is a shame that OpenGL drivers seems to be flaky with you, as this is a great way of implementing shader without any fuss <br><br></td></tr></table><br>
<a name="1015889"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FBEpyon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello,<br><br>I was able to get both examples to work with klepto2 new ext2 version and its very fast !!<br><br>So I think I figured it out now.. <br><br></td></tr></table><br>
<a name="1030997"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >nrasool</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey FBEpyon<br><br>Sorry to resurrect this thread, but what did you do, did you customised your minib3d to include part of klepto2 new ext2 version concerning shaders? If so, please can you post what you did<br><br>Many thanks<br><br>Kind Regards <br><br></td></tr></table><br>
<a name="1031028"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >klepto2</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi, <br><br>he is saying that he was using ext2 version. <br><br>@all: I have 2 weeks of free time from the upcoming week and I will try to add clean up the googlecode version a bit. eg: uploading per SVN, adding some more loaders, a few other samples and a few experimental files.<br><br>The experimental files contains a very simple shadowmapping sample via shaders so this may a good start for someone to implement shadowmapping completely.<br><br>screens:<br><br>experimental bsp loader:<br><img src="http://i2.photobucket.com/albums/y48/klepto2/BSPBezier.jpg"><br><br>shadowmapping:<br><img src="http://i2.photobucket.com/albums/y48/klepto2/PCFShadow.png"> <br><br></td></tr></table><br>
<a name="1031033"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello Klepto2, this looks very nice. <br><br>Some sort of PCF or filtering going on?<br><br>PS: did you get my e-mail about the GLSL sprite rotation? <br><br></td></tr></table><br>
<a name="1073919"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KronosUK</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> Any movment on this? I'm particularly interested in the shadowmapping. <br><br></td></tr></table><br>
<a name="1079978"></a>

<a name="1079979"></a>

<a name="1079980"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FBEpyon</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> <textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Import sidesign.miniB3D
Import pub.glew
graphics3d 640,480,0,2

Local cam:TCamera=CreateCamera()
Local cube:TMesh=Createcube()
Local light:TLight=CreateLight(3)

Local shader:Int = loadShader("flatten.vert","flatten.frag")

Local colorMap:Int= loadtexture("color_map.jpg") '; colorMap.TextureBlend(2)
Local normalMap:Int= loadtexture("normal_Map.jpg") '; normalMap.TextureBlend(4)

TextureBlend colormap,2

EntityTexture cube, colormap
entitytexture cube, normalMap

lightcolor light,255,255,255
LightRange light, 50
PositionEntity light, -10, 10,-10
pointentity light, cube

MoveEntity cam, 0,0,-5
TurnEntity cube,0,45,0

updatenormals cube

glewInit()

While Not KeyHit(KEY_ESCAPE)
Cls

	turnentity cube,0,1,1
	
	updateworld

	If KeyHit(KEY_1) 
		glUseProgramObjectARB(shader)

	ElseIf KeyHit(KEY_2)
		glUseProgramObjectARB(0)

	EndIf
		
	renderworld

	Flip 'False
Wend

End

Function loadShader:Int(file:String, file2:String)
   Local ProgramObject:Int
   Local VertexShaderObject :Int '  : GLhandleARB;
   Local FragmentShaderObject : Int 'GLhandleARB;

   ProgramObject=glCreateProgramObjectARB()
   VertexShaderObject   = glCreateShaderObjectARB(GL_VERTEX_SHADER_ARB);
   FragmentShaderObject = glCreateShaderObjectARB(GL_FRAGMENT_SHADER_ARB);
   
   Local fileStream:TStream=OpenFile(file)
   Local fileStream2:TStream=OpenFile(file2)
   
   Local shaderSrcVertex:Byte[FileSize(file)+1]
   Local i:Int=0
   While Not Eof(fileStream)
      shaderSrcVertex[i] = ReadByte(fileStream)
      i:+1
      If i&gt;FileSize(file) Then i = FileSize(file)
   Wend
   CloseFile(fileStream)
   
   Local pointer:Byte Ptr = Varptr shadersrcVertex[0]
   Local laenge:Int=FileSize(file)
   
   glShaderSourceARB(VertexShaderObject,1,Varptr pointer,Varptr laenge)
   glCompileShaderARB(VertexShaderObject)
   
   debugShader(VertexShaderObject)
      
   Local shaderSrcFragment:Byte[FileSize(file2)+1]
   i=0
   While Not Eof(fileStream2)
      shaderSrcFragment[i] = ReadByte(fileStream2)
      i:+1
      If i&gt;FileSize(file2) Then i = FileSize(file2)
   Wend
   CloseFile(fileStream2)
   
   pointer = Varptr shadersrcFragment[0]
   laenge=FileSize(file2)
   
   glShaderSourceARB(FragmentShaderObject,1,Varptr pointer,Varptr laenge)
   glCompileShaderARB(FragmentShaderObject)
   
   debugShader(FragmentShaderObject)

   
   
   glAttachObjectARB(ProgramObject, VertexShaderObject)
   glAttachObjectARB(ProgramObject, FragmentShaderObject)

   glDeleteObjectARB(VertexShaderObject)
   glDeleteObjectARB(FragmentShaderObject)

   glLinkProgramARB(ProgramObject);
   
   Return ProgramObject
End Function

Function debugShader(shaderObject:Int)
   Local laengedeslogs:Float
   glGetObjectParameterfvARB(shaderObject,GL_OBJECT_INFO_LOG_LENGTH_ARB,Varptr laengedeslogs)


   Local bytearray:Byte[]=New Byte[laengedeslogs]
   Local laenge23:Int=0
   glGetInfoLogARB(shaderObject, laengedeslogs, Varptr(laenge23), Varptr(bytearray[0]));
   Local msg:String=""
   For Local j:Int=0 To laengedeslogs-1
      msg=msg+ Chr(bytearray[j])
   Next
   DebugLog "ShaderLog: "+msg
End Function
</textarea><br><br>vertex code<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
varying vec3 lightVec; 
varying vec3 eyeVec;
varying vec2 texCoord;
attribute vec3 vTangent; 
					 

void main(void)
{
	gl_Position = ftransform();
	texCoord = gl_MultiTexCoord0.xy;
	
	vec3 n = normalize(gl_NormalMatrix * gl_Normal);
	vec3 t = normalize(gl_NormalMatrix * vTangent);
	vec3 b = cross(n, t);
	
	vec3 vVertex = vec3(gl_ModelViewMatrix * gl_Vertex);
	vec3 tmpVec = gl_LightSource[0].position.xyz - vVertex;

	lightVec.x = dot(tmpVec, t);
	lightVec.y = dot(tmpVec, b);
	lightVec.z = dot(tmpVec, n);

	tmpVec = -vVertex;
	eyeVec.x = dot(tmpVec, t);
	eyeVec.y = dot(tmpVec, b);
	eyeVec.z = dot(tmpVec, n);
}

</textarea><br><br>fragment file<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
varying vec3 lightVec;
varying vec3 eyeVec;
varying vec2 texCoord;
uniform sampler2D colorMap;
uniform sampler2D normalMap;
uniform float invRadius;

void main (void)
{
	float distSqr = dot(lightVec, lightVec);
	float att = clamp(1.0 - invRadius * sqrt(distSqr), 0.0, 1.0);
	vec3 lVec = lightVec * inversesqrt(distSqr);

	vec3 vVec = normalize(eyeVec);
	
	vec4 base = texture2D(colorMap, texCoord);
	
	vec3 bump = normalize( texture2D(normalMap, texCoord).xyz * 2.0 - 1.0);

	vec4 vAmbient = gl_LightSource[0].ambient * gl_FrontMaterial.ambient;

	float diffuse = max( dot(lVec, bump), 0.0 );
	
	vec4 vDiffuse = gl_LightSource[0].diffuse * gl_FrontMaterial.diffuse * 
					diffuse;	

	float specular = pow(clamp(dot(reflect(-lVec, bump), vVec), 0.0, 1.0), 
	                 gl_FrontMaterial.shininess );
	
	vec4 vSpecular = gl_LightSource[0].specular * gl_FrontMaterial.specular * 
					 specular;	

	gl_FragColor = ( vAmbient*base + vDiffuse*base + vSpecular) * att;
}

</textarea><br><br>Hello All,<br><br>Can you please look at this, I'm not able to get the textures to blend and give me my normal mapping.. :(  can you see what I might be missing..<br><br>Get images from here <a href="http://www.ozone3d.net/tutorials/normal_map.php" target="_blank">http://www.ozone3d.net/tutorials/normal_map.php</a><br><br>Thanks,<br><br>Fbepyon<br><br><font class="tiny">Last edited 2011</font><br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
