<!DOCTYPE html><html lang="en" ><head ><title >Annoying Cull Bug</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Annoying Cull Bug</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=119" >MiniB3D Module</a>/<a href="#bottom" >Annoying Cull Bug</a><br><br>
<a name="1310815"></a>

<a name="1310816"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Streaksy</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Has anyone else had this problem?  Entities (meshes), especially if their entity scale is a bit low, vanish when the camera gets close.  I've tried changing the camera near range to like .01 and the far range to something small like 100 and it still happens.  I've searched the code for autofade incase that was doing something weird but it's not anywhere.<br><br>It seems to happen when the entity is within (.5 divided by entityscale) radius of the camera.  Something like that.<br><br>Big static map geometry whose entity position is origin (0,0,0) are unaffected.  It's just the small dynamic objects that vanish when they get close.<br><br>I don't know what else to try.  ;/ <br><br></td></tr></table><br>
<a name="1310846"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Zethrax</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've had that problem with some animated third-party models. I suspect whichever pivot/bone is used as the reference for the culling is placed outside the visibility area.<br><br>Try iterating the parent-child hierarchy and placing some text at the position of the bone in 3D space. This will tell you if the model needs to be edited - either by you, or by the creator if it is a defective product you've bought.<br><br>I'll write some code for this after work tonight and post it here. I need it for a model I'm using for a project anyway. <br><br></td></tr></table><br>
<a name="1310858"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Streaksy</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> No bones involved.  It's all stuff made with CreateMesh or CreateSphere/whatever.  I haven't actually tried an animated model but I imagine it would be the same. <br><br></td></tr></table><br>
<a name="1310859"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Streaksy</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> And by the way, it's does it when the mesh has no parent entity. <br><br></td></tr></table><br>
<a name="1310861"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Streaksy</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> OKAAAAAAAYYYYYYY I found a solution.  And it's weird.<br><br>I noticed that it didn't happen to vertex-lightmapped meshes.... so I tried setting the entities' FX to 2 (vertex colours) instead of default (0 I guess) and it stopped happening. :O<br><br>It's not the only weird bug only I seem to have.  It takes a few seconds for fog to kick in.  I even do a timed render loop without Flip before the program starts, just to get it out the way.  The time it takes to kick-in is very random so it still kinda messes with the experience.<br><br>Thanks for replying anyways.  I think I have a workaround. <br><br></td></tr></table><br>
<a name="1310865"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Streaksy</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nope it's still happening in some cases.  Egh.  Sigh.  A good 20% of this is finding bug workarounds. <br><br></td></tr></table><br>
<a name="1310956"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Zethrax</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Can you post some example code that reproduces the problem? Otherwise all I can give you is guesses. <br><br></td></tr></table><br>
<a name="1310983"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Streaksy</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Not without posting 1.5mb of complex bmx files and 60 mb of media that it needs to run.  I was just hoping someone had come accross it and had an idea of why it happens.<br><br>But like... in this project, if I create a few basic meshes (spheres or whatever), just for testing purposes, and move the camera close to them, they vanish.<br><br>CreateCamera<br>CreateSphere<br>PositionCamera<br>Renderworld<br>Flip<br><br>It's all you need for it to happen.  But mainly in this project, and I've pored through the code trying to work out why... tinkering with camera range, doing searches for "autofade" and stuff.<br><br>I wonder if it's actually related to that fog bug?  Okay... this project is a game engine and map editor, and each map has two states - editing and finalised (lightmapped etc).  In finalised state fog is enabled and small objects are vertex lightmapped, hence vertex colours (fx2), and they are much less likely to disappear.<br><br>Anyway, if it hasn't happened to anyone else I don't think I can fix it.  I've always gotten weird and unique bugs.  ;/ <br><br></td></tr></table><br>
<a name="1311023"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Zethrax</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Could you make a video of the problem then and upload to Youtube or somewhere similar. The free version of Fraps ( <a href="http://www.fraps.com/download.php" target="_blank">http://www.fraps.com/download.php</a> ) would probably work for this.<br><br>Only idea I've got right now is that it's a near camera range clipping thing, but it sounds like you've got enough experience to have eliminated that as a possibility. <br><br></td></tr></table><br>
<a name="1311168"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Streaksy</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah and the geometry doesn't progressively Z-out as it comes within the camera's near-radius - the whole object is either drawn or invisible.  I could fraps it for you but there's really nothing to see that I haven't said.  ;/  So strange.  It's okay though I'll have to live with it.  It's one of those things.  Thanks for all the replies. <br><br></td></tr></table><br>
<a name="1311170"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >grable</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> If it only happens when the mesh/surface has alpha, then its probably the entity alpha ordering that is messing up.<br><br>There is code for this spread all over, but the gist of it is in:<br>TGlobal.bmx:TGlobal.RenderCamera()<br>TMesh.bmx:TMesh.Alpha()<br>TEntity.bmx:TEntity.EntityListAdd()<br><br>Try printing some messages in RenderCamera() and see if your entity really is within the frustrum and if <b>alpha_order</b> is set to some unreasonable value. <br><br></td></tr></table><br>
<a name="1311208"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Does it affect MiniB3d or OpenB3d? Or both? <br><br></td></tr></table><br>
<a name="1311236"></a>

<a name="1311237"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Streaksy</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Never tried OpenB3D...<br><br>The entities alphas are 1, and their textures are loaded without the alpha flag... but I'll get some frustrum feedback.  Worth knowing. <br><br></td></tr></table><br>
<a name="1312296"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Streaksy</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello again.<br><br>Great news!  Fog doesn't work at all anymore.  WHAT IS GOING ON??? <br><br></td></tr></table><br>
<a name="1312302"></a>

<a name="1312311"></a>

<a name="1312312"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Streaksy</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Agh help :P<br><br>I do two types of render depending on light conditions.  A lot to explain, but really the only thing that changes is the entityfx (vertex colour mode or normal), and existence of light entities.<br><br>Now... on one render fog is ignored.  On the other, fog is drawn.  Here's the mad thing.  I've tried setting the entityfx to 0 and creating a dummy light on the second render (the render that fog doesn't work) and it still doesn't work.<br><br>And earlier in the project, it DID work in that mode.  I've tried adding the following RIGHT BEFORE the RenderWorld.<br><br>LightFogMode cam,1<br>LightFogRange cam,.1,3<br>LightFogColor cam,250,0,0<br>EntityFX mesh,0<br><br>So... I can't work out what other conditions could be causing fog to be ignored.<br><br>I even tried creating an untouched sphere before renderworld and freeing it after, to see if it was a property of the mesh that causes the fog to not work, but that test mesh was unfogged aswell.<br><br><br>So... the ONLY difference between the two renders that I know of is that the WORKING one is rendering to an image while the BROKEN one is just doing the normal screen render.  Yes, it uses a tweak of the MiniB3D code, but even when I replace all my stuff with normal renderworld, same result.  So.  Question is... anyone know any conditions that could be preventing fog?  Cheers.<br><br><br>EDIT:<br>I have found that fog kicks in after several renders if there is tons of geometry.  Mental.  So, I've finally found a workaround involving 4 seconds of rendering a ton of randomised geometry at the start of the program.  The REALLY mad thing is it only works if there is a "Flip".  Annoying, but there you go.  Once it's rendered I have to clear the screen before the flip. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
