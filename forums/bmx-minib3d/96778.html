<!DOCTYPE html><html lang="en" ><head ><title >iminib3d leaks when copying entity</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >iminib3d leaks when copying entity</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=119" >MiniB3D Module</a>/<a href="#bottom" >iminib3d leaks when copying entity</a><br><br>
<a name="1120842"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm doing leak checks and I'm getting quite a few, all from Brush::Copy()  and Surface::Surface(). Both 80 bytes. I can't quite figure out what's going sideways...<br><br>My app does a large number of entity copies (and freeing of those entities) on meshes so it's probably not something that would usually pop up. I'm not 100% that is a copy entity problem but it very much seems like it.<br><br>Any thoughts on where to dig would be much appreciated. <br><br></td></tr></table><br>
<a name="1120843"></a>

<a name="1120844"></a>

<a name="1120845"></a>

<a name="1120846"></a>

<a name="1120847"></a>

<a name="1120849"></a>

<a name="1120850"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Definitely a copy problem... using copy mesh or copy entity it leaks. If I create new meshes every time it doesn't leak. I'm not sure CopyEntity gives any render time improvements on iOS over just using dedicated meshes each time, if it doesn't it's not a problem for me I can just create a new mesh each time, but would prefer to do it "right"... just have to stop the leaks...<br><br>Update:<br>mesh-&gt;brush=*brush.Copy(); line 97 in mesh.mm causes the brush leak, I assume the surface leak is in the surface area of the copy. Not sure how to work around it...<br><br>Update 2:<br>changing mesh-&gt;brush=*brush.Copy(); to mesh-&gt;brush = brush; fixes the brush leak and doesn't seem to cause any problems... not sure why it was copying in the first place which concerns me a little...<br><br>No luck with surfaces...<br><br>Update 3:<br>AHA! new_surf-&gt;brush=surf-&gt;brush-&gt;Copy(); needs to delete the new_surf-&gt;brush before setting the new one (like it does in create surface). Put delete new_surf-&gt;brush; right above new_surf-&gt;brush=surf-&gt;brush-&gt;Copy(); and the surface leaks go away... I *think* this is all legit. Would love to get some feedback from simon to confirm I'm not creating a gremlin... the brush copy is the main thing that worries me.<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1120893"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >simonh</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks ima747. Good work digging these out.<br><br>Your fixes look fine to me. I was worried that the 'mesh-&gt;brush = brush' fix might cause problems with shared pointers, but then I realised the brushes that belong to an entity (and so a mesh) aren't actually pointers, but are actual brush objects. So that fix copies the brush properties from one to the other as it should do. <br><br></td></tr></table><br>
<a name="1120894"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yay, thanks for the insight. Always makes me nervous when I fix stuff by hitting it until the warnings die... <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
