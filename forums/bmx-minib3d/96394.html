<!DOCTYPE html><html lang="en" ><head ><title >Alpha Z Order problem?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Alpha Z Order problem?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=119" >MiniB3D Module</a>/<a href="#bottom" >Alpha Z Order problem?</a><br><br>
<a name="1115230"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kittomer</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Can anyone explain this?<br><br><img src="http://www.kittomer.com/temp/dragoncraft_alphaproblem.jpg"><br><br>This is what it SHOULD look like:<br><br><img src="http://www.kittomer.com/temp/dragoncraft_alphaproblem_good.jpg"><br><br>It happens when I load the texture atlas for the terrain with the alpha flag enabled.<br><br>I searched around but I wasn't able to find a solution or even an explanation.<br><br>The texture is a 24bit PNG with transparency. <br><br></td></tr></table><br>
<a name="1115301"></a>

<a name="1115302"></a>

<a name="1115303"></a>

<a name="1115304"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> <b>EDIT:</b> aww <i>nuts</i> I answered this on autopilot assuming we were in the Blitz3D section. The answer below may be true of OpenGL 1.whatever miniB3D uses, or it may be totally off; I have no idea. Sorry!<br><br><br>---<br><br><br>DirectX 7 doesn't support Z-ordering for polygons with alpha, sadly. Blitz3D will attempt to order the polygons based on the centre position of the whole object, so if the cube is nearer to the camera than the centre of the terrain, it will be drawn after the terrain, regardless of individual polygon positions. Within the object, polygons will be drawn in their mesh order regardless of distance from the camera, so it's best for alpha objects to be completely convex, too.<br><br>The best way to fix this is to severely limit your use of alpha, by splitting your larger objects into small, convex components that either do or don't have alpha applied to them at the moment. That way you can make it so that as far as possible the cube only overlaps subunits of the terrain that don't currently have alpha applied.<br><br>This restriction doesn't apply to masked textures, by the way, since texels are either visible or not, and it's therefore easy for a pixel to have a fixed depth value.<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1115308"></a>

<a name="1115309"></a>

<a name="1115310"></a>

<a name="1115311"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AdamRedwoods</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Pretty much the same.<br><br>When your whole texture is flagged for alpha, you're going to get a mixed bag of sorting for all those objects, which as Yasha explained is based on z-ordering the center of each object. It needs to be drawn in a layered order from furthest to closest.<br><br>To fix this in miniB3D, there are a few ways. I usually set the atlas texture to a non-alpha, so by default, objects get the depth-buffer in openGL. But for any alpha entities, try setting them to be alpha-sorted, and it should solve the problem:<br><pre class=code>
EntityFX(yourentity, 32)
'' ...or...
EntityAlpha(yourentity, 0.9999)
</pre><br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1115328"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Entities randered with alpha are manually render ordered by minib3d based on object center point distance from camera. There can be plenty of quirks for plenty of reasons. Generally speaking if ordering is critical you can't involve alpha or things are going to go sideways on you... I'm a huge fan of alpha effects but the headaches they can raise are pretty staggering. A simple hack, if you can afford the overhead, in some situations is to break alpha things up into smaller chunks so that the center point is a more accurate representation of the render surface so the z ordering is more appropriate. I'm guessing you're batching objects based on those screen shots, probably for rendering speed, so that likely isn't an option for you... <br><br></td></tr></table><br>
<a name="1115532"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kittomer</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmmm... I suppose I will have to split alpha blended faces into a different mesh then.<br>That will make things a bit more complicated.<br><br>It's probably not hard to get it to work, but it will double my drawcalls, essentially.<br><br>Either that or try to run with masked, there don't seem to be any z order problems when I use the mask flag instead of the alpha flag.<br><br>I hoped it was just a flag I forgot to set, or something, oh well.<br>Thanks everyone! <br><br></td></tr></table><br>
<a name="1119189"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jtfrench</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> What workaround did you end up going with? I encountered this same problem and ended up just breaking down objects so that they were smaller. Had to eat the cost for breaking up batching. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
