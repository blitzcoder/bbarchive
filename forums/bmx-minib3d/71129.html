<!DOCTYPE html><html lang="en" ><head ><title >Solution to the gimbal lock!!!</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Solution to the gimbal lock!!!</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=119" >MiniB3D Module</a>/<a href="#bottom" >Solution to the gimbal lock!!!</a><br><br>
<a name="795079"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KimoTech</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi all! I discovered that there was some problems by recieving the global rotation coords from EntityPitch yaw roll, because of the gimbal lock. But why not just add all the parents rotation degrees together, and then you've got the global rotation coords? and then just MOD them to 360? <br><br></td></tr></table><br>
<a name="795088"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Koriolis</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Because this is not correct. Adding all the angles together is matematically incorrect and doesn't lead to the expected result.<br>If you were converting the rotations to matrices, and multiplying them, then you'd get the expected result.<br>But merely adding the angles won't do it. <br><br></td></tr></table><br>
<a name="795161"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KimoTech</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> i've made a test against Blitz3D, and it is correct!<br><br>if you've got an entity with a parent, and that parent has got a parent too, then look here:<br><br>+ Entity : Local Pitch = 90<br>|-+ Entity : Local Pitch = 90   &lt;-- Here the child is at 180 degrees in global right?<br>...|-+ Entity : Local Pitch = 90   &lt;-- And now this entity's pitch is 270 global right?<br><br>thats it! just add all the parents angle-degrees together. <br><br></td></tr></table><br>
<a name="795163"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Koriolis</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> [Disclaimer: this is from very very old memories of distant 3d experience. It may be bull***]<br><br>Nope. You are doing it with only one of the angles that is different of zero. In short, you're thinking in 2D.<br><br>Try with rotations where all the 3 angles (Pitch, Yaw and Roll) are different from 0, and see by yourself.<br>The problem is the final rotation depends on the order the 3 angles are applied (I can't remember what this order is in Blitz3D).<br>The first angle is applied on a given axis.<br>Then the second angle is applied on a second axis, but this axis is itself rotated already, so the result depends on the previous rotation.<br>Same for the final axis (rotation depends on the 2 previous rotations).<br><br>If the result of a single Pitch/Yaw/Roll already depends on the order of the axis rotations, you can imagine, that simply doing consecutive Pitch/Yaw/Roll rotations won't work great. <br><br></td></tr></table><br>
<a name="795197"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KimoTech</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> but it's working in my engine? i testet it with an entity, which is attached on another, and then moved 4 units in local space, and then i have set the parent to rotate 1 degree on each axis each frame, and it looks like it should? <br><br></td></tr></table><br>
<a name="795223"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Koriolis</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well it's hard to see just by eye that the rotation is incorrect, usually all you'll see is that indeed the rotations add up.<br>But they don't add as they should. You'd need to compare with rotations done with equivalent matrixes, all multiplied.<br>Also I suggest you search google for Pitch/Yaw/Roll or "euler Angles", you should find a lot of information on the problem.<br><br>But again, maybe I overlooked something. The last time I did 3D was literally in another life.<br><br>And concerning the gimbal lock per se, you'll find even more information. Needless to say, lots of smart people have studied the problem, so rest assured this was not an imaginary problem that can be solved with a simple modulo. <br><br></td></tr></table><br>
<a name="795313"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I thought using Quats gets around the gimbal lock problem? <br><br></td></tr></table><br>
<a name="795330"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Koriolis</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Totally correct.<br>But Qimmer was suggesting to directly add the individual components of the euler angles (Pitch/Yaw/Roll), which is totally different (and incorrect).<br>With Quaternions, one would convert the euler angles to Quaternions, compose them, and convert back the result to Euler angles. <br><br></td></tr></table><br>
<a name="795379"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KimoTech</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> but thats the problem when converting back to euler angles again, because then the gimbal lock occurs .. but i tried to look at the coordinates returned by decomposing the quaternion rotated by the euler angles, and then the euler angles added together, and they are the same? why is my method incorrect then? <br><br></td></tr></table><br>
<a name="795383"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> but thats the problem when converting back to euler angles again, because then the gimbal lock occurs <br></div><br><br>I wouldn't have thought so. Isn't it the case that the process of applying the different angles causes the lock, therefore, when that process is done using Quats you avoid the issue altogether.<br>There's just the overhead of converting between one system and another. <br><br></td></tr></table><br>
<a name="795403"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Floyd</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Gimbal lock is inherent to Euler angles and is not a matter of conversion between systems. It happens when an axis gets rotated exactly onto another axis, causing later rotations to become undefined.<br><br>The technique of adding parent and child angles is wrong because it simply does not work. It may work in certain special cases, such as only one axis being used. But in general it will fail. <br><br></td></tr></table><br>
<a name="843002"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KimoTech</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wrong! Because i am using the addition-method in euler angles, and it works fine with the parent/child system, and it all rotates fine. <br><br></td></tr></table><br>
<a name="843017"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Qimmer:<br>People much smarter than you or I worked for years trying to solve the gymbal lock problem with Euler matrices, and failed.  That's why they invented Quaternions.  <br><br>Trust what people above are telling you.  You haven't solved the gymbal lock issue.  And if you have "solved" it, then you've done it in a way which won't work in the general case where you have to transform objects to one matrix or another and all that weird crap people who don't use Blitz have to concern themselves with. :-) <br><br></td></tr></table><br>
<a name="843074"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KimoTech</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> But in my nexus engine i am through developing, i have a skinned mesh working 100% with this method? <br><br></td></tr></table><br>
<a name="843095"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Koriolis</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Define "working". <br>Do the angles accumulate? Yes.<br>Do the angles accmulate as they sould? No.<br><br>To be usefull, angle composition should work whatever the original angle was, right? That's not the case with euler angles, that's it. To be honest I'm surprised you still question the reality of the problem. There should be enough material on the net for you to understand what the problem is all about. <br><br></td></tr></table><br>
<a name="843102"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KimoTech</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> working = an animated zombie mesh walking around on a plane. And when you use a skeleton as this one in milkshape, a lot of the bones are rotated specially to fit the special axes of the bones, but still, the whole zombie animates ok. <br><br></td></tr></table><br>
<a name="843271"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> To clarify, gimbal lock is actually a math problem, not a percieved issue. it is a flaw in the concept of euler angle implimentation. Eulers are really meant to represent a snap shot of a rotation, and as such don't handle rotation as well as other representations (such as quats) which are designed for motion.<br><br>The issue lies in the base code of MiniB3. It is based on a Euler system, there's no way to get around that besides re-coding it from the inside out (as simon has stated he would like to do at some point but it's a MASSIVE undertaking) so no matter what you do your angles will end up as eulers in minib3d and will suffer from gimbal lock.<br><br>Check wikipidia for more details on eulers and gimbal lock. The bottom line is gimbal lock is not fixable in the current iteration of minib3d no matter how you try to out smart it because of the way in which the rotations are stored and applied in the engine itself.<br><br>I retract that statement. theoreticly you could make your program handle ALL rotation calculations in it's own quats and then convert the final angle to eulers and apply that staticly to each entity each frame... but the whole reason of using an engine is so you don't have to do exactly that kind of thing... so if you were to do that you'd be better off making a spin off of minib3d in the first place...<br><br>I've spent a lot of time trying to work around the issue myself, trying to track orientations and so forth externaly and then apply them to an entity etc. and it will work 95% of the time but then all of a sudden you'll try to do a barrel roll and your object will invert 3 times and then come out facing left and upside down because the adaptation is being back corrected by the eulers. so you have to replace them completely to fix the issue.<br><br>You can make it better, but you can't make it go away, and when it's better it's harder to figure out what angles are triggering the gimbal lock <br><br></td></tr></table><br>
<a name="843427"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="http://youtube.com/watch?v=y7WAGYAkf98" target="_blank">A barrel roll?</a> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
