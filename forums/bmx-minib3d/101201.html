<!DOCTYPE html><html lang="en" ><head ><title >race cars turning between path around track</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >race cars turning between path around track</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=119" >MiniB3D Module</a>/<a href="#bottom" >race cars turning between path around track</a><br><br>
<a name="1200425"></a>

<a name="1200426"></a>

<a name="1200427"></a>

<a name="1200428"></a>

<a name="1200429"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >redmoth</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm experimenting with race cars following a preset path of coordinates (checkpoints) around a race track.  The current system works, but currently the cars immediately rotate to the next checkpoint and I'm trying to get them to turn smoothly, and hopefully from this I can work out how fast they should go to be able to turn.<br><br>My car has a max speed of 3, and a max turning of 3, (MAX_TURN), which is the maximum it can turn every loop.<br><br>I also reduce the max the car can turn at higher speeds for example:<br><pre class=code>
		If inputSteer &lt; 0 Then
			mesh.TurnEntity(0,((inputSteer*MAX_TURN)+(speed/2)),0)
		Else If inputSteer &gt; 0
			mesh.TurnEntity(0,((inputSteer*MAX_TURN)-(speed/2)),0)
		End
</pre><br><br>So, for the computer cars I want to work out how far they have to turn to the next checkpoint and if it's greater than MAX_TURN, slow the car down.<br><br><br>Currently, I'm just pointing the computer cars to the next checkpoint <br><pre class=code>
If EntityDistance(mesh,targetPivot) &lt;= 9 Then 'if near to the checkpoint
    checkPoint+= 1
    mesh.RotateEntity(DeltaPitch(mesh,targetPivot)*0.9,DeltaYaw(mesh,targetPivot)*0.9,0.0)
    targetPivot.PositionEntity(nxtCheckX,-2,nxtCheckZ) 'move the cars target pivot to the next checkpoint X and Z locations	
End
</pre><br><br>My best idea is something like this, but I'm not a great mathematician and am not sure if my idea is flawed:<br>1. get the DeltaYaw between the car and the checkpoint<br>DeltaYaw(mesh,targetPivot)<br>2. Divide it by the distance between the car and the targetPivot<br>3. Divide that by the maximum turn speed at that speed ie: leftToTurn:float = (TURN_SPEED)+(speed/2)<br>4. If the remaining angle s greater than the leftToTurn variable then slow the car down slightly.<br><br>Any help would be appreciated.<br>(In the code above I'm using minib3d + monkey, but also have minib3d and blitzmax if that's easier)<br><br>Images, if it's easier:<br><img src="http://i.imgur.com/atvZCFv.png"><br><br><img src="http://i.imgur.com/AlnmoRr.png"> <br><br></td></tr></table><br>
<a name="1200434"></a>

<a name="1200435"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Chapman7</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I would use a Bezier Curve<br><br>(Wayback machine to the wordpost that helped me)<br>http://web.archive.org/web/20100204203840/http://gurumeditations.wordpress.com/articles/calculating-and-drawing-bezier-curves-with-blitzmax/<br><br>You can make how ever many points you want for a more smoother turn<br><br>EDIT:  Just realized this is for 3d though.  I am sure you can work something for it out. <br><br></td></tr></table><br>
<a name="1200492"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >redmoth</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks, I understand more or less what a bezier curve is, but I'm having trouble thinking how to adapt it to my ai cars.<br><br>each checkpoint has an x, and z location and also a rotation.<br><br>would P0 be the current checkpoint and P2 be the next checkpoint, <br>a bit confused over p1, <br>would it be p2-p1 * speed?<br><br>Sorry, maybe it's late for me and my head is playing stupid. <br><br></td></tr></table><br>
<a name="1200527"></a>

<a name="1200528"></a>

<a name="1200529"></a>

<a name="1200530"></a>

<a name="1200531"></a>

<a name="1200565"></a>

<a name="1200566"></a>

<a name="1200567"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I agree that you need a spline for that. <br>The way it is being done now, every car has to pass exactly through each waypoint, and that's unrealistic especially in tighter curves. Two cars side by side would come into contact trying to go through the same waypoint.<br><br>You can use <i>Catmull-Rom</i> splines for this. <br>The good thing about them is that they pass through their control points (so are easy to define), are fast to compute and can be cyclic, so you can define a closed circuit with them - for this you'd need several different splines connected to each other.<br><br>A few resources:<br>- Interview with a F-Zero X hacker and how the tracks for that game are laid out. Has some information and images that may spark ideas: <a href="http://www.pressthebuttons.com/2005/08/some_words_with.html" target="_blank">http://www.pressthebuttons.com/2005/08/some_words_with.html</a><br><br>- Direct3D demo of Catmull-Rom for a vehicle in a highway: <a href="http://www.mvps.org/directx/articles/catmull/" target="_blank">http://www.mvps.org/directx/articles/catmull/</a><br><br>- More on Catmull-Rom: <a href="http://www.booncotter.com/waypoints-catmull-rom-splines/" target="_blank">http://www.booncotter.com/waypoints-catmull-rom-splines/</a><br><br>- Steering behaviors theory (look for the Path Following article): <a href="http://www.red3d.com/cwr/steer/" target="_blank">http://www.red3d.com/cwr/steer/</a><br><br>- Blitz code archives:<br><a href="http://blitzbasic.com/codearcs/codearcs.php?code=1522" target="_blank">http://blitzbasic.com/codearcs/codearcs.php?code=1522</a><br><a href="http://blitzbasic.com/codearcs/codearcs.php?code=1761" target="_blank">http://blitzbasic.com/codearcs/codearcs.php?code=1761</a><br><a href="http://blitzbasic.com/codearcs/codearcs.php?code=3011" target="_blank">http://blitzbasic.com/codearcs/codearcs.php?code=3011</a><br><br>You'll need to find the <b>tangents</b> of the spline at specific points on the curve so you know where the vehicles should point at any time.<br><br>A tangent is the straight line this dot is carrying:<br><br><img src="http://i41.tinypic.com/nlvc5e.gif"><br><br>You can calculate that tangent fast if you have the previous and future locations of the car on the spline. The tangent for (currentPoint) is the vector from (oldPoint) to (futurePoint).<br>Remember that this is calculated as a delta (future - past), so the result is:<br><br>currentPoint.tangentX = futurePoint.positionX - oldPoint.positionX<br>currentPoint.tangentZ = futurePoint.positionZ - oldPoint.positionZ<br><br>Instead of Y it's Z because, as you've said it, viewing from above has you working on the XZ plane. <br>With this tangent you can use AlignToVector, and so each car is aligning to be parallel with the spline instead of trying to pass through the points that define it. You can have several cars distributed over a spot and they'll all remain to their "local" directions.<br>My suggestion is that at the beginning of the race you calculate not only the current point on the spline for each car, but also the future point. This way every frame you're calculating the future point only, and the next frame passing it along for the car as "current point", and the car's previous current point is now the old point with which you can calculate the current tangent direction. <br>Note the cars are never placed on these points on the spline - these points only serve to calculate tangents. The cars can mantain their distance from the spline so they can occupy the track however you want, with formations or lineups etc.<br><br>Another method you'll need is finding the point on the spline that's closer to the car (this is used when you want to start the race and need to find out the closest point on the spline for a given car), but I believe this can be <i>approximated</i> by treating the spline as a polyline: each pair of points defines a line segment, and you just need to get the closest distance of a point to a line segment for this, and normalize this closest point (i.e, divide the length of the section of the segment from the starting point to the closest point discovered, by the length of the entire segment which is from the starting point to the end point) to obtain the spline's 't' argument. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
