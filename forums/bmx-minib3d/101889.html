<!DOCTYPE html><html lang="en" ><head ><title >Collision Weirdness</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Collision Weirdness</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=119" >MiniB3D Module</a>/<a href="#bottom" >Collision Weirdness</a><br><br>
<a name="1212747"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TheTophatDemon</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I can't really wrap my head around this.<br>OK, so I'm trying to make some stereotypical fps game, and I'm trying to implement jumping. Well, I tried to detect whether the player was on the ground or not, so I used Raycasting (LinePick) to detect that. Most people just use EntityCollided, but I always thought that would trigger if the player was against a wall, too, and thus the player would be able to wall-jump.<br>Anyways, when I used LinePick() I got some very weird results. First of all, you can't jump anywhere in the map except for one specified area. Secondly, when you are in said specified area, you can somehow jump in midair. And also, the player is apparently spiderman. If you jump up against a wall and hold w, you won't fall to the ground at all. I have no idea what's going on here.<br><br>Here's the code (Assets included) :<br><br><a href="https://drive.google.com/file/d/0BzyMN5S2kRTHM0tmUm5MS0dBWnc/edit?usp=sharing" target="_blank">https://drive.google.com/file/d/0BzyMN5S2kRTHM0tmUm5MS0dBWnc/edit?usp=sharing</a><br><br>*And yes, I DID search the forums, but I never found anything.* <br><br></td></tr></table><br>
<a name="1212764"></a>

<a name="1212765"></a>

<a name="1212766"></a>

<a name="1212767"></a>

<a name="1212768"></a>

<a name="1212769"></a>

<a name="1212770"></a>

<a name="1212788"></a>

<a name="1212795"></a>

<a name="1212796"></a>

<a name="1212797"></a>

<a name="1213224"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Most people just use EntityCollided, but I always thought that would trigger if the player was against a wall, too, and thus the player would be able to wall-jump. <br></div><br>EntityCollided provides only partial information on a collision. If you want to have sophisticated physical interaction, you need more information than that.<br><br>On each frame (or on each time you call UpdateWorld), an entity may be colliding against one or more entities.<br>Therefore, to have an appropriate reactive behaviour, on each frame you need to cycle through all the collisions that an entity was involved in and retrieve information about them. The amount of collisions for an entity for the current frame is given by <a href="/b3ddocs/command.php?name=CountCollisions&amp;ref=3d_cat" target="_blank">CountCollisions</a>.<br><br>Once you have this amount, you can use a For-Next loop and retrieve the <a href="/b3ddocs/command.php?name=CollisionX&amp;ref=3d_cat" target="_blank">point of contact</a> and the <a href="/b3ddocs/command.php?name=CollisionNX&amp;ref=3d_cat" target="_blank">normal</a> of the surface that the entity collided with for all the collisions for the current frame.<br>How you use this information is up to you, but a suggestion would be to use the <i>normal</i> information for applying (or damping) the forces that should influence your entity:<br>If you are jumping, you have a force moving your entity up (the jump force that it started with) and you have a smaller force moving it down (gravity).<br>- If the normal of one of the collisions points down (that is, its CollisionNY component is less than zero), you know that the entity collided with some sort of ceiling, so you can nullify the jump force as the entity should only fall from that point on (that is, it should only have the gravity influencing it).<br>- If the normal of one of the collisions points up (the CollisionNY value is greater than the steepest slope CollisionNY that you can walk on), you know that the entity collided with some sort of ground or platform, so you can stop applying gravity to it for the time being. Consequently, if the entity is <i>not</i> colliding with any surface pointing up, it should be under the influence of the gravity force.<br><br>Note that all of this can be done with a single "collision hull" for an entity. As of now, you can only set up ellipsoid hulls for "source" entities, and "destination" entities can have an ellipsoid, a box or their own mesh as hulls. <br>An entity with a single hull is as responsive as an entity with many child colliders, since the points and the normals of each contact can be separately retrieved even when a single hull is being used.<br><br>This is a more physics-oriented approach, so you need to <i>study</i> how vectors (vector maths and operations), velocities and accelerations (or forces) work. The final direction that the entity will be translated by is the resultant of all the forces influencing it. <br><br></td></tr></table><br>
<a name="1213300"></a>

<a name="1213322"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Kryzon&gt;&gt;Let's imagine CountCollisions returns 2 or more (which i have never seen yet), how do you decide which collision informations to use ? I always use the informations of the first collision (CollisionEntity(ColliderEmitter,1)) because, to me, this means this is the first collision which has been detected and therefore the collider must react to this collision, not to the others which may have happened after.<br><br>Can you please explain what you do if CountCollisions() returns 2 or more ? And why ? I am curious.<br><br>Thanks, <br><br></td></tr></table><br>
<a name="1213362"></a>

<a name="1213363"></a>

<a name="1213364"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello.<br>I agree that more than 2 simultaneous collisions will be rare. They are a possibility, however.<br>The engine must check a source entity against all the destination entities progressively, so any of the detected collisions for the source entity will be listed in the order that the system detected them. They should be equally important nonetheless, since they were all found in the same call to UpdateWorld: on the same frame, the source entity is colliding against more than one obstacle.<br><br>Consider two destination entities: a level and a moving platform. Each has a distinct collision type.<br>Consider that the player is jumping (moving up and sideways) and that he collided against both the level and the moving platform. But we don't know in what way he collided against these entities.<br><br>We don't know if he has collided with his sides or with his head (considering a single hull for the entire player), but if you retrieve the normals for all the collisions that he was involved in, you can check if one of these collisions was against something pointing down: The player may have collided against the ceiling of the level, or he may have collided against the bottom of the platform. Either way, he has collided against something pointing down, so you know that he hit an obstacle to his upwards movement and so he should fall from that point on, since the only force acting upon him should be the gravity and not the jump force anymore since it was reset.<br>If none of the collision normals indicate that he has collided with a vertical obstacle then there's no need to change anything and he will keep moving up with his jump force.<br><pre class=code>For (all the collisions of the player on the current frame)

	If CollisionNY() &lt; 0.0 Then jumpForce = 0 ;Reset the jump force of the player when he collides against at least one vertical obstacle.
	
	If CollisionNY() &gt; 0.5 Then playerOnGround = True ;Consider the player on the ground if he collided against a point that faces up (so don't move him down with gravity, later).

Next</pre>We should check all the collisions that an entity has participated in on an UpdateWorld call since at least one of these collisions may have the information that we're looking for to change the forces that we're moving or turning the entity with. <br><br></td></tr></table><br>
<a name="1213380"></a>

<a name="1213381"></a>

<a name="1213382"></a>

<a name="1213383"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I agree with what you say but this does not answer my question.<br><br>Let's imagine that a character has one collider "emitter" (entityradius) and there are 4 groups of colliders "receiver" (mesh) : the terrain, the buildings, the crates, the ladders.<br><br>Let's imagine that there is a ladder positionned against the wall of the building and that there is a crate positionned against the wall near the ladder (at left or at right)<br><br>Let's imagine that after you turn/move the character and call updateworld, countcollisions returns 3 (i don't know if this is possible but let's imagine)<br>The collision 1 is with the building wall<br>The collision 2 is with the ladder<br>The collision 3 is with the crate<br><br>In this game, a character can grab and climb on ledges if they are in range (and thus on the ledges of buildings walls and on the ledges of crates) and can grab and climb on ladders.<br><br>In this case, how will you choose what is the "right" collision to consider.<br><br>I understand that the developer has to decide in which order he wants to consider a collision but if this scenario happens, it can be come confusing.<br><br>Fortunately, the way Blitz3d collisions works with the response slide will prevent a collider "emitter" to go through a collider "receiver" so even if i consider only the first collision, there should be no errors.<br><br>Have you done some tests to know if the collisions index CollisionEntity(ColliderEmitter,index) corresponds with the nearest farest collision detected or if it corresponds to the order in which the colliders receiver have been tested and thus can not be trusted ?<br><br>Thanks, <br><br></td></tr></table><br>
<a name="1213433"></a>

<a name="1213434"></a>

<a name="1213435"></a>

<a name="1213436"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> As you can see from the source code, the collisions are listed as they are detected. <br>The order with which collisions are tested is defined when you call the Collisions function:<br><a href="https://github.com/si-design/minib3d/blob/master/inc/TCollision.bmx#L171" target="_blank">https://github.com/si-design/minib3d/blob/master/inc/TCollision.bmx#L171</a><br><br>Regarding the context that you have described, you need to have priorities.<br>Consider that the worst case scenario is when you have collided with all the three objects and that you're in a position and orientation that is favourable for grabbing all the three at the same time: grab the ladder, grab the ledge of the wall or grab the ledge of the crate.<br><br>To prevent the game from trying to do all of these three actions at the same time, you should program that climbing ladders is more important (has a higher priority) than grabbing ledges. <br>If one of the detected collisions is with a ladder and the conditions for grabbing it are positive given your current position and orientation (the point of impact, the normal of the impact etc.), then disregard the other grabbable objects even if the conditions for grabbing them are also positive.<br><br>Without taking the ladder in consideration, having several grabbable ledges close to each other (the crate and the wall) could be considered as a bad practice, as it can lead to erratic behaviour. So we need to address this with clever level design and avoid having ledges of different objects close enough so that the player won't collide with both at the same time.<br>If I'm not mistaken some engines allow you to 'tag' which ledges the player is able to grab, so you have further control over this issue. <br><br></td></tr></table><br>
<a name="1213453"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>To prevent the game from trying to do all of these three actions at the same time, you should program that climbing ladders is more important (has a higher priority) than grabbing ledges. <br>If one of the detected collisions is with a ladder and the conditions for grabbing it are positive given your current position and orientation (the point of impact, the normal of the impact etc.), then disregard the other grabbable objects even if the conditions for grabbing them are also positive.<br> <br></div><br>Yes i understand what you mean.<br>This discussion has been useful to me because now i will consider the others possible collisions which may have happened. Thanks for the explanations<br><br><div class="quote"> <br>Without taking the ladder in consideration, having several grabbable ledges close to each other (the crate and the wall) could be considered as a bad practice, as it can lead to erratic behaviour. So we need to address this with clever level design and avoid having ledges of different objects close enough so that the player won't collide with both at the same time.<br> <br></div><br>Yes i agree. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
