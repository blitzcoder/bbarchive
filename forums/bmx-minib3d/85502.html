<!DOCTYPE html><html lang="en" ><head ><title >EntityOrder - Workaround for FPS Gun Meshes</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >EntityOrder - Workaround for FPS Gun Meshes</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=119" >MiniB3D Module</a>/<a href="#bottom" >EntityOrder - Workaround for FPS Gun Meshes</a><br><br>
<a name="967417"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flemmonk</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> First post ever, g'day guys!<br><br>The Issue: MiniB3D can not render multiple meshes with Z-Buffering in a order specified by a custom value. Even the EntityOrder command for Blitz3D states :- "Setting an entity's order to non-0 also disables z-buffering for the entity"<br><br>The Solution: Adding a value to TMesh and TCamera which links the two together. This means that when the engine renders each camera only TMeshes with the same value as that camera are added to the rendering list and thus rendered.<br><br>If you combine this solution with the TCamera.CameraClsMode function you can easily match your gun meshes to a secondary camera, still have lighting affect your gun AND not have to use CameraRange to cut out the rest of the world.<br><br>Warning: I am not a expert in OpenGL or Programming and this fix may make things slower, or cause alot of experts to be unhappy as it might not be the correct way to do things or make them frown, so sorry and please suggest any better ways.<br><br>Down to the juicy stuff, to apply this fix you will need to modify MiniB3D and in particular these files: TEntity.Bmx and TGlobal.Bmx ( SO BACK THEM UP FIRST!!! )<br><br>We will start with TEntity.Bmx, open it up and at the beginning of your file or at the end, wherever you like we're going to add a "_scene" value.<br><pre class=code>
	Field _scene:Int = 0
</pre><br><br>Next we are going to add a handy little function to set our new value with the ability to recursively set child entities with the same value. I added this at the bottom of my TEntity.Bmx (before the EndType line).<br><pre class=code>
	Method SetScene(scene:Int, children = False)
	
		Self._scene = scene
		
		If children Then
	
			For Local ent_c:TEntity=EachIn Self.child_list
				ent_c.SetScene(scene, True)
			Next
		
		EndIf

	EndMethod
</pre><br><br>Right that is all for TEntity.Bmx, we can save that and move on to TGlobal.Bmx, we're going to modify the "RenderCamera" method, about 1/4 of the way down is the following line:<br><pre class=code>
		For Local mesh:TMesh=EachIn TEntity.entity_list
</pre><br><br>We want to add the following line below it:<br><pre class=code>
			If mesh._scene &lt;&gt; cam._scene Then Continue
</pre><br><br>And people, that is it! Save TGlobal.Bmx and re-build your MiniB3D module (hopefully with success!).<br><br>Now to utilise the code you create 1 camera for your scene, and 1 for your hud, except with the hud camera you would "SetScene 2". Additionally to your gun parent you would "SetScene 2, True"<br><br>Here is a couple of screenshots:<br><br>before fix - <br><a href="http://img72.imageshack.us/img72/9144/ss5.png" target="_blank"><img src="http://img72.imageshack.us/img72/9144/ss5.th.png"></a><br><br>after fix - <br><a href="http://img132.imageshack.us/img132/8978/ss6.png" target="_blank"><img src="http://img132.imageshack.us/img132/8978/ss6.th.png"></a><br><br>Let me know what you think and if it works for you! <br><br></td></tr></table><br>
<a name="967427"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> if you dont want to do this you could make the player's entityradius bigger but then enemies will hit you unfairly and you may not be able to go through doors. <br><br></td></tr></table><br>
<a name="967898"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flemmonk</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> For those who have given a go at modifying MiniB3D and tried the above changes, I have recently made another one which might come in handy for everybody.<br><br>Within TEntity.Bmx I added a new variable:<br><pre class=code>	Field _wireframe = False</pre>This then gets inherited in TMesh and TCamera as they are each based on TEntity Type. What this allows us to have is a per entity Wireframe render and a per Camera Wireframe render.<br><br>We will next modify TGlobal.Bmx and write some if statements that will allow us to render a whole camera in wireframe or per entity based on the camera they're set to.<br><br>Find the following line in TGlobal.Bmx<br><pre class=code>		UpdateSprites(cam,render_list) ' rotate sprites with respect to current cam</pre>And we will add the following:<br><pre class=code>		If cam._wireframe
			glPolygonMode(GL_FRONT,GL_LINE)
		Else
			glPolygonMode(GL_FRONT,GL_FILL)
		EndIf</pre>Further more below that within the 'For EachIn' loop we will add the following lines:<br><pre class=code>			If Not cam._wireframe Then
				If mesh2._wireframe Then
					glPolygonMode(GL_FRONT,GL_LINE)
				Else
					glPolygonMode(GL_FRONT,GL_FILL)
				EndIf	
			EndIf</pre>before the line:<br><pre class=code>			mesh2.Update()</pre>So in the end each TEntity(TCamera, TMesh, etc...) anything that inherits TEntity will have a _wireframe property allowing the mesh/camera to be rendered in Wireframe. <br><br></td></tr></table><br>
<a name="969767"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >puki</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Of course you can just use illusion and bypass EntityOrder issues.  You can scale the mesh small and position it in front of the camera so as to make the mesh look normal size - yet, in fact, it is small and also (being small) doesn't pass through walls, etc. <br><br></td></tr></table><br>
<a name="969843"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flemmonk</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> True, however it will still get affected. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
