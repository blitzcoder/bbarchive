<!DOCTYPE html><html lang="en" ><head ><title >LinePick</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >LinePick</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=119" >MiniB3D Module</a>/<a href="#bottom" >LinePick</a><br><br>
<a name="788935"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >siread</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm doing a linepick from EntityXYZ of one mesh to EntityXYZ of another. They are simply scaled cubes. I set the entitypickmode after scaling. I've tried EntityPickModes 1,2 and 3.<br><br>The first problem I encountered was that the line was picking the "from" entity. So I set its EntityPickMode to 0 before the linepick and reset it after.<br><br>However, with EntityPickModes 1 and 3 the linepick now returns null. When set to 2 i seem to get strange results where it picks the wrong target. <br><br></td></tr></table><br>
<a name="788942"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >siread</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm doing a linepick from A to B (EntityPickMode,2). I've used CameraProject to draw the line.<br><br>I set the color of the Entity returned from LinePick to Green. As you can see the LinePick is returning Entity C. What am I doing wrong?<br><br><img src="http://download.newstargames.com/misc/Linepick.jpg"> <br><br></td></tr></table><br>
<a name="788995"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >siread</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Doh! I was using the absolute co-ords of the second entity, not the offset from the first! Crisis over. :D <br><br></td></tr></table><br>
<a name="789012"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LAB[au]</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is that a football/soccer field? <br><br></td></tr></table><br>
<a name="789041"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >siread</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes. Here's a slightly be view... <br><img src="http://www.newstargames.com/uploaded_images/MatchBlox-720931.jpg"> <br><br></td></tr></table><br>
<a name="795312"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >siread</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Any ideas why EntityPickModes 1 and 3 (Sphere and Box) don't work on my entities? The Polygon mode is fine but terribly slow when using complex meshes.<br><br>I've tried setting EntityRadius and EntityBox but no joy. <br><br></td></tr></table><br>
<a name="795410"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >simonh</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Don't forget to use CreateOctree wish meshes to speed up picking.<br><br>Not sure why 1 + 3 don't work - they work in the CameraPick example. I'll take a look. <br><br></td></tr></table><br>
<a name="795431"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >siread</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm, I tried CreateOctree, but that stopped my linepick working completely. Could max_polys and max_levels affect it? I tried the suggested values "200,5 for large meshes and 0,1 for small meshes". <br><br></td></tr></table><br>
<a name="795799"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >simonh</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here's a LinePick example. Put it in the same folder as the CameraPick example. Seems to suggest everything is working OK (including CreateOctree):<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">Import "../MiniB3D.bmx"

Local width=640,height=480,depth=16,mode=0

Graphics3D width,height,depth,mode

Local cam=CreateCamera()
PositionEntity cam,0,0,-15

Local light=CreateLight()
RotateEntity light,45,0,0

Local marker_a=CreateSphere()
ScaleEntity marker_a,0.2,0.2,0.2
EntityColor marker_a,255,255,0
PositionEntity marker_a,-14,0,0

Local marker_b=CreateSphere()
ScaleEntity marker_b,0.2,0.2,0.2
EntityColor marker_b,255,0,0

Local sphere=CreateSphere()
EntityRadius sphere,1
EntityPickMode sphere,1
PositionEntity sphere,-10,5,0

Local mesh=LoadMesh("media/teapot.b3d")
EntityPickMode mesh,2
ScaleEntity mesh,4,4,4

Local octree=CreateOctree(mesh,0,3)

Local box=CreateCube()
FitMesh box,-2,-1,-1,4,2,2
EntityBox box,-2,-1,-1,4,2,2
EntityPickMode box,3
PositionEntity box,10,-5,0

Local sphere_move_y#=0.1
Local mesh_move_y#=0.1
Local box_move_y#=0.1

;' used by camera code
Local mxs#=0
Local mys#=0
Local move#=0.5
MouseXSpeed() ;' flush
MouseYSpeed() ;' flush

;' used by fps code
Local old_ms=MilliSecs()
Local renders
Local fps

While Not KeyDown(KEY_ESCAPE)		

	If KeyHit(KEY_ENTER) Then DebugStop

	;'' control camera
	
	;' mouse look
	
	If KeyDown(KEY_SPACE)=False
	
		mxs#=mxs#+(MouseXSpeed()/5.0)
		mys#=mys#+(MouseYSpeed()/5.0)
	
		RotateEntity cam,mys#,-mxs#,0
	
		MoveMouse width/2,height/2
	
	EndIf
	
	MouseXSpeed() ;' flush
	MouseYSpeed() ;' flush

	;' move camera forwards/backwards/left/right with cursor keys
	
	If KeyDown(KEY_UP)=True Then MoveEntity cam,0,0,move# ;' move camera forward
	If KeyDown(KEY_DOWN)=True Then MoveEntity cam,0,0,-move# ;' move camera back

	If KeyDown(KEY_LEFT)=True Then MoveEntity cam,-move#,0,0 ;' move camera left
	If KeyDown(KEY_RIGHT)=True Then MoveEntity cam,move#,0,0 ;' move camera right
	
	;''
	
	' move objects up and down
	MoveEntity sphere,0,sphere_move_y#,0
	MoveEntity mesh,0,mesh_move_y#,0
	MoveEntity box,0,box_move_y#,0
	
	' turn mesh
	TurnEntity mesh,0,1,0

	' switch y direction of object if too high/low
	If Abs(EntityY#(sphere))&gt;10 Then sphere_move_y#=-sphere_move_y#
	If Abs(EntityY#(mesh))&gt;10 Then mesh_move_y#=-mesh_move_y#
	If Abs(EntityY#(box))&gt;10 Then box_move_y#=-box_move_y#

	;' if mousehit then perform linepick
	If MouseHit(1)
	
		;' reset entity colors
		EntityColor sphere,255,255,255
		EntityColor mesh,255,255,255
		EntityColor box,255,255,255

		Local pick=LinePick(EntityX(marker_a),EntityY(marker_a),EntityZ(marker_a),100,0,0)
		Local pe=PickedEntity()
		Local ps=PickedSurface()
		
		If pick&lt;&gt;0
			DebugLog "Picked!"
			DebugLog "PickedX(): "+PickedX()
			DebugLog "PickedY(): "+PickedY()
			DebugLog "PickedZ(): "+PickedZ()
			DebugLog "PickedNX(): "+PickedNX()
			DebugLog "PickedNY(): "+PickedNY()
			DebugLog "PickedNZ(): "+PickedNZ()
			DebugLog "PickedTime(): "+PickedTime()
			DebugLog "PickedEntity(): "+pe
			DebugLog "PickedSurface(): "+ps
			DebugLog "PickedTriangle(): "+PickedTriangle()
			EntityColor PickedEntity(),255,255,0
			PositionEntity marker_b,PickedX(),PickedY(),PickedZ()
		Else
			DebugLog "Not Picked"
		EndIf
	
	EndIf

	RenderWorld
	renders=renders+1

	;' calculate fps
	If MilliSecs()-old_ms&gt;=1000
		old_ms=MilliSecs()
		fps=renders
		renders=0
	EndIf
	
	Text 0,0,"FPS: "+fps
	Text 0,20,"Click left mouse button to perform line pick"
	Text 0,40,"LinePick will be performed from yellow marker towards the right"
	Text 0,60,"Object will turn yellow when picked, and a red marker while show pick point"

	Flip

Wend
End</textarea> <br><br></td></tr></table><br>
<a name="795922"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >siread</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Must be something with my code then. Thanks Simon. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
