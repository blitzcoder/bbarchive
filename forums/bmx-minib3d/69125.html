<!DOCTYPE html><html lang="en" ><head ><title >CreateOctree help?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >CreateOctree help?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=119" >MiniB3D Module</a>/<a href="#bottom" >CreateOctree help?</a><br><br>
<a name="772693"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've got a level mesh which I make an octree for which speeds up my collision detection considerably. However I noticed that when the player model is in one area of the level where there are a few angles that arn't strait along the x,y or z axis that my frame rate drops considerably. I have a feeling that tweaking the octree numbers would help a lot if I had any clue as to what they actualy do.<br><br>is max_polys the number of faces that can fit in one octcube? and is max_level how many times those octcubes will be subdivided into individual collision cubes?<br><br>Playing around with random numbers changes very little besides making the game really slow if I put in stupid values...<br><br>Little help? <br><br></td></tr></table><br>
<a name="772749"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >klepto2</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> From the readme.txt provided with miniB3D :<br><br><div class="quote"> <br>Octree Notes<br>------------<br><br>* MiniB3D uses octrees to speed-up ellipsoid-to-mesh collisions.<br>* Octrees are not created automatically for meshes. They must be created manually using CreateOctree(mesh:TMesh,max_polys,max_levels).<br>* 'max_polys' denotes the maximum no. of polygons per octcube, and 'max_level' denotes the maximum no. of octcube 'levels', or sub-divisions.<br>* If both are set to greater than 0, then whatever is reached first will be used as the exit condition.<br>* If 'max_polys' is set to 0, then the octree will be sub-divided 'max_levels' times.<br>* If 'max_levels' is set to 0, then the octree will be sub-divided until the no. of polys per octcube is less than 'max_polys'.<br>* Experiment with both values for best results. A couple of suggested values are 200,5 for large meshes and 0,1 for small meshes.<br> <br></div> <br><br></td></tr></table><br>
<a name="772759"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yea, I've read that many times, but it doesn't make sense to me. primarily because it says "... polygons per octcube" and I don't know what it means by pollys... is that faces? or spacial units? or what? <br><br>if I have say a rectangular cube shape, that is 60 units along the Z axis and 5 units along the x and Y, what's a reasonable setting for something like that... if it were on an angle (not rotated, but created as a mesh that was already rotated) would that make a difference? i.e. would it need more subdivisions to get better accuracy since it wouldn't be straight along an axis...<br><br>I'm sure I'm missing something obvious. Is there a tutorial on how to properly use octrees somewhere? <br><br></td></tr></table><br>
<a name="772800"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >klepto2</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> 1. Polys are faces,yes.<br>2. As far as I know it make no difference if a mesh is rotated before or after creation time. <br>3 The usage of the Octree depends of the size of your mesh. eg a mesh which is small will need less subdivision (very small: 0,1) a very large mesh needs a lot more subdivison (eg: 200,5)<br>. these values are just examples. to get values of your needs the only way is to test different values. try things like 20,3 or 100,4 etc. there are no limits, but keep in mind the calculation time raises exponential to the subdivisions. <br><br></td></tr></table><br>
<a name="772903"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the help! if I can get a handle on this I think I'll write up a doc or atleast post some instructions.<br><br>So if I understand this so far, the max_polys value is how many cubes will be used per face (or in simpler terms, how many pieces each side of each thing you can hit will be seperated into) and then max_levels is how many pieces each one of those sub-face slices are further seperated into... I think...<br><br>So if I'm right about that 1 max_poly and 1 max_level will make 1 octcube per face...<br><br>10 max_polys and 1 max_level would make 1 octcube with a maximum of 10 faces inside it.<br><br>10 max_polys and 100 max_levels would make an octcube with a maximum of 10 faces in it and then subdivide that octcube 100 times for greater acuracy in the collision... (which would be crazy slow in most instances since that's 1000 collisions tests per 10 or less faces...)<br><br>so to simplify it down to a speed vs. acuracy thing. more max_polys means faster and potentialy less acurate. more max_levels means much more accurate but exponentialy slower. Especialy since it's MAX pollys, so setting it to 200 is going to grab 1-200 faces depending on geometry in a given area, but each one of those generated octcubes will be split by max_levels, so if an area has complicated geometry and generates 1 octcube per face, and then subdivides each one by 5, then it could really slow things down.<br><br>So really it comes down to how complicated is geometry in a given area, and how big an object are you testing with the collision. If you have a bigger object it might be overlaping 2 or 3 or 10 areas with many single faces that are divided many many times causing a lot of slow down. but if it's a small object and it's testing say 2 or more faces and those are only subdivided once or twice then theres a lot less testing to do.<br><br>are octcubes always perfect cubes or can they be stretched? I'm guessing I'll find out if I test some more. Also by pre rotated I mean if you make in a modeling program a mesh of a cube and turn it 45 degrees and make an octtree for it, would you need more octcubes because the octcubes would be 45 degrees off of the sides of the mesh, or will the octcubes always be along the same orientation as the faces they're attached to...<br><br>I have a fealing the angle thing is a factor simply because the areas where I have slow down as a result of my bad octree values in my level are areas where there are faces that are not straight along the x, y or z axis. It could also be because there are a few more faces in those areas though but I think I can trial and error it out now. <br><br></td></tr></table><br>
<a name="772910"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Clearly I'm not understanding  something... I just changed my values from 200, 5 to 100, 1000. with the new settings areas that were getting 50-60 fps (open areas like the middle of the room) are now getting 60-65 and areas that were getting 25-45 (tight areas and places with lots of angles) are getting 75-90... <br><br>I love the FPS increase but I'll be buggered if I can figure out why it's doing what it's doing... maybe it is just play with the numbers till you get values that work... or maybe my defenition of a "large mesh" is way off...<br><br>by large mesh does it mean something with say tens of thousands of faces? or does it mean something that is large on a unit scale, like the mesh size is 1000x 1000y 1000z? <br><br></td></tr></table><br>
<a name="773638"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Welp, I still don't really get it, but playing around with lots of random numbers got my frame rate up. However if I put an octree on more than one thing (i.e. my level mesh and say a landing pad) certain spots on the level drop to 3 fps... no idea why but I'm guessing that making a second ocrtee somehow combines values of both trees... I really only need it on my level mesh though so not a problem for me... <br><br></td></tr></table><br>
<a name="773678"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >simonh</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> The current octree.bmx splits polygons in half if they're on a dividing plan which sometimes leads to more polys than is desirable (especially in small tight areas with many polys). I've since changed this so polys are no longer split and it's generally a lot faster - will be in the next version. <br><br></td></tr></table><br>
<a name="774487"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> aaaaah that would totaly explain a lot of the things I was encountering. Any kind of estimate (weeks/months/etc.) till we might get a new version? <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
