<!DOCTYPE html><html lang="en" ><head ><title >OpenB3D - CameraProject for entity behind camera</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >OpenB3D - CameraProject for entity behind camera</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=119" >MiniB3D Module</a>/<a href="#bottom" >OpenB3D - CameraProject for entity behind camera</a><br><br>
<a name="1330089"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >icebeararmy</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey :)<br><br>Is it possible to get real values with CameraProject() for an entity, that's behind the camera? It looks like it just flips the z-axis. But I actually need the screenposition of an entity that's behind the camera for something that comes from behind the camera. I'm trying to implement light-scattering with this shader: <a href="https://github.com/Erkaman/glsl-godrays" target="_blank">https://github.com/Erkaman/glsl-godrays</a><br>The shader needs the position of the lightsource, and I set the value like this:<br><pre class=code>CameraProject camera,EntityX(light,1),EntityY(light,1),EntityZ(light,1)
SetFloat2 (lightshader,"uScreenSpaceSunPos",ProjectedX()/x_resolution,1.0-ProjectedY()/y_resolution)</pre><br>It works good as long as my camera points to the light, but as soon as the camera turns around, the light-rays are coming from the wrong side. This image shows the problem:<br><img src="http://fs5.directupload.net/images/161220/qixaq9fb.png"><br>I need the ProjectedX and ProjectedY to have negative values I guess, but how? <br><br></td></tr></table><br>
<a name="1330092"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> OpenB3D uses gluProject, for that. The argument is discussed in details here:<br><br>https://groups.google.com/forum/#!topic/comp.graphics.api.opengl/9ZVBUbV8vnI <br><br></td></tr></table><br>
<a name="1330107"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >icebeararmy</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm, I guess I just disable the shader as soon as the light isn't in viewspace anymore. Thanks anyway :) <br><br></td></tr></table><br>
<a name="1330178"></a>

<a name="1330180"></a>

<a name="1330189"></a>

<a name="1330190"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you transform the location of the light to the camera local space, the new light Z should tell if the light is in front or behind the camera (or the near plane, if you subtract the near plane distance). Like, negative or positive. You can use TFormPoint for this. <br>Is this what you mean?<br><br>Edit: unless that's exactly what's already happening.<br>Can't you flip the X coordinate when the light is behind? This should give the correct position.<br>Depending on how the math in gluProject works for objects behind the camera you might need instead to mirror the X and Y coordinates based on the centre of the screen (i.e top-left corner becomes bottom-right and so on). <br><br></td></tr></table><br>
<a name="1330194"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >icebeararmy</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Flipping like this?<br><pre class=code>1.0-(ProjectedX()/x_resolution)</pre><br>That doesn't work sadly. <br><br></td></tr></table><br>
<a name="1330252"></a>

<a name="1330254"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> In the demo the rays disappear when you face away from the sun because the effect is caused by the blurring of the bright spot in the pixel shader -- if the bright spot isn't on the screen (like when you're facing away from it), nothing is blurred and there are no rays.<br>So your idea of disabling the effect (or fading it out) when the light is behind the camera should make it behave the same.<br><br>I guess in reality you could still see some rays if there's dust or fog in the place you're in, even if you're facing away from the light source, but I'm not sure how to reproduce that. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
