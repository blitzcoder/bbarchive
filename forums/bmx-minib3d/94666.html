<!DOCTYPE html><html lang="en" ><head ><title >B3D models crashing MiniB3D</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >B3D models crashing MiniB3D</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=119" >MiniB3D Module</a>/<a href="#bottom" >B3D models crashing MiniB3D</a><br><br>
<a name="1086799"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jtfrench</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>I'm encountering an odd crash when loading certain .b3d models into my MiniB3D-based game. The models themselves appear to render fine, but after being loaded in the 3D scene for a few seconds they eventually cause the program to crash. This sometimes happens after trying to "orbit" the scene using mouse picking, but also occurs when just leaving the model loaded into the scene.<br><br>The model export path we're currently using is taking models in .x format, opening them in Fragmotion and exporting to B3D.<br><br>Below is an example of a stack trace we would get when the error occurred while orbiting the scene:<br><br><pre class=code>
Exception Type:  EXC_BAD_ACCESS (SIGSEGV)
Exception Codes: KERN_INVALID_ADDRESS at 0x0000000020f1bdbc
Crashed Thread:  0  Dispatch queue: com.apple.main-thread

Thread 0 Crashed:  Dispatch queue: com.apple.main-thread
0   com.toscaledesign.wip         	0x00065f8f MeshCollider::collide(Box const&amp;, Line const&amp;, float, Transform const&amp;, Collision*, MeshCollider::Node*) + 255
1   com.toscaledesign.wip         	0x000660d1 MeshCollider::collide(Box const&amp;, Line const&amp;, float, Transform const&amp;, Collision*, MeshCollider::Node*) + 577
2   com.toscaledesign.wip         	0x000660d1 MeshCollider::collide(Box const&amp;, Line const&amp;, float, Transform const&amp;, Collision*, MeshCollider::Node*) + 577
3   com.toscaledesign.wip         	0x00066118 MeshCollider::collide(Box const&amp;, Line const&amp;, float, Transform const&amp;, Collision*, MeshCollider::Node*) + 648
4   com.toscaledesign.wip         	0x00066118 MeshCollider::collide(Box const&amp;, Line const&amp;, float, Transform const&amp;, Collision*, MeshCollider::Node*) + 648
5   com.toscaledesign.wip         	0x00066118 MeshCollider::collide(Box const&amp;, Line const&amp;, float, Transform const&amp;, Collision*, MeshCollider::Node*) + 648
6   com.toscaledesign.wip         	0x00066118 MeshCollider::collide(Box const&amp;, Line const&amp;, float, Transform const&amp;, Collision*, MeshCollider::Node*) + 648
7   com.toscaledesign.wip         	0x00066118 MeshCollider::collide(Box const&amp;, Line const&amp;, float, Transform const&amp;, Collision*, MeshCollider::Node*) + 648
8   com.toscaledesign.wip         	0x000660d1 MeshCollider::collide(Box const&amp;, Line const&amp;, float, Transform const&amp;, Collision*, MeshCollider::Node*) + 577
9   com.toscaledesign.wip         	0x000660d1 MeshCollider::collide(Box const&amp;, Line const&amp;, float, Transform const&amp;, Collision*, MeshCollider::Node*) + 577
10  com.toscaledesign.wip         	0x000672a0 MeshCollider::collide(Line const&amp;, float, Transform const&amp;, Collision*) + 1472
11  com.toscaledesign.wip         	0x0006b4d8 hitTest(Line const&amp;, float, Transform const&amp;, MeshCollider*, int, Collision*, CollisionInfo&amp;) + 1816
12  com.toscaledesign.wip         	0x0006b53d C_Pick + 77
13  com.toscaledesign.wip         	0x0005c992 6947 + 59
14  com.toscaledesign.wip         	0x0005bfab _sidesign_minib3d_TPick_CameraPick + 288
15  com.toscaledesign.wip         	0x000636a6 sidesign_minib3d_CameraPick + 32
16  com.toscaledesign.wip         	0x000131f8 3034 + 108
17  com.toscaledesign.wip         	0x00005aec 1514 + 10
18  com.toscaledesign.wip         	0x00003d68 74 + 73
19  com.toscaledesign.wip         	0x00003430 135 + 76
20  com.toscaledesign.wip         	0x00002d4a 4 + 20
21  com.toscaledesign.wip         	0x00002e7e run + 78
22  com.apple.Foundation          	0x94e0a4df _nsnote_callback + 176
23  com.apple.CoreFoundation      	0x99629793 __CFXNotificationPost + 947
24  com.apple.CoreFoundation      	0x9962919a _CFXNotificationPostNotification + 186
25  com.apple.Foundation          	0x94dff384 -[NSNotificationCenter postNotificationName:object:userInfo:] + 128
26  com.apple.Foundation          	0x94e0c789 -[NSNotificationCenter postNotificationName:object:] + 56
27  com.apple.AppKit              	0x907f7422 -[NSApplication _postDidFinishNotification] + 125
28  com.apple.AppKit              	0x907f7332 -[NSApplication _sendFinishLaunchingNotification] + 74
29  com.apple.AppKit              	0x9094e4ed -[NSApplication(NSAppleEventHandling) _handleAEOpen:] + 274
30  com.apple.AppKit              	0x9094e10d -[NSApplication(NSAppleEventHandling) _handleCoreEvent:withReplyEvent:] + 101
31  com.apple.Foundation          	0x94e3f7a4 -[NSAppleEventManager dispatchRawAppleEvent:withRawReply:handlerRefCon:] + 511
32  com.apple.Foundation          	0x94e3f568 _NSAppleEventManagerGenericHandler + 228
33  com.apple.AE                  	0x9244cf58 aeDispatchAppleEvent(AEDesc const*, AEDesc*, unsigned long, unsigned char*) + 166
34  com.apple.AE                  	0x9244ce57 dispatchEventAndSendReply(AEDesc const*, AEDesc*) + 43
35  com.apple.AE                  	0x9244cd61 aeProcessAppleEvent + 197
36  com.apple.HIToolbox           	0x95d40389 AEProcessAppleEvent + 50
37  com.apple.AppKit              	0x907c79ca _DPSNextEvent + 1420
38  com.apple.AppKit              	0x907c6fce -[NSApplication nextEventMatchingMask:untilDate:inMode:dequeue:] + 156
39  com.apple.AppKit              	0x90789247 -[NSApplication run] + 821
40  com.toscaledesign.wip         	0x000033a7 main + 999
41  com.toscaledesign.wip         	0x00002b7d _start + 208
42  com.toscaledesign.wip         	0x00002aac start + 40
</pre><br><br>Any ideas?<br><br>Thanks,<br>Jason <br><br></td></tr></table><br>
<a name="1086813"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AdamRedwoods</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Not sure. The stack looks like it's running through the collision tree.<br>Check TCollision.bmx to make sure you're passing valid data to the functions. <br><br></td></tr></table><br>
<a name="1086839"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Warner</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I noticed in TPick.bmx, there is something peculiar. It looks as if there is a bunch of vector objects created each time the function is called. However, I cannot find a place where they are released/freed.<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
	' requires two absolute positional values
	Function Pick:TEntity(ax:Float,ay:Float,az:Float,bx:Float,by:Float,bz:Float,radius:Float=0.0)

		Global c_vec_a:Byte Ptr=C_CreateVecObject(0.0,0.0,0.0)
		Global c_vec_b:Byte Ptr=C_CreateVecObject(0.0,0.0,0.0)
		Global c_vec_radius:Byte Ptr=C_CreateVecObject(0.0,0.0,0.0)
		Global c_col_info:Byte Ptr=C_CreateCollisionInfoObject(c_vec_a,c_vec_b,c_vec_radius)

		Global c_line:Byte Ptr=C_CreateLineObject(0.0,0.0,0.0,0.0,0.0,0.0)

		Global c_vec_i:Byte Ptr=C_CreateVecObject(0.0,0.0,0.0)
		Global c_vec_j:Byte Ptr=C_CreateVecObject(0.0,0.0,0.0)
		Global c_vec_k:Byte Ptr=C_CreateVecObject(0.0,0.0,0.0)

		Global c_mat:Byte Ptr=C_CreateMatrixObject(c_vec_i,c_vec_j,c_vec_k)		
		Global c_vec_v:Byte Ptr=C_CreateVecObject(0.0,0.0,0.0)
		Global c_tform:Byte Ptr=C_CreateTFormObject(c_mat,c_vec_v)
</textarea><br>Maybe it is causing a memory leak? <br><br></td></tr></table><br>
<a name="1087544"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jtfrench</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Interesting idea. If this were the case though, wouldn't everyone's minib3d apps start crashing after running long enough?<br><br>@AdamRedwoods:<br>Are you suggesting that bad data is being passed to the collision functions, causing the program to abort? <br><br></td></tr></table><br>
<a name="1087593"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Warner</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think you could best first try to force the bug to appear in a separate example. Try loading the asserting model, placing it in view, then using CameraPick or LinePick in a For..Next loop very often. It is much easier to trace the bug if you could somehow isolate it in a small testing program.<br>Then, exclude a few lines in TPick.bmx or TCollision.bmx that you think are responsible for this. If that helps, restore some of the lines you removed. Using that method, you should be able to isolate what part of the program is causing the error. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
