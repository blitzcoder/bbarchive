<!DOCTYPE html><html lang="en" ><head ><title >Openb3d wrapper (Part 3)</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Openb3d wrapper (Part 3)</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=119" >MiniB3D Module</a>/<a href="#bottom" >Openb3d wrapper (Part 3)</a><br><br>
<a name="1277775"></a>

<a name="1277777"></a>

<a name="1278026"></a>

<a name="1278029"></a>

<a name="1285943"></a>

<a name="1302234"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Since the <a href="/posts.php?topic=103682" target="_blank">2nd thread</a> has exceeded 250 posts I have started a new thread. So please post new issues here. Thanks.<br><br>Download: You can download the latest version of the wrapper with examples and my small fixes to the C++ source <a href="https://github.com/markcwm/openb3d.mod" target="_blank">HERE</a>. Now available courtesy of GitHub.<br>You can find the official Openb3d libraries and source <a href="http://sourceforge.net/projects/minib3d/files/" target="_blank">HERE</a>.<br><br>To install MinGW follow <a href="/posts.php?topic=105834" target="_blank">this guide</a>.<br><br>The original thread about Openb3d is <a href="/posts.php?topic=92800" target="_blank">here</a> and the Freebasic thread is <a href="http://www.freebasic.net/forum/viewtopic.php?t=15409" target="_blank">here</a>.<br>Other Openb3d wrapper threads: <a href="/posts.php?topic=102556" target="_blank">1st</a>, <a href="/posts.php?topic=103682" target="_blank">2nd</a>.<br><br>New for version 1.1:<br><div class="quote"> Added:<br>-3d actions: ActMoveBy, ActTurnBy, ActMoveTo, ActTurnTo, and many more<br>-Physics features: CreateConstraints and CreateRigidBody; with the last one, it's possible to define position, scale and rotation of an entity by linking it to four other entities (usually pivots): if that entities are controlled by constraints, the main entity can be controlled in a physically realistic way<br>-Particle system: emitters can be made with CreateEmitter (even an "emitter of emitters" is possible)<br>-if a light is created with a negative light type, it won't cast shadows<br>-DepthBufferToTex: with no args it uses the back buffer, otherwise it can render the depth buffer from a camera (like in CameraToTex)<br><br>Fixed:<br>-Collisions crashed when an entity made with CopyEntity was erased, it doesn't crash any more<br>-Dynamic collisions didn't work for scaled entities, or child entities; now they work<br>-HideEntity now works on lights<br>-Finally, it's possible to load textures from different directories; path info in texture name is now used: if the file cannot be found, a warning is emitted and the file is searched in current directory (or in the directory where the 3d model using that texture is located).<br>-CreateGeosphere now build a model with correct texture mapping<br>-When updating a child entity, only its matrix is recalculated, not the entire tree (should be slightly faster)<br>-PaintEntity and TextureFilter now should work<br>-fixed a bug in static shadows  <br></div> <br><br></td></tr></table><br>
<a name="1277787"></a>

<a name="1277790"></a>

<a name="1277792"></a>

<a name="1277793"></a>

<a name="1277794"></a>

<a name="1277795"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> My god, there's no end to this thread heh.<br>You and angros should just open up your own forum.<br><br>But I've noticed a weird thing with CreateTerrain().<br>It always seems to create really weird corners.<br>I tried looping through the terrain and use ModifyTerrain to set the same height everywhere, but it doesn't seem to set the corner height.<br><br><img src="http://puu.sh/kriEK/2ea81f7093.jpg"> <br><br></td></tr></table><br>
<a name="1277814"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, it's a small bug...<br>It's because the terrain is recursively divided, and the height of each vertex is evaluated only once at each subdivision: since four corners are never divided (even at the lowest LOD they are the same), theis height is never set during rendering.<br><br>To fix it, you should assign a height inside the function RecreateROAM: something like:<br><br>		v[0][1] = height[(int)(v[0][0]*size+ v[0][2])] * vsize<br><br>For v[1], v[2] and v[3] too <br><br></td></tr></table><br>
<a name="1277839"></a>

<a name="1277840"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> That fix for RecreateROAM worked, so thanks Angros, but I'm having a problem with the Windows builds (some kind of MAV with every example) so just don't update until I get that fixed. <br><br></td></tr></table><br>
<a name="1277843"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> The "official" fix for RecreateROAM should be that:<br><br><pre class=code>
	v[0][0] = 0.0; 		v[0][2] = size;
	v[0][1] = height[(int)size] * vsize;

	v[1][0] = size; 	v[1][2] = size;
	v[1][1] = height[(int)(size*(size+1))] * vsize;

	v[2][0] = size; 	v[2][2] = 0;
	v[2][1] = height[(int)(size*size)] * vsize;

	v[3][0] = 0.0; 		v[3][2] = 0;
	v[3][1] = height[0] * vsize;
</pre><br><br>(if, for example, I know that v[0][0] is 0, there is no point in using it in the expression)<br><br>Meanwhile, I am experimenting a little with Python... I just managed to get, under Ubuntu, a window showing a cube rendered with OpenB3D. Maybe having Blitz3d-like commands in Python could be a nice feature... <br><br></td></tr></table><br>
<a name="1277844"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is the terrain not affected by lights?<br><br><img src="http://puu.sh/ksqJJ/9ce582e8df.jpg"> <br><br></td></tr></table><br>
<a name="1277915"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Lights hould affect terrains, unless you disabled that with EntityFX.<br><br>But the upper light, in your picture, seems to affect the terrain... and the lower light seems not to affect even crates. <br><br></td></tr></table><br>
<a name="1277920"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> The top light doesn't affect the terrain, the 2D flare is only rendered above it.<br>The bottom light doesn't have a very long range, but it does light up the ground and box in the background (same mesh)<br>So it should affect the terrain too.<br>Even it I move the light around it never affects the terrain.<br>No FX has been used with the terrain, only EntityTexture and ModifyTerrain.<br><br>I'll explore a bit, see if I can figure out what's causing it to not light correctly. <br><br></td></tr></table><br>
<a name="1277955"></a>

<a name="1277956"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> If someone could just test the latest version of the repo for me on Windows Vista/6 or higher then that would be great. I suspect I may have a slightly broken install of MinGW but I'm not sure. Just build it and run any example/s (to see if it crashes straight away). Thanks. <br><br></td></tr></table><br>
<a name="1277965"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >feeble1</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> With the exception of the usual load3ds and loadx issues, everything runs great on my box:<br>Windows 7. <br><br></td></tr></table><br>
<a name="1277967"></a>

<a name="1277974"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks feeble! Then it is probably my MinGW libs.<br><br>Edit: well when I reverted to MinGW 4.6.1 it worked! I remember I didn't edit the bat file to copy the lib files over to bmx/lib but when I tried upgrading to 4.8.1 tdm properly it now produces an 'undefined reference to pthread_blah' error. So I copied all libs in gcc/lib and gcc/lib/mingw/4.8.1 and deleted all dll.a files but it still gives the same error so I'm just going to revert to 4.6.1 again. <br><br></td></tr></table><br>
<a name="1277995"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RustyKristi</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi munch, so this won't work on MinGW 4.8.1? I'm trying some examples right now and it does nothing but compiles ok. <br><br></td></tr></table><br>
<a name="1277996"></a>

<a name="1277997"></a>

<a name="1278024"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah, afaik. There's probably a way to get it working but for now I'm leaving it. I haven't tried 4.7 but it should work. Edit: yes 4.7.1 works fine. <br><br></td></tr></table><br>
<a name="1278050"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RustyKristi</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok thanks. <br><br></td></tr></table><br>
<a name="1278054"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> No worries. <br><br></td></tr></table><br>
<a name="1278056"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RustyKristi</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey munch,<br><br>I tried with 4.7.1 as per instructions here: <br><a href="http://www.blitzmax.com/Community/posts.php?topic=95220" target="_blank">http://www.blitzmax.com/Community/posts.php?topic=95220</a><br><br>copied 2 bin files and manually copied the whole mingw lib directory to blitzmax/lib. The batch file fails btw on the copying libs part<br><br>Same thing, compiles ok but does not run. MiniB3D works fine though. <br><br></td></tr></table><br>
<a name="1278256"></a>

<a name="1278257"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> The bat file shouldn't fail. You need to edit the three paths at the top (dirMinGW, minGWVersionString, dirBlitzmax) AND the path to the 2nd lib folder the line with "..\lib\gcc\mingw32\..". If you manually copy all libs you will need to delete any files ending in "dll.a".<br><br>Did you rebuild all modules? If you have a lot of mods you can just do a makemods in cmd starting with brl.mod, then pub, then maxgui then openb3d. <br><br></td></tr></table><br>
<a name="1278266"></a>

<a name="1278267"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RustyKristi</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks munch, still weird the bat file does not work and I missed that dll.a delete part but it works now! :) <br><br></td></tr></table><br>
<a name="1278289"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RustyKristi</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Btw, is there support that I can use this with Brucey's BMXNG? Do I just copy the lib folder because as I see it there's MinGW (4.8.1) included in the release already. <br><br></td></tr></table><br>
<a name="1278294"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> No, this hasn't been tested to see if it works with Bmx-NG, my priority is Win/Mac/Linux. There is a separate module b3d.mod that Brucey maintains for Bmx-NG. <br><br></td></tr></table><br>
<a name="1278312"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RustyKristi</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok thank you for that info <br><br></td></tr></table><br>
<a name="1278417"></a>

<a name="1278418"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well I should have said I intend to make sure it is working with Bmx-NG when I get the time, for the 64bit. <br><br></td></tr></table><br>
<a name="1278476"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RustyKristi</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> got it, thanks. I was also wondering about how postprocessing shaders work in openb3d. I can only see material shaders on the examples. <br><br></td></tr></table><br>
<a name="1278525"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> There aren't any yet, but I plan on adding those too. <br><br></td></tr></table><br>
<a name="1278626"></a>

<a name="1278627"></a>

<a name="1278629"></a>

<a name="1278630"></a>

<a name="1278661"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is there any way to get all the entities created?<br>Like a global list containing all entities. <br><br></td></tr></table><br>
<a name="1278662"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes it's the global entity_list in TEntity, currently you have to use CopyList(TEntity.entity_list) before you do an EachIn loop to update the list but I'm plainning to internalize CopyList so it won't be needed then. <br><br></td></tr></table><br>
<a name="1278815"></a>

<a name="1278816"></a>

<a name="1278817"></a>

<a name="1278819"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> Alright, thanks!<br>But wouldn't it be really slow to copy the list?<br>I want to hide everything before each RenderWorld, so that means I'd have to do CopyList each frame.<br><br>And I have a question about BackBufferToTex.<br>I'm using it to draw my textures with BeginMax2D.<br>But since I'm clearing the screen with black before drawing my texture, I can't get alpha to work.<br>Is there any way to clear the screen without covering it with a color?<br><br>UPDATE: Nevermind, I used glClearColor(0, 0, 0, 0) to clear with 0 alpha. <br><br></td></tr></table><br>
<a name="1278830"></a>

<a name="1278831"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's up to you where you use CopyList, in this case if you free or create an entity you need to call CopyList then, but if it's code that isn't being called every frame you can just drop it before any EachIn loops. <br><br></td></tr></table><br>
<a name="1278882"></a>

<a name="1278883"></a>

<a name="1278884"></a>

<a name="1278885"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> I wanted to hide every entity before each frame, as I do multiple renders to get alpha and other effects working and don't want to manually hide everything.<br><br>Also, does OpenB3D not handle OBJ files?<br>For some reason I thought it did...<br><br>And a question about shadows.<br>Is it possible to disable self shadows?<br>So that meshes doesn't cast shadows on themselves, it looks very weird in some situations. <br><br></td></tr></table><br>
<a name="1278904"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> OpenB3D does not handle .OBJ files directly, you need to use some external libraries like AssImp, or use some of the existing code for BlitzMax or Blitz3D, or convert your model to another format.<br><br>The issue has already been discussed one year ago:<br><br><a href="http://www.blitzbasic.com/Community/post.php?topic=102556&amp;post=1236018" target="_blank">http://www.blitzbasic.com/Community/post.php?topic=102556&amp;post=1236018</a><br><br>About shadows: there is no command to disable self-shadowing... but remember that in the real world an object acutally casts a shadow on itself. <br><br></td></tr></table><br>
<a name="1278910"></a>

<a name="1278911"></a>

<a name="1278912"></a>

<a name="1278913"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the OBJ information!<br><br>And yeah shadows may work like that in the real world, but the shadows in the engine are far from real world shadows heh.<br>My trashcan and street lamp for example are very tall, and when the sun shines from above, the long edges start to flicker black because of the shadow they cast on themselves.<br>I guess the trick/solution would be to make them a bit thinner or thicker at the bottom.<br><br>Anyways, is there a way to get the Bumpmap shaders to support transparent parts? <br><br></td></tr></table><br>
<a name="1279031"></a>

<a name="1279034"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Cocopino</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#32">[#32]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi, I am getting really strange and inconsistent results using LoadAnimSeq. <br>I am using a human.b3d file that contains a rigged mesh and several anim.b3d files that contain the animations.<br><br>A small program that outlines the problem(s)<br><br><pre class=code>
SuperStrict

Import angros.b3dglgraphics

Graphics3D 1600, 900
Local cam:TCamera = CreateCamera()

Local sequence:Int = 1

Local human:TMesh = LoadAnimMesh("media\\meshes\\human.b3d")
Local human2:TEntity = LoadAnimMesh("media\\meshes\\human.b3d")

Local head:TEntity = human.FindChild("Head")
Local head2:TEntity = human2.FindChild("Head")

PositionEntity cam, 0, 180, -500
PointEntity cam, human

Local light:TLight = createlight(2)
light.PositionEntity(500, 1000, -100)
PointEntity(light, human)

human.MoveEntity(-70, 0, 0)
human2.MoveEntity(70, 0, 0)

AmbientLight(200, 200, 200)

Local anim:Int[10]
anim[1] = human.LoadAnimSeq("media\\anims\\human_anim_1.b3d")
anim[2] = human.LoadAnimSeq("media\\anims\\human_anim_2.b3d")
anim[3] = human.LoadAnimSeq("media\\anims\\human_anim_3.b3d")

Local anim2:Int[10]
anim2[1] = human2.LoadAnimSeq("media\\anims\\human_anim_1.b3d")
anim2[2] = human2.LoadAnimSeq("media\\anims\\human_anim_2.b3d")
anim2[3] = human2.LoadAnimSeq("media\\anims\\human_anim_3.b3d")

While Not KeyDown(KEY_ESCAPE)

	If KeyHit(KEY_1) sequence = 1
	If KeyHit(KEY_2) sequence = 2
	If KeyHit(KEY_3) sequence = 3

	If Not Animating(human)
		Animate(human, 3, 1, anim[sequence])
		Animate(human2, 3, 1, anim2[sequence])
	EndIf

	UpdateWorld()
	RenderWorld()

	BeginMax2D
	DrawText(EntityVisible(cam, human), 5, 5)
	DrawText(EntityX(head, True) + "," + EntityY(head, True) + "," + EntityZ(head, True), 5, 20)

	DrawText(EntityVisible(cam, human2), 5, 45)
	DrawText(EntityX(head2, True) + "," + EntityY(head2, True) + "," + EntityZ(head2, True), 5, 60)
	EndMax2D
	
	Flip(1)

Wend
</pre><br><br>Running it several times in a row yields completely different results:<br><br>- Sometimes, all is well from the start.<br>- Sometimes, human (using TMesh) is visible but human2 is not.<br>- Sometimes, human2 is visible but human is not. The animation of human2 will now sometimes be slowed down severely.<br>- Sometimes the program crashes completely on UpdateWorld_( anim_speed ), line 205 in TGlobal.bmx<br><br>When a mesh is not visible, the global position of the head child is all over the place. I've seen extremely large numbers like +e35, or extremely small ones. Sometimes it says #QNAN which I assume is "Not A Number".<br><br>I've deinstalled the minib3d module so cannot test that now but when using these same animations in Blitz3D all is fine...<br>Any ideas?<br>Thanks! <br><br></td></tr></table><br>
<a name="1279047"></a>

<a name="1279048"></a>

<a name="1279050"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#33">[#33]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here's another problem for you guys!<br><br>If you create a shadow from a mesh and compare that mesh against a camera picks PickEntity(), it doesn't work!<br><br>I've made an example of it <a href="https://dl.dropboxusercontent.com/u/2842751/shadow_pick.zip" target="_blank">here</a> <br><br></td></tr></table><br>
<a name="1279049"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#34">[#34]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Anyways, is there a way to get the Bumpmap shaders to support transparent parts?  <br></div><br><br>Yes, assuming you're using bumpmap2 and a png with alpha channel then add these lines to the frag shader:<br><pre class=code>uniform sampler2D alphaMap;
...
vec4 alpha_color = texture2D(alphaMap, vec2(texCoords));
gl_FragColor = vec4(totalLighting, alpha_color.a);</pre><br>Then add to the bumpmap example:<br><pre class=code>ShaderTexture(shader2,LoadTexture("media/alpha_map.png"),"alphaMap",2)
...
EntityFX(wall1,32) ; EntityFX(wall2,32) ' etc </pre> <br><br></td></tr></table><br>
<a name="1279261"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#35">[#35]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Hezkore: I tried the same experiment in FreeBasic, and looks like CameraPick works even with shadows with vanilla OpenB3D.<br><br>@Cocopino<br>I can't do any test without the 3d models. <br><br></td></tr></table><br>
<a name="1279279"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Cocopino</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#36">[#36]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Angros, here you go, hope it helps.<br><a href="https://www.dropbox.com/s/2h6mggup5fdu083/4angros.zip?dl=0" target="_blank">https://www.dropbox.com/s/2h6mggup5fdu083/4angros.zip?dl=0</a><br><br>Thanks for looking into it. <br><br></td></tr></table><br>
<a name="1279283"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#37">[#37]</a></td></tr></table></td></tr><tr ><td class="posttext"> I ported your code in FreeBasic and tried it under linux with vanilla OpenB3D.<br><br>Here is the ported code:<br><pre class=code>

#Include "openb3d.bi"


ScreenRes 800,600,32,,&amp;h10002
Graphics3D 800,600

var cam=CreateCamera()
PositionEntity cam,0,50,-100

var light=CreateLight(2)
PositionEntity light,1000,1000,-1000

var ground=CreatePlane(2)
EntityAlpha ground,0.5
EntityColor ground,200,0,200

var hero = LoadAnimMesh("media\\meshes\\hero.b3d")
var head = FindChild(hero,"mixamorig:Head")

var hero2 = LoadAnimMesh("media\\meshes\\hero.b3d")
var head2 = FindChild(hero2,"mixamorig:Head")

PointEntity(cam,hero)
CameraRange(cam, 0.5, 9999)

MoveEntity(hero,25,0,0)

var anim1 = LoadAnimSeq(hero,"media\\anims\\anim_1.b3d")
var anim2 = LoadAnimSeq(hero,"media\\anims\\anim_2.b3d")
var anim3 = LoadAnimSeq(hero,"media\\anims\\anim_3.b3d")
var anim4 = LoadAnimSeq(hero,"media\\anims\\anim_4.b3d")

var anim5 = LoadAnimSeq(hero2,"media\\anims\\anim_1.b3d")
var anim6 = LoadAnimSeq(hero2,"media\\anims\\anim_2.b3d")
var anim7 = LoadAnimSeq(hero2,"media\\anims\\anim_3.b3d")
var anim8 = LoadAnimSeq(hero2,"media\\anims\\anim_4.b3d")

While Not multikey(1)
	
	If multikey(2) Then Animate(hero,3,1,anim1):Animate(hero2,3,1,anim5):
	If multikey(3) Then Animate(hero,3,1,anim2):Animate(hero2,3,1,anim6):
	If multikey(4) Then Animate(hero,3,1,anim3):Animate(hero2,3,1,anim7):
	If multikey(5) Then Animate(hero,3,1,anim4):Animate(hero2,3,1,anim8):
	
	UpdateWorld
	RenderWorld
	
	'Text(5,5,EntityX(head,1) + "," + EntityY(head,1) + "," + EntityZ(head,1))
	'Text(5,20,EntityVisible(cam, hero))
	
	Flip
Wend
End
</pre><br><br>Both heroes are visible, and seems to be animated correctly. I didn't manage to reproduce your issue. <br><br></td></tr></table><br>
<a name="1279287"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#38">[#38]</a></td></tr></table></td></tr><tr ><td class="posttext"> So from tests it seems the PickEntity issue is a problem with the wrapper and the lights on terrain is with Openb3d, also I haven't tested but it looks like the LoadAnimSeq is a prrolem with the wrapper. So far no solutions. <br><br></td></tr></table><br>
<a name="1279316"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#39">[#39]</a></td></tr></table></td></tr><tr ><td class="posttext"> About the issue of lights and terrain, I need to know a thing: does the issue occur only on terrains created by CreateTerrain, or also with terrains made with LoadTerrain?<br><br>The terrain in Hezkore picture is flat, so maybe it has been made with CreateTerrain; try replacing it with a LoadTerrain (and load a square, black image of the size of the terrain); tell me if the issue still occurs.<br><br>Because I made some tests, and the bug seems to affect only CreateTerrain. There is a simple way to fix: you have to call the method "UpdateNormals" of the terrain object (don't confuse with UpdateNormals for mesh, that is the method called by "functions.cpp"); when a terrain is loaded, it is called automatically, but it's not called with CreateTerrain.<br><br>It also need to be called after you use some ModifyTerrain commands, otherwise lightning won't be correct. It's not called by the ModifyTerrain routine otherwise it would be performed too many time, with excessive slow down. <br><br></td></tr></table><br>
<a name="1279328"></a>

<a name="1279329"></a>

<a name="1279331"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#40">[#40]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, it was CreateTerrain I was working with and now I test it LoadTerrain is affected by lights. I just wrapped UpdateNormals and tested it with CreateTerrain/ModifyTerrain and your fix worked, so thanks! I still need to wrap terrains fully so I'll do that next. <br><br>One thing I notice is that when the terrain is flat it doesn't seem to reflect light as you would expect but add some bumps and it looks fine then. <br><br></td></tr></table><br>
<a name="1279409"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Cocopino</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#41">[#41]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Angros, Munch, I can confirm LoadAnimSeq working correctly in both FreeBasic+OpenB3d and in Blitz3D. So it probably has something to do with the wrapper.<br><br>One weird thing I noticed is that in the dropbox download of post #36, I can change from animation 1 to 4 (this seems to be working correctly some/most of the times I tried). Now for the weird part: this does not seem to have to do with the animation itself: because if I rename anim_2.b3d to anim_4.b3d and vice versa, I still can change from 1 to 4 most of the times, while switching to anim_2 crashes or behaves unexpectedly. <br><br></td></tr></table><br>
<a name="1279635"></a>

<a name="1279636"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#42">[#42]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Cocopino, I tested your code in Linux and both examples seem to work fine but in the zip example you had a mistake where you are using hero.LoadAnimSeq instead of hero2.LoadAnimSeq, which was causing a crash. <br><br></td></tr></table><br>
<a name="1279772"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ErikT</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#43">[#43]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm getting a compiler error: "Module does not match commandline module" on building bmax code. I've followed the mingw install instructions by Brucey, built all modules and placed the bmx files in my project folder. Not sure what else I need to do? <br><br></td></tr></table><br>
<a name="1279807"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#44">[#44]</a></td></tr></table></td></tr><tr ><td class="posttext"> Have you checked the module scope folder is named "openb3d.mod"? <br><br></td></tr></table><br>
<a name="1279916"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#45">[#45]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey munch, the "fix-stencil-shadow-crashes" push by ProPuke on Github solved a lot of random crashes that were causing me a lot of problems! <br><br></td></tr></table><br>
<a name="1279920"></a>

<a name="1279921"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RustyKristi</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#46">[#46]</a></td></tr></table></td></tr><tr ><td class="posttext"> @ErikT<br><br>The Blitzmax version is different from NG, as munch mentioned and is working for me right now on both.<br><br>Vanilla BMX:<br>openb3d.mod<br>|_ openb3d.mod<br>|_ b3dglgraphics.mod<br>|_ openb3dlib.mod<br><br>BNX-NG:<br>b3d.mod<br>|_ openb3d.mod<br>|_ b3dglgraphics.mod<br>|_ b3dglsdlgraphics.mod<br>|_ newtondynamics.mod<br>|_ b3d.mod<br><br>using MingW 4.7.1 <br><br></td></tr></table><br>
<a name="1280115"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ErikT</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#47">[#47]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay thanks :) I'll try out NG then. <br><br></td></tr></table><br>
<a name="1280195"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BlitzSupport</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#48">[#48]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just noticed "DepthBufferToTex" the other day! Had a bit of fun learning how to access and display it:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">

' Shows depth buffer on a full-screen sprite

SuperStrict

Import Openb3d.B3dglgraphics

Type TCube
	Field entity:TEntity
	Field pitch:Float, yaw:Float, roll:Float
End Type

AppTitle = "Depth buffer display - A &amp; Z - camera forward/reverse | SPACE - toggle depth display | -/= to blend when depth buffer is [ON]"

Local width:Int		= 1024
Local height:Int		= 768
Local depth:Int		= 0
Local mode:Int			= 2
Local rate:Int			= 60
Local flags:Int		= -4 ' flags=GRAPHICS_BACKBUFFER|GRAPHICS_DEPTHBUFFER ** &lt; Important!
Local usecanvas:Int	= 0

Graphics3D width, height, depth, mode, rate, flags, usecanvas

Local cam:TCamera = CreateCamera ()
CameraRange cam, 0.5, 1000.0

Local light:TEntity = CreateLight ()
MoveEntity light, -10, 5, 5

PointEntity light, cam

' Texture into which depth buffer will be rendered

Local tex:TTexture = CreateTexture (GraphicsWidth (), GraphicsHeight (), 1 | 256)

ScaleTexture tex, 1.0, -1.0

' Sprite which displays the texture

Local texsprite:TSprite = CreateSprite ()

EntityTexture texsprite, tex
EntityOrder texsprite, -1

' Position to fill screen (derived from a Yasha post!)

ScaleSprite texsprite, 1.0, Float (GraphicsHeight ()) / GraphicsWidth ()
MoveEntity texsprite, 0, 0, 1.0

EntityParent texsprite, cam

' Some cubes...

SeedRnd MilliSecs ()

Local cubelist:TList = CreateList ()

For Local loop:Int = 0 Until 500

 	Local cube:TCube = New TCube
	
	cube.entity = CreateCube ()
	
	EntityColor cube.entity, Rnd (100.0, 255.0), Rnd (100.0, 255.0), Rnd (100.0, 255.0)
	MoveEntity cube.entity, Rnd (-30.0, 30.0), Rnd (-30.0, 30.0), Rnd (5.0, 100.0)
	
	cube.pitch	= Rand (-2.0, 2.0)
	cube.yaw	= Rand (-2.0, 2.0)
	cube.roll	= Rand (-2.0, 2.0)
	
	ListAddLast cubelist, cube
	
Next

Local dbstatus:String = ""

Local renderdepthbuffer:Int		= True
Local depthbufferalpha:Float	= 1.0

EntityAlpha texsprite, depthbufferalpha

Repeat

	' A &amp; Z: Move camera forwards/backwards
	
	If KeyDown (KEY_A) Then MoveEntity cam, 0, 0, 0.1
	If KeyDown (KEY_Z) Then MoveEntity cam, 0, 0, -0.1
	
	' RETURN: Reset camera
	
	If KeyDown (KEY_RETURN) Then PositionEntity cam, 0, 0, 0.0
	
	' SPACE: Toggle depth buffer display
	
	If KeyHit (KEY_SPACE) Then renderdepthbuffer = 1 - renderdepthbuffer
	
	If renderdepthbuffer
	
		' MINUS/PLUS (well, equals on main keyboard!): Change depth buffer display alpha
		
		If KeyDown (KEY_MINUS)
			depthbufferalpha = depthbufferalpha - 0.01
			If depthbufferalpha &lt; 0.0 Then depthbufferalpha = 0.0
			EntityAlpha texsprite, depthbufferalpha
		EndIf
		
		If KeyDown (KEY_EQUALS)
			depthbufferalpha = depthbufferalpha + 0.01
			If depthbufferalpha &gt; 1.0 Then depthbufferalpha = 1.0
			EntityAlpha texsprite, depthbufferalpha
		EndIf
	
	EndIf
	
	Cls

	' -------------------------------------------------------
	' RENDER PASS #1 - Cubes!
	' -------------------------------------------------------

	HideEntity texsprite ' Get sprite off the screen!
	
	For Local cube:TCube = EachIn cubelist
		TurnEntity cube.entity, cube.pitch, cube.yaw, cube.roll
	Next

	RenderWorld

	' -------------------------------------------------------
	' RENDER PASS #2 - Depth buffer onto full-screen sprite!
	' -------------------------------------------------------

	If renderdepthbuffer
	
		' -------------------------------------------------------
		' Grab depth buffer into texture
		' -------------------------------------------------------
		
		DepthBufferToTex tex, cam ' Same without [, cam] ?
	
		ShowEntity texsprite ' Put sprite back on screen!
		
		' Render
		
		RenderWorld
	
	EndIf
	
	' -------------------------------------------------------
	' Results!
	' -------------------------------------------------------

	If renderdepthbuffer Then dbstatus = "ON" Else dbstatus = "OFF"
	
	Text 20, 20, "Depth buffer [" + dbstatus + "]"
	Text 20, 40, "Depth buffer alpha: " + depthbufferalpha
	
	Flip
	
Until KeyHit (KEY_ESCAPE)

End
</textarea><br><br>Next job will be to figure out how to access it from a shader!<br><br>Before I get too far ahead, have I done anything stupid/wasteful here? <br><br></td></tr></table><br>
<a name="1280207"></a>

<a name="1280208"></a>

<a name="1280209"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#49">[#49]</a></td></tr></table></td></tr><tr ><td class="posttext"> I haven't looked at your code, but I made my own camera type that has a quad infront of it that I render the 3D world to from a second camera.<br>I then just apply any shader I want to that quad.<br>Right now I have a color adjust and greyscale shader on it.<br>I did have bloom also, but found a simpler way to do that. <br><br></td></tr></table><br>
<a name="1280210"></a>

<a name="1280211"></a>

<a name="1280212"></a>

<a name="1280213"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BlitzSupport</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#50">[#50]</a></td></tr></table></td></tr><tr ><td class="posttext"> Any chance of posting a simple example, Hezkore?<br><br>Failing that, can anyone see what I'm doing wrong here? (Should this even work the way I'm expecting?!)<br><br>I'm attempting to simply amend my 'depthtex' texture here (displayed on a full-screen sprite) with a very simple shader, but where I'm expecting it to return all in red, it just remains the same.<br><br>I am groping a little blindly here (cross-referencing the examples and some old Max3D shaders I did years ago), but if anyone can point me in the right direction to simply amend the texture colours via a fragment shader I'll be happy!<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">

SuperStrict

Import Openb3d.B3dglgraphics

Type TCube
	Field entity:TEntity
	Field pitch:Float, yaw:Float, roll:Float
End Type

AppTitle = "Depth buffer display - A &amp; Z - camera forward/reverse | SPACE - toggle depth display | -/= to blend when depth buffer is [ON]"

Local width:Int		= 1024
Local height:Int	= 768
Local depth:Int		= 0
Local mode:Int		= 2
Local rate:Int		= 60
Local flags:Int		= -4 ' flags=GRAPHICS_BACKBUFFER|GRAPHICS_DEPTHBUFFER ** &lt; Important!
Local usecanvas:Int	= 0

Graphics3D width, height, depth, mode, rate, flags, usecanvas

Local cam:TCamera = CreateCamera ()
CameraRange cam, 0.5, 1000.0

Local light:TEntity = CreateLight ()
MoveEntity light, -10, 5, 5

PointEntity light, cam

' Texture into which depth buffer will be rendered

Local depthtex:TTexture = CreateTexture (GraphicsWidth (), GraphicsHeight (), 1 | 256)

ScaleTexture depthtex, 1.0, -1.0

' Sprite which displays the texture

Local texsprite:TSprite = CreateSprite ()

EntityTexture texsprite, depthtex
EntityOrder texsprite, -1

' Position to fill screen (derived from a Yasha post!)

ScaleSprite texsprite, 1.0, Float (GraphicsHeight ()) / GraphicsWidth ()
MoveEntity texsprite, 0, 0, 1.0

EntityParent texsprite, cam

Local shader_name:String		= "DepthShader"
Local shader_vertex:String		= ""
Local shader_fragment:String	= "shadertest.glsl"	' Fragment shader = pixel shader!

Local shader:TShader = LoadShader (shader_name, shader_vertex, shader_fragment)

If Not shader
	Print "Failed to load shader! Aborting..."
	End
EndIf

' Some cubes...

SeedRnd MilliSecs ()

Local cubelist:TList = CreateList ()

For Local loop:Int = 0 Until 500

 	Local cube:TCube = New TCube
	
	cube.entity = CreateCube ()
	
	EntityColor cube.entity, Rnd (100.0, 255.0), Rnd (100.0, 255.0), Rnd (100.0, 255.0)
	MoveEntity cube.entity, Rnd (-30.0, 30.0), Rnd (-30.0, 30.0), Rnd (5.0, 100.0)
	
	cube.pitch	= Rand (-2.0, 2.0)
	cube.yaw	= Rand (-2.0, 2.0)
	cube.roll	= Rand (-2.0, 2.0)
	
	ListAddLast cubelist, cube
	
Next

Local dbstatus:String = ""

Local renderdepthbuffer:Int		= True
Local depthbufferalpha:Float	= 1.0

EntityAlpha texsprite, depthbufferalpha

' depthtex = depth_texture in the GLSL shader, right?

ShaderTexture shader, depthtex, "depth_texture", 0
ShadeEntity texsprite, shader

Repeat
	
	Cls

	' -------------------------------------------------------
	' RENDER PASS #1 - Cubes!
	' -------------------------------------------------------

	HideEntity texsprite ' Get sprite off the screen!
	
	For Local cube:TCube = EachIn cubelist
		TurnEntity cube.entity, cube.pitch, cube.yaw, cube.roll
	Next

	RenderWorld

	' -------------------------------------------------------
	' RENDER PASS #2 - Depth buffer onto full-screen sprite!
	' -------------------------------------------------------

	DepthBufferToTex depthtex, cam

	ShowEntity texsprite ' Put sprite back on screen!
	
	' Render
	
	RenderWorld

	Flip
	
Until KeyHit (KEY_ESCAPE)

End
</textarea><br><br>shader.glsl:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">

uniform sampler2D depth_texture;

void main ()
{

	vec4 pixel = texture2DRect(depth_texture, gl_FragCoord.xy);    // * Max3D!
//	vec4 pixel = texture2DRect(depth_texture, gl_TexCoord[0].st);  // * OB3D!
	
	pixel.r = 1.0; //depth_texture.r;
	pixel.g = 0.0;
	pixel.b = 0.0;
	
	gl_FragColor = pixel;
}
</textarea><br><br>Also, is there any way to test if a shader compiled correctly? Even with deliberate typos, they seem to load! <br><br></td></tr></table><br>
<a name="1280218"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#51">[#51]</a></td></tr></table></td></tr><tr ><td class="posttext"> I guess I could share it once I'm by the computer.<br><br>You can use InitShader or something like that to test for shader errors.<br>I think it was shown/used in an example or in the previous part 2 thread. <br><br></td></tr></table><br>
<a name="1280349"></a>

<a name="1280350"></a>

<a name="1280351"></a>

<a name="1280352"></a>

<a name="1280353"></a>

<a name="1280354"></a>

<a name="1280355"></a>

<a name="1280357"></a>

<a name="1280358"></a>

<a name="1280359"></a>

<a name="1280360"></a>

<a name="1280361"></a>

<a name="1280363"></a>

<a name="1280364"></a>

<a name="1280365"></a>

<a name="1280366"></a>

<a name="1280367"></a>

<a name="1280368"></a>

<a name="1280369"></a>

<a name="1280370"></a>

<a name="1280383"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#52">[#52]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here's my TShaderCam code, along with an example for greyscale and color adjusting.<br>I'm not sure if I should ask for any credits for sharing this...<br>Not that it's very advanced, but it took some time to figure out!<br>I guess, just use it as you want, but I'd be really happy if you (anyone) gave me some creds if you do end up using this. :)<br><br>*LINK REMOVED, SEE POST #55 FOR NEW VERSION*<br><br>And BlitzSupport, TShaderCam has shader error checking.<br>The example included has that part enabled, so if you're still wondering how to check for shader errors you can check that out.<br><br><br>And while I'm at it, I guess I should also share the FBO module with depth testing enabled that I'm using for bloom, screen dirt and smoke/fog in my 3D world.<br>With it you can draw the 3D world or your Max2D stuff to a separate image and render it ontop of everything.<br><br><a href="https://bitbucket.org/Hezkore/fbo" target="_blank">https://bitbucket.org/Hezkore/fbo</a><br><br>For bloom I render the world normally once, then make everything EXCEPT for the bloom objects 100% black and render that to an FBO with low resolution.<br>Then I render the FBO a couple of times ontop of the normal world (in Max2D) with the light blend mode.<br>It's not the best looking bloom, but it works alright as glow in my GTA2-ish top-down game.<br><br>Here's a random test scene from my little editor.<br>Notice how the neon sign glows a bit.<br><img src="http://puu.sh/kTYgB/8d488c233b.jpg"> <br><br></td></tr></table><br>
<a name="1280376"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BlitzSupport</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#53">[#53]</a></td></tr></table></td></tr><tr ><td class="posttext"> Excellent, thanks for posting! I'll have a good look at this.<br><br>Been playing with some really simple shaders tonight, and about to try and get my depth buffer stuff working again, so hopefully your work will help me figure out what I need... much appreciated!<br><br>That last screenshot is really nice, some subtle effects going on there. <br><br></td></tr></table><br>
<a name="1280380"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RustyKristi</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#54">[#54]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for sharing Hezkore. :-) Just tried it and it looks great! will this be included in official repo? <br><br></td></tr></table><br>
<a name="1280381"></a>

<a name="1280382"></a>

<a name="1280384"></a>

<a name="1280385"></a>

<a name="1280386"></a>

<a name="1280387"></a>

<a name="1280388"></a>

<a name="1280389"></a>

<a name="1280390"></a>

<a name="1280391"></a>

<a name="1280392"></a>

<a name="1280395"></a>

<a name="1280450"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#55">[#55]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think a better way would be to create a type of shader camera that attaches itself to a normal camera entity.<br>That way you could use all your normal Entity functions for moving the camera around.<br><br>Basically something like...<pre class=code>myCamera = CreateCamera()

myShaderCamera = CreateShaderCamera(myCamera)
myShaderCamera.Shader(Blah,Blah)
myShaderCamera.Quality(0.25)</pre><br>etc.<br><br>So then you'd only work with "myCamera", like you normally would.<br>All the normal entity functions would work and act as expected.<br><br>Then to render you'd do...<pre class=code>myShaderCamera.Render()</pre>Instead of RenderWorld()<br><br>It'd be easier to implement in existing projects and it'd be easy to switch between which camera to render with since myCamera.Render() would act the same way as myShaderCamera.Render().<br>But without any shaders applied of course!<br>So for machines that can't handle the screen shaders, you could just render with the normal camera to skip the shaders.<br><br><br>UPDATE: I have created a camera that works like this.<br>I also accidentally rendered the world twice in the old example, so that's been fixed too.<br>Here's the new link: *LINK REMOVED, SEE POST #60 FOR NEW LINK* <br><br></td></tr></table><br>
<a name="1280396"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BlitzSupport</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#56">[#56]</a></td></tr></table></td></tr><tr ><td class="posttext"> Interesting, will take a look tomorrow (didn't really stick to the plan tonight!), but thanks again, Hezkore, hopefully it will point me in the right direction! <br><br></td></tr></table><br>
<a name="1280402"></a>

<a name="1280403"></a>

<a name="1280404"></a>

<a name="1280422"></a>

<a name="1280423"></a>

<a name="1280424"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ErikT</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#57">[#57]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm. On compiling with BMK-NG I get:<br><br>Compile Error: Unable to find overload for rotatemesh(TMesh,Int,Int,Int)<br>[C:/Progs/BlitzMaxNG/mod/openb3d.mod/openb3d.mod/inc/TMesh.bmx;142;0]<br><br>NG version: 0.62.3.08 <br><br></td></tr></table><br>
<a name="1280425"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ErikT</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#58">[#58]</a></td></tr></table></td></tr><tr ><td class="posttext"> Uh oh, looks like I forgot about the libraries themselves. Downloaded and placed them in my own project folder and now it works great.<br><br>But I thought Build Modules/Rebuild All Modules already built the libraries for me? So where do those fresh builds get placed? (Sorry about all the stupid questions :P) <br><br></td></tr></table><br>
<a name="1280443"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#59">[#59]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry Erik, I don't think I can help as I still haven't tried out Bmxng myself. It does seem likely your Mingw install is missing something.<br><br>Hezkore, thanks a lot for the shader demo! It should help me trying to add postfx shaders to the wrapper (I'm busy at the moment so sorry for the lack of response). <br><br></td></tr></table><br>
<a name="1280449"></a>

<a name="1280451"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#60">[#60]</a></td></tr></table></td></tr><tr ><td class="posttext"> I decided to make my shader camera into a module.<br>You can find it at <a href="https://bitbucket.org/Hezkore/shader-camera" target="_blank">https://bitbucket.org/Hezkore/shader-camera</a><br>I also set the camera range for the "screen camera" very low, so there's an even lower chance of it rendering anything of the actual 3D world.<br>So make sure you update to the new version! <br><br></td></tr></table><br>
<a name="1280797"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#61">[#61]</a></td></tr></table></td></tr><tr ><td class="posttext"> About the "fix-stencil-shadow-crashes" push by ProPuke on Github. Thanks for pointing that out Hezkore! <br><br>Angros, if you're wondering about ProPuke's changes you should be able to see them <a href="https://github.com/ProPuke/openb3d.mod/commit/a7751f4f738021b73de0655fe40ba644365ed429" target="_blank">HERE</a>. <br><br></td></tr></table><br>
<a name="1280827"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#62">[#62]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'd have to make some changes in those files, for the next version...<br><br>For now, I am testing some changes in the files mesh.cpp,  global.cpp...<br><br>In the new version, there will be a lot of lines like:<br>#ifdef gles2<br><br>Of course, since I am compiling with standard opengl, I will need your help for testing. <br><br></td></tr></table><br>
<a name="1280854"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#63">[#63]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sounds great Angros! So assuming you mean testing gles2, what platforms would I need for that? <br><br></td></tr></table><br>
<a name="1280862"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#64">[#64]</a></td></tr></table></td></tr><tr ><td class="posttext"> Angle, Android, Emscripten... you choose. <br><br>I don't have gles2 installed, I am using opengl and removing all unsupported commands like glLoadIdentity, so I will need someone with a true gles2 install to test (not easy: Angle seems to require Visual Studio, Emscripten requires 64 bit, Android requires ND... ) <br><br></td></tr></table><br>
<a name="1280957"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#65">[#65]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is there a way to disable the shader I've set for an Entity? <br><br></td></tr></table><br>
<a name="1280964"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#66">[#66]</a></td></tr></table></td></tr><tr ><td class="posttext"> Set it to 0 <br><br></td></tr></table><br>
<a name="1280967"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#67">[#67]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> so I will need someone with a true gles2 install to test <br></div><br>I'm sure someone around here will be able to assist :-) <br><br></td></tr></table><br>
<a name="1281013"></a>

<a name="1281014"></a>

<a name="1281015"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#68">[#68]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  Is there a way to disable the shader I've set for an Entity? <br>&gt;Set it to 0  <br></div><br>Do you mean the shader variable or the "ShaderMat" variable in the Surface class? I haven't wrapped this variable yet.<br><br>By the way, could you explain what the "ambient_shader" variable in the Global class is for?<br><br><div class="quote"> I'm sure someone around here will be able to assist :-)  <br></div><br>Great! I don't have an Android phone but I should get someone's old one soon, so will hopefully be able to beta test too. <br><br></td></tr></table><br>
<a name="1281017"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#69">[#69]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've made some Android and iOS games, so I have a bunch of devices if something needs testing. Along with Macs and PCs with Linux and Windows.<br><br>And about removing the shader.<br>After I've used ShadeEntity to bind a shader to my Entity, is there a way to remove that?<br>So that it works like a normal Entity again that uses EntityTexture and all that. <br><br></td></tr></table><br>
<a name="1281027"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#70">[#70]</a></td></tr></table></td></tr><tr ><td class="posttext"> As I've said: to remove the shader, just use ShadeEntity again, on the same entity, using 0 instead of a shader<br><br>if you used something like:<br><pre class=code>shadeentity cube,shader</pre><br><br>to disable the shader just use:<br><br><pre class=code>shadeentity cube,0</pre> <br><br></td></tr></table><br>
<a name="1281070"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BlitzSupport</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#71">[#71]</a></td></tr></table></td></tr><tr ><td class="posttext"> I actually tried this last night, using Null, and it gave an error relating to accessing a Null object:<br><br><pre class=code>

' Using Local shader:TShader...

	If KeyHit (KEY_SPACE)
		toggle = 1 - toggle
		If toggle
			ShadeEntity sprite, Null
		Else
			ShadeEntity sprite, shader
		EndIf
	EndIf
</pre><br><br>(Changing to 0 gives an error due to wrong type for the shader parameter.) <br><br></td></tr></table><br>
<a name="1281091"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#72">[#72]</a></td></tr></table></td></tr><tr ><td class="posttext"> I tested it in FreeBasic, and it worked (but FreeBasic calls library functions directly).<br><br>I am not sure how the wrapper works, but you should be able to use ShadeEntity_ (with the underscore) to bypass the wrapper code that gives the error. <br><br></td></tr></table><br>
<a name="1281095"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#73">[#73]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, it's because ShadeEntity calls the method material.ShadeEntity and it's erroring when that's null. It just needs to be changed to call as a function. For now this should work:<br>ShadeEntity_( TEntity.GetInstance(sprite),Null ) <br><br></td></tr></table><br>
<a name="1281734"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >feeble1</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#74">[#74]</a></td></tr></table></td></tr><tr ><td class="posttext"> I was playing around with OpenB3d, MiniB3d, and Blitz3d.  Something about UpdateWorld was a little different.  Its not game breaking or bug inducing (I don't think), but it is interesting.<br><br> <pre class=code>Import openb3d.b3dglgraphics
'Import sidesign.minib3d
Graphics3D 640,480

camera=CreateCamera()
	RotateEntity camera,45,0,0
	PositionEntity camera,2,5,-5

AmbientLight 255,255,255

ball=CreateSphere()
	EntityColor ball,0,0,255
	EntityType ball,1

box=CreateCube(box)
	PositionEntity box,4,0,0
	EntityType box,2

Collisions 1, 2, 2, 2

While Not KeyHit( KEY_ESCAPE ) And Not AppTerminate()
	'openb3d is much more particular than miniB3d Or B3d about UpdateWorld placement
	UpdateWorld
	
	MoveEntity ball,(KeyDown(KEY_RIGHT)-KeyDown(KEY_LEFT))*.05,0,0
	
	If CountCollisions(ball) Then End
	
	'UpdateWorld
	RenderWorld	

	Flip
Wend
End</pre><br><br>OpenB3d is much more particular about where you call UpdateWorld. <br><br></td></tr></table><br>
<a name="1284331"></a>

<a name="1284333"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#75">[#75]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry for the delay, we had a wedding in the family (not me). :) <br><br>I have just wrapped TTerrain fully, except for the terrain collisions in tree.h (TColTree in minib3d) because it seems they are only for internal use and are not possible to access (since they get deleted quickly). So now I am just mulling whether anyone will need the shader variables (in shadermat.h and shaderobject.h). Could do with a second opinion on that. <br><br>I tried to get Openb3d working on ubuntu with Freebasic so I can test this shadow camerapick bug. I can run the OpenGL examples but not code I take from the Openb3d thread. I am wondering if I am missing Glee.c or something.<br><br>Anyway, happy Christmas (or holidays) to everyone! <br><br></td></tr></table><br>
<a name="1284372"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#76">[#76]</a></td></tr></table></td></tr><tr ><td class="posttext"> What error do you get in Ubuntu? <br><br></td></tr></table><br>
<a name="1284405"></a>

<a name="1284411"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#77">[#77]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Angros! I'm sure I just don't know what I'm doing. The FBWiki is very helpful though.<br><br>I have extracted Openb3d for FB to FreeBASIC-1.04/examples/graphics/openb3d and copied some code from your thread.<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">#Include "openb3d.bi"

Screen 18, 32, , &amp;h02
Graphics3D 640,480,32,2,1


Var cam=CreateCamera()
MoveEntity cam, 0, 0, -4
Var light=CreateLight()
Var box=CreateCube()
turnEntity box, 90,0,0

EntityColor box, 300,0,0
Dim As Integer mx,my,mb

EntityPickMode box,3,1



Do
GetMouse mx,my,,mb
   
If box =Camerapick(cam, mx,my) And mb=1 Then
end
   
EndIf

    updateworld
    renderworld
    Sleep 1,1
 
    Flip
   
   
Loop</textarea><br>The error is: "error while loading shared libraries: libOpenB3D.so: cannot open shared object file: No such file or directory".<br><br>Edit: so it seems I need to install the Openb3d shared library, but I don't know what files need to go where. <br><br></td></tr></table><br>
<a name="1284431"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#78">[#78]</a></td></tr></table></td></tr><tr ><td class="posttext"> If the library is in the same directory of the compiled file, you can launch it using this command:<br><br><pre class=code>LD_LIBRARY_PATH=./:$LD_LIBRARY_PATH  ./yourfile</pre><br><br>instead of just using <br><pre class=code>./yourfile</pre><br><br>With this trick, you tell linux to look for shared libraries in current directory, too (otherwise you'd need to put the library in a system directory) <br><br></td></tr></table><br>
<a name="1284464"></a>

<a name="1284465"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#79">[#79]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks, that worked but how do I install Openb3d so I don't have to do that every time I run a FB exe? I tried copying the .bi files to /usr/local/include and the .so to /usr/local/lib but it still can't find them. Do I need any symlinks?<br><br>I converted the shadowpick.zip example by Hezkore to FB and tested it, still no idea what's wrong though. <br><br>I notice you can't use the Text command in FB, I tried using code by Westbeam saved as 2d2.bi with the equivalent command myFont.print 10,10,"supertext" but it didn't work. <br><br></td></tr></table><br>
<a name="1284506"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#80">[#80]</a></td></tr></table></td></tr><tr ><td class="posttext"> You are using wrong directories: correct directory for the .so file is "/usr/lib" (no "local") <br><br></td></tr></table><br>
<a name="1284508"></a>

<a name="1284519"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#81">[#81]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ahh, thank you!<br><br>I have fixed the shadow Camerapick bug. I tested older versions until I found which commit it broke in, then in the changes log I saw it was when I added variables to TShadowObject. So I regressed just that file and when that worked I narrowed it down to InitFields. It was the Parent variable, I realize I can't just call Createobject it must be checked with Getobject or you may end up with duplicate objects in the lists, which in this case confused Camerapick. <br><br>If you want a quick fix then change line 99 in TShadowObject.bmx to:<br><pre class=code>Parent=TMesh( TEntity.GetObject(inst) )</pre> <br><br></td></tr></table><br>
<a name="1284651"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#82">[#82]</a></td></tr></table></td></tr><tr ><td class="posttext"> Angros, playing around with your particles example it seems as soon as I create any meshes, even another sprite, then the particles don't work. <br><br></td></tr></table><br>
<a name="1284666"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#83">[#83]</a></td></tr></table></td></tr><tr ><td class="posttext"> Can you post an example? <br><br></td></tr></table><br>
<a name="1284667"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#84">[#84]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sure. It's just your example with a line added. I've noticed it just affects the emitter stuff. So the swarm example works with meshes as it doesn't use the emitter stuff.<br><pre class=code> #Include "openb3d.bi"


    ScreenRes 800,600,32,,&amp;h10002
    Graphics3d 800,600

    Var camera=createCamera
    Var light=createLight

var cube=createsprite()
	var cube2=createsprite() ' &lt;-
var t=createtexture (1,1)
entitytexture cube,t
spriterendermode cube,3
particletrail cube,200
particlecolor cube,-255,-255,0,-1

var p=createparticleemitter(cube)

emitterrate p,1
emitterparticlelife p, 500
emittervariance p,.5
emitterparticlespeed p,.3
emittervector p,0,-.004,0

var p2=copyentity(p)
moveentity p2,10,0,0
var zz=0
moveentity camera,0,1,-15
p=p2

    Do

        if multikey(72) then turnentity p,-1,0,0
        if multikey(80) then turnentity p,1,0,0
        if multikey(77) then turnentity p,0,-1,0
        if multikey(75) then turnentity p,0,1,0
        if multikey(2) and zz=0 then freeentity p:zz=1

        updateworld '1
        renderworld
        Flip
    Loop Until MultiKey(1)
</pre> <br><br></td></tr></table><br>
<a name="1284808"></a>

<a name="1284809"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#85">[#85]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, you've just found a bug. To fix it, in the file "particle.cpp", just before the line:<br><br><pre class=code>
	glColorPointer(4,GL_FLOAT,0,&amp;surf-&gt;vert_col[0]);
</pre><br><br>add the line: <br><br><pre class=code>
	glBindBuffer(GL_ARRAY_BUFFER,0); // reset - necessary for when non-vbo surf follows vbo surf
</pre> <br><br></td></tr></table><br>
<a name="1285884"></a>

<a name="1285885"></a>

<a name="1285886"></a>

<a name="1285887"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#86">[#86]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've updated the repo now. Quite a few changes and just in time for Christmas! ho ho ho :)<br><br>- particles with meshes fix<br>- terrain corners not set fix<br>- wrapped terrain fields and methods<br> (meshinfo and mechcollider in coltree/tree were not wrapped because I couldn't get access them)<br>- ShadeEntity erroring on null shader<br>- changed any other functions that may use a null object<br>- GetObject checks for CreateObject in InitFields<br>- some more doc comments<br>- sl_shimmer example, heat haze postprocess effect using CameraToTex<br>- sl_depthfield example, depth of field postprocess effect using CameraToTex/DepthbufferToTex<br>- particle example, how to do a smoke effect with TParticleEmitter<br>- new methods for when using GL 2.0, CameraToTexEXT/DepthbufferToTexEXT - no MAV now<br>- CameraViewport's inverted y parameter was the wrong value when switching cameras<br>- THarwareInfo new extensions, FBOSupport and DepthStencil used in CameraToTexEXT<br>- changes to CameraToTex/DepthbufferToTex in texture.cpp (see sl_depthfield)<br><br>The changes to texture.cpp were not essential but I noticed they improved the rendering, in sl_depthfield you can see ugly "ghost edges" artifacts around the meshes from the depth buffer but with my changes these are gone.<br><br>Also the CameraToTexEXT/DepthbufferToTexEXT were added when I was reminded that CameraToTex MAVs in GL 2.0. It may not be worth supporting 2.0 but it's nice to have it. Just for fun I tested on a Mac with GL 1.4 and everything errored out. He he <br><br></td></tr></table><br>
<a name="1285888"></a>

<a name="1285889"></a>

<a name="1285890"></a>

<a name="1285934"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#87">[#87]</a></td></tr></table></td></tr><tr ><td class="posttext"> Angros! I've been playing with the particle commands a bit and noticed a few things. EmitterVector sets the direction as well as the speed but shouldn't it just be a direction? Also EmitterParticleSpeed only effects things on the z axis. I also wonder how I would effect the particles alpha, so it would fade with time. Should I use the EmitterParticleFunction for this?<br><br>Here is an example converted to FB for smoke so you see what I mean (images are on my repo).<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">' particle2.bas

#Include "openb3d.bi"

ChDir ExePath() ' set path (for textures/shaders/models ...)

ScreenRes 800,600,32,,&amp;h10002
Graphics3d 800,600


'ClearTextureFilters

Var camera=CreateCamera()
CameraClsColor camera,100,150,200

Var light=CreateLight()
TurnEntity light,45,45,0

Var pivot=CreatePivot()
PositionEntity pivot,0,2,0

Var t_sphere=CreateSphere( 8 )
EntityShininess t_sphere,0.2

randomize 1
dim as integer t, lastsphere
For t=0 To 359 Step 36
	Var sphere=CopyEntity(t_sphere,pivot)
	EntityColor sphere,Rnd(1)*255,Rnd(1)*255,Rnd(1)*255
	TurnEntity sphere,0,t,0
	MoveEntity sphere,0,2,10
	lastsphere=sphere
Next
FreeEntity t_sphere

Var cube=CreateCube()
PositionEntity cube,0,7,0
ScaleEntity cube,2,2,2
EntityColor cube,Rnd(1)*255,Rnd(1)*255,Rnd(1)*255

'Var ground=CreatePlane(128)
Var ground=CreateCube()
ScaleEntity ground,1000,1,1000
Var ground_tex=LoadTexture("sand.bmp")
ScaleTexture ground_tex,0.01,0.01 ' scale uvs
EntityTexture ground,ground_tex

Var cone=CreateCone()
PositionEntity cone,25,3,25

Var sprite=CreateSprite()
EntityColor sprite,250,250,150
'ScaleSprite sprite,1.5,1.5
EntityAlpha sprite,0.2
Var noisetex=LoadTexture("smoke.png",1+2)
'Local noisetex:TTexture=CreateTexture(1,1)
EntityTexture sprite,noisetex

'SpriteRenderMode sprite,3 ' 1: normal, 2: sprite batch, 3: particle batch?
'ParticleTrail sprite,20 ' particle trail for particle
'ParticleColor sprite,1.0,0,0,1.0 ' vertex color?

Var p=CreateParticleEmitter(sprite)
MoveEntity p,25,5,25
EmitterRate p,1.0 ' rate between each emission (1.0/r) smaller is less
EmitterParticleLife p,175 ' lifespan of particle, in frames
EmitterVariance p,0.07 ' randomness of emission, direction and speed
EmitterParticleSpeed p,0.01 ' initial speed?
EmitterVector p,0.001,0.001,0 ' emission direction and speed?

Var p2=CopyEntity(p)

PositionEntity sprite,-25,6,25
PositionEntity camera,0,7,0
MoveEntity camera,0,0,-20

Do
	' control camera
	MoveEntity camera,multikey(30)-multikey(32),0,multikey(31)-multikey(17) ' A D S W
	TurnEntity camera,multikey(80)-multikey(72),multikey(77)-multikey(75),0 ' Up Dn Rt Lf
	
	TurnEntity cube,0.1,0.2,0.3
	TurnEntity pivot,0,1,0
	
	PositionEntity p2,EntityX(lastsphere,1),5.0,EntityZ(lastsphere,1)
	
	UpdateWorld ' update particles
	
	RenderWorld
	
	Flip
Loop Until MultiKey(1)</textarea><br>Edit: I forgot to mention ParticleColor. It doesn't seem to work. Have I missed something?<br><br>Finally, I was looking at bloom shaders which are basically a blur in two passes which means you need access to two (maybe even three) framebuffer objects. This is a bit beyond me but maybe you will know what to do. I read it can be done by multiple renders instead but surely this would be slower? I was thinking of a DoublebufferToTex command... <br><br></td></tr></table><br>
<a name="1285945"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#88">[#88]</a></td></tr></table></td></tr><tr ><td class="posttext"> EmitterVector sets a vector: and a vector has a magnitude (a speed, in that case) and a direction. Anyway, that vector affects particles only AFTER they have been emitted: it's used to simulate gravity, and wind. To set direction of the emitted particle, just turn the emitter (TurnEntity and RotateEntity work on emitters): particles will be emitted in the direction the emitter is facing, at the speed set by EmitterParticleSpeed (that's why it only affect z axis)<br><br>To set alpha, rotations and other parameters (color, size... whatever you want) you should use EmitterParticleFunction.<br><br>ParticleColor only works on particles that have a trail (sprites with SpriteRenderMode set to 3), and does not affect the particle itself, but only its trail (by default the trail is set to 0, so you don't see anything); ParticleVector can move the trail (i.e. to simulate a smoke trail in the wind). The trail always start with the colour of the particle, and changes according to ParticleColor (a red flame can become gray smoke, then fade away). Every sprite with mode 3 can leave a trail, and if the trail has a vector a single sprite could act as a mini-emitter (actually, I implemented that as a poor-man way to create emitters before adding the "Emitter" entity). By combining the two solution you could achieve complex effects (fire with smoke, for example)<br><br>What do you mean with "DoublebufferToTex"? Even with double buffering, rendering always happen on one buffer, not on two. You can render the same image on many textures using many times CameraToTex (with the same camera, if you want), then post-process the texture as you wish. <br><br></td></tr></table><br>
<a name="1285946"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#89">[#89]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok thanks. One problem I found with SpriteRenderMode 3 is the sprites are scaled to always be the same size no matter the distance from the camera, I think this is a bug as I don't see why anyone would want this.<br><br>DoublebufferToTex was meant to be about using a second framebuffer object with GL_COLOR_ATTACHMENT1. It seems you need to use glDrawBuffers to draw multiple buffers as in beanage's fbo mod. <br><br></td></tr></table><br>
<a name="1285950"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#90">[#90]</a></td></tr></table></td></tr><tr ><td class="posttext"> With SpriteRenderMode 3 sprites are rendered using GL_POINTS, and not all implementations of OpenGL act in the same way (older implementation don't even texture them). But usually this is not an issue for particles.<br><br>As far as I know, usually a buffer is rendered on a simple quad mesh for post-processing (it's not the most efficient way, but it's the most compatible solution) <br><br></td></tr></table><br>
<a name="1285960"></a>

<a name="1285961"></a>

<a name="1285964"></a>

<a name="1285966"></a>

<a name="1285967"></a>

<a name="1285968"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#91">[#91]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey I haven't been able to pin point the exact problem here.<br>But for some reason when I use flag 64 with LoadTexture it affects other textures as well. (Flag 64 is Spherical environment map)<br>When I load a texture with it and then use BrushTexture() and PaintSurface(), it seems to apply to a lot of other textures as well.<br>It doesn't do that when I use original MiniB3D.<br><br>It's like it doesn't reset sometimes, for some reason, and keeps it on.<br><br><img src="https://dl.dropboxusercontent.com/u/2842751/flag64.jpg"> <br><br></td></tr></table><br>
<a name="1285986"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#92">[#92]</a></td></tr></table></td></tr><tr ><td class="posttext"> Maybe it's my mistake... I never tried using it on entities with many surfaces/textures.<br><br>in the file "mesh.cpp", locate the lines:<br><br><pre class=code>
			if (DisableCubeSphereMapping!=0){
				glDisable(GL_TEXTURE_CUBE_MAP);
				glDisable(GL_TEXTURE_GEN_S);
				glDisable(GL_TEXTURE_GEN_T);
				glDisable(GL_TEXTURE_GEN_R);
				DisableCubeSphereMapping=0;
			}
</pre><br><br>and remove the line "DisableCubeSphereMapping=0;"<br><br>Please tell me as soon as possible if that fixed the issue. <br><br></td></tr></table><br>
<a name="1285987"></a>

<a name="1285988"></a>

<a name="1285989"></a>

<a name="1285990"></a>

<a name="1285991"></a>

<a name="1285992"></a>

<a name="1285996"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#93">[#93]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'll give it a go as soon as munch updates the source! :)<br><br>And while I'm here I might as well ask...<br>Is there a way to pass raw GL blend functions?<br>I'm reading the the Quake 3 shaders and it's throwing me a lot of "GL_SRC_ALPHA GL_ONE_MINUS_SRC_ALPHA" and such.<br>It'd be nice if I could just apply that directly to a texture instead of trying to figure out what it is via the built-in TextureBlend modes.<br>Something like TextureBlendGL(texture:TTexture,source:int,destination:int) <br><br></td></tr></table><br>
<a name="1286005"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#94">[#94]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's a nice idea, and I was thinking to add something similar in the next version: maybe a material could have two callback functions (one to enable, one to disable parameters) <br><br></td></tr></table><br>
<a name="1286008"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#95">[#95]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well I tried to reproduce this but wasn't able to. I just made two cubes in one mesh and applied a spheremap to one and normal texture to the other. So I've just added the fix by Angros to the repo as requested but I don't see why you can't just edit the C++ yourself for this Hezkore. <br><br></td></tr></table><br>
<a name="1286009"></a>

<a name="1286015"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#96">[#96]</a></td></tr></table></td></tr><tr ><td class="posttext"> @munch I honestly didn't know I could just edit the source.<br>I thought I would have to compile much more than the module then.<br><br>@angros47 Your fix works! \o/<br>And about the Quake 3 shaders.<br>They're not "real" shaders, they don't use LoadShader or anything like that. (that was too slow anyways)<br>So if TextureBlendGL gets implemented, I'd like it outside of the shader part.<br><br>Oh and btw, is there a way to quickly load a shader multiple times?<br>I have a bunch of surfaces that all use the same shader but with different textures, and doing LoadShader for each surface takes forever. <br><br></td></tr></table><br>
<a name="1286019"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#97">[#97]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, no the module is independent from anything other than brl, pub and maxgui modules, openb3dlib has the c++ library and openb3d has the bmx wrapper.<br><br>Do you know how to use BMK as explained in "users guide/bmk" or do you just use "build modules"? That works but I prefer commandline. If you don't then all you do is open cmd/terminal, type "cd blitzmax/bin" ("cd ../" goes up a directory) then "bmk makemods -a -d openb3d" prefixing with "./" if in unix which builds only debug mode. If you want both debug and release just use "bmk makemods -a openb3d" but it's slower. <br><br></td></tr></table><br>
<a name="1286064"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#98">[#98]</a></td></tr></table></td></tr><tr ><td class="posttext"> In OpenB3D a "material" is more than a shader, since it contains the vertex shader, the fragment shader, and the textures: it could contain only shaders, or only textures (i.e. to use a 3d texture you have to use materials); so, I don't see any reason why it shouldn't contain a callback function, too.<br><br>Maybe I could add a "UseTexture" command, to use entity textures in shader instead of material textures (so the same shader could work with many entities and different textures)... I'll have a look at it. <br><br></td></tr></table><br>
<a name="1286078"></a>

<a name="1286079"></a>

<a name="1286080"></a>

<a name="1286081"></a>

<a name="1286082"></a>

<a name="1286083"></a>

<a name="1286084"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#99">[#99]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for all the help guys!<br><br>I think I've found another issue, this time with BrushFX 16, disable backface culling and BrushBlend 6, additive.<br>It works fine but only on the faces that would normally be culled!<br><br><img src="https://dl.dropboxusercontent.com/u/2842751/cullingalpha.jpg"><br><br>UPDATE: False alarm, it was all my fault!<br>I had another face overlaying it, sorry guys. :)<br><br>Once again, thanks for all the help. <br><br></td></tr></table><br>
<a name="1286085"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#100">[#100]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh good! :)<br><br>Nice art Hezkore. By the way couldn't you just use a sprite for the fire? I never used 2 quads like that, what's the technique called? <br><br></td></tr></table><br>
<a name="1286099"></a>

<a name="1286100"></a>

<a name="1286102"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#101">[#101]</a></td></tr></table></td></tr><tr ><td class="posttext"> The art is from Quake 3, infact the whole level is loaded directly from the Quake 3 BSP files.<br>So I haven't actually made the fire, just loaded it from the Quake 3 level file.<br>Krischan posted a BSP loader and I'm trying to improve on it by adding most of the unsupported stuff, like the texture scripts/shaders that Quake 3 uses and some special geometry.<br>But it's very hard when the texture scripts use blending functions like "gl_dst_color gl_zero" and you can't really get those effects with just the 3 different BrushBlend() modes.<br>All I really can get to work as it should is the additive stuff.<br>That's why I suggested TextureBlendGL or BrushBlendGL or just SurfaceBlendGL so that I could get the correct effects. <br><br></td></tr></table><br>
<a name="1286174"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#102">[#102]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok I have added a new function SurfaceGLBlendFunc(surf,sfactor,dfactor) with example. It seems to work fine. I probably should add SurfaceFX and SurfaceAlpha instead of using the pointers. <br><br></td></tr></table><br>
<a name="1286240"></a>

<a name="1286241"></a>

<a name="1286276"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#103">[#103]</a></td></tr></table></td></tr><tr ><td class="posttext"> Good work munch!<br><br>I've give it a go now, but I can't seem to get the results I want...<br>Maybe what I'm asking for is really advanced or something, I don't know?<br><br>Basically the Quake 3 texture scripts layers textures above each other, and each texture has its own blending mode for how it should blend with the previous texture.<br>Or in the case of the first/bottom texture, how it blends with the background/rest of the world.<br><br>So what I've done is created a new surface for each layered texture and then applied SurfaceGLBlendFunc to that surface.<br>But it doesn't seem to blend with whatever's under it.<br><br>I've created an example here showing the issue - <a href="https://dl.dropboxusercontent.com/u/2842751/blendtest.zip" target="_blank">blendtest.zip</a><br>When you first run it, it's going to look just fine.<br>And what's how I want it to look!<br>But you can uncomment Attempt 1 and 2, which uses SurfaceGLBlendFunc, and see that it doesn't quite work the same way.<br>Attempt 2 would be the best way since I wouldn't have to make a bunch of surfaces ontop of each other. (way better FPS)<br>But for that I would need BrushGLBlendFunc.<br>What am I doing wrong?<br><br>As I said, it might be that what I'm asking for is something really advanced that needs a real beefy 3D engine, I don't know, I'm not that good at 3D in general.<br>But it seemed so easy when I read the texture scripts and it just said how each texture would blend with the next one. <br><br></td></tr></table><br>
<a name="1286342"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#104">[#104]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hezkore, I realize you need access to brush and surface so I changed it to BrushGLBlendFunc and then just pass surf.brush to it. I also added TextureGLTexEnv for a TextureBlend equivalent, it allows up to 12 TexEnv calls per texture and the counter can be reset if the 2nd parameter is void (or zero). I couldn't get an add blend working with your TextureBlend example, this TexEnv stuff can get very complex. The only thing similar I could get was alpha+multiply. Also you need to set fx=32 or alpha&lt;1 for BlendFunc to work. Here is my changes to your code. And you don't need to use brush.blend[0] just use BrushBlend(), same for BrushAlpha().<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">SuperStrict
Framework openb3d.B3dglgraphics
Graphics3D 800,600,0,2

Local camera:TCamera = CreateCamera()
Local light:TLight = CreateLight()
Local plane1:TMesh = CreateQuad()
PositionEntity plane1, 0, 0, 1.35

Local surf1:TSurface = GetSurface(plane1, 1)


'======================================
'== Demonstration of what I expected ==
' This is what I want to happen
Rem
Local plane2:TMesh = CreateQuad()
PositionEntity plane2, 0, 0, 1.35

Local surf2:TSurface = GetSurface(plane2, 1)

Local brush1:TBrush = LoadBrush("flamingos.png")
Local brush2:TBrush = LoadBrush("flamingobg.jpg")

PaintSurface(surf1, brush1)
PaintSurface(surf2, brush2)

BrushBlend(surf1.brush, 3)
EndRem


'===============
'== Attempt 1 ==
' First attempt is to create two surfaces with the top one being additive
' This is the way I want to do it
Rem
Local plane2:TMesh = CreateQuad()
PositionEntity plane2, 0, 0, 1.35

Local surf2:TSurface = GetSurface(plane2, 1)

Local brush1:TBrush = LoadBrush("flamingos.png")
Local brush2:TBrush = LoadBrush("flamingobg.jpg")

PaintSurface(surf1, brush1)
PaintSurface(surf2, brush2)

BrushGLBlendFunc(surf1.brush, GL_SRC_ALPHA, GL_ONE) ' Additive
BrushFX(surf1.brush, 32)
EndRem


'===============
'== Attempt 2 ==
' Second attempt was to just use a multi textured surface
' This would be nice but I'd like BrushGLBlendFunc()
'Rem
Local tex1:TTexture = LoadTexture("flamingos.png")
Local tex2:TTexture = LoadTexture("flamingobg.jpg")

Local brush:TBrush = CreateBrush()
BrushTexture(brush, tex1, 0, 0)
BrushTexture(brush, tex2, 0, 1)

PaintSurface(surf1, brush)

FreeBrush(brush)

Local t_blend% = 2 ' set tex env mode
Select t_blend
	Case 1
		TextureglTexEnv(tex1,GL_TEXTURE_ENV, GL_TEXTURE_ENV_MODE, GL_DECAL)
		TextureglTexEnv(tex2,GL_TEXTURE_ENV, GL_TEXTURE_ENV_MODE, GL_MODULATE)
	Case 2 ' equivalent to case 1
		TextureBlend(tex1,1)
		TextureBlend(tex2,2)
	Default
		BrushGLBlendFunc(surf1.brush, GL_SRC_ALPHA, GL_ONE) ' Additive
EndSelect

'EndRem


' Main loop
While Not KeyDown(KEY_ESCAPE)
	RenderWorld()
	Flip()
Wend
End
</textarea> <br><br></td></tr></table><br>
<a name="1286526"></a>

<a name="1286543"></a>

<a name="1286544"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#105">[#105]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm I'm still having some problems with BrushGLBlendFunc.<br>Try for example GL_DST_COLOR, GL_SRC_ALPHA which should look like this:<br><br><img src="http://puu.sh/m9lwK/12acb09d71.jpg"><br><br>But looks like this:<br><br><img src="http://puu.sh/m9snM/0d560e25f1.jpg"><br><br>Everything ALMOST works, but it seems the background messes up all the time for some reason. <br><br></td></tr></table><br>
<a name="1286589"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#106">[#106]</a></td></tr></table></td></tr><tr ><td class="posttext"> You need to set the glColor to 0 for that mode to work, it defaults to 1. I also was able to get the same mode with glTexEnv but I don't really understand it. Changes below.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">SuperStrict
Framework openb3d.B3dglgraphics
Graphics3D 800,600,0,2

Local camera:TCamera = CreateCamera()
Local light:TLight = CreateLight()
Local plane1:TMesh = CreateQuad()
PositionEntity plane1, 0, 0, 1.35

Local surf1:TSurface = GetSurface(plane1, 1)


'======================================
'== Demonstration of what I expected ==
' This is what I want to happen
Rem
Local plane2:TMesh = CreateQuad()
PositionEntity plane2, 0, 0, 1.35

Local surf2:TSurface = GetSurface(plane2, 1)

Local brush1:TBrush = LoadBrush("flamingos.png")
Local brush2:TBrush = LoadBrush("flamingobg.jpg")

PaintSurface(surf1, brush1)
PaintSurface(surf2, brush2)

BrushBlend(surf1.brush, 3)
EndRem


'===============
'== Attempt 1 ==
' First attempt is to create two surfaces with the top one being additive
' This is the way I want to do it
'Rem
Local plane2:TMesh = CreateQuad()
PositionEntity plane2, 0, 0, 1.35

Local surf2:TSurface = GetSurface(plane2, 1)

Local brush1:TBrush = LoadBrush("flamingos.png")
Local brush2:TBrush = LoadBrush("flamingobg.jpg")

PaintSurface(surf1, brush1)
PaintSurface(surf2, brush2)

Local t_blend% = 2 ' set blend mode
Select t_blend
	Case 1 ' additive
		BrushGLBlendFunc(surf1.brush, GL_SRC_ALPHA, GL_ONE)
		BrushGLColor(surf1.brush,1,1,1,1)
		BrushFX(surf1.brush, 32)
	Case 2 ' replace
		BrushGLBlendFunc(surf1.brush, GL_DST_COLOR, GL_SRC_ALPHA)
		BrushGLColor(surf1.brush,0,0,0,1)
		BrushFX(surf1.brush,32)
EndSelect
'EndRem


'===============
'== Attempt 2 ==
' Second attempt was to just use a multi textured surface
' This would be nice but I'd like BrushGLBlendFunc()
Rem
Local tex1:TTexture = LoadTexture("flamingos.png")
Local tex2:TTexture = LoadTexture("flamingobg.jpg")

Local brush:TBrush = CreateBrush()
BrushTexture(brush, tex1, 0, 0)
BrushTexture(brush, tex2, 0, 1)

PaintSurface(surf1, brush)

FreeBrush(brush)

Local t_blend% = 3 ' set tex env mode
Select t_blend
	Case 1 ' multiply
		TextureglTexEnv(tex1, GL_TEXTURE_ENV, GL_TEXTURE_ENV_MODE, GL_DECAL)
		TextureglTexEnv(tex2, GL_TEXTURE_ENV, GL_TEXTURE_ENV_MODE, GL_MODULATE)
		BrushFX(surf1.brush,32)
	Case 2 ' equivalent to case 1
		TextureBlend(tex1,1)
		TextureBlend(tex2,2)
	Case 3 ' replace
		'TextureglTexEnv(tex1, GL_TEXTURE_ENV, GL_TEXTURE_ENV_MODE, GL_REPLACE)
		TextureglTexEnv(tex2, GL_TEXTURE_ENV, GL_TEXTURE_ENV_MODE, GL_DECAL)
		BrushFX(surf1.brush,32)
	Default
		BrushGLBlendFunc(surf1.brush, GL_SRC_ALPHA, GL_ONE) ' Additive
EndSelect

EndRem


' Main loop
While Not KeyDown(KEY_ESCAPE)
	RenderWorld()
	Flip()
Wend
End
</textarea> <br><br></td></tr></table><br>
<a name="1286593"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#107">[#107]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ah cool, I'll do some experimenting with this.<br>Thanks a bunch!<br><br>Btw. why doesn't .copy() from TSurface return a copy of the surface? <br><br></td></tr></table><br>
<a name="1286643"></a>

<a name="1286644"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#108">[#108]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay. As far as I tested (just a valid instance), the surface.copy() method works. <br><br></td></tr></table><br>
<a name="1286655"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#109">[#109]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm I'm trying to copy a surface to another mesh, but no matter what I do it ends up being different (odd vert positions) than the original.<br>100% sure it's my fault though.<br>There's no function for something like that, is there? <br><br></td></tr></table><br>
<a name="1286749"></a>

<a name="1287426"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#110">[#110]</a></td></tr></table></td></tr><tr ><td class="posttext"> I tried out a proper surface.copy and you're right it's not working but I wonder how you got any results since the copied surface needs to be added to the mesh surf_list before it works. The code that works in minib3d max2d.bmx is:<br><pre class=code>Local teapot1:TMesh=LoadMesh("../media/teapot.b3d")
Local surf:TSurface=GetSurface(teapot1,1)
Local surf2:TSurface=surf.copy()
Local teapot:TMesh=CreateMesh()
ListAddLast teapot.surf_list,surf2</pre><br><br>I need an equivalent to ListAddLast which will be ListPushBack teapot.surf_list,surf2[,teapot]. I will also internalize CopyList.<br><br>About BrushGLBlendFunc. I've been testing with <a href="http://www.andersriggelsen.dk/glblendfunc.php" target="_blank">THIS</a> and can see the results are different. I added the same function to minib3d and got the same results so it's not really a bug although I don't understand why it works so differently, but I will see how many blend modes I can get. <br><br></td></tr></table><br>
<a name="1287425"></a>

<a name="1287427"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#111">[#111]</a></td></tr></table></td></tr><tr ><td class="posttext"> I had a few bugs to fix but have got it working! I just need to internalize copylist now.<br><br>I improved the copylist c++ code, it needed to loop through all items to reset the counter which might cause trouble if anything other than a full copy is done, so now you can break out of a loop since the counter is a global and gets reset in the size functions.<br><br>I have listpushback working tested on child_list and surf_list. I've tested some lists but not all, I'll need to do that. I should have an update soon. :) <br><br></td></tr></table><br>
<a name="1287432"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#112">[#112]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wow, awesome munch!!<br>Is it possible to get a CopySurface(surface,toMesh) function of some sort?<br><br>Thanks for your hard work. <br><br></td></tr></table><br>
<a name="1287443"></a>

<a name="1287445"></a>

<a name="1287446"></a>

<a name="1287447"></a>

<a name="1287448"></a>

<a name="1287449"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#113">[#113]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Hezkore. Your feedback has been great by the way, it's really pushed the progress forward so thanks. It's really getting to a stable stage now.<br><br>Yes, I see why CopySurface is nice. Looking at the types with copy methods, it would be nice to have CopyBrush too.<br><br>Edit: oh wait, I think I know what you mean now, like this:<br><pre class=code>Local teapot:TMesh=LoadMesh("../media/teapot.b3d")
Local surf:TSurface=GetSurface(teapot,1)
...
Local teapot2:TMesh=CreateMesh()
Local surf2:TSurface=CopySurface(surf,teapot2)
...instead of...
Local surf2:TSurface=surf.copy()
Local teapot2:TMesh=CreateMesh()
ListPushBack teapot2.surf_list,surf2,teapot2</pre><br><br>I had a bit of trouble with getting these lists working nicely, first I had to discover that in c++ I was forgetting to use a break after a nested switch case (causing code to 'break' he he), then I forgot to reset the global list index in some size functions, and then I missed that I shouldn't call ClearList after a Super.CopyList in CopyList. Those things cost me several hours of wasted time! <br><br></td></tr></table><br>
<a name="1287495"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#114">[#114]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah the engine/wrapper is turning out great!<br>And I'm glad to know I'm helping, I wasn't sure if I was helping or just in the way by bugging you about every little thing I find hehe.<br><br>I've been hoping this project wouldn't get abandoned like all other 3D engine projects.<br>And all your hard work (and angros of course!) has really shown that you guys are dedicated to finishing up this engine!<br><br>I'm slowly but surely trying out everything I need to get a game going in this engine.<br>Atm. I'm making sure that I can get some decent levels loaded into it.<br>Next step is to get animated models loaded, and that step has gotten me a bit worried.<br>I know there are no plans to support loading other model file formats, but do you guys have any suggestions on how I could get animated models from Maya into this engine?<br>I've been asking this a lot but I still haven't managed to get it fully working.<br><br>And yes, the CopySurface example is exactly what I had in mind. :) <br><br></td></tr></table><br>
<a name="1287534"></a>

<a name="1287535"></a>

<a name="1287541"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Krischan</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#115">[#115]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've reviewed the current version yesterday - it looks very nice at the current stage but I have two issues with the Geosphere in which I'm most interested for my space game, but first an impressive shot with a 2048 pixel wide height/colormap at close distance:<br><br><img src="http://www.christianhart.de/bmax/openb3d/geosphere1.jpg"><br><br>Now to the problems:<br><br>1. there is a clear UV glitch in the texture mapping, see screenshot. The heightmap has the same problem, <a href="http://www.christianhart.de/bmax/openb3d/starkillerbase.jpg" target="_blank">looks like the Starkiller base</a> in the new Star Wars movie. Use these two textures and this nearly vanilla code to check it yourself: <a href="http://www.christianhart.de/bmax/openb3d/hm.jpg" target="_blank">hm.jpg</a>  <a href="http://www.christianhart.de/bmax/openb3d/cm.jpg" target="_blank">cm.jpg</a><br><br><img src="http://www.christianhart.de/bmax/openb3d/geosphere2.jpg"><br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">' geosphere.bmx
' freebasic.net/forum/viewtopic.php?p=198556#p198556

Strict

Framework Openb3d.B3dglgraphics

Graphics3D 800,600,0,2


Local camera:TCamera=CreateCamera()
CameraRange camera,0.00001,100
MoveEntity camera,0,0,-23

Local x:TTerrain = LoadGeosphere("media/hm.jpg") ' heightmap
'Local x:TTerrain=CreateGeosphere(2700)
ScaleEntity x,0.01,0.01,0.01

Local light:TLight=CreateLight()
MoveEntity light,10,10,10
PointEntity light,x

Local tex:TTexture = LoadTexture("media/cm.jpg") ' colormap
Local mapheight:Int = 1024
ScaleTexture tex,mapheight,mapheight
EntityTexture x,tex

EntityPickMode x,2
Local sphere:TMesh=CreateSphere()
ScaleEntity sphere,0.1,0.1,0.1
EntityColor sphere,255,0,0

EntityType camera,1
EntityRadius camera,0.03
EntityType x,2
Collisions 1, 2, 2, 2 ' set collisons: 2 = elipsoid-polygon method, 2 = full-slide reponse

RotateEntity x,0,90,90

Local wiretoggle%=-1


While Not KeyDown(KEY_ESCAPE)

	' zoom
	If KeyDown(KEY_A) Then MoveEntity camera,0,0,0.08
	If KeyDown(KEY_Z) Then MoveEntity camera,0,0,-0.08
	
	' move camera
	If KeyDown(KEY_UP) Then TurnEntity camera,-0.5,0,0,0
	If KeyDown(KEY_DOWN) Then TurnEntity camera,0.5,0,0,0
	If KeyDown(KEY_LEFT) Then TurnEntity camera,0,0.5,0,0
	If KeyDown(KEY_RIGHT) Then TurnEntity camera,0,-0.5,0,0
	
	' spin geosphere
	If KeyDown(KEY_SPACE) Then TurnEntity x,0,0.5,0
	
	' wireframe
	If KeyHit(KEY_W) Then wiretoggle=-wiretoggle
	If wiretoggle=1 Then Wireframe True Else Wireframe False
	
	CameraPick camera,MouseX(),MouseY()
	PositionEntity sphere,PickedX(),PickedY(),PickedZ()
	
	UpdateWorld 1
	RenderWorld
	
	Text 0,0,"A/Z: zoom, Arrows: move camera, Space: spin geo, W: wireframe"
	Text 0,20,"x = "+EntityX(camera)+" y = "+EntityY(camera)+" z = "+EntityZ(camera)

	Flip

Wend</textarea><br><br>2. Would it be possible to use a Cubemap Cross instead of a Spheremap? As you know, a Spheremap has pinched poles, lesser information and it's hard to subdivide with detail noise to get a really detailed planet. Without cubemaps the use of geospheres is very limited if you want high quality subdivided planets.<br><br><img src="http://www.christianhart.de/bmax/openb3d/geosphere3.jpg"><br><br>By the way, my new planet generation algorithm <a href="http://www.christianhart.de/bmax/openb3d/cubemap1.jpg" target="_blank">creates cube heightmap gems like this one</a> in a few seconds :-) The two spheremaps above were generated out of this one and in a cube colormap <a href="http://www.christianhart.de/bmax/openb3d/cubemap2.jpg" target="_blank">it would look like this one</a> (with a small stiching problem I couldn't figure out yet). <br><br></td></tr></table><br>
<a name="1287929"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#116">[#116]</a></td></tr></table></td></tr><tr ><td class="posttext"> Internally geosphere.cpp doesn't use a sphere map or a cube map; it uses a format called TOAST projection (Tessellated Octahedral Adaptive Subdivision Transform); I got the idea from here:<br><br><a href="http://www.worldwidetelescope.org/docs/worldwidetelescopeprojectionreference.html" target="_blank">http://www.worldwidetelescope.org/docs/worldwidetelescopeprojectionreference.html</a><br><br>The map should be like this one:<br><img src="http://wwtweb.blob.core.windows.net/docs/images/ToastMapOfEarth.jpg"><br><br>Unfortunately, how many heightmap can you find in this format? About 0. Either you create your one, or use another solution, since most heightmaps are distributed as equirectangular projections. So, I chose to use equirectangular format, and I added a simple routine that convert the height map into a TOAST projection when it is loaded. There are other ways to project a sphere map (i.e. Mercator), but they all have some flaws (i.e. in a Mercator map poles cannot be represented); equirectangular is the simplest one, and it has already been used in OpenB3D (and even in original Blitz3D) to texture spheres.<br><br>Also, a cubemap cross is the worst way to store a texture or an heightmap: an image file is always a rectangle, and look at the example you posted: you have 6 faces at a resolution 1024*1024 (total=6291456 pixels) and your image is  4096*3072 (total=12582912 pixels): it uses exactly twice the memory (and a planetary map can be a BIG image, you aren't allowed to store it in an inefficient way).<br><br>Also, cubemaps used with LoadTexture command are not stored as crosses, but as strips, so it would not be consistent. IMHO, you should modify your algorithm to output equirectangular images (or, if you are feeling brave, you could try to directly output a TOAST projection and directly store it inside the geosphere class)<br><br>The glitch happens because on a TOAST projection this line coincide with map border; I always considered it a minor glitch, because I ran all my tests using an earth map, and on earth that line fell in the ocean. I'll see if I can fix it. <br><br></td></tr></table><br>
<a name="1288057"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Krischan</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#117">[#117]</a></td></tr></table></td></tr><tr ><td class="posttext"> I never saw this projection before, interesting. And yes, I know that the cubemap cross is suboptimal, my generator puts out 6 separate textures but in a cross you can view them better and get an idea how the planet looks like - internally I can make whatever I want with them. A cubemap cross always contains six quadratic textures. But I'll still prefer a cubemap over other projection styles as it still stores the most information by a minimal cost of distortion as far as I know and you can manipulate it very easy as its - quadratic/cubic! Forget about spherical projections, I only use them for small survey maps calculated from the cubemap information.<br><br>So please add cubemap support for your geospheres. I would like to create something like this with it:<br><br><iframe width="560" height="345" src="http://www.youtube.com/embed/rL8zDgTlXso" frameborder="0" allowfullscreen></iframe> <br><br></td></tr></table><br>
<a name="1288064"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#118">[#118]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Angros, I think it would be *really* cool if OpenB3d supported back to OpenGL 1.4. Have you any interest in this?<br><br>I have two old MacBooks that are limited to 1.4 and I would love to run OpenB3d on them. Here is a <a href="http://www.gamedev.net/topic/514368-shaders-with-opengl-14/" target="_blank">thread</a> discussing it. <br><br></td></tr></table><br>
<a name="1288168"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#119">[#119]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Krischan<br>To achieve a LOD spherical terrain there are two possible approaches: one is the geodesic sphere, the other is the quadrilateralized spherical cube.<br><br>In a quadrilateralized spherical cube, you start from a cube, subdivide it into 12 right triangles, and recursively split each triangle in two other right triangles (the same algorithm used in regular terrains).<br><br>In a geodesic sphere, you start from a platonic solid (usually an icosahedron, but a tetrahedron or an octahedron are just as good), subdivide it into 4, 8, 20 equilateral triangles, and then recursively split each triangle into four equilateral triangles.<br><br>Internally, OpenB3D uses the geodesic sphere (shortened in GeoSphere) approach, because I find it to be the best solution to avoid cracks (with no need to use skirts or other "dirty" tricks)<br><br>In quadrilateralized spherical cube, a cubemap would be the best solution to store the textures; in a geosphere, the best solution is to use a texture tailored for the starting platonic solid; for an icosahedron, it would be something like:<br><br><img src="http://www.fracterra.com/icos.jpg"><br><br>since it's still suboptimal, I looked for alternatives: as I've said, there is no need to start with an icosahedron, any platonic solid will work, and an octahedron is easier to texture: the top of the octahedron can be projected to a square, the bottom can be mapped to four right triangles (with just a slight distortion)... and all the geosphere can be mapped on a single, square picture (hence the TOAST projection).<br><br>Since, as I've said, you can't find many maps in this format, the loader must convert the map from a more common format; which one? Well, have a look on wikipedia:<br><br><a href="https://en.wikipedia.org/wiki/List_of_map_projections" target="_blank">https://en.wikipedia.org/wiki/List_of_map_projections</a><br><br>There are about 80 different formats, and each one has advantages and disadvantages.<br><br>To be able to load other formats a converter to TOAST would be needed... something like this:<br><br><a href="http://jonaszeitler.se/cubemap-toastmap-generator/" target="_blank">http://jonaszeitler.se/cubemap-toastmap-generator/</a><br><br>I don't think it's a good idea to put in into the library... but it could be an extension.<br><br>@munch<br>What do you mean? OpenGL 1.4 uses fixed function pipeline, and OpenB3D should work perfectly on it, as long as you don't use custom shaders.<br><br>In the thread you linked, they said that shader support in 1.4 is an extension, so it's not official: it means that different implementations might support different features, so your shader might work perfectly on a computer, and crash on another (even if it still has version 1.4).<br><br>Even worse, most of the GLSL features in 1.4 are deprecated (like the gl_Vertex, gl_Color attributes), so you'd have to rewrite most of your program anyway.<br><br>And shaders are not like multitexturing, that just didn't work on some version, without harm (if you try to use a multi-texture mesh with a very old driver version, you will see only the first texture, but the program still run); with shaders, if you dare to use even one feature on a driver not supporting it, the whole program crashes (or becomes unusable). <br><br></td></tr></table><br>
<a name="1288276"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Thareh</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#120">[#120]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nice stuff, I'm currently having some fun playing around with this! :)<br><br>One thing I can't get to work is playing an animation backwards though (with negative speed), is this broken or am I doing something wrong? =P<br><br>Thanks! <br><br></td></tr></table><br>
<a name="1288286"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#121">[#121]</a></td></tr></table></td></tr><tr ><td class="posttext"> It works here in the examples for b3d and md2. Are you using SetAnimTime? <br><br></td></tr></table><br>
<a name="1288290"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#122">[#122]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I know there are no plans to support loading other model file formats, but do you guys have any suggestions on how I could get animated models from Maya into this engine? <br></div><br>Googling this it seems there are two ways: <br>Use Maya 8.5 and the <a href="/posts.php?topic=82668" target="_blank">Maya Blitz3D Exporter v2</a><br>Or I think the best bet, to export to FBX (v 2010) and use FragMotion to export b3d as in <a href="http://irrlicht3d.org/wiki/index.php?n=Main.B3d" target="_blank">Irrlicht Engine</a>. <br>Milkshape3d also support FBX but not sure if it has fbx 2010. <br><br></td></tr></table><br>
<a name="1288293"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#123">[#123]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ah! I haven't tried the FragMotion way before, I'll give that a go.<br>Thanks!<br><br>Any news about the CopySurface function? <br><br></td></tr></table><br>
<a name="1288295"></a>

<a name="1288296"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Thareh</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#124">[#124]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> It works here in the examples for b3d and md2. Are you using SetAnimTime? <br></div><br>Alright, nope I'm using the Animate command - it works very well playing the animation in a normal fashion but backwards the animation just freezes =P<br><br>Should I stop using the Animate command and start using SetAnimTime instead?<br><br>Thanks,<br>-- Thareh <br><br></td></tr></table><br>
<a name="1288324"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Krischan</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#125">[#125]</a></td></tr></table></td></tr><tr ><td class="posttext"> Angros, my Planet Generator currently works like this:<br><br>- Load 2-3 alpha faded Heightmaps with Craters, Hills, Cracks etc. as Textures<br>- Place a few hundred Sprites spherical around the Camera, pointing to it<br>- The sprites are textured and scaled randomly and blended to overlap<br>- With a certain amount of Sprites, a detailed Planet Surface "forms"<br>- Grab six Camera views: Front, Right, Back, Left, Top, Bottom with FoV=90<br>- Normalize the greyscale values to 0...255 = Heightmap<br>- Apply a color gradiant to the six images using the height information = Colormap<br>- Optional: calculate a Spheremap out of the 6 Heightmaps<br>- Optional: calculate a Normalmap out of the 6 Heightmaps<br>- Optional: Emboss the Colormap / Spheremap = polish<br><br>This method has the disadvantage that you can't zoom in very much as I always have only 256 height steps and the detail depends on the resolution of the source heightmaps. But... the speed is priceless. I can create a detailed Planet Texture like above (2048x1024 from 6x512x512 sides) in 750ms without any shader support. I tried many methods to achieve results like that but they were either too slow or too complex (with GPU shaders I don't understand right now). And I want to avoid additional Layers of complexity. Well, for a CLOD planet like in the video above I must subdivide or mix the cubefaces with Simplex Noise to get more details when approaching the surface.<br><br>So my base/source are six Cube-Height-Maps. How would you achieve this? <br><br></td></tr></table><br>
<a name="1288329"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#126">[#126]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hezkore, yes I have CopySurface working, it's just surf.copy and then listpushback. I'm currently stuck on internalizing copylist, I need an addlist for optimizing performance. <br><br></td></tr></table><br>
<a name="1288336"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Thareh</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#127">[#127]</a></td></tr></table></td></tr><tr ><td class="posttext"> I tried the included "zombie.b3d" now as well, and backwards animation doesn't work with that either =P and also I don't think the "transition" parameter works as intended on the Animation command as well, it's supposed to smooth the transition between the last frame and the first frame when looping the animation if I understand it correctly? Right now it just creates a delay before the first frame the first time the animation runs =P<br><br>Perhaps this is just on my computer?<br><br>Thanks,<br>-- Thareh <br><br></td></tr></table><br>
<a name="1288426"></a>

<a name="1288427"></a>

<a name="1288549"></a>

<a name="1288550"></a>

<a name="1288556"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#128">[#128]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is there any way to rotate a clamped texture around its center instead of top left?<br>What I've done is used VertexTexCoords and offset U and V with -0.5<br>And then with PositionTexture I've done done +0.5<br>Which works with textures that aren't clamped.<br>But with a clamped texture I just get a blurry mess.<br><br>UPDARTE: Managed to get it working.<br>But now to another question...<br>Is it possible to set a Texture brightness/color?<br><br>And another question.<br>Is it possible to change a texture in a brush realtime?<br>I've loaded about 6 or so textures, and I've painted a mesh with a brush and I'd like to switch out texture[0] in the brush to one of the 6 textures I've loaded. <br><br></td></tr></table><br>
<a name="1288558"></a>

<a name="1288559"></a>

<a name="1288560"></a>

<a name="1288562"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#129">[#129]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've made an example of my brush texture switching issue I mentioned above - <a href="https://dl.dropboxusercontent.com/u/2842751/textest.zip" target="_blank">textest.zip</a><br>Pressing Key 1 switches to the first texture, while pressing 2 or 3 switches to the second texture.<br>It seems to register that the texture is switched (since it doesn't scroll anymore) but the image isn't updated.<br>The method I've used for Key 3 works with MiniB3D. <br><br></td></tr></table><br>
<a name="1288813"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#130">[#130]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here is the patched version of Geosphere.cpp. It should fix both the texturing issue and the "Starkiller" bug. I have to do some more tests.<br><br><pre class=code>
/*
 *  geosphere.cpp
 *  openb3d
 *
 *
 */

#ifdef linux
#define GL_GLEXT_PROTOTYPES
#include &lt;GL/gl.h&gt;
#include &lt;GL/glext.h&gt;
#endif

#ifdef WIN32
#include &lt;gl\GLee.h&gt;
#endif

#ifdef __APPLE__
#include "GLee.h"
#endif


#include "global.h"
#include "entity.h"
#include "camera.h"
#include "brush.h"
#include "geosphere.h"
#include "pick.h"


#include "stb_image.h"
#include "string_helper.h"
#include "file.h"
#include "tree.h"


static Line Ray;
static float radius;

static vector&lt;float&gt; vertices;


Geosphere* Geosphere::CopyEntity(Entity* parent_ent){

	// new terr
	Geosphere* geo=new Geosphere;

	// copy contents of child list before adding parent
	list&lt;Entity*&gt;::iterator it;
	for(it=child_list.begin();it!=child_list.end();it++){
		Entity* ent=*it;
		ent-&gt;CopyEntity(geo);
	}

	// lists

	// add parent, add to list
	geo-&gt;AddParent(*parent_ent);
	entity_list.push_back(geo);

	// add to collision entity list
	if(collision_type!=0){
		CollisionPair::ent_lists[collision_type].push_back(geo);
	}

	// add to pick entity list
	if(pick_mode){
		Pick::ent_list.push_back(geo);
	}

	// update matrix
	if(geo-&gt;parent){
		geo-&gt;mat.Overwrite(geo-&gt;parent-&gt;mat);
	}else{
		geo-&gt;mat.LoadIdentity();
	}

	// copy entity info

	geo-&gt;mat.Multiply(mat);

	geo-&gt;px=px;
	geo-&gt;py=py;
	geo-&gt;pz=pz;
	geo-&gt;sx=sx;
	geo-&gt;sy=sy;
	geo-&gt;sz=sz;
	geo-&gt;rx=rx;
	geo-&gt;ry=ry;
	geo-&gt;rz=rz;
	geo-&gt;qw=qw;
	geo-&gt;qx=qx;
	geo-&gt;qy=qy;
	geo-&gt;qz=qz;

	geo-&gt;name=name;
	geo-&gt;class_name=class_name;
	geo-&gt;order=order;
	geo-&gt;hide=false;

	geo-&gt;cull_radius=cull_radius;
	geo-&gt;radius_x=radius_x;
	geo-&gt;radius_y=radius_y;
	geo-&gt;box_x=box_x;
	geo-&gt;box_y=box_y;
	geo-&gt;box_z=box_z;
	geo-&gt;box_w=box_w;
	geo-&gt;box_h=box_h;
	geo-&gt;box_d=box_d;
	geo-&gt;collision_type=collision_type;
	geo-&gt;pick_mode=pick_mode;
	geo-&gt;obscurer=obscurer;

	//copy terrain info
	geo-&gt;brush=brush;

	geo-&gt;ShaderMat=ShaderMat;
	//geo-&gt;EqToToast=0;


	geo-&gt;size=size;
	geo-&gt;vsize=vsize;
	geo-&gt;hsize=hsize;
	for (int i = 0; i&lt;= ROAM_LMAX+1; i++){
		geo-&gt;level2dzsize[i] = level2dzsize[i];
	}
	int tsize=size;
	geo-&gt;height=new float[(tsize+1)*(tsize+1)];
	for (int i = 0; i&lt;= (tsize+1)*(tsize+1); i++){
		geo-&gt;height[i]=height[i];
	}
	geo-&gt;NormalsMap=new float[(tsize+1)*(tsize+1)*5];
	for (int i = 0; i&lt;= (tsize+1)*(tsize+1)*5; i++){
		geo-&gt;NormalsMap[i]=NormalsMap[i];
	}

	mesh_info=C_NewMeshInfo();
	geo-&gt;c_col_tree=C_CreateColTree(mesh_info);
	C_DeleteMeshInfo(mesh_info);

	terrain_list.push_back(geo);


	return geo;

}

Geosphere* Geosphere::CreateGeosphere(int tsize, Entity* parent_ent){

	Geosphere* geo=new Geosphere;

	for (int i = 0; i&lt;= ROAM_LMAX; i++){
		geo-&gt;level2dzsize[i] = 0;
	}
        int lmax=(int)(log(tsize)/log(2)-3.0);
	if (lmax&gt;=ROAM_LMAX) lmax=ROAM_LMAX;


	const float LOD[20]={1700000,800000,40000,10000,5000,1000,200,10,1,0.1,0.005,
	0.001,0.0005,0.0002,0.0001,0.00005,0.00002,0.00001,0.000005,0.000002};

	for (int i = 0; i&lt;= lmax; i++){
		geo-&gt;level2dzsize[i] = tsize*LOD[i];/*1000000000.0*(float)pow((float)tsize/8192 / sqrt((float)(1 &lt;&lt; i)),2);	// &lt;-------------terrain detail here*/
	}

	geo-&gt;ShaderMat=Global::ambient_shader;
	//geo-&gt;EqToToast=0;

	//terr-&gt;brush=new brush;
	mesh_info=C_NewMeshInfo();
	geo-&gt;c_col_tree=C_CreateColTree(mesh_info);
	C_DeleteMeshInfo(mesh_info);
	geo-&gt;AddParent(*parent_ent);
	terrain_list.push_back(geo);
	if (tsize!=0){
		geo-&gt;size=tsize/2;
		geo-&gt;hsize=tsize/4;

		geo-&gt;vsize=.05;
		geo-&gt;height=new float[(tsize+1)*(tsize+1)];
		geo-&gt;NormalsMap=new float[(tsize+1)*(tsize+1)*5];

		geo-&gt;EquirectangularToTOAST();

	}

	return geo;

}

void Geosphere::UpdateTerrain(){

	glBindBuffer(GL_ARRAY_BUFFER,0);

	RecreateGeoROAM();

	glDisable(GL_ALPHA_TEST);

	if (order!=0){
		glDisable(GL_DEPTH_TEST);
		glDepthMask(GL_FALSE);
	}else{
		glEnable(GL_DEPTH_TEST);
		glDepthMask(GL_TRUE);
	}

	switch(brush.blend){
		case 0:
			glBlendFunc(GL_SRC_ALPHA,GL_ONE_MINUS_SRC_ALPHA); // alpha
			break;
		case 1:
			glBlendFunc(GL_SRC_ALPHA,GL_ONE_MINUS_SRC_ALPHA); // alpha
			break;
		case 2:
			glBlendFunc(GL_DST_COLOR,GL_ZERO); // multiply
			break;
		case 3:
			glBlendFunc(GL_SRC_ALPHA,GL_ONE); // additive and alpha
			break;
		}

	float ambient_red,ambient_green,ambient_blue;

	// fx flag 1 - full bright ***todo*** disable all lights?
	if (brush.fx &amp; 1){
		if(Global::fx1!=true){
			Global::fx1=true;
			glDisableClientState(GL_NORMAL_ARRAY);
		}
		ambient_red  =1.0;
		ambient_green=1.0;
		ambient_blue =1.0;
	}else{
		if(Global::fx1!=false){
			Global::fx1=false;
			glEnableClientState(GL_NORMAL_ARRAY);
		}
		ambient_red  =Global::ambient_red;
		ambient_green=Global::ambient_green;
		ambient_blue =Global::ambient_blue;
	}

	// fx flag 2 - vertex colours
	/*if(brush.fx&amp;2){

			glEnable(GL_COLOR_MATERIAL);
	}else{
			glDisable(GL_COLOR_MATERIAL);
	}*/
	if(Global::fx2!=false){
		Global::fx2=false;
		glDisableClientState(GL_COLOR_ARRAY);
		glDisable(GL_COLOR_MATERIAL);
	}


	// fx flag 4 - flatshaded
	if(brush.fx&amp;4){
		glShadeModel(GL_FLAT);
	}else{
		glShadeModel(GL_SMOOTH);
	}

	// fx flag 8 - disable fog
	if(brush.fx&amp;8){
		if(Global::fog_enabled==true){ // only disable if fog enabled in camera update
			glDisable(GL_FOG);
		}
	}

	// fx flag 16 - disable backface culling
	if(brush.fx&amp;16){
		glDisable(GL_CULL_FACE);
	}else{
		glEnable(GL_CULL_FACE);
	}

	// light + material color

	float ambient[]={ambient_red,ambient_green,ambient_blue};
	glLightModelfv(GL_LIGHT_MODEL_AMBIENT,ambient);

	float mat_ambient[]={brush.red,brush.green,brush.blue,brush.alpha};
	float mat_diffuse[]={brush.red,brush.green,brush.blue,brush.alpha};
	float mat_specular[]={brush.shine,brush.shine,brush.shine,brush.shine};
	float mat_shininess[]={100.0}; // upto 128

	glMaterialfv(GL_FRONT_AND_BACK,GL_AMBIENT,mat_ambient);
	glMaterialfv(GL_FRONT_AND_BACK,GL_DIFFUSE,mat_diffuse);
	glMaterialfv(GL_FRONT_AND_BACK,GL_SPECULAR,mat_specular);
	glMaterialfv(GL_FRONT_AND_BACK,GL_SHININESS,mat_shininess);

	// textures

	int tex_count=0;

	if(ShaderMat!=NULL){
		ShaderMat-&gt;TurnOn(mat, 0, &amp;vertices);
	}

	tex_count=brush.no_texs;

	int DisableCubeSphereMapping=0;
	for(int ix=0;ix&lt;tex_count;ix++){

		if(brush.tex[ix]){

			// Main brush texture takes precedent over surface brush texture
			unsigned int texture=0;
			int tex_flags=0,tex_blend=0;
			float tex_u_scale=1.0,tex_v_scale=1.0,tex_u_pos=0.0,tex_v_pos=0.0,tex_ang=0.0;
			int tex_cube_mode=0;


			texture=brush.cache_frame[ix];
			tex_flags=brush.tex[ix]-&gt;flags;
			tex_blend=brush.tex[ix]-&gt;blend;
			//tex_coords=brush.tex[ix]-&gt;coords;
			tex_u_scale=brush.tex[ix]-&gt;u_scale;
			tex_v_scale=brush.tex[ix]-&gt;v_scale;
			tex_u_pos=brush.tex[ix]-&gt;u_pos;
			tex_v_pos=brush.tex[ix]-&gt;v_pos;
			tex_ang=brush.tex[ix]-&gt;angle;
			tex_cube_mode=brush.tex[ix]-&gt;cube_mode;
			//frame=brush.tex_frame;

			glActiveTexture(GL_TEXTURE0+ix);
			glClientActiveTexture(GL_TEXTURE0+ix);

			glEnable(GL_TEXTURE_2D);
			glBindTexture(GL_TEXTURE_2D,texture); // call before glTexParameteri

			// masked texture flag
			if(tex_flags&amp;4){
				glEnable(GL_ALPHA_TEST);
			}else{
				glDisable(GL_ALPHA_TEST);
			}

			// mipmapping texture flag
			if(tex_flags&amp;8){
				glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MAG_FILTER,GL_LINEAR);
				glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MIN_FILTER,GL_LINEAR_MIPMAP_LINEAR);
			}else{
				glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MAG_FILTER,GL_LINEAR);
				glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MIN_FILTER,GL_LINEAR);
			}

			// clamp u flag
			if(tex_flags&amp;16){
				glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_WRAP_S,GL_CLAMP_TO_EDGE);
			}else{
				glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_WRAP_S,GL_REPEAT);
			}

			// clamp v flag
			if(tex_flags&amp;32){
				glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_WRAP_T,GL_CLAMP_TO_EDGE);
			}else{
				glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_WRAP_T,GL_REPEAT);
			}

				// ***!ES***

			// spherical environment map texture flag
			if(tex_flags&amp;64){
				glTexGeni(GL_S,GL_TEXTURE_GEN_MODE,GL_SPHERE_MAP);
				glTexGeni(GL_T,GL_TEXTURE_GEN_MODE,GL_SPHERE_MAP);
				glEnable(GL_TEXTURE_GEN_S);
				glEnable(GL_TEXTURE_GEN_T);
				DisableCubeSphereMapping=1;
			}/*else{
				glDisable(GL_TEXTURE_GEN_S);
				glDisable(GL_TEXTURE_GEN_T);
			}*/

				// cubic environment map texture flag
				if(tex_flags&amp;128){

					glEnable(GL_TEXTURE_CUBE_MAP);
					glBindTexture(GL_TEXTURE_CUBE_MAP,texture); // call before glTexParameteri

					glTexParameteri(GL_TEXTURE_CUBE_MAP,GL_TEXTURE_WRAP_S,GL_CLAMP_TO_EDGE);
					glTexParameteri(GL_TEXTURE_CUBE_MAP,GL_TEXTURE_WRAP_T,GL_CLAMP_TO_EDGE);
					glTexParameteri(GL_TEXTURE_CUBE_MAP,GL_TEXTURE_WRAP_R,GL_CLAMP_TO_EDGE);
					glTexParameteri(GL_TEXTURE_CUBE_MAP,GL_TEXTURE_MIN_FILTER,GL_NEAREST);
					glTexParameteri(GL_TEXTURE_CUBE_MAP,GL_TEXTURE_MAG_FILTER,GL_NEAREST);

					glEnable(GL_TEXTURE_GEN_S);
					glEnable(GL_TEXTURE_GEN_T);
					glEnable(GL_TEXTURE_GEN_R);
					//glEnable(GL_TEXTURE_GEN_Q)

					if(tex_cube_mode==1){
						glTexGeni(GL_S,GL_TEXTURE_GEN_MODE,GL_REFLECTION_MAP);
						glTexGeni(GL_T,GL_TEXTURE_GEN_MODE,GL_REFLECTION_MAP);
						glTexGeni(GL_R,GL_TEXTURE_GEN_MODE,GL_REFLECTION_MAP);
					}

					if(tex_cube_mode==2){
						glTexGeni(GL_S,GL_TEXTURE_GEN_MODE,GL_NORMAL_MAP);
						glTexGeni(GL_T,GL_TEXTURE_GEN_MODE,GL_NORMAL_MAP);
						glTexGeni(GL_R,GL_TEXTURE_GEN_MODE,GL_NORMAL_MAP);
					}
					DisableCubeSphereMapping=1;

				}else  if (DisableCubeSphereMapping!=0){

					glDisable(GL_TEXTURE_CUBE_MAP);

					// only disable tex gen s and t if sphere mapping isn't using them
					if((tex_flags &amp; 64)==0){
						glDisable(GL_TEXTURE_GEN_S);
						glDisable(GL_TEXTURE_GEN_T);
					}

					glDisable(GL_TEXTURE_GEN_R);
					//glDisable(GL_TEXTURE_GEN_Q)

				}


			switch(tex_blend){
				case 0: glTexEnvf(GL_TEXTURE_ENV,GL_TEXTURE_ENV_MODE,GL_REPLACE);
				break;
				case 1: glTexEnvf(GL_TEXTURE_ENV,GL_TEXTURE_ENV_MODE,GL_DECAL);
				break;
				case 2: glTexEnvf(GL_TEXTURE_ENV,GL_TEXTURE_ENV_MODE,GL_MODULATE);
				//case 2 glTexEnvf(GL_TEXTURE_ENV,GL_COMBINE_RGB_EXT,GL_MODULATE);
				break;
				case 3: glTexEnvf(GL_TEXTURE_ENV,GL_TEXTURE_ENV_MODE,GL_ADD);
				break;
				case 4:
					glTexEnvf(GL_TEXTURE_ENV, GL_TEXTURE_ENV_MODE, GL_COMBINE_EXT);
					glTexEnvf(GL_TEXTURE_ENV, GL_COMBINE_RGB_EXT, GL_DOT3_RGB_EXT);
					break;
				case 5:
					glTexEnvi(GL_TEXTURE_ENV,GL_TEXTURE_ENV_MODE,GL_COMBINE);
					glTexEnvi(GL_TEXTURE_ENV,GL_COMBINE_RGB,GL_MODULATE);
					glTexEnvi(GL_TEXTURE_ENV,GL_RGB_SCALE,2.0);
					break;
				default: glTexEnvf(GL_TEXTURE_ENV,GL_TEXTURE_ENV_MODE,GL_MODULATE);
			}

			glEnableClientState(GL_TEXTURE_COORD_ARRAY);
			glTexCoordPointer(2,GL_FLOAT,32,&amp;vertices[6]);


			// reset texture matrix
			glMatrixMode(GL_TEXTURE);
			glLoadIdentity();

			if(tex_u_pos!=0.0 || tex_v_pos!=0.0){
				glTranslatef(tex_u_pos,tex_v_pos,0.0);
			}
			if(tex_ang!=0.0){
				glRotatef(tex_ang,0.0,0.0,1.0);
			}
			if(tex_u_scale!=1.0 || tex_v_scale!=1.0){
				glScalef(tex_u_scale,tex_v_scale,1.0);
			}

			// ***!ES***
			// if spheremap flag=true then flip tex
			if(tex_flags&amp;64){
				glScalef(1.0,-1.0,-1.0);
			}

			// if cubemap flag=true then manipulate texture matrix so that cubemap is displayed properly
			if(tex_flags&amp;128){

				glScalef(1.0,-1.0,-1.0);

				// get current modelview matrix (set in last camera update)
				float mod_mat[16];
				glGetFloatv(GL_MODELVIEW_MATRIX,&amp;mod_mat[0]);

				// get rotational inverse of current modelview matrix
				Matrix new_mat;
				new_mat.LoadIdentity();

				new_mat.grid[0][0] = mod_mat[0];
				new_mat.grid[1][0] = mod_mat[1];
				new_mat.grid[2][0] = mod_mat[2];

				new_mat.grid[0][1] = mod_mat[4];
				new_mat.grid[1][1] = mod_mat[5];
				new_mat.grid[2][1] = mod_mat[6];

				new_mat.grid[0][2] = mod_mat[8];
				new_mat.grid[1][2] = mod_mat[9];
				new_mat.grid[2][2] = mod_mat[10];

				glMultMatrixf(&amp;new_mat.grid[0][0]);

			}


		}

	}

	// draw tris
	glMatrixMode(GL_MODELVIEW);

	glPushMatrix();
	glMultMatrixf(&amp;mat.grid[0][0]);
	glVertexPointer(3,GL_FLOAT,32,&amp;vertices[0]);
	glNormalPointer(GL_FLOAT,32,&amp;vertices[3]);

	glDrawArrays(GL_TRIANGLES, 0, triangleindex*3);
	glPopMatrix();

	// disable all texture layers
	for(int ix=0;ix&lt;tex_count;ix++){

		glActiveTexture(GL_TEXTURE0+ix);
		glClientActiveTexture(GL_TEXTURE0+ix);

		// reset texture matrix
		glMatrixMode(GL_TEXTURE);
		glLoadIdentity();

		glDisable(GL_TEXTURE_2D);

		// ***!ES***
		if (DisableCubeSphereMapping!=0){
			glDisable(GL_TEXTURE_CUBE_MAP);
			glDisable(GL_TEXTURE_GEN_S);
			glDisable(GL_TEXTURE_GEN_T);
			glDisable(GL_TEXTURE_GEN_R);
			//DisableCubeSphereMapping=0;
		}

	}
	glDisableClientState(GL_TEXTURE_COORD_ARRAY);


	if (brush.fx&amp;8 &amp;&amp; Global::fog_enabled==true){
		glEnable(GL_FOG);
	}

	if(ShaderMat!=NULL){
		ShaderMat-&gt;TurnOff();
	}


}

void Geosphere::RecreateGeoROAM(){

	/*xcf = eyepoint-&gt;EntityX();
	ycf = eyepoint-&gt;EntityY();
	zcf = -eyepoint-&gt;EntityZ();*/

	TFormPoint(eyepoint-&gt;EntityX(true), eyepoint-&gt;EntityY(true), eyepoint-&gt;EntityZ(true), 0, this);
	xcf = tformed_x;
	ycf = tformed_y;
	zcf = -tformed_z;

	//int i;

	float h1= (height[(int)hsize*(int)size+ (int)hsize]*vsize+1)*size;
	float h2= (height[(int) size*(int)size+ (int)hsize]*vsize+1)*size;
	float h3= (height[(int)hsize*(int)size+ (int) size]*vsize+1)*size;
	float h4=-(height[(int)    0*(int)size+ (int)hsize]*vsize+1)*size;
	float h5=-(height[(int)hsize*(int)size]*vsize+1)*size;
	float h6=-(height[0]*vsize+1)*size;


	float v[9][5]={
	{ 0,  h1,  0, hsize, hsize},

	{ h2,  0,  0, size, hsize},
	{ 0,  0,  h3, hsize, size},
	{ h4,  0,  0, 1, hsize},
	{ 0,  0,  h5, hsize, 1},

	{ 0,  h6,  0, size, size},
	{ 0,  h6,  0, 1, size},
	{ 0,  h6,  0, 1, 1},
	{ 0,  h6,  0, size, 1}};



	// diamond radius - apply entity scale
	float rx=EntityScaleX(true);
	float ry=EntityScaleY(true);
	float rz=EntityScaleZ(true);
	if(rx&gt;=ry &amp;&amp; rx&gt;=rz){
		dradius=abs(rx);
	}else if(ry&gt;=rx &amp;&amp; ry&gt;=rz){
		dradius=abs(ry);
	}else{
		dradius=abs(rz);
	}


	//MQ_GetMatrix(tmat, true);


	triangleindex = 0;

	vertices.clear();

	geosub( 0, v[0], v[1], v[2]);
	geosub( 0, v[0], v[2], v[3]);
	geosub( 0, v[0], v[3], v[4]);
	geosub( 0, v[0], v[4], v[1]);

	geosub( 0, v[2], v[1], v[5]);
	geosub( 0, v[3], v[2], v[6]);
	geosub( 0, v[4], v[3], v[7]);
	geosub( 0, v[1], v[4], v[8]);




}

void Geosphere::geosub(int l, float v2[], float v1[], float v0[]){

	float vc[3][5];			/* New (split) vertices */
	float ds;			/* maximum midpoint displacement */
	float dx,dy,dz;			/* difference vector */
	float rd;			/* squared sphere bound radius */
	float nx[3],ny[3], nz[3];
	float rc, rc0, rc1, rc2;	/* squared distance from vc To camera position */

	if (l &lt; ROAM_LMAX) {
		ds = level2dzsize[l];

		/* compute radius of diamond bounding sphere (squared) */
		float x,y,z;
		x = (v0[0] + v1[0] + v2[0]) / 3;
		y = (v0[1] + v1[1] + v2[1]) / 3;
		z = (v0[2] + v1[2] + v2[2]) / 3;
		rd = 0.0;
		dx = v0[0] - x;
		dy = v0[1] - y;
		dz = v0[2] - z;
		rc = dx * dx + dy * dy + dz * dz;
		if (rc &gt; rd) {rd = rc;}
		dx = v1[0] - x;
		dy = v1[1] - y;
		dz = v1[2] - z;
		rc = dx * dx + dy * dy + dz * dz;
		if (rc &gt; rd) {rd = rc;}
		dx = v2[0] - x;
		dy = v2[1] - y;
		dz = v2[2] - z;
		rc = dx * dx + dy * dy + dz * dz;
		if (rc &gt; rd) {rd = rc;}
		rd = sqrt(rd)*dradius;


		float vcx=x;
		float vcy=y;
		float vcz=-z;
		mat.TransformVec(vcx, vcy, vcz, 1);

		for (int i = 0 ;i&lt;= 5; i++){
			float d = eyepoint-&gt;frustum[i][0] * vcx + eyepoint-&gt;frustum[i][1] * vcy - eyepoint-&gt;frustum[i][2] * vcz + eyepoint-&gt;frustum[i][3];
			if (d &lt;= -rd) return;//{ds=ds/10; break;}
			//m = m &lt;&lt; 1;
		}

		/* compute distance from split point To camera (squared) */
		/*dx = x - xcf;
		dy = y - ycf;
		dz = z - zcf;
		rc = dx*dx+dy*dy+dz*dz;*/
		nx[0]=(v0[0]+v1[0])/2;
		ny[0]=(v0[1]+v1[1])/2;
		nz[0]=(v0[2]+v1[2])/2;

		dx = nx[0] - xcf;
		dy = ny[0] - ycf;
		dz = nz[0] - zcf;
		rc0 = dx*dx+dy*dy+dz*dz;
		rc=rc0;

		nx[1]=(v1[0]+v2[0])/2;
		ny[1]=(v1[1]+v2[1])/2;
		nz[1]=(v1[2]+v2[2])/2;

		dx = nx[1] - xcf;
		dy = ny[1] - ycf;
		dz = nz[1] - zcf;
		rc1 = dx*dx+dy*dy+dz*dz;
		if (rc&gt;rc1) {rc=rc1;}

		nx[2]=(v2[0]+v0[0])/2;
		ny[2]=(v2[1]+v0[1])/2;
		nz[2]=(v2[2]+v0[2])/2;

		dx = nx[2] - xcf;
		dy = ny[2] - ycf;
		dz = nz[2] - zcf;
		rc2 = dx*dx+dy*dy+dz*dz;
		if (rc&gt;rc2) {rc=rc2;}



		/* If not error large on screen, recursively split */
		if (ds &gt; rc) {/*&lt;---------terrain detail here*/

			float d,h;
			/*float nx, ny, nz, d, h, ts;

			ts=size/(1&lt;&lt;l)*4.8;//size*size/l/l*11.973;
			ts*=ts;*/

			l++;

			/*nx=(v0[0]+v1[0])/2;
			ny=(v0[1]+v1[1])/2;
			nz=(v0[2]+v1[2])/2;

			dx = nx - xcf;
			dy = ny - ycf;
			dz = nz - zcf;
			rc = dx*dx+dy*dy+dz*dz+ts;*/


			vc[0][3]=(v0[3]+v1[3])/2; vc[0][4]=(v0[4]+v1[4])/2;
			h=height[(int)vc[0][3]*(int)size+ (int)vc[0][4]]*vsize+1;
			if (ds &gt; rc0) {
				d=sqrt(nx[0]*nx[0]+ny[0]*ny[0]+nz[0]*nz[0])/(size)/h;
			}else{
				d=1;
			}
			vc[0][0]=nx[0]/d; vc[0][1]=ny[0]/d; vc[0][2]=nz[0]/d; 


			/*nx=(v1[0]+v2[0])/2;
			ny=(v1[1]+v2[1])/2;
			nz=(v1[2]+v2[2])/2;

			dx = nx - xcf;
			dy = ny - ycf;
			dz = nz - zcf;
			rc = dx*dx+dy*dy+dz*dz+ts;*/

			vc[1][3]=(v1[3]+v2[3])/2; vc[1][4]=(v1[4]+v2[4])/2;
			h=height[(int)vc[1][3]*(int)size+ (int)vc[1][4]]*vsize+1;
			if (ds &gt; rc1) {
				d=sqrt(nx[1]*nx[1]+ny[1]*ny[1]+nz[1]*nz[1])/(size)/h;
			}else{
				d=1;
			}
			vc[1][0]=nx[1]/d; vc[1][1]=ny[1]/d; vc[1][2]=nz[1]/d; 


			/*nx=(v2[0]+v0[0])/2;
			ny=(v2[1]+v0[1])/2;
			nz=(v2[2]+v0[2])/2;

			dx = nx - xcf;
			dy = ny - ycf;
			dz = nz - zcf;
			rc = dx*dx+dy*dy+dz*dz+ts;*/

			vc[2][3]=(v2[3]+v0[3])/2; vc[2][4]=(v2[4]+v0[4])/2;
			h=height[(int)vc[2][3]*(int)size+ (int)vc[2][4]]*vsize+1;
			if (ds &gt; rc2) {
				d=sqrt(nx[2]*nx[2]+ny[2]*ny[2]+nz[2]*nz[2])/(size)/h;
			}else{
				d=1;
			}
			vc[2][0]=nx[2]/d; vc[2][1]=ny[2]/d; vc[2][2]=nz[2]/d; 

			geosub(l, v0, vc[2], vc[0]);
			geosub(l, v1, vc[0], vc[1]);
			geosub(l, v2, vc[1], vc[2]);
			geosub(l, vc[2], vc[1], vc[0]);

			return;
		}

	 }

	float *n0, *n1, *n2;

	n0=&amp;NormalsMap[5*(int)((int)v0[3]*(int)size+ v0[4])];
	n1=&amp;NormalsMap[5*(int)((int)v1[3]*(int)size+ v1[4])];
	n2=&amp;NormalsMap[5*(int)((int)v2[3]*(int)size+ v2[4])];

	vertices.push_back(v0[0]); vertices.push_back(v0[1]); vertices.push_back(v0[2]);
	vertices.push_back(n0[0]); vertices.push_back(n0[1]); vertices.push_back(n0[2]);
	vertices.push_back(n0[3]);
	vertices.push_back(n0[4]);


	vertices.push_back(v1[0]); vertices.push_back(v1[1]); vertices.push_back(v1[2]);
	vertices.push_back(n1[0]); vertices.push_back(n1[1]); vertices.push_back(n1[2]);
	vertices.push_back(n1[3]);
	vertices.push_back(n1[4]);


	vertices.push_back(v2[0]); vertices.push_back(v2[1]); vertices.push_back(v2[2]);
	vertices.push_back(n2[0]); vertices.push_back(n2[1]); vertices.push_back(n2[2]);
	vertices.push_back(n2[3]);
	vertices.push_back(n2[4]);

	triangleindex++;


}


void Geosphere::TOASTsub(int l, float v2[], float v1[], float v0[]){

	float vc[3][5];	/* New (split) vertices */

	if (l &gt; 0) {
		l--;
		float nx, ny, nz, d;

		nx=(v0[0]+v1[0])/2;
		ny=(v0[1]+v1[1])/2;
		nz=(v0[2]+v1[2])/2;

		vc[0][3]=(v0[3]+v1[3])/2; vc[0][4]=(v0[4]+v1[4])/2;
		d=sqrt(nx*nx+ny*ny+nz*nz);
		vc[0][0]=nx/d; vc[0][1]=ny/d; vc[0][2]=nz/d; 


		nx=(v1[0]+v2[0])/2;
		ny=(v1[1]+v2[1])/2;
		nz=(v1[2]+v2[2])/2;

		vc[1][3]=(v1[3]+v2[3])/2; vc[1][4]=(v1[4]+v2[4])/2;
		d=sqrt(nx*nx+ny*ny+nz*nz);
		vc[1][0]=nx/d; vc[1][1]=ny/d; vc[1][2]=nz/d; 


		nx=(v2[0]+v0[0])/2;
		ny=(v2[1]+v0[1])/2;
		nz=(v2[2]+v0[2])/2;

		vc[2][3]=(v2[3]+v0[3])/2; vc[2][4]=(v2[4]+v0[4])/2;
		d=sqrt(nx*nx+ny*ny+nz*nz);
		vc[2][0]=nx/d; vc[2][1]=ny/d; vc[2][2]=nz/d; 

		TOASTsub(l, v0, vc[2], vc[0]);
		TOASTsub(l, v1, vc[0], vc[1]);
		TOASTsub(l, v2, vc[1], vc[2]);
		TOASTsub(l, vc[2], vc[1], vc[0]);

		return;
	}

	/*float ax,ay,az,bx,by,bz;
	float nx,ny,nz,ns;
	float h0,h1,h2;

	h0=height[(int)v0[3]*(int)size+ (int)v0[4]]*vsize+1;
	h1=height[(int)v1[3]*(int)size+ (int)v1[4]]*vsize+1;
	h2=height[(int)v2[3]*(int)size+ (int)v2[4]]*vsize+1;

	ax = h1*v1[0]-h0*v0[0];
	ay = h1*v1[1]-h0*v0[1];
	az = h1*v1[2]-h0*v0[2];
	bx = h2*v2[0]-h1*v1[0];
	by = h2*v2[1]-h1*v1[1];
	bz = h2*v2[2]-h1*v1[2];
	nx = ( ay * bz ) - ( az * by );
	ny = ( az * bx ) - ( ax * bz );
	nz = ( ax * by ) - ( ay * bx );
	ns = sqrt( nx * nx + ny*ny + nz*nz );
	if (ns != 0) ns = 1;
	nx /= ns;
	ny /= ns;
	nz /= ns;
	NormalsMap[5*(int)((int)v0[3]*(int)size+ v0[4])]=nx;
	NormalsMap[5*(int)((int)v0[3]*(int)size+ v0[4])+1]=ny;
	NormalsMap[5*(int)((int)v0[3]*(int)size+ v0[4])+2]=nz;

	NormalsMap[5*(int)((int)v1[3]*(int)size+ v1[4])]=nx;
	NormalsMap[5*(int)((int)v1[3]*(int)size+ v1[4])+1]=ny;
	NormalsMap[5*(int)((int)v1[3]*(int)size+ v1[4])+2]=nz;

	NormalsMap[5*(int)((int)v2[3]*(int)size+ v2[4])]=nx;
	NormalsMap[5*(int)((int)v2[3]*(int)size+ v2[4])+1]=ny;
	NormalsMap[5*(int)((int)v2[3]*(int)size+ v2[4])+2]=nz;*/


	float u,v;
	u=0.5f * (-1.0 +atan2( v0[2] , v0[0] ) * (-1 / M_PI ));
	v=acos( v0[1] ) * ( 1 / M_PI );
	NormalsMap[5*(int)((int)v0[3]*(int)size+ v0[4])+3]=u*size;
	NormalsMap[5*(int)((int)v0[3]*(int)size+ v0[4])+4]=v*size;

	u=0.5f * (-1.0 +atan2( v1[2] , v1[0] ) * (-1 / M_PI ));
	v=acos( v1[1] ) * ( 1 / M_PI );
	NormalsMap[5*(int)((int)v1[3]*(int)size+ v1[4])+3]=u*size;
	NormalsMap[5*(int)((int)v1[3]*(int)size+ v1[4])+4]=v*size;

	u=0.5f * (-1.0 +atan2( v2[2] , v2[0] ) * (-1 / M_PI ));
	v=acos( v2[1] ) * ( 1 / M_PI );
	NormalsMap[5*(int)((int)v2[3]*(int)size+ v2[4])+3]=u*size;
	NormalsMap[5*(int)((int)v2[3]*(int)size+ v2[4])+4]=v*size;

}



void Geosphere::ModifyGeosphere (int x, int y, float new_height){
	/*int width=size*2;		//Most accurate approach: it wastes a lot of memory
	if (EqToToast==0){	//First time: must create a look-up map to convert equirectangular coords to TOAST coords
		EqToToast=new int[(int)(size+1)*width];
		for (int y=0;y&lt;size;y++){
			for (int x=0;x&lt;size;x++){
				int x1=-NormalsMap[5*(x*(int)size+ y)+3]*2;
				int y1=NormalsMap[5*(x*(int)size+ y)+4];

				//geo-&gt;height[x*(int)geo-&gt;size+y]=((float)*(buffer+x1+y1*width))/255.0;
				if (x1+y1*width&lt;0) {
					x1=0; y1=0;
				}
				EqToToast[x1+y1*width]=x*(int)size+y;
			}
		}
	}

	height[EqToToast[x+y*width]]=new_height;*/


	//Less accurate approach: some lines might be distorted, but for little changes on a map should be good enough

	float r=sqrt((x % (int)hsize)*(x % (int)hsize)+(hsize-(x % (int)hsize))*(hsize-(x % (int)hsize)))/hsize;


	if (x&lt;hsize){
		if (y&lt;=hsize){

			r=(r*(hsize-y)+1*y)/hsize;
			y=y/r;

			x=x* y/hsize;
			y=y-x;
		}else{
			r=(r*(y-hsize)+1*(2*hsize-y))/hsize;
			y=2*hsize-(2*hsize-y)/r;

			x=y-(x*(y-2*hsize)/hsize)-hsize;
			y=y-x;
		}
	}else if (x&lt;hsize*2){
		x=hsize*2-x;
		if (y&lt;=hsize){

			r=(r*(hsize-y)+1*y)/hsize;
			y=y/r;

			x=x* y/hsize;
			y=x-y;
		}else{

			r=(r*(y-hsize)+1*(2*hsize-y))/hsize;
			y=2*hsize-(2*hsize-y)/r;


			x=y-(x*(y-2*hsize)/hsize)-hsize;
			y=x-y;
		}
	}else if (x&lt;hsize*3){
		x=x-hsize*2;
		if (y&lt;=hsize){

			r=(r*(hsize-y)+1*y)/hsize;
			y=y/r;

			x=-x* y/hsize;
			y=-y-x;
		}else{
			r=(r*(y-hsize)+1*(2*hsize-y))/hsize;
			y=2*hsize-(2*hsize-y)/r;

			x=(x*(y-2*hsize)/hsize)+hsize-y;
			y=-y-x;
		}
	}else{
		x=hsize*4-x;
		if (y&lt;=hsize) {

			r=(r*(hsize-y)+1*y)/hsize;
			y=y/r;

			x=-x* y/hsize;
			y=x+y;
		}else{
			r=(r*(y-hsize)+1*(2*hsize-y))/hsize;
			y=2*hsize-(2*hsize-y)/r;

			x=(x*(y-2*hsize)/hsize)+hsize-y;
			y=x+y;
		}
	
	}
	x+=hsize;
	y+=hsize;
	height[x+y*(int)size]=new_height;
}

void Geosphere::EquirectangularToTOAST (){
	/*for (int x=0; x&lt;size*2; x++){
		for (int y=0; y&lt;size; y++){
			int x1=x, y1=y;
			EquirectangularToTOAST (x1, y1);

			NormalsMap[5*(x1*(int)size+ y1)+3]=x/2;
			NormalsMap[5*(x1*(int)size+ y1)+4]=y;
		}
	}*/
	float v[9][5]={
	{ 0,  1,  0, hsize, hsize},
	{ 1,  0,  0, size, hsize},
	{ 0,  0,  1, hsize, size},
	{-1,  0,  0, 1, hsize},
	{ 0,  0, -1, hsize, 1},

	{ 0, -1,  0, size, size},
	{ 0, -1,  0, 1, size},
	{ 0, -1,  0, 1, 1},
	{ 0, -1,  0, size, 1}};

	int l=(int)(log(hsize)/log(2));

	TOASTsub( l, v[0], v[1], v[2]);
	TOASTsub( l, v[0], v[2], v[3]);
	TOASTsub( l, v[0], v[3], v[4]);
	TOASTsub( l, v[0], v[4], v[1]);

	TOASTsub( l, v[2], v[1], v[5]);
	TOASTsub( l, v[3], v[2], v[6]);
	TOASTsub( l, v[4], v[3], v[7]);
	TOASTsub( l, v[1], v[4], v[8]);

}

void Geosphere::UpdateNormals (int preserve){
		for (int y=0;y&lt;size;y++){
			for (int x=0;x&lt;size;x++){
				float theta=-M_PI*(NormalsMap[5*(x*(int)size+ y)+3]-hsize)/size*2;
				float phi=M_PI*(NormalsMap[5*(x*(int)size+ y)+4])/size;
				if (preserve==0){
					NormalsMap[5*(x*(int)size+ y)]=sin(phi) * cos(theta);
					NormalsMap[5*(x*(int)size+ y)+1]=cos(phi);
					NormalsMap[5*(x*(int)size+ y)+2]=sin(phi) * sin(theta);
				}else{
					float a,b,c, d,e,f;
					a=sin(phi) * cos(theta);
					b=cos(phi);
					c=sin(phi) * sin(theta);

					d=NormalsMap[5*(x*(int)size+ y)];
					e=NormalsMap[5*(x*(int)size+ y)+1];
					f=NormalsMap[5*(x*(int)size+ y)+2];

					NormalsMap[5*(x*(int)size+ y)]=a*e+c*d;
					NormalsMap[5*(x*(int)size+ y)+1]=b*e+f;
					NormalsMap[5*(x*(int)size+ y)+2]=c*e-a*d;

				}
			}
		}
}

Geosphere* Geosphere::LoadGeosphere(string filename,Entity* parent_ent){
	//filename=Strip(filename); // get rid of path info

	filename=File::ResourceFilePath(filename);
	/*if(File::ResourceFilePath(filename)==""){
		cout &lt;&lt; "Error: Cannot Find Terrain: " &lt;&lt; filename &lt;&lt; endl;
		return NULL;
	}*/

	string filename_left=Left(filename,Len(filename)-4);
	string filename_right=Right(filename,3);

	//const char* c_filename_left=filename_left.c_str();
	//const char* c_filename_right=filename_right.c_str();

	Geosphere* geo;

	unsigned char* pixels;

	int width,height;

	pixels=stbi_load(filename.c_str(),&amp;width,&amp;height,0,1);   //Memory leak fixed by D.J.Peters

	short* tmpNormals=0;		//An equirectangular normal maps

	// all OK ?
	if (pixels!=NULL) {
		// work with a copy of the pixel pointer
		unsigned char* buffer=pixels;

		tmpNormals=new short[(width+1)*(height+1)*2];	// Build an equirectangular normals map, that will be used to build
								// the final normals map in TOAST projection.
		for (int x=1;x&lt;=width;x++){
			for (int y=1;y&lt;=height-2;y++){
				tmpNormals[2*(y*(int)width+x)]=((short)*(buffer+(x-1)+y*width)) - ((short)*(buffer+(x+1)+y*width));
				tmpNormals[2*(y*(int)width+x)+1]=((short)*(buffer+x+(y-1)*width)) - ((short)*(buffer+x+(y+1)*width));
			}
		}


		geo=Geosphere::CreateGeosphere(width, parent_ent);

		for (int y=0;y&lt;geo-&gt;size;y++){
			for (int x=0;x&lt;=geo-&gt;size;x++){
				int x1=geo-&gt;NormalsMap[5*(x*(int)geo-&gt;size+ y)+3]*2;
				int y1=geo-&gt;NormalsMap[5*(x*(int)geo-&gt;size+ y)+4];

				if (x1+y1*width&lt;0) {
					x1=0; y1=0;
				}

				geo-&gt;height[x*(int)geo-&gt;size+y]=((float)*(buffer+x1+y1*width))/255.0;
				if (x&lt;geo-&gt;size) {
					geo-&gt;NormalsMap[5*(x*(int)geo-&gt;size+ y)]=(float)tmpNormals[2*(y1*(int)width+x1)];
					geo-&gt;NormalsMap[5*(x*(int)geo-&gt;size+ y)+1]=256;
					geo-&gt;NormalsMap[5*(x*(int)geo-&gt;size+ y)+2]=(float)tmpNormals[2*(y1*(int)width+x1)+1];
				}
			}
		}
		stbi_image_free(pixels);
		pixels=NULL;
	} else {
		// create a dummy terrain only as a dirty fallback
		height =128;
		geo=Geosphere::CreateGeosphere(256, parent_ent);
		//geo-&gt;height=new float[(width+1)*(width+1)];
		for (int x=0;x&lt;=geo-&gt;size-1;x++){
			for (int y=0;y&lt;=geo-&gt;size-1;y++){
				geo-&gt;height[x*(int)geo-&gt;size+y]=0.0f;
			}
		}
	}


	geo-&gt;UpdateNormals(true);
	delete tmpNormals;

	return geo;
}

void Geosphere::TreeCheck(CollisionInfo* ci){
	Ray=ci-&gt;coll_line;
	radius=ci-&gt;radius;

	TFormPoint(Ray.o.x, Ray.o.y, Ray.o.z, 0, this);
	xcf = tformed_x;
	ycf = tformed_y;
	zcf = -tformed_z;


	//int i;
	float h1= (height[(int)hsize*(int)size+ (int)hsize]*vsize+1)*size;
	float h2= (height[(int) size*(int)size+ (int)hsize]*vsize+1)*size;
	float h3= (height[(int)hsize*(int)size+ (int) size]*vsize+1)*size;
	float h4=-(height[(int)    0*(int)size+ (int)hsize]*vsize+1)*size;
	float h5=-(height[(int)hsize*(int)size]*vsize+1)*size;
	float h6=-(height[0]*vsize+1)*size;


	float v[9][5]={
	{ 0,  h1,  0, hsize, hsize},

	{ h2,  0,  0, size, hsize},
	{ 0,  0,  h3, hsize, size},
	{ h4,  0,  0, 0, hsize},
	{ 0,  0,  h5, hsize, 0},

	{ 0,  h6,  0, size, size},
	{ 0,  h6,  0, 0, size},
	{ 0,  h6,  0, 0, 0},
	{ 0,  h6,  0, size, 0}};


	// diamond radius - apply entity scale
	float rx=EntityScaleX(true);
	float ry=EntityScaleY(true);
	float rz=EntityScaleZ(true);
	if(rx&gt;=ry &amp;&amp; rx&gt;=rz){
		dradius=abs(rx);
	}else if(ry&gt;=rx &amp;&amp; ry&gt;=rz){
		dradius=abs(ry);
	}else{
		dradius=abs(rz);
	}


	//MQ_GetMatrix(tmat, true);



	if(c_col_tree!=NULL){
		C_DeleteColTree(c_col_tree);
		c_col_tree=NULL;
	}

	mesh_info=C_NewMeshInfo();
	triangleindex = 0;


	/* recurse on the two base triangles */
	c_col_tree_geosub( 0, v[0], v[1], v[2]);
	c_col_tree_geosub( 0, v[0], v[2], v[3]);
	c_col_tree_geosub( 0, v[0], v[3], v[4]);
	c_col_tree_geosub( 0, v[0], v[4], v[1]);

	c_col_tree_geosub( 0, v[2], v[1], v[5]);
	c_col_tree_geosub( 0, v[3], v[2], v[6]);
	c_col_tree_geosub( 0, v[4], v[3], v[7]);
	c_col_tree_geosub( 0, v[1], v[4], v[8]);

	c_col_tree=C_CreateColTree(mesh_info);
	C_DeleteMeshInfo(mesh_info);



}

void Geosphere::c_col_tree_geosub(int l, float v2[], float v1[], float v0[]){

	float vc[3][5];	/* New (split) vertices */
	float ds;	/* maximum midpoint displacement */
	float dx,dy,dz;	/* difference vector */
	float rd;	/* squared sphere bound radius */
	float rc;	/* squared distance from vc To camera position */

	if (l &lt; ROAM_LMAX) {
		ds = level2dzsize[l];

		/* compute radius of diamond bounding sphere (squared) */
		float x,y,z;
		x = (v0[0] + v1[0] + v2[0]) / 3;
		y = (v0[1] + v1[1] + v2[1]) / 3;
		z = (v0[2] + v1[2] + v2[2]) / 3;
		rd = 0.0;
		dx = v0[0] - x;
		dy = v0[1] - y;
		dz = v0[2] - z;
		rc = dx * dx + dy * dy + dz * dz;
		if (rc &gt; rd) {rd = rc;}
		dx = v1[0] - x;
		dy = v1[1] - y;
		dz = v1[2] - z;
		rc = dx * dx + dy * dy + dz * dz;
		if (rc &gt; rd) {rd = rc;}
		dx = v2[0] - x;
		dy = v2[1] - y;
		dz = v2[2] - z;
		rc = dx * dx + dy * dy + dz * dz;
		if (rc &gt; rd) {rd = rc;}
		rd = sqrt(rd)*dradius;


		float vcx=x;
		float vcy=y;
		float vcz=-z;
		mat.TransformVec(vcx, vcy, vcz, 1);

		/*Is triangle on the collision line?*/

		Vector Sphere;
		Sphere.x=vcx;
		Sphere.y=vcy;
		Sphere.z=vcz;
		Line dst( Sphere-Ray.o,Ray.d );

		float a=dst.d.dot(dst.d);
		if( !a ) return;
		float b=dst.o.dot(dst.d)*2;
		float c=dst.o.dot(dst.o)-rd*rd;
		float d=b*b-4*a*c;

		if (d&lt;0) return;


		/* compute distance from split point To camera (squared) */
		dx = x - xcf;
		dy = y - ycf;
		dz = z - zcf;
		rc = dx*dx+dy*dy+dz*dz;

		/* If not error large on screen, recursively split */
		if (ds &gt; rc) {/*&lt;---------terrain detail here*/
			l++;
			float nx, ny, nz, d, h;

			nx=(v0[0]+v1[0])/2;
			ny=(v0[1]+v1[1])/2;
			nz=(v0[2]+v1[2])/2;

			vc[0][3]=(v0[3]+v1[3])/2; vc[0][4]=(v0[4]+v1[4])/2;
			h=height[(int)vc[0][3]*(int)size+ (int)vc[0][4]]*vsize+1;
			d=sqrt(nx*nx+ny*ny+nz*nz)/(size)/h;

			vc[0][0]=nx/d; vc[0][1]=ny/d; vc[0][2]=nz/d; 


			nx=(v1[0]+v2[0])/2;
			ny=(v1[1]+v2[1])/2;
			nz=(v1[2]+v2[2])/2;

			vc[1][3]=(v1[3]+v2[3])/2; vc[1][4]=(v1[4]+v2[4])/2;
			h=height[(int)vc[1][3]*(int)size+ (int)vc[1][4]]*vsize+1;
			d=sqrt(nx*nx+ny*ny+nz*nz)/(size)/h;

			vc[1][0]=nx/d; vc[1][1]=ny/d; vc[1][2]=nz/d; 


			nx=(v2[0]+v0[0])/2;
			ny=(v2[1]+v0[1])/2;
			nz=(v2[2]+v0[2])/2;
			vc[2][3]=(v2[3]+v0[3])/2; vc[2][4]=(v2[4]+v0[4])/2;
			h=height[(int)vc[2][3]*(int)size+ (int)vc[2][4]]*vsize+1;
			d=sqrt(nx*nx+ny*ny+nz*nz)/(size)/h;

			vc[2][0]=nx/d; vc[2][1]=ny/d; vc[2][2]=nz/d; 

			c_col_tree_geosub(l, v0, vc[2], vc[0]);
			c_col_tree_geosub(l, v1, vc[0], vc[1]);
			c_col_tree_geosub(l, v2, vc[1], vc[2]);
			c_col_tree_geosub(l, vc[2], vc[1], vc[0]);

			return;
		}

	 }

	//add to collisiontree
	C_AddVertex(mesh_info,v0[0],v0[1],-v0[2],0);
	C_AddVertex(mesh_info,v1[0],v1[1],-v1[2],0);
	C_AddVertex(mesh_info,v2[0],v2[1],-v2[2],0);
	C_AddTriangle(mesh_info, triangleindex, triangleindex*3+2, triangleindex*3+1, triangleindex*3+0, 0);
	triangleindex++;
}

void Geosphere::FreeEntity(){

	delete[] height;
	delete[] NormalsMap;		
	//delete[] EqToToast;		

	terrain_list.remove(this);
	delete c_col_tree;

	Entity::FreeEntity();

	delete this;

	return;

}

</pre> <br><br></td></tr></table><br>
<a name="1288818"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#131">[#131]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thareh, I've tested in Ubuntu &amp; Win7 with the latest version and can't reproduce your problem.<br><br>Hezkore, thanks for the example! The smiley face .jpg must be in the progressive format which Openb3d doesn't support in it's stb image decoders. Also Openb3d Textures are a little bit different to Minib3d so swapping out tex[0] won't work but BrushTexture(brush, tex) does the job.<br><br>Currently, things are a bit broken in the repo, cubemaps, tex render, maybe more, I've checked back to the ProPuke merge and it's fine so just use that for now. <br><br></td></tr></table><br>
<a name="1288820"></a>

<a name="1288821"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#132">[#132]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've switched out the jpg for a png.<br>And I've also tried<pre class=code>	If KeyHit(KEY_1) Then BrushTexture(GetSurfaceBrush(quad.GetSurface(1)), tex1)
	If KeyHit(KEY_2) Then BrushTexture(GetSurfaceBrush(quad.GetSurface(1)), tex2)</pre>But I'm still not getting any results. <br><br></td></tr></table><br>
<a name="1288861"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#133">[#133]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh right, no you shouldn't use GetSurfaceBrush as it creates a new brush, you need the current brush handle.<br><pre class=code>	If KeyHit(KEY_3) Then BrushTexture(quad.GetSurface(1).brush, tex2)
</pre> <br><br></td></tr></table><br>
<a name="1289247"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#134">[#134]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ah yes, that works!<br>Is it possible for a TextureColor function?<br>The Quake shaders/scripts have blinking parts where they basically have a texture with additive blend mode go from RGB 0,0,0 to 255,255,255.<br>I'd also like to use it for the lightmap. <br><br></td></tr></table><br>
<a name="1289331"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#135">[#135]</a></td></tr></table></td></tr><tr ><td class="posttext"> Textures don't have colors themselves, brushes have them, does BrushColor not work? <br><br></td></tr></table><br>
<a name="1289334"></a>

<a name="1289335"></a>

<a name="1289336"></a>

<a name="1289337"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#136">[#136]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well BrushColor would apply colour to the entire brush, which includes many textures. Making the entire thing blink instead of individual parts.<br><br>The brushes for Quake might be something like:<br>Texture 0 would be the floor texture.<br>Texture 1 would maybe be some fire texture or something.<br>Texture 2 might be a frame around the fire texture.<br>And Texture 3 could be the blinky stuff ontop of the frame.<br><br>If I did BrushColor the entire thing would "blink".<br>What I need is for Texture 3 to only blink.<br><br>The lightmap goes ontop of everything too (Texture 4 in this case) so BrushColor would also change the lightmap colour, which would look pretty trippy heh.<br><br>With a TextureColor function, we could have those blinky parts.<br>And also adjust the colour/light of the lightmap if needed.<br><br>I'm also wondering if there's a way to disable texture caching?<br>Loading the same texture twice and then rotating one seems to rotate both.<br>I'd like load the same texture twice and have them as individual textures.<br>Loading the textures with different flags does the trick.<br>So I'm thinking like perhaps another flag?<br>Flag 1024 could be the no caching flag. <br><br></td></tr></table><br>
<a name="1289406"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#137">[#137]</a></td></tr></table></td></tr><tr ><td class="posttext"> About TextureColor. Can you use surf.VertexColor? There's also an unused surf.SurfaceColor. <br><br></td></tr></table><br>
<a name="1289410"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#138">[#138]</a></td></tr></table></td></tr><tr ><td class="posttext"> VertexColor would only change the bottom texture if anything, wouldn't it?<br><br>I've found a trick for the texture caching problem.<br>If I for example load "tech.tga" I can load the same texture but with "tecH.tga" (notice the capital H) and it'll think it's a new texture file.<br>Dirty trick, but it works for now. <br><br></td></tr></table><br>
<a name="1289537"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#139">[#139]</a></td></tr></table></td></tr><tr ><td class="posttext"> Don't use that trick, because it will cause unexpected results on different operating systems: in Windows, the file system is not case sensitive, so "tech.tga" and "tecH.tga" refers to the same file, but on linux (and also on OSX, Android and IOS) they are different files, and you will get a "Cannot find resource file" <br><br></td></tr></table><br>
<a name="1289543"></a>

<a name="1289544"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#140">[#140]</a></td></tr></table></td></tr><tr ><td class="posttext"> We did it this way - <a href="https://github.com/propuke/openb3d.mod" target="_blank">https://github.com/propuke/openb3d.mod</a><br>He'll look into Texture color later. <br><br></td></tr></table><br>
<a name="1290087"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#141">[#141]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, progress report for anyone watching! <br><br>I'm nearly ready for an update, Addlist is in and working (yay)! Just a few issues need to be cleared up, at the mo, currently I need to check what objects need a createobject. I need to test all lists work properly and what pushback funcs aren't going to be needed. <br><br>I removed createobject from TEntity and reintroduced the Abstract methods CopyEntity/Update which probably has fixed a few bugs. I've gone for stability with Copy/Addlist which means it loops through the list everytime the func is called instead of incrementing an iterator. I found when you do that with a vector it just crashes. <br><br></td></tr></table><br>
<a name="1290196"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#142">[#142]</a></td></tr></table></td></tr><tr ><td class="posttext"> Keep up the good work munch!<br><br>I have a tip for you though.<br>If you change line 139 in openb3d.mod\inc\TMesh.bmx from<pre class=code>RotateMesh mesh,0,-90,0</pre> to <pre class=code>mesh.RotateMesh(0, -90, 0)</pre>The module will compile in BMX-NG. :) <br><br></td></tr></table><br>
<a name="1291494"></a>

<a name="1291497"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#143">[#143]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, the repo is updated at last! :)<br><br>New changes are:<br>- removed all unneeded CreateObject's<br>- added ent.exists field to know if entity was freed, use instead of ent=Null<br>- removed TCollision.bmx, no need for it - the Collision functions cover everything<br>- internalized CopyList and AddList - field lists use CopyList, global lists AddList, no need for CopyList now<br>- fixed child_list not loading when ent has bones, waits for all bones to load<br>- added ListPushBack method for adding objects to field lists - global lists not supported, like ListAddLast<br>- reintroduced using GraphicsHeight to invert CameraViewport - vheight didn't work<br>- added TDebug for Minib3d debug functions<br>- added list removal in FreeEntity, FreeShadow and FreeTexture<br>- added list reset in ClearWorld (and cpp fix where root_ent should not be freed)<br>- added CopyBrush, CopySurface and CopyTexture functions (and cpp changes by ProPuke)<br>- added TPick AddList to EntityPickMode and CopyEntity functions<br>- fixed no breaks in nested switches causing errors in data.cpp<br>- improved the way iter list functions work in data.cpp<br>- added geosphere.cpp changes by Angros <br><br></td></tr></table><br>
<a name="1291639"></a>

<a name="1291650"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#144">[#144]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just updated TMatrix2 to be TMatrix.<br><br>I tested with feeble's Newton demo and the bug where the boxes vanish below -15M has gone.<br><br>Edit: Oops, just missed updating openb3dlib.bmx. <br><br></td></tr></table><br>
<a name="1292318"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#145">[#145]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm using ProPukes version I can do<pre class=code>myTexture = LoadTexture(name, flags).CopyTexture()</pre>and that works fine, but with yours I need to specify a brush, which is a bit of an issue for me. :S <br><br></td></tr></table><br>
<a name="1292350"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#146">[#146]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Hezkore, I should have said I changed CopyTexture to be 'copy tex to brush' because I thought it might be good to have both options, that and the tex.Copy() method. If this is not anything anyone will want I can change it? I also changed ProPuke's cpp copy function a bit and I was wondering if I should even add a glGenTextures so it is a unique texture you can then draw to?<br><br>Currently I'm filling in the spaces in the docs and working on some examples. <br><br></td></tr></table><br>
<a name="1292486"></a>

<a name="1292490"></a>

<a name="1292491"></a>

<a name="1292492"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#147">[#147]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ah okay, I didn't know .Copy() existed.<br>Then all is fine, thank you!<br><br>I noticed it's not possible to load incbin models.<br>Is there a way this could be fixed in the future?<br>I mean stuff like this<pre class=code>Incbin "mesh.b3d"
LoadMesh("incbin::mesh.b3d")</pre> <br><br></td></tr></table><br>
<a name="1292574"></a>

<a name="1292578"></a>

<a name="1292597"></a>

<a name="1292598"></a>

<a name="1292786"></a>

<a name="1292880"></a>

<a name="1292888"></a>

<a name="1292891"></a>

<a name="1292898"></a>

<a name="1292904"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#148">[#148]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Hezkore, glad to know tex.Copy is ok with you. I would like to clarify if you want to draw to this copy (via glGenTextures) or if you just need to get around the cache issue mentioned.<br><div class="quote"> I'm also wondering if there's a way to disable texture caching?<br>Loading the same texture twice and then rotating one seems to rotate both.<br>I'd like load the same texture twice and have them as individual textures. <br></div><br><br>Re: incbin, I think as with Minib3d your best option here is to use Brucey's version of koriolis.zipstream as mentioned here: <a href="http://www.blitzmax.com/Community/posts.php?topic=105651" target="_blank">http://www.blitzmax.com/Community/posts.php?topic=105651</a><br><br>@Angros, how's the GLES stuff going?<br><br>EDIT: I have been testing the Action functions and found a few issues.<br>- First was I think it would be better if there was an option to loop an action (and any appended ones) and to stop an action would be useful for vector/newtonian functions.<br>- Then there seems to be a random Mesa error report "Mesa 10.1.3 implementation error: Bad attrib flag in PopAttrib" which happens when I use FreeAction. At other times there is a random DrawText bug rendering black background - no blending.<br>- There is also a random segfault with FreeAction (could it be related to the mesa error?). I double-checked this wasn't my code, it happens maybe 1/10 times.<br>- I had to change Action::action_list to public as I wanted to access it to free finished actions.<br>- When I wrapped "int act" after the action is over sometimes it is random data instead of being zero.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">' action.bmx
' from bOGL 3DAction demo

Strict

Framework Openb3d.B3dglgraphics

Graphics3D 800,600,0,2


Local camera:TCamera=CreateCamera()
CameraClsColor camera,32,32,64
PositionEntity camera,0,0,6

AmbientLight 128,128,128

Local light:TLight=CreateLight(1)
PositionEntity light,2,6,-6
PointEntity light,camera

Local cube1:TMesh=CreateCube()
EntityColor cube1,220,0,0
PositionEntity cube1,-9,-5,20

Local cube2:TMesh=CreateCube()
EntityColor cube2,0,220,0
PositionEntity cube2,-3,-5,20

Local cube3:TMesh=CreateCube()
EntityColor cube3,0,0,220
PositionEntity cube3,3,-5,20

Local cube4:TMesh=CreateCube()
EntityColor cube4,220,220,220
PositionEntity cube4,9,-5,20

' Explode
Local cube1_act1:TAction=ActFadeTo( cube1,0.0,0.01 ) ' expand and fade away
Local cube1_act1b:TAction=ActFadeTo( cube1,1.0,0.01 ) ' contract and reappear
Local cube1_act2:TAction=ActScaleTo( cube1,3,3,1,0.04 )
Local cube1_act2b:TAction=ActScaleTo( cube1,0.5,0.5,1,0.05 )
AppendAction cube1_act1,cube1_act1b ' fade/reappear
AppendAction cube1_act2,cube1_act2b ' expand/contract

' Bounce and spin
Local cube2_act1:TAction=ActMoveBy( cube2,0,5,0,0.1 )
Local cube2_act1b:TAction=ActTurnBy( cube2,0,45,0,1.0 )
Local cube2_act2:TAction=ActMoveBy( cube2,0,-5,0,0.1 )
Local cube2_act2b:TAction=ActTurnBy( cube2,0,45,0,1.0 )
AppendAction cube2_act1,cube2_act2 ' move down
AppendAction cube2_act1b,cube2_act2b ' spin moving down

' Move and push
Local cube3_act1:TAction=ActMoveBy( cube3,-1,4,2,0.1 )
Local cube3_act1b:TAction=ActTintTo( cube3,255,255,0,4.0 ) ' tint yellow
Local cube3_act2:TAction=ActNewtonian( cube3,0.8 )
AppendAction cube3_act1,cube3_act2

' Absolute movement with trackers
Local cube4_act1:TAction=ActMoveTo( cube4,9,5,20,0.2 )
Local cube4_act2:TAction=ActMoveTo( cube4,-9,5,20,0.2 )
Local cube4_act3:TAction=ActMoveTo( cube4,9,5,20,0.2 )
Local cube4_act4:TAction=ActMoveTo( cube4,9,-5,20,0.2 )
Local cube4_act5:TAction=ActTurnTo( cube4,90,180,0,1.0 ) ' spin
AppendAction cube4_act1,cube4_act2
AppendAction cube4_act2,cube4_act3
AppendAction cube4_act3,cube4_act4

Local moon1:TMesh=CreateCube() ' these will follow it
ScaleEntity moon1,0.25,0.25,0.25
EntityColor moon1,128,128,128

Local moon2:TMesh=CreateCube()
ScaleEntity moon2,0.25,0.25,0.25
EntityColor moon2,64,64,64

' Note that tracker actions have no timer and never expire on their own
Local moon1_act1:TAction=ActTrackByDistance( moon1,cube4,3.0,0.2 ) ' just follow it arbitrarily
Local moon2_act1:TAction=ActTrackByPoint( moon2,cube4,2.0,2,0,0.2 )' stay above and to the right

While Not KeyDown(KEY_ESCAPE)

	' control camera
	MoveEntity camera,KeyDown(KEY_D)-KeyDown(KEY_A),0,KeyDown(KEY_W)-KeyDown(KEY_S)
	TurnEntity camera,KeyDown(KEY_DOWN)-KeyDown(KEY_UP),KeyDown(KEY_LEFT)-KeyDown(KEY_RIGHT),0
	
	If KeyHit(KEY_SPACE)
		For Local a:TAction=EachIn TAction.action_list
			FreeAction(a)
		Next
	EndIf
	
	UpdateWorld 1 ' update actions
	RenderWorld
	
	BeginMax2D()
	DrawText "Exploder",50,550
	DrawText "Bouncer",300,550
	DrawText "Pusher",450,550
	DrawText "Orbiter with followers",600,550
	DrawText "Actions:",0,0
	
	Local ty:Int=20
	For Local a:TAction=EachIn TAction.action_list
		If a.exists And a.act[0]&gt;=0 And a.act[0]&lt;=11 Then DrawText "inst="+Int(TAction.getinstance(a))+" act="+a.act[0],0,ty
		ty:+20
	Next
	EndMax2D()
	
	Flip
Wend
End
</textarea><br><br>Also a few other issues.<br>- FreeEntity you should be calling child_list.remove(this) after the child_list loop. <br>- ClearWorld there is no code to deal with brush's since Minib3d never implemented it. EDIT: looking at the <a href="https://github.com/blitz-research/blitz3d" target="_blank">b3d src</a> it uses something called a set which must be a custom list, bbCreateBrush, bbGetSurfaceBrush and bbGetEntityBrush insert and bbFreeBrush erases, so it doesn't include internal brushes in Entity and Brush.<br>- GetMatElement just returns 0 in functions.cpp when it should be  ent-&gt;mat-&gt;grid[row,col]. <br><br></td></tr></table><br>
<a name="1292579"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#149">[#149]</a></td></tr></table></td></tr><tr ><td class="posttext"> I just needed it to get around the caching problem.<br>I'm still scratching my head about how to colour the textures though.<br>Something like ColorTexture(r,g,b) <br><br></td></tr></table><br>
<a name="1292588"></a>

<a name="1292590"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#150">[#150]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, as mentioned I think the way to do that is by creating separate surfaces and then using surfaceColor or vertexColor. <br><br></td></tr></table><br>
<a name="1292601"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#151">[#151]</a></td></tr></table></td></tr><tr ><td class="posttext"> Vertex colour won't work in my situation, I only want to change the colour of a couple textures in my brush, vertex colour would affect the entire brush, even lightmap parts.<br>And I tired multiple surfaces, but my PC came to a crawling speed, seeing as how entire levels use multiple textures that change colours. I basically end up with too many surfaces! <br><br></td></tr></table><br>
<a name="1292602"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#152">[#152]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well I guess the only other option would be to draw to the texture and therefore change its color. <br><br></td></tr></table><br>
<a name="1292603"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#153">[#153]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah, but it changes every frame.<br>Seems very slow... Unless there was some sort of PixmapToTexture function hehe<br>But that would still probably be very slow. <br><br></td></tr></table><br>
<a name="1292613"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#154">[#154]</a></td></tr></table></td></tr><tr ><td class="posttext"> If your texture is only a few pixels it shouldn't matter, right? <br><br></td></tr></table><br>
<a name="1292615"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#155">[#155]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's the Quake 3 textures, and they're pretty big. :/ <br><br></td></tr></table><br>
<a name="1292617"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#156">[#156]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, I must misunderstand what you're talking about, sorry I'm watching Sweeny Todd! Hehe <br><br></td></tr></table><br>
<a name="1292618"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#157">[#157]</a></td></tr></table></td></tr><tr ><td class="posttext"> Cool movie heh<br>I sent you a mail to the email you've got registered here at the forum. <br><br></td></tr></table><br>
<a name="1292922"></a>

<a name="1292923"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#158">[#158]</a></td></tr></table></td></tr><tr ><td class="posttext"> Another update! This time I filled in all the docs blanks but some other things too.<br><br>- nice actions example taken from bOGL demo - FreeAction bug (MAVs every time in Win7)<br>- updated particle example<br>- voxelsprite example - ugly rendering issue when using first and last splices<br>- issue with rigidbody being flattened so no constraints example<br>- action_list and act vars to TAction<br>- changed cls_depth name to cls_color in StencilClsMode to prevent confusion<br>- removed rest of collision code in data.cpp <br><br></td></tr></table><br>
<a name="1292968"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#159">[#159]</a></td></tr></table></td></tr><tr ><td class="posttext"> What happens with rigidbody? <br><br></td></tr></table><br>
<a name="1292990"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#160">[#160]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well sorry I've no screenies but here's test code. It basically just flattens the body mesh like a pancake, although it is being affected by the constraints.<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">' rigidbody.bmx

Strict

Framework Openb3d.B3dglgraphics

Graphics3D 800,600,0,2


Local camera:TCamera=CreateCamera()
PositionEntity camera,0,10,-25

Local light:TLight=CreateLight()

Local body:TMesh=CreateCube()
PositionEntity body,0,2,0
ScaleEntity body,6,1,6
EntityColor body,0,0,255

Local cube1:TMesh=CreateCube()
PositionEntity cube1,6,2,6

Local ball1:TMesh=CreateSphere()
PositionEntity ball1,6,0,6
EntityColor ball1,255,255,0

Local cube2:TMesh=CreateCube()
PositionEntity cube2,6,2,-6

Local ball2:TMesh=CreateSphere()
PositionEntity ball2,6,0,-6
EntityColor ball2,255,255,0

Local cube3:TMesh=CreateCube()
PositionEntity cube3,-6,2,6

Local ball3:TMesh=CreateSphere()
PositionEntity ball3,-6,0,6
EntityColor ball3,255,255,0

Local cube4:TMesh=CreateCube()
PositionEntity cube4,-6,2,-6

Local ball4:TMesh=CreateSphere()
PositionEntity ball4,-6,0,-6
EntityColor ball4,255,255,0

Local test%=2 ' 1 constraints, 2 constraints &amp; rigidbody
If test
	Local c1:TConstraint=CreateConstraint(cube1,ball1,4)
	Local c2:TConstraint=CreateConstraint(cube2,ball2,4)
	Local c3:TConstraint=CreateConstraint(cube3,ball3,4)
	Local c4:TConstraint=CreateConstraint(cube4,ball4,4)
EndIf
If test=2
	Local rb:TRigidBody=CreateRigidBody(body,cube1,cube2,cube3,cube4)
EndIf

While Not KeyDown(KEY_ESCAPE)

	' control camera
	MoveEntity camera,KeyDown(KEY_D)-KeyDown(KEY_A),0,KeyDown(KEY_W)-KeyDown(KEY_S)
	TurnEntity camera,KeyDown(KEY_DOWN)-KeyDown(KEY_UP),KeyDown(KEY_LEFT)-KeyDown(KEY_RIGHT),0
	
	' move balls
	If KeyDown(KEY_Y) Then MoveEntity ball4,0,0.1,0
	If KeyDown(KEY_H) Then MoveEntity ball4,0,-0.1,0
	If KeyDown(KEY_U) Then MoveEntity ball3,0,0.1,0
	If KeyDown(KEY_J) Then MoveEntity ball3,0,-0.1,0
	If KeyDown(KEY_I) Then MoveEntity ball1,0,0.1,0
	If KeyDown(KEY_K) Then MoveEntity ball1,0,-0.1,0	
	If KeyDown(KEY_O) Then MoveEntity ball2,0,0.1,0
	If KeyDown(KEY_L) Then MoveEntity ball2,0,-0.1,0
	
	UpdateWorld 1 ' update physics
	RenderWorld
	
	Text 0,0,"WSAD/Arrows: move camera, YH/UJ/IK/OL: move rigidbody"
	Text 0,20,"body pitch="+EntityPitch(body)+" yaw="+EntityYaw(body)+" roll="+EntityRoll(body)
	
	Flip
	
Wend
End
</textarea> <br><br></td></tr></table><br>
<a name="1292994"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#161">[#161]</a></td></tr></table></td></tr><tr ><td class="posttext"> Of course the mesh is flattened: constraints are not connected!<br><br>A constraint will ONLY keep the same distance between two objects: you connect every cube to a ball, but you didn't put constraints between cubes, so every cube can change position relative to any other: and if the rigid body has to follow cubes, it is deformed.<br><br>You should create a constraint between every cube entity and each other (it means, 6 constraints), to connect them like the vertices of irregular tetrahedron (if you are not sure of the distance, use EntityDistance); it is an undeformable shape, and will make the rigid body undeformable, too. <br><br></td></tr></table><br>
<a name="1293060"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#162">[#162]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok thanks Angros, I created a constraint tetrahedron with 6 edges from 4 cubes and attached 4 spheres to those but the cube body is distorted into a parallelogram shape now. How can I retain the original shape of the mesh?<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">' rigidbody.bmx

Strict

Framework Openb3d.B3dglgraphics

Graphics3D 800,600,0,2


Local camera:TCamera=CreateCamera()
PositionEntity camera,0,10,-25

Local light:TLight=CreateLight()

Local body:TMesh=CreateCube()
PositionEntity body,0,2,0
ScaleEntity body,6,1,6
EntityColor body,0,0,255
EntityAlpha body,0.5

Local toppiv:TMesh=CreateCube()
PositionEntity toppiv,0,6,0

Local topball:TMesh=CreateSphere()
PositionEntity topball,0,4,0
EntityColor topball,255,255,0

Local rightpiv:TMesh=CreateCube()
PositionEntity rightpiv,6,2,-6

Local rightball:TMesh=CreateSphere()
PositionEntity rightball,6,0,-6
EntityColor rightball,255,255,0

Local frontpiv:TMesh=CreateCube()
PositionEntity frontpiv,0,2,6

Local frontball:TMesh=CreateSphere()
PositionEntity frontball,0,0,6
EntityColor frontball,255,255,0

Local leftpiv:TMesh=CreateCube()
PositionEntity leftpiv,-6,2,-6

Local leftball:TMesh=CreateSphere()
PositionEntity leftball,-6,0,-6
EntityColor leftball,255,255,0

Local test%=2 ' 1 constraints, 2 constraints &amp; rigidbody
If test
	Local c1:TConstraint=CreateConstraint(toppiv,rightpiv,EntityDistance(toppiv,rightpiv))
	Local c2:TConstraint=CreateConstraint(toppiv,leftpiv,EntityDistance(toppiv,leftpiv))
	Local c3:TConstraint=CreateConstraint(toppiv,frontpiv,EntityDistance(toppiv,frontpiv))
	Local c4:TConstraint=CreateConstraint(frontpiv,rightpiv,EntityDistance(frontpiv,rightpiv))
	Local c5:TConstraint=CreateConstraint(frontpiv,leftpiv,EntityDistance(frontpiv,leftpiv))
	Local c6:TConstraint=CreateConstraint(rightpiv,leftpiv,EntityDistance(rightpiv,leftpiv))
	
	Local c7:TConstraint=CreateConstraint(toppiv,topball,2)
	Local c8:TConstraint=CreateConstraint(frontpiv,frontball,2)
	Local c9:TConstraint=CreateConstraint(rightpiv,rightball,2)
	Local c10:TConstraint=CreateConstraint(leftpiv,leftball,2)
EndIf
If test=2
	Local rb:TRigidBody=CreateRigidBody(body,toppiv,rightpiv,frontpiv,leftpiv)
EndIf

While Not KeyDown(KEY_ESCAPE)

	' control camera
	MoveEntity camera,KeyDown(KEY_D)-KeyDown(KEY_A),0,KeyDown(KEY_W)-KeyDown(KEY_S)
	TurnEntity camera,KeyDown(KEY_DOWN)-KeyDown(KEY_UP),KeyDown(KEY_LEFT)-KeyDown(KEY_RIGHT),0
	
	' move balls
	If KeyDown(KEY_Y) Then MoveEntity leftball,0,0.1,0
	If KeyDown(KEY_H) Then MoveEntity leftball,0,-0.1,0
	If KeyDown(KEY_U) Then MoveEntity frontball,0,0.1,0
	If KeyDown(KEY_J) Then MoveEntity frontball,0,-0.1,0
	If KeyDown(KEY_I) Then MoveEntity topball,0,0.1,0
	If KeyDown(KEY_K) Then MoveEntity topball,0,-0.1,0	
	If KeyDown(KEY_O) Then MoveEntity rightball,0,0.1,0
	If KeyDown(KEY_L) Then MoveEntity rightball,0,-0.1,0
	
	UpdateWorld 1 ' update physics
	RenderWorld
	
	Text 0,0,"WSAD/Arrows: move camera, YH/UJ/IK/OL: move rigidbody"
	Text 0,20,"body pitch="+EntityPitch(body)+" yaw="+EntityYaw(body)+" roll="+EntityRoll(body)
	
	Flip
	
Wend
End
</textarea> <br><br></td></tr></table><br>
<a name="1293076"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#163">[#163]</a></td></tr></table></td></tr><tr ><td class="posttext"> The first cube must be in the center of the mesh (I mean the 0,0,0 relative coords... with FitMesh, it might not be the real center). The other three cubes must be, respectively, forward, up, and on the right (or left): they will define three axis, that can define position and rotation of the mesh; if the three axis are not perpendicular, the mesh is distorted; if one axis is longer than others, the mesh will be longer/larger. <br><br>Actually, the coordinates of these four points are used to build a matrix, that is directly applied to the rigid body (all the stuff about scaling, rotations and position is bypassed) <br><br></td></tr></table><br>
<a name="1293185"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#164">[#164]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks again Angros, I have a working rigidbody now. It's pretty cool but I notice the rigidbody mesh gets distorted as the constraints are moved, so it looks like it's made of jelly. I decided to get around this I could get the angle of each axis and position of the center and apply it to the mesh without using a rigidbody. I'm also wondering how I can apply this to make a kart with four wheels moving about a terrain.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">' rigidbody.bmx

Strict

Framework Openb3d.B3dglgraphics

Graphics3D 800,600,0,2


Local camera:TCamera=CreateCamera()
PositionEntity camera,0,5,-20

Local light:TLight=CreateLight()

Local body:TMesh=LoadMesh("media/teapot.b3d")
'Local body:TMesh=CreateCube()
'ScaleEntity body,6,6,6
EntityColor body,0,255,255
EntityAlpha body,0.5

Local centeraxis:TMesh=CreateCube()
PositionEntity centeraxis,0,0,0
EntityColor centeraxis,255,255,0

'Local centerpivot:TMesh=CreateSphere()
'PositionEntity centerpivot,0,0.001,0

Local xaxis:TMesh=CreateCube()
PositionEntity xaxis,6,0,0
EntityColor xaxis,255,0,0

Local xpivot:TMesh=CreateSphere()
PositionEntity xpivot,6,0,0

Local yaxis:TMesh=CreateCube()
PositionEntity yaxis,0,6,0
EntityColor yaxis,0,255,0

Local ypivot:TMesh=CreateSphere()
PositionEntity ypivot,0,6,0

Local zaxis:TMesh=CreateCube()
PositionEntity zaxis,0,0,6
EntityColor zaxis,0,0,255

Local zpivot:TMesh=CreateSphere()
PositionEntity zpivot,0,0,6

Local test%=2 ' 1 constraints, 2 constraints &amp; rigidbody
If test
	Local c1:TConstraint=CreateConstraint(centeraxis,xaxis,EntityDistance(centeraxis,xaxis))
	Local c2:TConstraint=CreateConstraint(centeraxis,zaxis,EntityDistance(centeraxis,zaxis))
	Local c3:TConstraint=CreateConstraint(centeraxis,yaxis,EntityDistance(centeraxis,yaxis))
	Local c4:TConstraint=CreateConstraint(yaxis,xaxis,EntityDistance(yaxis,xaxis))
	Local c5:TConstraint=CreateConstraint(yaxis,zaxis,EntityDistance(yaxis,zaxis))
	Local c6:TConstraint=CreateConstraint(xaxis,zaxis,EntityDistance(xaxis,zaxis))
	
	'Local c7:TConstraint=CreateConstraint(centeraxis,centerpivot,0.001)
	Local c8:TConstraint=CreateConstraint(xaxis,xpivot,0.001)
	Local c9:TConstraint=CreateConstraint(yaxis,ypivot,0.001)
	Local c10:TConstraint=CreateConstraint(zaxis,zpivot,0.001)
EndIf
If test=2
	Local rb:TRigidBody=CreateRigidBody(body,centeraxis,xaxis,yaxis,zaxis)
EndIf

While Not KeyDown(KEY_ESCAPE)

	' control camera
	MoveEntity camera,KeyDown(KEY_D)-KeyDown(KEY_A),0,KeyDown(KEY_W)-KeyDown(KEY_S)
	TurnEntity camera,KeyDown(KEY_DOWN)-KeyDown(KEY_UP),KeyDown(KEY_LEFT)-KeyDown(KEY_RIGHT),0
	
	' move balls
	If KeyDown(KEY_Y) Then MoveEntity xpivot,0,0.1,0
	If KeyDown(KEY_H) Then MoveEntity xpivot,0,-0.1,0
	If KeyDown(KEY_U) Then MoveEntity ypivot,0.1,0,0
	If KeyDown(KEY_J) Then MoveEntity ypivot,-0.1,0,0
	If KeyDown(KEY_I) Then MoveEntity zpivot,0,0.1,0
	If KeyDown(KEY_K) Then MoveEntity zpivot,0,-0.1,0
	'If KeyDown(KEY_O) Then MoveEntity centerpivot,0,0.1,0
	'If KeyDown(KEY_L) Then MoveEntity centerpivot,0,-0.1,0
	
	UpdateWorld 1 ' update physics
	RenderWorld
	
	Text 0,0,"WSAD/Arrows: move camera, YH/UJ/IK/OL: move rigidbody"
	Text 0,20,"body pitch="+EntityPitch(body)+" yaw="+EntityYaw(body)+" roll="+EntityRoll(body)
	
	Flip
	
Wend
End
</textarea> <br><br></td></tr></table><br>
<a name="1293279"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#165">[#165]</a></td></tr></table></td></tr><tr ><td class="posttext"> Constraints are used to build a sort of "skeleton": you should use four pivot to control the rigid body (I. E. The kart), but this is the bare minimum: you can add other pivots on the angles, and on the four wheels, and link them to the structure.<br><br>Let's say you have four wheels: you set collision with ground for each one, then you create a constraint between each wheel and each other  (constraints will for a rectangle with diagonals ), providing an invisible "frame" for the car. Try it, and you will see that the wheels will act as in a real car. Then, you can add to the frame other pivot, and use them with a rigid body to draw the car chassis. <br><br></td></tr></table><br>
<a name="1293284"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#166">[#166]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok thanks I will try that.<br><br>Btw, Spinduluz is working on a fork of openb3d.mod <a href="https://github.com/Spinduluz/openb3d.mod/commits/Cleanup" target="_blank">HERE</a>. He's added DDS textures and zip archives via koriolis.zipstream. <br><br></td></tr></table><br>
<a name="1293663"></a>

<a name="1293664"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FBEpyon</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#167">[#167]</a></td></tr></table></td></tr><tr ><td class="posttext"> @munch / agros47 - Is there a way to add a function for getting ScreenToWorldPoint(camera:TCamera, x:Int, y:int, z:Int)?<br><br>Return Function:<br><br>WorldPointX()<br>WorldPointY()<br>WorldPointZ()<br><br>The only reason I ask is I'm trying to do a mouse drag on an orthographic projection to move my map around, and there is no way to just grab the position of the mouse and translate it into screen location with out interacting with another entity.<br><br>Unity3D uses something similar to this called ScreenToWorldPoint: <a href="http://docs.unity3d.com/ScriptReference/Camera.ScreenToWorldPoint.html" target="_blank">http://docs.unity3d.com/ScriptReference/Camera.ScreenToWorldPoint.html</a><br><br>Sorry to bother you on this, but figured it would be a nice feature of the camera entity, or if you have another solution that would be great..<br><br>Thanks,<br><br>FBEpyon <br><br></td></tr></table><br>
<a name="1293666"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#168">[#168]</a></td></tr></table></td></tr><tr ><td class="posttext"> Doesn't CameraPick work for that?<br>Have a quad pickable before the CameraPick and then hide it after the pick. <br><br></td></tr></table><br>
<a name="1293685"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FBEpyon</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#169">[#169]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have played with the CameraPick() many of times, but it requires a mesh to interact with.  <br><br>I even tried putting a plane on the screen and picked the vertex from that plane to see were in the World_Space I was and then re-hide it. Didn't seem to work very well (could of done something wrong though).<br><br>ScreenToWorldPoint takes the ScreenX / ScreenY and transforms it into World_Space X/Y/Z for you without any form of interaction with another entity.<br><br>Also forgot to mention this is really only useful for Orthographic projection, which was mentioned earlier. This is because in normal frustum mode you would use LinePick, CameraPick, Etc.  Orthographic doesn't really care about depth other than object Z-Ordering.<br><br>Thanks,<br><br>FBEpyon <br><br></td></tr></table><br>
<a name="1293756"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#170">[#170]</a></td></tr></table></td></tr><tr ><td class="posttext"> CameraPick can work on terrains, too, not only on meshes.<br><br>Converting 2d screen coordinates to world coordinates with no entity is pointless,  because every screen location could map to infinite world locations : in a simple orthographic projection, the point in the middle of the screen could map to coordinates 0,0,0 as well as 0,0,1 (any value of z will project on the same pixel), so how can it be converted?<br><br>Anyway, in an orthographic projection you can just map x and x to world coordinates, and add camera coordinates to get absolute position. <br><br></td></tr></table><br>
<a name="1294379"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Spinduluz</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#171">[#171]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>Ok thanks I will try that.<br><br>Btw, Spinduluz is working on a fork of openb3d.mod HERE. He's added DDS textures and zip archives via koriolis.zipstream. <br> <br></div><br><br>These are actually the small changes done to OpenB3D.<br>I've put a lot of effort to ensure that objects are actually freed when you free them.<br><br>It's a cool library but it's plauged with memory/resource leaks. (Yeah I know it's in beta stage but still)<br>While this is not a problem for small demos and such it might be a problem in larger projects.<br><br>Especially if resources are updated often and the game/application should be able to run for hours.<br><br>But like I said. Still a cool library. <br><br></td></tr></table><br>
<a name="1294389"></a>

<a name="1294390"></a>

<a name="1294391"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#172">[#172]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well thanks a lot for your improvements, Spinduluz! I will be happy to add them all to my repo. <br><br>I meant to mention about the memory leak fixes but forgot. As you said, an important issue in big projects. <br><br></td></tr></table><br>
<a name="1294414"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#173">[#173]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have some problems with LinePick and PickedNX().<br>If the LinePick radius is set to anything greater than 0 and the pick starts really close/inside a wall, PickedNX/Y/Z will return odd values.<br>It's easy to test by LinePicking every frame and going through a wall, make sure LinePick radius is greater than 0, the higher the better.<br>If radius is 0 everything works just fine.<br>It's causing some issues with my sliding collision code.<br><br>I'll make an example of this if needed, but it might take a day or two as I'm not by the computer.<br><br>Oh and the same problem exists in MiniB3D. <br><br></td></tr></table><br>
<a name="1294543"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#174">[#174]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here's an example of it, run it from your Examples folder.<pre class=code>SuperStrict
Framework openb3d.B3dglgraphics

Graphics3D(1280, 720, 0, 2)

Local cam:TCamera = CreateCamera()
PositionEntity cam, 150, 40, -187

Local light:TLight=CreateLight(1)
RotateEntity light,90,0,0

Local mesh:TMesh=LoadMesh("../media/test.b3d")
ScaleMesh mesh, 10, 10, 10
EntityPickMode(mesh, 2)

Local lastPick:TEntity
Local lastNX:Float

While Not KeyDown(KEY_ESCAPE)
	MoveEntity(cam, 0, 0, 0.025)
	
	lastPick = LinePick(EntityX(cam), EntityY(cam), EntityZ(cam), 0, 0, 2, 5)
	If lastPick Then lastNX = PickedNZ()
	
	RenderWorld()
	Text(GraphicsWidth() / 2, GraphicsHeight() / 2, "PickedNZ = " + lastNX)
	
	Flip(1)
	
	'End demo
	If EntityZ(cam) &gt;= - 181 Then End
Wend
End
</pre> <br><br></td></tr></table><br>
<a name="1294694"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#175">[#175]</a></td></tr></table></td></tr><tr ><td class="posttext"> I also have a request for the future.<br>With MiniB3D you didn't have to create a graphics window for things to run.<br>That was perfect for things like dedicated servers.<br>But with OpenB3D it just crashes if no window is created.<br>Is that something that could be fixed in the future? <br><br></td></tr></table><br>
<a name="1294700"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#176">[#176]</a></td></tr></table></td></tr><tr ><td class="posttext"> Minib3d uses the graphic library of Blitz max,  that creates it's window. OpenB3D is language independent, so it can't use specific features  (in Freebasic the routine that creates a window is different from BlitzMax, for example ) <br><br></td></tr></table><br>
<a name="1295170"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#177">[#177]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay...<br>Well what's up with PickedNX()? (example above) <br><br></td></tr></table><br>
<a name="1295221"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#178">[#178]</a></td></tr></table></td></tr><tr ><td class="posttext"> does the linepick problem occur even in Blitz3d? <br><br></td></tr></table><br>
<a name="1295222"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#179">[#179]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry, I've never used Blitz3D so I have no idea.<br>But the normals shouldn't be any different no matter how deep into the wall I go anyways. <br><br></td></tr></table><br>
<a name="1295225"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#180">[#180]</a></td></tr></table></td></tr><tr ><td class="posttext"> Radius is unrelated with how deep you go into the wall; to define how deep you go, you need to use the three picking directions. Radius means the "thickness" of the picking line (if radius is greater than 0, the picking line becomes a cylinder); with a picking cylinder, picking can happen on many points of a surface at the same time, so exact picking coordinates and normals become meaningless (but you can still know the picked entity).<br><br>Anyway, why did you use LinePick instead of EntityPick? In your example I think EntityPick would be simpler to use. <br><br></td></tr></table><br>
<a name="1295228"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#181">[#181]</a></td></tr></table></td></tr><tr ><td class="posttext"> I know what radius is and sure I could have used EntityPick heh.<br>I'm just showing you a way to make the PickedNX() function bug out.<br>The walls normal doesn't ever change, but according to PickedNX it does change, which is incorrect. <br><br></td></tr></table><br>
<a name="1295229"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#182">[#182]</a></td></tr></table></td></tr><tr ><td class="posttext"> The collision routine is the same used for standard collision tests, so I don't know where the bug could be. I'd need to know if original Blitz3D has the same behavior. <br><br></td></tr></table><br>
<a name="1295243"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#183">[#183]</a></td></tr></table></td></tr><tr ><td class="posttext"> I tested with B3d and the example Hezkore made behaves the same as in Minib3d/Openb3d ie. it starts of -1.0 then as the camera moves the normal goes down to -0.25.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">;PickedNZ.bb

Graphics3D(1280, 720, 0, 2)
SetBuffer BackBuffer()

Local cam=CreateCamera()
PositionEntity cam, 150, 40, -187

Local light=CreateLight(1)
RotateEntity light,90,0,0

Local mesh=LoadMesh("media/test.b3d")
ScaleMesh mesh, 10, 10, 10
EntityPickMode(mesh, 2)

Local lastPick
Local lastNZ#


While Not KeyDown(1)
	MoveEntity(cam, 0, 0, 0.025)
	
	lastPick = LinePick(EntityX(cam), EntityY(cam), EntityZ(cam), 0, 0, 2, 5)
	If lastPick Then lastNZ = PickedNZ()
	
	RenderWorld()
	Text(GraphicsWidth() / 2, GraphicsHeight() / 2, "PickedNZ = " + lastNZ)
	
	Flip(1)
	
	;End demo
	If EntityZ(cam) &gt;= - 181 Then End
Wend
End
</textarea> <br><br></td></tr></table><br>
<a name="1295245"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#184">[#184]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, so I don't think it can be considered a bug, since Blitz3D has been used for years with no complaints about it; maybe this is not the most intuitive behavior, but it's consistent with legacy code.<br><br>Thank you for testing! <br><br></td></tr></table><br>
<a name="1295413"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Naughty Alien</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#185">[#185]</a></td></tr></table></td></tr><tr ><td class="posttext"> ..hi guys..i have trouble building openb3d modules..may i know requirements for successful build, please.. <br><br></td></tr></table><br>
<a name="1295416"></a>

<a name="1295417"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Cocopino</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#186">[#186]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Naughty Alien<br><br>Problem might be MingW:<br><a href="http://www.blitzmax.com/Community/posts.php?topic=95220" target="_blank">http://www.blitzmax.com/Community/posts.php?topic=95220</a> <br><br></td></tr></table><br>
<a name="1295428"></a>

<a name="1295429"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#187">[#187]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, it's probably an issue with the Mingw version or it could be the lib folder issue with legacy Bmx which the batch file is meant to resolve.<br><br>On win7 I use mingw 32bit 4.7.1 (not sure if it's tdm version) as I had trouble using 4.8.1 with legacy Bmx (will double-check that). Using Bmx NG I am using tdm gcc 4.8.1 64bit with no issues I can find. <br><br>I always used Brucey's Mingw guide but there's now a new howto by TomToad here: <a href="http://www.blitzmax.com/Community/posts.php?topic=105745" target="_blank">http://www.blitzmax.com/Community/posts.php?topic=105745</a><br><br>I will try to supply module binaries. I'll need to find out what version is compatible with legacy Bmx. <br><br></td></tr></table><br>
<a name="1295444"></a>

<a name="1295448"></a>

<a name="1295456"></a>

<a name="1295457"></a>

<a name="1295474"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RGR</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#188">[#188]</a></td></tr></table></td></tr><tr ><td class="posttext"> . <br><br></td></tr></table><br>
<a name="1295462"></a>

<a name="1295463"></a>

<a name="1295533"></a>

<a name="1295534"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#189">[#189]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Naughty Alien, I've uploaded the archive .a and preprocessed include .i files built with the same gcc version as legacy Bmx 1.50. So now as long as you haven't rebuilt brl/pub/maxgui mods with some other mingw version it should work, otherwise you'll need to make a clean install, or rebuild with gcc 4.6.1.<br><br>So the story is: I found out the gnu binutils ar and ld display the version with --version which was "2.21.1" for Bmx 1.50 this is then listed by Nuwen Mingw <a href="http://nuwen.net/mingw.html" target="_blank">HERE</a> which shows the gcc version was 4.6.1 at that time. This version is not available from Nuwen now but there is a working link to it <a href="/posts.php?topic=96946" target="_blank">HERE</a> by Armitage 1982. There is a version of gcc 4.6.1 by TDM <a href="https://sourceforge.net/projects/tdm-gcc/files/TDM-GCC%20Installer/Previous/1.1006.0/" target="_blank">HERE</a> which did build Openb3d but it's a slightly later version of binutils "2.21.53" which may cause conflicts, although it's probably fine I didn't want to use it. <br><br></td></tr></table><br>
<a name="1295540"></a>

<a name="1295542"></a>

<a name="1295973"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#190">[#190]</a></td></tr></table></td></tr><tr ><td class="posttext"> @RGR, your comment about Mingw being off-putting and the "crazy" module system were valid criticisms so no need to delete it. I have found Bmx a struggle and still do so I know what you mean. It would be nice to have a Mingw-less install of Bmx to encourage people to dip into Bmx more as it really is a nice language. I think I'll make one with selected 3rd-party modules. Edit: I decided this was a bad idea! Instead I wrote a new MinGW guide in Bmx tutorials.<br><br>Following the Bmx open-source thread <a href="/posts.php?topic=105045" target="_blank">HERE</a> it seems to work with tdm 5.0.1 now so will have to investigate. The official repo is source only but it has an installer. Edit: works well with 32 and 64 bit tdm 5.1.0. <br><br></td></tr></table><br>
<a name="1297392"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Cocopino</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#191">[#191]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi!<br><br>Is it possible to manipulate (rotate/scale) bones of an animated mesh?<br>I tried doing this with Findchild but it seems the rotation stored in the animation always prevails. For example, I'd like a character to look around during a walking animation by rotating the neck bone. <br><br></td></tr></table><br>
<a name="1297394"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >feeble1</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#192">[#192]</a></td></tr></table></td></tr><tr ><td class="posttext"> I would animate the head separately and then parent it to the neck bone, so that the character can look around while walking or standing.  You can rotate bones, but it is best (less problematic) in your modeling software. <br><br></td></tr></table><br>
<a name="1297396"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Cocopino</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#193">[#193]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmmm... but the model now consists of one group/mesh, so that would involve work using 3D tools I am not too skilled with. Also, would this not lead to a strangely looking mesh around the neck area?<br>And furthermore, the model also has jaw bones, to make him "talk", so if I'll probably run into the same problem again when trying to do that... <br><br></td></tr></table><br>
<a name="1297397"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >feeble1</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#194">[#194]</a></td></tr></table></td></tr><tr ><td class="posttext"> Perhaps, everyone's implementation will be a bit different.  It sounds a lot like you want to run multiple animations on the same model, I have no idea how to do this.  Unfortunately, the important part of game development seems to be hiding the hacky way you made things work ;) <br><br></td></tr></table><br>
<a name="1297398"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Cocopino</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#195">[#195]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, game development seems to need a lot more workarounds than normal programming :)<br><br>I have done this before however, and it was not hard at all. I could just animate a model, and set the rotation of a child entity manually during the animation. Might have been Leadwerks though instead of B3d/minib3d. <br><br></td></tr></table><br>
<a name="1297402"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#196">[#196]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's possible to manipulate bones, as long as you are using animation mode 4 (manual mode). <br><br></td></tr></table><br>
<a name="1297403"></a>

<a name="1297404"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Cocopino</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#197">[#197]</a></td></tr></table></td></tr><tr ><td class="posttext"> I would like to mimic this Blitz3D behavior (uses the well known zombie mesh):<br><br><pre class=code>
Graphics3D 1600,900

SetBuffer BackBuffer()
camera=CreateCamera()
zombie=LoadAnimMesh("zombie.b3d")
PositionEntity(camera,0,0,-50)
PointEntity(camera,zombie)

Animate (zombie,1,0.3)

Local joint1 = FindChild(zombie,"Joint8")
Local joint2 = FindChild(zombie,"Joint11")

While Not KeyHit(1)
	
	UpdateWorld
	
	RotateEntity(joint1,50,50,50)
	RotateEntity(joint2,50,50,50)
	
	RenderWorld
	Flip
	
Wend
</pre><br><br>Is that possible using openB3d? <br><br></td></tr></table><br>
<a name="1297410"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#198">[#198]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, it's possible with a trick: <br><br><pre class=code>
	i=i+.3
	SetAnimTime zombie,i: Animate (zombie,4)
	RotateEntity(joint1,50,50,50)
	RotateEntity(joint2,50,50,50)
	UpdateWorld
	
	RenderWorld
	Flip
</pre><br><br>Bones needs to be moved BEFORE the UpdateWorld command (differently from Blitz3D, in OpenB3D the mesh is not deformed according to bones unless UpdateWorld is called). But UpdateWorld would also execute the animation, so you cannot use animation mode 1; to still have the animation running, you need to set the frame manually (by using SetAnimTime), set again animation mode 4 (SetAnimTime by default set mode -1), perform your joint rotation, and THEN call UpdateWorld. <br><br></td></tr></table><br>
<a name="1297411"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Cocopino</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#199">[#199]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, that did it, thanks!<br><br>The following code worked as planned:<br><pre class=code>
Strict

Import openb3d.b3dglgraphics

Graphics3D 1600, 900

Local camera:TCamera = CreateCamera()
Local zombie:TMesh = LoadAnimMesh("zombie.b3d")

PositionEntity(camera, 0, 0, -50)
PointEntity(camera,zombie)

Local joint1:TEntity = FindChild(zombie, "Joint8")
Local joint2:TEntity = FindChild(zombie, "Joint11")

Local frame:Float = 0.0
While Not KeyHit(KEY_ESCAPE)

	frame:+0.3
	SetAnimTime (zombie, frame)
	Animate (zombie, 4)
	RotateEntity(joint1,50,50,50)
	RotateEntity(joint2,50,50,50)
	UpdateWorld()

	RenderWorld()
	Flip()
	
Wend
</pre> <br><br></td></tr></table><br>
<a name="1297485"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Cocopino</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#200">[#200]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is there also a trick I could use to attach a textured mesh to an animated character when the texture has been loaded with flag 2 (alpha), for example hair?<br><br>In Blitz3D, when using a semi transparent texture like this:<br><pre class=code>
local hair = LoadAnimMesh("hair.b3d")
local tex = LoadTexture("hair.png",2)
EntityTexture(hair,tex)
EntityParent(hair,character)
Animate(character)
</pre><br>,the hair would look fine from any angle.<br><br>When trying the same in openB3d, (part of) the hair mesh sometimes disappears/becomes invisible, e.g. when the camera is placed low to the ground or when the arm of the character gets in between the camera and the hair mesh.<br><br>Thanks again! <br><br></td></tr></table><br>
<a name="1297551"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#201">[#201]</a></td></tr></table></td></tr><tr ><td class="posttext"> I am not sure I have understand... maybe it is a problem of alpha sorting. Can you post a screenshot? <br><br></td></tr></table><br>
<a name="1297574"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Cocopino</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#202">[#202]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, it's probably an alpha sorting problem. <br>I will try to create a Blitz3d + OpenB3d example using the same assets and similar code. <br><br></td></tr></table><br>
<a name="1297579"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#203">[#203]</a></td></tr></table></td></tr><tr ><td class="posttext"> Meanwhile, try to set <pre class=code>EntityFX hair,32</pre> to force alpha sorting <br><br></td></tr></table><br>
<a name="1297668"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Cocopino</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#204">[#204]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Angros, I tried to create a small example but the problem did not occur on a very simple animated mesh with just one texture. <br>It only exists when the parent has textures with the alpha flag of it's own, but I can certainly work around that.<br><br>Thanks again! <br><br></td></tr></table><br>
<a name="1297732"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >feeble1</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#205">[#205]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just to report on the MinGW issue: 5.1.0 and 4.7.1 will not successfully build OpenB3D (running Windows 7).<br>It works great if I do not build the module and enable debug mode or if I use 4.6.1.<br>Not a big deal but the 0.8 version of the module seems to build just fine on all three. <br><br></td></tr></table><br>
<a name="1297739"></a>

<a name="1297740"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#206">[#206]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm, it worked for me. <br><br>You can only use MinGW 5.1.0 with OS Bmx (or Bmx NG), if you're using legacy Bmx you should use 4.6.1 of either Nuwen or TDM. 4.7.1 does seem to work but there may be some compiler conflicts as bmk and bcc were built with 4.6.1. <br><br></td></tr></table><br>
<a name="1297752"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >feeble1</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#207">[#207]</a></td></tr></table></td></tr><tr ><td class="posttext"> So far I have had the best and most consistent results with 4.6.1 TDM, even 4.7.1 TDM messes up now and then.  Its kind of fun to play around with though. <br><br></td></tr></table><br>
<a name="1298064"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Cocopino</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#208">[#208]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi, does FreeEntity work entirely as it should?<br>I've mocked up a small test (adjust mediadir as needed):<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
SuperStrict
Import openb3d.b3dglgraphics

SeedRnd(MilliSecs())

Graphics3D 1024, 768

Global mediadir:String = "../media/"

Global meshes:TMesh[8]
meshes[0] = LoadMesh(mediadir + "cactus2.b3d")
meshes[1] = LoadMesh(mediadir + "camel.b3d")
meshes[2] = LoadMesh(mediadir + "green_ufo.b3d")
meshes[3] = LoadMesh(mediadir + "grid.b3d")
meshes[4] = LoadMesh(mediadir + "teapot.b3d")
meshes[5] = LoadMesh(mediadir + "test.b3d")
meshes[6] = LoadMesh(mediadir + "tris.md2")
meshes[7] = LoadMesh(mediadir + "zombie.b3d")

For Local i:Int = 0 To meshes.Length - 1
	HideEntity(meshes[i])
Next

Local assets:TAsset[500]
For Local i:Int = 0 To 499
	assets[i] = New TAsset
Next

Local camera:TCamera = CreateCamera()
MoveEntity(camera, 50, 80, -100)
CameraRange(camera, 10, 250)
PointEntity(camera, meshes[0])

Local deadAssets:Int = 0
While Not KeyHit(KEY_ESCAPE)

	For Local i:Int = 0 To 499
		deadAssets = deadAssets + assets[i].Update()
	Next

	UpdateWorld()
	RenderWorld()

	Text 20, 20, deadAssets + " assets killed and reborn"
	Flip()

Wend

Type TAsset

	Field vx:Float
	Field vy:Float
	Field vz:Float
	
	Field enttype:Int
	Field ent:TEntity
	Field ticks2live:Int
	Field maxTTL:Int = 3

	Method New()
		Init()
	End Method

	Method Init()

		ent = CopyMesh(meshes[Rand(0, 7)])
		EntityColor(ent, Rand(1, 255), Rand(1, 255), Rand(1, 255))

		vx = Rnd() * 15.0
		vy = Rnd() * 15.0
		vz = Rnd() * 15.0

		ticks2live = maxTTL

	End Method

	Method Kill()

		FreeEntity(ent)
		Init()

	End Method

	Method Update:Int()

		ticks2live:-1
		
		Local killed:Int = 0
		If ticks2live &lt; 0 Kill() ;killed = 1
		MoveEntity(ent, vx, vy, vz)
		
		Return killed

	End Method
	

End Type
</textarea><br>but the program will slowly but surely eat up more ram. <br><br></td></tr></table><br>
<a name="1298073"></a>

<a name="1298074"></a>

<a name="1298075"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#209">[#209]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes there are memory leaks in FreeEntity, for one the brush is not freed, also the strings probably need freed too. More than that needs done I would think.<br><br>Also, posted this in another thread which may be useful to repost here.<br><br><i>Brucey's version of Openb3d hasn't been updated in yonks, so don't use it until he updates it to v1.1. My version (vanilla) now works in NG after Brucey's bug fixes (and maybe Brucey's), and vanilla Minib3d works too. So make sure you have the latest bcc source.</i> <br><br></td></tr></table><br>
<a name="1298081"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#210">[#210]</a></td></tr></table></td></tr><tr ><td class="posttext"> Actually, using your example with Task manager&gt;Resource monitor it only went from 40% used physical memory to 50% and leveled off at that, although I only tested for a few minutes. <br><br></td></tr></table><br>
<a name="1298097"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Cocopino</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#211">[#211]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, I made another test, a much simpler one. <br>This one just loads, and then destroys meshes ad infinitum.<br><br>Blitz3D version:<br><pre class=code>
Graphics3D 1024, 768, 32,2

Local cam=CreateCamera()
Local mesh = LoadMesh("media/zombie.b3d")
PositionEntity cam,0,10,-30

While Not KeyDown(1)

    FreeEntity(mesh)
    UpdateWorld()
    mesh = LoadMesh("media/zombie.b3d")
    UpdateWorld()
    
	RenderWorld()
	Flip()
	
Wend
</pre><br><br>OpenB3d (FreeBasic):<br><pre class=code>
#Include "openb3d.bi"

ScreenRes 1024,768,32,,&amp;h10002
Graphics3D 1024,768

var cam=CreateCamera()
var mesh = loadMesh("media/zombie.b3d")
PositionEntity cam,0,10,-30

While Not multikey(1)

    freeentity(mesh)
    UpdateWorld()

    mesh = loadMesh("media/zombie.b3d")
    UpdateWorld()

    RenderWorld()
	Flip()

Wend
</pre><br><br>The RAM taken by the Blitz3D version will stay around 25MB for a long time while the OpenB3D version will eventually crash because of taking more than 2GB.<br>Using assets like this will not happen in a real game of course but this still could pose a problem when there's lots of loading involved and/or the player will be playing for several hours. <br><br></td></tr></table><br>
<a name="1298101"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#212">[#212]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you replace the "LoadMesh" with "CreateMesh" it does not happen... maybe the issue is in model.cpp, not in FreeEntity. I've found some memory leaks in it... <br><br></td></tr></table><br>
<a name="1298139"></a>

<a name="1298146"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Naughty Alien</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#213">[#213]</a></td></tr></table></td></tr><tr ><td class="posttext"> ..for some reason, i cant get OB3D work..i guess its about compiler..can someone post me step by step tutorial, how to get it right with BMX?<br><br>EDIT:<br>Got it work..i have installed wrong MinGW... <br><br></td></tr></table><br>
<a name="1298145"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Cocopino</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#214">[#214]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Angros<br><div class="quote"> If you replace the "LoadMesh" with "CreateMesh" it does not happen <br></div><br>But CreateMesh creates a completely empty mesh, right? The things that stay in memory are more likely textures, brushes, child entities or other artifacts.<br><br>Is it possible to load animated, textured meshes and delete and reload them when needed without the program increasing in memory?<br><br>@Naughty Alien<br>I had the same problem at first. Solution in post #186 worked for me but maybe you should try the replies by Munch first. <br><br></td></tr></table><br>
<a name="1298152"></a>

<a name="1298153"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Naughty Alien</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#215">[#215]</a></td></tr></table></td></tr><tr ><td class="posttext"> ..this is rather minimalistic, but very nice little engine..what 3D formats are supported?? And animation wise, is it hardware or software skinning(if supported)? <br><br></td></tr></table><br>
<a name="1298174"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#216">[#216]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  i cant get OB3D work..i guess its about compiler..can someone post me step by step tutorial, how to get it right with BMX? <br></div><br>I wrote a MinGW install guide <a href="/posts.php?topic=105834" target="_blank">HERE</a>. To summarize, if using legacy Bmx use TDM 4.6.1, if OS Bmx (or Bmx NG) TDM 5.1.0 is probably best but whatever you prefer.<br><br><div class="quote"> what 3D formats are supported?? And animation wise, is it hardware or software skinning <br></div><br>It's basically Minib3d in C++ with extra bits from Warner engine (quats, terrain) and Extended (shader, shadow, md2) and some other features like particles (but no physics engine). <br><br>So formats are .3ds .x .b3d .md2 (no .bsp yet) and animation is software skinning, assuming hardware is writing a shader to load the bones. <br><br></td></tr></table><br>
<a name="1298184"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#217">[#217]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Cocopino<br><br>I mean, commands like CreateCube, CreateSphere seems not to trigger the memory leak. Instead, using CopyEntity does. I already found many leaks (i.e. in CopySurface, or in FreeEntity for bones). I'll work on it<br><br>@Naughty Alien<br>B3D is fully supported, and so MD2 (but you need to texture it manually, because PCX textures aren't supported). 3DS is partially supported (no animations), and so DirectX .X (no animation, text format only, and only version 0302). <br><br>Animations use software skinning (maybe it's slower, but works everywhere), plus a special hardware mode taken from the MiniB3D Monkey port: all frames are pre-calculated in software, then loaded in the video memory: it's less smooth, since there is no tweening, but it requires almost no computation neither from the CPU, nor from the GPU; it uses more video memory, but makes instancing possible, so if you have many copies of the same mesh, it could actually use less memory) <br><br></td></tr></table><br>
<a name="1298294"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Cocopino</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#218">[#218]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>I already found many leaks (i.e. in CopySurface, or in FreeEntity for bones). I'll work on it<br> <br></div><br><br>Thanks!<br>Can I be of assistance, e.g. would it be helpful to write a program showing which commands do not "clean up well"? <br><br></td></tr></table><br>
<a name="1298789"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#219">[#219]</a></td></tr></table></td></tr><tr ><td class="posttext"> There are too many fixes needed, listing all of them here is impractical. So, I release the version 1.12 that contains all the patches.<br><br><a href="https://sourceforge.net/projects/minib3d/files/" target="_blank">https://sourceforge.net/projects/minib3d/files/</a> <br><br></td></tr></table><br>
<a name="1298845"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Cocopino</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#220">[#220]</a></td></tr></table></td></tr><tr ><td class="posttext"> Angros... you're the man!<br><br>Tested the example in #211 again and memory hardly goes up at all, but instead stays within the same regions as the Blitz3D version does. Many thanks, that must have been pretty boring work ;) <br><br></td></tr></table><br>
<a name="1299105"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#221">[#221]</a></td></tr></table></td></tr><tr ><td class="posttext"> Updated the wrapper for 1.12 fixes. Thanks Angros! <br><br></td></tr></table><br>
<a name="1299114"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Cocopino</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#222">[#222]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks both! <br><br></td></tr></table><br>
<a name="1299123"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BlitzMan</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#223">[#223]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi guys<br>Is this wrapper stable enough at the moment to actually make a game with,or<br>should i wait a while longer.<br><br>Good Job Guys<br><br>thnx <br><br></td></tr></table><br>
<a name="1299136"></a>

<a name="1299138"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >feeble1</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#224">[#224]</a></td></tr></table></td></tr><tr ><td class="posttext"> @munch  Would you take additions to your examples folder?<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">'CopyBrush Example

SuperStrict

Import openb3d.B3dglgraphics

Graphics3D 800,600,0,2

Local cam:TCamera=CreateCamera()
PositionEntity cam,0,0,-10

Local light:TLight=CreateLight()

Local Mesh:TMesh=CreateCube()
Local grass:TBrush=CreateBrush(20,80,20)
PaintMesh(Mesh,grass)

PositionMesh Mesh,-5,0,0

Local Brush:TBrush, Surface:TSurface

Local MeshCopy:TMesh = CopyMesh(Mesh)

For Local SurfIndex:Int = 1 To CountSurfaces(MeshCopy)
	Local Surface2:TSurface = GetSurface(MeshCopy,SurfIndex)

	Local Brush2:TBrush = GetSurfaceBrush(Surface2)	
	Brush = CopyBrush(Brush2, Surface2)
Next

FreeEntity MeshCopy

Local box:TMesh = CreateCube()
PaintMesh(box,Brush)
PositionEntity box,5,0,0

While Not KeyDown(KEY_ESCAPE)		
	RenderWorld
	
	Text 140,200,"The Original."
	
	Text 560,200,"The New Mesh."
	
	Flip
Wend
End
</textarea><br><br>Also, what the odds of getting an AddSurface or FreeSurface command?<br><br>I absolutely love CopyBrush btw! <br><br></td></tr></table><br>
<a name="1299137"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#225">[#225]</a></td></tr></table></td></tr><tr ><td class="posttext"> Updated again with FreeObject fixes. <br><br>Two questions Angros:<br>- where is the "Bug that made particles crash" fix<br>- why are you using in global.cpp ClearWorld "Global::root_ent-&gt;FreeEntity()" instead of "Global::root_ent-&gt;child_list.clear()"<br><br>@BlitzMan, it's pretty stable now since these updates, there may be a few issues yet though. <br><br></td></tr></table><br>
<a name="1299214"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#226">[#226]</a></td></tr></table></td></tr><tr ><td class="posttext"> 1) This one:<br><a href="http://www.blitzbasic.com/Community/post.php?topic=105082&amp;post=1284809" target="_blank">http://www.blitzbasic.com/Community/post.php?topic=105082&amp;post=1284809</a><br><br>It wasn't yet fixed in the vanilla version<br><br>2) because FreeEntity also deletes objects,  calling their destructor,  and is recursive <br><br></td></tr></table><br>
<a name="1299215"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Cocopino</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#227">[#227]</a></td></tr></table></td></tr><tr ><td class="posttext"> @BlitzMan<br><br>If you were planning on using minib3d or Blitz3D otherwise - go for it! <br>As you can see it's still being updated, that's the biggest advantage, and it's much faster, and much more portable (OpenGL vs DX7) than Blitz3d. Command set is almost exactly the same so porting would be very easy should it fail. Also, only real users can make it better.<br><br>You could start with writing some small proof of concept programs taking away your biggest "will it work?" fears. (at least, that's what I plan to do) <br><br></td></tr></table><br>
<a name="1299219"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >feeble1</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#228">[#228]</a></td></tr></table></td></tr><tr ><td class="posttext"> There are far more commands in OpenB3D than in Blitz3D! <br><br></td></tr></table><br>
<a name="1299277"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#229">[#229]</a></td></tr></table></td></tr><tr ><td class="posttext"> @feeble1, thanks I'll add it but it has uncovered a bug with CopyBrush (error: free(): invalid pointer - delete object that's not there) and I'm not sure what is going on there so need to investigate.<br><br>@Angros, thanks I had the fix for 1. For 2 I just can't see how you can add new entities after ClearWorld. Shouldn't you have a root_ent=new after the FreeEntity?<br><br>Also, I'll be splitting the wrapper into 2 mods soon, Blitz3d and extended functions, just so it is easier to read the help. <br><br></td></tr></table><br>
<a name="1299287"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#230">[#230]</a></td></tr></table></td></tr><tr ><td class="posttext"> Actually, ClearWorld is seldom used, so I never tested it. Maybe you need to add a line like:<br><br><pre class=code>Global::root_ent=new Pivot();</pre><br><br>after the FreeEntity.<br><br>What is the bug in CopyBrush? <br><br></td></tr></table><br>
<a name="1299288"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#231">[#231]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well what I'm doing is in function.cpp<br><pre class=code>void ReplaceBrush(Brush* brush, Brush* brush2){
	if(brush!=NULL) delete brush;
printf("replacebrush=%p\n",brush);
	brush=brush2;
	return;
}</pre><br>And then in openb3dlib.bmx<br><pre class=code>Function CopyBrush:TBrush( brush:TBrush,surf:TSurface )
	Local brush2:TBrush=brush.Copy()
	ReplaceBrush_( TBrush.GetInstance(surf.brush),TBrush.GetInstance(brush2) )
	surf.brush=brush2
	Return brush2
End Function</pre><br>And then running the copybrush example by feeble1 it errors with free() invalid pointer in ubuntu (but seems ok in win) but if I comment out the FreeEntity line its fine. After debugging it seems the pointer for surf-&gt;brush in data.cpp is slightly different to the one created in Surface::Surface. <br><br></td></tr></table><br>
<a name="1299436"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >feeble1</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#232">[#232]</a></td></tr></table></td></tr><tr ><td class="posttext"> It seems to run fine in Win 7, but seems to randomly error when threaded.  Not consistent enough to show where. <br><br></td></tr></table><br>
<a name="1299671"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Cocopino</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#233">[#233]</a></td></tr></table></td></tr><tr ><td class="posttext"> What is the accepted, or the least resource intensive, way to use a fullscreen (not single mesh) shader effect? <br>Do I need to use CameraToTex and then render that texture to a sprite, does anyone have an example?<br><br>Thanks! <br><br></td></tr></table><br>
<a name="1299672"></a>

<a name="1299673"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#234">[#234]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Cocopino<br><a href="https://bitbucket.org/Hezkore/shader-camera" target="_blank">https://bitbucket.org/Hezkore/shader-camera</a><br>I haven't tested it since last year, so it might not work with newer versions. <br><br></td></tr></table><br>
<a name="1299674"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Cocopino</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#235">[#235]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks, I will look into that :) <br><br></td></tr></table><br>
<a name="1299761"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Cocopino</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#236">[#236]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Hezkore,<br><br>If I change the example by texturing Mesh2, or by using a loaded model instead of CreateCone(), ShaderCamera does not render anything anymore, it's just a black screen. The regular camera still works fine (showing the textured cone).<br><br>I did not look at the code too closely but does it work like this:<br>1. render the main camera to texture<br>2. texture a sprite using this texture<br>3. use a shader on the sprite<br>4. show the sprite fullscreen with the second camera <br>?<br><br>Because if it does, I don't understand why it's not working... Any ideas? <br><br></td></tr></table><br>
<a name="1301537"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RustyKristi</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#237">[#237]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey munch, I was wondering if there's this sl_dof.bmx example included. I would like to check that out and seems I can't find any good links. It was mentioned here by you.<br><br><a href="http://www.blitzbasic.com/Community/post.php?topic=102556&amp;post=1246878" target="_blank">http://www.blitzbasic.com/Community/post.php?topic=102556&amp;post=1246878</a><br><br>Thanks. <br><br></td></tr></table><br>
<a name="1301552"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#238">[#238]</a></td></tr></table></td></tr><tr ><td class="posttext"> That was added a while ago as sl_depthfield.bmx - I got the shader from source by klepto and used it instead of another I have as it was faster and seemed to look better but I don't think it's as pronounced as some dof pics I've seen so some work still needed. <br><br></td></tr></table><br>
<a name="1301558"></a>

<a name="1301559"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RustyKristi</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#239">[#239]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ah right thanks, that will do! :D This is awesome btw <br><br></td></tr></table><br>
<a name="1301561"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RustyKristi</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#240">[#240]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey munch,<br><br>I have noticed that when you activate the postfx examples, the camera kinda steps back away a bit. It's not a big deal, but just curious as to why.<br><br>thanks again. <br><br></td></tr></table><br>
<a name="1301580"></a>

<a name="1301581"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#241">[#241]</a></td></tr></table></td></tr><tr ><td class="posttext"> I did that because sl_shimmer was visibly wrapping the pixels top/bottom so I just moved the sprite in a bit to cover that as I didn't know how to clamp uvs in the shader code. It's not needed in sl_depthfield so maybe I'll change it. So just change this line to 1.<br><pre class=code>MoveEntity screensprite,0,0,0.99 ' just under 1.0, instead of clamping uvs</pre> <br><br></td></tr></table><br>
<a name="1301616"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RustyKristi</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#242">[#242]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks munch! works great :D <br><br></td></tr></table><br>
<a name="1301884"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RustyKristi</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#243">[#243]</a></td></tr></table></td></tr><tr ><td class="posttext"> Quick question munch, may I ask how do you load or combine multiple postfx on the screensprite? aside from doing it on the shader file which obviously requires a bit more knowledge. <br><br></td></tr></table><br>
<a name="1301946"></a>

<a name="1301947"></a>

<a name="1301948"></a>

<a name="1301949"></a>

<a name="1301950"></a>

<a name="1301951"></a>

<a name="1301953"></a>

<a name="1302110"></a>

<a name="1302245"></a>

<a name="1302246"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#244">[#244]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've made this function that updates the Max2D canvas correctly when using OpenB3D.<br>And doesn't have that annoying bug where for a few frames the Max2D canvas is incorrect after a resize.<br>It also doesn't assume that your canvas is covering the entire window.<br>So instead of this:<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">

Type TResize

	Global resized%=False
	
	Function PopResize()
	
		resized = True
		BeginMax2D() ' pop old values
		
	End Function
	
	Function DoResize(win:TGadget,can:TGadget,cam:TCamera)
	
		If resized = True
			BeginMax2D()
			SetGraphics CanvasGraphics(can)
			SetViewport 0,0,ClientWidth(win),ClientHeight(win)
			EndMax2D() ' push new values
			
			CameraViewport cam,0,0,ClientWidth(win),ClientHeight(win)
			TGlobal.width[0]=ClientWidth(win) ' values used in texture rendering
			TGlobal.height[0]=ClientHeight(win)
			resized=False
		EndIf
		
	End Function
	
End Type</textarea><br><br>And all that "TResize.PopResize()" and "TResize.DoResize(win,can,cam)" stuff.<br>You can instead just call this before rendering.<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">

Function UpdateCanvas(can:TGadget, cam:TCamera)
	SetGraphics(CanvasGraphics(can))
	If TGlobal.width[0] &lt;&gt; ClientWidth(can) Or TGlobal.height[0] &lt;&gt; ClientHeight(can)
		BeginMax2D()
		SetViewport(0, 0, ClientWidth(can), ClientHeight(can))
		EndMax2D()
		
		CameraViewport(cam, 0, 0, ClientWidth(can), ClientHeight(can))
		TGlobal.width[0] = ClientWidth(can)
		TGlobal.height[0] = ClientHeight(can)
	EndIf
EndFunction</textarea> <br><br></td></tr></table><br>
<a name="1302226"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#245">[#245]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just downloaded the newest version and it's crashing on a lot of random places.<br>FreeVBO seems to be the cause of most crashes. <br><br></td></tr></table><br>
<a name="1302229"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#246">[#246]</a></td></tr></table></td></tr><tr ><td class="posttext"> What was your previous version?<br><br>I doubt I can reproduce, so try previous commits <a href="https://github.com/markcwm/openb3d.mod/commits/master" target="_blank">here</a> until it's fixed and post the commit date. <br><br></td></tr></table><br>
<a name="1302230"></a>

<a name="1302231"></a>

<a name="1302232"></a>

<a name="1302233"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#247">[#247]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm not sure what version the old one was...<br>But it happens quite often with my "Tile Maker" (tilemaker.bmx) which you can find at: <a href="https://bitbucket.org/Hezkore/retro-dungeon-crawler" target="_blank">https://bitbucket.org/Hezkore/retro-dungeon-crawler</a><br>Jump to line 67 and uncomment "FreeEntity(mesh)" <br><br></td></tr></table><br>
<a name="1302238"></a>

<a name="1302239"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#248">[#248]</a></td></tr></table></td></tr><tr ><td class="posttext"> Also, I'm wondering if there's any way to remove the filtering on textures?<br>I'd like small textures to be big pixels instead of smoothed.<br>ClearTextureFilters() doesn't help. <br><br></td></tr></table><br>
<a name="1302254"></a>

<a name="1302255"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#249">[#249]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Also, what the odds of getting an AddSurface or FreeSurface command?<br><br>I absolutely love CopyBrush btw!  <br></div><br>I've added Add/FreeSurface not tested. CopyBrush/Texture/Surface are now wrappers for Copy so they just return a copy. I was going to add ReplaceBrush/Tex/Surf but I realized this creates a problem either you cause a memory leak or you delete something that may be in use. So that is better managed by the end program.<br><br><div class="quote"> Quick question munch, may I ask how do you load or combine multiple postfx on the screensprite?  <br></div><br>Openb3d only uses one framebuffer object (there may be a reason) so you have to use CameraToTex every time you want to render another pass with a shader. I'm sure this is slower than using two FBOs but I don't know how to add this.<br><br><div class="quote">  I've made this function that updates the Max2D canvas correctly when using OpenB3D. <br></div><br>Thanks, I added your function, what was I thinking!<br><br><div class="quote">  Also, I'm wondering if there's any way to remove the filtering on textures? <br></div><br>I'm sure this is the tex.flag set in LoadTexture (which doesn't seem to be working when I set it which may be a problem with pointers in the wrapper) this sets glTexParameter GL_LINEAR which should disable mipmaps but it doesn't seem to work. <br><br></td></tr></table><br>
<a name="1302273"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RustyKristi</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#250">[#250]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Openb3d only uses one framebuffer object (there may be a reason) so you have to use CameraToTex every time you want to render another pass with a shader. I'm sure this is slower than using two FBOs but I don't know how to add this. <br></div><br><br>Thanks munch, I don't mind trying it so how would you go about in rendering another pass in OpenB3D? It seems I am stuck with "currentTexture" and got no clue how to line up another shader texture to camera.<br><br><br><pre class=code>Local shader:TShader=LoadShader("","shaders/shadervert.glsl", "shaders/shaderfrag.glsl")
ShaderTexture(shader,colortex,"currentTexture",0) 
ShadeEntity(screensprite, shader)

...

While
...
CameraToTex colortex, camera
...
Wend</pre> <br><br></td></tr></table><br>
<a name="1302375"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#251">[#251]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I'm sure this is the tex.flag set in LoadTexture (which doesn't seem to be working when I set it which may be a problem with pointers in the wrapper) this sets glTexParameter GL_LINEAR which should disable mipmaps but it doesn't seem to work. <br></div><br><br>Is that something angros will have to fix? <br><br></td></tr></table><br>
<a name="1302406"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#252">[#252]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Openb3d only uses one framebuffer object (there may be a reason)  <br></div><br><br>The reason is just that I added the command CameraToTex with the purpose to render on textures (i.e. for cubemapped reflections), not with shader tricks in mind, and so one FBO was enough. Also, it made the syntax very simple: just one command, with two parametes (the camera, and the texture). It's possible to add more FBOs, of course, but syntax would become quirky and incompatible with current one, breaking down some existing code. Also, to make a generic, all purpose command, being able to use many FBO is not enough, you'd need to be able to set what you want in each of them (one with colors only, one with normal mapping only, one with depth buffer only... or maybe one with colors and depth buffer, one with normal and stencil buffer, and so on). It could be done, but how the syntax of such a command would be? Understanding it might be harder than re-writing a specific render for the single purpose one wants. Anyway, if someone has any suggestions, I'll see what can be done. <br><br></td></tr></table><br>
<a name="1302418"></a>

<a name="1302419"></a>

<a name="1302420"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#253">[#253]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well the CameraToTex frame parameter is not used so this could be changed to flags to support new options with zero being the current code. Just expanding it to allow 2 (or 3 at the most) FBOs for postfx shaders like bloom and 2-pass blur would be enough for me, there's already a working depthbuffertotex example and I can't see anyone needing a stencilbuffertotex. I was trying to do a 2-pass postfx shader but haven't got it working yet (it sort of fails after a while) but fps was better than I expected. <br><br></td></tr></table><br>
<a name="1302422"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angros47</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#254">[#254]</a></td></tr></table></td></tr><tr ><td class="posttext"> And how could it return all the FBO needed? As texture frames, maybe? Currently, there is no easy way to access specific frames of a texture from a shader.<br><br>Or maybe, a new class could be added, that contains FBO arrays, to be used only with shaders. And a command CameraToFBO, or something similar. <br><br></td></tr></table><br>
<a name="1302423"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#255">[#255]</a></td></tr></table></td></tr><tr ><td class="posttext"> Actually, I've just managed to get a 2 pass postfx shader going (see sl_shimmer2.bmx) and the fps is okay 11 (vs 17 for 1 shader) on ubuntu so I think this will do fine! <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
