<!DOCTYPE html><html lang="en" ><head ><title >Email from NVidia about BlitzMax graphics</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Email from NVidia about BlitzMax graphics</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=103" >OpenGL Module</a>/<a href="#bottom" >Email from NVidia about BlitzMax graphics</a><br><br>
<a name="925184"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I had a problem with undeleted FBOs causing the application to hang upon exit here:<br><a href="http://developer.nvidia.com/forums/index.php?showtopic=2454" target="_blank">http://developer.nvidia.com/forums/index.php?showtopic=2454</a><br><br>This is something one of the NVidia driver engineers sent me.  I thought this might be of interest to the Blitz crew.  I am pretty sure I am calling glDeleteFrameBuffers correctly.  Maybe that is something BMX is doing internally?:<br><div class="quote"> Hey Josh,<br> <br>I figured out what was going on our end.  During your sample app's termination, you invoke exit().  You seem to have an atexit callback that cleans up your resources, and after that, exit calls ExitProcess.  ExitProcess uses a big hammer to smash stuff, and that's where the problem pops up.<br> <br>The app creates two contexts, but then only uses the second one created, such as FBO management.  Then you delete that second context during application exit.  However, that first context is never deleted.  It only really matters because the app also calls wglShareLists between the two contexts, which unifies not only their display list namespace, but their FBO namespace too.  That really isn't well documented anywhere, but at this point, it's expected behavior.  It is kinda ridiculous (imo), but it is mentioned in issue 76 of the FBO EXT spec: <a href="http://opengl.org/registry/specs/EXT/framebuffer_object.txt" target="_blank">http://opengl.org/registry/specs/EXT/framebuffer_object.txt</a><br> <br>So when you call wglDeleteContext on that second context, you aren't actually destroying the FBOs you created, since they still exist to the first context.<br> <br>After that point, as I mentioned, ExitProcess gets called, and that calls into our DLL to notify us that the app process is about to detach.  Our bug/problem here is that we try to do some cleanup here, when we shouldn't be.  When ExitProcess is called, MS recommends doing nothing, and letting the OS clean up.  We had been trying to clean up before, and it had worked out ok for the most part, but in this case, there was some stuff with cleaning up the FBOs and some threads that didn't play nice (we were looking for stuff that got annihilated by ExitProcess before calling into our DLL).  We'll get this bug fixed.<br> <br>On your side, you can remedy this for yourself by just deleting all contexts you created during your exit time, instead of just the second context.  Or, you can not call wglShareLists if you don't plan on actually sharing resources.  I didn't see your sample app ever use the first context.  That may not be indicative of your real life usage though.<br> <br>BTW, I don't think your nobug.exe app is correct.  I think it was working because it might have been crapping out without you catching the exception (or maybe because you called glDeleteFramebuffers while handling another exception).  It calls glDeleteFramebuffers by passing the FBO name directly in as a parameter, when it should be passing in a pointer to the FBO name.  So when you tried to delete FBO 8, the app is doing this:<br> <br>    glDeleteFramebuffers(1, 8);<br> <br>When it should be doing this:<br> <br>    unsigned int name = 8; // I'm just plugging this in here<br>    glDeleteFramebuffers(1, &amp;name);<br> <br>Let me know if deleting that other context/not sharing does the trick for you. <br></div> <br><br></td></tr></table><br>
<a name="925442"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ShadowTurtle</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> this means... opengl = application killer? ;) <br><br></td></tr></table><br>
<a name="925582"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> So you were just missing like an EndGraphics() call or something? <br><br></td></tr></table><br>
<a name="925676"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ian Thompson</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Have you checked if the deleted named framebuffer has now got its name removed after the call, if it has the OpenGL is quite happy with your call? <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
