<!DOCTYPE html><html lang="en" ><head ><title >SetPixelFormat() fails on canvases</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >SetPixelFormat() fails on canvases</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=103" >OpenGL Module</a>/<a href="#bottom" >SetPixelFormat() fails on canvases</a><br><br>
<a name="716957"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> The windows command SetPixelFormat() fails when used on a Canvas gadget.  It works correctly on a panel gadget.  Why is this significant?<br><br>-Canvas gadgets generate GADGET_PAINT events.  Panels no not.  Therefore, only a canvas can tell you if another window has been dragged over the viewport (and that the viewport needs to be redrawn).<br><br>-SetPixelFormat() is necessary to change color depth, antialias mode, and stencil settings.  You can't just rely on a pixel format chosen internally by Blitz.<br><br>SetPixelFormat can only be used once on any hdc.  After that, the gadget/control must be recreated for a new SetPixelFormat to be called.  Presumably, Blitz sets the pixel format internally when a canvas is created.  Subsequent calls to set the pixel format of the canvas' hDC will therefore fail.  The solution would be to add an optional flag to the CreateCanvas() function, which skips setting the pixel format, allowing the user to set their own. <br><br></td></tr></table><br>
<a name="716960"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> well... Can you change the pixel colour depth at all? Are you saying you can change it on a Panel? (Stupid question, cos you are)<br><br>I dont think this is a bug, the Cavas needs to be the same format as the window, but the panel doesnt, because it is drawn onto a canvas and so its format is converted on drawing. (But im not good at gui at all, do only shout a little bit if Im wrong) <br><br></td></tr></table><br>
<a name="716963"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Use the flags parameter with your initial call to SetGraphicsDriver to control the properties of the context created with CanvasGraphics.<br><br>Casting the result of CanvasGraphics to TGLGraphics will give you access to the context, which I assume you can use for more messing about. <br><br></td></tr></table><br>
<a name="716969"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I edited my original post.  SetPixelFormat() can only be called once on any dc.  After that, you have to create a new window and get the dc.  You cannot call SetPixelFormat() twice on any dc.  For example, to change antialias modes, you have to destroy the viewport panel, create a new one, and set the pixel format with the new antialias mode.  I am guessing that by the time I get the handle of a canvas, Blitz has already internally set the pixel format, disallowing me to set it again.<br><br>By the way, to add AntiAliasing to Blitz GL graphics, you just add these values when you call wglChoosePixelFormat(), where antialiasmode is 0,2,4,8 or 16:<br>WGL_SAMPLE_BUFFERS_ARB,GL_TRUE,WGL_SAMPLES_ARB,antialiasmode <br><br></td></tr></table><br>
<a name="716997"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> All I have to do is add an antialias flag to the graphics module.  Open the file glgraphics.win32.c and find the flags at the beginning, and make them look like this:<br><pre class=code>enum{
	_BACKBUFFER=	0x2,
	_ALPHABUFFER=	0x4,
	_DEPTHBUFFER=	0x8,
	_STENCILBUFFER=	0x10,
	_ACCUMBUFFER=	0x20,
	_ANTIALIAS2X=	0x40,
	_ANTIALIAS4X=	0x80,
	_ANTIALIAS8X=	0x100,
	_ANTIALIAS16X=	0x200,
};</pre><br><br>Now anywhere the code says ChoosePixelFormat(), we want to use wglChoosePixelFormatARB().<br><br>wglChoosePixelFormatARB is an extension.  You have to retrieve the function pointer with wglGetProcAddress().  Here is an example of another extensio file being called in the same source file:<br><pre class=code>typedef BOOL (APIENTRY * WGLSWAPINTERVALEXT) (int);

static int _setSwapInterval( int n ){
	WGLSWAPINTERVALEXT 	wglSwapIntervalEXT=(WGLSWAPINTERVALEXT)wglGetProcAddress("wglSwapIntervalEXT");
	if( wglSwapIntervalEXT ) wglSwapIntervalEXT( n );
}</pre><br><br>I need to convert the antialias flags into a multisample value, but I can't make sense enough of C gibberish to do that.  In basic it would just be this:<br><pre class=code>If (_ANTIALIAS2X &amp; flags) multisample=2
If (_ANTIALIAS4X &amp; flags) multisample=4
If (_ANTIALIAS8X &amp; flags) multisample=8
If (_ANTIALIAS16X &amp; flags) multisample=16</pre><br><br>Finally, the function wglChoosePixelFormatARB has additional parameters.  In my own code, it gets called like this:<br><pre class=code>wglChoosePixelFormatARB(hDC,[WGL_DRAW_TO_WINDOW_ARB,GL_TRUE,WGL_SUPPORT_OPENGL_ARB,GL_TRUE,WGL_ACCELERATION_ARB,WGL_FULL_ACCELERATION_ARB,WGL_COLOR_BITS_ARB,24,WGL_ALPHA_BITS_ARB,8,WGL_DEPTH_BITS_ARB,16,WGL_DOUBLE_BUFFER_ARB,GL_TRUE,WGL_SAMPLE_BUFFERS_ARB,GL_TRUE,WGL_SAMPLES_ARB,multisample,0,0],[0.0,0.0],1,Varptr lPixelFormat,Varptr numFormats)</pre><br><br>So there you have it.  Pretty easy to set up, but my limited knowledge of C prevents me from doing it.  If this were set up correctly, Max GL graphics could have an optional antialias flag when initialized. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
