<!DOCTYPE html><html lang="en" ><head ><title >Some Monkey stuff.</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Some Monkey stuff.</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=512" >Monkey Code</a>/<a href="#bottom" >Some Monkey stuff.</a><br><br>
<a name="2032248"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FelipeA</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is some stuff I got laying around which are Pixel Collision and Sockets. Don't get excited, It doesn't work so good, at least the pixel collision doesn't, and sockets( as client ) only work for flash and android.<br><br>Here you can see an example of the pixel collision:<br><a href="http://shin.cl/pixelcollision/" target="_blank">http://shin.cl/pixelcollision/</a><br><br>For the pixel collision I used diddy's GetPixel(), and it only works on flash and html5, but html5 gets 0 fps when testing collision.<br><br>I tried 2 methods, one was drawing one image frist then getting all pixels of the intersecting rectangle and the draw the second image, finally compare them and check if they are colliding. The second method was drawing both images with and offset and then compare pixels. This one runs a bit better, but still lags a lot.<br><br><br>And here you can see a chat made with the socket module, runs on flash and android.<br><a href="http://shin.cl/crosschat/" target="_blank">http://shin.cl/crosschat/</a><br><br>I was actually building a crossplatform MMO but I got stucked on the server part. The demo is running on an Adobe Air ServerSocket App.<br><br>Here you can get the code:<br><a href="https://github.com/ilovepixel/MonkeyStuff" target="_blank">https://github.com/ilovepixel/MonkeyStuff</a><br><br>All this isn't perfectly coded, as I am no programmer but It can probably help someone else, or even improve it.<br>:) <br><br></td></tr></table><br>
<a name="2032246"></a>

<a name="2033127"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FelipeA</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I update this post as I've added to my monkeystuff repo a small bitmap module, only working on flash and html5.<br><br>With this bitmap module you can grab an image an load it to a bitmap or create a bitmap o copy from the canvas. You can also render other bitmaps into your bitmap. It also has a simple get and set pixel.<br>The flash version has pixel-perfect collision.<br><br>Here you can see a demo:<br><a href="http://shin.cl/bitmap" target="_blank">http://shin.cl/bitmap</a><br><br>And you can get the module from:<br><a href="https://github.com/ilovepixel/MonkeyStuff/tree/master/bitmap" target="_blank">https://github.com/ilovepixel/MonkeyStuff/tree/master/bitmap</a> <br><br></td></tr></table><br>
<a name="2033132"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Beaker</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Great. Will definitely find a use for the bitmap render stuff. <br><br></td></tr></table><br>
<a name="2033143"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> y u got santa claus penis on the demo :0<br><br>The flash version doesnt work here, I am using a computer with an old version of flash on it (cant upgrade) so maybe thats why <br><br></td></tr></table><br>
<a name="2033145"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paul - Taiphoz</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> collisions work really well here..<br><br>I would love to see a more intense collisions example tho, something that we can use as a water mark for how well it will perform in a game. <br><br></td></tr></table><br>
<a name="2033245"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> checked it with a different pc and it works on flash too, good one,<br><br>This is actually useful, cos someone might want to copy a tiled background as one image, i wonder what the best way of doing scrolling would be using that method<br><br>do you have the source code to the demo?<br><br>basically i want to grab an image from the canvas and draw it back to the canvas <br><br></td></tr></table><br>
<a name="2033244"></a>

<a name="2033262"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FelipeA</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've updated  the demo for the bitmap module, It's  a simple shoot the enemys with pixel collision checking on every bullet and enemy and the rock at the background.<br>I'll upload the code for the demo and also update the module in a couple of hours as I need some sleep.<br><br>here is the demo:<br><a href="http://shin.cl/bitmap" target="_blank">http://shin.cl/bitmap</a> <br><br></td></tr></table><br>
<a name="2033315"></a>

<a name="2033316"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FelipeA</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've uploaded the code for the demo here:<br><a href="https://github.com/ilovepixel/MonkeyStuff/blob/master/bitmap/demo/main.monkey" target="_blank">https://github.com/ilovepixel/MonkeyStuff/blob/master/bitmap/demo/main.monkey</a><br><br>I've also updated the bitmap module and added a method called ClearPixel()<br>which can be seen in action on the demo, when for example the bullet collides with the big rock thing, or the red space ships.<br>To the demo I've added a small SetPixel effect to the ships which can be disabled by pressing E key.<br><a href="http://shin.cl/bitmap/" target="_blank">http://shin.cl/bitmap/</a><br><br>I was looking into making an android version of the module but I know nothing of java or opengl. <br><br></td></tr></table><br>
<a name="2033318"></a>

<a name="2033319"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >NoOdle</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> great job and thank you for sharing, I have some ideas I'd like to try out and I will need this. Any plans to make an IOS version too? <br><br></td></tr></table><br>
<a name="2033328"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> I tried making a little demo to test grabbing an image from the screen:<br><br><pre class=code>
Strict
Import ilovepixel.bitmap
Import mojo
Const wall_tile_height:Int=8
Const wall_tile_width:Int=8
Const walk_up_limit:Int=88
Global the_camera:camera

Function Main:Int()
New mygame
Return 0
End Function

Class mygame Extends App

Method OnCreate:Int()
SetUpdateRate 40
the_camera=New camera
Return 0
End Method

Field b:Bitmap

Method OnUpdate:Int()
If KeyDown(KEY_RIGHT)
the_camera.x+=1
Endif
If KeyHit(KEY_SPACE)
b=New Bitmap()
b.MakeBitmapData(30,30,True,255,255, 255)
b.x=0
b.y=0
b.CopyFromCanvas(0,0,30,30)
b.x=30
b.y=30
Endif
Return 0
End Method

Method OnRender:Int()
Cls
PushMatrix()
Local switch:Bool
Scale 1,1
For Local x:Int=0 To 64
For Local y:Int=0 To 48
If switch=True
SetColor(0,255,255)
switch=False
Else
SetColor(200,255,255)
switch=True
Endif
DrawRect(x*10,y*10,10,10)
Next
Next

If b&lt;&gt;Null
Print "rendering"
b.RenderToApp()
Endif
Return 0
End Method

End Class

Class camera
Field x:Int
Field y:Int
End Class

</pre><br><br>but it crashes, only html5 produces an error message <br><br></td></tr></table><br>
<a name="2033323"></a>

<a name="2033331"></a>

<a name="2033332"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FelipeA</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello, sorry about that. I've already uploaded the fixed CopyFromCanvas(), I have also added a function to get and set pixels from the canvas and not the bitmap, that way you don't have to create a new bitmap to do it, for example:<br>[monkeycode]<br>Bitmap.SetPixelApp(100,100,255,0,0)<br>Local colors:Int[] = Bitmap.GetPixelApp(100,100)<br>Print(colors[0]+","+colors[1]+","+colors[2]+","+colors[3])<br>[/monkeycode]<br><br>Here is a demo of how to use CopyFromCanvas():<br><br>The CopyFromCanvas should be run after the image or part of the canvas is rendered.<br><br>[monkeycode]<br>Import mojo<br>Import bitmap<br><br>Function Main:Int()<br>	New Grab()<br>	Return 0<br>End<br><br>Class Grab Extends App<br>	Field bit:Bitmap<br>	Field img:Image<br>	Field copied:Bool<br>	Method OnCreate:Int()<br>		img = LoadImage("img.png")<br>		bit = New Bitmap()<br>		bit.MakeBitmapData(50,50,False,255,0,0)<br>		copied = False<br>		SetUpdateRate(60)<br>		Return 0<br>	End<br>	<br>	Method OnUpdate:Int()<br>	<br>		Return 0<br>	End<br>	<br>	Method OnRender:Int()<br>		Cls(0, 0, 0)<br>		DrawImage(img, 100, 100)<br>		If( Not copied)<br>			bit.CopyFromCanvas(100, 100, img.Width(), img.Height())<br>			copied = True<br>		EndIf<br>		bit.RenderToApp()<br>		Return 0<br>	End<br>End<br>[/monkeycode]<br><br><br>About an IOS version, I don't know really, as don't know any C++. <br><br></td></tr></table><br>
<a name="2033335"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> it works on html5 now, but not on flash<br><pre class=code>Strict
Import ilovepixel.bitmap
Import mojo

Function Main:Int()
New mygame
Return 0
End Function

Class mygame Extends App

Method OnCreate:Int()
SetUpdateRate 40
Return 0
End Method

Field b:Bitmap

Method OnUpdate:Int()
If KeyHit(KEY_SPACE)
b=New Bitmap()
b.MakeBitmapData(30,30,True,255,255, 255)
b.x=0
b.y=0
b.CopyFromCanvas(0,0,29,29)

Endif
Return 0
End Method

Method OnRender:Int()
Cls
PushMatrix()
Local switch:Bool
Scale 1,1
For Local x:Int=0 To 64
For Local y:Int=0 To 48
If switch=True
SetColor(0,255,255)
switch=False
Else
SetColor(200,255,255)
switch=True
Endif
DrawRect(x*10,y*10,10,10)
Next
Next

If b&lt;&gt;Null
Print "rendering"
b.RenderToApp()

If b.x&lt;590
b.x+=1
Endif

Endif
Return 0
End Method

End Class

</pre><br><br>the flash version just freezes <br><br></td></tr></table><br>
<a name="2033333"></a>

<a name="2033334"></a>

<a name="2033338"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FelipeA</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> The flash debugger said that the bitmapDataSource was null, probably is because you are calling CopyFromCanvas before any drawing is done, or other theory would be that monkey disposes the canvas bitmapdata after the render loop, I really couldn't find what was giving problems.<br><br>Here I made an edit and called the method after everything was already drawn and it worked on flash and html5.<br><pre class=code>
Strict
Import bitmap
Import mojo

Function Main:Int()
	New mygame
	Return 0
End Function



Class mygame Extends App

	Field copy:Int
	
	Method OnCreate:Int()
		SetUpdateRate 40
		copy = 0
		Return 0
	End Method
	
	Field b:Bitmap
	
	
	
	Method OnUpdate:Int()
		If KeyHit(KEY_SPACE)
			copy = 1
		Endif
		Return 0
	End Method
	
	Method OnRender:Int()
		Cls
		PushMatrix()
		Local switch:Bool
		Scale 1,1
		For Local x:Int=0 To 64
			For Local y:Int=0 To 48
			If switch=True
				SetColor(0,255,255)
				switch = False
			Else
				SetColor(200,255,255)
				switch = True
			Endif
			DrawRect(x*10,y*10,10,10)
			Next
		Next
		
		If(copy = 1)
			b = New Bitmap()
			b.MakeBitmapData(30,30,True,255,255, 255)
			b.x=0
			b.y=0
			b.CopyFromCanvas(0, 0, 29, 29)
			copy = 0
		EndIf
		
		If b&lt;&gt;Null
			Print "rendering"
			b.RenderToApp()
			
			If b.x&lt;590
				b.x += 1
			Endif
			
		Endif

		Return 0
	End Method

End Class
</pre> <br><br></td></tr></table><br>
<a name="2033339"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FelipeA</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> A new example of fractal using FillRect(), apparently on html5 this is much faster than SetPixel()<br><br><a href="http://shin.cl/bitmap/mandelbrotset/" target="_blank">http://shin.cl/bitmap/mandelbrotset/</a><br><br><br>The original code is from:<br><a href="http://www.actionscript.org/resources/articles/614/1/Creating-a-Mandelbrot-set/Page1.html" target="_blank">http://www.actionscript.org/resources/articles/614/1/Creating-a-Mandelbrot-set/Page1.html</a><br><br>The monkeycode:<br><pre class=code>
Import mojo
Import bitmap

Function Main:Int()
	New Fract()
	Return 0
End

Class Fract Extends App
	Field bt:Bitmap
	Field cycle:Float
	Method OnCreate:Int()
		bt = New Bitmap()
		bt.MakeBitmapData(DeviceWidth(), DeviceHeight(), False, 0, 0, 0)
		cycle = 128
		
		DrawSet( -2, 1, - 1, 1)
		SetUpdateRate(60)
		Return 0
	End
	
	Method DrawSet:Void(rmin:Float, rmax:Float, imin:Float, imax:Float)
		Local rStep:Float = (rmax - rmin) / bt.width
		Local iStep:Float = (imax - imin) / bt.height
		
		Local r:Float
		Local i:Float
		
		For Local px:Int = 0 To bt.width
			r = rmin + px * rStep
			For Local py:Int = 0 To bt.height
				i = imin + py * iStep;
				
				Local color:Int[]
				Local cy:Int = GetCycle(r, i)
				If(cy = cycle)
					color =[0, 0, 0]
				Else
					color =[Int(cy + 90), Int(cy), Int(cy)]

				EndIf
				
				'bt.SetPixel(px, py, color[0], color[1], color[2])
				bt.FillRect(px, py, 1, 1, color[0], color[1], color[2])
			Next
		Next
		
	End
	
	Method GetCycle:Int(r:Float, i:Float)
		Local zr:Float = 0
		Local zi:Float = 0
		
		Local cr:Float = r
		Local ci:Float = i
		
		Local ozr:Float = 0
		Local ozi:Float = 0
		
		Local zrsq:Float = 0
		Local zisq:Float = 0
		
		Local a:Int
		
		For a = 0 To cycle
			zi = ozr * ozi * 2 + ci
			zr = zrsq - zisq + cr
			zrsq = zr * zr
			zisq = zi * zi
			ozr = zr
			ozi = zi
			If( (zrsq + zisq) &gt; 4)
				Exit
			EndIf
		Next
		
		Return a
	End
	
	Method OnUpdate:Int()
		
		Return 0
	End
	
	Method OnRender:Int()
		Cls()
		bt.RenderToApp()
		Return 0
	End
End
</pre> <br><br></td></tr></table><br>
<a name="2033394"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> oh i see it is rendering code so it has to go in the Onrender method thanks! <br><br></td></tr></table><br>
<a name="2033427"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Samah</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> If/when you do render-to-surface for GLES targets you'd be better off using VBOs (GLES 2) and render directly to them rather than copying from the canvas. <br><br></td></tr></table><br>
<a name="2033571"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> flash acts a bit differently than html5<br>html only has one way of drawing images but flash has 2<br><br>	bitmapData.draw(scratch,mmatrix,colorTform,blend,clipRect,image_filtering_enabled);<br><br><br>and<br><br>bitmapData.copyPixels( surface.bitmap.bitmapData,srcrect,new Point( x,y ) );<br>		<br>so here is the new rendertoApp function for actionscript<br><pre class=code>		public function RenderToApp():void
	{
		if( app.graphics.matrix ){
			if( x!=0 || y!=0 ){
				//have to translate matrix! TODO!
				return;
			}
			app.graphics.bitmapData.draw(bitmap.bitmapData,app.graphics.matrix,app.graphics.colorTform,app.graphics.blend,app.graphics.clipRect,app.graphics.image_filtering_enabled );
		}else if( app.graphics.clipRect || app.graphics.colorTform || app.graphics.blend ){
			var mat:Matrix=new Matrix( 1,0,0,1,x,y );
			app.graphics.bitmapData.draw( bitmap.bitmapData,mat,app.graphics.colorTform,app.graphics.blend,app.graphics.clipRect,app.graphics.image_filtering_enabled );
		}else{
			app.graphics.bitmapData.copyPixels( bitmap.bitmapData,rect,new Point( x,y ) );
		}
	
	}</pre> <br><br></td></tr></table><br>
<a name="2033570"></a>

<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
