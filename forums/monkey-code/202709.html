<!DOCTYPE html><html lang="en" ><head ><title >Spriter Importer</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Spriter Importer</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=512" >Monkey Code</a>/<a href="#bottom" >Spriter Importer</a><br><br>
<a name="2049702"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> <b>[EDIT] Latest code can be downloaded from here:<br><a href="https://code.google.com/p/monkey-spriter-importer/" target="_blank">https://code.google.com/p/monkey-spriter-importer/</a><br>[/EDIT]</b><br><br>Based off the Libgdx version from here: <a href="http://www.badlogicgames.com/forum/viewtopic.php?f=17&amp;t=3863" target="_blank">http://www.badlogicgames.com/forum/viewtopic.php?f=17&amp;t=3863</a><br><br><b>You need Diddy's latest xml module:</b><br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
#TEXT_FILES="*.txt|*.xml|*.json|*.SCML"
Strict

Import diddy

Function Main:Int()
	New Game()
	Return 0
End

Class Game Extends App
	Field spriterObject:SpriterObject
	Field timeElapsed:Float = 0
	Field textures:TextureProvider
	
	Method OnCreate:Int()
		textures = New TextureProvider
		spriterObject = SpriterImporter.ImportFile("hero/BetaFormatHero.SCML", textures)
		
		SetUpdateRate(60)
		Return 0
	End
	Method OnUpdate:Int()
		Return 0
	End	
	Method OnRender:Int()
		Cls(255, 0, 255)
		timeElapsed+=0.06 'dx.graphics.getDeltaTime();
		SpriterDrawer.Draw(textures, spriterObject, "idle_healthy", timeElapsed*100 Mod 760, 100, 300);
	    SpriterDrawer.Draw(textures, spriterObject, "walk", timeElapsed*100 Mod 225, 300, 300);

		Return 0
	End
End

Class SpriterAnimation
	Field name:String
	Field frames:ArrayList&lt;SpriterAnimationFrame&gt;
	
	Method New()
		Self.frames = New ArrayList&lt;SpriterAnimationFrame&gt;
	End
	
	Method GetFrames:ArrayList&lt;SpriterAnimationFrame&gt;()
		Return Self.frames
	End
	
	Method AddFrame:Void(frame:SpriterAnimationFrame)
		Self.frames.Add(frame)
	End
	
	Method ToString:String()
		Return "";'"SpriterAnimation [name=" + name + ", frames=" + frames + "]"
	End
End

Class SpriterAnimationFrame
	Field frame:SpriterFrame
	Field duration:Float
	
	Method ToString:String()
		Return "SpriterAnimationFrame [frame=" + frame + ", duration=" + duration + "]"
	End	
End

Class SpriterFrame
	Field name:String
	Field sprites:ArrayList&lt;SpriterSprite&gt;
	
	Method New()
		Self.sprites = New ArrayList&lt;SpriterSprite&gt;
	End
	
	Method GetSprites:ArrayList&lt;SpriterSprite&gt;()
		Return Self.sprites
	End
	
	Method AddSprite:Void(sprite:SpriterSprite)
		Self.sprites.Add(sprite)
	End
	
	Method GetSpriteByObjectPart:SpriterSprite(objectPart:SpriterObjectPart)
		For Local i:Int = 0 To sprites.Size() -1
			Local sprite:SpriterSprite = sprites.Get(i)
			If sprite.objectPart = objectPart
				Return sprite
			End
		Next
		Return Null
	End
	
	Method GetSpriteByObjectPartPath:SpriterSprite(objectPart:SpriterObjectPart)
		'TODO
		Local searchPath:String = "" 'objectPart.textureName.substring(0, objectPart.textureName.indexOf("\\"));

		For Local i:Int = 0 To sprites.Size() - 1
			Local sprite:SpriterSprite = sprites.Get(i)
			Local curPath:String = ""'sprite.objectPart.textureName.substring(0, sprite.objectPart.textureName.indexOf("\\"));    		
    		
			If curPath = searchPath
				Return sprite
			End
		Next
		Return Null
	End
	
	Method ToString:String()
		Return ""'"SpriterFrame [name=" + name + ", sprites=" + sprites + "]"
	End	
End

Class SpriterObject
	Field basePath:String

	Field objectParts:StringMap&lt;SpriterObjectPart&gt;
	Field animations:StringMap&lt;SpriterAnimation&gt;
	
	Method New()
		Self.objectParts = New StringMap&lt;SpriterObjectPart&gt;
		Self.animations = New StringMap&lt;SpriterAnimation&gt;
	End
	
	Method GetObjectParts:StringMap&lt;SpriterObjectPart&gt;()
		Return objectParts
	End

	Method AddObjectPart:Void(objectPart:SpriterObjectPart)
		Self.objectParts.Add(objectPart.textureName, objectPart)
	End

	Method GetAnimations:StringMap&lt;SpriterAnimation&gt;()
		Return animations
	End

	Method AddAnimation:Void(animation:SpriterAnimation)
		Self.animations.Add(animation.name, animation)
	End

	Method ToString:String()
		Return ""'"SpriterObject [objectParts=" + objectParts + ", animations=" + animations + "]"
	End
End

Class SpriterObjectPart
	Field textureName:String
	Field originX:Float
	Field originY:Float
	
	Method ToString:String()
		Return ""'"SpriterObjectPart [textureName=" + textureName + ", originX=" + originX + ", originY=" + originY + "]"
	End
End

Class SpriterSprite
	Field objectPart:SpriterObjectPart
	Field colorBits:Float
	Field opacity:Float
	Field angle:Float
	Field x:Float
	Field y:Float
	Field width:Float
	Field height:Float

	Method ToString:String()
		Return ""'"SpriterSprite [objectPart=" + objectPart + ", colorBits=" + colorBits + ", opacity=" + opacity + ", angle=" + angle + ", x=" + x + ", y=" + y + ", width=" + width + ", height=" + height + "]"
	End
End

Class SpriterImporter
	Function ImportFile:SpriterObject(file:String, textures:TextureProvider)
		Local xmlReader:XMLParser = New XMLParser
		Local doc:XMLDocument = xmlReader.ParseString(LoadString(file))
		
		Print doc.Root.Children.Get(0).Parent.Name
		
		
		Local rootElement:XMLElement = doc.Root
		Local spriterObject:SpriterObject = New SpriterObject
		
		spriterObject.basePath = "hero\" 'file.path().replace(file.name(), "");
		'// import the objectParts with the hotspots
		
		Local xmlHotSpotArray:XMLElement = rootElement.GetFirstChildByName("hotspotarray")
		If (xmlHotSpotArray&lt;&gt;Null) Then
			For Local xmlHotSpot:XMLElement = Eachin xmlHotSpotArray.GetChildrenByName("hotspot")
				Local objectPart:SpriterObjectPart = New SpriterObjectPart
				objectPart.textureName = xmlHotSpot.GetFirstChildByName("filepath").Value()
				objectPart.originX = Float(xmlHotSpot.GetFirstChildByName("x").Value())
				objectPart.originY = Float(xmlHotSpot.GetFirstChildByName("y").Value())
				spriterObject.AddObjectPart(objectPart);
			Next
		Endif	
		
		'// Import the frames
		Local frames:StringMap&lt;SpriterFrame&gt; = New StringMap&lt;SpriterFrame&gt;
		For Local xmlFrame:XMLElement = Eachin rootElement.GetChildrenByName("frame")
			Local frame:SpriterFrame = New SpriterFrame
			frame.name = xmlFrame.GetFirstChildByName("name").Value
			For Local xmlSprite:XMLElement = Eachin xmlFrame.GetChildrenByName("sprite")
				Local sprite:SpriterSprite = New SpriterSprite
				sprite.objectPart = spriterObject.GetObjectParts().Get(xmlSprite.GetFirstChildByName("image").Value())
				If sprite.objectPart = Null Then ' create new object part
					Local objectPart:SpriterObjectPart = New SpriterObjectPart
					objectPart.textureName = xmlSprite.GetFirstChildByName("image").Value()
					textures.Load(spriterObject.basePath + objectPart.textureName)
					sprite.objectPart = objectPart
					spriterObject.AddObjectPart(objectPart)
				End
				sprite.colorBits = Float(xmlSprite.GetFirstChildByName("color").Value())
				sprite.opacity = Float(xmlSprite.GetFirstChildByName("opacity").Value())
				sprite.angle = Float(xmlSprite.GetFirstChildByName("angle").Value())
				If sprite.angle &lt; 0
					sprite.angle += 360
				End
				sprite.x = Float(xmlSprite.GetFirstChildByName("x").Value())
				sprite.y = Float(xmlSprite.GetFirstChildByName("y").Value())
				sprite.width = Float(xmlSprite.GetFirstChildByName("width").Value())
				sprite.height = Float(xmlSprite.GetFirstChildByName("height").Value())

				frame.AddSprite(sprite)
			Next
			frames.Add(frame.name, frame)
		Next
		
		'// Import the animations
		For Local xmlAnim:XMLElement = Eachin rootElement.GetFirstChildByName("char").GetChildrenByName("anim")
			Local animation:SpriterAnimation = New SpriterAnimation
			animation.name = xmlAnim.GetFirstChildByName("name").Value()
			For Local xmlFrame:XMLElement = Eachin xmlAnim.GetChildrenByName("frame")
				Local animationFrame:SpriterAnimationFrame = New SpriterAnimationFrame
				animationFrame.duration = Float(xmlFrame.GetFirstChildByName("duration").Value())
				Local text:String = xmlFrame.GetFirstChildByName("name").Value()
				animationFrame.frame = frames.Get(text)
				animation.AddFrame(animationFrame)
			Next
			spriterObject.AddAnimation(animation)
		Next
		
		Return spriterObject
	End
End

Class SpriterDrawer
	Function Draw:Void(textureProvider:TextureProvider, spriterObject:SpriterObject, animationName:String, keyTime:Float, offsetX:Float, offsetY:Float)
		Local spriterAnimation:SpriterAnimation = spriterObject.GetAnimations().Get(animationName)
		If spriterAnimation = Null Then
			Error("The given animationname:" + animationName + " does not exist in the animation")
		End
		Local frames:ArrayList&lt;SpriterAnimationFrame&gt; = spriterAnimation.GetFrames()
		Local currentFrame:SpriterAnimationFrame = Null
		Local nextFrame:SpriterAnimationFrame = Null
		Local curTime:Float = 0
		Local tweenFactor:Float = 0
		For Local i:Int = 0 To frames.Size() - 1
			Local animationFrame:SpriterAnimationFrame = frames.Get(i)
			If curTime &lt;= keyTime And curTime + animationFrame.duration &gt; keyTime
				currentFrame = animationFrame
				If i &lt; frames.Size() - 1
					nextFrame = frames.Get(i + 1)
				Else
					nextFrame = animationFrame
				End
				tweenFactor = (keyTime - curTime) / (animationFrame.duration)
				Exit
			End
			curTime += animationFrame.duration
		End
		If currentFrame= Null Then
			currentFrame = frames.Get(frames.Size() - 1)
			nextFrame = frames.Get(frames.Size() - 1)
		End
		
		'// iterate through all sprites And draw them
		Local sprites1:ArrayList&lt;SpriterSprite&gt; = currentFrame.frame.GetSprites()
		For Local i:Int = 0 To sprites1.Size() - 1
			Local sprite1:SpriterSprite = sprites1.Get(i)
			
			'// attention: Sprite uses an inverted y-axis: 0:0 is top left
			Local posX1:Float  = sprite1.x - sprite1.objectPart.originX + offsetX
			Local posY1:Float  = sprite1.y - sprite1.objectPart.originY + offsetY
			Local angle1:Float  = sprite1.angle
			
			Local posXTweened:Float
			Local posYTweened:Float
			Local angleTweened:Float
			'// perform tweening, If sprite occurs in next frame too
			Local sprite2:SpriterSprite = nextFrame.frame.GetSpriteByObjectPart(sprite1.objectPart)
			If sprite2 = Null '// no tweening possible
				posXTweened = posX1
				posYTweened = posY1
				angleTweened = angle1
			Else
				Local posX2:Float = sprite2.x - sprite2.objectPart.originX + offsetX
				Local posY2:Float = sprite2.y - sprite2.objectPart.originY + offsetY
				Local angle2:Float = sprite2.angle

				posXTweened = posX1 * (1 - tweenFactor) + posX2 * tweenFactor
				posYTweened = posY1 * (1 - tweenFactor) + posY2 * tweenFactor

				If (angle2 &gt; angle1)
					If (angle2 - angle1 &lt;= 180)
						angleTweened = angle1 * (1 - tweenFactor) + angle2 * tweenFactor
					Else
						angleTweened = (360 + angle1) * (1 - tweenFactor) + angle2 * tweenFactor
					End
				Else
					If (angle1 - angle2 &lt;= 180)
						angleTweened = angle1 * (1 - tweenFactor) + angle2 * tweenFactor
					Else
						angleTweened = angle1 * (1 - tweenFactor) + (360 + angle2) * tweenFactor
					End
				End
			End
			
			'// Lets draw!
			Local img:Image = textureProvider.GetTexture(spriterObject.basePath + sprite1.objectPart.textureName)
			Local x# = posXTweened
			Local y# = posYTweened
			Local rot# = angleTweened
			Local scaleX# = 1
			Local scaleY# = 1
			DrawImage img, x, y, rot, scaleX, scaleY
		End
	End	
End

Class TextureProvider Extends StringMap&lt;Image&gt;

	Method Load:Image(name:String)
		Local storeKey:String = name.ToUpper()

		Local i:Image = New Image
		Local imgName:String = name
		imgName = imgName.Replace("\", "/")
		
		i = LoadImage(imgName )', 1, flags)
		If i = Null
			Error "Error loading image "+name
		End
		'Print "storing "+storeKey
		Self.Set(storeKey, i)
		Return i
	End
	
	Method DisplayAllStored:Void()
		' debug: print all keys in the map
		For Local key:String = Eachin Self.Keys()
			Print key + " is stored in the map."
		Next
	End
	
	Method GetTexture:Image(name:String)
		name = name.ToUpper()
	   	
		Local i:Image= Self.Get(name)
		If i = Null Then Error("Image '" + name + "' not found in the TextureProvider")
		Return i
	End	
End
</textarea><br><br>It's not 100% yet, but it does load up the hero example: <a href="http://dl.dropbox.com/u/1013446/Spriter%20Releases/BetaFileFormatRelease/BetaFileFormatRelease.zip" target="_blank">http://dl.dropbox.com/u/1013446/Spriter%20Releases/BetaFileFormatRelease/BetaFileFormatRelease.zip</a><br><br>Running Example: <a href="http://www.therevillsgames.com/monkey/Spriter/MonkeyGame.html" target="_blank">http://www.therevillsgames.com/monkey/Spriter/MonkeyGame.html</a> <br><br></td></tr></table><br>
<a name="2027661"></a>

<a name="2027437"></a>

<a name="2027436"></a>

<a name="2027435"></a>

<a name="2027434"></a>

<a name="2027652"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John McCubbin</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Good work, I've backed the spriter project on kickstarter and am looking forward to using it for monkey and hopefully blitzmax too :) <br><br></td></tr></table><br>
<a name="2027651"></a>

<a name="2027655"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Soap</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Awesome! :D The page has been updated with Monkey listed: <a href="http://www.kickstarter.com/projects/539087245/spriter" target="_blank">http://www.kickstarter.com/projects/539087245/spriter</a> <br><br></td></tr></table><br>
<a name="2027653"></a>

<a name="2027658"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TheRedFox</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've backed Spriter as well. Cool to get this! <br><br></td></tr></table><br>
<a name="2027659"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wiering</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nice! <br>What am I doing wrong if I get 'Identifier "GetFirstChildByName" not found'? <br><br></td></tr></table><br>
<a name="2027660"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> What am I doing wrong if I get 'Identifier "GetFirstChildByName" not found'?  <br></div><br>You need Diddy's latest xml module...<br><br><a href="http://code.google.com/p/diddy/source/detail?r=393" target="_blank">http://code.google.com/p/diddy/source/detail?r=393</a><br><br>Add this to the xml.monkey file around line 565:<br><br><pre class=code>	Method GetFirstChildByName:XMLElement(findName:String)
		For Local element:XMLElement = EachIn children
			If element.name = findName Then Return element
		Next
		Return Null
	End</pre> <br><br></td></tr></table><br>
<a name="2027663"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Samah</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Get the latest xml.monkey from the repository.<br>Edit: Beat me to it. Stupid Gingerbread keyboard. :-) <br><br></td></tr></table><br>
<a name="2027662"></a>

<a name="2027664"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wiering</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks! <br><br></td></tr></table><br>
<a name="2027885"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Soap</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="http://dl.dropbox.com/u/1013446/Spriter%20Releases/wordpress/Procedural.pdf" target="_blank">http://dl.dropbox.com/u/1013446/Spriter%20Releases/wordpress/Procedural.pdf</a> <br><br></td></tr></table><br>
<a name="2029305"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Soap</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Update: <a href="http://www.brashmonkey.com/forum/viewtopic.php?f=2&amp;t=543" target="_blank">http://www.brashmonkey.com/forum/viewtopic.php?f=2&amp;t=543</a><br><br>"I’ve completed the candidate for the file format.  The format is a proposal for the final format of SCML" <br><br></td></tr></table><br>
<a name="2035116"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Soap</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="http://www.kickstarter.com/projects/539087245/spriter/posts/279445" target="_blank">http://www.kickstarter.com/projects/539087245/spriter/posts/279445</a> <br><br></td></tr></table><br>
<a name="2035478"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tibit</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> This tool is really cool! <br><br>I had totally missed this, I saw the kickstarter today, and then at the bottom saw "monkey" and I was soo suprised.<br><br>Nice work, will defiantly use this in many projects!! <br><br></td></tr></table><br>
<a name="2036573"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rob Pearmain</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Where is the latest download link, the existing one seems broken?<br><br>Thanks <br><br></td></tr></table><br>
<a name="2036577"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> The link to the beta format in the first post was controlled by the Spriter guys.<br><br>The code also needs to be updated to work with the newest version the spriter format. <br><br></td></tr></table><br>
<a name="2036787"></a>

<a name="2036788"></a>

<a name="2036789"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tibit</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here is the latest:<br><a href="http://www.kickstarter.com/projects/539087245/spriter/posts" target="_blank">http://www.kickstarter.com/projects/539087245/spriter/posts</a> (Update 17 Aug)<br><br>They allow you to pre-order on their site. I haven't started working with it in Monkey yet since they are still in an unstable Alpha state, tough it is looking really good and nice to see Monkey with early support thanks to therevills :) <br><br></td></tr></table><br>
<a name="2048089"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> WIP Update:<br><br><a href="http://www.therevillsgames.com/monkey/SpriterA4/MonkeyGame.html" target="_blank">http://www.therevillsgames.com/monkey/SpriterA4/MonkeyGame.html</a><br><br>TODO:<br>Tweening<br><strike>Timeline Updating</strike> <br><br></td></tr></table><br>
<a name="2048064"></a>

<a name="2048086"></a>

<a name="2048088"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just updated the demo, now uses the actual timing from the files and has timeline updating (so now more missing hair :P)... the monster moves slow as the animation is 2 seconds in length, it'll look better once tweening is done ;) <br><br></td></tr></table><br>
<a name="2048098"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >CopperCircle</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Looking good <br><br></td></tr></table><br>
<a name="2048128"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DGuy</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nicely done! <br><br></td></tr></table><br>
<a name="2048155"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nearly finished tweening, the monster looks 99% complete but the hero looks off...<br><br>Left side sprites are drawn per key frame and the right side sprites are drawn with tweening:<br><br><a href="http://www.therevillsgames.com/monkey/SpriterA4/MonkeyGame.html" target="_blank">http://www.therevillsgames.com/monkey/SpriterA4/MonkeyGame.html</a> <br><br></td></tr></table><br>
<a name="2048157"></a>

<a name="2048158"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jesse</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> whenever I change animation it glitches and does this:<br><img src="http://img843.imageshack.us/img843/5915/badimg.png"><br><br><br>Safari &amp; Chrome.<br><br>other than that it works quite nicely.<br><br><br><br>. <br><br></td></tr></table><br>
<a name="2048161"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >rIKmAN</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yep same as Jesse for me, left side works fine, right side characters explode when changing animations - Tested in Chrome.<br><br>Good work :) <br><br></td></tr></table><br>
<a name="2048163"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah I know about that one ;) Its due to the timing not being reset, if you leave a second or two the animation should go back to normal.<br><br>So whats the difference between these calculations:<br><pre class=code>Local tweenedX:Float = x1 + ((x2 - x1) * ((currentTime - timelineKey.time) / ( nextKeyTime - timelineKey.time))) </pre><br><br>with this:<br><pre class=code>Local t1:Float = currentTime - timelineKey.time
Local t2:Float = nextKeyTime - timelineKey.time
Local timeAmount:Float = t1 / t2
Local tweenedX:Float = x1 + ((x2 - x1) * timeAmount)</pre><br><br>I thought they were the same, but I had to expand the first one to the second one to get the tweening to work. <br><br></td></tr></table><br>
<a name="2048169"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Samah</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> <pre class=code>(currentTime - timelineKey.time) / ( nextKeyTime - timelineKey.time)</pre><br>Integer division. <br><br></td></tr></table><br>
<a name="2048173"></a>

<a name="2048174"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Integer division.  <br></div><br>Doh! Thanks Samah!!<br><br>Just uploaded a newer version with a timer class: F1 to start, F2 to Stop and F3 to Resume.<br><br>So close now... hero's arm is a bit off when walking. [Edit - looks like the file is like that anyway...) <br><br></td></tr></table><br>
<a name="2048178"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tibit</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> Excellent work, this is going to be very fun to use! <br><br></td></tr></table><br>
<a name="2048180"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> Uploaded a quick fix and also uses Maps instead of Lists (since most of the objects are ID based). <br><br></td></tr></table><br>
<a name="2048259"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> Question...<br><br>If you are on the last keyframe and there is time left on the animation, do we tween between the last frame and the first frame?<br><br>As this is what is causing the jumping movement with the walking hero... if we just display the last keyframe until the end of the animation it looks better, but you have a slight pause in movement. <br><br></td></tr></table><br>
<a name="2048292"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paul - Taiphoz</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> have you tried just maxing the time or setting it back to the start the second the animation reaches its end ? <br><br></td></tr></table><br>
<a name="2048352"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> I originally had it if there wasnt a next keyframe it would tween between the last keyframe and the first keyframe and max the time, it worked 90% of the time and I guess would be nearly the correct way for looping.<br><br>Now I've got if you are on the last keyframe it keeps on that frame until the end of the animation... <br><br></td></tr></table><br>
<a name="2048361"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >rIKmAN</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  Now I've got if you are on the last keyframe it keeps on that frame until the end of the animation... <br></div><br><br>That doesn't sound right, is it working like that?<br>Maybe if you had to have a keyframe on the last frame, so as soon as it hits it you know then animation has completely ended, that might work?<br><br>From what you said it sounds like it would be frozen on the last keyframe pose until the end of the animation, then snap back to frame 1 when it had finished. <br><br></td></tr></table><br>
<a name="2048363"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#32">[#32]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Maybe if you had to have a keyframe on the last frame, so as soon as it hits it you know then animation has completely ended, that might work? <br></div><br>Then it would go straight to the first keyframe with no time to tween.<br><br><div class="quote"> From what you said it sounds like it would be frozen on the last keyframe pose until the end of the animation, then snap back to frame 1 when it had finished.  <br></div><br>Exactly :)<br><br>I think I need to add/use the looping flag in the SCML:<br><pre class=code>&lt;animation id="0" name="idle_healthy" length="2100" looping="false"&gt;</pre><br><br>Currently it is always "false" in the XML.<br><br>If its false, we would freeze on the last keyframe until the end of the animation, if true it would tween between the last keyframe and the first keyframe until the end of the animation and start again. <br><br></td></tr></table><br>
<a name="2048367"></a>

<a name="2048368"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#33">[#33]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ahhhh think I've might have got it (maybe), a timeline's first key might not start at the animation start... so if we don't tween. <br><br></td></tr></table><br>
<a name="2048954"></a>

<a name="2048955"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#34">[#34]</a></td></tr></table></td></tr><tr ><td class="posttext"> All cleaned up and read to go (apart from bones):<br><br><a href="http://www.therevillsgames.com/monkey/SpriterA4/MonkeyGame.html" target="_blank">http://www.therevillsgames.com/monkey/SpriterA4/MonkeyGame.html</a><br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
#TEXT_FILES="*.txt|*.xml|*.json|*.SCML|*.scml"
Strict
Import mojo
Import diddy.xml

Function Main:Int()
	New Game()
	Return 0
End

'-------------------------- Monkey Spriter Demo --------------------------
Class Game Extends App
	
	Field monster:MonkeySpriter
	Field hero:MonkeySpriter

	Const IDLE:String = "Idle"
	Const POSTURE:String = "Posture"
	Field monsterAnimName:String = IDLE
	
	Const IDLEH:String = "idle_healthy"
	Const WALK:String = "walk"
	Field heroAnimName:String = IDLEH

	Field x:Float, y:Float
	
	Field lastMillisecs:Int
	Field currentMillisecs:Int 
	Field timeElapsed:Int
	Field tween:Bool = True
	Field loopType:Int
	
	Method OnCreate:Int()
		monster = SpriterImporter.ImportFile("monster", "Example.SCML")
		hero = SpriterImporter.ImportFile("example hero", "BetaFormatHero.SCML")
		x = DeviceWidth() / 2
		y = DeviceHeight() - 20
		monster.timer.Start()
		hero.timer.Start()		
		SetUpdateRate(60)
		lastMillisecs = Millisecs()
		loopType = MonkeySpriter.LOOPING_TRUE
		CreateGUI()
		Return 0
	End
	
	Method CreateGUI:Void()
		Local b:Button = New Button("Anim 1", 0, 10, 100, 20)
		b.SetColour(255, 0, 0)
		b = New Button("Anim 2", 110, 10, 100, 20)

		b = New Button("Loop Type", 220, 10, 100, 20)
		b.SetColour(255, 255, 0)
		
		b = New Button("Reset Timer", 330, 10, 100, 20)
		b.SetColour(255, 0, 255)
		
		b = New Button("Stop Timer", 440, 10, 100, 20)
		b.SetColour(0, 255, 255)
		
		b = New Button("Resume Timer", 550, 10, 100, 20)
		b.SetColour(0, 255, 0)
		
		b = New Button("Slower", 440, 40, 100, 20)
		b.SetColour(100, 100, 100)
		
		b = New Button("Faster", 550, 40, 100, 20)
		b.SetColour(0, 0, 255)
		
		b = New Button("Tween On/Off", 220, 40, 100, 20)
		b.SetColour(25, 255, 25)
	End
	
	Method OnUpdate:Int()
		' simple delta timing
		currentMillisecs = Millisecs()
		timeElapsed = currentMillisecs - lastMillisecs 
		lastMillisecs = currentMillisecs

		hero.Update(heroAnimName, loopType, timeElapsed)
		monster.Update(monsterAnimName, loopType, timeElapsed)
		
		Controls()
		Return 0
	End	
	
	Method OnRender:Int()
		Cls
		
		monster.Draw(x, y, tween)
		hero.Draw(x-100, y, tween)
		
		Button.DrawAll()
		DrawDebug()
		Return 0
	End
	
	Method Controls:Void()
		Button.UpdateAll()
		If Button.Clicked("Stop Timer") Then
			monster.timer.Stop()
			hero.timer.Stop()
		End
		If Button.Clicked("Resume Timer") Then
			monster.timer.Resume()
			hero.timer.Resume()
		End
		If Button.Clicked("Reset Timer") Then
			monster.timer.Start()
			hero.timer.Start()
			monster.mainlineKeyId = 0
			hero.mainlineKeyId = 0
		End
		If Button.Clicked("Faster") Then
			hero.timer.rate/=1.1
			monster.timer.rate/=1.1
		End
		If Button.Clicked("Slower") Then
			hero.timer.rate*=1.1
			monster.timer.rate*=1.1
		End
		If Button.Clicked("Anim 1") Then
			monsterAnimName = IDLE
			heroAnimName = IDLEH
			monster.mainlineKeyId = 0
			monster.timer.Start()
			hero.mainlineKeyId = 0
			hero.timer.Start()
		End
		If Button.Clicked("Anim 2") Then
			monsterAnimName = POSTURE
			heroAnimName = WALK
			monster.mainlineKeyId = 0
			monster.timer.Start()
			hero.mainlineKeyId = 0
			hero.timer.Start()
		End
		If Button.Clicked("Tween On/Off") Then
			tween = Not tween
		End
		If Button.Clicked("Loop Type") Then
			monster.timer.Start()
			hero.timer.Start()
			monster.mainlineKeyId = 0
			hero.mainlineKeyId = 0
			loopType += 1
			If loopType &gt; 2 loopType = 0
		End
		
		If KeyDown(KEY_W) y-=2
		If KeyDown(KEY_S) y+=2
		If KeyDown(KEY_A) x-=2
		If KeyDown(KEY_D) x+=2
	End
	
	Method DrawDebug:Void()
		Local y:Int = 100
		Local gap:Int = 15
		DrawText("MONKEY SPRITER IMPORTER", 10, y)
		y+=gap
		y+=gap
		DrawText("Monster Timer = " + monster.timer.GetTime(), 10, y)
		y+=gap
		DrawText("Hero Timer    = " + hero.timer.GetTime(), 10, y)
		y+=gap
		DrawText("Time Elapsed  = " + timeElapsed, 10, y)
		y+=gap
		Local loopString:String
		Select loopType
			Case 0
				loopString = "FALSE"
			Case 1
				loopString = "TRUE"
			Case 2
				loopString = "PING PONG"
		End
		DrawText("Looping Type  = " + loopString, 10, y)
		y+=gap
		DrawText("Timer Speed   = " + monster.timer.rate, 10, y)
		y+=gap
		If tween
			DrawText("Tweening      = TRUE", 10, y)
		Else
			DrawText("Tweening      = FALSE", 10, y)
		End
		y+=gap
	End
End
'-------------------------- Simple Button --------------------------
Class Button
	Field x:Int, y:Int
	Field w:Int, h:Int
	Field label:String
	Field name:String
	Field r:Int = 255, g:Int = 255, b:Int = 255
	Field mouseOver:Bool = False
	Field clicked:Bool = False
	Global clickedName:String = ""
	Global list:List&lt;Button&gt;
	
	Method New(label:String, x:Int, y:Int, w:Int, h:Int)
		If list = Null Then list = New List&lt;Button&gt;
		Self.label = label
		Self.name = label.ToUpper()
		Self.x = x
		Self.y = y
		Self.w = w
		Self.h = h
		
		list.AddLast(Self)
	End
	
	Method SetColour:Void(r:Int, g:Int, b:Int)
		Self.r = r
		Self.g = g
		Self.b = b
	End
	
	Method Update:Void()
		If RectsOverlap(MouseX(), MouseY(), 3, 3, Self.x, Self.y, Self.w, Self.h)
			mouseOver = True
			If MouseHit(MOUSE_LEFT)
				If Not clicked
					clicked = True
				End
			Else
				clicked = False
			End
		Else
			clicked = False
			mouseOver = False
		End
	End
	
	Method Draw:Void()
		Local light:Int = -25
		If mouseOver
			light = 120
		End
		SetColor (r + light, g + light, b + light)
		DrawRect (x, y, w, h)
		SetColor (255, 255, 255)
		DrawText (label, x + 2, y + 2)
	End
	
	Function DrawAll:Void()
		For Local b:Button = Eachin list
			b.Draw()
		End
	End
	
	Function Clicked:Int(name:String)
		name = name.ToUpper()
		If name = clickedName
			clickedName = ""
			Return 1		
		Else
			Return 0
		End
	End
	
	Function UpdateAll:Void()
		clickedName = ""
		For Local b:Button = Eachin list
			b.Update()
			If b.clicked Then clickedName = b.name
		End
	End
End

Function RectsOverlap:Int(x0:Float, y0:Float, w0:Float, h0:Float, x2:Float, y2:Float, w2:Float, h2:Float)
	If x0 &gt; (x2 + w2) Or (x0 + w0) &lt; x2 Then Return False
	If y0 &gt; (y2 + h2) Or (y0 + h0) &lt; y2 Then Return False
	Return True
End

'-------------------------- Monkey Spriter Code --------------------------
Class MonkeySpriter
	Field textures:TextureProvider = New TextureProvider()
	Field folders:IntMap&lt;SpriterFolder&gt;
	Field entities:IntMap&lt;SpriterEntity&gt;
	Field mainPath:String
	Field animationName:String
	Field nextKeyTime:Int
	Field mainlineKeyId:Int
	Field timer:Timer
	Const LOOPING_FALSE:Int = 0
	Const LOOPING_TRUE:Int = 1
	Const LOOPING_PING_PONG:Int = 2
	
	Method New()
		Self.folders = New IntMap&lt;SpriterFolder&gt;
		Self.entities = New IntMap&lt;SpriterEntity&gt;
		mainlineKeyId = 0
		timer = New Timer
	End

	Method Update:Void(animationName:String, looping:Int = LOOPING_TRUE, timeElapsed:Int)
		Self.animationName = animationName
		If Not timer.stopped
			timer.Update(timeElapsed)
			Local animation:SpriterAnimation = entities.Get(0).animations.Get(animationName)
			If looping &lt;&gt; "" Then
				animation.looping = looping
			End
			Local mainline:SpriterMainline = animation.mainline
			If timer.GetTime() &gt;= animation.length
				If animation.looping = LOOPING_TRUE
					timer.Reset()
				Else If animation.looping = LOOPING_PING_PONG
					timer.direction = timer.DOWN
				Else If animation.looping = LOOPING_FALSE
					timer.Stop()
				End
			End
			If animation.looping = LOOPING_PING_PONG And timer.GetTime() &lt;= 0
				timer.direction = timer.UP
				timer.Reset()
			End
		End		
	End
	
	Method Draw:Void(offsetX:Float, offsetY:Float, tween:Bool = False)
		Local anim:SpriterAnimation = entities.Get(0).animations.Get(animationName)
		Local mainline:SpriterMainline = anim.mainline
		
		Local time:Float = timer.GetTime()
		mainlineKeyId = mainline.GetKeyViaTime(time).id
		Local mainlineKey:SpriterKey = mainline.keys.Get(mainlineKeyId)

		For Local i:Int = Eachin mainlineKey.objectRefs.Keys()
			Local objRef:SpriterObjectRef = mainlineKey.objectRefs.Get(i)
			Local timeline:SpriterTimeline = anim.timelines.Get(objRef.timeline)
			Local timelineKey:SpriterKey = timeline.GetKeyViaTime(time)
			Local nextTimelineKey:SpriterKey = timeline.keys.Get(objRef.key + 1)
			Local nextKeyTime:Int
			
			If nextTimelineKey = Null Then
				If anim.looping = LOOPING_TRUE
					nextTimelineKey = timeline.keys.Get(0)
					nextKeyTime = anim.length
					' next timeline might not start at the beginning of the animation
					If nextTimelineKey.time &gt; 0 Then
						nextKeyTime += nextTimelineKey.time
					End
				Else If anim.looping = LOOPING_PING_PONG
					If timer.direction = timer.UP
						nextKeyTime = anim.length
					Else
						nextKeyTime = 0
					End
					nextTimelineKey = timelineKey
				Else If anim.looping = LOOPING_FALSE
					nextTimelineKey = timelineKey
					nextKeyTime = anim.length	
				End
			Else
				nextKeyTime = nextTimelineKey.time
			End
			
			Local nextO:SpriterObject = nextTimelineKey.objects.Last()

			For Local o:SpriterObject = Eachin timelineKey.objects
				Local folder:SpriterFolder = Self.folders.Get(o.folder)
				Local file:SpriterFile = folder.files.Get(o.file)
				Local texture:Image = textures.GetTexture(Self.mainPath + "/" + file.name.ToUpper())
				Local px:Float = o.pivotX * texture.Width()
				Local py:Float = texture.Height() + (-o.pivotY * texture.Height())
				If o.pivotY = 0 Then py = 0
				If o.pivotX = 0 Then px = 0
				texture.SetHandle(px, py)
				If tween
					Local tweenedX:Float = LinearInterpolation(o.x, nextO.x, timelineKey.time, nextKeyTime, timer.GetTime())
					Local tweenedY:Float = LinearInterpolation(o.y, nextO.y, timelineKey.time, nextKeyTime, timer.GetTime())
					Local tweenedAngle:Float = AngleLinearInterpolation(o.angle, nextO.angle, timelineKey.time, nextKeyTime, timer.GetTime())
					Local tweenedScaleX:Float = LinearInterpolation(o.scaleX, nextO.scaleX, timelineKey.time, nextKeyTime, timer.GetTime())
					Local tweenedScaleY:Float = LinearInterpolation(o.scaleY, nextO.scaleY, timelineKey.time, nextKeyTime, timer.GetTime())
					Local tweenedAlpha:Float = LinearInterpolation(o.alpha, nextO.alpha, timelineKey.time, nextKeyTime, timer.GetTime())
					SetAlpha(tweenedAlpha)
					DrawImage(texture, tweenedX + offsetX, -tweenedY + offsetY, tweenedAngle, tweenedScaleX, tweenedScaleY, 0)
				Else
					SetAlpha(o.alpha)
					DrawImage(texture, o.x + offsetX, -o.y + offsetY, o.angle, o.scaleX, o.scaleY, 0)
				End
			Next
			SetAlpha(1)
		Next
	End
	
	Method LinearInterpolation:Float(a:Float, b:Float, timeA:Float, timeB:Float, currentTime:Float)
		Return a + ((b - a) * ((currentTime - timeA) / (timeB - timeA)))
	End
	
	Method AngleLinearInterpolation:Float(a:Float, b:Float, timeA:Float, timeB:Float, currentTime:Float)
		return a + (AngleDifference(b, a) * ((currentTime - timeA) / (timeB - timeA)))
	End
	
	Method AngleDifference:Float(a:Float, b:Float)
		Return ((((a - b) Mod 360) + 540) Mod 360) - 180
	End
End

Class SpriterFolder
	Field files:IntMap&lt;SpriterFile&gt;
	Field id:Int
	Field name:String
	
	Method New()
		Self.files = New IntMap&lt;SpriterFile&gt;
	End
End

Class SpriterFile
	Field id:Int
	Field name:String
	Field width:Int
	Field height:Int
End

Class SpriterEntity
	Field id:Int
	Field name:String
	Field animations:StringMap&lt;SpriterAnimation&gt;
	
	Method New()
		Self.animations = New StringMap&lt;SpriterAnimation&gt;
	End
End

Class SpriterAnimation
	Field id:Int
	Field name:String
	Field length:Int
	Field looping:Int
	Field mainline:SpriterMainline
	Field timelines:IntMap&lt;SpriterTimeline&gt;
	Field maxKey:Int
	
	Method New()
		Self.mainline = New SpriterMainline
		Self.timelines = New IntMap&lt;SpriterTimeline&gt;
	End
End

Class SpriterMainline
	Field keys:IntMap&lt;SpriterKey&gt;
	Field keyId:Int = 0
	Field delay:Float = 0
	Field maxDelay:Int = 5
	Field speed:Float = 1.5
	Field maxKey:Int
		
	Method New()
		Self.keys = New IntMap&lt;SpriterKey&gt;
	End
		
	Method GetKey:SpriterKey(timer:Timer)
		Local rv:SpriterKey = Self.keys.Get(0)
		For Local i:Int = Eachin Self.keys.Keys()
			Local key:SpriterKey = Self.keys.Get(i)
			If key.time &gt; timer.GetTime()
				Return rv
			End
			rv = key
		Next
		Return rv
	End
	
	Method GetKeyViaTime:SpriterKey(time:Float)
		Local rv:SpriterKey = Self.keys.Get(0)
		For Local i:Int = Eachin Self.keys.Keys()
			Local key:SpriterKey = Self.keys.Get(i)
			If key.time &gt; time
				Return rv
			End
			rv = key
		Next
		Return rv
	End

End

Class SpriterKey
	Field id:Int
	Field time:Int
	Field spin:Int
	Field objectRefs:IntMap&lt;SpriterObjectRef&gt;
	Field objects:List&lt;SpriterObject&gt;
	
	Method New()
		Self.objectRefs = New IntMap&lt;SpriterObjectRef&gt;
		Self.objects = New List&lt;SpriterObject&gt;
	End
End

Class SpriterObjectRef
	Field id:Int
	Field timeline:Int
	Field key:Int
	Field zIndex:Int
End

Class SpriterTimeline
	Field id:Int
	Field keys:IntMap&lt;SpriterKey&gt;
	Field keyId:Int = 0
	Field delay:Float = 0
	Field maxDelay:Int = 5
	Field speed:Float = 1.5
	Field maxKey:Int
	
	Method New()
		Self.keys = New IntMap&lt;SpriterKey&gt;
	End
	
	Method GetKey:SpriterKey(timer:Timer)
		Local rv:SpriterKey = Self.keys.Get(0)
		For Local i:Int = Eachin Self.keys.Keys()
			Local key:SpriterKey = Self.keys.Get(i)
			If key.time &gt; timer.GetTime()
				Return rv
			End
			rv = key
		Next
		Return rv
	End
	
	Method GetKeyViaTime:SpriterKey(time:Float)
		Local rv:SpriterKey = Self.keys.Get(0)
		For Local i:Int = Eachin Self.keys.Keys()
			Local key:SpriterKey = Self.keys.Get(i)
			If key.time &gt; time
				Return rv
			End
			rv = key
		Next
		Return rv
	End

End

Class SpriterObject
	Field folder:Int
	Field file:Int
	Field x:Float
	Field y:Float
	Field pivotX:Float
	Field pivotY:Float
	Field angle:Float
	Field scaleX:Float
	Field scaleY:Float
	Field alpha:Float
End

Class SpriterImporter
	Function ImportFile:MonkeySpriter(path:String, file:String, debug:Bool = False)
		If debug Then Print "Importing " + path + "/" + file

		Local str:String = LoadString(path + "/" + file)
		If str = "" Then Error "Error loading file..."
		
		Local xmlReader:XMLParser = New XMLParser		
		Local doc:XMLDocument = xmlReader.ParseString(str)
		Local rootElement:XMLElement = doc.Root

		Local smo:MonkeySpriter = New MonkeySpriter()
		smo.mainPath = path
		For Local folderElement:XMLElement = Eachin rootElement.GetChildrenByName("folder")
			Local folder:SpriterFolder = New SpriterFolder()
			folder.id = Int(folderElement.GetAttribute("id"))
			folder.name = folderElement.GetAttribute("name")
			If debug Print "folder = " + folder.id + " " + folder.name
			
			For Local fileElement:XMLElement = Eachin folderElement.GetChildrenByName("file")
				Local file:SpriterFile = New SpriterFile()
				file.id = Int(fileElement.GetAttribute("id"))
				file.name = fileElement.GetAttribute("name")
				file.width = Int(fileElement.GetAttribute("width"))
				file.height = Int(fileElement.GetAttribute("height"))
				
				If debug Print "file = " + file.id + " " + file.name
				smo.textures.Load(path + "/" + file.name)
				
				folder.files.Add(file.id, file)
			Next
			smo.folders.Add(folder.id, folder)
		Next
		
		For Local entityElement:XMLElement = Eachin rootElement.GetChildrenByName("entity")
			Local entity:SpriterEntity = New SpriterEntity()
			Local id:String = entityElement.GetAttribute("id")
			Local name:String = entityElement.GetAttribute("name")
			
			If debug Print "entity = " + id + " " + name
			For Local animationElement:XMLElement = Eachin entityElement.GetChildrenByName("animation")
				Local animation:SpriterAnimation = New SpriterAnimation()
				animation.id  = Int(animationElement.GetAttribute("id"))
				animation.name = animationElement.GetAttribute("name")
				animation.length = Int(animationElement.GetAttribute("length"))
				Local looping:String = animationElement.GetAttribute("looping", MonkeySpriter.LOOPING_FALSE)
				Select looping
					Case "true"
						animation.looping = MonkeySpriter.LOOPING_TRUE
					Case "false"
						animation.looping = MonkeySpriter.LOOPING_FALSE
					Case "ping_pong"
						animation.looping = MonkeySpriter.LOOPING_PING_PONG
				End

				If debug Print "animation = " + animation.id + " " + animation.name
				
				' Should only be one mainline element
				For Local mainlineElement:XMLElement = Eachin animationElement.GetChildrenByName("mainline")
					For Local keyElement:XMLElement = Eachin mainlineElement.GetChildrenByName("key")
						Local skey:SpriterKey = New SpriterKey()
						skey.id = Int(keyElement.GetAttribute("id"))
						skey.time= Int(keyElement.GetAttribute("time", "0"))
						If debug Print "key = " + skey.id + " " + skey.time

						For Local objectRefElement:XMLElement = Eachin keyElement.GetChildrenByName("object_ref")
							Local objectRef:SpriterObjectRef = New SpriterObjectRef
							objectRef.id = Int(objectRefElement.GetAttribute("id"))
							objectRef.timeline = Int(objectRefElement.GetAttribute("timeline"))
							objectRef.key = Int(objectRefElement.GetAttribute("key"))
							objectRef.zIndex = Int(objectRefElement.GetAttribute("z_index"))
							If debug Print "object_ref = " + objectRef.id + " " + objectRef.timeline
							
							skey.objectRefs.Add(objectRef.id, objectRef)
						Next
						animation.mainline.keys.Add(skey.id, skey)
						animation.maxKey = skey.id
					Next	
				Next
				
				For Local timelineElement:XMLElement = Eachin animationElement.GetChildrenByName("timeline")
					Local timeline:SpriterTimeline = New SpriterTimeline()
					timeline.id = Int(timelineElement.GetAttribute("id"))
					If debug Print "timeline = " + timeline.id
					
					For Local keyElement:XMLElement = Eachin timelineElement.GetChildrenByName("key")
						Local key:SpriterKey = New SpriterKey()
						key.id = Int(keyElement.GetAttribute("id"))
						key.time = Int(keyElement.GetAttribute("time", "0"))
						key.spin = Int(keyElement.GetAttribute("spin", "1"))
						If debug Print "key = " + key.id + " " + key.time + " " + key.spin
						
						For Local objectElement:XMLElement = Eachin keyElement.GetChildrenByName("object")						
							Local o:SpriterObject = New SpriterObject()
							o.folder = Int(objectElement.GetAttribute("folder"))
							o.file = Int(objectElement.GetAttribute("file"))
							o.x = Float(objectElement.GetAttribute("x", "0"))
							o.y = Float(objectElement.GetAttribute("y", "0"))
							o.pivotX = Float(objectElement.GetAttribute("pivot_x", "0"))
							o.pivotY = Float(objectElement.GetAttribute("pivot_y", "0"))
							o.angle = Float(objectElement.GetAttribute("angle", "0"))
							o.scaleX = Float(objectElement.GetAttribute("scale_x", "1"))
							o.scaleY = Float(objectElement.GetAttribute("scale_y", "1"))
							o.alpha = Float(objectElement.GetAttribute("a", "1"))
							
							If debug Print "object = " + o.folder + " " + o.file + " " + o.angle
														
							key.objects.AddLast(o)
						Next
						timeline.keys.Add(key.id, key)
					Next
					animation.timelines.Add(timeline.id, timeline)
				Next
				entity.animations.Add(animation.name, animation)
			Next
			smo.entities.Add(entity.id, entity)
		Next
		Return smo
	End
End

Class TextureProvider Extends StringMap&lt;Image&gt;
	Method Load:Image(name:String)
		Local storeKey:String = name.ToUpper()

		Local i:Image = New Image
		Local imgName:String = name

		i = LoadImage(imgName )', 1, flags)
		If i = Null
			Error "Error loading image "+name
		End
		'Print "storing "+storeKey
		Self.Set(storeKey, i)
		Return i
	End
	
	Method DisplayAllStored:Void()
		' debug: print all keys in the map
		For Local key:String = Eachin Self.Keys()
			Print key + " is stored in the map."
		Next
	End
	
	Method GetTexture:Image(name:String)
		name = name.ToUpper()
	   	
		Local i:Image= Self.Get(name)
		If i = Null Then Error("Image '" + name + "' not found in the TextureProvider")
		Return i
	End	
End

Class Timer
	Field stopped:Bool
	Field rate:Float
	Const UP:Int = 1
	Const DOWN:Int = -1
	Field direction:Int
	Field count:Float
	
	Method New()
		stopped = True
		rate = 1
		direction = UP
	End
	
	Method Start:Void()
		Reset()
		Resume()
		rate = 1
	End
	
	Method Stop:Void()
		If Not stopped
			stopped = True
		End
	End
	
	Method Resume:Void()
		If stopped
			stopped = False
		End
	End
	
	Method Reset:Void()
		count = 0
		direction = UP
	End
	
	Method GetTime:Float()
		Return count / rate
	End

	Method Update:Void(timeElapsed:Int)
		If direction = UP
			count+=timeElapsed
		Else
			count-=timeElapsed
		End
	End
End
</textarea> <br><br></td></tr></table><br>
<a name="2048967"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paul - Taiphoz</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#35">[#35]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thats looking really good if you can really get this nailed down and into diddy it will probably make me buy that spriter tool. <br><br></td></tr></table><br>
<a name="2049028"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#36">[#36]</a></td></tr></table></td></tr><tr ><td class="posttext"> SLotman over on bb.com suggested adding support for scaling and flipping, so after head banging at my desk and bugging Samah, it now works.<br><br><a href="http://www.therevillsgames.com/monkey/SpriterA4/MonkeyGame.html" target="_blank">http://www.therevillsgames.com/monkey/SpriterA4/MonkeyGame.html</a><br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">#TEXT_FILES="*.txt|*.xml|*.json|*.SCML|*.scml"
Strict
Import mojo
Import diddy.xml

Function Main:Int()
	New Game()
	Return 0
End

'-------------------------- Monkey Spriter Demo --------------------------
Class Game Extends App
	
	Field monster:MonkeySpriter
	Field hero:MonkeySpriter

	Const IDLE:String = "Idle"
	Const POSTURE:String = "Posture"
	Field monsterAnimName:String = IDLE
	
	Const IDLEH:String = "idle_healthy"
	Const WALK:String = "walk"
	Field heroAnimName:String = IDLEH

	Field x:Float, y:Float
	Field flipX:Bool
	Field flipY:Bool
	Field lastMillisecs:Int
	Field currentMillisecs:Int 
	Field timeElapsed:Int
	Field tween:Bool = True
	Field loopType:Int
	Field scaleX:Float = 1
	Field scaleY:Float = 1
	Field debug:Bool
	
	Method OnCreate:Int()
		monster = SpriterImporter.ImportFile("monster", "Example.SCML")
		hero = SpriterImporter.ImportFile("example hero", "BetaFormatHero.SCML")
		x = DeviceWidth() / 2
		y = DeviceHeight() - 20
		monster.timer.Start()
		hero.timer.Start()		
		SetUpdateRate(60)
		lastMillisecs = Millisecs()
		loopType = MonkeySpriter.LOOPING_TRUE
		debug = false
		CreateGUI()
		Return 0
	End
	
	Method CreateGUI:Void()
		Local b:Button = New Button("Anim 1", 0, 10, 100, 20)
		b.SetColour(255, 0, 0)
		b = New Button("Anim 2", 110, 10, 100, 20)

		b = New Button("Loop Type", 220, 10, 100, 20)
		b.SetColour(255, 255, 0)
		
		b = New Button("Reset Timer", 330, 10, 100, 20)
		b.SetColour(255, 0, 255)
		
		b = New Button("Stop Timer", 440, 10, 100, 20)
		b.SetColour(0, 255, 255)
		
		b = New Button("Resume Timer", 550, 10, 100, 20)
		b.SetColour(0, 255, 0)
		
		b = New Button("Slower", 440, 40, 100, 20)
		b.SetColour(100, 100, 100)
		
		b = New Button("Faster", 550, 40, 100, 20)
		b.SetColour(0, 0, 255)
		
		b = New Button("Tween On/Off", 330, 40, 100, 20)
		b.SetColour(25, 255, 25)

		b = New Button("Flip X", 0, 70, 100, 20)
		b.SetColour(25, 255, 125)	

		b = New Button("Flip Y", 110, 70, 100, 20)
		b.SetColour(123, 123, 255)	

		b = New Button("Scale Up", 0, 40, 100, 20)
		b.SetColour(255, 33, 125)	
		
		b = New Button("Scale Down", 110, 40, 100, 20)
		b.SetColour(125, 0, 125)
		
		b = New Button("Debug On/Off", 220, 40, 100, 20)
		b.SetColour(125, 230, 234)	
	End
	
	Method OnUpdate:Int()
		' simple delta timing
		currentMillisecs = Millisecs()
		timeElapsed = currentMillisecs - lastMillisecs 
		lastMillisecs = currentMillisecs

		hero.Update(heroAnimName, loopType, timeElapsed)
		monster.Update(monsterAnimName, loopType, timeElapsed)
		
		Controls()
		Return 0
	End	
	
	Method OnRender:Int()
		Cls
		monster.Draw(x, y, tween, scaleX, scaleY)
		hero.Draw(x-200, y, tween, scaleX, scaleY)
	
		Button.DrawAll()
		If debug Then DrawDebug()
		Return 0
	End
	
	Method Controls:Void()
		Button.UpdateAll()
		If Button.Clicked("Debug On/Off") Then
			debug = Not debug
		End
		If Button.Clicked("Scale Up") Then
			scaleX *= 1.1
			scaleY *= 1.1
		End
		If Button.Clicked("Scale Down") Then
			scaleX /= 1.1
			scaleY /= 1.1
		End
		If Button.Clicked("Flip X") Then
			scaleX = -scaleX
		End
		If Button.Clicked("Flip Y") Then
			scaleY = -scaleY
			y = DeviceHeight() - y
		End
		If Button.Clicked("Stop Timer") Then
			monster.timer.Stop()
			hero.timer.Stop()
		End
		If Button.Clicked("Resume Timer") Then
			monster.timer.Resume()
			hero.timer.Resume()
		End
		If Button.Clicked("Reset Timer") Then
			monster.timer.Start()
			hero.timer.Start()
			monster.mainlineKeyId = 0
			hero.mainlineKeyId = 0
		End
		If Button.Clicked("Faster") Then
			hero.timer.rate/=1.1
			monster.timer.rate/=1.1
		End
		If Button.Clicked("Slower") Then
			hero.timer.rate*=1.1
			monster.timer.rate*=1.1
		End
		If Button.Clicked("Anim 1") Then
			monsterAnimName = IDLE
			heroAnimName = IDLEH
			monster.mainlineKeyId = 0
			monster.timer.Start()
			hero.mainlineKeyId = 0
			hero.timer.Start()
		End
		If Button.Clicked("Anim 2") Then
			monsterAnimName = POSTURE
			heroAnimName = WALK
			monster.mainlineKeyId = 0
			monster.timer.Start()
			hero.mainlineKeyId = 0
			hero.timer.Start()
		End
		If Button.Clicked("Tween On/Off") Then
			tween = Not tween
		End
		If Button.Clicked("Loop Type") Then
			monster.timer.Start()
			hero.timer.Start()
			monster.mainlineKeyId = 0
			hero.mainlineKeyId = 0
			loopType += 1
			If loopType &gt; 2 loopType = 0
		End
		
		If KeyDown(KEY_W) y-=2
		If KeyDown(KEY_S) y+=2
		If KeyDown(KEY_A) x-=2
		If KeyDown(KEY_D) x+=2
	End
	
	Method DrawDebug:Void()
		Local y:Int = 100
		Local gap:Int = 15
		SetAlpha(0.75)
		DrawText("MONKEY SPRITER IMPORTER", 10, y)
		y+=gap
		y+=gap
		DrawText("Monster Timer = " + monster.timer.GetTime(), 10, y)
		y+=gap
		DrawText("Hero Timer    = " + hero.timer.GetTime(), 10, y)
		y+=gap
		DrawText("Time Elapsed  = " + timeElapsed, 10, y)
		y+=gap
		Local loopString:String
		Select loopType
			Case 0
				loopString = "FALSE"
			Case 1
				loopString = "TRUE"
			Case 2
				loopString = "PING PONG"
		End
		DrawText("Looping Type  = " + loopString, 10, y)
		y+=gap
		DrawText("Timer Rate    = " + monster.timer.rate, 10, y)
		y+=gap
		If tween
			DrawText("Tweening      = TRUE", 10, y)
		Else
			DrawText("Tweening      = FALSE", 10, y)
		End
		y+=gap
		DrawText("Scale X       = " + scaleX, 10, y)
		y+=gap
		DrawText("Scale Y       = " + scaleY, 10, y)

		SetAlpha(1)
	End
End
'-------------------------- Simple Button --------------------------
Class Button
	Field x:Int, y:Int
	Field w:Int, h:Int
	Field label:String
	Field name:String
	Field r:Int = 255, g:Int = 255, b:Int = 255
	Field mouseOver:Bool = False
	Field clicked:Bool = False
	Global clickedName:String = ""
	Global list:List&lt;Button&gt;
	
	Method New(label:String, x:Int, y:Int, w:Int, h:Int)
		If list = Null Then list = New List&lt;Button&gt;
		Self.label = label
		Self.name = label.ToUpper()
		Self.x = x
		Self.y = y
		Self.w = w
		Self.h = h
		
		list.AddLast(Self)
	End
	
	Method SetColour:Void(r:Int, g:Int, b:Int)
		Self.r = r
		Self.g = g
		Self.b = b
	End
	
	Method Update:Void()
		If RectsOverlap(MouseX(), MouseY(), 3, 3, Self.x, Self.y, Self.w, Self.h)
			mouseOver = True
			If MouseHit(MOUSE_LEFT)
				If Not clicked
					clicked = True
				End
			Else
				clicked = False
			End
		Else
			clicked = False
			mouseOver = False
		End
	End
	
	Method Draw:Void()
		Local light:Int = -25
		If mouseOver
			light = 120
			SetAlpha(1)
		End
		SetColor (r + light, g + light, b + light)
		DrawRect (x, y, w, h)
		SetColor (255, 255, 255)
		DrawText (label, x + 2, y + 2)
	End
	
	Function DrawAll:Void()
		For Local b:Button = Eachin list
			SetAlpha(0.75)
			b.Draw()
		End
		SetAlpha(1)		
	End
	
	Function Clicked:Int(name:String)
		name = name.ToUpper()
		If name = clickedName
			clickedName = ""
			Return 1		
		Else
			Return 0
		End
	End
	
	Function UpdateAll:Void()
		clickedName = ""
		For Local b:Button = Eachin list
			b.Update()
			If b.clicked Then clickedName = b.name
		End
	End
End

Function RectsOverlap:Int(x0:Float, y0:Float, w0:Float, h0:Float, x2:Float, y2:Float, w2:Float, h2:Float)
	If x0 &gt; (x2 + w2) Or (x0 + w0) &lt; x2 Then Return False
	If y0 &gt; (y2 + h2) Or (y0 + h0) &lt; y2 Then Return False
	Return True
End

'-------------------------- Monkey Spriter Code --------------------------
Class MonkeySpriter
	Field textures:TextureProvider = New TextureProvider()
	Field folders:IntMap&lt;SpriterFolder&gt;
	Field entities:IntMap&lt;SpriterEntity&gt;
	Field mainPath:String
	Field animationName:String
	Field nextKeyTime:Int
	Field mainlineKeyId:Int
	Field timer:Timer
	Const LOOPING_FALSE:Int = 0
	Const LOOPING_TRUE:Int = 1
	Const LOOPING_PING_PONG:Int = 2
	
	Method New()
		Self.folders = New IntMap&lt;SpriterFolder&gt;
		Self.entities = New IntMap&lt;SpriterEntity&gt;
		mainlineKeyId = 0
		timer = New Timer
	End

	Method Update:Void(animationName:String, looping:Int = LOOPING_TRUE, timeElapsed:Int)
		Self.animationName = animationName
		If Not timer.stopped
			timer.Update(timeElapsed)
			Local animation:SpriterAnimation = entities.Get(0).animations.Get(animationName)
			If looping &lt;&gt; "" Then
				animation.looping = looping
			End
			Local mainline:SpriterMainline = animation.mainline
			If timer.GetTime() &gt;= animation.length
				If animation.looping = LOOPING_TRUE
					timer.Reset()
				Else If animation.looping = LOOPING_PING_PONG
					timer.direction = timer.DOWN
				Else If animation.looping = LOOPING_FALSE
					timer.Stop()
				End
			End
			If animation.looping = LOOPING_PING_PONG And timer.GetTime() &lt;= 0
				timer.direction = timer.UP
				timer.Reset()
			End
		End		
	End
	
	Method Draw:Void(offsetX:Float, offsetY:Float, tween:Bool = False, scaleX:Float = 1, scaleY:Float = 1)
		Local anim:SpriterAnimation = entities.Get(0).animations.Get(animationName)
		If anim = Null Return
		Local mainline:SpriterMainline = anim.mainline
		
		Local time:Float = timer.GetTime()
		mainlineKeyId = mainline.GetKeyViaTime(time).id
		Local mainlineKey:SpriterKey = mainline.keys.Get(mainlineKeyId)

		For Local i:Int = Eachin mainlineKey.objectRefs.Keys()
			Local objRef:SpriterObjectRef = mainlineKey.objectRefs.Get(i)
			Local timeline:SpriterTimeline = anim.timelines.Get(objRef.timeline)
			Local timelineKey:SpriterKey = timeline.GetKeyViaTime(time)
			Local nextTimelineKey:SpriterKey = timeline.keys.Get(objRef.key + 1)
			Local nextKeyTime:Int
			
			If nextTimelineKey = Null Then
				If anim.looping = LOOPING_TRUE
					nextTimelineKey = timeline.keys.Get(0)
					nextKeyTime = anim.length
					' next timeline might not start at the beginning of the animation
					If nextTimelineKey.time &gt; 0 Then
						nextKeyTime += nextTimelineKey.time
					End
				Else If anim.looping = LOOPING_PING_PONG
					If timer.direction = timer.UP
						nextKeyTime = anim.length
					Else
						nextKeyTime = 0
					End
					nextTimelineKey = timelineKey
				Else If anim.looping = LOOPING_FALSE
					nextTimelineKey = timelineKey
					nextKeyTime = anim.length	
				End
			Else
				nextKeyTime = nextTimelineKey.time
			End
			
			Local nextO:SpriterObject = nextTimelineKey.objects.Last()

			For Local o:SpriterObject = Eachin timelineKey.objects
				Local folder:SpriterFolder = Self.folders.Get(o.folder)
				Local file:SpriterFile = folder.files.Get(o.file)
				Local texture:Image = textures.GetTexture(Self.mainPath + "/" + file.name.ToUpper())
				Local px:Float = o.pivotX * texture.Width()
				Local py:Float = texture.Height() + (-o.pivotY * texture.Height())
				If o.pivotY = 0 Then py = 0
				If o.pivotX = 0 Then px = 0
				texture.SetHandle(px, py)
				Local currentAngle:Float = o.angle
				Local nextAngle:Float = nextO.angle

				'XOR
				If (scaleX &lt; 0) &lt;&gt; (scaleY &lt; 0) Then
					currentAngle = -currentAngle
					nextAngle = -nextAngle
				End

				If tween
					Local tweenedX:Float = LinearInterpolation(o.x, nextO.x, timelineKey.time, nextKeyTime, timer.GetTime())
					Local tweenedY:Float = LinearInterpolation(o.y, nextO.y, timelineKey.time, nextKeyTime, timer.GetTime())
					Local tweenedAngle:Float = AngleLinearInterpolation(currentAngle, nextAngle, timelineKey.time, nextKeyTime, timer.GetTime())
					Local tweenedScaleX:Float = LinearInterpolation(o.scaleX, nextO.scaleX, timelineKey.time, nextKeyTime, timer.GetTime())
					Local tweenedScaleY:Float = LinearInterpolation(o.scaleY, nextO.scaleY, timelineKey.time, nextKeyTime, timer.GetTime())
					Local tweenedAlpha:Float = LinearInterpolation(o.alpha, nextO.alpha, timelineKey.time, nextKeyTime, timer.GetTime())
					SetAlpha(tweenedAlpha)
					DrawImage(texture, tweenedX * scaleX + offsetX, -tweenedY * scaleY + offsetY, tweenedAngle, tweenedScaleX * scaleX, tweenedScaleY * scaleY, 0)
				Else
					SetAlpha(o.alpha)
					DrawImage(texture, o.x * scaleX + offsetX, -o.y * scaleY + offsetY, currentAngle, o.scaleX * scaleX, o.scaleY * scaleY, 0)
				End
			Next		
			SetAlpha(1)
		Next
	End
	
	Method LinearInterpolation:Float(a:Float, b:Float, timeA:Float, timeB:Float, currentTime:Float)
		Return a + ((b - a) * ((currentTime - timeA) / (timeB - timeA)))
	End
	
	Method AngleLinearInterpolation:Float(a:Float, b:Float, timeA:Float, timeB:Float, currentTime:Float)
		return a + (AngleDifference(b, a) * ((currentTime - timeA) / (timeB - timeA)))
	End
	
	Method AngleDifference:Float(a:Float, b:Float)
		Return ((((a - b) Mod 360) + 540) Mod 360) - 180
	End
End

Class SpriterFolder
	Field files:IntMap&lt;SpriterFile&gt;
	Field id:Int
	Field name:String
	
	Method New()
		Self.files = New IntMap&lt;SpriterFile&gt;
	End
End

Class SpriterFile
	Field id:Int
	Field name:String
	Field width:Int
	Field height:Int
End

Class SpriterEntity
	Field id:Int
	Field name:String
	Field animations:StringMap&lt;SpriterAnimation&gt;
	
	Method New()
		Self.animations = New StringMap&lt;SpriterAnimation&gt;
	End
End

Class SpriterAnimation
	Field id:Int
	Field name:String
	Field length:Int
	Field looping:Int
	Field mainline:SpriterMainline
	Field timelines:IntMap&lt;SpriterTimeline&gt;
	Field maxKey:Int
	
	Method New()
		Self.mainline = New SpriterMainline
		Self.timelines = New IntMap&lt;SpriterTimeline&gt;
	End
End

Class SpriterMainline
	Field keys:IntMap&lt;SpriterKey&gt;
	Field keyId:Int = 0
	Field delay:Float = 0
	Field maxDelay:Int = 5
	Field speed:Float = 1.5
	Field maxKey:Int
		
	Method New()
		Self.keys = New IntMap&lt;SpriterKey&gt;
	End
		
	Method GetKey:SpriterKey(timer:Timer)
		Local rv:SpriterKey = Self.keys.Get(0)
		For Local i:Int = Eachin Self.keys.Keys()
			Local key:SpriterKey = Self.keys.Get(i)
			If key.time &gt; timer.GetTime()
				Return rv
			End
			rv = key
		Next
		Return rv
	End
	
	Method GetKeyViaTime:SpriterKey(time:Float)
		Local rv:SpriterKey = Self.keys.Get(0)
		For Local i:Int = Eachin Self.keys.Keys()
			Local key:SpriterKey = Self.keys.Get(i)
			If key.time &gt; time
				Return rv
			End
			rv = key
		Next
		Return rv
	End

End

Class SpriterKey
	Field id:Int
	Field time:Int
	Field spin:Int
	Field objectRefs:IntMap&lt;SpriterObjectRef&gt;
	Field objects:List&lt;SpriterObject&gt;
	
	Method New()
		Self.objectRefs = New IntMap&lt;SpriterObjectRef&gt;
		Self.objects = New List&lt;SpriterObject&gt;
	End
End

Class SpriterObjectRef
	Field id:Int
	Field timeline:Int
	Field key:Int
	Field zIndex:Int
End

Class SpriterTimeline
	Field id:Int
	Field keys:IntMap&lt;SpriterKey&gt;
	Field keyId:Int = 0
	Field delay:Float = 0
	Field maxDelay:Int = 5
	Field speed:Float = 1.5
	Field maxKey:Int
	
	Method New()
		Self.keys = New IntMap&lt;SpriterKey&gt;
	End
	
	Method GetKey:SpriterKey(timer:Timer)
		Local rv:SpriterKey = Self.keys.Get(0)
		For Local i:Int = Eachin Self.keys.Keys()
			Local key:SpriterKey = Self.keys.Get(i)
			If key.time &gt; timer.GetTime()
				Return rv
			End
			rv = key
		Next
		Return rv
	End
	
	Method GetKeyViaTime:SpriterKey(time:Float)
		Local rv:SpriterKey = Self.keys.Get(0)
		For Local i:Int = Eachin Self.keys.Keys()
			Local key:SpriterKey = Self.keys.Get(i)
			If key.time &gt; time
				Return rv
			End
			rv = key
		Next
		Return rv
	End

End

Class SpriterObject
	Field folder:Int
	Field file:Int
	Field x:Float
	Field y:Float
	Field pivotX:Float
	Field pivotY:Float
	Field angle:Float
	Field scaleX:Float
	Field scaleY:Float
	Field alpha:Float
End

Class SpriterImporter
	Function ImportFile:MonkeySpriter(path:String, file:String, debug:Bool = False)
		If debug Then Print "Importing " + path + "/" + file

		Local str:String = LoadString(path + "/" + file)
		If str = "" Then Error "Error loading file..."
		
		Local xmlReader:XMLParser = New XMLParser		
		Local doc:XMLDocument = xmlReader.ParseString(str)
		Local rootElement:XMLElement = doc.Root

		Local smo:MonkeySpriter = New MonkeySpriter()
		smo.mainPath = path
		For Local folderElement:XMLElement = Eachin rootElement.GetChildrenByName("folder")
			Local folder:SpriterFolder = New SpriterFolder()
			folder.id = Int(folderElement.GetAttribute("id"))
			folder.name = folderElement.GetAttribute("name")
			If debug Print "folder = " + folder.id + " " + folder.name
			
			For Local fileElement:XMLElement = Eachin folderElement.GetChildrenByName("file")
				Local file:SpriterFile = New SpriterFile()
				file.id = Int(fileElement.GetAttribute("id"))
				file.name = fileElement.GetAttribute("name")
				file.width = Int(fileElement.GetAttribute("width"))
				file.height = Int(fileElement.GetAttribute("height"))
				
				If debug Print "file = " + file.id + " " + file.name
				smo.textures.Load(path + "/" + file.name)
				
				folder.files.Add(file.id, file)
			Next
			smo.folders.Add(folder.id, folder)
		Next
		
		For Local entityElement:XMLElement = Eachin rootElement.GetChildrenByName("entity")
			Local entity:SpriterEntity = New SpriterEntity()
			Local id:String = entityElement.GetAttribute("id")
			Local name:String = entityElement.GetAttribute("name")
			
			If debug Print "entity = " + id + " " + name
			For Local animationElement:XMLElement = Eachin entityElement.GetChildrenByName("animation")
				Local animation:SpriterAnimation = New SpriterAnimation()
				animation.id  = Int(animationElement.GetAttribute("id"))
				animation.name = animationElement.GetAttribute("name")
				animation.length = Int(animationElement.GetAttribute("length"))
				Local looping:String = animationElement.GetAttribute("looping", MonkeySpriter.LOOPING_FALSE)
				Select looping
					Case "true"
						animation.looping = MonkeySpriter.LOOPING_TRUE
					Case "false"
						animation.looping = MonkeySpriter.LOOPING_FALSE
					Case "ping_pong"
						animation.looping = MonkeySpriter.LOOPING_PING_PONG
				End

				If debug Print "animation = " + animation.id + " " + animation.name
				
				' Should only be one mainline element
				For Local mainlineElement:XMLElement = Eachin animationElement.GetChildrenByName("mainline")
					For Local keyElement:XMLElement = Eachin mainlineElement.GetChildrenByName("key")
						Local skey:SpriterKey = New SpriterKey()
						skey.id = Int(keyElement.GetAttribute("id"))
						skey.time= Int(keyElement.GetAttribute("time", "0"))
						If debug Print "key = " + skey.id + " " + skey.time

						For Local objectRefElement:XMLElement = Eachin keyElement.GetChildrenByName("object_ref")
							Local objectRef:SpriterObjectRef = New SpriterObjectRef
							objectRef.id = Int(objectRefElement.GetAttribute("id"))
							objectRef.timeline = Int(objectRefElement.GetAttribute("timeline"))
							objectRef.key = Int(objectRefElement.GetAttribute("key"))
							objectRef.zIndex = Int(objectRefElement.GetAttribute("z_index"))
							If debug Print "object_ref = " + objectRef.id + " " + objectRef.timeline
							
							skey.objectRefs.Add(objectRef.id, objectRef)
						Next
						animation.mainline.keys.Add(skey.id, skey)
						animation.maxKey = skey.id
					Next	
				Next
				
				For Local timelineElement:XMLElement = Eachin animationElement.GetChildrenByName("timeline")
					Local timeline:SpriterTimeline = New SpriterTimeline()
					timeline.id = Int(timelineElement.GetAttribute("id"))
					If debug Print "timeline = " + timeline.id
					
					For Local keyElement:XMLElement = Eachin timelineElement.GetChildrenByName("key")
						Local key:SpriterKey = New SpriterKey()
						key.id = Int(keyElement.GetAttribute("id"))
						key.time = Int(keyElement.GetAttribute("time", "0"))
						key.spin = Int(keyElement.GetAttribute("spin", "1"))
						If debug Print "key = " + key.id + " " + key.time + " " + key.spin
						
						For Local objectElement:XMLElement = Eachin keyElement.GetChildrenByName("object")						
							Local o:SpriterObject = New SpriterObject()
							o.folder = Int(objectElement.GetAttribute("folder"))
							o.file = Int(objectElement.GetAttribute("file"))
							o.x = Float(objectElement.GetAttribute("x", "0"))
							o.y = Float(objectElement.GetAttribute("y", "0"))
							o.pivotX = Float(objectElement.GetAttribute("pivot_x", "0"))
							o.pivotY = Float(objectElement.GetAttribute("pivot_y", "0"))
							o.angle = Float(objectElement.GetAttribute("angle", "0"))
							o.scaleX = Float(objectElement.GetAttribute("scale_x", "1"))
							o.scaleY = Float(objectElement.GetAttribute("scale_y", "1"))
							o.alpha = Float(objectElement.GetAttribute("a", "1"))
							
							If debug Print "object = " + o.folder + " " + o.file + " " + o.angle
														
							key.objects.AddLast(o)
						Next
						timeline.keys.Add(key.id, key)
					Next
					animation.timelines.Add(timeline.id, timeline)
				Next
				entity.animations.Add(animation.name, animation)
			Next
			smo.entities.Add(entity.id, entity)
		Next
		Return smo
	End
End

Class TextureProvider Extends StringMap&lt;Image&gt;
	Method Load:Image(name:String)
		Local storeKey:String = name.ToUpper()

		Local i:Image = New Image
		Local imgName:String = name

		i = LoadImage(imgName )', 1, flags)
		If i = Null
			Error "Error loading image "+name
		End
		'Print "storing "+storeKey
		Self.Set(storeKey, i)
		Return i
	End
	
	Method DisplayAllStored:Void()
		' debug: print all keys in the map
		For Local key:String = Eachin Self.Keys()
			Print key + " is stored in the map."
		Next
	End
	
	Method GetTexture:Image(name:String)
		name = name.ToUpper()
	   	
		Local i:Image= Self.Get(name)
		If i = Null Then Error("Image '" + name + "' not found in the TextureProvider")
		Return i
	End	
End

Class Timer
	Field stopped:Bool
	Field rate:Float
	Const UP:Int = 1
	Const DOWN:Int = -1
	Field direction:Int
	Field count:Float
	
	Method New()
		stopped = True
		rate = 1
		direction = UP
	End
	
	Method Start:Void()
		Reset()
		Resume()
		rate = 1
	End
	
	Method Stop:Void()
		If Not stopped
			stopped = True
		End
	End
	
	Method Resume:Void()
		If stopped
			stopped = False
		End
	End
	
	Method Reset:Void()
		count = 0
		direction = UP
	End
	
	Method GetTime:Float()
		Return count / rate
	End

	Method Update:Void(timeElapsed:Int)
		If direction = UP
			count+=timeElapsed
		Else
			count-=timeElapsed
		End
	End
End</textarea> <br><br></td></tr></table><br>
<a name="2049027"></a>

<a name="2049026"></a>

<a name="2049150"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >rIKmAN</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#37">[#37]</a></td></tr></table></td></tr><tr ><td class="posttext"> Not sure if you have seen it therevills, but if you are planning on adding bones support the Admin over at BrashMonkey has posted a bone example in your Monkey thread.<br><br>Are you planning on updating this to support new Spriter features in the future?<br><br>What are the downsides to using Spriter as opposed to typical images for animation. ie. performance, memory, cpu etc. <br><br></td></tr></table><br>
<a name="2049156"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#38">[#38]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah I saw the reply and I've changed the Importer to read in the bones... but I'm not sure how to implement it at the moment.<br><br><div class="quote"> Are you planning on updating this to support new Spriter features in the future? <br></div><br>I'm getting it to a stage so I can actually use it in a game, the source is here so if I don't keep it up to date hopefully someone else will. And hopefully the Spriter team doesn't totally change the format again...<br><br><div class="quote"> What are the downsides to using Spriter as opposed to typical images for animation. ie. performance, memory, cpu etc. <br></div><br>It will require more CPU time to tween and maybe more memory due to more objects per sprite... but you save on texture memory and you can quickly change an animation without redrawing all the frames again. <br><br></td></tr></table><br>
<a name="2049347"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >rIKmAN</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#39">[#39]</a></td></tr></table></td></tr><tr ><td class="posttext"> I didn't even realise it didn't support bones until I saw your post on their forums, I assumed that was what the demo was using.<br><br>I look forward to having bones support, once that is in I will be having a proper look at using it in a game, as from what I have seen of Spriter it makes animating possible even for a complete non-artist like me.<br><br>Any ETA on the bones support or is it just an as and when for when you progress with your project? <br><br></td></tr></table><br>
<a name="2049358"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#40">[#40]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've added the importing code for the bones, but need to do the rendering... I'll be working on this for the rest of this week, but I really need to move with my main project. <br><br></td></tr></table><br>
<a name="2049402"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >rIKmAN</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#41">[#41]</a></td></tr></table></td></tr><tr ><td class="posttext"> Can't wait to see your progress :) <br><br></td></tr></table><br>
<a name="2049550"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#42">[#42]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay, hit a big bump yesterday... Slotman has been messing around with my code and found quite a huge bug.<br><br>In Spriter you can alter a pivot point in any of the keyframes. So for example say on key frame 1 the pivot for the head is at 20, 74 and on key frame 2 its at 24, 150, but the actual image doesn't move. The tween is between 74 and 150 forcing the head to move upwards.<br><br>I could minus the pivots off the co-ords, but only if I don't use "SetHandle":<br><br><pre class=code>
       |Frame 1 | Frame 2
-------+--------+---------
  x    | 20     | 24
  y    | 74     | 150
pivotX | 0.617  | 0.503
pivotY | 0.157  | 0.778

Image Height = 121 pixels

Just looking at Y:
Frame 1:
pivotYPoint = 0.157 * 121 = 18.997

newY = 74 - 18.997 = 55

Frame 2:
pivotYPoint = 0.778 * 121 = 94.138

newY = 150 - 94.138 = 56
</pre><br><br>But of course now all the angles wont be rotated at the correct point.... :( <br><br>Anyone got any ideas on how to get around this? <br><br></td></tr></table><br>
<a name="2049677"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tibit</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#43">[#43]</a></td></tr></table></td></tr><tr ><td class="posttext"> Could you do your own rotation, translation, scale &amp; pivot instead of DrawImage's using push pop matrix to mimic the Spriter behavior? <br><br></td></tr></table><br>
<a name="2049691"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#44">[#44]</a></td></tr></table></td></tr><tr ><td class="posttext"> Maybe... but I didn't really want to use matrix stuff, as I wanted to be able to convert this code quickly to BlitzMax (as this is really where I want to use it at the moment...) <br><br></td></tr></table><br>
<a name="2049696"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#45">[#45]</a></td></tr></table></td></tr><tr ><td class="posttext"> Fixed it!!!!!!!!!!!!!!!!! YAYYYYYYYYYYYY!!!!! \o/<br><br>Samah originally suggested tweening the pivots which we tried, but it didn't work... I've just revisit that idea and figured out what we did wrong:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">#TEXT_FILES="*.txt|*.xml|*.json|*.SCML|*.scml"
Strict
Import mojo
Import diddy.xml

Function Main:Int()
	New Game()
	Return 0
End

'-------------------------- Monkey Spriter Demo --------------------------
Class Game Extends App
	
	Field monster:MonkeySpriter
	Field hero:MonkeySpriter
	Field bones:MonkeySpriter
	Field devil:MonkeySpriter
	
	Const IDLE:String = "Idle"
	Const POSTURE:String = "Posture"
	Field monsterAnimName:String = IDLE
	
	Const IDLEH:String = "idle_healthy"
	Const WALK:String = "walk"
	Field heroAnimName:String = IDLEH
	Field flipX:Bool
	Field flipY:Bool
	Field lastMillisecs:Int
	Field currentMillisecs:Int 
	Field timeElapsed:Int
	Field tween:Bool = True
	Field loopType:Int
	Field scaleX:Float = 1
	Field scaleY:Float = 1
	Field debug:Bool
	
	Method OnCreate:Int()
		monster = SpriterImporter.ImportFile("monster", "Example.SCML")
		hero = SpriterImporter.ImportFile("example hero", "BetaFormatHero.SCML")
		bones = SpriterImporter.ImportFile("BoneExample", "Basic_Platformer.scml")
		devil = SpriterImporter.ImportFile("bdevil1", "bdevil1.scml")
	'	devil = SpriterImporter.ImportFile("testdevil", "testdevil.scml")
		
		monster.x = DeviceWidth() / 2
		monster.y = DeviceHeight() - 20
		hero.x = DeviceWidth() / 2 - 200
		hero.y = DeviceHeight() - 20
		bones.x = DeviceWidth() / 2
		bones.y = -100' DeviceHeight() / 2
		
		devil.x = 200
		devil.y = 400
		
		devil.timer.Start()
		bones.timer.Start()
		monster.timer.Start()
		hero.timer.Start()		
		SetUpdateRate(60)
		lastMillisecs = Millisecs()
		loopType = MonkeySpriter.LOOPING_TRUE
		debug = false
		CreateGUI()
		Return 0
	End
	
	Method CreateGUI:Void()
		Local b:Button = New Button("Anim 1", 0, 10, 100, 20)
		b.SetColour(255, 0, 0)
		b = New Button("Anim 2", 110, 10, 100, 20)

		b = New Button("Loop Type", 220, 10, 100, 20)
		b.SetColour(255, 255, 0)
		
		b = New Button("Reset Timer", 330, 10, 100, 20)
		b.SetColour(255, 0, 255)
		
		b = New Button("Stop Timer", 440, 10, 100, 20)
		b.SetColour(0, 255, 255)
		
		b = New Button("Resume Timer", 550, 10, 100, 20)
		b.SetColour(0, 255, 0)
		
		b = New Button("Slower", 440, 40, 100, 20)
		b.SetColour(100, 100, 100)
		
		b = New Button("Faster", 550, 40, 100, 20)
		b.SetColour(0, 0, 255)
		
		b = New Button("Tween On/Off", 330, 40, 100, 20)
		b.SetColour(25, 255, 25)

		b = New Button("Flip X", 0, 70, 100, 20)
		b.SetColour(25, 255, 125)	

		b = New Button("Flip Y", 110, 70, 100, 20)
		b.SetColour(123, 123, 255)	

		b = New Button("Scale Up", 0, 40, 100, 20)
		b.SetColour(255, 33, 125)	
		
		b = New Button("Scale Down", 110, 40, 100, 20)
		b.SetColour(125, 0, 125)
		
		b = New Button("Debug On/Off", 220, 40, 100, 20)
		b.SetColour(125, 230, 234)	
	End
	
	Method OnUpdate:Int()
		' simple delta timing
		currentMillisecs = Millisecs()
		timeElapsed = currentMillisecs - lastMillisecs 
		lastMillisecs = currentMillisecs

		hero.Update(heroAnimName, loopType, timeElapsed)
		monster.Update(monsterAnimName, loopType, timeElapsed)
		
		bones.Update("Player_Idle", loopType, timeElapsed)
		
		devil.Update("idle", loopType, timeElapsed)
		Controls()
		Return 0
	End	
	
	Method OnRender:Int()
		Cls
		monster.Draw(tween)
		hero.Draw(tween)
		bones.Draw(tween)
		devil.Draw(tween)
		
		Button.DrawAll()
		If debug Then DrawDebug()
		Return 0
	End
	
	Method Controls:Void()
		Button.UpdateAll()
		If Button.Clicked("Debug On/Off") Then
			debug = Not debug
		End
		If Button.Clicked("Scale Up") Then
			scaleX *= 1.1
			scaleY *= 1.1
			monster.SetScale(scaleX, scaleY)
			hero.SetScale(scaleX, scaleY)
			bones.SetScale(scaleX, scaleY)
		End
		If Button.Clicked("Scale Down") Then
			scaleX /= 1.1
			scaleY /= 1.1
			monster.SetScale(scaleX, scaleY)
			hero.SetScale(scaleX, scaleY)
			bones.SetScale(scaleX, scaleY)
		End
		If Button.Clicked("Flip X") Then
			scaleX = -scaleX
			monster.SetScale(scaleX, monster.scaleY)
			hero.SetScale(scaleX, monster.scaleY)
		End
		If Button.Clicked("Flip Y") Then
			scaleY = -scaleY
			monster.SetScale(monster.scaleX, scaleY)
			hero.SetScale(hero.scaleX, scaleY)
			monster.y = DeviceHeight() - monster.y
			hero.y = DeviceHeight() - hero.y
		End
		If Button.Clicked("Stop Timer") Then
			monster.timer.Stop()
			hero.timer.Stop()
			devil.timer.Stop()
		End
		If Button.Clicked("Resume Timer") Then
			monster.timer.Resume()
			hero.timer.Resume()
			devil.timer.Resume()
		End
		If Button.Clicked("Reset Timer") Then
			monster.timer.Start()
			hero.timer.Start()
			monster.mainlineKeyId = 0
			hero.mainlineKeyId = 0
		End
		If Button.Clicked("Faster") Then
			hero.timer.rate/=1.1
			monster.timer.rate/=1.1
		End
		If Button.Clicked("Slower") Then
			hero.timer.rate*=1.1
			monster.timer.rate*=1.1
			devil.timer.rate*=1.1
		End
		If Button.Clicked("Anim 1") Then
			monsterAnimName = IDLE
			heroAnimName = IDLEH
			monster.mainlineKeyId = 0
			monster.timer.Start()
			hero.mainlineKeyId = 0
			hero.timer.Start()
		End
		If Button.Clicked("Anim 2") Then
			monsterAnimName = POSTURE
			heroAnimName = WALK
			monster.mainlineKeyId = 0
			monster.timer.Start()
			hero.mainlineKeyId = 0
			hero.timer.Start()
		End
		If Button.Clicked("Tween On/Off") Then
			tween = Not tween
		End
		If Button.Clicked("Loop Type") Then
			monster.timer.Start()
			hero.timer.Start()
			monster.mainlineKeyId = 0
			hero.mainlineKeyId = 0
			loopType += 1
			If loopType &gt; 2 loopType = 0
		End
		
		If KeyDown(KEY_W) hero.y-=2
		If KeyDown(KEY_S) hero.y+=2
		If KeyDown(KEY_A) hero.x-=2
		If KeyDown(KEY_D) hero.x+=2
	End
	
	Method DrawDebug:Void()
		Local y:Int = 100
		Local gap:Int = 15
		SetAlpha(0.75)
		DrawText("MONKEY SPRITER IMPORTER", 10, y)
		y+=gap
		y+=gap
		DrawText("Monster Timer = " + monster.timer.GetTime(), 10, y)
		y+=gap
		DrawText("Hero Timer    = " + hero.timer.GetTime(), 10, y)
		y+=gap
		DrawText("Devil Timer   = " + devil.timer.GetTime(), 10, y)
		y+=gap
		DrawText("Time Elapsed  = " + timeElapsed, 10, y)
		y+=gap
		Local loopString:String
		Select loopType
			Case 0
				loopString = "FALSE"
			Case 1
				loopString = "TRUE"
			Case 2
				loopString = "PING PONG"
		End
		DrawText("Looping Type  = " + loopString, 10, y)
		y+=gap
		DrawText("Timer Rate    = " + monster.timer.rate, 10, y)
		y+=gap
		If tween
			DrawText("Tweening      = TRUE", 10, y)
		Else
			DrawText("Tweening      = FALSE", 10, y)
		End
		y+=gap
		DrawText("Scale X       = " + scaleX, 10, y)
		y+=gap
		DrawText("Scale Y       = " + scaleY, 10, y)

		SetAlpha(1)
	End
End
'-------------------------- Simple Button --------------------------
Class Button
	Field x:Int, y:Int
	Field w:Int, h:Int
	Field label:String
	Field name:String
	Field r:Int = 255, g:Int = 255, b:Int = 255
	Field mouseOver:Bool = False
	Field clicked:Bool = False
	Global clickedName:String = ""
	Global list:List&lt;Button&gt;
	
	Method New(label:String, x:Int, y:Int, w:Int, h:Int)
		If list = Null Then list = New List&lt;Button&gt;
		Self.label = label
		Self.name = label.ToUpper()
		Self.x = x
		Self.y = y
		Self.w = w
		Self.h = h
		
		list.AddLast(Self)
	End
	
	Method SetColour:Void(r:Int, g:Int, b:Int)
		Self.r = r
		Self.g = g
		Self.b = b
	End
	
	Method Update:Void()
		If RectsOverlap(MouseX(), MouseY(), 3, 3, Self.x, Self.y, Self.w, Self.h)
			mouseOver = True
			If MouseHit(MOUSE_LEFT)
				If Not clicked
					clicked = True
				End
			Else
				clicked = False
			End
		Else
			clicked = False
			mouseOver = False
		End
	End
	
	Method Draw:Void()
		Local light:Int = -25
		If mouseOver
			light = 120
			SetAlpha(1)
		End
		SetColor (r + light, g + light, b + light)
		DrawRect (x, y, w, h)
		SetColor (255, 255, 255)
		DrawText (label, x + 2, y + 2)
	End
	
	Function DrawAll:Void()
		For Local b:Button = Eachin list
			SetAlpha(0.75)
			b.Draw()
		End
		SetAlpha(1)		
	End
	
	Function Clicked:Int(name:String)
		name = name.ToUpper()
		If name = clickedName
			clickedName = ""
			Return 1		
		Else
			Return 0
		End
	End
	
	Function UpdateAll:Void()
		clickedName = ""
		For Local b:Button = Eachin list
			b.Update()
			If b.clicked Then clickedName = b.name
		End
	End
End

Function RectsOverlap:Int(x0:Float, y0:Float, w0:Float, h0:Float, x2:Float, y2:Float, w2:Float, h2:Float)
	If x0 &gt; (x2 + w2) Or (x0 + w0) &lt; x2 Then Return False
	If y0 &gt; (y2 + h2) Or (y0 + h0) &lt; y2 Then Return False
	Return True
End

'-------------------------- Monkey Spriter Code --------------------------
Class MonkeySpriter
	Field textures:TextureProvider = New TextureProvider()
	Field folders:IntMap&lt;SpriterFolder&gt;
	Field entities:IntMap&lt;SpriterEntity&gt;
	Field mainPath:String
	Field animationName:String
	Field nextKeyTime:Int
	Field mainlineKeyId:Int
	Field timer:Timer
	Field scaleX:Float = 1
	Field scaleY:Float = 1
	Field x:Float, y:Float
	Const LOOPING_FALSE:Int = 0
	Const LOOPING_TRUE:Int = 1
	Const LOOPING_PING_PONG:Int = 2
	
	Method New()
		Self.folders = New IntMap&lt;SpriterFolder&gt;
		Self.entities = New IntMap&lt;SpriterEntity&gt;
		mainlineKeyId = 0
		timer = New Timer
	End
	
	Method Copy:MonkeySpriter()
		Local ms:MonkeySpriter = New MonkeySpriter
		ms.textures = Self.textures
		ms.folders  = Self.folders
		ms.entities = Self.entities
		ms.mainPath = Self.mainPath
		ms.animationName = Self.animationName
		ms.nextKeyTime   = Self.nextKeyTime
		ms.mainlineKeyId = Self.mainlineKeyId
		ms.timer = New Timer
		ms.scaleX = Self.scaleX
		ms.scaleY = Self.scaleY
		ms.x = Self.x
		ms.y = Self.y
		Return ms
	End Method
	
	Method Update:Void(animationName:String, looping:Int = LOOPING_TRUE, timeElapsed:Int)
		Self.animationName = animationName
		If Not timer.stopped
			timer.Update(timeElapsed)
			Local animation:SpriterAnimation
			Try
				animation = entities.Get(0).animations.Get(animationName)
				If animation = Null Then Throw New Throwable
			Catch ex:Throwable
        		Print "Animation is null! Can not find animation " + animationName
			End
			
			If looping &lt;&gt; "" Then
				animation.looping = looping
			End
			Local mainline:SpriterMainline = animation.mainline
			If timer.GetTime() &gt;= animation.length
				If animation.looping = LOOPING_TRUE
					timer.Reset()
				Else If animation.looping = LOOPING_PING_PONG
					timer.direction = timer.DOWN
				Else If animation.looping = LOOPING_FALSE
					timer.Stop()
				End
			End
			If animation.looping = LOOPING_PING_PONG And timer.GetTime() &lt;= 0
				timer.direction = timer.UP
				timer.Reset()
			End
		End		
	End
	
	Method Draw:Void(tween:Bool = False)
		Local anim:SpriterAnimation = entities.Get(0).animations.Get(animationName)
		If anim = Null Return
		Local mainline:SpriterMainline = anim.mainline
		
		Local time:Float = timer.GetTime()
		mainlineKeyId = mainline.GetKeyViaTime(time).id
		Local mainlineKey:SpriterKey = mainline.keys.Get(mainlineKeyId)
		
		Local boneMap:IntMap&lt;SpriterBone&gt; = New IntMap&lt;SpriterBone&gt;
		For Local i:Int = Eachin mainlineKey.boneRefs.Keys()
			Local boneRef:SpriterBoneRef = mainlineKey.boneRefs.Get(i)
			Local timeline:SpriterTimeline = anim.timelines.Get(boneRef.timeline)
			Local timelineKey:SpriterKey = timeline.GetKeyViaTime(time)
			Local nextTimelineKey:SpriterKey = timeline.keys.Get(boneRef.key + 1)
			Local nextKeyTime:Int
			
			For Local b:SpriterBone = Eachin timelineKey.bones
				boneMap.Add(i, b)
			Next
		Next

		For Local i:Int = Eachin mainlineKey.objectRefs.Keys()
			Local objRef:SpriterObjectRef = mainlineKey.objectRefs.Get(i)
			Local timeline:SpriterTimeline = anim.timelines.Get(objRef.timeline)
			Local timelineKey:SpriterKey = timeline.GetKeyViaTime(time)
			Local nextTimelineKey:SpriterKey = timeline.keys.Get(objRef.key + 1)
			Local nextKeyTime:Int
			
			If nextTimelineKey = Null Then
				If anim.looping = LOOPING_TRUE
					nextTimelineKey = timeline.keys.Get(0)
					nextKeyTime = anim.length
					' next timeline might not start at the beginning of the animation
					If nextTimelineKey.time &gt; 0 Then
						nextKeyTime += nextTimelineKey.time
					End
				Else If anim.looping = LOOPING_PING_PONG
					If timer.direction = timer.UP
						nextKeyTime = anim.length
					Else
						nextKeyTime = 0
					End
					nextTimelineKey = timelineKey
				Else If anim.looping = LOOPING_FALSE
					nextTimelineKey = timelineKey
					nextKeyTime = anim.length	
				End
			Else
				nextKeyTime = nextTimelineKey.time
			End
			
			Local nextO:SpriterObject = nextTimelineKey.objects.Last()

			Local bone:SpriterBone
			If objRef.parent &gt; -1
			'	bone = boneMap.Get(objRef.parent)
			End

			For Local o:SpriterObject = Eachin timelineKey.objects
				Local folder:SpriterFolder = Self.folders.Get(o.folder)
				Local file:SpriterFile = folder.files.Get(o.file)
				Local texture:Image = textures.GetTexture(Self.mainPath + "/" + file.name.ToUpper())

				Local nextFolder:SpriterFolder = Self.folders.Get(nextO.folder)
				Local nextFile:SpriterFile = nextFolder.files.Get(nextO.file)
				Local nextTexture:Image = textures.GetTexture(Self.mainPath + "/" + nextFile.name.ToUpper())
			
				Local currentAngle:Float = o.angle
				Local nextAngle:Float = nextO.angle

				'XOR
				If (scaleX &lt; 0) &lt;&gt; (scaleY &lt; 0) Then
					currentAngle = -currentAngle
					nextAngle = -nextAngle
				End

				If 1=0'bone
					Local bx# = (bone.x)+ x
					Local by# = (bone.y) + y
					Local ba# = 90'bone.angle
					Local bsx# = 1'bone.scaleX' * scaleX
					Local bsy# =  1'bone.scaleY' * scaleY
					DrawImage(texture, bx, by, ba, bsx, bsy, 0)
				Else
					If tween
						Local x1# = o.x
						Local x2# = nextO.x
						Local y1# = o.y
						Local y2# = nextO.y
						
						Local tweenedPivotX:Float = LinearInterpolation(o.pivotX, nextO.pivotX, timelineKey.time, nextKeyTime, time)
						Local tweenedPivotY:Float = LinearInterpolation(o.pivotY, nextO.pivotY, timelineKey.time, nextKeyTime, time)
						
						Local tweenedX:Float = LinearInterpolation(x1, x2, timelineKey.time, nextKeyTime, time)
						Local tweenedY:Float = LinearInterpolation(y1, y2, timelineKey.time, nextKeyTime, time)
						Local tweenedAngle:Float = AngleLinearInterpolation(currentAngle, nextAngle, timelineKey.time, nextKeyTime, time)
						Local tweenedScaleX:Float = LinearInterpolation(o.scaleX, nextO.scaleX, timelineKey.time, nextKeyTime, time)
						Local tweenedScaleY:Float = LinearInterpolation(o.scaleY, nextO.scaleY, timelineKey.time, nextKeyTime, time)
						Local tweenedAlpha:Float = LinearInterpolation(o.alpha, nextO.alpha, timelineKey.time, nextKeyTime, time)

						texture.SetHandle(tweenedPivotX * texture.Width(),  nextTexture.Height() + (-tweenedPivotY * nextTexture.Height()))
						
						SetAlpha(tweenedAlpha)
						DrawImage(texture, tweenedX * scaleX + x, -tweenedY * scaleY + y, tweenedAngle, tweenedScaleX * scaleX, tweenedScaleY * scaleY, 0)
					Else
						texture.SetHandle(o.pivotX * texture.Width(),  nextTexture.Height() + (-o.pivotY * nextTexture.Height()))
						SetAlpha(o.alpha)
						DrawImage(texture, o.x * scaleX + x, -o.y * scaleY + y, currentAngle, o.scaleX * scaleX, o.scaleY * scaleY, 0)
					End
				End
			Next		
			SetAlpha(1)
			DrawText timelineKey.id +" " +nextTimelineKey.id, x, y
		Next
	End
	
	Method LinearInterpolation:Float(a:Float, b:Float, timeA:Float, timeB:Float, currentTime:Float)
		Return a + ((b - a) * ((currentTime - timeA) / (timeB - timeA)))
	End
	
	Method AngleLinearInterpolation:Float(a:Float, b:Float, timeA:Float, timeB:Float, currentTime:Float)
		return a + (AngleDifference(b, a) * ((currentTime - timeA) / (timeB - timeA)))
	End
	
	Method AngleDifference:Float(a:Float, b:Float)
		Return ((((a - b) Mod 360) + 540) Mod 360) - 180
	End
	
	Method SetScale:Void(scaleX:Float, scaleY:Float)
		Self.scaleX = scaleX
		Self.scaleY = scaleY
	End
End

Class SpriterFolder
	Field files:IntMap&lt;SpriterFile&gt;
	Field id:Int
	Field name:String
	
	Method New()
		Self.files = New IntMap&lt;SpriterFile&gt;
	End
End

Class SpriterFile
	Field id:Int
	Field name:String
	Field width:Int
	Field height:Int
End

Class SpriterEntity
	Field id:Int
	Field name:String
	Field animations:StringMap&lt;SpriterAnimation&gt;
	
	Method New()
		Self.animations = New StringMap&lt;SpriterAnimation&gt;
	End
End

Class SpriterAnimation
	Field id:Int
	Field name:String
	Field length:Int
	Field looping:Int
	Field mainline:SpriterMainline
	Field timelines:IntMap&lt;SpriterTimeline&gt;
	Field maxKey:Int
	
	Method New()
		Self.mainline = New SpriterMainline
		Self.timelines = New IntMap&lt;SpriterTimeline&gt;
	End
End

Class SpriterMainline
	Field keys:IntMap&lt;SpriterKey&gt;
	Field keyId:Int = 0
	Field delay:Float = 0
	Field maxDelay:Int = 5
	Field speed:Float = 1.5
	Field maxKey:Int
		
	Method New()
		Self.keys = New IntMap&lt;SpriterKey&gt;
	End
		
	Method GetKey:SpriterKey(timer:Timer)
		Local rv:SpriterKey = Self.keys.Get(0)
		For Local i:Int = Eachin Self.keys.Keys()
			Local key:SpriterKey = Self.keys.Get(i)
			If key.time &gt; timer.GetTime()
				Return rv
			End
			rv = key
		Next
		Return rv
	End
	
	Method GetKeyViaTime:SpriterKey(time:Float)
		Local rv:SpriterKey = Self.keys.Get(0)
		For Local i:Int = Eachin Self.keys.Keys()
			Local key:SpriterKey = Self.keys.Get(i)
			If key.time &gt; time
				Return rv
			End
			rv = key
		Next
		Return rv
	End

End

Class SpriterKey
	Field id:Int
	Field time:Int
	Field spin:Int
	Field objectRefs:IntMap&lt;SpriterObjectRef&gt;
	Field objects:List&lt;SpriterObject&gt;
	Field boneRefs:IntMap&lt;SpriterBoneRef&gt;
	Field bones:List&lt;SpriterBone&gt;
	
	Method New()
		Self.objectRefs = New IntMap&lt;SpriterObjectRef&gt;
		Self.objects = New List&lt;SpriterObject&gt;
		Self.boneRefs = New IntMap&lt;SpriterBoneRef&gt;
		Self.bones = New List&lt;SpriterBone&gt;
	End
End

Class SpriterBoneRef
	Field id:Int
	Field timeline:Int
	Field parent:Int
	Field key:Int
End

Class SpriterObjectRef
	Field id:Int
	Field timeline:Int
	Field key:Int
	Field zIndex:Int
	Field parent:Int
End

Class SpriterTimeline
	Field id:Int
	Field keys:IntMap&lt;SpriterKey&gt;
	Field keyId:Int = 0
	Field delay:Float = 0
	Field maxDelay:Int = 5
	Field speed:Float = 1.5
	Field maxKey:Int
	Field name:String
	
	Method New()
		Self.keys = New IntMap&lt;SpriterKey&gt;
	End
	
	Method GetKey:SpriterKey(timer:Timer)
		Local rv:SpriterKey = Self.keys.Get(0)
		For Local i:Int = Eachin Self.keys.Keys()
			Local key:SpriterKey = Self.keys.Get(i)
			If key.time &gt; timer.GetTime()
				Return rv
			End
			rv = key
		Next
		Return rv
	End
	
	Method GetKeyViaTime:SpriterKey(time:Float)
		Local rv:SpriterKey = Self.keys.Get(0)
		For Local i:Int = Eachin Self.keys.Keys()
			Local key:SpriterKey = Self.keys.Get(i)
			If key.time &gt; time
				Return rv
			End
			rv = key
		Next
		Return rv
	End

End

Class SpriterObject
	Field folder:Int
	Field file:Int
	Field x:Float
	Field y:Float
	Field pivotX:Float
	Field pivotY:Float
	Field angle:Float
	Field scaleX:Float
	Field scaleY:Float
	Field alpha:Float
End

Class SpriterBone
	Field x:Float
	Field y:Float
	Field angle:Float
	Field scaleX:Float
	Field scaleY:Float
End

Class SpriterImporter
	Function ImportFile:MonkeySpriter(path:String, file:String, debug:Bool = False)
		If debug Then Print "Importing " + path + "/" + file

		Local str:String = LoadString(path + "/" + file)
		If str = "" Then Error "Error loading file..."
		
		Local xmlReader:XMLParser = New XMLParser		
		Local doc:XMLDocument = xmlReader.ParseString(str)
		Local rootElement:XMLElement = doc.Root

		Local smo:MonkeySpriter = New MonkeySpriter()
		smo.mainPath = path
		For Local folderElement:XMLElement = Eachin rootElement.GetChildrenByName("folder")
			Local folder:SpriterFolder = New SpriterFolder()
			folder.id = Int(folderElement.GetAttribute("id"))
			folder.name = folderElement.GetAttribute("name")
			If debug Print "folder = " + folder.id + " " + folder.name
			
			For Local fileElement:XMLElement = Eachin folderElement.GetChildrenByName("file")
				Local file:SpriterFile = New SpriterFile()
				file.id = Int(fileElement.GetAttribute("id"))
				file.name = fileElement.GetAttribute("name")
				file.width = Int(fileElement.GetAttribute("width"))
				file.height = Int(fileElement.GetAttribute("height"))
				
				If debug Print "file = " + file.id + " " + file.name
				smo.textures.Load(path + "/" + file.name)
				
				folder.files.Add(file.id, file)
			Next
			smo.folders.Add(folder.id, folder)
		Next
		
		For Local entityElement:XMLElement = Eachin rootElement.GetChildrenByName("entity")
			Local entity:SpriterEntity = New SpriterEntity()
			Local id:String = entityElement.GetAttribute("id")
			Local name:String = entityElement.GetAttribute("name")
			
			If debug Print "entity = " + id + " " + name
			For Local animationElement:XMLElement = Eachin entityElement.GetChildrenByName("animation")
				Local animation:SpriterAnimation = New SpriterAnimation()
				animation.id  = Int(animationElement.GetAttribute("id"))
				animation.name = animationElement.GetAttribute("name")
				animation.length = Int(animationElement.GetAttribute("length"))
				Local looping:String = animationElement.GetAttribute("looping", MonkeySpriter.LOOPING_FALSE)
				Select looping
					Case "true"
						animation.looping = MonkeySpriter.LOOPING_TRUE
					Case "false"
						animation.looping = MonkeySpriter.LOOPING_FALSE
					Case "ping_pong"
						animation.looping = MonkeySpriter.LOOPING_PING_PONG
				End

				If debug Print "animation = " + animation.id + " " + animation.name
				
				' Should only be one mainline element
				For Local mainlineElement:XMLElement = Eachin animationElement.GetChildrenByName("mainline")
					For Local keyElement:XMLElement = Eachin mainlineElement.GetChildrenByName("key")
						Local skey:SpriterKey = New SpriterKey()
						skey.id = Int(keyElement.GetAttribute("id"))
						skey.time= Int(keyElement.GetAttribute("time", "0"))
						If debug Print "key = " + skey.id + " " + skey.time

						For Local boneRefElement:XMLElement = Eachin keyElement.GetChildrenByName("bone_ref")
							Local boneRef:SpriterBoneRef = New SpriterBoneRef
							boneRef.id = Int(boneRefElement.GetAttribute("id"))
							boneRef.parent = Int(boneRefElement.GetAttribute("parent", "-1"))
							boneRef.timeline = Int(boneRefElement.GetAttribute("timeline"))
							boneRef.key = Int(boneRefElement.GetAttribute("key"))
							If debug Then Print "bone_ref = " + boneRef.id + " " + boneRef.timeline
							skey.boneRefs.Add(boneRef.id, boneRef)
						Next

						For Local objectRefElement:XMLElement = Eachin keyElement.GetChildrenByName("object_ref")
							Local objectRef:SpriterObjectRef = New SpriterObjectRef
							objectRef.id = Int(objectRefElement.GetAttribute("id"))
							objectRef.timeline = Int(objectRefElement.GetAttribute("timeline"))
							objectRef.key = Int(objectRefElement.GetAttribute("key"))
							objectRef.zIndex = Int(objectRefElement.GetAttribute("z_index"))
							objectRef.parent = Int(objectRefElement.GetAttribute("parent", "-1"))
							If debug Print "object_ref = " + objectRef.id + " " + objectRef.timeline + " " + objectRef.parent
							
							skey.objectRefs.Add(objectRef.id, objectRef)
						Next
						animation.mainline.keys.Add(skey.id, skey)
						animation.maxKey = skey.id
					Next	
				Next
				
				For Local timelineElement:XMLElement = Eachin animationElement.GetChildrenByName("timeline")
					Local timeline:SpriterTimeline = New SpriterTimeline()
					timeline.id = Int(timelineElement.GetAttribute("id"))
					timeline.name = timelineElement.GetAttribute("id", "")
					If debug Print "timeline = " + timeline.id + " " + timeline.name
					
					For Local keyElement:XMLElement = Eachin timelineElement.GetChildrenByName("key")
						Local key:SpriterKey = New SpriterKey()
						key.id = Int(keyElement.GetAttribute("id"))
						key.time = Int(keyElement.GetAttribute("time", "0"))
						key.spin = Int(keyElement.GetAttribute("spin", "1"))
						If debug Print "key = " + key.id + " " + key.time + " " + key.spin
						
						For Local boneElement:XMLElement = Eachin keyElement.GetChildrenByName("bone")
							Local b:SpriterBone = New SpriterBone()
							b.x = Float(boneElement.GetAttribute("x", "0"))
							b.y = Float(boneElement.GetAttribute("y", "0"))
							b.angle = Float(boneElement.GetAttribute("angle", "0"))
							b.scaleX = Float(boneElement.GetAttribute("scale_x", "1"))
							b.scaleY = Float(boneElement.GetAttribute("scale_y", "1"))
							
							If debug Print "bone = " + b.x + " " + b.y + " " + b.angle
							
							key.bones.AddLast(b)
						Next
						
						For Local objectElement:XMLElement = Eachin keyElement.GetChildrenByName("object")						
							Local o:SpriterObject = New SpriterObject()
							o.folder = Int(objectElement.GetAttribute("folder"))
							o.file = Int(objectElement.GetAttribute("file"))
							o.x = Float(objectElement.GetAttribute("x", "0"))
							o.y = Float(objectElement.GetAttribute("y", "0"))
							o.pivotX = Float(objectElement.GetAttribute("pivot_x", "0"))
							o.pivotY = Float(objectElement.GetAttribute("pivot_y", "1"))
							o.angle = Float(objectElement.GetAttribute("angle", "0"))
							o.scaleX = Float(objectElement.GetAttribute("scale_x", "1"))
							o.scaleY = Float(objectElement.GetAttribute("scale_y", "1"))
							o.alpha = Float(objectElement.GetAttribute("a", "1"))
							
							If debug Print "object = " + o.folder + " " + o.file + " " + o.angle
														
							key.objects.AddLast(o)
						Next
						timeline.keys.Add(key.id, key)
					Next
					animation.timelines.Add(timeline.id, timeline)
				Next
				entity.animations.Add(animation.name, animation)
			Next
			smo.entities.Add(entity.id, entity)
		Next
		Return smo
	End
End

Class TextureProvider Extends StringMap&lt;Image&gt;
	Method Load:Image(name:String)
		Local storeKey:String = name.ToUpper()

		Local i:Image = New Image
		Local imgName:String = name

		i = LoadImage(imgName )', 1, flags)
		If i = Null
			Error "Error loading image "+name
		End
		'Print "storing "+storeKey
		Self.Set(storeKey, i)
		Return i
	End
	
	Method DisplayAllStored:Void()
		' debug: print all keys in the map
		For Local key:String = Eachin Self.Keys()
			Print key + " is stored in the map."
		Next
	End
	
	Method GetTexture:Image(name:String)
		name = name.ToUpper()
	   	
		Local i:Image= Self.Get(name)
		If i = Null Then Error("Image '" + name + "' not found in the TextureProvider")
		Return i
	End	
End

Class Timer
	Field stopped:Bool
	Field rate:Float
	Const UP:Int = 1
	Const DOWN:Int = -1
	Field direction:Int
	Field count:Float
	
	Method New()
		stopped = True
		rate = 1
		direction = UP
	End
	
	Method Start:Void()
		Reset()
		Resume()
		rate = 1
	End
	
	Method Stop:Void()
		If Not stopped
			stopped = True
		End
	End
	
	Method Resume:Void()
		If stopped
			stopped = False
		End
	End
	
	Method Reset:Void()
		count = 0
		direction = UP
	End
	
	Method GetTime:Float()
		Return count / rate
	End

	Method Update:Void(timeElapsed:Int)
		If direction = UP
			count+=timeElapsed
		Else
			count-=timeElapsed
		End
	End
End</textarea> <br><br></td></tr></table><br>
<a name="2049695"></a>

<a name="2049693"></a>

<a name="2049697"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#46">[#46]</a></td></tr></table></td></tr><tr ><td class="posttext"> Decided on uploading the code to Google Code:<br><br><a href="https://code.google.com/p/monkey-spriter-importer/" target="_blank">https://code.google.com/p/monkey-spriter-importer/</a> <br><br></td></tr></table><br>
<a name="2049734"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >rIKmAN</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#47">[#47]</a></td></tr></table></td></tr><tr ><td class="posttext"> Great work mate, so bones are fully working now? :)<br><br>Are those example files available from the Spriter site? <br><br></td></tr></table><br>
<a name="2049778"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#48">[#48]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> so bones are fully working now? <br></div><br>Nope, I was having trouble with pivots and it was really doing my head in!<br><br><div class="quote"> Are those example files available from the Spriter site?  <br></div><br>They should be, or you can get them on the Google Code page. <br><br></td></tr></table><br>
<a name="2049815"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#49">[#49]</a></td></tr></table></td></tr><tr ><td class="posttext"> WIP Bones added... my brain hurts :P<br><br><a href="http://www.therevillsgames.com/monkey/SpriterA4/MonkeyGame.html" target="_blank">http://www.therevillsgames.com/monkey/SpriterA4/MonkeyGame.html</a> <br><br></td></tr></table><br>
<a name="2049816"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dopeyrulz</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#50">[#50]</a></td></tr></table></td></tr><tr ><td class="posttext"> @therevills<br><br>Your flipping on the right-hand character is not working properly - otherwise looks ok! <br><br></td></tr></table><br>
<a name="2049820"></a>

<a name="2049821"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#51">[#51]</a></td></tr></table></td></tr><tr ><td class="posttext"> LOL... that's why its WIP :-) <br><br></td></tr></table><br>
<a name="2050069"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >rIKmAN</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#52">[#52]</a></td></tr></table></td></tr><tr ><td class="posttext"> There aren't any files listed in the downloads section on the Google Code page, do I need to SVN like with Diddy?<br><br>Also, I've posted on the App page as well, but how are you keeping the images so crisp when rotating / scaling?<br><br>As soon as I rotate or scale any image in 4.1a it gets distorted / jaggy, and apparently it is a known issue, but doesn't seem to affect your demo? <br><br></td></tr></table><br>
<a name="2050083"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#53">[#53]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> do I need to SVN like with Diddy? <br></div><br>I'm using Mercurial (Hg) this time around :)<br><br><div class="quote"> but how are you keeping the images so crisp when rotating / scaling? <br></div><br>The power of Monkey ;) It's the image filtering built into Monkey, if you turn it off it will look pixelated. <br><br></td></tr></table><br>
<a name="2050085"></a>

<a name="2050086"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >rIKmAN</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#54">[#54]</a></td></tr></table></td></tr><tr ><td class="posttext"> Not for me - they start getting jaggies when I rotate them in Spriter so it can't be Monkey, unless you're saying Monkey fixes these jaggies once loaded?<br><br>Thinking about it you are using demo files - it's possible they are exported from a newer version than 4.1a.<br><br>If you load in the monster demo and rotate his head you'll see the jaggies and distortion on his face - when you get time could you test it?<br><br>Also maybe load the demo monster into 4.1a, re-save it and see if that is still smooth and crisp in your demo. <br><br></td></tr></table><br>
<a name="2050090"></a>

<a name="2050091"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#55">[#55]</a></td></tr></table></td></tr><tr ><td class="posttext"> Because we render the images using Monkey it is smooth, it is the Sprinter application which is not smoothing them. We are just using the animation file in Monkey. <br><br></td></tr></table><br>
<a name="2050115"></a>

<a name="2050116"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >rIKmAN</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#56">[#56]</a></td></tr></table></td></tr><tr ><td class="posttext"> So it isn't just me then? - ut's becuase you are using a non-jaggy premade .scml file (+images)..?<br><br>If you were to use Spriter like I explained to make your own test character you would also get the ugly jaggies?<br><br>Just want to make sure it's not me going mad, I spent about 3hrs messing round last night and got nowhere really due to it looking so ugly. <br><br></td></tr></table><br>
<a name="2050142"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#57">[#57]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry... okay let's try again. For me, the images within the Spriter application are pixelated when scaled and rotated, but when I load them using my code into Monkey its fine. <br><br></td></tr></table><br>
<a name="2050144"></a>

<a name="2050145"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >rIKmAN</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#58">[#58]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ahhhh!<br><br>I never tried getting them into Monkey as they got messed up in Spriter so I thought that was where the problem was.<br><br>I'll give that a go, ignore how it looks in Spriter and see if I can finally get it looking right in Monkey once its loaded in.<br><br>Thanks for the info.<br><br>edit<br>I missed one of your replies when posting, hence me asking you the same thing again, apologies :) <br><br></td></tr></table><br>
<a name="2050143"></a>

<a name="2050243"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >rIKmAN</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#59">[#59]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just tested this and it works perfectly when in Monkey, smooth and crisp just as you said.<br><br>Thanks mate, next up flipped bones! :P<br><br>&lt;snipped a load of waffle&gt;<br><br>When I add my unboned character to your demo and set looping to false, after the animation has finished he warps into a pile of limbs, but the x/y position do not change when this happens.<br><br>If I turn off tweening, then he looks fine when the animation ends - so it's something to do with tweening.<br>I must be missing something but can't see anything in the demo code with your models that I'm not doing with mine.  Any ideas?<br><br>edit<br>I fixed/bodged this by checking timer.GetTime() against a value around 20ms less than the length of the animation inside Spriter. <br><br></td></tr></table><br>
<a name="2050235"></a>

<a name="2050236"></a>

<a name="2050237"></a>

<a name="2050233"></a>

<a name="2050234"></a>

<a name="2050217"></a>

<a name="2050213"></a>

<a name="2050214"></a>

<a name="2050212"></a>

<a name="2050211"></a>

<a name="2050147"></a>

<a name="2051267"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#60">[#60]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> after the animation has finished he warps into a pile of limbs <br></div><br>Any chance you could send me your character?<br><br><br>Re: Flipped bones........ I give up, until the Spriter guys release the development guides, I've been trying off and on for the past two weeks and getting nowhere! <br><br></td></tr></table><br>
<a name="2051334"></a>

<a name="2051335"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#61">[#61]</a></td></tr></table></td></tr><tr ><td class="posttext"> I had a mini-brainwave last night and thought sod flipping the bones, why don't I just flip the images!<br><br><a href="http://www.therevillsgames.com/monkey/SpriterA4/MonkeyGame.html" target="_blank">http://www.therevillsgames.com/monkey/SpriterA4/MonkeyGame.html</a> <br><br></td></tr></table><br>
<a name="2051637"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >rIKmAN</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#62">[#62]</a></td></tr></table></td></tr><tr ><td class="posttext"> There is a <a href="http://www.brashmonkey.com/forum/viewtopic.php?f=2&amp;t=2503&amp;start=10" target="_blank">post on the Spriter forum</a> by C2tP which basically says the same thing - don't flip the bones.<br><br>I am not using bones at the moment as I wanted to get it working with just images before I spent time setting up a rig, but even that is giving me issues when trying to flip - although I suspect my code is at fault here rather than Spriter or your importer.<br><br>Do you still want my character that collapses when not in loop mode?<br><br>Is it possible to turn on/off images in a character using Monkey code, maybe setting the alpha level on the fly for each image in the rig? <br><br></td></tr></table><br>
<a name="2051706"></a>

<a name="2051707"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#63">[#63]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Do you still want my character that collapses when not in loop mode? <br></div><br>Yes please!<br><br><div class="quote"> Is it possible to turn on/off images in a character using Monkey code, maybe setting the alpha level on the fly for each image in the rig?  <br></div><br>Yeah, it should be possible... over on bb.com SlotMan did it on an old version of the importer:<br><a href="http://www.blitzbasic.com/Community/post.php?topic=99983&amp;post=1177496" target="_blank">http://www.blitzbasic.com/Community/post.php?topic=99983&amp;post=1177496</a> <br><br></td></tr></table><br>
<a name="2051710"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >rIKmAN</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#64">[#64]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ah nice - I forgot about bb.com if I'm honest - I'll give that a look tomorrow that could be really helpful.<br><br>Where do you want me to send my files? <br><br></td></tr></table><br>
<a name="2051714"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#65">[#65]</a></td></tr></table></td></tr><tr ><td class="posttext"> Have you got a drop box account or something, if not send it to my email address: therevillsgames@... <br><br></td></tr></table><br>
<a name="2051844"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >rIKmAN</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#66">[#66]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes of course, sorry it was late and my brain was frazzled!<br><br>I've got a couple of examples that are not playing nice, which I have basically added my character to your Example to rule out it being my code.<br>I've upped it to my DropBox with a little readme to explain things.<br><br>Find the download <strike>here</strike> <br><br></td></tr></table><br>
<a name="2051796"></a>

<a name="2051794"></a>

<a name="2051795"></a>

<a name="2051820"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#67">[#67]</a></td></tr></table></td></tr><tr ><td class="posttext"> Love the Goof character!<br><br>Okay, the issue with your character and the spriter importer is that you have your very last key frame at the end of the animation. For a quick fix add 100ms to the Animation length... but it is a bug in the code!<br><br>With your day/night cycle... dont know yet, I'll investigate tonight. <br><br></td></tr></table><br>
<a name="2051827"></a>

<a name="2051828"></a>

<a name="2051829"></a>

<a name="2051830"></a>

<a name="2051831"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >rIKmAN</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#68">[#68]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks mate, keep it to yourself if you would, though I wouldn't expect you to do anything with it.<br><br>Would setting the last keyframe 1ms before the end of the animation work rather than adding dead space to my animations?<br><br>I think it may be the same issue with the nigh and day scene - the last keyframe is the very end of the animation, so I guess its doing the same as with the character, I'll give it a try and see.<br><br>Is the bug with the scml or the importer module?<br><br>Oh and thanks, appreciate your time. :) <br><br></td></tr></table><br>
<a name="2051832"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#69">[#69]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> keep it to yourself if you would <br></div><br>No worries! Did you draw it yourself and the night/day background?<br><br><div class="quote"> I think it may be the same issue with the nigh and day scene <br></div><br>I thought so too, but when I altered it I still saw the slight flicker.<br><br><div class="quote"> Is the bug with the scml or the importer module? <br></div><br>The importer module... <br><br></td></tr></table><br>
<a name="2051834"></a>

<a name="2051835"></a>

<a name="2051836"></a>

<a name="2051845"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >rIKmAN</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#70">[#70]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> No worries! Did you draw it yourself and the night/day background? <br></div><br>No they are from the game I'm working on at the moment - hence the keep it to yourself - but I'm not the artist.<br><br><div class="quote"> I thought so too, but when I altered it I still saw the slight flicker. <br></div><br>Ahh OK, hopefully a simple fix then :)<br><br>EDIT: I just tested moving the keyframe 2ms from the end of the animation and it works fine, he stays on screen when the animation ends. <br><br></td></tr></table><br>
<a name="2051872"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#71">[#71]</a></td></tr></table></td></tr><tr ><td class="posttext"> Fixed the LOOPING_FALSE bug...<br><br>With the night and day issue, I know whats causing it and a workaround. <br><br>The flicker you are seeing is when your night scene finishes and you change to the day scene, but for some reason Monkey displays your night scene again which causes the flicker.<br><br>The workaround around is to call spriterObject.Update after changing the animation, so in your example move bg.Update(bgAnimName, loopType, timeElapsed) under the Select statement.<br><br>I'll have to think about how we can fix that in the importer. <br><br></td></tr></table><br>
<a name="2051904"></a>

<a name="2051905"></a>

<a name="2051906"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >rIKmAN</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#72">[#72]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ahhh that fixed both the issues - thank you! :)<br><br>I will be having a play with boned characters this weekend, so I will let you know if I find any anomalies with the flipping.<br>The current character is just images, and is now a lot more complicated (parts-wise) than that small demo so I think a skeleton is in order.<br><br>Thanks again for the quick fix! :) <br><br></td></tr></table><br>
<a name="2051952"></a>

<a name="2051953"></a>

<a name="2051954"></a>

<a name="2051955"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#73">[#73]</a></td></tr></table></td></tr><tr ><td class="posttext"> Alright, I've just pushed another changed. This one will require you to call SetAnimation and I have also removed the animationName and loopType from the Update method.<br><br>This will fix the day/night cycle so you wont need to call update after changing the animations:<br><br>Load in your scml:<br><pre class=code>
loopType = MonkeySpriter.LOOPING_FALSE

bg = SpriterImporter.ImportFile("bg", "bg_day_and_night.scml")
bg.x = 0
bg.y = 0
bg.timer.Start()
bg.SetAnimation(bgAnimName, loopType)</pre><br><br>Update and change animations:<br><pre class=code>bg.Update(timeElapsed)

If bg.currentAnimation.finished
	bgAnimName = BG_NIGHT_TO_DAY
	bg.SetAnimation(bgAnimName, loopType)
	bg.timer.Start()
EndIf</pre><br><br>Note: finished is only set if the loop type is FALSE <br><br></td></tr></table><br>
<a name="2051974"></a>

<a name="2051975"></a>

<a name="2051977"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >rIKmAN</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#74">[#74]</a></td></tr></table></td></tr><tr ><td class="posttext"> Good stuff, super speedy fix, I'll get that pulled shortly - thanks. :)<br><br>A little off-topic, but are you rolling your own collision for the Spriter images or waiting for the official implementation in the SCML? <br><br></td></tr></table><br>
<a name="2051978"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#75">[#75]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Are you rolling your own collision for the Spriter images or waiting for the official implementation?  <br></div><br><br>Haven't even thought about collisions yet... I'm more using it for animation cut-scenes.<br><br>I guess the best approach would be rectangle collisions for each image. <br><br></td></tr></table><br>
<a name="2052472"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >rIKmAN</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#76">[#76]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi mate,<br><br>I sent an email to you about this, but in case you don't get it...<br><br>What is the deal with multiple .scml files for one character (ie. head/body) and scaling?<br><br>I can place them fine and offset the head for movement etc, but when I scale they explode away from each other due to the differing pivot points, and I'm wondering if there is some way to easily deal with this? <br><br></td></tr></table><br>
<a name="2052499"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#77">[#77]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey Rik,<br><br>Yes, I got your email I been trying to think a solution for you... but havent come up with anything.<br><br>Maybe post on the Spriter forum and see if anyone on there has any answers. <br><br></td></tr></table><br>
<a name="2052528"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >rIKmAN</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#78">[#78]</a></td></tr></table></td></tr><tr ><td class="posttext"> Will do mate, I just thought it may be something that could be handled in the importer - I will let you know if I find out an answer. <br><br></td></tr></table><br>
<a name="2052527"></a>

<a name="2052532"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#79">[#79]</a></td></tr></table></td></tr><tr ><td class="posttext"> It more a parent child relationship issue, the importer has done it's job now its the actual game's job to control the imported sprites.<br><br>Not sure if this would work, but a cheating way you could do is, in Spriter set you head position to be in the correct position where it would be on the body... <br><br></td></tr></table><br>
<a name="2052537"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >rIKmAN</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#80">[#80]</a></td></tr></table></td></tr><tr ><td class="posttext"> That works, so simple I didn't think of it - doh! :) <br><br></td></tr></table><br>
<a name="2053048"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Soap</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#81">[#81]</a></td></tr></table></td></tr><tr ><td class="posttext"> New update: <a href="http://www.kickstarter.com/projects/539087245/spriter/posts/436499" target="_blank">http://www.kickstarter.com/projects/539087245/spriter/posts/436499</a> <br><br></td></tr></table><br>
<a name="2053053"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >rIKmAN</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#82">[#82]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yep been testing this for a week or so, it's a big improvement over the old version but lacks some important features right now to be used in a proper project.<br><br>As soon as the copy/paste is in I think I'll use it instead of the alpha full time. <br><br></td></tr></table><br>
<a name="2053356"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#83">[#83]</a></td></tr></table></td></tr><tr ><td class="posttext"> I actually prefer the A4 GUI... why do they keep changing it!? <br><br></td></tr></table><br>
<a name="2055313"></a>

<a name="2055315"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Playniax</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#84">[#84]</a></td></tr></table></td></tr><tr ><td class="posttext"> I am playing around with this again and I would like to add some kind of collision handling.<br><br>What is the best way to get a certain part of the sprite. For example the sword relative x and coordinates, width and height so can make some collision stuff?<br><br>Also the complete width and height of a sprite would be great :)<br><br>Or I should hack something together myself...<br><br>I have made this little demo with Ignition:<br><br><a href="http://www.playniax.com/share/demos/spriter/MonkeyGame.html" target="_blank">http://www.playniax.com/share/demos/spriter/MonkeyGame.html</a> <br><br></td></tr></table><br>
<a name="2055356"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#85">[#85]</a></td></tr></table></td></tr><tr ><td class="posttext"> lol - you like to spam the forums dont ya ;)<br><br><a href="http://www.monkeycoder.co.nz/Community/posts.php?topic=5040#55355" target="_blank">http://www.monkeycoder.co.nz/Community/posts.php?topic=5040#55355</a> <br><br></td></tr></table><br>
<a name="2055358"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#86">[#86]</a></td></tr></table></td></tr><tr ><td class="posttext"> How stable would you considere Spriter on Monkey? I'm about to start a very big project next week and I would like to suggest Monkey for it, but I would love to have some feedback about Spriter and Monkey and how much do they love each other. All samples look like that's what I want to do, but if there's anything missing on the Monkey module I should know beforehand, It would be great to be aware of it. <br><br></td></tr></table><br>
<a name="2055366"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#87">[#87]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Monkey module I should know beforehand, It would be great to be aware of it <br></div><br>I've pretty much stressed tested it in HTML5 and GLFW and its pretty stable.<br><br>The only thing I can think of is that it might have issues on Android, due to the lists I am using, so there is work we could do to optimise the code - maybe use arrays/arraylist instead. <br><br></td></tr></table><br>
<a name="2055368"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#88">[#88]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks! if it's only optimization looks great <br><br></td></tr></table><br>
<a name="2055370"></a>

<a name="2055371"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >rIKmAN</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#89">[#89]</a></td></tr></table></td></tr><tr ><td class="posttext"> Spriter itself is still in dev, so a lot of features are still "coming soon" and "planned" as it has been heavily delayed.<br><br>It's far from perfect and there are still some bugs and features missing, but in the last month the new version has come on loads and is finally heading towards adding all the features promised.<br><br>The spriterImporter supports all the features available at the moment, and hopefully as Spriter itself adds more features then therevills will kindly keep his importer up to date - I hope so anyway :)<br><br>I'm using the existing software and importer in my project and it's fine for that at the moment, though I don't use bones so not sure if there are any issues there.<br><br>EDIT: I can confirm it works fine on iOS as well. <br><br></td></tr></table><br>
<a name="2055369"></a>

<a name="2055391"></a>

<a name="2055392"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Playniax</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#90">[#90]</a></td></tr></table></td></tr><tr ><td class="posttext"> @therevills: yeah, I was wondering about the lists. Not sure performance wise this would work with a lot of sprites. Also I noticed the New command in the Draw method if I remember correctly. Isn't that going to be a problem for the GC because it looks like it's called everytime? Not sure though.<br><br>And for collision, If I could get the objects width/height and relative pos it should not be so hard to add collision methods. <br><br></td></tr></table><br>
<a name="2055589"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#91">[#91]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Also I noticed the New command in the Draw method if I remember correctly. Isn't that going to be a problem for the GC because it looks like it's called everytime? <br></div><br>Yeah it could be an issue, as I said the code could be optimised quite a bit - I normally try to get things working and then optimise as needed. <br><br></td></tr></table><br>
<a name="2063117"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >rIKmAN</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#92">[#92]</a></td></tr></table></td></tr><tr ><td class="posttext"> Not sure how many (if any) people are keeping up to date with Spriter and this importer module, but it has been updated a fair bit to B4 now.<br><br>This version includes "Character Maps" which is allowing images to be swapped in and use the same animation data (Pro Feature Only) for things like weapons, clothing, armour, shields etc.<br><br><iframe width="560" height="345" src="http://www.youtube.com/embed/NufHCAHrEdw" frameborder="0" allowfullscreen></iframe><br><br>As well as an update/release of the <a href="http://www.brashmonkeygames.com/spriter/ScmlDocs/ScmlReference.html" target="_blank">Developer Docs.</a><br><br>Any plans to update the importer to support the new stuff therevills? <br><br></td></tr></table><br>
<a name="2063116"></a>

<a name="2063115"></a>

<a name="2063114"></a>

<a name="2063113"></a>

<a name="2063112"></a>

<a name="2063156"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#93">[#93]</a></td></tr></table></td></tr><tr ><td class="posttext"> So the character maps let you to use the same animations but just swap in the images... that's cool (as long as all the images are the same size I guess).<br><br>Is the idea also that you can change the images at runtime?<br><br>I do/did plan on adding all the features of Spriter, but I am so busy at the moment, so don't expect it soon...<br><br>I am happy to open up the repo to anyone who is interested in helping, just let me know. :) <br><br></td></tr></table><br>
<a name="2063155"></a>

<a name="2063450"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dwapook</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#94">[#94]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey.. I'm using the ignition framework implementation of the importer and I've run into a problem with pivots.. <br><br>I've been setting the pivot point before laying the image on the canvas in spriter.. <a href="http://www.brashmonkey.com/spriter_manual/default%20pivot%20points.htm" target="_blank"> (like this states) </a><br><br>But doing that seems to cause the pivot points to be ignored when run through the monkey importer.. Kind of curious if that's ignition specific or the original source of the module has the same problem?  I'm having a bit of trouble trying to figure out how the download the latest version.. <br><br></td></tr></table><br>
<a name="2063457"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Playniax</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#95">[#95]</a></td></tr></table></td></tr><tr ><td class="posttext"> Can you test this with the non Ignition code?<br><br>We do not support this code officially but I see what I can do. Just test it first with the non Ignition code. <br><br></td></tr></table><br>
<a name="2063500"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >rIKmAN</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#96">[#96]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the reply therevills.<br><br>Without being pushy at all, would you have a rough estimate of timescale before you have chance to look at the code again?  Weeks / months?<br><br>@Dwapook<br>I use the non-Playniax code and have not noticed any abnormalities with regards to pivot points - I'm using the Pro version of Spriter B4, are you?<br><br>What is the problem exactly...incorrect animations when played back due to the pivots being wrong? <br><br></td></tr></table><br>
<a name="2063499"></a>

<a name="2063519"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dwapook</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#97">[#97]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Playniax<br>Eh.. I tested it with the non ignition code and getting the same issues, maybe I'm doing something wrong<br><br>@ rIKmAN<br>Yeah, I'm using Spriter B4 Pro also.. as for specifics..<br><br><b>I set the pivot x and pivot y in the file palette, these values were 0 in the spriter examples I downloaded.. </b><br><br><img src="http://i278.photobucket.com/albums/kk115/Dwapook/error2.png"><br><br>___________________________________________________________________________<br><br><b>When I test it out, it looks like the pivot points are considered to be set as 0,0 and all the images are displaced...</b><br><br><img src="http://i278.photobucket.com/albums/kk115/Dwapook/error1.png"><br><br>___________________________________________________________________________<br><br><img src="http://i278.photobucket.com/albums/kk115/Dwapook/0bcbeb00-1259-4233-9241-599566d2a1c4.jpg"><br><br><b> This happens when I turn the tween off.. <br>One last issue, if I set animation to ping pong, the images warps back and forth on the screen, appearing in the left as a crumpled ball, and unchanged in the right..</b> <br><br></td></tr></table><br>
<a name="2063541"></a>

<a name="2063542"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#98">[#98]</a></td></tr></table></td></tr><tr ><td class="posttext"> @rIKmAN<br><br>Its going to be months... its currently good enough for my newest game and I dont want to spend anymore time on this until my game is out. (Apart from bug fixes).<br><br>@Dwapook<br><br>Firstly dont worry about what happens when you turn off tweening, you are using bones - bones require tweening.<br><br>Any chance can you share your animation? <br><br></td></tr></table><br>
<a name="2063543"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dwapook</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#99">[#99]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="https://docs.google.com/file/d/0B23VwTc0S49gTllWOHRjdjRqeUk/edit?usp=sharing" target="_blank">https://docs.google.com/file/d/0B23VwTc0S49gTllWOHRjdjRqeUk/edit?usp=sharing</a><br><br>Eh.. fairly incomplete as we weren't planning to do much with it until this issue gets sorted out.. danke! <br><br></td></tr></table><br>
<a name="2063554"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#100">[#100]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Dwapook, looking thru your SCML file there are quite a few new elements which unless I am blind I can not find how to use them.<br><br>For example "File" now has pivotX and pivotY which I guess is the default pivot points, also "Object_Ref" has "abs_" elements (pivot, x, y, angle, scales, alpha) yet I cant find any documentation on what to do with these... <br><br></td></tr></table><br>
<a name="2063635"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dwapook</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#101">[#101]</a></td></tr></table></td></tr><tr ><td class="posttext"> Aye, well thanks for looking into it at least! Tried messing with it for a while myself and only managed to get it looking somewhat better.. Still trying to get familiar with monkey and I'm not a very strong coder to begin with.. <br><br></td></tr></table><br>
<a name="2063655"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#102">[#102]</a></td></tr></table></td></tr><tr ><td class="posttext"> For the time being could you not use the default pivot points for your project? <br><br></td></tr></table><br>
<a name="2063748"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dwapook</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#103">[#103]</a></td></tr></table></td></tr><tr ><td class="posttext"> Eh, what I used was the default, I thought? I think I get what you mean though! Will try just altering the pivots after the images have been laid on the canvas for now and hope nothing else comes up, thanks again for your time! <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
