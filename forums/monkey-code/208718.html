<!DOCTYPE html><html lang="en" ><head ><title >Reading all the buttons from a joystick</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Reading all the buttons from a joystick</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=512" >Monkey Code</a>/<a href="#bottom" >Reading all the buttons from a joystick</a><br><br>
<a name="2090784"></a>

<a name="2090785"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >mr_twister</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't know if this has been posted before but it's been quite the useful discovery for me.<br><br>Monkey actually reads (a max of) 32 buttons per joystick but only maps a handful of them to the constants we all know (JOY_A, JOY_B, JOY_X, JOY_MENU, JOY_BACK, etc)...<br><br>The rest of the buttons are still part of the internal array of states that monkey allocates and keeps track of, so if you can figure out the "key code" assigned to them you can actually read their state.<br>Luckily, that's awfully simple since joystick entries are consecutive groups (1 group per joystick) of 32 entries (1 entry per button) starting at KEY_JOY0, which means that you can query their "hit" and "down" with nothing more than this:<br><br><pre class=code>
Function RawJoyButtonDown: Int(joyNum: Int, bttnNum: Int)
	If joyNum &lt; 0 Or joyNum &gt; 3 Or bttnNum &lt; 0 Or bttnNum &gt; 31 Then Return 0
	Return KeyDown(KEY_JOY0 + joyNum*32 + bttnNum)
End

Function RawJoyButtonHit: Int(joyNum: Int, bttnNum: Int)
	If joyNum &lt; 0 Or joyNum &gt; 3 Or bttnNum &lt; 0 Or bttnNum &gt; 31 Then Return 0
	Return KeyHit(KEY_JOY0 + joyNum*32 + bttnNum)
End
</pre><br>I'm currently using this to improve the gamepad support in my game and it's been working perfectly so far. I truly hope someone else can benefit from this code too. <br><br></td></tr></table><br>
<a name="2090813"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nobuyuki</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I do this with system charcodes to get foreign keyboard keys in my bind system.  Works pretty well. <br><br></td></tr></table><br>
<a name="2093556"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sensei</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi there. Where would one place this and use the code example above? <br><br></td></tr></table><br>
<a name="2093558"></a>

<a name="2093559"></a>

<a name="2093560"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >mr_twister</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just add those two functions to your code (outside of any class declaration if you want them to be global).<br>You can then use them instead of (or together with) JoyHit() or JoyDown() to read joystick buttons. <br><br></td></tr></table><br>
<a name="2093563"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sensei</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks mr_twister. I did as you suggested and added the following snippet to the joytest.monkey and I found it displaying the same results as the regular JoyDown() commands.<br><br><pre class=code>
For Local button := 0 Until 32
    DrawText "Button:       " +RawJoyButtonDown(port, button), 200, 10 + (button * 10)
Next
</pre><br><br>Unfortunately I only have a xbox360 controller attached so can't test more buttons than are usable in Monkey :) <br><br></td></tr></table><br>
<a name="2093684"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >mr_twister</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well yes! it's doing the same as the regular KeyDown/KeyHit but it gives you access to ALL the buttons that Monkey keeps track of, (32) instead of the first few that are available on the XBOX 360 controller and exposed through JOY_A, JOY_B, etc!<br>I don't have an xbox controller but PERHAPS with this code you can read the "analog stick" buttons"? (pressing the analog sticks down, also known as L3/R3 is PS2/3 gamepads) <br><br></td></tr></table><br>
<a name="2093685"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sensei</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the update mate. The standard hits are already able to get to all buttons, pads and analog sticks on both 360 and ps3 controllers (I have both).<br>I suppose your code will be useful when using more advanced controllers like flight sticks or steering wheels etc. <br><br></td></tr></table><br>
<a name="2093686"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >mr_twister</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh you are right, the stick buttons are JOY_LSB and JOY_RSB, respectively.<br><br>This code is not only for massive/advanced controllers though, It's more for non-PS3/360 controllers! I have a Genius "PS3-compatible" joystick, and a few buttons (like R3) are not recognized by Monkey as any of the internal constants but can be read with my code. Although I guess that most gamers use either a PS3 or 360 controller these days... <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
