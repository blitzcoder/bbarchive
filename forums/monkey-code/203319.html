<!DOCTYPE html><html lang="en" ><head ><title >New File System (real files, Large files faster)</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >New File System (real files, Large files faster)</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=512" >Monkey Code</a>/<a href="#bottom" >New File System (real files, Large files faster)</a><br><br>
<a name="2035016"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Cygnus</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> This allows you to write to files in the actual filesystem (GLFW only)<br>It also reads files like you were used to in BlitzMax. (all platforms)<br><br>file size is not limited to the ~300k limit that seemed to be imposed by previous options.<br><br>This is based off GfKs FileSystem but uses real files, rather than a virtual file system. As such, saving files in HTML5 is not possible.<br>Reading files in HTML5 is possible.<br><br>Code to write to output folders is based on GreyAlien's work.<br><br>THINGS TO NOTE:<br><br>It will write files to the executables .data folder.<br><br>It also saves the same data to the current project folder by default. Disable this if you are using it in a release.<br><br>set APP_NAME to the name of the folder your files are in. (for me it was basicgame.data, hence basicgame)<br><br>Thanks to GfK and GreyAlien!<br><br>[monkeycode]<br>Strict<br>Import mojo<br>Import os<br>Const APP_NAME:String="basicgame"<br>Const COPY_TO_PROJECT_DATA_FOLDER:Bool=True<br><br>Class FileStream Extends DataConversion<br>	Field filename:String<br>	Field fileptr:Int<br>Private<br>	Field arrayPointer:int<br>	Field data:String<br>	Field WriteData:String<br>	Field readingOnly:bool<br>Public<br>	<br>	<br>	<br>	Function WriteFile:FileStream(filename:String)<br>		Local f:FileStream = New FileStream<br>		f.filename = filename<br>		f.fileptr = 0<br>		f.arrayPointer=0<br>		f.data=""<br>		f.readingOnly=False<br>		Return f	<br>	End<br>	<br>	Function ReadFile:FileStream(filename:String)<br>		Local f:FileStream = New FileStream<br>		f.filename = filename<br>		f.fileptr = 0<br>		Print "Reading from "+filename<br>		f.data = app.LoadString(filename) 'LoadState()<br>		f.readingOnly=True<br>		Return f<br>	End<br>	<br>	Method Close:Void()<br>		If (readingOnly=False) Then<br>			FlushData()<br>			Print "Writing "+Self.WriteData.Length()+" bytes."<br>		#If TARGET="glfw" Then<br>		<br>			SaveString(Self.WriteData,CurrentDir()+"/data/"+filename) 'local to build - Runtime folder.<br>			If (COPY_TO_PROJECT_DATA_FOLDER) Then<br>				Print "Writing "+CurrentDir()+"/../../../../"+APP_NAME+".data/"+filename<br>				SaveString(Self.WriteData,CurrentDir()+"/../../../../"+APP_NAME+".data/"+filename) 'project data path<br>			Endif<br>		#End<br>			Self.data=""<br>			Self.WriteData=""<br>		Endif<br>	End<br>		<br>	<br>	<br>	Method ReadInt:Int()<br>		Local result:String<br>		result = Self.data[Self.fileptr..Self.fileptr+4]<br>		Self.fileptr+=4<br>		Return Self.StringToInt(result)<br>	End<br>	<br>	Method WriteInt:Void(val:Int)<br>'		Print(val+" Outputted.")<br>		Self.fileptr+=4<br>		Self.data+=Self.IntToString(val)<br>	End<br>	<br>	Method ReadString:String()<br>		Local result:String<br>		Local strLen:Int = Self.StringToInt(Self.data[Self.fileptr..Self.fileptr+4])<br>		Self.fileptr+=4<br>		If strLen &gt; 0<br>			result = Self.data[Self.fileptr..Self.fileptr+strLen]<br>			Self.fileptr+=strLen<br>		End<br>		Return result<br>	End<br>	<br>	Method WriteString:Void(val:String)<br>		Self.data+=Self.IntToString(val.Length())<br>		If val.Length() &gt; 0<br>			Self.data+=val<br>			Self.fileptr+=val.Length()<br>		End<br>		CheckDataLength()<br>	End<br>	<br>	Method ReadFloat:Float()<br>		Local result:Float<br>		Local s:String<br>		Local strLen:Int = Self.StringToInt(Self.data[Self.fileptr..Self.fileptr+4])<br>		Self.fileptr+=4<br>		s = Self.data[Self.fileptr..Self.fileptr+strLen]<br>		result = Self.StringToFloat(s)<br>		Self.fileptr+=strLen<br>		Return result<br>	End<br>	<br>	Method WriteFloat:Void(val:Float)<br>		Local s:String = Self.FloatToString(val)<br>		Self.data+=Self.IntToString(s.Length())<br>		Self.data+=s<br>		CheckDataLength()<br><br>	End<br>	<br>	Method ReadBool:Bool()<br>		Local result:Bool<br>		result = Bool(Self.data[Self.fileptr])<br>		Self.fileptr+=1<br>		Return result<br>	End Method<br>	<br>	Method WriteBool:Void(val:Bool)<br>		Self.data+=String.FromChar(val)<br>		CheckDataLength()<br><br>	End Method	<br>	<br>	<br>	Method ReadByte:Int()<br>		Local result:Int= Int(Self.data[Self.fileptr])<br>		Self.fileptr+=1<br>		Return (result)<br>	End<br>	<br>	Method WriteByte:Void(val:Int)<br>		Self.fileptr+=1<br>		Self.data+=String.FromChar(val &amp; $ff)'Self.ByteToString(val)<br>		CheckDataLength()<br>	End<br>	Method CheckDataLength:void()<br>		If (Self.data.Length()&gt;65536) Then '64k round-up<br>			Print "Flushed."<br>			FlushData()<br>		Endif<br>	End Method<br>	Method FlushData:void()<br>		Self.WriteData=Self.WriteData+Self.data<br>		Self.data=""<br>	End method<br>End<br><br>Class DataConversion<br>	Method IntToString:String(val:Int)<br>		Local result:String= String.FromChar((val) &amp; $FF)<br>		result+= String.FromChar((val Shr 8) &amp; $FF)<br>		result+= String.FromChar((val Shr 16) &amp; $FF)<br>		result+= String.FromChar((val Shr 24) &amp; $FF)<br>		Return result<br>	End<br><br>	Method FloatToString:String(val:Float)<br>		Return String(val)<br>	End		<br>	<br>	Method StringToInt:Int(val:String)<br>		Local result:Int<br>		result = (val[0])<br>		result|= (val[1] Shl 8)<br>		result|= (val[2] Shl 16)<br>		result|= (val[3] Shl 24)<br>		Return result<br>	End<br>	<br>	Method StringToFloat:Float(val:String)<br>		Return Float(val)<br>	End		<br>End<br>[/monkeycode]<br><br>example of use:<br><br>[monkeycode]<br>	  		Local stream:FileStream=FileStream.WriteFile("Temp.dat")<br>	  		stream.WriteByte(65)<br>	  		stream.WriteByte(66)<br>	  		stream.WriteByte(67)<br>	  		stream.WriteByte(68)<br>	  		stream.WriteByte(69)<br>	  		stream.WriteByte(70)<br>	  		stream.Close()<br>	  		<br>	  		stream=FileStream.ReadFile("Temp.dat")<br>	  		Print stream.ReadByte()<br>	  		Print stream.ReadByte()<br>	  		Print stream.ReadByte()<br>	  		Print stream.ReadByte()<br>	  		Print stream.ReadByte()<br>	  		Print stream.ReadByte()<br>	  		stream.Close()<br>[/monkeycode] <br><br></td></tr></table><br>
<a name="2034838"></a>

<a name="2034837"></a>

<a name="2034805"></a>

<a name="2034803"></a>

<a name="2034801"></a>

<a name="2034799"></a>

<a name="2034774"></a>

<a name="2034773"></a>

<a name="2034833"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paul - Taiphoz</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> use [ monkeycode ] for your code box's will make it look better. <br><br></td></tr></table><br>
<a name="2035124"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nobuyuki</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> nice, dude.  Can we use something like this for direct saving/loading of tilemap data?  (With the proper file filter directive, of course) <br><br></td></tr></table><br>
<a name="2035196"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Cygnus</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes you can, but be careful if you release to HTML5- Some browsers struggle to load data files. I'm going to add Base64 (or for speed, base52) encoding to the library shortly to allow for easy HTML5 deployment. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
