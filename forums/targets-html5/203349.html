<!DOCTYPE html><html lang="en" ><head ><title >Binary data problem with Firefox</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Binary data problem with Firefox</h1><a href="forums.php" >Monkey Targets Forums</a>/<a href="topics.php?forum=504" >HTML5</a>/<a href="#bottom" >Binary data problem with Firefox</a><br><br>
<a name="2035063"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Cygnus</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi All,<br><br>Link to app with problem:<br><br><a href="http://www.sturdygames.co.uk/GravityEd/" target="_blank">http://www.sturdygames.co.uk/GravityEd/</a><br><br>note it works under Chrome, but under Firefoxx, LoadString() fails.<br><br>The xmlhttprequest succeeds- the data is shown in debug tools in Firefox, which is weird, so I suspect Mime type to be an issue. That said, I've tweaked the code as much as possible and haven't been able to trick it into working. I notice the following in Firefox regardless of my attempts:<br><br>"The character encoding of the HTML document was not declared. The document will render with garbled text in some browser configurations if the document contains characters from outside the US-ASCII range. The character encoding of the page must to be declared in the document or in the transfer protocol."<br><br>Sadly no matter what I do to the source, I cannot get the game running in Firefox.<br><br>I have tried using overrideMimeType with no luck.<br><br>Anyone have any suggestions?<br><br>[edit]<br><br>How likely is it that I am going to have to Base64 this stuff? (because that is going to slow things down a lot!) <br><br></td></tr></table><br>
<a name="2035061"></a>

<a name="2035078"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Your server is giving the .dat file the MIME type: "application/x-ns-proxy-autoconfig" which appears to be expected to be single byte encoded text. Your dat file appears to present as UTF16-LE (although the data seems to be nearly all 1-byte chars so half of the file is empty space).<br><br>You could just try changing the extension to ".txt" or similar if you don't want to mess around with the server. <br><br></td></tr></table><br>
<a name="2035088"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Cygnus</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks, but sadly I tried that. Firefox seems to override it (forcing a mimetype seems to do bugger all too!) - although thinking about it, it runs in Firefox locally, so this pretty much has to be my server, right?<br><br>The file is indeed all single byte chars, 0-255, each representing a byte-encoded piece of level data. <br><br><br>What would I need to do to the server? I'm pretty confident going in and fiddling (It's a VPS) <br><br></td></tr></table><br>
<a name="2035092"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> The file isn't single byte chars though. Just look at it in an appropriate editor. It's a UTF-16 little endian encoded text file. I would have thought .txt would work fine and be sent as text/plain. Maybe try .bin or .exe and see if it comes through as application/octet-stream untouched? <br><br>As for messing with the server, it depends on what the server is. Apache allows types to be associated with file extensions in .htaccess files. It's not really my area of expertise. <br><br></td></tr></table><br>
<a name="2035110"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Cygnus</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> ...*click* Hmmm, that would explain why the dat file is actually 2x the size I'd expect for the amount of data, You might have pointed me in the right direction here, cheers.<br><br>Strange though, how it works in eveerything except Firefox. :-)<br><br>Cheers, I have some ideas now. <br><br></td></tr></table><br>
<a name="2035115"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Cygnus</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yup, the actual file's encoding was the problem.<br><br>So I stopped monkey from encoding it into unicode by storing only values from 0 to 253.<br><br>However, these files do not load back in the same at all, as if the unicode detection on load does not match the unicode detection on save.<br><br>Any ideas on this one?<br><br>Starting to suspect I should actually just do a "base-128" on the output. <br><br></td></tr></table><br>
<a name="2035121"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Cygnus</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> AAAND one more update:<br><br>I gave up trying to work around storing certain values and just Base64 encoded the bugger, this worked, and since my original levels were double-sized anyway, this didn't actually cause any perceived increase in file size. :-) <br><br></td></tr></table><br>
<a name="2035489"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matthius</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm currently having some trouble with LoadString() trying to load up my txt file, though with mine it's working in Firefox but not working in Chrome.<br>It's throwing up an error<br>NETWORK_ERR: XMLHttpRequest Exception 101<br>mojo/app.monkey lines 53 and 137<br>and also the line in my code with LoadString.<br>I've tried running a bit of code to just load the text file and nothing else and it still doesn't work even for just loading a little text file with just 1 entered in it.<br><br>Import mojo<br>Function Main()<br>Print LoadString("Map_1.txt")<br>End<br><br>Would my problem be due to encoding as well and if so how would I go about fixing it. Note that I'm not using Monkey to save the file, I'm saving it from BlitzMax if that makes any difference. <br><br></td></tr></table><br>
<a name="2035563"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Cygnus</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Actually, it's because LoadString fails in Chrome due to (silly, IMO) security concerns. Try it in Firefox, or upload it to a server.<br><br>Basically it thinks that the file it's loading fron is on a different server and Chrome doesn't allow that. If it's on a server then the problem is gone.<br><br>It's a bit annoying, I know, but that's how it is. :-( <br><br></td></tr></table><br>
<a name="2035564"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Cygnus</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Also something to note, Monkey tries to automatically detect what encoding the file is using. If you've written out a binary format string from Bmax, you will find Monkey struggles with it. I could not find a way around this problem without hacking the LoadString function.<br><br>That said, if you Base-64 encode the file, monkey will load it as UTF8, where you will be able to use ReadByte and a Base-64 decoder to correctly get your data from it. You will want to do this if you release to HTML5 anyway due to similar problems transmitting over the net.<br><br>Personally I used Base-52 for my data. It might sound like a fair bit of work but this was relatively quick and easy even for me and I've only had monkey a short while.<br><br>Let me know how you get on. I'll try to get round to updating this lib to work fully with my Base-52 encoder. I'll also provide a file converter written with Bmax so you don't have to do any fiddling yourself. :-) It'll be a while though as I am very stretched for time. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
