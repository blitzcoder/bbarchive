<!DOCTYPE html><html lang="en" ><head ><title >No audio at all on iOS browsers (audio_test used!)</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >No audio at all on iOS browsers (audio_test used!)</h1><a href="forums.php" >Monkey Targets Forums</a>/<a href="topics.php?forum=504" >HTML5</a>/<a href="#bottom" >No audio at all on iOS browsers (audio_test used!)</a><br><br>
<a name="2119290"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >rIKmAN</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> As per title, after a few hours testing with various audio formats thinking it was that, I decided to try the "audio_test" demo, and found that it also does not play ANY sound at all when viewed through any browser on my iPad.<br><br>I tested .ogg, .m4a, .mp3 and not even .wav is working in the audio_test demo in the "mak" folder, and I tested using the iOS versions of Safari, Firefox and Opera all with the same result: no sound at all.<br><br>I tested using the latest Monkeyv86e and the HTML5 target.<br>I also tried setting #HTML5_WEBAUDIO_ENABLED to true/false with no change.<br><br>The "audio_test" demo (and my game) play sounds perfectly when using desktop browsers, and I'm not sure if this happens on Android browsers as I have no Android device to test with.<br><br><a href="https://dl.dropboxusercontent.com/u/26955697/musicfmt3/MonkeyGame.html" target="_blank">I've hosted it here to make it easy for people to check</a><br>As I said it works fine on desktop browsers, but not on my iPad so please check on your iOS device.<br><br>Could anyone else please test this and confirm?<br>Has anyone else had the same problem?<br>Is it a known bug?  Is there a simple fix?<br><br>Hopefully Mark sees this.<br><br>Thanks. <br><br></td></tr></table><br>
<a name="2119287"></a>

<a name="2119263"></a>

<a name="2119264"></a>

<a name="2119262"></a>

<a name="2119265"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Pharmhaus</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well I sadly have no ipad to test for you but have you seen <a href="http://www.monkey-x.com/Community/posts.php?topic=2716" target="_blank">*this*</a>?<br>If i remember correctly the problem was that apples devices will only play something when a user presses a button or does some kind of other action to the site but the site cannot play sounds on its own. Not sure about other browsers though. <br><br></td></tr></table><br>
<a name="2119266"></a>

<a name="2119267"></a>

<a name="2119268"></a>

<a name="2119269"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >rIKmAN</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for those links Pharmhaus, I'd seen the official Apple page when Googling but not the Monkey thread.<br><br>That is some really bad news - Apple even seem to have blocked the workarounds people were using!<br>Most of the workarounds mentioned are a few years old, and the Monkey thread you linked is also 4yrs old - are there any more recent workarounds anyone knows of and would be willing to share?<br><br>Once initiated on a touch event, I wonder if the "looping" flags still work? (ie. bg music)<br>Will have to test later on I guess.<br><br>Apple suck, this is purely to force people to use the App Store and pay for a dev licence etc.<br><br>Thanks again Pharmhaus, especially for the quick reply - much appreciated! <br><br></td></tr></table><br>
<a name="2119275"></a>

<a name="2119276"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >rIKmAN</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> the problem was that apples devices will only play something when a user presses a button or does some kind of other action to the site <br></div><br><br>Just come back to this, and realised that in the audio_test example, you have to press/touch the screen to play each sound - so in theory it should work?<br><br>It doesn't though. <br><br></td></tr></table><br>
<a name="2119283"></a>

<a name="2119284"></a>

<a name="2119285"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Pharmhaus</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well it has to be attached to an javascript element such as a button if i remember correctly.<br>In monkey you have the canvas which draws your content but there is no event attached to a button drawn on a canvas if you know what i mean, monkey handles these things internally. Don't know who on hell would come up with a limitation like this?<br><br>EDIT:<br>Its written on the lower part of <a href="https://developer.apple.com/library/safari/documentation/AudioVideo/Conceptual/Using_HTML5_Audio_Video/PlayingandSynthesizingSounds/PlayingandSynthesizingSounds.html#//apple_ref/doc/uid/TP40009523-CH6-SW1" target="_blank">*this page*</a><br><div class="quote"> <br>Note: On iOS, the Web Audio API requires sounds to be triggered from an explicit user action, such as a tap. Calling noteOn() from an onload event will not play sound.<br> <br></div> <br><br></td></tr></table><br>
<a name="2119277"></a>

<a name="2119278"></a>

<a name="2119279"></a>

<a name="2119281"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Pharmhaus</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thinking about a workaround, the only thing i could think of would be creating javascript elements like button/textbox hiding (Z-Layering) them using some dirty hack so that they appear below the canvas and then wiring up some events triggering sounds. Not sure if it would work though but maybe worth a try if you have to deliver as html. What kind of html app are we talking about by the way? <br><br></td></tr></table><br>
<a name="2119280"></a>

<a name="2119501"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Leginus</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> We used the howler.js library for sound, which is excellent and free, but the get around they use for the  ios issue is the following..<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">  /**
     * iOS will only allow audio to be played after a user interaction.
     * Attempt to automatically unlock audio on the first user interaction.
     * Concept from: <a href="http://paulbakaus.com/tutorials/html5/web-audio-on-ios/" target="_blank">http://paulbakaus.com/tutorials/html5/web-audio-on-ios/</a>
     * @return {Howler}
     */
    _enableiOSAudio: function() {
      var self = this;

      // only run this on iOS if audio isn't already eanbled
      if (ctx &amp;&amp; (self._iOSEnabled || !/iPhone|iPad|iPod/i.test(navigator.userAgent))) {
        return;
      }

      self._iOSEnabled = false;

      // call this method on touch start to create and play a buffer,
      // then check if the audio actually played to determine if
      // audio has now been unlocked on iOS
      var unlock = function() {
        // create an empty buffer
        var buffer = ctx.createBuffer(1, 1, 22050);
        var source = ctx.createBufferSource();
        source.buffer = buffer;
        source.connect(ctx.destination);

        // play the empty buffer
        if (typeof source.start === 'undefined') {
          source.noteOn(0);
        } else {
          source.start(0);
        }

        // setup a timeout to check that we are unlocked on the next event loop
        setTimeout(function() {
          if ((source.playbackState === source.PLAYING_STATE || source.playbackState === source.FINISHED_STATE)) {
            // update the unlocked state and prevent this check from happening again
            self._iOSEnabled = true;
            self.iOSAutoEnable = false;

            // remove the touch start listener
            window.removeEventListener('touchstart', unlock, false);
          }
        }, 0);
      };

      // setup a touch start listener to attempt an unlock in
      window.addEventListener('touchstart', unlock, false);

      return self;
    }
  }; </textarea> <br><br></td></tr></table><br>
<a name="2119542"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >rIKmAN</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry for the late reply to this.<br><br>@Pharmaus:<br>I've not tested it yet but I've spoken to the author of Mungo and he has confirmed that this won't be an issue when using it, all sounds will play normally after the first user input/action so I will be testing that in the next week or so and if all is well I'll be using that going forward.<br><br>I used his HTML5 Web-GL target anyway, but didn't realise it was still being updated as Mungo which is great news and is compatible with existing Monkey code - even better! :)<br><br>@Leginus:<br>Thanks for that code snippet, very helpful!<br>I assume this is similar to what Mungo is doing to achieve the same result, but more methods to fix a problem is never a bad thing. :) <br><br></td></tr></table><br>
<a name="2123661"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >maverick69</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've also stumbled upon that issue and here is very simple workaround that should work.<br><br>Edit the MonkeyGame.html, after the line<br><br><pre class=code>
window.onload=function( e ){

	var canvas=document.getElementById( "GameCanvas" );
</pre><br><br>attach the remaing code to a click event listener, like:<br><br><pre class=code>
	canvas.addEventListener("click", function() {

		var splitter=document.getElementById( "Splitter" );
		var console=document.getElementById( "GameConsole" );
                ...
       });
</pre><br><br>Now you have to click into the canvas to start, but at least the sound stuff is working. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
