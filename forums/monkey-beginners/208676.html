<!DOCTYPE html><html lang="en" ><head ><title >simple networking game tutorial ? takers</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >simple networking game tutorial ? takers</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=528" >Monkey Beginners</a>/<a href="#bottom" >simple networking game tutorial ? takers</a><br><br>
<a name="2090026"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >navyRod</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> First of all I would like to say thank you to all the supporters of the Forum. <br><br>As a new beginner to monkey my ability to be a provider vice a taker of <br>knowledge here is obviously limited.  I truly hope to reverse that with time. <br><br>I understand my abilities and unfortunately am no 'Einstein' or even close to it. <br>(should have used a reference to some great coder there) .  I do enjoy learning <br>new things and passing on helpful advice  that I have learned.<br><br>All product to be successful needs to have support and I have seen some awesome <br>examples in the past ( and still see some now ), but it seems to me that community support  to some extent has dwindled off in the last year or so. <br><br>   There are great examples of that support with: <br>   Learn Monkey with this friendly beginners guide by James Boyd (pdf).<br>   View the Monkey Pixels tutorial by Robbert Prins (pdf).<br>   Follow the Path of the Monkey by Patrick Strandell.<br>   Check out invaderJim's great new YouTube tutorials.<br> <br>   Also module support<br>   Diddy<br>   fantom Engine <br>   and all the others. <br><br>   And also awesome new third party product support like JungleIde and IginitionX<br><br>   I am wondering over the past year why hasn't there been new YouTube videos <br>   that have taken Jim's series  to the next level?  <br><br>   Please don't get me wrong there have been some and don't have enough time <br>   to list them all  but  I would like to encourage the community to give itself a shot <br>   in the arm and make this a thriving community.  <br><br>   I wish I had discovered monkey back a year or two ago and hopefully would have<br>   been by now more a giver than taker of knowledge.  And so I apologize for <br>   all my annoying I am sure to some beginner questions. <br><br>    I would hope to see some new tutorials that help new users take this product and run <br>    with it.   <br><br>    One thing I would like to see  is a fully explained simple networked game example <br>    that allows for multiple players to play ( say 6 or so)  .  My thoughts on this is <br>    when you have friends or family over with different devices , Android/Windows/IOS    <br>    etc.   Example <br><br>     1. Simple shooter game. <br>     2. Yatzee  or similar dice game <br>     3.  Trivia game <br>     4.  Hang Man <br>     ....   the list goes on <br><br>     Is there anyone out there that would take this on or can a community project <br>     be created ?<br><br>      Thanks <br>       Rod. <br><br></td></tr></table><br>
<a name="2090025"></a>

<a name="2090023"></a>

<a name="2090024"></a>

<a name="2090022"></a>

<a name="2090148"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >navyRod</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> What do you think Rod... ? <br><br></td></tr></table><br>
<a name="2090149"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >navyRod</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Gee I am pretty inexperienced  but give me some time will see what I can figure out <br><br></td></tr></table><br>
<a name="2090150"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >navyRod</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Rod -- will look forward to what you can come up with .. <br><br></td></tr></table><br>
<a name="2090163"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TeaBoy</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I wish I had discovered monkey back a year or two ago and hopefully would have<br>been by now more a <b>giver than taker</b> of knowledge. And so I apologize for<br>all my annoying I am sure to some beginner questions. <br></div><br><br>Keep spreading that you'll give yourself a reputation ;) <br><br></td></tr></table><br>
<a name="2090162"></a>

<a name="2090197"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >erebel55</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm confused are you talking to yourself in this thread navyRod?<br>I would also love to see a tutorial on networking :) <br><br></td></tr></table><br>
<a name="2090208"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >navyRod</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yep -- was looking to get some response  to the  post ... so generated some myself <br><br></td></tr></table><br>
<a name="2090210"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >navyRod</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay, I am going to give my self a challenge to create initially a very simple network game <br>    Well to at least some of those on here that could probably knock this out in an hour, <br>    but simple to me is a totally different ball game.  Thinking  it will take me ?  <br><br>      well that's left to be determined  :)    but I am sure you will not be seeing it tomorrow  ( next week ? month ? year ?) <br><br>Concept:<br>1.  Simple movable cannon with rotating turret along one edge of the play field <br>     ( if my playfield is a square and I still count right then I think I should be able to  have up to 4 networked  players)  <br>       ... note to self above -- that is under assumption that I only have 1 player per edge<br><br>2.   Goal:  Shoot the other moveable cannon  :) <br><br>Ok ,  -- made it through project design phase,  now moving on to  implementation   ...    more to follow..... <br><br></td></tr></table><br>
<a name="2090219"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Reaper</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sounds like an interesting discussion you got going there Rod ;)<br>My code as it stands is way too messy to postup, and its a mix of benmc`s network code<br>&amp; invader jims game mashed together ina way that seems to work ...<br><br>Been tidying it up and clearing out stuff , eventually Ill have it as a basic framework thats game with network in and Ill stick that up here<br>but Im no tutorial writer, will be interested to see what youve come up with too :) <br><br></td></tr></table><br>
<a name="2090257"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >navyRod</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Reaper and erebe55 l :) <br><br></td></tr></table><br>
<a name="2090336"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >consty</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here is an example: C:\MonkeyX77a\bananas\mak\echoserver_tcp<br>I have not tried to make any network game yet, but this tutorial says it all. <br><br></td></tr></table><br>
<a name="2090353"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >navyRod</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> const -- -- thanks <br><br>I did see these in the banana fold and the echoserver_udp I am sure is the one I want to use for network game.<br><br>I run it and all's I get is the hello world print from the create method -- do not see any of the text from the methods  making it through <br>actually getting the socket setup correctly and sending anything .  <br><br> I do see  the code files but I don't see actually any tutorial on how to use this module that goes along with it  ? <br><br></td></tr></table><br>
<a name="2090354"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >navyRod</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> @ Reaper -- thanks -- hope to see what you get out as well. <br><br>Are you setting this up for more than two players ?  <br><br>I am still trying to determine if I have more than 2 in the mix does each one need to connect to the host using a different port or do they all use the same port. <br><br></td></tr></table><br>
<a name="2090366"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Pharmhaus</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> I made you a quick mock-up of what it could look like.<br>It doesn't send/receive data but shows you how to do the connection stuff.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Strict

Import brl.asyncevent
Import brl.socket

Function Main:Int()
	Local S:= New Server
	Local C:= New Client
	Local C2:= New Client

	While True
		UpdateAsyncEvents()
	Wend
End

#rem
	
	The "Async" Method calls will work "in the background" this means your program will continue while they work
	If you call too many "Async" methods, your app is going crash, so you should usually wait for a async method to complete before starting a new one
	
#END
Class Client Implements IAsyncEventSource, IOnConnectComplete, IOnReceiveComplete

	Field Sock:Socket = New Socket()
	Field Data:DataBuffer = New DataBuffer(1024)
	
	Method New()
		Sock.ConnectAsync("127.0.0.1", 50987, Self) ' connect to this computer locally using another thread (does this in the background)
		AddAsyncEventSource(Self)
	End
	
	Method UpdateAsyncEvents:Void()
		'do not call too much AsyncMethods because they will all create new threads and your app wil crash
	End
	
	'TODO: Needs some kind of Sock.ReceiveAsync to work
	Method OnReceiveComplete:Void(data:DataBuffer, offset:Int, count:Int, source:Socket)
		Print "client receive:" + count
	End
	
	'Will be called automatically by Sock.ConnectAsync("127.0.0.1", 50987, Self) &lt;&lt;- because of the Self once the connection is established
	Method OnConnectComplete:Void(connected:Bool, source:Socket)
		Print "connected to a server!"
		'the Difference: No new Socket
	End
	
End

Class Server Implements IAsyncEventSource, IOnBindComplete, IOnAcceptComplete, IOnReceiveComplete

	Field Sock:Socket = New Socket("server")
	Field Data:DataBuffer = New DataBuffer(1024)
	
	
	Method New()
		Sock.BindAsync("127.0.0.1", 50987, Self) ' try to take over port 50987 (NOTE: this uses threading under the hood, so it simply continues and doesn't wait for BindAsync to complete)
		AddAsyncEventSource(Self)
	End
	
	Method UpdateAsyncEvents:Void()
		'do not call too much AsyncMethods because they will all create new threads and your app wil crash
	End
	
	'TODO: Needs some kind of Sock.ReceiveAsync to work
	Method OnReceiveComplete:Void(data:DataBuffer, offset:Int, count:Int, source:Socket)
		Print "server receive:" + count
	End
	
	'Will be automatically called when a new client connects
	Method OnAcceptComplete:Void(socket:Socket, source:Socket)
		Print "a client connected"
		Sock.AcceptAsync(Self)
		'Please note : "socket" contains the incoming connection and needs to be saved
	End
	
	Method OnBindComplete:Void(bound:Bool, source:Socket)
 		If bound Then
 			Print "Port was available!"
			Sock.AcceptAsync(Self) ' Accecpt incoming connections now (DONT DO THIS WHILE BINDASYNC IS RUNNING)
		Else
			Error("Another application is already using the port 50987 :(")
		EndIf
	End
End
</textarea><br><br>hope that helps! <br><br></td></tr></table><br>
<a name="2090387"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >navyRod</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks..  ran that and it worked.  <br><br>There was a post by ben that has a good beginning example .  <br><br>It draws a colored circle based on mouse location and I did get this to work when trying between devices (laptop,windows8phone, android tablet, android phone)  in different configurations lap to phone .. tablet to phone etc.   ( I attach it in code section below) <br><br>What I am trying to figure out is what it is going to take to expand this code to allow more connections  thinking up to 6  or so  as it seems to be coded in this example just as a server and one client .  ( so this is a great start ) <br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
#rem

Connect a client to a server.
Send the mouse or touch coords back and forth and display a circle in that spot on both screens.

Hardcode the server's IP into the code below.

Run on the Client Device
Run on the Server Device
Touch the word SERVER at the top on the Server device.
Touch the word CLIENT at the top on the Client device.
Start clicking/touching the screens and see the dots move around.

Works (kind-of) for me :/

#end

Import mojo

Import brl.socket


Const SERVER_IP:String = "xxxxxxx"  ' Change to your Server device's IP
Const SERVER_PORT:Int = 12345 ' Change to your own

Const SOCKET_NONE = 0
Const SOCKET_SERVER = 1
Const SOCKET_CLIENT = 2

Global msgStr:String = ""
                                                                                                                                              Global serverStr:String = "0,0"
Global clientStr:String = "0,0"
Global isServer:Int = 0
Global socketType:Int = SOCKET_NONE

Global hasMsg:String = "No messages"

Global killClient:Int = 0

Global clickX:Int = 0
	Global clickY:Int = 0	
	Global serverX:Int = 0
	Global serverY:Int = 0
	Global clientX:Int = 0
	Global clientY:Int = 0

Class TcpEchoServer Implements IOnAcceptComplete

	Method New( port:Int )
		_socket=New Socket( "server" )
		If Not _socket.Bind( "",port ) Then
			hasMsg = "Server IP Bind Failed"
			Return
		Else
			hasMsg = "Bind Successful"			
		End If
		_socket.AcceptAsync( Self )
		
	End
	
	Private
	
	Field _socket:Socket
	Field clients:TcpEchoServerClient[10]
	Field onClient:Int = 0
	
	
	Method OnAcceptComplete:Void( socket:Socket,source:Socket )
		If Not socket Then
			hasMsg = "Server Client Connection Accept Error" ' "Accept Error"
			Return 
		End If		
		hasMsg = "TcpEchoServer: Accepted client connection"
		clients[onClient] = New TcpEchoServerClient( socket )
		onClient = onClient + 1
	End
	
	
End

Class TcpEchoServerClient Implements IOnSendComplete,IOnReceiveComplete

	Method New( socket:Socket )
		_socket=socket
		_socket.ReceiveAsync _data,0,_data.Length,Self
	End
	
	Private
	
	Field _socket:Socket
	Field _data:=New DataBuffer( 1024 )
	
	Method OnReceiveComplete:Void( data:DataBuffer,offset:Int,count:Int,source:Socket )
	
		If Not count Or killClient = 1 Then
			hasMsg = "TcpEchoServer: Closing client connection"
			_socket.Close()
			killClient = 0
			Return
		Endif
		'Print "received " + offset + ", " + count + ", " + data.PeekString( offset,count )
		clientStr = data.PeekString( offset,count )
		Local sstr:String[2]
		sstr = clientStr.Split(",")
		If sstr.Length=2 Then
			clientX = Int(Float(sstr[0]))
			clientY = Int(Float(sstr[1]))			
		End If
		msgStr = serverStr+":"+clientStr		
		data.PokeString(0,serverStr)
		_socket.SendAsync data,0,serverStr.Length(),Self ' offset
	End

	Method OnSendComplete:Void( data:DataBuffer,offset:Int,count:Int,source:Socket )
		_socket.ReceiveAsync _data,0,_data.Length,Self
	End
	
End

Class MyApp Extends App Implements IOnConnectComplete,IOnSendComplete,IOnReceiveComplete

	Field _server:TcpEchoServer
	
	Field _socket:Socket
	Field _data:=New DataBuffer( 1024 )
	
	Field onSocketTry:Int = 0
		
	Method OnCreate()
	
		socketType = SOCKET_NONE
		
		msgStr = serverStr + "," + clientStr
				
		SetUpdateRate 60
		
		
	End
	
	Method OnUpdate()
		UpdateAsyncEvents
		
				
			
		If MouseHit() Then
		
		
			Local mx:Float = MouseX()
			Local my:Float = MouseY()
			
			If my &lt; 30 Then
			
				If mx &gt;= 0 And mx &lt;= 92 Then
				
					If socketType = SOCKET_NONE Then
						socketType = SOCKET_SERVER
						_server=New TcpEchoServer( SERVER_PORT )										
					End If
					
				Elseif mx &gt; 92 And mx&lt;= 192 Then
				
					If socketType = SOCKET_NONE Then
						socketType = SOCKET_CLIENT
						_socket=New Socket( "stream" )
						_socket.ConnectAsync SERVER_IP,SERVER_PORT,Self
					End If
				
				End If
				
								
				
			
			End If				
		
		Elseif MouseDown() Then
		
			clickX = MouseX()
			clickY = MouseY()
			
			If socketType=SOCKET_CLIENT Then
			
				clientX = clickX
				clientY = clickY
			
				clientStr = clickX + "," + clickY
				msgStr = serverStr+":"+clientStr
			
			Elseif socketType=SOCKET_SERVER Then
			
				serverX = clickX
				serverY = clickY
			
				serverStr = clickX + "," + clickY	
				msgStr = serverStr+":"+clientStr			

			End If			
		
		End If
			
		
	End
	
	Method OnRender()
		Cls
		If socketType=SOCKET_SERVER Then
			DrawText "SERVER ON PORT " + SERVER_PORT,10,10			
		Elseif socketType=SOCKET_CLIENT Then
			DrawText"CLIENT",10,10			
		Else
			DrawText "Server            Client",10,10
		End If
		
		DrawText msgStr,10,30
		
		DrawText hasMsg, 10, 50
		
		DrawText MouseX() + "," + MouseY(), 10, 70
		
		If serverX&gt;0 Or serverY&gt;0 Then
		
			SetColor 255,0,0
			DrawCircle serverX,serverY,20
			
		End If
		
		If clientX&gt;0 Or clientY&gt;0 Then
		
			SetColor 0,255,0
			DrawCircle clientX,clientY,20
			
		End If
		
		
	End
	
	
	
	Method SendMore:Void()
		
		' we send our coords to the server
		Local n:=_data.PokeString( 0, clickX + "," + clickY )
		_socket.SendAsync _data,0,n,Self
		
	End
	
	Method OnConnectComplete:Void( connected:Bool,source:Socket )
		If Not connected Then
			hasMsg = "Error Connecting"
			_socket.Close()
			Return
		Else
			SendMore
		End If
	End
	
	Method OnSendComplete:Void( data:DataBuffer,offset:Int,count:Int,source:Socket )
		_socket.ReceiveAsync _data,0,_data.Length,Self
	End

	Method OnReceiveComplete:Void( data:DataBuffer,offset:Int,count:Int,source:Socket )
		' The server always just sends back its coords, attach ours
		serverStr = data.PeekString( offset,count )
		Local sstr:String[2]
		sstr = serverStr.Split(",")
		If sstr.Length=2 Then
			serverX = Int(Float(sstr[0]))
			serverY = Int(Float(sstr[1]))			
		End If
		msgStr = serverStr + ":" + clientStr
		SendMore
	End
	
	
	
	
End

Function Main()

	New MyApp
	
End


</textarea> <br><br></td></tr></table><br>
<a name="2090382"></a>

<a name="2090381"></a>

<a name="2090380"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >navyRod</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks..  ran that and it worked.  <br><br>Mark does have an  echo server example out that draws a colored circle  based on mouse locations as a beginning example.<br>It draws a colored circle based on mouse location and I did get this to work when trying between devices (laptop,windows8phone, android tablet, android phone)  in different configurations lap to phone .. tablet to phone etc.   ( I attach it in code section below) <br><br>What I am trying to figure out is what it is going to take to expand this code to allow more connections  thinking up to 6  or so  as it seems to be coded in this example just as a server and one client .  ( so this is a great start ) <br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
#rem

Connect a client to a server.
Send the mouse or touch coords back and forth and display a circle in that spot on both screens.

Hardcode the server's IP into the code below.

Run on the Client Device
Run on the Server Device
Touch the word SERVER at the top on the Server device.
Touch the word CLIENT at the top on the Client device.
Start clicking/touching the screens and see the dots move around.

Works (kind-of) for me :/

#end

Import mojo

Import brl.socket


Const SERVER_IP:String = "192.168.43.1" ' Change to your Server device's IP
Const SERVER_PORT:Int = 12345 ' Change to your own

Const SOCKET_NONE = 0
Const SOCKET_SERVER = 1
Const SOCKET_CLIENT = 2

Global msgStr:String = ""
                                                                                                                                              Global serverStr:String = "0,0"
Global clientStr:String = "0,0"
Global isServer:Int = 0
Global socketType:Int = SOCKET_NONE

Global hasMsg:String = "No messages"

Global killClient:Int = 0

Global clickX:Int = 0
	Global clickY:Int = 0	
	Global serverX:Int = 0
	Global serverY:Int = 0
	Global clientX:Int = 0
	Global clientY:Int = 0

Class TcpEchoServer Implements IOnAcceptComplete

	Method New( port:Int )
		_socket=New Socket( "server" )
		If Not _socket.Bind( "",port ) Then
			hasMsg = "Server IP Bind Failed"
			Return
		Else
			hasMsg = "Bind Successful"			
		End If
		_socket.AcceptAsync( Self )
		
	End
	
	Private
	
	Field _socket:Socket
	Field clients:TcpEchoServerClient[10]
	Field onClient:Int = 0
	
	
	Method OnAcceptComplete:Void( socket:Socket,source:Socket )
		If Not socket Then
			hasMsg = "Server Client Connection Accept Error" ' "Accept Error"
			Return 
		End If		
		hasMsg = "TcpEchoServer: Accepted client connection"
		clients[onClient] = New TcpEchoServerClient( socket )
		onClient = onClient + 1
	End
	
	
End

Class TcpEchoServerClient Implements IOnSendComplete,IOnReceiveComplete

	Method New( socket:Socket )
		_socket=socket
		_socket.ReceiveAsync _data,0,_data.Length,Self
	End
	
	Private
	
	Field _socket:Socket
	Field _data:=New DataBuffer( 1024 )
	
	Method OnReceiveComplete:Void( data:DataBuffer,offset:Int,count:Int,source:Socket )
	
		If Not count Or killClient = 1 Then
			hasMsg = "TcpEchoServer: Closing client connection"
			_socket.Close()
			killClient = 0
			Return
		Endif
		'Print "received " + offset + ", " + count + ", " + data.PeekString( offset,count )
		clientStr = data.PeekString( offset,count )
		Local sstr:String[2]
		sstr = clientStr.Split(",")
		If sstr.Length=2 Then
			clientX = Int(Float(sstr[0]))
			clientY = Int(Float(sstr[1]))			
		End If
		msgStr = serverStr+":"+clientStr		
		data.PokeString(0,serverStr)
		_socket.SendAsync data,0,serverStr.Length(),Self ' offset
	End

	Method OnSendComplete:Void( data:DataBuffer,offset:Int,count:Int,source:Socket )
		_socket.ReceiveAsync _data,0,_data.Length,Self
	End
	
End

Class MyApp Extends App Implements IOnConnectComplete,IOnSendComplete,IOnReceiveComplete

	Field _server:TcpEchoServer
	
	Field _socket:Socket
	Field _data:=New DataBuffer( 1024 )
	
	Field onSocketTry:Int = 0
		
	Method OnCreate()
	
		socketType = SOCKET_NONE
		
		msgStr = serverStr + "," + clientStr
				
		SetUpdateRate 60
		
		
	End
	
	Method OnUpdate()
		UpdateAsyncEvents
		
				
			
		If MouseHit() Then
		
		
			Local mx:Float = MouseX()
			Local my:Float = MouseY()
			
			If my &lt; 30 Then
			
				If mx &gt;= 0 And mx &lt;= 92 Then
				
					If socketType = SOCKET_NONE Then
						socketType = SOCKET_SERVER
						_server=New TcpEchoServer( SERVER_PORT )										
					End If
					
				Elseif mx &gt; 92 And mx&lt;= 192 Then
				
					If socketType = SOCKET_NONE Then
						socketType = SOCKET_CLIENT
						_socket=New Socket( "stream" )
						_socket.ConnectAsync SERVER_IP,SERVER_PORT,Self
					End If
				
				End If
				
								
				
			
			End If				
		
		Elseif MouseDown() Then
		
			clickX = MouseX()
			clickY = MouseY()
			
			If socketType=SOCKET_CLIENT Then
			
				clientX = clickX
				clientY = clickY
			
				clientStr = clickX + "," + clickY
				msgStr = serverStr+":"+clientStr
			
			Elseif socketType=SOCKET_SERVER Then
			
				serverX = clickX
				serverY = clickY
			
				serverStr = clickX + "," + clickY	
				msgStr = serverStr+":"+clientStr			

			End If			
		
		End If
			
		
	End
	
	Method OnRender()
		Cls
		If socketType=SOCKET_SERVER Then
			DrawText "SERVER ON PORT " + SERVER_PORT,10,10			
		Elseif socketType=SOCKET_CLIENT Then
			DrawText"CLIENT",10,10			
		Else
			DrawText "Server            Client",10,10
		End If
		
		DrawText msgStr,10,30
		
		DrawText hasMsg, 10, 50
		
		DrawText MouseX() + "," + MouseY(), 10, 70
		
		If serverX&gt;0 Or serverY&gt;0 Then
		
			SetColor 255,0,0
			DrawCircle serverX,serverY,20
			
		End If
		
		If clientX&gt;0 Or clientY&gt;0 Then
		
			SetColor 0,255,0
			DrawCircle clientX,clientY,20
			
		End If
		
		
	End
	
	
	
	Method SendMore:Void()
		
		' we send our coords to the server
		Local n:=_data.PokeString( 0, clickX + "," + clickY )
		_socket.SendAsync _data,0,n,Self
		
	End
	
	Method OnConnectComplete:Void( connected:Bool,source:Socket )
		If Not connected Then
			hasMsg = "Error Connecting"
			_socket.Close()
			Return
		Else
			SendMore
		End If
	End
	
	Method OnSendComplete:Void( data:DataBuffer,offset:Int,count:Int,source:Socket )
		_socket.ReceiveAsync _data,0,_data.Length,Self
	End

	Method OnReceiveComplete:Void( data:DataBuffer,offset:Int,count:Int,source:Socket )
		' The server always just sends back its coords, attach ours
		serverStr = data.PeekString( offset,count )
		Local sstr:String[2]
		sstr = serverStr.Split(",")
		If sstr.Length=2 Then
			serverX = Int(Float(sstr[0]))
			serverY = Int(Float(sstr[1]))			
		End If
		msgStr = serverStr + ":" + clientStr
		SendMore
	End
	
	
	
	
End

Function Main()

	New MyApp
	
End


</textarea> <br><br></td></tr></table><br>
<a name="2090379"></a>

<a name="2090377"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >navyRod</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks..  ran that and it worked.  <br><br>Mark does have an  echo server example out that draws a colored circle  based on mouse locations as a beginning example.<br>It draws a colored circle based on mouse location and I did get this to work when trying between devices (laptop,windows8phone, android tablet, android phone)  in different configurations lap to phone .. tablet to phone etc.   ( I attach it in code section below) <br><br>What I am trying to figure out is what it is going to take to expand this code to allow more connections  thinking up to 6  or so  as it seems to be coded in this example just as a server and one client .  ( so this is a great start ) <br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">

</textarea> <br><br></td></tr></table><br>
<a name="2090378"></a>

<a name="2090376"></a>

<a name="2090375"></a>

<a name="2090440"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Reaper</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Heya navy, the code of benmc`s supoported 4 clients for the falling game over tcp no problems, udp would obviously be better tho but not tried yet.<br>It just needed an extra _socket.AcceptAsync( Self) at the end OnAcceptComplete:Void Method.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">	Method OnAcceptComplete:Void( socket:Socket,source:Socket)
		If Not socket Then
			hasMsg = "Server Client Connection Accept Error" ' "Accept Error"
			Return 
		End If		
		
		If onClient &lt; maxPlayers Then
			clients[onClient] = New TcpEchoServerClient( socket )
			onClient = onClient + 1
			serverStr = numPlayers + ",9999,"+onClient
			hasMsg = "TcpEchoServer: Accepted client connection"+onClient
			_socket.AcceptAsync( Self )
			
		Else
			_socket.Close()
		End
	End</textarea><br><br>As I recall once Id added that it worked for multiple clients.<br>Here are the 2 OnReceiveComplete methods to show you how it switched state etc.<br>A bit messy but I was cobling it together and learning :)<br><br>1st the Clients receiving code.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">	Method OnReceiveComplete:Void( data:DataBuffer,offset:Int,count:Int,source:Socket )
		'client
		serverStr = data.PeekString( offset,count ) ' load received data into serverstr
		
		Local sstr:String[]						'split string into variables
		sstr = serverStr.Split(",")					'
		Local a:Int[sstr.Length()]
		
		For Local i:Int = 0 To sstr.Length()-1
			a[i] = Int(Float(sstr[i]))						'
		End
		
		Select gameState
			
			Case STATE_MENU
		
				If a.Length() &gt; 2
					Select a[1]
					
						Case 9999
							If clientNo = 0
								clientNo = a[2]
							End
							numPlayers = a[0]
							
						Case 8888
				
							Seed = a[2]
							seedForThisGame = Seed
							gameState = STATE_SYNC
							'PlayMusic("Mining_by_Moonlight.ogg")
							Reset()
							'clientsReady[1] = 1
							readyCount = a[0]
					End
				End
			Case STATE_SYNC
				If a.Length() &gt; 2
					Select a[1]	
						Case 8888
							readyCount = a[0]
					End
				End
			Case STATE_GAME
			
				For Local player:Player = Eachin players
					Local d:Int = 0
					If player.isDead = True
						d = 1
					Else
						d = 0
					End
					If clientNo = player.client
						clientStr = player.client+","+player.position.x+","+player.position.y+","+player.flip+","+player.score+","+d
					Else
						If a.Length() &gt; 3 And a[1] = 8888
							For Local i:Int = 3 To a.Length()-1 Step 6
								If player.client = a[i]
									player.position.x = a[i+1]
									player.position.y = a[i+2]
									player.flip = a[i+3]
									player.score = a[i+4]
									If a[i+5] = 1 
										player.isDead = True
									End
								End
							End
						End
					End
					
					If a.Length() &gt; 3 And a[1] = 7777
						For Local i:Int = 3 To a.Length()-1 Step 2
							If player.client = a[i]
								player.score = a[i+1]
							End
						End
					End	
				End
				
				If a.Length() &gt; 3 And a[1] = 7777
					CheckWinner()
					readyCount = 0
					For Local i:= 0 To 4
						clientsReady[i] = 0
					End
					gameState = STATE_DEATH
				End
				
				
			Case STATE_DEATH
			
				For Local player:Player = Eachin players
					If clientNo = player.client
						clientStr = player.client+","+"8888"+","+seedForThisGame
					End
				End
			
			
				If a.Length() &gt; 2 And a[1] = 8888
					gameState = STATE_SERVER_WAIT
				End
				
				If a.Length() &gt; 2 And a[1] = 9999
					'PlayMusic("Disco_con_Tutti.ogg")
					Seed = a[2]
					seedForThisGame = Seed
					Reset()
					gameState = STATE_MENU
					For Local i:= 0 To 4
						clientsReady[i] = 0
					End
				readyCount = 0
				End
				
			Case STATE_SERVER_WAIT
			
				If a.Length() &gt; 2 And a[1] = 9999
					'PlayMusic("Disco_con_Tutti.ogg")
					gameState = STATE_MENU
					For Local i:= 0 To 4
						clientsReady[i] = 0
					End
					readyCount = 0
				End
			
				If a.Length() &gt; 2 And a[1] = 8888
					Seed = a[2]
					seedForThisGame = Seed
					Reset()
					readyCount = a[0]
				End
				
				
		End
	
		msgStr = serverStr + ":" + clientStr		' display text
		SendMore()									' call routine to send client info
	End</textarea><br><br>And the Servers<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Class TcpEchoServerClient Implements IOnSendComplete,IOnReceiveComplete

	Method New( socket:Socket )
		_socket=socket
		_socket.ReceiveAsync _data,0,_data.Length,Self
	End
	
	Private
	
	Field _socket:Socket
	Field _data:=New DataBuffer( 1024 )
	
	Method OnReceiveComplete:Void( data:DataBuffer,offset:Int,count:Int,source:Socket )
	'Server Receive
		If Not count Or killClient = 1 Then
			hasMsg = "TcpEchoServer: Closing client connection"
			_socket.Close()
			killClient = 0
			onClient -= 1
			Return
		Endif
		
		clientStr = data.PeekString( offset,count )

		Local sstr:String[]
		sstr = clientStr.Split(",")
		Local a:Int[sstr.Length()]
		
		For Local i:Int = 0 To sstr.Length()-1
			a[i] = Int(Float(sstr[i]))						'
		End
		
		Select gameState 
			Case STATE_SYNC
				If a.Length() &gt; 1
					If a[1] = seedForThisGame
						clientsReady[a[0]] = 1
					End
				End
				
			Case STATE_GAME

				serverStr = readyCount + ",8888," + seedForThisGame

				For Local player:Player = Eachin players
					If a.Length() &gt; 5
						If player.client = a[0]
							player.position.x = a[1]
							player.position.y = a[2]
							player.flip = a[3]
							player.score = a[4]
							If a[5] = 1 
								player.isDead = True
							End
						End
					End
					
					Local d:Int = 0
					If player.isDead = True
						d = 1
					Else
						d = 0
					End
					serverStr = serverStr+","+player.client+","+player.position.x+","+player.position.y+","+player.flip+","+player.score+","+d
				End
			Case STATE_DEATH
				serverStr = readyCount + ",7777,"+numPlayers
				For Local player:Player = Eachin players
					If a.Length() &gt; 5
						If player.client = a[0]
							player.score = a[4]
						End
					End
					
				End
				For Local player:Player = Eachin winningPlayers
					serverStr = serverStr+","+player.client+","+player.score
				End
				If a.Length() &gt; 1
					If a[1] = 7777
						clientsReady[a[0]] = 1
					End
				End
				
			Case STATE_SERVER_WAIT
				serverStr = readyCount + ",8888,"+seedForThisGame
				If a.Length() &gt; 1
					If a[1] = 8888
						clientsReady[a[0]] = 1
					End
				End
			
		End
		
		msgStr = serverStr+":"+clientStr
		data.PokeString(0,serverStr)
		_socket.SendAsync data,0,serverStr.Length(),Self ' offset
		
	End</textarea><br><br>Obviously theres a certain amount in the onUpdate() section so Ive included it below as a (bad?) example<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">	Method OnUpdate()
		
		Select gameState
			
			Case STATE_LOADING1
				GameInitialize()

				gameState = STATE_MENU
				
			Case STATE_LOADING0
				gameState = STATE_LOADING1
		
			Case STATE_MENU	
				
				UpdateAsyncEvents
				
				' Marks Keyboard input routine
				If enabled
					Repeat
						Local char=GetChar()
						If Not char Exit
						
						Print "char="+char
						If char&gt;=32
							SERVER_IP+=String.FromChar( char )
						Else
							Select char
							Case 8
								SERVER_IP=SERVER_IP[..-1]
							Case 13
								If SERVER_IP.Trim()="bye" Error ""	'test abrupt exit with keyboard open
								enabled=False
								DisableKeyboard
								If SERVER_IP &lt;&gt;""
									socketType = SOCKET_CLIENT
									_socket=New Socket( "stream" )
									_socket.ConnectAsync SERVER_IP,SERVER_PORT,Self
								End
							Case 27
								SERVER_IP=old
								enabled=False
								DisableKeyboard
							End
						Endif
		
					Forever
				Endif
				
				If KeyHit(KEY_F1) Or KeyHit(KEY_LMB) And VMouseX &gt;= 0 And VMouseX &lt;= 100 And VMouseY &gt;= 0 And VMouseY &lt;= 64
					If socketType = SOCKET_NONE Then
						socketType = SOCKET_SERVER
						_server=New TcpEchoServer( SERVER_PORT )										
					End If
				Endif
					
				If KeyHit(KEY_F2) Or KeyHit(KEY_LMB) And VMouseX &gt;= SCREEN_WIDTH-100 And VMouseX &lt;= SCREEN_WIDTH And VMouseY &gt;= 0 And VMouseY &lt;= 64			
					If socketType = SOCKET_NONE And enabled = False Then
						old=SERVER_IP
						SERVER_IP=""
						enabled=True
						EnableKeyboard
						
					End If			
				End If
				
				If KeyHit(KEY_F12)				
					If socketType = SOCKET_CLIENT Then
						socketType = SOCKET_NONE
						clientStr ="LOG"
						_socket.Close()
					End If			
				End If
				
								
				If socketType=SOCKET_CLIENT Then

					clientStr = clientNo+","+numPlayers
					msgStr = serverStr+":"+clientStr
			
				Elseif socketType=SOCKET_SERVER Then
					serverStr = numPlayers + ",9999,"+onClient
					msgStr = serverStr+":"+clientStr			

				End If			
		
				
				If socketType = SOCKET_NONE Then 
					If numPlayers &gt; 1
						If KeyHit(KEY_LEFT) Or KeyHit(KEY_LMB) And VMouseX &gt;= 98 And VMouseX &lt;= 168 And VMouseY &gt;= 177 And VMouseY &lt;= 251
							numPlayers -= 1
						End
					End
					If numPlayers &lt; maxPlayers
						If KeyHit(KEY_RIGHT) Or KeyHit(KEY_LMB) And VMouseX &gt;= 451 And VMouseX &lt;= 521 And VMouseY &gt;= 177 And VMouseY &lt;= 251
							numPlayers += 1
						End
					End	
					If KeyHit(KEY_ENTER) Or KeyHit(KEY_LMB) And VMouseX &gt;= 0 And VMouseX &lt;= 100 And VMouseY &gt;= SCREEN_HEIGHT-64 And VMouseY &lt;= SCREEN_HEIGHT
						gameState = STATE_GAME
						Seed = Millisecs()
						seedForThisGame = Seed
						'PlayMusic("Mining_by_Moonlight.ogg")
						Reset()
					End
				Elseif socketType =SOCKET_SERVER
					numPlayers = onClient
					If numPlayers &gt; maxPlayers Then	numPlayers = maxPlayers
					
					If KeyHit(KEY_ENTER) Or KeyHit(KEY_LMB) And VMouseX &gt;= 0 And VMouseX &lt;= 100 And VMouseY &gt;= SCREEN_HEIGHT-64 And VMouseY &lt;= SCREEN_HEIGHT
						gameState = STATE_SYNC
						Seed = Millisecs()
						seedForThisGame = Seed
						'PlayMusic("Mining_by_Moonlight.ogg")
						Reset()
						For Local i:= 0 To 4
							clientsReady[i] = 0
						End
						clientsReady[1] = 1
					End
					
				End		

				If KeyHit(KEY_ESCAPE) Or KeyHit(KEY_LMB) And VMouseX &gt;= SCREEN_WIDTH-100 And VMouseX &lt;= SCREEN_WIDTH And VMouseY &gt;= SCREEN_HEIGHT-64 And VMouseY &lt;= SCREEN_HEIGHT
				
					If socketType &lt;&gt; SOCKET_NONE
						_socket.Close()
					End
					EndApp
				End
				
			Case STATE_SYNC
				UpdateAsyncEvents
				

				
				If socketType=SOCKET_CLIENT Then

					clientStr = clientNo + "," + seedForThisGame
			
				Elseif socketType=SOCKET_SERVER Then
				
					readyCount = 0
					For Local i:= 1 To numPlayers
						If clientsReady[i] = 1
							readyCount += 1
						End
					End
			
					serverStr = readyCount + ",8888," + seedForThisGame			

				End If
				

				If readyCount = numPlayers Then gameState = STATE_GAME
			
			Case STATE_GAME
				UpdateAsyncEvents
				
				If KeyHit(KEY_ESCAPE) 
					CheckWinner()
					gameState = STATE_DEATH
				End
				
				If KeyHit(KEY_R)
					Reset()
				End
				
				deadPlayers = 0
				For Local player:Player = Eachin players
					If Not player.isDead
						UpdatePlayer(player)
					Else
						deadPlayers +=1
					End
				End
				cam.Update(curGameVars.camSpeed)
				
				curRow = Abs(cam.position.y/TILE_HEIGHT)
				
				If curRow &gt;= nextFloorGen
					GenerateFloor(lastFloorRow+ curGameVars.floorFrequency)
				End
				
				If gameVars.Count() &gt; 0 And rowsGenerated &gt;= gameVars.First().row
					curGameVars = gameVars.RemoveFirst()
				End
				
				If deadPlayers &gt;= players.Count() And socketType &lt;&gt; SOCKET_CLIENT
					CheckWinner()
					readyCount = 0
					For Local i:= 0 To 4
						clientsReady[i] = 0
					End
					gameState = STATE_DEATH
				End
				
				
			Case STATE_DEATH
				UpdateAsyncEvents
				
				If KeyHit(KEY_ESCAPE) Or KeyHit(KEY_LMB) And VMouseX &gt;= SCREEN_WIDTH-100 And VMouseX &lt;= SCREEN_WIDTH And VMouseY &gt;= SCREEN_HEIGHT-64 And VMouseY &lt;= SCREEN_HEIGHT
					'PlayMusic("Disco_con_Tutti.ogg")
					gameState = STATE_MENU
					For Local i:= 0 To 4
						clientsReady[i] = 0
					End
					readyCount = 0
				End
				
				If KeyHit(KEY_ENTER) Or KeyHit(KEY_LMB) And VMouseX &gt;= 0 And VMouseX &lt;= 100 And VMouseY &gt;= SCREEN_HEIGHT-64 And VMouseY &lt;= SCREEN_HEIGHT
					If socketType = SOCKET_SERVER
						gameState = STATE_SERVER_WAIT
						Seed = Millisecs()
						seedForThisGame = Seed
						Reset()
						For Local i:= 0 To 4
							clientsReady[i] = 0
						End
						clientsReady[1] = 1
						serverStr = readyCount + ",8888,"+ seedForThisGame
					Elseif socketType = SOCKET_NONE
						gameState = STATE_GAME
						Reset()
					End
				End
				
			Case STATE_SERVER_WAIT
				UpdateAsyncEvents
				
								
				If socketType=SOCKET_CLIENT Then

					clientStr = clientNo + ","+"8888"+"," + seedForThisGame
			
				Elseif socketType=SOCKET_SERVER Then
				
					readyCount = 0
					For Local i:= 1 To numPlayers
						If clientsReady[i] = 1
							readyCount += 1
						End
					End
			
					serverStr = readyCount + ",8888,"+ seedForThisGame

				End If
				

				If readyCount = numPlayers 
					Seed = seedForThisGame
					gameState = STATE_GAME
				End
				
			
			
		End
	End</textarea><br><br>As you can see I used serverStr and clientStr to pass data between the 2 and the 9999 was a flag I used to switch to 8888 / 7777 just as a trigger to switch gamestates.<br><br>The whole game ended up with a ferw extra states - a STATE_SYNC and a STATE_WAIT where it made sure all clients were ready after the main menu and after the death screen when the Server hit return. <br><br></td></tr></table><br>
<a name="2090401"></a>

<a name="2090402"></a>

<a name="2090403"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Reaper</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> erm how do I make those code boxes scrolly..... I just used  [ code and [/code ??? <br><br></td></tr></table><br>
<a name="2090404"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Reaper</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> damn u navy u distracted me, came here to find link for jentos`s Ide, thats pretty sweet, a few bugs atm but I find it very nice so far..... off to dload it and get on with what I meant to hehe <br><br></td></tr></table><br>
<a name="2090419"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raph</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> Use codebox instead of code. <br><br></td></tr></table><br>
<a name="2090429"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >navyRod</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> Awesome news that this can support 4 or (more?)  <br><br>Will definitely be looking this over.   Your posts are very much appreciated. <br><br></td></tr></table><br>
<a name="2090439"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Reaper</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> Tested it with 4, according to the code it should work for 10 , at least thats what the array is declared as being able to allow. <br><br></td></tr></table><br>
<a name="2090446"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >navyRod</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nice -- you going to be posting your game eventually <br><br>Plan on dissecting what you  got here and initially see if I can incorporate it into ben's example for my understanding <br><br>It appears that your using a keyboard routine to enter the IP address and port # that is going to be used vice hard coding it. <br><br>Is that  correct ?<br><br>I am assuming that the clients have to do this as well ? <br><br>Getting a few networking examples out here I think would be a nice addition to the community effort so appreciate  what you have done. <br><br></td></tr></table><br>
<a name="2090449"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Reaper</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> Its is benmcs netcode exactly, just with that 1 extra missing line.<br><br>Correct the keyboard routine is lifted from \bananas\mak\keyboardtest and is used for entering in the IP.  could do with some tweaks for the purpose ie only entering numbers <br>and auto inserting dots....   Only the client needs the IP. for now the port is fixed and it is all that the server needs.<br><br>Too much to dissect, where to start ;p<br><br>As said the netcode is the same, and to incorporate it as you can see I replaced the screen clicks with key presses. Also for android compatibnility I placed 4 buttons on the 4 corners of the screen for host(F1) join(F2) start(return) and quit(esc)  F12 was just an experiment and forgot to remove it. Also as you can see in the various different case STATE sections of OnUpdate()  it is essentialy just the 1player stuff with added in server checks, where its checking all players are dead during the game, or checking that all the players are ready (connected and having acknowledged the connection by returning relevant info.)<br><br>most of the code gets placed in the 2 onreceive methods which is essentialy the same, I just changed how the data was stored when it was split to allow for any amount of info being sent ie this bit - <textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">		serverStr = data.PeekString( offset,count ) ' load received data into serverstr
		
		Local sstr:String[]						'split string into variables
		sstr = serverStr.Split(",")					'
		Local a:Int[sstr.Length()]
		
		For Local i:Int = 0 To sstr.Length()-1
			a[i] = Int(Float(sstr[i]))						'
		End
		
		Select gameState</textarea><br><br>The basic process from start to finish is the host presses f1 to initiate a connection, anyone can then join if they have the correct IP. only the server needs to have Dmz or port forwarding enabled on their router. Any client can now press F2 and connect. The server during this time is broadcasting the number of players total and the onclientno so when the next client connects it sets its local clientNo variable to onClient , (I also added clientNo as a field of the player class.)<br><br>Once the server hits return it sets the gamestate to STATE_SYNC, Seed() = Millisecs and seedForThisGame to Seed(). It then does the standard Reset() and sets serverStr to<br>readycount(1 initialy ie the server) + 8888 (just a random value I did as a marker/test. should be replaced with a single digit idealy.) + numberofplayers(total number of clients including host) once the client has received this it acknowledges by setting it6s clientStr to its clientno+the SeedForThisGame value.<br><br>As soon as the server sees that the seed value broadcast by the client matches its own it sets clientsready[broadcast client no] to be 1 . once all clients are ready the gamestate switches to STATE_GAME. - Note the server then continues to broadcast this info durting the game (seed+8888+readycount) because otherwise the clients dont have a chance to receive the updated readycount value and launch themselves.<br><br>Once its in the STATE_GAME section its basicly the same but a little more info is passed back and forth. basicly the clients send their clientNo, position, score, isDead and flip.<br>The server receives this info and puts each players info into its playerlist and then broadcasts the position of all 4 players(or total no playing) the client receives info and like the server puts the info in its playerlist for the other clients.<br><br>Collision death etc are all handled clientside, the server just waits until all players isDead flag is true before changing gamestate, again with a simple digit change, this time to 7777.<br>It continues broadcasting readycount and numplayers and attaches each players score. the clients likewise send their score once the server hits return / esc the broadcast message is changed to 8888 or 9999 depending if its going back to the main menu or to the game then it goes to STATE_WAIT  which is essentialy the same as STATE_SYNC, and from there once all have acknowledged it then goes back to STATE_MENU / STATE_GAME.<br><br>Hope this helps and yeah Ill post fullcode of the network framework, stripped outof the game but still with a complete gameloop as a simpler example once Ive tidied it up alot and Im happy with it, this lot is very much a work in progress.<br><br>Also as of yet Ive not looked at doing it with UDP but might have to switch to that as with TCPIP you get a certain amount of lag in info being transferred, noticable by how the network players move too many pixels and a bit jerkily. <br><br></td></tr></table><br>
<a name="2090450"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Reaper</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> wow thats a wall of text, hate explaining shit ;p hope it helps tho.... <br><br></td></tr></table><br>
<a name="2090451"></a>

<a name="2090457"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >navyRod</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nice explanation.   I can see from this that network code is not exactly easy  and appreciate what you have done .<br><br>and ben for having the base to start with .. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
