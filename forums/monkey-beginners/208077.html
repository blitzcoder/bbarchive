<!DOCTYPE html><html lang="en" ><head ><title >PopMatrix PushMatrix implementation</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >PopMatrix PushMatrix implementation</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=528" >Monkey Beginners</a>/<a href="#bottom" >PopMatrix PushMatrix implementation</a><br><br>
<a name="2080746"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Any reason why it's not using a Stack? It seems it's limited to 30 push/pop operations.<br>Shouldn't a MatrixStack be used instead? <br><br></td></tr></table><br>
<a name="2080747"></a>

<a name="2080748"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skid</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> No, the current push implementation will from the looks complete in under 4 cpu cycles and creates zero garbage which is what you want for functions that are likely to be called thousands of times per frame. <br><br></td></tr></table><br>
<a name="2080764"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Thousands of times per frame <br></div>I honestly think it makes no sense to worry about the speed of calling it thousands of times per frame, and limit it to 32 nested oiperations. Woud a Stack of 6 floats arrays be noticeable slower? I'm running out of array index often when woking with my Gui system.<br><br>EDIT: At last, it could dynamically resize the internal float array if required, and allow us to pre-resize it programatically if we want to prevent a chain of multiple slow resizes.<br><br>EDIT2: I see I can roll my own MatrixStack (or similar) and it should not interfer with current implementation. So, if you think my request/question has no sense, just ignore it. <br><br></td></tr></table><br>
<a name="2080756"></a>

<a name="2080757"></a>

<a name="2080760"></a>

<a name="2080761"></a>

<a name="2080765"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skid</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't disagree. I am finding it difficult to visualise a layout / use case that would require 8, let alone 32 deep transformation stack. <br><br></td></tr></table><br>
<a name="2080766"></a>

<a name="2080767"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> One of the initial motivations behind limiting the matrix stack size was to handle situations where users would forget to the pop the stack, in which case the stack would just quietly grow and grow until it blew up, probably leaving the user with little idea of what went wrong.<br><br>But that was back when I wasn't sure if mojo graphics state should reset itself every OnRender or not. But it does (ie: stack is effectively Cleared before each OnRender), so I don't think this is really a valid concern any more and would be comfortable with using a proper matrix stack. Or at the very least, a bigger one! <br><br></td></tr></table><br>
<a name="2080770"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I changed the mojo code to use a larger array of arrays as a matrix stack a while back. Made no odds in terms of speed for the most part and IIRC it was even a little faster in places due to being able to copy entire arrays with a single reference. The code was cleaner too. <br><br></td></tr></table><br>
<a name="2080771"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> @muddy_shoes; That's what I was testing right now. <br><br></td></tr></table><br>
<a name="2080787"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nobuyuki</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I always wondered the exact reasoning behind the stack limit, and now I know. <br><br></td></tr></table><br>
<a name="2080837"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I always wondered the exact reasoning behind the stack limit, and now I know. <br></div>It's fun that at first sight, I thought it was sort of "I'll add a propper stack later" and, as it is working as it is for most games, then nobody came back later to it. Like it had a missing "TODO" or something like this. <br><br></td></tr></table><br>
<a name="2080843"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nobuyuki</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> I always figured it was faster to allocate the hard limit than to use Stack&lt;T&gt;'s reallocator. At small values, it does a lot of array resizing ops. <br><br></td></tr></table><br>
<a name="2080853"></a>

<a name="2080855"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gerry Quinn</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> One fix to that would be to add a SetCapacity( capacity:Int ) and/or a New( startingCapacity:Int ) method to monkey.Stack<br><br>So:<br>matrixStack = New Stack&lt; matrixInfo &gt;( 30 ) <br><br>This would allocate an array of 30 as now, but it would grow like a stack if more were needed.<br><br>That said, if it were a standard stack and stack.Clear() were called at the start of a render, it would generally achieve its full size during the first frame, and require no reallocation thereafter. <br><br></td></tr></table><br>
<a name="2080979"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Lovely fix in the repo. Thanks! <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
