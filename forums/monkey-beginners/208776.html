<!DOCTYPE html><html lang="en" ><head ><title >Some questions on performance, box2D and usability</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Some questions on performance, box2D and usability</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=528" >Monkey Beginners</a>/<a href="#bottom" >Some questions on performance, box2D and usability</a><br><br>
<a name="2091528"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Szabo</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello there,<br><br>I just finished a game in Unity and I was somewhat disappointed by the performance on low-end android devices... it's a rather simple 2D shooter and I would like it to run on Galaxy Pockets and alikes, but that was not possible... when the game is simple, the overhead of Unity becomes significant.<br><br>So, since I'm not actually planning to go 3D anytime soon, I started looking for alternatives, I've used blitzmax in the past and I really loved it, so I'm considering Monkey since it's the new thing from the same guys.<br><br>The other two 'competitors' are Haxe (OpenFL) and LidGDX (although I don't know Java).<br><br>I've downloaded the free version of Monkey, the Box2D module and modded the box stacks demo, to create lots of smaller boxes instead, however, when I try to create 600 boxes, the memory goes up to 2GB and then goes down to about 130MB, when I try to create 1200 boxes, the thing crashes.<br><br>I don't know if that's expected, perhaps some GC peak or something... but in any case, I'd like to know how Monkey compares, in terms of performance (sprite rendering and physics2d performance) to the other competitors like Haxe (optionally Nape for physics) and LibGDX for 'native' target, be it desktop or mobile.<br><br>Is it possible to batch draw calls in Monkey? Do you have to do that manually?<br><br>Also, I'd like to know how is the usability compared to something line Unity... I don't actually need the GameObject+Component architecture, but I would like to know if there are easy ways to edit the levels and stuff. Perhaps some external tools or something.<br><br>Thank you in advance. <br><br></td></tr></table><br>
<a name="2091530"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> When using the Desktop target, the GC executes once per frame. If you're creating lots of garbage on.a single frame, it could have issues. To fix this, you only need to enable the generational GC using a compiler directive. I'm not at my computer now, so I can't tell the directive name. However, testing your app on HTML5 should not show this issue, and the same goes for Android. It's something speciffic to the C++ collector. Setting it to generational collection, will solve it too. <br><br></td></tr></table><br>
<a name="2091558"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Szabo</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello there.<br><br>HTML5 is just too slow for that... I'm sure it's possible to make it work though... I'm mostly interested on this because I read somewhere that the Box2D port is not that slower than the LibGDX wrapper, which is basically plain C++ because the JNI overhead is very minimal.<br><br>Any rough numbers on graphics performance is appreciated also, specially comparing these 3 alternatives. Of course I expect LibGDX to be the faster one, but I'd like to have an idea on how slower Monkey is (2x, 5x, 10x, etc).<br><br>Thanks. <br><br></td></tr></table><br>
<a name="2091562"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Why0Why</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey Szabo, welcome to the forums.  You might want to check out Ignition along with the RUBE module and editor.<br><br><a href="http://www.playniax.com/index.html" target="_blank">http://www.playniax.com/index.html</a> <br><br></td></tr></table><br>
<a name="2091581"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >rIKmAN</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> The Monkey Box2D Module is a port of the Flash version IIRC....<br><br>&lt;goes to look&gt;<br><br>Here we go: <a href="https://code.google.com/p/monkeybox2d/" target="_blank">https://code.google.com/p/monkeybox2d/</a><br><div class="quote"> <br>This is a port of Box2D by Erin Catto (http://www.box2d.org) to the Monkey language (http://www.monkeycoder.co.nz).<br><br>The port is directly translated from the Box2DFlash 2.1a code (http://www.box2dflash.org), with credits to BorisTheBrave, Matthew Bush and John Nesky for their work on that project.<br> <br></div><br>I would also take a look at <a href="http://www.monkey-x.com/Community/posts.php?topic=3106&amp;page=2" target="_blank">this thread</a> and start reading at post #38 as that's where performance starts to get discussed. <br><br></td></tr></table><br>
<a name="2091632"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >programmer</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Is it possible to batch draw calls in Monkey? Do you have to do that manually? <br></div> Batching is done automatically. <br><i>(edited)</i><br>Monkey can automatically batch drawings into the same draw call if they share the same image and blending. <br><br>Do:<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
DrawImageRect(image1, ...)
DrawImageRect(image1, ...)
...

' Or: rect1 = image1.GrabImage(...), rect2 = image1.GrabImage(...)
DrawImage(rect1, ...)
DrawImage(rect2, ...)
...

DrawImageRect(image2, ...)
DrawImageRect(image2, ...)
...

DrawImageRect(image3, ...)
DrawImageRect(image3, ...)
...
</textarea><br><br>Don't:<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
DrawImageRect(image1, ...)
DrawImageRect(image2, ...)
DrawImageRect(image3, ...)

DrawImageRect(image1, ...)
DrawImageRect(image2, ...)
DrawImageRect(image3, ...)

DrawImageRect(image1, ...)
DrawImageRect(image2, ...)
DrawImageRect(image3, ...)

...
</textarea> <br><br></td></tr></table><br>
<a name="2091625"></a>

<a name="2091626"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >programmer</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> ... modded the box stacks demo, to create lots of smaller boxes instead, however, when I try to create 600 boxes, the memory goes up to 2GB and then goes down to about 130MB, when I try to create 1200 boxes, the thing crashes. <br></div> Did you build and run it in "release" mode? <br><br></td></tr></table><br>
<a name="2091629"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gerry Quinn</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> DrawImage(image1, ...)<br>DrawImage(image1, ...)<br><br>Is this automatically batched if instead you draw two images that are grabbed from image1?<br><br>[Actually, this might explain why grabbing is not recursive, as somebody noticed recently...] <br><br></td></tr></table><br>
<a name="2091628"></a>

<a name="2091633"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >programmer</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> <i>(I edited the previous post and example)</i><br><div class="quote"> Is this automatically batched if instead you draw two images that are grabbed from image1? <br></div> Yes. Monkey can automatically batch drawings into the same draw call if they share the same image and blending. <br><br></td></tr></table><br>
<a name="2091910"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nobuyuki</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Monkey's version of box2d is a "naive" (read:  mostly machine-converted) port of the version of box2d used in ActionScript games.  It will be slower than a native port of box2d.  I don't know if haxe uses native box2d or one in its own language, but if it uses the C version then it will be faster.  The maintainer of the box2d port (whose name escapes me right now) is decent at fixing problems with it if you can report the bug and track down the problem with a profiler, but it will probably always be slower on some platforms compared to native.  This means Android, mainly.<br><br>I've had a project that used box2d extensively for its engine running at about 28fps on Android on my old Nexus S phone.  There were approximately 100 active objects in the simulation being polled for at any one time.  Depending on your game, you can deep freeze objects in and out of the simulation to increase the framerate for objects that are out of range, off-screen, or whatever.  There shouldn't be any serious bottlenecks unless you're making some kind of danmaku game which requires full collision mechanics.  (And if you're making one of those, usually you'd be writing your own collision code and foregoing most physics simulations entirely) <br><br></td></tr></table><br>
<a name="2091909"></a>

<a name="2091908"></a>

<a name="2091911"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >mjcamerer</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> I use Monkey's version of box2D in my project. It runs really great, although I do not have too many bodies in my game. The most extensive level is Level 12 and has over dynamic 100 box2D bodies. Everything runs nice and smooth on my Android  tablet, Android phone, HTML5, and GLFW builds. The game is here on the Monkey site if you are interested in trying the HTML build. <a href="http://www.monkey-x.com/Community/posts.php?topic=8722&amp;app_id=321" target="_blank">http://www.monkey-x.com/Community/posts.php?topic=8722&amp;app_id=321</a> <br><br></td></tr></table><br>
<a name="2092105"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Szabo</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thank you guys.<br><br>Sorry for the bad formatting. I'm typing this in a phone...<br><br>@why0why: thanks for the recommendation.<br><br>@programmer: yes I'm building a release version.<br><br>I'm not building anything massive ATM but I'd like the game to run in as many devices as possible, so I'd like it to be as efficient as possible.<br><br>Is it possible to have a wrapper for native box 2d in monkey? (Or perhaps chipmunk). <br><br></td></tr></table><br>
<a name="2092106"></a>

<a name="2092107"></a>

<a name="2092108"></a>

<a name="2092110"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> I did a quick test of Box2D via Haxe using the Android NDK build earlier in the year and it was actually slower than the Monkey Java output. Joshua Granick puts it down to their version of Box2D being poorly optimised so maybe it has or will improve. Last time I tested performance on LibGDX it had &lt;20% speed improvement over the Monkey output on Android. As with everything your mileage will vary depending on your particular use case and the version of Android/hardware you're running on.<br><br>As you haven't provided your test case I can't say what's going on with your memory usage/crashing. It's fair to say that 600-1200 dynamic boxes is a lot for most Android devices to handle though. Perhaps you should try your test case in LibGDX and see how that goes for you before planning a project that needs that sort of scenario. The domino stack test only involves a couple of hundred blocks and LibGDX can only manage around 13 simulation frames (no rendering) per second on my, admittedly old and weedy, Android phone. <br><br><br><div class="quote"> Is it possible to have a wrapper for native box 2d in monkey? <br></div><br><br>Sure, let us know how you get on writing it. :)<br><br><br><div class="quote"> Monkey's version of box2d is a "naive" (read: mostly machine-converted) port <br></div><br><br>While about 90% of the initial code was produced by automated conversion this description is quite off the mark. It's certainly inaccurate when discussing Android performance where significant effort has been made to optimise for that platform's particular issues. <br><br></td></tr></table><br>
<a name="2092230"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Szabo</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> @muddy_shoes: thank you. I know box2d sucks for haxe, that's why I mentioned nape because it seems to be way better than the other options and comes closer to native box 2d performance.  Libdgx is practically the same as native performance, at least on desktop. I don't know how it performs on mobile. Besides the advantage of speed, libgdx also has 3d and uses java which is somewhat valuable knowledge.<br><br>I still didn't decide though... In fact I'm noticing that even for simpler 2d games, these options can't really be compared to unity... I'd like something higher-level, I mean, a fully featured engine with a solid workflow including appropriate graphical tools for the different tasks. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
