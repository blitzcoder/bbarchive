<!DOCTYPE html><html lang="en" ><head ><title >SQL handle overflow</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >SQL handle overflow</h1><a href="forums.php" >Community Forums</a>/<a href="topics.php?forum=206" >Common Room</a>/<a href="#bottom" >SQL handle overflow</a><br><br>
<a name="1342211"></a>

<a name="1342212"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> One of the reasons original search was suspended was because I thought it may be responsible for the dreaded sql no handle site outage we suffer here occasionally.<br><br>But alas, it happened again this morning so it wasn't search, or not on this site anyways.<br><br>Maybe we just tick over some limit. The site got backed up to a secure location instead of reading the forums, so yeh. productivity gain there.... <br><br></td></tr></table><br>
<a name="1342221"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> For me this site's been slow for the last few days, even now.  Seems to not load whole forum threads most of the time and I have to hit refresh two or three times before it loads the entire page.<br><br>Is it related? Anyone else getting this? <br><br></td></tr></table><br>
<a name="1342258"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Site loads "complete" here without issues.<br><br>Only starting page might be a bit slowe for you as it includes external media (and their connections might be problematic to your destination).<br><br><br>@ SQL<br>you might monitor MySQL stats. They will show you open connections and the likes. According to the server setup connections might not be dropped fast enough stacking up to such "error outs".<br>More likely it is a script not doing what it should - or a script called externally (by bots, bad users, external services checking for updates...).<br><br>If you have access to the apache logs, you might also have a look in analyzing them with awstats (could be done locally then) and then check how visitors / page impressions increased (or not) before the outage.<br><br><br>Another potential source:<br>in your scripts you open up the DB connection ... then do something (eg. fetching information) and finally you close the DB connection.<br>BUT if your script "excepts out" then the connection will stay open (at least for a while).<br><br>With "Mysql workbench" or the mysql-command-line you could query this:<br>show variables like "max_connections";<br><br>it will show the value of "max_connections" which might be "100". This means the most concurrent value of connections to mysql is "100". There is also a "user limit".<br><br>But there is one interesting question left: this error should only come "from time to time" (in the moment of too many people trying to access something which connects to MySQL).<br>But for blitzmax.com (and your other domains) this error will stay for hours - I assume until you restart the server/services.<br>If that really needs a restart, then something is keeping the connection alive (or the server is thinking it needs to be kept alive). It is like a funnel which is "full". Normally the funnel should get empty after a certain time but in this case either there is still water coming down filling the water (incoming page requests or so) or the funnel is blocked somehow (server keeps connections alive).<br><br><br>Maybe this is of help too:<br><a href="https://dev.mysql.com/doc/refman/5.7/en/server-status-variables.html" target="_blank">https://dev.mysql.com/doc/refman/5.7/en/server-status-variables.html</a><br><br><br><br>Further thinking: I assume the server still uses PHP 5 and no PDO but raw "mysql_connect".<br>If you have access to monkey-x-page-sources (and blitzmax.com-sources) then have a look if some scripts contain<br>"mysql_<b>p</b>connect" rather than "mysql_connect". The P stands for "persistent", which means "keep connection for user open even if the script finished"<br><br><br>Also check the disk space of the mysql server ... if it is running out of space then the error will happen too.<br><br><br>While looking for options like .htaccess "php_value mysql.connect_timeout 10" (to lower timeout values - to free connections earlier) I found users using "mysqltuner" which reports potential improvements to mysql settings and/or the tables.<br><br><br>While you removed "search" from blitzmax.com I am not sure whether "monkey-x" is running on the same host. As "monkey-x.com" was "down" during the same time, I assume it is. This means disabling the search here does not bring efforts if the search was enabled on the other websites using the same MySQL installation.<br><br><br><br>Ok, conclusion:<br>- find out if there were higher page impressions before the outage started<br>- find out if there were certain pages (not-that-common ones!) called right before<br>- check if "mysql_pconnect" is used - and replace that with "mysql_connect" then (I assume you are not really needing persistent connections)<br>- if the server was not running on its limits then configure mysql to allow more simultaneous connections (especially if you are always running it near the current limit)<br>- decrease timeout values so obsolete connections get closed earlier<br>optional:<br>- if mysqltuner (or raw commands given) state huge "slow queries" counts, then there might be time to optimize them<br>- "optimize tables" if you have big tables with many adjustments/updates done - so accesses will be faster<br><br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1342261"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm all for the "not properly closing connections you've opened" line of inquiries.<br>Perhaps there's some code that gets "stuck" for some reason, and hence never closes its resources.<br><br>Good luck :-) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
