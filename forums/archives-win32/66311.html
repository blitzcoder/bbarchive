<!DOCTYPE html><html lang="en" ><head ><title >Getting location of My Documents folder</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Getting location of My Documents folder</h1><a href="forums.php" >Archives Forums</a>/<a href="topics.php?forum=108" >Win32 Discussion</a>/<a href="#bottom" >Getting location of My Documents folder</a><br><br>
<a name="741015"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JazzieB</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Normally I would throw all my game data into the games directory under Program Files, but thanks to Vista and it's UAC I now have to think about storing any files that will be modifled elsewhere.<br><br>What I'm currently doing is retrieving the shared applications data folder using the getenv_ command.  However, I want to fall-back to the user's own My Documents folder if this fails (plus I need it for user designed levels and such like).  So, the question is... How do I get the physical location of the My Documents folder?<br><br>I can't simply use HOMEDRIVE and HOMEPATH, because these point to the folder held under Documents and Settings for the current user, but not the My Documents folder.  I can't simply add /My Documents/ on the end as this wouldn't work for those that have moved the location of this folder (like me), plus it's not actually called that in a lot of countries.<br><br>I've tried Googling, but can't find anything useful at the moment.  Any ideas?  I'm using BlitzMax. <br><br></td></tr></table><br>
<a name="741131"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xlsior</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I poked around for a moment, and found the following in the windows registry:<br><br>HKEY_current_User\Software\Microsoft\Windows\CurrentVersion\Explorer\Shell folders<br><br>That locations has the links to all the 'special' folders, including 'My Documents'.<br><br>You can find some code to access the windows registry here: <a href="http://www.blitzforum.de/forum/viewtopic.php?t=15521" target="_blank">http://www.blitzforum.de/forum/viewtopic.php?t=15521</a><br><br>There's probably also a windows API call that returns the location of these folders, but I have no idea which one of how to use it. :-? <br><br></td></tr></table><br>
<a name="741157"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> deleted. Sorry not relevent <br><br></td></tr></table><br>
<a name="741207"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> There's a Max module called "Volumes" (<a href="http://www.brucey.net/programming/blitz/" target="_blank">available here</a>) which has a cross-platform function called <b>GetUserDocumentsDir</b> which may be of use.<br><br>The module is also available via syncmods (see my sig below for more details)<br><br>It uses system APIs to get the information, rather than hacking the registry (which is fine if you like that kind of thing). <br><br></td></tr></table><br>
<a name="741330"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JazzieB</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks guys.  I'll give them a whirl and see what happens. <br><br></td></tr></table><br>
<a name="741504"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xlsior</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Brucey -- Just checked out your module. Pretty nice one, definitely saving a copy. <br><br></td></tr></table><br>
<a name="752662"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >WendellM</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I just made a pass through four OSes using Brucey's module (which looks quite handy), checking out GetUserDocumentsDir().  It seems to work fine on XP Pro SP2 and MacOS 10.3.9.  <br><br>However, in Ubuntu 6.06, I found that GetUserDocumentsDir() returned (IIRC) "home/wendellm/Documents" which seems reasonable except that the "Documents" folder doesn't exist.  Trying the Windows version in Win 98 SE causes an error about linking to Shell32.dll.  So, just a potential heads-up about using it with these two environments.<br><br>UPDATE: I tried the approach below (based on <a href="http://blitzbasic.com/Community/posts.php?topic=45722" target="_blank">http://blitzbasic.com/Community/posts.php?topic=45722</a> ) and it works in 98 SE:<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">'WinApi Commands
Extern "Win32"
Function SHGetSpecialFolderLocation(hwndOwner, nFolder, pIdl:Byte  Ptr)
Function SHGetPathFromIDList( pidList ,lpBuffer:Byte  Ptr)
End Extern


Const CSIDL_DESKTOP                 = $0000  ' &lt;desktop&gt;
Const CSIDL_INTERNET                = $0001  ' Internet Explorer (icon on desktop)
Const CSIDL_PROGRAMS                = $0002  ' Start Menu\Programs
Const CSIDL_CONTROLS                = $0003  ' My Computer\Control Panel
Const CSIDL_PRINTERS                = $0004  ' My Computer\Printers
Const CSIDL_PERSONAL                = $0005  ' My Documents
Const CSIDL_FAVORITES               = $0006  ' &lt;user name&gt;\Favorites
Const CSIDL_STARTUP                 = $0007  ' Start Menu\Programs\Startup
Const CSIDL_RECENT                  = $0008  ' &lt;user name&gt;\Recent
Const CSIDL_SENDTO                  = $0009  ' &lt;user name&gt;\SendTo
Const CSIDL_BITBUCKET               = $000a  ' &lt;desktop&gt;\Recycle Bin
Const CSIDL_STARTMENU               = $000b  ' &lt;user name&gt;\Start Menu
Const CSIDL_MYDOCUMENTS             = $000c  ' logical "My Documents" desktop icon
Const CSIDL_MYMUSIC                 = $000d  ' "My Music" folder
Const CSIDL_MYVIDEO                 = $000e  ' "My Videos" folder
Const CSIDL_DESKTOPDIRECTORY        = $0010  ' &lt;user name&gt;\Desktop
Const CSIDL_DRIVES                  = $0011  ' My Computer
Const CSIDL_NETWORK                 = $0012  ' Network Neighborhood
Const CSIDL_NETHOOD                 = $0013  ' &lt;user name&gt;\nethood
Const CSIDL_FONTS                   = $0014  ' windows\fonts
Const CSIDL_TEMPLATES               = $0015
Const CSIDL_COMMON_STARTMENU        = $0016  ' All Users\Start Menu
Const CSIDL_COMMON_PROGRAMS         = $0017  ' All Users\Programs
Const CSIDL_COMMON_STARTUP          = $0018  ' All Users\Startup
Const CSIDL_COMMON_DESKTOPDIRECTORY = $0019  ' All Users\Desktop
Const CSIDL_APPDATA                 = $001a  ' &lt;user name&gt;\Application Data
Const CSIDL_PRINTHOOD               = $001b  ' &lt;user name&gt;\PrintHood
Const CSIDL_LOCAL_APPDATA           = $001c  ' &lt;user name&gt;\Local Settings\Application Data (non roaming)
Const CSIDL_ALTSTARTUP              = $001d  ' non localized startup
Const CSIDL_COMMON_ALTSTARTUP       = $001e  ' non localized common startup
Const CSIDL_COMMON_FAVORITES        = $001f
Const CSIDL_INTERNET_CACHE          = $0020
Const CSIDL_COOKIES                 = $0021
Const CSIDL_HISTORY                 = $0022
Const CSIDL_COMMON_APPDATA          = $0023  ' All Users\Application Data
Const CSIDL_WINDOWS                 = $0024  ' GetWindowsDirectory()
Const CSIDL_SYSTEM                  = $0025  ' GetSystemDirectory()
Const CSIDL_PROGRAM_FILES           = $0026  ' C:\Program Files
Const CSIDL_MYPICTURES              = $0027  ' C:\Program Files\My Pictures
Const CSIDL_PROFILE                 = $0028  ' USERPROFILE
Const CSIDL_SYSTEMX86               = $0029  ' x86 system directory on RISC
Const CSIDL_PROGRAM_FILESX86        = $002a  ' x86 C:\Program Files on RISC
Const CSIDL_PROGRAM_FILES_COMMON    = $002b  ' C:\Program Files\Common
Const CSIDL_PROGRAM_FILES_COMMONX86 = $002c  ' x86 Program Files\Common on RISC
Const CSIDL_COMMON_TEMPLATES        = $002d  ' All Users\Templates
Const CSIDL_COMMON_DOCUMENTS        = $002e  ' All Users\Documents
Const CSIDL_COMMON_ADMINTOOLS       = $002f  ' All Users\Start Menu\Programs\Administrative Tools
Const CSIDL_ADMINTOOLS              = $0030  ' &lt;user name&gt;\Start Menu\Programs\Administrative Tools
Const CSIDL_CONNECTIONS             = $0031  ' Network and Dial-up Connections
Const CSIDL_COMMON_MUSIC            = $0035  ' All Users\My Music
Const CSIDL_COMMON_PICTURES         = $0036  ' All Users\My Pictures
Const CSIDL_COMMON_VIDEO            = $0037  ' All Users\My Video
Const CSIDL_RESOURCES               = $0038  ' Resource Direcotry


Function GetSpecialFolder:String(folder_id) 
		
Local  idl:TBank = CreateBank (8) 
Local  pathbank:TBank = CreateBank (260) 
Local n%
Local sp$

	If SHGetSpecialFolderLocation(0,folder_id,BankBuf(idl)) = 0		
		SHGetPathFromIDList PeekInt( idl,0), BankBuf(pathbank)
		
		For n= 0 To 259
			sp$ = sp$ + Chr(PeekByte(pathbank,n))
		Next
	EndIf
	Return Trim(sp$) + "\"
		
End Function



Print GetSpecialFolder(CSIDL_PROGRAMS)
Print GetSpecialFolder(CSIDL_PERSONAL)
Print GetSpecialFolder(CSIDL_DESKTOP)

Input
</textarea> <br><br></td></tr></table><br>
<a name="752847"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SebHoll</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Trying the Windows version in Win 98 SE causes an error about linking to Shell32.dll. So, just a potential heads-up about using it with these two environments.<br> <br></div><br><br>This is interesting... I don't have a Window 98 box anymore but I think the problem is that Windows 98 (and 95's) DLL was just called Shell.dll though I may be wrong.<br><br>If this is the case, I'm not sure how you'd tell the BlitzCompiler to load from Shell.dll on Windows 98 machines and Shell32.dll on Windows XP. :S <br><br></td></tr></table><br>
<a name="753574"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JazzieB</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Seems to work just fine in Vista.  One thing to watch out for...  I have My Documents pointing to my second hard drive, and not a folder on there, and it adds a second '\' to the path returned, i.e. I got 'C:\\'.  (Please don't ask why my second hard drive is C, long story!). <br><br></td></tr></table><br>
<a name="753649"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >WendellM</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> If it's the code that I posted above which is having a problem with "My Documents" being the root of C:, perhaps replacing <pre class=code>Return Trim(sp$) + "\"</pre> with<br><pre class=code>sp = Trim(sp)
If sp[sp.length - 1] &lt;&gt; Asc("\") Then sp :+ "\"
Return sp</pre>will do the trick? <br><br></td></tr></table><br>
<a name="753765"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xlsior</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> there's another problem in there somewhere.<br><br>when I run it on my PC, I get the following results:<br><br><div class="quote"> <br>C:\Documents and Settings\Administrator\Start Menu\Programs\<br>C:\Documents and Settings\Administrator\My Documents\<br>C:\Documents and Settings\Administrator\Desktopettings\Administrator\Start Menu\Programs\<br> <br></div><br><br><br>As you can see, the "Desktop" location has an additional (incorrect) 'ettings\Administrator\Start Menu\Programs\' appended to the end of it. Perhaps there's some old data in the bank that's not getting zeroed out? <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
