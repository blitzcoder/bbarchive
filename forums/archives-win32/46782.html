<!DOCTYPE html><html lang="en" ><head ><title >"User lib not found" -- WinXP vs. Win98</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >"User lib not found" -- WinXP vs. Win98</h1><a href="forums.php" >Archives Forums</a>/<a href="topics.php?forum=108" >Win32 Discussion</a>/<a href="#bottom" >"User lib not found" -- WinXP vs. Win98</a><br><br>
<a name="520428"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >soja</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm got a conundrum here.  Here's my situation.  I have:<br><br>a) a small and simple DLL that I wrote in Visual C++ .NET (linking to standard libs, no MFC or ATL)<br>b) a test program that I wrote in BlitzPlus<br><br>When I run the test program (with the DLL in the same folder), it works perfectly.  The problem?  If I then copy the exact same executable and DLL to a Win98 box, it fails with "User lib not found" as soon as the program tries to call one of the functions in my DLL.  What gives?<br><br>Before I try fiddling with linker settings, pragma directives, and different C compilers, I thought I try here.  Questions:<br><br>1) What does Blitz do when an external function is called.  LoadLibrary?  What else?<br>2) What would be the difference between the Win98 and WinXP environments that would cause it to work in one and not the other?  Remember, the executables are identical.<br><br>If any more info is needed (declarations, def file, linker options, etc), I'll be glad to provide.  Thanks for any input. <br><br></td></tr></table><br>
<a name="520443"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Perturbatio</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> does the 98 machine have .net installed? <br><br></td></tr></table><br>
<a name="520447"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >soja</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> No.  However, I don't think that's it, because I'm not using anything in .NET (at least that I know of (??))...<br><br>I actually used the New Project wizard to create a "Visual C++ Project -&gt; General -&gt; Extended Stored Procedure DLL", and then just modified that.  Nothing fancy (i.e. .NET, ATL, MFC, etc).<br><br>I've had similar issues, though, ("user lib not found") even when using other compilers, link ming (I think) via Bloodshed, so it really makes me wonder what's going on under the hood. <br><br></td></tr></table><br>
<a name="520504"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Azathoth</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Are you linking with MSVCR71.DLL with the /MD option? If so does the Win98 have it? <br><br></td></tr></table><br>
<a name="520663"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >soja</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, I am compiling with the /MD option, and YES, it needed msvcr71.dll!  Thank you very much!<br><br>In retrospect, I suppose I should have looked at the import table for my DLL.  It needs kernel32.dll, user32.dll, and... msvcr71.dll.  I just thought the "user lib not found" error was for the functions in _my_ DLL, which was thoroughly confusing.<br><br>More info from MSDN:<br><div class="quote"> Applications compiled with [the /MD] option are statically linked to MSVCRT.lib. This library provides a layer of code that allows the linker to resolve external references. The actual working code is contained in MSVCR71.DLL, which must be available at run time to applications linked with MSVCRT.lib. <br></div><br>...and...<br><div class="quote"> An application should use and redistribute msvcr71.dll, and it should avoid placing a copy or using an existing copy of msvcr71.dll in the system directory. Instead, the application should keep a copy of msvcr71.dll in its application directory with the program executable. Any application built with Visual C++ .NET using the /MD switch will necessarily use msvcr71.dll. <br></div><br><br>Incidentally, can you suggest any other options I might have besides using msvcr71.dll?  I'm trying to make (a) the smallest DLL with (b) the most compatibility that I can.  I imagine I could try out older and/or different compilers with different C libraries, but I'd value an experienced opinion at the moment.<br><br>Thanks again. <br><br></td></tr></table><br>
<a name="520700"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Azathoth</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can statically link with /ML for single-threaded or /MT for multi-threaded, your DLL will be bigger since it contains some msvcr71.dll code but you won't need to copy msvcr71.dll to machines that don't have it. There are also problems if the program running your DLL also links to msvcr71.dll. <br><br></td></tr></table><br>
<a name="520704"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >soja</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, actually, I did try that, and noticed that it imported a bunch more functions from kernel32 instead, and was slightly bigger.  Unfortunately, when I tried it, I got "user lib not found" again.  &lt;shrug&gt;  Wondering if it used some functions that weren't in the Win98 version of kernel32, I copied the kernel32.dll over from my XP box, but it didn't make any difference either. <br><br></td></tr></table><br>
<a name="520843"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Azathoth</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Um. Have you written a DllMain function? Does it at all get called before you get the error message? <br><br></td></tr></table><br>
<a name="520846"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sarge</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi the only tips i can give are the following<br><br>1: Try the dll in another programming language see if it works<br><br>2: Post the dll here so we can test it <br><br></td></tr></table><br>
<a name="520915"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >soja</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> aeiou, yes, I have written a DLLMain function.  (Even if I didn't though, the linker would have put a stub in.)  I'm not sure if it gets called before I get the error message -- I suppose I can put some debug code in there and test that.  Good idea.<br><br>Sarge, good ideas too.<br><br>If all else fails, it can still be distributed with msvcr71.dll and it should work, but I appreciate your input all the same. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
