<!DOCTYPE html><html lang="en" ><head ><title >error on load Escapi.dll on BitzmaxNG (64 build)</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >error on load Escapi.dll on BitzmaxNG (64 build)</h1><a href="forums.php" >Archives Forums</a>/<a href="topics.php?forum=108" >Win32 Discussion</a>/<a href="#bottom" >error on load Escapi.dll on BitzmaxNG (64 build)</a><br><br>
<a name="1279945"></a>

<a name="1279946"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Fielder</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> On 32 stock build everything works fine, but on the 64 build the DLL can't be loaded... this is because the DLL is not 64 ?<br><br><pre class=code>
Function SetupESCAPI ()

	esc = LoadLibraryA ("escapi.dll")
</pre><br><br>other infos about escapi and blitmax examples: <br><br><a href="http://sol.gfxile.net/escapi/index.html" target="_blank">http://sol.gfxile.net/escapi/index.html</a><br><br>and the example was made by James Boyd (i dont't know if he is a register blitzmax forum member) <br><br></td></tr></table><br>
<a name="1279947"></a>

<a name="1279948"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Fielder</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> sorry.. double post :( <br><br></td></tr></table><br>
<a name="1279954"></a>

<a name="1279955"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can't load 32-bit DLLs into a 64-bit app. You will need a 64-bit version of the DLL.<br><br>You could always email the author of the DLL and see if he can build you one. (Or ask for the source, which he may give you, according to the comment at the bottom of the page, then you can build it yourself).<br><br><br>You'll get answers to NG related issue more quickly if you post in either <b><a href="/topics.php?forum=124" target="_blank">Brucey's Modules</a></b> or raise an issue on github. <br><br></td></tr></table><br>
<a name="1280012"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RustyKristi</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> The author quoted on site and readme :<br><br><div class="quote"> <br>..I'd rather not give out the source code, but it is available if you have a very good reason (and some people have had such)<br><br>..Sources are available upon request. They are somewhat hackish, so I <br>don't feel like publishing them.<br> <br></div><br><br>Looks like this is a very good reason, or like Brucey said request for the 64bit DLL! :D <br><br></td></tr></table><br>
<a name="1280869"></a>

<a name="1280874"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Fielder</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> i've contacted the autor (Jari Komppa) requesting some new features ... and he released the new Escapi 3.. <a href="http://iki.fi/sol/zip/escapi3.zip" target="_blank">http://iki.fi/sol/zip/escapi3.zip</a><br><br>now i've to request a 64 bit version :)<br><br>from the autor:<br><br>// I'm kinda rewriting escapi from scratch using windows media<br>   foundation APIs, which means that the new version will require windows<br>    7 (possibly vista), but there'll be some nice enchancements. //<br><br>EDIT: there is the 64 Bit build :)<br>but something is changed... and the Escapi can't be used as the oll Escapi 2 on Blitzmaz<br><br>now i have the EXCEPTION_ACCESS_VIOLATION on:<br><br><pre class=code>
				If OpenCaptureDevice (1, scp1) = 0
					'Print "Failed to initialise capture device! 1"
</pre><br>when trying to open an inexistent camera (number 2)<br><br>and opening just the 1 i have i receive a black image <br><br></td></tr></table><br>
<a name="1280983"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Fielder</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> contacted "Drugged Bunny" that made the Escapi 2.1 examples for blitzmax.. maybe on next days we can have an update with Escapi 3 <br><br></td></tr></table><br>
<a name="1282949"></a>

<a name="1282950"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Fielder</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> <pre class=code>
Function SetupESCAPI ()

	esc = LoadLibraryA ("escapi.dll")
	
	If esc
		InitCOM					= GetProcAddress (esc, "setupESCAPI")
</pre><br><br>InitCOM is NULL... and i can't get working the escapi3 DLL... :(<br><br>this is the API description from author:<br><br><pre class=code>
struct SimpleCapParams
{
  /* Target buffer. 
   * Must be at least mWidth * mHeight * sizeof(int) of size! 
   */
  int * mTargetBuf;
  /* Buffer width */
  int mWidth;
  /* Buffer height */
  int mHeight;
};


/* Sets up the ESCAPI DLL and the function pointers below. Call this first! */
/* Returns number of capture devices found (same as countCaptureDevices, below) */
int setupESCAPI();

/* return the number of capture devices found */
int countCaptureDevices();

/* initCapture tries to open the video capture device. 
 * Returns 0 on failure, 1 on success. 
 * Note: Capture parameter values must not change while capture device
 *       is in use (i.e. between initCapture and deinitCapture).
 *       Do *not* free the target buffer, or change its pointer!
 */
int initCapture(unsigned int deviceno, struct SimpleCapParams *aParams);

/* deinitCapture closes the video capture device. */
void deinitCapture(unsigned int deviceno);

/* doCapture requests video frame to be captured. */
void doCapture(unsigned int deviceno);

/* isCaptureDone returns 1 when the requested frame has been captured.*/
int isCaptureDone(unsigned int deviceno);

/* Get the user-friendly name of a capture device. */
void getCaptureDeviceName(unsigned int deviceno, char *namebuffer, int bufferlength);

/* Returns the ESCAPI DLL version. 0x200 for 2.0 and later (for legacy support)*/
int ESCAPIDLLVersion();

/* Returns the ESCAPI version. 0x300 for 3.0.
   When checking the version, accept higher versions too. */
int ESCAPIVersionProc();

/* 
  On properties -
  - Not all cameras support properties at all.
  - Not all properties can be set to auto.
  - Not all cameras support all properties.
  - Messing around with camera properties may lead to weird results, so YMMV.
*/

/* Gets value (0..1) of a camera property (see CAPTURE_PROPERTIES, above) */
float getCapturePropertyValueProc(unsigned int deviceno, int prop);
/* Gets whether the property is set to automatic (see CAPTURE_PROPERTIES, above) */
int getCapturePropertyAutoProc(unsigned int deviceno, int prop);
/* Set camera property to a value (0..1) and whether it should be set to auto. */
int setCapturePropertyProc(unsigned int deviceno, int prop, float value, int autoval);

/*
  All error situations in ESCAPI are considered catastrophic. If such should
  occur, the following functions can be used to check which line reported the
  error, and what the HRESULT of the error was. These may help figure out
  what the problem is.
*/

/* Return line number of error, or 0 if no catastrophic error has occurred. */
int getCaptureErrorLineProc(unsigned int deviceno);
/* Return HRESULT of the catastrophic error, or 0 if none. */
int getCaptureErrorCodeProc(unsigned int deviceno);
</pre> <br><br></td></tr></table><br>
<a name="1282951"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I can have a look later, if you want. <br><br></td></tr></table><br>
<a name="1283014"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Fielder</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> maybe Brucey , your are a Blitz-coding-monster , help from you is the best thing i can receive !<br><br>(thnak you!!!) <br><br></td></tr></table><br>
<a name="1290036"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've added bah.escapi to bah mods.<br>It works on x86 and x64. (tested in Parallels VM on Mac with Windows 7).<br><br><br><br>... I also have a registry module under review... <br><br></td></tr></table><br>
<a name="1290040"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Fielder</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> WOW THX BRUCEY!, i WILL TRY RIGHT NOW! <br><br></td></tr></table><br>
<a name="1290164"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Fielder</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's working!, can you make a working 2 cameras example? <br><br></td></tr></table><br>
<a name="1290171"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> You should just be able to create another instance of TEscapi and call Open(), Capture(), Close() etc with the different device number (eg. 0 for first camera, 1 for other camera).<br><br>And don't use DrawPixmap in your code... it's very slow. <br><br></td></tr></table><br>
<a name="1290281"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Fielder</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> ok thank you Brucey! <br><br></td></tr></table><br>
<a name="1290365"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xlsior</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Very nice, works compiled as x86 as well as x64 for me with NG. <br><br></td></tr></table><br>
<a name="1290699"></a>

<a name="1290701"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Fielder</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> 2 cameras can be used without 2nd istance...<br><pre class=code>
SuperStrict

Framework bah.escapi
Import brl.standardio
Import brl.pixmap
Import brl.glmax2d

Local escapi:TEscapi = New TEscapi.Create()

If Not escapi Print "Could not load escapi" ;End

Local deviceCount:Int = escapi.Count()
Print "Devices = " + deviceCount

If deviceCount = 0 Print "No devices found :-(" ;End

Local width:Int = 512
Local height:Int = 512

Local pix:TPixmap = CreatePixmap(width, height, PF_BGRA8888)

escapi.SetBuffer(pix.pixels)
escapi.SetWidth(width)
escapi.SetHeight(height)

Print "Opened device0 : " + escapi.DeviceName(0)

Graphics 1024, 512, 0

While Not KeyDown(KEY_ESCAPE)

Cls

escapi.Open(0) 
escapi.Capture(0)
Delay(500)
DrawPixmap pix, 0,0
escapi.Open(1) 
escapi.Capture(1)
Delay(500)
DrawPixmap pix,512,0

Flip

Wend

escapi.Close(0)
</pre><br>but sometimes it trows an exception violation....<br><br>anyone can post a minimal code to use the 2 istance? <br><br></td></tr></table><br>
<a name="1290704"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Your usage seems a bit strange.<br><br>Generally you would "Open" the device once, then "Capture" many times until you are finished using the device, then "Close" it.<br><br>You'd probably need to examine the source for the library to see the implications of continually opening the device - in a worst case it might leak memory or some such.<br><br>You should use "IsCaptureDone" to determine if it is finished capturing data into your pixmap buffer.<br>I don't know what the implications are if your capture isn't finished and you then call Open on the other device and start to capture from that one. <br><br>And don't use DrawPixmap in your production code. Really :-) <br><br></td></tr></table><br>
<a name="1291107"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Fielder</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> i don't see this drawpixmap issue... i tried 4 cams with drawpixmap.. but seems ok... (i delayed everything by a delay(100) to reduce CPU usage) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
