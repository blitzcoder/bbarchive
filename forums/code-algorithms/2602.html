<!DOCTYPE html><html lang="en" ><head ><title >Safer Millisecs() Interval</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='Obtains time intervals even over the 'Integer-Limit rollover', language=bb, category=Algorithms'><meta name='author' content='_PJ_'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 ><a href=codearcs.php>Code archives</a>/<a href=codearcs.php?cat=6>Algorithms</a>/Safer Millisecs() Interval</h1><div class="quote">This code has been declared by its author to be Public Domain code.</div><br><a href="2602.bb">Download source code</a><br><br><table width="100%" cellspacing="0" cellpadding="0"><tr ><td width="100%"><table width=100% cellspacing=0 cellpadding=0><tr ><td class=headleft></td><td class=head><table width=100% cellspacing=0 cellpadding=0><tr ><td >Safer Millisecs() Interval by _PJ_</td><td align="right">2009 </td></tr></table></td><td class=headright></td></tr></table></td></tr><tr ><td class="cell"> I'm suprised this couldn't be found in the archives already. Sure it's only tiny but there's been a few posts here and there about it, so I thought I'd jot it down.<br><br>Basically, there's an upper limit to Blitz' apacity for integers. This value is ((2^31)-1) or 2147483647.<br>With the Millisecs() function, when the internal timer reaches this amount (After just under 25 days!) then  it rolls-over but not to 0, instead it flips to 0-2147483647 and continues counting numerically UPWARDS to 0.<br>This can cause a lot of issues when certain timing checks rely on the difference between the current count and a previous stored value when the interval overlaps this rollover. </td></tr><tr ><td class="cell"><pre class="code">While Not KeyDown(1)
	If (KeyHit(57))
		Print Str(ElapsedSince%(nLast%))
		nLast%=MilliSecs()
	End If
Wend

Function ElapsedSince%(nLast%)
	FlushKeys()
	Local nMilli%=MilliSecs()
	Local nReturn%
	
	If ((Sgn(nLast%))&lt;&gt;(Sgn(nMilli)))
		nReturn=Abs(nLast)+Abs(nMilli)
	Else
		nReturn=nMilli-nLast%
	End If
	Return Abs(nReturn%)
End Function</pre></td></tr></table><br><a name="comments">Comments</a><br><br><table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Floyd</td><td align="right"><font class=tiny>2009</font></td></tr></table></td></tr><tr ><td class="posttext"> Elapsed time from time1 to time2 is simply the difference time2-time1.<br><br>You don't need to do anything else. The possible rollover to negative is irrelevant. <br><br></td></tr></table><br><table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>2009</font></td></tr></table></td></tr><tr ><td class="posttext"> I disagree.<br>In rare infrequent situations with large durations where T2&lt;T1 and (T2&gt;0), that T2-T1 becomes negative: A negative time interval.<br>Many programs break for this reason. <br><br></td></tr></table><br><table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Floyd</td><td align="right"><font class=tiny>2009</font></td></tr></table></td></tr><tr ><td class="posttext"> A negative elapsed time means the interval is at least 2^31 milliseconds. A signed integer can't hold such a value so there would be no way to return the correct elapsed time.<br><br>The situation people usually think will cause trouble is when time1 is a large positive number and a later time2 has rolled over to a negative number. But the difference time2-time1 is still positive.<br><br>I am saying that, for example, if you assign any value to t1, then set t2=t1+50 then t2-t1 will be 50. It does not matter if t2 is positive and t1 is negative. Try it. <br><br></td></tr></table><br><table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>2009</font></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> (Posted 7 minutes ago) <br>A negative elapsed time means the interval is at least 2^31 milliseconds. A signed integer can't hold such a value so there would be no way to return the correct elapsed time. <br> <br></div><br><br>Exactly, causing potential problems which ARE relevant.<br><br><div class="quote"> The situation people usually think will cause trouble is when time1 is a large positive number and a later time2 has rolled over to a negative number. But the difference time2-time1 is still positive.<br><br>I am saying that, for example, if you assign any value to t1, then set t2=t1+50 then t2-t1 will be 50. It does not matter if t2 is positive and t1 is negative. Try it. <br> <br></div><br>I don't need to try it, nor am I concerned with when T1&lt;T2 since that is always the case in the REAL world. the first check is always PRIOR to the second.<br><br>However, as I stated, it is possible to have (T2&lt;T1) and (T2&gt;0) resulting in a negative duration. multiple of rollovers this is possible<br><br>Perhaps ' "Accurate" Millisecs()' is a bad chocie of word for the title, but still my code alleviates any breaking situations with interval millisecs checks if not preserving accurate count overall. <br><br></td></tr></table><br><table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TaskMaster</td><td align="right"><font class=tiny>2009</font></td></tr></table></td></tr><tr ><td class="posttext"> As long as you do your math, where you subtract the later number from the earlier number, then the answer will always be correct.  That way, T2 is never less than T1. <br><br></td></tr></table><br><table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>2009</font></td></tr></table></td></tr><tr ><td class="posttext"> Make the first check. For the sake of argument, let's say it's when Milliseconds returns 1000<br><br>T1= 1000<br><br>Wait for a 4294966296 milliseconds interval until checking again (T2) At this point, the Milliseconds value would have wrapped to negative and counted up to 0 again, then, it continues increasing in positive.<br><br>T2=1<br><br>T2-T1 = (0-999)<br><br>There's the negative duration and the bug I've already mentioned in every post where (T2&lt;T1) and (T2&gt;0)<br><br>I really don't want to explain it again. Just accept that I've provided a solution for those who want it. <br><br></td></tr></table><br><table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Krischan</td><td align="right"><font class=tiny>2009</font></td></tr></table></td></tr><tr ><td class="posttext"> Use this check first to fix negative values<br><br>ms%=MilliSecs()<br>If ms&lt;0 Then ms=ms And $7fffffff <br><br></td></tr></table><br><table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>2009</font></td></tr></table></td></tr><tr ><td class="posttext"> . . .<br><br>That doesn't make the slightest difference.<br><br>I really, really mean this is the last time I will say this:<br><br>The problem doesn't involve negative values at all, only when <br>(T2&lt;T1) and (T2&gt;0) <br><br></td></tr></table><br><table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TaskMaster</td><td align="right"><font class=tiny>2009</font></td></tr></table></td></tr><tr ><td class="posttext"> You are correct.<br><br>In the case that you are comparing two times that you got about 50 days apart, you have solved the problem.  Except...  You do get a positive value, but you do not get the actual difference in time.  The result is going to be some arbitrary time.<br><br>But, I would hope that if you are comparing times that far apart, you would use time/date values rather than just a millisec counter.  You are adding overhead to every millisecs check, just in case you make a check with numbers 50 days apart. <br><br></td></tr></table><br><table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>2009</font></td></tr></table></td></tr><tr ><td class="posttext"> Wow.  An argument in a code archive.<br><br>I'm afraid that Floyd is 99% correct.  He would have been 100% correct if he'd said <b>Abs(Abs(time2)-Abs(time1))</b>.  That way you still get the time difference between time1 and time2.  Its the use of Abs() throughout that makes negative values irrelevant.<br><br>Auf wiedersehen. <br><br></td></tr></table><br><table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TaskMaster</td><td align="right"><font class=tiny>2009</font></td></tr></table></td></tr><tr ><td class="posttext"> ... <br><br></td></tr></table><br><table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >schilcote</td><td align="right"><font class=tiny>2010</font></td></tr></table></td></tr><tr ><td class="posttext"> And remember to practice safe secs(). <br><br></td></tr></table><br><a href="codearcs.php" >Code Archives Forum</a><table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
