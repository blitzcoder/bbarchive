<!DOCTYPE html><html lang="en" ><head ><title >nDrawExts - Portable drawing extensions for Mojo</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >nDrawExts - Portable drawing extensions for Mojo</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=524" >User Modules</a>/<a href="#bottom" >nDrawExts - Portable drawing extensions for Mojo</a><br><br>
<a name="2051415"></a>

<a name="2051416"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nobuyuki</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello,<br><br>nDrawExts is my first attempt at creating a native Monkey module.  It's purpose is to override the SetBlend() function of Mojo in a backwards-compatible way, adding more blending effects to choose from for targets that support them while avoiding the need to hack Mojo to achieve this.  It also adds a few new functions, SetLogicOp() and SetAlphaThreshold(), which allow for even more low-level blending effects.  <b>The project's available for download here:</b><br><br><a href="http://code.google.com/p/ndrawexts/" target="_blank">http://code.google.com/p/ndrawexts/</a><br><br>As of right now, it only supports the glfw target, but I'm sure it could easily support the ios target, and maybe also android too, if the native code can be made to properly reference the surface context on that target.  All of these targets leverage the "state machine" style of OpenGL in one way or another, and should be relatively similar to each other.<br><br>I am not very experienced in gl programming, nor C++, so hopefully this code isn't a big mess.  Anyone wishing to help extend this module is welcome to do so.  Thanks go out to therevills for help acquiring the graphics context on glfw.<br><br>Screenshot:<br><img src="https://s3.amazonaws.com/uploads.hipchat.com/11212/31746/mn03kkf2nwfus5r/mojo_multiply_blend.png"> <br><br></td></tr></table><br>
<a name="2051473"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Beaker</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nice. Looks useful. <br><br></td></tr></table><br>
<a name="2051739"></a>

<a name="2051740"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nobuyuki</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Support for the stencil buffer has been added.  The following screenshot demonstrates the use of the stencil buffer by drawing a checkerboard in the far background where the bubble is located, behind the monkey:<br><br><img src="https://s3.amazonaws.com/uploads.hipchat.com/11212/31746/clb276gmclwsp3n/stencil_mask.png"><br><br>In order to use the stencil buffer, you must manually clear it just like you would the screen, using <b>ClearStencil()</b>, and explicitly enable it where it should be used.  Other than ClearStencil, there are 3 other functions:<br><br><b>EnableStencil()</b> and <b>DisableStencil()</b> signal where the stencil will be applied.  Think of them like block keywords for the stencil drawing routine.  Anything inside these calls will either be drawn to the stencil buffer, or stencilled according to the existing stencil mask.<br><br><b>DrawToStencil(</b><i><b>enabled:Bool</i>)</b> is a switch which is active inside the stenciled part of the render block. To begin drawing to the stencil, call this method with the argument True.  All drawing routines are mapped to the stencil, including DrawImage, which is masked using the current alpha threshold (use SetAlphaThreshold before a stencil pass to set this).  To stop drawing to the stencil, and to draw the objects you want to have stencilled, you must then call this routine again with the argument False before calling any more draw routines.<br><br>Using these in the correct order, it should be able to do multiple render passes, but I haven't tested it like that, so be aware!<br><br>If nothing is drawn to the stencil buffer while the stencil buffer is enabled, nothing will be drawn.  I hope to add a function which inverts the stencil mask so that more effects are possible (like destructible terrain), but for right now, this functionality covers a large majority of the type of effects most people have been wishing they could do in Monkey. <br><br></td></tr></table><br>
<a name="2051761"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shinkiro1</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> That's so cool :)<br>But I think something doesn't work for me. Running the example I can always see the checkered background (unlike in your screen above).<br>Using v66 on OSX 10.8 (in debug and release built).<br><br>All the other blending stuff works perfectly. <br><br></td></tr></table><br>
<a name="2051784"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nobuyuki</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> hmm, that shouldn't happen!  I'm not quite certain what the problem could be....  Can anyone else here confirm this problem on their systems?  I'm running a rather oldish graphics card and maybe I'm not setting the test up correctly when things write to the stencil buffer...<br><br>I am going to try adding a few things to see if it fixes the example.  Are you able to check out from the source tree?  Please check out the latest source (NOT in downloads) and let me know if this fixes your problem?<br><br>If you're unable to check out from the source tree, lemme know and I'll get a build up for you. <br><br></td></tr></table><br>
<a name="2051866"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raz</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> This looks like it will be really useful to me, I look forward to giving it a try! Thanks:) <br><br></td></tr></table><br>
<a name="2051874"></a>

<a name="2051878"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shinkiro1</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Checked out the newest version and it still gives me the same results.<br><br>Edit: Using v69 makes no difference. <br><br></td></tr></table><br>
<a name="2051930"></a>

<a name="2051932"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nobuyuki</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Shinkiro:<br><br>Are you comfortable messing around in the source code?  I asked a friend of mine what the problem might be, and it may have to do with differences in how glfw initializes the graphics context on the different platforms.  We need a pixel format that includes at least a 1-bit stencil buffer, which apparently is happening on Windows, but maybe not happening on OSX for whatever reason.  <br><br>Here's a hack you can try to modify the glfw target, which isn't an ideal solution (and something that this project hoped to avoid), but might work.  Go to your monkey folder and look for targets\glfw\main.cpp.  On line 226, change this:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
if( !glfwOpenWindow( w,h, 0,0,0,0,CFG_OPENGL_DEPTH_BUFFER_ENABLED ? 32 : 0,0,CFG_GLFW_WINDOW_FULLSCREEN ? GLFW_FULLSCREEN : GLFW_WINDOW  ) ){
</textarea><br><br>to<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
if( !glfwOpenWindow( w,h, 0,0,0,0,CFG_OPENGL_DEPTH_BUFFER_ENABLED ? 32 : 0,8,CFG_GLFW_WINDOW_FULLSCREEN ? GLFW_FULLSCREEN : GLFW_WINDOW  ) ){
</textarea><br><br>and recompile a clean build of the example project.<br><br>What this does is it changes the initialized graphics context's stencil buffer's bit depth from 0 (ie:  GLFW looks for a "sane default") to 8 (GLFW attempts to create an 8-bit stencil buffer).  This <i>should</i> work, but I guess some platforms aren't guaranteed to have an 8-bit stencil buffer, or Mark would've set it up differently.  All platforms <i>should</i> have support for a stencil buffer, though, so I wouldn't know why sending the argument 0 wouldn't have set this up to begin with.<br><br>Anyway, let me know if this works for you.  Anyone here using glfw on linux, let me know if the code has problems for you too, and if this hack fixes it! <br><br></td></tr></table><br>
<a name="2051929"></a>

<a name="2058402"></a>

<a name="2058404"></a>

<a name="2058405"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nobuyuki</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> nDrawExts has been updated to support clearing the surface with alpha transparency.  This may not be useful in the obvious sense, but is more for working with ReadPixels().  You can use Cls2(r,g,b,a) to clear the surface in a way that allows ReadPixels to work with alpha values.  <br><br>The matting color of the alpha clear value still counts, unfortunately, so non-solid colors will matte in the direction of the clear color.  I'm sure this can be solved with some sort of alpha pre-multiplication junk, or perhaps I'm just not implementing Cls2 correctly, but anyone with any knowledge on the subject, I'm reaching out to you.  In the meantime, calling Cls2(128,128,128,0) before drawing seems to matte most things reasonably.<br><br>More information on Cls2() here:  <a href="http://www.monkeycoder.co.nz/Community/posts.php?topic=5272" target="_blank">http://www.monkeycoder.co.nz/Community/posts.php?topic=5272</a> <br><br></td></tr></table><br>
<a name="2058451"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raz</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> About 3-4 months ago I considered GLFW to be the weakest of the targets (mainly because of a slow down bug relating to having a joypad plugged in!), but now it's by far the best for me and extensions like this only add to that further :) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
