<!DOCTYPE html><html lang="en" ><head ><title >ImageBuffer Module (render to texture / fbo)</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >ImageBuffer Module (render to texture / fbo)</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=524" >User Modules</a>/<a href="#bottom" >ImageBuffer Module (render to texture / fbo)</a><br><br>
<a name="2060430"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Skn3</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> So I spent a little time on this today. I have managed to get a render to texture module working. On GLFW at least.<br><br><a href="https://github.com/skn3/imagebuffer" target="_blank">https://github.com/skn3/imagebuffer</a><br><br>Enjoy, for free :D<br><a href="https://www.paypal.com/cgi-bin/webscr?cmd=_donations&amp;business=jon%2epittock%40gmail%2ecom&amp;lc=US&amp;item_name=Skn3&amp;no_note=0&amp;currency_code=GBP&amp;bn=PP%2dDonationsBF%3abtn_donate_SM%2egif%3aNonHostedGuest" target="_blank"><img src="http://help.yahoo.com/l/us/yahoo/smallbusiness/webhosting/yss/paypal/media/images/paypal_donate_button.gif"></a><br><br><b>Installation</b><br>It requires one modification to a monkey module:<br>Add...<pre class=code>Method GetSurface:Surface()
    Return surface
End</pre>to the <i>Class Image</i> in <i>modules/mojo/graphics.monkey</i><br><br><br><br>Its highly experimental and currently only supports GLFW. There is a bit of hacking in there to fake monkey into thinking it is rendering. Use at your own risk!<br><br>If you use this in OnRender() remember it will reset monkey graphics states (such as scissor and matrix) upon fbo.Start() and fbo.Finish()<br><br>This is a very rough-around-the-edges-module and I don't know if I will have time to implement for other targets. Would anyone like to contribute to this?<br><br><img src="http://www.skn3.com/junk/imagebuffer/screenshots/imagebufferv01.png"> <br><br></td></tr></table><br>
<a name="2058681"></a>

<a name="2058680"></a>

<a name="2058679"></a>

<a name="2058614"></a>

<a name="2058615"></a>

<a name="2058611"></a>

<a name="2058613"></a>

<a name="2058609"></a>

<a name="2058693"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Skn3</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just adding some more stuff to this, should probably rename it from ImageBuffer...<br><br>Started adding shader support<br><br><img src="http://www.skn3.com/junk/imagebuffer/screenshots/imagebufferv02.png"><br><br>Example syntax:<br><pre class=code>'create shader and shader program
shaderProgram = New ShaderProgram()
shaderFragment = New Shader(FRAGMENT_SHADER)
shaderFragment.SetSource(LoadString("path_here"))
shaderProgram.Attach(shaderFragment)
shaderProgram.Link()

'in render loop
shaderProgram.Start()
DrawImage(image, MouseX(), MouseY())
shaderProgram.Finish()</pre> <br><br></td></tr></table><br>
<a name="2058692"></a>

<a name="2058701"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AdamRedwoods</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> very nice.<br>so for GLFW, you are tapping into the possible extensions while using opengl 1.x? so i don't think this is possible on the other targets with openglES 1, because framebuffers/shaders are not allowed. it's when you enable opengles 2 that you can open this up.... but you can't use mojo in opengles 2.<br><br>if you want to extend mojo to use opengles2, it's not terribly difficult (extend GraphicsDevice and then set it in OnRender() ), and it can be done almost entirely in monkey. <br><br></td></tr></table><br>
<a name="2058730"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Skn3</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hadn't thought about the es limitation. I am simply loading in the extensions if supported by the driver for glfw.<br><br>I'm not sure I have the time to support all platforms. It would be good if somone would like to contribute.<br><br>Do you have an example of enabling 2.0 and mojo? <br><br></td></tr></table><br>
<a name="2058792"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nobuyuki</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> this is pretty darn cool, but as you said, it seems rough around the edges -- I have yet to try it, though!<br><br>I want shaders in monkey sooooo bad.  And access to both the main surface and individual image textures as surfaces, too.  Hoo hoo.  Gotta check this out. <br><br></td></tr></table><br>
<a name="2058928"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImmutableOctet(SKNG)</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey Skn3, I think there's a small typo; "GRAPHICS_CAPABILITY_IMAGE_BUFFERS" was called "GRAPHICS_CAPABILITY_IMAGE_BUFFER" in "example_imagebuffer.monkey". Am I missing something, or was this just a simple typo?<br><br>Anyway, this looks great, and I may just use it for a project of mine. I just wish it had Android/Java support, that would be perfect. <br><br></td></tr></table><br>
<a name="2058946"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Skn3</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey Sonickid,<br><br>Thanks, I fixed the typo.<br><br>Did a little more on this just now, still implementing the shader api so monkey can get/set stuff. Repo has been updated, but the shader stuff is not fully usable yet.<br><br>I will continue on this when I next get some spare time. <br><br></td></tr></table><br>
<a name="2058943"></a>

<a name="2058937"></a>

<a name="2059014"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raz</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey Skn3 : would it be potentially possible to have a blur or bloom shader? :D <br><br></td></tr></table><br>
<a name="2059053"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Skn3</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey Raz, it is probably possible at the moment with a combination of the frame buffers and shaders.<br><br>following something like:<br><a href="http://stackoverflow.com/questions/11282394/what-kind-of-blurs-can-be-implemented-in-pixel-shaders" target="_blank">http://stackoverflow.com/questions/11282394/what-kind-of-blurs-can-be-implemented-in-pixel-shaders</a><br><br>The shaders in the examples were just examples I found on the net, so it would be a good idea to try some existing ones out to see if they work.<br><br>I have still got to implement some more shader functionality so not sure if it would all be possible yet.<br><br>I worked on it a bit last night (the shader stuff) and its now possible to get/set uniforms. So for example in the ripple demo, I am speaking to the shader and modifying the time value, which animates the effect. You can get set ints/floats,vectors(2,3,4),arrays(of other data types) and matrices. These are all done through 2 overloaded methods, instead of the convoluted 1 function per gl call.<br><br>GetUniform(location.. instead of glGetUniform1v34v222(location..<br><br>I will try find some spare time to continue. <br><br></td></tr></table><br>
<a name="2059052"></a>

<a name="2059635"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Skn3</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Havn't had a chance to work any more on this as my graphics card is currently RMA to gigabyte. Boo! Will resume once I get it back. <br><br></td></tr></table><br>
<a name="2059834"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shinkiro1</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> This looks really cool.<br>If it could be made to work with mojo I would be willing to contribute (at least on ios, android and glfw). <br><br></td></tr></table><br>
<a name="2059875"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skape</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is the single thing I've been missing lately. I was debating if I should attempt to work it out myself or not. So... this looks really cool to me too. Thanks for your work. <br><br></td></tr></table><br>
<a name="2059885"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Skn3</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> This works fully with mojo/glfw. Would definitely be looking for help with ios/android bits of it. Perhaps once I get a stable version done for glfw you could do a port after that? <br><br></td></tr></table><br>
<a name="2060723"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Skn3</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> I had a little spare time so I just updated the repo.<br><br>Updated to work with Monkey v71b+<br><br>FBO's are now working on OpenGL 2.0 (previously was using v3.0+ syntax)<br><br>FBO's tested and working on ati x1550 (6 year old graphics card) <br><br></td></tr></table><br>
<a name="2061402"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nobuyuki</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm taking an initial look at the source, and I'm wondering --<br><br>Would it be nontrivial or a good idea to split the shader and FBO code into separate CPP files?  They're both really good features, but the shader stuff alone is taking up over 1000 lines of code, which may complicate porting to ES devices, especially if shaders can't be hacked into ES 1.1 as extensions (I don't actually know for sure!) <br><br></td></tr></table><br>
<a name="2061462"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Skn3</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey Nobu,<br><br>Yeah that would make sense. Next time I have some spare time to work on this I will tidy up teh source and rename the module to something more fitting. <br><br></td></tr></table><br>
<a name="2063387"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Skn3</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> I will probably halt dev of this module for the time being.<br>The new roadmap details sound like it will include this type of functionality, or if not, make it easier to do. There is no point me duplicating work that might be replicated in a few weeks time.<br><br>We shall wait and see!<br><br>For now this will be left as WIP. <br><br></td></tr></table><br>
<a name="2064298"></a>

<a name="2064299"></a>

<a name="2064300"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nobuyuki</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, I certainly hope that this functionality gets included soon, at the very least, FBO access.  I've been pretty much holding off writing a new font module because I've been wanting something like that in OnUpdate and am (mostly) unwilling to force users to bake alpha maps into their fonts just so they can have 'em in a "redraw only on invalidated context" font module.  With the current system, redraws have to be queued for the next render cycle, <i>and</i> require chromakeying or alpha maps to restore alpha because alpha can't be sampled directly with ReadPixels().<br><br>Mark, if you're reading this, consider my personal plea to add this support!  If shaders are trouble, then forget 'em, but I sooo want those texture pixels' data! <br><br></td></tr></table><br>
<a name="2064587"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Skn3</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'll revisit this at some point when I have spare time. Incredibly busy at the moment with paid work.<br><br>Would definitely like to have a reliable solution for FBO on many targets. <br><br></td></tr></table><br>
<a name="2100855"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sicilica</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> Not to necro an old post, but I wanted to post the changes I had to make to make this work for me under v82b, in case it will help anyone else out. I could've created a pull request, but I'm not sure how elegant this solution is.<br><br>It seems that there was an update to String::ToCString() a few versions back to combat memory leaks, and I had to make changes to imagebuffer.glfw.cpp like this:<br><br>Change line 389 and add another line afterwards:<br><pre class=code>
String::CString&lt;GLchar&gt; theRawSource = source.ToCString&lt;GLchar&gt;();
const GLchar *theSource = theRawSource;
</pre><br><br>And comment out line 395, because for some reason the delete leads to a debugassert fail.<br><br>I don't know why that conversion from CString&lt;GLchar&gt; to GLchar* needs to happen on two lines instead of one, but without it I couldn't get any shaders to compile.... <br><br></td></tr></table><br>
<a name="2100856"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImmutableOctet(SKNG)</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Sicilica: <a href="http://www.monkey-x.com/Community/posts.php?topic=7702#99059" target="_blank">There was a discussion about this on the nDrawExts2 thread</a>. SKN3's probably not going to maintain it further. <br><br></td></tr></table><br>
<a name="2100858"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sicilica</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> @ImmutableOctet(SKNG)<br><br>Yeah, I was aware that SKN3 wasn't planning on maintaining this anymore, but as far as I've found there's still isn't much in the way of shader support in Monkey. I actually hadn't seen nDrawExts2, I'll definitely look into that some, cause AFAIK this module doesn't give access to the stencil buffer, which would cover most use cases. I'm new to shader programming stuff, though, really.<br><br>It's interesting that the thread you pointed to made almost the exact changes I did! I remember changing that header now, it was such a simple change I'd forgotten it. I think the delete fails because you can't delete a const pointer, and maybe CString used to cast to a normal template C*? But I tried casting it before and it still had problems, so I decided I didn't care about a bit of memory lost one time at startup.<br><br>Actually, is anyone still working actively on framebuffers and shaders and things? At least as far as I can tell it's seemed like the monkey community is kinda on the decline, which is a shame since it's probably my favorite language I've ever used. <br><br></td></tr></table><br>
<a name="2100869"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImmutableOctet(SKNG)</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, most people are using custom GL code for shaders, similar to what SKN3 was doing. On top of that, MiniB3D has its own shader support. But as far as new advancements go, Mungo's 'harmony' module has a different audience, but it can be used as a Mojo backend. That supports shaders, from what I've heard, at least. It's an new module, and it's targeted at Mungo, though. <a href="http://mungo.io" target="_blank">Here's the website</a>. Devolonter's the main person working on that fork. Here's <a href="http://www.monkey-x.com/Community/posts.php?topic=8435&amp;page=first" target="_blank">his forum thread for it</a>; hasn't been touched in a while, but he's working on it. Last I heard, he's being funded by <a href="http://www.monkey-x.com/Community/posts.php?topic=9061" target="_blank">the 2Dark project</a>, which uses his module. Here's the <a href="https://twitter.com/mungodev" target="_blank">fork's main twitter account</a>, and here's <a href="https://twitter.com/devolonter" target="_blank">Devolonter's</a>. Haven't been following his fork very much, but it looks good to me.<br><br>That's basically how shaders are going in the world of Monkey. At the end of the day, Monkey does have full OpenGL support, though. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
