<!DOCTYPE >
<html><head>
<meta http-equiv="content-type" content="text/html; charset=windows-1252"><title>The Official Blitz Website</title><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"></head><body> 
 
<table width="100%" cellspacing="0" cellpadding="0"><tbody><tr><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tbody><tr><td>&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="../../news.html" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="../../index.html" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="../../codearcs.html" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="../../user-worklogs.html" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="../../gallery.html" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="../../sdkspecs.html" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="../../search.html" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></tbody></table></td><td class="menubarright"></td></tr></tbody></table><div class="main"><h1>Worklog for Kalisme</h1><h1>shaKAL</h1><a href="../../user-worklogs.html">Return to Worklogs</a><br><br><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr><td class="posthead"><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr><td>HOLE retouch and shaKAL 0.5 download links</td><td align="right"><font class="tiny">(Posted 2008-04-07)</font></td></tr></tbody></table></td></tr><tr><td class="posttext"> Hey there everybodies....<br>Finally got shaKAL 0.5 and HOLE:retouch up on the net...<br>Please note:<br>*I'm hoping to re-write shaKAL soon to make easier to read.<br>*Hole: retouch is a tech demo using shaKAL<br>*I haven't check the speed for these downloads<br><br>Hole: retouch<br><a href="http://www.uploading.com/files/DDHTIINP/hole_retouch.zip.html" target="_blank">http://www.uploading.com/files/DDHTIINP/hole_retouch.zip.html</a><br><br>shaKAL 0.5 &amp; tutorials<br><a href="http://www.uploading.com/files/DII9REKX/tutorial1.zip.html" target="_blank">http://www.uploading.com/files/DII9REKX/tutorial1.zip.html</a><br><br>Feed back please. <br><br> ---------------------<br>my current projects:<br><br>...*shrugs*<br>Learning SDL via DevC++ </td></tr></tbody></table><br><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr><td class="posthead"><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr><td>currently at 0.5</td><td align="right"><font class="tiny">(Posted 2008-04-04)</font></td></tr></tbody></table></td></tr><tr><td class="posttext">
 well, things are getting a little stressful (currently job hunting), 
but I'm considering getting back into the games devolpment 
scene....Unfortunatley these TAFE computers don't seem to let people 
upload files to the net (darn)...<br>I'll try to use the university 
computers, but if not I might need to ask someone if I can Email them 
files to add to my mediafire acount...<br><br>Oh well... shaKAL is still at 0.5...<br>Really wanting to do some freeware games... <br><br> ---------------------<br>my current projects:<br><br>...*shrugs*<br>Learning SDL via DevC++ </td></tr></tbody></table><br><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr><td class="posthead"><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr><td>0.5 soon</td><td align="right"><font class="tiny">(Posted 2007-09-24)</font></td></tr></tbody></table></td></tr><tr><td class="posttext">
 After posting that odd update of that tech demo I released when I was 
15, I noticed a wierd glitch in my ol' shaKAL shadow culling code... so I
 used some older code I wrote, which worked better (wierd, eh?)<br>I 
didn't think I'd return to this project (or programming, depressingly 
enough) because I was WAY too wrapped up in my course and producing 
"artwork". Luckily a friend got me back into playing video games... so I
 became interested in programming again.<br>I shall post the new verson ASAP. <br><br> ---------------------<br>my current projects:<br><br>...*shrugs*<br>Learning SDL via DevC++ </td></tr></tbody></table><br><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr><td class="posthead"><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr><td>0.3</td><td align="right"><font class="tiny">(Posted 2007-02-20)</font></td></tr></tbody></table></td></tr><tr><td class="posttext"> I have recently done some more work on shaKAL...<br>here are files for the 0.3 release:<br><br><a href="http://download.35mb.com/kalisme/shaKAL0_3.zip" target="_blank">http://download.35mb.com/kalisme/shaKAL0_3.zip</a><br><a href="http://download.35mb.com/kalisme/terrain%20demo.zip" target="_blank">http://download.35mb.com/kalisme/terrain%20demo.zip</a><br><a href="http://download.35mb.com/kalisme/tutorials.zip" target="_blank">http://download.35mb.com/kalisme/tutorials.zip</a><br><br>Get the required *.decls &amp; *.dll to work with this at:<br>www.blitzbasic.com/codearcs/codearcs.php?code=1191<br><br>or:<br>www.freewebs.com/elias_t/tribox_dll.zip <br><br>(they are required to run the shadow library)<br><br>(sorry for being so blunt, but it's too hot today!)<br>Hope someone finds this work of interest.<br>I'm still working on shaKAL.<br>-Kevin Laherty <br><br> ---------------------<br>my current projects:<br><br>...*shrugs*<br>Learning SDL via DevC++ </td></tr></tbody></table><br><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr><td class="posthead"><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr><td>0.25</td><td align="right"><font class="tiny">(Posted 2007-02-13)</font></td></tr></tbody></table></td></tr><tr><td class="posttext"> Here is version 0.25.<br>Fixed a glitch causing jagged shadowcamera movement &amp; added shadow culling for terrains. (experimental)<br><br>www.freewebs.com/elias_t/tribox_dll.zip &lt;--you'll need this.<br><br><textarea class="codebox" name="code" readonly="true" rows="15" cols="80" wrap="OFF">;
 ShaKAL 
;version 0.25
;(this release includes experimental terrain polygon culling)
Global shadow_render_dis#=200
Global light_dot_piv=CreatePivot()

Global shakal_terrain_nudge#=3
Dim mess(100,100)    ;&lt;-test
Global Terrain_shadow_detail=40

Type kShl
	Field	ent,dis#
End Type

Type kShob
	Field	ent,hi#,fat#,sclx#,piv#
End Type

Type kShr
	Field	ent
End Type

Type kShr_ter
	Field	ent,x_scale#,z_scale#
End Type


Type kmsh
	Field	ob,lite,mesh,surf,texy
End Type

Type kSh_d ;dev mode types
	Field	ent,box,hi#,fat#,sclx#,piv#
End Type

Global shaKAL_camera_range#=700

Global blur_cam_x#=65536.0
Global blur_cam_y#=65536.0
Global blur_cam_z#=0.0


Global blur_times=1
Global blur_radius#=1



Global diss#
Global dis#
Global shadbox_x
Global shadbox_y
Global shadbox_z
Global shadbox_sx
Global shadbox_sy
Global shadbox_sz

;---------------------int box
Dim TriVertex(3)

Dim TriVx#(3)
Dim TriVy#(3)
Dim TriVz#(3)

Dim TriVnx#(3)
Dim TriVny#(3)
Dim TriVnz#(3)


Dim ShadowVertex(3)

Global bank=CreateBank(15*4)

Global ksh_ng#=.00005     ;&lt;---nudge vertesies  
Global  ssize=64     ;&lt;----shadow size

shadbox_x=50
shadbox_y=-5000
shadbox_z=50

shadbox_sx=50
shadbox_sy=50
shadbox_sz=50


Global ksh_pivvy=CreatePivot()
Global ksh_sdpiv=CreatePivot()


Global ksh_cam =CreateCamera()                   ;&lt;----camera for 
shadows
CameraRange ksh_cam,1,shaKAL_camera_range#
CameraViewport ksh_cam,0,0,ssize,ssize 
CameraClsColor ksh_cam,255,255,255
CameraProjMode ksh_cam,2
CameraFogMode ksh_cam,1
CameraFogColor ksh_cam,255,255,255


Function create_light(ent,dis#)
c_light=0
For d.kshl = Each kshl
If d\ent=ent Then c_light=1
Next
If c_light=1 Then Goto skip_create_light

	d.kshl=New kshl
	d\ent=ent
	d\dis#=dis
.skip_create_light
End Function

Function draw_light(cam)
For d.kshl = Each kshl
CameraProject cam,EntityX(d\ent,1),EntityY(d\ent,1),EntityZ(d\ent,1) 
;moo
Line 
ProjectedX()+Cos(Rnd(360))*20,ProjectedY()+Sin(Rnd(360))*20,ProjectedX(),ProjectedY()
Text
 ProjectedX()+2,ProjectedY()+15,"light source"
Next
End Function 

Function create_caster(ent,hi#,fat#,scalex#,piv_offset#)
c_cast=0
For d.kshob = Each kshob
If d\ent=ent Then c_cast=1
Next
If c_cast=1 Then Goto skip_create_caster
	d.kshob=New kshob
	d\ent=ent
	d\hi#=hi#
	d\fat#=fat#
	d\sclx#=scalex#
	d\piv=piv_offset#
	.skip_create_caster
End Function

Function draw_caster(cam)
For d.kshob = Each kshob
CameraProject cam,EntityX(d\ent,1),EntityY(d\ent,1),EntityZ(d\ent,1)
Line ProjectedX()-15,ProjectedY(),ProjectedX()+15,ProjectedY()
Line ProjectedX(),ProjectedY()-15,ProjectedX(),ProjectedY()+15
Text ProjectedX()+2,ProjectedY()+15,"caster"
Next
End Function 

Function create_receiver(ent)
c_receiver=0
For d.kshr = Each kshr
If d\ent=ent Then c_receiver=1
Next
If c_receiver=1 Then Goto skip_create_receiver


	d.kshr=New kshr
	d\ent=ent
	
.skip_create_receiver
End Function

Function create_terrain_receiver(ent,x#,z#)
c_terrain_receiver=0
For d.kshr_ter = Each kshr_ter
If d\ent=ent Then c_terrain_receiver=1
Next
If c_terrain_receiver=1 Then Goto skip_create_terrain_receiver
	d.kshr_ter=New kshr_ter
	d\ent=ent
	d\x_scale#=x#
	d\z_scale#=z#
.skip_create_terrain_receiver
End Function


Function update_ks(g_cam)
CameraRange ksh_cam,1,shaKAL_camera_range#
killshads()
For a.kshl = Each kshl

  For b.kshob = Each kshob
createcopy(a\ent,b\ent,b\hi#,b\fat#,b\piv#,a\dis#,b\sclx#,g_cam)

  Next


Next
End Function

Function killshads()
For c.kmsh = Each kmsh
If c\mesh &lt;&gt; 0 Then 	ClearSurface c\surf:FreeTexture 
c\texy:FreeEntity c\mesh: Delete c
Next

End Function

Function createcopy(ligt,mesh,hi#,fat#,offset#,ldis#,scalex#,g_cam)
CameraViewport ksh_cam,0,0,ssize,ssize 

Local shadbox=CreateCube()
EntityColor shadbox,255,255,255
PositionEntity shadbox,shadbox_x,shadbox_y,shadbox_z
ScaleEntity shadbox,shadbox_sx,shadbox_sy,shadbox_sz
EntityFX shadbox,1
EntityOrder shadbox,-2

offset_piv=CreatePivot()

PositionEntity 
offset_piv,EntityX(mesh,1),EntityY(mesh,1),EntityZ(mesh,1)
RotateEntity 
offset_piv,EntityPitch(mesh,1),EntityYaw(mesh,1),EntityRoll(mesh,1)

MoveEntity offset_piv,0,offset#,0


PositionEntity ksh_pivvy,EntityX(ligt,1),EntityY(ligt,1),EntityZ(ligt,1)
PointEntity ksh_pivvy,offset_piv
dis#=EntityDistance(ksh_pivvy,offset_piv)

If dis# &gt; ldis#+1 Then Goto skipc2

	c.kmsh=New kmsh
c\texy=CreateTexture(ssize,ssize,16+32)
c\mesh= CreateMesh()
c\surf  = CreateSurface(c\mesh)
PositionEntity ksh_cam,EntityX(ligt,1),EntityY(ligt,1),EntityZ(ligt,1)
PointEntity ksh_cam,offset_piv
CameraZoom ksh_cam,.06/scalex#
dis#=EntityDistance(ksh_cam,offset_piv)
ndis#=-(shadow_render_dis#-dis#)
MoveEntity ksh_cam,0,0,ndis#


PositionEntity ksh_pivvy,EntityX(ligt,1),EntityY(ligt,1),EntityZ(ligt,1)
PointEntity ksh_pivvy,offset_piv
dis#=EntityDistance(ksh_pivvy,offset_piv)
ndis#=ldis#-dis#
MoveEntity ksh_pivvy,0,0,dis#+ndis#
pfox#=EntityX(ksh_cam,1)-EntityX(mesh,1)
pfoy#=EntityY(ksh_cam,1)-EntityY(mesh,1)
pfoz#=EntityZ(ksh_cam,1)-EntityZ(mesh,1)


obx#=EntityX(offset_piv,1)
oby#=EntityY(offset_piv,1)
obz#=EntityZ(offset_piv,1)

sbx#=EntityX(ksh_pivvy,1)
sby#=EntityY(ksh_pivvy,1)
sbz#=EntityZ(ksh_pivvy,1)

bsw#=sbx#-obx#
bsh#=sby#-oby#
bsd#=sbz#-obz#

cbx#=obx#+((bsw)*.5)
cby#=oby#+((bsh)*.5)
cbz#=obz#+((bsd)*.5)


If bsw#&lt;0 Then bsw#=bsw#*-1
If bsh#&lt;0 Then bsh#=bsh#*-1
If bsd#&lt;0 Then bsd#=bsd#*-1
bsw#=bsw#+(fat#*2)
bsh#=bsh#+(hi#*2)
bsd#=bsd#+(fat#*2)




PokeFloat bank,0,cbx#
PokeFloat bank,4,cby#
PokeFloat bank,8,cbz#

PokeFloat bank,12,bsw#*.5
PokeFloat bank,16,bsh#*.5
PokeFloat bank,20,bsd#*.5


For d.kshr = Each kshr

If d\ent = offset_piv Then Goto scopym
If d\ent = mesh Then Goto scopym


RotateMesh d\ent,EntityPitch(d\ent),0,0
RotateMesh d\ent,0,EntityYaw(d\ent),0
RotateMesh d\ent,0,0,EntityRoll(d\ent)

surfaces = CountSurfaces(d\ent)

   For LOOP_Surface = 1 To Surfaces
		
		Surface_Handle = GetSurface(d\ent, LOOP_Surface)
        Tris = CountTriangles(Surface_Handle)
		
		For LOOP_Tris = 0 To Tris-1
		cull=1

				For LOOP_Verts = 0 To 2

					TriVertex(LOOP_Verts) = TriangleVertex(Surface_Handle, LOOP_Tris, 
LOOP_Verts)
					TriVx#(LOOP_Verts) = VertexX#(Surface_Handle, 
TriVertex(LOOP_Verts)) + EntityX(d\ent,1)
					TriVy#(LOOP_Verts) = VertexY#(Surface_Handle, 
TriVertex(LOOP_Verts)) + EntityY(d\ent,1)
					TriVz#(LOOP_Verts) = VertexZ#(Surface_Handle, 
TriVertex(LOOP_Verts)) + EntityZ(d\ent,1)

					TriVnx#(LOOP_Verts) = VertexNX#(Surface_Handle, 
TriVertex(LOOP_Verts))
					TriVny#(LOOP_Verts) = VertexNY#(Surface_Handle, 
TriVertex(LOOP_Verts))
					TriVnz#(LOOP_Verts) = VertexNZ#(Surface_Handle, 
TriVertex(LOOP_Verts))
PositionEntity 
light_dot_piv,EntityX(ligt,1),EntityY(ligt,1),EntityZ(ligt,1)
PointEntity light_dot_piv,d\ent
				TFormNormal 0, 0, 1, light_dot_piv, 0
				L_NX# = TFormedX#()
				L_NY# = TFormedY#()
				L_NZ# = TFormedZ#()
If ((TriVnx#(LOOP_Verts) * -L_NX#) + (TriVny#(LOOP_Verts) * -L_NY#) + 
(TriVnz#(LOOP_Verts) * -L_NZ#))&gt; 0 Then cull=0
								Next

;triangle vertices
;v0
PokeFloat bank,24,trivx#(0)
PokeFloat bank,28,trivy#(0)
PokeFloat bank,32,trivz#(0)
;v1
PokeFloat bank,36,trivx#(1)
PokeFloat bank,40,trivy#(1)
PokeFloat bank,44,trivz#(1)
;v2
PokeFloat bank,48,trivx#(2)
PokeFloat bank,52,trivy#(2)
PokeFloat bank,56,trivz#(2)

If cull=0 

	If triBox(bank) = 1
															

		For LOOP_Verts = 0 To 2			
			ShadowVertex(LOOP_Verts) = AddVertex(c\surf, 
TriVx#(LOOP_Verts)+(TriVnx#(LOOP_Verts)*ksh_ng#), 
TriVy#(LOOP_Verts)+(TriVny#(LOOP_Verts)*ksh_ng#), 
TriVz#(LOOP_Verts)+(TriVnz#(LOOP_Verts)*ksh_ng#))											
		Next															
		AddTriangle(c\surf, ShadowVertex(0), ShadowVertex(1), ShadowVertex(2))
										
	EndIf		
EndIf

Next
Next
EntityAlpha c\mesh,1

RotateMesh d\ent,0,0,-EntityRoll(d\ent)
RotateMesh d\ent,0,-EntityYaw(d\ent),0
RotateMesh d\ent,-EntityPitch(d\ent),0,0

.scopym

Next

;============================================================================================
;============================================================================================
;============================================================================================
terpiv=CreatePivot()

sizex#=Float(bsw*1.125)/Terrain_shadow_detail
sizez#=Float(bsd*1.125)/Terrain_shadow_detail


For
 e.kshr_ter = Each kshr_ter
max_x#=EntityX(e\ent)+(TerrainSize(e\ent) * e\x_scale#)
max_z#=EntityZ(e\ent)+(TerrainSize(e\ent) * e\z_scale#)

x_box_min#=cbx#-((sizex#*Terrain_shadow_detail)*.5)
x_box_max#=cbx#+((sizex#*Terrain_shadow_detail)*.5)

z_box_min#=cbz#-((sizez#*Terrain_shadow_detail)*.5)
z_box_max#=cbz#+((sizez#*Terrain_shadow_detail)*.5)


If x_box_min# &lt; max_x# Then If x_box_max# &gt; EntityX#(e\ent) Then 
If z_box_min# &lt; max_z Then If z_box_max# &gt; EntityZ#(e\ent) Then 

 For b=0 To Terrain_shadow_detail
  For a=0 To Terrain_shadow_detail
def_x#=cbx#-((sizex#*Terrain_shadow_detail)*.5)+(a*sizex#)
def_z#=cbz#-((sizez#*Terrain_shadow_detail)*.5)+(b*sizez#)

If def_x#&lt;EntityX#(e\ent) Then def_x#=EntityX(e\ent)
If def_x#&gt;max_x# Then def_x#=max_x#

If def_z#&lt;EntityZ#(e\ent) Then def_z#=EntityZ#(e\ent)
If def_z#&gt;max_z# Then def_z#=max_z#


y#=TerrainY(e\ent,def_x#,0,def_z#)+shakal_terrain_nudge#
mess(a,b)= AddVertex (c\surf,def_x#,y#,def_z#)


  Next
 Next

 For b=0 To Terrain_shadow_detail-1
  For a=0 To Terrain_shadow_detail-1

;experimental code... may remove in future
ax#=VertexX(c\surf,mess(a+1,b))-VertexX(c\surf,mess(a,b))
ay#=VertexY(c\surf,mess(a+1,b))-VertexY(c\surf,mess(a,b))
az#=VertexZ(c\surf,mess(a+1,b))-VertexZ(c\surf,mess(a,b))

bx#=VertexX(c\surf,mess(a+1,b+1))-VertexX(c\surf,mess(a+1,b))
by#=VertexY(c\surf,mess(a+1,b+1))-VertexY(c\surf,mess(a+1,b))
bz#=VertexZ(c\surf,mess(a+1,b+1))-VertexZ(c\surf,mess(a+1,b))

nx#=(ay#*bz#) - (az#*by#)
ny#=(az#*bx#) - (ax#*bz#)
nz#=(ax#*by#) - (ay#*bx#)
ns#=Sqr(nx#*nx# + ny#*ny# + nz# * nz#)
nx#=Float(nx#)/ns#
ny#=Float(ny#)/ns#
nz#=Float(nz#)/ns#
;----------------------------------------------&gt;



;checks if light hits the surface.... not very clean (done by checking 
squares.... not polygons.)
PositionEntity 
light_dot_piv,EntityX(ligt,1),EntityY(ligt,1),EntityZ(ligt,1)
PositionEntity 
terpiv,VertexX(c\surf,mess(a+1,b)),VertexY(c\surf,mess(a+1,b)),VertexZ(c\surf,mess(a+1,b))
PointEntity
 light_dot_piv,terpiv
cull=1
				TFormNormal 0, 0, 1, light_dot_piv, 0
				L_NX# = TFormedX#()
				L_NY# = TFormedY#()
				L_NZ# = TFormedZ#()
If ((nx# * -L_NX#) + (ny# * -L_NY#) + (nz# * -L_NZ#))&gt; 0 Then cull=0

If cull = 1
   AddTriangle c\surf,mess(a,b),mess(a+1,b),mess(a+1,b+1)
   AddTriangle c\surf,mess(a,b),mess(a,b+1),mess(a+1,b+1)
EndIf

  Next
 Next
EndIf
Next
FreeEntity terpiv
;============================================================================================
;============================================================================================
;============================================================================================



EntityFX
 mesh,8+1
EntityColor mesh,0,0,0
EntityOrder mesh,-2

HideEntity g_cam 
ShowEntity ksh_cam 

TextureBlend c\texy,3


temp_mesh=CopyEntity(mesh)
PositionEntity temp_mesh,shadbox_x,shadbox_y,shadbox_z

PositionEntity ksh_cam,shadbox_x+pfox#,shadbox_y+pfoy#,shadbox_z+pfoz#


RenderWorld()
PositionEntity ksh_cam,EntityX(ligt,1),EntityY(ligt,1),EntityZ(ligt,1)

ShowEntity g_cam
Color 255,255,255
Rect 1,1,ssize-1,ssize-1,0
Rect 0,0,ssize,ssize,0
CopyRect 0,0,ssize,ssize,0,0,BackBuffer(),TextureBuffer(c\texy) 
For s=1 To CountSurfaces(c\mesh) 
surf=GetSurface(c\mesh,s) 
For v=0 To CountVertices(surf)-1 
TFormPoint 
VertexX(surf,v),VertexY(surf,v),VertexZ(surf,v),c\mesh,ksh_cam
VertexTexCoords 
surf,v,(TFormedX()/scalex#)/32+0.5,1-((TFormedY()/scaleX#)/32+.5)

PositionEntity 
ksh_sdpiv,VertexX(surf,v)+EntityX(c\mesh,1),VertexY(surf,v)+EntityY(c\mesh),VertexZ(surf,v)+EntityZ(c\mesh)
dis2#
 =EntityDistance(ksh_sdpiv,ksh_cam)
diss#=(ldis#-dis2#)/ldis#
dis#=1-diss#
VertexColor surf,v,(128*dis#)*2,(128*dis#)*2,(128*dis#)*2

Next 
Next 



HideEntity g_cam
ShowEntity ksh_cam 

;------------------------------------------------------------------------------------


blur_quality=blur_times
If
 blur_quality &gt; 0
Local blurmesh[16*4]
Local loop
Local blur_cam


	RotateEntity ksh_cam,90,0,0,True
	PositionEntity ksh_cam, blur_cam_x#, blur_cam_y#, blur_cam_z#
CameraZoom ksh_cam,1


	For loop = 0 To (blur_quality*4)-1
			blurmesh[loop] = CreateCube()
	Next
	
	blurradius#=blur_radius#*(1.0/256.0)
	bluranglestep#=360.0/Float(blur_quality*4)
	blurshade = Ceil(255.0/Float(blur_quality*4))
	
	For loop=0 To (blur_quality*4)-1
			EntityTexture blurmesh[loop],c\texy

			EntityColor 
blurmesh[loop],255*(1.0/Float(loop+1)),255*(1.0/Float(loop+1)),255*(1.0/Float(loop+1))


			ScaleEntity blurmesh[loop],1,.001,1
			blurangle# = bluranglestep# * Float(loop) + 180.0*(loop Mod 2)
			xoff# = blurradius# * Cos(blurangle#)
			yoff# = blurradius# * Sin(blurangle#)
			PositionEntity blurmesh[loop], blur_cam_x#+xoff#, blur_cam_y#-5.0, 
blur_cam_z# + yoff#, True
			If loop&gt; 1 Then EntityBlend blurmesh[loop],2
	Next
	RenderWorld
Rect 1,1,ssize-1,ssize-1,0
Rect 0,0,ssize,ssize,0

CopyRect 0,0,ssize,ssize,0,0,BackBuffer(),TextureBuffer(c\texy) 
			For loop = 0 To (blur_quality*4)-1
					FreeEntity blurmesh[loop]
			Next
	
EndIf

;--------------------------------------------------------


ShowEntity g_cam
HideEntity ksh_cam

PositionEntity ksh_cam,EntityX(ligt,1),EntityY(ligt,1),EntityZ(ligt,1)
CameraZoom ksh_cam,.06/scalex#

.skip_blur


EntityTexture c\mesh,c\texy
EntityBlend c\mesh,2
EntityFX c\mesh,1+2+8+16

EntityFX mesh,0
EntityColor mesh,128,128,128
EntityOrder mesh,0
HideEntity ksh_cam 

FreeEntity temp_mesh

.skipc2
FreeEntity shadbox
FreeEntity offset_piv
HideEntity ksh_cam

End Function

Function remove_caster(ent)
For d.kshob = Each kshob
If d\ent=ent Then Delete d
Next
End Function 

Function remove_light(ent)
For d.kshl = Each kshl
If d\ent=ent Then Delete d
Next
End Function 

Function remove_receiver(ent)
For d.kshr = Each kshr
If d\ent=ent Then Delete d
Next
End Function 

Function remove_terrain_receiver(ent)
For d.kshr_ter = Each kshr_ter
If d\ent=ent Then Delete d
Next
End Function 



;--------------------------------------------------------
; dev mode functions
;--------------------------------------------------------
Function create_dev_caster(ent,hi#,fat#,scalex#,piv_offset#)
c_cast=0
For d.ksh_d = Each ksh_d
If d\ent=ent Then c_cast=1
Next
If c_cast=1 Then Goto skip_create_caster
	d.ksh_d=New ksh_d
	d\ent=ent
	d\box=CreateCube()
	d\hi#=hi#
	d\fat#=fat#
	d\sclx#=scalex#
	d\piv=piv_offset#
ScaleEntity d\box,fat#,hi#,fat#
PositionEntity d\box,0,piv_offset#,0
EntityAlpha d\box,.5
EntityColor d\box,0,200,0
	.skip_create_caster

End Function

Function draw_dev_caster(ent,light,g_CAM,x,y)
HideEntity g_cam
ShowEntity ksh_cam
CameraViewport ksh_cam,x,y,ssize,ssize 

For d.ksh_d = Each ksh_d
If d\ent=ent Then 

PositionEntity d\box,EntityX(d\ent),EntityY(d\ent),EntityZ(d\ent)
RotateEntity 
d\box,EntityPitch(d\ent,1),EntityYaw(d\ent,1),EntityRoll(d\ent,1)
MoveEntity d\box,0,d\piv,0
RotateEntity d\box,0,0,0

offsetpiv=CreatePivot()

PositionEntity 
offsetpiv,EntityX(d\ent,1),EntityY(d\ent,1),EntityZ(d\ent,1)
RotateEntity 
offsetpiv,EntityPitch(d\ent,1),EntityYaw(d\ent,1),EntityRoll(d\ent,1)

MoveEntity offsetpiv,0,d\piv,0


PositionEntity 
ksh_cam,EntityX(light,1),EntityY(light,1),EntityZ(light,1)
PointEntity ksh_cam,offsetpiv
CameraZoom ksh_cam,.06/d\sclx#

RenderWorld()
Color 255,255,255
Rect x+1,y+1,ssize-1,ssize-1,0
Rect x,y,ssize,ssize,0

Text x,y-25,"scaleX: " + d\sclx#
Text x,y-15,"pivot offset: " + d\piv
EndIf

Next
HideEntity ksh_cam
ShowEntity g_cam
End Function 

Function show_dev_caster(ent)
For d.ksh_d = Each ksh_d
If d\ent=ent Then ShowEntity d\box
Next
End Function 

Function hide_dev_caster(ent)
For d.ksh_d = Each ksh_d
If d\ent=ent Then HideEntity d\box
Next
End Function 

Function remove_dev_caster(ent)
For d.ksh_d = Each ksh_d
If d\ent=ent Then FreeEntity d\box : Delete d
Next
End Function 
</textarea><br><br>In short, thanyou to the support of two blitzers, 
I've decided to continue work on shaKAL.... expect updates... but know I
 might be slower inbetween updates now because I'm using TAFE internet 
to update and I'm currently teaching myself c++ &amp; SDL.<br><br>a scene without shaKAL: (before shadows)<br><textarea class="codebox" name="code" readonly="true" rows="15" cols="80" wrap="OFF">;A simple scene

Graphics3D 800,600
SetBuffer BackBuffer()

	cube = CreateCube()
	ScaleEntity cube,5,5,5
	ScaleEntity cube,5,5,5

	map=CreateCube()
	PositionEntity map,0,-15,0
	ScaleMesh map,20,1,20

;setting up the camera
	Global camera=CreateCamera()
	PositionEntity camera,0,10,-70

;the light source for our little scene:
	light= CreateLight(2)
		light_ball=CreateSphere(6,light) 
		EntityColor light_ball,0,200,0   
		ScaleEntity light_ball,2,2,2
		EntityFX light_ball,1
	PositionEntity light,-6,40,0

fps_milli=MilliSecs(): fps_counter=0: update_frequency=10

While Not KeyHit(1)
TurnEntity cube,.75,1,0

		UpdateWorld
	RenderWorld
;===========================================================	
; fps counter
fps_counter=fps_counter+1
If fps_counter=update_frequency
     fps=1000/Float(((MilliSecs()-fps_milli))/update_frequency)
     fps_milli=MilliSecs()
     fps_counter=0
     EndIf
Text 80,0, "shadowless"
Text 0,0,"FPS:"+fps
;-----------------------------------------------------------
Flip
Wend
End
</textarea><br><br>The same scene WITH a shadow:<br><textarea class="codebox" name="code" readonly="true" rows="15" cols="80" wrap="OFF">;A simple scene

Graphics3D 800,600
SetBuffer BackBuffer()

Include "../lib/shaKAL_lib.bb"
ssize=64
blur_times=1
blur_radius#=.025


	cube = CreateCube()
	ScaleEntity cube,5,5,5
	ScaleEntity cube,5,5,5
create_caster(cube,5,5,1,0)


	map=CreateCube()
	PositionEntity map,0,-15,0
	ScaleMesh map,20,1,20
	create_receiver(map)

;setting up the camera
	Global camera=CreateCamera()
	PositionEntity camera,0,10,-70

;the light source for our little scene:
	light= CreateLight(2)
		light_ball=CreateSphere(6,light) 
		EntityColor light_ball,0,200,0   
		ScaleEntity light_ball,2,2,2
		EntityFX light_ball,1
	PositionEntity light,-6,40,0
create_light(light,200)

fps_milli=MilliSecs(): fps_counter=0: update_frequency=10

While Not KeyHit(1)
TurnEntity cube,.75,1,0
update_ks(camera)

		UpdateWorld
	RenderWorld
;===========================================================	
; fps counter
fps_counter=fps_counter+1
If fps_counter=update_frequency
     fps=1000/Float(((MilliSecs()-fps_milli))/update_frequency)
     fps_milli=MilliSecs()
     fps_counter=0
     EndIf
Text 80,0, "shadowless"
Text 0,0,"FPS:"+fps
;-----------------------------------------------------------
Flip
Wend
End
</textarea><br><br>A better scene: (still primitives though)<br><textarea class="codebox" name="code" readonly="true" rows="15" cols="80" wrap="OFF">; a simple scene with 3 shadow casters that also receive
Graphics3D 800,600
SetBuffer BackBuffer()

Include "../lib/shaKAL_lib.bb"
ssize=128
blur_times=1

AmbientLight 100,100,100

	cube1 = CreateCube()
	ScaleMesh cube1,5,14,5  ;&lt;--- please note this is "scalemesh", no longer scaleentity because they are also receivers now
	PositionEntity cube1,-15,0,0
create_caster(cube1,15,5,2,0)
	create_receiver(cube1)

	cube2 = CreateCube()
	ScaleMesh cube2,5,14,5
	PositionEntity cube2,15,0,0
create_caster(cube2,15,5,2,0)
	create_receiver(cube2)


	cube3 = CreateCube()
	ScaleMesh cube3,5,14,5
	PositionEntity cube3,0,0,10
create_caster(cube3,15,5,2,0)
	create_receiver(cube3)


	map=CreateCube()
	PositionEntity map,0,-15,0
	ScaleMesh map,70,1,70  ;&lt;--- please note this is "scalemesh", not "scaleentity".
	create_receiver(map)

;setting up the camera
	Global camera=CreateCamera()
	PositionEntity camera,0,10,-70

;the light source for our little scene:
	light= CreateLight(2)
		light_ball=CreateSphere(6,light) 
		EntityColor light_ball,0,200,0   
		ScaleEntity light_ball,2,2,2
		EntityFX light_ball,1
	PositionEntity light,-60,24,40
create_light(light,160)

fps_milli=MilliSecs(): fps_counter=0: update_frequency=10

While Not KeyHit(1)
TurnEntity light,0,6,0
MoveEntity light,0,0,-4

TurnEntity camera,0,3,0
MoveEntity camera,4,0,0

		UpdateWorld
update_ks(camera)
	RenderWorld
	
;===========================================================	
; fps counter
fps_counter=fps_counter+1
If fps_counter=update_frequency
     fps=1000/Float(((MilliSecs()-fps_milli))/update_frequency)
     fps_milli=MilliSecs()
     fps_counter=0
     EndIf
Text 80,0, "3 shadow casters that also receive"
Text 0,0,"FPS:"+fps
;-----------------------------------------------------------
Flip
Wend
End
</textarea><br><br>Tally-ho &amp; pip pip then...<br>Till next time,<br>-Kevin Laherty <br><br> ---------------------<br>my current projects:<br><br>...*shrugs*<br>Learning SDL via DevC++ </td></tr></tbody></table><br><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr><td class="posthead"><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr><td>Case of the missing files.</td><td align="right"><font class="tiny">(Posted 2007-02-08)</font></td></tr></tbody></table></td></tr><tr><td class="posttext">
 Erm... I just tried to download my own files (the shaKAL libs)... 
(yeah... I download my own stuff now and again... I check if they still 
work.)<br>But unfortunatley www.filelodge.com doesn't seem to exist anymore!! :o<br>Well... I'll sort it out I guess. But if anyone wants to help... I'm not gonna say no :P<br>Oh, and if anyone wants shaKAL emailed to them or something, just eamail me at kalisme@...<br>it might take a few days for me to reply since I'm using the tafes internet.... but I'll reply.<br>Just make sure to add "shaKAL" in the subject.<br>(my hotmail presumes most poeple are junkmail... very odd.)<br>-Kevin Laherty <br><br> ---------------------<br>my current projects:<br><br>...*shrugs*<br>Learning SDL via DevC++ </td></tr></tbody></table><br><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr><td class="posthead"><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr><td>pseudo-update</td><td align="right"><font class="tiny">(Posted 2007-02-07)</font></td></tr></tbody></table></td></tr><tr><td class="posttext"> well... this isn't really an update...<br>I
 haven't done much... I fiddled around with shaKAL in the hollidays a 
little... but I was quite busy learning C++ and studying stuff...<br>There
 wasn't much intrest in the project... I might continue if I get some 
spare time and a good idea (they do come... sometimes.)<br>But I might 
shove up a simple tutorial I wrote so that it's easy to understand the 
basis of writting your own shadow engine... I admit mine was a tad 
fiddley...<br>I'll have a look at the tutorial tonight and see if I can 
shorten it down or something.... hopefully I'll upload it this week 
sometime.<br>Well, that's all for now.<br>Thankyou for those who supported shaKAL.<br>If you did have any intrest in the project, feel free to Email me: kalisme@...<br>(I
 think I just need motivation... lack of feedback &amp; intrest sorta 
kills the thrill of coding freeware opensource stuff... I know I sound 
like an attention seeker, but I'm sure some of you out there can 
understand.)<br>I want to continue TRYING to contribute to this great 
comunity so I want to continue coding in blitz3d, but I know I have to 
get more seriousley into c++ if I ever want to get anywhere in the 
industry.<br>-Kevin Laherty <br><br> ---------------------<br>my current projects:<br><br>...*shrugs*<br>Learning SDL via DevC++ </td></tr></tbody></table><br><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr><td class="posthead"><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr><td>YAY!!! Version 0.2 avadable!</td><td align="right"><font class="tiny">(Posted 2006-12-06)</font></td></tr></tbody></table></td></tr><tr><td class="posttext"> <a href="http://www.filelodge.com/files/room17/427152/shaKALv02.zip" target="_blank">http://www.filelodge.com/files/room17/427152/shaKALv02.zip</a><br><br>there it is!<br>I just uploaded it!<br>version 0.2 is alot nicer than 0.1, but still not a version 1.0... not yet. :(<br><br>Next I hope to restructure my code so it's easyier to re-write and learn from. (aren't I nice?)<br><br>Get the required *.decls &amp; *.dll to work with this at:<br>www.blitzbasic.com/codearcs/codearcs.php?code=1191<br><br>or:<br>www.freewebs.com/elias_t/tribox_dll.zip <br><br>(they are required to run the shadow library)<br><br>thankyou for reading... any support would be great :D<br>-Kevin Laherty <br><br> ---------------------<br>my current projects:<br><br>...*shrugs*<br>Learning SDL via DevC++ </td></tr></tbody></table><br><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr><td class="posthead"><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr><td>working on releasing version 0.2 ASAP</td><td align="right"><font class="tiny">(Posted 2006-12-04)</font></td></tr></tbody></table></td></tr><tr><td class="posttext"> I've currently got a stable 0.2... (I guess)<br>I'm just trying to tidy it up before I post it...<br>Now the shadows are only casted onto the sides of the mesh that have light hitting them.<br><br>Here's something I want to say to anyone who has tryed or is using shaKAL:<br>-with
 the rotatable receivers.... it turns out they are very dodgey... I 
shall have to work on the code more.... (grrrr)... but changing the 
"yaw" in real time seems ok... but pitch and roll are being a real 
hassle.<br><br>-DO NOT SCALE RECEIVERS WITH "scaleentity", use "scalemesh".<br><br>Well... I shall post a new version ASAP...<br>My next goal is culling unlit terrain mesh polygons.<br>Since I don't think I can post in the hollidays, I might work on deKAL... then make a tech demo using my recent work...<br>Thanks for reading,<br>-Kevin Laherty <br><br> ---------------------<br>my current projects:<br><br>...*shrugs*<br>Learning SDL via DevC++ </td></tr></tbody></table><br><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr><td class="posthead"><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr><td>patching 0.1</td><td align="right"><font class="tiny">(Posted 2006-11-29)</font></td></tr></tbody></table></td></tr><tr><td class="posttext"> erg.... here is a patched version of 0.1... my rotateble receivers were very flawed.... (grrr)<br>they didn't like "roll" being played with...<br>I don't think it minds now...<br>I was going to release this in a v 0.15, but I found a bug in the code I was using for culling unlit normals...<br>well... hope 0.15 comes soon.<br>Best of wishes<br><br><pre class="code">; ShaKAL
;version 0.1   + rotatable receiver patch fixes flaw in original release.

Global shakal_terrain_nudge#=3
Dim mess(100,100)    ;&lt;-test
Global Terrain_shadow_detail=40

Type kShl
	Field	ent,dis#
End Type

Type kShob
	Field	ent,hi#,fat#,sclx#,piv#
End Type

Type kShr
	Field	ent
End Type

Type kShr_ter
	Field	ent,x_scale#,z_scale#
End Type


Type kmsh
	Field	ob,lite,mesh,surf,texy
End Type

Type kSh_d ;dev mode types
	Field	ent,box,hi#,fat#,sclx#,piv#
End Type

Global shaKAL_camera_range#=700

Global blur_cam_x#=65536.0
Global blur_cam_y#=65536.0
Global blur_cam_z#=0.0


Global blur_times=1
Global blur_radius#=1



Global diss#
Global dis#
Global shadbox_x
Global shadbox_y
Global shadbox_z
Global shadbox_sx
Global shadbox_sy
Global shadbox_sz

;---------------------int box
Dim TriVertex(3)

Dim TriVx#(3)
Dim TriVy#(3)
Dim TriVz#(3)

Dim TriVnx#(3)
Dim TriVny#(3)
Dim TriVnz#(3)

Dim TriVdot#(3)

Dim ShadowVertex(3)

Global bank=CreateBank(15*4)

Global ksh_ng#=.00005     ;&lt;---nudge vertesies  
Global  ssize=64     ;&lt;----shadow size

shadbox_x=50
shadbox_y=-5000
shadbox_z=50

shadbox_sx=50
shadbox_sy=50
shadbox_sz=50


Global ksh_pivvy=CreatePivot()
Global ksh_sdpiv=CreatePivot()


Global ksh_cam =CreateCamera()                   ;&lt;----camera for shadows
CameraRange ksh_cam,1,shaKAL_camera_range#
CameraViewport ksh_cam,0,0,ssize,ssize 
CameraClsColor ksh_cam,255,255,255
CameraProjMode ksh_cam,2
CameraFogMode ksh_cam,1
CameraFogColor ksh_cam,255,255,255


Function create_light(ent,dis#)
c_light=0
For d.kshl = Each kshl
If d\ent=ent Then c_light=1
Next
If c_light=1 Then Goto skip_create_light

	d.kshl=New kshl
	d\ent=ent
	d\dis#=dis
.skip_create_light
End Function

Function draw_light(cam)
For d.kshl = Each kshl
CameraProject cam,EntityX(d\ent,1),EntityY(d\ent,1),EntityZ(d\ent,1) ;moo
Line ProjectedX()+Cos(Rnd(360))*20,ProjectedY()+Sin(Rnd(360))*20,ProjectedX(),ProjectedY()
Text ProjectedX()+2,ProjectedY()+15,"light source"
Next
End Function 

Function create_caster(ent,hi#,fat#,scalex#,piv_offset#)
c_cast=0
For d.kshob = Each kshob
If d\ent=ent Then c_cast=1
Next
If c_cast=1 Then Goto skip_create_caster
	d.kshob=New kshob
	d\ent=ent
	d\hi#=hi#
	d\fat#=fat#
	d\sclx#=scalex#
	d\piv=piv_offset#
	.skip_create_caster
End Function

Function draw_caster(cam)
For d.kshob = Each kshob
CameraProject cam,EntityX(d\ent,1),EntityY(d\ent,1),EntityZ(d\ent,1)
Line ProjectedX()-15,ProjectedY(),ProjectedX()+15,ProjectedY()
Line ProjectedX(),ProjectedY()-15,ProjectedX(),ProjectedY()+15
Text ProjectedX()+2,ProjectedY()+15,"caster"
Next
End Function 

Function create_receiver(ent)
c_receiver=0
For d.kshr = Each kshr
If d\ent=ent Then c_receiver=1
Next
If c_receiver=1 Then Goto skip_create_receiver


	d.kshr=New kshr
	d\ent=ent
	
.skip_create_receiver
End Function

Function create_terrain_receiver(ent,x#,z#)
c_terrain_receiver=0
For d.kshr_ter = Each kshr_ter
If d\ent=ent Then c_terrain_receiver=1
Next
If c_terrain_receiver=1 Then Goto skip_create_terrain_receiver
	d.kshr_ter=New kshr_ter
	d\ent=ent
	d\x_scale#=x#
	d\z_scale#=z#
.skip_create_terrain_receiver
End Function


Function update_ks(g_cam)
CameraRange ksh_cam,1,shaKAL_camera_range#
killshads()
For a.kshl = Each kshl

  For b.kshob = Each kshob
createcopy(a\ent,b\ent,b\hi#,b\fat#,b\piv#,a\dis#,b\sclx#,g_cam)

  Next


Next
End Function

Function killshads()
For c.kmsh = Each kmsh
If c\mesh &lt;&gt; 0 Then 	ClearSurface c\surf:FreeTexture c\texy:FreeEntity c\mesh: Delete c
Next

End Function

Function createcopy(ligt,mesh,hi#,fat#,offset#,ldis#,scalex#,g_cam)
CameraViewport ksh_cam,0,0,ssize,ssize 

Local shadbox=CreateCube()
EntityColor shadbox,255,255,255
PositionEntity shadbox,shadbox_x,shadbox_y,shadbox_z
ScaleEntity shadbox,shadbox_sx,shadbox_sy,shadbox_sz
EntityFX shadbox,1
EntityOrder shadbox,-2

offset_piv=CreatePivot()

PositionEntity offset_piv,EntityX(mesh,1),EntityY(mesh,1),EntityZ(mesh,1)
RotateEntity offset_piv,EntityPitch(mesh,1),EntityYaw(mesh,1),EntityRoll(mesh,1)
MoveEntity offset_piv,0,offset#,0


PositionEntity ksh_pivvy,EntityX(ligt,1),EntityY(ligt,1),EntityZ(ligt,1)
PointEntity ksh_pivvy,offset_piv
dis#=EntityDistance(ksh_pivvy,offset_piv)

If dis# &gt; ldis#+1 Then Goto skipc2

	c.kmsh=New kmsh
c\texy=CreateTexture(ssize,ssize,16+32)
c\mesh= CreateMesh()
c\surf  = CreateSurface(c\mesh)
PositionEntity ksh_cam,EntityX(ligt,1),EntityY(ligt,1),EntityZ(ligt,1)
PointEntity ksh_cam,offset_piv
CameraZoom ksh_cam,.06/scalex#

PositionEntity ksh_pivvy,EntityX(ligt,1),EntityY(ligt,1),EntityZ(ligt,1)
PointEntity ksh_pivvy,offset_piv
dis#=EntityDistance(ksh_pivvy,offset_piv)
ndis#=ldis#-dis#
MoveEntity ksh_pivvy,0,0,dis#+ndis#
pfox=EntityX(ksh_cam,1)-EntityX(mesh,1)
pfoy=EntityY(ksh_cam,1)-EntityY(mesh,1)
pfoz=EntityZ(ksh_cam,1)-EntityZ(mesh,1)


obx#=EntityX(offset_piv,1)
oby#=EntityY(offset_piv,1)
obz#=EntityZ(offset_piv,1)

sbx#=EntityX(ksh_pivvy,1)
sby#=EntityY(ksh_pivvy,1)
sbz#=EntityZ(ksh_pivvy,1)

bsw#=sbx#-obx#
bsh#=sby#-oby#
bsd#=sbz#-obz#

cbx#=obx#+((bsw)*.5)
cby#=oby#+((bsh)*.5)
cbz#=obz#+((bsd)*.5)


If bsw#&lt;0 Then bsw#=bsw#*-1
If bsh#&lt;0 Then bsh#=bsh#*-1
If bsd#&lt;0 Then bsd#=bsd#*-1
bsw#=bsw#+(fat#*2)
bsh#=bsh#+(hi#*2)
bsd#=bsd#+(fat#*2)




PokeFloat bank,0,cbx#
PokeFloat bank,4,cby#
PokeFloat bank,8,cbz#

PokeFloat bank,12,bsw#*.5
PokeFloat bank,16,bsh#*.5
PokeFloat bank,20,bsd#*.5


For d.kshr = Each kshr

If d\ent = offset_piv Then Goto scopym
If d\ent = mesh Then Goto scopym

RotateMesh d\ent,EntityPitch(d\ent),0,0
RotateMesh d\ent,0,EntityYaw(d\ent),0
RotateMesh d\ent,0,0,EntityRoll(d\ent)

surfaces = CountSurfaces(d\ent)

   For LOOP_Surface = 1 To Surfaces
		
		Surface_Handle = GetSurface(d\ent, LOOP_Surface)
        Tris = CountTriangles(Surface_Handle)
		
		For LOOP_Tris = 0 To Tris-1

				For LOOP_Verts = 0 To 2

					TriVertex(LOOP_Verts) = TriangleVertex(Surface_Handle, LOOP_Tris, LOOP_Verts)
					TriVx#(LOOP_Verts) = VertexX#(Surface_Handle, TriVertex(LOOP_Verts)) + EntityX(d\ent,1)
					TriVy#(LOOP_Verts) = VertexY#(Surface_Handle, TriVertex(LOOP_Verts)) + EntityY(d\ent,1)
					TriVz#(LOOP_Verts) = VertexZ#(Surface_Handle, TriVertex(LOOP_Verts)) + EntityZ(d\ent,1)

					TriVnx#(LOOP_Verts) = VertexNX#(Surface_Handle, TriVertex(LOOP_Verts))+EntityPitch(d\ent)
					TriVny#(LOOP_Verts) = VertexNY#(Surface_Handle, TriVertex(LOOP_Verts))+EntityYaw(d\ent)
					TriVnz#(LOOP_Verts) = VertexNZ#(Surface_Handle, TriVertex(LOOP_Verts))+EntityRoll(d\ent)								Next
;triangle vertices
;v0
PokeFloat bank,24,trivx#(0)
PokeFloat bank,28,trivy#(0)
PokeFloat bank,32,trivz#(0)
;v1
PokeFloat bank,36,trivx#(1)
PokeFloat bank,40,trivy#(1)
PokeFloat bank,44,trivz#(1)
;v2
PokeFloat bank,48,trivx#(2)
PokeFloat bank,52,trivy#(2)
PokeFloat bank,56,trivz#(2)

If triBox(bank) = 1
															

	For LOOP_Verts = 0 To 2			
	ShadowVertex(LOOP_Verts) = AddVertex(c\surf, TriVx#(LOOP_Verts)+(TriVnx#(LOOP_Verts)*ksh_ng#), TriVy#(LOOP_Verts)+(TriVny#(LOOP_Verts)*ksh_ng#), TriVz#(LOOP_Verts)+(TriVnz#(LOOP_Verts)*ksh_ng#))
												
	Next															
									

	AddTriangle(c\surf, ShadowVertex(0), ShadowVertex(1), ShadowVertex(2))
										
EndIf		


Next
Next
EntityAlpha c\mesh,1

RotateMesh d\ent,0,0,-EntityRoll(d\ent)
RotateMesh d\ent,0,-EntityYaw(d\ent),0
RotateMesh d\ent,-EntityPitch(d\ent),0,0

.scopym

Next

;============================================================================================
;============================================================================================
;============================================================================================


sizex#=Float(bsw*1.125)/Terrain_shadow_detail
sizez#=Float(bsd*1.125)/Terrain_shadow_detail


For e.kshr_ter = Each kshr_ter
max_x#=EntityX(e\ent)+(TerrainSize(e\ent) * e\x_scale#)
max_z#=EntityZ(e\ent)+(TerrainSize(e\ent) * e\z_scale#)

x_box_min#=cbx#-((sizex#*Terrain_shadow_detail)*.5)
x_box_max#=cbx#+((sizex#*Terrain_shadow_detail)*.5)

z_box_min#=cbz#-((sizez#*Terrain_shadow_detail)*.5)
z_box_max#=cbz#+((sizez#*Terrain_shadow_detail)*.5)


If x_box_min# &lt; max_x# Then If x_box_max# &gt; EntityX#(e\ent) Then If z_box_min# &lt; max_z Then If z_box_max# &gt; EntityZ#(e\ent) Then 

 For b=0 To Terrain_shadow_detail
  For a=0 To Terrain_shadow_detail
def_x#=cbx#-((sizex#*Terrain_shadow_detail)*.5)+(a*sizex#)
def_z#=cbz#-((sizez#*Terrain_shadow_detail)*.5)+(b*sizez#)

If def_x#&lt;EntityX#(e\ent) Then def_x#=EntityX(e\ent)
If def_x#&gt;max_x# Then def_x#=max_x#

If def_z#&lt;EntityZ#(e\ent) Then def_z#=EntityZ#(e\ent)
If def_z#&gt;max_z# Then def_z#=max_z#


y#=TerrainY(e\ent,def_x#,0,def_z#)+shakal_terrain_nudge#
mess(a,b)= AddVertex (c\surf,def_x#,y#,def_z#)


  Next
 Next

 For b=0 To Terrain_shadow_detail-1
  For a=0 To Terrain_shadow_detail-1
   AddTriangle c\surf,mess(a,b),mess(a+1,b),mess(a+1,b+1)
   AddTriangle c\surf,mess(a,b),mess(a,b+1),mess(a+1,b+1)
  Next
 Next
EndIf
Next

;============================================================================================
;============================================================================================
;============================================================================================



EntityFX mesh,8+1
EntityColor mesh,0,0,0
EntityOrder mesh,-2

HideEntity g_cam 
ShowEntity ksh_cam 

TextureBlend c\texy,3


temp_mesh=CopyEntity(mesh)
PositionEntity temp_mesh,shadbox_x,shadbox_y,shadbox_z

PositionEntity ksh_cam,shadbox_x+pfox,shadbox_y+pfoy,shadbox_z+pfoz


RenderWorld()
PositionEntity ksh_cam,EntityX(ligt,1),EntityY(ligt,1),EntityZ(ligt,1)

ShowEntity g_cam
Color 255,255,255
Rect 1,1,ssize-1,ssize-1,0
Rect 0,0,ssize,ssize,0
CopyRect 0,0,ssize,ssize,0,0,BackBuffer(),TextureBuffer(c\texy) 
For s=1 To CountSurfaces(c\mesh) 
surf=GetSurface(c\mesh,s) 
For v=0 To CountVertices(surf)-1 
TFormPoint VertexX(surf,v),VertexY(surf,v),VertexZ(surf,v),c\mesh,ksh_cam
VertexTexCoords surf,v,(TFormedX()/scalex#)/32+0.5,1-((TFormedY()/scaleX#)/32+.5)

PositionEntity ksh_sdpiv,VertexX(surf,v)+EntityX(c\mesh,1),VertexY(surf,v)+EntityY(c\mesh),VertexZ(surf,v)+EntityZ(c\mesh)
dis2# =EntityDistance(ksh_sdpiv,ksh_cam)
diss#=(ldis#-dis2#)/ldis#
dis#=1-diss#
VertexColor surf,v,(128*dis#)*2,(128*dis#)*2,(128*dis#)*2

Next 
Next 



HideEntity g_cam
ShowEntity ksh_cam 

;------------------------------------------------------------------------------------


blur_quality=blur_times
If blur_quality &gt; 0
Local blurmesh[16*4]
Local loop
Local blur_cam


	RotateEntity ksh_cam,90,0,0,True
	PositionEntity ksh_cam, blur_cam_x#, blur_cam_y#, blur_cam_z#
CameraZoom ksh_cam,1


	For loop = 0 To (blur_quality*4)-1
			blurmesh[loop] = CreateCube()
	Next
	
	blurradius#=blur_radius#*(1.0/256.0)
	bluranglestep#=360.0/Float(blur_quality*4)
	blurshade = Ceil(255.0/Float(blur_quality*4))
	
	For loop=0 To (blur_quality*4)-1
			EntityTexture blurmesh[loop],c\texy

			EntityColor blurmesh[loop],255*(1.0/Float(loop+1)),255*(1.0/Float(loop+1)),255*(1.0/Float(loop+1))

			ScaleEntity blurmesh[loop],1,.001,1
			blurangle# = bluranglestep# * Float(loop) + 180.0*(loop Mod 2)
			xoff# = blurradius# * Cos(blurangle#)
			yoff# = blurradius# * Sin(blurangle#)
			PositionEntity blurmesh[loop], blur_cam_x#+xoff#, blur_cam_y#-5.0, blur_cam_z# + yoff#, True
			If loop&gt; 1 Then EntityBlend blurmesh[loop],2
	Next
	RenderWorld
Rect 1,1,ssize-1,ssize-1,0
Rect 0,0,ssize,ssize,0

CopyRect 0,0,ssize,ssize,0,0,BackBuffer(),TextureBuffer(c\texy) 
			For loop = 0 To (blur_quality*4)-1
					FreeEntity blurmesh[loop]
			Next
	
EndIf

;--------------------------------------------------------


ShowEntity g_cam
HideEntity ksh_cam

PositionEntity ksh_cam,EntityX(ligt,1),EntityY(ligt,1),EntityZ(ligt,1)
CameraZoom ksh_cam,.06/scalex#

.skip_blur


EntityTexture c\mesh,c\texy
EntityBlend c\mesh,2
EntityFX c\mesh,1+2+8+16

EntityFX mesh,0
EntityColor mesh,128,128,128
EntityOrder mesh,0
HideEntity ksh_cam 

FreeEntity temp_mesh

.skipc2
FreeEntity shadbox
FreeEntity offset_piv
HideEntity ksh_cam

End Function

Function remove_caster(ent)
For d.kshob = Each kshob
If d\ent=ent Then Delete d
Next
End Function 

Function remove_light(ent)
For d.kshl = Each kshl
If d\ent=ent Then Delete d
Next
End Function 

Function remove_receiver(ent)
For d.kshr = Each kshr
If d\ent=ent Then Delete d
Next
End Function 

Function remove_terrain_receiver(ent)
For d.kshr_ter = Each kshr_ter
If d\ent=ent Then Delete d
Next
End Function 



;--------------------------------------------------------
; dev mode functions
;--------------------------------------------------------
Function create_dev_caster(ent,hi#,fat#,scalex#,piv_offset#)
c_cast=0
For d.ksh_d = Each ksh_d
If d\ent=ent Then c_cast=1
Next
If c_cast=1 Then Goto skip_create_caster
	d.ksh_d=New ksh_d
	d\ent=ent
	d\box=CreateCube()
	d\hi#=hi#
	d\fat#=fat#
	d\sclx#=scalex#
	d\piv=piv_offset#
ScaleEntity d\box,fat#,hi#,fat#
PositionEntity d\box,0,piv_offset#,0
EntityAlpha d\box,.5
EntityColor d\box,0,200,0
	.skip_create_caster

End Function

Function draw_dev_caster(ent,light,g_CAM,x,y)
HideEntity g_cam
ShowEntity ksh_cam
CameraViewport ksh_cam,x,y,ssize,ssize 

For d.ksh_d = Each ksh_d
If d\ent=ent Then 

PositionEntity d\box,EntityX(d\ent),EntityY(d\ent),EntityZ(d\ent)
RotateEntity d\box,EntityPitch(d\ent,1),EntityYaw(d\ent,1),EntityRoll(d\ent,1)
MoveEntity d\box,0,d\piv,0
RotateEntity d\box,0,0,0

offsetpiv=CreatePivot()

PositionEntity offsetpiv,EntityX(d\ent,1),EntityY(d\ent,1),EntityZ(d\ent,1)
RotateEntity offsetpiv,EntityPitch(d\ent,1),EntityYaw(d\ent,1),EntityRoll(d\ent,1)

MoveEntity offsetpiv,0,d\piv,0


PositionEntity ksh_cam,EntityX(light,1),EntityY(light,1),EntityZ(light,1)
PointEntity ksh_cam,offsetpiv
CameraZoom ksh_cam,.06/d\sclx#

RenderWorld()
Color 255,255,255
Rect x+1,y+1,ssize-1,ssize-1,0
Rect x,y,ssize,ssize,0

Text x,y-25,"scaleX: " + d\sclx#
Text x,y-15,"pivot offset: " + d\piv
EndIf

Next
HideEntity ksh_cam
ShowEntity g_cam
End Function 

Function show_dev_caster(ent)
For d.ksh_d = Each ksh_d
If d\ent=ent Then ShowEntity d\box
Next
End Function 

Function hide_dev_caster(ent)
For d.ksh_d = Each ksh_d
If d\ent=ent Then HideEntity d\box
Next
End Function 

Function remove_dev_caster(ent)
For d.ksh_d = Each ksh_d
If d\ent=ent Then FreeEntity d\box : Delete d
Next
End Function </pre><br><br><br>(oh... this is just a patch I guess... you still need a download of a shaKAL library... just look downwards) <br><br> ---------------------<br>my current projects:<br><br>...*shrugs*<br>Learning SDL via DevC++ </td></tr></tbody></table><br><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr><td class="posthead"><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr><td>new download, first version</td><td align="right"><font class="tiny">(Posted 2006-11-27)</font></td></tr></tbody></table></td></tr><tr><td class="posttext"> YAY! I finally placed up a new download for shaKAL.<br><a href="http://www.filelodge.com/files/room17/427152/shaKAL%20v01.zip" target="_blank">http://www.filelodge.com/files/room17/427152/shaKAL%20v01.zip</a><br><br>this is version 0.1<br>(yup.... finally gonna start giving them numbers)<br>this has the new library, the old tutorial, and a demonstration of the new terrain receivers.<br>I'm in a rush... but I hope this is helpful :) <br><br> ---------------------<br>my current projects:<br><br>...*shrugs*<br>Learning SDL via DevC++ </td></tr></tbody></table><br><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr><td class="posthead"><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr><td>A new goal</td><td align="right"><font class="tiny">(Posted 2006-11-24)</font></td></tr></tbody></table></td></tr><tr><td class="posttext"> yup... just like my new goal for deKAL<br>(hey, c'mon... they work off the same basis! it's just that one is constantly updated!)<br><br>I'm going to add terrain shadows! (for blitz terrains)<br>wouldn't that be nifty?<br>Like
 I said in my deKAL log... I've played some Halo recently and WAY too 
much MorrowWind... I think the blitzterrains are very underused in blitz
 games... and it's because  they seem sooooo uncompatible with so many 
things I guess... (good shadows, accurate normal mapping, physics... 
blah blah... blah!)<br>I've figured out how to work it... I just need to add it into shaKAL. It will work alot like towl meshing.<br>So
 towl meshing for terrains, box collision detected meshes for mesh 
receivers... but the textures will work the same way (same way of 
calculating the uv map)<br><br>Well... Hope this will help... I'll get to work ASAP so I can upload a working demo (with source) ASAP.<br><br>REALLY hoping I can help the comunity in some way...<br>because they help me LOTS! <br><br> ---------------------<br>my current projects:<br><br>...*shrugs*<br>Learning SDL via DevC++ </td></tr></tbody></table><br><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr><td class="posthead"><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr><td>FOUR PART TUTORIAL!!! + updated library.</td><td align="right"><font class="tiny">(Posted 2006-11-12)</font></td></tr></tbody></table></td></tr><tr><td class="posttext"> Yup, here's a four part tutorial on adding my library to a scene...<br><a href="http://www.filelodge.com/files/room17/427152/demonstration.zip" target="_blank">http://www.filelodge.com/files/room17/427152/demonstration.zip</a><br><br>I hope this is easy to understand,<br>all opensource, I hope someone can find this useful :)<br>you'll need to get the required *.decls &amp; *.dll to work with this at:<br>www.blitzbasic.com/codearcs/codearcs.php?code=1191<br><br>good luck, and thankyou for reading :)<br>-Kevin Laherty <br><br> ---------------------<br>my current projects:<br><br>...*shrugs*<br>Learning SDL via DevC++ </td></tr></tbody></table><br><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr><td class="posthead"><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr><td>another download. Plus dev mode functions.</td><td align="right"><font class="tiny">(Posted 2006-11-08)</font></td></tr></tbody></table></td></tr><tr><td class="posttext"> ERG! the newest download is like 3.2 meg :(<br>anywho, I've included "development mode" functions...<br>mainly "create_dev_caster", which creates a fake caster...<br>instead
 of casting a shadow, it creates a green box around the object to show 
the height and width settings for the caster. And "Draw_dev_caster" 
which renders what the shadow camera is seeing so you can see the 
scaleing and camera zoom better... (to make sure the object sits inside 
the viewport)<br><br>here it is:<br><a href="http://www.filelodge.com/files/room17/427152/newer%20test.zip" target="_blank">http://www.filelodge.com/files/room17/427152/newer%20test.zip</a><br>Hope this helps. <br><br> ---------------------<br>my current projects:<br><br>...*shrugs*<br>Learning SDL via DevC++ </td></tr></tbody></table><br><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr><td class="posthead"><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr><td>new download</td><td align="right"><font class="tiny">(Posted 2006-11-07)</font></td></tr></tbody></table></td></tr><tr><td class="posttext"> <a href="http://www.filelodge.com/files/room17/427152/new%20test.zip" target="_blank">http://www.filelodge.com/files/room17/427152/new%20test.zip</a><br><br>This has the new commands that I talked about in it as well as bluring.<br>Hope it works well.<br><br>I have alot of work to do on this tonight.<br>I hope I can give an update tomorrow. <br><br> ---------------------<br>my current projects:<br><br>...*shrugs*<br>Learning SDL via DevC++ </td></tr></tbody></table><br><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr><td class="posthead"><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr><td>quick update</td><td align="right"><font class="tiny">(Posted 2006-11-07)</font></td></tr></tbody></table></td></tr><tr><td class="posttext"> last night I opened up my library and noticed I was missing some really simple and IMPORTANT commands.. :o<br>so I added "remove_caster" and "remove_light" commands.<br><br>I also played with a blur effect...<br>it
 just re-rendered the texture on a box and added 2 layers on-top of 
it... then looped for the amount of blurring you asked for. It looked 
nice with a quick 1X blur... but the more blurring made an offset with 
the texture and made the shadow look wrong...<br>Well I printed off the blurtexture() command from the archives (by Sswift)... thankyou to devils child to pointing it out :D<br><br>I'll update and post a new download soon. <br><br> ---------------------<br>my current projects:<br><br>...*shrugs*<br>Learning SDL via DevC++ </td></tr></tbody></table><br><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr><td class="posthead"><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr><td>first post - early progress</td><td align="right"><font class="tiny">(Posted 2006-11-05)</font></td></tr></tbody></table></td></tr><tr><td class="posttext"> Hey y'all...<br>This is my first worklog... I hope this project goes well...<br>this is all open source...<br><br>here is a REALLY early shot I did:<br><img src="7897&amp;log=1395_files/shtexte.html"><br><br>(progress was killed for a while.... my computer died... but I got a new one last week... and started work again 2 days ago)<br><br>I did alot of work last night, and now it looks more like this:<br><img src="7897&amp;log=1395_files/shad1.html"><br><br>you can download my current progress here: (watch out... it's a slow download :( )<br><a href="http://www.filelodge.com/files/room17/427152/showcase%20shadows.zip" target="_blank">http://www.filelodge.com/files/room17/427152/showcase%20shadows.zip</a><br><br>Special thanx to the following people:<br><br>Tomas Moller &amp; elias_t     - for giving the box&gt;polygon <br>                             collision detection to the<br>                             blitz comuntity :D<br><br>TigerZ                     -for donating the kickass<br>                            3d model balchak to this<br>                            project!<br><br>to get in touch with me,<br>you can Email: kalisme@...<br><br>and to see my site, you can visit: www.kalisme.tk<br><br>I hope I am helpful,<br>thanx for reading,<br>     -Kevin Amos Laherty<br><br>-oh... quick add... I forgot to add:<br>Get the required *.decls &amp; *.dll to work with this at:<br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=1191" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=1191</a><br><br>or:<br>www.freewebs.com/elias_t/tribox_dll.zip <br><br> ---------------------<br>my current projects:<br><br>...*shrugs*<br>Learning SDL via DevC++ </td></tr></tbody></table><br></div><table width="100%"><tbody><tr><td></td></tr></tbody></table></body></html>