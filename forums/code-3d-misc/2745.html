<!DOCTYPE html><html lang="en" ><head ><title >Verlet intergration Lib</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='Simple Verlet Library with by-passable physics., language=bb, category=3D Graphics - Misc'><meta name='author' content='MusicianKool'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 ><a href=codearcs.php>Code archives</a>/<a href=codearcs.php?cat=2>3D Graphics - Misc</a>/Verlet intergration Lib</h1><div class="quote">This code has been declared by its author to be Public Domain code.</div><br><a href="2745.bb">Download source code</a><br><br><table width="100%" cellspacing="0" cellpadding="0"><tr ><td width="100%"><table width=100% cellspacing=0 cellpadding=0><tr ><td class=headleft></td><td class=head><table width=100% cellspacing=0 cellpadding=0><tr ><td >Verlet intergration Lib by MusicianKool</td><td align="right">2010 </td></tr></table></td><td class=headright></td></tr></table></td></tr><tr ><td class="cell"> Download here: <a href="http://www.mediafire.com/?q7t31qc8lk329f6" target="_blank">http://www.mediafire.com/?q7t31qc8lk329f6</a>  : Verlet.rar<br><br>To run the example you will also need: <a href="http://www.mediafire.com/?w2v7phqmmyclzq0" target="_blank">http://www.mediafire.com/?w2v7phqmmyclzq0</a>  :CoordinateSystems.rar<br><br>(fixed) oops need to add deleting uh uh. just a min / hour.<br><br>Example:<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
SeedRnd MilliSecs()

Graphics3D 800,600,32,2
SetBuffer BackBuffer()

Global Angle#
Global Thrust# = 80
number_of_people = 10
Global camera = CreateCamera()
PositionEntity camera,0,0,-400
Global light = CreateLight()
Type enemy
	Field entity
	Field name
	Field health
End Type
Const STATIC = 1
Const DYNAMIC = 2
Collisions DYNAMIC,STATIC,2,2
SetVerlet_Default_RestLength(20)  ; change this to make the length of lines longer or smaller at rest.

For i = 1 To 100
	e.enemy = New enemy
	e\entity = CreateCube()
	e\name = Handle(e)
	e\health = 10
	NameEntity(e\entity,e\name)
	EntityColor e\entity,255,0,0
	ScaleEntity e\entity,Rand(5,10),Rand(5,10),Rand(5,10)
	EntityType e\entity,STATIC
	PositionEntity e\entity,Rand(-300,300),Rand(-200,200),0
Next



; Create the verlet humanoid thing
Global Head = CreateVerletPoint(0,0,0,1.6)
SetVerlet_GravDirection(Head,0,-1,0)
Global leftSholder = CreateVerletPoint(0,0,0,.5)
SetVerlet_GravDirection(leftSholder,1,0,0)
Global rightSholder = CreateVerletPoint(0,0,0,.5)
SetVerlet_GravDirection(rightSholder,-1,0,0)
Global leftBicept = CreateVerletPoint(0,0,0,.1)
SetVerlet_GravDirection(leftBicept,0,1,0)
Global leftForeArm = CreateVerletPoint(0,0,0,.1)
SetVerlet_GravDirection(leftForeArm,0,1,0)
Global LeftHand = CreateVerletPoint(0,0,0,.5)
SetVerlet_GravDirection(LeftHand,0,1,0)
Global rightBicept = CreateVerletPoint(0,0,0,.1)
SetVerlet_GravDirection(rightBicept,0,1,0)
Global rightForeArm=CreateVerletPoint(0,0,0,.1)
SetVerlet_GravDirection(rightForeArm,0,1,0)
Global rightHand = CreateVerletPoint(0,0,0,.5)
SetVerlet_GravDirection(rightHand,0,1,0)
Global Chest = CreateVerletPoint(0,0,0,.1)
SetVerlet_GravDirection(chest,0,1,0)
Global Abdomen = CreateVerletPoint(0,0,0,.1)
SetVerlet_GravDirection(abdomen,0,1,0)
Global Pelvis = CreateVerletPoint(0,0,0,.1)
SetVerlet_GravDirection(Pelvis,0,1,0)
Global leftHip = CreateVerletPoint(0,0,0,.5)
SetVerlet_GravDirection(leftHip,1,0,0)
Global rightHip = CreateVerletPoint(0,0,0,.5)
SetVerlet_GravDirection(rightHip,-1,0,0)
Global leftThigh = CreateVerletPoint(0,0,0,.1)
SetVerlet_GravDirection(leftThigh,0,1,0)
Global leftCalf = CreateVerletPoint(0,0,0,.1)
SetVerlet_GravDirection(leftCalf,0,1,0)
Global leftFoot = CreateVerletPoint(0,0,0,1)
SetVerlet_GravDirection(leftFoot,0,1,0)
Global RightThigh = CreateVerletPoint(0,0,0,.1)
SetVerlet_GravDirection(RightThigh,0,1,0)
Global RightCalf = CreateVerletPoint(0,0,0,.1)
SetVerlet_GravDirection(RightCalf,0,1,0)
Global RightFoot = CreateVerletPoint(0,0,0,1)
SetVerlet_GravDirection(RightFoot,0,1,0)

Global HeadPiv = CreatePivot()
Global PHead = CreateCone(8,1,HeadPiv)
PositionEntity PHead,0,1,0
EntityType HeadPiv,DYNAMIC
ScaleEntity HeadPiv,5,15,5

Global footright = CreateSphere()
EntityType footright,DYNAMIC

Global footleft = CreateSphere()
EntityType footleft,DYNAMIC

ScaleEntity footright,5,5,5
ScaleEntity footleft,5,5,5

Global handleft = CreateSphere()
EntityType handleft,DYNAMIC

Global handright = CreateSphere()
EntityType handright,DYNAMIC

ScaleEntity handleft,5,5,5
ScaleEntity handright,5,5,5

;head
CreateVerletConnection(Head,Chest)
;right leg
CreateVerletConnection(RightFoot,RightCalf)
CreateVerletConnection(RightCalf,RightThigh)
CreateVerletConnection(RightThigh,rightHip)
CreateVerletConnection(rightHip,Pelvis)
;left leg
CreateVerletConnection(leftFoot,leftCalf)
CreateVerletConnection(leftCalf,leftThigh)
CreateVerletConnection(leftThigh,leftHip)
CreateVerletConnection(leftHip,Pelvis)
;mid body
CreateVerletConnection(Chest,Abdomen)
CreateVerletConnection(Abdomen,Pelvis)
;right arm
CreateVerletConnection(rightHand,rightForeArm)
CreateVerletConnection(rightForeArm,rightBicept)
CreateVerletConnection(rightBicept,rightSholder)
CreateVerletConnection(rightSholder,Chest)
;left arm
CreateVerletConnection(LeftHand,leftForeArm)
CreateVerletConnection(leftForeArm,leftBicept)
CreateVerletConnection(leftBicept,leftSholder)
CreateVerletConnection(leftSholder,Chest)

SetVerlet_GravityForce(10)

While Not KeyHit( 1 )
    Cls
    GetInput()
    ApplyVerletPhysics()
    For i = 1 To GetVerlet_NumberOfVerletPoints()
    	SetVerlet_AccelZ(i,0)
    	SetVerlet_PointZ(i,0)
    Next
	Verlet()
	ConstrainVerletMass()
	Draw3DVerlet()
	UpdateWorld()
	If EntityCollided(HeadPiv,STATIC) Then 
		e.enemy = Object.enemy(	EntityName(EntityCollided(HeadPiv,STATIC)))
		SetVerlet_AccelX(Head,0):SetVerlet_AccelY(Head,0)
		SetVerlet_PointXYZ(Head,GetVerlet_OldX(Head),GetVerlet_OldY(Head),GetVerlet_OldZ(Head))
		e\health = e\health -1
		If e\health&lt;= 0 Then
			e\health = 10
			PositionEntity(e\entity,Rand(-300,300), Rand(-200,200),0)
		EndIf
	EndIf
	If EntityCollided(footright,STATIC) Then 
		e.enemy = Object.enemy(	EntityName(EntityCollided(footright,STATIC)))
		SetVerlet_AccelX(RightFoot,0):SetVerlet_AccelY(RightFoot,0)
		SetVerlet_PointXYZ(RightFoot,GetVerlet_OldX(RightFoot),GetVerlet_OldY(RightFoot),GetVerlet_OldZ(RightFoot))
		e\health = e\health -1
		If e\health&lt;= 0 Then
			e\health = 10
			PositionEntity(e\entity,Rand(-300,300), Rand(-200,200),0)
		EndIf
	EndIf
	If EntityCollided(footleft,STATIC) Then 
		e.enemy = Object.enemy(	EntityName(EntityCollided(footleft,STATIC)))
		SetVerlet_AccelX(leftFoot,0):SetVerlet_AccelY(leftFoot,0)
		SetVerlet_PointXYZ(leftFoot,GetVerlet_OldX(leftFoot),GetVerlet_OldY(leftFoot),GetVerlet_OldZ(leftFoot))
		e\health = e\health -1
		If e\health&lt;= 0 Then
			e\health = 10
			PositionEntity(e\entity,Rand(-300,300), Rand(-200,200),0)
		EndIf
	EndIf
	If EntityCollided(handright,STATIC) Then 
		e.enemy = Object.enemy(	EntityName(EntityCollided(handright,STATIC)))
		SetVerlet_AccelX(rightHand,0):SetVerlet_AccelY(rightHand,0)
		SetVerlet_PointXYZ(rightHand,GetVerlet_OldX(rightHand),GetVerlet_OldY(rightHand),GetVerlet_OldZ(rightHand))
		e\health = e\health -1
		If e\health&lt;= 0 Then
			e\health = 10
			PositionEntity(e\entity,Rand(-300,300), Rand(-200,200),0)
		EndIf
	EndIf
	If EntityCollided(handleft,STATIC) Then 
		e.enemy = Object.enemy(	EntityName(EntityCollided(handleft,STATIC)))
		SetVerlet_AccelX(LeftHand,0):SetVerlet_AccelY(LeftHand,0)
		SetVerlet_PointXYZ(LeftHand,GetVerlet_OldX(LeftHand),GetVerlet_OldY(LeftHand),GetVerlet_OldZ(LeftHand))
		e\health = e\health -1
		If e\health&lt;= 0 Then
			e\health = 10
			PositionEntity(e\entity,Rand(-300,300), Rand(-200,200),0)
		EndIf
	EndIf
	
	RenderWorld()
	Draw2DVerlet()
	
		;Framecounter--------------------------------------------
	Framecounter_counter=Framecounter_counter+1
	If Framecounter_time=0 Then Framecounter_time=MilliSecs()
	If Framecounter_time+1001 &lt;MilliSecs() Then
		Framecounter_framerate=Framecounter_counter
		Framecounter_counter=0
		Framecounter_time=MilliSecs()
	EndIf
	Locate 0,0:Color 255,255,255
	Print "FPS: " + Framecounter_framerate
		;========================================================
		
    Flip
Wend

End

Function Draw3DVerlet()

	; Position head
	PositionEntity HeadPiv,GetVerlet_PointX(Head),-GetVerlet_PointY(Head),GetVerlet_PointZ(Head)
	RotateEntity HeadPiv,0,0,Angle

	; draw ball at the end of each apendage
	Cartesian(0,0,0,GetVerlet_PointX(leftFoot) ,GetVerlet_PointY(leftFoot) ,GetVerlet_PointZ(leftFoot))
	PositionEntity footleft,Cartesian_X(),-Cartesian_Y(),Cartesian_Z()

	Cartesian(0,0,0,GetVerlet_PointX(RightFoot) ,GetVerlet_PointY(RightFoot) ,GetVerlet_PointZ(RightFoot))
	PositionEntity footright,Cartesian_X(),-Cartesian_Y(),Cartesian_Z()

	Cartesian(0,0,0,GetVerlet_PointX(LeftHand) ,GetVerlet_PointY(LeftHand) ,GetVerlet_PointZ(LeftHand))
	PositionEntity handleft,Cartesian_X(),-Cartesian_Y(),Cartesian_Z()

	Cartesian(0,0,0,GetVerlet_PointX(rightHand) ,GetVerlet_PointY(rightHand) ,GetVerlet_PointZ(rightHand))
	PositionEntity handright,Cartesian_X(),-Cartesian_Y(),Cartesian_Z()

End Function

Function Draw2DVerlet()
		; draw body
	Color 255,0,0
	For i = 1 To GetVerlet_NumberOfVerletPoints()
        Cartesian(0,0,0,GetVerlet_PointX(i),GetVerlet_PointY(i),GetVerlet_PointZ(i))
        Project_3Dto2D(400,300,300,Cartesian_X(),Cartesian_Y(),Cartesian_Z(),EntityZ(camera),EntityZ(camera))
        LX# = Projected_X()
        LY# = Projected_Y()
        
        Cartesian(0,0,0,GetVerlet_ConnectedX(i),GetVerlet_ConnectedY(i),GetVerlet_ConnectedZ(i))
        Project_3Dto2D(400,300,300,Cartesian_X(),Cartesian_Y(),Cartesian_Z(),EntityZ(camera),EntityZ(camera))
        Line LX,LY,Projected_X(),Projected_Y()
    Next
    ; white dots, for clarity
	Color 255,255,255
	For i = 2 To GetVerlet_NumberOfVerletPoints()-1
		Cartesian(0,0,0,GetVerlet_PointX(i) ,GetVerlet_PointY(i) ,GetVerlet_PointZ(i))
		Project_3Dto2D(400,300,300,Cartesian_X(),Cartesian_Y(),Cartesian_Z(),EntityZ(camera),EntityZ(camera))
		Plot Projected_X(),Projected_Y()
	Next
End Function

Function GetInput()

	If KeyDown( 203 )
		;rotate
		Angle = Angle + 5
	EndIf

	If KeyDown( 205 )
		;rotate
		Angle = Angle - 5
	EndIf

	If KeyDown( 200 )
		;thrust, adjust head verlet acceleration
		SetVerlet_AccelX(head, GetVerlet_AccelX(head) - Sin( Angle ) * Thrust)
		SetVerlet_AccelY(head, GetVerlet_AccelY(head) - Cos( Angle ) * Thrust)
	EndIf
	
	If KeyDown( 208 )
		;thrust, adjust head verlet acceleration
		SetVerlet_AccelX(Head, GetVerlet_AccelX(Head) - Sin( Angle ) * -Thrust)
		SetVerlet_AccelY(Head, GetVerlet_AccelY(Head) - Cos( Angle ) * -Thrust)
	EndIf
End Function
</textarea> </td></tr><tr ><td class="cell"><pre class="code">Function List.

.lib "verlet.dll"
;Globals
SetVerlet_Config%(Time#,Force#,Drag#,Length#)
SetVerlet_TimeStep%(Time#)
SetVerlet_Default_RestLength%(Length#)
SetVerlet_GravityForce%(Force#)
SetVerlet_Drag%(Drag#)
GetVerlet_TimeStep#()
GetVerlet_Default_RestLength#()
GetVerlet_GravityForce#()
GetVerlet_NumberOfVerletPoints%()

;Verlet stuff
SetVerlet_GravDirection%(Index%,X_axis#,Y_axis#,Z_axis#)

SetVerlet_AccelX%(index% , Velocity#)
SetVerlet_AccelY%(index% , Velocity#)
SetVerlet_AccelZ%(index% , Velocity#)
SetVerlet_AccelXYZ%(Index%, X_Vel#,Y_Vel#,Z_Vel#)

SetVerlet_PointX%(Index% , X_Location#)
SetVerlet_PointY%(Index% , Y_Location#)
SetVerlet_PointZ%(Index% , Z_Location#)
SetVerlet_PointXYZ%(Index%, X#,Y#,Z#)

SetVerlet_OldX%( Index% , X_Location# )
SetVerlet_OldY%( Index% , Y_Location# )
SetVerlet_OldZ%( Index% , Z_Location# )
SetVerlet_OldXYZ%( Index% , X_Location#, Y_Location#, Z_Location#)

SetVerlet_Name%( Index% , Name$ )
GetVerlet_Name$( Index% )

SetVerlet_RestLength( Index% , Length# )
GetVerlet_RestLength#( Index% )

GetVerlet_AccelX#(index%) 
GetVerlet_AccelY#(index%)
GetVerlet_AccelZ#(index%)

GetVerlet_PrevIndex%(Index%)
GetVerlet_NextIndex%(Index%)


GetVerlet_PointX#( Index% )
GetVerlet_PointY#( Index% )
GetVerlet_PointZ#( Index% )

GetVerlet_OldX#( Index% )
GetVerlet_OldY#( Index% )
GetVerlet_OldZ#( Index% )

GetVerlet_ConnectedX#( Index% )
GetVerlet_ConnectedY#( Index% )
GetVerlet_ConnectedZ#( Index% )

;Creation stuff
CreateVerletPoint%(X#,Y#,Z#,Mass#) 
CreateVerletConnection( Index1% , Index2%)
DeleteVerletPoint%( Index% )

;MainEngine stuff
Verlet%()
ConstrainVerletMass%()
ApplyVerletPhysics%()</pre></td></tr></table><br><a name="comments">Comments</a><br><br>None.<br><br><a href="codearcs.php" >Code Archives Forum</a><table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
