<!DOCTYPE html><html lang="en" ><head ><title >how to patch a map file (save file)</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >how to patch a map file (save file)</h1><a href="forums.php" >Community Forums</a>/<a href="topics.php?forum=125" >General Help</a>/<a href="#bottom" >how to patch a map file (save file)</a><br><br>
<a name="1330276"></a>

<a name="1330277"></a>

<a name="1330278"></a>

<a name="1330279"></a>

<a name="1330282"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello,<br><br>(the longer number of characters allowed in the title is appreciated, thanks skidracer ! :) )<br><br>I am working on a map editor.<br><br>There are different kinds (lists) of entities (entryexits, terrains, statics, interactables, lightsources, takables, turningmovings) (the names don't matter)<br><br>I can create a new map, save a map, save a map as, close a map, load a map.<br>The map is saved by writing, for each kind (list), the count of entities of this kind, for each entity, its properties (modelname, position, orientation, tag) <br>The map is loaded by reading, for each kind (list), the count of entities of this kind, for each entity, its properties (modelname, position, orientation, tag) <br><br>All works well, great !<br><br>Now, sometimes i decide to rename a model name, or to remove a model from the map editor, and if you work for several hours on a map but then you can't load it because you have renamed/removed a model, that's bad...<br><br>So i decided to code a "map file patch program" where you can define which entities (identifiable by their model name) you want to rename/remove in the map (with for each, its kind (list), its model name, the operation wanted (rename or remove)), and then the program will analyze an existing map file (similar than loading a map), and rename or remove some entities from the map.<br><br>I already know how to do it and it should work, i am just curious how you would do that ? The idea is to be able to load an old map file even if some models have been altered or removed from the map editor.<br><br>Thanks, <br><br></td></tr></table><br>
<a name="1330291"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I use bruceys TPersistence to serialize my object data into "savegames".<br><br>I patched this mod to:<br>- have a generic de/serializer which is called if the found "type" is no longer defined (eg. removed or renamded)<br>- - the de/serializer handles incoming "data-arrays" and creates the new/renamed type instance by hand<br>- each type could have a "serializedTypeNameToString()" and "deserializeTypeNameFromString:TypeName()" - which is called instead of bruceys TPersistence-de/serializer<br><br><br>So I could - if really needed - make my savegames compatible to newer revisions.<br><br><br>In your case:<br>store them as json/xml and just skip whatever is no longer supported.<br>For all supported ones you just need to have to register "synonyms": store a list of all known "ttypenames" (or even "ttypename-&gt;typenamehandler", "toldtypename-&gt;typenamehandler" ....).<br>Then during loading of your map, you ask your registered handlers whether they are interested in the stored data or not.<br><br>No patching needed - you just need to store in your code all these "renames" of types. removed types are just no longer handled by the savegame. And if a type got joined with another, then this new type just needs to register a handler for "old type" too.<br><br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1330301"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I did not understood everything that you wrote, but thanks for the tips.<br><br>This made me realize again how important it is to backup your datas (progress) regularly, because i was able to debug the content of an old mapfile (since i have the old loading code to know how to read the file), and then i coded a procedure to modify some old models names into new models names, and apparently it worked !<br>(without a backup and the old loading code, i would have not managed to retrieve the old models names and the map would have stayed incompatible with the new version of my map editor (using a new saving/loading code and new models names) <br><br></td></tr></table><br>
<a name="1330318"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you write "readable" files (like XML, Json ...) then you could analyze the content while reading.<br><br>&lt;toldtype&gt;<br>-&gt; load content but create "tnewtype" out of it, eg. create the newly introduced TVec2D out of toldtype.x and toldtype.y <br><br>&lt;tnewtype&gt;<br>-&gt; load content too, without further "data updates".<br><br><br><br>It is also good to store some kind of "version number" in your map file. So you could even write "loaders" for each version (or each "compatibility breaking change").<br><br>v1 -&gt; LoadV1Map()<br>v2 -&gt; LoadV2Map()<br>...<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1330361"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>It is also good to store some kind of "version number" in your map file. So you could even write "loaders" for each version (or each "compatibility breaking change").<br> <br></div><br>good idea, thanks <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
