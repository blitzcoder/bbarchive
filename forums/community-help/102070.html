<!DOCTYPE html><html lang="en" ><head ><title >Expected behaviour of 'For' loop</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Expected behaviour of 'For' loop</h1><a href="forums.php" >Community Forums</a>/<a href="topics.php?forum=125" >General Help</a>/<a href="#bottom" >Expected behaviour of 'For' loop</a><br><br>
<a name="1216160"></a>

<a name="1216161"></a>

<a name="1216164"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hiya,<br><br>The following 'for' statement :-<br><br><pre class=code>
Local i:Int
For i = 0 Until Func(i)
Next

Function Func(a:Int)
	Return a + 1
EndFunction
</pre><br><br>What's your thoughts on the expected behaviour of using Func(i) as the terminating value?<br><br>Should the terminating value be evaluated before the loop starts or keep evaluating during each iteration of the loop? <br><br></td></tr></table><br>
<a name="1216162"></a>

<a name="1216165"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> <strike>I don't understand?  Are you saying it shouldn't accept a function call as a parameter?</strike>Oh, you edited it.<br><br>Um... I'd expect it to only be evaluated once. <br><br></td></tr></table><br>
<a name="1216166"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> My mistake.. I posted too early by accidently hitting the tab then return. I've edited it now. <br><br></td></tr></table><br>
<a name="1216168"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm... seems to be working as I'd expect it to?  You expecting something different to happen?<br><pre class=code>Local i:Int
For i = 1 Until Func(i)
	Print "Bumeyes"
Next

Function Func(a:Int)
	Return a + 20
EndFunction</pre> <br><br></td></tr></table><br>
<a name="1216171"></a>

<a name="1216172"></a>

<a name="1216173"></a>

<a name="1216175"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Not really, I was asking for opinions for what seems/feels right.<br><br>I'm writing a compiler and was interested in what a programmer would expect to happen when the iterator of the for loop is used as a parameter in the terminator function value. I can choose either way as the compiler outputs c++ - giving a choice of behaviors. <br><br></td></tr></table><br>
<a name="1216182"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've actually decided to go the other way - re-evaluate the func each iteration. It gives the best of both making for the option of a little more power and expression in the language. If you only want it evaluated once then it's easy to stick the result in a local before the loop and use the local as the terminator. <br><br></td></tr></table><br>
<a name="1216186"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Glad my advice helped! :P <br><br></td></tr></table><br>
<a name="1216197"></a>

<a name="1216198"></a>

<a name="1216199"></a>

<a name="1216204"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> If there's still time to offer opinions, I'd agree with GfK here, for two reasons:<br><br>1) 'For' usually implies 'For each in'; i.e. that it is for iterating over a collection of some kind (where the integer 'to' form is just a special case or optimisation of the primary list form that recognises a range+step as an abstract list). So if you put a function call in that position to something iterating over an object collection, you wouldn't expect a whole new collection to be returned each time. (If you do want something new to happen in the call each frame to get the next element, that's usually why we have things like ObjectEnumerator, or generators in other languages.)<br><br>2) We already have a standard construct dedicated to having a function get called again each time to see if something changed - 'While'. May as well differentiate them as much as you can.<br><br>...and add that C's 'for' is a bit of a special case - it's not <i>really</i> a high-level construct at all, without the same intent behind it as the similarly-named thing in other languages, so beware of potentially being misled by it.<br><br><br>EDIT: actually I can think of a third, too, which I believe is the same reasoning Mark gave for changing the behaviour between BlitzPlus and BlitzMax: <i>optimise for the common case</i>. Most loops will be integer loops over fixed bounds; shorter, clearer and therefore <i>objectively better</i> code will not waste a local on a single space, and thus put the function call in the 'To' position; so if you default to rerunning the target bound every frame, you're punishing the user for writing good code. A good compiler <i>absolutely must</i> never demand that the user hand-optimise their code for better performance - it's supposed to be trying as hard as it can to do that automatically. If you have to put in the docs "write like this for better results", that should technically count as a compiler <i>bug</i>.<br><br>(I should also point out that this situation actually links back really well to your previous question - a purity-analysis and flow-analysis pass can make this question irrelevant in 99% of realistic code if you do go with the second behaviour.) <br><br></td></tr></table><br>
<a name="1216210"></a>

<a name="1216214"></a>

<a name="1216216"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm...<br><br>2 against 1 at the moment :)<br>To be honest I dont mind either. And I see yours and GfKs points.<br><br>The way I have it at the moment it as Max is :-<br><br>for &lt;ident of int/float&gt; = &lt;expression of int/float&gt; To/Until &lt;expression of int/float&gt; step &lt;expression of int/float&gt;<br><br>The 'step' is optional as one may expect.<br>As you can see the expressions must equate to int/float for the statement to be valid. Of course, a function return result can be used as, or part of, an expression so the return result must still be an int/float. There are no objects/arrays/collections allowed to be used in the statement at all ( apart from object members/functions that still follow the above rule ).<br><br>So I was just in 2 minds whether to allow the function be called each iteration or just the once during the initial first iteration. I was thinking this could be more of feature and most definitely not a requirement. For regular integers/floats in the statement it will behave exactly how you expect.<br><br>Now thinking about it some more - I'm in 2 minds again :D<br><br>What is difference between Max and Plus in this respect? I have 'Plus but I don't think I've ever used it. <br><br></td></tr></table><br>
<a name="1216219"></a>

<a name="1216221"></a>

<a name="1216224"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> What is difference between Max and Plus in this respect? <br></div><br><br>BlitzMax evaluates the expression once before the loop begins. BlitzPlus - and the linguistically-identical compilers that came before it - evaluates it repeatedly before each run through the loop body. So you have both templates there to look at.<br><br>BlitzMax is the one that generalised For to mean collections, and provided ObjectEnumerator; in the Classic language, For/Each iterates over a builtin global list for each user-defined type, so there is no expression for it to repeat a call to; For/To and For/Each are completely conceptually unrelated over there.<br><br><br>Note also that your original example would normally be either iffy or even wrong in BlitzMax proper (because Max introduces a limited form of scope nesting): since the controlling expression happens before the loop, Func(i) is <i>outside the scope of</i> the actual definition of i; if you'd used For Local this would (probably*) be a variable Not Defined error, or connect to the wrong variable; and in non-Strict would probably be undefined. In Classic this is a nonissue because scopes are not nested.<br><br>* can't be bothered to check but if it's not an error, it's an inconsistency in the language definition. <br><br></td></tr></table><br>
<a name="1216241"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>Note also that your original example would normally be either iffy or even wrong in BlitzMax proper (because Max introduces a limited form of scope nesting): since the controlling expression happens before the loop, Func(i) is outside the scope of the actual definition of i; if you'd used For Local this would (probably, won't check) be a variable Not Defined error, or connect to the wrong variable; and in non-Strict would probably be undefined. In Classic this is a nonissue because scopes are not nested.<br> <br></div><br><br>'Max does error. I have this same behaviour.<br>I think I'll leave it as it is for time being. <br><br></td></tr></table><br>
<a name="1216242"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Shouldn't for-loops be "pre-evaluated" (constant) while a WHILE-WEND/REPEAT-UNTIL loop evaluates each loop?<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1216271"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, obviously not 'constant' by definition but I know what you mean and it seems thats the general expectation so far :)<br><br>I think it depends on the implementation and the language designer as to whether to have re-evaluation on each iteration. I just quickly checked out how Monkey handles it and its the same as previous Blitz*name* languages - it re-evaluates a function call expression each iteration. <br><br></td></tr></table><br>
<a name="1216275"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Re-Evaluation is complicating some situations (adding need for previous variable declaration)<br><br>Surely there is advantage in "for eachin EnumeratorFunction()" but most of the times I use the for loop is when the "eachin X" corresponds to something non-changing-during-loop (changes to that object should be added "at the end").<br><br>If I do not know if that X changes I use a While-Wend with a "counter", so I do it as long as a Getter(counter) returns something.<br><br><br>Just have seen how Monkey (or Diddy) does Lists... seems more complicated to me than needed. Sure...it adds more potential but therfor - like said - I would use RepeatUntil or WhileWend. As they by definition are loops with condition checking - so coders would assume that the condition is rechecked every loop.<br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1216319"></a>

<a name="1216320"></a>

<a name="1216324"></a>

<a name="1216327"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm.<br><br>Both Repeat and While require an 'external' Local too. Is that really a valid case for not using For?<br><br>However I understand in that you would expect a For loop to iterate using 'static' variables. As you've all said - you're expecting to iterate over an existing collection, not a 'possibly changing' collection.<br><br>The favour now seems against re-evaluation :P <br><br></td></tr></table><br>
<a name="1216427"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> That is just _my_ favour. If it is _your_ language, you define the cases.<br><br>All "non-reevaluated" loop-conditions use an external-local (hidden from the coder).<br><br><br>But you go d'accord with me about WHILE? I am German so my understanding of the English language may be not 100% perfect.<br><br>My understanding of the "meaning" of a phrase is the following:<br>FOR all in this box DO eatThem()<br>-&gt; you can throw the content of the box in another box - and if you ate everything in that other box, you finished your task, you ate all which WAS in the box<br><br>WHILE something is in this box DO eatThem()<br>-&gt; as soon as you find something in this box you will have to eat it to fulfill the task. If one replenishes it, you have to eat again<br><br>(of course this ignores the head/foot-condition checking as REPEAT eat UNTIL .. won't work with that example)<br><br>So if you think about it in the same way - you should transfer this expectation to your language. If you think: there is no difference between a "for everything on this list" and a "while there is something on this list" then you do it by throwing a dice or look how other bigger languages do it.<br>Especially if you enable "importing externals" you could try to have all importable languages behave the same way.<br><br><br>Hmm, seems my post just made myself uncertain about "for and while" in English. Maybe because we translate "while" as "So lange" ("as long ...") which might change meaning a bit.<br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
