<!DOCTYPE html><html lang="en" ><head ><title >UDP: prevent flood of a port with several packets</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >UDP: prevent flood of a port with several packets</h1><a href="forums.php" >Community Forums</a>/<a href="topics.php?forum=125" >General Help</a>/<a href="#bottom" >UDP: prevent flood of a port with several packets</a><br><br>
<a name="1182954"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello,<br><br>I am still working on datas transfert with UDP and i have found that if there are several clients programs, it is better to use several ports and several streams for the incoming packets. This way i can check each frame on all "receiving streams" using different ports if a packet (sent by a client program) has been received.<br><br>The issue that i am thinking about but i don't know if it is common in reality, is if the server program has attributed a port and a "receiving stream" to a client program, and for some reason the client program and the server program are not able to communicate anymore.<br><br>After a specific time without communication (not receiving a packet), the server program will disconnect the client program and have an empty slot ready to be taken by another client program.<br><br>Now let say that the previous client program has not received any packet from the server program and does not know that it is disconnected, it will keep sending packets on the same port and this can cause a "flood" of the port.<br><br>As i understand it, if the server program checks if a packet has been received in the "receiving stream" using this port and the packet is not from the wanted client program, and a packet from the wanted client has been received at the exact same time, then one will be lost isn't it ? Or is there a stack of packets waiting to be read ? If so, how to access it ? Is it in the same stream ? If so, if i have already finished to read a packet in a "receiving stream", is it a good practice to check several time in the same mainloop to see if there are others packets sent by others IPAs in the same stream ? Will they stay in the stack if i read only one packet per mainloop ?<br><br>Perhaps a simple solution is to add a time out on the client program too, but let's imagine a chaotic situation where there are many client programs sending several packets to the same port of a machine, how the server program is supposed to manage that ?<br><br>Thanks, <br><br></td></tr></table><br>
<a name="1182969"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MCP</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's been a long time since I delved into any of this but I'm fairly sure if a connection has been lost between client and server then attempting to send any data will fail because your stream will be invalid. <br><br></td></tr></table><br>
<a name="1182971"></a>

<a name="1182972"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> MCP&gt;&gt;What you say may be true with TCP (i have not tested yet), but from my understanding and tests, with UDP there is no connection between a client and a server, there are only packets traveling from one program to a stream to a port of a computer to another port of a computer to another stream to another program. Hence the possibility of a "flood" of a port if several programs keep sending packets to the same port of a machine even if they are not supposed to.<br><br>Anyway i guess this is a rare issue so nobody thinks about it. A possible solution would be to attribute a new port and a new stream to each new client and delete the old streams. This may limit the problem even if it will not avoid hackers to send many packets to all ports. <br><br></td></tr></table><br>
<a name="1183006"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MCP</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> ...with UDP there is no connection between a client and a server... <br></div><br>I genuinely didn't know that about UDP. I've just read a quick article on the subject and I'm quite suprised. My limited knowledge extends as far as TCP only. Are you absolutely sure your program will not benefit from TCP? UDP does sound like it's more hassle than it's worth when you read into it. <br><br></td></tr></table><br>
<a name="1183036"></a>

<a name="1183037"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>Are you absolutely sure your program will not benefit from TCP?<br> <br></div><br>I am learning how to use UDP and TCP because depending on the program, if it requires fast updates, UDP is, as i have read, faster, while TCP is more reliable (no packets loss, and the packets are received in the right order), but UDP can be used to have the same reliability as TCP but probably with a faster datas transfer (depending on how i code my routines and depending on how the blitz3d commands are coded...)<br><br><div class="quote"> <br>UDP does sound like it's more hassle than it's worth when you read into it.<br> <br></div><br>As always, it seems complicated when you haven't done it, but then it is fully understandable and easy enough to use.<br><br><br><br>If anybody has more tips to avoid a flood of a port by unwanted programs, please don't hesitate to post. Thanks <br><br></td></tr></table><br>
<a name="1183055"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> The way I do UDP is quite simply the program has to validate themselves before the port is accepted from that program, if the program cant validate itself within an allotted time then the stream is closed.<br><br>All packets are read into a buffer and the buffer is processed sequentially looking for a packet header and footer (for my system it was &lt;EPB&gt; ...&lt;EPE&gt;) if the program only finds one ie &lt;EPB&gt; with no &lt;EPE&gt; then its an invalid packet and is disregarded. also if there is data with no headers this too is disregarded. This cuts down on corrupt or incomplete packets which is the bane of UDP.<br><br>As for clients connecting from other programs the validation system makes sure its your game client thats connecting and not something like telnet etc. <br><br></td></tr></table><br>
<a name="1183056"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> By validation I mean the program connects to the server then the server requests a code string from the client, if the client cannot provide the string after x requests from the server the connection is terminated and the server logs the attempt and IP address. If there is a constant attempt to connect and not validate from the client and they cannot validate then its down the the programmer to choose either ban the IP or continue kicking it every time it connects and fails. <br><br></td></tr></table><br>
<a name="1183122"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>The way I do UDP is quite simply the program has to validate themselves before the port is accepted from that program, if the program cant validate itself within an allotted time then the stream is closed.<br> <br></div><br>So do you close the stream and avoid to use the port associated to this stream and then you create another stream associated to another port ? If yes this is what i thought i will do.<br><br><br><br><div class="quote"> <br>All packets are read into a buffer and the buffer is processed sequentially looking for a packet header and footer (for my system it was &lt;EPB&gt; ...&lt;EPE&gt;) if the program only finds one ie &lt;EPB&gt; with no &lt;EPE&gt; then its an invalid packet and is disregarded. also if there is data with no headers this too is disregarded.<br> <br></div><br>So this means there is a stack of packets in the same stream and i can read several times in the same stream each loop to check if there are others packets ?<br><br><br><br><div class="quote"> <br> This cuts down on corrupt or incomplete packets which is the bane of UDP.<br> <br></div><br>What do you mean by "corrupt or incomplete packets" ? I thought that if a packet was received, it was full and not corrupted.<br>See my explanations here : <br><a href="http://blitzbasic.com/Community/posts.php?topic=100246" target="_blank">http://blitzbasic.com/Community/posts.php?topic=100246</a><br>post #5<br>(some infos may be partially false)<br><br><br><br><div class="quote"> <br>By validation I mean the program connects to the server then the server requests a code string from the client, if the client cannot provide the string after x requests from the server the connection is terminated and the server logs the attempt and IP address. <br> <br></div><br>I see, it is a kind of password. Good idea.<br><br><br><br><div class="quote"> <br>If there is a constant attempt to connect and not validate from the client and they cannot validate then its down the the programmer to choose either ban the IP or continue kicking it every time it connects and fails.<br> <br></div><br>What to you mlean by "ban the IP" ? Do you mean that the server program will ignore all packets coming from this IPA or that it is possible to ban this IPA by asking Windows or the firewall to do this ?<br><br><br><br>Thanks for your answer EdzUp, this is interesting. <br><br></td></tr></table><br>
<a name="1183126"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> So do you close the stream and avoid to use the port associated to this stream and then you create another stream associated to another port ? If yes this is what i thought i will do. <br></div><br>no just close the stream and socket associated with that client connection<br><br><div class="quote"> So this means there is a stack of packets in the same stream and i can read several times in the same stream each loop to check if there are others packets ? <br></div><br>I normally read the available bytes from the stream<br><br><div class="quote"> What do you mean by "corrupt or incomplete packets" ? I thought that if a packet was received, it was full and not corrupted.<br>See my explanations here : <br><a href="http://blitzbasic.com/Community/posts.php?topic=100246" target="_blank">http://blitzbasic.com/Community/posts.php?topic=100246</a><br>post #5<br>(some infos may be partially false)<br><br><br><br><br>By validation I mean the program connects to the server then the server requests a code string from the client, if the client cannot provide the string after x requests from the server the connection is terminated and the server logs the attempt and IP address.  <br></div><br>you are NOT guaranteed to get complete packets with UDP networking especially over the internet, you will also get sometimes noise from the connection this sometimes appears as extra bytes in the stream.<br><br><div class="quote"> What to you mlean by "ban the IP" ? Do you mean that the server program will ignore all packets coming from this IPA or that it is possible to ban this IPA by asking Windows or the firewall to do this ? <br></div><br>i mean log the ip address and if it tries to open another connection close it immediately.<br><br>My networking system is in the code archives if you wish to pull it apart its an old version as im updating it but it will give you some ideas <br><br></td></tr></table><br>
<a name="1183127"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="http://www.blitzbasic.com/Community/posts.php?topic=100290" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=100290</a><br><br>On ipod and editing is a nightmare :/ <br><br></td></tr></table><br>
<a name="1183181"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>you are NOT guaranteed to get complete packets with UDP networking especially over the internet, you will also get sometimes noise from the connection this sometimes appears as extra bytes in the stream.<br> <br></div><br>Ok, noted. Thanks again for these tips. <br><br></td></tr></table><br>
<a name="1183205"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >-=Darkheart=-</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> If I were you I would use a combination of TCP and UDP, this gives you the best of both. Use TCP to send the non-speed dependant data e.g. setting up sessions, UDP ports, parameters, other players etc. Use UDP for the speed sensitive data, typically with an algorithm to deal with some of the issues of UDP packets (out of order, lost packets etc.).<br><br>This way it is quite easy for your networking to maintain critical data and still perform well.<br><br>Have fun.<br><br>Darkheart <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
