<!DOCTYPE html><html lang="en" ><head ><title >maths help : 2D line intersects 2D circle</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >maths help : 2D line intersects 2D circle</h1><a href="forums.php" >Community Forums</a>/<a href="topics.php?forum=125" >General Help</a>/<a href="#bottom" >maths help : 2D line intersects 2D circle</a><br><br>
<a name="1327185"></a>

<a name="1327186"></a>

<a name="1327187"></a>

<a name="1327188"></a>

<a name="1327228"></a>

<a name="1327233"></a>

<a name="1327327"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello,<br><br>I have found a function by col here : <a href="http://www.blitzbasic.com/Community/posts.php?topic=73517" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=73517</a> (post #9)<br><br>and i have tried to convert it to Blitz3d, and also removed the things that i don't need (i only need to know if a 2D line intersects with a 2d circle), and it works most of the time but not always, see :<br>;removed useless code (with errors)<br><br>The base formula is good because it seems to return if an infinite line intersects with a circle, which is good but not exactly what i want. I want to know if a limited line (between 2 points) intersects with a circle.<br><br>Any suggestions to improve the procedure/function appreciated.<br><br>Thanks, <br><br></td></tr></table><br>
<a name="1327190"></a>

<a name="1327191"></a>

<a name="1327192"></a>

<a name="1327193"></a>

<a name="1327229"></a>

<a name="1327231"></a>

<a name="1327232"></a>

<a name="1327259"></a>

<a name="1327260"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok i have added 2 checks :<br>if each point of the line is near enough the center of the circle (distance less than length of line + radius of circle)<br>;removed useless code<br><br>and again after 100 tries, it works in most cases but not in all cases, see : <br><img src="http://rd-stuff.fr/line-intersects-circle-error-201611282355.jpg"><br>(in this case, this should return false (does not intersect)) <br><br></td></tr></table><br>
<a name="1327240"></a>

<a name="1327241"></a>

<a name="1327242"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Trinosis</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi RemiD.<br><br>I have a bunch of intersection video's and source code i think would be of use to you.<br><br>All return true or false for intersection and the intersection point.<br><br>Line To Line Intersection.<br><br>Circle To Line Intersection.<br><br>Ellipse To Line Intersection.<br><br>The video's demonstrate their use for sliding collision.<br><br><iframe width="560" height="345" src="http://www.youtube.com/embed/uF0UMCYK8-8?list" frameborder="0" allowfullscreen></iframe><br><br><iframe width="560" height="345" src="http://www.youtube.com/embed/FvAQK9YtVUg?list" frameborder="0" allowfullscreen></iframe><br><br><iframe width="560" height="345" src="http://www.youtube.com/embed/Z0lKPqfBloE?list" frameborder="0" allowfullscreen></iframe><br><br><br>And you can download the demo's and source code here in my Dropbox.<br>( You don't need to sign up to Dropbox in order to download the files, just skip the sign up process if asked )<br><br><a href="https://www.dropbox.com/sh/7yo7113x0jsll4q/AAA_noRRvfPpSgF-cibv3toya?dl=0" target="_blank">https://www.dropbox.com/sh/7yo7113x0jsll4q/AAA_noRRvfPpSgF-cibv3toya?dl=0</a> <br><br></td></tr></table><br>
<a name="1327247"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Trinosis&gt;&gt;Thanks, i will take a look. :) <br><br></td></tr></table><br>
<a name="1327248"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I am not looking for a circle to line collisions system but rather for a line intersects circle formula, not sure if i can use this... <br><br></td></tr></table><br>
<a name="1327249"></a>

<a name="1327250"></a>

<a name="1327251"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I am trying to understand some math formulas on different websites, and i have to admit that trying to understand egyptians symbols is easier than this :-O<br><br>Why do the math formulas are written in such a weird way ? They could be written like with programming syntax it would be easier to grasp... <br><br></td></tr></table><br>
<a name="1327252"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> OoOh i think i found a way ! <br><br></td></tr></table><br>
<a name="1327253"></a>

<a name="1327254"></a>

<a name="1327255"></a>

<a name="1327329"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well done, you're nearly there but you missed a final step.<br>As the result of the equation is a parametric then you need to check if the intersection points are between 0.0 and 1.0.<br><br>Ox, Oy are the origin of the line to check for intersection<br>Dx, Dy is a vector from Ox, Oy to end of the line to check for intersection<br>Cx, Cy are the centre coords of the circle<br>Radius is... ;-)<br><br><pre class=code>
Function IntersectLineCircle(Ox:Float,Oy:Float,Dx:Float,Dy:Float,Cx:Float, Cy:Float,Radius:Float)
	Local DiffX:Float = Ox - Cx
	Local DiffY:Float = Oy - Cy
	
	Local A:Float = (Dx * Dx) + (Dy * Dy)
	Local B:Float = (DiffX * Dx) + (DiffY * Dy)
	Local Coeff# = (DiffX * DiffX) + (DiffY * DiffY) - (Radius*Radius)
	
	Local Intersecting# = B * B - A * Coeff
	If Intersecting &lt; 0.0 Return False
	
	Local sqrIntersecting = Sqr(Intersecting)
	Local InvA# = 1.0 / A
	Local I0:Float = (-B - sqrIntersecting ) * InvA
	Local I1:Float = (-B + sqrIntersecting ) * InvA
	
	If I0 &gt; 0.0 And I0 &lt; 1.0 Return True
	If I1 &gt; 0.0 And I1 &lt; 1.0 Return True

	Return False
EndFunction
</pre> <br><br></td></tr></table><br>
<a name="1327257"></a>

<a name="1327258"></a>

<a name="1327261"></a>

<a name="1327262"></a>

<a name="1327263"></a>

<a name="1327264"></a>

<a name="1327265"></a>

<a name="1327266"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Col&gt;&gt;thanks !<br><br>Your function seems to work correctly for the case that the infinite line would intersect with the circle but the limited line (between 2 points) would not.<br><br>However, now, if the 2 points of the line are inside the circle, the function returns false (as if the line does not intersect with the circle)<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
;2DLineIntersects2DCircle
Graphics 640,480,32,2

SeedRnd(MilliSecs())

;circle properties
CRadius% = Rand(30,90)
CX% = Rand(0+CRadius,GraphicsWidth()-1-CRadius) : CY% = Rand(0+CRadius,GraphicsHeight()-1-CRadius)

;line properties
LAX% = Rand(CX-CRadius,CX+CRadius) : LAY% = Rand(CY-CRadius,CY+CRadius)
LBX% = Rand(CX-CRadius,CX+CRadius) : LBY% = Rand(CY-CRadius,CY+CRadius)

While Not KeyHit(1)
	
 If( KeyHit(57)=1 )
  ;line properties
  LAX% = Rand(0,GraphicsWidth()-1) : LAY% = Rand(0,GraphicsHeight()-1)
  LBX% = Rand(0,GraphicsWidth()-1) : LBY% = Rand(0,GraphicsHeight()-1)
  ;circle properties
  CRadius% = Rand(30,90)
  CX% = Rand(0+CRadius,GraphicsWidth()-1-CRadius) : CY% = Rand(0+CRadius,GraphicsHeight()-1-CRadius)
 EndIf

 MilliStart% = MilliSecs()
 For n% = 1 To 1000 Step 1
  Result% = LineIntersectsCircle(LAX,LAY,LBX,LBY,CX,CY,CRadius)
 Next
 LineIntersectsCircleMilliTime% = MilliSecs() - MilliStart

 SetBuffer(BackBuffer())
	
 ClsColor(000,000,000)
 Cls()
 
 ;draw line
 Color(255,255,255)
 Line(LAX,LAY,LBX,LBY)

 ;draw circle
 Color(255,255,255)
 Oval(CX-CRadius,CY-CRadius,CRadius*2,CRadius*2,False)

 Color(255,255,255)
 Text(0,0,"LineIntersectsCircleMilliTime = "+Float(LineIntersectsCircleMilliTime)/1000)
 If( Result = True )	
  Color(255,000,000)
  Text(GraphicsWidth()/2-StringWidth("Intersects")/2,GraphicsHeight()/2,"Intersects")
 Else If( Result = False )	
  Color(000,255,000)
  Text(GraphicsWidth()/2-StringWidth("Does not Intersect")/2,GraphicsHeight()/2,"Does not Intersect")	
 EndIf
	
 Flip(1)
	
Wend

End()

Function LineIntersectsCircle%(Ax#,Ay#,Bx#,By#,Cx#,Cy#,CRadius#) ;by Col

 Vx# = Bx - Ax
 Vy# = By - Ay

 DiffX# = Ax - Cx
 DiffY# = Ay - Cy
	
 A# = (Vx * Vx) + (Vy * Vy)
 B# = (DiffX * Vx) + (DiffY * Vy)

 Coeff# = (DiffX * DiffX) + (DiffY * DiffY) - (CRadius*CRadius)
	
 Intersecting# = B * B - A * Coeff

 If( Intersecting &lt; 0.0 )
  Return False
 EndIf	

 sqrIntersecting# = Sqr(Intersecting)
 InvA# = 1.0 / A
 I0# = (-B - sqrIntersecting ) * InvA
 I1# = (-B + sqrIntersecting ) * InvA
	
 If( I0 &gt; 0.0 And I0 &lt; 1.0 )
  Return True
 EndIf

 If( I1 &gt; 0.0 And I1 &lt; 1.0 )
  Return True
 EndIf

 Return False

End Function
</textarea><br>see :<br><img src="http://rd-stuff.fr/line-intersects-circle-error-201611291214.jpg"><br>This is not a problem for what i want, but just to be aware of it...<br><br>(a simple improvement would be to check if the 2 points of the line are near enough the circle center (at a distance less than the radius), if yes, the line is inside the circle and thus intersects with the circle)<br><br>Thanks for sharing ! <br><br></td></tr></table><br>
<a name="1327267"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Your function seems to work correctly for the case that the infinite line would intersect with the circle but the limited line (between 2 points) would not. <br></div><br>Ooops, sorry about that.<br><br><pre class=code>
Function IntersectLineCircle(Ox:Float,Oy:Float,Dx:Float,Dy:Float,Cx:Float, Cy:Float,Radius#)
	Local DiffX:Float = Ox - Cx
	Local DiffY:Float = Oy - Cy
	
	Local A:Float = (Dx * Dx) + (Dy * Dy)
	Local B:Float = (DiffX * Dx) + (DiffY * Dy)
	Local Coeff# = (DiffX * DiffX) + (DiffY * DiffY) - (Radius*Radius)
	
	Local Intersecting# = B * B - A * Coeff
	If Intersecting &lt; 0.0 Return False
	
	Local sqrIntersecting = Sqr(Intersecting)
	Local InvA# = 1.0 / A
	Local I0:Float = (-B - sqrIntersecting ) * InvA
	Local I1:Float = (-B + sqrIntersecting ) * InvA

	If (I0 &gt; 0.0 And I0 &lt; 1.0) Return True
	If (I1 &gt; 0.0 And I1 &lt; 1.0) Return True
	If (I0 =&lt; 0.0 And I1 &gt;= 1.0) Return True
EndFunction
</pre> <br><br></td></tr></table><br>
<a name="1327269"></a>

<a name="1327325"></a>

<a name="1327326"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, this seems to work well in all cases now.<br><br>(you have to add :<br><pre class=code>
If(I0 =&lt; 0.0 And I1 &gt;= 1.0) 
 Return True
endif
</pre><br>at the end of the function in post #9 )<br><br><br>Thanks ! <br><br></td></tr></table><br>
<a name="1327303"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm trying to understand the code in that routine Col posted. It seems to be using the quadratic formula.<br><br>But this part here:<br><pre class=code>Local Intersecting# = B * B - A * Coeff</pre>...is the "discriminant", or (b^2 - 4.a.c) from the quadratic formula<br>I don't understand why it removed the 4. It's probably an optimisation given these line-circle circumstances.<br><br>This answer in StackExchange preserves the 4 (and gives some insight into why the problem can be solved this way):<br><a href="http://gamedev.stackexchange.com/a/18339" target="_blank">http://gamedev.stackexchange.com/a/18339</a> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
