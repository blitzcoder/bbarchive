<!DOCTYPE html><html lang="en" ><head ><title >A way to detect if an OS has the C:/user/appdata/</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >A way to detect if an OS has the C:/user/appdata/</h1><a href="forums.php" >Community Forums</a>/<a href="topics.php?forum=125" >General Help</a>/<a href="#bottom" >A way to detect if an OS has the C:/user/appdata/</a><br><br>
<a name="1200276"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just wondering recent thoughts on games writing save files before I go and try to re-invent the wheel. Don't think W7 likes you writing to the C:/Program Files/Application/ directory ordinarily. Any thoughts greatly appreciated. <br><br></td></tr></table><br>
<a name="1200278"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is what the %APPDATA% environment variable is for. You should ideally avoid assuming things like the existence of C: or that the path will even be the same on two installations of the same OS version. <br><br></td></tr></table><br>
<a name="1200284"></a>

<a name="1200285"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xlsior</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> You should never use hard-coded paths like that, or you'll be bit big time in many situations (32/64 bit systems, non-English windows installs, etc.)<br><br>Bruceh has a blitzmax module, bah.volumes, which will return a lot of the 'correct' paths for windows/linux/mac, such as the users home directory, application folder, desktop, etc.<br><br>But never hard code -- even if you try to deduce the most likely location, it's bound to fail spectacularly next time that MS changes their rules again and your program may grind to a halt under windows 9 / 10 / whatever.<br>Use the MS API's (or a wrapper) to query the OS for the proper paths to write to. <br><br></td></tr></table><br>
<a name="1200286"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Bruceh has a blitzmax module, bah.volumes <br></div>I almost said the same, but I'm pretty sure he uses Blitz3D still... <br><br></td></tr></table><br>
<a name="1200295"></a>

<a name="1200296"></a>

<a name="1200297"></a>

<a name="1200307"></a>

<a name="1200309"></a>

<a name="1200310"></a>

<a name="1200311"></a>

<a name="1200312"></a>

<a name="1200313"></a>

<a name="1200322"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the feedback folks, I've got a job again which has somewhat diminished my coding mojo. <br><br>B3D was my 2nd BRL love (BBasic 2.1 was the first!), I developed a little program sanctioned by BECTA (think they're defunct now) in BMAX, so I might shoe horn a little Brucey moddule into my suite (oh alright, theres only 2 executables so far, but they're sweet if I say so myself) executables.<br><br>Although, in the leary morning light the %APPDATA variable seems ever so much the easier option.<br><br>Have been digging around trying to find how to use APPDATA with systemproperty in B3D, however the closest I could find was : <a href="http://www.blitzbasic.com/Community/posts.php?topic=100256#1182262" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=100256#1182262</a>  Might resort to Brucey's bah.volumes<br><br>Although, this looks promising: <br><br><a href="http://www.blitzbasic.com/Community/posts.php?topic=100344#1184042" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=100344#1184042</a><br><br>Hell, yes - that's some pretty sweet code by Rob - bit of water under the bridge since he penned that though 2001 !<br><br><br>Cheers folks ;) <br><br></td></tr></table><br>
<a name="1201423"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >virtlands</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Rob Hutchinson and Joseph Cox created that nice BlitSys package [back in 2001]<br><br> You're probably searching for Episode 7 : (Get special directory info).<br><br> <textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">;
; BLITZSYS DLL V1.02 - EXAMPLE #007
; Written by Rob Hutchinson and Joseph Cox 2001.
;
; Gets a list of all the special directories on the system.
;
; SYNTAX:
; 
; sPath$ = DLLGetSpecialFolder$(iFolderFlag)
; DESCRIPTION: Get special folder name on the users system. This command is an extension of
;              the blitz command, SystemProperty(). Allows you to get about 30 different special
;              folders.
;

; Include the DLL wrapper include..
Include "blitzsys.bb"

; This just checks to see if the DLL is available... (probably makes it resident too).
If DLLBlitzSysInitialise() = False Then RuntimeError("blitzsys.dll not found, you suck! :)")

Graphics 800,500,0,2

;Print CSIDL_HISTORY :WaitKey():End

Print DLLGetSpecialFolder$(CSIDL_HISTORY)
Print DLLGetSpecialFolder$(CSIDL_DESKTOP)
Print DLLGetSpecialFolder$(CSIDL_INTERNET)
Print DLLGetSpecialFolder$(CSIDL_PROGRAMS)
Print DLLGetSpecialFolder$(CSIDL_CONTROLS)
Print DLLGetSpecialFolder$(CSIDL_PRINTERS)
Print DLLGetSpecialFolder$(CSIDL_PERSONAL)
Print DLLGetSpecialFolder$(CSIDL_FAVORITES)
Print DLLGetSpecialFolder$(CSIDL_STARTUP)
Print DLLGetSpecialFolder$(CSIDL_RECENT)
Print DLLGetSpecialFolder$(CSIDL_SENDTO)
Print DLLGetSpecialFolder$(CSIDL_BITBUCKET)
Print DLLGetSpecialFolder$(CSIDL_STARTMENU)
Print DLLGetSpecialFolder$(CSIDL_NETWORK)
Print DLLGetSpecialFolder$(CSIDL_NETHOOD)
Print DLLGetSpecialFolder$(CSIDL_FONTS)
Print DLLGetSpecialFolder$(CSIDL_TEMPLATES)
Print DLLGetSpecialFolder$(CSIDL_COMMON_STARTMENU)
Print DLLGetSpecialFolder$(CSIDL_COMMON_PROGRAMS)
Print DLLGetSpecialFolder$(CSIDL_COMMON_STARTUP)
Print DLLGetSpecialFolder$(CSIDL_COMMON_DESKTOPDIRECTORY)
Print DLLGetSpecialFolder$(CSIDL_APPDATA)
Print DLLGetSpecialFolder$(CSIDL_PRINTHOOD)
Print DLLGetSpecialFolder$(CSIDL_LOCAL_APPDATA)
Print DLLGetSpecialFolder$(CSIDL_DESKTOPDIRECTORY)
Print "":Print "[Press Any Key]":WaitKey
Print DLLGetSpecialFolder$(CSIDL_ALTSTARTUP)
Print DLLGetSpecialFolder$(CSIDL_COMMON_ALTSTARTUP)
Print DLLGetSpecialFolder$(CSIDL_COMMON_FAVORITES)
Print DLLGetSpecialFolder$(CSIDL_INTERNET_CACHE)
Print DLLGetSpecialFolder$(CSIDL_COOKIES)
Print DLLGetSpecialFolder$(CSIDL_HISTORY)
Print DLLGetSpecialFolder$(CSIDL_COMMON_APPDATA)
Print DLLGetSpecialFolder$(CSIDL_WINDOWS)
Print DLLGetSpecialFolder$(CSIDL_SYSTEM)
Print DLLGetSpecialFolder$(CSIDL_PROGRAM_FILES)
Print DLLGetSpecialFolder$(CSIDL_MYPICTURES)
Print DLLGetSpecialFolder$(CSIDL_PROFILE)
Print DLLGetSpecialFolder$(CSIDL_SYSTEMX86)
Print DLLGetSpecialFolder$(CSIDL_PROGRAM_FILESX86)
Print DLLGetSpecialFolder$(CSIDL_PROGRAM_FILES_COMMON)
Print DLLGetSpecialFolder$(CSIDL_PROGRAM_FILES_COMMONX86)
Print DLLGetSpecialFolder$(CSIDL_COMMON_TEMPLATES)
Print DLLGetSpecialFolder$(CSIDL_COMMON_DOCUMENTS)
Print DLLGetSpecialFolder$(CSIDL_COMMON_ADMINTOOLS)
Print DLLGetSpecialFolder$(CSIDL_ADMINTOOLS)
Print DLLGetSpecialFolder$(CSIDL_CONNECTIONS)
Print DLLGetSpecialFolder$(CSIDL_FLAG_CREATE)
Print DLLGetSpecialFolder$(CSIDL_FLAG_DONT_VERIFY)
Print DLLGetSpecialFolder$(CSIDL_FLAG_MASK)
Print DLLGetSpecialFolder$(CSIDL_DRIVES)

Print "":Print "[Press Any Key]":WaitKey
End
</textarea><div class="quote"> <br>----------------------------------------------------------------<br>You can also get related info using the <b>SET</b> command, information similar to THIS! (I use Windows 7):<br><br>APPDATA=C:\Users\##########\AppData\Roaming<br>CommonProgramFiles=C:\Program Files\Common Files<br>COMPUTERNAME=##########-PC<br>ComSpec=C:\Windows\system32\cmd.exe<br>HOME=C:\Users\##########<br>HOMEDRIVE=C:<br>HOMEPATH=\Users\##########<br>LOCALAPPDATA=C:\Users\##########\AppData\Local<br>LOGONSERVER=\\##########-PC<br>NUMBER_OF_PROCESSORS=16<br><b>OS=Windows_NT</b><br>Path=C:\programming\PellesC\Bin; ...................<br>PATHEXT=.COM;.EXE;.BAT;.CMD;.VBS;.VBE;.JS;.JSE;.WSF;.WSH;.MSC;.CH;.py;.pyw<br>PROCESSOR_ARCHITECTURE=x86<br>PROCESSOR_IDENTIFIER=x86 Family 6 Model 15 Stepping 6, GenuineIntel<br>PROCESSOR_LEVEL=6<br>PROCESSOR_REVISION=0f06<br>ProgramData=C:\ProgramData<br>ProgramFiles=C:\Program Files<br>PROMPT=$P$G<br>PSModulePath=C:\Windows\system32\WindowsPowerShell\v1.0\Modules\<br>PUBLIC=C:\Users\Public<br>SESSIONNAME=Console<br>SystemDrive=C:<br>SystemRoot=C:\Windows<br>TEMP=C:\Users\##########\AppData\Local\Temp<br>TMP=C:\Users\##########\AppData\Local\Temp<br>USERDOMAIN=##########-PC<br>USERNAME=##########<br>USERPROFILE=C:\Users\##########<br>windir=C:\Windows  <br></div> <br><br></td></tr></table><br>
<a name="1201445"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xlsior</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh, something else to consider, another reason why it's bad to hard-code the paths: the OS doesn't necessarily have to be installed on the C:\ drive either <br><br>(I've come across several machines in the real world where the OS is either on D:\ or M:\ no idea WHY anyone would do that, but they are out there...) <br><br></td></tr></table><br>
<a name="1202036"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the feedback, also found this interesting article about 'where to stick it':--<br><br><a href="http://vb.mvps.org/articles/vsm20090119.pdf" target="_blank">http://vb.mvps.org/articles/vsm20090119.pdf</a> <br><br></td></tr></table><br>
<a name="1202086"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John G</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I used Brucey's BaH.Volumes and it seemed to work fine with Win XP, Vista and Win 7.  Couldn't get it to work for Macs and bypassed it.  Now I may be having trouble with Mac Preference Files.  Has anyone used it successfully with say OSX 10.5 thru 10.8.5? <br><br></td></tr></table><br>
<a name="1202619"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John G</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Apologies:  Brucey's BaH.Volumes seems to work just fine with Macs -- at least the ones available here.  How could I question our Brucey???  Carry on. <br><br></td></tr></table><br>
<a name="1202671"></a>

<a name="1264363"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> I would create a userlib for this: <a href="http://msdn.microsoft.com/en-us/library/bb762181(VS.85).aspx" target="_blank">http://msdn.microsoft.com/en-us/library/bb762181(VS.85).aspx</a><br><br><pre class=code>.lib "shell32.dll"

SHGetFolderPath% ( hwndOwner%, nFolder%, hToken%, dwFlags%, pszPath* ) : "SHGetFolderPathA"</pre><pre class=code>Const MAX_PATH = 260
Const CSIDL_APPDATA = 26 ;Taken from Shlobj.h
Const SHGFP_TYPE_CURRENT = 0
Const SHGFP_TYPE_DEFAULT = 1

pathBank = CreateBank( MAX_PATH )

SHGetFolderPath( 0, CSIDL_APPDATA, 0, SHGFP_TYPE_DEFAULT, pathBank )

temp$ = ""
For x = 0 To MAX_PATH-1
	temp = temp + Chr( PeekByte( pathBank, x ) )
Next

Print temp
WaitKey()
End</pre>It has been deprecated on versions of Windows above XP, <b>but</b> it is implemented in them anyway for backwards compatibility. <br><br></td></tr></table><br>
<a name="1264348"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Small bit of advice, if you are getting something like the MyDocuments folder (CSIDL_PERSONAL), you should use SHGFP_TYPE_CURRENT not SHGFP_TYPE_DEFAULT because it's possible to move the MyDocuments folder and you don't want to get the original location, you want the new (current) one. <br><br></td></tr></table><br>
<a name="1264350"></a>

<a name="1264351"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Also, I'm a bit of a noob at making userlibs, do you know how to convert the top bit of code so that it can simply be included in a normal .bmx file? For example I do this for some other api calls:<br><br><pre class=code>
?win32
Extern "win32"
	Function CloseLibrary(hLib%) = "FreeLibrary@4"
	Function GetEnvironmentVariable(lpName$z, lpBuffer:Byte Ptr, nSize%) = "GetEnvironmentVariableA@12"
	Function GetVersionExA(infoex:Byte Ptr)
	Function RegOpenKey%(hKeyParent%,SubKey$z,phkResult:Byte Ptr)="RegOpenKeyA@12"
	Function RegCloseKey%(hKey%)="RegCloseKey@4"
	Function RegQueryValueEx%(hKey%,ValueName$z,Reserved%,nType:Byte Ptr,ValueBytes:Byte Ptr,ValueSize:Byte Ptr)="RegQueryValueExA@24"
	Function SHGetPathFromIDList(pidList%, lpBuffer:Byte Ptr)
	Function SHGetSpecialFolderLocation(hwndOwner%, nFolder%, pIdl:Byte Ptr)
End Extern
?
</pre><br>Thanks. <br><br></td></tr></table><br>
<a name="1264391"></a>

<a name="1264392"></a>

<a name="1264393"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello. The Win32 module ( pub.mod\win32.mod\ ) has some of the functions wrapped, so they're a nice reference. The module didn't wrap that function though.<br><br>With BlitzMax the declaration would be like this:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">Framework brl.standardio
Import brl.system
Import brl.bank
Import pub.win32


'Constants taken from "MinGW\Include\shlobj.h".

Const CSIDL_APPDATA:Int			= 26 'These seem to give
Const CSIDL_LOCAL_APPDATA:Int	= 28 'different results.

Const SHGFP_TYPE_CURRENT:Int = 0
Const SHGFP_TYPE_DEFAULT:Int = 1

'Constant taken from "MinGW\Include\winerror.h"

Const S_OK:Int = 0

Extern "win32"

	Function SHGetFolderPathA:Int( hwndOwner:Int, nFolder:Int, hToken:Int, dwFlags:Int, pszPath:Byte Ptr )

End Extern


'Usage:

Local tempBank:TBank = CreateBank( MAX_PATH ) 'MAX_PATH is defined in 'pub.win32'.
If SHGetFolderPathA( 0, CSIDL_APPDATA, 0, SHGFP_TYPE_CURRENT, LockBank( tempBank ) ) &lt;&gt; S_OK Then

	UnlockBank( tempBank )
	RuntimeError( "Unable to identify the Application Data folder" )

Else

	UnlockBank( tempBank )

	Local desiredPath:String = String.FromCString( LockBank( tempBank ) )
	UnlockBank( tempBank ) 'tempBank now can be released.

	Print "Path: " + desiredPath 'Output to console.

EndIf

End</textarea> <br><br></td></tr></table><br>
<a name="1264398"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> And this is the sanitised function to support unicode or ANSI (it can avoid unexpected errors):<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">SuperStrict 

Framework brl.standardio
Import brl.system
Import brl.bank
Import pub.win32


'Constants taken from "MinGW\Include\shlobj.h".

Const CSIDL_APPDATA:Int			= 26 'These seem to give
Const CSIDL_LOCAL_APPDATA:Int	= 28 'different results.

Const SHGFP_TYPE_CURRENT:Int = 0
Const SHGFP_TYPE_DEFAULT:Int = 1

'Constant taken from "MinGW\Include\winerror.h"

Const S_OK:Int = 0

Extern "win32"

	Function SHGetFolderPathA:Int( hwndOwner:Int, nFolder:Int, hToken:Int, dwFlags:Int, pszPath:Byte Ptr )
	Function SHGetFolderPathW:Int( hwndOwner:Int, nFolder:Int, hToken:Int, dwFlags:Int, pszPath:Byte Ptr )	
	
	Global _bbusew:Int 'Defined in 'blitz.mod\blitz_app.c'.
	
End Extern


'Usage:

Local desiredPath:String = SHGetFolderPath( CSIDL_APPDATA, SHGFP_TYPE_CURRENT )
If desiredPath Then

	Print "Path: " + desiredPath 'Output to console.

Else

	RuntimeError( "Unable to identify the Application Data folder" )

EndIf

End


'Function:

Function SHGetFolderPath:String( nFolder:Int, dwFlags:Int )

?Win32
	Local tempBank:TBank
	Local success:Byte = False
	
	If _bbusew Then
		tempBank = CreateBank( MAX_PATH * 2 ) 'WCHAR
		success = SHGetFolderPathW( 0, nFolder, 0, dwFlags, LockBank( tempBank ) ) = S_OK
	Else
		tempBank = CreateBank( MAX_PATH )
		success = SHGetFolderPathA( 0, nFolder, 0, dwFlags, LockBank( tempBank ) ) = S_OK
	EndIf	
	UnlockBank( tempBank )
	
	If success Then
		Local result:String

		If _bbusew Then
			result = String.FromWString( Short Ptr( LockBank( tempBank ) ) )
		Else
			result = String.FromCString( LockBank( tempBank ) )
		EndIf
		
		UnlockBank( tempBank )
		Return result
	EndIf
?
	Return Null 'Check for a Null result to identify errors.
	
End Function</textarea> <br><br></td></tr></table><br>
<a name="1264423"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wow awesome thanks! The Widechar (Unicode) version will definitely avoid errors because on some users' systems they have non-ASCII chars in their user names (and thus special folder paths) e.g. Japanese or Russian characters.<br><br>On my system _bbusew is true. I'm assuming that's because Mark made BlitzMax support Unicode a number of years ago, so anyone running the latest (unmodified) version will get true for that value right?<br><br>I'm then using BMax functions like CreateDir() with the path returned from SHGetFolderPathW() and I'm hoping it's compatible because all the file handling stuff in BlitzMax is Unicode right? <br><br></td></tr></table><br>
<a name="1264544"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> The result is converted to a standard BlitzMax string, so even though it may come from Unicode, once you obtain that string you can use it with any BlitzMax function \ operation. <br><br></td></tr></table><br>
<a name="1264611"></a>

<a name="1264612"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Great, thanks for the confirmation. I'm pretty sure I read years ago that BlitzMax Strings are now Unicode anyway. Oh yeah, from the docs "String is a BlitzMax container type containing a sequence of unicode characters."  I guess I was more concerned about if all the file handling stuff was Unicode or not. <br><br></td></tr></table><br>
<a name="1264628"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> OK just tested this with a profile with a unicode char in it (&amp;#322;) and I was able to read the MyDocuments folder with and then create a subfolder it in correctly.<br><br>In a contrast, some of my old code doesn't work with that user name because it's probably using this Windows function in ANSI mode instead of widechar mode (probably because I didn't specify the W version)<br><br>Function SHGetPathFromIDList(pidList%, lpBuffer:Byte Ptr)<br><br>So just a heads up, to people to be careful, especially if you are making a commercial game. <br><br></td></tr></table><br>
<a name="1264696"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> I wanted to confirm that Kryzon's SHGetFolderPathW code works great on XP Home (32-bit), Win 7 Pro (64-bit), Windows 8.1 (32-bit). I tested it with CSIDL_APPDATA and CSIDL_PERSONAL (using the SHGFP_TYPE_CURRENT flag). <br><br></td></tr></table><br>
<a name="1264716"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> Of course you do know that SHGetFolderPath doesn't always work as expected on the new OS's, and you should really be using SHGetKnownFolderPath instead, if it is available. <br><br></td></tr></table><br>
<a name="1264718"></a>

<a name="1264719"></a>

<a name="1264720"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah I know that SHGetFolderPath says it's "depreciated" on MS site but I know some pretty big games that still use it that have sold a huge amount recently.  In what way doesn't it always work as expected? I'm keen to know.<br><br>Anyway, before I was using SHGetSpecialFolderLocation, which is totally unsupported, so SHGetFolderPath is a bit better.<br><br>The reason I didn't use SHGetKnownFolderPath is that it's Vista+ only, so I'd need to test if OS is XP and use SHGetFolderPath instead.  Not too hard I know.  How would you test if it's available? <br><br></td></tr></table><br>
<a name="1264755"></a>

<a name="1264759"></a>

<a name="1264760"></a>

<a name="1264761"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BlitzSupport</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> One way to check would be like this:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">

SuperStrict

' Blitz functions, can be named anything:

Global SHGetSpecialFolderLocation:Int (hwndOwner:Byte Ptr, nFolder:Int, ppidl:Byte Ptr) "win32"
Global NonExistentFunction:Int () "win32"

Print ""

Local lib:Int = LoadLibraryA ("shell32.dll")

If lib

	' Assign Win32 functions to Blitz functions:

	SHGetSpecialFolderLocation = GetProcAddress (lib, "SHGetSpecialFolderLocation")
	
	If SHGetSpecialFolderLocation
		Print "SHGetSpecialFolderLocation OK"
	Else
		Print "SHGetSpecialFolderLocation not found"
	EndIf
	
	NonExistentFunction = GetProcAddress (lib, "NonExistentFunction")
	
	If NonExistentFunction
		Print "NonExistentFunction OK"
	Else
		Print "NonExistentFunction not found"
	EndIf

Else
	Print "Failed to open shell32.dll"
EndIf

' Use Blitz functions from here...

</textarea> <br><br></td></tr></table><br>
<a name="1264765"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >grable</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> I dont understand why noone uses the environment variables meant for this instead of faffing around with all these different apis.<br>And for those who think they are unreliable, they are infact circular.<br>Changing the relevant environment variables will also change the results returned from these different apis.<br><br>I use this fact to fool applications into running off usb drives with their own copy of PROGRAMDATA, USERPROFILE, APPDATA etc, never touching the system. <br><br></td></tr></table><br>
<a name="1264780"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> That's a good point grable. I guess it never occurred to me to use those. Is there ever a case when they are not defined on a system? Or perhaps they are not all available on XP for example?<br><br>@BlitzSupport Aha thanks for that. So I could use that and if it fails (function not found), use Kryzon's code above. <br><br></td></tr></table><br>
<a name="1264783"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Or perhaps they are not all available on XP for example? <br></div><br><br>I'd a right headache developing a front end on XP using environment variables and then trying to use that front end on W7 - it was an interesting (there is other words..) learning exercise.<br><br>Gog.com just access right on the System Drive for some stuff - I found this kinda stuff works well:  (not sanitized...)<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">

Global PROGRAMDATALocation$=GetEnv("ProgramData")

;======================================================
; Getting the ALLUSERSPROFILE

Global PROGDATALocation$=GetEnv("ALLUSERSPROFILE")

;======================================================
; Getting the HOMEDRIVE

Global HomerDrive$=GetEnv("HOMEDRIVE")


</textarea> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
