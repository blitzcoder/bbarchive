<!DOCTYPE html><html lang="en" ><head ><title >Platform Collision</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Platform Collision</h1><a href="forums.php" >BlitzPlus Forums</a>/<a href="topics.php?forum=81" >BlitzPlus Programming</a>/<a href="#bottom" >Platform Collision</a><br><br>
<a name="739716"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >weebo</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello,<br><br>I'm using BlitzPlus to get the hang of the basic mechanics behind a platform game.<br><br>My problem is with the collision detection between the player sprite and the floor.  <br><br>The play area is 640x480, divided in to tiles of 8x8, and the player sprite is 15x16 pixels. (x,y)<br><br>The code I have used checks all of the tiles around the player at any given time.  Using this information it  knows if the player should be falling, walking on the floor etc<br><br>This is all great, however, I'm finding that the player sprite doesn't always land flush with the floor tile.  Sometimes the player lands pixel perfectly on the top of the floor, other times the players feet dip a few pixels below and overlap in to the floor.<br><br>Can anybody throw some light on it for me?<br><br>Cheers!<br><br><br>*******Code now follows**********<br><br>AppTitle "Little Platformer"<br><br>;Player Variables<br>Global frmplayer, tmrplayer 			;player animation<br>Global playerx, playery, jumping	   ;player position/status<br>Global ladderpresent					;is the player on a ladder<br>Global tileleft<br>Global tileright<br>Global tileabove<br>Dim tilebelow(1)<br>Dim tileon(1)<br><br>;Player constants<br>playerx=250 ;start position<br>playery=455<br><br><br>;Environment Variables<br>Global gravity#,yspeed#<br><br>;Environment Constants<br>gravity =.3;Affects jump<br>jump#= -5	;jump height<br>speedx#=0	;ground friction<br><br>;Level variables<br>Dim level(79,59)<br><br><br>;MAIN PROGRAM;<br>;************;<br><br><br>;Prepare Screen<br>Graphics 640,480,16,1 		;set resolution<br><br>;load player animation and mask<br>gfxplayer=LoadAnimImage("c:\dk\player.bmp",15,16,0,12)<br>MaskImage gfxplayer,255,0,255<br><br>;load level gfx<br>floorgfx=LoadImage("C:\dk\floor.bmp")<br>MaskImage floorgfx,255,0,255<br>laddergfx=LoadImage("C:\dk\ladder.bmp")<br>MaskImage laddergfx,255,0,255<br><br>;Load the current level from file to the array<br>filein = ReadFile("c:\dk\levels\level1.txt")<br>For y = 0 To 59<br>	For x = 0 To 79<br>		level(x,y) = ReadByte(filein) 	;read 1 byte at a time<br>	Next<br>Next<br>CloseFile(filein)<br><br><br>;MAIN GAME LOOP;<br>;**************;<br><br>While Not KeyDown(1) ;until esc is pressed<br><br>	SetBuffer BackBuffer()<br>	Cls<br>		<br>	;draw the level/objects on screen<br>	;Floor tiles<br>	For y = 0 To 59<br>		For x = 0 To 79							<br>	<br>			Select level(x,y)			<br>				Case 49<br>					DrawImage floorgfx,x*8,y*8<br>				Case 50<br>					DrawImage laddergfx,x*8,y*8<br>			End Select<br>		Next<br>	Next<br><br>	;draw the player<br>	DrawImage gfxplayer,playerx,playery,frmplayer<br>	<br>	;discover players immediate surroundings<br>	tilebelow(0) = level(playerx/8,(playery/8)+2)<br>	tilebelow(1) = level((playerx/8)+1,(playery/8)+2)<br>	tileabove = level(playerx/8,(playery/8)-1)<br>	tileleft =  level((playerx/8)-2,playery/8)<br>	tileright = level((playerx/8)+2,playery/8)<br>	tileon(0) = level(playerx/8,playery/8)<br>	tileon(1) = level(playerx/8+1,playery/8)<br><br><br>	;check collisions against surroundings<br>	If tileon(0) = 49 Or tileon(1) = 49 And yspeed &lt;= 0 Then ;stop jumping you have hit your head<br>		yspeed=0<br>	End If<br><br>	If tileon(0) = 50 Or tileon(1) = 50 Then	;player is over a ladder<br>		ladderpresent=1<br>	Else<br>		ladderpresent=0<br>	End If<br>	<br>	If tilebelow(0) = 49 Or tilebelow(1) = 49 And yspeed &gt;=0 Then ;stop if you are falling and land on a tile<br>		jumping = 0<br>		yspeed=0<br>	End If<br>	<br>	If tilebelow(0) = 48 And tilebelow(1) = 48 Then ;falling if nothing is below<br>			jumping=1<br>	End If<br>		<br>	;check player input and update accordingly	<br>	If JoyX()=-1 Then ;left<br>		;friction<br>		speedx = speedx  -.2<br>		If speedx &lt; -2 Then speedx = -2<br>		<br>		If MilliSecs() &gt; tmrplayer + 100 Then<br>			tmrplayer=MilliSecs() ; 'reset' the timer<br>			frmplayer=( frmplayer + 1 ) Mod 3 ; increment the frame, flip to 0 if we are  out<br>		End If<br>	EndIf<br>	<br>	If JoyX()=+1 Then ;right<br>		speedx = speedx +.2<br>		If speedx &gt; 2 Then speedx=2<br>		<br>		If MilliSecs() &gt; tmrplayer + 100 Then<br>			tmrplayer=MilliSecs() ; 'reset' the timer<br>			frmplayer=3+( frmplayer + 1 ) Mod 3; increment the frame, flip to 0 if we are  out<br>		End If<br>		<br>	EndIf<br>		<br>	If JoyY()=-1 And ladderpresent=1 Then ;up if a ladder is present<br>		playery=playery-1 ;only go up if there is more ladder<br>			If MilliSecs() &gt; tmrplayer + 100 Then<br>			tmrplayer=MilliSecs() ; 'reset' the timer<br>			If frmplayer=8 Then <br>				frmplayer=10<br>			Else<br>				frmplayer=8<br>			EndIf<br>					<br>		End If<br>	EndIf<br>	<br>	If JoyY()=+1 And ladderpresent=1 Then ;down if a ladder is present<br>		<br>		playery=playery+1 ;only go down if there is more ladder to go down<br>		If MilliSecs() &gt; tmrplayer + 100 Then<br>			tmrplayer=MilliSecs() ; 'reset' the timer<br>			If frmplayer=8 Then <br>				frmplayer=10<br>			Else<br>				frmplayer=8<br>			EndIf<br>		End If<br>	EndIf<br>	<br>	If  JoyHit(1) And jumping=0 Then ;jump if not already<br>		jumping = 1	;the player is mid-jump<br>		yspeed# = jump#<br>	EndIf<br>	<br>	If jumping=1 ; check that we have pushed the jump key<br>		YSpeed# = YSpeed# + Gravity# ; this will calculate the y location in pixels<br>		If yspeed# &gt; 4 Then yspeed# = 4<br>		playery = playery + YSpeed ; this will add our calculated number to our current y position<br>	End If<br>	<br>	;updates on player variables<br>	speedx = speedx * .88 ;friction<br>	playerx = playerx + speedx ;update player x position<br>	<br>	;debugging<br>	;Show tilesbelow<br>	;Rect(playerx,playery+16,8,8,0)<br>	;Rect(playerx+8,playery+16,8,8,0)<br>	<br>	;show tileon<br>	;Rect(playerx,playery,8,8,0)<br>	;Rect(playerx+8,playery,8,8,0)<br>	<br>	Flip ;draw the screen<br><br>Wend <br><br></td></tr></table><br>
<a name="739728"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >b32</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> First, move the line where you draw the player:<br><pre class=code>
DrawImage gfxplayer,playerx,playery;,frmplayer
</pre><br>Before the line:<br><pre class=code>
If JoyY()=-1 And ladderpresent=1 Then ;up if a ladder is present
</pre><br>So that the player is drawn right after checking the collisions.<br><br>In this collision code, there are two parts that stop the jumping with "yspeed = 0"<br>Before that line, insert:<br><pre class=code>
playery=playery / 8 * 8
</pre><br>This will place the player back on a whole tile again after a jump.<br><br>In your main loop, you are setting the buffer, "SetBuffer BackBuffer()" I don't know if it matters much, but it can be moved before the loop. <br><br></td></tr></table><br>
<a name="739789"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >weebo</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> b32, thank you for taking the time to check this for me.  The line "playery=playery / 8 * 8" was exactly what I needed.  What can I say...it was late!<br><br>I've also moved the setbuffer line out of the main loop as it's not required as you mention.<br><br>Many thanks!<br>Neil <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
