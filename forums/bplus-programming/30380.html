<!DOCTYPE html><html lang="en" ><head ><title >Slowdown with read/writepixelfast..</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Slowdown with read/writepixelfast..</h1><a href="forums.php" >BlitzPlus Forums</a>/<a href="topics.php?forum=81" >BlitzPlus Programming</a>/<a href="#bottom" >Slowdown with read/writepixelfast..</a><br><br>
<a name="323687"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ErikT</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> For my game I wrote this function which is called every time a portion of a background image is loaded. It takes a background image, does it's thing and spit out a coloured version of the same image. I'm real proud of it :D I feel it proves once again that *anyone* can learn to code, even a guy who's practically retarded when it comes to math (like I am). One problem though: whenever I draw the modified images, fps are cut in half! But the read/writepixel operations are already done with when I draw them. The modified images shouldn't draw any slower than ordinary ones, right?<br><br>I posted the function below if anyone wants to take a look at it and see if there's anything wrong.<br><br>[CODE]<br>Function Scenery_Light(f,r_value3D,g_value3D,b_value3D)<br><br>	Local r# = 0<br>	Local g# = 0<br>	Local b# = 0<br>	Local r_value<br>	Local g_value<br>	Local b_value<br>	Local R_Modifier#<br>	Local G_Modifier#<br>	Local B_Modifier#<br>	Local PixelR#<br>	Local PixelR_Modifier#<br>	Local width = 160<br>	Local height = 400<br><br>		r_value = 255-r_value3D<br>		g_value = 255-g_value3D<br>		b_value = 255-b_value3D<br><br>		deltax = 0<br>		deltay = 0<br><br>		LightedBackgr = CreateImageBB(width,height)<br><br>		LockBufferReadingBB(Layer3[f])<br>		LockBufferWritingBB(LightedBackgr,64000)<br><br>		For x = 0 To width-1<br>			For y = 0 To height-1<br>				If BitDepth = 8<br>					PixelR = ReadPixelFastBB(x,y)<br><br>					PixelR_Modifier = (r_value+g_value+b_value)/3<br>					PixelR = PixelR - (PixelR_Modifier*(PixelR/255))<br><br>					If PixelR &gt; 255<br>						PixelR = 255<br>					ElseIf PixelR &lt; 0<br>						PixelR = 0<br>					EndIf<br><br>				ElseIf BitDepth = 16<br>					r = 8*(PeekShort(pixelReadBank,2*x+y*ReadPixelPitch) Shr 11 And %11111) ;pos 11-15<br>					g = 4*(PeekShort(pixelReadBank,2*x+y*ReadPixelPitch) Shr 5 And %111111) ;pos 5-10<br>					b = 8*(PeekShort(pixelReadBank,2*x+y*ReadPixelPitch) And %11111);pos 0-4<br><br>				ElseIf BitDepth = 32<br>					rgba = PeekInt(pixelReadBank,4*x+y*ReadPixelPitch) And %111111111111111111111111<br><br>					r = rgba Shr 16 And %11111111			;pos 16-23<br>					g = rgba Shr 8 And %11111111 			;pos 8-15<br>					b = rgba And %11111111					;pos 0-7<br>				EndIf<br><br>				R_Modifier = (r_value*(r/255))<br>				G_Modifier = (g_value*(g/255))<br>				B_Modifier = (b_value*(b/255))<br><br>				r = r - R_Modifier<br>				g = g - G_Modifier<br>				b = b - B_Modifier<br><br>				If r &gt; 255<br>					r = 255<br>				ElseIf r &lt; 0<br>					r = 0<br>				EndIf<br>				If g &gt; 255<br>					g = 255<br>				ElseIf g &lt; 0<br>					g = 0<br>				EndIf<br>				If b &gt; 255<br>					b = 255<br>				ElseIf b &lt; 0<br>					b = 0<br>				EndIf<br><br>				If BitDepth = 8<br>					WritePixelFastBB(x+deltax,y+deltay,PixelR)<br>				Else<br>					WritePixelFastBB(x+deltax,y+deltay,r,g,b)<br>				EndIf<br>			Next<br>		Next<br><br>		UnlockBufferWritingBB(LightedBackgr)<br>		UnlockBufferWritingBB(Layer3[f])<br>		FreeImageBB(Layer3[f])<br>		Layer3[f] = CreateImageBB(width,height)<br>		Layer3[f] = CopyImageBB(LightedBackgr,1)<br>		FreeImageBB(LightedBackgr)<br><br>End Function<br>[/CODE] <br><br></td></tr></table><br>
<a name="323697"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ford escort</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> look at the createimage command<br><br>CreateImage( width,height[,frames,flags] )<br><br>and here the description of the flags<br><br>1 : managed (image is frequently drawn but seldom modified - this is the default) <br>2 : dynamic (image is frequently drawn and modified) <br>4 : scratch (image is seldom drawn or modified) <br><br>try to set the flag to 2 maybe this can speed up things ... <br><br></td></tr></table><br>
<a name="323841"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ErikT</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the heads up. Didn't make any difference, tho', so the problem's somewhere else obviously. Rrr, why won't it just behave? :-= <br><br></td></tr></table><br>
<a name="324178"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ford escort</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> it look like you're using some customized commands i don't know them <br><br>CreateImageBB <br><br>maybe the problem is there <br><br>as b+ use the new flags if this command is for bb and b3d maybe it's not implemented and b+ uses these image created as default managed that is a bit more slow than dynamic. <br><br></td></tr></table><br>
<a name="324582"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ErikT</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm using the Extended Blitz lib by Turtle1776. Yep, the bug could be there too. Just thought I'd post here in case I did an obvious bummer in my own code. <br><br></td></tr></table><br>
<a name="325693"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mr Brine</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ive found the 'createimage' uses a lot of processor power for what it does, I'd try creating the image before you enter your programs main loop and passing that image handle to your function instead of creating the image inside the function.<br><br>I know your using the 'createimagebb' so I dont know if this info is valid.<br><br>Mr Brine <br><br></td></tr></table><br>
<a name="325712"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ErikT</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> The whole function is run just after images are loaded and before the game starts. What stumps me is why the modified image is drawn so slow. It's already been altered before the action starts and afterwards just sits in memory like any other image. <br><br></td></tr></table><br>
<a name="325898"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mr Brine</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Do you use these bb... functions to draw the actual graphics in the program loop?<br><br>Are you doing applying additional effects that only these bb functions provide? <br><br></td></tr></table><br>
<a name="326756"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ErikT</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yep, the custom commands replace all the native ones. In the cases of Create/Load/Drawimage it should work the same, except you're allowed to put images in and draw them from system mem. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
