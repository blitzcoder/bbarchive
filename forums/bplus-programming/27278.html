<!DOCTYPE html><html lang="en" ><head ><title >Sonic Maths?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Sonic Maths?</h1><a href="forums.php" >BlitzPlus Forums</a>/<a href="topics.php?forum=81" >BlitzPlus Programming</a>/<a href="#bottom" >Sonic Maths?</a><br><br>
<a name="285590"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >WillKoh</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Can someone help me with the maths involved in making a game like sonic? I suppose it involves pi and gravity..<br><br>Just don't refer to the "sonicblitz" please, I don't get anything of that code... <br><br></td></tr></table><br>
<a name="285692"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >WillKoh</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Maybe I should be more specific: I was thinking about the loops in particular... <br><br></td></tr></table><br>
<a name="285693"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >WillKoh</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> ...And the Sonic game I refer to is that of a certain hedgehog... <br><br></td></tr></table><br>
<a name="285870"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paul "Taiphoz"</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> loops ?<br><br>your going to have to give us more to go on than that. how about you tell us what sort of coding level your at then we can help better, also let us know exactly what it is your asking.<br><br>Help with loops could be anything . as there will be millions of code iterations in any game. <br><br></td></tr></table><br>
<a name="285874"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >WolRon</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Pretty simple.<br><br>Increase speed if button pressed (unless at max speed) but only if Sonic is touching 'ground'.<br>Decrease speed if button not pressed (unless at zero speed) or if Sonic is NOT touching 'ground'.<br>Move forward an amount relative to speed (following contour of environment).<br>Apply gravity.<br><br>Should do it for ya. <br><br></td></tr></table><br>
<a name="286165"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >WillKoh</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> &gt;&gt;Following contour of environment&gt;&gt; That's the tricky part - in a loop that sonic should run (being upside down and so, with a certain generosity to actual gravity rules though) <br><br></td></tr></table><br>
<a name="286284"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Réno</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> speed move :<br><br><pre class=code>
;#1
SonicY=(SonicY+1)
If ImagesOverlap (TileOfSonic,TileOfGroundY);bla bla, change it
SonicY=(TileOfGroundY-TileOfSonic)

;#2
SonicX=(SonicX+SonicSpeed)
Select SonicScript
Case 0;Sonic doesn't move
   SonicSpeed=(SonicSpeed-1)
   If SonicSpeed&lt;0 SonicSpeed=0
case 1;sonic script left
   SonicSpeed=(SonicSpeed+1)
   If SonicSpeed&gt;8 SonicSpeed=8
endif
</pre> <br><br></td></tr></table><br>
<a name="286581"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >WillKoh</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> What is the issue is not movement across common ground but on the inside of a looping, where he tilts to match the part of the loop-road he is stepping on, pointing head to ground when he is in the very roof of the loop.<br><br>Can someone help me with the maths to do that? <br><br></td></tr></table><br>
<a name="286589"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Warren</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> One idea would be to use his speed as a countering force against gravity.  So do a linepick from his head towards his feet.  Whatever the surface normal is that you hit, apply the countering force in the opposite direction of that normal.  If he's going fast enough, that should make him stick to the top of loops and such.<br><br>As for moving him forward, you'll have to do that same check but probably bust out a cross product to get the "forward" vector in relation to whatever surface he's on at any given moment. <br><br></td></tr></table><br>
<a name="286600"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Todd</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> The only problem with that is that I assume he's trying to do this in 2d, not 3d. So there's no linepicks or surface normals. You could still do that using the same principal though. If you're using a tile map, just store collision data in the form of a line for each tile. When your character collides with the line, you can get the normal of the line by taking the line vector, diving 1 by it, and switching the sign. Then you can convert the normal into degrees usins Sin() and Cos(). You can then use that angle to draw your character pointing in the right direction. That probably didn't make any sense, so if you want me to explain a little more, I might consider writing a tutorial on doing this. <br><br></td></tr></table><br>
<a name="286631"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >WillKoh</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Please do that, that would be very kind of you. You would need to explain even things like normals and tilemaps though. <br><br></td></tr></table><br>
<a name="286701"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rob</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Since this is 2D, the most important thing to learn is pinball physics.<br><br>If you use a black and white mask and get a ball working on a pinball table, you will have the required physics for use in a sonic game. <br><br></td></tr></table><br>
<a name="286837"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >WillKoh</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> &gt;&gt;Since this is 2D, the most important thing to learn is pinball physics&gt;&gt; I guess so. Any help on that? I can't help but think it should be quite simple in terms of the code size? <br><br></td></tr></table><br>
<a name="351280"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rob Farley</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> The yellow lines are the normals.<br><br><pre class=code>Graphics 640,480,0,2

For n=0 To 359 Step 10

x=Sin(n)*200+320
y=Cos(n)*200+240

Color 0,255,0
Line x+(Sin(n-90)*15),y+(Cos(n-90)*15),x+(Sin(n+90)*15),y+(Cos(n+90)*15)
Color 255,255,0
Line x,y,x+(Sin(n+180)*15),y+(Cos(n+180)*15)

Next

WaitKey</pre> <br><br></td></tr></table><br>
<a name="351367"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> If this is 2D and your play area is larger than a single screen then you'll need tilemaps. <br>Would it be possible to use pre-calculated waypoints (connected using Bezier curves or sin/cos table?)around the inside of the loops and a min speed threshold. If you duck below that speed you branch to a 'start_dropping' function? <br><br></td></tr></table><br>
<a name="351726"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rob Farley</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Tony, that seems like a terrible way of handling the game.<br><br>Basically you'll need a real basic physics engine that holds your xspeed and yspeed.<br><br>xspeed increases and decreases as you press left and right<br>if keydown(right) then xspeed=xspeed+1 (where 1 is an acceleration speed)<br>if keydown(left) then xspeed=xspeed-1<br><br>xspeed gets dampened by friction<br>xspeed=xspeed*friction (where 1 would be no friction and 0 would make you stop immediately)<br><br>yspeed always accelerates downwards at the force of gravity<br>yspeed=yspeed+gravity_constant<br><br>yspeed gets adjusted by height differences upwards that the player has made.<br>if oldy&lt;y then yspeed=yspeed-((currenty-oldy)*lift_constant)<br><br>Adjust x and y positions based on the x and y speeds<br>x=x+xspeed<br>y=y+yspeed<br><br>Make sure player hasn't fallen through the ground or through the ceiling and adjust the y accordingly.<br><br>If you hit the jump key then you make yspeed = -5 (or something similar) and everything will work fine.<br><br>Anyway... that's how I'd do it. <br><br></td></tr></table><br>
<a name="351746"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rob Farley</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just knocked this up... it might help a bit...<br><br><pre class=code>; =======================================================================
;  Basic physics engine                                  Rob Farley 2004
; 
;  <a href="http://www.mentalillusion.co.uk" target="_blank">http://www.mentalillusion.co.uk</a>              rob@...
; =======================================================================



Graphics 640,480,0,2
SetBuffer BackBuffer()

Dim ground(639)
createground()

Const keyRht=205
Const keyLft=203
Const keyUp =200
Const KeyDwn=208


Const accel#=0.5
Const friction#=0.9
Const gravity#=0.5


x#=320.0
y#=240.0
oldy#=y

xs#=0.0
ys#=0.0

ontheground=False

Repeat

Cls

; draw ground
Color 0,255,0
For n=0 To 639
Plot n,ground(n)
Next

; draw player
Color 255,255,255
Oval x-5,y-11,11,11,True

oldy=y

; get user input
If ontheground
If KeyDown(keyrht) Then xs=xs+accel
If KeyDown(keylft) Then xs=xs-accel
If KeyDown(keyup)  Then ys=ys-5 	; jump
xs=xs*friction				; add friction
EndIf


x=x+xs		; update x position

ys=ys+gravity	; add gravity
y=y+ys		; add the y speed to the y position

; wrap x
If x&gt;639 Then x=0
If x&lt;0 Then x=639

; hit the ground
If y&lt;ground(x) Then ontheground=False Else ontheground=True ; are you on the ground
If y&gt;ground(x) Then y=ground(x):ys=-ys/5 ;bounce
If ontheground	; things to deal with when on the ground:

	If y&lt;oldy Then ys=ys-(oldy-y)	; lift from hills
	hl#=ground(wrap(x-1,0,639))
	hr#=ground(wrap(x+1,0,639))
	xs=xs+((hr-hl)/10)		; the /10 reduces the amount of affect the ground has
	EndIf
	

Flip
Until KeyHit(1)


; create the ground
; this just creates a bunch of random places and cosine interpolates between them to create
; a rolling landscale.
Function createground()
steps#=50
fraction#=640/steps
gap#=640/fraction

old_random=Rand(0,100)
For x#=0 To fraction
	random=Rand(0,100)
	For n#=0 To 1 Step .001
		Color 0,255,0
		xx=Int((x*gap)+(n*gap))
		If xx&gt;-1 And xx&lt;640 Then ground(xx)=(cosine_interpolate(old_random,random,n))+300
		Next
	old_random=random
	Next
	
End Function
	
Function cosine_interpolate#(a#, b#, x#) 
	f#=(1-Cos(x*180))/2 
	Return a*(1-f)+(b*f) 
End Function

Function wrap(x,low,high)
	If x&lt;low Then x=x+(high-low)
	If x&gt;high Then x=x-(high-low)
	Return x
End Function</pre> <br><br></td></tr></table><br>
<a name="351758"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LarsG</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Excellent little snippet you got there Rob.. :) <br><br></td></tr></table><br>
<a name="360812"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> WillKoh:<br>Never look a gift horse in the mouth...  <br><br>...Unless you're checking for sharp objects that might have an adverse affect on your plans for it later. <br><br></td></tr></table><br>
<a name="360826"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> Btw, you're asking for something really complicated to do right.  Hacking it though... Well you could do that.  That's  what Sega did.<br><br>What you need to do is detect when Sonic enters a loop, and then switch him to a mode where he'll follow the path of a circle.<br><br>First you need to know where the center of the loop is.  That is Lx#, Ly#.  Then you need to know the radius of the loop.  That is the distance from the center to the edge.  That is R#.<br><br>The equations then are:<br><br>X# = Lx# + R#*Cos(A#)<br>Y# = Ly# + R#*Sin(A#)<br><br>The problem is, what value should you use for A#?  X# and Y# are the location to put Sonic at.<br><br>Now, when Sonic enters the loop, A# will be -90.  You will need to increment that value as he goes around.  At 0 he will be on the left of the loop, and at 90 he will be at the top of the loop.  At 180 he is on the right, and at 270 he exits the loop.<br><br>But how much should you increment A# by each loop?<br><br>Well, that depends on two things.  One, is Soncic's velocity.  That is to say, how far does he move each second?<br><br>The second is, what is the distance betweem one degree and another on a circle?  <br><br>The answer to that is this:<br>D# = (Pi#/180.0) * R#<br><br>Where pi is 3.14159265<br>And where R is the radius of our circle.<br><br>So now that we know how far sonic will move if he moves one degree on the circle, we can calculate how many degrees we should move him if we want to move him 10 pixels this frame, assuming the radius of our circle is in pixels.<br><br>So if V# is the number of pixels to move this frame, then A# is:<br><br>A# = V# / D#<br><br>So now we know all the variables for our first two equations.  Except that you should know that A# here is just an increment for A for the above equations.  In other words, add this A to the A from the last frame, using the current velocity of Sonic.  <br><br>I leave the rest as an excerise for the reader. :-) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
