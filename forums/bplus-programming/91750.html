<!DOCTYPE html><html lang="en" ><head ><title >Finding the height of the desktop tool bar</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Finding the height of the desktop tool bar</h1><a href="forums.php" >BlitzPlus Forums</a>/<a href="topics.php?forum=81" >BlitzPlus Programming</a>/<a href="#bottom" >Finding the height of the desktop tool bar</a><br><br>
<a name="1044278"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >julianbury</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> How can I find the height of the desktop tool bar in order to avoid obscuring it?<br><br>I know there is some Windows code for this but I have no idea of how to access it and use it.<br><br>Can anyone help?<br><br>Thank you for your kind attention :-) <br><br></td></tr></table><br>
<a name="1044406"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Serpent</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Do you mean the task bar? <br><br></td></tr></table><br>
<a name="1044566"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >julianbury</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, I guess I do. The task bar :-) <br><br></td></tr></table><br>
<a name="1044748"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Serpent</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Does BlitzPlus support user-declared-functions?  I'm a Blitz3D user and not sure... <br><br></td></tr></table><br>
<a name="1044783"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >julianbury</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, if you mean something like ...<br><br>Function return_this()<br>   work out something<br>   return some_result<br>End function<br><br>(-_-) <br><br></td></tr></table><br>
<a name="1044790"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xlsior</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> You'll have to use the windows API to obtain that info...<br><br>Kind of similar to this:<br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=1311" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=1311</a><br><br>(I don't know what the call is to get the system properties that you're looking for, though) <br><br></td></tr></table><br>
<a name="1044792"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Serpent</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry, I wasn't very clear.  The (-_-) was appropriate :P<br>What I was asking about is if BlitzPlus supports 'userlibs' - i.e. if it allows you to declare external functions from dlls.<br>Yes, you will need to use Windows API functions to find out these sorts of values.  I'll assume the BlitzPlus has 'userlibs' (i.e. lets you declare these functions) for the rest of this post.<br><br>The function you will probably have is use is SystemParametersInfo (see <a href="http://msdn.microsoft.com/en-us/library/ms724947%28v=VS.85%29.aspx" target="_blank">MSDN PAGE HERE</a>).<br><br>The thing you can Ctrl-F for on that page is "SPI_GETWORKAREA":<br><pre class=code>Retrieves the size of the work area on the primary display monitor.
The work area is the portion of the screen not obscured by the system taskbar or by application desktop toolbars.
The pvParam parameter must point to a RECT structure that receives the coordinates of the work area, expressed in virtual screen coordinates.</pre><br><br>This looks like what you want - the rectangle of the screen not obscured by taskbars, toolbars, etc.<br><br>It says that you will need to use a RECT structure for this option.  This will simply be a type in blitz:<br><pre class=code>Type RECT
  Field left
  Field top
  Field right
  Field bottom
End Type</pre><br><br>The function:<br><pre class=code>BOOL WINAPI SystemParametersInfo(
  __in     UINT uiAction,
  __in     UINT uiParam,
  __inout  PVOID pvParam,
  __in     UINT fWinIni
);</pre><br><br>You should probably need to use it like this:<br>Success = SystemParametersInfo(SPI_GETWORKAREA, 0, MyRECT, 0)<br>Afterwards, MyRECT should be filled with the data and Success will indicate whether the function was successful or not. Example:<br><br><pre class=code>Const SPI_GETWORKAREA = $30

Type RECT
	Field left
	Field top
	Field right
	Field bottom
End Type

Local MyRECT.RECT
MyRECT = New RECT

Print SystemParametersInfo(SPI_GETWORKAREA, 0, MyRECT, 0)
Print MyRECT\left
Print MyRECT\top
Print MyRECT\right
Print MyRECT\bottom

WaitKey
End</pre><br><br>This works on my PC fine - but in Blitz3D.  You'll need this in your userlibs (if they're supported in BlitzPlus):<br><pre class=code>.lib "user32.dll"
SystemParametersInfo%(uiAction%, uiParam%, pvParam*, fWinIni%) : "SystemParametersInfoA"</pre><br><br><br>Hope this helps.<br>And if BlitzPlus doesn't support userlibs, tell me if it has CallDLL. <br><br></td></tr></table><br>
<a name="1044858"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xlsior</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> What I was asking about is if BlitzPlus supports 'userlibs' - i.e. if it allows you to declare external functions from dlls. <br></div><br><br>Yes, it does. <br><br></td></tr></table><br>
<a name="1044887"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Serpent</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay - what I've described above should also work in BlitzPlus then. <br><br></td></tr></table><br>
<a name="1044925"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >julianbury</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Serpent :-)<br><br>BlitzPlus does, indeed support userlibs.<br>It has a directory of that name with a demo in it.<br>My reading of the contents indicates that the DLLs are C compilations.<br>I do not have a C compiler.<br>There is a file, 'demolib.decls' which I assume is short for demolib.declarations.<br>It's contents are as follows:<br>-------------------------------------------------------------------------<br><br>;Declarations file for demolib.dll<br>;<br>;Adds the following commands:<br>;<br>;DemoLib_InvertBits( bank,offset,count )<br>;DemoLib_ShuffleString$( str$ )<br><br>.lib "demolib.dll"<br><br>DemoLib_InvertBits( bank*,offset,byte_count):"_InvertBits@12"<br>DemoLib_ShuffleString$( str$ ):"_ShuffleString@4"<br><br>There is also a file, 121 lines long, called 'UserLibs.txt'.<br><br>I don't suppose it would dammage anything to present it to you, so here it comes ...<br><br>-------------------------------------------------------------------------<br><br>New DLL interface spec<br>----------------------<br><br>There is now a directory in the root blitzpath called 'userlibs'.<br><br>By adding DLLs and '.decls' files to this directory, you can extend blitz's command set.<br><br>DLLs contain actually library code, while .decls files contain 'declarations' to be added to the<br>base command set. These declarations describe the functions contained in the Dll.<br><br><br>Format of decls files<br>---------------------<br><br>Decls files should always start with a '.lib' directive, followed by the quoted name of the DLL to be<br>loaded, eg:<br><br>.lib "mylib.dll"<br><br>Following the .lib is a list of function declarations. The syntax of these is identical to<br>function declarations in Blitz, with the following exceptions:<br><br>* No default parameter values are allowed.<br><br>* If no function return type is specified, the function is a 'void' function - ie: it returns nothing.<br><br>* Instead of object parameters, you can only specify 'void*' parameters using a '*' type tag. Such<br>parameters can be assigned ANY object or bank, so BE CAREFUL!<br><br>* A declaration may be optionally followed by a 'decorated name'. This takes the form of a ':' <br>followed by a quoted string denoting the decorated name, eg:<br><br>MyFunction( text$ ):"_MyFunction@4"<br>MessageBox%( hwnd,text$,title$,style ):"MessageBoxA"<br><br>The decorated name is the name of the function as it appears in the dll, and only needs to be<br>specified if it is different from the actual function name.<br><br><br>Writing DLLs<br>------------<br><br>All functions MUST use the _stdcall calling convention.<br><br>Floats are passed and returned as per standard C/C++ conventions.<br><br>Strings are passed and returned in 'C' format - ie: a pointer to a null-terminated sequence of<br>characters.<br><br>Returned strings must be in a 'static' memory buffer. Once the function returns, this string is<br>immediately copied into an internal Blitz style string, so its OK to share this buffer between<br>multiple functions.<br><br>Both banks and objects can be passed to functions. The value passed is the address of the first byte<br>of storage. No information is sent regarding the size or type of memory passed so, again, BE CAREFUL!<br><br>Neither Banks or objects can be returned from functions.<br><br>Arrays are not supported at all.<br><br>VisualC decorates symbols quite heavily! If you are coding in 'C', the necessary stdcall specifier<br>will cause a '_' to be prepended, and a '@' (followed by the number of bytes passed to the function<br>- ie: number of parameters*4) to be appended. So, something like: 'void _stdcall MyFunc( int x )'<br>will end up as '_MyFunc@4'. In C++, the name decoration is even messier! But you can supress it by <br>using the 'extern "C"' feature (see examples below) so you're just left with the 'C' stdcall mess.<br><br>Other languages such as Delphi and Purebasic don't appear to suffer from this feature, but it can be<br>worthwhile looking through dll symbols if you're having problems. Check out PEview at<br><a href="http://www.magma.ca/~wjr" target="_blank">http://www.magma.ca/~wjr</a>  Open your dll and select 'SECTION .rdata'/'EXPORT address table'<br>to have a look at the exported symbols your compiler has seen fit to bestow upon your dll.<br><br>Example<br>-------<br><br>Ok, here's a little C++ example, as it would appear in VisualC.<br><br>First, we write the DLL:<br><br>//demo.dll<br>//<br>#include &lt;math.h&gt;<br>#include &lt;string.h&gt;<br>#include &lt;stdlib.h&gt;<br><br>#define BBDECL extern "C" _declspec(dllexport)<br>#define BBCALL _stdcall<br><br>//returns a float and has 6 float parameters<br>BBDECL float BBCALL VecDistance( float x1,float y1,float z1,float x2,float y2,float z2 ){<br>	float dx=x1-x2,dy=y1-y2,dz=z1-z2;<br>	return sqrtf( dx*dx+dy*dy+dz*dz );<br>}<br><br>//returns a string and has one string parameter<br>BBDECL const char * BBCALL ShuffleString( const char *str ){<br>	static char *_buf;<br><br>	int sz=strlen(str);<br><br>	delete[] _buf;<br>	_buf=new char[ sz+1 ];<br>	strcpy( _buf,str );<br>	<br>	for( int k=0;k&lt;sz;++k ){<br>		int n=rand()%sz;<br>		int t=_buf[k];_buf[k]=_buf[n];_buf[n]=t;<br>	}<br><br>	return _buf;<br>}<br>After building this, the resultant 'demo.dll' should be placed in the userlibs directory.<br><br>Now, we also need to create a 'demo.decls' file, describing the functions in our dll. This file<br>is also placed in the userlibs directory:<br><br>.lib "demo.dll"<br>VecDistance#( x1#,y1#,z1#,x2#,y2#,z2# ):"_VecDistance@24"<br>ShuffleString$( str$ ):"_ShuffleString@4"<br><br>...Voila! The next time Blitz is started up, the new commands appear within the IDE and can be used. <br><br></td></tr></table><br>
<a name="1044944"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Serpent</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> What you need to do is create a new text file in that directory.  Then put in it:<br><pre class=code>.lib "user32.dll"
SystemParametersInfo%(uiAction%, uiParam%, pvParam*, fWinIni%) : "SystemParametersInfoA"</pre><br>Once you've saved it, you need to change the file extension to '.decls'<br>The filename can be anything, as long as the extension is right.<br><br>Then, the code I posted above should work.  When you compile your program, Blitz will recognise the function SystemParametersInfo just like one of the inbuilt ones.<br><br>What the '.decls' file actually does is tell Blitz where to find the function.  There are various dlls that Windows has, all with a variety of functions for getting information about the computer, creating and controlling windows, creating processes, and more.  The .decls file will tell Blitz that when you type "SystemParametersInfo", you want it to get the function out of 'user32.dll'.<br>The stuff in C++ is an example dll you can create.  Once you compile the code with a C++ compiler, you can create a dll that your Blitz program can access just like it can access the Windows dll 'user32'.<br><br>I hope this explains everything. <br><br></td></tr></table><br>
<a name="1045632"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >julianbury</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thank you Serpent,<br><br>That's absolutly brilliant :D<br><br>Sorry about the delayed responce, duties keep interrupting the flow.<br><br>I need to take a sabatical to get stuck in and finish some of these projects.<br><br>(^_^) <br><br></td></tr></table><br>
<a name="1105381"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TAS</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> My thanks to Serpent too, having the taskbar hide the bottom part of the game window has been the bane of my programming life. <br><br></td></tr></table><br>
<a name="1111164"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TAS</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> The call also works with banks if you don't want to create a single use Type.  It appears it also with any type structure as long as the first four fields are integers.<br><br>bnk=CreateBank(16)<br><br>Print SystemParametersInfo($30,0,bnk,0)<br>Print PeekInt(bnk,0)<br>Print PeekInt(bnk,4)<br>Print PeekInt(bnk,8)<br>Print PeekInt(bnk,12)<br>WaitKey()<br>End <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
