<!DOCTYPE html><html lang="en" ><head ><title >update a progbar while a loading file ...</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >update a progbar while a loading file ...</h1><a href="forums.php" >BlitzPlus Forums</a>/<a href="topics.php?forum=81" >BlitzPlus Programming</a>/<a href="#bottom" >update a progbar while a loading file ...</a><br><br>
<a name="218180"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Red</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is it possible ? <br><br></td></tr></table><br>
<a name="218188"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >cyberseth</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Program execution is halted during the LoadImage() command. You know this. It's as much the same in Windowed mode as it is in Graphics mode.<br><br>There is a way to get around it, if you load in your image byte by byte. You could do this by reading the bytes into a bank and then using BlitzPlus's "Locked Graphics" commands to transfer the bytes over into an image.<br><br>Hmmmm I should write a test app for this.... <br><br></td></tr></table><br>
<a name="218193"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Red</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> it's not a easy question. <br><br></td></tr></table><br>
<a name="218195"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >QuietBloke</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> as I think i mentioned before in another post you could do it the way a lot of apps seem to do it. Just increment the progress bar by a random amount each time slice. Then set it to 100% briefly once the load is finished. <br>If the bar reaches 98% and the file is still not loaded just leave it at 98% till the load is done then again show 100% breifly.<br><br>&lt;grin&gt; <br><br></td></tr></table><br>
<a name="218196"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Anthony Flack</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Heh, yeah that sounds about right. And here was me thinking you should try to intelligently estimate it... <br><br></td></tr></table><br>
<a name="218291"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >QuietBloke</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> hehe.. sometimes you need to approach problems from another angle :)<br><br>Seroiusly though.. you didnt mention what kind of file you were talking about.<br><br>If its an image then something along the line that cyberseth suggests is probably the way to do it. <br><br></td></tr></table><br>
<a name="218293"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RexRhino</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> QuietBloke:<br><br>I always wondered why with so many programs the first 70% took so long, and the rest seemed to zip by! :) <br><br></td></tr></table><br>
<a name="218338"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kevin_</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Try measuring the time it takes to load the file nornally from your hard drive.<br><br>Take this time and apply it to your progress bar.<br><br>e.g. Say it takes 1 second to load in a 1mb file. Divide the time by 100 to get the time it takes to load 1% of the file. Now simply use this new time (1 sec/100) for every 1% of your progress bar.  It wont be accurate, but it should be fairly proportional to the size of the file.<br><br>Regards <br><br></td></tr></table><br>
<a name="218362"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LineOf7s</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I get the whole 'add random bits to progress bar' idea, but as Seth mentioned, since program execution halts whilst something loads, how does one manage to do *anything* as far as a progress bar goes.<br><br>*rereads*<br><br>Unless all the suggestions that follow Seth's post relate to methods that _complement_ his idea of loading into a bank first? <br><br></td></tr></table><br>
<a name="218396"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kevin_</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> You load in your file first measuring how long it takes to load then update the progress bar afterwards. If the file is smallish in size there will not be any noticable difference.<br><br>Regards <br><br></td></tr></table><br>
<a name="218397"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kevin_</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Look in the 'graphics' section in the code archives. I did a progress bar function some time ago.<br><br>regards <br><br></td></tr></table><br>
<a name="218426"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Skitchy</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Custom loader (?) <br><br></td></tr></table><br>
<a name="218428"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >cyberseth</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well you should be able to do this:<br><br>1. First of all read the File size, as this is the maximum value of the progress bar.<br>2. Open the bitmap file, and from whatever data positions, read the width and height.<br>3. Create a new image of that width and height and LOCK it.<br>4. bank = LockedPixels(ImageBuffer(img))<br>5. Then use ReadInt and PokeInt to read data from the file and draw it onto the image, pixel by pixel.<br>6. While doing that, update the progess bar. <br><br></td></tr></table><br>
<a name="218741"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >cyberseth</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok here is a loading/saving progress-bar test I've made.<br><br><pre class=code>
win = CreateWindow("Image Loading Progress..",100,100,500,400,0,1)
can = CreateCanvas(50,50,ClientWidth(win)-100,ClientHeight(win)-100,win)
SeedRnd MilliSecs()

btn1 = CreateButton("Save Image",50,10,100,30,win)
btn2 = CreateButton("Load Image",160,10,100,30,win)
btn3 = CreateButton("Clear Canvas",270,10,100,30,win)

prog = CreateProgBar(50,ClientHeight(win)-40,ClientWidth(win)-100,30,win,1)


SetBuffer CanvasBuffer(can)
For i=0 To 1000
	Color 0,0,Rand($FFFFFF)
	Rect Rand(ClientWidth(can)-16),Rand(ClientHeight(can)-16),16,16
Next
FlipCanvas can

Repeat
	Select WaitEvent()
	Case $101
		If EventData()=1 Then End
	Case $803
		End
	Case $401
		Select EventSource()
		Case btn1
			f=WriteFile("C:\canvastest.enc")
			If f
				WriteInt f,ClientWidth(can)
				WriteInt f,ClientHeight(can)
				LockBuffer CanvasBuffer(can)
				bnk = LockedPixels() p=LockedPitch()
				For y=0 To ClientHeight(can)-1
					WriteBytes bnk,f,y*p,4*ClientWidth(can)
					UpdateProgBar prog,Float(y)/ClientHeight(can)
				Next
				UnlockBuffer CanvasBuffer(can)
				CloseFile f
			End If
		Case btn2
			f=ReadFile("C:\canvastest.enc")
			If f
				w = ReadInt(f)
				h = ReadInt(f)
				Cls
				LockBuffer
				x=0 y=0 bnk = LockedPixels()  p=LockedPitch()
				While Not Eof(f)
					ReadBytes bnk,f,y*p,4*w
					;PokeInt bnk,x*4+y*p,pxl
					;x=x+1 If x=ClientWidth(can) Then
					x=0 y=y+1 UpdateProgBar prog,Float(y)/Float(h)
				Wend
				UnlockBuffer
				CloseFile f
				FlipCanvas can
			End If
		Case btn3
			ClsColor 0,0,0
			Cls
			FlipCanvas can
		End Select
	End Select
Forever
</pre><br><br>Currently, it saves pretty much raw colour data, so the file is unrecognisable and quite large! If I knew how to read and write BMP(, PNG and JPEG) or make up my own compression, then it could be a really good function for loading images.<br><br>Basically, writing every pixel one by one is far too slow, so instead I got the bank of the buffer and used WriteBytes/ReadBytes to write all the pixels in "chunks" one line at a time. Much faster! Note however that this can only be done in BlitzPlus, not in Blitz3D. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
