<!DOCTYPE html><html lang="en" ><head ><title >Cls VS DrawBlock VS DrawImage</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Cls VS DrawBlock VS DrawImage</h1><a href="forums.php" >BlitzPlus Forums</a>/<a href="topics.php?forum=81" >BlitzPlus Programming</a>/<a href="#bottom" >Cls VS DrawBlock VS DrawImage</a><br><br>
<a name="622881"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >WolRon</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I couldn't believe the results I found with this test program.  Clearly, clearing the screen with a Cls command is hundreds of times more efficient than drawing 'blank' pixels.<br><br>I was testing to see if clearing the screen with a cls command and then redrawing only the upper about 1/3 of the screen would be more efficient than just drawing the entire screen (in one shot) with an image that covered the whole screen but contained 'empty' pixel info (0, 0, 0) in the majority of the image.<br>The image was something like this (0 represents empty pixels):<pre class=code>0111111111111110
0111111111111110
0000000000000000
0000000000000000
0000000000000000
0000000000000000</pre><br>Interesting as well, DrawImage actually outperformed DrawBlock by 30%.  I always assumed a DrawBlock would be faster since it didn't bother to check for masked pixels, but clearly not drawing the masked pixels at all is faster.<br><br>Cls = 6 millisecs<br>DrawBlock = 3150 millisecs<br>DrawImage = 2153 millisecs<br><br>That makes the Cls command 500 times faster than the DrawBlock command (350 times faster if you subtract 33% for the upper portion of the image being drawn).  There must be some kind of Graphics card optimization being used there.<br><br>So, by using a Cls, and then only redrawing the top 1/3 of the screen, I was able to save 60% time.<br><br>and here's the code I tried:<br><pre class=code>Graphics 640, 400
;load main menu image
MenuBG = LoadImage("testmenu_bg.png", 4)
Flip
Delay 2000
time = MilliSecs()
For iter = 1 To 1000
	Cls
Next
time2 = MilliSecs()
For iter = 1 To 1000
	DrawBlock MenuBG, 0, 0
Next
time3 = MilliSecs()
For iter = 1 To 1000
	DrawImage MenuBG, 0, 0
Next
time4 = MilliSecs()


Cls
Text 0, 0, time2-time
Text 0, 30, time3-time2
Text 0, 60, time4-time3
Flip
WaitKey
End
</pre><br><br><b>- - - EDIT - - -</b><br>Oops, I realized now that the majority of the speed reductions was due to my loading the image as a type 4 image due to it being used as a title screen.<br>So, the stats still apply, but only to a type 4 image.  When I loaded it as a type 1 (the default), then my test results weren't as significant, but still showed some improvement.<br><br>Cls = 6 millisecs<br>DrawBlock = 225 millisecs<br>DrawImage = 126 millisecs<br><br>That's still 37 times faster than the DrawBlock command.<br><br>And to show comparison, the same test program with images loaded as type 2s:<br><br>Cls = 6 millisecs<br>DrawBlock = 168 millisecs<br>DrawImage = 179 millisecs<br><br>DrawImage isn't any more efficient anymore with a type 2. <br><br></td></tr></table><br>
<a name="622899"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> With type 4, scratch, the delay is the entire image going across to the video card from RAM each time.  With type 1, managed, your very first drawblock will take twice as long as the rest of the drawblocks (test it) because it's being copied to the VRAM from RAM, then each subsequent use will be quicker cos it's using the VRAM copy (unless you modify the image, in which a case a re-copy to VRAM is required).  Type 2 is loaded straight onto the VRAM so it shouldn't be any slower the first time.  It's odd that the drawimage stat for Type2 is slower than Type1, this doesn't make sense.  I have found that with these sort of benchmarks you need to leave a decent delay at the start before commencing otherwise they can vary a bit.  Also did you run the test more than once for each type to check the results were always in the same range?<br><br>As a matter of interest, I would always use CLS anyway :-) but I see that you were only needing to clear a portion of the screen and thought you'd optimise.  Clearly the video card has some kind of hardware clearing OR optimisation i.e. it only bothers doing it once! (try drawing a single pixel after each CLS and see if it slows down).<br><br>Would be interesting to try the same test on an Image in RAM (scratch) by pointing at it with ImageBuffer(testimage), not on the card, and see how fast CLS is then ... <br><br></td></tr></table><br>
<a name="623131"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Buggy</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm a little confused how you can say that cls is 37 times faster than drawblock, because although that may be so, with cls, you need to use drawimage also, so really it's only marginally faster.<br><br>But this info still helps a lot.<br><br>By the way, what's a type 4 image? <br><br></td></tr></table><br>
<a name="623231"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >WolRon</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I tried to make myself understood in the first post.  I was clearing the screen with an image that was 2/3 just black pixels.  I thought it would be faster than performing a Cls and then performing a DrawBlock or DrawImage (because that's two commands) on the upper 1/3 of the screen.<br><br>I found out that using a Cls takes almost no time at all (remember, the 6 millisecs is 1000 Cls's), so there's nothing to lose by using a Cls and then RE-drawing over the same cleared screen with an image. <br><br></td></tr></table><br>
<a name="623306"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Buggy</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> 6 millisex is 1000 Cls'?  Ooh... that makes more sense.<br><br>Still a little confused, but no matter.  So what <i>is</i> a type 4, type 1, or type 2 or 3 image? <br><br></td></tr></table><br>
<a name="623316"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I found out that using a Cls takes almost no time at all <br></div><br><br>To be quite correct, it takes no time at all to issue a CLS command to the graphics card, which will then most likely buffer it up with all the other drawing stuff it is required to do in it's own time... <br><br>Try locking and releasing the backbuffer before calling millisecs which shoulld guarantee the drawing has actually been accomplished. <br><br></td></tr></table><br>
<a name="623404"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wolron: Yeah like I said it probably only does the CLS once so the test isn't correct.<br><br>Buggy.  Type Loadimage into the Ide and press F1 on it.  The flag controls the image type.  1,2 and 4 are the different types, 1 is stored in RAM and VRAM, 2 in vRAM only, 4 in RAM only.  The VRAM one will corrup if you alt+tab out and then back into your game. <br><br></td></tr></table><br>
<a name="623615"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Buggy</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> What?!  How do I press F1 on something?  I no nothing of your computer jargon! <br><br></td></tr></table><br>
<a name="623636"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >WolRon</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Are you joking? <br><br></td></tr></table><br>
<a name="623737"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> sorry I just gotta lol, no offence.  anyway, type Loadimage into the IDE (the BlitzPlus compiler) and move the cursor into the middle of the word, then press F1.  The help for that keyword will appear!  tada! <br><br></td></tr></table><br>
<a name="625212"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Buggy</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Really?!<br><br>...*Three and a half hours later*...<br><br>Wow!  It does work!  It's amazing!<br><br>Thanks a lot. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
