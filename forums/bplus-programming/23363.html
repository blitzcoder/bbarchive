<!DOCTYPE html><html lang="en" ><head ><title >Multiple File selections...</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Multiple File selections...</h1><a href="forums.php" >BlitzPlus Forums</a>/<a href="topics.php?forum=81" >BlitzPlus Programming</a>/<a href="#bottom" >Multiple File selections...</a><br><br>
<a name="241130"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BarcodeGeek</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey.<br>Im currently trying to code an MP3 player for myself in B+.<br>I'm planing on using playlists with the applcation, and Im having some issues.<br><br>I intend to have a menu option that links to a window that allows the user to select MP3's from a directory, and add them to a new list. I figure that using RequestFile function linked to an 'Add' button, but it doesn't seem to allow you to pick more than one file at a time..(you cant shift click selections) One at a time could take a while if you want to add 50 trakcs from one dir..<br><br>I am doing somthing stupid? Or does anyone know of a way round this problem??<br>Thanks,<br>BG <br><br></td></tr></table><br>
<a name="241189"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >CS_TBL</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> If B+ has no standard solution for this, then it seems you need to code your own filemenu with that feature ..<br><br>Otherwise you could load a whole dir (RequestDir), open all mp3 files in it (just the 'filenames' not the content itself), create a listbox-sorta-thing where you select your tunes, and load them. Since the standard listbox doesn't have multiselect, I guess you've to make your own listbox with this feature then.. tho it can't be as hard as making your own filerequester .. :)<br><br>otherwise .. I dunno~ <br><br></td></tr></table><br>
<a name="241198"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BarcodeGeek</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Good idea; that was what I was thinking I may have to do - I think the way I will do it somthing like;<br>open a dir, full of mp3s, which creates the LB, <br>then wait for a mouse click event within the area of the LB.<br>Use GetSelectedItem(?) to add the song cliked on to the second LB - which contains the users songs to add to the list.<br>Or somthing like that..<br><br><br>But WhyTF doesnt the B+ requestFile function allow multiple selection? Seems a bit of a shame... <br><br></td></tr></table><br>
<a name="244455"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tazzy</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Or you could write a wrapper around GetOpenFilename from the common dialogs. Below is some Microsoft documentation  <br>about the GetOpenFile function<br><br>[a]http://msdn.microsoft.com/library/default.asp?url=/library/en-us/winui/winui/windowsuserinterface/userinput/commondialogboxlibrary/commondialogboxreference/commondialogboxfunctions/getopenfilename.asp[/a]<br><br>I can't check my documentation from here, but if requestfile<br>has a flags parameter, then the VB code below might have some usefull info for you.<br><br>Const OFN_ALLOWMULTISELECT As Long = &amp;H200<br>Const OFN_CREATEPROMPT As Long = &amp;H2000<br>Const OFN_DONTADDTORECENT As Long = &amp;H2000000<br>Const OFN_ENABLEHOOK As Long = &amp;H20<br>Const OFN_ENABLEINCLUDENOTIFY As Long = &amp;H400000<br>Const OFN_ENABLESIZING As Long = &amp;H800000<br>Const OFN_ENABLETEMPLATE As Long = &amp;H40<br>Const OFN_ENABLETEMPLATEHANDLE As Long = &amp;H80<br>Const OFN_EX_NOPLACESBAR As Long = &amp;H1<br>Const OFN_EXPLORER As Long = &amp;H80000<br>Const OFN_EXTENSIONDIFFERENT As Long = &amp;H400<br>Const OFN_FILEMUSTEXIST As Long = &amp;H1000<br>Const OFN_FORCESHOWHIDDEN As Long = &amp;H10000000<br>Const OFN_HIDEREADONLY As Long = &amp;H4<br>Const OFN_LONGNAMES As Long = &amp;H200000<br>Const OFN_NOCHANGEDIR As Long = &amp;H8<br>Const OFN_NODEREFERENCELINKS As Long = &amp;H100000<br>Const OFN_NOLONGNAMES As Long = &amp;H40000<br>Const OFN_NONETWORKBUTTON As Long = &amp;H20000<br>Const OFN_NOREADONLYRETURN As Long = &amp;H8000<br>Const OFN_NOTESTFILECREATE As Long = &amp;H10000<br>Const OFN_NOVALIDATE As Long = &amp;H100<br>Const OFN_OVERWRITEPROMPT As Long = &amp;H2<br>Const OFN_PATHMUSTEXIST As Long = &amp;H800<br>Const OFN_READONLY As Long = &amp;H1<br>Const OFN_SHAREAWARE As Long = &amp;H4000<br>Const OFN_SHAREFALLTHROUGH As Long = 2<br>Const OFN_SHARENOWARN As Long = 1<br>Const OFN_SHAREWARN As Long = 0<br>Const OFN_SHOWHELP As Long = &amp;H10<br>Const OFN_USEMONIKERS As Long = &amp;H1000000<br>Const OFS_MAXPATHNAME As Long = 128<br><br>Good luck,<br><br>tazzy <br><br></td></tr></table><br>
<a name="244464"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tazzy</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oops... found documentation now. No flags parameter :(<br><br>Then at least I can give you this VB sourcecode that does the trick. No time to convert it to Blitz. Sorry<br><br>The code below returns a string to the buffer lpstrFileTitle with multiple names seperated by ';' Offcourse the buffer needs to be big enough to fit those names in.<br><br>Good luck,<br><br><pre class=code>
Private Declare Function GetOpenFileName Lib "comdlg32.dll" Alias "GetOpenFileNameA" (pOpenfilename As OPENFILENAME) As Long
Private Type OPENFILENAME
    lStructSize As Long
    hwndOwner As Long
    hInstance As Long
    lpstrFilter As String
    lpstrCustomFilter As String
    nMaxCustFilter As Long
    nFilterIndex As Long
    lpstrFile As String
    nMaxFile As Long
    lpstrFileTitle As String
    nMaxFileTitle As Long
    lpstrInitialDir As String
    lpstrTitle As String
    flags As Long
    nFileOffset As Integer
    nFileExtension As Integer
    lpstrDefExt As String
    lCustData As Long
    lpfnHook As Long
    lpTemplateName As String
End Type

Private Sub Form_Load()
    'KPD-Team 1998
    'URL: <a href="http://www.allapi.net/" target="_blank">http://www.allapi.net/</a>
    'E-Mail: KPDTeam@...
    Dim OFName As OPENFILENAME
    OFName.lStructSize = Len(OFName)
    OFName.hwndOwner = 0
    OFName.hInstance = 0
    'Select a filter
    OFName.lpstrFilter = "Text Files (*.txt)" + Chr$(0) + "*.txt" + Chr$(0) + "All Files (*.*)" + Chr$(0) + "*.*" + Chr$(0)
    'create a buffer for the file
    OFName.lpstrFile = Space$(254)
    'set the maximum length of a returned file
    OFName.nMaxFile = 255
    'Create a buffer for the file title
    OFName.lpstrFileTitle = Space$(254)
    'Set the maximum length of a returned file title
    OFName.nMaxFileTitle = 255
    'Set the initial directory
    OFName.lpstrInitialDir = "C:\"
    'Set the title
    OFName.lpstrTitle = "Open File - KPD-Team 1998"
    'No flags
    OFName.flags = 512 ;OFN_ALLOWMULTISELECT

    'Show the 'Open File'-dialog
    If GetOpenFileName(OFName) Then
        MsgBox "File to Open: " + Trim$(OFName.lpstrFile)
    Else
        MsgBox "Cancel was pressed"
    End If
End Sub
</pre> <br><br></td></tr></table><br>
<a name="244909"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tazzy</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Guys,<br><br>Had a shot at converting to Blitz, but strings and buffer don't work as I expected. Anyone who can fix this ? I tries shorts instead of bytes because of the unicode, but as soon as I put a pointer to a bank in a bank, it seems to crash. Also CallDll works better that a userlib. Any ideas ?<br><br>This is what I created so far...<br>[code]<br><br>Const OFN_ALLOWMULTISELECT  = $200 <br>Const OFN_CREATEPROMPT  = $2000 <br>Const OFN_DONTADDTORECENT  = $2000000 <br>Const OFN_ENABLEHOOK  = $20 <br>Const OFN_ENABLEINCLUDENOTIFY  = $400000 <br>Const OFN_ENABLESIZING  = $800000 <br>Const OFN_ENABLETEMPLATE  = $40 <br>Const OFN_ENABLETEMPLATEHANDLE  = $80 <br>Const OFN_EX_NOPLACESBAR  = $1 <br>Const OFN_EXPLORER  = $80000 <br>Const OFN_EXTENSIONDIFFERENT  = $400 <br>Const OFN_FILEMUSTEXIST  = $1000 <br>Const OFN_FORCESHOWHIDDEN  = $10000000 <br>Const OFN_HIDEREADONLY  = $4 <br>Const OFN_LONGNAMES  = $200000 <br>Const OFN_NOCHANGEDIR  = $8 <br>Const OFN_NODEREFERENCELINKS  = $100000 <br>Const OFN_NOLONGNAMES  = $40000 <br>Const OFN_NONETWORKBUTTON  = $20000 <br>Const OFN_NOREADONLYRETURN  = $8000 <br>Const OFN_NOTESTFILECREATE  = $10000 <br>Const OFN_NOVALIDATE  = $100 <br>Const OFN_OVERWRITEPROMPT  = $2 <br>Const OFN_PATHMUSTEXIST  = $800 <br>Const OFN_READONLY  = $1 <br>Const OFN_SHAREAWARE  = $4000 <br>Const OFN_SHAREFALLTHROUGH  = 2 <br>Const OFN_SHARENOWARN  = 1 <br>Const OFN_SHAREWARN  = 0 <br>Const OFN_SHOWHELP  = $10 <br>Const OFN_USEMONIKERS  = $1000000 <br>Const OFS_MAXPATHNAME  = 128 <br><br><br>DebugLog(SelectFiles("Please select file","Blitz Basic (*.bb);*.bb;","C:\",OFN_EXPLORER + OFN_ALLOWMULTISELECT))<br><br>Function SelectFiles$(psTitle$,psFilter$,psInitialDir$,flags)<br>	<br>	sFiles$ = ""<br>	<br>    bnkTitle = CreateStringBuffer(psTitle$)<br>	bnkFilter = CreateStringBuffer(psFilter,True)<br>	bnkInitDir = CreateStringBuffer(psInitialDir$)<br>	<br>	bnkFile = CreateBank(2048)<br>	bnkFileTitle = CreateBank(2048)<br>	<br>	bnkInfo = CreateBank(76)<br>	PokeInt   bnkInfo, 0,76            ;lStructSize<br>	PokeInt   bnkInfo, 4,0             ;hwndOwner<br>	PokeInt   bnkInfo, 8,0             ;hInstance<br>	PokeInt   bnkInfo,12,0 ;bnkFilter     ;lpstrFilter<br>	PokeInt   bnkInfo,16,0             ;lpstrCustomFilter<br>	PokeInt   bnkInfo,20,0             ;nMaxCustFilter<br>	PokeInt   bnkInfo,24,0             ;nFilterIndex<br>	PokeInt   bnkInfo,28,bnkFile       ;lpstrFile<br>	PokeInt   bnkInfo,32,2047          ;nMaxFile<br>	PokeInt   bnkInfo,36,0;bnkFileTitle  ;lpstrFileTitle<br>	PokeInt   bnkInfo,40,2047          ;nMaxFileTitle<br>	PokeInt   bnkInfo,44,0;bnkInitDir    ;lpstrInitialDir<br>	PokeInt   bnkInfo,48,0 ;bnkTitle      ;lpstrTitle<br>	PokeInt   bnkInfo,52,flags         ;flags<br>	PokeShort bnkInfo,56,0             ;nFileOffset<br>	PokeShort bnkInfo,58,0             ;nFileExtension<br>	PokeInt   bnkInfo,60,0             ;lpstrDefExt<br>	PokeInt   bnkInfo,64,0             ;lCustData<br>	PokeInt   bnkInfo,68,0             ;lpfnHook<br>	PokeInt   bnkInfo,72,0             ;lpTemplateName<br>	<br>	iRC = CallDLL("comdlg32.dll","GetOpenFileNameA",bnkInfo)<br>	<br>	If iRC Then<br>       sFiles$ = PeekString(bnkFile)<br>	EndIf<br>	<br>	FreeBank bnkFile<br>	FreeBank bnkFileTitle<br>	FreeBank bnkTitle<br>	FreeBank bnkFilter<br>	FreeBank bnkInitDir<br>	<br>	FreeBank bnkInfo<br>	<br>	If iRC Then<br>		Return sFiles$<br>	Else<br>		Return "Cancelled"<br>	EndIf<br>	<br>	<br>End Function<br><br>Function CreateStringBuffer(psBuffer$,piConvertZero =False)<br>	iLen = Len(psBuffer$) <br>	bnkX = CreateBank(iLen + 2)<br>	intChar = 0<br>	For i = 0 To iLen <br>		intChar = Asc(Mid(psBuffer,i,1))<br>		If intChar = 59 Then ;';'<br>			If piConvertZero  Then<br>				intChar = 0<br>			EndIf<br>		EndIf<br>		;UniCode<br>		PokeByte(bnkX,i,intChar)<br>	Next<br>	;Closing zero<br>	PokeByte(bnkX,i,0)<br>	Return bnkX<br>End Function<br><br>Function PeekString$(pbnkBuffer,piConvertZero=False)<br>	<br>	sBuffer$ = ""<br>	For i = 0 To BankSize(pbnkBuffer)<br>		iByte = PeekByte(pbnkBuffer,i)<br>		sBuffer = sBuffer + Chr(iByte)<br>	Next<br>	Return sBuffer<br>End Function<br>[/code/ <br><br></td></tr></table><br>
<a name="244910"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tazzy</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> again. Now with formatting :(<br><pre class=code>

Const OFN_ALLOWMULTISELECT  = $200 
Const OFN_CREATEPROMPT  = $2000 
Const OFN_DONTADDTORECENT  = $2000000 
Const OFN_ENABLEHOOK  = $20 
Const OFN_ENABLEINCLUDENOTIFY  = $400000 
Const OFN_ENABLESIZING  = $800000 
Const OFN_ENABLETEMPLATE  = $40 
Const OFN_ENABLETEMPLATEHANDLE  = $80 
Const OFN_EX_NOPLACESBAR  = $1 
Const OFN_EXPLORER  = $80000 
Const OFN_EXTENSIONDIFFERENT  = $400 
Const OFN_FILEMUSTEXIST  = $1000 
Const OFN_FORCESHOWHIDDEN  = $10000000 
Const OFN_HIDEREADONLY  = $4 
Const OFN_LONGNAMES  = $200000 
Const OFN_NOCHANGEDIR  = $8 
Const OFN_NODEREFERENCELINKS  = $100000 
Const OFN_NOLONGNAMES  = $40000 
Const OFN_NONETWORKBUTTON  = $20000 
Const OFN_NOREADONLYRETURN  = $8000 
Const OFN_NOTESTFILECREATE  = $10000 
Const OFN_NOVALIDATE  = $100 
Const OFN_OVERWRITEPROMPT  = $2 
Const OFN_PATHMUSTEXIST  = $800 
Const OFN_READONLY  = $1 
Const OFN_SHAREAWARE  = $4000 
Const OFN_SHAREFALLTHROUGH  = 2 
Const OFN_SHARENOWARN  = 1 
Const OFN_SHAREWARN  = 0 
Const OFN_SHOWHELP  = $10 
Const OFN_USEMONIKERS  = $1000000 
Const OFS_MAXPATHNAME  = 128 


DebugLog(SelectFiles("Please select file","Blitz Basic (*.bb);*.bb;","C:\",OFN_EXPLORER + OFN_ALLOWMULTISELECT))

Function SelectFiles$(psTitle$,psFilter$,psInitialDir$,flags)
	
	sFiles$ = ""
	
    bnkTitle = CreateStringBuffer(psTitle$)
	bnkFilter = CreateStringBuffer(psFilter,True)
	bnkInitDir = CreateStringBuffer(psInitialDir$)
	
	bnkFile = CreateBank(2048)
	bnkFileTitle = CreateBank(2048)
	
	bnkInfo = CreateBank(76)
	PokeInt   bnkInfo, 0,76            ;lStructSize
	PokeInt   bnkInfo, 4,0             ;hwndOwner
	PokeInt   bnkInfo, 8,0             ;hInstance
	PokeInt   bnkInfo,12,0 ;bnkFilter     ;lpstrFilter
	PokeInt   bnkInfo,16,0             ;lpstrCustomFilter
	PokeInt   bnkInfo,20,0             ;nMaxCustFilter
	PokeInt   bnkInfo,24,0             ;nFilterIndex
	PokeInt   bnkInfo,28,bnkFile       ;lpstrFile
	PokeInt   bnkInfo,32,2047          ;nMaxFile
	PokeInt   bnkInfo,36,0;bnkFileTitle  ;lpstrFileTitle
	PokeInt   bnkInfo,40,2047          ;nMaxFileTitle
	PokeInt   bnkInfo,44,0;bnkInitDir    ;lpstrInitialDir
	PokeInt   bnkInfo,48,0 ;bnkTitle      ;lpstrTitle
	PokeInt   bnkInfo,52,flags         ;flags
	PokeShort bnkInfo,56,0             ;nFileOffset
	PokeShort bnkInfo,58,0             ;nFileExtension
	PokeInt   bnkInfo,60,0             ;lpstrDefExt
	PokeInt   bnkInfo,64,0             ;lCustData
	PokeInt   bnkInfo,68,0             ;lpfnHook
	PokeInt   bnkInfo,72,0             ;lpTemplateName
	
	iRC = CallDLL("comdlg32.dll","GetOpenFileNameA",bnkInfo)
	
	If iRC Then
       sFiles$ = PeekString(bnkFile)
	EndIf
	
	FreeBank bnkFile
	FreeBank bnkFileTitle
	FreeBank bnkTitle
	FreeBank bnkFilter
	FreeBank bnkInitDir
	
	FreeBank bnkInfo
	
	If iRC Then
		Return sFiles$
	Else
		Return "Cancelled"
	EndIf
	
	
End Function

Function CreateStringBuffer(psBuffer$,piConvertZero =False)
	iLen = Len(psBuffer$) 
	bnkX = CreateBank(iLen + 2)
	intChar = 0
	For i = 0 To iLen 
		intChar = Asc(Mid(psBuffer,i,1))
		If intChar = 59 Then ;';'
			If piConvertZero  Then
				intChar = 0
			EndIf
		EndIf
		;UniCode
		PokeByte(bnkX,i,intChar)
	Next
	;Closing zero
	PokeByte(bnkX,i,0)
	Return bnkX
End Function

Function PeekString$(pbnkBuffer,piConvertZero=False)
	
	sBuffer$ = ""
	For i = 0 To BankSize(pbnkBuffer)
		iByte = PeekByte(pbnkBuffer,i)
		sBuffer = sBuffer + Chr(iByte)
	Next
	Return sBuffer
End Function
</pre> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
