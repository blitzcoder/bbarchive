<!DOCTYPE html><html lang="en" ><head ><title >Locked Graphics Demo?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Locked Graphics Demo?</h1><a href="forums.php" >BlitzPlus Forums</a>/<a href="topics.php?forum=81" >BlitzPlus Programming</a>/<a href="#bottom" >Locked Graphics Demo?</a><br><br>
<a name="192995"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >turtle1776</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm pretty impressed by the fast pixel writing capabilities in Mark's lock_graphics demo, but I'd like to actually do something more useful than write the color red all over the screen.<br><br>Can anybody around here whip up a short demo would show how to do the same thing, but with an existing image (like a rock or a tree or a spaceship, or whatever)?<br><br>BTW, I'm not talking about writing on an existing image, though that would be interesting, too. I'm talking about writing the image to the backbuffer using Mark's method rather than DrawImage. <br><br></td></tr></table><br>
<a name="193015"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Michael Reitzenstein</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Using WritePixelFast and ReadPixelFast to draw an image is extremely slow in comparison to Blitting the said image, and completely useless unless you want to do some pixel color manipulation (alpha, brightness etc). What exactly did you have in mind? <br><br></td></tr></table><br>
<a name="193019"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Beaker</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you can track down FlameDuck on IRC, he has a nice demo that uses LockedPixels. <br><br></td></tr></table><br>
<a name="193031"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DJWoodgate</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Some nice demos with source by obviousdisaster are here...  <a href="http://www.blitzcoder.com/cgi-bin/showcase/showcase_showentry.pl?id=obviousdisaster03032003142359&amp;comments=no" target="_blank">http://www.blitzcoder.com/cgi-bin/showcase/showcase_showentry.pl?id=obviousdisaster03032003142359&amp;comments=no</a> <br><br></td></tr></table><br>
<a name="193139"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >turtle1776</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks all,<br><br>@DJWoodgate<br>Interesting demos. Unfortunately, after looking at both those demos and Mark's lock_graphics demo, it seems that to actually use this new capability, you need to understand lines like this:<br><br>u=(hu Shr 8)And$1FF<br><br>Anybody have any suggestions, resources, or tutorials on this kind of thing?<br><br>@Michael Reitzenstein<br>I know blitting is faster, but I want to learn how these new techniques work so I can do all the special effects stuff I was doing with writePixelFast with the new, faster techniques that are offered by B+. <br><br></td></tr></table><br>
<a name="193210"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FlameDuck</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> If you can track down FlameDuck on IRC, he has a nice demo that uses LockedPixels.  <br></div>The demo (if we're talking about the same one that is) is available very much as-is from my website (you'll want the file called bp-colorblend-win32.rar). There are a few things to note: a) it's totally unoptimized at this point and b) It'll only work in ARGB 32-bit. I have some code to convert between the formats but I figured the example as it is now is more academic.<br><br><div class="quote"> u=(hu Shr 8)And$1FF<br><br>Anybody have any suggestions, resources, or tutorials on this kind of thing?  <br></div>Not really. Short of suggesting a Google search for "Binary Arithmetic" and asking questions on this forum, I'm fresh out of ideas. If you're feeling particularilly adventurous you could teach yourself some assembly language. :o&gt; <br><br></td></tr></table><br>
<a name="193253"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >turtle1776</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmmm. Time to tap into the generousity of one of you higher level gurus. Any chance someone could whip up a function that can poke the proper color into a designated bank/buffer?<br><br>What I have in mind is something like: writeColor(bank or buffer,rgb,x,y), which will write the specified rgb color to the specified bank at the specified x,y location. It would only write one pixel to that location, but if someone wanted more than 1 pixel per function call, they could use this function as the basic example of how to do it.<br><br>As near as I can tell, this function would need to include options for each of the possible rgb formats. <br><br></td></tr></table><br>
<a name="193281"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FlameDuck</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> As near as I can tell, this function would need to include options for each of the possible rgb formats. <br></div>If you want a general function using WritePixelFast is most likely the way to go. The "LockedPixels" is really (IMHO) more suitable for "hardcoded" solutions based on your particular game. The example mentioned above for example could probably be optimized by a factor of ten or so by using constants in place of variables, and a less flexible "wipe" code. <br><br></td></tr></table><br>
<a name="193394"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >turtle1776</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay, I *think* this might clarify how the faster B+ pixel drawing works.<br><br>Here is Mark's lock_graphics demo with a bit more added to show how to add the correct colors. The functions slow things down a bit, but you can easily optimize it. Comments are welcome.<br><br><br>[CODE]<br>;Note that this is B+ code.<br>Const FORMAT_RGB565=1 ;16 bit 565<br>Const FORMAT_XRGB1555=2 ;16 bit 555<br>Const FORMAT_RGB888=3 ;24 bit<br>Const FORMAT_XRGB8888=4 ;32 bit<br><br>Graphics 640,480,16,1;fullscreen!<br><br>timer=CreateTimer(60)<br><br>Repeat<br><br>	Select WaitEvent()<br>	<br>	Case $103	;key down<br>		If EventData()=27 End<br>		<br>	Case $4001	;timer tick<br>	<br>		tm=MilliSecs()<br>		LockBuffer<br>		bank=LockedPixels()<br>		<br>		For y=0 To 479<br>			offset=y*LockedPitch()<br>		<br>			Select LockedFormat()<br>			Case FORMAT_RGB565<br>				For x=0 To 319<br>					PokeShort bank,offset+x*4,Get16Bit565RGB(255,0,255)<br>					PokeShort bank,offset+x*4+2,Get16Bit565RGB(255,0,255)										<br>				Next<br>			Case FORMAT_XRGB1555<br>				For x=0 To 319<br>					PokeShort bank,offset+x*4,Get16Bit555RGB(255,0,0)<br>					PokeShort bank,offset+x*4+2,Get16Bit555RGB(255,0,0)					<br>				Next<br>			Case FORMAT_RGB888<br>				For x=0 To 639<br>					PokeInt bank,offset+x*4,GetRGB(255,0,0)<br>				Next<br>			Case FORMAT_XRGB8888<br>				For x=0 To 639<br>					PokeInt bank,offset+x*4,GetRGB(255,0,0)<br>				Next<br>			End Select<br>		Next<br>		<br>		UnlockBuffer<br>		tm=MilliSecs()-tm<br>		<br>		Text 0,0,tm<br>		Text 100,0,LockedFormat()<br>		Flip<br>	<br>	End Select<br>	<br>Forever<br>End<br><br><br>Function GetRGB(r,g,b)<br>	;24/32 Bit Conversion - ignore first 8 bits, which are reserved for alpha info<br>	;r 00000000111111110000000000000000 = 00FF0000<br>	;g 00000000000000001111111100000000 = 0000FF00<br>	;b 00000000000000000000000011111111 = 000000FF<br>	;Note: 32 bits = 4 bytes = 2 shorts = 1 int<br><br>	Return b Or (g Shl 8) Or (r Shl 16)<br>End Function<br><br>Function Get16Bit555RGB(r,g,b)<br>	;16 bit 555 Conversion - 1st bit is empty<br>	;r 0111110000000000 = 7C00 = 7*16^3 + 12*16^2 = 31744<br>	;g 0000001111100000 = 03E0<br>	;b 0000000000011111 = 001F = 31<br>	;Note: 16 bits = 2 bytes = 1 short<br>	Return (r/8 Shl 10) Or (g/8 Shl 5) Or (b Shr 3)<br>End Function<br>Function Get16Bit565RGB(r,g,b)<br>	;16 bit 565 conversion - middle green value gets 6 bits<br>	;r 1111100000000000 = F800 = 63488<br>	;g 0000011111100000 = 07E0 <br>	;b 0000000000011111 = 001F = 31<br>	;Note: 16 bits = 2 bytes = 1 short<br>	Return (r/8 Shl 11) Or (g/4 Shl 5) Or (b Shr 3)<br>End Function<br>[/CODE] <br><br></td></tr></table><br>
<a name="194099"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Snarty</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=585" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=585</a><br><br>dunno if you missed that in the code-arc's <br><br></td></tr></table><br>
<a name="194225"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >turtle1776</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Very cool, Snarty. I wish I had seen that earlier. Would have saved me a few hours. Oh well, at least I got the conversions right! <br><br></td></tr></table><br>
<a name="215398"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Griz</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> How about doing the opposite and reading pixels from the locked buffer and seperating their red, green and blue components? That would provide both reading and writing capabilities. <br><br></td></tr></table><br>
<a name="215423"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Snarty</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Griz:<br><br>Here's an example of converting RGB Int's or Shorts to Red, Green and Blue Components.<br><pre class=code>
; RGB to Red, Greed, Blue
; By Paul Snart (Snarty)

LockBuffer
LBank=LockedPixels()
LPitch=LockedPitch()
LFormat=LockedFormat()

Select LFormat

	Case 1
		For y=0 To Height-1
			YPos=y*LPitch
			For x=0 To Width-1
				RGB=PeekShort(LBank,YPos+(x*2))
				Red=((RGB And $F800) Shr 11) Shl 3
				Green=((RGB And $7E0) Shr 5) Shl 2
				Blue=(RGB And $1F) Shl 3
			Next
		Next

	Case 2 ; 1555
		For y=0 To Height-1
			YPos=y*LPitch
			For x=0 To Width-1
				RGB=PeekShort(LBank,YPos+(x*2))
				Red=((RGB And $7C00) Shr 10) Shl 3
				Green=((RGB And $3E0) Shr 5) Shl 3
				Blue=(RGB And $1F) Shl 3					
			Next
		Next		
			
	Case 3,4
		For y=0 To Height-1
			YPos=Y*LPitch
			For x=0 To Width-1
				RGB=PeekInt(LBank,YPos+(x*LFormat))
				Red=(RGB And $FF0000) Shr 16
				Green=(RGB And $FF00) Shr 8
				Blue=RGB And $FF
			Next
		Next

End Select
UnlockBuffer
</pre><br>The Above code will need adjustment to suit your needs, but the conversions are correct. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
