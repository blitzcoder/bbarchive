<!DOCTYPE html><html lang="en" ><head ><title >Moving a piece</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Moving a piece</h1><a href="forums.php" >BlitzPlus Forums</a>/<a href="topics.php?forum=81" >BlitzPlus Programming</a>/<a href="#bottom" >Moving a piece</a><br><br>
<a name="1016946"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Martin W</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have a problem with a square game board, and moving pieces.  What I want to do is click on a piece I want to move, and have that piece image attach to and move with the mouse pointer to a new location, then drop the piece on the new location.  Subsequently I update the game position by changing the occupancy of the tile vacated and the tile where the piece has been moved to.  Sounds simple enough but I haven't been able to find anything in the BlitzPlus help files about changing the mouse pointer to a new image, moving the image around over the rest of the board as background and putting the moved image in the new location.  Any ideas? <br><br></td></tr></table><br>
<a name="1016947"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> There are many ways of doing this, I'm not sure what your experience is with programming but I'll try and give some general tips.<br><br>To change the mousepointer:<br><br>Use the 'hidepointer' command to hide the windows mouse pointer.<br>Create an image (or images) which you want to use for your mouse pointer, and use the drawimage command with the coordinates of the mouse position (mousex() mousey()) for the location.  The 'frame' flag is useful if you want to have different appearances for the mouse cursor, simply change the frame value, assuming you loaded your image with the loadanimimage command.<br><br>For moving the game pieces / objects what I may suggest is as follows:<br><br>keep a type list of all your pieces containing (at least) the following variables:<br><br>eg:<br><br><pre class=code>
type mygamepieceobject

field scrx,scry,gameimagehandle,pieceselected

end type

</pre><br><br>Then, when a piece is clicked on (compare mouse coordinates with the coordinates of your gamepieceobject (scrx &amp; scry), if it is within a certain bounding area set all other pieces "pieceselected" to 0, then set the current piece pieceslected to 1, this is to indicate which piece is selected.<br><br>Then in your loop, scan through the list of gamepieces, and for the one which has 'pieceselected' set to 1 draw it at the mouse coordinates.<br><br>Hope that gives you some idea. <br><br></td></tr></table><br>
<a name="1016958"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Martin W</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks, Matty.  Years ago I programmed a crossword game on the Commodore 64, using sprites for the letters and placing them on the board.  That's the effect I was trying to create in BlitzPlus.  Here is some code that appears to work.  Not very efficient or polished I'll admit.<br><br>Global gfxBoardImage, BoardSize, CardsOnBoard<br>;(other definitions)<br>Graphics 800, 600, 16, 2       ;a convenient window size<br>SetBuffer BackBuffer()<br><br>; load a game image<br>BoardSize = 6               ; 6x6 square version<br><br>Const CardPath$ = "C:\Data\Projects\BlitzBasic\Kartik\"<br><br>gfxBoardImage = LoadImage(CardPath$ + "Kartik" + BoardSize +".bmp")<br>DrawImage (gfxBoardImage, 0, 0)<br>;The image has been previously stored from a different program.<br>Flip<br>;Save the current state of the game as a background image<br>SaveBuffer (FrontBuffer(), CardPath$+"Kartik"+"Game.bmp")<br>WaitKey()                    ;so that we have a random seed time<br>SeedRnd MilliSecs()<br>CardSize = 568/BoardSize - 3         ;defines the size of the card image<br>Kltr = Rand(59)+1       ; In the real game this was determined in the deal<br>CardFiles$ = "aaaAbbBccCddeeeEffgghhiiIjkkllLmmnnNooOppqrrRssSttuUvwwxyyz*" <br>Klnam$ = Mid$(CardFiles$,Kltr,1)	;a letter in the string above<br>KltA=Asc(Klnam$)			;ASCII value of the letter will be 65 to 90, 97 to 122<br>;get card image to be played from file<br>If Kltr = 60 Then<br>	CardImage$ = "KLtrG-"+".bmp" ;naming convention from old version<br>ElseIf KLtA &gt; 91 Then<br>    CardImage$ = "KLtrB"+Klnam$+".bmp"<br>Else<br>	CardImage$ = "KLtrR"+Klnam$+".bmp"<br>End If<br>;load card image<br>gfxCardImg = LoadImage(CardPath$ + CardImage$)<br>ScaleImage gfxCardImg, (0.8*6/BoardSize), (0.8*6/BoardSize)<br>;it needs scaling to the window size etc.<br><br>MoveMouse(100-CardSize/2, 212)  ;set the mouse to the initial location<br><br>DrawImage(gfxCardImg, 100-CardSize/2, 212) ;draw the card image<br><br>Flip<br><br>WaitKey()     ;just to allow viewing the image<br>;moving the sprite loop<br>While CardsOnBoard &lt; BoardSize * BoardSize<br>	gfxBoardImage = LoadImage(CardPath$+"KartikGame.bmp")<br>	<br>	While Not MouseDown(1)<br>;redraw the game state	<br>		DrawImage (gfxBoardImage, 0, 0)<br>;clean up the lines as these tend to be wiped by the card when moving<br>		Color 0, 0, 0				;color for dividing lines<br>		Rect 216, 16, 568, 568, 0	;draw edge of tray area.<br>		For i = 1 To BoardSize-1	;draw grid in tray area<br>  			Line 216+(568*i/BoardSize), 16, 216+(568*i/BoardSize), 584<br>  			Line 216, 16+568*i/BoardSize, 784, 16+568*i/BoardSize<br>		Next<br>	<br>;Draw card image attached to mouse<br>		DrawImage (gfxCardImg, MouseX(), MouseY())<br>		Flip<br>	Wend<br>;move sprite to nearest allowed location for card. i &amp; j are cell row &amp; col.<br>	i = Int((MouseX()-216)/(568/BoardSize))<br>	j = Int((MouseY()-16)/(568/BoardSize))<br>	MoveMouse(218+(568*i/BoardSize), 18+(568*j/BoardSize))<br>	DrawImage (gfxBoardImage, 0, 0)<br>	For i = 1 To BoardSize-1	;draw grid in tray area<br>  		Line 216+(568*i/BoardSize), 16, 216+(568*i/BoardSize), 584<br>  		Line 216, 16+568*i/BoardSize, 784, 16+568*i/BoardSize<br>	Next<br><br>	DrawImage (gfxCardImg, MouseX(), MouseY())<br>	Flip<br><br>	CardsOnBoard = CardsOnBoard + 1<br>	Kltr = Rand(59)+1         ;this isn't how determined in the game<br>	Klnam$ = Mid$(CardFiles$,Kltr,1)	;a letter in the string above<br><br>	KltA=Asc(Klnam$)			;ASCII value of the letter will be 65 to 90, 97 to 122<br><br><br>	If Kltr = 60 Then<br>		CardImage$ = "KLtrG-"+".bmp"      ;green star card<br>	ElseIf KLtA &gt; 91 Then<br>    	CardImage$ = "KLtrB"+Klnam$+".bmp"  ;black letter card<br>	Else<br>		CardImage$ = "KLtrR"+Klnam$+".bmp" ;red letter card<br>	End If<br><br>	gfxCardImg = LoadImage(CardPath$ + CardImage$)<br>	ScaleImage gfxCardImg, (0.8*6/BoardSize), (0.8*6/BoardSize)<br>	MoveMouse(100-CardSize/2, 212)<br><br>	DrawImage(gfxCardImg, 100-CardSize/2, 212)<br><br>	WaitKey()        ;now save revised board state<br>	SaveBuffer (FrontBuffer(), CardPath$+"KartikGame.bmp")<br>	<br>Wend<br><br>WaitKey()<br><br>Some additional comments: <br>This is just a tryout program to get the basic idea working. The card sprite, attached to the Windows mouse pointer, moves over the background image smoothly and the lines separating the board spaces are redrawn at each interval before the card is redrawn, as I found the lines were getting erased.  When the card is positioned somewhere in a board space, it and the mouse are moved to the correct point to center the card on the space.  In the real game the board is an array of type BoardCell which has parameters like the coordinates of the card top left point so the calculation here isn't needed, it's done up front.  Also the cards aren't randomly selected, they have been "shuffled" and dealt to the players and are taken from each player's hand in turn (more types). <br>It's a lot less complicated in C-64 BASIC or for that matter Sinclair QL.<br>Next step, to implement something similar in BlitzMax. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
