<!DOCTYPE html><html lang="en" ><head ><title >Virtual Memory low. Memory Leak?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Virtual Memory low. Memory Leak?</h1><a href="forums.php" >BlitzPlus Forums</a>/<a href="topics.php?forum=81" >BlitzPlus Programming</a>/<a href="#bottom" >Virtual Memory low. Memory Leak?</a><br><br>
<a name="423065"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >weebo</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi, I have written a pretty basic program designed to sit on a PC and run 24/7.  Trouble is after a few hours windws reports virtual memory is running low which I think means there is a flaw in my programming using up more and more memory.  Here is the code, perhaps someone can point out the flaw in my program. <br><br>; Merlin Whiteboard Display<br>; Full screen 12 Line display of a Text file created by Whiteboard VB program<br>; By Neil Corbett<br><br>;Global Variables<br>	Dim bayarray$(11,255)						;This array holds all the information (row/column)<br>	Global fntArial								;Font for Display<br>	Global scramblecount						;for matrix effect<br>	Const whiteboard_file$ = "config.dat"		;file containing data<br>	Global quote$<br>	<br>;string manipulation<br>	Dim currentchar(11)					<br>	Dim length(11)<br>	<br>;misc<br>	Global updatetimer<br>	Global background_image<br>	<br><br>;	Includes	<br>	Include "whiteboard1.bb"	;Static board with scrolling on longer descriptions<br>	Include "whiteboard2.bb"	;Displays the IT Helpline number<br>	Include "whiteboard3.bb"	;Displays the IT Quote of the day<br><br><br>	<br>; ==============================================================================================;<br>;	Main Program<br><br><br>	initialisevideo	<br><br>Repeat<br><br>	;select which view to display on this pass<br>	SeedRnd (MilliSecs())<br>	mode = Rand(1,3)<br>	<br>	;load the array for updates<br>	load_array(whiteboard_file)<br>	<br>	updatetimer = 0<br>	<br>	;Run the preloop code for the selected mode<br>	If mode = 1Then whiteboard1preloop		<br>	If mode = 2 Then whiteboard2preloop<br>	If mode = 3 Then whiteboard3preloop<br>	<br>	Repeat<br>			;run the random view selected until next pass<br>			If mode = 1 Then whiteboard1loop<br>			If mode = 2 Then whiteboard2loop<br>			If mode = 3 Then whiteboard3loop	<br><br>			updatetimer = updatetimer + 1<br>			If KeyHit(1) Then End<br>	Until updatetimer = 500 Or KeyHit(1)<br><br>Until KeyHit(1)<br><br>;	End of Main Program<br>; ==============================================================================================;<br><br><br>Function initialisevideo()<br>;Prepare the variables before running the main loop<br><br>	;set the resolution<br>	Graphics 1024,768,32,1<br>	<br>	;Prepare the Fonts<br>	fntArial=LoadFont("Arial",30,False,False,False) <br>	SetFont fntArial <br><br>End Function<br><br><br>Function load_array(file_to_open)<br>	<br>	;open the file to read<br>	filein = ReadFile(whiteboard_file) <br><br>	;Read the Header<br>	quote = ReadLine(filein)<br>		<br>	;Read each line in the file to the array<br>	For count = 0 To 11<br>		For count2 = 0 To 3<br>				bayarray(count,count2) = ReadLine(filein)<br>		Next<br>	Next	<br>	<br>	CloseFile( filein ) <br>	<br>	;add whitespace to scrolling text<br>	For count = 0 To 11<br>	Length(count) = Len(bayarray(count,1))           <br>	If length(count) &gt; 48 Then bayarray(count,1) = "                                                  " +  bayarray(count,1)<br>	Next<br>	<br>	;set the First letter of the descriptions To 1<br>	For count = 0 To 11<br>		currentchar(count) = 1<br>	Next<br>	<br>End Function<br><br><br>****************This is the second file included<br><br>Function whiteboard1preloop()<br><br>	scramblecount = 100<br>	<br>	;load the background image<br>	background_image = LoadImage("background.jpg")<br>	<br>	;Prepare the Fonts<br>	fntArial=LoadFont("Arial",30,False,False,False) <br>	SetFont fntArial <br><br>	While scramblecount &lt;&gt; 0			;Displays scrambling text for a few seconds<br>	<br>		SetBuffer BackBuffer()<br>		Cls<br>		DrawImage(background_image,0,0)	<br>		updatescramble<br>		Flip<br>	<br>		scramblecount = scramblecount - 1<br>		Delay(20)<br>	Wend<br>	<br>End Function<br><br>Function whiteboard1loop()<br>						<br> 	update_changes<br>	update_screen<br>	Delay(200)<br><br>End Function<br><br>Function updatescramble()<br>	<br>	x = 40<br>		For count2 = 0 To 3<br>			If count2 = 1 Then	;this is the description field<br>				Text(x,100,Chr(Rand(97,122)),False,True)<br>				Text(x,150,Chr(Rand(97,122)),False,True)<br>				Text(x,200,Chr(Rand(97,122)),False,True)<br>				Text(x,250,Chr(Rand(97,122)),False,True)<br>				Text(x,300,Chr(Rand(97,122)),False,True)<br>				Text(x,350,Chr(Rand(97,122)),False,True)<br>				Text(x,400,Chr(Rand(97,122)),False,True)<br>				Text(x,450,Chr(Rand(97,122)),False,True)<br>				Text(x,500,Chr(Rand(97,122)),False,True)<br>				Text(x,550,Chr(Rand(97,122)),False,True)<br>				Text(x,600,Chr(Rand(97,122)),False,True)<br>				Text(x,650,Chr(Rand(97,122)),False,True)<br>			End If<br>		<br>		If count2 &lt;&gt; 1 Then<br>			Text(x,100,Chr(Rand(80,100)),False,True)<br>			Text(x,150,Chr(Rand(80,100)),False,True)<br>			Text(x,200,Chr(Rand(80,100)),False,True)<br>			Text(x,250,Chr(Rand(80,100)),False,True)<br>			Text(x,300,Chr(Rand(80,100)),False,True)<br>			Text(x,350,Chr(Rand(80,100)),False,True)<br>			Text(x,400,Chr(Rand(80,100)),False,True)<br>			Text(x,450,Chr(Rand(80,100)),False,True)<br>			Text(x,500,Chr(Rand(80,100)),False,True)<br>			Text(x,550,Chr(Rand(80,100)),False,True)<br>			Text(x,600,Chr(Rand(80,100)),False,True)<br>			Text(x,650,Chr(Rand(80,100)),False,True)<br>		End If<br>			If count2 = 0 Then x = x + 55 <br>			If count2 = 1 Then x = x + 590<br>			If count2 = 2 Then x = x + 130  <br>		Next<br><br>End Function<br><br>Function update_screen() <br><br>	SetBuffer BackBuffer()<br>	Cls<br>	DrawImage(background_image,0,0)<br>	draw_text<br>	Flip	<br><br>End Function<br><br>Function update_changes()<br><br>	For count = 0 To 11<br>		Length(count) = Len(bayarray(count,1))<br>		If currentchar(count) = length(count) Then currentchar(count)  = 1<br>		If length(count) &gt; 48 Then currentchar(count) = currentchar(count) + 1		<br>	Next<br><br>End Function<br><br><br>Function draw_text()<br>	<br>	x = 40<br>		For count2 = 0 To 3<br>			If count2 = 1 Then	;this is the description field<br>				Text(x,100,Mid(bayarray(0,count2),currentchar(0),48),False,True)<br>				Text(x,150,Mid(bayarray(1,count2),currentchar(1),48),False,True)<br>				Text(x,200,Mid(bayarray(2,count2),currentchar(2),48),False,True)<br>				Text(x,250,Mid(bayarray(3,count2),currentchar(3),48),False,True)<br>				Text(x,300,Mid(bayarray(4,count2),currentchar(4),48),False,True)<br>				Text(x,350,Mid(bayarray(5,count2),currentchar(5),48),False,True)<br>				Text(x,400,Mid(bayarray(6,count2),currentchar(6),48),False,True)<br>				Text(x,450,Mid(bayarray(7,count2),currentchar(7),48),False,True)<br>				Text(x,500,Mid(bayarray(8,count2),currentchar(8),48),False,True)<br>				Text(x,550,Mid(bayarray(9,count2),currentchar(9),48),False,True)<br>				Text(x,600,Mid(bayarray(10,count2),currentchar(10),48),False,True)<br>				Text(x,650,Mid(bayarray(11,count2),currentchar(11),48),False,True)<br>			End If<br>		<br>		If count2 &lt;&gt; 1 Then<br>			Text(x,100,bayarray(0,count2),False,True)<br>			Text(x,150,bayarray(1,count2),False,True)<br>			Text(x,200,bayarray(2,count2),False,True)<br>			Text(x,250,bayarray(3,count2),False,True)<br>			Text(x,300,bayarray(4,count2),False,True)<br>			Text(x,350,bayarray(5,count2),False,True)<br>			Text(x,400,bayarray(6,count2),False,True)<br>			Text(x,450,bayarray(7,count2),False,True)<br>			Text(x,500,bayarray(8,count2),False,True)<br>			Text(x,550,bayarray(9,count2),False,True)<br>			Text(x,600,bayarray(10,count2),False,True)<br>			Text(x,650,bayarray(11,count2),False,True)<br>		End If<br>			If count2 = 0 Then x = x + 55 <br>			If count2 = 1 Then x = x + 590<br>			If count2 = 2 Then x = x + 130  <br>		Next<br><br>End Function<br><br>*******************************************************<br><br><br>I am only interested in the whiteboard1 include, the other 2 are blank at present for future additions.<br><br>Thanks to anyone who takes a look! <br><br></td></tr></table><br>
<a name="423258"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >soja</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I just glanced at it, but you're putting a whole bunch of things in functions that look like they should onlyu be done once (or if not, you're not freeing the originals before loading another)...<br><br>For instance:<br>a) In your main loop, put Repeat after loadarray or updatetimer=0<br>b) In your whiteboard1preloop() function, load the image and the font only once.  That could mean to put them in another function that is only called ONCE before your Repeat in the main loop. <br><br>Stuff like that.  There may be more.  Basically, just look for where memory is allocated and not freed multiple times (like in your loop).  =) <br><br></td></tr></table><br>
<a name="425064"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >weebo</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>I see what you mean, but that is by design.  The program displays information from a file that is updated frequently externally.  So the program reloads the file in to the arrays etc on each pass, that's why it is nested within the repeat loop. <br><br></td></tr></table><br>
<a name="425157"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >soja</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I see, then just make sure anytime you call something that allocates memory (like LoadImage), you call the appropriate command to delete/free that memory (like FreeImage) before you load something else with it.<br><br>There are some commands which I don't see why you would need to call them more than once, though, e.g. SeedRnd, LoadFont, SetFont. <br><br></td></tr></table><br>
<a name="426076"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >weebo</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks, you have to see the program running really to understand why I'm doing some of the odd things going on, but you have been a great help with the freeimage etc thats sorted it.<br><br>My own laziness I guess. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
