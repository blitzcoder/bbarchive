<!DOCTYPE html><html lang="en" ><head ><title >How to get an images device context?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >How to get an images device context?</h1><a href="forums.php" >BlitzPlus Forums</a>/<a href="topics.php?forum=81" >BlitzPlus Programming</a>/<a href="#bottom" >How to get an images device context?</a><br><br>
<a name="329523"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >REDi</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Does anyone know how to get the DC of an image?<br><br>I thought maybe ImageBuffer() might pass it, but it seems it doesn't :(<br>Any ideas? <br><br></td></tr></table><br>
<a name="329536"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >soja</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, it's as simple as calling GetDC from User32.  =)  I've done it successfully in my projects.<br><br><pre class=code>
; .lib "user32.dll"
; GetDC%(hwnd%):"GetDC"
; ReleaseDC%(hwnd%, hdc%):"ReleaseDC"

dc% = GetDC(QueryObject(gadget,1))
If Not dc Then DebugLog "Error getting DC"
If Not ReleaseDC(QueryObject(gadget,1), dc) Then DebugLog "Error releasing DC"</pre><br><br>&lt;EDIT&gt; Oh, incidentally I just noticed that you said "device context of image"... well, I suppose you mean the gadget/window that the image is drawn to, which is known by Blitz (assuming it's using GDI?)<br><br>So maybe this isn't the answer you're looking for.  I don't think Blitz will give it to you anyway.  Still you CAN get another DC to the same space if you want to do your own painting. <br><br></td></tr></table><br>
<a name="329537"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >REDi</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Really I'm after drawing to an image using the Gdi32 functions like ExtFloodFill ect, I've managed it okay with purebasic because it allows you to get the DC, but i can't figure it out in blitz.<br><br>I didn't know that you can create new DCs :) I'm new to all this windows stuff, I'll have to look into that.<br><br>Thanx soja <br><br></td></tr></table><br>
<a name="329549"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >soja</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh yeah, in that case, that's what you do.<br><br>1) GetDC<br>2) Call GDI drawing functions<br>3) Release DC<br>4) Repeat when you need to<br><br>For example, in order to fill the background of a window with a certain pattern, here's what I did/used:<br><br>1) CreateBitmap (Creates a bitmap)<br>2) CreatePatternBrush (creates a brush with the bitmap's pattern)<br>3) GetDC (get a device context to window)<br>4) GetSysColor (gets color of window background)<br>5) SetBkColor (make sure the brush is the right color)<br>6) FillRect (paint the brush onto the window background)<br>7) ReleaseDC (release the device context)<br><br>I do steps 3-7 60 times a second with almost no CPU usage. <br><br></td></tr></table><br>
<a name="329562"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >REDi</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> ???<br><br>ImageID = CreateImage(256,256)<br>Debuglog GetDC(ImageID) ; returns 0 :(<br><br>GetDC works okay for windows ect but not on images, am i missing something here?<br><br>Purebasic allows this...<br><br>CreateImage(1,256,256)<br>UseImage(1)<br>OutPut = ImageOutput()<br>DC = StartDrawing(OutPut)<br>Debug Str(DC)    ; shows the DC for the image<br>EXTFloodFill_(DC,10,10,Point(10,10),1)<br>StopDrawing()<br><br>Sorry to be a pain, but can this be done in blitz? Thx <br><br></td></tr></table><br>
<a name="329570"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Snarty</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> You may be able to get the DC of a Canvas rather than the image. I'm not 100% sure on this, but it's my theory. <br><br></td></tr></table><br>
<a name="329738"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >soja</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, I think that PureBasic must be doing something underneath, because AFAIK you can only get device contexts for gadgets/windows.  Try getting the a DC to the canvas like Snarty says, but make sure you use QueryObject(gadget,1) as the argument to GetDC. <br><br></td></tr></table><br>
<a name="329978"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >REDi</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Snarty your theory is fact! :D it does work well with a canvas.<br><br>But i still can't use it because i need it to work with Blitz3D as well as BlitzPlus :(<br><br>Well i'll either have to write a fast flood fill algorithm or just use pure for this project, lets hope BlitzMax covers this when we get it;)<br><br>Thanx all<br><br><br>&lt;Edit&gt;<br>I've just realized that when the window is repainted any changes you made to canvas through the DC are lost, it seems to draw to the gadget and not to the canvas buffer :( <br><br></td></tr></table><br>
<a name="330000"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >soja</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> ...which is why it needs to be updated by you.  I have a loop that updates my stuff 60 times per second.  To minimize the CPU hit, I tried peeking into Blitz' message queue to find messages indicating that I would need to repaint the gadget, but I wasn't able to make anything work.  Unfortunately.  <br><br>Anyway, mixing GDI and Blitz is a pain.  Yes, it sure would be nicer if Blitz "supported" more... <br><br></td></tr></table><br>
<a name="330083"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Snarty</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thats good to know Cliff, handy for Blitz+ as you said, but, starts becoming a pain for Blitz3D.<br><br><a href="http://www.blitzbasic.co.nz/codearcs/codearcs.php?code=263" target="_blank">Blitz Flood Fill</a> <br><br>soja, I agree with WinAPI support.<br><br>At least I can have a play with canvas DC's now :) <br><br></td></tr></table><br>
<a name="330410"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >REDi</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Snarty<br><br>Did you read my edit at the bottom?... :(<br><br>Thanx for the link m8, nice work :D <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
