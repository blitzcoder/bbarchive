<!DOCTYPE html><html lang="en" ><head ><title >isGadget(gadget)</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >isGadget(gadget)</h1><a href="forums.php" >BlitzPlus Forums</a>/<a href="topics.php?forum=81" >BlitzPlus Programming</a>/<a href="#bottom" >isGadget(gadget)</a><br><br>
<a name="767139"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Moore</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is there anyway of detecting if a gadget handle is valid with out crashing the computer. I'm allowing users to create scripts and I want to prevent a crash if they use the wronge value for a handle.... something like:<br>bool isGadget(int gadHandle)<br><br>Thanks! <br><br></td></tr></table><br>
<a name="767154"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> You could keep a list of valid gadget handles in a bank (for example) and compare the values to the value set in a script when the script runs, unless you have tens of thousands of gadgets the speed impact will be negligible although for a gui app it most definitely will not be noticeable.<br><br>EDIT :<br>kind of like this:<br><br>when a new gadget is created add its handle to a type list , and when it is removed/deleted/freed remove the handle from the list.<br><br>This list can be used to compare any script references to gadget handles with. <br><br></td></tr></table><br>
<a name="767435"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Moore</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmmmm... then I would need to wrap all the gui functions to do the tracking and checking. Right now the script language gives the user direct access to the gui functions.... Well, its one possible solutions. Is there anything available in the user32.dll do check gadgets.... <br><br>Maybe I could create a function in C++ to check the x value of a gadget. Then using a try/catch I could detect the error and return false or true if ther is no error <br><br></td></tr></table><br>
<a name="767447"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kev</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> you could use the api IsWindow() found within user32.dll pass IsWindow() the HWND pointer returned from QueryObject() <br><br></td></tr></table><br>
<a name="767761"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Moore</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> function isGadget(gadgetHndl)<br>if isWindow(QueryObject(gadgetHndl, 1)) then return true<br>return false<br>end function<br><br>testing this now.... <br><br></td></tr></table><br>
<a name="767763"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Moore</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> function isGadget(gadgetHndl)<br> if isWindow(QueryObject(gadgetHndl, 1)) then return  true<br> return false<br>end function<br><br>This crashes in blitz when an invalid gadgetHndle is used. Ill try porting it to a C++ DLL. Just not tonight. I need some zees. :) <br><br></td></tr></table><br>
<a name="767767"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kev</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> use FindWindow.<br><br>decls<br><pre class=code>
API_FindWindow%(lpClassName%,lpWindowName$):"FindWindowA"
API_IsWindow%(hwnd%):"IsWindow"
</pre><br><br>blitz+ code<br><pre class=code>
window_test = CreateWindow("Test Window - Default (15)",0,500,400,100,0)

Notify isWindow("Test Window - Default (15)")

; wait until the user closes one of the windows
Repeat
	If WaitEvent()=$803 Then Exit
Forever
End ; bye!

Function isWindow(window_title$)

hwnd = API_FindWindow(0,window_title$)
Return API_IsWindow(hwnd)

End Function
</pre> <br><br></td></tr></table><br>
<a name="768319"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Moore</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> OK, created the dll..... it works fine.... but I need to use queryObject and THAT is what crashes it! arg! Heres the code: <br><br>(C++ DLL)<br>BBDECL bool BBCALL isGadget(HWND hWnd) <br>{<br> try{<br>     return IsWindow(hWnd);<br>     }<br> catch(...)<br> {<br>      return false;<br> }<br>}<br><br>in B+<br><br>if isGadget(QueryObject(handle, 1)) then<br>; blah, blah, blah<br>endif<br><br>Any ideas? <br><br></td></tr></table><br>
<a name="768322"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Moore</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmmmmm..... I guessed that gadget handles were actually pointers so when I pass the pointer to c++ and check the value I get an int.... if the gadget handle is for a valid gadget I get some value. If the gadget is freed then I get 0. I know that there is still a chance that the memory maybe written over so this is not perfect. More over if I pass a value less then 9764864 the dll will causes a crash. I guess 9764864 is either not a valid or is a protected memory address. And Im sure this too may not be the same on every computer.....<br><br>C++<br>BBDECL bool BBCALL isGadget(int* ptr) <br>{<br>     if (int(&amp;ptr) &lt; 9764864){ return false; }<br>     // int x = *ptr; // will still crash comp if &amp;ptr &gt;  9764864... even in try block<br>try{<br>     int x = *ptr;<br>     if (*ptr == 0){return false;}<br>     return true;<br>     }<br> catch(...)<br> {<br>      return false;<br> }<br> return false;<br>}<br><br>b+<br>win = createwindow(.....)<br>print isGadget(win) ; prints 1<br>freegadget win<br>print isGadget(win) ; prints 0<br>print isGadget(123) ; prints 0<br><br><br>So it works, NO CRASH. I just don't know how portable or reliable it is. <br><br></td></tr></table><br>
<a name="768382"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kev</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Moore <br> <br>If i recall correct, when b+ creates windows or gadgets it first create's an internal struct to store these values. im unsure of the offset within the pointer returned where the windows HWND is stored. <br><br>it should be possable to scan the passed value and check IsWindow on each pointer until a pre-defined offset is reached.<br><br>kev <br><br></td></tr></table><br>
<a name="769475"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Moore</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Kev, Good idea! I did in fact look into that and EACH gadget has a slightly different structure. The offset for a window is not the same as an offset for a panel. Looks like my best choice is to limit what the user can do with the script language and wrap the GUI. Thanks all! <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
