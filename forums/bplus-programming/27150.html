<!DOCTYPE html><html lang="en" ><head ><title >Load PNG from memory</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Load PNG from memory</h1><a href="forums.php" >BlitzPlus Forums</a>/<a href="topics.php?forum=81" >BlitzPlus Programming</a>/<a href="#bottom" >Load PNG from memory</a><br><br>
<a name="284234"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Imphenzia</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Loading PNG images from the memory instead of the drive would be nice, but it's not still possible I suppose =) <br><br>I'd like to do this so I can encrypt png files and then load the file into memory, decode the encryption in the memorybank then use the LoadImage command on the memory bank. I am quite certain it's not possible with blitz, and I also assume that a PNG decoder written in blitz would be too slow.<br><br>(I would like to avoid using the existing "packers" if possible, that's not the solution I've got in mind for a number of reasons)<br><br>Any thoughts? <br><br></td></tr></table><br>
<a name="284306"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Seldon</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Using DECLS, you could try to use the API commands for retrieving files from an EXE's resources (LoadResource(), LockResource(), etc..). You must use a program like ResHacker to add all the PNG files into your Blitz EXE. I think you can get a valid pointer to data, but then I don't know if you can use Blitz bank commands with it. I don't have B+ yet so I have to try (but still you'd need to code your own PNG decoder in Blitz). <br><br>Another solution is to pack the PNG files into an external DLL's resources. You call the DLL from the Blitz program and you get a pointer to the bitmap data (in Blitz, you pass a bank). Then, using a Bank2Image function you poke the bitmap data to a valid image created with Blitz. I think this is a solution that can work indeed.<br><br>The DLL should unpack and decode the PNG files into flat bitmap data. Such task could be done easily with PureBasic (it has an internal PNG decoder and a general packer). <br><br></td></tr></table><br>
<a name="284511"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Clyde</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> What benefit would this have? As Im interested in reading on your findings! <br><br></td></tr></table><br>
<a name="284525"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Imphenzia</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Mikey, not sure whether you're asking about the benefit of my question or Seldon's comments. Anyhow, in my case, I want to encrypt a .PNG file as it is saved to the disk so that any graphics program doesn't recognize it allowing easy modifications etc.<br><br>The benefit of being able to do this is that a file can be loaded from the disk into a memory bank and manipulated into a recognized PNG file in the process. Following this, the image can be loaded as an image into the video memory using a LoadImage command from a memory bank.<br><br>The reason why I want to avoid bundling files with my executables or as pak files is that the game is allowing custom addon packs (and there's over 100MB of graphics to begin with). My car / circuit editors would then export the images to the encrypted file format. Another reason for avoiding so called "packers" is that I believe they uncompress the files temporarily which means that if the computer crashes, the files may be left exposed (I think).<br><br>Stefan <br><br></td></tr></table><br>
<a name="284532"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Perturbatio</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I once wrote some functions that were the start of loading PNG's from a bank and saving to a bank (It should be in the code archives somewhere). <br><br></td></tr></table><br>
<a name="284559"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Seldon</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think the idea of a DLL keeping the images in its resources as packed/compressed data can work (you have just to change the DLL and you have another set of gfx). I've already such kind of thing working and I could make it indeed. Since the data can be compressed, the use of PNG is not that useful, that's why I'd use normal BMP.<br><br>The Blitz program should have two functions:<br><br>ListImages() -&gt; it returns the list of images<br><br>image_handle=LoadPackedImage("name") -&gt; it loads a packed/compressed image from inside the DLL.<br><br>The best would be to have a configuration tool to put inside the DLL all the needed images. I have no time (work) to realize the configuration tool, but I can do the DLL and Blitz functions easily. If someone wants to start a colaboration, we could do a nice thing for all Blitz users (it can work for both B2D/3D or B3D/B+ using DECLS). <br><br></td></tr></table><br>
<a name="284574"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Perturbatio</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> The problem with storing the images as a res is that it's a pain in the butt to write resources to an executable module in win9x/ME since it doesn't support UpdateResource (and it's companion commands). <br><br></td></tr></table><br>
<a name="284576"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Perturbatio</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> They could however be stored as a compressed file with optional encryption (i.e. blowfish), the individual files could be relatively easily unencrypted and decompressed in memory. <br><br></td></tr></table><br>
<a name="284579"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Skitchy</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just use MoleBox :<br><a href="http://www.molebox.com/" target="_blank">http://www.molebox.com/</a><br><br>If you want to protect EVERYTHING (music,sounds,images,models,textures,dll's) it's perfect. Costs about £70, but I think it was worth every penny.<br>:) <br><br></td></tr></table><br>
<a name="284632"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Seldon</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, dealing with resources needs some work. You can use an external file of course, the reason I suggested a DLL is that since it'd be very difficult to write a good compression&amp;encryption function with Blitz (since it has no pointers, etc..) , to have a DLL with files inside, it seems more handy. Besides, usually people don't pay attention to DLL if they're looking for pictures. <br><br></td></tr></table><br>
<a name="284811"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Seldon</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Little update:<br><br>I successfully did a tiny converter that takes a BMP/PNG/JPG/TGA/TIFF picture, decodes to Blitz's Image format and compresses it. A 27KB BMP has been compressed in 882 bytes !! The data will be stored in the resources of a DLL that will be called by Blitz (I still have to finish this part). <br><br></td></tr></table><br>
<a name="284887"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Imphenzia</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's a good feature, especially for smaller games I think! Is it using RLE compression? Does that util actually create the DLL by the way? <br><br></td></tr></table><br>
<a name="284908"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Seldon</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> That's what I'd like to do. At the moment, it creates a .RES file to be added to DLL using a tool like ResHacker (btw, do you know some other tools like this?). The DLL is general purpose, you don't need to change it when you change the pictures inside. <br><br></td></tr></table><br>
<a name="286828"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Seldon</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, just to let you know that I've successfully included a compressed image in the Blitz's EXE as a real resource. The program loads data from resources, uncompresses all and gets a normal Blitz image.<br><br>No temporary saving on hard-disk, no waste of memory and very fast speed (it's faster than loading it from disk).<br><br>From Blitz's side you have only to do:<br><br>image=LoadResourceImage(num_of_resource)<br><br>and you get a valid Blitz image handle. At the moment I'm using an external DLL (13KB long) to make decompression, with B+ I may not need any DLL, but unfortunately there's no efficient compression/decompression routine written in Blitz. Does someone know some compression code to look and possibly translate in Blitz ?<br><br>If someone wants the sample source in Blitz, the translater tool and the DLL, email me at: h.seldon@... <br><br></td></tr></table><br>
<a name="286855"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Imphenzia</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> There are some compression routines in the code archives for RLE and Huffman, but I don't think they are fast enough. <br><br></td></tr></table><br>
<a name="286879"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Seldon</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thank you. I tried the Huffmann staff, it'd be fast enough but the compression ratio is low. My DLL compressed a 24bit 500KB BMP in 12KB. The Blitz EXE was only 12KB longer and it taked 13 millisecs to show the image in a 800x600 screen (I've a Celeron@1GHz). The Huffmann code did 124KB for the same BMP.. not so bad, maybe I could use it. Though I want to try to make the LZW stuff on Blitz (hard work I know :-).<br><br>The Blitz Real Packer<br>---------------------<br><br>- Loads several formats (BMP,PNG,TIFF,JPG)<br>- Compresses and packs your pictures inside your Blitz's EXE as real Windows resources<br>- Real resource means: 1) no temporary swapping on HD 2) no waste of memory as the only used memory will be the one needed by CreateImage() 3) professional look of your applications<br>- Easy to use: in your source you've only to do:<br>image=LoadResourceMemory(num_of_resource)<br>- Compatible with Blitz 2D and 3D/B+ .<br>- GUI to manage all the pictures<br><br>... soon available :-) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
