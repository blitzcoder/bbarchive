<!DOCTYPE html><html lang="en" ><head ><title >Create only one instance of a program?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Create only one instance of a program?</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Create only one instance of a program?</a><br><br>
<a name="1234644"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi all. Is there anything floating around that can allow for a program to be opened only ONE time and no more in order to save memory?<br><br>Thank You so kindly! =)<br><br>Sincerely, <br><br>~GF <br><br></td></tr></table><br>
<a name="1234654"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >wmaass</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Maybe use api_FindWindow(). <br><br></td></tr></table><br>
<a name="1234689"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well if they renamed the file, they would be able to open a 2nd instance. Which is what I'm trying to prevent. <br><br></td></tr></table><br>
<a name="1234692"></a>

<a name="1234693"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Create a time stamped "is an instance running" file <br><br></td></tr></table><br>
<a name="1234698"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> time stamped is an instance running file?<br><br>Can you elaborate a little more please?<br><br>Thank You so kindly! =)<br><br>Sincerely, <br><br>~GF <br><br></td></tr></table><br>
<a name="1234708"></a>

<a name="1234709"></a>

<a name="1234710"></a>

<a name="1234711"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Open/create a file, write the time to it, re-write to it every min (say).<br><br>When an instance starts it reads/looks for file, and if the time is less than a min (say) it know an instance is either running or just crashed.<br><br>Fair enough you have to wait a min (say) after a crash, but ALL one instance programs have that restart delay crap, just let the restarted instance hang about for a min (say) and then recheck. If it passes, It will just look like the program is doing some "crash fixing rubbish", and if it fails then so what you made them wait a min (say) before you give the one instance message.<br><br>If you have the cpu time you could check every cycle, but that seems a waste of cycle time to me when once every couple of seconds would appear invisible depending on the start-up speed of your program<br><br>Ps The files location needs to be independent of programme name/location<br>PPS If you really wanted to you could also "crash" the original instance, to discourage this sort of thing. <br><br></td></tr></table><br>
<a name="1234715"></a>

<a name="1234716"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rroff</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> If someone wants to open multiple instances for whatever reason they will - even if it means running one under another name under another user so the other instance can't interfere with it etc.<br><br>If they've renamed the original exe and you can't capture it with find window/get module name, etc. then thats on the user really not a developer problem as such. <br><br></td></tr></table><br>
<a name="1234718"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well the reason is because I don't want people complaining about how when they opened a second instance and had alot of 3D data in the scene, that it would wind up lagging then crashing. <br><br></td></tr></table><br>
<a name="1234725"></a>

<a name="1234726"></a>

<a name="1234727"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> @H&amp;K: Good idea. I tried but can't seem to get this function to work correctly.<br><br>At the top of your main program, put: <br><br>Check_TimeStamp()<br><br>in order to create a "Data/" folder &amp; place "Log.txt" inside the folder.<br><br>I can't get it to compare right.<br><br>TestInstances.bb: <br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">Global timestamp
Global ntimestamp

Function GetUnixTimestamp()
	; Returns a Unix timestamp.

	; A Unix timestamp is the number of seconds since the start of the year 1970.
	; Unix timestamps operate on UTC time (Coordinated Universal Time)
	; which is the same as GMT time (Greenwich Mean Time).
	; Due to the use of UTC, local daylight saving and timezones are not a factor.
	
	; Note that Unix time seems to ignore leap seconds.

	; Requires a 'kernel32.decls' file in the Blitz3D 'userlibs' folder with the contents:-
	; .lib "kernel32.dll"
	; api_GetSystemTime (lpSystemTime*) : "GetSystemTime"

	; The 'kernel32.decls' file can be obtained from:-
	; <a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=1180" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=1180</a>

	; Reference Links:-
	; <a href="http://en.wikipedia.org/wiki/Unix_time" target="_blank">http://en.wikipedia.org/wiki/Unix_time</a>
	; <a href="http://en.wikipedia.org/wiki/Leap_year" target="_blank">http://en.wikipedia.org/wiki/Leap_year</a>
	; <a href="http://en.wikipedia.org/wiki/Leap_second" target="_blank">http://en.wikipedia.org/wiki/Leap_second</a>
	; <a href="http://en.wikipedia.org/wiki/Coordinated_universal_time" target="_blank">http://en.wikipedia.org/wiki/Coordinated_universal_time</a>
	; <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ms724390(v=vs.85).aspx" target="_blank">http://msdn.microsoft.com/en-us/library/windows/desktop/ms724390(v=vs.85).aspx</a>
	; <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ms724950(v=vs.85).aspx" target="_blank">http://msdn.microsoft.com/en-us/library/windows/desktop/ms724950(v=vs.85).aspx</a>

	; To test the results use: <a href="http://www.unixtimestamp.com/" target="_blank">http://www.unixtimestamp.com/</a>

	; Get the UTC/GMT time and date.
	Local timebank = CreateBank( 16 )
	api_GetSystemTime( timebank )
	Local year = PeekShort( timebank, 0 ) ; The year. Exact value.
	Local month = PeekShort( timebank, 2 ) ; The month. Struct values: January = 1 - December = 12
	Local day = PeekShort( timebank, 6 ) - 1 ; The day of the month. The valid values for this struct member are 1 through 31.
	Local hour = PeekShort( timebank, 8 ) ; The hour. The valid values for this struct member are 0 through 23.
	Local minute = PeekShort( timebank, 10 ) ; The minute. The valid values for this struct member are 0 through 59.
	Local second = PeekShort( timebank, 12 ) ; The second. The valid values for this struct member are 0 through 59.
	FreeBank timebank

	; Do we include the current year in the leap year test?
	Local end_year
	If month &gt; 2
		end_year = year
	Else 
		end_year = year - 1
	EndIf
	
	; Calculate if a specific year is a leap year
	Local y
	For y = 1970 To end_year
		If ( y Mod 100 ) = 0
			If ( y Mod 400 ) = 0
				day = day + 1 ; leap year = True
			EndIf
		Else
			If ( y Mod 4 ) = 0
				day = day + 1 ; leap year = True
			EndIf 
		EndIf 
	Next
	
	day = day + ( year - 1970 ) * 365

	If month &gt; 1 Then day = day + 31
	If month &gt; 2 Then day = day + 28
	If month &gt; 3 Then day = day + 31
	If month &gt; 4 Then day = day + 30
	If month &gt; 5 Then day = day + 31
	If month &gt; 6 Then day = day + 30
	If month &gt; 7 Then day = day + 31
	If month &gt; 8 Then day = day + 31
	If month &gt; 9 Then day = day + 30
	If month &gt; 10 Then day = day + 31
	If month &gt; 11 Then day = day + 30
	If month &gt; 12 Then day = day + 31

	Return day * 86400 + hour * 3600 + minute * 60 + second
End Function

Function Check_TimeStamp()

	If FileType("Data") = 0
		CreateDir("Data")
	EndIf

	DeleteFile("Data"+"\"+"Log.txt")
		unixtime = GetUnixTimestamp()
		timestamp = WriteFile("Data"+"\"+"Log.txt")
		WriteLine timestamp, unixtime
		CloseFile timestamp
		new_timestamp = OpenFile("Data"+"\"+"Log.txt")
		ntimestamp = ReadLine(new_timestamp)
		If ntimestamp$ &lt;&gt; unixtime Then End
		CloseFile(new_timestamp)
	DeleteFile("Data"+"\"+"Log.txt")

End Function</textarea><br><br>Thank You so kindly! :)<br><br>Sincerely, <br><br>~GF <br><br></td></tr></table><br>
<a name="1234743"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LineOf7s</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I don't want people complaining about how when they opened a second instance and had alot of 3D data in the scene, that it would wind up lagging then crashing.  <br></div><br>They will anyway. <br><br></td></tr></table><br>
<a name="1234744"></a>

<a name="1234745"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is NOT your personal thread to hijack. If you're not going to be of any help &amp; continue to whine and complain &amp; try to put me down, then LEAVE this thread &amp; DON'T come back! And I don't care WHAT you have to say after this post. <br><br></td></tr></table><br>
<a name="1234746"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LineOf7s</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wow. <br><br></td></tr></table><br>
<a name="1234747"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thank you so kindly. <br><br></td></tr></table><br>
<a name="1234750"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >wmaass</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> In all seriousness, there is always the danger of over thinking or over doing it. Implement a simple check and if your users monkey about, well shame on them. <br><br></td></tr></table><br>
<a name="1234753"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Bear in mind that I don't have b3D<br><br><pre class=code> 	DeleteFile("Data"+"\"+"Log.txt")
		unixtime = GetUnixTimestamp()
		timestamp = WriteFile("Data"+"\"+"Log.txt")
		WriteLine timestamp, unixtime
		CloseFile timestamp
		new_timestamp = OpenFile("Data"+"\"+"Log.txt")
		ntimestamp = ReadLine(new_timestamp)
		If ntimestamp$ &lt;&gt; unixtime Then End
		CloseFile(new_timestamp)
	DeleteFile("Data"+"\"+"Log.txt")</pre><br><br>Your code is,<br>1) Delete file<br>2) Create file<br>3) See if file has different value<br><br>Should be<br>1) Does file exist, if not create it, exit check<br>2) Does file have a very different value (one min say), if so exit program<br>3) Change file to new value (I personally would just change it rather than delete it every time) <br><br></td></tr></table><br>
<a name="1234799"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> I get steps 1 and 3, but step 2 partially eludes me. How would I check every minute for a different value &amp; should this function be called in the main loop? If so, how?<br><br>Thank You so kindly, H&amp;K!<br><br>Sincerely, <br><br>~GF <br><br></td></tr></table><br>
<a name="1234810"></a>

<a name="1234811"></a>

<a name="1234812"></a>

<a name="1234813"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RGR</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> .. <br><br></td></tr></table><br>
<a name="1234827"></a>

<a name="1234828"></a>

<a name="1234829"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ignoring LineOf7s, Kryzon, &amp; RGR, I found a sneaky way to do it! =D<br><br>You take the program's "App Title" string, and compare it with a string of the actual file name, compile the program, then encrypt the compiled program so that the string cannot easily be seen by opening the program in a text editor!<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">Const APP_TITLE$ = "My Program"
Const ERROR_ALREADY_EXISTS=183

AppTitle APP_TITLE$

Global br$ = Chr$(13)+Chr$(10)

Check_Instances()

Graphics3D(800, 600, 0, 2)

;Uncomment the below if you have the window hack that removes the black startup window from your program
;api_ShowWindow(SystemProperty$("AppHWND"), 1)

    While Not KeyDown(1)

            UpdateWorld
            RenderWorld

        Flip

    Wend

End

Function File_Name$(File$)
	For I% = Len(File$) To 1 Step -1
		If Mid(File$, I%, 1) = "\" Or Mid(File$, I%, 1) = "/" Then Return Mid(File$, I% + 1)
		Next
	Return File$
End Function

Function Get_Filename$()

	; Bank for path name...
	Local MAX_PATH = 260 ; Windows max path size!
	Local program$ = ""

		pbank = CreateBank (MAX_PATH)
		
			; Write executable name to bank...		
			psize = api_GetModuleFileName (0, pbank, MAX_PATH)
			
			; Read characters in bank...		
			For byte = 0 To psize - 1
				program$ = program$ + Chr (PeekByte (pbank, byte))
			Next
		
		FreeBank pbank
	
	Return program$

End Function

Function Check_Instances()

	mutex$=APP_TITLE$
	attributes=CreateBank(4)
	PokeInt attributes,0,0
	
	mutex_h=api_CreateMutex(attributes,1,mutex$)
	FreeBank(attributes)

	If api_GetLastError() = ERROR_ALREADY_EXISTS Or Real_Filename$(Get_Filename$()) &lt;&gt; mutex$
		api_MessageBox(0, "Program is already running!"+br$+br$+"Exiting other Program Instance...", "ERROR!", MB_ICONERROR Or ID_OK)
		End
	EndIf

End Function

Function Real_FileName$(File$)
	For I% = Len(File$) To 1 Step -1
		If Instr(File$, ".exe") Then Return File_Name$(Replace$(File$, ".exe", ""))
	Next
	Return File$
End Function</textarea> <br><br></td></tr></table><br>
<a name="1234831"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Step<br>0) Create the time stamp (TS)<br>1) As Above<br>2) Read file, and from that Recreate Time Stamp (RTS)<br>2b) if TS - rts &lt; 60 then fail. (from your time stamp creation)<br><br>If you dont have any pseudo multitasking code, then yes in main loop.<br><br>How to do it rarely depends on how you have "main looped", and there are better ways than this one, BUT I know you will have almost defiantly got a "flip" so. And some of these variables you might already by creating<br><br>1) Have a variable (probably global), every flip add to it how many milli-secs have passed since last flip. (count=count + (currentmill- oldmilli))<br>2) If count is greater than 6001 (say) then gosub (lol joke) the check and reset count.<br><br>Obviously you have got a time creation function using api_GetSystemTime, and so you could use that instead of whatever millisecond function b3d has (if any) <br><br></td></tr></table><br>
<a name="1234835"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh how I despise you, gosub :P <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
