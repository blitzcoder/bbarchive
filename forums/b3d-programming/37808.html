<!DOCTYPE html><html lang="en" ><head ><title >My engine discussion thread</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >My engine discussion thread</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >My engine discussion thread</a><br><br>
<a name="417043"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> This thread is for discussing rendering and other techniques in the context of a structured engine.<br><br>Related threads:<br><a href="/posts.php?topic=37500" target="_blank">Design</a><br><a href="/posts.php?topic=37133" target="_blank">Terrain</a><br><a href="/posts.php?topic=37732" target="_blank">Actors</a><br><a href="/posts.php?topic=37762" target="_blank">Rendering</a><br><br>After trimming down my skeleton, I was able to boost the framerate to acceptable levels.  I also implemented an extensive statistics feedback system that helped me to optimize the outer rendering loop.  I am very proud of all I have going on here, the mesh density, the view distance, number of actors, and a decent framerate.  The next step will be creating super-low-res version of the skeletons and actor meshes, so that a minimum number of bones is used.  The FPS is 76 without actors, so there is still a lot of improvement I can make.<br><br><img src="http://www.leadwerks.com/post/screenshot0049.jpg"><br><br>Another tip for rendering animations is to still use Blitz's animation system, but only call it once before the outer rendering loop, then hide the animated mesh after you update and render it.  Only update animation for meshes that are not hidden or far away:<br><pre class=code>Function AnimateFrame(entity,sequence,frame#,percent=False)
Animate entity,3,1,sequence,0
length=AnimLength(entity)
If percent
	frame=frame*length
	Else
	frame=frame/length
	EndIf
Animate entity,1,frame,sequence
End Function</pre>  <br><br>So you animation routine would look like this:<br><pre class=code>For each model
If Visible(model)
	ShowEntity model
	Next
UpdateWorld
Renderworld
For each model
	HideEntity model
	Next
</pre><br><br>I actually render each model in a separate pass.  This lets you set up a unique lighting environment for each model, based on visibility between the model and light sources.  Just do an EntityVisible() to see of the model is in the light or the shadow. <br><br></td></tr></table><br>
<a name="417048"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Regular K</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> In some engines ive noticed lets say the render distance is 300 (some measurement). But for smaller, and less important objects the render distance is 200 or 150.<br><br>This would help if you rendering a variety of objects in a big space.<br><br>But from the screen above, your engine wouldnt really require anything like that? <br><br></td></tr></table><br>
<a name="417064"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> That's not a bad idea.  I figure, if performance is good now, let's push it further and really take it to the limit.  My trees start looking like crap from a mile away anyways, so I might as well hide them and just leave a terrain silhouette in the fog. <br><br></td></tr></table><br>
<a name="417097"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SSS</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> or for tree's that are far a away you could build a mesh and paint a forrest texture on it, that way you see the green of the trees so they dont just 'pop up'. and  you vastly reduce your polygon count. in adition something like this wouldnt be too hard to code. <br><br></td></tr></table><br>
<a name="417106"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Braincell</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> For FPS games such as a WW2 i hear you might be using the engine for, i think the drawing distance is crucial importance. Maybe if you played Operation Flashpoint you know. And if you 'zoom in' with binoculars and stuff you have to solve that too, how trees convert from low to high poly count if you zoom into them from distance. It takes a bit of effort to make it real good.<br><br>Also :P place some rocks, logs, branches and dirt patches on that ground! <br><br></td></tr></table><br>
<a name="417212"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BlitzSupport</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>And if you 'zoom in' with binoculars and stuff you have to solve that too, how trees convert from low to high poly count if you zoom into them from distance<br> <br></div><br><br>This is very important also in relation to this:<br><br><div class="quote"> <br>Only update animation for meshes that are not hidden or far away<br> <br></div><br><br>In Battlefield 1942 (at least, in older versions) the developers forgot to animate characters in the distance when viewed through a sniper scope, so they sort of slide around instead of walking... <br><br></td></tr></table><br>
<a name="417224"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah but when you zoom, your field of view is narrowed, so you can lose a lot of polys even though you are gaining them.<br><br>I can make much prettier terrain, but the point here is to test for max size and view range. <br><br></td></tr></table><br>
<a name="417266"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> 71k tris for terrain and trees only is not well balanced imho. And 17ms is not 31 FPS, but 60.<br><br>I think the viewrange is not high engough for an outdoor scenery. It looks like a "due to crappy hardware we have very bad weather these days".<br><br>True Sniper rifles are made for 1 mile... <br><br></td></tr></table><br>
<a name="417308"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I increased the view range and terrain size with no speed hit.  The low FPS is caused by rendering 30 actors.  I am working to reduce the number of bones in the far-away versions.  The framerate is 70+ without actors.<br><br>I am not sure what you mean by "well balanced". <br><br></td></tr></table><br>
<a name="417312"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jeremy Alessi</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> 71K tris seems good though. <br><br></td></tr></table><br>
<a name="417468"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AdrianT</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> "71K tris seems good though. "<br><br>would depend on the system thats drawing the 70k tris. But thats not a bad speed at all really, allthough not a high surface count judging by the screenshot. <br><br>also currently its just rendering and doesn't have any gameplay as far as I can see. looks nice though :)<br><br>I liked the video with tree shadows etc that was published a coupl eof weeks ago. that was pretty sweet. Really nice to see people trying to push blitz past what were used to seeing and making a really good go at a game. <br><br></td></tr></table><br>
<a name="417508"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> I first didn't see that the 30 chars are part of the 70k, so it seems to be ok. Only one thing halo, something design-related: the trees are looking like baby-trees of 1.4 meter height, due to their special shape. older/higher trees have diffrent shapes. This way the scene is unneccessarily looking smaller than it is, also the chars are looking very small this way. The trunk of higher (fir)trees are naked at the lower part and they have less dense limbs/leaves. Just my 2c. <br><br></td></tr></table><br>
<a name="418566"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GrumpyOldMan</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Halo<br><br>I was following your thread on large numbers of actors and since I'm also interested in having large numbers of actors on screen I decided to do some experiments on minimising the impact on the animation chokepoint.<br><br>Reducing the bones certainly reduces the overhead, but another way is to reduce the length of animation and the number of frames. I started with 800 low poly boned figures but with no animation, and sequentially added, through LoadAnimSeq, more animations and the degradation was noticeable, especially when five animations were added to each figure. The best I was able to get was 30 FPS with 480 figures with 30 frames of animation each (not quite Rome Total War territory). For distant figures you could just Copyentity an Idle figure to replace a Walking figure but you would lose any smooth transition from one animation to another.<br><br>Back to the lab.<br><br>Cheers<br><br>GrumpyOldMan <br><br></td></tr></table><br>
<a name="418567"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can use copyentity anyways, and the animation state will be kept separate.<br><br>It seems updating the animation only takes 0-1 msecs.  Rendering characters is by far the most intensive process I am dealing with, usually taking a good 10 msecs for 30 actors.<br><br>Another issue to consider, which is impossible to analyze, is the bone update time, which I presume is handled in the RenderWorld() routine. <br><br></td></tr></table><br>
<a name="418577"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GrumpyOldMan</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Halo<br><br>With rendering the actors have you tried Addmesh'ing to see if cutting the number of surfaces down (bearing in mind the limit on tris within one surface) gives you any speed increase? I've tried it and it was minimal but I'm only using 250-250 tri figures.<br><br>Cheers<br><br>GrumpyOldMan <br><br></td></tr></table><br>
<a name="418580"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MadJack</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Forgive me if this is a stupid idea - but what about replacing meshes with animated sprites at a distance that varies depending on the density of animated figures close to the camera? <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
