<!DOCTYPE html><html lang="en" ><head ><title >Problem with LoadMaskedAnimTexture() ?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Problem with LoadMaskedAnimTexture() ?</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Problem with LoadMaskedAnimTexture() ?</a><br><br>
<a name="1240926"></a>

<a name="1240928"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi all. I was wondering why this isn't removing all masked pixels no matter how big the quad / texture size is.<br><br>LoadMaskedAnimTexture.bb: <br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">; Common keys:
Const VK_LEFTMOUSE                              = $01   ; Left physical mouse button
Const VK_RIGHTMOUSE                             = $02   ; Right physical mouse button
Const VK_MIDDLEMOUSE                            = $04   ; Middle physical mouse button
Const VK_BACKSPACE                              = $08   ; BACKSPACE key
Const VK_TAB                                    = $09   ; TAB key
Const VK_ENTER                                  = $0D   ; ENTER key (Main keyboard or keypad)
Const VK_SHIFT                                  = $10   ; SHIFT key (Left or right)
Const VK_CONTROL                                = $11   ; CTRL key (Left or right)
Const VK_ALT                                    = $12   ; ALT key (Left or right)
Const VK_PAUSE                                  = $13   ; PAUSE key
Const VK_SCROLL                                 = $14   ; SCROLL LOCK key
Const VK_ESCAPE                                 = $1B   ; ESC key
Const VK_SPACE                                  = $20   ; SPACEBAR
Const VK_PGUP                                   = $21   ; PAGE UP key
Const VK_PGDN                                   = $22   ; PAGE DOWN key
Const VK_END                                    = $23   ; END key
Const VK_HOME                                   = $24   ; HOME key
Const VK_LEFT                                   = $25   ; LEFT ARROW key
Const VK_UP                                     = $26   ; UP ARROW key
Const VK_RIGHT                                  = $27   ; RIGHT ARROW key
Const VK_DOWN                                   = $28   ; DOWN ARROW key
Const VK_PRINTSCRN                              = $2C   ; PRINT SCREEN key
Const VK_INSERT                                 = $2D   ; INSERT key
Const VK_DELETE                                 = $2E   ; DELETE key
Const VK_0                                      = $30
Const VK_1                                      = $31
Const VK_2                                      = $32
Const VK_3                                      = $33
Const VK_4                                      = $34
Const VK_5                                      = $35
Const VK_6                                      = $36
Const VK_7                                      = $37
Const VK_8                                      = $38
Const VK_9                                      = $39
Const VK_A                                      = $41
Const VK_B                                      = $42
Const VK_C                                      = $43
Const VK_D                                      = $44
Const VK_E                                      = $45
Const VK_F                                      = $46
Const VK_G                                      = $47
Const VK_H                                      = $48
Const VK_I                                      = $49
Const VK_J                                      = $4A
Const VK_K                                      = $4B
Const VK_L                                      = $4C
Const VK_M                                      = $4D
Const VK_N                                      = $4E
Const VK_O                                      = $4F
Const VK_P                                      = $50
Const VK_Q                                      = $51
Const VK_R                                      = $52
Const VK_S                                      = $53
Const VK_T                                      = $54
Const VK_U                                      = $55
Const VK_V                                      = $56
Const VK_W                                      = $57
Const VK_X                                      = $58
Const VK_Y                                      = $59
Const VK_Z                                      = $5A
Const VK_LEFTWIN                                = $5B   ; Left Windows key
Const VK_RIGHTWIN                               = $5C   ; Right Windows key
Const VK_NUMPAD0                                = $60
Const VK_NUMPAD1                                = $61
Const VK_NUMPAD2                                = $62
Const VK_NUMPAD3                                = $63
Const VK_NUMPAD4                                = $64
Const VK_NUMPAD5                                = $65
Const VK_NUMPAD6                                = $66
Const VK_NUMPAD7                                = $67
Const VK_NUMPAD8                                = $68
Const VK_NUMPAD9                                = $69
Const VK_MULTIPLY                               = $6A   ; Keypad *
Const VK_ADD                                    = $6B   ; Keypad +
Const VK_SEPERATOR                              = $6C   ; Keypad /
Const VK_SUBTRACT                               = $6D   ; Keypad -
Const VK_DECIMAL                                = $6E   ; Keypad .
Const VK_DIVIDE                                 = $6F   ; Keypad \
Const VK_F1                                     = $70
Const VK_F2                                     = $71
Const VK_F3                                     = $72
Const VK_F4                                     = $73
Const VK_F5                                     = $74
Const VK_F6                                     = $75
Const VK_F7                                     = $76
Const VK_F8                                     = $77
Const VK_F9                                     = $78
Const VK_F10                                    = $79
Const VK_F11                                    = $7A
Const VK_F12                                    = $7B
Const VK_NUMLOCK                                = $90  
Const VK_CAPITAL                                = $91   ; CAPS LOCK key
Const VK_LEFTSHIFT                              = $A0   ; Windows 95 does not support the left and right distinguishing constants.     
Const VK_RIGHTSHIFT                             = $A1  
Const VK_LEFTCTRL                               = $A2  
Const VK_RIGHTCTRL                              = $A3  
Const VK_LEFTALT                                = $A4  
Const VK_RIGHTALT                               = $A5
 
; Less common keys:
; Some of the keys here would seem to be common keys, but the documentation does not say they work in 95/98,
; so I did not include them with the other keys above just to be safe.
Const VK_CANCEL                                 = $03   ; Control-break processing
Const VK_X1MOUSE                                = $05   ; Windows 2000/XP: X1 mouse button
Const VK_X2MOUSE                                = $06   ; Windows 2000/XP: X2 mouse button
Const VK_CLEAR                                  = $0C   ; CLEAR key
Const VK_SELECT                                 = $29   ; SELECT key
Const VK_EXECUTE                                = $2B   ; EXECUTE key
Const VK_PRINT                                  = $2A   ; PRINT key
Const VK_HELP                                   = $2F   ; HELP key
Const VK_KANA                                   = $15   ; Input Method Editor (IME) Kana mode
Const VK_HANGUL                                 = $15   ; IME Hangul mode
Const VK_JUNJA                                  = $17   ; IME Junja mode
Const VK_FINAL                                  = $18   ; IME final mode
Const VK_KANJI                                  = $19   ; IME Hanja/Kanji mode 
Const VK_CONVERT                                = $1C   ; IME convert
Const VK_NONCONVERT                             = $1D   ; IME nonconvert
Const VK_ACCEPT                                 = $1E   ; IME accept
Const CK_MODECHANGE                             = $1F   ; IME mode change request
Const VK_APPS                                   = $5D   ; Applications key
Const VK_SLEEP                                  = $5F   ; Computer Sleep key
Const VK_F13                                    = $7C
Const VK_F14                                    = $7D
Const VK_F15                                    = $7E
Const VK_F16                                    = $7F
Const VK_F17                                    = $80
Const VK_F18                                    = $81
Const VK_F19                                    = $82
Const VK_F20                                    = $83
Const VK_F21                                    = $84
Const VK_F22                                    = $85
Const VK_F23                                    = $86
Const VK_F24                                    = $87
Const VK_BROWSER_BACK                           = $A6   ; Windows 2000/XP: Browser Back key
Const VK_BROWSER_FORWARD                        = $A7   ; Windows 2000/XP: Browser Forward key
Const VK_BROWSER_REFRESH                        = $A8   ; Windows 2000/XP: Browser Refresh key
Const VK_BROWSER_STOP                           = $A9   ; Windows 2000/XP: Browser Stop key
Const VK_BROWSER_SEARCH                         = $AA   ; Windows 2000/XP: Browser Search key
Const VK_BROWSER_FAVORITES                      = $AB   ; Windows 2000/XP: Browser Favorites key
Const VK_BROWSER_HOME                           = $AC   ; Windows 2000/XP: Browser Start And Home key
Const VK_VOLUME_MUTE                            = $AD   ; Windows 2000/XP: Volume Mute key
Const VK_VOLUME_DOWN                            = $AE   ; Windows 2000/XP: Volume Down key
Const VK_VOLUME_UP                              = $AF   ; Windows 2000/XP: Volume Up key
Const VK_MEDIA_NEXT_TRACK                       = $B0   ; Windows 2000/XP: Next Track key
Const VK_MEDIA_PREV_TRACK                       = $B1   ; Windows 2000/XP: Previous Track key
Const VK_MEDIA_STOP                             = $B2   ; Windows 2000/XP: Stop Media key
Const VK_MEDIA_PLAY_PAUSE                       = $B3   ; Windows 2000/XP: Play/Pause Media key
Const VK_LAUNCH_MAIL                            = $B4   ; Windows 2000/XP: Start Mail key
Const VK_LAUNCH_MEDIA_SELECT                    = $B5   ; Windows 2000/XP: Select Media key
Const VK_LAUNCH_APP1                            = $B6   ; Windows 2000/XP: Start Application 1 key
Const VK_LAUNCH_APP2                            = $B7   ; Windows 2000/XP: Start Application 2 key     
Const VK_OEM_1                                  = $BA   ; Windows 2000/XP: For the US standard keyboard, the ';:' key
Const VK_OEM_PLUS                               = $BB   ; Windows 2000/XP: For any country/region, the '+' key
Const VK_OEM_COMMA                              = $BC   ; Windows 2000/XP: For any country/region, the ',' key
Const VK_OEM_MINUS                              = $BD   ; Windows 2000/XP: For any country/region, the '-' key
Const VK_OEM_PERIOD                             = $BE   ; Windows 2000/XP: For any country/region, the '.' key
Const VK_OEM_2                                  = $BF   ; Windows 2000/XP: For the US standard keyboard, the '/?' key
Const VK_OEM_3                                  = $C0   ; Windows 2000/XP: For the US standard keyboard, the '`~' key
Const VK_OEM_4                                  = $DB   ; Windows 2000/XP: For the US standard keyboard, the '[{' key
Const VK_OEM_5                                  = $DC   ; Windows 2000/XP: For the US standard keyboard, the '\|' key
Const VK_OEM_6                                  = $DD   ; Windows 2000/XP: For the US standard keyboard, the ']}' key
Const VK_OEM_7                                  = $DE   ; Windows 2000/XP: For the US standard keyboard, the 'single-quote/double-quote' key
Const VK_OEM_8                                  = $DF   ; Used for miscellaneous characters; it can vary by keyboard.
Const VK_ICO_F17                                = $E0  
Const VK_ICO_F18                                = $E1  
Const VK_OEM102                                 = $E2   ; Windows 2000/XP: Either the angle bracket key or the backslash key on the RT 102-key keyboard
Const VK_ICO_HELP                               = $E3
Const VK_ICO_00                                 = $E4  
Const VK_PROCESSKEY                             = $E5   ; Windows 95/98/Me, Windows NT 4.0, Windows 2000/XP: IME PROCESS key
Const VK_ICO_CLEAR                              = $E6
Const VK_PACKET                                 = $E7   ; Windows 2000/XP: Used to pass Unicode characters as if they were keystrokes.
Const VK_OEM_RESET                              = $E9
Const VK_OEM_JUMP                               = $EA
Const VK_OEM_PA1                                = $EB
Const VK_OEM_PA2                                = $EC
Const VK_OEM_PA3                                = $ED
Const VK_OEM_WSCTRL                             = $EE
Const VK_OEM_CUSEL                              = $EF
Const VK_OEM_ATTN                               = $F0
Const VK_OEM_FINNISH                            = $F1
Const VK_OEM_COPY                               = $F2
Const VK_OEM_AUTO                               = $F3
Const VK_OEM_ENLW                               = $F4
Const VK_OEM_BACKTAB                            = $F5
Const VK_ATTN                                   = $F6   ; Attn key
Const VK_CRSEL                                  = $F7   ; CrSel key
Const VK_EXSEL                                  = $F8   ; ExSel key
Const VK_EREOF                                  = $F9   ; Erase EOF key
Const VK_PLAY                                   = $FA   ; Play key
Const VK_ZOOM                                   = $FB   ; Zoom key
Const VK_NONAME                                 = $FC   ; Reserved
Const VK_PA1                                    = $FD   ; PA1 key
Const VK_OEM_CLEAR                              = $FE   ; Clear key

Type camera

	Field id
	
	Field xpos#
	Field ypos#
	Field zpos#
	
	Field xrot#
	Field yrot#
	Field zrot#
	
	Field near_range#
	Field far_range#

End Type

Type chara_sprite

	Field id

	Field tex

	Field xpos#
	Field ypos#
	Field zpos#
	
	Field xrot#
	Field yrot#
	Field zrot#
	
	Field xscl#
	Field yscl#
	Field zscl#
	
End Type

Global player.chara_sprite

Global totalframes
Global oldtotalframes

Global moving = 0
Global fast_moving = 0

Global trigger_reset
Global idle

Initialize_Program()

Update_Program()

End

Function Initialize_Program()

	AppTitle "2D RPG"

		Graphics3D(800, 600, 0, 2)
	
		cam.camera = New camera
		
		cam\xpos# = 0.0
		cam\ypos# = 0.0
		cam\zpos# = 0.0
		
		cam\xrot# = 0.0
		cam\yrot# = 0.0
		cam\zrot# = 0.0
	
		cam\near_range# = 0.1
		cam\far_range# = 10000.0
		
		cam\id = CreateCamera()
		CameraRange cam\id, cam\near_range#, cam\far_range#
	
		PositionEntity cam\id, cam\xpos#, cam\ypos#, cam\zpos#
		TurnEntity cam\id, cam\xrot#, cam\yrot#, cam\zrot#
		
		AmbientLight 255, 255, 255
		
		totalframes = InitSprites(32, 32)
		oldtotalframes = totalframes
		Initialize_Sprites()

	api_ShowWindow(SystemProperty$("AppHWND"), 1)
	
End Function

Function Update_Program()

	AnimSprite( player\id, player\tex, 200, 1 )

	While Not KeyDown(1)
	
		moving = 0
		fast_moving = 0
		trigger_reset = 0
		idle = 0
	
			UpdateWorld
			RenderWorld
			
				Update_Player()
			
			Text GraphicsWidth()/2, GraphicsHeight()/2, "moving: "+Str$(moving), 1, 1
			Text GraphicsWidth()/2, GraphicsHeight()/2+20, "fast_moving: "+Str$(fast_moving), 1, 1
			Text GraphicsWidth()/2, GraphicsHeight()/2+40, "trigger_reset: "+Str$(trigger_reset), 1, 1
			Text GraphicsWidth()/2, GraphicsHeight()/2+60, "idle: "+Str$(idle), 1, 1
		
		VWait 1
		Flip 0
		Delay 1

	Wend

End Function

Function Initialize_Sprites()

	player.chara_sprite = New chara_sprite
	
		player\id = CreateQuad()

		player\tex = LoadMaskedAnimTexture("sprites\Terra2.png", 32, 48, totalframes, 0, 179, 254, 0)

		TextureFilter "sprites\Terra2.png", 1+2+4+8+16+32+256+512
		
			player\xpos# = 0.0
			player\ypos# = 0.0
			player\zpos# = 32.0
			
			player\xrot# = 0.0
			player\yrot# = 0.0
			player\zrot# = 0.0
			
			player\xscl# = 0.5
			player\yscl# = 1.0
			player\zscl# = 0.001

		PositionEntity player\id, player\xpos#, player\ypos#, player\zpos#
		TurnEntity player\id, player\xrot#, player\yrot#, player\zrot#
		ScaleEntity player\id, player\xscl#, player\yscl#, player\zscl#

	enemy.chara_sprite = New chara_sprite

End Function

Function CreateQuad(parent=0)

	sprite = CreateMesh( parent )

		v = CreateSurface( sprite )
		AddVertex ( v, -3, 3, 0, 1, 0)
		AddVertex ( v, 3, 3, 0, 0, 0)
		AddVertex ( v, 3, -3, 0, 0, 1)
		AddVertex ( v, -3, -3, 0, 1, 1)
		AddTriangle ( v, 0, 1, 2)
		AddTriangle ( v, 2, 3, 0)

	Return sprite
	
End Function

Function GDI_GetAsyncKeyState(VirtualKey, IgnoreFocus=False)

	If (IgnoreFocus = True) And (api_GetActiveWindow() = 0) Then Return
	Return (api_GetAsyncKeyState%(VirtualKey) And %1000000000000000) &gt; 0

End Function

Function KH_ESCAPE()
	Return (KeyHit(1))
End Function

Function KH_A()
	Return (KeyHit(30))
End Function

Function KH_C()
	Return (KeyHit(46))
End Function

Function KH_E()
	Return (KeyHit(18))
End Function

Function KH_H()
	Return (KeyHit(36))
End Function

Function KH_I()
	Return (KeyHit(23))
End Function

Function KH_M()
	Return (KeyHit(50))
End Function

Function KH_N()
	Return (KeyHit(49))
End Function

Function KH_O()
	Return (KeyHit(24))
End Function

Function KH_P()
	Return (KeyHit(26))
End Function

Function KH_Q()
	Return (KeyHit(16))
End Function

Function KH_S()
	Return (KeyHit(31))
End Function

Function KH_X()
	Return (KeyHit(45))
End Function

Function KH_Z()
	Return (KeyHit(44))
End Function

Function KH_UP()
	Return (KeyHit(200))
End Function

Function KH_DOWN()
	Return (KeyHit(208))
End Function

Function KH_LEFT()
	Return (KeyHit(203))
End Function

Function KH_RIGHT()
	Return (KeyHit(205))
End Function

Function KH_SPACE()
	Return (KeyHit(57))
End Function

Function KH_BACKSPACE()
	Return (KeyHit(14))
End Function

Function KH_1()
	Return (KeyHit(2))
End Function

Function KH_2()
	Return (KeyHit(3))
End Function

Function KH_TAB()
	Return (KeyHit(15))
End Function

Function KH_R()
	Return (KeyHit(19))
End Function

Function KH_LEFT_RETURN()
	Return (KeyHit(28))
End Function

Function KH_RIGHT_RETURN()
	Return (KeyHit(156))
End Function

Function CONTROL()
	Return (GDI_GetAsyncKeyState(VK_LEFTCTRL, 1) Or GDI_GetAsyncKeyState(VK_RIGHTCTRL, 1))
End Function

Function SHIFT()
	Return (GDI_GetAsyncKeyState(VK_LEFTSHIFT, 1) Or GDI_GetAsyncKeyState(VK_RIGHTSHIFT, 1))
End Function

Function SPACE()
	Return (GDI_GetAsyncKeyState(VK_SPACE, 1))
End Function

Function CONTROL_SHIFT()
	Return (CONTROL() And SHIFT())
End Function

Function CONTROL_SPACE()
	Return (CONTROL() And SPACE())
End Function

Function CONTROL_SHIFT_SPACE()
	Return (CONTROL_SHIFT() And SPACE())
End Function

Function KD_W()
	Return (GDI_GetAsyncKeyState(VK_W, 1))
End Function

Function KD_UP()
	Return (GDI_GetAsyncKeyState(VK_UP, 1))
End Function

Function KD_S()
	Return (GDI_GetAsyncKeyState(VK_S, 1))
End Function

Function KD_DOWN()
	Return (GDI_GetAsyncKeyState(VK_DOWN, 1))
End Function

Function KD_A()
	Return (GDI_GetAsyncKeyState(VK_A, 1))
End Function

Function KD_LEFT()
	Return (GDI_GetAsyncKeyState(VK_LEFT, 1))
End Function

Function KD_D()
	Return (GDI_GetAsyncKeyState(VK_D, 1))
End Function

Function KD_RIGHT()
	Return (GDI_GetAsyncKeyState(VK_RIGHT, 1))
End Function

Function W_UP()
	Return (KD_W() Or KD_UP())
End Function

Function S_DOWN()
	Return (KD_S() Or KD_DOWN())
End Function

Function A_LEFT()
	Return (KD_A() Or KD_LEFT())
End Function

Function D_RIGHT()
	Return (KD_D() Or KD_RIGHT())
End Function

Function CONTROL_SHIFT_SPACE_UP()
	Return (CONTROL() And SHIFT() And SPACE() And KD_UP())
End Function

Function CONTROL_SHIFT_SPACE_DOWN()
	Return (CONTROL() And SHIFT() And SPACE() And KD_DOWN())
End Function

Function CONTROL_SHIFT_SPACE_LEFT()
	Return (CONTROL() And SHIFT() And SPACE() And KD_LEFT())
End Function

Function CONTROL_SHIFT_SPACE_RIGHT()
	Return (CONTROL() And SHIFT() And SPACE() And KD_RIGHT())
End Function

Function CONTROL_SHIFT_SPACE_RETURN()
	Return (CONTROL() And SHIFT() And SPACE() And KD_RETURN())
End Function

Function CONTROL_SHIFT_UP()
	Return (CONTROL() And SHIFT() And KD_UP())
End Function

Function CONTROL_SHIFT_DOWN()
	Return (CONTROL() And SHIFT() And KD_DOWN())
End Function

Function CONTROL_SHIFT_LEFT()
	Return (CONTROL() And SHIFT() And KD_LEFT())
End Function

Function CONTROL_SHIFT_RIGHT()
	Return (CONTROL() And SHIFT() And KD_RIGHT())
End Function

Function CONTROL_SHIFT_RETURN()
	Return (CONTROL() And SHIFT() And KD_RETURN())
End Function

Function CONTROL_SPACE_UP()
	Return (CONTROL() And SPACE() And KD_UP())
End Function

Function CONTROL_SPACE_DOWN()
	Return (CONTROL() And SPACE() And KD_DOWN())
End Function

Function CONTROL_SPACE_LEFT()
	Return (CONTROL() And SPACE() And KD_LEFT())
End Function

Function CONTROL_SPACE_RIGHT()
	Return (CONTROL() And SPACE() And KD_RIGHT())
End Function

Function CONTROL_SPACE_RETURN()
	Return (CONTROL() And SPACE() And KD_RETURN())
End Function

Function CONTROL_UP()
	Return (CONTROL() And KD_UP())
End Function

Function CONTROL_DOWN()
	Return (CONTROL() And KD_DOWN())
End Function

Function CONTROL_LEFT()
	Return (CONTROL() And KD_LEFT())
End Function

Function CONTROL_RIGHT()
	Return (CONTROL() And KD_RIGHT())
End Function

Function CONTROL_RETURN()
	Return (CONTROL() And KD_RETURN())
End Function

Function KD_X()
	Return (GDI_GetASyncKeyState(VK_X, 1))
End Function

Function KD_RETURN()
	Return (GDI_GetASyncKeyState(VK_RETURN, 1))
End Function

Function AnimSprite( obj, atex, d, f )
    frame = MilliSecs( ) / d Mod f
    EntityTexture obj, atex, frame
End Function

; -----------------------------------------------------------------------------
; LoadMaskedSprite (image$, r, g, b, flags)
; -----------------------------------------------------------------------------

; -----------------------------------------------------------------------------
; REQUIRED PARAMETERS:
; -----------------------------------------------------------------------------
; image$  = image file to be used for sprite
; -----------------------------------------------------------------------------

; -----------------------------------------------------------------------------
; OPTIONAL PARAMETERS:
; -----------------------------------------------------------------------------
; r, g, b = background colour to mask out (defaults to 255, 0, 255)
; flags   = defaults to 1 + 2 + 8 + 16 + 32 (best not to touch these!)
; -----------------------------------------------------------------------------

; -----------------------------------------------------------------------------
; EXAMPLE
; -----------------------------------------------------------------------------
; LoadMaskedSprite ("ship.bmp", 0, 255, 0)
; ... would use a green background mask...
; -----------------------------------------------------------------------------

Function LoadMaskedSprite (f$, r = 255, g = 0, b = 255, flags = 1 + 2 + 8 + 16 + 32)

	temp = CreateTexture (1, 1, flags)
	WritePixel 0, 0, ((r Shl 16) + (g Shl 8) + b) And $00FFFFFF, TextureBuffer (temp)
	trgb = ReadPixel (0, 0, TextureBuffer (temp))
	r = trgb Shr 16 And %11111111
	g = trgb Shr 8 And %11111111
	b = trgb And %11111111
	FreeTexture temp

	texture = LoadTexture (f$, flags)						; Load texture
	tBuffer = GraphicsBuffer ()								; Store current buffer
		
	SetBuffer TextureBuffer (texture)						; Use texture's buffer
	LockBuffer GraphicsBuffer ()							; Lock it for 'fast' pixel access
	
	; Read each pixel of texture...
	
	For x = 0 To TextureWidth (texture) - 1
		For y = 0 To TextureHeight (texture) - 1

			rgb = ReadPixelFast (x, y) And $00FFFFFF		; Read pixel, strip alpha value			
			If rgb = ((r Shl 16) + (g Shl 8) + b)			; If pixel = rgb mask...
				WritePixelFast x, y, $00000000				; ... make transparent, else...
			Else											; Not rgb mask pixel, so...
				WritePixelFast x, y, rgb Or $FF000000		; ... make 'solid'
			EndIf

		Next
	Next

	UnlockBuffer GraphicsBuffer ()							; Unlock texture buffer

	sprite = CreateSprite ()								; Create blank sprite
	EntityTexture sprite, texture							; Apply masked texture
	
	SetBuffer tBuffer										; Reset graphics buffer as at start
	Return sprite											; Return masked sprite
	
End Function

; -----------------------------------------------------------------------------
; LoadMaskedTexture () -- usage as per LoadMaskedSprite () -- see above...
; -----------------------------------------------------------------------------

Function LoadMaskedTexture (f$, r = 255, g = 0, b = 255, flags = 1 + 2 + 8 + 16 + 32)

	texture = LoadTexture (f$, flags)						; Load texture
	tBuffer = GraphicsBuffer ()								; Store current buffer
		
	SetBuffer TextureBuffer (texture)						; Use texture's buffer
	LockBuffer GraphicsBuffer ()							; Lock it for 'fast' pixel access
	
	; Read each pixel of texture...
	
	For x = 0 To TextureWidth (texture) - 1
		For y = 0 To TextureHeight (texture) - 1

			rgb = ReadPixelFast (x, y) And $00FFFFFF		; Read pixel, strip alpha value
			If rgb = ((r Shl 16) + (g Shl 8) + b)			; If pixel = rgb mask...
				WritePixelFast x, y, $00000000				; ... make transparent, else...
			Else											; Not rgb mask pixel, so...
				WritePixelFast x, y, rgb Or $FF000000		; ... make 'solid'
			EndIf

		Next
	Next

	UnlockBuffer GraphicsBuffer ()							; Unlock texture buffer

	SetBuffer tBuffer										; Reset graphics buffer as at start
	Return texture											; Return masked texture
	
End Function


Function LoadMaskedAnimTexture (f$, width, height, frames, r = 255, g = 0, b = 255, startframe = 0, flags = 1 + 2 + 8 + 16 + 32)

	; Get correct RGB value for 16-bit modes by writing to,
	; and reading from, a temporary texture...
	
	temp = CreateTexture (1, 1, flags)

		WritePixel 0, 0, ((r Shl 16) + (g Shl 8) + b ) And $00FFFFFF, TextureBuffer (temp)
	
			trgb = ReadPixel (0, 0, TextureBuffer (temp))
			r = trgb Shr 16 And 255
			g = trgb Shr 8 And 255
			b = trgb And 255
	
		FreeTexture temp
	
	temp = 0

	; Load the animated texture...
	
	texture = LoadAnimTexture (f$, flags, width, height, startframe, frames)
	
	If texture
	
		tBuffer = GraphicsBuffer ()									; Store current graphics buffer
	
		For loop = 0 To frames - 1									; Do each frame in turn
		
			SetBuffer TextureBuffer (texture, loop)					; Use texture frame's buffer

			LockBuffer GraphicsBuffer ()							; Lock it for 'fast' pixel access
			
			; Read each pixel of texture frame...			
			For x = 0 To width - 1

				For y = 0 To height - 1
		
					rgb = ReadPixelFast (x, y) And $00FFFFFF		; Read pixel, strip alpha value			
					If rgb = ((r Shl 16) + (g Shl 8) + b)			; If pixel = rgb mask...
						WritePixelFast x, y, $00000000				; ... make transparent, else...
					Else											; Not rgb mask pixel, so...
						WritePixelFast x, y, rgb Or $FF000000		; ... make 'solid'
					EndIf
		
				Next

			Next
		
			UnlockBuffer GraphicsBuffer ()							; Unlock texture buffer
	
		Next
			
		SetBuffer tBuffer											; Restore graphics buffer
		Return texture												; Hand back the AnimTexture...
	
	EndIf
	
End Function

Function Update_Player()
		For player.chara_sprite = Each chara_sprite
			If player &lt;&gt; Null
				If player\id
					If Not (KD_W() And KD_UP() Or KD_UP() And KD_W())
						If Not (KD_A() And KD_LEFT() Or KD_LEFT() And KD_A())
							If Not (KD_D() And KD_RIGHT() Or KD_RIGHT() And KD_D())
								If Not (KD_S() And KD_DOWN() Or KD_DOWN() And KD_S())
									If Not (KD_W() And KD_LEFT() Or KD_LEFT() And KD_W())
										If Not (KD_W() And KD_RIGHT() Or KD_RIGHT() And KD_W())
											If Not (KD_A() And KD_UP() Or KD_UP() And KD_A())
												If Not (KD_A() And KD_DOWN() Or KD_DOWN() And KD_A())
													If Not (KD_W() And KD_S() Or KD_S() And KD_W())
														If Not (KD_A() And KD_D() Or KD_D() And KD_A())
															If Not (KD_UP() And KD_DOWN() Or KD_DOWN() And KD_UP())
																If Not (KD_LEFT() And KD_RIGHT() Or KD_RIGHT() And KD_LEFT())
																	If Not (KD_S() And KD_LEFT() Or KD_LEFT() And KD_S())
																		If Not (KD_S() And KD_RIGHT() Or KD_RIGHT() And KD_S())
																			If Not (KD_D() And KD_UP() Or KD_UP() And KD_D())
																				If Not (KD_D() And KD_DOWN() Or KD_DOWN() And KD_D())
																					If Not (KD_W() And KD_DOWN() Or KD_DOWN() And KD_W())
																						If Not (KD_S() And KD_UP() Or KD_UP() And KD_S())
																							If Not (KD_A() And KD_RIGHT() Or KD_RIGHT() And KD_A())
																								If Not (W_UP() Or S_DOWN() Or A_LEFT() Or D_RIGHT()) Then trigger_reset = True
																								If Not (SHIFT())
																										If W_UP() Then MoveEntity player\id, 0, 0.1, 0 : moving = True : fast_moving = False : facing = 8
																										If S_DOWN() Then MoveEntity player\id, 0, -0.1, 0 : moving = True : fast_moving = False : facing = 2
																										If A_LEFT() Then MoveEntity player\id, -0.1, 0, 0 : moving = True : fast_moving = False : facing = 4
																										If D_RIGHT() Then MoveEntity player\id, 0.1, 0, 0 : moving = True : fast_moving = False : facing = 6
																										If (trigger_reset = True And totalframes &lt;&gt; 1) Then totalframes = 1 : idle = 0
																										If (trigger_reset = True And totalframes  = 1) Then totalframes = oldtotalframes : idle = 1
																								Else
																									If W_UP() Then MoveEntity player\id, 0, 0.3, 0 : fast_moving = True : moving = False : facing = 8
																									If S_DOWN() Then MoveEntity player\id, 0, -0.3, 0 : fast_moving = True : moving = False : facing = 2
																									If A_LEFT() Then MoveEntity player\id, -0.3, 0, 0 : fast_moving = True : moving = False : facing = 4
																									If D_RIGHT() Then MoveEntity player\id, 0.3, 0, 0 : fast_moving = True : moving = False : facing = 6
																								EndIf
																							EndIf
																						EndIf
																					EndIf
																				EndIf
																			EndIf
																		EndIf
																	EndIf
																EndIf
															EndIf
														EndIf
													EndIf
												EndIf
											EndIf
										EndIf
									EndIf
								EndIf
							EndIf
						EndIf
					EndIf
					If (trigger_reset = 0 And idle = 0)
						If moving Or fast_moving Then AnimSprite(player\id, player\tex, 100, totalframes)
					Else If (trigger_reset Or idle)
						If (moving = 0 And fast_moving = 0) Then AnimSprite(player\id, player\tex, 100, 1)
					EndIf
				EndIf
			EndIf
		Next
End Function

Function InitSprites(fsizewidth=32, fsizeheight=32)

	totalframes = 0

		image = LoadTexture("sprites\terra2.png")
					
			frameswide = (TextureWidth(image) / fsizewidth)-1
			frameshigh = (TextureHeight(image) / fsizeheight)-1
			totalframes = frameswide * frameshigh

		FreeImage image
	
	Return totalframes

End Function</textarea><br><br>Here is the link to the media along with the source and a compiled version of the above source code in order to show the problem I'm having.<br><br>https://mega.co.nz/#!jgthBQQZ!Dwu7HzVlLg1K5tyDYXW5Whps_FBgWl39nTWNfkd1m24<br><br>Thank You to all that help!<br><br>~GF <br><br></td></tr></table><br>
<a name="1241216"></a>

<a name="1241219"></a>

<a name="1241274"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RGR</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Textures are loaded 32x32 32x64 64x64 64x128 etc. Power of 2<br><br>Your 4x32x48 Sprite gets obviously loaded as 4x32x64 <br>After loading a texture you must check the actual size with TextureWidth and TextureHeight if you want to paint on it ...<br><br><pre class=code>	texture = LoadAnimTexture (f$, flags, width, height, startframe, frames)
	
	If texture
		tempwidth = TextureWidth(texture)
		tempheight = TextureHeight(texture)
	
		tBuffer = GraphicsBuffer ()									; Store current graphics buffer
	
		For loop = 0 To frames - 1									; Do each frame in turn
		
			SetBuffer TextureBuffer (texture, loop)					; Use texture frame's buffer

			LockBuffer GraphicsBuffer ()							; Lock it for 'fast' pixel access
			
			; Read each pixel of texture frame...			
			For x = 0 To tempwidth - 1

				For y = 0 To tempheight - 1
		
					rgb = ReadPixelFast (x, y) And $00FFFFFF		; Read pixel, strip alpha value			
					If rgb = trgb ;((r Shl 16) + (g Shl 8) + b)			; If pixel = rgb mask...
						WritePixelFast x, y, $00000000				; ... make transparent, else...
					Else											; Not rgb mask pixel, so...
						WritePixelFast x, y, rgb Or $FF000000		; ... make 'solid'
					EndIf
		
				Next

			Next
		
			UnlockBuffer GraphicsBuffer ()							; Unlock texture buffer
	
		Next
			
		SetBuffer tBuffer											; Restore graphics buffer
		Return texture												; Hand back the AnimTexture...
	
	EndIf
</pre> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
