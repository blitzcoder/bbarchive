<!DOCTYPE html><html lang="en" ><head ><title >Another Shadow routine...</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Another Shadow routine...</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Another Shadow routine...</a><br><br>
<a name="560397"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hautvent</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here's my little Shadow routine, it's not finished yet but you can already make some pretty shadow in your prod.<br><br>It's based on Norc system, optimised with the idea of philipe C, still working on it.<br><br>As you'll see there is some limitation....<br><br>http:\www.planb.free.fr\AFO_Shadow.zip<br><br>Some thing to know : To cast a shadow on thing, those thing must have an EntityPickMode specified. IE: the ground....<br>If you find the shadow too aliased, just change the AFO_FLEXshadowTextureSize%. It's the resolution of the shadow. Carefull, this will affect frame rate.<br><br>to preserve this frame rate, a shadow is calculate once per  call of UpdateShadow. So multiple shadows (like 3 or 4 shadows per actor) will refresh one after the other, the result will be slow moving shadows.<br><br>check the example file, you'll find answers.<br><br>Still working on improvment...<br><br>Hautvent. <br><br></td></tr></table><br>
<a name="560404"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nice work!<br><br>Some questions:<br><br>a) AFO_create_ShadowSun() seems to create a nicer shadow than AFO_create_ShadowLight() - why is that?<br><br>b) Is AFO_create_ShadowLight() just for static lights?<br><br>c) Can you comment your work in English for those of us who don't speak French.<br><br>d) How much work do you think you have left to do?<br>Looks pretty much finished to me. <br><br></td></tr></table><br>
<a name="560416"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for sharing. <br><br></td></tr></table><br>
<a name="560437"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >IPete2</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> thanks, dloading now...<br><br>IPete2. <br><br></td></tr></table><br>
<a name="560582"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >puki</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Good stuff.<br><br>Not had chance to play around with it too much - first thing I will do is stop the lights moving - want to see how it works with static lighting.<br><br>Nice to see someone having a go at doing shadow stuff.  Maybe "sswifty" can give you some input on it. <br><br></td></tr></table><br>
<a name="563927"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hautvent</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> sorry I didn't answer earlier, but the ocean in Espania was too good )))<br><br>So, AFO_Create_ShadowSun() creates a directionnal light ( createlight(1) ) like a sun, the shadow will ever been displayed.<br>AFO_Create_ShadowLight() creates a point light ( createlight(2) ) like a torche. This type of light has a range : the shadow will disapear after 80% of this lightrange.<br><br>I haven't created a function for spot light yet.<br><br>For every type of light, the shadow will be darker when the actor is closer to the lightsource, and also the shadow will wanish the farther away the actor is from the lightsource.<br><br>In my example code, you can see that lights or sun can be moved or anything else related to light.<br>My functions returned the light entity so every blitz command will work, like lightcolor, lightrange, positionentity.....<br><br><br>WORKLOG :<br><br>while I was burning on the beach, I though of multiple things to do for improvment : I found a way for shadows to be much much more flexible so it will better fit the ground. I've tought on a way to calculate a lot more shadow at a time with the same framerate as for now, just let me try it out.... The result will prevent the actual problem in my example file : shadows refreshs slowly when they're too many /<br>I'm working on improving realism when there is two or more lightsources, the weaker shadow may disapear if a lightsource is too close and too strong kinda things...<br><br>Also working for compatibility with biltzKlan! Smart Light System.<br><br>And the last but not the least : make shadow with spotlight.<br><br>When everything done, I'll do a HTML file in english explaining every function and parameters... It's not much complicated thou <br><br></td></tr></table><br>
<a name="564053"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Brilliant work Hautvent. Looking forward to seeing it.<br><br>BTW, are we coders allowed time off?<br>No-one told me! <br><br></td></tr></table><br>
<a name="567961"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hautvent</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> A big update to the system, but not yet the last.<br>Still posting it for feedback, check the example file, some function calls have changed... And some english comments )<br><br>V5 :<br><a href="http://www.planb.free.fr/AFO_Shadow.zip" target="_blank">http://www.planb.free.fr/AFO_Shadow.zip</a><br><br>Working on a big improvment of frame rate now, with V6 comming. <br><br></td></tr></table><br>
<a name="568037"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hauvent,<br><br>A few comments (and I hate it when people comment on my work!):<br><br>1)<br>I moved your static 'sun' from:  PositionEntity Luz3, 0, 500, 0<br>to:  PositionEntity Luz3, 50, 50, 5<br>to more clearly see which light was which.<br><br>Then I REM'd out luz1 and p1 entirely to simplify the scene, leaving just light 2.<br><br>I've asked this before, but why is there such a big difference between the shdows created by AFO_create_ShadowLight and AFO_create_ShadowSun?<br>AFO_create_ShadowSun seems to create a much subtler shadow, more 'real-world'.<br><br>2)<br>I also moved the cube nearer to the character<br>from: PositionEntity c, 20, PickedY()+20, 75<br>to: PositionEntity c, 20, PickedY()+20, 70<br>to see the effect of the shadows against an object.<br><br>In your previous version your shadows 'draped' up vertical objects (a bit strange actually - they draped at 45 degrees).<br>Have you taken out this effect altogether? Do all shadows now only lie on horizontal surfaces?<br><br><br>Please understand that these questions are from a person who wouldn't have a cat-in-hell's chance of even starting this code.<br>Full respect! <br><br></td></tr></table><br>
<a name="568056"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hautvent</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> the process is the same for sun or light. The only differnce lies in the color : a light is supposably closer to the actor than a sun. So the shadow's color is calculated dynamicly for a light and is static for a Sun.<br>You might notice a smoother shadow for the sun when there is only it's shadow (when you are too far away from other lightsources), it's only because it is the only shadow calculated so it refreshs quickly.<br><br>point 2 embarassed me : before it showed how to cast shadow on object, but there is two side of the story : a simple cube has not enought vertices to have a nice projection on it ! So the result is crappy form of the shadow. So I rather remove the entitypickmod for the cube, the purpose of the cube is just to show shadow of big object. Furthermore, aligning shadowmesh to vertices picked is a real FPS killer, more than anything else in the system.<br><br>I'm working on a revolution for this system to avoid the "noise" in shadow, meaning by that when the shadow lack vertices to cast on, and just fall underground or have just some spike...<br><br>By the tests I've made, I'm pretty sure the solution I tend to is the one sswift found. I've only see the demo of his shadow system and it's really amazing. Now All I want is not just do some bad copy of it. <br><br></td></tr></table><br>
<a name="568093"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Doggie</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> it doesn't work if you have a flat screen monitor.<br>The 60hz refresh rate flickers like all hell.<br>Too bad. <br><br></td></tr></table><br>
<a name="568095"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> point 1) Understood.<br><br>point 2) I can see that it's a nightmare.<br>I change the cube for a sphere in your old version to see the shadow map 'upwards' on the sphere, and I can see that this is an almost impossible task for you - potentially one good detailed shadow could take up all of the cpu.<br>As you say, sswift seems to have got closest to that.<br><br>Looking forward to your next version. <br><br></td></tr></table><br>
<a name="568190"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> A few thoughts. Once upon a time I wrote this little shadow demo (formerly knows as norc). My biggest mistake was to think a shadow towel needs to be object oriented. Today I think, it would be much more clever when the towel acts camera oriented. In other words, lay down the towel on the ground that is right in front of the camera. Make sure it will cover the whole field of view and problaby use EntityAutofade to smoothly fade out the shadow towel mesh in the distance.<br><br>The second problem is: aligning the towel to the ground. Linepicks are very slow, indeed. But how about to pre-compile the static ground, using some kind of raster? It may eat some megs of ram to hold the data. Not a big problem IMO.<br><br>I think this would be very fast. <br><br></td></tr></table><br>
<a name="568236"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gosse</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't want to fill up my address bar history :)<br><a href="http://www.planb.free.fr/AFO_Shadow.zip" target="_blank">http://www.planb.free.fr/AFO_Shadow.zip</a><br>[edit]<br>Nice stuff! <br><br></td></tr></table><br>
<a name="568301"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hautvent</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Doggie wrote : " it doesn't work if you have a flat screen monitor.<br>The 60hz refresh rate flickers like all hell.<br>Too bad."<br><br>What the hell are you talking about ? I'm working on dual screen LCD monitor one with 60Hz the other with 75Hz and I don't have any flicker ! I tested it too on another PC with a Flat screen CRT monitor, no problem either... Can you tell more ?<br><br>I think the next release will be the last, that remember me that I need to add spot lights... Maybe I'll release a V5.1 with spotlight included first, this was not my priority so far. <br><br></td></tr></table><br>
<a name="568323"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> "this was not my priority so far."<br>- It's very much appreciated though.<br><br>I noticed recently in the Spiderman game (not that I play that sort of thing) that all the 'extras' had simple round sprite-shadows under their feet (which was fine), while spiderman himself had a detailed shadow like yours (which was appropriate).<br><br>For anyone considering that sort of scenario, your shadow system is ideal.<br><br>As I said before, I wouldn't even know where to begin to write code like this; we all have our different talents.<br>For you to do this, then give it away, is very much appreciated. <br><br></td></tr></table><br>
<a name="568897"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hautvent</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> There you go, a small (for some people big ;o) ) update with spotlights for your pleasure )<br>I'd like to thank Mr. Mikkel Fredborg who inspired me in some way for a little (but hard) part of the code.<br><br>V5.1<br><a href="http://www.planb.free.fr/AFO_Shadow.zip" target="_blank">http://www.planb.free.fr/AFO_Shadow.zip</a><br><br><br>Now going back to V6... <br><br></td></tr></table><br>
<a name="568932"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nice!<br><br>V6? You feel there's more to do? <br><br></td></tr></table><br>
<a name="569073"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hautvent</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> mm yes with the actual version there is another optimisation that can be done (see JFK's post) but due to limitation of the system, I'll try another aproach of shadows.<br>So V6 will be using totally different shadow system, thus transparent for the user of the lib. My goal is to have the same possibility as V5.1 and add more, that's why I'd rather call it V6 than doing a brand new one. <br><br></td></tr></table><br>
<a name="569398"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hautvent</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> I just saw that I forgot a small but vital lign of code that preserve a lot a frame rate in hudge scene...<br>Did the small update, I change the main actor too for one that is more animated (I actually did it), hope you'll like it.<br><br>V5.1 revesited<br><a href="http://www.planb.free.fr/AFO_Shadow.zip" target="_blank">http://www.planb.free.fr/AFO_Shadow.zip</a> <br><br></td></tr></table><br>
<a name="569404"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> CHerrs. Works well. Thanks. <br><br></td></tr></table><br>
<a name="569429"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BlitzSupport</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah, nice job, thanks. <br><br></td></tr></table><br>
<a name="569514"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have to say it again. using an object oriented shadow system is such a waste of performance. Hit space in your demo and watch the tris in wireframe mode. There is more than enough triangles to cover the whole near range scene in front of the camera. So you'll have one single mesh for all shadows that are near the camera. To save perfomrmance you may even try to use a Terrain (LOD!) for this shadow mesh.<br><br>EDIT:<br>Uh, this just gave me a kick, I hope you don't mind, I wrote a little demo that is using one terrain as a shadow towel around the camera. It's pretty fast. Not a real system, currently it has only one light source, the sun (outdoors scene thing):<br><a href="http://www.melog.ch/dl/csp_bb_terrainshadow_05_1.zip" target="_blank">http://www.melog.ch/dl/csp_bb_terrainshadow_05_1.zip</a><br>It is btw using an orthographic camera for the shadowmap.<br>A very simple thing, but it may give you some ideas.<br><br>Of course, I think your system is great, especially since it's a real system, with multiple lights etc. <br><br></td></tr></table><br>
<a name="569553"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hautvent</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think you're right JKF, there is too much polys. On my system there is no problem with glow, blur, particles and stuff plus shadows, but my 6800GT helps )<br><br>The V6 I'm working on will be towel-less, it will be only texture bakery (real nightmare I'm telling ya). Tests I've made works well, but there is a lot of problem with multiple lights and my 'algos' are not working in every cases...<br><br>That's why I think I won't work on V5 anymore, the V6 will break actual limitation. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
