<!DOCTYPE html><html lang="en" ><head ><title >Delete files to Recycle Bin?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Delete files to Recycle Bin?</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Delete files to Recycle Bin?</a><br><br>
<a name="908770"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Danny</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Does anyone know how to delete files from Blitz to the windows recycle bin, so they could possibly be restored later ?<br><br>Couldn't find anything in environment variables, code archives or other obvious ways to do it...?!<br><br>Thanks,<br>Danny <br><br></td></tr></table><br>
<a name="908772"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> DeleteFile ? <br><br></td></tr></table><br>
<a name="908775"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Danny</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Err.. Nope. That will simply Delete the file which will be lost forever. I want to send it to the desktop's recycle bin instead..  ?! <br><br></td></tr></table><br>
<a name="908832"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Couldn't you just move the file? I'm sure the recycle bin has a folder somewhere in c: <br><br></td></tr></table><br>
<a name="908910"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="http://support.microsoft.com/kb/136517" target="_blank">http://support.microsoft.com/kb/136517</a> - this has some information on the Recycle Bin's folder\file structure.<br><br>Good luck. <br><br></td></tr></table><br>
<a name="908945"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Beaker</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> This might help a little:<br><a href="http://www.purebasic.fr/english/viewtopic.php?t=3783" target="_blank">http://www.purebasic.fr/english/viewtopic.php?t=3783</a> <br><br></td></tr></table><br>
<a name="908951"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Err.. Nope. That will simply Delete the file which will be lost forever.  <br></div>Huh. So they do. I'm sure they used to go to the recycle bin. I wonder if something changed with Blitz or if depends on the operating system. <br><br></td></tr></table><br>
<a name="908972"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Knight #51</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> You could simply create a function that moves a file to the Recycle Bin and removes it from the game, or you could try something like:<br><br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">

; copy file to recycle bin

CopyFile(file,recycle_bin_directory)

;delete file from this dir

DeleteFile(file)

</textarea><br><br><br>That will give the effect of deletion without actually deleting it from you computer. I didn't try it yet so let me know how it turns out. <br><br></td></tr></table><br>
<a name="909997"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Danny</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks All for the feedback.<br><br>yes Gizmo, that's the idea I'm hoping for: simply "moving" (renaming) the file to the recycle folder. Point is HOW do I obtain that Recycle folder's Full Path including Drive letter? That's pretty much the mystery I'm trying to solve.. I'm not expecting it's the same folder/drive for every system/windows version - and sjeesh knows what Vista will do in this context!<br><br>Beaker seems to have found what I need with that 'AllowUndo' flag before deleting a file  - although I wouldn't have a clue how to translate that to B3D... :(<br><br>D. <br><br></td></tr></table><br>
<a name="910000"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xlsior</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Point is HOW do I obtain that Recycle folder's Full Path including Drive letter <br></div><br><br>The recyclebin actually exists on ALL drives -- if you delete something from C:\ it ends up in the recyclebin folder on your C: drive, if you delete it from Z: it ends up in the recycle bin folder on your Z: drive.<br><br>The reason: Moving a file from one folder is just a matter of updating the file allocation table to point the filehandle to the new folder which is near-instantanious, while moving it to a different drive would entail making a full copy of the file which can take a LONG time for large files.<br><br>I'm sure there is a windows API or registry setting that will give you the directory name for the recycle bin. (which is important, since IIRc there are slight variations in the folder name across different windows versions, not to mention that it is likely called differently in all the non-English windows versions)<br><br>Last but not least: You can also *disable* the recycle bin on some (or all) drives, so don't just assume that it's always there. <br><br></td></tr></table><br>
<a name="910028"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> We not make your own recycle bin, on the directory of your program? Your program can restore the files if needed, or you can give the location of the folder, so users may copy it back themselves. <br><br></td></tr></table><br>
<a name="910086"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kev</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Danny long time no see, Use the API ShFileOperation() found in shell32.dll to send the file to recycle bin.<br><br>kev <br><br></td></tr></table><br>
<a name="910123"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kev</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> For those that want this feature.<br><br>decls<br><pre class=code>
.lib "shell32.dll"
shell32_SHFileOperation%(lpFileOp*):"SHFileOperationA" 

.lib "user32.dll"
user32_CallWindowProc%(lpPrevWndFunc*,hwnd%,msg%,wParam%,lParam$):"CallWindowProcA"
</pre><br><br>example<br><pre class=code>


Const FO_DELETE = $3
Const FOF_ALLOWUNDO = $40
Const FOF_NOCONFIRMATION = $10
Const FOF_SILENT = $4

; send example file to bin
If send_to_bin("e:\tmp.txt") = 0 Then
	Print "sent to bin"
Else
	Print "problem sending file to bin"
EndIf

MouseWait
End

Function send_to_bin(filename$)

	; build quick asm call to obtain string address
	asm = CreateBank(5)
	Restore asm_data
	For add_byte = 0 To 4
		Read byte
		PokeByte asm,add_byte,byte
	Next
	str_addr = user32_CallWindowProc(asm,0,0,0,filename$)

	; build struct
	bank = CreateBank(24)
	PokeInt bank,4,FO_DELETE 
	PokeInt bank,8,str_addr
	PokeInt bank,16,FOF_ALLOWUNDO Or FOF_NOCONFIRMATION Or FOF_SILENT

	; delete file to bin
	value =  shell32_SHFileOperation(bank)
	
	FreeBank bank
	FreeBank asm
	
	Return value

End Function

.asm_data
Data $8b,$44,$24,$10,$c3

</pre> <br><br></td></tr></table><br>
<a name="910293"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Danny</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> @ Ross C: Very good idea indeed - and probably safest :) I considered this but the amounts of data being purged (100's megs/multiple gigs at one time) is too much for comfort to store in a folder people might very easily forget about - and crash their system..<br><br>@xlsior: Very good points you're raising about considering language - or absence of the recycle bin! Thanks for that - I didn't think about that before!<br><br>@ Kev. You still my main man! The son I never had! :))<br>Thanks for that again. I will test it out (I'm sure it'll work) but curious to see how it reacts when there is no recycle bin (probably just deletes it). BTW, talk soon again, I need some special protection only you can provide ;)<br><br>Thanks again all, you really saved my skin on this one!<br><br>Danny,-- <br><br></td></tr></table><br>
<a name="910343"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kev</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> cool danny no problem, i would think it would throw an soft error if the recycle bin is removed. im sure the api can handle this :) umm you need some special protection boot's is the place to go mate :P<br><br>kev <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
