<!DOCTYPE html><html lang="en" ><head ><title >dx lighting and tris</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >dx lighting and tris</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >dx lighting and tris</a><br><br>
<a name="325179"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SabataRH</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi, just playing with some code here and stumbled unto a problem. Creating a mesh in blitz then adding tris/quads to it - is there a way to update dx lighting on the tris as they are being rotated? Im not rotating the Mesh itself, just the triangles/quads...<br><br>Thanks. <br><br></td></tr></table><br>
<a name="325185"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Andy</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I am not sure what you are asking, but 2 commands immediately sounds familiar.<br><br>UpdateNormals<br>VertexNormal<br><br><br>Andy <br><br></td></tr></table><br>
<a name="325190"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SabataRH</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> UpdateNormals <br>VertexNormal <br><br>Neither of which help the problem..<br>Okay, im creating a blitz mesh (createmesh), adding a surface to it (createsurface), adding the verts and building the tris (quads)... Now i set a dx light into my scene (createlight())... The mesh only updates the lighting if i rotate the parent mesh. (as it should do)..<br><br>But im not rotating the parent (mesh)... im rotating the triangles/quads... Doing so I get no lighting on the surfaces (as I shouldnt)... My question is can i force the mesh to update dx lighting on the surfaces even though im not rotating the mesh..<br><br>Err i know this sounds confusing.. sorry.<br><br>[edit] just added a bit more detail and some shots of the problem in this post <a href="http://www.blitzbasic.com/Community/posts.php?topic=30320" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=30320</a><br>[edit] <br><br></td></tr></table><br>
<a name="325227"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Are you saying that you're rotating the quads away from the light source, but the lighting on them is not changing?  <br><br>But that the lighting DOES change if you rotate the tree mesh?<br><br>AND you are using updatenormals() on the mesh after each update of the quads, OR are updating the normals manually with vertexnormal()?<br><br><br>"im rotating the triangles/quads... Doing so I get no lighting on the surfaces (as I shouldnt)"<br><br>Why do you think that the quads should NOT change their brightness when you rotate them?  They SHOULD change their brightness when you rotate them.  <br><br>UNLESS you're not updating the normals...<br><br><br>There is only one suggestion I can offer without knowing more about the problem, and that is that you should try redicing the radius of your light.  Note that the radius of a light is the distance at which the light BEGINS to fall off, not the distance at which it finishes falling off.  <br><br>As such, any light with a radius that is very large will cause light glitches where rotating an object will cause the surfaces to very suddenly go from dark to light instead of having a smooth transition. <br><br></td></tr></table><br>
<a name="325321"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah, agree with swift, the light should update as the quads in a mesh rotate. I think you might need to use one of the EntityFx commands.... or somthing. <br><br></td></tr></table><br>
<a name="325343"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SabataRH</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm I thought it should update too.. But seeing as the quads are being moved and not the actual mesh handle; I had to wonder if that was preventing it.<br><br>At any rate, they do not update... light shows from all angles or in most cases - none at all.<br><br>When applying updatenormals to the mesh I get a funky 1970's disco like effect ... the quads flash all diffrent shades of grey... Its quite pyschodelic! but not the effect I'm after :(<br><br>If I rotate the mesh handle then the quads update perfectly.. but obvisously thats not what I want to do  here. <br><br></td></tr></table><br>
<a name="325354"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Send me a verison of the demo with lighting and I'll make it work. :-) <br><br></td></tr></table><br>
<a name="325365"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> hey , this works fine, Just need to call updatenormals, and the mesh name. The camera is turning at the same speed as the quad, and you can see the light changing :)<br><br><pre class=code>
Graphics3D 800,600
SetBuffer BackBuffer()

light=CreateLight()

piv=CreatePivot()
cam=CreateCamera(piv)
PositionEntity cam,0,2,10
PointEntity cam,piv

Global mesh=CreateMesh()
Global surf=CreateSurface(mesh)
Global angle#=0

v0	= AddVertex(surf,-1 ,  1 , 0 , 0 ,0  )
v1	= AddVertex(surf, 1 ,  1 , 0 , 0 ,0  )
v2	= AddVertex(surf,-1 , -1 , 0 , 0 ,0  )
v3	= AddVertex(surf, 1 , -1 , 0 , 0 ,0  )
tri	= AddTriangle(surf,v0,v1,v2)
tri1= AddTriangle(surf,v1,v3,v2)

UpdateNormals(mesh)

While Not KeyHit(1)

	
	angle=angle+1
	TurnEntity piv,0,1,0
	rotate()
	
	
	UpdateWorld
	RenderWorld
	Flip
Wend
End

Function rotate()
	VertexCoords(surf,0,	Cos(angle),	 	 1,	 Sin(angle)	 )
	VertexCoords(surf,1,	Cos(angle+180),	 1,	 Sin(angle+180) )
	VertexCoords(surf,2,	Cos(angle)	,	-1,	 Sin(angle)	 )
	VertexCoords(surf,3,	Cos(angle+180),	-1,	 Sin(angle+180))
	UpdateNormals(mesh)
End Function
</pre> <br><br></td></tr></table><br>
<a name="325439"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SabataRH</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Heh nice example ross.. hmmm sadly though i get quite a diffrent effect when using this approach.. This is odd... Gonna strip out some stuff until it works then start adding back in until i find out whats causing it..<br><br>Also, im sure this has been covered... EntityAlpha() on meshes set to use vertex coloring (entityfx mesh,2) dosent work.. its either all the way on or all the way off. Im sure its because setting fx 2 truns off alphablending ?<br><br>Try ross's example with enityfx command remed out, then try it on..<br><br><pre class=code>
Graphics3D 800,600
SetBuffer BackBuffer()

light=CreateLight()

piv=CreatePivot()
cam=CreateCamera(piv): CameraClsColor cam,255,0,0
PositionEntity cam,0,2,10
PointEntity cam,piv

Global mesh=CreateMesh()
Global surf=CreateSurface(mesh)
Global angle#=0
EntityFX mesh,2
EntityAlpha mesh,.5

v0	= AddVertex(surf,-1 ,  1 , 0 , 0 ,0  )
v1	= AddVertex(surf, 1 ,  1 , 0 , 0 ,0  )
v2	= AddVertex(surf,-1 , -1 , 0 , 0 ,0  )
v3	= AddVertex(surf, 1 , -1 , 0 , 0 ,0  )
tri	= AddTriangle(surf,v0,v1,v2)
tri1= AddTriangle(surf,v1,v3,v2)

UpdateNormals(mesh)



While Not KeyHit(1)

	
	angle=angle+1
	TurnEntity piv,0,1,0
	rotate()
	
	
	UpdateWorld
	RenderWorld
	Flip
Wend
End

Function rotate()
	VertexCoords(surf,0,	Cos(angle),	 	 1,	 Sin(angle)	 )
	VertexCoords(surf,1,	Cos(angle+180),	 1,	 Sin(angle+180) )
	VertexCoords(surf,2,	Cos(angle)	,	-1,	 Sin(angle)	 )
	VertexCoords(surf,3,	Cos(angle+180),	-1,	 Sin(angle+180))
	UpdateNormals(mesh)
End Function
</pre><br><br><br><br><br>Ross, thanks.<br>Sswift, thanks. <br><br></td></tr></table><br>
<a name="325476"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Good news! <br>I found the problem!<br><br>Better news!  <br>I dramatically increased the speed of the rendering!<br><br>Aren't I great?  I'm so great.  I postively wonderful.  You owe me big time!<br><br>Good now that that's settled maybe you won't kill me. :-)<br><br>Remember that Quad function I wrote for you?  Well I kiiinda forgot that when testing I added FOUR triangles, two wound clockwise and two wound counterclockwise.  <br><br>Go into "addquadtosurface" and delete the two addtriangles at the end under the counterclockwise header.<br><br><br><br>And here's a weird thing.  When I deleted those two and ran the program, the black quads went away.  But they shouldn't have been there in the first place cause those are back faces.  They should have been invisible.  And if I only add the back faces, the trees have no foliage at all, so they clearly are not visible.  Yet they were cuasing graphical glitches somehow.<br><br>And now for the really weird thing.  After I commented out those lines, I uncommented them and ran the program again.  The black stuff was gone.  But it should have been there.<br><br>AND, if I install a completely new copy of the one you sent me where the black glitches were appearing in the first place, they're still gone.  <br><br>I think this is a bug in Blitz.  I think that Blitz somehow set something on the video card wrong in the first place cuaisng the black glitches because of the back faces which should have been invisible but were not... Perhaps a zbuffer issue...  And then when I fixed it it toggled something on the card driver and things are now normal, but I bet if I rebooted it would go back to not working.<br><br>This might have something to do with the zbuffer and transparency...  It migth be interesting to see what would have happened if I took out the CLS from your main loop.  which btw, you don't need.  That may lose you a bit of speed.<br><br><br>So there you have it.  I think it was the backfaces causing the problem, but they should not have done anyhting worse than just make the scene a little slower.  Try remvoign them from your code and let me know if that solves it. <br><br></td></tr></table><br>
<a name="325481"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Aha... I rebooted and the black tris were still gone so I now realise why the black tris were there when using updatenormals!<br><br>The reason the black tris were there is because the corner vertcies of the quad were connected to both the front and the back faces.  Because these face in exact opposite directions, it is impossible to calculate a normal for them which is halfway between the two.  So all attempts to clauclate the normals ended up getting screwed up.<br><br>It should also be noted that even if the two sides had used individual vertcies, if you'd used Mark's updatenormals function you would have seen the same results, because MArks' updatenormals function looks for vertcies which occupy the same space and smooths across them.  This sometimes leads to graphical glitches when you have geometry arranged in weird ways.<br><br>So that's what was going on.  No zbuffer problem or bug in Blitz' rendering.  Just normals that were impossible to calculate because of one tiny bit of debugging code I'd mistakenly left in the quad function. :-) <br><br></td></tr></table><br>
<a name="325485"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SabataRH</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> !! thats great news Sswift!, thought I may had stumbled upon something that 'couldn't be done'.. :)<br><br>I actually thought those 2 additional triangles were left in for tform rotation calcs... good to know! :)<br><br>Nice research... Thanks. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
