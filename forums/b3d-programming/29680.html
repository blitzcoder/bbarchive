<!DOCTYPE html><html lang="en" ><head ><title >tokamak physics thread 2:</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >tokamak physics thread 2:</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >tokamak physics thread 2:</a><br><br>
<a name="314535"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >(tu) sinu</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> New thread, old one is to big, please post in here now if you don't mind, helps the modem users. <br><br></td></tr></table><br>
<a name="314595"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RayTracer</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Tokamak is awesome , but collisions with terrains could be a problem ,since you can't GetSurface from a terrain... <br><br></td></tr></table><br>
<a name="314597"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I had a problem with the terrain demo.  A few of the objects dropped straight through. :/ <br><br></td></tr></table><br>
<a name="314602"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DarkEagle</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> probably best with a mesh terrain rather than a blitz terrain? the moving verts cant really be helping... <br><br></td></tr></table><br>
<a name="314608"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jeremy Alessi</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmmm... I don't have a Tokamakdll.dll I only have a Tokamakdll.dsp.  Yes everything is in the current directory and I still have the same folder setup it had when I unzipped it too. <br><br></td></tr></table><br>
<a name="314609"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jhocking</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Don't forget the actual dll is a separate download you have to get from the Tokamak website.  Sweenie's download is just the wrapper. <br><br></td></tr></table><br>
<a name="314610"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Go Sweenie!<br><br>In case ppl missed out on initial thread visit this site for some physices tokamak style - www.freewebs.com/sweenie <br><br>ban, if you are messing with c++ projects maybe start a new thread to avoid confusion? <br><br></td></tr></table><br>
<a name="314617"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DarkEagle</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> can anybody explain the process of making a b3d exported from maplet work with this? i have an idea using 2 copies of the mesh, one of them having just one surface... <br><br></td></tr></table><br>
<a name="314625"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ice9</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Very nice Sweenie MUU!! <br><br></td></tr></table><br>
<a name="314627"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DarkEagle</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> never mind, sorted it :) requires 2 copies of the mesh though, one of them needs to have just one surface and is hidden. Is this naming convention for the tok functions going to stay? if so il create some nice functions :) <br><br></td></tr></table><br>
<a name="314628"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bot Builder</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> why does it have to be single surface? Can't you just tell it where all your tris are? <br><br></td></tr></table><br>
<a name="314629"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Vorderman</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> So what's the deal with distributing the TokamakDLL file with your programs? If the system is free for commercial use, how can you not be able to distribute the DLL? <br><br></td></tr></table><br>
<a name="314631"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Koriolis</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can.<br>It's when you're making a physics engine or the like (say...a wrapper for tokamak) that you can't distribute yourself the tokamak DLL.<br>For you game no prob.<br><br>At least that's waht I understood. <br><br></td></tr></table><br>
<a name="314634"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AL</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> GFK, i had the same problem of some objects falling through the landscape.<br><br>Ive just been through the terrain tutorial briefly (find it <a href="http://www.adamdawes.com/" target="_blank">here!</a>) and you have to set the maximum number of collisions that can happen at any one time, i guess its exceeding this value when you see the objects going through the terrain. <br><br></td></tr></table><br>
<a name="314639"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bot Builder</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> I checked; you can just loop through your surfaces grabbing all the tris and putting them in you bank. Why would you need another entity?<br><br>Very, very nice sweenie!<br><br>how bout making the function called 'TOKSIM_SetStaticMesh' instead of 'TOKSIM_SetTerrainMesh' people might get confused and think it has to be a terrain. <br><br></td></tr></table><br>
<a name="314644"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DarkEagle</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> you can? can somebody code a function for me that does this with every mesh i pass to to it? at the moment i have this for my collision entity...<br><br><pre class=code>
Function MakeTokCollider(mesh)

	surface = GetSurface(mesh,1)
	
	;fill bank with vertices
	vertices=CreateBank(16*CountVertices(surface))
	offset=0
	For v=0 To CountVertices(surface)-1
	 PokeFloat vertices,offset,VertexX#(surface,v)
	 PokeFloat vertices,offset+4,VertexY#(surface,v)
	 PokeFloat vertices,offset+8,VertexZ#(surface,v)
	 PokeFloat vertices,offset+12,0.0
	 offset=offset+16  
	Next
	
	;fill bank with triangles
	triangles=CreateBank(24*CountTriangles(surface))
	offset=0
	For v=0 To CountTriangles(surface)-1
	 PokeInt triangles,offset,TriangleVertex(surface,v,0)
	 PokeInt triangles,offset+4,TriangleVertex(surface,v,1)
	 PokeInt triangles,offset+8,TriangleVertex(surface,v,2)
	 PokeInt triangles,offset+12,0
	 PokeInt triangles,offset+16,0
	 PokeInt triangles,offset+20,0
	 offset=offset+24  
	Next
	
	;Hand over the terrain data to Tokamak
	TOKSIM_SetTerrainMesh vertices,CountVertices(surface),triangles,CountTriangles(surface) 
	
	; Now we can free the banks as Tokamak has copied all data
	FreeBank vertices
	FreeBank triangles

End Function
</pre><br><br>i also made these:<br><br><pre class=code>
Function CreateTokCube(entity,rb,x#,y#,z#,xs#=1.0,ys#=1.0,zs#=1.0,mass#=1.0)

	ScaleEntity entity,xs,ys,zs
	PositionEntity entity,x,y,z
	
	TOKRB_AddBox rb,xs*2,ys*2,zs*2
	TOKRB_SetPosition rb,x,y,z
	TOKRB_SetLinearDamping rb,0.001
	TOKRB_SetMass rb,mass
	TOKRB_SetBoxInertiaTensor rb,xs,ys,zs,mass

End Function


Function CreateTokSphere(entity,rb,x#,y#,z#,rad#=1.0,mass#=1.0)

	ScaleEntity entity,rad,rad,rad
	PositionEntity entity,x,y,z
	
	TOKRB_AddSphere rb,rad#*2
	TOKRB_SetPosition rb,x,y,z
	TOKRB_SetLinearDamping rb,0.001
	TOKRB_SetMass rb,mass
	TOKRB_SetBoxInertiaTensor rb,rad,rad,rad,mass

End Function


Function CreateTokCylinder(entity,rb,x#,y#,z#,rad#=1.0,height#=1.0,mass#=1.0)

	TOKRB_AddCylinder rb,rad*2,height
	TOKRB_SetPosition rb,x,y,z
	TOKRB_SetLinearDamping rb,0.001 
	TOKRB_SetAngularDamping rb,0.01 
	TOKRB_SetMass rb,mass
	TOKRB_SetCylinderInertiaTensor rb,rad*2,height,mass

End Function
</pre><br><br>to be used as such:<br><br><pre class=code>
	nr=Rnd(1,3)	
		
	If nr=1 Then
		obj(i) = CreateCube()
		rb(i) = TOKRB_Create()
		CreateTokCube(obj(i),rb(i),x#,15+i*0.2,z#,1,1,1,2)
	ElseIf nr=2 
		obj(i) = CreateSphere()
		rb(i) = TOKRB_Create()
		CreateTokSphere(obj(i),rb(i),x#,15+i*0.2,z#,1,1.5)
	ElseIf nr=3 
		obj(i) = CreateCylinder()
		rb(i) = TOKRB_Create()
		CreateTokCylinder(obj(i),rb(i),x#,15+i*0.2,z#,1,1,2)
	EndIf
</pre><br><br>figured it might help you guys... <br><br></td></tr></table><br>
<a name="314654"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Binary_Moon</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> how bout making the function called 'TOKSIM_SetStaticMesh' instead of 'TOKSIM_SetTerrainMesh' people might get confused and think it has to be a terrain. <br></div><br><br>You could just edit the decls file yourself. Of course getting it changed in the global distribution would be better but...<br><br>Sweenie - This is all very cool. I will have to have a play with this properly some time; I've wanted decent physics for ages. <br><br></td></tr></table><br>
<a name="314656"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bot Builder</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'll post it in a minute... It's a bit harder than I thought, as the triangls's vertice indices will be screwed up.<br><br>BTW, I get no 'through the terrain' problems unless I jack it up to 500 entities. at 200 its fine.  Tokomak time is wrong though. it says its taking 300 ms. while with a total-process timer its only 20? <br><br></td></tr></table><br>
<a name="314660"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Skitchy</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is the constraint thing in yet? I'm assuming it would be necessary to do a car physics sim? Anybody know? :-/ <br><br></td></tr></table><br>
<a name="314666"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bot Builder</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> try this out real quick. I doubt it'll work. I probably made an error somewhere as it is quite a complex thing :( however very useful to have.<br><br>[edit]took out the code cause there's a better one down below<br><br>this hopefully handles multi-surface entities. <br><br></td></tr></table><br>
<a name="314670"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DarkEagle</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> doesnt seem to :( the tris seem to be getting messed up somewhere.<br><br>it needs to be:<br><br>TOKSIM_SetTerrainMesh vertices,ttlvert,triangles,ttltris<br><br>rather than:<br><br>TOKSIM_SetTerrainMesh vertices,CountVertices(surface),triangles,CountTriangles(surface)<br><br>though...<br><br>/edit/ still nothing /edit/ <br><br></td></tr></table><br>
<a name="314672"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bot Builder</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> As you can see I already changed that :) musta posted while I updated :) <br><br></td></tr></table><br>
<a name="314676"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DarkEagle</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> yeah, still doesnt work :P looks like multi-surface is a tad tougher? possibly rebuilding mesh into one surface, then passing this through is a better idea? the new mesh could be deleted afterwards... <br><br></td></tr></table><br>
<a name="314677"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bot Builder</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> not sure if that works, but try it again. I changed it a bit more. <br><br></td></tr></table><br>
<a name="314679"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DarkEagle</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> youl never guess what... still doesnt work :P i have to go to bed now, if your going to carry on then good luck ;) <br><br></td></tr></table><br>
<a name="314680"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tom</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> You gotta check this out, I was testing the Joint types (I know we aint got proper axle type joints 'yet') but anyways, I created a galloping box LOL!<br><br>Just hold space down<br><br>[code]<br>; Joint tests, trying to simulate vehicle axles<br>;<br>; I got a galloping car instead hehe<br>;<br>; Scouse<br><br>Const FPS=50<br><br><br>Graphics3D 800,600,0,2<br>SetBuffer BackBuffer()<br><br>WireFrame False<br><br>Const ENTS=5<br><br>camera = CreateCamera()<br>PositionEntity camera,-5,8,-10<br><br>TOKSIM_CreateSimulator(ENTS,5,0,-10,0)<br><br>ground = CreateCube()<br>EntityColor ground,5,5,55 <br>ScaleEntity ground,50,5,50 <br>PositionEntity ground,0,-5,0<br>abground = TOKAB_Create()<br>TOKAB_AddBox(abground,100.0,10.0,100.0)<br>TOKAB_SetPosition(abground,0.0,-5.0,0.0)<br><br>wall1 = CreateCube()<br>EntityColor wall1,25,25,55 <br>ScaleEntity wall1,2,10,50 <br>PositionEntity wall1,50,0,0<br>abwall1 = TOKAB_Create()<br>TOKAB_AddBox(abwall1,4.0,20.0,100.0)<br>TOKAB_SetPosition(abwall1,50.0,0,0.0)<br><br>wall2 = CreateCube()<br>EntityColor wall2,25,25,55 <br>ScaleEntity wall2,2,10,50 <br>PositionEntity wall2,-50,0,0<br>abwall2 = TOKAB_Create()<br>TOKAB_AddBox(abwall2,4.0,20.0,100.0)<br>TOKAB_SetPosition(abwall2,-50.0,0,0.0)<br><br>wall3 = CreateCube()<br>EntityColor wall3,25,25,55 <br>ScaleEntity wall3,50,10,2 <br>PositionEntity wall3,0,0,-50<br>abwall3 = TOKAB_Create()<br>TOKAB_AddBox(abwall3,100.0,20.0,4.0)<br>TOKAB_SetPosition(abwall3,0.0,0,-50.0)<br><br>wall4 = CreateCube()<br>EntityColor wall4,25,25,55 <br>ScaleEntity wall4,50,10,2 <br>PositionEntity wall4,0,0,50<br>abwall4 = TOKAB_Create()<br>TOKAB_AddBox(abwall4,100.0,20.0,4.0)<br>TOKAB_SetPosition(abwall4,0.0,0,50.0)<br><br><br>Dim obj(ENTS)<br>Dim rb(ENTS)<br><br>  obj(1) = CreateCube()<br>  ScaleEntity obj(1),.5,.5,1 <br>  rb(1) = TOKRB_Create()<br>  TOKRB_AddBox rb(1),1.0,1.0,2.0<br>  ;TOKRB_CollideConnected rb(1),True<br>  TOKRB_SetPosition rb(1),0,2,0<br>  PositionEntity obj(1),0,2,0<br>  TOKRB_SetLinearDamping rb(1),0.001<br>  TOKRB_SetAngularDamping rb(1),0.001 	<br>  TOKRB_SetMass rb(1),2.0<br>  TOKRB_SetBoxInertiaTensor rb(i),1,1,2,2.0  <br> <br>  obj(2) = CreateSphere()<br>  ScaleEntity obj(2),.5,.5,.5<br>  rb(2) = TOKRB_Create()<br>  ;TOKRB_CollideConnected rb(2),True<br>  TOKRB_AddSphere rb(2),1<br>  TOKRB_SetPosition rb(2),-1,1.5,0.7<br>  PositionEntity obj(2),-1,1.5,0.7<br>  TOKRB_SetAngularDamping rb(2),0.02 <br>  TOKRB_SetLinearDamping rb(2),0.001 <br>  TOKRB_SetMass rb(2),0.5<br>  TOKRB_SetSphereInertiaTensor rb(2),1,1<br><br>  obj(3) = CreateSphere()<br>  ScaleEntity obj(3),.5,.5,.5<br>  rb(3) = TOKRB_Create()<br>  ;TOKRB_CollideConnected rb(3),True<br>  TOKRB_AddSphere rb(3),1<br>  TOKRB_SetPosition rb(3),1,1.5,0.7<br>  PositionEntity obj(3),1,1.5,0.7<br>  TOKRB_SetAngularDamping rb(3),0.02 <br>  TOKRB_SetLinearDamping rb(3),0.001 <br>  TOKRB_SetMass rb(3),0.5<br>  TOKRB_SetSphereInertiaTensor rb(3),1,1<br><br>  obj(4) = CreateSphere()<br>  ScaleEntity obj(4),.5,.5,.5<br>  rb(4) = TOKRB_Create()<br>  ;TOKRB_CollideConnected rb(5),True<br>  TOKRB_AddSphere rb(4),1<br>  TOKRB_SetPosition rb(4),-1,1.5,-.7<br>  PositionEntity obj(4),-1,1.5,-.7<br>  TOKRB_SetAngularDamping rb(4),0.02 <br>  TOKRB_SetLinearDamping rb(4),0.001 <br>  TOKRB_SetMass rb(4),0.5<br>  TOKRB_SetSphereInertiaTensor rb(4),1,1<br><br><br>  obj(5) = CreateSphere()<br>  ScaleEntity obj(5),.5,.5,.5<br>  rb(5) = TOKRB_Create()<br>  ;TOKRB_CollideConnected rb(5),True<br>  TOKRB_AddSphere rb(5),1<br>  TOKRB_SetPosition rb(5),1,1.5,-.7<br>  PositionEntity obj(5),1,1.5,-.7<br>  TOKRB_SetAngularDamping rb(5),0.02 <br>  TOKRB_SetLinearDamping rb(5),0.001 <br>  TOKRB_SetMass rb(5),0.5<br>  TOKRB_SetSphereInertiaTensor rb(5),1,1<br><br>  ;obj(i) = CreateCylinder()<br>  ;rb(i) = TOKRB_Create()<br>  ;TOKRB_AddCylinder rb(i),2.0,1.0<br>  ;TOKRB_SetPosition(rb(i),x#,2+i*0.2,z#)<br>  ;TOKRB_SetAngularDamping rb(i),0.02 <br>  ;TOKRB_SetLinearDamping rb(i),0.001 <br>  ;TOKRB_SetMass rb(i),2.0<br>  ;TOKRB_SetCylinderInertiaTensor rb(i),2.0,1.0,2.0  <br><br><br> ;EntityColor obj(i),Rnd(100,230),Rnd(100,230),Rnd(100,230) <br><br>  <br>  axletype=1<br><br>  axle1=TOKJOINT_Create (2,rb(1),rb(2))<br>  TOKJOINT_SetPositionWorld axle1,-.5,1.5,.7<br>  TOKJOINT_SetType axle1,axletype<br>  TOKJOINT_Enable axle1,True<br><br>  axle2=TOKJOINT_Create (2,rb(1),rb(3))<br>  TOKJOINT_SetPositionWorld axle2,.5,1.5,.7<br>  TOKJOINT_SetType axle2,axletype<br>  TOKJOINT_Enable axle2,True<br><br>  axle3=TOKJOINT_Create (2,rb(1),rb(4))<br>  TOKJOINT_SetPositionWorld axle3,-.5,1.5,-.7<br>  TOKJOINT_SetType axle3,axletype<br>  TOKJOINT_Enable axle3,True<br><br>  axle4=TOKJOINT_Create (2,rb(1),rb(5))<br>  TOKJOINT_SetPositionWorld axle4,.5,1.5,-.7<br>  TOKJOINT_SetType axle4,axletype<br>  TOKJOINT_Enable axle4,True<br><br><br><br>Centerpivot = CreatePivot()<br><br>light=CreateLight()<br>PositionEntity light,7,15,-5<br>PointEntity light,Centerpivot<br><br>rot#=0<br><br>period=1000/FPS<br>time=MilliSecs()-period<br><br>imptime=MilliSecs()<br>; MainLoop<br>While Not KeyHit(1)<br><br>	Repeat<br>		elapsed=MilliSecs()-time<br>	Until elapsed<br><br>	ticks=elapsed/period<br>	tween#=Float(elapsed Mod period)/Float(period)<br><br>	For k=1 To ticks<br>		time=time+period<br>		If k=ticks Then CaptureWorld<br><br>		TOKSIM_Advance(1.0/FPS)<br><br>If rot#&gt;360 Then rot#=0<br><br>;PositionEntity camera,camx#,40,camz#<br>PointEntity camera,centerpivot  <br>	UpdateWorld<br><br>	Next<br><br>; Not sure wether to put this here or inside the for/next above...<br>For i=1 To 5<br> If TOKRB_IsIdle(rb(i)) Then<br>  EntityAlpha obj(i),0.5<br> Else<br>  EntityAlpha obj(i),1.0<br> EndIf<br><br> PositionEntity obj(i),TOKRB_GetX#(rb(i)),TOKRB_GetY#(rb(i)),TOKRB_GetZ#(rb(i)) <br> RotateEntity obj(i),TOKRB_GetPitch#(rb(i)),TOKRB_GetYaw#(rb(i)),TOKRB_GetRoll#(rb(i)),False<br>Next<br><br>If KeyDown(57) Then<br>; i=Rnd(1,ENTS) <br>; TOKRB_ApplyImpulse rb(i),Rnd(-3.0,3.0),Rnd(15,30),Rnd(-3.0,3.0) <br>; TOKRB_ApplyImpulse2 rb(i),0,30,0,TOKRB_GetX#(rb(i))+0.5,TOKRB_GetY#(rb(i))-0.5,TOKRB_GetZ#(rb(i))+0.5 <br> TOKRB_ApplyTwist rb(2),1,0,0<br> TOKRB_ApplyTwist rb(3),1,0,0<br> TOKRB_ApplyTwist rb(4),1,0,0<br> TOKRB_ApplyTwist rb(5),1,0,0<br><br>; TOKRB_SetForce rb(i),0,0,-10<br>; TOKRB_SetForce2 rb(i),0,0,-10,TOKRB_GetX#(rb(i))+0.5,TOKRB_GetY#(rb(i))-1.5,TOKRB_GetZ#(rb(i))+0.5<br>; For i=1 To ENTS<br> ;TOKRB_SetTorque rb(i),0,60,0<br>; Next<br>EndIf<br><br>RenderWorld tween<br><br>Text 0,0,"Physics Time:"+TOKSIM_GetPhysicsTime()*1000.0+ " milliseconds"<br>Text 0,10,"Render Time:"+Str(elapsed)+ " milliseconds"<br>	Flip False<br><br>Wend<br><br>TOKSIM_DestroySimulator()<br><br>End<br>[/CODE]<br><br>Have fun!<br>Tom <br><br></td></tr></table><br>
<a name="314690"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bot Builder</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> lol. that's awesome :)<br><br>Darkeagle, Can you send me the code and model your using so I can work on it?  You method would work, but I'd rather try a method that's pure data manipulation before doing that.<br><br>bot_builder56 AT fastmail.fm<br><br>(replace the AT with @)<br><br>updated the code. if it doesn't work, please mail me. <br><br></td></tr></table><br>
<a name="314691"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >puki</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> That galloping box is cute - f'nar - could be turned into a virtual puppy. <br><br></td></tr></table><br>
<a name="314715"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Craig H. Nisbet</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey guys, I just jumped in on this thread.  I don't have much experience with whole userlib thing.  I downloaded the dll and related files, and copied to my user lib dir.  Looks like the command came in fine but it claims that it can't find the userlib, I'm assuming it means the dll.  Is that supposed to be in a specific place? <br><br></td></tr></table><br>
<a name="314719"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jeremy Alessi</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think you need the .dll from tokamakphysics.com, I had the same problem but haven't tested it out yet as I switched machines. <br><br></td></tr></table><br>
<a name="314770"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xmlspy</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> the demos are awesome, this seems to be the best physics engine for Blitz3D, keep up the good work. <br><br></td></tr></table><br>
<a name="314806"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >darklordz</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#32">[#32]</a></td></tr></table></td></tr><tr ><td class="posttext"> How to install sweenie's wrapper:<br><br>First unpack the userlibs\Tokamak.decls file into your blitz3d\userlibs folder. Also unpack userlibs\TokamakWrapper.dll into your blitz3d\userlibs folder. <br><br>Then download tokamak_lib_1010.zip and unpack lib\tokamakdll.dll to either your system32 folder of the folder that your tokamak samples are launched from. Otherwise you'll get the userlib not found error.....<br><br>To recap. You need 2 dll's the wrapper and the actual physics lib.<br><br>Nice work Sweenie :Restecpa! <br><br></td></tr></table><br>
<a name="314830"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MattG</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#33">[#33]</a></td></tr></table></td></tr><tr ><td class="posttext"> is there a command i can use to tell if somthing has collided ? ie when a ball hits the ground ? or do i have to do that within blitz using blitz colision ?<br><br>thanks<br><br>Matt <br><br></td></tr></table><br>
<a name="314898"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sweenie</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#34">[#34]</a></td></tr></table></td></tr><tr ><td class="posttext"> Rigid and Animated bodies can be freed, check the Tokamak.decls file for reference.<br><br><div class="quote"> how bout making the function called 'TOKSIM_SetStaticMesh' instead of 'TOKSIM_SetTerrainMesh' people might get confused and think it has to be a terrain. <br></div><br><br>I've tried to stay with the names in the actual physicsdll, but I have to agree, setterrainmesh is misleading.<br>I will change this in the next release.<br><br>The same goes for animatedbodies. I don't really think they are supposed to be moved once the simulation has started.<br>If you move an animbody towards a rigidbody it will go right through if the velocity is to high.<br>StaticBodies would have been a better name for them.<br>Unless they can be moved and I simply do something wrong in my simulations.<br><br><div class="quote"> Is the constraint thing in yet? I'm assuming it would be necessary to do a car physics sim? Anybody know? :-/  <br></div><br>I'm currently working on the jointlimits. Should be implemented in the next release.<br><br><div class="quote"> is there a command i can use to tell if somthing has collided ? ie when a ball hits the ground ? or do i have to do that within blitz using blitz colision ? <br></div><br><br>Since Tokamak uses Callbacks for collisioninfo I have to come up with some way to feed the collisioninfo to Blitz.<br>I will probably fill some kind of collisiontable and then the user can retrieve collisioninfo for a certain body or bodies.<br>hmm, like how you retrieve collisioninfo in blitz today I suppose. <br><br></td></tr></table><br>
<a name="314899"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RayTracer</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#35">[#35]</a></td></tr></table></td></tr><tr ><td class="posttext"> it would be useful if we had something like this:<br><pre class=code>
...
tok_mesh=createmesh()
mesh1=loadmesh("mesh1.3ds")
AddToMesh(mesh1)
mesh2=loadmesh("mesh2.3ds")
AddToMesh(mesh2)
...
TOKSIM_SetTerrainMesh...
</pre><br>AddToMesh is a function that adds vertices to a mesh(tok_mesh in this case) from another certain mesh ,and then give it to tokamak as the static mesh.<br>Just a thought <br><br></td></tr></table><br>
<a name="314918"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mark Judd</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#36">[#36]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sweenie,<br><br>Appreciate you've plenty to be going on with, but any chance of adding a :-<br><br>TOKSIM_SetMaterial(s32 index,friction,restitution)<br><br>since my car model works ace apart from driving everywhere on ice!!<br><br>Thanks in advance.<br><br>/EDIT Sorry Sweenie, just read your worklog a little better - realise you had this planned already. <br><br></td></tr></table><br>
<a name="314994"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DarkEagle</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#37">[#37]</a></td></tr></table></td></tr><tr ><td class="posttext"> parp :) i have some issues with objects falling through a mesh if they are travelling too fast... any fixes? <br><br></td></tr></table><br>
<a name="315006"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LostCargo</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#38">[#38]</a></td></tr></table></td></tr><tr ><td class="posttext"> that seems to happen also with blitz's collision systems too if im correct. <br><br></td></tr></table><br>
<a name="315020"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RayTracer</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#39">[#39]</a></td></tr></table></td></tr><tr ><td class="posttext"> to increase accuracy you should do this<br><pre class=code>
const iterations=5
...
 for i=1 to iterations
          TOKSIM_Advance(1.5/(FPS*iterations))
 next
</pre><br>its slower but more accurate ,increase the number of iterations if necessary <br><br></td></tr></table><br>
<a name="315024"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bradford6</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#40">[#40]</a></td></tr></table></td></tr><tr ><td class="posttext"> alot of these question could be addressed if you guys would go to www.tokamakphysics.com and look at the documentation.<br><br>Sweenie did not write Tokamak, he is creating the bridge between Tokamak &lt;===&gt; Blitz-3d.<br><br>...and he is doing a damn fine job I might add :) <br><br></td></tr></table><br>
<a name="315047"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >CopperCircle</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#41">[#41]</a></td></tr></table></td></tr><tr ><td class="posttext"> "If you move an animbody towards a rigidbody it will go right through if the velocity is to high."<br><br>Is there anyway to create a mesh that has dynamic collisions with the rigid bodies at speed? <br><br></td></tr></table><br>
<a name="315166"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bradford6</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#42">[#42]</a></td></tr></table></td></tr><tr ><td class="posttext"> you could connect rigid bodies together and the resulting <br>RB &gt; RB would produce a collision. <br><br></td></tr></table><br>
<a name="315187"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paul "Taiphoz"</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#43">[#43]</a></td></tr></table></td></tr><tr ><td class="posttext"> Question is your zip all you need. ? Or do I need to download the SDK from the other website ?<br><br>Only asking cos I had a quick look today and none of the demos worked. but I didnt download the SDK. <br><br></td></tr></table><br>
<a name="315190"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >IPete2</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#44">[#44]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yavin,<br><br>Look further up this thread.<br><br>It is explicitly explained for us (I had the same problems initially!)<br><br>Cheers,<br><br>IPete2. <br><br></td></tr></table><br>
<a name="315232"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bot Builder</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#45">[#45]</a></td></tr></table></td></tr><tr ><td class="posttext"> okay Darkeagle :) got it working. multisurface meshs :) I'll take ghostdag's suggestion and try making it multi-mesh as well as multi-surface.<br>[edit]see below for a new version<br>turns out I had a '-1' where it shouldn't have been. <br><br></td></tr></table><br>
<a name="315412"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bradford6</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#46">[#46]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="/posts.php?topic=29736" target="_blank">DOWNLOAD my new tokamak demo from this thread...</a> <br><br></td></tr></table><br>
<a name="315437"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RayTracer</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#47">[#47]</a></td></tr></table></td></tr><tr ><td class="posttext"> Good work bot builder <br><br></td></tr></table><br>
<a name="315490"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >fredborg</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#48">[#48]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can use this to create the tokamak terrain mesh, from a segmented model:<pre class=code>Function TOK_MakeCollider(entity,trisbank=0,vertbank=0,rec=False)

	If EntityClass(entity) = "Mesh"
	
		If rec = False
			vertbank = CreateBank(0)
			trisbank = CreateBank(0)
			
			f_vert = 0
			f_tris = 0
		Else
			f_vert = BankSize(vertbank)/16
			f_tris = BankSize(trisbank)/24
		End If
				
		n_surf = CountSurfaces(entity)
		For s = 1 To n_surf
			surf = GetSurface(entity,s)
			
			n_vert = CountVertices(surf)
			n_tris = CountTriangles(surf)
	
			ResizeBank vertbank,(n_vert+f_vert)*16			
			ResizeBank trisbank,(n_tris+f_tris)*24
			
			For v = 0 To n_vert-1
				bankoffset = (f_vert+v)*16
			
				TFormPoint VertexX#(surf,v),VertexY#(surf,v),VertexZ#(surf,v),entity,0
			
				PokeFloat vertbank,bankoffset	,TFormedX()
				PokeFloat vertbank,bankoffset+4	,TFormedY()
				PokeFloat vertbank,bankoffset+8	,TFormedZ()
				PokeFloat vertbank,bankoffset+12,0.0
			Next
			
			For t = 0 To n_tris-1
				bankoffset = (f_tris+t)*24
			
				PokeInt trisbank,bankoffset   ,f_vert+TriangleVertex(surf,t,0)
				PokeInt trisbank,bankoffset+4 ,f_vert+TriangleVertex(surf,t,1)
				PokeInt trisbank,bankoffset+8 ,f_vert+TriangleVertex(surf,t,2)
				PokeInt trisbank,bankoffset+12,0
				PokeInt trisbank,bankoffset+16,0
				PokeInt trisbank,bankoffset+20,0
			Next	
			
			f_vert = f_vert + n_vert
			f_tris = f_tris + n_tris
		Next
		
	End If

	n_child = CountChildren(entity)
	For c = 1 To n_child
		TOK_MakeCollider(GetChild(entity,c),trisbank,vertbank,True)
	Next
			
	If rec = False
		If vertbank&lt;&gt;0 And trisbank&lt;&gt;0
			f_vert = BankSize(vertbank)/16 
			f_tris = BankSize(trisbank)/24
		
			TOKSIM_SetTerrainMesh vertbank,f_vert,trisbank,f_tris

			FreeBank vertbank
			FreeBank trisbank
		End If
	End If
	
End Function</pre><br>Just use it like this:<pre class=code>bob = LoadAnimMesh("MyAwesomeLevel.b3d")
TOK_MakeCollider(bob)</pre><br>And you're done. :)<br><br>This tokamak stuff rocks! <br><br></td></tr></table><br>
<a name="315540"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sweenie</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#49">[#49]</a></td></tr></table></td></tr><tr ><td class="posttext"> I just want to mention something about the GetPhysicsTime function.<br>You can retrieve different timereports in Tokamak and currently I have set it to RUNNING_AVERAGE.<br>This means that the timevalue you get is not the computiontime for the last frame but instead an average.<br><br>I will let the user choose different timereports in future releases.<br>You will also be able to choose what part of the physics to be measured. Currently it sums all calculations together but you can choose to only get the compution time for jointsolving, bodies, collisions and so on. <br><br></td></tr></table><br>
<a name="315694"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Skitchy</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#50">[#50]</a></td></tr></table></td></tr><tr ><td class="posttext"> How do you connect 2 tokamak objects together in a rigid way? ie. putting legs on a table - one box for the top and 4 for the legs? Sort of like parent/child in Blitz. I've tried usin 3 joints to kind of 'glue' them together, but it doesn't seem to work.<br><br>EDIT : I think I just saw the answer in my head :)<br><br>@Sweenie - What do you think to changing the units so that they match standard Blitz objects? It seems at the moment that 1 Blitz unit=2 Tokamak units. Get's a bit annoying after a while. Could you change the wrapper to compensate? Or am I missing something (again) ;) <br><br></td></tr></table><br>
<a name="315699"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Koriolis</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#51">[#51]</a></td></tr></table></td></tr><tr ><td class="posttext"> You'd probably need to set up constraints, but they are not yet available in the wrapper. Sweenie's working on it. <br><br></td></tr></table><br>
<a name="315875"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bot Builder</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#52">[#52]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>@Sweenie - What do you think to changing the units so that they match standard Blitz objects? It seems at the moment that 1 Blitz unit=2 Tokamak units. Get's a bit annoying after a while. Could you change the wrapper to compensate? Or am I missing something (again) ;) <br></div> How could one blitz unit equal 2 tokomak units? it doesn't matter. that's why there are gravity settings, alowing you to have a large gravity if each unit is a small amount and a small gravity if each unit is a large amount. It all depends on your world scale. bradford6's demo might 'look unrealistic to some' but thats simply because you're imagining it at a different scale. say the demo was inside a little 1 ft. by 1 ft. box. then gravity would be pretty large. if each sphere is the size of a house, then gravity would be alot smaller.<br><br>nice code fredborg :) I assume setting rec prevents it from actually creating a mesh, allowing you to fiddle with it. Why not make the banks and varsglobal? then, on the last entity (or with a seperate command) you could set rec to false and have it write the collision mesh with all the entities you've called with TOK_MakeCollider. Basically, call it multiple times to have multiple meshs added into the collision mesh. <br><br></td></tr></table><br>
<a name="315891"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bot Builder</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#53">[#53]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here's a new version of my code that handles multiple meshes, multiple surfaces, and hierarchal meshs(if you set the recursive parameter to true). :)<br><br><pre class=code>Global vertices=CreateBank(0),triangles=CreateBank(0)
Global offsett,offsetv,tric,ttlvert,ttltris

Function TOK_AddMesh(mesh,recurse=0)
 scount=CountSurfaces(mesh)
 For ind=1 To scount
  surface=GetSurface(mesh,ind)
  ttltris=ttltris+CountTriangles(surface)
  ttlvert=ttlvert+CountVertices(surface)
 Next
 ResizeBank triangles,ttltris*24
 ResizeBank vertices,ttlvert*16
 For ind=1 To scount
  surface = GetSurface(mesh,ind)
  ctr=CountTriangles(surface)
  tric=tric+cvt 
  cvt=CountVertices(surface)
  ;add vertices to bank
  For v=0 To cvt-1 
   TFormPoint VertexX#(surface,v),VertexY#(surface,v),VertexZ#(surface,v),mesh,0
   PokeFloat vertices,offsetv,TFormedX()
   PokeFloat vertices,offsetv+4,TFormedY()
   PokeFloat vertices,offsetv+8,TFormedZ()
   PokeFloat vertices,offsetv+12,0.0
   offsetv=offsetv+16 
  Next
  ;fill bank with triangles 
  For v=0 To ctr-1 
   PokeInt triangles,offsett,tric+TriangleVertex(surface,v,0)
   PokeInt triangles,offsett+4,tric+TriangleVertex(surface,v,1)
   PokeInt triangles,offsett+8,tric+TriangleVertex(surface,v,2)
   PokeInt triangles,offsett+12,0
   PokeInt triangles,offsett+16,0
   PokeInt triangles,offsett+20,0
   offsett=offsett+24
  Next
 Next
 If recurse Then 
  children=CountChildren(mesh)
  If children&gt;0 Then
   For childcount = 1 To children
    child = GetChild(mesh,childcount)
    TOK_AddMesh child  
   Next 
  EndIf
 EndIf
End Function

Function TOK_SetMesh()
 ;Hand over the terrain data to Tokamak
 TOKSIM_SetTerrainMesh vertices,ttlvert,triangles,ttltris
 ; Now we can free the banks as Tokamak has copied all data
 FreeBank vertices
 FreeBank triangles
End Function
</pre> <br><br>To use,  for each mesh you want it to collide with, use the TOK_AddMesh. To make it use all the meshs in the mesh's hierarchy, set 'recursive' to true. Then, when your done adding meshs do 'TOK_SetMesh' to transfer it to tokomak and delete the banks. The globals need to be declared at the start of the proggie. <br><br></td></tr></table><br>
<a name="315937"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Skitchy</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#54">[#54]</a></td></tr></table></td></tr><tr ><td class="posttext"> @bot builder<br>I should have been more specific :) If you create a Blitz cube that is 1 unit in size and attach it to a Tokamak cube that is 1 unit in size you will notice that the 2 don't match. You have to scale the Tokamak cube up by a factor of 2 - at least that's what I've been doing.<br>I agree that the gravity stuff is all relative, but the geometry primitives don't match.<br><br>Anyway, could somebody explain how you would attach 2 objects in a child/parent manner. By that I mean :<br>If you have a beach-ball mesh then you can just match it to a Tokamak sphere and it will work fine. BUT if you have a lollipop mesh you'd need a Tokamak cylinder+sphere. Now, the thing is that there isn't a way (ATM) to offset the sphere so that it sits toward one end of the cylinder. <br>I've tried using 3 joints in a triangular formation and essentially 'glueing' two objects together, but it hasn't worked for me so far.<br><br>I know this can be done because i've seen the Tokamak demos, but having scanned the docs I can't see how to achieve it.<br><br>Having said that, the AddGeometry() command might have something to do with it. Can you actually have 2 arbitrary meshes sent to Tokamak as rigid/animated bodies? Probably not, but would be nice ;) <br><br></td></tr></table><br>
<a name="315954"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bradford6</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#55">[#55]</a></td></tr></table></td></tr><tr ><td class="posttext"> addgeometry() will have to be a tokamak function and sweenie has not implemented that into it yet.<br><br>this would have nothing to do with blitz.<br><br>the best way to think about tokamak is that it is an invisible collision entity and you simply  position and rotate blitz meshes to visually mark it. <br><br></td></tr></table><br>
<a name="316141"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sweenie</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#56">[#56]</a></td></tr></table></td></tr><tr ><td class="posttext"> In the next release you can position and rotate the geometries within the rigidbody.(You can add several geoms to one single body in the v0.1 and v0.2 but you can't position or rotate them)<br>The reason that it isn't implemented yet is because I had some problems with my Euler2Matrix code. But I've got it working now.<br>However, the really tricky part when using several different primitives in one body is to calculate the inertiatensor. For the lollipop you could probably get away with a boxinertiatensor.<br>Maybe someone on this forum knows how to calculate the inertiatensor(a 3-dimensional vector) when it's not a box,sphere or cylinder.<br><br>About the Blitz/Tokamak units.<br>When you create a cube in blitz using CreateCube it's width,height and depth is actually 2.0 because the cube extends from -1.0 to 1.0(Check the blitzdocs)<br>A cube in Tokamak created with 1.0,1.0,1.0 as parameter extends from -0.5 to 0.5 in all axes. <br><br></td></tr></table><br>
<a name="316142"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jeroen</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#57">[#57]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sweenie, your effords bringing Tokamak to Blitz is very much appriciated!!!<br><br>Does Tokamak support rag doll? (in fact, is rag doll just something like assigning parameters to a mesh joint, plus constraints?). Rag doll is not that important comparing to the stuff you already implemented though (it's a hyped feature I think) but it would be nice nevertheless.<br><br>And what about car-like physics? (there are some special physics for those purposes I believe).<br><br>Anyway, thumbs up. <br><br></td></tr></table><br>
<a name="316169"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Skitchy</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#58">[#58]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Sweenie :) That's what I wanted ;)<br><br>Great work! <br><br></td></tr></table><br>
<a name="316192"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >(tu) sinu</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#59">[#59]</a></td></tr></table></td></tr><tr ><td class="posttext"> ragdoll isn't hyped, especially if you apply it right, it's just like any other graphical physics effect.<br><br>Anyone upto doing some ropes physics in tokamak,i'd try but my hands are full for a while. <br><br></td></tr></table><br>
<a name="316203"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >aCiD2</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#60">[#60]</a></td></tr></table></td></tr><tr ><td class="posttext"> im working on some rope physics, going to use rigid bodys on each vertex maybe? something like that, ill give it a try :) <br><br></td></tr></table><br>
<a name="316233"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Midnight</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#61">[#61]</a></td></tr></table></td></tr><tr ><td class="posttext"> Are people using different tokamak.decls? I have no problem running the first few demos by sweenie, but some of the demos posted in the first thread use e.g. CreateSimulator() rather than TOKSIM_CreateSimulator(), and the former is not recognized by my setup.<br><br>Help? <br><br></td></tr></table><br>
<a name="316239"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tom</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#62">[#62]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi all,<br><br>I've moved my reply to the Player Factory forums. I think that these Tokamak threads are specific, popular, and might end up swamping BB forums, so a home of their own seems appropriate :)<br><br>Jeroen: My original reply can be viewed here, thanks!<br><br><a href="http://playerfactory.proboards25.com/index.cgi?board=tokamak&amp;action=display&amp;num=1074960769" target="_blank">http://playerfactory.proboards25.com/index.cgi?board=tokamak&amp;action=display&amp;num=1074960769</a><br><br>Cya!<br>Tom <br><br></td></tr></table><br>
<a name="316257"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AL</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#63">[#63]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Midnight,<br><br>Sweenie has currently released the second version of the wrapper, the changes involved adding the word 'TOK' to all of the commands. The demos posted in the first thread were written with the first version of the wrapper, hence missing the 'TOK' bit. <br><br></td></tr></table><br>
<a name="316266"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >IPete2</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#64">[#64]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey guys, <br><br>for a Bullet Time effect check out my separate post in this forum.<br><br>IPete2. <br><br></td></tr></table><br>
<a name="316382"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >CyBeRGoth</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#65">[#65]</a></td></tr></table></td></tr><tr ><td class="posttext"> I wonder if anyone can solve this?<br><br>Say you have a ball, and you can push it forward using <br>TOKRB_ApplyImpulse OBJECT,X,Y,Z<br><br>This allows you to push the ball, forward, back, left, right<br>but what if you wanted to rotate the ball with the left/right arrows and push it forward with the up arrow key? how could you do this with Tokamak, i tried the rotation commands but still cant get it.  <br>Can someone with some experience post a small demo maybe? <br><br>cheers <br><br></td></tr></table><br>
<a name="316442"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AbbaRue</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#66">[#66]</a></td></tr></table></td></tr><tr ><td class="posttext"> Has anyone tried any type of outdoor terrain with Tok yet?  <br>I was woundering if it is fast at rendering a large terrain. <br>If someone has could you upload a demo of how it's done. <br><br></td></tr></table><br>
<a name="316450"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Robert</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#67">[#67]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I was woundering if it is fast at rendering a large terrain.  <br></div><br><br>Eh? Tokamak doesn't do any rendering at all.  It does physics calculations on meshes. <br><br></td></tr></table><br>
<a name="316458"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AbbaRue</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#68">[#68]</a></td></tr></table></td></tr><tr ><td class="posttext"> Tokamak has Terrain functions.  The web site has a tutorial that creates a terrain. Here is the link:<br><br><a href="http://www.adamdawes.com/programming/tokamak/04_TerrainMesh.html" target="_blank">http://www.adamdawes.com/programming/tokamak/04_TerrainMesh.html</a> <br>I wanted to know how to do this in blitz3d with the Tok interface. <br><br></td></tr></table><br>
<a name="316459"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bot Builder</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#69">[#69]</a></td></tr></table></td></tr><tr ><td class="posttext"> maybe he means doing physics calcs on large terrains. I'm pretty sure its fast enough for most things your going to be doing. certaintly faster than a renderer. If it becomes a problem then you can use a lower triangle equivalent of the render mesh for physics. <br><br></td></tr></table><br>
<a name="316539"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ice9</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#70">[#70]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here's a little sheep herding demo based off of Toms Galloping code. Maybe you coud make the sheep gallop ;)<br><br>Arrow keys move the sheep dog<br><br><pre class=code>
;sheep herder based on Toms code
;Arbitrage



; Joint tests, trying to simulate vehicle axles
;
; I got a galloping car instead hehe
;
; Scouse

Const FPS=50


Graphics3D 800,600,0,2
SetBuffer BackBuffer()

WireFrame False

Const ENTS=200

camera = CreateCamera()
PositionEntity camera,-5,8,-10

TOKSIM_CreateSimulator(ENTS,5,0,-10,0)

ground = CreateCube()
EntityColor ground,5,5,55 
ScaleEntity ground,50,5,50 
PositionEntity ground,0,-5,0
abground = TOKAB_Create()
TOKAB_AddBox(abground,100.0,10.0,100.0)
TOKAB_SetPosition(abground,0.0,-5.0,0.0)

wall1 = CreateCube()
EntityColor wall1,25,25,55 
ScaleEntity wall1,2,10,50 
PositionEntity wall1,50,0,0
abwall1 = TOKAB_Create()
TOKAB_AddBox(abwall1,4.0,20.0,100.0)
TOKAB_SetPosition(abwall1,50.0,0,0.0)

wall2 = CreateCube()
EntityColor wall2,25,25,55 
ScaleEntity wall2,2,10,50 
PositionEntity wall2,-50,0,0
abwall2 = TOKAB_Create()
TOKAB_AddBox(abwall2,4.0,20.0,100.0)
TOKAB_SetPosition(abwall2,-50.0,0,0.0)

wall3 = CreateCube()
EntityColor wall3,25,25,55 
ScaleEntity wall3,50,10,2 
PositionEntity wall3,0,0,-50
abwall3 = TOKAB_Create()
TOKAB_AddBox(abwall3,100.0,20.0,4.0)
TOKAB_SetPosition(abwall3,0.0,0,-50.0)

wall4 = CreateCube()
EntityColor wall4,25,25,55 
ScaleEntity wall4,50,10,2 
PositionEntity wall4,0,0,50
abwall4 = TOKAB_Create()
TOKAB_AddBox(abwall4,100.0,20.0,4.0)
TOKAB_SetPosition(abwall4,0.0,0,50.0)


Dim obj(ENTS)
Dim rb(ENTS)

  obj(1) = CreateCube()
  ScaleEntity obj(1),.5,.5,.5 
  rb(1) = TOKRB_Create()
  TOKRB_AddBox rb(1),1.0,1.0,1.0
  ;TOKRB_CollideConnected rb(1),True
  TOKRB_SetPosition rb(1),0,2,0
  PositionEntity obj(1),0,2,0
  TOKRB_SetLinearDamping rb(1),0.05
  TOKRB_SetAngularDamping rb(1),0.05 	
  TOKRB_SetMass rb(1),2.0
  TOKRB_SetBoxInertiaTensor rb(1),1,1,2,2.0 
Xpos =-20
Zpos =-10
For x = 2 To 200 
	Xpos=Xpos +2
	If Xpos&gt;20
		Zpos=Zpos +2
		Xpos=-20
		If ZPos &gt; 10 Then Zpos=-10
	EndIf
	
	  obj(x) = CreateCube()
	  ScaleEntity obj(x),.5,.5,.5 
	  rb(x) = TOKRB_Create()
	  TOKRB_AddBox rb(x),1.0,1.0,1.0
	  ;TOKRB_CollideConnected rb(1),True
	  TOKRB_SetPosition rb(x),Xpos,2,Zpos
	  PositionEntity obj(x),Xposx,2,Zpos
	  TOKRB_SetLinearDamping rb(x),0.01
	  TOKRB_SetAngularDamping rb(x),0.01 	
	  TOKRB_SetMass rb(x),2.0
	  TOKRB_SetBoxInertiaTensor rb(x),1,1,2,2.0  
Next
  ;obj(i) = CreateCylinder()
  ;rb(i) = TOKRB_Create()
  ;TOKRB_AddCylinder rb(i),2.0,1.0
  ;TOKRB_SetPosition(rb(i),x#,2+i*0.2,z#)
  ;TOKRB_SetAngularDamping rb(i),0.02 
  ;TOKRB_SetLinearDamping rb(i),0.001 
  ;TOKRB_SetMass rb(i),2.0
  ;TOKRB_SetCylinderInertiaTensor rb(i),2.0,1.0,2.0  


 ;EntityColor obj(i),Rnd(100,230),Rnd(100,230),Rnd(100,230) 

  



Centerpivot = CreatePivot()

light=CreateLight()
PositionEntity light,7,15,-5
PointEntity light,Centerpivot

rot#=0

period=1000/FPS
time=MilliSecs()-period

imptime=MilliSecs()
; MainLoop
While Not KeyHit(1)

	Repeat
		elapsed=MilliSecs()-time
	Until elapsed

	ticks=elapsed/period
	tween#=Float(elapsed Mod period)/Float(period)

	For k=1 To ticks
		time=time+period
		If k=ticks Then CaptureWorld

		TOKSIM_Advance(1.0/FPS)

If rot#&gt;360 Then rot#=0

;PositionEntity camera,camx#,40,camz#

PositionEntity camera,EntityX(obj(1)),EntityY(obj(1))+15,EntityZ(obj(1))-+10
PointEntity camera,obj(1)  
	UpdateWorld

	Next

; Not sure wether to put this here or inside the for/next above...
For i=1 To 200
 If TOKRB_IsIdle(rb(i)) Then
  EntityAlpha obj(i),0.5
 Else
  EntityAlpha obj(i),1.0
 EndIf

 PositionEntity obj(i),TOKRB_GetX#(rb(i)),TOKRB_GetY#(rb(i)),TOKRB_GetZ#(rb(i)) 
 RotateEntity obj(i),TOKRB_GetPitch#(rb(i)),TOKRB_GetYaw#(rb(i)),TOKRB_GetRoll#(rb(i)),False
Next

If KeyDown(200) Then
 TOKRB_ApplyImpulse rb(1),0,0,5*ticks
EndIf
If KeyDown(208) Then
 TOKRB_ApplyImpulse rb(1),0,0,-5*ticks
EndIf

If KeyDown(205) Then
 TOKRB_ApplyImpulse rb(1),5*ticks,0,0
EndIf
If KeyDown(203) Then
 TOKRB_ApplyImpulse rb(1),-5*ticks,0,0
EndIf


RenderWorld tween

Text 0,0,"Physics Time:"+TOKSIM_GetPhysicsTime()*1000.0+ " milliseconds"
Text 0,10,"Render Time:"+Str(elapsed)+ " milliseconds"
	Flip False

Wend

TOKSIM_DestroySimulator()

End
</pre> <br><br></td></tr></table><br>
<a name="316617"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bradford6</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#71">[#71]</a></td></tr></table></td></tr><tr ><td class="posttext"> rmb = place rigid body<br>lmb = apply force<br>lmb + ctrl = apply lots of force<br><br>wasd + mouselook t 'fly'<br><br><pre class=code>
;# TOKAMAK DEMO v7 (bradford6)
; Credits:
; SWEENIE for creating the TOKAMAK WRAPPER
; www.tokamakphysics.com to get SDK
; note:
; you must put TOKAMAK.DLL (from SDK) in system32
; must put sweenies tokamak files in blitz3d/userlibs directory
; thanks to fredborg for the maketokcollider func


Graphics3D 800,600,0,2
Global midw = GraphicsWidth()/2
Global midh =GraphicsHeight()/2
SetBuffer BackBuffer()
HidePointer 
WireFrame False

Const ENTS=100	; TOTAL NUMBER OF TOKAMAKPHYSICS ENTITIES
Const FPS=50
Const w=17, s=31, a=30, d=32, space=57

Global campiv = CreatePivot()
Global camera = CreateCamera(campiv)
Global pickmarker = CreateSphere(4)
EntityAlpha pickmarker,.75
Global pictentity,pnx#,pny#,pnz#,pcx#,pcy#,pcz#
Global latspeed#,speed#,MX#,MY#

Global TOKS
CameraClsColor(camera,20,20,205)


TOKSIM_CreateSimulator(ENTS,1,0,-10,0)

; go and create a generic checkerboard texture to apply to the objects
cubetex = create_cube_texture()
spheretex = create_sphere_texture()
cyltex = create_cyl_texture()
worldtex = create_world_texture()



world = CreateCube()
EntityPickMode world,2
sc# = 50
ScaleMesh world,sc#,sc#,sc#
PositionMesh world,0,sc#,0
FlipMesh world
EntityTexture world,worldtex
maketokcollider(world)


Dim obj(ENTS)
Dim rb(ENTS)

SeedRnd MilliSecs()  


; add--------------------------------------------------------------------------


	;create_TOK_BOX(xs#,ys#,zs#,xp#,yp#,zp#,damp#,angdamp#,mass#,iw#,ih#,id#,imass#, texture)
	;create_TOK_BOX(8,1,8,0,5,0,0.0025,.125,4,cubetex)
	xs#=32 iw#=xs#
	ys#=1 ih#=ys#
	zs#=8 id#=zs#	
	mass# = 2 imass# = mass#

	
	
	create_TOK_BOX(xs#,ys#,zs#,0,6,0,0.001,0.002,mass#,8,3,8,imass#,cubetex,"box")

	;create_TOK_BALL(segs,sc#,xp#,yp#,zp#,angdamp#,lindamp#,mass#,IT1#,IT2#)
	; # create tokamak sphere
	create_TOK_BALL(7,4,0,4,-4,0.002,0.001,2.0,1.0,.5,spheretex,"ball")
	create_TOK_BALL(7,4,0,4,4,0.002,0.001,2.0,1.0,.5,spheretex,"ball2")

	;TOKRB_SetTorque(rb(toks),5,0,0)
	joint1 = TOKJOINT_Create(2,rb(toks-2),rb(toks-1))
	TOKJOINT_SetType(joint1,1)
	TOKJOINT_SetPositionWorld(joint1,0,4,-4)
	TOKJOINT_Enable(joint1,True)
	
	joint2 = TOKJOINT_Create(2,rb(toks-2),rb(toks))
	TOKJOINT_SetType(joint2,1)
	TOKJOINT_SetPositionWorld(joint2,0,4,4)
	TOKJOINT_Enable(joint2,True)
	
	;joint3 = TOKJOINT_Create(1,rb(toks),0)
	;TOKJOINT_SetType(joint3,1)
	;TOKJOINT_SetPositionWorld(joint3,0,0,8)
	;TOKJOINT_Enable(joint3,True)

	;joint4 = TOKJOINT_Create(1,rb(toks-1),0)
	;TOKJOINT_SetType(joint4,1)
	;TOKJOINT_SetPositionWorld(joint4,0,0,-8)
	;TOKJOINT_Enable(joint4,True)


	
	;create_TOK_CYL(segs,,height#,radius#,xp#,yp#,zp#,angdamp#,lindamp#,mass#,IT1#,IT2#,IT3#,texture)
	create_TOK_BALL(12,4,0,6,0,0.002,0.001,2.0,1.0,.5,spheretex,"ball3")
	
	
	create_TOK_BOX(4,2,4,0,8,0,0.001,0.002,2,2,2,2,imass#,cubetex,"box2")
	
	create_TOK_BOX(2,2,2,0,8,-4,0.01,0.0002,2,2,2,2,imass#,cubetex,"box3")

			 
   			
	 
	
	
	 


; add--------------------------------------------------------------------------

Centerpivot = CreatePivot()

light=CreateLight()
PositionEntity light,7,15,-5
PointEntity light,Centerpivot

rot#=0

period=600/FPS
time=MilliSecs()-period

imptime=MilliSecs()

camx#=Cos(rot#)*50
camz#=Sin(rot#)*50

;rot#=rot#+0.05

If rot#&gt;360 Then rot#=0

PositionEntity campiv,camx#,40,camz#
PointEntity campiv,centerpivot  


; +++ MAIN LOOP START ++++++ MAIN LOOP START ++++++ MAIN LOOP START ++++++ MAIN LOOP START +++
While Not KeyHit(1)

	Repeat
		elapsed=MilliSecs()-time
	Until elapsed

	ticks=elapsed/period
	tween#=Float(elapsed Mod period)/Float(period)

	For k=1 To ticks
		time=time+period
		If k=ticks Then CaptureWorld

		TOKSIM_Advance(1.75/FPS)

move_camera()

	UpdateWorld

	Next

; Not sure wether to put this here or inside the for/next above...
For i=1 To TOKS
 If TOKRB_IsIdle(rb(i)) Then
  EntityAlpha obj(i),0.5
 Else
  EntityAlpha obj(i),1.0
  TOKRB_Active(rb(i),True)

 EndIf
 
 If EntityName(obj(i)) = "ball"
	; do stuff
 EndIf

 If EntityName(obj(i)) = "box"
	;If MouseDown(2) = 1 Then TOKRB_ApplyTwist(rb(i),0,150,0)
 EndIf

	If MouseDown(2) = 1 Then place_rb(cubetex)

 PositionEntity obj(i),TOKRB_GetX#(rb(i)),TOKRB_GetY#(rb(i)),TOKRB_GetZ#(rb(i)) 
 RotateEntity obj(i),TOKRB_GetPitch#(rb(i)),TOKRB_GetYaw#(rb(i)),TOKRB_GetRoll#(rb(i)),False
Next

If MouseDown(1)=1 Then push_rigid_body()


RenderWorld tween
Color 255,255,255
Text 0,0,"Physics Time:"+TOKSIM_GetPhysicsTime()*1000.0+ " milliseconds"
Text 0,10,"Render Time:"+Str(elapsed)+ " milliseconds"
Text 0,20,"pnx"+pnx#+"  pny "+pny#+"  pnz  "+pnz# 
;Text 0,30,"Render Time:"+Str(elapsed)+ " milliseconds"
Text 0,40,"pitch:"+EntityPitch(campiv)
;Text 0,50,"Render Time:"+Str(elapsed)+ " milliseconds"

Color 255,0,0
Rect midw-4,midh-4,8,8,0
	Flip False

Wend

; == MAIN LOOP END ==== MAIN LOOP End ==== MAIN LOOP End ==== MAIN LOOP End ==== MAIN LOOP End ==


TOKSIM_DestroySimulator()

End

;==================================================================================
Function curvevalue#(newvalue#,oldvalue#,increments# )
	If increments&gt;1 Then oldvalue#=oldvalue#-(oldvalue#-newvalue#)/increments
	If increments&lt;=1 Then oldvalue=newvalue
	Return oldvalue#
End Function
;==================================================================================
Function move_camera()
	; Movement controls
	If KeyDown(w)=1 Then speed# = speed#+.03
	If KeyDown(a)=1 Then latspeed# = latspeed# - .02
	If KeyDown(s)=1 Then speed# = speed# -.03
	If KeyDown(d)=1 Then latspeed# = latspeed# + .02

latspeed#=latspeed#*.98
speed#=speed#*.98

MY#=curvevalue#(MouseYSpeed(),MY#,3 )
MX#=curvevalue#(MouseXSpeed(),MX#,3 )
TurnEntity campiv,MY#,-MX#,0 ; turn camera up and down
;TurnEntity campiv,0,-MX#,0 ;  turn nnn left --right
RotateEntity campiv,EntityPitch(campiv),EntityYaw(campiv),0
If EntityPitch(campiv)&gt;88 Then RotateEntity campiv,88,EntityYaw(campiv),EntityRoll(campiv)
If EntityPitch(campiv)&lt;-88 Then RotateEntity campiv,-88,EntityYaw(campiv),EntityRoll(campiv)

MoveMouse 100,100

MoveEntity campiv,latspeed#,0,speed#
	


End Function
;==================================================================================
Function create_cube_texture()
	tex = CreateTexture(64,64)
	ScaleTexture tex,.5,.5
	SetBuffer TextureBuffer(tex)
		Color 20,20,200
		Rect 0,0,64,64
		Color 255,255,255
		Rect 0,0,32,32
		Rect 32,32,64,64
		Color 0,0,0
		Rect 0,0,64,64,0
	SetBuffer BackBuffer()
	Return tex
	
End Function

Function create_world_texture()
	tex = CreateTexture(128,128)
	ScaleTexture tex,.25,.25
	SetBuffer TextureBuffer(tex)
		Color 100,100,100
		Rect 0,0,128,128
		Color 50,50,50
		Rect 0,0,64,64
		Rect 64,64,128,128
		Color 200,200,0
		Rect 0,0,128,128,0
		

	SetBuffer BackBuffer()
	Return tex
	
End Function

;==================================================================================
Function create_sphere_texture()
	tex = CreateTexture(128,128)
	SetBuffer TextureBuffer(tex)
		Color 0,200,0
		Rect 0,0,128,128
		Color 255,255,0
		Rect 0,0,64,64
		Rect 64,64,128,128
		Color 0,0,0
		Rect 0,0,64,64,0
		Color 0,0,0
		Rect 64,64,128,128,0
		Color 0,0,0
		Rect 0,0,128,128,0
	ScaleTexture tex,.5,.5


	SetBuffer BackBuffer()
	Return tex

	
End Function

;==================================================================================
Function create_cyl_texture()
	tex = CreateTexture(128,128)
	SetBuffer TextureBuffer(tex)
		Color 0,0,0
		Rect 0,0,128,128
		Color 255,0,0
		Rect 0,0,64,64
		Rect 64,64,128,128
	SetBuffer BackBuffer()
	Color 255,255,0 ; YELLOW
	Return tex

	
End Function

;==================================================================================
Function campick()
	pictentity = 0
	CameraPick(camera,midw,midh)
	pictentity = PickedEntity() 
	If Pictentity&lt;&gt;0
		
		;EntityAlpha pictentity,.7	
		pnx# = PickedNX#()
		pny# = PickedNY#()
		pnz# = PickedNZ#()	
		pcx# = PickedX#()
		pcy# = PickedY#()
		pcz# = PickedZ#()

	
	EndIf
	

End Function

Function create_TOK_BOX(xs#,ys#,zs#,xp#,yp#,zp#,damp#,angdamp#,mass#,iw#,ih#,id#,imass#,texture,name$)

			TOKS = TOKS+1
			If TOKS&gt;ENTS 
				TOKS = ENTS
				Return
			EndIf
			obj(TOKS) = CreateCube()
			NameEntity obj(toks),name$
			ScaleEntity obj(TOKS),xs#/2,ys#/2,zs#/2
			EntityPickMode obj(TOKS),2
			EntityTexture obj(TOKS),texture
			rb(TOKS) = TOKRB_Create()
			TOKRB_SetSleepingParameter(rb(TOKS),-100)
			TOKRB_AddBox rb(TOKS),xs#,ys#,zs#
			TOKRB_SetPosition(rb(TOKS),xp#,yp#,zp#)
			TOKRB_SetLinearDamping rb(TOKS),damp#
			TOKRB_SetAngularDamping rb(TOKS),angdamp# 

			TOKRB_SetMass rb(TOKS),mass#
			TOKRB_SetBoxInertiaTensor rb(TOKS),iw#,ih#,id#,imass# 
			
			

End Function

Function create_TOK_BALL(segs,sc#,xp#,yp#,zp#,angdamp#,lindamp#,mass#,IT1#,IT2#,texture,name$)
			  TOKS = TOKS+1
			  
				If TOKS&gt;ENTS 
					TOKS = ENTS
					Return
				EndIf
	
			
				obj(TOKS) = CreateSphere(segs)
				NameEntity obj(toks),name$

			  ScaleEntity obj(TOKS),sc#/2,sc#/2,sc#/2
			  EntityPickMode obj(TOKS),2

			  EntityTexture obj(TOKS),texture
			  rb(TOKS) = TOKRB_Create()
			  TOKRB_AddSphere rb(TOKS),sc#
			  TOKRB_SetPosition(rb(TOKS),xp#,yp#,zp#)
			  TOKRB_SetAngularDamping rb(TOKS),angdamp# 
			  TOKRB_SetLinearDamping rb(TOKS),lindamp#
			  TOKRB_SetMass rb(TOKS),mass#
			  TOKRB_SetSphereInertiaTensor rb(TOKS),IT1#,IT2#  
End Function



Function create_TOK_CYL(segs,height#,radius#,xp#,yp#,zp#,angdamp#,lindamp#,mass#,IT1#,IT2#,IT3#,texture)

			TOKS = TOKS+1
			  
				If TOKS&gt;ENTS 
					TOKS = ENTS
					Return
				EndIf
			
			obj(TOKS) = CreateCylinder(segs)
 				EntityPickMode obj(TOKS),2
  			 EntityTexture obj(TOKS),texture
			  rb(TOKS) = TOKRB_Create()
			  TOKRB_AddCylinder rb(TOKS),height#,radius#
			  ScaleEntity obj(TOKS),radius#/1.95,height#,radius#/1.95
			  TOKRB_SetPosition(rb(TOKS),xp#,yp#,zp#)
			  TOKRB_SetAngularDamping rb(TOKS),angdamp# 
			  TOKRB_SetLinearDamping rb(TOKS),lindamp#
			  TOKRB_SetMass rb(TOKS),mass#
			  TOKRB_SetCylinderInertiaTensor rb(TOKS),IT1#,IT2#,IT3#  
End Function
;==================================================================================

Function place_rb(tex)
	
		campick()
		If pictentity&gt;0
			PositionEntity pickmarker,pcx#,pcy#,pcz#
			;create_TOK_BOX(xs#,ys#,zs#,xp#,yp#,zp#,damp#,angdamp#,mass#,iw#,ih#,id#,imass#,texture,name$)
	
			create_TOK_BOX(4,4,4,pcx#,pcy#+2,pcz#,0.001,0.002,2,4,4,4,2,tex,"foo")
			Repeat : Until MouseDown(2) = 0
	 	EndIf
End Function
		
;==================================================================================



;==================================================================================

Function push_rigid_body()
	
		campick()
	 	For n = 1 To TOKS
			If pictentity = obj(n)
				i = n
				
				If KeyDown(29) Or KeyDown(157)
				
					TOKRB_ApplyImpulse2 rb(i),-pnx#*15,-pny#*15,-pnz#*15,pcx#,pcy#,pcz# 
				Else
					TOKRB_ApplyImpulse2 rb(i),-pnx#,-pny#,-pnz#,pcx#,pcy#,pcz# 				;TOKRB_ApplyImpulse rb(i),-pnx#,pny#,-pnz#
				EndIf
			EndIf
		Next		
End Function
		
;==================================================================================


Function MakeTokCollider(mesh)
 scount=CountSurfaces(mesh)
 For ind=1 To scount
  surface=GetSurface(mesh,ind)
  ttltris=ttltris+CountTriangles(surface)
  ttlvert=ttlvert+CountVertices(surface)
 Next
 vertices=CreateBank(16*ttlvert)
 triangles=CreateBank(24*ttltris)
 offsetv=0
 offsett=0
 For ind=1 To scount
  surface = GetSurface(mesh,ind)
  ctr=CountTriangles(surface)
  tric=tric+cvt
  cvt=CountVertices(surface)
  ;fill bank with vertices
  For v=0 To cvt-1
   PokeFloat vertices,offsetv,VertexX#(surface,v)
   PokeFloat vertices,offsetv+4,VertexY#(surface,v)
   PokeFloat vertices,offsetv+8,VertexZ#(surface,v)
   PokeFloat vertices,offsetv+12,0.0
   offsetv=offsetv+16
  Next
  ;fill bank with triangles
  For v=0 To ctr-1
   PokeInt triangles,offsett,tric+TriangleVertex(surface,v,0)
   PokeInt triangles,offsett+4,tric+TriangleVertex(surface,v,1)
   PokeInt triangles,offsett+8,tric+TriangleVertex(surface,v,2)
   PokeInt triangles,offsett+12,0
   PokeInt triangles,offsett+16,0
   PokeInt triangles,offsett+20,0
   offsett=offsett+24
  Next
 Next
 ;Hand over the terrain data to Tokamak
 TOKSIM_SetTerrainMesh vertices,ttlvert,triangles,ttltris
 ; Now we can free the banks as Tokamak has copied all data
 FreeBank vertices
 FreeBank triangles
End Function
</pre> <br><br></td></tr></table><br>
<a name="316785"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >(tu) sinu</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#72">[#72]</a></td></tr></table></td></tr><tr ><td class="posttext"> maybe a dumb question but can we now use tokamak for collisions instead of blitz ones? <br><br></td></tr></table><br>
<a name="316816"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >aCiD2</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#73">[#73]</a></td></tr></table></td></tr><tr ><td class="posttext"> yea, no reason why not. :) but, there is no way to make a rigid body have something like tokrb_addmesh ... <br><br></td></tr></table><br>
<a name="316833"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AbbaRue</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#74">[#74]</a></td></tr></table></td></tr><tr ><td class="posttext"> I was wondering if someone could rewrite the demo file at: <br><a href="http://www.adamdawes.com/programming/tokamak/04_TerrainMesh.html" target="_blank">http://www.adamdawes.com/programming/tokamak/04_TerrainMesh.html</a> <br>So it will work in Blitz3d. <br><br></td></tr></table><br>
<a name="316870"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bot Builder</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#75">[#75]</a></td></tr></table></td></tr><tr ><td class="posttext"> Haven't we allready? all you need to do is pop in a terrain mesh along with a bunch of spheres. check out the latest version of bradford's demo. <br><br></td></tr></table><br>
<a name="316872"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DarkEagle</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#76">[#76]</a></td></tr></table></td></tr><tr ><td class="posttext"> hey sweenie, do you plan on implenting constraints/collision respone info anytime soon? <br><br></td></tr></table><br>
<a name="316892"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tom</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#77">[#77]</a></td></tr></table></td></tr><tr ><td class="posttext"> Lots of stuff in the works :)<br><br><a href="http://www.blitzbasic.com/logs/userlog.php?user=285" target="_blank">http://www.blitzbasic.com/logs/userlog.php?user=285</a> <br><br></td></tr></table><br>
<a name="317212"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#78">[#78]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi im a bit of a newb to all this, in my game I have a limit of 200 entities before my game starts to slow down but in a demo of TOKAMAK physics it could only handle 100 rigid bodies before it slowed down.<br>Would it be wise for me to used TOKAMAK with my game?? <br><br></td></tr></table><br>
<a name="317218"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tom</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#79">[#79]</a></td></tr></table></td></tr><tr ><td class="posttext"> Depends on how complex the simulation is, or what spec PC you run the game on?<br><br>As with general graphics detail, scale the amount of realtime physics used based on a 'low, medium, high' setting.<br><br>Even 20 realistic moving entities would be better than none :)<br><br>Tom <br><br></td></tr></table><br>
<a name="317223"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bot Builder</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#80">[#80]</a></td></tr></table></td></tr><tr ><td class="posttext"> I believe the only prob. with 200 entities is memory use. if that's just a precaution, and the entity level isn't likely to go up to that then you should have no prob.  And also, 200 entities isn't to unreasonable. Most of your time is lost in rendering those 200 entitities, which is probably one of the reasons the Tokamak demos are slow.  If your game requires physics, then you aren't gonna get much faster without creating a dll in some other lang(C most likely). <br><br></td></tr></table><br>
<a name="317228"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#81">[#81]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ive got a slow system 600MHZ and 64MB of ram with onboard graphics, All I need to know is , is Tokamak faster at doing collisions and reactions to collisions?? Or is it just easier to program with Tokamak. <br><br></td></tr></table><br>
<a name="317229"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bradford6</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#82">[#82]</a></td></tr></table></td></tr><tr ><td class="posttext"> slenkar,<br>the best way to answer your question is to test it yourself.  here is what I would do.<br><br>create a tokamak simulation with 1000 rigid bodies.<br>do not render the blitz entities and see how fast it is.<br><br><br>my observations:<br><br>the number of polygons is not the confounding factor. in fact, you could have a single surface mesh with 100,000 polygons render at a reasonable rate.<br><br>the bottleneck seems to be:<br>1. materials: the number of surfaces and textures<br>2. entity count. the number of entities<br><br>to have a great looking scene, I recommend using fewer entities with fewer materials. use your polygons to add detail, rather than extra texturemaps. <br><br></td></tr></table><br>
<a name="317255"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LostCargo</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#83">[#83]</a></td></tr></table></td></tr><tr ><td class="posttext"> i guess a better question is the collision setup better than blitz3d? <br><br></td></tr></table><br>
<a name="317263"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bot Builder</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#84">[#84]</a></td></tr></table></td></tr><tr ><td class="posttext"> Depends on how you look at it. seems to me that tokamak has a better collision setup as far as functions cause it does oriented capsules, boxes, and spheres. however, there are some problems with falling through terrains every once in a while :( <br><br></td></tr></table><br>
<a name="317463"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sweenie</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#85">[#85]</a></td></tr></table></td></tr><tr ><td class="posttext"> The reason bodies fall through a terrain is mostly due to high velocities combined with high timesteps.<br>So either increase accuracy by using smaller timesteps or lower your velocities.<br>Animated bodies doesn't suffer as much of this as an animated body has some volume/thickness while a terrain triangle has no volume/thickness at all.<br><br>Tokamaks collisionssystem doesn't perform any sweep-tests so if a body is just above a terrain triangle at one frame and in the next frame it passes completely through, Tokamak won't detect any collision.<br><br>I guess the bodies can fall through an animated body too if it's very very thin.<br><br>One way to make sure that bodies doesn't reach too high velocities is to set the lineardamping a little higher, but not too much or the body will seem like it's falling through water.<br>And remember that gamephysics doesn't necessarily need to be realistic, just look realistic. <br><br></td></tr></table><br>
<a name="317641"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bradford6</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#86">[#86]</a></td></tr></table></td></tr><tr ><td class="posttext"> the beauty of Tokamak is that it is configurable.  You can be super-realistc or do a best effort simulation that trades accuracy for performance.  If it looks ight, then it is right.  We arent building satellites here.<br><br>the only time i see an RB fall through the world is when it is going extremely fast (like sweenie said) ask yourself, How fast do my rigid bodies need to go? <br><br></td></tr></table><br>
<a name="317677"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LostCargo</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#87">[#87]</a></td></tr></table></td></tr><tr ><td class="posttext"> i guess its not a good idea to do bullets with tokamak. i mean calculating richochets and bullet deformation... not something that really matters. lol <br><br></td></tr></table><br>
<a name="317694"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bradford6</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#88">[#88]</a></td></tr></table></td></tr><tr ><td class="posttext"> bullets, no but cannonballs and lower velocity projectiles work great. <br><br></td></tr></table><br>
<a name="317779"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sweenie</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#89">[#89]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, jointlimits and some other new functions are implemented.<br>Let's make some ragdolls!<br><br>Get the update at my page.<br>www.freewebs.com/sweenie <br><br></td></tr></table><br>
<a name="317787"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >aCiD2</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#90">[#90]</a></td></tr></table></td></tr><tr ><td class="posttext"> smoooooooth :D <br><br></td></tr></table><br>
<a name="317816"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RetroBooster</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#91">[#91]</a></td></tr></table></td></tr><tr ><td class="posttext"> great :) <br><br></td></tr></table><br>
<a name="317823"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RayTracer</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#92">[#92]</a></td></tr></table></td></tr><tr ><td class="posttext"> wicked <br><br></td></tr></table><br>
<a name="317852"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bot Builder</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#93">[#93]</a></td></tr></table></td></tr><tr ><td class="posttext"> saweet!  yay. jointlimits..... I assume it's backwards compatible? <br><br></td></tr></table><br>
<a name="317855"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tom</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#94">[#94]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sweenie:<br><br>Great work !!!!!!!!!!1<br><br>Cheers<br>Tom <br><br></td></tr></table><br>
<a name="317863"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bradford6</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#95">[#95]</a></td></tr></table></td></tr><tr ><td class="posttext"> AWESOME Sweenie!!!<br><br>bot. it is not backwards compatible, but I was able to fix my code in about 10 minutes.<br>just fix onr thing and run....blitz will tell you what you need to fix. <br><br></td></tr></table><br>
<a name="317866"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rimmsy</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#96">[#96]</a></td></tr></table></td></tr><tr ><td class="posttext"> did you restart your blitz ide? <br><br></td></tr></table><br>
<a name="317888"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bradford6</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#97">[#97]</a></td></tr></table></td></tr><tr ><td class="posttext"> yes. restart the ide after you put the wrapper in your userlibs. (it gets the highlighting from the decls) <br><br></td></tr></table><br>
<a name="317913"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bot Builder</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#98">[#98]</a></td></tr></table></td></tr><tr ><td class="posttext"> yeah... I didn't see the front page :) no biggy. <br><br></td></tr></table><br>
<a name="317935"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tom</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#99">[#99]</a></td></tr></table></td></tr><tr ><td class="posttext"> ragdoll demos up!<br><br>Unfortunately I only have about 45 meg of bandwidth left on my webby and my ISP webspace is flakey, so if anyone can mirror the file until I sort my webby out, please feel free!<br><br><a href="http://www.tomspeed.com/RagOrkDemos.zip" target="_blank">http://www.tomspeed.com/RagOrkDemos.zip</a><br><br>Cursors plus what's on screen to interact, also in demo 2 'v' toggles rigidbody visibility.<br><br>There's no reset in it 'yet'.<br><br>cya!<br>Tom <br><br></td></tr></table><br>
<a name="317941"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bouncer</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#100">[#100]</a></td></tr></table></td></tr><tr ><td class="posttext"> That's really cool... <br><br></td></tr></table><br>
<a name="317948"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bradford6</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#101">[#101]</a></td></tr></table></td></tr><tr ><td class="posttext"> very cool,<br>can you show us the source? <br><br></td></tr></table><br>
<a name="317950"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dangerdave</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#102">[#102]</a></td></tr></table></td></tr><tr ><td class="posttext"> Good stuff Tom!<br>What did you use to model the Ork?<br>How did you get the data that you needed?<br><br>====================<br>NOTE: I uploaded Tom's demo to my site!<br><br>Please go to <a href="http://www.stewartsoftware.ca/downloads/RagOrkDemos.zip" target="_blank">http://www.stewartsoftware.ca/downloads/RagOrkDemos.zip</a> <br><br></td></tr></table><br>
<a name="317963"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bot Builder</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#103">[#103]</a></td></tr></table></td></tr><tr ><td class="posttext"> fantastic. I really like the second one. nice orc aswell. great anims :P.<br><br>codez? or should I email you? <br><br></td></tr></table><br>
<a name="317983"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tom</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#104">[#104]</a></td></tr></table></td></tr><tr ><td class="posttext"> bradford, bot builder:<br><br>I'm working on an basic editor for setting up rigs, and I've learnt a few things on the way. The editor is simple, is suited to editing data for 'runtime ragdoll creation', and works like so:<br><br>Load your animated B3D file.<br><br>Default box type rigid bodies are added to each bone, and a small sphere at the Bones base position. (to aid in picking joint positions).<br><br>To simplify a rig, delete any rigid bodies you don't need. This works fine as later on when setting up the ragdoll at runtime, any Bone that has an associated rigidbody gets unparented (it needs to be unparented because it's positon/rotation is controled by the RigidBody it's associated to), but those without will remain parented. i.e You may decide hands may not need to be animated by the ragdoll, so they remain parented to the forearm, which will be animated by the ragdoll.<br><br>Switch to a Joint setup mode, using the left &amp; right mouse buttons, select 2 rigidbodies, then while holding a key, click on the Bone sphere to set the joints world position.<br><br>Resize &amp; change the rigidbody types interactively to best fit your model.<br><br>Save out the rigidbody &amp; joint data, done!<br><br>There's some other stuff I need to add like limits, and setting a joint frame world (as soon as Sweenie explain how the hell it works! hehe)<br><br><br>If you can bear to read the following...<br><br>As I understand it, the basic joint creation command automaticaly sets up the alignment of your joints 'cone limits' based on the rotation of the rigid body at the time you create the joint (phew!), while this is a nice feature it may not be appropriate for creating ragdolls on the fly (as in the demo).<br><br>The reason being, in the editor, the default pose of your character is used while editing. Imagine the arms are in a classic  'T' pose, looking at that, you'll want the arms to have free movement of about 45 degrees up/down/front/back coming off the shoulder, right?<br><br>But what if you characters arm is pointing down to it's side as you initialise a ragdoll setup at runtime?...then, the alignment of the 'cone limits' axis will be down too, so the arms will never be able to move above above the shoulders, hmm :|<br><br>That's where (I think) the FrameWorldA .. B commands are used. With those, you can define the Axis the limits will apply from.<br><br>I guess I could have said that the default joint creation command creates its limits on an Axis 'local to the Bone/rigidbody' :)<br><br>Sweenie please correect me if I'm wrong!<br><br>dangerdave:<br>I used Lightwave to model &amp; animate the Ork. and thanks for mirroring the demo! :)<br><br>Editor will be out in a few days!<br><br>Cya!<br>Tom<br><br>Freelance 3D Artist, full time dad. <br><br></td></tr></table><br>
<a name="317989"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tom</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#105">[#105]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sweenie:<br><br>I'm wondering if the CollideConnected command does actualy tell a rigid body that it CAN collide with direct neighbours?<br><br>I was sure I read that can't happen on the Tokamak forums but If I have it set to True for joints in my ragdolls, they just fly off the screen like superman as soon as I activate them :)<br><br>Some of the ragdoll rigid bodys in my demo above do intersect slightly, so I'm guessing that's what's happening. Any ideas?<br><br>Tom <br><br></td></tr></table><br>
<a name="318003"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mustang</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#106">[#106]</a></td></tr></table></td></tr><tr ><td class="posttext"> Gheeeez Tom! Those Orc demos were really mind blowing! I have missed the whole Tokamak-thingy because I've been so busy otherwise... this was the first Tokamak-demo I tried and it RULES! Sure could use something like this in my game too... now I have to read every god damn post regarding Tokamak... and there's quite a few of them! Any schedule / ETA when you have working editor, Tom?<br><br>[edit]<br><br><div class="quote"> Editor will be out in a few days! <br></div><br><br>Ah - Cool! :) <br><br></td></tr></table><br>
<a name="318012"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sweenie</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#107">[#107]</a></td></tr></table></td></tr><tr ><td class="posttext"> To tell you the truth I haven't quite grasped how the limits work either.<br>It's very hard to visualise them in your head, but I was hoping your editor would fix that. ;)<br><br>I think I understand what you mean regarding the arm, and I do think you're right about the SetJointPositionFrameA &amp; B.<br>In your case FrameA is the shoulder and Frame B is the arm.<br>FrameA can have the same rotation, but FrameB should have an initial rotation of 45 degrees to compensate for the arm being down.<br>I just realized that I forgot to implement rotation of FrameA&amp;B.<br>Will fix this tonight. <br><br></td></tr></table><br>
<a name="318029"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sweenie</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#108">[#108]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Some of the ragdoll rigid bodys in my demo above do intersect slightly, so I'm guessing that's what's happening. Any ideas? <br> <br></div><br><br>I've never managed to get direct neighbours to collide but if two bodies that are not directly neighbours are brought together somehow with joints causing them to intersect, there will be a struggle between the collisionsystem and the jointsolver.<br>The collision will try to push them apart while the joints try to bring them together and eventually you will get a rigidbody "explosion". <br><br></td></tr></table><br>
<a name="318056"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >CyBeRGoth</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#109">[#109]</a></td></tr></table></td></tr><tr ><td class="posttext"> Cool update!<br><br>Would any of the new commands help me with my rotating ball problem? You know so you can rotate a ball left or right (yaw) and have it move forward in the direction it is facing?  Someone sudgested Tformvector but thats maths.. and me and maths dont add up :<br><br>Cheers<br><br>ps.. someone make a ball demo where the arrow keys are used to rotate the ball.... go on :P <br><br></td></tr></table><br>
<a name="318088"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >simonh</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#110">[#110]</a></td></tr></table></td></tr><tr ><td class="posttext"> Try rotating the mesh with RotateMesh, and then just moving the entity.<br><br>Amazing demo by the way Tom and great work with the new update Sweenie! <br><br></td></tr></table><br>
<a name="318102"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bradford6</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#111">[#111]</a></td></tr></table></td></tr><tr ><td class="posttext"> Car demo.  still very buggy. use arrows to drive. you can move the camera around with wasd + mouse<br><br>this is a car made from a box with cylinders attached to the rear wheels with hingjoints and independent axles on the front.  the front wheels go a little buggy every now and again.<br><br>have a look...(this is v3 wrapper code)<br><br><br><pre class=code>
;# TOKAMAK car DEMO v0.0017 (bradford6)
; Credits:
; SWEENIE for creating the TOKAMAK WRAPPER
; www.tokamakphysics.com to get SDK
; note:
; you must put TOKAMAK.DLL (from SDK) in system32
; must put sweenies tokamak files in blitz3d/userlibs directory
; this is rev -1 so it is very early and probably buggy, 


Graphics3D 800,600,0,2
Global midw = GraphicsWidth()/2
Global midh =GraphicsHeight()/2
SetBuffer BackBuffer()
HidePointer 
WireFrame False

Const ENTS=100	; TOTAL NUMBER OF TOKAMAKPHYSICS ENTITIES
Const FPS=50
Const w=17, s=31, a=30, d=32, space=57

Global campiv = CreatePivot()
Global camera = CreateCamera(campiv)
Global pickmarker = CreateSphere(4)
EntityAlpha pickmarker,.75
Global pictentity,pnx#,pny#,pnz#,pcx#,pcy#,pcz#
Global latspeed#,speed#,MX#,MY#

Global TOKS
CameraClsColor(camera,0,0,0)


TOKSIM_CreateSimulator(ENTS,1,0,-10,0)

; go and create a generic checkerboard texture to apply to the objects
cubetex = create_cube_texture()
spheretex = create_sphere_texture()
cyltex = create_cyl_texture()
worldtex = create_world_texture()


world = CreateCube()
;world = LoadMesh("roadmap2.3ds")
EntityPickMode world,2
sc# = 50
ScaleMesh world,sc#,sc#,sc# : PositionMesh world,0,sc#,0 : FlipMesh world : EntityTexture world,worldtex
obstacle = CreateCube() : EntityTexture obstacle,cyltex : ScaleMesh obstacle,5,10,10 : PositionMesh obstacle,-10,16,0
RotateMesh obstacle ,0,0,65 : AddMesh obstacle,world

obstacle2 = CreateSphere(6) : EntityTexture obstacle2,cubetex : ScaleMesh obstacle2,10,4,10 : PositionMesh obstacle2,32,-1,30
RotateMesh obstacle2 ,0,0,0 : AddMesh obstacle2,world


maketokcollider(world)
;maketokcollider(obstacle)

Dim obj(ENTS)
Dim rb(ENTS)

SeedRnd MilliSecs()  


; add--------------------------------------------------------------------------

.cardata
	;create_TOK_BOX(xs#,ys#,zs#,xp#,yp#,zp#,damp#,angdamp#,mass#,iw#,ih#,id#,imass#, texture)
	;create_TOK_BOX(8,1,8,0,5,0,0.0025,.125,4,cubetex)
	carwidth#=2 iw#=carwidth#
	carheight#=4 ih#=carheight#
	carlength#=4 id#=carlength#	
	mass# = .5 imass# = mass#
	
	wheelwidth# = 2.5
	wheellength# = 3.5
	wheelclearance# = 2
	wheelheight# = 0.5 ; thickness
	wheeldiameter# = 4 ; tall-ness
	carx# = 2
	cary# = 5
	carz# = 2
	
	; OBJ-1
	create_TOK_BOX(carwidth#,carheight#,carlength#,carx#,cary#,carz#,0.001,0.001,mass#,iw,ih,id,imass,cubetex,"car")

	;create_TOK_BALL(segs,sc#,xp#,yp#,zp#,angdamp#,lindamp#,mass#,IT1#,IT2#)
	; # create tokamak sphere
	
	; ----------------------------------------------------------------------------------

	id#=2
	ih#=3
	iw#=1
	;zs#=1 id#=zs#	
	mass# = 1
	imass# = 1
	
	rearwheelmass# = 3
	angdampfront#= 0.002
	angdamprear# = 0.001
	lindampfront# = 0.002
	lindamprear# = 0.001
	segs = 16
	
	axleiw#=1 axleih#=0.25 axleid#=1 
	
	axlemass# = 1.5
	axleimass# = 1.5
For c = 1 To 4
	Select c
		Case 1 : cx# = carx#-(carwidth#/1.5) : cy# = cary#-(carheight#/2) : cz# = carz#+(carlength#/1.5) : wheelname$ = "leftfront" : inc = 1
					
					; obj 2
					create_TOK_BOX(1.5,.5,1,cx#,cy#,cz#,0.001,0.01,axlemass#,axleiw,axleih,axleid,axleimass,cubetex,"car")

					;obj 3
					create_TOK_CYL(segs,wheeldiameter#,wheelheight#,cx#-1,cy#,cz#,angdampfront#,lindampfront#,mass#,Id#,ih#,imass#,spheretex,wheelname$)
					;create_TOK_ball(segs,wheeldiameter#,cx#-1,cy#,cz#,angdampfront#,lindampfront#,mass#,Id#,imass#,spheretex,wheelname$)
					

					;create_TOK_ball(5,wheelsize#,carx#-wheelheight#,cary#-wheelwidth#,carz#+wheellength#,angdamp#,lindamp#,mass#,Id#,imass#,spheretex,"leftfront")
					EntityColor obj(2),155,0,0 
					EntityColor obj(3),255,0,0 ; red = 
					TOKRB_SetRotation(rb(toks),0,00,90)
					;TOKRB_SetTorque(rb(toks),5,0,0)
					
					; axle
					joint1a = TOKJOINT_Create(2,rb(1),rb(2))
					TOKJOINT_SetType(joint1a,3)
					TOKJOINT_SetPositionAndRotationWorld(joint1a,cx#,cy#,cz#,0,0,0)
					TOKJOINT_Enable(joint1a,True)
					TOKJOINT_SetLowerLimit joint1a,-3.14*0.50 ; (-45 degrees)
					TOKJOINT_SetUpperLimit joint1a,3.14*0.50  ; (+45 degrees)
					TOKJOINT_EnableLimit joint1a,True  

					; wheel
					joint1b = TOKJOINT_Create(2,rb(2),rb(3))
					TOKJOINT_SetType(joint1b,3)
					TOKJOINT_SetPositionAndRotationWorld(joint1b,cx#-1,cy#,cz#,0,0,90)
					TOKJOINT_Enable(joint1b,True)
					TOKJOINT_SetJointLength(Joint1b,3)
					TOKJOINT_SetLowerLimit2 joint1b,-3.14*0.1 ; (-45 degrees)
					TOKJOINT_SetUpperLimit2 joint1b,3.14*0.1  ; (+45 degrees)
					TOKJOINT_EnableLimit2 joint1b,True  

		Case 2 : cx# = carx#+(carwidth#/1.5) : cy# = cary#-(carheight#/2) : cz# = carz#+(carlength#/1.5) : wheelname$ = "rightfront" : inc = 2
					
					
					; obj 4
					create_TOK_BOX(1.5,.5,1,cx#,cy#,cz#,0.001,0.01,axlemass#,axleiw,axleih,axleid,axleimass,cubetex,"car")

					; obj 5
					create_TOK_CYL(segs,wheeldiameter#,wheelheight#,cx#+1,cy#,cz#,angdampfront#,lindampfront#,mass#,Id#,ih#,imass#,spheretex,wheelname$)
					;create_TOK_ball(segs,wheeldiameter#,cx#+1,cy#,cz#,angdampfront#,lindampfront#,mass#,Id#,imass#,spheretex,wheelname$)
					

					;create_TOK_ball(5,wheelsize#,carx#-wheelheight#,cary#-wheelwidth#,carz#+wheellength#,angdamp#,lindamp#,mass#,Id#,imass#,spheretex,"leftfront")
					EntityColor obj(4),0,255,0 ; green= 
					EntityColor obj(5),0,120,0
					TOKRB_SetRotation(rb(toks),0,00,90)
					;TOKRB_SetTorque(rb(toks),5,0,0)
					
					; axle
					joint2a = TOKJOINT_Create(2,rb(1),rb(4))
					TOKJOINT_SetType(joint2a,3)
					TOKJOINT_SetPositionAndRotationWorld(joint2a,cx#,cy#,cz#,0,0,0)
					TOKJOINT_Enable(joint2a,True)
					TOKJOINT_SetLowerLimit joint2a,-3.14*.5 ; (-45 degrees)
					TOKJOINT_SetUpperLimit joint2a,3.14*0.5  ; (+45 degrees)
					TOKJOINT_EnableLimit joint2a,True  

					; wheel
					joint2b = TOKJOINT_Create(2,rb(4),rb(5))
					TOKJOINT_SetType(joint2b,3)
					TOKJOINT_SetPositionAndRotationWorld(joint2b,cx#+1,cy#,cz#,0,0,90)
					TOKJOINT_Enable(joint2b,True)
					TOKJOINT_SetJointLength(Joint2b,.1)
					TOKJOINT_SetLowerLimit2 joint2b,-3.14*0.1 ; (-45 degrees)
					TOKJOINT_SetUpperLimit2 joint2b,3.14*0.1  ; (+45 degrees)
					TOKJOINT_EnableLimit2 joint2b,True  


	

		Case 3 : cx# = carx#-(carwidth#) : cy# = cary#-(carheight#/2) : cz# = carz#-(carlength#/1.5) : wheelname$ = "leftrear" : inc = 3
					; obj 6
					create_TOK_CYL(segs,wheeldiameter#,wheelheight#,cx#,cy#,cz#,angdamprear#,lindamprear#,rearwheelmass#,Id#,ih#/2,rearwheelmass#*2,spheretex,wheelname$)
					;create_TOK_ball(segs,wheeldiameter#,cx#,cy#,cz#,angdampfront#,lindampfront#,mass#,Id#,imass#,spheretex,wheelname$)
					

					EntityColor obj(6),255,0,0 ; blue= 
					TOKRB_SetRotation(rb(toks),0,00,90)
					;TOKRB_SetTorque(rb(toks),5,0,0)
					joint3 = TOKJOINT_Create(2,rb(1),rb(6))
					TOKJOINT_SetType(joint3,3)
					TOKJOINT_SetPositionAndRotationWorld(joint3,cx#,cy#,cz#,0,0,90)
					TOKJOINT_Enable(joint3,True)
	

		Case 4 : cx# = carx#+(carwidth#) : cy# = cary#-(carheight#/2) : cz# = carz#-(carlength#/1.5) : wheelname$ = "rightrear" : inc = 4
					; obj 7
					create_TOK_CYL(segs,wheeldiameter#,wheelheight#,cx#,cy#,cz#,angdamprear#,lindamprear#,rearwheelmass#,Id#,ih#/2,rearwheelmass#*2,spheretex,wheelname$)
					;create_TOK_ball(segs,wheeldiameter#,cx#,cy#,cz#,angdampfront#,lindampfront#,mass#,Id#,imass#,spheretex,wheelname$)
					

					
					EntityColor obj(7),255,0,0 ; yellow= 
					TOKRB_SetRotation(rb(toks),0,00,90)
					;TOKRB_SetTorque(rb(toks),5,0,0)
					joint4 = TOKJOINT_Create(2,rb(1),rb(7))
					TOKJOINT_SetType(joint4,3)
					TOKJOINT_SetPositionAndRotationWorld(joint4,cx#,cy#,cz#,0,0,90)
					TOKJOINT_Enable(joint4,True)
	

	
	End Select
	
	

Next
	; ----------------------------------------------------------------------------------

For columns = 1 To 4
	For rows = 1 To 4
	
		create_TOK_BOX(4,4,4,(columns*4)+20,rows*4,16,0.001,0.001,1.5,4,4,4,2,cubetex,"car")
	Next
Next

; ----------------------------------------------------------------------------------




; add--------------------------------------------------------------------------

Centerpivot = CreatePivot()

light=CreateLight()
PositionEntity light,7,15,-5
PointEntity light,Centerpivot

rot#=0

period=800/FPS
time=MilliSecs()-period

imptime=MilliSecs()

camx#=Cos(rot#)*50
camz#=Sin(rot#)*50

;rot#=rot#+0.05

If rot#&gt;360 Then rot#=0

PositionEntity campiv,camx#,40,camz#
PointEntity campiv,centerpivot  

FlushMouse 
; +++ MAIN LOOP START ++++++ MAIN LOOP START ++++++ MAIN LOOP START ++++++ MAIN LOOP START +++
.mainloop
While Not KeyHit(1)

	Repeat
		elapsed=MilliSecs()-time
	Until elapsed

	ticks=elapsed/period
	tween#=Float(elapsed Mod period)/Float(period)

	For k=1 To ticks
		time=time+period
		If k=ticks Then CaptureWorld

		TOKSIM_Advance(1.75/FPS,1)

move_camera()

	UpdateWorld

	Next

; Not sure wether to put this here or inside the for/next above...
For i=1 To TOKS
 If TOKRB_IsIdle(rb(i)) Then
  EntityAlpha obj(i),0.5
 Else
  EntityAlpha obj(i),1.0
  TOKRB_Active(rb(i),True)

 EndIf
 
 If EntityName(obj(i)) = "ball"
	; do stuff
 EndIf

 If EntityName(obj(i)) = "box"
	;If MouseDown(2) = 1 Then TOKRB_ApplyTwist(rb(i),0,150,0)
 EndIf


.carmovement
;accel# = 0.01
;force# = force# * .99

;TOKRB_ApplyImpulse rb(1),-(Sin(EntityYaw(obj(1)))*force#),-(Sin(EntityPitch(obj(1)))*force#),Cos(EntityYaw(obj(1)))*force#
;ok
;TOKRB_ApplyImpulse rb(2),-(Sin(EntityYaw(obj(1)))*force#),-(Sin(EntityPitch(obj(1)))*force#),Cos(EntityYaw(obj(1)))*force#
;TOKRB_ApplyImpulse rb(4),-(Sin(EntityYaw(obj(1)))*force#),-(Sin(EntityPitch(obj(1)))*force#),Cos(EntityYaw(obj(1)))*force#
;TOKRB_SetTorque rb(2),-(Cos(EntityYaw(obj(1)))*force#)/2,0,-(Sin(EntityYaw(obj(1)))*force#)/2
;TOKRB_ApplyTwist rb(3),-(Cos(EntityYaw(obj(1)))*force#)/2,0,-(Sin(EntityYaw(obj(1)))*force#)/2
;TOKRB_ApplyTwist rb(2),0,-(Sin(EntityYaw(obj(1)))*force#),0
carpitch# = EntityPitch(obj(1))
caryaw# = EntityYaw(obj(1))
carroll# = EntityRoll(obj(1))
caryaw_cos# = Cos(caryaw#)
caryaw_sin# = Sin(caryaw#)

	If KeyDown(200) = 1
								
				TOKRB_ApplyTwist(rb(6),caryaw_cos#*force#,0,caryaw_sin#*force#)
				TOKRB_ApplyTwist(rb(7),caryaw_cos#*force#,0,caryaw_sin#*force#)
				force# = 6
				;TOKRB_ApplyImpulse rb(1),-(Sin(EntityYaw(obj(1)))*force#),-(Sin(EntityPitch(obj(1)))*force#),Cos(EntityYaw(obj(1)))*force#
	EndIf

	If KeyDown(208) = 1
				TOKRB_SetAngularMomentum(rb(6),caryaw_cos#*force#,0,caryaw_sin#*force#)
				TOKRB_SetAngularMomentum(rb(7),caryaw_cos#*force#,0,caryaw_sin#*force#)
				force# = -4

	EndIf
	
		
	ncaryaw# = caryaw# + turn#
	
	If KeyDown(203) = 1
		turn# = turn# + 0.05
		If turn#&gt;40 Then turn# = 40
		
	EndIf
	If KeyDown(205) = 1
		turn# = turn# - 0.05
		If turn#&lt;-40 Then turn# = -40
	EndIf

	TOKRB_SetRotation(rb(2),carpitch#,ncaryaw#,carroll#)
	TOKRB_SetRotation(rb(4),carpitch#,ncaryaw#,carroll#)




	If MouseDown(2) = 1 Then place_rb(cubetex)

 PositionEntity obj(i),TOKRB_GetX#(rb(i)),TOKRB_GetY#(rb(i)),TOKRB_GetZ#(rb(i)) 
 RotateEntity obj(i),TOKRB_GetPitch#(rb(i)),TOKRB_GetYaw#(rb(i)),TOKRB_GetRoll#(rb(i)),False
Next

If MouseDown(1)=1 Then push_rigid_body()


RenderWorld tween
Color 255,255,255
Text 0,0,"Physics Time:"+TOKSIM_GetPhysicsTime()*1000.0+ " milliseconds"
Text 0,10,"Render Time:"+Str(elapsed)+ " milliseconds"
Text 0,20,"pnx"+pnx#+"  pny "+pny#+"  pnz  "+pnz# 
;Text 0,30,"Render Time:"+Str(elapsed)+ " milliseconds"
Text 0,40,"force: "+force#
;Text 0,50,"Render Time:"+Str(elapsed)+ " milliseconds"
Text 0,50,"camera X : "+EntityX(campiv)+"   Y : "+EntityY(campiv)+"  Z : "+EntityZ(campiv)

Color 255,0,0
Rect midw-4,midh-4,8,8,0
	Flip False

Wend

; == MAIN LOOP END ==== MAIN LOOP End ==== MAIN LOOP End ==== MAIN LOOP End ==== MAIN LOOP End ==


TOKSIM_DestroySimulator()

End

;==================================================================================
Function curvevalue#(newvalue#,oldvalue#,increments# )
	If increments&gt;1 Then oldvalue#=oldvalue#-(oldvalue#-newvalue#)/increments
	If increments&lt;=1 Then oldvalue=newvalue
	Return oldvalue#
End Function
;==================================================================================
Function move_camera()
	; Movement controls
	If KeyDown(w)=1 Then speed# = speed#+.03
	If KeyDown(a)=1 Then latspeed# = latspeed# - .02
	If KeyDown(s)=1 Then speed# = speed# -.03
	If KeyDown(d)=1 Then latspeed# = latspeed# + .02

latspeed#=latspeed#*.98
speed#=speed#*.98

MY#=curvevalue#(MouseYSpeed(),MY#,3 )
MX#=curvevalue#(MouseXSpeed(),MX#,3 )
TurnEntity campiv,MY#,-MX#,0 ; turn camera up and down
;TurnEntity campiv,0,-MX#,0 ;  turn nnn left --right
RotateEntity campiv,EntityPitch(campiv),EntityYaw(campiv),0
If EntityPitch(campiv)&gt;88 Then RotateEntity campiv,88,EntityYaw(campiv),EntityRoll(campiv)
If EntityPitch(campiv)&lt;-88 Then RotateEntity campiv,-88,EntityYaw(campiv),EntityRoll(campiv)

MoveMouse 100,100

MoveEntity campiv,latspeed#,0,speed#
	


End Function
;==================================================================================
Function create_cube_texture()
	tex = CreateTexture(64,64)
	ScaleTexture tex,.5,.5
	SetBuffer TextureBuffer(tex)
		Color 20,20,200
		Rect 0,0,64,64
		Color 255,255,255
		Rect 0,0,32,32
		Rect 32,32,64,64
		Color 0,0,0
		Rect 0,0,64,64,0
	SetBuffer BackBuffer()
	Return tex
	
End Function

Function create_world_texture()
	tex = CreateTexture(128,128)
	ScaleTexture tex,.25,.25
	SetBuffer TextureBuffer(tex)
		Color 100,100,100
		Rect 0,0,128,128
		Color 50,50,50
		Rect 0,0,64,64
		Rect 64,64,128,128
		Color 200,200,0
		Rect 0,0,128,128,0
		

	SetBuffer BackBuffer()
	Return tex
	
End Function

;==================================================================================
Function create_sphere_texture()
	tex = CreateTexture(128,128)
	SetBuffer TextureBuffer(tex)
		Color 0,200,0
		Rect 0,0,128,128
		Color 255,255,0
		Rect 0,0,64,64
		Rect 64,64,128,128
		Color 0,0,0
		Rect 0,0,64,64,0
		Color 0,0,0
		Rect 64,64,128,128,0
		Color 0,0,0
		Rect 0,0,128,128,0
	ScaleTexture tex,.5,.5


	SetBuffer BackBuffer()
	Return tex

	
End Function

;==================================================================================
Function create_cyl_texture()
	tex = CreateTexture(128,128)
	SetBuffer TextureBuffer(tex)
		Color 0,0,0
		Rect 0,0,128,128
		Color 255,0,0
		Rect 0,0,64,64
		Rect 64,64,128,128
	SetBuffer BackBuffer()
	Color 255,255,0 ; YELLOW
	Return tex

	
End Function

;==================================================================================
Function campick()
	pictentity = 0
	CameraPick(camera,midw,midh)
	pictentity = PickedEntity() 
	If Pictentity&lt;&gt;0
		
		;EntityAlpha pictentity,.7	
		pnx# = PickedNX#()
		pny# = PickedNY#()
		pnz# = PickedNZ#()	
		pcx# = PickedX#()
		pcy# = PickedY#()
		pcz# = PickedZ#()

	
	EndIf
	

End Function

Function create_TOK_BOX(xs#,ys#,zs#,xp#,yp#,zp#,damp#,angdamp#,mass#,iw#,ih#,id#,imass#,texture,name$)

			TOKS = TOKS+1
			If TOKS&gt;ENTS 
				TOKS = ENTS
				Return
			EndIf
			obj(TOKS) = CreateCube()
			NameEntity obj(toks),name$
			ScaleEntity obj(TOKS),xs#/2,ys#/2,zs#/2
			EntityPickMode obj(TOKS),2
			EntityTexture obj(TOKS),texture
			rb(TOKS) = TOKRB_Create()
			TOKRB_SetSleepingParameter(rb(TOKS),-100)
			TOKRB_AddBox rb(TOKS),xs#,ys#,zs#
			TOKRB_SetPosition(rb(TOKS),xp#,yp#,zp#)
			TOKRB_SetLinearDamping rb(TOKS),damp#
			TOKRB_SetAngularDamping rb(TOKS),angdamp# 

			TOKRB_SetMass rb(TOKS),mass#
			TOKRB_SetBoxInertiaTensor rb(TOKS),iw#,ih#,id#,imass# 
			
			

End Function

Function create_TOK_BALL(segs,sc#,xp#,yp#,zp#,angdamp#,lindamp#,mass#,IT1#,IT2#,texture,name$)
			  TOKS = TOKS+1
			  
				If TOKS&gt;ENTS 
					TOKS = ENTS
					Return
				EndIf
	
			
				obj(TOKS) = CreateSphere(segs)
				NameEntity obj(toks),name$

			  ScaleEntity obj(TOKS),sc#/2,sc#/2,sc#/2
			  EntityPickMode obj(TOKS),2

			  EntityTexture obj(TOKS),texture
			  rb(TOKS) = TOKRB_Create()
			  TOKRB_AddSphere rb(TOKS),sc#
			  TOKRB_SetPosition(rb(TOKS),xp#,yp#,zp#)
			  TOKRB_SetAngularDamping rb(TOKS),angdamp# 
			  TOKRB_SetLinearDamping rb(TOKS),lindamp#
			  TOKRB_SetMass rb(TOKS),mass#
			  TOKRB_SetSphereInertiaTensor rb(TOKS),IT1#,IT2#  
End Function



Function create_TOK_CYL(segs,diameter#,height#,xp#,yp#,zp#,angdamp#,lindamp#,mass#,Id#,Ih#,Imass#,texture,name$)

			TOKS = TOKS+1
			  
				If TOKS&gt;ENTS 
					TOKS = ENTS
					Return
				EndIf
			
			obj(TOKS) = CreateCylinder(segs)
 				EntityPickMode obj(TOKS),2
  			 EntityTexture obj(TOKS),texture
			  rb(TOKS) = TOKRB_Create()
			  TOKRB_AddCylinder rb(TOKS),diameter#,height#
			  ScaleEntity obj(TOKS),diameter#/1.95,height#,diameter#/1.95
			  TOKRB_SetPosition(rb(TOKS),xp#,yp#,zp#)
			  TOKRB_SetAngularDamping rb(TOKS),angdamp# 
			  TOKRB_SetLinearDamping rb(TOKS),lindamp#
			  TOKRB_SetMass rb(TOKS),mass#
			  TOKRB_SetCylinderInertiaTensor rb(TOKS),Id#,Ih#,Imass# 
			  TOKRB_Active(rb(toks),True)
			;TOKRB_CollideConnected(rb(toks),True)
End Function
;==================================================================================

Function place_rb(tex)
	
		campick()
		If pictentity&gt;0
			PositionEntity pickmarker,pcx#,pcy#,pcz#
			;create_TOK_BOX(xs#,ys#,zs#,xp#,yp#,zp#,damp#,angdamp#,mass#,iw#,ih#,id#,imass#,texture,name$)
	
			create_TOK_BOX(4,4,4,pcx#,pcy#+2,pcz#,0.001,0.002,2,4,4,4,2,tex,"foo")
			Repeat : Until MouseDown(2) = 0
			
	 	EndIf
	FlushMouse()
End Function
		
;==================================================================================



;==================================================================================

Function push_rigid_body()
	
		campick()
	 	For n = 1 To TOKS
			If pictentity = obj(n)
				i = n
				
				If KeyDown(29) Or KeyDown(157)
				
					TOKRB_ApplyImpulse2 rb(i),-pnx#*15,-pny#*15,-pnz#*15,pcx#,pcy#,pcz# 
				Else
					TOKRB_ApplyImpulse2 rb(i),-pnx#,-pny#,-pnz#,pcx#,pcy#,pcz# 				;TOKRB_ApplyImpulse rb(i),-pnx#,pny#,-pnz#
				EndIf
			EndIf
		Next		
End Function
		
;==================================================================================


Function MakeTokCollider(mesh)
 scount=CountSurfaces(mesh)
 For ind=1 To scount
  surface=GetSurface(mesh,ind)
  ttltris=ttltris+CountTriangles(surface)
  ttlvert=ttlvert+CountVertices(surface)
 Next
 vertices=CreateBank(16*ttlvert)
 triangles=CreateBank(24*ttltris)
 offsetv=0
 offsett=0
 For ind=1 To scount
  surface = GetSurface(mesh,ind)
  ctr=CountTriangles(surface)
  tric=tric+cvt
  cvt=CountVertices(surface)
  ;fill bank with vertices
  For v=0 To cvt-1
   PokeFloat vertices,offsetv,VertexX#(surface,v)
   PokeFloat vertices,offsetv+4,VertexY#(surface,v)
   PokeFloat vertices,offsetv+8,VertexZ#(surface,v)
   PokeFloat vertices,offsetv+12,0.0
   offsetv=offsetv+16
  Next
  ;fill bank with triangles
  For v=0 To ctr-1
   PokeInt triangles,offsett,tric+TriangleVertex(surface,v,0)
   PokeInt triangles,offsett+4,tric+TriangleVertex(surface,v,1)
   PokeInt triangles,offsett+8,tric+TriangleVertex(surface,v,2)
   PokeInt triangles,offsett+12,0
   PokeInt triangles,offsett+16,0
   PokeInt triangles,offsett+20,0
   offsett=offsett+24
  Next
 Next
 ;Hand over the terrain data to Tokamak
 TOKSIM_SetStaticMesh vertices,ttlvert,triangles,ttltris
 ; Now we can free the banks as Tokamak has copied all data
 FreeBank vertices
 FreeBank triangles
End Function
</pre> <br><br></td></tr></table><br>
<a name="318125"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DarkEagle</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#112">[#112]</a></td></tr></table></td></tr><tr ><td class="posttext"> any idea why this goes insane?<br><br><pre class=code>
Const FPS=50


Graphics3D 800,600,0,2
SetBuffer BackBuffer()

WireFrame False

Const ENTS=10

Global cam = CreateCamera()
PositionEntity cam,0,10,-50

TOKSIM_CreateSimulator(ENTS,5,0,-10,0)


Dim obj(ENTS)
Dim rb(ENTS)

SeedRnd MilliSecs()  


For i = 1 To ents

	obj(i) = CreateCube()
	rb(i) = TOKRB_Create()
	CreateTokCube(obj(i),rb(i),0,10-i*3,0,1,1,1,2)
	TOKRB_CollideConnected rb(i),1

Next

For i = 1 To ents-1

	joint = TOKJOINT_Create(2,rb(i),rb(i+1))
	TOKJOINT_SetType joint,1 
	TOKJOINT_SetPositionAndRotationWorld joint,0,9-i*3,0,90,0,0
	TOKJOINT_Enable joint,1
	TOKJOINT_SetLowerLimit joint,0
	TOKJOINT_SetUpperLimit joint,0
	TOKJOINT_EnableLimit joint,1
	TOKJOINT_SetLowerLimit2 joint,Pi*0.4
	TOKJOINT_SetUpperLimit2 joint,0
	TOKJOINT_EnableLimit2 joint,1

Next

joint = TOKJOINT_Create(1,rb(1),0)
TOKJOINT_SetType joint,1 
TOKJOINT_SetPositionAndRotationWorld joint,0,11,0,0,0,0
TOKJOINT_Enable joint,1



Centerpivot = CreatePivot()
light=CreateLight()
PositionEntity light,7,15,-5
PointEntity light,Centerpivot



period=1000/FPS
time=MilliSecs()-period
imptime=MilliSecs()

While Not KeyHit(1)

	Repeat
		elapsed=MilliSecs()-time
	Until elapsed

	ticks=elapsed/period
	tween#=Float(elapsed Mod period)/Float(period)

	For k=1 To ticks
		time=time+period
		If k=ticks Then CaptureWorld

		TOKSIM_Advance(1.5/FPS,1)

		UpdateWorld
	Next

	; Not sure wether to put this here or inside the for/next above...
	For i=1 To ENTS
	
		If TOKRB_IsIdle(rb(i)) Then
			EntityAlpha obj(i),0.5
		Else
			EntityAlpha obj(i),1.0
		EndIf
		
		PositionEntity obj(i),TOKRB_GetX#(rb(i)),TOKRB_GetY#(rb(i)),TOKRB_GetZ#(rb(i)) 
		RotateEntity obj(i),TOKRB_GetPitch#(rb(i)),TOKRB_GetYaw#(rb(i)),TOKRB_GetRoll#(rb(i)),False
		
	Next
	
	If KeyDown(57)
		TOKRB_ApplyImpulse rb(ents),1,1,1
	End If
	
	RenderWorld tween
	
	Text 0,0,"Physics Time:"+TOKSIM_GetPhysicsTime()*1000.0+ " milliseconds"
	Text 0,10,"Render Time:"+Str(elapsed)+ " milliseconds"


Flip False

Wend

TOKSIM_DestroySimulator()
End


Function CreateTokCube(entity,rb,x#,y#,z#,xs#=1.0,ys#=1.0,zs#=1.0,mass#=1.0)

	ScaleEntity entity,xs,ys,zs
	PositionEntity entity,x,y,z
	
	TOKRB_AddBox rb,xs*2,ys*2,zs*2
	TOKRB_SetPosition rb,x,y,z
	TOKRB_SetLinearDamping rb,0.001
	TOKRB_SetAngularDamping rb,0.001
	TOKRB_SetMass rb,mass
	TOKRB_SetBoxInertiaTensor rb,xs*2,ys*2,zs*2,mass

End Function


Function CreateTokSphere(entity,rb,x#,y#,z#,rad#=1.0,mass#=1.0)

	ScaleEntity entity,rad,rad,rad
	PositionEntity entity,x,y,z
	
	TOKRB_AddSphere rb,rad#*2
	TOKRB_SetPosition rb,x,y,z
	TOKRB_SetLinearDamping rb,0.001
	TOKRB_SetMass rb,mass
	TOKRB_SetBoxInertiaTensor rb,rad*2,rad*2,rad*2,mass

End Function


Function CreateTokCylinder(entity,rb,x#,y#,z#,rad#=1.0,height#=1.0,mass#=1.0)

	TOKRB_AddCylinder rb,rad*2,height
	TOKRB_SetPosition rb,x,y,z
	TOKRB_SetLinearDamping rb,0.001 
	TOKRB_SetAngularDamping rb,0.01 
	TOKRB_SetMass rb,mass
	TOKRB_SetCylinderInertiaTensor rb,rad*2,height,mass

End Function
</pre> <br><br></td></tr></table><br>
<a name="318131"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DarkEagle</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#113">[#113]</a></td></tr></table></td></tr><tr ><td class="posttext"> thought it would be a good idea to help sweenie out and document the commands for ourselves! ive started doing the first few, just hoping you lot will help carry on and complete this? possibly turn into html?<br><br><pre class=code>
*** Simulator ***
TOKSIM_CreateSimulator%(RBCount%,ABCount%,GravityX#,GravityY#,GravityZ#)
RBCount = number of rigid bodies.
ABCount = number of animated bodies.
GravityX,Y,Z = amount of gravity applying in each direction.

TOKSIM_DestroySimulator()
Destroys the simulator at the end of the program

TOKSIM_Advance(timestep#,SubSteps%)
timestep = time used for calculations. larger value = larger mvements per update.
SubSteps = amount of steps to split timestep into. this should usually be 1.

TOKSIM_GetPhysicsTime#()

TOKSIM_SetStaticMesh(Vertices*,VertexCount%,Triangles*,TriangleCount%)

*** Rigid Body *** 
TOKRB_Create%()
TOKRB_Free(RigidBody%)
TOKRB_GetX#(RigidBody%)
TOKRB_GetY#(RigidBody%)
TOKRB_GetZ#(RigidBody%)
TOKRB_SetPosition(RigidBody%,X#,Y#,Z#)
TOKRB_GetPitch#(RigidBody%)
TOKRB_GetYaw#(RigidBody%)
TOKRB_GetRoll#(RigidBody%)
TOKRB_SetRotation(RigidBody%,Pitch#,Yaw#,Roll#)
TOKRB_AddBox%(RigidBody%,Width#,Height#,Depth#)
TOKRB_AddSphere%(RigidBody%,Diameter#)
TOKRB_AddCylinder%(RigidBody%,Diameter#,Height#)
TOKRB_UpdateBoundingInfo(RigidBody%)
TOKRB_SetBoxInertiaTensor(RigidBody%,Width#,Height#,Depth#,Mass#)
TOKRB_SetSphereInertiaTensor(RigidBody%,Diameter#,Mass#)
TOKRB_SetCylinderInertiaTensor(RigidBody%,Diameter#,Height#,Mass#)
TOKRB_SetMass(RigidBody%,Mass#)
TOKRB_SetLinearDamping(RigidBody%,Damping#)
TOKRB_SetAngularDamping(RigidBody%,Damping#)
TOKRB_IsIdle%(RigidBody%)
TOKRB_CollideConnected(RigidBody%,Connected%)
TOKRB_SetSleepingParameter(RigidBody%,sleepparam#)
TOKRB_Active(RigidBody%,Active%)
TOKRB_IsActive%(RigidBody%)
TOKRB_ApplyImpulse(RigidBody%,X#,Y#,Z#)
TOKRB_ApplyImpulse2(RigidBody%,X#,Y#,Z#,XPos#,YPos#,ZPos#)
TOKRB_ApplyTwist(RigidBody%,X#,Y#,Z#)
TOKRB_SetForce(RigidBody%,X#,Y#,Z#)
TOKRB_SetForce2(RigidBody%,X#,Y#,Z#,XPos#,YPos#,ZPos#)
TOKRB_SetTorque(RigidBody%,X#,Y#,Z#)
TOKRB_SetVelocity(RigidBody%,X#,Y#,Z#)
TOKRB_SetAngularMomentum(RigidBody%,X#,Y#,Z#)
TOKRB_GetVelocityX#(RigidBody%)
TOKRB_GetVelocityY#(RigidBody%)
TOKRB_GetVelocityZ#(RigidBody%)
TOKRB_GetAngularMomentumX#(RigidBody%)
TOKRB_GetAngularMomentumY#(RigidBody%)
TOKRB_GetAngularMomentumZ#(RigidBody%)
TOKRB_GetAngularVelocityX#(RigidBody%)
TOKRB_GetAngularVelocityY#(RigidBody%)
TOKRB_GetAngularVelocityZ#(RigidBody%)

*** Animated Body ***
TOKAB_Create%()
TOKAB_Free(AnimatedBody%)
TOKAB_SetPosition(AnimatedBody%,X#,Y#,Z#)
TOKAB_SetRotation(AnimatedBody%,Pitch#,Yaw#,Roll#)
TOKAB_AddBox%(AnimatedBody%,Width#,Height#,Depth#)
TOKAB_AddSphere%(AnimatedBody%,Diameter#)
TOKAB_AddCylinder%(AnimatedBody%,Diameter#,Height#)

*** Geometry ***
TOKGEOM_SetPositionAndRotation(Geometry%,X#,Y#,Z#,Pitch#,Yaw#,Roll#)

*** Joint ***
TOKJOINT_Create%(ConnectionType%,BodyA%,BodyB%)
TOKJOINT_Free%(Joint%)
TOKJOINT_SetType(Joint%,JointType%)
TOKJOINT_SetPositionAndRotationWorld(Joint%,X#,Y#,Z#,Pitch#,Yaw#,Roll#)
TOKJOINT_SetPositionFrameA(Joint%,X#,Y#,Z#)
TOKJOINT_SetPositionFrameB(Joint%,X#,Y#,Z#)
TOKJOINT_SetJointLength(Joint%,Length#)
TOKJOINT_GetJointLength#(Joint%)
TOKJOINT_Enable(Joint%,Enable)
TOKJOINT_IsEnabled%(Joint%)
TOKJOINT_SetUpperLimit(Joint%,Limit#)
TOKJOINT_SetLowerLimit(Joint%,Limit#)
TOKJOINT_SetUpperLimit2(Joint%,Limit#)
TOKJOINT_SetLowerLimit2(Joint%,Limit#)
TOKJOINT_GetUpperLimit#(Joint%)
TOKJOINT_GetLowerLimit#(Joint%)
TOKJOINT_GetUpperLimit2#(Joint%)
TOKJOINT_GetLowerLimit2#(Joint%)
TOKJOINT_EnableLimit(Joint%,Enabled%)
TOKJOINT_EnableLimit2(Joint%,Enabled%)
TOKJOINT_IsLimitEnabled%(Joint%)
TOKJOINT_IsLimit2Enabled%(Joint%)
</pre> <br><br></td></tr></table><br>
<a name="318136"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bradford6</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#114">[#114]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have a doc file in the works as well.<br><br>anyone see my car code ? (above  ^ )<br><br>need some input on that one... <br><br></td></tr></table><br>
<a name="318166"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ricky Smith</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#115">[#115]</a></td></tr></table></td></tr><tr ><td class="posttext"> I know that animated bodies are not influenced by tomakak - so what exactly is the use of an animated body ??<br><br>EDIT - question posted in BlitzTool forum. <br><br></td></tr></table><br>
<a name="318252"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sweenie</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#116">[#116]</a></td></tr></table></td></tr><tr ><td class="posttext"> @DarkEagle:<br>In what way does it go insane?<br><br>It only went "insane" for me when I only had Limit2(Twist) enabled, but that could be reduced a bit by setting the angulardamping to 0.01 instead of 0.001<br>Angulardamping prevents bodies from spinning extremly fast.<br>But maybe that wasn't what you meant. <br><br></td></tr></table><br>
<a name="318267"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PsychicParrot</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#117">[#117]</a></td></tr></table></td></tr><tr ><td class="posttext"> Bradford ... the car demo is a great start, but there seems to be a real lack of friction in there between the ground and the wheels - since I haven't spend enough time with Sweenie's wrapper, I don't know how you go about changing that? Is there a friction setting or similar? <br><br></td></tr></table><br>
<a name="318275"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tom</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#118">[#118]</a></td></tr></table></td></tr><tr ><td class="posttext"> DarkEagle: You have Upper &amp; Lower limits of 0 and 0, that's leaving no room for the joint to flex. Try increaming the mass too. <br><br></td></tr></table><br>
<a name="318279"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >aCiD2</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#119">[#119]</a></td></tr></table></td></tr><tr ><td class="posttext"> i have a proteanide userlib for takomak any one want it? it has the proper command docs like<br><br>;;; &lt;summary&gt;Creates the simulator&lt;/summary&gt;<br><br>that sort of stuff, useful for proteanuses, not much else however :P <br><br></td></tr></table><br>
<a name="318380"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sweenie</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#120">[#120]</a></td></tr></table></td></tr><tr ><td class="posttext"> Unfortunately I was very busy last night so I didn't have much time with the wrapper.<br>But materials are in(friction and restitution) and Accuracysettings for jointsolvers.<br><br>@Tom:<br>hehe, I DID actually implement rotation of FrameA &amp; B in v0.3.<br>Just forgot to update the Tokamak.decls file.<br>Change the following lines:<br>TOKJOINT_SetPositionFrameA(Joint%,X#,Y#,Z#):"_TOKJOINT_SetPositionFrameA@16"<br>TOKJOINT_SetPositionFrameB(Joint%,X#,Y#,Z#):"_TOKJOINT_SetPositionFrameB@16"<br>To --&gt;<br>TOKJOINT_SetPositionAndRotationFrameA(Joint%,X#,Y#,Z#,Pitch#,Yaw#,Roll#):"_TOKJOINT_SetPositionFrameA@28"<br>TOKJOINT_SetPositionAndRotationFrameB(Joint%,X#,Y#,Z#,Pitch#,Yaw#,Roll#):"_TOKJOINT_SetPositionFrameB@28" <br><br></td></tr></table><br>
<a name="318430"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tom</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#121">[#121]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah I noticed last night and added it, I may have to post a Q. to the Tokamak guys about the frame world stuff.<br><br>The editor is quite usable, that is, it can produce something that works, with relative ease. A few new things I discovered along the way:<br><br>When creating a runtime ragdoll, of all the Bones in your character, the Root bone (first child of a B3D animated mesh) must be unparented, the majority of the rest of the Bones get unparented too, although they don't all have too as I explained in my earlier post.<br><br>Basicly your Bones are taken over by Tokamak and unparented from the main mesh, you effectively leave the meshes 'pivot' at the position it was at the time of creating the ragdoll. But then I come across a problem, if that mesh pivot went out of the camera view your actual character polygons disappear, Blitz thinks it's off screen and hides them, regardless of wether the Bones are in camera view, the effect showed up as an invisible character smashing down a wall, spooky! :)<br><br>I thought what if when creating the ragdoll, after unparenting all the Bones, I parent the actual mesh/pivot to the Root bone using the Global flag. It works! Now the mesh pivot sticks to the ragdoll, so no more disappearing character. (parenting a mesh to it's bones...crazy!)<br><br>There could be a neat side effect to this, it could be easy to deactivate the ragdoll, reparent all the Bones  so the hierarchy is identical to when you loaded the mesh, and then can carry on animating it with regular Blitz commands (providing the character aint been killed of course! hehe)<br><br>Imagine, B3D animation cycle.........character gets knocked down, falls off a ledge or whatever using Tokamak.......then it gets back up again and you carry on animating it. Hmmm the possibilities!<br><br>Idealy I'd like to have a few function calls to make it all transparent, something like:<br><br>myChar.Ragdoll=CreateRagdoll(Entity) ; physics take over<br>...<br>TOKRB_ApplyImpulse myChar\RigidBody\Chest,x,y,z ; get funky!<br>...<br>FreeRagdoll(myChar.Ragdoll) ; back to Blitz animatable control<br><br>Yum!<br><br>Anyways, I'll crack away at this editor so I have something for tomorrow night (I hope!)<br><br>Cya!<br>Tom <br><br></td></tr></table><br>
<a name="318648"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >(tu) sinu</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#122">[#122]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>I thought what if when creating the ragdoll, after unparenting all the Bones, I parent the actual mesh/pivot to the Root bone using the Global flag. It works! Now the mesh pivot sticks to the ragdoll, so no more disappearing character. (parenting a mesh to it's bones...crazy!) <br><br>There could be a neat side effect to this, it could be easy to deactivate the ragdoll, reparent all the Bones so the hierarchy is identical to when you loaded the mesh, and then can carry on animating it with regular Blitz commands (providing the character aint been killed of course! hehe) <br><br>Imagine, B3D animation cycle.........character gets knocked down, falls off a ledge or whatever using Tokamak.......then it gets back up again and you carry on animating it. Hmmm the possibilities! <br> <br></div><br><br>that is exactly what i wanted to try/do :). <br><br></td></tr></table><br>
<a name="318716"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bradford6</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#123">[#123]</a></td></tr></table></td></tr><tr ><td class="posttext"> hey, lets start a new sticky thread for this... <br><br></td></tr></table><br>
<a name="318719"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bot Builder</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#124">[#124]</a></td></tr></table></td></tr><tr ><td class="posttext"> yeah. this ones to long for me :) How bout recording the old/new positions and rotions of the bones while animating, then when it starts tokamak, apply force impulses based on the velocity, or (old-new)*mass. this makes it so that if the charachter is running, the limbs will move based on the animation/movement of the charachter. <br><br></td></tr></table><br>
<a name="318728"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tom</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#125">[#125]</a></td></tr></table></td></tr><tr ><td class="posttext"> That's a possibility too, but not just position data. If you stepped back a few frames and created a vector of each bone, do a dotproduct with old &amp; new positions you'll get an angle which you could somehow convert to a force value. Also do a crossproduct on the 2 vectors and you have the axis on which to apply the twist. <br><br></td></tr></table><br>
<a name="318752"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bot Builder</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#126">[#126]</a></td></tr></table></td></tr><tr ><td class="posttext"> ?why find the angle? I thought all you need is rotational and velocity data? maybe you know best. <br><br></td></tr></table><br>
<a name="318766"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tom</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#127">[#127]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah but the physics aren't active at the time of creation, as soon as the rigid bodies are created they have no velocity or angular momentum, that's why we need to find that stuff out from the bones e.t.c :) <br><br></td></tr></table><br>
<a name="318843"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sweenie</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#128">[#128]</a></td></tr></table></td></tr><tr ><td class="posttext"> It seems that I have made some mistakes in the code that rotates the joints.<br>I only checked straight angles like 90 degrees and so on, but last night when I implemented the functions TOKJOINT_GetPitch,Yaw n Roll I noticed that the rotational values wasn't what they should be.<br><br>It was easier to spot mistakes with the rotation of the bodies because you could see the mistake visually, but it's more difficult with the joints.<br><br>But don't worry, I'm on it.<br><br><br>@Tom:<br>That could explain why you had problems setting up the joints. ;p <br><br></td></tr></table><br>
<a name="318905"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ricky Smith</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#129">[#129]</a></td></tr></table></td></tr><tr ><td class="posttext"> All credit to you Sweenie - you've done a marvellous job - considering the speed at which you have been pumping this stuff out ! <br><br></td></tr></table><br>
<a name="318956"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bradford6</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#130">[#130]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sweenie,<br>Here is an idea. (If you havent already thought of it) create a joint_marker mesh that would visually identify the joint pitch,yaw,roll.<br><br>the best marker I have seen is the finned bones from 3dsmax.  the fins really help you visualize the rotation of the bone <br><br></td></tr></table><br>
<a name="318968"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sweenie</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#131">[#131]</a></td></tr></table></td></tr><tr ><td class="posttext"> That is how I discovered the faulty values.<br>When I aligned the mesh used to mark the joint I saw that it went nuts.<br>But as Tom pointed out in the other forum, the values returned from the bodies aren't fully correct either.<br><br>But with a little help from the community I'm sure we get this fixed in notime. :) <br><br></td></tr></table><br>
<a name="318993"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bradford6</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#132">[#132]</a></td></tr></table></td></tr><tr ><td class="posttext"> let me know how I can help.<br>(although I don't know a quaternion from a hole in the ground) <br><br></td></tr></table><br>
<a name="319163"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hansie</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#133">[#133]</a></td></tr></table></td></tr><tr ><td class="posttext"> is this the longest thread ever? :-D <br><br></td></tr></table><br>
<a name="319169"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#134">[#134]</a></td></tr></table></td></tr><tr ><td class="posttext"> part 3 coming up... <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
