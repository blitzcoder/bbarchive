<!DOCTYPE html><html lang="en" ><head ><title >Sensors based pathfinding and behaviors</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Sensors based pathfinding and behaviors</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Sensors based pathfinding and behaviors</a><br><br>
<a name="1137726"></a>

<a name="1137729"></a>

<a name="1137732"></a>

<a name="1137734"></a>

<a name="1137735"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi, :)<br><br>I was thinking about the pathfinding and the behaviors of the npcs in my game.<br><br>I try to code a game with a gameplay similar to Daggerfall, but only the part about the dungeons exploration and the fights against creatures (in my game the bad guys are vampires.)<br><br>I want the vampires to be agile, fast, strong. Therefore if i make the vampires characters follow a path of nodes around a furniture, that's not an impressive behavior...<br><br>But if i manage to make the vampire character "sense" that there is a furniture, let's say a table, blocking his path, and if he can climb on it, or jump above it, then this will be an impressive behavior !<br><br>If you have played Morrowind or Oblivion, you understand what i mean by non impressive behaviors, the npcs only walk or run towards nodes. You climb on a rock or on a wall and you can shoot arrows to the npc and he is lost...<br>If you have played Urban chaos or Gothic 2, you have seen what i mean by impressive behaviors, the npcs can follow you everywhere ! on the walls, on the crates, on the ladders, on the roofs, this is so funny to observe these smart bots ! Ahah :D<br><br>I think i'm going to use nodes only to guide the npcs to the doors of each zone, and sensors to guide the npcs through the obstacles of a zone (mainly furnitures and columns)<br><br>I have already used sensors with several linepicks each loop so that a character can sense the walls and the ledges in a parkour demo.<br><br>This worked well, but linepick seems to be slow, i think i can try to use several collider spheres instead, or the Coldet lib as Yasha suggested.<br><br><br><br>How would you achieve this ? Nodes with parameters around each furniture ? Or sensors on each npc ?<br><br>Also do you know how to use navmeshes ? I have already read articles on the subject but i don't understand how you can use the tris of a mesh to guide a npc.<br><br>Thanks,<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1137789"></a>

<a name="1137790"></a>

<a name="1137791"></a>

<a name="1137792"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >stayne</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Have you tried creating a pivot connected to the NPC in front a few feet?  Like so (O is the NPC and x is the pivot) top view and side view:<br><br><pre class=code> 
       ________
      |        |
O--x  |Obstacle|
      |________|


       ________
O--x  |Obstacle|
______|________|___

</pre><br><br>Very simple way to detect obstacles, but it might work for you.  If you give your obstacles and pivot different collision types and the pivot is hits the obstacle mesh, then have the NPC jump.  Once the NPC jumps and the obstacle is low enough and is no longer colliding while in the air, have the NPC move forward.<br><br>I like simplicity.  Give it a try.  Will probably fail miserably :).<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1137793"></a>

<a name="1137794"></a>

<a name="1137796"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well navmeshes are the correct starting point for what you want to achieve - getting past the obvious artificiality of node-based pathfinding. Nodes can work well but they need to be pretty dense and be closely linked to the level design (e.g. they work brilliantly in the HL2 series, but that's because they're not trying to be a "generic" solution but rather the node placement and level design are linked to each other the whole way through the design process).<br><br>The first part of using a navmesh is that to get from distant-point-A to distant-point-B, they map a path in essentially the same way as nodes: treat each pathfinding quad as a node and use a simple, fast algorithm to find out <i>which quads</i> the shortest path will cover.<br><br>It's the second part where it gets interesting: as long as an NPC is <i>anywhere</i> on the nav quad, they're still "on" the path and don't need to immediately decide to "correct" their path the way they would if you were using nodes. So once the long-term route is chosen, they can also plan a short-term route that chooses how to <i>cross this quad</i> to get to the next one and the ones after that; the target they're now aiming for is a flexible position along the joining line that happens to provide the shortest following step to the quad one along from that. This point can move as the NPC may be required to move, making for much less obvious node-seeking behaviour.<br><br>Now the first two parts assume that within a single quad, an NPC will not be obstructed. If there are no dynamic objects, this should be true, since the navmesh is set up to show routes that the static environment never obstructs. So the third, and most, interesting part is handling obstructions.<br><br>Any object your system marks as a "collider" should have a top-down profile, either a box or a circle (possibly ditching the circle if having two kinds of profile slows things down too much; circles are much harder). It <i>does not need</i> to be any more specific than this: just err on the side of caution and mark irregular objects with an oversize box that comfortably holds them, and your NPCs will avoid them by a safe margin of an extra few inches.<br><br>Knowing the collider box's X/Z position and yaw, you can determine the transform of the rectangle that needs to be subtracted from the nav quad. What you then need to do is triangulate the nav quad to take account of the missing space and extra vertices, and the NPC can then safely pathfind across every individual sub-quad nav-triangle in a very simple operation, stringing them together in the same way that the NPC initially chose the long-route across the whole quads.<br><br>e.g.:<br><br><img src="http://img849.imageshack.us/img849/7249/navmesh.png"><br><br>If there is no route across the triangles, mark the whole quad as obstructed and find a new long-route.<br><br>Tips:<br><br>- do not attempt to use B3D meshes or B3D collisions for this (do it entirely in software using "hypothetical" quads in a bank or something)<br>- do not attempt to use overcomplicated object profiles<br>- do not run this every frame<br><br>Advanced commercial games, like Left 4 Dead, will work out every step taking several steps ahead into account as well, in an iterative process; this will let them consider things like the smoothest path across several quads or tris and take proper account of cornering and so on; thus removing the first unnecessary swerve to the right or the unnaturally tight final corner in the diagram above. However, this may be computationally expensive and you don't need to think about it immediately (upgrading your pathfinding to look more natural is a smooth progression if you start with even a simple navmesh, as opposed to nodes).<br><br>Or, read how the pros do it: <a href="http://www.valvesoftware.com/publications/2009/ai_systems_of_l4d_mike_booth.pdf" target="_blank">http://www.valvesoftware.com/publications/2009/ai_systems_of_l4d_mike_booth.pdf</a><br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1137813"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Get Game Programming Gems 1, it has a nice article on navMeshes. GPG3 also has one, but I haven't read it.<br><br>(It's item 3.6 of book 1 <a href="http://www.asawicki.info/Download/Misc/GameProgrammingGemsTOC.html" target="_blank">in this list</a>.) <br><br></td></tr></table><br>
<a name="1137883"></a>

<a name="1137884"></a>

<a name="1137917"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the suggestions and links :)<br><br>I think i have an idea of what to do.<br><br>Here :<br><a href="https://developer.valvesoftware.com/wiki/Navigation_Meshes" target="_blank">https://developer.valvesoftware.com/wiki/Navigation_Meshes</a><br><br>Search "jump areas" or "crouch areas", i don't know if these are navmeshes, it seems to be trigger meshes which explains to the bot what to do but i can also use nodes at the same time.<br><br>With this method, i only need to put one sensor on the npc and several triggers around each furniture.<br><br>I think i will try both methods. Navmeshes are too complicated for me for the moment.<br>Thanks,<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1138423"></a>

<a name="1138424"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >NoOdle</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> +1 for Game Programming Gems. A NavMesh sounds more complicated than it is. I've written quite a few now and I'm very suprised how simple they are. It is only a slight adaption from node based pathfinding after all...<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
