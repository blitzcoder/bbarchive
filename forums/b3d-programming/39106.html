<!DOCTYPE html><html lang="en" ><head ><title >Blit and memory leak  ??</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Blit and memory leak  ??</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Blit and memory leak  ??</a><br><br>
<a name="435521"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Filax</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Graphics3D 640,480,16,2<br>SetBuffer BackBuffer()<br><br>Print "Before : "+AvailVidMem ()<br>MyImage=LoadImage("test.jpg")<br>DrawImage MyImage,0,30<br><br>FreeImage MyIMage<br>Print "After  : "+AvailVidMem ()<br><br>WaitKey<br><br>If i try this program i don't obtain the same result about my memory   ?? why ?? <br><br></td></tr></table><br>
<a name="435547"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >D4NM4N</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> tried it and it seemed ok on my machine. mabe it could be due to a background programs running causing the mem to fluctuate. <br><br></td></tr></table><br>
<a name="435637"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >antero</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have the same problem :<br><br>win2k - sp4 (all updates)<br>geforce fx 5200<br>512 Ram<br>PIV 3000<br><br>avg antivirus free edition<br>sygate personal firewall <br><br></td></tr></table><br>
<a name="435646"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Maybe blitz doesn't visiably free up the memory till it's actually needed? <br><br></td></tr></table><br>
<a name="435647"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Koriolis</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have no problem here.<br>It could just be due to differences in the way video memory is handled, for different gfx drivers. It's quite possible that ther is some "lazy" memory managing behind the scene.<br><br>It might be better to try to load dozens of big distinct images and see if the unfreed memory is always proportional to the number of loaded images. Just to see if memory is still unfreed even when the vram starts to be saturated. If so, then there's really something wrong happening. <br><br></td></tr></table><br>
<a name="435676"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Doesn't happen here, and I tried it fullscreen, windowed, debug on, debug off, the values are always the same. <br><br></td></tr></table><br>
<a name="435820"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >antero</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> well here sometimes it happens others it doesn't ... its random :) my favorite kind of bug ( I wish ) <br><br></td></tr></table><br>
<a name="435884"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Eole</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have the problem too <br><br></td></tr></table><br>
<a name="435892"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >D4NM4N</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> have you got a memory monitoring program (like the taskmonitor does for RAM) that draws a time graph (mabe you could write your own), to see what the state of the memory is before you run the program, you will be able to see if its unstable.<br>(you will have to use windowed mode tho) <br><br></td></tr></table><br>
<a name="435927"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BlackD</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Modified the code for a createimage blitz test. Values return to normal after image is freed here.<br><br><pre class=code>
Graphics3D 640,480,16,2 
SetBuffer BackBuffer() 
Print "Before : "+AvailVidMem () 
MyImage=CreateImage( 500,500)
Print "During : "+AvailVidMem () 
DrawImage MyImage,0,30 
FreeImage MyIMage 
Print "After  : "+AvailVidMem () 
WaitKey </pre>Flax - using this code, does the memory return to normal? If this works (frees the memory correctly) and your code doesn't, then its likely a Blitz issue (as the processes being passed to the video card are the same) and should be reported. <br><br></td></tr></table><br>
<a name="435930"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >smilertoo</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> try running it in a loop to see if its just delaying the freeing of memory until theres a big chunk to free. <br><br></td></tr></table><br>
<a name="435936"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BlackD</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Code to do what john suggested above. Try different values of I, but don't go too high. ;) Them be large images. It'll start consuming virtual memory and give a false result. That test should use about 51 megs of video memory so as long as you have at least a 64 meg card it should work fine.<br><br><pre class=code>
Graphics3D 640,480,16,2
SetBuffer BackBuffer() 
Type image
    Field pic
    End Type
MemBefore = AvailVidMem () 
For I = 1 To 50
    test.image = New image
    test\pic = CreateImage(500,500)
    DrawImage test\pic,0,0 
    Next
MemDuring = AvailVidMem () 
For test.image = Each image
    FreeImage test\pic
    Delete test
    Next
Print "Starting Memory:       "+MemBefore
Print "After creating Images: "+MemDuring
Print "After freeing Images : "+AvailVidMem () 
WaitKey
</pre>+BlackD<br><br>edit: Actually, I've noticed a pattern emerging. All the people who have the problem are from europe. Do they sell dodgy video cards there or something. ;) <br><br></td></tr></table><br>
<a name="435969"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Filax</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's strange i don"t obtaint the same number ?? i have a GEForce FX<br>card. <br><br></td></tr></table><br>
<a name="436796"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BlackD</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Which FX card are you using? Which brand? See if other people with the same card have the same problem.<br><br>Alternatively, if you have a spare video card lying around in a drawer or something, try putting it in and see if that problem still happens, or if its just a conflict with your current card/drivers. If it still happens with a different card, but doesn't happen on someone elses system, then theres something else in your system causing the problem. Using memory managers? Leaked drivers? Old DirectX runtimes? Win2k/ME/XP? Etc. Easy way to find a fault - eliminate everything that's not causing it.<br><br>+BlackD <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
