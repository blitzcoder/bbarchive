<!DOCTYPE html><html lang="en" ><head ><title >Single surface VS CopyEntity - the big fight live</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Single surface VS CopyEntity - the big fight live</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Single surface VS CopyEntity - the big fight live</a><br><br>
<a name="431916"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Skitchy</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Which is faster?<br>Everybody seems to think that a single surface particle system is faster than using native Blitz sprites. Well, yes, and no.<br>AFAIK, using CopyEntity() means that only 1 copy of the mesh/texture is actually used and all subsequent copies are just instances of that entity.<br>There's a LOT of extra maths behind an SS system, and it got me thinking about whether its *really* worth the hassle.<br>Individual CopyEntity() beings can have their alpha/color altered, and I don't think it increases the surface count. Theroetically, if you are only using 1 texture for your particles, this should result in one surface being used anyway, and the extra speed would be gained by not having to<br>- rebuild the SS mesh every frame<br>- send it to the GFX card (only 1 plane needs to be sent)<br>- sort out the well known z-order problems<br><br>To check out the speed, try creating 3000 planes using CopyEntity() - works fine(?)<br><br>Let me know if I'm overlooking something blindingly obvious, but I used such a system in my last game and it worked fine. The only noticable slowdown was when there was a lot of overdraw (fill rate) which you get with an SS system as well. <br><br></td></tr></table><br>
<a name="431918"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> There's also another thing involved in the concept of single surface particle systems vs. sprite particle systems.<br><br>In single surface particle systems, you never really have to call any functions beyond those needed to draw the polygons, in the case of sprite based particle systems you have to use Position/Move/Translate/RotateEntity (and such) functions in order to move the entity about.  Now, this is the part that might get most people, but that's one of the really big hits on speed.  Imagine calling those functions about 8000 times per frame- it's a real hit on the FPS.  In Lotus R2 I removed the use of those functions where I could without writing hideously long math functions to get values, and thanks to that it runs very fast.  Prior to removing those functions, it capped out at Lotus R1's previous particle 'max' (it's not really a max, it's just a way of describing this concept)- 2000 particles.<br><br>The graphics side of R2 is also completely optimized compared to R1.  No more surface-per-emitter stuff, now everything is in, at minimum, zero surfaces per texture.  Now, each texture can contain one or more tiles which are also particle textures, or it can be an animated particle texture wherein you can animate the particles over their lifespan.<br><br>So, it really can be worth the hassle of writing all the math and such, because in the end you can result in having quadruple the particles in existence and being updated (you can freeze emitters and their particles in Lotus R1 and R2, which means if you're far enough away from an emitter or it's in another world zone you can freeze it and it won't be updated at all, but the particles will still exist) at any time. <br><br></td></tr></table><br>
<a name="431940"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jeremy Alessi</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I agree with Skitchy.  I did a test with Rob's system vs. copied sprites.<br><br>430 sprites and the standard method (non-single surface) was faster by about 4X.  This was also updating the sprites and not updating the single surface system.  If you don't use CopyEntity() then they are really slow, but otherwise it's usually ok. <br><br></td></tr></table><br>
<a name="432120"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dmaz</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Jeremy, are you saying that 430 sprites using CopyEntity is faster than 430 particles from Noel's R2 system or, for that matter, his R1?<br><br>or<br><br>Are you just saying that 430 copied entities are faster than non copied?  If that's the case, hadn't that been established a long time ago? <br><br></td></tr></table><br>
<a name="432122"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Pickford</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> A single surface with 430 sprites NOT updated is simply a mesh with 860 triangles.  There's no way that's slower than 430 separate objects.<br><br>When you update the particles then, depending on the CPU usage there could be a big hit but the single surface has to render faster that 430 separate objects unless something is very wrong. <br><br></td></tr></table><br>
<a name="432124"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bouncer</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sprites are MUCH slower... test and you'll see... <br><br></td></tr></table><br>
<a name="432128"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> At low poly counts, instances are faster than single surface, and easier to work with.  At high polycounts (&gt;40000) single surfaces are much faster. <br><br></td></tr></table><br>
<a name="432134"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bouncer</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> No they're not... even small amount of sprites is SLOW compared to single surface... <br><br></td></tr></table><br>
<a name="432138"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bouncer</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just did some testing...<br><br>2000 particles...<br><br>STATIC SPRITES <br>(no movement, no nothing... just render) <br>= 85fps<br><br>SIMPLE SINGLE SURFACE SYSTEM<br>(with position updates)<br>= 220fps<br><br><br>so there's your difference... just displaying sprites is MUCH slower than my whole SS particle system with position updates.<br><br><br>see for yourself...<br><br>download<br><a href="http://www.kotiposti.net/naama/compare.zip" target="_blank">http://www.kotiposti.net/naama/compare.zip</a> (&lt;30kb)<br><br>compile TEST_SINGLESURFACE and TEST_SPRITES <br><br></td></tr></table><br>
<a name="432160"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jeremy Alessi</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'd say Halo is right ... maybe if I had 2000 particles the single surface would be faster but with only 430 the Copied sprites are faster.  I got some stupid like 13 fps with 430 single surface sprites and I still get like 50 fps with just 430 separate copied Blitz sprites.  I'll have to do some more tests ... but it doesn't seem worth it, unless I'm going to use some ridiculous number of particles. <br><br></td></tr></table><br>
<a name="432161"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> "maybe if I had 2000 particles the single surface would be faster but with only 430 the Copied sprites are faster. I got some stupid like 13 fps with 430 (non-updating) single surface sprites"<br><br>As has been said before, 430 non updated single surface sprites means a static mesh with 860 polygons.  There is no way a single 860 polygon object was running at 13fps on your system, while 430 two polygon objects was running faster.  You have the same number of polygons in both, yet one has multiple surfaces.  You obviously did something VERY VERY wrong in your test.  Blitz would be unusable if one 860 polyogn object dropped the framerate to 16fps.<br><br>Hell, each character in that Arial Antics game probably has more polygons that that.  And your terrain definitely does. <br><br></td></tr></table><br>
<a name="432170"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Skitchy</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Bouncer - I think you've conclusively proved that SS is faster with that test. I even tried swapping the sprite for a standard 2 poly mesh but the results are identical.<br><br>The question was just theoretical, because I can't see the reason *why* it should be faster to rebuild a mesh every frame - but apparently it is :) <br><br></td></tr></table><br>
<a name="432171"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jeremy Alessi</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes there was something wrong. <br><br></td></tr></table><br>
<a name="432180"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't know about sprites, I was talking about meshes.<br><br>I wouldn't use a single sprite in your game.  I even merge my flares into single surface systems. <br><br></td></tr></table><br>
<a name="432185"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jeremy Alessi</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh, also disregarding any speed issues.  Vertex alpha causes major sort issues that I don't see with regular sprites.  How do you get around that one? <br><br></td></tr></table><br>
<a name="432195"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Defoc8</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> A simple test isnt really a great test..you cannot see<br>the code generated by the compiler - the generic sprite<br>code is most likely more complex with or without any<br>fancey operations..its generic...and thats were the problem<br>lies....I have little doubt that custom systems are faster..<br><br>One more thing..the data is always uploaded to the card..<br>even if only a single quad is stored, that quad must be<br>sent over and over and over...unless shaders control the<br>vertex data...the buffers are locked + the vertex data is<br>altered + the buffers are unlocked..of course there are<br>hware point sprites, but i dont think blitz makes use of <br>these..<br><br>Anyway..a lot of this is speculation..only mr sibly knows<br>what the generated code is doing..... <br><br></td></tr></table><br>
<a name="432198"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jeremy Alessi</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Still, the Vertex Alpha problem ... what's the workaround for that? <br><br></td></tr></table><br>
<a name="432220"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm sure I remember Mark (or someone in the know) saying that blitz sprites are just separate quad meshes that are rebuilt from scratch at RenderWorld, anyway. <br><br></td></tr></table><br>
<a name="432221"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sprites do have their uses though.<br><br>In my Napoleonic wargame I used a single surface system for the soldiers and all particle effects, albeit a single surface for each different class of soldier which allowed me to have over 1000 soldiers on each side on my lowly machine.  Because the soldiers were always displayed upright and only rotated about their vertical axis they were<br>very easy to code in this instance.<br><br>However, I made a simple space battle scene which used<br>copyentity exclusively along with sprites and found that<br>while I couldn't have hundreds of ships I could still have <br>quite a few but the real gain was that it was far easier to<br>program as I didn't have to  write my own functions for <br>things like MoveEntity,  TFormPoint/TFormVector, and<br>making sure that each quad  always faced the camera. <br><br></td></tr></table><br>
<a name="432225"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rob</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> Single surface is way faster when anything less than 2,000 polys...<br><br>There are many ways to do single surface.<br><br>Debug mode drastically slows down with typical single surface demos. Check your debug mode... <br><br></td></tr></table><br>
<a name="432229"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jeremy Alessi</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ah debug ... that was it then.  But what about the the vertex alpha sort issues ... did anyone else experience those? <br><br></td></tr></table><br>
<a name="432233"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rob</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> vertex alpha is sortable but usually you will just have different systems using different meshes. one mesh per emitter is sufficient. This usually sidesteps alpha issues.<br><br>You can sort by building your meshes in order but it will be complex code. <br><br></td></tr></table><br>
<a name="432235"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Beaker</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> Jeremy - here is one solution to your sort problems:<br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=850" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=850</a> <br><br></td></tr></table><br>
<a name="432251"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> Use one mesh per emitter and each frame clear the triangles in the mesh and create new ones in the right order.  Or, keep the triangles attached to the same vertices, but change the vertex color/alpha/uv coordinates every frame for each particle.  As the ENTIRE mesh gets uploaded to the 3D card every time you change even one value, you're not likely to get much savings by trying to avoid updating certain data in the mesh. <br><br></td></tr></table><br>
<a name="432286"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Vertex alpha causes major sort issues that I don't see with regular sprites. How do you get around that one? <br></div><br><br>Add them to the surface in order of either the inverse Z-distance (this is usually faster but has some graphical side effects that go with it- minor, but they're there), or the inverse squared distance.  Goes like this, add closest first, farthest last.  Or maybe it was the other way around, I haven't had to write a single surface system in a while, so it left my mind. <br><br></td></tr></table><br>
<a name="432343"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jeremy Alessi</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's not only vertex sort issues with itself ... it's issues with other alpha'd objects.  It actually came up because I was using it in Leadfoot GT and the fence was behind the particles but the particles appeared behind the fence. <br><br></td></tr></table><br>
<a name="432358"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> "It's not only vertex sort issues with itself ... it's issues with other alpha'd objects. It actually came up because I was using it in Leadfoot GT and the fence was behind the particles but the particles appeared behind the fence."<br><br>If the center of the mesh containing the particles is nearer to the camera than the fence, then they will be rendered in front of the fence.  Otherwise, they will be rendered behind it.  If some particles are in front and some behind they'll all render on one side or the other depending on where the center of the mesh is.<br><br>This is not the fault of Blitz, it's a problem with how 3D cards render transparent things.  It'll be fixed in a few years, but for now, you're stuck with using tricks to try to avoid the problem.<br><br>If you have water and your particles are rendering behind it when they are over it, and you don't need the particles to render properly underwater, then you could place the center of the mesh containing the water plane really far underground, and just have the surface of the water above the ground.  For a fence though, you'll have to use masking instead of alpha.  Masked objects are treated as opaque because there are no partially transparent pixels. <br><br></td></tr></table><br>
<a name="432360"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jeremy Alessi</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nah, the particles were in front of the fence ... the center of the mesh ... should have been.  Hmmm... maybe the mesh is just at 0,0,0.  We had this problem in AA though with chunks way out in the desert.  Adrian used Vertex Alpha to blend them into the distance and they would appear in front of our alpha PNG fences even though they were a mile behind.  Anyway ... it looks stupid and is kinda unavoidable in certain situations. <br><br></td></tr></table><br>
<a name="432400"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> When moving your emittor centre, move the mesh of particles to the emittor centre using the PositionMesh command. And remember vertexX() and such return the co-ords relative to the meshes co-ords. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
