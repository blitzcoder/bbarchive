<!DOCTYPE html><html lang="en" ><head ><title >Big NAN Troubles ...</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Big NAN Troubles ...</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Big NAN Troubles ...</a><br><br>
<a name="480401"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> An Owner of a GeForce FX5600 reported a bugous behaviour of one of my products: While my App only does a:<br><br>Text 0,0,EntityX(player,1)...<br><br>His Machine sometimes writes "NAN" (not a number) to the screen, instead of the current position. It also seems like he was kicked out of his location without any reason after a mouse movement, and ends up in the darkes space (tho I use the MouseSpeed funtion only for rotation).<br><br>I haven't be able to reproduce thie NAN thing on my machine, is this something GeForce specific, or maybe a Driver Version thing?<br><br>Thanks. <br><br></td></tr></table><br>
<a name="480410"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> As far as I can see, that Text command should never produce a NaN. :/ <br><br></td></tr></table><br>
<a name="480423"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DJWoodgate</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah, but entityX with a global transform might.  Not enough information to say what is causing it, though I will hazard a guess that maybe it is the mouse driver.  If for some insane reason mousespeed is returning NaN (or maybe infinity which would probably screw you up as well) at least it is something you can easily check for and reject if it occurs. <br><br></td></tr></table><br>
<a name="480426"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> well, especially the EntityX() command shouldn't. can it be that some kind of division by near-zero that took place at an other place would force DX to return NaNs everywhere? <br><br></td></tr></table><br>
<a name="480427"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> DJW - you mean if I use the Mousespeed for the rotation, it may give me a Nan in the Position? <br><br></td></tr></table><br>
<a name="480429"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DJWoodgate</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes my point is the use of global will mean it has to use the global transform matrix.  And if you start feeding that with Nan and infinity it gets very sick very quick.  I have not actually tried rotateentity with Nan and Infinity, but I doubt it would be pretty.<br><br>Not saying that is the reason though, it is just a guess. There could be other reasons, but since it does not occur on your machine and it does on his and this happens when he uses the mouse... <br><br></td></tr></table><br>
<a name="480432"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks a lot. I'll check this out. I guess I got to find the source of the NaN first. Can be hard when it happens on someone elses machine only :/ <br><br></td></tr></table><br>
<a name="480434"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DJWoodgate</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, but... The only flaw to that idea though that just occured to me is that Mousespeed should only return an int, and so you can not get NaN or infinity out of it no matter how hard you try. :( <br><br></td></tr></table><br>
<a name="480440"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I never had any problems with MouseSpeed, but I'll try it anyway.<br><br><pre class=code>
zero#=0.0
nan#=zero/zero
if mouseXspeed()=nan then runtimeerror "gotcha, bugger!"
</pre><br><br>or something like that. Well, infact I will also test other values with it, including the FpS calculation, that may do weird things when vsinc is deactivated and no geometry is loaded. <br><br></td></tr></table><br>
<a name="480452"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> I got NaN's alot with my entity positioning over a networked game. It turned out i was accidentally, exponentially accelerating it :S <br><br></td></tr></table><br>
<a name="480454"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DJWoodgate</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Are you feeding a raw mousespeed into rotateentity or are you scaling it first?  Maybe the scalefactor is being set to zero for some reason producing Infinity.  Not very likely though, grasping at straws now :)<br><br>Anyway I have just confirmed that if say you are rotating a pivot which is the parent of player and you feed that Nan or Infinity then the global position of player will be reported as Nan as I suspected.<br><br>So you may want to test for infinity as well, or at least division by zero. Ross has a point as well, look out for overflow producing Infinity.<br><br>BTW. I think it was Michael Reitzenstein who posted a neat way to define NaN and Infinity as constants...<br>Const Infinity# = (999.0)^(99999.0), NaN# = (-1.0)^(0.5) <br><br></td></tr></table><br>
<a name="480671"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Now I think it may have something to do with the FPS calculation. The current fps# is then used to create a movement speed factor to move things framerate independently. Now when the user is looking away from the scene, watching the dark nothing, and assuming he has - for some reason - deactivated VWait in the DX settings, the framerate may jump up to hundreds or even thousands (tho I use Flip True, but maybe the DX Settings affect this as well?). This probably may result in a NaN and explain why the mousemovement affects the position. Probably I will add a limiter, something like "if frametime &lt; 10ms then wait for some time" to prevent this.<br><br>Well at least it seems like I'm gonna hunt this bug down soonish.<br><br>Those Constants didn't work for me, when I print them out, it only says 0.0 or 1.0, But when I use:<br><br>global zero#=0.0<br>global nan#=zero/zero<br>print nan<br><br>surprisingly it wont result in a division by zero exception, but print "NaN" to the screen. so infact I can use it to effectively recognize a NaN. <br><br></td></tr></table><br>
<a name="480685"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DJWoodgate</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>Those Constants didn't work for me, when I print them out, it only says 0.0 or 1.0, But when I use: <br> <br></div><br>Hmm, now that is odd, they work here.  Another mystery! Guess I will have to start using the other method again maybe this one is somehow CPU specific. (Edit - they seem to work fine here on Intel (Win 2004) and AMD (Win 98) processors ??).<br><br>Anyway pleased to hear you may have found the source of the problem and it is not specifically related to the Gforce. As you say if they had disabled the wait for Vsync this will override Flip true and it will probably give some massive FPS when there is not much to be rendered. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
