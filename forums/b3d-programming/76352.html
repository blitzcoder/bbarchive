<!DOCTYPE html><html lang="en" ><head ><title >Finding Child coordinates relative to parent?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Finding Child coordinates relative to parent?</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Finding Child coordinates relative to parent?</a><br><br>
<a name="853573"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hosh</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is there any way to find a child's relative coordinates to the parent object???<br><br>My model ship.3ds is composed of several child entities.  I would like bullets to shoot from the location of certain child entities.  The only problem is that children entities take on the coordinates of the parent entity. <br><br>So when I copy a bullet sprite and name the gun child as its parent, the bullet appears from the center of gun's parent, and not from gun.<br><br><pre class=code>CopyEntity( bullet_sprite, gun )    ; Doesn't work...</pre><br><br>So then I tried adding... (b is the bullet type)<br>	<pre class=code>PositionEntity b\sprite, EntityX(gun,True), EntityY(gun, True), EntityZ(gun,True)</pre><br>The hope was to position the bullet at the true coordinates of gun, but really this just caused the bullet to appear farther and farther away from the ship when I moved it farther from the world center (0,0,0).<br><br>There was no chance to succeed. Looking at my debuglog, EntityX(gun,True) was the same value as EntityX(Ship)<br><br>I even tried disconnecting the gun child from ship by assigning it nothing as a parent.<br><br><pre class=code>	EntityParent gun, 0 </pre><br><br>But this had the exact same effect as the previous fix.  The farther I moved the ship from the world center the farther the bullets began to form away from the ship.<br><br>So... <br><br>Is there anyway to find a child's relative coordinates to the parent object (via local coordinate system or whatever)??? <br><br></td></tr></table><br>
<a name="853579"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >mtnhome3d</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> if you look in the samples, in the mak directory there's a folder called anim. In side that theres a folder called makbot. the .bb fie shows how to get the locations of different meshes inside one big ine. <br><br></td></tr></table><br>
<a name="853587"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> entityx, entityy, entityz are always relative to parent unless you specify the "global" parameter to be true. <br><br></td></tr></table><br>
<a name="853604"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hosh</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Mayaman,<br>The anim example in the mak directory is exactly what I needed.  <br><br>Unfortunately, I was surprised to find that my code is basically identical (except for variable names, etc.).  How strange.<br><br>I think my problem has to do with the child hierarchy of my model.   I made it in Anim8or.  Hmmm... I just don't know...  I'll have to play with it some more I guess.<br><br>Dreamora,<br>Yeah, I tried setting the global parameter to true.  Didn't' work very well.  Made the bullets start appearing farther and farther away from the ship the farther I flew away from the world center (0,0,0). <br><br></td></tr></table><br>
<a name="853612"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, as dreamora say, just use entityx() entityy() and entityz() if you want the positions relative to the parent. DON'T use the TRUE flag though, as that will give you world co-ords.<br><br>But, i'm confused... Surely you'd want the world co-ords so you could place the bullet at the exact same world co-ords as the gun?<br><br>Rememeber, if you using positionentity on a child entity:<br><br><pre class=code>
PositionEntity Bullet, EntityX(gun,true), EntityY(gun,true), EntityZ(gun,true) , TRUE
</pre><br><br>You need the TRUE flag on the end of the positionentity command so it will PLACE the entity in the world co-ords, and not it's parents co-ords. <br><br></td></tr></table><br>
<a name="855302"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hosh</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Gun's position relative to the parent ship is 0,0,0.  So it's located right on the center pivot.<br><br>===DEBUG===<br>EntityX(gun) = 0<br>EntityY(gun) = 0<br>EntityZ(gun) = 0<br><br>EntityX(gun, true) = Current global X of the parent ship is.<br>EntityY(gun,true) = same for Y<br>etc.<br><br>Perhaps if I gave it its own pivot it could have local co-ords different than the global co-ords of the parent?  <br><br>It's very frustrating because looking at the mak sample code, what everyone has suggested should work.<br><br><pre class=code>
mak=LoadAnimMesh( "mak_running.3ds" )
eyepos=FindChild(mak,"eye")
eyeflare=CopyEntity(flare,eyepos)
</pre><br><br>I do the same thing.  <br>p\entity is the ship's handle.<br>gun is the name of the child (e.g. "left_gun")  <br>b\sprite is the sprite graphic of my bullet type<br><pre class=code>
weapon = FindChild(p\entity, gun)
b\sprite=CopyEntity( bullet_sprite, weapon )
</pre><br><br>But that doesn't work. <br>The co-ords of gun on my model are the same as the parent.<br>The co-ords for flare on the mak model are different than the parent.<br><br>Thus, using PositionEntity with the True global flag set does not help.  Gun's local co-ords are 0,0,0.<br>		<br>So that seems to be the root of the problem.<br><br>My model is faulty.  The gun child's local co-ords are 0,0,0.  This should not be.<br><br>If I import the mak model into Anim8or, change nothing, save it, and export it back into the mak sample folder.  The flare is no longer properly positioned at the eye child's position.  eye's local co-ords become 0,0,0.  <br><br>Here it is visually<br><img src="http://www.crestfallen.us/3d/mak1.GIF"><br><img src="http://www.crestfallen.us/3d/mak2.GIF"><br><br>Before I did this, eye's local co-ords actually gave the true local position from mak's main pivot.<br><br>So I am more certain than ever that this is Anim8or issue.    What do you guys use to model? <br><br></td></tr></table><br>
<a name="855326"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >mtnhome3d</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> personally i use maya but thats sorta expensive. i like ac3d and milkshape. <br><br></td></tr></table><br>
<a name="855386"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> You are using positionentity and not moveentity i assume?<br><br>Can you show us your whole code for this. It helps to see if something else isn't set right :o) <br><br></td></tr></table><br>
<a name="855633"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hosh</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> <pre class=code>
Function CreateBullet.Bullet( p.Player, w.Weapon, gun$ )
  
		b.Bullet=New Bullet
		b\shooter = p\entity

		weapon = FindChild(p\entity, gun)
		b\sprite=CopyEntity( bullet_sprite, weapon ) 
                PositionEntity b\sprite, EntityX(gun,True), EntityY(gun,True), EntityZ(gun,True), True
	
		b\speed = w\speed

	        MoveEntity b\sprite, 0,0,(b\speed*FL\SpeedFactor)*5
		EntityParent b\sprite,0
		EmitSound shoot,b\sprite
		Return b
		
End Function

</pre> <br><br></td></tr></table><br>
<a name="855654"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Your finding the child every time you create a bullet? Once you find a child, i'm sure it gets removed from the child list. I'm not sure about that, but i recommend you only do findchild ONCE.<br><br>This line:<br><br><pre class=code>
weapon = FindChild(p\entity, gun)
</pre><br><br>Should probably be just after your load your mesh. Assign weapon to a Global variable too. <br><br></td></tr></table><br>
<a name="987282"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Dreamora:<br><br><div class="quote"> <br>entityx, entityy, entityz are always relative to parent unless you specify the "global" parameter to be true.  <br></div><br><br>Thats interesting, then further on Ross C states that it will give you world co-ords. <br><br></td></tr></table><br>
<a name="987414"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> I said don't use the true flag to get the co-ords relative to the parent, but use the true flag to position the entity in global space, rather than  local to the parent. Shows how good my memory is though. I have no recollection of typing these replies :) <br><br></td></tr></table><br>
<a name="987418"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the extra clarification Ross, when I was initially reading the thread I was still getting a handle on Entity manipulation areas.<br><br>. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
