<!DOCTYPE html><html lang="en" ><head ><title >Why does this code go so slowly?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Why does this code go so slowly?</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Why does this code go so slowly?</a><br><br>
<a name="451736"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rottbott</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is really puzzling me. My timing code is left in. Mostly it outputs 0 or 1 for the time elapsed, but every now and then I get an 11 or 12, which seems WAY too long for this simple bit of code. Any suggestions?<br><br><pre class=code>MS = MilliSecs()

    ; Increase delay counters for all removed clients
    For i = RN_DelayLoop To RN_DelayLoop + 500
      If H\Clients[i] &lt; 0 Then H\Clients[i] = H\Clients[i] + 1
    Next
    RN_DelayLoop = RN_DelayLoop + 501
    If RN_DelayLoop &gt;= RN_MaxClientID
      RN_DelayLoop = 0
    ElseIf RN_DelayLoop &gt; RN_MaxClientID - 500
      RN_DelayLoop = RN_MaxClientID - 500
    EndIf

MS = MilliSecs() - MS
If MS &gt; 2 Then DebugLog MS</pre><br><br>EDIT: Something else that's weird. As you can see, the code is some network code (from a new version of RottNet as a matter of fact). When a run a client and join the server, this same bit of code starts taking 200 milliseconds! That's really ridiculous. I can see why running another program at the same time will slow my server program down, but 200 milliseconds for that simple bit of code is far too long. <br><br></td></tr></table><br>
<a name="451738"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> can't see anything slow there- its something running outside of blitz, probably..... <br><br></td></tr></table><br>
<a name="451740"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rottbott</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I just edited with a new observation.<br><br>Also, when my client is running, the overall RottNet update on the server starts taking up to 4000 milliseconds! Something is badly wrong here. The client itself runs at 250 FPS no problem.<br><br>EDIT: I think it must be something to do with BlitzPlus being too nice about CPU time. (The server is B+, client B3D.) I noticed the client uses 98% CPU, and the server uses 0-2%.<br>Also it runs a lot faster with debug off - perhaps it was doing bounds checking on that Blitz array when debug was on? That might explain some of the slowness. <br><br></td></tr></table><br>
<a name="451745"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> <pre class=code>
For i = RN_DelayLoop To RN_DelayLoop + 500
      If H\Clients[i] &lt; 0 Then H\Clients[i] = H\Clients[i] + 1
    Next
</pre><br><br>What sorta values does "rn_delayloop" reach? <br><br></td></tr></table><br>
<a name="451755"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rottbott</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> 9,500<br><br>Whatever it is though, the loop only iterates 500 times. <br><br></td></tr></table><br>
<a name="451783"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TomToad</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Actually, it loops 501 times.  it loops with i = RN_DelayLoop for the first loop, then i = RN_DelayLoop+1 for the second loop, i = RN_DelayLoop+2 for the third, etc... all the way to i = RN_DelayLoop+500 for the 501st loop.<br>Although I cannot see that as being the cause of the slowdown, unless you're accidentally writing to an extra byte that's out of range which I would think would be caught by the debugger.<br>If you want it to iterate exactly 500 times, the command should read For i = RN_DelayLoop to RN_DelayLoop + 499. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
