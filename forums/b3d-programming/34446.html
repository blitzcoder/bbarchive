<!DOCTYPE html><html lang="en" ><head ><title >Deforming Vertices randomly</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Deforming Vertices randomly</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Deforming Vertices randomly</a><br><br>
<a name="372250"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just toying with some ideas...<br>I am just getting to grips with code-based 3D mesh altering functions, and I am wondering if it's possible to take a cube, then, on one face of this cube, 'morph' the flat side into a jaggedy, 'natural' shape using random values.<br><br>I have only thought about this so far, and haven't touched any code, but I can see some potential issues...<br><br>1) This wont work with a Primitive, because primitives only have two triangles per face (or could extra triangles be created within the morphing process???)<br><br>2) The morphing needs to be congruent with adjacent cubes eventually***<br><br>3) The morphing needs to be 'aware' of whether the face is vertical or horizontal, as stalagmites etc. would be more prominent on 'floor' cubes than 'wall' cubes.<br><br>*** The idea behind this, is to create a 'dungeon map' designer, that shows a theoretical 3D view of the dungeon. To make cavernous walls look better, but to account for enormous variety, I envisioned using simple cubes, then with the faces morphed to look less regular. Exact repetition is not necessary (though could be achieved with a specific 'seed' value. <br><br></td></tr></table><br>
<a name="372268"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> you can introduce new triangles in the morphing if you created the cube from the scratch not using blitz3ds function for creation of it.<br><br>you might check the clearsurface command, where you will see that you can delete all triangles from a surface -&gt; you can recreate them with some new triangles to change the mesh during deformation <br><br></td></tr></table><br>
<a name="489538"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I still haven't got the hang of this.<br><br>I understand I need to create vertices instead of using Primitives (I guess because Primitive's faces use just 2 large tris, limiting the amount of morphing that is possible.)<br><br>If I explain what I am trying to do:<br><br>I wish to create a cavernous environment, however, this will be based on a squared map. To stop the 'walls' from looking too square, and introduce some degree of randomness( that a word?), I wish to deform the faces of the cubes by random amounts to appear more natural. This doesn't need to be especially fast, as it will be done and finished with upon initial level creation.<br><br>In fact, if I am not using primitive cubes, then just the outward facing quads need to be created. The main problem, is ensuring the angles of tris at the edges of adjacent quads match up. I don't want to have gaps.<br><br>I have no clue as to how to do any of this :( All my projects so far have relied on 3rd-party meshes and primitives, I wouldnt know where to start on creating my own, nor knowing how to find the angles of each tri. <br><br></td></tr></table><br>
<a name="489540"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rob Farley</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> This may help.<br><br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=1120" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=1120</a> <br><br></td></tr></table><br>
<a name="489541"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Doh!<br><br>I only looked at that the other day for incorporating into Galactic Allegiance (don't worry, full credit will be given!)<br><br>Thanks, Rob!<br><br>I should've thought it's the same principle!<br><br>Q:<br>Am I right to assume it is this line that deals with the actual amount of morphing?<br><br><pre class=code>
VertexCoords as1,nn,vpos(nn,0)+xm,vpos(nn,1)+ym,vpos(nn,2)+zm
			vpos(nn,3)=1
</pre><br><br><br>And how do I ensure it will line-up with the verts next-door?<br><br>----------edit: just read <div class="quote"> <br>The 'clever' bit is it checks all the verts that are joined together first so you don't get cracks and stuff. <br> <br></div>!!! <br><br></td></tr></table><br>
<a name="489549"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >puki</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Mmm, I think you need a mesh tube and a sweeping deformation algo - I have seen mesh tubes the code archives before.  The hard bit will be doing the algo, but it would make life easier - you'd just sweep through the tube from one end to the other altering the surface - taking into account that you will probably want to make the floor a bit flatter.  Creating the algo would be the hardest bit - but you could create more than one to sweep through - maybe flatten the floor first, then re-sweep and make the walls a bit more uneven, another sweep to do stalagmites/stalacties, etc. and maybe, when you have got them all worked out, then combine them into one sweep.<br><br>In fact, I think there is a piece of code that deforms a tube into a 'breathing' motion - it might be in the 3D samples folder - I'll take a look.<br><br>EDIT:<br>Yep - "halo" did it 'Mesh deformation demo' (meshfx.bb).  Take a look at it - obviously he deforms it uniformally, but you get the idea. <br><br></td></tr></table><br>
<a name="489550"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> that sounds a bit more complex than I think I need, puki - but thanks!<br><br>In fact, to make life easier, the floor can remain flat with some customised meshes. I still dunno if there will actually BE a cieling or not yet. Il have a look at halo's code...<br><br>________________________________________________________<br><br>um... got a link, there, puki? I searched the code arcs, the tutorials and all sorts for it... <br><br></td></tr></table><br>
<a name="489556"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >puki</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's in your B3D 3D samples folder in "halo's" folder - it's called 'MeshFX'. <br><br></td></tr></table><br>
<a name="489569"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> So, you basically want to do a tile map, but in 3D using cube 'tiles'?<br><br>I think the easiest way to ensure that all adjacent cube faces 'fit together' is to have all edge vertices shared with the cube it's touching. That way, any alterations to the edge verts will automatically deform the cube face it's touching. If you see what I mean. :P <br><br></td></tr></table><br>
<a name="489618"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BlackJumper</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> I would recommend that you have a look at big10p's exploding mesh demo in the code arcs...<br><br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=680" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=680</a><br><br>The code contains a function to subdivide a mesh. {Strictly speaking it makes an unwelded copy of the mesh and subdivides that to a user-controlled degree.} I have managed to get this to operate on B3D primitives by looping through the surfaces and vertices... here to individually colour each face:<br><pre class=code>Case 6
	shape = CreateCube()
	EntityFX shape, 2
			
	DebugLog "surfaces of cube = " + CountSurfaces(shape)

	For n = 1 To CountSurfaces(shape)
		surf = GetSurface(shape, n)
		DebugLog n + "    number vertices = " + CountVertices(surf)
		verts = CountVertices(surf)

		For v = 0 To CountVertices(surf)
			Select Int(v / 4)
				Case 1 VertexColor surf, v, 0, 0, 255
				Case 2 VertexColor surf, v, 0, 255, 0
				Case 3 VertexColor surf, v, 255, 0, 0
				Case 4 VertexColor surf, v, 255, 255, 0
				Case 6 VertexColor surf, v, 255, 0, 255
				Case 0 VertexColor surf, v, 0, 255, 255
				End Select

			Next
		Next
				
		UpdateNormals shape
</pre><br><br>However, it may just be simplest to create your own primitives from the outset. Dave Bird has code in the codearcs to create a cube from six faces. <br><br></td></tr></table><br>
<a name="489778"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Take a look at bezier patches if you would like the scene to be more organic. There are a few good tuts on GameDev. Basically you set up 9 control points per cube face and then create a patch using interpolation. <br><br></td></tr></table><br>
<a name="489779"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm all still seems a little involved. Il have a go and see what I can do!<br>Thanks, peeps! <br><br></td></tr></table><br>
<a name="490200"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Puki -  I am currently having to work from just the demo version of B3D until I get my computer set up at home. The demo version doesnt have that file included unfortunately.<br><br>Stevie G, I understand Beziers are like smooth curves. I think I see what you mean, and yeah, the end result would make some great looking caverns, but it's way beyond my capabilities right now!<br><br>I combined Rob Farley's "Asteroid" code, and Dave Bird's "Segmented Cube" code, but it only seems to deform one face (typically the one facing vertically down), Not too sure what to do with it. Sorry I know Im being a pain with this, I never realised such a simple concept could get so involved!<br><br>Here's what I have so far:<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Graphics3D 800,600

SetBuffer BackBuffer()


;*****************************INITIALISE******************************

cam=CreateCamera()

CameraViewport cam,0,0,800,600

;****************************BUILD ARRAYS *****************************

Dim vpos#(1,1)
Dim Map(100)

;***************************CREATE QUICK RANDOM MAP**********************


	For f= 1 To 100

		Map(f)=CreateWall()
		
		tt=LoadTexture("t.bmp")

		EntityTexture Map(f),tt
		
		Morph(Map(f))
				
		PositionEntity Map(f),Rand(-20,20),0,Rand(-20,20)
	Next

;*************************** MAIN LOOP ****************************
While Not KeyDown(1)

If KeyDown(200) Then MoveEntity cam,0,0,0.2
If KeyDown(208) Then MoveEntity cam,0,0,-0.2

If KeyDown(205) Then TurnEntity cam,0,-1,0
If KeyDown(203) Then TurnEntity cam,0,1,0

UpdateWorld
RenderWorld

Flip

Wend
End

;*******************************************FUNCTIONS************************



















Function CreateWall()

;*****************************CREATE SEGMENTED CUBE FROM 6 SIDES **************

	mesh=CreateMesh()
	
	segs=3
	
	For scnt=0 To 3
		surf=CreateSurface( mesh )
		stx#=-.5
		sty#=stx
		stp#=Float(1)/Float(segs)
		y#=sty
		For a=0 To segs
			x#=stx
			v#=a/Float(segs)
			For b=0 To segs
				u#=b/Float(segs)
				AddVertex(surf,x,y,0.5,u,v)
				x=x+stp
			Next
			y=y+stp
		Next
		For a=0 To segs-1
			For b=0 To segs-1
				v0=a*(segs+1)+b:v1=v0+1
				v2=(a+1)*(segs+1)+b+1:v3=v2-1
				AddTriangle( surf,v0,v1,v2 )
				AddTriangle( surf,v0,v2,v3 )
			Next
		Next
		RotateMesh mesh,0,90,0
	Next
	;top and bottom
	RotateMesh mesh,90,0,0
	For scnt=0 To 1
		surf=CreateSurface( mesh )
		stx#=-.5
		sty#=stx
		stp#=Float(1)/Float(segs)
		y#=sty
		For a=0 To segs
			x#=stx
			v#=a/Float(segs)
			For b=0 To segs
				u#=b/Float(segs)
				AddVertex(surf,x,y,0.5,u,v)
				x=x+stp
			Next
			y=y+stp
		Next
		For a=0 To segs-1
			For b=0 To segs-1
				v0=a*(segs+1)+b:v1=v0+1
				v2=(a+1)*(segs+1)+b+1:v3=v2-1
				AddTriangle( surf,v0,v1,v2 )
				AddTriangle( surf,v0,v2,v3 )
			Next
		Next
		RotateMesh mesh,180,0,0
	Next
	UpdateNormals mesh

Return mesh
End Function


;**************************MORPH VERTS*****************************

Function Morph(mesh)

surftotal=CountSurfaces(mesh)

For xx= 1 To surftotal
as1=GetSurface(mesh,xx)

; record the locations of the verts
Dim vpos#(CountVertices(as1)-1,3)
For n=0 To CountVertices(as1)-1
	vpos(n,0)=VertexX(as1,n)
	vpos(n,1)=VertexY(as1,n)
	vpos(n,2)=VertexZ(as1,n)
	vpos(n,3)=0
Next

For n=0 To CountVertices(as1)-1

; change these to make it more or less messy
xm#=Rnd(-.3,.3)
ym#=Rnd(-.0,.0)
zm#=Rnd(-.3,.3)

	For nn=0 To CountVertices(as1)-1
	
	; if the vert has not been monkeyed with monkey away
	If vpos(nn,3)=0
		If vpos(n,0)=vpos(nn,0) And vpos(n,1)=vpos(nn,1) And vpos(n,2)=vpos(nn,2)
			VertexCoords as1,nn,vpos(nn,0)+xm,vpos(nn,1)+ym,vpos(nn,2)+zm
			vpos(nn,3)=1
			EndIf
		EndIf
		
	Next
Next

Next

Return mesh

End Function


</textarea><br><br><br>_________________________________EDIT__________________________________<br><br><br><br>Ive amended the code. Ive kinda got it sussed, only because CopyMesh would need retexturing and remorphing, and CopyEntity would result in identical blocks, I have simply created a new block for every map position. This shouldnt be much of a problem, graphics memory wise, and I hope to occlude more distant blocks eventually for rendering speeds etc. As I trial, I am quite pleased so far, although I still need to determine how to match the split edges up... <br><br></td></tr></table><br>
<a name="490294"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Malice,<br><br>Why not addmesh a clump of deformed cubes?  The way your doing this would generate far too many surfaces which would be a frame rate killer!! <br><br></td></tr></table><br>
<a name="490320"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >puki</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Don't alter the verts at the edges is your answer.<br><br>However, if you want uneven edges then you will have to see where vertices pair and them move them accordingly.  You can automate this - but you'll probably have to sit there working out the coords.  Once you have paired them - you are laughing.<br><br>Try doing it manually first.  Just create a 2-sided cube and work on how you can alter the edge of one face first - then look at how you have to move the edge of the adjoining side to join it - you'll see a pattern (in 3D space) - once you have worked out the pattern you can automate it - you then just optimise it for the other sides (assuming you retain your 'block' structure).<br><br>Ps - "StevieG" is right - you might  consider a cube structure with 2 sides facing inwards and build your levels that way - you may not need to be using 4 sides - depends on what you have on the other side of the walls. <br><br></td></tr></table><br>
<a name="490545"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah, seeing as the texture will always be the same for these 'cubes', minimising the surface count with AddMesh should be better.<br><br>Yeah, Optimising the cubes with regaards to non-visible faces is also an important consideration. Especially the top and bottom of the 'cubes' these I think will never be seen.<br><br>puki, the idea of pairing the verts is something I wouldn't know where to start, especially considering the random nature of the deformations. Not affecting the tris along the edge did cross my mind, but then the meshes would lose a lot of their 'caverny' feeling.<br><br>Here's my code so far, with step-by-step movement and torchlighting (the code needs two texture files in the root folder t.bmp and floor.bmp)<br><br><pre class=code>
Graphics3D 800,600

SetBuffer BackBuffer()


;*****************************INITIALISE******************************

AmbientLight 150,150,150

cam=CreateCamera()

CameraViewport cam,0,0,800,600
CameraRange cam,0.01,100

CameraFogMode cam,1
CameraFogColor cam,1,1,1
CameraFogRange cam,-20,20


camlight=CreateLight(2)
EntityParent camlight,cam,1

LightRange camlight,1
;****************************BUILD ARRAYS *****************************

Dim vpos#(1,1)
Dim Map(200)

;***************************CREATE QUICK RANDOM MAP**********************


Fl=CreatePlane()
MoveEntity fl,0,-1,0
ft=LoadTexture("floor.bmp",1)

EntityTexture Fl,ft


	For f= 1 To 200

		Map(f)=CreateWall()
		
			If f&gt;1
				AddMesh Map(f),Map(f-1)
			EndIf
		
		tt=LoadTexture("t.bmp",9)

		EntityTexture Map(f),tt
		
		Morph(Map(f))
				
		PositionEntity Map(f),Rand(-15,15),0,Rand(-15,15)
	Next

;*************************** MAIN LOOP ****************************

timer=MilliSecs()

While Not KeyDown(1)

If KeyDown(200) Then walkforward(cam)
If KeyDown(208) Then walkbackward(cam)

If KeyDown(203) Then turnleft(cam)
If KeyDown(205) Then turnright(cam)


;*************************TORCHLIGHT*******************************
LightColor camlight,Rand(150,200),Rand(170,220),100

;*************************COUNT FRAMES*****************************

fpscount=fpscount+1

	If (MilliSecs()-timer)&gt;=1000
		timer=MilliSecs()
		fps=fpscount
		fpscount=0
	EndIf

render()

Wend
End

;*******************************************FUNCTIONS************************




Function walkforward(entity)

For f= 1 To 10 

MoveEntity entity,0,0,0.1

render()

Next
End Function




Function walkbackward(entity)

For f=1 To 10

MoveEntity entity,0,0,-.1

render()

Next
End Function


Function turnleft(entity)

For f=1 To 20

TurnEntity entity,0,4.5,0

render()

Next

End Function


Function turnright(entity)

For f=1 To 20

TurnEntity entity,0,-4.5,0

render()

Next

End Function







Function CreateWall()

;*****************************CREATE SEGMENTED CUBE FROM 6 SIDES **************

	mesh=CreateMesh()
	
	segs=3
	
	For scnt=0 To 3
		surf=CreateSurface( mesh )
		stx#=-.5
		sty#=stx
		stp#=Float(1)/Float(segs)
		y#=sty
		For a=0 To segs
			x#=stx
			v#=a/Float(segs)
			For b=0 To segs
				u#=b/Float(segs)
				AddVertex(surf,x,y,0.5,u,v)
				x=x+stp
			Next
			y=y+stp
		Next
		For a=0 To segs-1
			For b=0 To segs-1
				v0=a*(segs+1)+b:v1=v0+1
				v2=(a+1)*(segs+1)+b+1:v3=v2-1
				AddTriangle( surf,v0,v1,v2 )
				AddTriangle( surf,v0,v2,v3 )
			Next
		Next
		RotateMesh mesh,0,90,0
	Next
	;top and bottom
	RotateMesh mesh,90,0,0
	For scnt=0 To 1
		surf=CreateSurface( mesh )
		stx#=-.5
		sty#=stx
		stp#=Float(1)/Float(segs)
		y#=sty
		For a=0 To segs
			x#=stx
			v#=a/Float(segs)
			For b=0 To segs
				u#=b/Float(segs)
				AddVertex(surf,x,y,0.5,u,v)
				x=x+stp
			Next
			y=y+stp
		Next
		For a=0 To segs-1
			For b=0 To segs-1
				v0=a*(segs+1)+b:v1=v0+1
				v2=(a+1)*(segs+1)+b+1:v3=v2-1
				AddTriangle( surf,v0,v1,v2 )
				AddTriangle( surf,v0,v2,v3 )
			Next
		Next
		RotateMesh mesh,180,0,0
	Next
	UpdateNormals mesh

Return mesh
End Function


;**************************MORPH VERTS*****************************

Function Morph(mesh)

surftotal=CountSurfaces(mesh)

For xx= 1 To surftotal
as1=GetSurface(mesh,xx)

; record the locations of the verts
Dim vpos#(CountVertices(as1)-1,3)
For n=0 To CountVertices(as1)-1
	vpos(n,0)=VertexX(as1,n)
	vpos(n,1)=VertexY(as1,n)
	vpos(n,2)=VertexZ(as1,n)
	vpos(n,3)=0
Next

For n=0 To CountVertices(as1)-1

; change these to make it more or less messy
xm#=Rnd(-.2,.2)
ym#=Rnd(-.0,.0)
zm#=Rnd(-.2,.2)

	For nn=0 To CountVertices(as1)-1
	
	; if the vert has not been monkeyed with monkey away
	If vpos(nn,3)=0
		If vpos(n,0)=vpos(nn,0) And vpos(n,1)=vpos(nn,1) And vpos(n,2)=vpos(nn,2)
			VertexCoords as1,nn,vpos(nn,0)+xm,vpos(nn,1)+ym,vpos(nn,2)+zm
			vpos(nn,3)=1
			EndIf
		EndIf
		
	Next
Next

Next

Return mesh

End Function


Function render()

UpdateWorld
RenderWorld

Text 0,100,"POLYS: "+TrisRendered(),0,1

Text 0,200,"FPS: "+fps,0,1


Flip

End Function
</pre><br><br><br>----------------Now I seem to have a problem that the 'timer' variable doesn't = millisecs at the start(?) it maintains a 'null' value, so my framecounter doesn't work here. <br><br></td></tr></table><br>
<a name="490585"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> At a glance you haven't made FPS global so will be 0 in the render function. <br><br></td></tr></table><br>
<a name="490592"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> That was it! Cheers! This is also my first real use of Functions, Ive usually jsut repeated code or used *eek!* subroutines. (bad programmer bad programmer) So not being able to declare the vars unless outside the routines is taking a little getting used to. Still Im getting there!<br><br>I've removed the (kindly anotated) mesh building section for the top and bottom of the walls, which helps a lot. I notice the Tris are still rendered even if invisible due to camera fog, this seems a little pointless, but I need to work on an occlusion routine anyway... oh well... no rest for the wicked... <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
