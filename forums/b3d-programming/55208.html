<!DOCTYPE html><html lang="en" ><head ><title >Entitypickmode affects childs entities?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Entitypickmode affects childs entities?</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Entitypickmode affects childs entities?</a><br><br>
<a name="614638"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Pinete</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi all,<br><br>Could someone please solve this little question?<br>I'm trying to setup a enemy as a 'pickable' entity.<br><br>The entity is a .B3D animated model with a scene root and some chidrens depending of it (arms, body, legs, etc...)<br><br>When I create the enemy I use the next...<br><br>...<br>enemy\entity = loadanimmesh("enemy.b3d")<br>enemy\root   = finchild(entity,"SceneRoot")<br>...<br>...<br><br>then I have doubts about how to do the picking setup:<br><br>a) entitypickmode enemy\entity,2<br>or<br>b) entitypickmode enemy\root,2<br><br>What option should be the correct one?<br><br>...or maybe we need to make all the childs pickables?<br><br>Now it seems to work properly just when I point to some<br>polygons, but really doesn't works as it should, with the<br>whole model.<br><br>Thanks in advance! <br><br></td></tr></table><br>
<a name="614660"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >octothorpe</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> <pre class=code>function EntityPickModeRecursive(entity, value)
	If EntityClass$(entity)="Mesh" then entitypickmode entity, value
	for i = 1 to countchildren(entity)
		EntityPickModeRecursive(getchild(entity, i), value)
	next
end function</pre><br><br>EDIT: "If EntityClass$(m)="Mesh"", thanks jfk <br><br></td></tr></table><br>
<a name="614663"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> you need to make the children pickabe too, use a recursive function to set the pickmode to all MESH children (see here: <a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=1170" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=1170</a> )<br><br>Now I guess you want to have one entityhandle only, to control if you eg. shot the enemy, or see the enemy etc.<br><br>Personally I solved this with a socalled orphan structure. Every main root handle of an enemy animesh will get its list of child entities (a simple nonhierarchical list). Now when linepick returns a child handle, you need to search the orphan lists to see what root parent was shot.<br><br>It may look slow, but in fact it's pretty fast because it's only comparing some ints, so checking several thousand children won't consume siginficant amounts of time.<br><br>It's up to you to use:<br><br>banks, eg:<br>int root entity handle<br>int number of orphans<br>int oprhan 1<br>int orphan 2<br>...<br><br>arrays:<br>dynamicly redim the arrays as required, using a second array to save the content before you resize the main array. Con: waste of space when the number of children differs a lot between the various meshes. Pro: easy access.<br><br>types:<br>create a new type instance for each enemy and a subtype instance for every child. Elegant code, but some overhead compared to banks IMHO.<br><br>Alternatively you can do it the easy way, use the Command <b>GetParent</b>. You need to use this recursively to find the root entity. Recursive function calls may be slower than the orphans structure I described before. <br><br></td></tr></table><br>
<a name="614723"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >octothorpe</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> There's a third option: indexing, which would be a faster (and cleaner IMHO) approach.<br><br>You can store a string in an entity's EntityName and use this to either (a) index an object for the child entity which contains a pointer to the parent object (i.e. enemy) or (b) index the parent object directly.<br><br>The string can work as an index either by being a Handle() to the object or - if you keep all your objects in global arrays like Frank Taylor - the array index to find the object (aka its "ID".)<br><br>I think the simplest solution is to set the EntityName of all the entities belonging to an enemy to the Handle() of that enemy object; you only need to call Object() on the EntityName of the picked entity to get the correct enemy. <br><br></td></tr></table><br>
<a name="614749"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> That's indeed a clean solution. Storing the top root handle in the EntityName of every child. Although you still need to extract the handle from a string it may be the fastest way.<br><br>Probably you need to use an individual part for every entityname, not sure if you can name them with the same name, and I would not recommend to do so. But you may name it something like this:<br>(handle)+"_"+oldname$<br><br>So the value of the handle can be converted to int simply by automatic type casting, eg:<br>value%=entityname$(picked_child) <br><br></td></tr></table><br>
<a name="614759"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Pinete</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks a lot, thanks a lot to all!!!!<br>really grateful!<br>:) <br><br></td></tr></table><br>
<a name="614947"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >octothorpe</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Probably you need to use an individual part for every entityname, not sure if you can name them with the same name, and I would not recommend to do so. <br></div><br><br>It's perfectly safe to do so.<br><br>I like your automatic type-casting trick though.  I often prefix EntityNames with the type of object the Handle() points to - I think I'll start postfixing instead. :) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
