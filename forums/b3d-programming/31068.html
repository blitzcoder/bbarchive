<!DOCTYPE html><html lang="en" ><head ><title >Freeing a copied entity</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Freeing a copied entity</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Freeing a copied entity</a><br><br>
<a name="331362"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi<br><br>I had to revisit an old demo today which seemed to run OK but hung after about 20 mins. I checked the code and the only potential prob I could see was that I created a master entity (cube) which I then copy (copyentity) many times before freeEntity'ing the master cube.<br><br>I guess this is a no-no as the copies refer to the same mesh which has now been freed. Or is it OK to do this?<br><br>I'm a bit rusty as I haven't done any programming in ages - I've lost my mojo (i.e. enthusiasm) :( <br><br></td></tr></table><br>
<a name="331427"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> As far as I know the master entity will not be removed as long as there are any copies around. At least that's what I assumed until now. There might be other reasons why it crashes. Lost mojo? Cmon - you just made an Art break. <br><br></td></tr></table><br>
<a name="331684"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh, so doing a FreeEntity on the master entity won't have any effect then? Hmmm. Maybe the crash was just Windows throwing on of it's occasional wobblies. The demo in question isn't very complex - not doing any mesh manipulations of anything.<br><br>lol. I am on a bit of an art break at the mo as I've just started trying my hand at 3D modeling having found a modeler I can actually use (wings3D - highly recommmended). ;) <br><br></td></tr></table><br>
<a name="332427"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ChrML</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Add an a place where it says the number of bytes video memory left using AvailVidMem(), and see if it decreases. If you copy an entity, then you have to free all copies, but if you just copy the pointer, you can't.<br><br>Works:<br><br>mesh = LoadMesh("mesh.x")<br>mesh2 = CopyMesh(mesh)<br><br>FreeEntity mesh<br>FreeEntity mesh2<br><br><br>Here we just copy the pointers:<br><br>mesh = LoadMesh("mesh.x")<br>mesh2 = mesh<br><br>FreeEntity mesh<br>FreeEntity mesh2 ;THIS WILL CAUSE ACCESS VIOLATION BECAUSE HERE YOU TRIE FREEING THE SAME ENTITY TWICE (THE SAME MEMORY LOCATION) <br><br></td></tr></table><br>
<a name="332545"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think only Mark could answer this question, if a hidden "original entity" is legally kept in memory when it already has copies and then was removed manually.<br><br>But personally I think this is trivial, so it might work correctly. Then again - oftenly the trivial bugs are the mean ones. <br><br></td></tr></table><br>
<a name="332554"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Floyd</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Mark has implicitly answered this in his sample programs that come with Blitz3D.<br><br>For example, look at the pick or tex_render programs.<br>They both create an entity, make many copies and then free the original. <br><br></td></tr></table><br>
<a name="332574"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DJWoodgate</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I would *guess* that a count is kept of all entities that reference a mesh.  Copying an entity that points to a given mesh would increment the count and freeing an entity that points to this mesh would decrement the count. When the count is zero the mesh is freed?   In any event I doubt thats the cause of the problem (unless you are not freeing all the copies after you are finished with them). Its not something I have come across anyway.  If memory were being chewed up its my experience that every starts running slower and slower.  If thats the case then you do have a memory leak somewhere, perhaps you are not freeing a pivot or have a runaway type list. <br><br></td></tr></table><br>
<a name="332690"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Floyd: Well, if Mark's doing it then it must be OK.<br><br>Beginning to think it was down to windows having a random crash but if anyone would like to prove me wrong, the demo in question is here: <br><br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=955" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=955</a> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
