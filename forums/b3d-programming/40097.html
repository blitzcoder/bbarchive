<!DOCTYPE html><html lang="en" ><head ><title >Stencil Shadow Volume demo</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Stencil Shadow Volume demo</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Stencil Shadow Volume demo</a><br><br>
<a name="449192"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tom</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> The new SystemProperty$() commands has opened up Blitz to stencil ops, here's an example of shadow volumes. The guts of the code is from one of the DX 7 SDK examples.<br><br>NOTE! This is very raw! No pixel format checking at all, and some of the guys in Irc (all with ATI cards it seems)  get a garbage display instead of eye candy so PLEASE don't complain if it's screwed up, I'm a crap coder and I've only been looking at the DX 7 SDK since v1.88 :) But that can be fixed with some checking.<br><br>anyways, just wanted to post to show a hardware shadow solution is possible since v1.88, alongwith maybe some other tricks.<br><br><a href="http://www.tomspeed.com/ShadowVolume.zip" target="_blank">http://www.tomspeed.com/ShadowVolume.zip</a><br><br><img src="http://www.tomspeed.com/shadowvolume.jpg"><br><br>Oh yeah, if the demo works (hehe) the sphere represents a shadow volume, which in game terms, would normaly be produced 'on the fly', that could be costly, and unfortunately building a shadow volume from an animated mesh could be near impossible because we can't access deformed vertex position right now, but you never know :)<br><br>Cya<br>Tom <br><br></td></tr></table><br>
<a name="449210"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >mongia2</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> thanks for demo...<br>work fine<br><br>Mongia <br><br></td></tr></table><br>
<a name="449228"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> oh, freakin' wow man! freaking WOW!!!!!!!!!!<br><br>i mean...<br><br>YEEEAAAHHHH!  :D <br><br></td></tr></table><br>
<a name="449233"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shambler</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> OMG it almost makes me feel like coding again! ;O <br><br></td></tr></table><br>
<a name="449235"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Eric</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> How did you do this? Can we see the code? <br><br></td></tr></table><br>
<a name="449251"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tom</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="http://www.tomspeed.com/shadowvolume/" target="_blank">http://www.tomspeed.com/shadowvolume/</a><br>Use at own risk!<br><br>Remove the texture references.<br><br>It's definately ATI unfriendly at the moment.<br><br>Don't forget, v1.88 needed. <br><br></td></tr></table><br>
<a name="449256"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bot Builder</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Screenie is sweet :D<br><br>This is basically the problem for ati cards:<br><pre class=code>Graphics3D 640,480,32,2
cam=CreateCamera()
PositionEntity cam,0,3,-6
RotateEntity cam,30,0,0

shadowplane=CreateCube()
ScaleMesh shadowplane,10,10,.1
EntityColor shadowplane,256,256,256

CameraClsMode cam,False,False

While Not KeyHit(1)
	Cls
	RenderWorld
	RenderWorld
	Flip
Wend</pre><br><br>Double render world apparently throws up a bunch of odd artifacts 0_o. This snippit doesnt work on anyones card as far as i can tell.  Probably what's happening is since the zbuffers are the same between frames it thinks only a little if any should be drawn... Dunno why it clears the color buffer if this is the case though. <br><br></td></tr></table><br>
<a name="449264"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tom</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> www.tomspeed.com/shadowvolume/<br><br>Updated, looks a bit better now with semitransparent blending. Now to fix this ATI thing and add some pixel format checking.<br><br><img src="http://www.tomspeed.com/shadowvolume2.jpg"> <br><br></td></tr></table><br>
<a name="449277"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Eric</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> This has the making for a nice shadow library... I'd pay money for a simple to use shadow system. <br><br></td></tr></table><br>
<a name="449298"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >.rIKmAN.</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nope, doesn`t work here either... 128Mb Radeon 9600 as in sig... <br><br></td></tr></table><br>
<a name="449407"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BODYPRINT</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yep Radeon 9800 Pro here comes up corrupt as well. <br><br></td></tr></table><br>
<a name="449421"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TartanTangerine (was Indiepath)</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is sweet :) <br><br></td></tr></table><br>
<a name="449428"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jeroen</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> ATI 9700 fails. Nice screens though <br><br></td></tr></table><br>
<a name="449430"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bruZard</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> <img src="http://www.makegame.de/pic/stencil.jpg"><br><br>ATI 9600 <br><br></td></tr></table><br>
<a name="449439"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >fredborg</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Tom baby, you rock! <br><br></td></tr></table><br>
<a name="449446"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Umm.. Just a thought - sorry I cannopt test this or do anything myself atm...<br><br>What if you had two shadow-volume spheres?<br><br>Would the overlap be darker???? <br><br></td></tr></table><br>
<a name="449518"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >HNPhan</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> this i really nice man, I wonder what else can be done,<br>mind explaining us what are all those commands o_0 <br><br></td></tr></table><br>
<a name="449520"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Beaker</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Malice - the overlap wouldn't be darker. <br><br></td></tr></table><br>
<a name="449531"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Really nice<br>although the shadow stuff does not work, the command itself is very usefull to activate other states :) <br><br></td></tr></table><br>
<a name="449532"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Neochrome</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> - <br><br></td></tr></table><br>
<a name="449560"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Difference</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> I made it work on my Radeon 9600XT.<br><br>I put this in the top of the loop, assuming it was a problem with clearing the z buffer.<br><br><pre class=code>
While Not KeyHit(1)
CameraClsMode cam,True,True
RenderWorld	
CameraClsMode cam,0,0
.start
</pre> <br><br></td></tr></table><br>
<a name="449567"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ion-Storm</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> Works dandy.<br><br>on my GF2 Gf4 <br><br></td></tr></table><br>
<a name="449574"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> has someone a mistake free version of the source code that gives the right result? <br><br></td></tr></table><br>
<a name="449593"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BODYPRINT</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> Peters fix works for me too :-)<br><br>Looks good.<br>[edit]<br>except the sphere doesn't fade in the background.<br>[/edit] <br><br></td></tr></table><br>
<a name="449606"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Difference</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> except the sphere doesn't fade in the background.  <br></div>Yeah, I know, but I'm on irc with Tom right now, and he's looking into it <br><br></td></tr></table><br>
<a name="449607"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BODYPRINT</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> Replace<pre class=code>ShowEntity sphere</pre>with this line<br><pre class=code>If sv Then ShowEntity sphere</pre>just before the last renderworld to hide the sphere. <br><br></td></tr></table><br>
<a name="449615"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Panno</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> cool <br><br></td></tr></table><br>
<a name="449633"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tom</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think the ATI problems are something to do with theway Blitz clears the Zbuffer, it needs to be False,False else every RenderWorld will clear them, and we don't want that.<br><br>The DeviceClear() should be clearing everything as needed at the beginning of each loop.<br><br>Here's a rough rundown of how all this works b.t.w (let's see if I got it right :)<br><br><br>Clear all buffers &amp; render target<br><br>Show scene items<br><br>Enable Z writes, Disable Stencils<br><br>Renderworld (Color &amp; Zbuffer is written)<br><br>Disable Zbuffer writes, hide scene, show shadow volume<br><br>Set stencil OPs, now the next RenderWorld affects Stencils only<br><br>RenderWorld (check each pixel Z value against old Zbuffer, write to Stencil on result)<br><br>Flip shadow volumes to now test back faces<br><br>Renderworld (check each pixels Z value against old Zbuffer, write to Stencil on result)<br><br>At this point, the Stencil Mask would only show pixels in the Scene, that are inside the shadow volume!<br><br>Now Disable Stencils &amp; Zbuffer Writes, put a Shadow Plane in front of the camera, and set Stencil OPs to only render parts of the Shadow Plane where the Stencil = 1 (draws shadow color!)<br><br>Simple when you think about it, but the code looks messy :) <br><br></td></tr></table><br>
<a name="449680"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paolo</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> Tom,<br>this is excellent.<br>I can't believe how fast you worked this out.<br><br>This community never stop impress me :)<br><br>Now it is time to start testing... testing ... testing ... oh yeah :)<br><br>Paolo. <br><br></td></tr></table><br>
<a name="449687"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Difference</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> New fix that does not add a renderworld:<br>Use Phil74's "If sv Then ShowEntity sphere" too.<br><br>Replace the first renderworld with this, commenting out the DeviceClear:<br><pre class=code>
	DeviceClear(Direct3DDevice7, 7,$00008080,1,0)
	CameraClsMode cam,True,True
	RenderWorld
	CameraClsMode cam,False,False
</pre><br><br>[EDIT]: tests show that you should keep the DeviceClear on Nvidia cards. Since it works ok on ATI too, I'll leave it in for now. <br><br></td></tr></table><br>
<a name="449697"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> Now this is something truely revolutionary. <br><br></td></tr></table><br>
<a name="449699"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >poopla</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#32">[#32]</a></td></tr></table></td></tr><tr ><td class="posttext"> For blitz anywho :). <br><br></td></tr></table><br>
<a name="449712"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tom</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#33">[#33]</a></td></tr></table></td></tr><tr ><td class="posttext"> It will be if it can be put to good use :)<br><br>For shadow volumes there are issues to think about:<br><br>1: Building shadow volumes on the fly could be costly<br><br>2: Deformed animated meshes, we can't get deformed vertex positions! Blood suggested recording deformed data from your 3D app, but, what about render tweening? (verts are then interpolated! :/ )<br><br>3: Is it faster than a software solution?<br><br>The software solution would be something like sswifts shadow system, but that uses shadow mapping.<br><br>With the new access to core of DirectX, maybe a RenderToTexture() function could be made, which would speed up a software shadow mapping solution?<br><br>Food for thought!<br><br>There are other things possible of course, decals, fades, torch lights...<br><br><br>To sswift if he reads this:<br>What would you say was the biggest slowdown in your shadow system?<br><br>Tom <br><br></td></tr></table><br>
<a name="449717"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#34">[#34]</a></td></tr></table></td></tr><tr ><td class="posttext"> "With the new access to core of DirectX, maybe a RenderToTexture() function could be made, which would speed up a software shadow mapping solution?"<br><br>In some instances, it would.<br><br><br>"What would you say was the biggest slowdown in your shadow system?"<br><br>Both rendering shadows and culling polygons to generate shadow meshes are costly.  My system is culling limited when working with complex levels and lots of casters.  But if you run my shadow demo, and crank up the shadow resolution and use two lights you will see the shadow map rendering can kill the framerate in some cases. <br><br>Rendering directly to a texture would greatly speed up the shadow map rendering.  In most games that might translate to a gain of several FPS.  I have optimizations in place to reduce rendering which speeds things up, but that doesn't work on animated meshes which are what most people use.<br><br>A stencil shadow system is likely to be a lot faster than my system.  But the stuff we've seen so far is only the tip of the iceberg as far as making one.  You still need a way to generate the shadow volumes.  I'd have to read up on how doom does that but I know it involves deforming the mesh on the video card.  And it may require vertex shaders.<br><br>I think the current state of stencil shadows in Blitz would allow one to have theor levels cast stencil shadows.  Static ones at least.  Dynamic would be possible but probably too slow in software.<br><br>I think you need vertex shaders to do dynamic stencil shadows. <br><br></td></tr></table><br>
<a name="450396"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Braincell</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#35">[#35]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh this is strange, but nice. I just figured out a software way of doing stencil shadows and then this guy puts this on. No need for me to share my ideas now, this is probably faster. We still have the problem of making shadow volumes for animated meshes, but NOT for solid ones. <br><br></td></tr></table><br>
<a name="450723"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Regular K</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#36">[#36]</a></td></tr></table></td></tr><tr ><td class="posttext"> Looks nice :)<br><br>This may open doors to more possible B3D users. <br><br></td></tr></table><br>
<a name="450848"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >eizdealer</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#37">[#37]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's interesting to see how fast this idea developed. It seems to work ok on my ATI card as well (with Peter Scheutz' 'fix').<br>But the question is: Is it fast enough for complex dynamic shadows (assuming you know the vertices' coordinates)? I get about 500 FPS with the scene, which sounds a lot, but you have to recall that it's just a simple sphere shadow volume casting the shadow, rendered with other basic objects.<br>What if I take some dynamic 1000-polies-meshes? After the normal render you would have to build shadow volumes, render them, and finally render the shadow itself. Maybe my thoughts are wrong but I doubt you'll get acceptable frame rates this way in Blitz. But feel free to cinvince me that it's fast enough :)<br>Anyway it IS fast enough for simple static objects, as the example shows. <br><br></td></tr></table><br>
<a name="450864"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BODYPRINT</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#38">[#38]</a></td></tr></table></td></tr><tr ><td class="posttext"> Tom:Can you explain please what the new DeviceClear2 should be used for.<br><br>It seems to act the same as the first version, but needs the BBrect types. I assume it is some culling options?<br><br>I'm trying like mad to get animated meshes to work. <br><br></td></tr></table><br>
<a name="450874"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BODYPRINT</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#39">[#39]</a></td></tr></table></td></tr><tr ><td class="posttext"> OK I got animated meshes working. Was easier than I thought :-)<br><br>I have modified the layout of the Demo a fair bit, so it may be easier just to link to my version.<br><br><a href="http://members.iinet.net.au/~pmerwarth/Stencil_SHadows.zip" target="_blank">http://members.iinet.net.au/~pmerwarth/Stencil_SHadows.zip</a> <br><br></td></tr></table><br>
<a name="450891"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Beaker</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#40">[#40]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think you might be missing the point a little.  The idea is to get animated objects with correctly projected shadows, not an animated shadow on its own!<br><br>Nice try tho. <br><br></td></tr></table><br>
<a name="450895"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BODYPRINT</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#41">[#41]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah, I realised that after !!<br><br>I'm working on that side of it now...don't hold your breath but :-) <br><br></td></tr></table><br>
<a name="450949"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tom</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#42">[#42]</a></td></tr></table></td></tr><tr ><td class="posttext"> Phil: DeviceClear2() takes a BBRect type which just tells what part of the screen to clear.<br><br>Stuff to think about:<br><br>Making volumes 'on the fly' is what's needed next, but also consider that you could precalc volumes for each light for your levels, useful for static lights &amp; geometry.<br><br>There's the problem that if your camera goes into a shadow volume the shadows won't get rendered correctly, the solution is the so called 'carmacks reverse' stencil method which I haven't tried. <br><br></td></tr></table><br>
<a name="450952"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Braincell</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#43">[#43]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'll also be trying to figure out some solutions for building shadow volumes, if not for animated .B3Ds then at least for static objects whoose vertices we can access. It's on my list is what i can tell you for sure. Cos this is what we need, and i have a feeling it will be satisfactory speed even at higher details. <br><br></td></tr></table><br>
<a name="450960"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tom</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#44">[#44]</a></td></tr></table></td></tr><tr ><td class="posttext"> Stenciling is quite fast, I don't think shadow volume polycount affects the speed as much as the screen resolution does (bigger the resolution, the more stencil checking to be done)<br><br><br>This is a cool demo done with Delphi &amp; GL, there's some 42 shadow volumes, I think they're all created on the fly. 2 of the items casting shadows are of reasonable poly detail (the hour glass shaped mesh, and the boolean cut cube), so that's a fair amount of on the fly math.<br><br><a href="http://www.delphi3d.net/download/stencilshadows.zip" target="_blank">http://www.delphi3d.net/download/stencilshadows.zip</a> <br><br></td></tr></table><br>
<a name="450966"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >eizdealer</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#45">[#45]</a></td></tr></table></td></tr><tr ><td class="posttext"> Tom: Is 'carmacks reverse' flipping the mesh (or rendering the tris both CCW and CW) and rendering for the stencil buffer again? If not, what's the purpose of this in your example? Because it seems to work OK without that second render. <br><br></td></tr></table><br>
<a name="450970"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paolo</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#46">[#46]</a></td></tr></table></td></tr><tr ><td class="posttext"> @ Tom,<br>It does not work properly when the shadow volume is made by more than one entity (or one entity with more than one surface) that are overlapping on the screen.<br>If you can fix this I may have an idea to dynamically build shadow volumes.<br><br>Paolo. <br><br></td></tr></table><br>
<a name="450983"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#47">[#47]</a></td></tr></table></td></tr><tr ><td class="posttext"> Carmack's Reverse...<br><br>I believe the normal way to render stencil shadows is to increment the stencil buffer once for each front face, and decrement it once for each backface.  If pixel ends up with a value greater than or equal to 0, then that pixel is in shadow.<br><br>Carmack's reverse is basically the opposite of this.  You decrement the stencil buffer once for each front face.  And increement it for each backface.<br><br>I think.  You should probably look it up on Google to be sure.<br><br>Anyway I'm not sure why this solves the camera inside the shadow volume problem, as I've never really thought about it before, but I do recall that while it solves that, it also creates a new problem whereby all shadow volumes must be capped...  Or extend to infinity.  And they can't be clipped by the far clipping plane, I think.<br><br>Correct me if I'm worng, but these demos don't show the ability to increment the stencil for front faces and decremenet it for backfaces.  If that is not possible then generating the shadow volumes themselves is the least of your worries. <br><br></td></tr></table><br>
<a name="451007"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tom</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#48">[#48]</a></td></tr></table></td></tr><tr ><td class="posttext"> The demo I posted doesn't use those particular Stencil OP modes, but they are available for use.<br><br>You have full access to stencils since v1.88 (GFX card permitting!).<br><br>;D3DSTENCILOP<br>Const D3DSTENCILOP_KEEP           = 1<br>Const D3DSTENCILOP_ZERO           = 2<br>Const D3DSTENCILOP_REPLACE        = 3<br>Const D3DSTENCILOP_INCRSAT        = 4<br>Const D3DSTENCILOP_DECRSAT        = 5<br>Const D3DSTENCILOP_INVERT         = 6<br>Const D3DSTENCILOP_INCR           = 7<br>Const D3DSTENCILOP_DECR           = 8 <br><br></td></tr></table><br>
<a name="451125"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#49">[#49]</a></td></tr></table></td></tr><tr ><td class="posttext"> "The demo I posted doesn't use those particular Stencil OP modes, but they are available for use."<br><br><br>Yeah but those ops don't appear to say that they do something different depending on whether or not a face is a front face or a back face. <br><br></td></tr></table><br>
<a name="451128"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ckob</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#50">[#50]</a></td></tr></table></td></tr><tr ><td class="posttext"> I get an error "function Set render state not found" i copied the userlib and dll over to the userlib folder what elsecould it be? <br><br></td></tr></table><br>
<a name="451132"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tom</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#51">[#51]</a></td></tr></table></td></tr><tr ><td class="posttext"> sswift, ...example of use<br><br>SetRenderState(Direct3DDevice7, D3DRS_STENCILZFAIL, D3DSTENCILOP_KEEP)<br>SetRenderState(Direct3DDevice7, D3DRS_STENCILFAIL,  D3DSTENCILOP_KEEP)<br>SetRenderState(Direct3DDevice7, D3DRS_STENCILPASS, D3DSTENCILOP_REPLACE)<br><br><br>ckob: You using v1.88? <br><br></td></tr></table><br>
<a name="451134"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Perturbatio</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#52">[#52]</a></td></tr></table></td></tr><tr ><td class="posttext"> . <br><br></td></tr></table><br>
<a name="451236"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ckob</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#53">[#53]</a></td></tr></table></td></tr><tr ><td class="posttext"> yeah I am <br><br></td></tr></table><br>
<a name="451277"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dock</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#54">[#54]</a></td></tr></table></td></tr><tr ><td class="posttext"> Has anyone tried projecting stencil shadows onto boned animated object yet?  The ability to project shadows on to a character (even if you have to turn it off on low-end hardware) is something we haven't really had in Blitz before, and would be a fantastic benefit. <br><br>I agree that generating efficient shadow volume geometry will be tricky - it seems like something which ought to be done in a 3D modelling package if it's going to be as optimal as possible. <br><br></td></tr></table><br>
<a name="451279"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#55">[#55]</a></td></tr></table></td></tr><tr ><td class="posttext"> the source online is totally bugged, forget it.<br><br>there is a place where you will find<br><br>renderstate( ... )<br><br>and at another there seem to have been 2 lines deleted ( text outputs ... ) which ends with a string in a setrenderstate command <br><br></td></tr></table><br>
<a name="451389"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tom</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#56">[#56]</a></td></tr></table></td></tr><tr ><td class="posttext"> There is no projecting as such, shadow volumes will encompass ANY geometry in a scene that's been rendered with the Zbuffer on.<br><br>Dreamorama: ? :) <br><br></td></tr></table><br>
<a name="451398"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#57">[#57]</a></td></tr></table></td></tr><tr ><td class="posttext"> The link you put in further up with the bb source is totally useless. no mather if you ever checked what you actually put there, but I would bet: no <br><br></td></tr></table><br>
<a name="451418"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MSW</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#58">[#58]</a></td></tr></table></td></tr><tr ><td class="posttext"> Very cool :)<br><br>There is a way to do this in DX7 with multitextureing on a quad in front of the camera. <br><br></td></tr></table><br>
<a name="451439"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tom</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#59">[#59]</a></td></tr></table></td></tr><tr ><td class="posttext"> Dreamorama: Code 'snippets' I've posted here in this thread are not full demos, they're a reply to sswift on how renderstates are used.<br><br>Source for demo is here:<br><a href="http://www.tomspeed.com/shadowvolume" target="_blank">http://www.tomspeed.com/shadowvolume</a> <br><br></td></tr></table><br>
<a name="451448"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#60">[#60]</a></td></tr></table></td></tr><tr ><td class="posttext"> seem like you replaced the bugged one that was online there before ( and which I used to try to get my ATI running ;) )<br><br>take out the<br><br>"Or D3DCLEAR_STENCIL" from deviceclear2 command and it even works on ATI :) ( mobility radeon 9700 ) <br><br></td></tr></table><br>
<a name="451489"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tom</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#61">[#61]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm still learning about stencils, pixelformats, buffers, blah blah, slowly but surely things are beginning to 'click' in my head with regards to the DX7 SDK (only been at it for 3 evenings or so!)<br><br>Dock: Here's an example of what I think you meant, I've encoded it to the old divx (seems to be the only format I could screencap to without stopping), 750k, Divx 5.x should play it<br><br><a href="http://www.tomspeed.com/sv.avi" target="_blank">http://www.tomspeed.com/sv.avi</a><br><br>There's 3 'pre made' shadow volumes, each one in turn is shown by itself and a renderworld called to update the stencil buffer. This is neccessary for overlapping shadow volumes, and not possible to do on (older cards) with a 1bit stencil buffer AFAIK.<br><br>Loop time on my PC was 1-2ms @ 800,600 with debug on, which aint bad for (I think 6 or 7 renderworlds!)<br><br><br>Cya<br>Tom <br><br></td></tr></table><br>
<a name="451602"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >mongia2</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#62">[#62]</a></td></tr></table></td></tr><tr ><td class="posttext"> very good work...<br><br>Mongia <br><br></td></tr></table><br>
<a name="451728"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hujiklo</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#63">[#63]</a></td></tr></table></td></tr><tr ><td class="posttext"> Could this technique realistically be used to shadow a level in a game?...Does it use light sources that can be placed in Blitz? <br><br></td></tr></table><br>
<a name="451757"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rogue Vector</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#64">[#64]</a></td></tr></table></td></tr><tr ><td class="posttext"> This stuff should be a standard feature in Blitz 3D - i.e. a future update.<br><br>Regards,<br><br>Rogue Vector <br><br></td></tr></table><br>
<a name="451759"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bouncer</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#65">[#65]</a></td></tr></table></td></tr><tr ><td class="posttext"> Looking great tom... now just figure a quick way to build the volumes realtime and roll us a little library :)<br><br>Great work! <br><br></td></tr></table><br>
<a name="452070"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mustang</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#66">[#66]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>Could this technique realistically be used to shadow a level in a game?<br> <br></div><br><br>Yes, but IMO it's not very likely that anyone here can use it. And it's not somekind of "magical" way to make everything nicely (&amp; fast) shadowed... even if you card supports it, you still must calc shadowvolumes and this will kill 95% of Blitz3D projects trying to use stencils... unless someone makes a universal code module that calcs those volumes, but it will slow to calc them still.<br><br>More about the subject:<br><br><a href="http://www.gamedev.net/reference/articles/article1873.asp" target="_blank">http://www.gamedev.net/reference/articles/article1873.asp</a><br><br><a href="http://www.gamedev.net/reference/articles/article1873.asp" target="_blank">http://www.gamedev.net/reference/articles/article1873.asp</a> <br><br></td></tr></table><br>
<a name="452082"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#67">[#67]</a></td></tr></table></td></tr><tr ><td class="posttext"> Write a good command set and let people calc their own vols. <br><br></td></tr></table><br>
<a name="452090"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BODYPRINT</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#68">[#68]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well thats what I have been doing for myself.<br><br>If you download my file from my post above you can see an extremely basic version of what I started.<br><br>Now my volume models stretch and rotate around lights.<br><br>Trouble is my game has nearly 200 objects on screen.<br>Major slowdown.<br>I ended up going back to sswifts system and fake shadows because at least I can select which objects are in the shadow routines. <br><br></td></tr></table><br>
<a name="452421"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hujiklo</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#69">[#69]</a></td></tr></table></td></tr><tr ><td class="posttext"> Phil74 - How about simply precalculating these shadows and not rotating them realtime simply in order to shadow a level, and have them react correctly to realtime lighting as opposed to shadow maps?<br>For me and probably a lot of other people around here, that would be better than no shadows at all! <br><br></td></tr></table><br>
<a name="452472"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mustang</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#70">[#70]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> not rotating them realtime simply in order to shadow a level, and have them react correctly <br></div><br><br>Ummm... that's impossible... you want static but moving shadows? :) <br><br></td></tr></table><br>
<a name="452480"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#71">[#71]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think he wants to light his level without using lightmaps.  The shadows would be static but they'd be sharp, and they would affect characters who walk through them.<br><br>They'd greatly limit how high poly your levels can be though...  You can't have every pipe and railing and such casting stencil shadows, unless you limit yourself to very few pipes and railings.  The shadow volumes increase the polygon count a lot, and the overdraw also would hurt the framerate.<br><br>Also I wonder how one would handle multiple lights?  With one light you can generate a shadow volume for each object it casts a shadow from.  But what if an object is in shadow from one light, but lit by another?  How do stencils handle that?  You must have to render the scene once for each light?  That'd be pretty expensive. <br><br></td></tr></table><br>
<a name="452538"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hujiklo</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#72">[#72]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes thanks SSwift I did mean only have the shadows react to lighting in their contrasts not change their orientation in any way.<br>Now that you mentioned limiting geometry for a level I don't think it would be a problem  - just use a seperate mesh of basic blocks to caste the shadows for an outside city level for instance..i think nobody would really notice that shadows are not 100 percent accurate. The volume effect itself would more than compensate in my opinion. <br><br></td></tr></table><br>
<a name="452540"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BODYPRINT</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#73">[#73]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Hujiklo : If I knew how to precalculate real time shadows I would. Working out the angle from the light to the model was easy and then I simply stretch and rotate the volume model around my characters.<br><br>I had the system working perfectly in game, but like I said, with 200ish models getting rendered 4 times each update was a major slowdown. I cut out any renderworlds I could from the shadow routines because I didn't need the backface part. But it was still slow as hell.<br><br>At least with sswifts system I can say, OK this object is within shadow distance of my players, so they will receive shadows this update. So I may have 8 models in the shadow system as apposed to all 200.<br><br>Does this make sense or am I dribbling?<br><br>Me and 3D maths don't get along too well but!! :-)<br><br>I still can't get my head around realtime texture shadows, hence why I paid sswift to do it for me :-)<br><br>@sswift:You pretty much got it except the shadows are from my players onto the world. They are not static as such as they do follow the player around and the angle does change to the lighting angle.<br>It's no high class FPS I'm writing here by the way (It's a Bomberman clone in 3D topdown view), but I still want my shadows to look nice.<br><br>Also, when I use blur on your shadow system my shadows disappear?? Any ideas why this is? <br><br></td></tr></table><br>
<a name="452569"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#74">[#74]</a></td></tr></table></td></tr><tr ><td class="posttext"> "Also, when I use blur on your shadow system my shadows disappear?? Any ideas why this is?"<br><br>Yes, because the blur function is broken.  Click my name and look back through my posts a week or so and there's a thread with a new blur function and another fix. <br><br></td></tr></table><br>
<a name="452603"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BODYPRINT</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#75">[#75]</a></td></tr></table></td></tr><tr ><td class="posttext"> Cheers :-) <br><br></td></tr></table><br>
<a name="452611"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >eizdealer</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#76">[#76]</a></td></tr></table></td></tr><tr ><td class="posttext"> It would be great if someone posted an algorigthm to create a shadow volume, or maybe give a link where it's demonstrated. No matter, how fast it is.<br>Imagine you take simplified meshes to create the volumes on load and hide the ones that are not visible when rendering. Wouldn't this be fast enough for static objects? <br><br></td></tr></table><br>
<a name="452702"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paolo</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#77">[#77]</a></td></tr></table></td></tr><tr ><td class="posttext"> Once, I read something about shadow volumes, and it said<br>that sometimes it could be better to cast each polygon<br>independentely instead of doing the shadow volume<br>calculations.<br><br>I ended up doing this:<br><br><a href="http://tecno-itb.coloniesonline.co.uk/imgs/Volumes.zip" target="_blank">http://tecno-itb.coloniesonline.co.uk/imgs/Volumes.zip</a><br><br>you can use the CreateShadowVolume() function<br>with any model, the only thing needed is that<br>the light object must have a child at the<br>position 0,0,1 (this is only to retrieve a vector).<br>Then, the function will create a shadow volume for<br>each polygon of each surface.<br><br>I tried to implement this in the DX7 code from Tom,<br>but I found that when there are more than one volume<br>in the screen the shadow is not correct<br>at all ... may be someone can fix it ..<br><br>later!<br>Paolo. <br><br></td></tr></table><br>
<a name="452834"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mustang</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#78">[#78]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> It would be great if someone posted an algorigthm to create a shadow volume, or maybe give a link where it's demonstrated. <br></div><br><br>Already did, few posts up:<br><br><a href="http://www.gamedev.net/reference/articles/article1873.asp" target="_blank">http://www.gamedev.net/reference/articles/article1873.asp</a> <br><br></td></tr></table><br>
<a name="452866"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >eizdealer</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#79">[#79]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is it possible to create triangles with c++ dlls in Blitz? If so then it would be best to write a c++ dll that creates the volumes themselves, if it is not possible maybe it could return the positions of all the volume's triangles. This way it should be a lot faster.<br><br>EDIT2 - correction:<br>What would have to be done (correct me if I'm wrong):<br>- go through all of the occluder's triangles and drop the ones not facing the light<br>- go through all these triangles and save the edges that are not in common with one other triangle's edge<br>- now extrude every edge as far away as possible<br>- done<br><br>I wrote the dll right now if I had ever coded in c++ but I haven't. If someone would like to write it, contact me whenever you have a question. I could also write it as a Function in Blitz but that would be very slow. <br><br></td></tr></table><br>
<a name="452909"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Braincell</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#80">[#80]</a></td></tr></table></td></tr><tr ><td class="posttext"> Eurythmia how about a demo of how this works with boned b3d meshes?? ;)<br><br>You know that IS the issue now. <br><br></td></tr></table><br>
<a name="453199"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Doiron</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#81">[#81]</a></td></tr></table></td></tr><tr ><td class="posttext"> After looking a while at the code, I must say that this technique could be a lot more flexible for *lights* than shadows.<br><br>Just change the "EntityColor shadowplane" to 255,255,255 to see what I mean: using a torchlight as an example, it just needs a cone which has it's base which is projected where the torch points to. Even using a small vertex deformed grid for scenery/character collision with the projected cone, you would obtain a very convincing effect. Though such a concept could be easily used for diffuse light effects as well, as a ceiling mounted neon which tilts slightly. <br><br></td></tr></table><br>
<a name="1121359"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ozzi789</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#82">[#82]</a></td></tr></table></td></tr><tr ><td class="posttext"> please dont lynch me for reviving this thread.<br>is there anybody that still owns the dll?<br><br>thank you so much,<br>ozzi <br><br></td></tr></table><br>
<a name="1121397"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#83">[#83]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> is there anybody that still owns the dll? <br></div><br><br>Yes: <a href="http://dl.dropbox.com/u/46635275/DX7libs.rar" target="_blank">http://dl.dropbox.com/u/46635275/DX7libs.rar</a> (hopefully this works)<br><br>That there is a mess of several very similar things, including the demo for this (I think). <br><br></td></tr></table><br>
<a name="1121417"></a>

<a name="1121582"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#84">[#84]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="http://devil-engines.dev-ch.de/devil-shadow-system" target="_blank">http://devil-engines.dev-ch.de/devil-shadow-system</a><br><br>EDIT: But stencil shadows are a no-go nowadays. Part of the method if patented by Creative Labs.<br>And modern meshes are so dense that making the shadow volume for them would be very slow - much faster to render them with shadowmaps, which FastEXT supports and in a very efficient way I might add.<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1122203"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ozzi789</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#85">[#85]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wow thank you so much Yasha :)<br>Also to you Kryzon, this is a interesting link &amp; tipp! <br><br></td></tr></table><br>
<a name="1122220"></a>

<a name="1122221"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rroff</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#86">[#86]</a></td></tr></table></td></tr><tr ><td class="posttext"> "EDIT: But stencil shadows are a no-go nowadays. Part of the method if patented by Creative Labs."<br><br>^^ This unfortunatly - although you can change the method slightly (if you have the DLL source) as Carmack did with the GPL release of the Doom 3 source and it doesn't conflict with the patent.<br><br>If your producing a free/shareware app with a limited audience you could chance it but if you put a lot of effort into building a product around stencil shadows using a system similiar to "carmack's reverse" there is a chance you'll fall foul of creative's lawyers.<br><br><br>I'm still playing around with ICU based dynamic lightmapping - its no alternative for stencil shadows but I think with a bit more playing it has potential for some useage - mostly a case of finding all the limitations to stop artifacting happening and working out some kinda work around (probably something of the style of PSSM) to handle surfaces which are axial or close to axial to the angle of the light.<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
