<!DOCTYPE html><html lang="en" ><head ><title >Fast perlin noise heightmap function added to code archives.</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Fast perlin noise heightmap function added to code archives.</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Fast perlin noise heightmap function added to code archives.</a><br><br>
<a name="219294"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="/codearcs.php?code=696" target="_blank">Right here.</a> <br><br></td></tr></table><br>
<a name="219309"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Koriolis</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Cool. You'll never stop to give us valuable code, will you ? :) <br><br></td></tr></table><br>
<a name="219313"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I just updated the function... <br><br>I noticed unsightly diamond artifacts in the resulting perlin noise caused by the bilinear filtering algorithm.<br><br>I looked up bicubic filtering and discovered that was a lot more complicated than I thought.  It turns out that bilinear filtering when scaling an image up is really the right way to do things.  I thought it was just a crappy approximation, but it's not.  Bicubic is the clever trick.<br><br>So with this knowledge in hand, and not wanting to attempt to implement bicubic, I noticed that another fellow's perlin noise function used something called "cosine weighting".  I didn't look at his code to see what he was doing cause it was too much of a bother to figure out, so I just implemented what I thought cosine weighting meant, and I guess I was right because the results look really nice.<br><br>Basically what I did was use a cosine to modify the location of the subpixel sample, on each axis during the bilienar filtering.<br><br>In layman's terms... If you take a cosine, and go from 0..180 degrees, the cosine goes in a nice sine curve from 1 down through 0, to -1.<br><br>Now normally, when you'ree bilinear filtering you'll step across the tile, and at each location figure out where you are 0..1 between the two pixels, and then multiply one of them by 1.0-L#, and the other by L#, and add them, and that gives you a weighted average.<br><br>Well what I did with the cosine was instead of simply using L#, I took L# and divided it by 180.  This gave me an angle 0..180 which I coudl then input into my cosine.  Once I did that, my cosine output a value between 1 and -1.  But for my average I needed a vlaue between 0 and 1, so I added 1 to the value, and divided by 2.  This gave me the value between 1 and 0 which I needed.<br><br>Now I had a value that went between 0 and 1, but it didn't move linearly between them at a constant rate... Instead it moved along slowly at first, then approaches 0.5 quickly, and then speeds away from it, and then slows down and approaches 1.0. <br><br>This basically pushes the colors of the pixels at the four corners towards the center of the square, making the area which is the average of the colors smaller.  And it makes the areas around each pixel round instead of diamond shape.<br><br>Which got rid of those diamond artifacts.<br><br>And now we both know what cosine weighted averages are, unless I lost you somwhere back near subpixel sampling! <br><br></td></tr></table><br>
<a name="219314"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> "You'll never stop to give us valuable code, will you ? :)"<br><br>Only if I switch back to Dark Basic! :-) <br><br></td></tr></table><br>
<a name="219338"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ashmantle</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> heh.. like that will ever happen ;) (well.. maybe after Patch 27?) <br><br></td></tr></table><br>
<a name="219344"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Difference</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Very nice, results looks very good. Thanks for sharing it.<br><br>Are planning on doing a version that makes tileable pictures? <br><br></td></tr></table><br>
<a name="219353"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Seamless heightmaps?  I don't know why you'd want such a thing, other than for some kind of texture creation program.  <br><br>Doing that is trivial though.<br><br>All you need to do is when the noisemap is generated each pass, copy the pixels in the left colum to the right column, and copy the pixels in the top row to the bottom row.<br><br>That's all you need to do to make it seamless. <br><br></td></tr></table><br>
<a name="219361"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hm.. I rendered two heightmaps with the same random number seed and one with the cosine weighting and the other with plain bilinear filtering, and man you would not beleive the difference in quality.  The cosine one has higher contrast, (which means more height variation) as well as more naturally shaped structures, (round hills vs diamond shaped ones) and all these tiny details that were just blirred out before become visible.  I'm really surprised that this cosine weighting improved the image quality that much.<br><br>I wonder if cosine weighting would be good to use when scaling regular images up? <br><br></td></tr></table><br>
<a name="219400"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Anthony Flack</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey, sswift, not only do you contribute valuable routines, but you've just taught me something cool. Again. The way you explained it makes it crystal clear, and now that I have grasped the concept I can immediately see the coolness of it. You're one smart cookie. And I'm fractionally more clued up than I was when you found me. thanks again. <br><br></td></tr></table><br>
<a name="219690"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Difference</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, the seamless thing was for texture creation. I also heard some people talking about tilable terrains.<br><br>Thanks for explaining how to implement it. <br><br></td></tr></table><br>
<a name="220507"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rob Farley</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Heh, I've just done one of these too! Going to have to compare results. Mine uses cosine interpolation too. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
