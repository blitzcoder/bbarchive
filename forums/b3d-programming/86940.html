<!DOCTYPE html><html lang="en" ><head ><title >RenderWorld slowdown problem</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >RenderWorld slowdown problem</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >RenderWorld slowdown problem</a><br><br>
<a name="985608"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >WildCat</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Please, can anyone help me to find out a cause of slowdown of my Blitz3D application? The situation is that everything's fine when I run it alone (25-50 FPS). Then I want to run another Blitz3D app behind it, say it's my gameserver. It doesn't take much CPU time, it doesn't even use Graphics3D mode. After all, it checks if it's in a background and if so, it doesn't draw anything at all!<br><br>Well, when I run my game having this 'server' started, the game slows down to 2-3 FPS. Finding a bottleneck shows that the RenderWorld command is executed too long (over 200msecs).<br><br>This trouble happen first on this hardware: Intel Pentium 4 CPU 1.6Ghz (single core), nVidia 7600GS AGP 256Mb VRAM, 1Gb RAM. Before this, everything was fine on dual-core computers, even with integrated video...<br><br>My scene consists of over 30K tris and there are some heavy textures 2048x2048 and 1024x1024. But the difference is too large to my mind, taking into account that the second application ('server') doesn't use much CPU nor GPU time and doesn't operate with much data...<br><br>So, who can tell me where should I find the clues? <br><br></td></tr></table><br>
<a name="985609"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >WildCat</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> And there's one funny addition. If I run my 'server' _after_ the game, this doesn't slow it down absolutely!! Both apps run well! <br><br></td></tr></table><br>
<a name="985610"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GIB3D</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm not sure where I got this from but it helps. You can run more than one program at the same time without totally slowing your computer down. I'm guessing you can add this to your program yourself ;)<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Local SV_FPS=60
Local RTime=Floor(1000.0/SV_FPS)
Local Limited=True
Local CTime

While Not KeyDown(1)
	
	
	
	UpdateWorld
	RenderWorld
	
	n=RTime-(MilliSecs()-CTime)
	Delay n-(Limited+1)
	Flip Limited
Wend</textarea> <br><br></td></tr></table><br>
<a name="985614"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Blitz3D apps hog as much CPU time as they can get, even if they don't need it. You can return CPU time to other apps by putting a small Delay in you main loop/s. <br><br></td></tr></table><br>
<a name="985621"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >WildCat</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Of course I do Delay in both apps. When I detect if it runs background I do Delay twice ;) <br><br></td></tr></table><br>
<a name="985796"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Seems to be Renderworld is interrupted by the other app frequently. No surprise, cause in a real game the whole loop with renderworld takes easily 17ms, sometimes 33. If the gameserver is using Delay 1 or 2 then it's likely rendering will be interrupted. What you could do is (well just an idea) use a variable that is accessible by both apps, somewhere in the ram. May be an enviroment variable, or use RtlMoveMemory with a userlib, however. Before you start Renderworld you set it to 1, then after the Render to zero again. The server may then check the variable and use a delay of the expected render time instead, if the variable was set to 1 recently (or, as a further approach: if it was set to the expected render time, instead of 1).<br><br>But as I said, if this is gonna help, that's really only a guess. <br><br></td></tr></table><br>
<a name="986265"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >WildCat</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thank you, JFK, you're giving good direction to explore! Well, if we'll suggest that the game app is being interrupted, why no other commands take more time to execute, only this damn RenderWorld? :) Ok, ok, researcher's blood should be cold :) <br><br>Please, if you can, explain also why we've got no slowdown when we run the game first? I have to discover which specific action of the server does interrupt render process... <br><br></td></tr></table><br>
<a name="986591"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have absolutely no idea why there is no slowdown the other way round. It sounds strange. Probably some Priority fights.<br><br>Basicly you should be aware that there are 2 DirectX Windows running. Windows must combine both for one graphicscard. I am no expert on this special subject, but I guess there is some kind of List of things to render, including the 2D stuff. Although this behaviour is bugous, it may play a role if you render 2D after 3D or 3D after 2D.<br><br>I would suggest you reduce a set of two testapps to the min, in order to isolate the bad stuff, and to get clear reproducable results. EG. A simple cube/camera 3D app and an other simple cls/rect 2D app. (Does your server do any 2D graphics anyway??).<br><br>You may also try to Hide the server window using the WinAPI commands (wasn't that HideWindow?? however) and see if it makes a diffrence. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
