<!DOCTYPE html><html lang="en" ><head ><title >Custom mesh exporting</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Custom mesh exporting</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Custom mesh exporting</a><br><br>
<a name="987864"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RifRaf</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Disregard, <br><br>I was having some issues with a custom export system, Right after posting my lengthly issue, I found my solution.<br><br>edit:<br>Ill try not to waste the post, and see if anyone can suggest a more effective way to save mesh data, im not really going for hard to crack format, just straight forward.<br><br>heres the meat of what im using now.  Indents got a little funky when I pasted them. sorry<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
   tc=CountTriangles(surf)
            DebugLog "WRITTING TRINGLES FOR "+STRIP_PATH$(DM\MESHNAME$)+" surface id ( "+s+" ) :: "+TC
            ;write the triangle count
            bank_writeint(pak_body,tc) 
			For t = 0 To tc-1
				x0#  = VertexX#(surf, TriangleVertex(surf, t, 0))
				y0#  = VertexY#(surf, TriangleVertex(surf, t, 0))
				z0#  = VertexZ#(surf, TriangleVertex(surf, t, 0))
				u0a# = VertexU#(surf, TriangleVertex(surf, t, 0), 0)
				v0a# = VertexV#(surf, TriangleVertex(surf, t, 0), 0)
				u02a# = VertexU#(surf, TriangleVertex(surf, t, 0), 1)
				v02a# = VertexV#(surf, TriangleVertex(surf, t, 0), 1)
				nx0# = VertexNX#(surf, TriangleVertex(surf, t, 0))
				ny0# = VertexNY#(surf, TriangleVertex(surf, t, 0))
				nz0# = VertexNZ#(surf, TriangleVertex(surf, t, 0))
				al0# = VertexAlpha#(surf, TriangleVertex(surf, t, 0))
				cr0# = VertexRed#(surf, TriangleVertex(surf, t, 0))
				cg0# = VertexGreen#(surf, TriangleVertex(surf, t, 0))
				cb0# = VertexBlue#(surf, TriangleVertex(surf, t, 0))
                ; 
				x1#  = VertexX#(surf, TriangleVertex(surf, t, 1))
				y1#  = VertexY#(surf, TriangleVertex(surf, t, 1))
				z1#  = VertexZ#(surf, TriangleVertex(surf, t, 1))
				u1a# = VertexU#(surf, TriangleVertex(surf, t, 1), 0)
				v1a# = VertexV#(surf, TriangleVertex(surf, t, 1), 0)
				u12a# = VertexU#(surf, TriangleVertex(surf, t, 1), 1)
				v12a# = VertexV#(surf, TriangleVertex(surf, t, 1), 1)
				nx1# = VertexNX#(surf, TriangleVertex(surf, t, 1))
				ny1# = VertexNY#(surf, TriangleVertex(surf, t, 1))
				nz1# = VertexNZ#(surf, TriangleVertex(surf, t, 1))
				al1# = VertexAlpha#(surf, TriangleVertex(surf, t, 1))
				cr1# = VertexRed#(surf, TriangleVertex(surf, t, 1))
				cg1# = VertexGreen#(surf, TriangleVertex(surf, t, 1))
				cb1# = VertexBlue#(surf, TriangleVertex(surf, t, 1))
                ;
				x2#  = VertexX#(surf, TriangleVertex(surf, t, 2))
				y2#  = VertexY#(surf, TriangleVertex(surf, t, 2))
				z2#  = VertexZ#(surf, TriangleVertex(surf, t, 2))
				u2a# = VertexU#(surf, TriangleVertex(surf, t, 2), 0)
				v2a# = VertexV#(surf, TriangleVertex(surf, t, 2), 0)
				u22a# = VertexU#(surf, TriangleVertex(surf, t, 2), 1)
				v22a# = VertexV#(surf, TriangleVertex(surf, t, 2), 1)
				nx2# = VertexNX#(surf, TriangleVertex(surf, t, 2))
				ny2# = VertexNY#(surf, TriangleVertex(surf, t, 2))
				nz2# = VertexNZ#(surf, TriangleVertex(surf, t, 2))
				al2# = VertexAlpha#(surf, TriangleVertex(surf, t, 2))
				cr2# = VertexRed#(surf, TriangleVertex(surf, t, 2))
				cg2# = VertexGreen#(surf, TriangleVertex(surf, t, 2))
				cb2# = VertexBlue#(surf, TriangleVertex(surf, t, 2))
                ;write all of this data
                bank_writefloat(pak_body,x0#)
                bank_writefloat(pak_body,y0#)
                bank_writefloat(pak_body,z0#)
                bank_writefloat(pak_body,u0a#)
                bank_writefloat(pak_body,v0a#)
                bank_writefloat(pak_body,u02a#)
                bank_writefloat(pak_body,v02a#)
                bank_writefloat(pak_body,nx0#)
                bank_writefloat(pak_body,ny0#)
                bank_writefloat(pak_body,nz0#)
                bank_writefloat(pak_body,al0#)
                bank_writefloat(pak_body,cr0#)
                bank_writefloat(pak_body,cg0#)
                bank_writefloat(pak_body,cb0#)
                ; 
                bank_writefloat(pak_body,x1#)
                bank_writefloat(pak_body,y1#)
                bank_writefloat(pak_body,z1#)
                bank_writefloat(pak_body,u1a#)
                bank_writefloat(pak_body,v1a#)
                bank_writefloat(pak_body,u12a#)
                bank_writefloat(pak_body,v12a#)
                bank_writefloat(pak_body,nx1#)
                bank_writefloat(pak_body,ny1#)
                bank_writefloat(pak_body,nz1#)
                bank_writefloat(pak_body,al1#)
                bank_writefloat(pak_body,cr1#)
                bank_writefloat(pak_body,cg1#)
                bank_writefloat(pak_body,cb1#)
				;
                bank_writefloat(pak_body,x2#)
                bank_writefloat(pak_body,y2#)
                bank_writefloat(pak_body,z2#)
                bank_writefloat(pak_body,u2a#)
                bank_writefloat(pak_body,v2a#)
                bank_writefloat(pak_body,u22a#)
                bank_writefloat(pak_body,v22a#)
                bank_writefloat(pak_body,nx2#)
                bank_writefloat(pak_body,ny2#)
                bank_writefloat(pak_body,nz2#)
                bank_writefloat(pak_body,al2#)
                bank_writefloat(pak_body,cr2#)
                bank_writefloat(pak_body,cg2#)
                bank_writefloat(pak_body,cb2#)
			Next ;tri
		Next ; surf
  EndIf

</textarea> <br><br></td></tr></table><br>
<a name="987881"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Not exactly shure what you mean by more effective (size?), one way would be to save only the data that is used, eg. when there is no 2nd UV set then simply omit these parameters.<br>One 16-Bit Word in the header could be used to signal (bitwise)what Parameters are used. This way you even get 2 optional parameters (14,15) for future additions or so.<br><br>But it makes the code more complicated (harder to read and easier to embed bugs), so I am not sure if it's worth the troubles, only for a few kBytes. <br><br></td></tr></table><br>
<a name="987890"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Unless all your meshes are completely unwelded, writing the vertices as they appear in each triangle is going to result in them being duplicated (so the result will always be unwelded, in fact). If you can use at least partially welded meshes you'd save some space by listing all the vertices in a surface first and then just storing the vertex indices in the triangle list, same as Blitz3D does internally. You wouldn't save any if you actually want unwelded meshes though.<br><br>As well as not storing the information you don't need (are you using vertex colours and a second UV set?) you might also be able to lose some precision on the information you do intend to use. Depending upon how important vertex normals are, you could multiply them all up by 127 (or so the largest one is 127, slightly better) and use only one byte to store them. Or do the same but with a short int. 16 bits is also usually enough precision for a simple, character-sized mesh - on those (ie. the tanks) you could set a single scale factor and multiply the vertex positions up so the largest is 32760 (ie. same suggestion as for normals, only with short ints - leave a bit off as error margin), then store these as short ints so they take up half the space. You'd have to convert short ints and bytes back to floats at load time, but there's probably not much of a speed hit for that. Anyway whether this is worthwhile depends on the complexity of your meshes, but if you use short ints for vertex positions and UVs in a normal sized character mesh the loss in quality is not likely to be noticeable (chances are that's still more precision than you were using anyway) for a 50% reduction in size.<br><br>Whatever you do, don't go crazy and decide to crush vertex positions down to single bytes (unless your meshes are super-simple and chunky and you don't care about quality). This is why MD2s look so bad and suffer from "wobbly" vertices. However, if you're feeling really stingy on space you can probably get away with this for the normals (you also don't need to store a scale for the normals as they can be whatever magnitude you like) and the UVs, which would normally be unsigned so you get twice the precision. <br><br></td></tr></table><br>
<a name="987899"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RifRaf</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> very useful tips, thanks guys.<br><br><div class="quote"> (are you using vertex colours and a second UV set?) <br></div><br>well i'm not, but the map editor will allow the creator to use whatever origin media they want to , so I was trying to keep the door open on most things.. such as a lightmap set of coordinates. <br><br></td></tr></table><br>
<a name="999440"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RifRaf</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, if you look at the above export code, and the loading code below. can you spot what im doing wrong.. I have a lightmap applied through gile[s] on channel 1, but if i try to apply it.. I get a mess.  I can load the primary uv fine if I bypass the lightmap textures it looks ok, just no lm.<br><br>  Any help would be appeciated.. thanks!!<br><br>Heres what i want<br><br><br><img src="http://www.empowergames.com/floaters.jpg"><br><br><br><br><br><br><br>And heres what I get<br><br><br><img src="http://www.empowergames.com/baduv.jpg"><br><br><br>heres the load code snippet<br><pre class=code>
    ;read the vert count for this surface          
        svcount=bank_ReadInt(loaded_pak)
        DebugLog "vert count is "+svcount
        For sv=0 To svcount-1
            x0#=bank_readfloat(loaded_pak)
            y0#=bank_readfloat(loaded_pak)
            z0#=bank_readfloat(loaded_pak)
            u0a#=bank_readfloat(loaded_pak)
            v0a#=bank_readfloat(loaded_pak)
            u02a#=bank_readfloat(loaded_pak)
            v02a#=bank_readfloat(loaded_pak)
            nx0#=bank_readfloat(loaded_pak)
            ny0#=bank_readfloat(loaded_pak)
            nz0#=bank_readfloat(loaded_pak)
            al0#=bank_readfloat(loaded_pak)
            r0#=bank_readfloat(loaded_pak)
            g0#=bank_readfloat(loaded_pak)
            b0#=bank_readfloat(loaded_pak)
            v0=AddVertex (s,x0,y0,z0)

            VertexTexCoords s,v0,u0a,v0a,  0,0
            VertexTexCoords s,v0,u02a,v02a,0,1
            VertexColor s,v0,r0,g0,b0,al0
            VertexNormal s,v0,nx0,ny0,nz0
			;;;;;;;;;;;;;;;;
		Next
        tc=bank_Readint(loaded_pak)
         For stt=0 To tc-1
           v1=bank_readint(loaded_pak)
           v2=bank_readint(loaded_pak)
           v3=bank_readint(loaded_pak)
           AddTriangle s,v1,v2,v3
        Next
   
          b=CreateBrush(255,255,255)
          BrushColor b,brush_Red,brush_Green,brush_blue
          If thistex &lt;&gt;0 Then  BrushTexture  b,thistex,0,0
          If thistex2&lt;&gt;0 Then  
                   TextureBlend thistex2,5
     		   BrushTexture b,thistex2,0,1
          EndIf
          BrushBlend b,brush_blend
          BrushFX b,brush_fx
          BrushShininess b,0;brush_shine#
          PaintSurface  s,b
          UpdateNormals mesh

     Next  
	 Return mesh

</pre> <br><br></td></tr></table><br>
<a name="999485"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RifRaf</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Problem solved.. it wasnt the code above. I forgot I was clusterizing my main map after loading wich was destroying the second uv set.. Thanks anyway! :) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
