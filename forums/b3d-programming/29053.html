<!DOCTYPE html><html lang="en" ><head ><title >3D sprite slowdown - heeelllp!!</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >3D sprite slowdown - heeelllp!!</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >3D sprite slowdown - heeelllp!!</a><br><br>
<a name="306691"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Who was John Galt?</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm creating a 2D game and I have just updated it to use 3D (quad) sprites. You have this ship that can fire tons (1000s) of bullets that remain in the air at the same time. Originally these were implemented as single pixel plots, but now they are alpha'd quads, each created using copyentity. When a maximum allowed number are fired, the oldest one is deleted each time a new one is created and the entity freed.<br><br>Now I'm not expected to be able to have as many bullets in the air as in the original version, but it seriously slows down once I have fired a couple of hundred and I have seen people have a lot more 3D sprites on screen at a time. The slowdown seems to come in quite sharply, the hard disk starts grinding and the computer eventually complains it's running out of virtual mem. Any ideas? <br><br></td></tr></table><br>
<a name="306699"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >poopla</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> The problems here are your making way to many memory intensive calls in freeing/creating/deleting type instances and quads on the fly.  What you need to do is implement a single surface system that recycles your particle type list(and possibly sorts them as well), then all the realtime updating is cleared out. <br><br></td></tr></table><br>
<a name="306709"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Who was John Galt?</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the feedback. My original system created and deleted type instancces for the bullets with no problems- not ideal perhaps but it worked fine with many more bullets than I have now. I don't know how blitz implements a copyentity internally, but I can hardly believe that creating say 200 copies of a quad, deleting them one at a time while creating say 200 more can bring my machine to its knees for what appears to be lack of memory. This is fragmentation on steroids. Any more ideas? Perhaps its the whole lack of 'single surface' thing? <br><br></td></tr></table><br>
<a name="306715"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >EOF</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Have a play with Skidracers <a href="/codearcs.php?code=437" target="_blank">single surface particle system</a> from the code archives.<br>I'm working on a single-surface version of my Sprite Control at the moment but it's far from complete. <br><br></td></tr></table><br>
<a name="306720"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Who was John Galt?</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ahh- ok thanx mate I will try that. <br><br></td></tr></table><br>
<a name="306730"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Who was John Galt?</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Right I've fixed the problem, but can't figure out why the change makes such a big difference. Look at the 'efinder' loop below. I replaced the commented out Draw3Dimage function call with the positionentity command and the change in speed/memory/not grinding hard disk/not crashing my machine was drastic. Can anyone figure out why this makes such a major difference with say 200 sprites on (or off!) screen?<br><br><pre class=code>

For efinder1=Each efinder
    ;Draw3Dimage efinder1\im,efinder1\x,efinder1\y
    PositionEntity efinder1\im,efinder1\x,efinder1\y,0
Next

Function draw3Dimage(quad,x,y,frame=0)
	PositionEntity quad,x,y,10
	Brush=GetEntityBrush(quad)
	Tex=GetBrushTexture(Brush)
	EntityTexture quad,Tex,frame
	Return
End Function

</pre><br><br>I look forward to single surface sprite control! <br><br></td></tr></table><br>
<a name="306735"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Neo Genesis10</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I assume you're using the Draw3DImage function as an easy way to change frames. The commands to retrieve the brush store the brush in memory and you aren't freeing them up. Try adding FreeBrush to your function. <br><br></td></tr></table><br>
<a name="306764"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Try to re-use your types, instead of deleting them :) <br><br></td></tr></table><br>
<a name="306774"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Who was John Galt?</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ahhhh..........<br><br>NeoGenesis- that sounds like it might be the problem. Good pointer ta.<br><br>Ross- Yep good tip cheers. <br><br></td></tr></table><br>
<a name="306782"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Who was John Galt?</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> that fixed it. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
