<!DOCTYPE html><html lang="en" ><head ><title >New commands for blitz3d!</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >New commands for blitz3d!</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >New commands for blitz3d!</a><br><br>
<a name="696005"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> hello!<br><br>well, after reading a bit in the forums i noticed that a bunch of people wat some commands like EntityRed() or CameraNearRange()...<br><br>i know there is a dll somewhere in here, and i have got this dll on my harddisk, but wouldnt it be easier above all for noobs, to make such commands? mark sibly?<br><br>i would have some ideas:<br><br><pre class=code>EntityRed(entity)
EntityGreen(entity)
EntityBlue(entity)
GetCameraZoom(entity)
GetCameraNearRange(entity)
GetCameraFarRange(entity)</pre><br><br>if you have any idea for additional commands in blitz, please post them here :) <br><br></td></tr></table><br>
<a name="696009"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't think commands of this nature are going to be worth Marks while when there are simple workarounds.<br><br>For example ....<br><br><pre class=code>

Type RGB
  field R, G, B
End Type

MyMesh = createsphere()
EntityCol( MyMesh, 200,50,150 )
Red = EntityRed( MyMesh )

;==============================
;==============================

Function EntityCol ( Entity, r, g, b )

  This.RGB = new RGB
  This\R = r
  This\G = g
  This\B = b
  entitycolor r, g, b 
  nameentity Entity, Handle( This )

End function

Function EntityRed( Entity )
  This.RGB = object.RGB( entityname( Entity ) )
  return This\R
end function

</pre><br><br>This isn't much effort on anyones part.  Features such as stencil shadows are far higher on my wish list and probably alot of others.<br><br>Stevie <br><br></td></tr></table><br>
<a name="696014"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> well, i don't think that blitz3d will have stencil shadows... rather bmx would have!<br><br>but i know how to workarround these things, but wouldnt it be much more easier to make these commands?<br><br>what do you say mark sibly? <br><br></td></tr></table><br>
<a name="696017"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tom</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> BEWARE! Some of the functions may be broken, use at own risk!<br><br>I've been meaning to go fix it, will do that soon.<br><br>Check decls for list<br><br>I mainly use it for the memory peek/poke. Check the entity system too (source should be there)<br><br>www.tomspeed.com/memorylib/ <br><br></td></tr></table><br>
<a name="696026"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> thx, but i allready have this libary... i tried to help the community by praying makr sibly to make these commands... <br><br></td></tr></table><br>
<a name="696128"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >t3K|Mac</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> hu, what happened to your page tom? all i get is a little "Nosey!". hacked? <br><br></td></tr></table><br>
<a name="696193"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Danny</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Tom, what's the difference between your peek/poke functions and Blitz's own ones? Are yours faster???<br><br>Thanks,<br>D. <br><br></td></tr></table><br>
<a name="696207"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Blitz's own ones only work on banks. :) <br><br></td></tr></table><br>
<a name="696432"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bobysait</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> ^^' ... maybe a "AnimatedVertexCoord()" would be nice... <br><br>and what about a "GetvertexWeight()" to get the weight of each vertex affected by bones ... mmm... maybe i dream ! <br><br></td></tr></table><br>
<a name="696454"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MCP</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Tom, great work on the Render to texture stuff - you think you could add some 3d line and pixel render commands?<br><br>cheers,<br><br>Roy <br><br></td></tr></table><br>
<a name="696488"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> yes, the animated vertex coords would be a nice idea :)<br>helpful at least for me, and the oter stencil-shadow-system-develpoer-who-cannot-access-animated-vertex-coords... <br><br></td></tr></table><br>
<a name="696535"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >b32</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> I believe you can get the animated vertex position by setting the parent to 0:<br><pre class=code>
;these contain the vertex x,y,z position
Global xx#, yy#, zz#

;call this function with the handle to the mesh (the actual child mesh that you need the coords from)
;followed by the surface index and the vertex index
Function GetVertexCoords(obj%, surfaceindex%, vertexindex%)
	
        local oldp%

	oldp = GetParent(obj)
	EntityParent obj, 0
		
	surf = GetSurface(obj, surfaceindex)

	xx# = VertexX(surf, vertexindex)
	yy# = VertexY(surf, vertexindex)
	zz# = VertexZ(surf, vertexindex)
	
	TFormPoint xx, yy, zz, obj, 0
	
	xx# = TFormedX()
	yy# = TFormedY()
	zz# = TFormedZ()
	
	EntityParent obj, oldp
	
End Function
</pre><br>I used the mak_running.x model from the examples to test it:<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
;-----------------------------------------------------------------------------------------------------
;												Globals()
;-----------------------------------------------------------------------------------------------------

	Global xx#, yy#, zz#
	
	Graphics3D 640, 480, 0, 2
	SetBuffer BackBuffer()

	;create camera	
	camera 			= CreateCamera()
	PositionEntity 	camera, 0, 20, -50
	
	;Load anim mesh
	robot		= LoadAnimMesh("mak_running.x")
	Animate 	robot, 1, 0.1

	;create cursor
	cursor	 		= CreateSphere()
	EntityOrder 	cursor, -1
	EntityColor		cursor, 255, 0, 0
	EntityFX		cursor, 1
	
	;find child "cylinder"	
	robot   = GetChild(robot, 1)
	robot   = GetChild(robot, 2)
	robot   = GetChild(robot, 1)
	robot   = GetChild(robot, 1)
	submesh = GetChild(robot, 2)
	
	;select vertex no 20	
	StickyVertex = 20

	;main loop	
	While Not KeyDown(1)
	
		UpdateWorld 
		RenderWorld 
	
		;calculate actual vertex position		
		GetVertexCoords(submesh, 1, StickyVertex)
		
		;move "cursor" mesh to calculated point
		PositionEntity cursor, xx#, yy#, zz#
		;print coords
		Text 0, 0, "returned (xx, yy, zz) : " + xx# + "," + yy# + "," + zz#
		
		Flip 
	
	Wend
	
	End

;-----------------------------------------------------------------------------------------------------
;											   GetVertexCoords()
;-----------------------------------------------------------------------------------------------------
;get the actual vertex coords
Function GetVertexCoords(obj, surfaceindex, vertexindex)
	
	oldp = GetParent(obj)
	EntityParent obj, 0
		
	surf = GetSurface(obj, surfaceindex)
	xx# = VertexX(surf, vertexindex)
	yy# = VertexY(surf, vertexindex)
	zz# = VertexZ(surf, vertexindex)
	
	TFormPoint xx, yy, zz, obj, 0
	
	xx# = TFormedX()
	yy# = TFormedY()
	zz# = TFormedZ()
	
	EntityParent obj, oldp
	
End Function
</textarea> <br><br></td></tr></table><br>
<a name="696558"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> worth checking out :)<br>but it would be easier to acces them via blitz, mark? <br><br></td></tr></table><br>
<a name="696575"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> WOW never realized this is so easy!<br><br><pre class=code>Function SetAnimShadowMesh(ent)
SetShadowMesh(ent)
cnt_children = CountChildren(ent)
If cnt_children = 0 Then Return
For i = 1 To cnt_children
	SetAnimShadowMesh(GetChild(ent, i))
Next
End Function</pre><br><br>thx bram!<br><br>now mark sibly, what about these ideas? why not replying? <br><br></td></tr></table><br>
<a name="696652"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bobysait</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Bram32 : Problem is that you don't know how vertices are affected by bones transformations. If the weight of the bone you move is set to 0.5, the vertex will not have coordinates you get with your function. And, notice that, you don't know which vertex is affected by which bones. So if you try to get vertex coordinates with TFormPoint, yu 'll have to know before is the vertex is really affected by the bone. <br><br></td></tr></table><br>
<a name="696661"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >b32</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't know .. are all bones alike ? The "mak_running.x" model has elements called 'bone', which behave like pivots. I don't know if other models work the same. <br><br></td></tr></table><br>
<a name="696665"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bobysait</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't remember, but x files do not support more than one bone per vertex. in b3d format, you can set up to 4 bones per vertex (  not sure, but i really think it's something like this ). And I thought about getting coords of vertex form Mesh that have more than one bone in the hierarchy. if the whole mesh use only one bone, it's simple as using TFormPoint. But if the mesh has lot of bones, how can you know which vertex of the surface of the mesh will move with bone ?<br>In blitz3d, for the moment, this is not supported.<br>We maybe can use an alternate strutur using type, and preloading the AnimMesh with the readfile command in the way to ripp the hierarchy and register weights of all the vertices, but it should be easier if Blitz3D made it ...<br><br>( really sorry for my bad english... =&gt; i'm french ! ) <br><br></td></tr></table><br>
<a name="696686"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >b32</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Aha, I understand .. I've never used animated .B3D's before. Thanks for your explanation <br><br></td></tr></table><br>
<a name="696750"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't think the DX7 .X files (which B3D uses) support bones at all, they just animate the geometry. <br><br></td></tr></table><br>
<a name="696808"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> *.3ds and *.x are working animated on my shadow system, but NOT B3D<br><br>*.x and *.3ds are BONE animated, that is like pivots - you just have to declare each bone as a shadow caster for itself!<br><br>*.b3d are VERTEX animated, thats the second kind of animation, wich is much more popular and in use, but it is not that easy!<br><br>the shadow system from andreymans fx-libary supports *.3ds only! like my one!<br><br>As soon as my upload problems are solved and the shadow system gets some sort of beta, i will upload it :) ! <br><br></td></tr></table><br>
<a name="696813"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> I may be misunderstanding.<br><br>For me B3D files support bones. Move the bones and the attached vertices move using their weights, with the bone.<br><br>DirectX 7 .X files just store rotation/position information at key frames, don't they?<br><br>I always thought bone animation was the newer way- you could animate bones and the vertices would follow, with the vertex weights allowing you to "skin" the models, whereas vertex animated models were the old way- you have no way to control them easily and just have to use the animation they are given in the models.<br><br>I like animating the top half of an entity differently to the bottom half you see- Like in the Prince of Persia series of games :) <br><br></td></tr></table><br>
<a name="696831"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> there are two kinds of animations: bone-aninations (3ds, x) and vertex animations(b3d)<br><br>mostly used is b3d vertex-animations, but this is not so easy to implement into s shadow system. 3ds and x are the easy ones, but the are not very popular.. <br><br></td></tr></table><br>
<a name="697198"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BIG BUG</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> Cygnus is right. Bone animation is a kind of vertex animation and works exactly as explained and is only supported by B3D files.<br><br>MD2 is another format that supports vertex animation. Unlike B3D it's frame based(each keyframe contains the whole mesh), so there is no need for bones.<br><br>I don't know how to call that animation by 3ds &amp; X(maybe Position or Object Animation??), but it's definitly not using Bones. <br><br></td></tr></table><br>
<a name="697296"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> hierarchy animation. <br><br></td></tr></table><br>
<a name="697468"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >b32</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've been trying to work something out to find b3d vertex positions. It works up to a point on the model i tested it with. But the arms are still wrong, they somehow stay in their original position and move only a bit.<br>I've used the emo girl from clownhunters emo game 2.<br><a href="http://www.codersworkshop.com/viewpost.php?id=78609" target="_blank">http://www.codersworkshop.com/viewpost.php?id=78609</a> (if i post a direct link, the codebox get scrambled)<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
	;internal counters
	Global numc%

	;will contain the number of children
	Global count_children%
		
	;setup graphics	
	Graphics3D 640, 480, 0, 2
	SetBuffer BackBuffer()

	;create camera	
	camera 			= CreateCamera()
	PositionEntity 	camera, 0, 20, -100
	CameraZoom		camera, 2.4
	
    ;i've used this on a single surface b3d file
    ;it is the emo girl from clownhunters game (v2).
    ;http://www.codersworkshop.com/viewpost.php?id=78609	
	Const meshfilename$ = "emo girl.b3d"

	;Load anim mesh
	mesh		= LoadAnimMesh(meshfilename$)
	Animate 	mesh, 1, 1

	;create cursor prototype
	ocursor	 		= CreateSphere()
	ScaleMesh	 	ocursor, 0.4, 0.4, 0.4
	EntityColor		ocursor, 255, 0, 0
	EntityFX		ocursor, 1
	EntityOrder		ocursor, -1
	HideEntity ocursor	
		
	;count children
	count_children% = EnumerateChildren(mesh)
	
	;make room
	Dim enumChild%(count_children)
	Dim enumName$(count_children)
	Dim x1#(count_children)
	Dim y1#(count_children)
	Dim z1#(count_children)
	
	;store children
	EnumerateChildren(mesh, True)
	
	Print "Found using recursive EnumerateChildren:"	
	;print out all enumerated children	
	For i = 0 To count_children%
		;write name
		Write EntityName$(enumChild%(i)) 
			;write parent structure
			p = enumChild%(i)
			While (GetParent(p) &lt;&gt; 0)
			 	p = GetParent(p)
				Write "-&gt;" + EntityName$(p)
			Wend
		Print
	Next
		
	;!!!!!!!!!!!!!!!!!!!!!!!! - i tested this on a single surface model, so no idea how the
	; count vertices
	;!!!!!!!!!!!!!!!!!!!!!!!! - other vertices are indexed, i assumed the counter kept increasing
	cv% = 0
	For i = 1 To CountSurfaces(mesh)
		surf% = GetSurface(mesh, i)
		cv% = cv% + CountVertices(surf%)	
	Next
	
	;set array sizes
	Dim joints#(count_children%, cv%)
	Dim parents(cv, 10) ;store parents (max parents = 10)
	Dim max(cv)			;number of parents
		
	;parse file	
	ff = ReadFile(meshfilename$)
	Print "Found parsing file:"
	While Not(Eof(ff))
		s$ = Chr$(ReadByte(ff))
		;search for "N"
		If s$ = "N" Then 
			;read next 3 characters
			s$ = "N" + Chr$(ReadByte(ff)) + Chr$(ReadByte(ff)) + Chr$(ReadByte(ff))
			;search for "NODE"
			If s$ = "NODE" Then
				n$ = "": cc$ = "X"
				length = ReadInt(ff)
				cc$ = "": n$ = ""
				While cc$ &lt;&gt; Chr$(0)
					n$ = n$ + cc$
					cc$ = Chr$(ReadByte(ff))
				Wend
				Print n$
			End If
		End If

		;search for "B"
		If s$ = "B" Then 
			;read next 3 characters
			s$ = "B" + Chr$(ReadByte(ff)) + Chr$(ReadByte(ff)) + Chr$(ReadByte(ff))
			;search for "BONE"
			If s$ = "BONE" Then
				;inc bone counter
				boneindex = boneindex + 1
				;read all vertices affected by the bone
				length = ReadInt(ff)
					For i = 1 To length / 8
						;read vertex index
						vindex% = ReadInt(ff)
						;read weight
						joints#(boneindex, vindex%) = ReadFloat(ff)
						;link parent to vertex
						parents(vindex, max(vindex)) = boneindex
						;increase number of parents for vertex
						max(vindex) = max(vindex) + 1
					Next
			End If
		End If
	Wend 
	CloseFile ff
	
	;will contain the pivots
	Dim cursor%(cv, 10)
	
	;create visible red spheres
	surf = GetSurface(mesh, 1)
	Dim show(cv)	
	For i = 0 To cv% - 1
		show(i) = CopyEntity(ocursor)		
	Next

	;create a pivot for each vertex, for each parent
	For i = 0 To cv% - 1
		For j = 0 To max(i)
		
			cursor(i, j) = CreatePivot()
			;place it on vertex
			PositionEntity cursor(i, j), VertexX(surf, i), VertexY(surf, i), VertexZ(surf, i)
			l_parent%	=	enumChild(parents(i, j))
			l_rx#		=	EntityPitch(l_parent,1)
			l_ry#		=	EntityYaw(l_parent,1)
			l_rz#		=	EntityRoll(l_parent,1)
			RotateEntity l_parent,0,0,0,1
			EntityParent cursor(i, j),l_parent
			RotateEntity l_parent,l_rx,l_ry,l_rz,1
			
		Next
	Next
	
	WaitKey()
				
	;main loop	
	While Not KeyDown(1)
		
		;render world	
		UpdateWorld 
		RenderWorld 
										
		;scan all vertices
		For i = 0 To cv% - 1
		
			;reset output coordinates to 0
			xx# = 0
			yy# = 0
			zz# = 0
			
			;scan all parent joints
			For j = max(i) To 0 Step -1
				
				;store parent
				oldp% = GetParent(cursor(i, j))
				;reset parent
				EntityParent cursor(i, j), 0
							
				;transform point to real world
				TFormPoint EntityX(cursor(i, j)), EntityY(cursor(i, j)), EntityZ(cursor(i, j)), 0, 0;cursor(i, j), 0
				
				;find this parent
				fnd = parents(i, j)
				
				If fnd &gt; 0 Then
					;add the coordinates in the amount, stored in "joints"
					xx# = (xx) + (TFormedX() * joints(fnd, i))
					yy# = (yy) + (TFormedY() * joints(fnd, i))
					zz# = (zz) + (TFormedZ() * joints(fnd, i))
				End If
				
				;reset parent				
				EntityParent cursor(i, j), oldp

			Next
	
			;place a red dot on the calculated point
			;CameraProject camera, xx, yy, zz
			;Rect ProjectedX(), ProjectedY(), 5, 5
			PositionEntity show(i), xx, yy, zz
		Next
		
		;turn 3d object
		TurnEntity mesh, 0, 1, 0

		Flip 
	
	Wend
	
	End	


;-----------------------------------------------------------------------------------------------------
;											EnumerateChildren()
;-----------------------------------------------------------------------------------------------------
;recursively enumerate children
Function EnumerateChildren%(mesh%, store% = False, reset% = True)

	;set counter	
	If Not reset Then numc% = numc% + 1 Else numc% = 0
	;store mesh
	If store Then enumChild(numc%) = mesh

	;recursively enumerate all children	
	For i = 1 To CountChildren(mesh)
		g = GetChild(mesh, i)
		EnumerateChildren% g, store%, 0
	Next
	
	;return number of children	
	Return numc%
	
End Function

;-----------------------------------------------------------------------------------------------------
;						
</textarea><br>I've used this method:<br>(1) parse file, search all parents for the vertices and the amount/weight<br>(2) place a pivot on each vertex for every parent it uses and connect it to this parent, thus creating several "versions" of each vertex.<br>(3) on runtime, calculate the average position between each version of the vertex, taking in account their weights. <br><br></td></tr></table><br>
<a name="697492"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bobysait</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> furious but not fast  LOL<br><br>For the moment, it 's the only one that can return vertex weight ! Good work.<br><br>But i try to understand two things :<br>- if you parse the file, you'll get directly the vertices weights. So why all this stuff ?<br>- if you parent a pivot to a bone , you move the pivot at the position of one vertex ( you make this operation for each vertex and each bones ), you turn the bone =&gt; you 'll know if the pivot has moved. like this, you'll know if the vertex weight, calculating the difference between the angles and the distance from the vertex to the Bone. And as far as i know, you'll not have to parse the file ...<br><br>So, I don't understand why you do the 2 method for the same result ?<br><br><br>[edit]<br>Ok, i realise that i'm so stupid :)<br>=&gt; If we parent the pivot to the bone, of course the pivot will move with it. So we'll never know if the vertex is "attached" to the bone... so it doesn't mind anything to do what i said... just a loss of time .<br>Don't care about my post :-s <br><br></td></tr></table><br>
<a name="697495"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bobysait</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> I found a part of your problem , but it seems this is not a good method !<br>=&gt; Rotations are not setted to 0,0,0 when you place the pivot<br><br>replace with this :<br><pre class=code>
	;create a pivot for each vertex, for each parent
	For i = 0 To cv% - 1
		For j = 0 To max(i)
		
			cursor(i, j) = CreatePivot(ocursor)
			;place it on vertex
			PositionEntity cursor(i, j), VertexX(surf, i), VertexY(surf, i), VertexZ(surf, i)
			l_parent%	=	enumChild(parents(i, j))
			l_rx#		=	EntityPitch(l_parent,1)
			l_ry#		=	EntityYaw(l_parent,1)
			l_rz#		=	EntityRoll(l_parent,1)
			RotateEntity l_parent,0,0,0,1
			EntityParent cursor(i, j),l_parent
			RotateEntity l_parent,l_rx,l_ry,l_rz,1
			
		Next
	Next
</pre><br><br><br>But there will still have a probleme for the scale. It's not sure the scale has not been modified during Keyframes . So initial position will may be wrong. And that don't really want say the bones have 0,0,0 angles at the first frame... <br><br>but i'm currently asking if =&gt; we could directly get the weights and vertex pos from the b3d file no ?<br><br>I'm trying to do it. but here, I go and sleep, tomorrow, i will try to finish ! <br><br></td></tr></table><br>
<a name="697506"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >kevin8084</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> I notice that when you're parsing for NODE you only parse out the "name" of the node, yet there is other vital information such as animation keys contained in the NODE chunk. Check for any animation keys contained in the parent node of the arms as this will undoubtedly affect the final orientation, etc. of the children.<br><br>Kevin <br><br></td></tr></table><br>
<a name="697680"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >b32</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks, Bobysait! I've updated the code with your routine. I've been trying to do something similair with the scaling, but it didn't work out.<br>Kevin, I will try parsing the animkeys. However I don't understand the b3d format too well. <br><br></td></tr></table><br>
<a name="890249"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Axel Wheeler</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry to revive an old topic, but it looks like this discussion turned away from the entityred, entitygreen, and entityblue question.  Stevie G's code:<br><br><div class="quote"> <br>I don't think commands of this nature are going to be worth Marks while when there are simple workarounds.<br><br>For example ....<br><br><br><br>Type RGB<br>  field R, G, B<br>End Type<br><br>MyMesh = createsphere()<br>EntityCol( MyMesh, 200,50,150 )<br>Red = EntityRed( MyMesh )<br><br>;==============================<br>;==============================<br><br>Function EntityCol ( Entity, r, g, b )<br><br>  This.RGB = new RGB<br>  This\R = r<br>  This\G = g<br>  This\B = b<br>  entitycolor r, g, b <br>  nameentity Entity, Handle( This )<br><br>End function<br><br>Function EntityRed( Entity )<br>  This.RGB = object.RGB( entityname( Entity ) )<br>  return This\R<br>end function<br><br><br><br>This isn't much effort on anyones part. Features such as stencil shadows are far higher on my wish list and probably alot of others.<br><br>Stevie <br> <br></div><br><br>While this works, it is hardly a "simple workaround" as it involves the undocumented Object keyword, and at least intermediate Blitz knowledge besides.  Most Blitz programmers would not understand the code above, let alone be able to write it.  <br><br>I mean, there are simple workarounds to things like not having a glove compartment in a car, or not having a handle on a refridgerator, but try selling products without them.  In Blitz3d you can set an entity's color, but you can't read it back without creating a whole new data structure and learning new functions you might never have to use otherwise.  That's just silly.  It's clearly an oversight that will eventually (hopefully?) be fixed. <br><br></td></tr></table><br>
<a name="890253"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >OJay</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="http://www.blitzbasic.com/Community/posts.php?topic=75711" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=75711</a> <br><br></td></tr></table><br>
<a name="890435"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Axel Wheeler</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#32">[#32]</a></td></tr></table></td></tr><tr ><td class="posttext"> Awesome!  Such a small file too.<br><br>(If I were being picky I would just say that most of those commands aren't really necessary for the sake of completeness; they are useful extras.  Reading an entity's color is more basic and probably ought to be included in the next update.  As I say that would be nit-picking and I would never do such a thing.)<br><br>Thanks Ojay. <br><br></td></tr></table><br>
<a name="890862"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#33">[#33]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Stevie G's code: <br></div>i could have figured that out by myself. Ojays code link to that dll seems much more like it.<br><br>now sleep tight little thread... <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
