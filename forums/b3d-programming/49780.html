<!DOCTYPE html><html lang="en" ><head ><title >Sorting a Linked List? Help please!</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Sorting a Linked List? Help please!</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Sorting a Linked List? Help please!</a><br><br>
<a name="553392"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DH</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> K, so say I create a linked list with 1000 arbitrary float values.  What is THE most efficient way to sort from smallest to biggest?<br><br>I cant think of a way off hand thats efficient (and wouldn't down the fps by too much).<br><br>Any thoughts? <br><br></td></tr></table><br>
<a name="553410"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >octothorpe</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> The paper <a href="http://www.cs.mtu.edu/~shene/PUBLICATIONS/1996/3Conline.pdf" target="_blank">A COMPARATIVE STUDY OF LINKED LIST SORTING ALGORITHMS</a> suggests that the Wegner variation on <a href="http://en.wikipedia.org/wiki/Quicksort" target="_blank">Quicksort</a> was the fastest tested (see the paper for a C code example,) beaten only by a <a href="http://en.wikipedia.org/wiki/Binary_tree_sort" target="_blank">Tree sort</a> (which "cheated" because it was using a doubly linked list.)<br><br>One thing to consider is whether you'll be creating a new list of values to be sorted every time, or re-sorting the previously sorted values which may have changed only a little?  Another algorithm may be more efficient if the list is already mostly sorted after the first sort.<br><br>By the way, how are you constructing your linked lists?  I wrote my own function libraries for linked lists and maps (I calls 'em hashes!) and I'm curious about alternate approaches.  :) <br><br></td></tr></table><br>
<a name="553415"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DH</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, the construction of the list is by going through my cloud particles and adding each particle location to the list.<br><br>I then need to sort it to find out which is closest to the camera, and thus re-order the zlist of the particles.  The partciles locations will be changing every scan (almost every scan), thus it will always be a new list.<br><br>Which method would you recommend? <br><br></td></tr></table><br>
<a name="553429"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> What are you doing with the sorted data? Why do you need to know which is nearest the camera? The GPU should take care of any z sort/blending issues when drawing the particles.<br><br>I'd make certain this complicated list work was needed before considering implementations! ;) <br><br></td></tr></table><br>
<a name="553432"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DH</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Unfortunatly Blitz zordering needs to be re-ordered at times, it isn't handleded by the GPU when<br><br>A. the camera changes position in relation to a mesh<br>B. Your using a custom single surface system that changes the locations of the polygons each scan of the program.<br><br>So, i find out what the distance is of each particle to the camera, throw that into a list, and I need to sort the list so I can do a 're-order' of the polygons to get correct alpha effects.  Thus, I need to sort a list. <br><br></td></tr></table><br>
<a name="553629"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >octothorpe</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Are you expecting the camera and/or particles to be moving around wildly?  If your camera is slowly revolving around a fountain of particles (where particles are moving away from each other at all times), I would expect the previously sorted list to be mostly correct and you may benefit from an algorithm which is good with mostly-sorted lists.  If your camera is randomly teleporting every frame around a room with some kind of vortex of particles (which intermingle wildly), you might as well be sorting from scratch every time.<br><br><div class="quote"> Which method would you recommend? <br></div><br><br>For the initial sort, Quicksort.  For latter sorts, probably Quicksort.  :)<br><br>Quicksort is really really fast.  It blows my mind.  Try it out - you might find that you don't need to optimize further.<br><br><div class="quote"> So, i find out what the distance is of each particle to the camera <br></div><br><br>Ouch, that might be slow, what with the square roots and all.  If it becomes necessary, you could try using some dirty math to get much faster - but somewhat inaccurate - distances. <br><br></td></tr></table><br>
<a name="553677"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, he doesn't need to know the <i>actual</i> distance each particle is from the camera - the squared distance will be good enough, so there's no need to use Sqr() at all:<br><pre class=code>
dx# = cam_x# - part_x#
dy# = cam_y# - part_y#
dz# = cam_z# - part_z#
square_dist# = dx*dx + dy*dy + dz*dz
</pre><br><br>Also, I'm pretty sure that using 2D (X and Z) coords will be good enough for this job, thus speeding things up a bit more:<br><pre class=code>
dx# = cam_x# - part_x#
dz# = cam_z# - part_z#
square_dist# = dx*dx + dz*dz
</pre> <br><br></td></tr></table><br>
<a name="553699"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DH</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> @octothorpe:<br>Since the particles are CONSTANTLY being re-arranged (its very random), I will have to resort the list every time, however I can get away with doing it once every 60 frames without anyone noticing.<br><br>@big10p:<br>Those are some great suggestions!  I didn't even think about the sqrt thing and the fact that since everything is relative that I dont really need it to be sqrt'ed and just use the base formula for the comparrison.  Excellet, that will same me some speed most definately! <br><br></td></tr></table><br>
<a name="553758"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DH</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Whoa, just tried the 'blitz' version of the quick sort!<br><br>OMG...<br><br>My sorting (using a linked list manually inserting and doing comparissons) comes to 64 ms for 1000 floats.<br><br>The QuickSort does 1000 random floats in 2 ms! <br><br></td></tr></table><br>
<a name="553946"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >octothorpe</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm assuming you found this 'Blitz' Quicksort in the Code Archives? <br><br></td></tr></table><br>
<a name="553957"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've gotta say though, 2ms is a lot when you consider 60fps only gives you 16 ms a frame to work with. Plus what level of hardware are you testing on and how does it compare with your minimum requirements? Will that 2 ms be 4-5+ ms only end-users machines?<br><br>If you can get away with using it every 60 frames, you'll hav to be careful not to introduce a big performance hit every 60th frame. Is there some way you can work on only a selection of particles each frame and then apply you update every 60th frame? Sorting the whole lot won't happily break down into sorting say every 50 sprites. <br><br></td></tr></table><br>
<a name="554013"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DH</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> I understand your concerns Shifty, but it 'needs' to be done the way it is being done.<br><br>@octothorpe:<br>Nope, ported an example of the c code from the quicksort link you gave me to blitz3d with a few minor optimizations for blitz!<br><br>2 ms for 1000 is very good, and is also worst case possiblity.  You have to remember that chances of me having more than 1000 cloud particles on the screen is very thin.<br><br>Also, 16ms per frame is when your waiting for vsync, so it's wasted time.  If I turn the flip wait off and frame limit to 60, then I have an extra 16ms to use at my disposal.<br><br>Currently the tests have been pretty good.  I can do 1000 cloud particles on the screen at a total of 2ms hit to the system.  Now thats:<br>A. Getting all my particle positions relative to the camera,<br>B. Coloring the particles and setting up their coordinates<br>C. factoring in a formation value for the cloud<br>D. Sending all the particles displayed to a list<br>E. Sorting the list based on distance from the camera<br>F. Then going through the final list and ordering the 'quad's in the proper order so not to get alpha artifacts.<br><br>The system should be complete with a cloud editor within a week or so.  Its very similar to the cloud system used in M$ flight simulator 2005.<br><br>The hardware I am testing this on is a 2.4 ghz system, so i can expect the 2 ms to double on half a machine.<br><br>I can see your a bit new to blitz there Shifty, I am unsure of your past experiences with game development however I assure you I am well qualified to optimize the system to peak performance.  I thank you again for your concerns, however there are simply some things you can't cut corners on (such as sorting quads to keep alpha artifacts out).<br><br>:-) <br><br></td></tr></table><br>
<a name="554132"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm sure you know what you're doing better than I. Not many people don't! Just thinking out loud taking in my old Comp Sci training which wasn't for fun things like computer games. I'm off the (uneducated) opinion that's sorting's not the fastest thing in the world and if it's possible to avoid, avoiding is good. But then if your solution works then kudos, and I'm interested to see the results :D <br><br></td></tr></table><br>
<a name="554289"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >octothorpe</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Also, 16ms per frame is when your waiting for vsync, so it's wasted time. If I turn the flip wait off and frame limit to 60, then I have an extra 16ms to use at my disposal. <br></div><br><br>I don't follow.  1s/60fps = 16.67ms each frames.  Vsyncing or not, that's all the time you get if you want to keep your game running at 60fps, and I wouldn't consider it wasted - you're likely going to have a lot more things you're going to want to do per frame unless this is just a cloud demo.<br><br>That said, premature optimization is the root of all evil. <br><br></td></tr></table><br>
<a name="554687"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DH</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> @octothorpe:<br>First off let me answer your 'I don't follow' with 'Vsyncing or not' isn't accurate in your argument.  If I vsync, then I could be running at 50 fps, or 65, depending on how my app syncs to the screen vsync (and thus, a wasted 16ms of the system sitting there waiting for the vsync, 16 ms i can't use).  So it can be a very speratic 60 fps if I leave vsync on.  Turning it off lets me use a guaranteed 16 ms every frame.  16 ms is alot of time with the systems I have been developing (particle systems, tree systems, cloud systems, etc).  When I combine worst case with each system i get about 8 ms of time I need to account for (all systems together take about 8ms to process per frame).<br><br>True, every ms counts, however you must realize that there are some things that just take time.  If the system is completely maxed out (beefed it up to 1000 cloud particles) and it is only costing me 2ms, then so be it....<br><br>When it comes to 1000 alphaed cloud particles I have to worry about flip times and fill rates before I have to worry about a 2ms sort and re-order of the zorder of the quads.<br><br>2ms in this case is completely acceptable and far better than I had hoped (was expecting around 40 ms, in which case would have thrown the whole project on the back burner till I figured out a better method).<br><br><div class="quote"> That said, premature optimization is the root of all evil. <br> <br></div><br><br>I am not sure I follow... <br><br></td></tr></table><br>
<a name="554696"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >octothorpe</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Premature optimization is the root of all evil. <br></div><br>It's a famous quote attributed to Tony Hoare (incidentally the inventor of the Quicksort algorithm) suggesting that programmers have a tendancy to paint themselves into corners because they try to optimize things before they know where performance bottlenecks are.  I was chiding myself. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
