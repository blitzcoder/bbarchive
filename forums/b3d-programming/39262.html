<!DOCTYPE html><html lang="en" ><head ><title >smooth scroll</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >smooth scroll</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >smooth scroll</a><br><br>
<a name="437641"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ZT</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Trying to get smooth scrolling for a 2D game in Blitz 3D, but whatever I do, there is always a bit of jerkiness. The scrolling dowsn't appear smooth to me, and somtimes, it will give a noticeable jerk. I also want the screen to scroll slower than it is, but can't get this to work.<br><br>Can anyone give any suggestions as to why it's not working?<br><br>Thanks<br><br>Code below...<br><br><br><br><br>Global Debug = True<br><br><br>Type FrameRate<br>	Field TargetFPS#<br>	Field SpeedFactor#<br>	Field TimeElapsed#<br>	Field FPS#<br>	Field FPS2#<br>	Field FPS3#<br>	Field FPS4#<br>	Field FPS5#<br>	Field CurrentTicks<br>	Field FrameDelay<br>End Type<br><br>Global no0# = 0.00000000001	;avoids division by zero<br>;for example; any time you perform a division, add no0# to the divisor<br>;quotient# = dividend# / (divisor# + no0#)<br><br>Global FL.FrameRate = New FrameRate<br><br>;initialize frame limiter<br>FL\TargetFPS# = 60	;set this to whatever FPS your code is based on<br>FL\FrameDelay = MilliSecs()<br><br><br>Graphics 800,600<br>quitgame=0<br><br><br><br>SetBuffer frontbuffer()<br><br>backx=0<br>backy=0<br>background=createimage(800,600)<br>SetBuffer ImageBuffer(background)<br>Color 255,0,0<br>Rect 0,0,50,50,1<br>Color 0,255,0<br>Rect 20,20,50,50,1<br><br>SetBuffer BackBuffer()<br><br><br><br><br>;---------------------------------------------------------------------------------------<br>;  Main Game Loop **********************************************************************<br>;---------------------------------------------------------------------------------------<br><br><br>While (Not quitgame)<br><br>Cls<br><br>;Set Speed Factor<br>FL\CurrentTicks = MilliSecs()<br>FL\SpeedFactor# = (FL\CurrentTicks - FL\FrameDelay) / (1000.0 / FL\TargetFPS#)<br>If FL\SpeedFactor# &lt;= 0 Then FL\SpeedFactor# = no0#<br>FL\TimeElapsed# = (FL\CurrentTicks - FL\FrameDelay) / 1000.0<br>If Debug<br>	FL\FPS# = (FL\FPS2# + FL\FPS3# + FL\FPS4# + FL\FPS5# + FL\TargetFPS# / FL\SpeedFactor#) / 5<br>	FL\FPS5# = FL\FPS4# : FL\FPS4# = FL\FPS3# : FL\FPS3# = FL\FPS2# : FL\FPS2# = FL\FPS#<br>EndIf<br>FL\FrameDelay = FL\CurrentTicks<br>;SpeedFactor# contains a percentage of the last frame<br>;TimeElapsed# contains a percentage of the last second<br>v# = v# + (FL\TimeElapsed# * a#)	;velocity (m/s) = velocity (m/s) + time (s) * acceleration (m/s^2)<br><br><br>speedZ=(FL\SpeedFactor#)<br><br><br><br><br>;--- check for escape key<br>If KeyDown( 1 )=True Then<br>    quitgame =1<br>End if<br><br><br><br><br>;--- draw background...<br>For by=0 To 15<br>    For bx=0 To 15<br>        DrawImageRect background,backx+bx*50,backy+by*50,0,0,50,50<br>    Next<br>Next<br><br><br><br>;-- scroll background down...<br>backy=backy+speedZ<br>If backy&gt;700 Then backy=-800<br><br><br>If Debug<br>    Text 10, 10, "FPS: " + Int(FL\FPS#)<br>	Text 10,50,"X:"+Str$(backx)+"  Y:"+Str$(backy)<br>EndIf<br><br><br>    VWait<br>    Flip False<br><br><br><br><br>Wend<br><br><br><br>End <br><br></td></tr></table><br>
<a name="437644"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Doesn't use vwait. If you syncing the framerate your self, then using vwait as well, it will sync the FPS to the refresh rate of the monitor, therefore making your Frame Rate code kinda useless. Maybe that's whats causing your jerkyness. Try getting rid of v-wait all together. <br><br></td></tr></table><br>
<a name="437647"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >CodeD</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Remove Vwait<br>Change Flip False to just Flip <br><br></td></tr></table><br>
<a name="437649"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm, very odd. There must be a problem with your frame syncing code. The image scrolling only updates if th blitz window is moving.... And in full screen mode, it moves once then doesn't move again... <br><br></td></tr></table><br>
<a name="437656"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ZT</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'd already tried just flip, but that still seems jerky on mine. Ross, try changing the FL\TargetFPS# = 60 to a different amount.<br><br>Even if I don't use the frame syncing and just increment the scroll by 1, it still looks jerky.<br><br>Obviously I want the game to play at the same speed on different setups, hence the frame sync code. Has anybody got some demo code which scrolls slowly and smoothly, taking into account different setups? <br><br></td></tr></table><br>
<a name="437663"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I changed 60 to 120, didn't really have much of a diference. What you can do, is time how long the render takes, start a timer at the beginning of the loop, do the game logic, moving player..etc, see long long you have left, take away the render time, then wait that long till you do your drawing of images and flip.<br><br>That should keep you code running smooth on different set ups :o) <br><br></td></tr></table><br>
<a name="437667"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ZT</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> very odd how it doesn't work on yours. What if you ignore the FPS code and just update backy+1 ?<br><br>I've just tried it on another machine, and it works fine, allbeit too jerky.<br><br>Surely, if I just update the scroll by +1, and wait for vertical sync, the scroll should be smooth? But its not! What am I missing?? <br><br></td></tr></table><br>
<a name="437669"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >wedoe</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't know if this is any help to you but this scroller is very small and should be easy to covert to your need:<br><br><pre class=code>Graphics 640,480,16,2:Dim scroll$(100):Color 255,255,255
Type scr Field x,y,txt$ End Type:Global a
.scrollread:a=a+1:Read scroll$(a)
If Not scroll$(a)="EOF" Goto scrollread
a=a-1:SetBuffer BackBuffer():Repeat
For b=1 To a:ln.scr=New scr:Ln\x=200:Ln\y=490:ln\txt$=scroll$(b)
  For c=1 To 20:For ln.scr=Each scr:ln\y=ln\y-1:Text ln\x,ln\y,ln\txt$:If ln\y&lt;-10 Then Delete ln.scr
 Next:Flip:Cls:Next:Next:Until KeyDown(1)
Data "Hello world":Data"Line two":Data"Line three":Data "EOF":End</pre> <br><br></td></tr></table><br>
<a name="437680"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ZT</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> thanks. Same problem, jerky and too fast.<br><br>is it not jerky on your machine? <br><br></td></tr></table><br>
<a name="437685"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >wedoe</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nope.. <br><br></td></tr></table><br>
<a name="437687"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >wedoe</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Same scroller, cleaned up and half speed:<br><br><pre class=code>Graphics 640,480,16,2
Dim scroll$(100):Color 255,255,255
Type scr 
Field x#,y#,txt$ 
End Type
Global a
.scrollread:a=a+1:
Read scroll$(a)
If Not scroll$(a)="EOF" Goto scrollread
a=a-1
SetBuffer BackBuffer()
Repeat
For b=1 To a
ln.scr=New scr:ln\x=200
ln\y=490:ln\txt$=scroll$(b)
 For c=1 To 30
  For ln.scr=Each scr
   ln\y=ln\y-.5
	Text ln\x,ln\y,ln\txt$
	 If ln\y&lt;-10 Then Delete ln.scr
  Next
   Flip
   Cls
 Next
Next
Until KeyDown(1)

Data "Hello world":Data"Line two":Data"Line three":Data "EOF":End</pre> <br><br></td></tr></table><br>
<a name="437689"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ZT</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> hmmm, I give up. tried yours on both my machines and it looks jerky. Athlon 2100+ Geforce 4 &amp; P4 1.7 with geforce mx2.<br><br>I seem to be getting better results with using a 3D sprite and setting the camera a long way away. But I'm sure this must be more resource hungry, and won't work on slower computers. <br><br></td></tr></table><br>
<a name="437699"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, 2d probably looks jerky, because it doesn't interpolate between pixel. 3D does this, so you will get smoother scrolling with that. Also, try upping your refresh rate on your monitor. Maybe that is causing problems. Maybe also, you GFX drivers are being forced to wait for v-sync before continuing.<br><br>Try and do what i suggest. Time how long it takes to draw everything, then in the next loop time the rest of the code execution and wait the correct amount of millisecs before you render. <br><br></td></tr></table><br>
<a name="437712"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >IPete2</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> ZT<br><br>Just for the record.<br><br>I have an Athlon 1900+ 512 MB Geforce 3 (64MB), when I run the original code with the vWait and false parts removed it looks absolutely fine.  Really smooth if a little quick.<br><br><br>IPete2. <br><br></td></tr></table><br>
<a name="437728"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sledge</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br> Well, 2d probably looks jerky, because it doesn't interpolate between pixel.<br> <br></div><br>That's not really true, as evidenced by the thousands upon thousands of games that exhibit smooth scrolling using 2D alone. Interpolating just makes things look distorted - a good 3d-as-2D system will move objects in pixel sized steps anyway.<br><br>ZT, whether or not your original code looks jerky or not depends on two lines...<br><br>FL\TargetFPS# = 60<br><br>and<br><br>Graphics 640,480<br><br>For example, my GFX card runs at the optimal refresh rate for whatever resolution it is set to. At 640*480 that is 120hz, into which 60 frames a second fits quite precisely - the image being updated once every two refreshes exactly. At this resolution your original code looks PERFECT on my monitor therefore. However if I set the resolution to 1024*768 then it's a different story... at that resolution my monitor's optimal refresh rate is 85hz and, obviously, the speed at which the code updates the display no longer syncronises exactly with what the monitor is doing. Set like this, it looks jerky.<br><br>Chances are, your monitor's refresh rate is not set to a multiple of 60 and this is why your code looks jerky. This is a continual problem with PC development - either you can use the monitor's refresh to limit speed and have a program that always looks smooth (CPU speed permitting) but may execute at different rates on various machines OR you can frame limit and have a program that is BOUND to update in a jerky manner on some set-ups. <br><br></td></tr></table><br>
<a name="437730"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ZT</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> thanks for the feedback. Yes, 3D does give a smoother look. I have changed my refresh etc, and tested it on several machines, but the important factor is that the game runs on other peoples machines (without them adjusting their refresh), so this would not help in the long run. <br><br>How do you check if the gfx drivers are forcing a vsync wait? I've looked at the driver, geforce Ti4600, and the closest thing I can see, says "Verticle Sync - Application Controlled" which suggests to me that its not waiting. Again this won't help, as I can't force prospective customers to change their gfx card settings, but I'm curious.<br><br>I'll stick with what I've got without the vwait. At least it seems to be consistent over 3 machines (which is the important factor to me), allbeit with the odd jerkiness.<br><br>I think I'm just being fussy. I'm sure it used to scroll smoother on the C64!! <br><br></td></tr></table><br>
<a name="437734"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ZT</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sledge - that's interesting. I have tried various settings on the refresh, but it's optimum is 72Mhz at 1280 by 1024. It's an LCD. I've also tried various combinations of FL\TargetFPS# = 60 which I've currently got set to 72.<br><br>So the end result is, it's going to look different on everybody else's machine (in terms of smoothness), even if I manage to keep the game/scroll speed the same?<br><br>or are you suggesting I set the game to 60Mhz and 640x480? <br><br></td></tr></table><br>
<a name="437744"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sledge</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>or are you suggesting I set the game to 60Mhz and 640x480? <br> <br></div><br><br>That would not guarantee you anything - my old monitor maxed out at 85Hz at 640*480 and many of your customers will have such hardware. On my old monitor, the code that looks fine for me now would look jerky again.<br><br>Similarly, if I run your code at 1024*768 AND set TargetFPS# to 85 rather than 60 it looks fine (the FPS counter suggests an update of 42.5 frames a second... fitting exactly with the monitor's optimal speed at that res').<br><br>You basically have a couple of questions to address: Are you  going to allow your code to run at multiple speeds in order to appear smooth on a range of monitors (remembering that you can still retain some control over the range)? And, if so, how are you going to let your program know what speed it should adopt? <br><br></td></tr></table><br>
<a name="437762"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >WolRon</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think the reason you are experiencing jerkiness is because backx, backy, and speedZ are integers.  Change all three to floating point and the problem may go away. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
