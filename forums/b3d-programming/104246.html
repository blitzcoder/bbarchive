<!DOCTYPE html><html lang="en" ><head ><title >Google Maps style zoom function</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Google Maps style zoom function</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Google Maps style zoom function</a><br><br>
<a name="1261587"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Axel Wheeler</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi all,<br><br>I'm looking for a formula to calculate the upper left corner x/y in a map after zooming in or out from the mouse pointer, just like Google Maps.  What I have almost works, except when I move the mouse.  Here's what I have now:<br><br><pre class=code>
upperLeftX=mapMx-mapMx/scale
upperLeftY=mapMx-mapMy/scale
</pre><br><br>... where scale is 1.0 to start and increases as you zoom in, like a camera.  And mapMx/mapMy is the map location under the mouse pointer.  This works perfectly as long as I keep the mouse in the same place, which obviously isn't good enough.<br><br>I also tried a different approach based on the current upperLeftX/Y.  Using this method the distance from mapMx/mapMy to the upperLeftX/Y (x and y separately of course) is scaled to the new scale and then the distance is used to recalculate upperLeftX/Y.  This is inelegant, and also doesn't work at all.  Here it is:<br><br><pre class=code>
upperLeftX=mapMx-(mapMx-upperLeftX)/scale
upperLeftY=mapMy-(mapMy-upperLeftY)/scale
</pre><br><br>Both these methods should work I think.  But they don't, so I'm doing something wrong.  Any ideas?  Thanks! <br><br></td></tr></table><br>
<a name="1261649"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Easiest way is to start with the world coordinate of the point where your mouse is located.<br><br>(Typed on phone so excuse any typos)<br><br>Assuming zoompoint is at screen midpoint which we will assume is 0.5×screen width etc<br><br>Worldxatmousex = worldxatzoompoint + (mousex-screenwidth×0.5)/zoom<br><br>You should be able to rearrange from that..make sure everything is a float. <br><br></td></tr></table><br>
<a name="1261661"></a>

<a name="1261662"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Axel Wheeler</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Matty,<br><br>Thanks for the response.  The world coordinate corresponding to the mouse location is mapMx/mapMy in my code above.<br><br>You've got it changing though; it should not change.  So if the zoompoint (thanks for that term!)  is over Times Square, it will still be over Times Square after zooming, so it didn't change.  See what I mean?  Everything else gets further away or closer in.<br><br>Here is a crude table of corresponding map/screen variables:<br><br>Screen . . . . Map<br>MouseX() . . mapMx<br>MouseY() . . mapMy<br>0 . . . . . . . . upperLeftX<br>0 . . . . . . . . upperLeftY<br><br>Interestingly there are several discussions about this on the web, but like so many things the discussion is about how to use some API to do it, not how the algorithm itself works, so it's no help. <br><br></td></tr></table><br>
<a name="1261678"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Floyd</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Suppose screen width is 800 and the mouse ( fixed point ) is at x = 200. This is 200/800 = 0.25 of the way from left to right.<br><br>What width of "subimage" will be drawn after scaling? This is just as you were doing: newWidth = originalWidth/scale. originalWidth is whatever width gets drawn when scale = 1.<br><br>Let's say this newly scaled width is 100. The fixed image point must still be 0.25 of the way from left to right, i.e. 0.25*100 = 25 pixels. If the image point (ix,iy) was drawn at the mouse location before, and now after, scaling then the new left edge must be at ix - 25. <br><br></td></tr></table><br>
<a name="1261679"></a>

<a name="1261680"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Axel Wheeler</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think you're on to something though Matty ... the proportion across the screen can be used to determine the top left edge.<br><br>mouseX()/GraphicsWidth()<br><br>... but on our chart above we don't have the map value corresponding to GraphicsWidth().  In other words I don't have that value.  But let's say I did... (and let's call it mapGW)<br><br>Then MouseX()/GraphicsWidth() =  (mapMx-upperLeftX)/mapGW<br><br>Both are the ration of the distance to the left of the mouse compared to the total area displayed.  upperLeftX is the only unknown, so we can solve for it:<br><br>mapGW*(MouseX()/GraphicsWidth())=(mapMx-upperLeftX)<br>upperLeftX+(mapGW*(MouseX()/GraphicsWidth()))=mapMx<br>upperLeftX=mapMx-(mapGW*(MouseX()/GraphicsWidth()))<br><br>Plus, I think mapGW should just be GraphicsWidth()/scale<br><br>Let's try it and see... <br><br></td></tr></table><br>
<a name="1261682"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Axel Wheeler</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yess!!!  It works.<br><br>Hi Floyd!   Yes that's what I was just doing based on Matty's post.  Here's the code:<br><br><pre class=code>
mapGW#=Float(GW)/scale
mapGH#=Float(GH)/scale

upperLeftX=mapMx-(mapGW*(mx/Float(GW)))
upperLeftY=mapMy-(mapGH*(my/Float(GH)))
</pre><br><br>GH and GW are my consts for use in Graphics3D().  At first the zoom was just slightly off because they were ints, but by floating them it's now razor sharp.<br><br>This will be for an inference diagramming, or argument diagramming tool.  By zooming out the user can create much larger diagrams and have different regions for related arguments.  But obviously this would be perfect for any game with a large map into which the user can zoom in to see what's happening at street level.  <br><br>Anyway, thanks so much both of you! <br><br></td></tr></table><br>
<a name="1261684"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Glad you got it working. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
