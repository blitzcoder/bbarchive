<!DOCTYPE html><html lang="en" ><head ><title >Texture woes - I am about to go MAL over this!!!</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Texture woes - I am about to go MAL over this!!!</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Texture woes - I am about to go MAL over this!!!</a><br><br>
<a name="956769"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Adam Novagen</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey all,<br><br>Okay, I'm trying to get Blitz to do something. It's really not all that complicated. I have a "ship" representing the player. Underneath the ship, there's a quad which has to display two bars, one for health and one for energy. The quad was created the way I always do 'em: <b>CreateMesh()</b>, <b>CreateSurface()</b>, <b>AddVertex()</b> (UV mapping included) and <b>AddTriangle()</b>.<br><br>There are three images that have to be drawn on the texture for this quad, which we may as well call a sprite because that's how I'm using it. First, there's a background, which is basically like a piece of metal or something with two grooves, then the two bars get drawn <i>in</i> those grooves. The texture itself is 128x128 to ensure maximum compatibility, while the bar background is only 104x26. This leaves a black area around it, which is where the problem comes in.<br><br>For the first attempt, I tried using the Mask (4) flag along with the Color (1) and VRAM (256) flags. The Mask flag is supposed to make all black (0,0,0) areas transparent, right? Wrong. The texture showed up as a solid black rectangle, with no sign of the bars. As soon as I removed the Mask flag, the bars showed up again, but still in the middle of a black square. What the *&amp;^@.<br><br>Next, I tried the Alpha (2) flag instead of the Mask flag, then filled in the texture using <b>WritePixelFast</b> with ARGB 0,0,0,0. As expected, the black area disappeared. When I started drawing the bars again, though, they appeared semi-transparent. Blitz was reading the Alpha value all the way AROUND them, but when it got to the bars themselves, it was reading the brightness.<br><br>Okay, new plan. Instead of using <b>DrawBlock()</b> and <b>DrawBlockRect()</b> to draw the bars, I'll use <b>WritePixelFast()</b> with an Alpha value of 255, and the RGB value of the bars' pixels. Copy them over one pixel at a time, with full opacity. But NOOO, they still appeared as semi-transparent!<br><br>Okay, FINE. I'll save them as PNGs instead of BMPs, then load them as textures with the Alpha flag, then use <b>CopyRect()</b>. Proper Alpha values all around. WRONG-O!!! They STILL showed up semi-transparent, and this time some of the last pixels were missing.<br><br>BACK TO THE DRAWING BOARD, THEN. I'll just have to throw compatibility to the wind, and make the initial texture 104x26, so that there's no black around the bars or their background. Okay, fine. BUT HEY, THAT'D BE TOO EASY!!! There was still some black to the right and bottom of the bar background. Not as much as before, but there shouldn't be ANY, since it's now the exact same size as the texture!!!<br><br>So, I'm pretty much at my wit's end. Why in the world would the Mask flag... Well, not Mask?? Why all the Alpha foul-ups?? And how in the world am I going to get these bars in place??? @_@ My sanity greatly appreciates your help. <br><br></td></tr></table><br>
<a name="956770"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> As you have found DrawBlock, CopyRect, DrawText etc. have no respect for alpha channels (they use GDI commands) and cannot be used on 32 bit textures unless you fix the alpha in a second pass.<br><br>So either draw the ENTIRE shape with WritePixelFast, process the alpha bits in a second pass or take the optimal route and build all the bars using geometry (runtime texture modification is always going to be a huge hit on your pipeline). <br><br></td></tr></table><br>
<a name="956771"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Textures have to be powers of two. You cannot create a 104x26 texture, it will be resized to the nest largest power of two in each dimension, which is 128x32. That would explain the black on the right and bottom. You should always check texture dimensions with TextureWidth and TextureHeight, not just assume that they are the size you hope.<br><br>CopyRect, IIRC, always ignores alpha, so it doesn't matter whether you use BMP or PNG.<br><br>Copying with WritePixelFast should work, but you might need to use PNG. BMP *does* have an alpha channel, but I think DirectX doesn't load the alpha channel. <br><br></td></tr></table><br>
<a name="956778"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Adam Novagen</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> ... or take the optimal route and build all the bars using geometry (runtime texture modification is always going to be a huge hit on your pipeline). <br></div><br><br>Well, in this case it doesn't have much of an impact since the images are so tiny. However, building them with geometry makes sense... I might make the bars and their background three individual sprites, that could work...<br><br><div class="quote"> Textures have to be powers of two. <br></div><br><br>O-Kay, that makes sense; I knew there was some limitation involved, but I couldn't find the mention of it in the BlitzDocs. And yeah, that's got to be why the black areas still appeared. Hey, while I think of it, what exactly does IIRC stand for?<br><br>Okay, thanks guys; I'll take these ideas on board &amp; see what I can do. Still, I can't figure out why the Mask flag didn't just solve the whole thing in the first place... <br><br></td></tr></table><br>
<a name="956811"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> "If I Recall Correctly".<br><br>Two more ideas come to mind:<br><br>1) Create your 104x26 image in your editor, and stretch it to 128x32, then resize the quad itself so the image proportions are correct (having each corner have UV of 1 or 0).<br><br>2) Create your 104x26 image, add borders so that it's 128x32, and work out the correct UV coords for the corners so that the extra texture space simply never gets put on the quad (ie.: 0,0 ; 0.8125,0 ; 0,0.8125 ; 0.8125,0.8125).<br><br>The second one would likely be easier, as you could then just forget about the black corner. However, geometry is still better in any case. <br><br></td></tr></table><br>
<a name="956813"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'd say, forget about pixel manipulation routines. Just forget about them. <br>If the thing doesn't work properly in the first place, then there's something so wrong about it that giving your program crutches for it just won't cut it.<br><br>Stick to geometry. Simple quad rectangle, 2 triangles, that's it. Do that for the health bar's framing and the health "content" themselves (meaning, total of 3 quads).<br>If you use a pixel perfect lib like the free Sprite Control, you can place the health bar content sprites exactly at the pixels you want them to be aligned with the framing, with a mathematical precision. <br>Most likely you'll want to change the size\value of the health bar's content, and for that you will have to find the index of the two vertices in the quad's right side. Then move them about using VertexCoords. <br><br>If your health bar content sprites are painted with a single-colored brush (and no texture), then you can just do that without a problem. If they have a certain texture to them, then moving their vertices will cause that texture to compress\expand, and that doesn't look to good. You'll have to painfully adjust these vertices UV coordinates when you move them so that the texture stays in place. <br>That's why I recommend using single colored brushes for the content quads, without textures (like green or red for HP, and blue or purple for MANA, for instance). It doesn't look as bad as you might think, especially if you use a black and white overlay quad just on top of these content sprites, specially textured with an alpha map to give these quads a <b>beveled</b> look.<br><br>This health bar, for instance, I used a total of 4 quads to build it:<br><img src="http://img12.imageshack.us/img12/3706/hbar.tif"><br>not only there's the main texture quads but also stuff like a "glare" overlay, to give that white shine, like glass.<br><br>PS: Whenever in doubt about a TXT-Talk slang or general shortenings, go to Google and write "define: IIRC" for instance. Google will look up quick and list you various possible definitions for the term you specified. <br><br></td></tr></table><br>
<a name="956829"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Adam Novagen</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the Define: tip, Kryzon!<br><br>Anyway, problem solved. I used the GIMP to center the health bar background in a 128x128 PNG, so no more black outline. As far as the health &amp; energy bars themselves, they're only simple bars filled with color gradients, so I got creative with vertex coloring &amp; custom meshes, and everything works perfectly now, plus there's no more realtime Texture alterations! :D <br><br></td></tr></table><br>
<a name="956870"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> The fast Libs have a copyrect that copies alpha, if that helps. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
