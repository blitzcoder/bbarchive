<!DOCTYPE html><html lang="en" ><head ><title >Z-Order problems with EntityAlpha?!</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Z-Order problems with EntityAlpha?!</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Z-Order problems with EntityAlpha?!</a><br><br>
<a name="640884"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Picklesworth</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay... this is probably partly my fault, and reasonably fixable.<br><br>I have a bunch of flattened, wide cylinders suspended in midair, and they are all semi transparent.<br><br>When viewed at various camera angles, the drawing order for these objects becomes confused, and they end up looking really weird.<br><br>It takes a bit of camera moving to notice, but it's definietly there and a really big graphical problem.<br><br>I have tried using Beaker/Fredborg's z-sorting code, but it looks like it solves a different problem from mine.<br><br><br>This is the creation function for the platforms:<br><pre class=code>
b.board=New board
	b\obj=Object_Create()
	;#Region Visual
	b\obj\vis\mesh=CreateCylinder(64)
	ScaleMesh(b\obj\vis\mesh,size,0.05,size)
	EntityPickMode(b\obj\vis\mesh,2)
	
	Texture=CreateTexture(64,64)
	SetBuffer TextureBuffer(Texture)
	For y=0 To 1:For x=0 To 1
		If ( x + y ) Mod 2 = 0 Color 128,32,128 Else Color 64,16,64 
		Rect x*32,y*32,32,32,1
	Next:Next			
	SetBuffer BackBuffer()
	ScaleTexture Texture,0.1,0.1
	TextureBlend Texture,2
	
	EntityTexture(b\obj\vis\mesh,Texture)
</pre><br><br>(And don't ask about the thousands of linked type instances... I do have a reason for it to be like that, and I've been meaning to do it for ages.)<br><br><br>You can download the program to see it for yourself:<br><a href="http://crumbsoftware.f2o.org/files/zsortproblem.zip" target="_blank">http://crumbsoftware.f2o.org/files/zsortproblem.zip</a><br><br><br>What is going on here, and how can I fix this?<br><br>Is Beaker's zsorting fix actually the fix for this? If so, am I doing it properly by using ZOrder_Init with each individual platform? (It didn't seem to work).<br><br>The cylinders need to all be independantly moveable. There will never be an event where one sticks through another, so I guess I could, if I must, use a solution with linepicks :(<br>Unless someone else already has... <br><br></td></tr></table><br>
<a name="640916"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DJWoodgate</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Blitz decides the draw order of alpha objects based on the distance of the objects origin from the camera because <b>alpha objects do not write to the Zbuffer</b>. That's what is going on.  Beakers fix has nothing to do with this problem, at least not at this level. It is intended to sort overlapping polys in the same surface based on distance from camera. Your platforms do not need this. <br><br></td></tr></table><br>
<a name="640933"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Try sticking an EntityOrder entity,0<br>Just a thought, it might kick the z-buffer back into the right order. <br><br></td></tr></table><br>
<a name="640942"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DJWoodgate</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> As far as the Zbuffer is concerned alpha objects do not exist. <b>Alpha objects do not write to the Zbuffer</b>.  They just read from it, so they have no problem drawing in front of or behind non alpha objects. That is why blitz orders their drawing manually based on their distance from the camera.  This can fail to achieve the desired result when they overlap and an alpha object further from the camera extends in front of an alpha object which has its origin closer to the camera. I think Entityorder forgoes use of the Zbuffer altogether, so I suspect it is not going to be of much use in this context.  <br><br>Not sure what you had in mind with your linepick approach.  I think it may be possible to get overlapping alpha objects to draw in the right order, but I suspect it is way more trouble than it is worth since you have to work around the default behaviour. <br><br></td></tr></table><br>
<a name="640979"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Beaker</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> There are a few possible solutions to this:<br><br>You could try splitting the platform meshes up into 4 quarters and moving the handles for them to the outer edge of the platform.<br><br>Alternatively: you could override the drawing order for each mesh by parsing the vertices of each and determining which has a vert closest to the camera.  This one would be drawn last.<br><br>Not sure how succesful each of these solutions would be.  I suspect the first one would be best.<br><br>Good luck. <br><br></td></tr></table><br>
<a name="640984"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> What about multiple rendering passes? <br><br></td></tr></table><br>
<a name="641062"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Picklesworth</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> So... If I could reposition the object's origin so that it's always in view, to "trick" Blitz (with a slight risk of objects bouncing around in weird ways).<br><br>Or, I could give up entityalpha() altogether and use a different approach with refraction, tinting, and other fun stuff based around the cube mapped reflections.<br><br>I think I'll try checking the verts first, and probably use multirendering to sort it all if entityorder doesn't work.<br><br>Or I could just remove alpha, and save it for another day.<br><br><br>Thanks for the help :)<br>I'll try all of these. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
