<!DOCTYPE html><html lang="en" ><head ><title >Ellipse - Box collision woes</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Ellipse - Box collision woes</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Ellipse - Box collision woes</a><br><br>
<a name="756216"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bankie</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ever since I started with Blitz3D, I've always had problems with ball-&gt;box collisions. When I completed my last project, I had to do a second test when a collision happened, to ensure the 2 objects were close enough for a collision to be possible. Basically, it's doing my head in, and I can't see any errors in any of my code but I'm hoping that there's something I don't know about how collisions work, so if anyone can take a look at the method I use to set these up, I'd appreciate it.<br><br>1. Firstly, I set up master entities:<br><br>masterbullet=LoadMD2("models\bullet.md2")<br>HideEntity masterbullet<br>ScaleEntity masterbullet,0.3,0.3,0.3<br>PositionEntity masterbullet,0,0,0<br>EntityType masterbullet,col_bullet<br>EntityRadius masterbullet,1<br><br>masterentities(c_master_wall) = LoadMD2("models\brickwall.md2")<br>brickwalltex = LoadTexture("models\brickwall.bmp")<br>EntityTexture masterentities(c_master_wall),brickwalltex<br>ScaleEntity masterentities(c_master_wall),0.13,0.13,0.13<br>PositionEntity masterentities(c_master_wall),0,0,0<br>HideEntity masterentities(c_master_wall)<br>EntityType masterentities(c_master_wall),col_wall<br>EntityBox masterentities(c_master_wall),-2.5,0,-2.5,5,10,5<br><br><br>2. Then, I create the collision, so that I'll know if a bullet hits the wall:<br><br>Collisions col_bullet,col_wall,3,1<br><br>3. Next I create my level from the master entities (in this simple case, the walls). I use a loop with CopyEntity, position the wall, unhide the entity to create the full level.<br><br>4. In the main loop, if I press fire, I use CopyEntity from the bullet master entity, position the new bullet, point it in the right direction then unhide it.<br><br>And that's it. Collisions do occur when the bullets hit the walls, so it does work to some degree. However, I find that extra collisions are often generated with walls which are far from the bullet. The walls being detected as hit are actually in exactly the opposite direction to which the bullet is moving.<br><br>As I say, this is a problem that's always plagued me, so it's not like I've mistyped something - it must be either something to do with my methods or there's a bug with Blitz, but the fact that no one else seems to be having the same problem makes this seem unlikely. Can anyone shed any light? <br><br></td></tr></table><br>
<a name="756225"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> This may help ....<br><br><a href="http://www.blitzbasic.com/Community/posts.php?topic=53187#594579" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=53187#594579</a><br><br>Stevie <br><br></td></tr></table><br>
<a name="756239"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bankie</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks, but my problem is not the same. My collisions do occur, but I get extra collisions occurring too when the colliding entities are far apart. The objects are all simple too - no merging of entities, just a simple boxy MD2 being hit by a relatively spherical bullet. <br><br></td></tr></table><br>
<a name="756288"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Zethrax</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Make sure you do a ResetEntity on the bullet entity copy after you move it to its initial position (the firing point of a gun, for example) but before the next UpdateWorld command. Otherwise it will be stopped by the first collision enabled entity it collides with.<br><br>Note that in your code above you shouldn't need to position your source entities at 0, 0, 0 as they will be created at this position. <br><br></td></tr></table><br>
<a name="756343"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bankie</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> ResetEntity has no effect. The collisions do not happen as soon as the bullet is created - they happen shortly after the bullet is in motion. I think the easiest way of demonstrating this is by creating the smallest possible program I can with the problem intact. My current program is much too large for quick digestion and uses some paid-for libraries anyway. I'll try to do this tonight.<br><br>Thanks for taking the time to reply, though. <br><br></td></tr></table><br>
<a name="756462"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bankie</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, here's a short program which needs no external models - just copy and paste into Blitz. There's a cone in the middle which you can rotate with cursor left and right. Press left ctrl to fire a bullet. Firing at the wall above does what it's supposed to and destroys all the wall blocks in its path. However, if you fire a ton of bullets downwards instead (just spread em out), you'll find that collisions occur with the blocks at the top, even though they're well out of range of the bullets. If anyone can explain why this happens, I'll award them the Bankie Gold Star Award.<br><br>Graphics3D 800,600,0,2<br><br>col_bullet=1<br>col_block=2<br><br>Type t_bullet<br>	Field id%<br>End Type<br><br>Type t_block<br>	Field id%<br>End Type<br><br>SetBuffer BackBuffer()<br><br>Global camera=CreateCamera()<br>CameraViewport camera,0,0,800,600<br>CameraRange camera,1,1000<br>PositionEntity camera,0,30,-10<br>RotateEntity camera,70,0,0<br><br>light=CreateLight()<br>AmbientLight(150,150,150)<br><br>player=CreateCone()<br>RotateMesh player,90,0,0<br><br>masterbullet=CreateSphere()<br>ScaleEntity masterbullet,0.5,0.5,0.5<br>EntityType masterbullet,col_bullet<br>EntityRadius masterbullet,1<br>HideEntity masterbullet<br><br>masterblock=CreateCube()<br>ScaleEntity masterblock,1,0.5,0.5 ; block is now 2x1x1<br>EntityType masterblock,col_block<br>EntityBox masterblock,-1,-0.5,-0.5,2,10,1<br>HideEntity masterblock<br><br>Collisions col_bullet,col_block,3,1<br><br>For x=-30 To 30 Step 3	; create wall<br>	For z=10 To 20 Step 2<br>		block.t_block=New t_block<br>		block.t_block\id=CopyEntity(masterblock)<br>		PositionEntity block.t_block\id,x,0,z<br>		ShowEntity block.t_block\id<br>		ResetEntity block.t_block\id<br>	Next<br>Next<br><br>NewTime = MilliSecs()<br>OldTime = NewTime<br><br>While Not KeyHit(1)<br>	NewTime = MilliSecs()<br>	delta# = Float (NewTime - OldTime) / 1000.0<br>	OldTime = NewTime<br>	<br>	; process input<br>	TurnEntity player,0,((KeyDown(203) - KeyDown(205)) * delta * 50),0<br>	If KeyHit(29) Then<br>		bullet.t_bullet=New t_bullet<br>		bullet.t_bullet\id=CopyEntity(masterbullet)<br>		PositionEntity bullet.t_bullet\id,0,0,0<br>		RotateEntity bullet.t_bullet\id,0,EntityYaw(player),0<br>		ShowEntity bullet.t_bullet\id<br>		ResetEntity bullet.t_bullet\id<br>	End If<br>	<br>	; animations<br>	For bullet.t_bullet = Each t_bullet<br>		MoveEntity bullet.t_bullet\id,0,0,delta * 10<br>		collidedblock=EntityCollided(bullet.t_bullet\id,col_block)<br>		If collidedblock Then<br>			For block.t_block = Each t_block<br>				If collidedblock=block.t_block\id Then<br>					FreeEntity block.t_block\id<br>					Delete block.t_block<br>				End If<br>			Next<br>		End If<br>	Next<br>	<br>	UpdateWorld<br>	RenderWorld	<br>	Flip<br>Wend<br><br>End <br><br></td></tr></table><br>
<a name="756518"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >b32</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I tried repeating your problem, but it works like it is supposed to. Actually it is pretty fun game allready. :)<br>Did you installed the latest update ? Have you tried upgrading/downgrading? And have you tried running it on another pc ? Maybe it varies on different systems. <br>One thing I could imagine is that the bullets fly so far down, that their coords wrap and they end up above. If that is the case, you could limit the distance that a bullet may fly from the ship, before it gets deleted. Another cause could be the delta timing maybe. Try setting it to a fixed value, ie delta# = 0.001, as a test. <br>And you could also make an even simpeler example, without types, and just 2 objects, to completely isolate the problem. Maybe it could generate the error by default <br><br></td></tr></table><br>
<a name="756522"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Works fine here.  <br><br>Probably not the issue but, if you've had your machine on for a couple of weeks without a restart, millisecs() starts returning negative numbers.  Stick an abs() on the front of your delta formula and see if that does anything.<br><br>Stevie <br><br></td></tr></table><br>
<a name="756524"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bankie</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the replies, particularly b32s as one of the suggestions worked. It certainly had nothing to do with the bullets flying so far down, as it would take a loooong time before coords would wrap. Delta was fine too - I tried setting that to a fixed value. HOWEVER, I was on V1.97. Upgrading to 1.98 didn't fix it, but downgrading to 1.85 did. Now I need to find the latest version that doesn't have the problem. I'd be interested in knowing what version of Blitz you guys are using as well as anyone else who's willing to give the code a quick test drive.<br><br>Thanks again! <br><br></td></tr></table><br>
<a name="756526"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Zethrax</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Line 37 should be EntityBox masterblock,-1,-0.5,-0.5,2,1,1 not EntityBox masterblock,-1,-0.5,-0.5,2,10,1. Changing it doesn't fix the problem, though.<br><br>I couldn't see any issues with your code that would cause this problem, so I'm thinking its a Blitz bug with box collsions. Best I can suggest is that you post a bug report and switch to using polygonal collisions (which worked fine when I used them with your code).<br><br>EDIT: I'm using version 1.98. The problem occurred in this version, as you mentioned above. <br><br></td></tr></table><br>
<a name="756527"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >b32</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm glad it works, however now you still don't know what it is .. :( If you could make a version of the program with a very clear example the problem, you could post it in the bugs report, with a description of the system you are running. I have the latest version installed <br><br></td></tr></table><br>
<a name="756544"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm still on 1.96 and as I mentioned it works just fine. <br><br></td></tr></table><br>
<a name="757934"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bankie</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello all. I've deduced that the collision bug is occurring on B3D versions 1.88 and after. This, however, seems to be contrary to what a couple of you are saying. On b32's advice, I've created a more concise program which doesn't have timing code, contains just one bullet and one block, and the error occurs 100% of the time on my PCs. One peculiar thing I noticed is that if I change the speed of the bullet, the collision occurs when the bullet is in a different position. However, it DOES seem to occur all the time, and always pretty quickly unless you slow down the bullet speed dramatically. I would be grateful to anyone who can give this a quick test to confirm that the block at the top disappears from a non-existent collision (collision should occur in less than a couple of seconds from starting unless your PC is incredibly slow). I'd especially be interested in b32 and Stevie G's results as you guys didn't see the bug.<br><br>Graphics3D 800,600,0,2<br><br>col_bullet=1<br>col_block=2<br><br>SetBuffer BackBuffer()<br><br>Global camera=CreateCamera()<br>CameraViewport camera,0,0,800,600<br>CameraRange camera,1,1000<br>PositionEntity camera,0,30,-10<br>RotateEntity camera,70,0,0<br><br>light=CreateLight()<br>AmbientLight(150,150,150)<br><br>bullet=CreateSphere()<br>ScaleEntity bullet,0.5,0.5,0.5<br>EntityType bullet,col_bullet<br>EntityRadius bullet,1<br>HideEntity bullet<br><br>block=CreateCube()<br>ScaleEntity block,1,0.5,0.5 ; block is now 2x1x1<br>EntityType block,col_block<br>EntityBox block,-1,-0.5,-0.5,2,1,1<br>HideEntity block<br><br>PositionEntity block,12,0,12<br>ShowEntity block<br>ResetEntity block<br><br>ShowEntity bullet<br>ResetEntity bullet<br>RotateEntity bullet,0,134.8,0<br><br>Collisions col_bullet,col_block,3,1<br><br>While Not KeyHit(1)<br>	MoveEntity bullet,0,0,0.25<br>	collidedblock=EntityCollided(bullet,col_block)<br>	If collidedblock Then<br>		If collidedblock=block Then<br>			FreeEntity block<br>		End If<br>	End If<br>	<br>	UpdateWorld<br>	RenderWorld<br>	Flip<br>Wend<br><br>End <br><br></td></tr></table><br>
<a name="758152"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DJWoodgate</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Bug happens here as well, with 1.96 and 1.98. Seems to occur when the sphere is on the same axis as an edge of the box.  <br><br>It should be fixed. Ellipsoid to box collisions were always a bit flaky as elipsoids were primarily introduced for use in polygon collisions, but this seems to pretty much invalidate using sphere to box collisions as well.<br><br>Strange it has not been noticed before. Ellipsoid collisions were added back at 1.81 when one might assume the problem was introduced, however I note from versions.txt that some additional collision work to tighten things up was done at 1.88 which coincides with your findings.  <br><br>It would be really hideous if it works ok on some systems and not on others. <br><br></td></tr></table><br>
<a name="758180"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> I see the error here on v1.96.  Looks like box collisions are borked! <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
