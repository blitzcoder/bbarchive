<!DOCTYPE html><html lang="en" ><head ><title >BlitzPlay help - 3d conversion</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >BlitzPlay help - 3d conversion</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >BlitzPlay help - 3d conversion</a><br><br>
<a name="282530"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tyler</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've been trying to convert the demo that comes with BP-LE to a 3d format, and I need to know if anyone could catch what mistake I'm making here that isn't updating the models for players that join (not even showing models when they join) But the log it makes says we're connecting and it also says we're sending data to each other ... so I can't figure it ... any help would be great! Thanks!<br><br>Include "BPliteV1.13.bb"<br><br>Global send_freq% = 8<br>Global sendupdates% = True<br>Global logging% = False<br><br>Type pdata<br>	Field x#,y#,z#,r#,name$,net_id%<br>	Field xvel#,yvel#,zvel#,rvel#<br>	Field model<br>End Type<br><br>Type Info<br>	Field txt$<br>End Type<br><br><br><br>Graphics3D 800, 600, 16, 2<br>SetBuffer BackBuffer() <br>Global gameFPS = 60<br><br>; Third Person Camera crap<br>Global TPerson = CreateCamera ()<br><br>; Creating camera for First Person<br>Global FPerson=CreateCamera()<br>CameraRange FPerson, 0.2, 2000<br><br>; Collision Constants<br>Const BUILDING_COL = 1<br>Const PLAYER_COL = 2<br>Const MONSTER_COL = 3<br>Const STAIRS_COL = 4<br>Const STAIRS_COL_X = 5<br><br>;--------------------------------------------|<br>;LINKED FILES - Load resources files<br>;--------------------------------------------|<br><br>Include "resources.bb"<br><br>; Consider collisions in these manners<br>Collisions PLAYER_COL, MONSTER_COL, 2, 2<br>Collisions PLAYER_COL, BUILDING_COL, 2, 2<br>Collisions PLAYER_COL, STAIRS_COL_X, 2, 3<br>Collisions MONSTER_COL, BUILDING_COL, 2, 2<br><br><br>framePeriod = 1000 / gameFPS<br>frameTime = MilliSecs () - framePeriod <br>fps=0 <br>framecount=0 <br>oldfps=0<br><br>TAB_HELD = 0<br><br>Global health# = 100<br><br>; Move mouse to center of screen<br>MoveMouse 400, 300<br><br>;--------------------------------------------|<br>;LINKED FILES - Camera control and Monster AI<br>;--------------------------------------------|<br><br>Include "camera.bb"<br><br>;Include "monster.bb"<br><br>Include "GUI.bb"<br><br>Include "controls.bb"<br><br><br><br>Cls<br>Color 100,150,100<br>Text 0,0,"Would you like to:"<br>Text 20,FontHeight()*2,"[H]ost a game"<br>Text 10,FontHeight()*3,"or"<br>Text 20,FontHeight()*4,"[J]oin one in progress?"<br>FlushKeys()<br>Repeat<br>	If KeyHit(35) Then<br>		Host = True<br>		Exit<br>	End If<br>	If KeyHit(36) Then<br>		Host = False<br>		Exit<br>	End If<br>Forever<br><br><br>Cls<br>FlushKeys<br>myname$ = Input$ ("Your name? ")<br>FlushKeys<br><br><br><br>If Host Then<br>	My_Port = 2222<br>	If Not BP_HostSession (myname,10,1,2222,10) Then<br>		Cls<br>		Locate 0,0<br>		Print "Host port was unavailable..Push a key to exit.."<br>		WaitKey<br>		End<br>	End If<br>	p.pdata = New pdata<br>	p\name = myname<br>	p\x = 0<br>	p\y = 50<br>	p\z = 0<br>	p\r = 90<br>	p\model = player<br>	ShowEntity p\model<br>	p\net_id = BP_My_ID <br>Else<br>	Print "Host port = 2222"<br>	Print "(Blank for Local IP)"<br>	IP$ = Input$("Please enter the host's IP? ")<br>	Select IP<br>		Case ""<br>			IP$ = "127.0.0.1"<br>			My_Port = Rand(3000,4000)<br>			Default<br>			My_Port = Input$ ("What port would you like to use? ")<br>			If Not My_Port Then My_Port = Rand (3000,4000)<br>			End Select<br>	Cls<br>	Text 200,50,"Connecting! (Hit [esc] to cancel)",True,True<br>	Select BP_JoinSession (myname,My_Port,IP,2222)<br>		;Handle any of the reasons if we couldn't join.<br>		Case BP_NOREPLY<br>			Cls<br>			Text 0,0,"No reply in specified timeout period.. exiting"<br>			WaitKey<br>			End<br>		Case BP_IAMBANNED<br>			Cls<br>			Text 0,0,"You have been banned from joining this game.. exiting"<br>			WaitKey<br>			End<br>		Case BP_GAMEISFULL<br>			Cls<br>			Text 0,0,"The game is full.. exiting"<br>			WaitKey<br>			End<br>		Case BP_PORTNOTAVAILABLE<br>			Cls<br>			Text 0,0,"Port: " + My_Port + " was not available.. exiting"<br>			WaitKey<br>			End<br>		Case BP_USERABORT<br>			Cls<br>			Text 0,0,"Connection attempt aborted!"<br>			WaitKey<br>			End<br>	End Select<br>	;Oh, we're allowed in? here we go!<br>	p.pdata = New pdata<br>	p\name = myname<br>	p\x = 0<br>	p\y = 50<br>	p\z = 0<br>	p\r = 0<br>	p\model = player<br>	ShowEntity p\model<br>	p\net_id = BP_My_ID<br>End If<br><br><br><br>;-----------------------------------------------------------------------------<br>Repeat<br><br>; Frame limiting<br><br>Repeat frameElapsed = MilliSecs () - frameTime <br>Until frameElapsed frameTicks = frameElapsed / framePeriod <br>frameTween# = Float (frameElapsed Mod framePeriod) / Float (framePeriod) <br><br>; Update game and world state<br><br>For frameLimit = 1 To frameTicks <br>If frameLimit = frameTicks Then CaptureWorld <br>frameTime = frameTime + framePeriod <br><br><br><br>BP_UpdateNetwork()<br>		HandleMessages()<br>		UpdateGame()<br>		send_count = send_count - 1<br>		If send_count &lt;= 0 Then<br>			send_count = send_freq<br>			p.pdata = First pdata<br>			msgtosend$ = BP_IntToStr(Int(p\x),2) + BP_IntToStr(Int(p\y),2) + BP_IntToStr(Int(p\r),2) + BP_IntToStr(Int(p\z),2 )<br>			If sendupdates Then BP_UDPMessage (0,1,msgtosend$)<br>		End If<br><br><br><br>fps = fps + 1 <br><br>UpdateWorld <br><br>Next <br><br>RenderWorld frameTween<br><br>If ent Then Text 0,0, EntityName$(ent)<br><br>Color 255, 255, 255<br><br>If health &lt; 0 Then health = 0<br><br>Text 10, 10, "Health: " + health<br><br><br><br>If MilliSecs()-framecount &gt; 1000 Then framecount=MilliSecs():oldfps=fps:fps=0<br><br>Flip <br>Until KeyHit (1)<br><br>BP_EndSession ()<br><br>End<br><br><br><br><br><br>Function UpdateGame()<br><br>CameraModeSwitcher()<br>CameraModeHandler()<br>UpdatePlayers()<br>UserInput()<br><br><br><br>If KeyHit(59) Then<br>				logging = 1 - logging<br>				If logging Then<br>					BP_StartLogFile (myname + ".txt")<br>				Else<br>					BP_StopLogFile ()<br>				End If<br>				End If<br>				<br>End Function<br><br><br><br><br>Function HandleMessages ()<br>	For msg.MsgInfo = Each MsgInfo<br>		Select msg\msgType<br>			Case 255	;A new player has joined!<br>				p.pdata = New pdata<br>				p\name = msg\msgData<br>				p\x = 0<br>				p\y = 50<br>				p\z = 0<br>				p\r = 90<br>				p\model = LoadAnimMesh("media\sammarktou2.x")<br>				p\net_id = msg\msgFrom<br>				nInfo.NetInfo = BP_FindID(p\net_id)<br>				Info ("**" + p\Name + " has joined!")<br>			Case 254	;A player has left<br>				p.pdata = Find_pdata(msg\msgFrom)<br>				If p&lt;&gt;Null Then<br>					If msg\msgData = True Then Info ("**" + p\Name + " has left!") Else Info ("**" + p\Name + " lagged out!")<br>					Delete p<br>				End If<br>			Case 253	;The host has disconnected<br>				For p.pdata = Each pdata<br>					If p\net_id &lt;&gt; BP_My_ID Then Delete p<br>				Next<br>				If msg\msgData = True Then Info ("**The host ended the game!") Else Info ("**No reply from host in " + (BP_TimeoutPeriod / 1000) + " seconds. Exiting game..")<br>			Case 252	;Someone got kicked/banned<br>				p.pdata = Find_pdata(msg\msgFrom)<br>				If p\net_id = BP_My_ID Then	;It was -me-??<br>					If msg\msgData = False Then Info ("**You have been kicked!") Else Info ("**You have been banned!")<br>					For p.pdata = Each pdata<br>						If p\net_id &lt;&gt; BP_My_ID Then<br>							Delete p<br>						End If<br>					Next<br>				Else				;It wasn't? Ok then.<br>					If msg\msgData = False Then Info ("**" + p\Name + " has been kicked!") Else Info ("**" + p\Name + " has been banned!")<br>					Delete p<br>				End If<br>			Case 1		;a position update packet<br>				newx% = BP_StrToInt (Mid$(msg\msgData,1,2))<br>				newy% = BP_StrToInt (Mid$(msg\msgData,3,2))<br>				newr% = BP_StrToInt (Mid$(msg\msgData,5,2))<br>				newz% = BP_StrToInt (Mid$(msg\msgData,7,2))<br>				p.pdata = Find_pdata(msg\msgFrom)<br>				;This demo handles movement by calculating an average speed to bring the player to the point indicated<br>				;in the packet by the time we think the next update should arrive.<br>				;This is fairly accurate in describing where the player moved, at one point, but unfortunately is not very<br>				;accurate for predicting where the player is "now" so to speak.<br>				p\xvel = (newx - p\x) / send_freq<br>				p\yvel = (newy - p\y) / send_freq<br>				p\zvel = (newz - p\z) / send_freq<br>				p\rvel = rotarydir(p\r,newr,send_freq)<br>			Case 2		;a chat packet<br>				p.pdata = Find_pdata(msg\msgFrom)<br>				Info (p\Name + ":" + msg\msgData)<br>		End Select<br>		Delete msg<br>	Next<br>End Function<br><br><br><br>Function UpdatePlayers ()<br><br>For p.pdata = Each pdata<br>If p\net_id = BP_My_ID Then<br>p\x = EntityX(player)<br>p\y = EntityY(player)<br>p\z = EntityZ(player)<br>p\r = EntityYaw(player)<br>End If<br>Next<br><br>For p.pdata = Each pdata<br><br><br>PositionEntity p\model, p\x, p\y, p\z<br>RotateEntity p\model, 0, p\r, 0<br>Next<br><br>End Function<br><br><br><br>Function Find_pdata.pdata (ID)<br>	For p.pdata = Each pdata<br>		If p\net_id = ID Then Return p<br>	Next<br>End Function<br><br><br><br>Function rotarydir#(Asource#,Adest#,smooth#)		;Taken from the Code Archives on blitzbasic.com,<br>	If Asource#&gt;Adest#									;Thanks Skully!<br>		Diff1#=Asource-Adest<br>		diff2#=(360.0-Asource)+Adest<br>		If diff2&lt;diff1<br>			dir#=diff2/smooth<br>		Else<br>			dir#=diff1/smooth*-1<br>		EndIf<br>	Else<br>		If Asource#&lt;Adest#<br>			diff1=Adest-Asource<br>			diff2=(360.0-Adest)+Asource<br>			If diff2&lt;diff1<br>				dir#=diff2/smooth*-1<br>			Else<br>				dir#=diff1/smooth<br>			EndIf<br>		Else<br>			dir=0<br>		EndIf<br>	EndIf<br>	Return dir<br>End Function<br><br>Function Info (t$)<br>	i.Info=New Info<br>	i\txt$=t$<br>	Insert i Before First Info<br>End Function <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
