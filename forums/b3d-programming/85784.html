<!DOCTYPE html><html lang="en" ><head ><title >Query:Best Method To Overcome Floating Point Error</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Query:Best Method To Overcome Floating Point Error</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Query:Best Method To Overcome Floating Point Error</a><br><br>
<a name="970973"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello,<br><br>What is the best way to handle floating point error, in particular in large outdoor environments where the movement step of a unit is very small compared to the world coordinates?<br><br>Would it work to have a grid of pivots widely spaced apart (10,000 units for instance) which the moving unit parents itself to when within said distance and then using local coordinates for positioning instead of global coordinates? <br><br>Thanks,<br>from Matt <br><br></td></tr></table><br>
<a name="970983"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nate the Great</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> use string maths if you are going for accuracy alone or change your scale if your steps are too small! yes the grid should work too.  Also I have heard moving the terain and everything in it around the camera instead of actually moving the camera helps with floating errors. <br><br></td></tr></table><br>
<a name="970987"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> string maths is no use to me if the blitz entity positioning commands are only single precision and don't accept strings. I'm not worried only about the camera's position but also the other entities which could be very far away but need to be positioned accurately as well - as they may be interacting with each other.<br><br>I guess my question is really - will blitz convert my local coordinates for each entity relative to pivots which may be far from the origin into global coordinates when it performs its internal calculations for move/translate/rotate/position entity? <br>For example:<br>global coordinates<br>x = 100,000.0<br>dx = 1.0<br>x+dx = floating point imprecision<br>however if I parent the entity to a pivot which is at x=99,900.0 then the local coordinate would be at x=100, and the dx would still be 1 - would I still have a problem with floating point imprecision or would the issue be resolved. <br><br></td></tr></table><br>
<a name="971044"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Floyd</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> ...or would the issue be resolved. <br></div><br>The issue remains.<br><br>The small, local x is now more accurate. But it must eventually be combined with "100,000 sized" values when Blitz deals with the rest of the world. So the inaccuracy returns.<br><br>That's why you are better off with a system which moves the currently active part of the world to the origin. <br><br></td></tr></table><br>
<a name="971053"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Use normalisation, i.e. when the camera is greater than, say, 20000 units from 0,0,0, move it back to 0,0,0.  Note the distance that the camera has moved on each axis, and move every other entity by the same amount.  Probably find it easier to attach everything to a pivot except the camera, then you just have to move the camera and pivot. <br><br></td></tr></table><br>
<a name="971073"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> There must be methods, similar to GfK suggested for example, to reduce the 'scale' of your 'play area'. Having a 100 000 : 1 scale just doesn't sound like a good thing for any situation to be honest.<br><br>Changing the absolute distance wont make any difference because the scale would still be the same, but changing the relative distances will, so you'd need to find a means of compressing everything together in ACTUAL 3D space, whilst ensuring that it all looks as though it's the 'correct' distance/size.<br><br>I believe it's possible to change the Camera entity scale, but to be honest, I'm not 100% sure on how this works.<br>In theory, though:<br><br>Your 'world' is currently at a scale 100 000 : 1<br>Modify all the distances and sizes to reflect a 1 000 : 1 scale<br>Now things will look odd and too close together and/or too big<br>Now Scale the camera entity to 1% of its original size.<br><br>So now, only the camera has the scale of 1 000 000 : 1 now, which, if you configure the drawdistance and fog range to limit to 1000:1 you should have no problems. <br><br></td></tr></table><br>
<a name="974174"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Chroma</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> <pre class=code>The small, local x is now more accurate</pre><br>Yes, I've noticed the floating point error has been addressed in some way or another.  I no longer get severe camera jitters when I'm 5000 units away from 0,0,0.  Not sure what Mark did but it was a very welcome fix. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
