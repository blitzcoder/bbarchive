<!DOCTYPE html><html lang="en" ><head ><title >Aiming spaceship turrets</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Aiming spaceship turrets</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Aiming spaceship turrets</a><br><br>
<a name="420767"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JKP</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi, I am working on a space combat game in Blitz but I am having problems aiming the turrets on ships. The turrets are made of 2 components, one can change its yaw, the other can change its pitch. I can make the turrets point correctly towards a stationary target when the ship itself is also stationary and if the turret fires a projectile it will hit the target OK. However, if the ship and/or the target are moving it's much more complicated because the projectile will already have a velocity to start with. If the target is moving very quickly too, then aiming the turret at the target's current position won't work, because the target will have moved by the time the projectile gets there.<br>So I was hoping someone might be able to help me with the maths needed to hit a fast moving target. I'm not too bothered about compensating for acceleration etc.<br><br>Here's what I am doing to aim the components of the turret:<br>(Hope I remembered it correctly)<br><br>TFormPoint tx,ty,tz,0,yawcomp<br>;where tx,ty,tz is the target's position<br>;yawcomp is the part of the turret that changes its yaw<br><br>yawchange = ATan2(TFormedZ(),TFormedX()) - 90<br>TurnEntity yawcomp,0,yawchange,0,False<br><br>I use a similar thing for aiming the pitch, but with the y and z values instead of the x and z values<br><br>One other thing: how can I change the amount of smoothing used on meshes in Blitz? After exporting my space ship models from Milkshape they always end up with darkened patches where there are steep angles between triangles.<br><br>Thanks for any help... <br><br></td></tr></table><br>
<a name="420859"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have no code, but an idea. Simply calculate the time your projectile takes to travel to the target. Then calculate where the target is going to be after this amount of time (based on the targets speed),  then aim to that position and fire. Of course, this is not totally accurate because the current distance from your ship to the target is less (or diffrent) than the distance to the target at the time of the impact. However, you can try to equalize this be recalculating distance to expected target position and flight-time several times.<br>Hmm - i feel there must be an easier solution, just can't see it right now :o) <br><br></td></tr></table><br>
<a name="420933"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> The commands DELTAPITCH and DELTAYAW are great for this kind of thing.<br><br>I use something like this ...<br><br><pre class=code>
Global Pivot = CreatePivot()

;=====================================
;=====================================
;=====================================

Function AIMat( x#, y#, z#, Turret, Smooth# )

	PositionEntity Pivot,x,y,z
	DP# = LIMIT( DeltaPitch( Turret, Pivot) , -Smooth, Smooth )
	DY# = LIMIT( DeltaYaw( Turret, Pivot ) , -Smooth, Smooth )
	TurnEntity Pivot,DP,DY,0
	
End Function

;=====================================
;=====================================
;=====================================

Function LIMIT#( q#, lo#, hi# )

	If q &lt; lo q = lo
	If q &gt; hi q = hi
	
	Return q
	
End Function

</pre><br><br>Where Smooth is the turn speed of the turret.  To anticipate where the target will be by the time the bullet gets there I kind of do something similar to Jfk.  <br><br>This makes it a bit more random ...<br><br>time# = TargetDistance / BulletSpeed<br>ox# = TargetSpeed * time<br>oz# = TargetSpeed * time<br>PositionEntity Pivot, x + Rnd(-ox,ox) , y , z+ Rnd(-oz,oz)<br><br>Might not work for you but may help.<br><br>Stevie <br><br></td></tr></table><br>
<a name="421010"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think you need to solve two equations at the same time...<br><br>You have one equation that reprents the line along which the space ship is currently traveling.<br><br>You have another equation that represents the turret's line of sight.<br><br>The turret's line of sight equation is full of unknowns since you don't know where this line should point.<br><br>There are also two additional values that come into play.  The speed of the ship, and the speed of the bullet.<br><br>Now when I sketch this out on paper, it becomes apparent that I could hit the ship at any number of locations along it's line of travel.  We have to choose a location to hit.  I guess the ideal location to hit would be the location where the ship has to travel the shortest distance.  <br><br>Hm...<br><br>What you want is you want to:<br><br>A) Take ship-line and calculate turret-line such that intersection point of turret line is equal to how far the bullet would travel if fired at this moment.<br><br>Ie, the more perpendicular the two lines are, the less time it will take for the bullet to reach the target point.<br><br>Boy this is tough to explain...  Especially when I don't know what I'm doing myself. :-)<br><br>Okay we know the player's ship line is fixed.<br><br>Now, for each point along that line, it is associated with a certain time in the future.<br><br>That time is the time at which the player's ship will arrive there if it remains on it's current course.<br><br>Aha...<br><br>So, our goal is to find a point where the turret line of sight intersects the ship line....  And this point has to have the same time on both lines.<br><br>We know these:<br>Ship_X#<br>Ship_Y#<br>Ship_Z#<br><br>ShipVector_Nx#<br>ShipVector_Ny#<br>ShipVector_Nz#<br><br>Turret_X#<br>Turret_Y#<br>Turret_Z#<br><br>TurretBullet_Speed#<br>Ship_Speed#<br><br>We do not know these:<br>TurretVector_Nx#<br>TurretVector_Ny#<br>TurretVector_Nz#<br><br>ShipVector_IntersectionDistance#<br>TurretVector_IntersectionDistance#<br><br><br><br>IntersectionDistance# is the world distance from the start of the vector to the point of intersection.<br><br>Speed# is a value which tells us what distance along the vector is equal to what amount of time.<br><br>For example, if Speed# is 2.0, then traveling one unit along the vector takes 2 seconds.<br><br><br>Now, we need to find a point along the ship's line where: <br><br>ShipVector_IntersectionDistance#*Ship_Speed# = TurretVector_IntersectionDistance#*TurretBullet_Speed#<br><br>It turns out there are lots of such points.<br><br>Hm...<br><br>You know, there are much easier ways of doing this. :-)  Like for example, simply dtermining when the ship is within a certain distance of the turret, and firing in it's general direction. :-) <br><br></td></tr></table><br>
<a name="421028"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paul "Taiphoz"</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> there is a way to do it - any maths.<br><br>What I would do is create a pivot on each ship. call this the target pivot.<br><br>then as the ship moves, you move it out in front of its parent by a set amount based on the ships seed.<br><br>You then have your gun turret aim at a ships target pivot and not the ship, as the pivot is always out away from the ship depending on what speed its doing your turret will aim in the right place.<br><br>it might take a tweak or two to get the distance right based on the bullet speed...<br><br>but this would require less maths and would probably be quicker as well and easier to use. <br><br></td></tr></table><br>
<a name="421089"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yavin:<br>If you don't move that pivot further away from the ship based on the ship's speed though, then if the ship is moving slowly, the turret will overcompensate and the shots will miss.<br><br>Also I don't think that will work if the distance between ship and turret varies.  What is a good enough lead distance when the ship is near the turret is not good enough when the ship is far from it. <br><br></td></tr></table><br>
<a name="421142"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paul "Taiphoz"</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Also I don't think that will work if the distance between ship and turret varies. What is a good enough lead distance when the ship is near the turret is not good enough when the ship is far from it <br></div><br><br>Trust me m8 it works, Iv done it.<br><br>And yes it does, because the distance the Pivot is from the ships is based on how fast the ship is moving. So if you show where the pivot is the bullet will hit the ship every time, unless of course the ship changes speed or direction after you fire the shot.<br><br>For example.<br><br>             []<br>         SP      PV<br>If the box is the Player Turret, SP is the Ship, and PV is the ships pivot, its well out in front cos the ship is moving fast, In this case the Turret will shoot in front of the ship but the ship will fly into the bullet, THUS getting the kill.<br><br>This doeas of course go with the understanding of the speed of the turrets bullet.<br><br>What I did was get it so that it NEVER missed. I then just flung in some random values to make it miss every now and then. <br><br></td></tr></table><br>
<a name="421146"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ah, I failed to notice this line:<br>"you move it out in front of its parent by a set amount based on the ships s(p)eed." <br><br></td></tr></table><br>
<a name="421253"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >WolRon</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yavin's idea doesn't take into account the distance of the turret to the target, which will affect the time it takes to get to the target.  You might have to add a variable in there that transforms the target area out in front of the pivot based on distance to the target. <br><br></td></tr></table><br>
<a name="421270"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> I agree... I forgot I mentioned that bit.  <br><br>Yeah... so you have to multiply the distance of the pivot from teh front of the ship by the speed of the ship AND the distance of the ship from the turret.  But before you do that you have to scale those values by some amount.  Well, scale the turrent to ship distance anyway.  I think.  <br><br>Actually... if the ship is moving away from the turret, then wouldn't this give you a point some distance in front of the ship, even though the point you should be aiming for in that case is the ship itself?  I wonder if this would not be a bit innacurate if the ship was traveling at a 45 degree angle to the turret. <br><br></td></tr></table><br>
<a name="421282"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> there are stilla lot of unknown values, eg. the multiplycation factor for those relations.<br><br>I'd rather say there is an easy math solution using radial intersection. Imagine there's a line the target will fly along. We know how long the projectile will travel to the current position of the target, We also know if the distance to the target is increasing or decreasing. Based on the angle of the targets flight we guess a radius that is big enough to hit the target somewhere on its line of flight.<br><br>Now we only have to draw a virtual cricle with that radius and where the circle intersects with the targets line of flight will be our aiming point. <br><br></td></tr></table><br>
<a name="421303"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Fairly simple, though not optimal method of working out the direction to aim the turret:<br><br>Own ship's turret currently has position X0,Y0,Z0 with velocity dx0,dy0,dz0.<br><br>Enemy Ship has position at X1,Y1,Z1 with velocities dx1,dy1,dz1.<br><br>Bullet has velocity VBullet<br><br>Assume that your bullets have a lifetime called "BulletLifeTime" which is the number of frames after firing that the bullet exists for.<br><br>Then perform this loop:<br>(use floats rather than ints for accuracy)<br>For StepNum=1 to BulletLifeTime<br>;calculate the enemy ship's position at each step<br>X1=X1+dx1<br>Y1=Y1+dy1<br>Z1=Z1+dz1<br>;calculate our own ship's position at each step<br>X0=X0+dx0<br>y0=y0+dy0<br>z0=z0+dz0<br><br>;calculate the distance from the turret to the enemy ship<br>Dist=Sqr((X1-X0)^2+(Y1-Y0)^2+(Z1-Z0)^2)<br><br>;check if this distance is greater than the distance a bullet could travel in the time taken so far:<br>IF Dist&gt;VBullet*StepNum then <br>;do nothing - ie if we fired here then the bullet would miss<br>else<br>;if we fire at X1,Y1,Z1 now then the bullet should (may be slightly inaccurate - this check could be improved) hit the target <br><br>AIM AT X1,Y1,Z1 / Place targeting reticule etc at X1,Y1,Z1<br>exit ;because we have found the target point<br>endif <br><br>next <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
