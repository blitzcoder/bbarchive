<!DOCTYPE html><html lang="en" ><head ><title >Any ideas on this?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Any ideas on this?</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Any ideas on this?</a><br><br>
<a name="700243"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Baystep Productions</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have a gun model, and I've attached it to the camera as this is a FPS game. Following me? Good.<br><br>It runs and looks fine, but it has a clipping problem with the other meshes, not uncommon. So I usualy just do something like EntityOrder -1 and it works.<br><br>Not this time, it doesn't clip, but now some of the triangles in the mesh are flipped. <br><br>Any ideas? <br><br></td></tr></table><br>
<a name="700244"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >kevin8084</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sounds like a vertex order problem with your model. Either that or part of your view is actually inside the model. <br><br></td></tr></table><br>
<a name="700247"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Baystep Productions</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> It only screws up the models view only. It's like I fliped the vertex's. vertex order might be it, but how to fix it. <br><br></td></tr></table><br>
<a name="700249"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >kevin8084</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> open in a modeller, select the face/triangle that is giving problems, and reverse vertex order. I don't know what modeller you use but Milkshape is great for this particular problem. <br><br></td></tr></table><br>
<a name="700251"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Baystep Productions</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> yup milkshape is what I got. but now it's even worse. I'll try to post a screenie <br><br></td></tr></table><br>
<a name="700253"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Baystep Productions</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> <img src="http://i43.photobucket.com/albums/e359/jackrackam/4a49005c.jpg"> <br><br></td></tr></table><br>
<a name="700255"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >kfprimm</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> EntityOrder messes with the z-ordering of the meshes triangles, so there is nothing you can do about it. <br><br></td></tr></table><br>
<a name="700263"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MadJack</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> A few solutions would be<br><br> - if the gun has collided/clipped with another object, draw it back (as you would in real life) and flag that the gun can't fire in this position. I've seen a few games that take this option<br><br> - scale down the gun mesh, put position it closer to the camera so that it appears in the same position (bottom right) and at the same scale. Scale it down so that it is within the collision radius of the player<br><br> - do a 2 pass render. First render the scene, then (without Z buffer clearing), render the gun. <br><br></td></tr></table><br>
<a name="700298"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bobysait</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Generally triangle flip when they are in the CameraRange Near using a different entityorder for the mesh and the world.<br>So the best way may be to resize the mesh . <br><br></td></tr></table><br>
<a name="700342"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tom</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  EntityOrder messes with the z-ordering of the meshes triangles, so there is nothing you can do about it. <br></div><br>Correct, I think the zbuffer is disabled when drawing meshes that use EntityOrder. But you should be able to compensate for this by using the function below. (demo included so you can see the difference)<br><br>PCD: Try running the gun mesh through this ZSortMesh() function. It rebuilds the triangle index so that polys furthest along the Z axis will get rendered first.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Graphics3D 800,600,32,2

cam=CreateCamera()
PositionEntity cam,-1,1,-4
light=CreateLight()
RotateEntity light,20,20,0

;Create an unsorted mesh
mesh=CreateSphere(16)
EntityColor mesh,255,0,0
mesh2=CreateSphere(16)
PositionMesh mesh2,0,0,4
AddMesh mesh2,mesh
FreeEntity mesh2

EntityOrder mesh,-1

While Not KeyHit(1)

	If KeyHit(57) ZSortMesh mesh

	RenderWorld
	Text 0,0,"Press SPACE to Z-Sort mesh"
	Flip	
Wend




Type ztri
	Field z#
	Field v0,v1,v2
End Type

Function ZSortMesh(mesh)
	Local temp.ztri = New ztri
	Local tris.ztri[4096] ; assuming meshes have 4096 or less triangles, increase as needed
	
	For i=0 To 4095
		tris[i] = New ztri
	Next

	surfCount = CountSurfaces(mesh)
	
	For i = 1 To surfCount
		surf = GetSurface(mesh,i)
		triCount = CountTriangles(surf)

		;Store each triangles Z distance (based on its vertices average Z value)
		For t = 0 To triCount-1
			z = VertexZ(surf,TriangleVertex(surf,t,0))
			z=z+VertexZ(surf,TriangleVertex(surf,t,1))
			z=z+VertexZ(surf,TriangleVertex(surf,t,2))
			z=z/3

			tris[t]\z = z
			tris[t]\v0 = TriangleVertex(surf,t,0) ;store triangle vertex indexes
			tris[t]\v1 = TriangleVertex(surf,t,1)
			tris[t]\v2 = TriangleVertex(surf,t,2)
		Next

		;Sort the triangles based on Z distance
		For x=0 To triCount-1
			For y=0 To triCount-1
				If x&lt;&gt;y; don't compare with itself
					If tris[y]\z &lt; tris[x]\z
						;Swap the 2 tris
						temp\z  = tris[y]\z
						temp\v0 = tris[y]\v0
						temp\v1 = tris[y]\v1
						temp\v2 = tris[y]\v2

						tris[y]\z  = tris[x]\z
						tris[y]\v0 = tris[x]\v0
						tris[y]\v1 = tris[x]\v1
						tris[y]\v2 = tris[x]\v2
						
						tris[x]\z  = temp\z
						tris[x]\v0 = temp\v0
						tris[x]\v1 = temp\v1
						tris[x]\v2 = temp\v2
					End If
				End If
			Next
		Next

		;Clear the existing triangles
		ClearSurface surf,False,True

		;Add the sorted triangles
		For x = 0 To triCount-1
			AddTriangle surf,tris[x]\v0,tris[x]\v1,tris[x]\v2
		Next
	Next
	Delete Each ztri	
End Function
</textarea> <br><br></td></tr></table><br>
<a name="700374"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Pinete</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Take a look at this link<br><br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=1271" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=1271</a><br><br>Basically it renders the weapons with a second camera and always appears over the rest of models..<br>I've implemented it and works fine..<br><br>regards!, <br><br></td></tr></table><br>
<a name="700434"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> in my little fps game, i have got a constant "WeaponAntiClipinFactor#"<br><br>the smaller this factor is, the nearer and smaller is the weapon! <br><br></td></tr></table><br>
<a name="700543"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rroff</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> or you could just do something like tribes (and other games) and have the gun as an object in the world and test it for collisions with a simple trace, then either move the gun model back corresponding to the space infront, or rotate it so its pointing down a bit or at an angle left-right. <br><br></td></tr></table><br>
<a name="700700"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoeGr</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> I could well be wrong here but perhaps its simply that part of the gun is closer to the camera than the 'near' CameraRange value. Try setting CameraRange 0.0001,1000 or something and see if that makes a difference.<br><br>EDIT - Actually, I think that's maybe what a couple of people were trying to say above. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
