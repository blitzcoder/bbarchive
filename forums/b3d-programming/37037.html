<!DOCTYPE html><html lang="en" ><head ><title >BVM Questions</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >BVM Questions</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >BVM Questions</a><br><br>
<a name="406284"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay, I want to add BVM into the engine, properly.  If this works, the author gets another license sale.<br><br>I am using one script per entity.  I want to load a script with an UpdateEntity() function, and pass the function the four-byte entity data structure to update that entity.<br><br><pre class=code>file$="monster.script"
module=BVM_LoadModule(file)
If module=BVM_INVALID_MODULE RuntimeError "Error loading script "+Quote(file)+"."
context=BVM_CreateContext()
functionpointer=BVM_FindEntryPoint(context,module,"UpdateEntity")
BVM_SelectContext(context)
BVM_SelectEntryPoint(functionpointer)
BVM_Invoke_Blitz3D()</pre><br><br>Questions:<br><br>-How do I pass a variable to the UpdateEntity() function?  (The entity!)<br><br>-Can I have more than one function called "UpdateEntity" in the same context, or do I have to call each entity's update routine a different name?<br><br>-Is there any inherit overhead in calling a function?  Should I call one UpdateMonsters() function, or is it okay to call each UpdateMonster() function individually? <br><br></td></tr></table><br>
<a name="406291"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >WendellM</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm only (very recently) familiar enough with BVM (though I <i>like</i> it) to mention that you'll need to pop the stack to prevent possible stack overflow, since every Invoke returns a value (this isn't really clear in the docs): <a href="http://koriolis.free.fr/forum/viewtopic.php?t=57" target="_blank">http://koriolis.free.fr/forum/viewtopic.php?t=57</a><br><br>As for multiple UpdateEntities per context, you might find <a href="http://koriolis.free.fr/forum/viewtopic.php?t=55" target="_blank">http://koriolis.free.fr/forum/viewtopic.php?t=55</a> helpful.<br><br>Man, I feel that I've only yet scratched the surface ( <a href="http://koriolis.free.fr/forum/viewtopic.php?t=49" target="_blank">http://koriolis.free.fr/forum/viewtopic.php?t=49</a> ), but I love what the potential of BVM seems to be! <br><br></td></tr></table><br>
<a name="406309"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jeroen</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> WendellM says it: you have to "pop".<br>Yes, BVM is cool and therefore I implemented it in Wobbles. <br><br></td></tr></table><br>
<a name="406310"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >poopla</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> FunctionPoint would be the entrypoint(like main() in a standard C program).  You would "Push" the entity that UpdateEntity() needs, then call it(if I recall correctly).<br><br>I never used BVM like that, I coded all the actual game entities and structure in script itself.  I was using it on top of alot of systems, like physics, effects, and general management.  So all game code went in scripts, the more processor intensive code went in hardcode. <br><br></td></tr></table><br>
<a name="406375"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Koriolis</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> How do I pass a variable to the UpdateEntity() function? (The entity!) <br></div>I have to admit this explanation really lacks in the "basics" part of the docs (it's explained in the tutorial though). The recent questions I was asked gave me good hints about what needs improvments in the docs, and it *will* be improved.<br><br>Passing parameters is done by pushing them on the context stack. For that use BVM_PushInt,BVM_PushFloat and BVM_PushString.<br>By example say your function is:<pre class=code>Function SomeFunc$(param1%, param2#)
...
End Function</pre><br>All you have to do in your main program is to push the parameters, invoke the function, then pop the return value.<br><pre class=code>BVM_PushInt(20) ; the value for param1 (it's an integer, so use BVM_PushInt)
BVM_PushFloat(1.23) ; the value for param2 (it's a float, so use BVM_PushFloat)
BVM_SelectEntryPoint(hEP_SomeFunc)
BVM_Invoke_MYCOMMANDSET()
returnValue$ = BVM_PopString() ; the return value (it's a string, so use BVM_PopString). 
    ; If we don't need the return value than we just do "BVM_PopString()" and don't 
    ; store the result anywhere (but popping it would *still* be required).
</pre><br><br><div class="quote"> Can I have more than one function called "UpdateEntity" in the same context, or do I have to call each entity's update routine a different name? <br></div>Each script is a separate program, and thus the names you use in one script doesn't interfer in the other ones. Using the same function name in different scripts is actually a common and good usage, if you're planning to use one script per entity.<br>So you can have each script have its very own "UpdateEntity" function, no problem at all.<br><br><div class="quote"> Is there any inherit overhead in calling a function? Should I call one UpdateMonsters() function, or is it okay to call each UpdateMonster() function individually?  <br></div>I don't think you can find any significant speed difference between both solutions, so choose the one that best fits your needs. <br><br></td></tr></table><br>
<a name="406400"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> If I have a script function that does not return a value, do I need to pop anything?  Can I just do this:<br><br>BVM_PushInt(entity); entity structure to update<br>BVM_SelectEntryPoint(pointer): update function pointer<br>BVM_Invoke_Blitz3D();update the entity<br><br>It seems that the stack might be getting screwed up.  After about 30 seconds, it says the entity does not exist when I try to position it, yet the debugline I added in the script, just before that command, lists the same entity it has been running the whole time. <br><br></td></tr></table><br>
<a name="406402"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Koriolis</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> No, as stated in the thread WendellM pointed you at, you *always* have to pop something.<br><br>To restate what I've said in this thread:<br><div class="quote"> There must always be a pop after BVM_Invoke_&lt;CMDSET&gt; <br>Most important, a function for which you declared no return value actually returns an int (like in plain blitz), so in this case you have to put BVM_PopInt() after the invokation. <br>Note: this also stands for the main program, which is nothing else than a function taking no parameters and returning an integer). <br></div><br>The fact that any function actually returns a value is really a blitz thing, it's not a specificity of BVM:<div class="quote"> In blitz you can do<pre class=code>: 
Function Func1() 
    ; I have not declared the return type, but it's an integer by default 
    ; Here's the proof: I return the string "7 little dwarfs", 
    ; it will get automatically converted to an integer (-&gt; 7) 
    Return "7 little dwarfs" 
End Function 
Function Func2() 
    ; I have not declared the return type, but it's an integer by default 
    ; In addition I'm returning nothing (will return the default value, 0 
End Function 
Print Func1() 
Print Func2()</pre><br>Try this in Blitz, this will print 7 and 0. As you see Func1 and Func2 *do* return a value. <br> <br></div>If you fail to pop the return value you will eventually face a stack overflow. Because the default return type is integer, you have to do a BVM_PopInt() after the invokation. And as you really don't need any return value, just pop it and don't store the value anywhere.<br>Simply put, add<pre class=code>BVM_PopInt()</pre>and that's all.<br><br>In BVM 2 the stack overflow error will get properly reported rather than causing a bug. <br><br></td></tr></table><br>
<a name="406418"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sick, it works! <br><br></td></tr></table><br>
<a name="406664"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hotcakes</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> That's great.  Days worth of conversation and Halo gets it all within a few hours.  =] <br><br></td></tr></table><br>
<a name="406704"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rimmsy</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> BVM is the bomb! <br><br></td></tr></table><br>
<a name="406844"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JaviCervera</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> BVM is the best scripting engine I have seen in ages :) <br><br></td></tr></table><br>
<a name="407915"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay, I almost have it all tested, but I am running into a bad problem.<br><br>I call an entity update function every loop for several minutes, and it works fine.  Then it just stops being able to select the entry pointer.  What causes this?  How can I bug test it? <br><br></td></tr></table><br>
<a name="407961"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sweenie</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> For starters I would count the nr of updates that is made before it stops to see if it's always the same or if it's random. <br><br></td></tr></table><br>
<a name="407977"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rimmsy</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Are you sure you're calling BVM_PopInt() or whichever data type the function at your selected entry point is returning?<br><br>I've found the only way to test it is to use large quantities of debuglogs in my scripts.<br><br>updatePoint=BVM_FindEntryPoint(script_context,module_handle,"updateworld")<br>debuglog "updateWorld entry point: "+updatePoint <br><br></td></tr></table><br>
<a name="407983"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rimmsy</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Generally I create one global context at the beginning of my game, then map all my loaded modules to that. I'm therefore never calling selectContext ever again. <br><br></td></tr></table><br>
<a name="408065"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Me too.  I said SelectEntryPoint.<br><br>I have verified that the entrypointer is the same value that is initially loaded, and that it is succesffully called for about five minutes, and then it just keeps failing after a certain point.  I only use one context for all scripts. <br><br></td></tr></table><br>
<a name="408137"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> I tested to see when it failed, by incrementing a variable each time the script is called.  I ran it three times, and it failed on the 17,582th, 16,904th, and  17,868th loops.  :| <br><br></td></tr></table><br>
<a name="408146"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Koriolis</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I call an entity update function every loop for several minutes, and it works fine. Then it just stops being able to select the entry pointer. What causes this <br></div>Most probably the 10 minutes timeout of the trial version. This time limit is the only limitation of the trial version, everything else being exactly as in the full version, so that you can properly test all you that want.<br>After that limit is reached some key functions of BVM are locked.<br>So if it works all fine for 10 minutes and suddenly stops, then it's all normal.<br><br>I should certainly have put a messagebox or something to make it obvious. <br><br></td></tr></table><br>
<a name="408150"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> ARGHHHHH!!!  I suspected this, but no one said that there was a time limit, and I didn't see anything in the docs about it.<br><br>Oh well, problem solved.  Now that I know the system works, I am off to get my credit card.<br><br>Thanks for the help with this.<br><br><br>You might check out PayPal for orders.  They take the same fee, but you can withdraw your money instantly.  ShareIt would not accept my hotmail address, and it failed the first time I tried my gamecreators address, then worked thr 2nd time.  :| <br><br></td></tr></table><br>
<a name="408155"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Koriolis</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> and I didn't see anything in the docs about it <br></div>True. It's said in the little readme at the end of the installation though. But I now believe noone actually reads these readmes, so a message box after the timeout is probably a good idea. <br><br></td></tr></table><br>
<a name="408495"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hotcakes</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> If it's any concellation, I read it, K =] But I bought it before I actually used it so it didn't matter =]<br><br>BTW, that patched dll you sent me, would that be likely to have been a patched demo or patched proper dll?  Maybe I should revert back to the old one and test it... <br><br></td></tr></table><br>
<a name="408720"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Koriolis</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> would that be likely to have been a patched demo <br></div>Shouldn't be, I compiled it with the options set up for the full version. I'll check that anyway, and let you know otherwise.<br><br>[EDIT]Checked, it's ok[/EDIT] <br><br></td></tr></table><br>
<a name="408931"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hotcakes</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> Then, shoot.  I have no idea what's going wrong now... <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
