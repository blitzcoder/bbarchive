<!DOCTYPE html><html lang="en" ><head ><title >3D Morph?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >3D Morph?</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >3D Morph?</a><br><br>
<a name="327518"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Pongo</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I was thinking of a concept, and I'm not quite sure the best way to accomplish this.<br><br>What I would like to do is have a character that can change slowly over time as the game plays. Color changes are easy through use of textures and entity color controls, but I would also like to alter the shape,... to make it more complicated, I would like to be able to blend multiple targets together.<br><br>For example,... I would have a creature in the following meshes,... all with the exact same vertice/face count and structure:<br>Base mesh (plain with no features)<br>Base mesh with horns on back of head<br>Base mesh with large nose<br>Base mesh with different shaped eyes<br><br>Now,... what I would like to be able to do in-game is mix these together,... a base mesh that has 20% horns, 50% large nose, and 10% different eyes. These would change over time. and could have animations from a base set applied to them.<br><br>In MAX, I can do this with a morph modifier obviously, but I would like to have that control in-game, so that game events change the character.<br><br>Has anyone written any functions like this, or is there a relatively painless way to do this? <br><br></td></tr></table><br>
<a name="327537"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> There are commands to alter the vertices of meshes directly. Although I think this doesn't need to be done as animation sequences per se.<br><br>You don't even need separate meshes.<br><br>Whether you would want to constantly check and update the vertices (whether or not the percentages have changed) I am not sure.<br><br>It's certainly possible though - Im not really very good with modelling and stuff though ;) <br><br></td></tr></table><br>
<a name="327554"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Pongo</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmmm,... maybe I didn't explain this well enough. Let me try again.<br><br>Imagine you have a goldfish model. It has animation applied to it to allow for different motions of swimming,eating,...etc.<br><br>Now you also want to be able to smoothly turn it into a shark, so you modify the mesh so the head is like a shark. You also modify the fins seperately. The reason for doing everything seperate, is so it can be blended smoothly in sections as desired.<br><br>For example,... After eating a special food, the goldfish grows a large shark fin, so I blend that mesh in with the original. After doing something else, perhaps the head starts to change into a dolphin head, but retains the shark fins. So I mix in a dolphin head mesh with a shark fin mesh at the appropriate mixture.<br><br>In order to do this, all meshes are based off of the original, with only vertices moved around. Although you can move individual points in blitz, I need them to be precisely to what has been modeled. (ie,... load the manipulated mesh, grab all the vertex locations and compare to the original to find out what is changed. Then use that info to move the vertices toward a certain shape)<br><br>In Max I can do this by making my seperate shapes and using a morph modifier,... what I would like is to have is that functionality in code.<br><br>Hope you're not even more confused now! (I know I am!) <br><br></td></tr></table><br>
<a name="327559"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry I thought you meant the mesh would gradually change over longer amounts of time.<br><br>I should have picked up on your use of the word 'morphing'!!!<br><br>I think you would need separate meshes for the horns, head, nose etc (I know it sounds like a lot)and assign the animation sequences to these??? At least there are commands to control the speed and smoothness of the animations.<br><br>This is where it gets way out of my depth though... <br><br></td></tr></table><br>
<a name="327570"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Pongo</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> nope,... still not right. I actually DO want it to change gradually over time. As a matter of fact, so slowly that you do not see it happening while it is changing.<br><br>Using the Fish example,.... say for example the fish starts eating a lot and therefore gets fat. I don't want to suddenly just pop a new fat fish in, I want it to happen very slowly, so that you look at it and ask "is that fish fatter than he was a bit ago?" Same with the other changes. Because of this, the function would not need to be called very often, maybe once every 30 seconds or so would probably even be enough.<br><br><br><br>The method I have in my head is this,... load in each mesh and store all vertex positions,... then call a function that mixes the position of the vertices based on what you want. In the most simple of cases,... 2 meshes,... the output would be a straight mix between the 2, but there is more to it when more variations come in.<br><br>Hope this is making more sense now. <br><br></td></tr></table><br>
<a name="327595"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bot Builder</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> hrm. can't you just loop through all the verts and position them at a point on the line between the target and the finish vert? to do this all you need to do is make a weighted average of the coordinates like this:<br><br>cx=(ox*(255-time)+nx*time)shr 8<br>cy=(oy*(255-time)+ny*time)shr 8<br>cz=(oz*(255-time)+nz*time)shr 8<br>this assumes time is between 0 and 255. the shr 8 effectivly divides by 256. c* is the current location, o* is the start vertex location, and n* is the final vertex location. If you want to say, blend between 3 or 4 mehs you could use bezier interopoloation instead of linear interopolation. <br><br></td></tr></table><br>
<a name="327609"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Pongo</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Maybe I'm overthinking this,... I know I'm in over my head anyways, but what the heck. that's never stopped me in the past.<br><br>I guess I'll just have to code something together and see what happens instead of worrying what won't work. My biggest concern was weighting more than 1 point where the point is stationary in multiple meshes. I don't want an average of those points in that case (don't know if this makes sense though, pardon me while I think out loud) I think the way around this is to not store the vertex positions, but the position offset from the original mesh,... then I can apply multiple offsets from different meshes. Hmmm,.. I'm sure no one knows what I'm talking about, but a light bulb is going off over my head right now. <br><br></td></tr></table><br>
<a name="327611"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AbbaRue</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just a suggestion, but if you use an x file for your mesh, x files are text files. <br>If you alter the values in the text file you can make it look however you want. <br>This is a thought I will be persuing for my project, once I get finished with my outside world. <br>Or better yet, convert your fish into an x file load it into a text editor <br>and then cut and paste the vertices into you program.  Then you can alter the <br>verticies using math functions to get any effect you want. <br><br></td></tr></table><br>
<a name="327613"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't know if it was said before: make models of all required shapes and use the same number of vertices with eachone of them. Now you can morph them easily with cheap math formula, as slow as you want. Simply interpolate the vertices to the new positions. <br><br>There is an other problem with textures. If you want to morph them too, this might slow things down. But it's possible. <br><br></td></tr></table><br>
<a name="327657"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ruz</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> aww i thought you meant morph, the plasticine guy from take hart <br><br></td></tr></table><br>
<a name="327668"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PetBom</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> The maths for doing a morph is really easy if you have the meshes to morph between. This is a function that I created some time ago to do some simple morphing for an idea i had.  You simply call the function and send in the mesh to be morphed, the base mesh of the morph, the target mesh of the morph, and a stage between 0 and 1 that sets the bias of morph between base and target (0 = as base, 0.5 = even mix betwen base and target, 1 = as target).<br><br><pre class=code>
Function DoMorph(morph,base,target,stage#)

	timeMorph = MilliSecs()

	allSurf = CountSurfaces(base)	
	
	For j = 1 To allSurf

		surfBase = GetSurface(base,j)
		surfTarget = GetSurface(target,j)
		surfMorph = GetSurface(morph ,j)
	
		allVerts = CountVertices(surfMorph)
	
		For i = 0 To allVerts-1
			VertexCoords surfMorph,i,VertexX(surfBase,i) + ((VertexX(surfTarget,i)-VertexX(surfBase,i))*stage),VertexY(surfBase,i) + ((VertexY(surfTarget,i)-VertexY(surfBase,i))*stage),VertexZ(surfBase,i) + ((VertexZ(surfTarget,i)-VertexZ(surfBase,i))*stage)
		Next
	
	Next
	
	Return  MilliSecs() - timeMorph
	
End Function
</pre><br><br>Oh! I just noticed there's a timer in there as well, which actually is the return value from the function. I guess I needed to time the time taken to do the morph. you can just remove it.<br><br>If you like I could send you the project where I do the morphing. It's actually really simple. I remember I just whipped it up in a few hours to test if you could do it<br><br>Hope this helps!<br><br>/PetBom <br><br></td></tr></table><br>
<a name="327672"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PetBom</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oops!<br><br>Sorry for posting that code with the very long line! I did not realize that it would make this page superwide!<br><br>Another thing that I forgot to mention with regards to morphing is that the morph,base and taget meshes must have<br>EXACTLY the same number of vetices and the same vertex and surface indexes. But this is nothing that is blitz specific, it is true for all morphing algorithms, since mophing in the end just is simple interpolation of vertexes in two vertex sets<br><br>/PetBom <br><br></td></tr></table><br>
<a name="327673"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> I thought you couldn't access the vertexs of an animating entity? I mean, they only gave vertex info from the intial un-animated positions.. <br><br></td></tr></table><br>
<a name="327676"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PetBom</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ross  C - You are right.You can not access the vertex positions of a mesh being animated through vertex deformation. So I guess my example only works if you use other forms of animation. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
