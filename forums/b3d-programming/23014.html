<!DOCTYPE html><html lang="en" ><head ><title >Surface count slowdown...</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Surface count slowdown...</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Surface count slowdown...</a><br><br>
<a name="236930"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I read somewhere that slowdown form using high surface counts is (mainly) because the GFX card has to keep using different textures to render the various surfaces. So, if I wan't to render a load of un-textured entities, will the surface count slowdown be largely reduced?<br><br>If not, what other factors cause a high surface count to slowdown the FPS?<br><br>Thanks in advance!<br><br>-big10p <br><br></td></tr></table><br>
<a name="238138"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sunteam Software</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> In the interests of replying, I don't actually know, might be worth you doing some tests yourself and posting results. <br><br></td></tr></table><br>
<a name="238142"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rob Farley</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I could be wrong, but even if an object doesn't have a texture it will still have at least 1 surface. If the object has a few materials on it to give it different colours then it will have multiple surfaces and therefore texturing would be more efficient.<br><br>If you've got a bunch of objects using the same texture however, you can addmesh them all together to make a single surface entity, of course you've got the poly count/surface count trade off there and all the objects are stuck together. <br><br></td></tr></table><br>
<a name="238144"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rob</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> You need to group as many meshes by the same texture.<br><br>Blitz will need a seperate surface to display a seperate brush setting/alpha/shininess/blend/fx or texture. <br><br></td></tr></table><br>
<a name="238179"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Anthony Flack</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> That's actually a very good question though - if surface slowdown is primarily caused by state changes on the video card, caused by the need to switch textures, what happens if you're not using textures? <br><br>And is drawing consecutive objects that use the same texture any faster than drawing different ones? And if the answer to both of the above is no, then is this a possible avenue for future optimisation? <br><br></td></tr></table><br>
<a name="238180"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >simonh</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Testing is the only answer. <br><br></td></tr></table><br>
<a name="238732"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> OK, I'll try and do some testing tomorrow. Thanks for replying! <br><br></td></tr></table><br>
<a name="238735"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GNS</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I coded a little test that creates 2000 (untextured) cubes and positions them at random places on the screen (always within the camera's view, however). TrisRendered() shows 24,012 polys being rendered. The framerate is a mere 16-18 FPS. <br><br>Now, if the assumption thus far has been that surface count slowdown has been because of texture switches what would account for the slowdown in this situation? Fill rate? <br><br></td></tr></table><br>
<a name="238740"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm not sure. Do you think 16-18 FPS is slow? I don't know what spec your PC is so I can't tell.<br><br>I would be interested to know what FPS you get if you had a variety of textures which you randomly assign to the cubes. Also, what speed you'd get if you plonked all the untextured cubes into a single surface mesh and displayed that. You could view the scene from a high distance in order to rule out fill rate as a culprit, I guess (or have I completely misundertood the meaning of fill rate all this time? possibly :) ). <br><br></td></tr></table><br>
<a name="238744"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> When I was testing this with quads, I found that them being untextured actually made them slower than the textured variety. Didn't make a lot of sense to me, but hey, that's computers for ya.<br><br>So yeah, it's still surface dependent. Or my tests indicated such, in any case. I don't know how videocards work, but I'm guessing it still sees a plain colour as a texture. <br><br></td></tr></table><br>
<a name="238745"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> "Now, if the assumption thus far has been that surface count slowdown has been because of texture switches what would account for the slowdown in this situation? Fill rate?"<br><br>No, surfaces.  Even though they're not textured differently, Blit still creates treats the surfaces as different.<br><br>The only optimizarion Mark could do is to check to see if the last surface rendered has the same properties (texture, color, alpha, shininess) as the current surface being rendered.<br><br>This may provide a large speed up in your demo, but in most games it would not provide a big speedup becuase entities can't be storted by material, they have to be sorted by distance.  But there are certain cases, like particle systems, where this might provide a big speedup IF the user knows about it and what to avoid doing (like changing the color or alpha of the particles... only animating the texture) I have written to Mark aobut this, so maybe th enext version of Blitz will have something like this, but he never replies to my emails anymore so I don't know what his thoughts on this are.  I wouldn't count on the opitimizaton appearing in the next update though. <br><br></td></tr></table><br>
<a name="238752"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GNS</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> big10p: I ran the test on my P3 1Ghz with a GF4 MX 440. If I combine the cubes into one mesh with one surface (using AddMesh) the framerate jumps up to 65-68 FPS. Quite a bit improvement.<br><br>sswift: I was under the assumption surfaces were slow because of the underlying texture switching going on? <br><br></td></tr></table><br>
<a name="238767"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> GNS: sorry, for some reason I read your 16-18 FPS as 16-18 milliseconds - it's very late. :)<br><br>Anyway, It seems from what ppl are saying that the surface count slowdown isn't just texture related. Oh well. <br><br></td></tr></table><br>
<a name="238770"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> "sswift: I was under the assumption surfaces were slow because of the underlying texture switching going on?"<br><br>They ARE.  But the "texture switching" code is called for each surface wether or not you actually change textures for each surface. <br><br></td></tr></table><br>
<a name="238771"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh and "alpha switching" and "color" switching and "shininess" switching are also done per surface regardless of whether those change.<br><br>At least, that's my limited understanding of how things work from what I've learned from talking to Mark about it. <br><br></td></tr></table><br>
<a name="238783"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GNS</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> I wonder if the texture switching code has to be called regardless of surface state? If it was possible to somehow only update surfaces whose properties have changed some performance could be gained for static objects. <br><br></td></tr></table><br>
<a name="238846"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>Blitz checks for redundant state changes, so if you set the same texture twice in a row the hit is minimal (ie: Blitz's fault!).<br><br>But transform changes (ie: different entities) also cause a big hit, so the more the entities you have - even if they share the same texture - the bigger the hit. <br><br></td></tr></table><br>
<a name="239010"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> There's a TRANSFORM change too? <br><br>So I guess what you're saying is you already thought of the optimization I suggested a long time ago, but it doesn't give much speedup between entities because there's a transform change to worry about as well as a texture change. <br><br>Damn.<br><br><br><br>But Mark...  Something doesn't make sense about what you've just said.<br><br>Above there's a demo which takes some spheres, all textured the same, and either uses addmesh to create a bunch of surfaces in a single mesh, or leaves them all as individual meshes.  And those who have tested that code claim that the results are the same for both.<br><br>This would seem to indicate that the speed hit between surfaces is the same as the speed hit between entities, even when using the same texture.<br><br>So I have to wonder:<br><br>1. Where is this texture hit optimization you speak of, because that should be speeding up the addmesh example.<br><br>2. Where is this entity transform hit, because that should be slowing down the example with individual entities.<br><br><br>When you take both of these together, they indicate that the addmesh example should be a lot faster than the seperate entities.  But it is not.  <br><br>Why? <br><br></td></tr></table><br>
<a name="239014"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> The test I speak of is here:<br><br><a href="http://www.blitzbasic.com/bbs/posts.php?topic=23182" target="_blank">http://www.blitzbasic.com/bbs/posts.php?topic=23182</a> <br><br></td></tr></table><br>
<a name="239034"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GNS</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> Some slightly off-topic things I've found:<br><br>In my test I used AddMesh. CountSurfaces() revealed that there was only 1 surface in the final mesh. This seems to say that AddMesh only creates new surfaces if the properties of individual entities differ from each other (from my tests, things like different UV coordinates, etc. cause new surfaces to be me created) but that's to be expected. There wouldn't be much point to AddMesh, that I can see, if it simply created a new surface for each individual entity. The speed hit would be the same, as instead of having 2000 individual meshes, each with 1 surface, you would have 1 mesh with 2000 surfaces.<br><br>Also, AddMesh doesn't seem to create a new surface once the vertex limit (65536 was it?) is reached. It simply gives an 'Illegal Memory Address' at Renderworld.<br><br>What I wonder now is how do other games/other engines work around the speed hit caused by transform changes? Tribes 2, for example, features maps with hundreds of tree meshes, buildings, infinite terrains, etc. and still manages to pull off an acceptable framerate. Obviously objects can be combined into single surface entities but with the transform change causing such a large speed hit surely there has to be some tricks or workarounds being used? <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
