<!DOCTYPE html><html lang="en" ><head ><title >Reading lightmap at location.</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Reading lightmap at location.</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Reading lightmap at location.</a><br><br>
<a name="384056"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sledge</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is there any way to cross reference a picked part of a b3d with the portion of the lightmap it uses, returning the rgb of the particular spot on the lightmap?<br><br>I've looked through the command set and there seem to be a couple of commands related to setting the lighting on part of a mesh but nothing for reading a value back. As you can probably guess I'm trying to alter an entity's colour dynamically so that it continually matches the lightmap hue as it travels about a level -- but I'm a bit stumped as to a "BASIC" solution. Anybody achieved something similar that they fancy going over? <br><br></td></tr></table><br>
<a name="384064"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tom</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Fredborgs PickedU() and PickedV()<br><br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=515" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=515</a> <br><br></td></tr></table><br>
<a name="384069"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sledge</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Crikey! Thanks for the link. I've no idea what U's, V's or W's are of course, but I'm sure if I employ my time honoured develoment methodology (changing things at random until they happen to work) to the task I'll soon have it doing... something. <br><br></td></tr></table><br>
<a name="384070"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ZombieWoof</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> think of u/v as x/y on the texture map -- range is 0-1, so you have to multiply by the w/h of the texture. <br><br></td></tr></table><br>
<a name="384080"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sledge</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ahh, I see... what's W for though? :/<br><br>I've run into a bit of a problem anyway in that you need to supply Fredborg's functions with the handle of the texture you're interrogating. How are you supposed to know that with an automatically loaded lightmap? I'm kind of amazed there isn't a straightforward command for this... it's not as if its use would be unanticipated (what else are you going to want a lightmap for?) <br><br></td></tr></table><br>
<a name="384081"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ZombieWoof</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Dunno -- blitz docs that I have say it doesnt get used, and I dont know of any app that does use w. Maybe there are shaders/procedural textures that use all 3 ?? <br><br></td></tr></table><br>
<a name="384106"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mustang</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> W is/was meant for future expansion... it's unused. IMO bit like XYZ (note that UVW comes before XYZ alpabetically), so W would be "depth" but it has no use in (UV) texturemaps. <br><br></td></tr></table><br>
<a name="384118"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rottbott</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sledge, use:<br><br>GetEntityBrush()<br>GetBrushTexture()<br><br>Don't forget to free them once you're done! <br><br></td></tr></table><br>
<a name="384211"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sledge</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the suggestions -- I will plug away at this and, if successful, wang a method in the code archive. Don't hold your breath though! <br><br></td></tr></table><br>
<a name="384292"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Caff</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sledge also look at: <a href="http://www.blitzcoder.com/cgi-bin/showcase/showcase_showentry.pl?id=kusonagi09182003234308&amp;comments=no" target="_blank">http://www.blitzcoder.com/cgi-bin/showcase/showcase_showentry.pl?id=kusonagi09182003234308&amp;comments=no</a> <br><br></td></tr></table><br>
<a name="384304"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sledge</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>GetEntityBrush() <br>GetBrushTexture() <br><br>Don't forget to free them once you're done! <br> <br></div><br><br>So let's say I do something like this...<br><pre class=code>
map=LoadMesh("mymap.b3d")
lmaptex=GetBrushTexture(GetEntityBrush(map))
</pre><br>How would I go about tweaking it so I'm getting information about the lightmap layer only... and how do I know what the brush I have to subsequently free is called? This is all very alien.<br>++:D &lt;-- smiley with alien forehead a la TV's famous Start Wreck.<br><br>EDIT: I'll have a look at that Caff... I was typing while you were posting.<br><br>EDIT: Looks perfect (and scarily complex) Caff. Thanks for that -- totally missed it. <br><br></td></tr></table><br>
<a name="384314"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ZombieWoof</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> its called lmaptex -- what you named it :)<br><br>Can blitz automatically load a lightmap ?? every example I've seen loads it in code and applies it to the mesh. <br><br></td></tr></table><br>
<a name="384323"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sledge</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> lmaptex is the texture, not the brush, isn't it? In answer to your question yes... if a lightmap is present it is loaded automatically. In fact, whenever I've tried to load a lightmap separately I've just ended up with the entire map texture applied to every wall like a regular texture -- no idea how you'd load one manually. <br><br></td></tr></table><br>
<a name="384347"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ZombieWoof</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> ok -- my bad -- you didnt store the result of GetEntityBrush(map) into its own variable.<br><br>This is how I load terrain with lightmap that I create with ALE: (dont expect it to be much different for any lightmapped mesh)<br><br>;Load Level <br>level = LoadMesh("default/default.b3d") <br>ScaleEntity level, 2, 2, 2 <br>PositionEntity level, 0,-5,0 <br><br>;Lightmap <br>EntityFX level, 1 <br>Global lightmap = LoadTexture("default/default_lm.png") <br>TextureCoords lightmap, 1 <br>TextureBlend lightmap, 2 <br>EntityTexture level, lightmap, 0, 1 <br><br>Note the EntityTexture command.. the lightmap is loaded into texture slot 1 (of 0-7 possible). One may presume that the mesh textures are in slot 0 -- if you replace slot 0, you get lightmap all over your models :) <br><br></td></tr></table><br>
<a name="384356"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sledge</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>you didnt store the result of GetEntityBrush(map) into its own variable. <br> <br></div><br>Heh - now does that mean there is anything to free or not?! :/<br><br>re Loading lightmaps manually -- it was TextureCoords I was missing previously, thanks for the example. <br><br></td></tr></table><br>
<a name="384417"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sledge</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Bitter-sweet: kusonagi's routine (linked to by Caff) is great, but all the line-picking and associated number-crunching slow things right down. Looks like pre-calcing a three dimensional shadowmap using kusonagi's function then referencing THAT instead is the order of the day. A bit more work, then, but there shouldn't be any reason why lots of shadow-sensitive entities can't be maintained this way.<br><br>(Or alternatively, use a low-res lightmap that is blurry enough to hide the lag in an entity's hue then only linepick every few frames)<br><br>EDIT: Quick update, kusonagi's code is plenty fast on smaller lightmaps. I can easily do a pick per frame out of it under such circumstances. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
