<!DOCTYPE html><html lang="en" ><head ><title >FreeImage LIB</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >FreeImage LIB</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >FreeImage LIB</a><br><br>
<a name="409716"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Boiled Sweets</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi, <br><br>has anyone got this to work with Blitz3d.  I have copied the \decls files into the \userlibs dir.  I have included the FreeImage3d.bb in my app.  I have copied the 2 dlls into my apps main dir.  It appears to comile OK but when I run it I get "User lib not found".<br><br>Any thoughts <br><br></td></tr></table><br>
<a name="409721"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bot Builder</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> You have to copy the dlls as well :P<br><br>Have you tried using 2d? <br><br></td></tr></table><br>
<a name="409722"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Boiled Sweets</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have copied them to my apps dir and to \userlibs.  Still no joy!  And when I build a release do I have to include the 2 dlls?<br>Do you mean the 2d version?  Its for Blitz Plus...<br><br>It fails on "FI_FileEXT(FI_FIFType,1)=FI_GetFIFDescription(FI_FIFType) "<br><br>Surely someone must use this library...<br><br>How do other people save to PNG? <br><br></td></tr></table><br>
<a name="409725"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Boiled Sweets</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Fixed it.  Removed the "\data" path in the FreeImage.decl file. <br><br>But what filees (if any) do I need to ship with my app?  Just the 2 dlls I guess?<br><br>Also the saved image is screwed.  The colours are all screwy!  ARGGGHHH!<br>I'm creating an image then using CopyRect to copy the back buffer to it then saving the image...<br><br>Any thoughts? <br><br></td></tr></table><br>
<a name="409729"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bot Builder</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just the two dlls. <br><br></td></tr></table><br>
<a name="409733"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Boiled Sweets</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Any idea why the image colors are all screwy? <br><br></td></tr></table><br>
<a name="409734"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Perturbatio</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Maybe to do with bit depth? <br><br></td></tr></table><br>
<a name="409735"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Boiled Sweets</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> But how do I fix it?<br><br>Does anyone use this lib? <br><br></td></tr></table><br>
<a name="409823"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AntonyWells</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've used it in C++, but I'm not sure if you're using the C++ .dll directly or using a 3rd party blitz wrapper? <br><br></td></tr></table><br>
<a name="409849"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Boiled Sweets</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm using a Blitz wrapper... <br><br></td></tr></table><br>
<a name="409957"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Boiled Sweets</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Bump!<br><br>Seriously though does anyone successfully save images to .PNG?<br><br>If so how???? <br><br></td></tr></table><br>
<a name="409976"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've saved images to PNG using FreeImage with BlitzPlus (Screenshot Magic uses it) but I ended up writing my own wrapper using Snartys code as a reference.<br><br>What Perturbatio said sounds right to me, it is most likely the image depth that is causing the strange colours. Take a look at the depth conversion function which is called inside the SavePNG function (just prior to saving - I think it's FIQSend?). Also what colour depth is your desktop set at, 16-bit or 32-bit? 16-bit can affect the images colour depth iirc.<br><br>If you still can't get it to work, bump this thread and I'll have a play with it here and get back to you. <br><br></td></tr></table><br>
<a name="410032"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Boiled Sweets, I was a little curious so I had a look anyway.<br><br>The image colour corruption is definitely due to the desktop being set at 16-bit. If you set it to 32-bit it works ok.<br><br>The problem occurs because the FIQSend function is only set up for 32-bit colour depth mode.<br><br>In the FIQSend function you have this code:<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
iBank=FI_PeekIntEx(iBuffer,72)
iPitch=FI_PeekIntEx(iBuffer,56)
FIBITMAP=FI_ConvertFromRawBits3D(iBank,ImageWidth(Image),ImageHeight(Image),iPitch,FI_PeekIntEx(iBuffer,100),FI_PeekIntEx(iBuffer,112),FI_PeekIntEx(iBuffer,116),FI_PeekIntEx(iBuffer,120),0)
</textarea><br>I suspect the function 'FI_PeekIntEx(iBuffer,offset)' would need to be replaced with the FI_PeekWordEx(iBuffer,offset) function, meaning it peeks 2 bytes instead of 4. The offsets would also need changing, but I'm not sure how to implement this in practice as I don't know how those offsets were calculated. Maybe Snarty can help point you in the right direction, if you email him, he may know what they should be for 16-bit colour depth. Once you know the settings for both modes, you can then detect the depth and use the correct function for that mode, 16-bit or 32-bit. <br><br></td></tr></table><br>
<a name="411919"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Bump<br><br>Have you sorted it then? :)<br><br>Was wondering if you got those 16-bit offsets... <br><br></td></tr></table><br>
<a name="412067"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Boiled Sweets</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> VIP3R,<br><br>No.  I'm a little out of my depth on this one.  I'm still trying to decypher what you recommended.  I am amazed that no-one here appears to be able to save to .PNG format as it is the image format of choice...<br><br>Could you help? <br><br></td></tr></table><br>
<a name="412098"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah, I'll have a look into it, can't promise anything tho ;)<br><br>I did manage to solve this with the B+ version, but the commands I need don't exist in B3D... LockedPitch() LockedPixels() etc. <br><br></td></tr></table><br>
<a name="412133"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have successfully created files in PNG format without issues, right "out of the box" so to speak....i use freeimage to generate my web graphics actually. <br><br></td></tr></table><br>
<a name="412186"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> ouch! ive never ever seen this! i have no way of trying that code here either.... (im at work) <br><br></td></tr></table><br>
<a name="412200"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Boiled Sweets</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> All I'm doing is creating a tmp image.  Copying the front buffer to the tmp imaage then calling the ImageLib "SavePNG" function passing in the tmp image.<br><br>The bluey/yellow circular mesh in the sample picture should be grey.  The yellowy floor ceiling is also supposed to be a greyisg colour. <br><br></td></tr></table><br>
<a name="412439"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Boiled Sweets</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> bump &lt;hic&gt; <br><br></td></tr></table><br>
<a name="412458"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> i will be taking a look at this tomorow. il let you see the results of a few screen modes <br><br></td></tr></table><br>
<a name="412894"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> FIXED! *wipes sweat from brow*<br><br>Ok, replace the FIQSend() function in your FreeImage3D.bb with this new one:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Function FIQSend(Image)

; ### 16-bit fix by VIP3R (Jim Williams)
; ### Now works with both 16-bit and 32-bit depth

Local iBuffer%, iPitch%, iFormat%
Local FIBITMAP%, nFIBITMAP%, iBank%

iBuffer=ImageBuffer(Image)

LockBuffer iBuffer

iBank=FI_PeekIntEx(iBuffer,72)
iPitch=FI_PeekIntEx(iBuffer,56)

If iPitch=3200
	ROffset=112
	GOffset=116
	BOffset=120
	End If

If iPitch=1600
	ROffset=120
	GOffset=116
	BOffset=112
	End If

FIBITMAP=FI_ConvertFromRawBits3D(iBank,ImageWidth(Image),ImageHeight(Image),iPitch,FI_PeekIntEx(iBuffer,100),FI_PeekIntEx(iBuffer,ROffset),FI_PeekIntEx(iBuffer,GOffset),FI_PeekIntEx(iBuffer,BOffset),0)

UnlockBuffer iBuffer

If FI_GetBPP(FIBITMAP)&lt;&gt;24
	nFIBITMAP=FI_ConvertTo24Bits(FIBITMAP)
	If nFIBITMAP
		FI_Unload FIBITMAP
		FIBITMAP=nFIBITMAP
		EndIf
	EndIf
	
Return FIBITMAP

End Function
</textarea><br><br>Works properly now in both 16-bit and 32-bit modes ;) <br><br></td></tr></table><br>
<a name="412897"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Boiled Sweets</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> Firstly EXCELLENT WORK!  So...<br><br><pre class=code>
If iPitch=3200
	ROffset=112
	GOffset=116
	BOffset=120
	End If

If iPitch=1600
	ROffset=120
	GOffset=116
	BOffset=112
	End If
</pre><br>appears to have fixed it.  What was it all about?  How did you fix it? <br><br></td></tr></table><br>
<a name="412899"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, trial and error :)<br><br>I spotted that in 16-bit mode, the red and blue bit masks were reversed.<br><br>It was just a case of detecting the depth, then reverse the bit masks with 16-bit modes.<br><br>I don't understand why Snarty didn't cater for this in the first place, I had the same problem with the 2D wrapper. <br><br></td></tr></table><br>
<a name="412906"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Boiled Sweets</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> Have you emailed the update to Snarty? <br><br></td></tr></table><br>
<a name="412908"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> No, the last time I mentioned a bug in the wrapper (memory leak) to Snarty, he never bothered to reply or implement an update. Suppose he could be too busy to work on it?<br><br>Maybe I should release my own FreeImage wrapper? <br><br></td></tr></table><br>
<a name="412919"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Boiled Sweets</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> YUP!<br><br>I'm amazed more people don't use it... <br><br></td></tr></table><br>
<a name="412931"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> woohoo, Yes, i could get the same error and that fixed it. vip3r, thanx :D <br><br></td></tr></table><br>
<a name="412932"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> You're welcome :) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
