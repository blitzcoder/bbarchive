<!DOCTYPE html><html lang="en" ><head ><title >Networking 101</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Networking 101</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Networking 101</a><br><br>
<a name="1107322"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Adam Novagen</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've been in a bit of a slump this month for programming, and it's been putting a major spanner in the works for getting my game together. To refresh myself, I'm taking up a side project for fun, and also to take my first foray into multiplayer principles. It's doing the trick as far as my brainwork and enthusiasm go, but I'm at a bit of a loss with this project on several fronts since I basically know nuffink about networking whatsoever. So, here come the questions.<br><br>Is it possible to obtain an external IP from B3D? I know (or at least believe) this can be done server-side with <b>TCPStreamIP()</b>, but I was wondering if there was any way for a <i>client</i> to know its own external IP address, rather than just its LAN IP. And yes, I know I could simply send the IP address detected by the server back to the client, but if possible I'd like to get the outside IP without using external sources. Risk of proxies and all that.<br><br>Can more than one TCP stream exist safely on the same port? In other words, if the server is listening for incoming streams on port 32587, and the client is <i>sending</i> its data to that port, can any other clients do the same? Or is it necessary to somehow assign each client its own port? I can't honestly imagine the latter being the case, but since I'm a complete novice here I figured it'd be safer to ask.<br><br>What would be a good way to handle large-ish file transmissions alongside player data? What I'm aiming for here is a "custom content" system. Say that the server is modified in some way or uses some sort of custom content; when a player connects, it needs to send a few images or what-have-you to their client, but it must do this while causing as little throttling on the already-connected players as possible. Should I simply use a <b>MilliSecs()</b> timing step to juggle the file transfer with the player data? Should I split the server into two separate programs, one to handle custom content transmissions and one to handle the player connections? Is there some other trick or ploy I don't know about yet, or should I simply forget the idea of custom content while using B3D?<br><br>That's about all I can think of for the moment, and it'll certainly give me a bit to chew on. Cheers! <br><br></td></tr></table><br>
<a name="1107323"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Leon Drake</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> yes you can get your external ip,<br><br>but i would recommend UDP over TCP for gaming. <br><br></td></tr></table><br>
<a name="1107324"></a>

<a name="1107326"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rroff</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> TCP is very slow in B3D (and in general) handshaking a new connection will stall the main thread for 200ms or so - so short of using threading with fastpointer its usually best avoided aside from things like downloading a new map file from a web server in the game client.<br><br>Getting the external IP on the client without bouncing off a remote server can be quite hard depending on the specifics of what the client is running.<br><br>If you want to handle custom content from the server I would reccomend doing one of the following:<br><br>URL redirect where the server hands the connected client a URL to a web server where it can download the data from as a file.<br><br>Seperate thread(s) on the server software using fastpointer that is purely used for handling content downloads to clients.<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1107325"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Adam Novagen</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've heard, but fortunately there's very little action element in this. Actually I'm trying something in a retro-RPG style, so the movement is tile-by-tile grid based, and combat uses minimal time orientation. In this case, I <i>believe</i> I would be better off with the stability of TCP over the relative speed of UDP. That raises a fourth and fifth question, though, namely "Should I use UDP instead of TCP" and "If so, how would I implement it?" <br><br></td></tr></table><br>
<a name="1107327"></a>

<a name="1107329"></a>

<a name="1107330"></a>

<a name="1107331"></a>

<a name="1107332"></a>

<a name="1107333"></a>

<a name="1107334"></a>

<a name="1107335"></a>

<a name="1107336"></a>

<a name="1107339"></a>

<a name="1107341"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RifRaf</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> What would be a good way to handle large-ish file transmissions alongside player data? What I'm aiming for here is a "custom content" system. <br></div><br><br>What I do for this is let the server tell the player where to get things if they are needed, and then the client does an http:// file transfer from that location so the server doesn't have to spend time sending that data to the client. Once the server sends the client the location is disconnects the client, and the client acts on that information accordingly. You can have your client remember the last server login attempt and reconnect after the http get file transfers are done.   <br><br>You'll have to make a system for this.. perhaps any address given you client will expect a "filelist.txt" file to get first then compare that list to existing files and download each one you dont have up to date.<br><br>It's also helpful if the media has a standard format to minimize required crc checking I've reduced tiny tanks down to three files   ( Map_DP.dat, MAP_SCN.dat, &amp; MAP_PAK.dat)<br>The _SCN holds the scenery placement data (where what size color ect), The _DP holds special data point data and ambient volume data, and the _PAK file is all the models &amp; textures recreated in my own format and compressed.<br><br>  I do not have any map specific sounds in the game but one more .dat file for that wouldn't hurt much. The tradeoff is that if I add more models the the map the entire _SCN or _PAK file has to be downloaded depening on if its a placement change or new model added the to the map.   But the .DAT files are usually only about 1 to 3 megs in size.<br><br>I recommend using the zlibwapi.dll for compressing and super fast crc checks on both banks and files<br><br><br>If you want to see this system in action , just download tiny tanks.. I update the main program , support paks and map data all the time.  Clients and servers auto update to the new data.<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1107328"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rroff</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I updated my post above a bit btw.<br><br>Even for that kinda game I reccomend using UDP, the actual implementation is quite a long subject tho. <br><br></td></tr></table><br>
<a name="1107337"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Adam Novagen</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Rifraf and Rroff.<br><br>Hmm, alright. The URL redirect is the most likely option for me to use, since I'm experimenting to see if I can make a little nicely portable server program so that it can be set up "anywhere by anyone." Oh, just before the cynics around here get started, btw, no I'm not pipe dreaming and trying to make the next WoW or Minecraft. I'm just futzing around for fun with something that I'll pass around to friends for our personal enjoyment.<br><br>As for UDP, I noticed shortly after responding to your first post, Rroff, that you mentioned a =&gt;200ms delay just for receiving new TCP streams. With that in mind, then yes, I should definitely get used to UDP. I'm going to need a lot of hand-holding to get started though, since I have absolutely NO idea what I'm doing with UDP, and the documentation for it is... Well, borderline nonexistent. So, here come some MORE questions:<br><br>How do I determine the non-dotted integer address of a machine I'm using for a server? My current testing rig is my own computer, which has a web URL provided via DynDNS to avoid problems with my global IP changing from time to time, which it of course does because it's a home internet connection, and security features from the ISP blah blah. How exactly am I supposed to get UDP to connect to something like that?<br><br>I gather that a UDP stream is prepared using <b>CreateUDPStream()</b> and then written to with the usual file/stream commands. When exactly should <b>CloseUDPStream</b> be used? Before sending? After? Only at client disconnection? <br><br></td></tr></table><br>
<a name="1107344"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Try taking a look at RottNet: <a href="http://www.rottbott-studios.com/rottnet.html" target="_blank">http://www.rottbott-studios.com/rottnet.html</a><br><br>It's a full network library implementing reliable and ordered packets built on top of UDP. I found it very easy to read and understand (except for why on Earth it sends all data as strings, which is unnecessary and wasteful to say the least). Good model to use as a base for building on top of UDP. <br><br></td></tr></table><br>
<a name="1107347"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Adam Novagen</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> ... God dammit Yasha, you make everything so damn one-stop simple. XD<br><br>Thanks a million for that, will check it out soon! <br><br></td></tr></table><br>
<a name="1107439"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Adam Novagen</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, RottNet certainly turned out to be God's gift to Blitz networking. While the code within the library itself is so extremely tight that it's a bit beyond my grasp, it's so damn easy to implement that I've already got the server working with a complete self-test procedure <i>and</i> outside connections (had a friend in Ohio test it out). This has made my life a lot easier.<br><br>Next step is linking to the file repositories. Since we're talking about downloading valuable game files before the game itself is actually in progress, I would assume <i>this</i> to be an obvious case for TCP usage. I have no idea what to send to the server, though. What does a web browser send out to nab the file dependencies of each webpage it encounters? <br><br></td></tr></table><br>
<a name="1107442"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Adam Novagen</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> ... DERP, never mind. That was actually incredibly simple. I just modified the <b>OpenTCPStream()</b> example to grab the little <b>german.gif</b> flag icon from this website (top-left corner). Worked like a charm, not an error in sight. Looks like linking to a <b>repo.zip</b> will be simple enough, I just have to tinker with some error-catching code. Blimey, this is exciting! :D <br><br></td></tr></table><br>
<a name="1107443"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rroff</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Do you have a way to handle zip in b3d? IIRC there are some userlibs for handling compressed files, I wrapped zlib.dll for my (fairly simple) useage (tho this is .gz not .zip). <br><br></td></tr></table><br>
<a name="1107447"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Adam Novagen</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> I do indeed; I use the ZIP API that's in the toolbox here. <a href="http://blitzbasic.com/toolbox/toolbox.php?tool=171" target="_blank">http://blitzbasic.com/toolbox/toolbox.php?tool=171</a> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
