<!DOCTYPE html><html lang="en" ><head ><title >VertexCoords performance issues</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >VertexCoords performance issues</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >VertexCoords performance issues</a><br><br>
<a name="346393"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Warren</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't really understand what's going on in my code so I figured I would throw this out here.<br><br>I've created a mesh to represent some terrain ... it's 128x128 quads.  So that's 32,768 triangles.<br><br>I have an interface written so that I can "draw" on this mesh and move its vertices up or down to create a heightmap.<br><br>I keep track of which vertices are changing each paint operation and I affect those vertices with the "VertexCoords" command.<br><br>My problem is that this is pretty sluggish on any heightmap over 32x32.  64x64 is chuggy and 128x128 is approaching unusable.  I'm only modifying 40-50 vertices per operation so I don't think that's asking too much.<br><br>Is there some "Lock" I should be doing before modifying the mesh?  Is there some way to store the mesh in different memory so it uploads faster each time I edit it?<br><br>Any other ideas?  I've optimized everything to use the fewest number of vertices possible, single surface, etc.<br><br>I don't see a way to make this any faster at the moment and that disturbs me. <br><br></td></tr></table><br>
<a name="346401"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> When I was working on my single surface stuff, I found VertexCoords prohibitively slow, and I found it much faster to free the surface and rebuild the mesh every frame. I know that's kinda ass-backwards, but it actually worked pretty well. Course this may vary wildly between machines and this is going back a few versions now so I really don't have a clue how it'll perform now. Worth a shot though, I'd think. <br><br></td></tr></table><br>
<a name="346406"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Warren</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Odd, but that actually does seem slightly faster.  That makes -no- sense to me.  Still kinda chuggy, but I'll take what I can get at this point... <br><br></td></tr></table><br>
<a name="346547"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Isn't there a vert limit of 64k per mesh/surface or something? If so, you must be working very close to the limit with a 128x128 mesh - that's alot of tris for a single mesh. This 'single surface is king' methodology is, apparently, only true to a certain extent when trying to optimize for speed. There's a point where actually using more surfaces is faster than stuffing everything into a single surface. I hear that 1500-2000 tris per surface is optimal. I think you might get a significant speed gain if split your 128x128 map accordingly. I guess this might be a bit tricky given the nature of what you're trying to achieve, though. <br><br></td></tr></table><br>
<a name="346550"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> The reaosn updating vertcies is slow is because in order to update the mesh Blitz has to re-send all the vertcies out to the 3D card when any vertex in the mesh is modified.  I presume that it caches these changes and makes them all at once, because there is no real speed difference between moving one vertex and moving 1000.  But if the mesh has 64K vertcies moving one vertex will be slower than if it has 10K vertcies.<br><br>So the solution to your problem is to divide your meshes up so they have fewer vertices.  This will cost you because of the extra surfaces though, so only do it if you're doing this because you really want to edit the meshes at runtime as the game is playing.  Of course you could do it in the level editor too so long as you recombine everything at the end. <br><br></td></tr></table><br>
<a name="346568"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Warren</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah, I think I am bumping against the surface limit - which I didn't know existed, so thanks for mentioning that.  That makes a lot of sense now as anything more than about 200x200 on the mesh size would crash Blitz with a generic error message.<br><br>I'm thinking that I'll split the heightmap up into multiple meshes.  Say, 32x32 sections ... that'll let me update each section quickly and the sections will get frustum culled which will help out my game due to the camera angle I'm intending to use.<br><br>*deep breath*<br><br>And now ... we rewrite the editor.  ;) <br><br></td></tr></table><br>
<a name="346668"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rob</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think Blitz could be doing more work with "surfaces"<br><br>I believe a modern engine should not need to worry about the concept of surfaces at all and group by texture, throw at the card, done.<br><br>I bet Mark does something like this though. <br><br></td></tr></table><br>
<a name="346703"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AntonyWells</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I bet he doesn't. Blitz is far too slow when using multiple surfaces with identical textures to be doing that.<br><br>He needs to do it. Pronto. (And if by some chance he had already...he needs to fix it.) <br><br></td></tr></table><br>
<a name="346728"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ashmantle</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Perhaps this has something to do with Immediate Mode or something? (I have no idea what I am talking about) <br><br></td></tr></table><br>
<a name="346773"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Warren</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Unless I miss my guess, the Blitz concept of a "surface" is simply "a group of polygons that share a common texture and rendering attributes".  So Mark is, in fact, enforcing good behavior by sending each surface as a batch to the video card.<br><br>There may be other problems in the code or something if it can't handle as much as it should, but on the surface (heh) it looks like his design is correct. <br><br></td></tr></table><br>
<a name="347690"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Abomination</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> ahem...<br>That is all very interesting; but if EpicBoy wants to update these smaller meshes, would You recommend to free the surface and rebuild the mesh, or use VertexCoords? <br><br></td></tr></table><br>
<a name="347737"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Warren</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> VertexCoords seems workable now that I've split the heightmap into smaller meshes.  It's still not screamingly fast, but it's a hell of a lot faster than when it was all one big mesh.<br><br>You can see it in action here...<br><br><a href="http://www.blitzbasic.com/logs/userlog.php?user=4761&amp;log=248" target="_blank">http://www.blitzbasic.com/logs/userlog.php?user=4761&amp;log=248</a> <br><br></td></tr></table><br>
<a name="348016"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rob</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> nice...<br><br>The concept of surfaces should be very transparent to the programmer though. Because we have different surfaces, we are forced to code through a lot of problems.<br><br>Removing the notion of surfaces will improve our development times. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
