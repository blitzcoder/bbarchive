<!DOCTYPE html><html lang="en" ><head ><title >Memory Usage just keeps on growing...</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Memory Usage just keeps on growing...</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Memory Usage just keeps on growing...</a><br><br>
<a name="495049"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Fry Crayola</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I just noticed this today. Half an hour ago.<br><br>As I said in my other thread, I've got a 2D GUI up and running. Just now I noticed that with every single button press, the memory used by the program (as seen in Task Manager) grows. By almost a megabyte.<br><br>I can't understand why. One whole MB? <br><br>Irritatingly, the code is long and complex and so I can't post it here. What that button does is store the current information to the relevant place in a memory bank, switch to a new type of information and refresh that and a search panel. I can't work out where an extra MB is coming into play, and I know without the code I can't expect much help...<br><br>But a few pointers or tips on what sort of thing to look out for would be great. <br><br></td></tr></table><br>
<a name="495058"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Your first port of call should be to add some debug code to count how many objects are in each of your Type collections.<br><br>If that doesn't turn up anything, then check that you aren't loading/copying images and forgetting to free them when you're done. <br><br></td></tr></table><br>
<a name="495102"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Fry Crayola</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> The second one would be the first thing I would think of, but earlier code doesn't have the megabyte problem (though it does rise about 10K each time) despite not having had...<br><br>Ah. Wait. You're probably (although that's better read as hopefully) spot on there. When I flicked from using Text commands to using bitmap fonts, that's a lot of new images created that definitely aren't being freed. I think.<br><br>They're all local variables for the image handles. I guess I presumed that when they're discarded at the end of a function (they are, aren't they?) the same would happen to the images. Foolish logic and it's better to make sure they're freed up.<br><br>Suddenly my day is twice as bright. <br><br></td></tr></table><br>
<a name="495154"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Beaker</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> In Blitz3D images (and other media, banks etc) are never free'd automagically. <br><br></td></tr></table><br>
<a name="495174"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Fry Crayola</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Automagically sounds cool.<br><br>Problem solved then. Each frame, every character has its own image. Sure, it's about 16x6, 24-bit colour making 288 bytes per character. It adds up over time, that's for sure.<br><br>I'll hopefully get that code changed tonight, let you know the findings. There's probably some other things that need cleaned up too. <br><br></td></tr></table><br>
<a name="495221"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Fry Crayola</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> That's it! Thanks guys, massive help there, really cheered me up.<br><br>When I added the following two lines to the GUI_text function (which displays text using a bitmap font):<br><br><pre class=code>
FreeImage charImage
FreeImage colourImage
</pre><br>instead of increasing the memory 1MB it increases about 30KB - due to other processes.<br><br>With those cleaned up, things will really be the way they should be. <br><br></td></tr></table><br>
<a name="495232"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> That's not my GUI system you're using is it?  If there's a bug in my system I'd like to know about it. :-) <br><br></td></tr></table><br>
<a name="495245"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Fry Crayola</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nah, I wrote it myself. Part of me likes to have control over that aspect, and it's a good learning experience. <br><br>In truth, it's not a bad GUI and can be easily ported to BlitzMax when the time is right. It just has a few bugs - this being a particularly serious one. There's a few other small issues - I can't cut and paste (I'd like to be able to from outside the program), you can't move the cursor in my edit boxes or highlight text, and scrollbars aren't perfect. But it's not bad for a beta. <br><br></td></tr></table><br>
<a name="495293"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Clarks</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> One other thing.  Dont forget that all blitz types are pointers so if you create one in a function thats just needed for the life of the function make sure and delete it.  Blitz types take up 20 or 24 bytes default. <br><br></td></tr></table><br>
<a name="495423"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Fry Crayola</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Good advice that. I never got too much time to tweak my code yesterday beyond the bitmap text function, but I was going to experiment with that. Some of my types would take up a quite hefty amount, in one case almost 1KB. <br><br>Just so I know, what about the standard types - integer, floating and string - do they get automatically deleted? I assume so, there appears to be no manual command for it. <br><br></td></tr></table><br>
<a name="495546"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Clarks</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> yes they do <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
