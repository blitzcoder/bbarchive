<!DOCTYPE html><html lang="en" ><head ><title >When tile-based worlds collide...</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >When tile-based worlds collide...</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >When tile-based worlds collide...</a><br><br>
<a name="936970"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Adam Novagen</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey all,<br><br>Okay, so I'm getting rather frustrated with my apparent ineptitude at programming collisions in a tile-based world. Here's the story:<br><br>I have a world engine which is based on tiles 50x50 pixels in size. The maps are stored in a 200 x 200 array, allowing up to 40,000 tiles per world. The movement within these tiled worlds, however, is free and pixel-based, which is to say, you're not confined to moving one square at a time. So, you could stop on the border between two tiles if you wanted to. The enemies move the same way, freely.<br><br>The player is laways at the center of the screen, while the map moves around them. I've used an RGB pixel-based collision routine here, and it works great. However, the enemies need to be able to move even while they're offscreen, which means that a pixel-based collision routine won't work; offscreen RGB values always return 0,0,0.<br><br>So, I've been trying to figure out some kind of formula or routine for the enemies, and failing miserably. Any ideas, anyone? <br><br></td></tr></table><br>
<a name="936974"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SoggyP</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello.<br><br>When offscreen do the enemies need the same level of collision detail as when on screen?<br><br>I tend to use a zonal collision system that deals with collisions in increasing levels of granularity.  Ie, I'll split my world into chunks and only do collisions against those that are in the same chunk.<br><br>I think Sswift did a posting that described the same methodology very well.  Perhaps have a look for that.<br><br>Goodbye. <br><br></td></tr></table><br>
<a name="936997"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Adam Novagen</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah, the enemies' collision routines need to retain the same degree of accuracy onscreen and off. <br><br></td></tr></table><br>
<a name="937002"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sledge</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Doing collision based on RGB is URK! Each entity should have world coordinates and from those world coordinates you can work out exactly which tile (or even which pixel of which tile) they're stood on and where to draw 'em relative to the "camera's" position.<br><br>If you really need to know which particular pixels in a tile can be collided with (rather than just the whole tile) then maintain a counterpart array for each tile and write the collision mask to it. You won't have the time overhead associated with reading pixels and the tile won't have to be on-screen to be read for collisions if you refer to the array instead. <br><br></td></tr></table><br>
<a name="937161"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wings</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> You ned to draw in ms paint like me<br><br><img src="http://www.tiberion.com/images/platform2d.jpg"> <br><br></td></tr></table><br>
<a name="937188"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Warner</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, I suppose your collision routine is based on the fact that a the part of the gameworld that the player collides with is allready drawn to the screen. That is not the case for the offscreen enemies. <br>You could adapt the routine so that enemies can also use the same system:<br>1. scroll the gameworld towards the enemy<br>2. Cls<br>3. draw the level to the screen<br>4. handle enemy collisions<br>5. Cls <br>6. scroll back to the mainplayer<br>7. draw the gameworld<br>8. handle player collisions<br>9. Flip. <br>But I can imagine it would become quite slow. Instead, you could maybe better use ImagesCollide for your collisions. That way, you can check the collisions between the enemy and a certain tile on a certain location. <br>You would need to identify all the tiles that the enemy would overlap after it's next move, in the way that Wings drawn out, and check if the enemy collides with them.<br>In the code archives I posted a tile engine you could check out. <br><br></td></tr></table><br>
<a name="937254"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Whenever a i did tile based games, i just checked to see whether the player/enemy was overlapping a new tile or not. If the new tile wasn't walkable, then move the player/enemy back to it's co-ords before it moved. <br><br></td></tr></table><br>
<a name="937306"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Adam Novagen</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah, me too, Ross... At least, that's the THEORY I'm working on. I can't seem to work out an accurate coordinate system for the enemies, though. The player is easy: always being center screen, it's just a question of dividing the map's X/Y coords by 50 (the tile size) and including an offset. However, since the enemies move relative to the map, which is relative to the player, I just can't get a successful coordinate formula going. T_T <br><br></td></tr></table><br>
<a name="937313"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sledge</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  since the enemies move relative to the map, which is relative to the player, I just can't get a successful coordinate formula going <br></div>I remember this problem well -- it comes from getting logic and rendering mixed up with one another (ideally your program should function without rendering anything). Like I mentioned, everything needs a world coordinate -- tiles, enemies, the player and even the <i>camera</i> (because having a concept of a camera is as useful in 2D as 3D). Once you've done that you render whatever you need relative to the camera's world x/y because every object already has its own world x/y relative to it. How a world x/y translates to the screen is up to you, but I tend to have the camera render a screen's worth of tiles to the right and below it, rather than conceptualise it as rendering centrally:<br><pre class=code>
|---------------|
|X              | 
|               | Camera's world x/y as screen 0,0
|               |
|---------------|

|---------------|
|               | 
|       X       | Camera's world x/y as screen gwidth/2,gheight/2
|               |
|---------------|
</pre> <br><br></td></tr></table><br>
<a name="937364"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Adam Novagen</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Guess what; I figured it out within five minutes of leaving this thread. After TWO MONTHS of grappling with the problem, I find that the solution is as simple as a division routine. A ONE-LINE division routine. I want to kick myself. &gt;_&lt;<br><br>Anyway, at least <i>Midnight Hacker</i> is back underway now. Thanks for the help guys! <br><br></td></tr></table><br>
<a name="937486"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wings</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> My engine is only data stored in array.<br><br>has nothing to realy do with screen.<br><br><br><br>the picture theory i draw above is the sollution for fast collision detection. its not pixel perfect. <br><br></td></tr></table><br>
<a name="937491"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sledge</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I find that the solution is as simple as a division routine. <br></div>Out of interest, what happens when the player is situated in a corner of the map and you no longer want him displayed at the centre of the screen? ;P <br><br></td></tr></table><br>
<a name="937614"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Adam Novagen</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nothing; the player is always centered. See, the map is a kind of hovering "cyberspace grid," and it has an animated background under it, so it doesn't matter if the edge appears or not, it still looks good &amp; natural. I'll post a screenshot sometime. <br><br></td></tr></table><br>
<a name="937649"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >smilertoo</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can do a walk zone, player is in the middle as long as the map is moving...then player moves towards edge. <br><br></td></tr></table><br>
<a name="937670"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >andy_mc</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Adam, are you wanting it to look like my platform game I'm working on here?:  <a href="http://www.youtube.com/amcadam26" target="_blank">http://www.youtube.com/amcadam26</a> <br><br></td></tr></table><br>
<a name="937706"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sledge</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I'll post a screenshot sometime. <br></div>Coolio.<br><br><div class="quote"> Adam, are you wanting it to look like my platform game I'm working on here? <br></div>Nice vids -- what did you capture them with? <br><br></td></tr></table><br>
<a name="938786"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wings</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> the A ONE-LINE division routine.  is the right path for fast 2d collisions in giantic maps even for the NPC :) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
