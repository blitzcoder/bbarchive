<!DOCTYPE html><html lang="en" ><head ><title >VWait not working?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >VWait not working?</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >VWait not working?</a><br><br>
<a name="586892"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm trying to use "VWait : Flip False" to sync my app with the monitor refresh but I'm still getting tearing!? This is probably a problem at my end because I'm sure it used to work, but can you please run this small bit of code and let me know if you see tearing too:<br><br><pre class=code>
	Graphics 800,600
	SetBuffer BackBuffer()

	While Not KeyHit(1)
		Cls
		
		Rect x,0,100,600,True
		x = x + 10
		If x &gt; 800 Then x = 0
		
		VWait : Flip False
	Wend

	End
</pre><br><br>Any suggestions as to why it's not working for me would be appreciated. As I understand it, it can't be a GFX card issue as using VWait makes the CPU wait for the VBlank signal, unlike Flip True. <br><br></td></tr></table><br>
<a name="586954"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Naughty Alien</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> ..smoth like silk here... <br><br></td></tr></table><br>
<a name="586958"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh, right - thanks. So, anybody know what might cause this to not work on my PC? <br><br></td></tr></table><br>
<a name="586998"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >(tu) ENAY</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> &gt; So, anybody know what might cause this to not work on my PC? <br><br>No. :)<br><br>INSERT COIN! <br><br></td></tr></table><br>
<a name="587051"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RFBcsa</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Using False the top of the bar scrolls a little behind the rest of the bar. If I use True the bar moves 100% correctly.<br><br>I assume this has something to do with the vsync so it wouldn't worry me much. My settings have vsync turned off. <br><br></td></tr></table><br>
<a name="587064"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Using False the top of the bar scrolls a little behind the rest of the bar. <br></div> That's the 'tearing' I'm getting. It shouldn't be happening. What are your system specs, RFBcsa?<br><br><div class="quote"> If I use True the bar moves 100% correctly. <br></div>So do I but I'm trying to find out why 'vwait:flip false' doesn't work anymore. :/ <br><br></td></tr></table><br>
<a name="587108"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> i get the same "tearing" its an optical illusion coz i tried print screening a few times and always the screen was fine. <br><br>but "flip" instead of "vwait:flip false" removed this "tearing". <br><br></td></tr></table><br>
<a name="587130"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KuRiX</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> The Vertical Sync Configuration can be overriden by the graphic driver.<br><br>Look in your driver settings that you have the vertical sync in the option: "controlled by application" or something like that... <br><br></td></tr></table><br>
<a name="587143"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> have i missed something here?<br><br>i tried switching v-sync on my card on/off for ogl + d3d but it always has the "tearing"<br><br>if it helps, heres a screen of the panels that have a v-sync option:<br>edit: "picture woz 'ere" <br><br></td></tr></table><br>
<a name="587153"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> i get the same "tearing" its an optical illusion coz i tried print screening a few times and always the screen was fine. <br></div>You can't take a screenshot of this effect because it's a mixture of two frames. :)<br><br>Fiddling with the vsync setting in my driver I can get rid of the tearing but the bars movement becomes really jerky. :/<br><br>Besides, I thought using 'vwait:flip false' isn't supposed to be affected by any driver settings - that's what the manual says and that's the reason I want to use it. I have no idea what's going on. :| <br><br></td></tr></table><br>
<a name="587155"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KuRiX</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Have you tried full screen modes? perhaps you cannot override driver setting in window mode... <br><br></td></tr></table><br>
<a name="587162"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yep, that demo code is in fullscreen (as long as debug is turned off). :)<br><br>I really can't understand what has happened as using this technique used to work great. I haven't upgraded my GFX driver or anything, either. <br><br></td></tr></table><br>
<a name="587274"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hujiklo</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> What is your frame rate? Is it slow?..there can be a big leap in frame rate with synch off which can lead to a jerky frame rate with it switched on. <br><br></td></tr></table><br>
<a name="587284"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Tearing on my machine too. GF4 Ti4200. Does this happen on other more complex programs? I haven't had a problem to date using Vwait : Flip False even though this example shows the problem. Maybethe fact it's running so fast makes for trouble???? <br><br></td></tr></table><br>
<a name="587338"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hujiklo: My monitor's frame rate is 60. This shouldn't be an issue though as VWait is simply meant to pause until a vertical blanking signal is received, regardless of monitor refresh rate.<br><br>Shifty: So you get the tearing but didn't used to, as well? I tried reverting back to an older version of blitz but the problem still exists. I just can't think why this isn't working anymore. I do still get this effect on larger programs but speed of loop execution shouldn't make any difference anyway. You can put a delay in the loop above and it still happens. <br><br></td></tr></table><br>
<a name="587410"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't get tearing (that I've noticed) in my ODE program using VWait. If I put in a delay 10 command in your example tearing is much reduced, but there are jitters where Blitz isn't sync'd with the refresh. Prior to this I never used Blitz so couldn't say! <br><br></td></tr></table><br>
<a name="587507"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Too weird! I'm also using a GF4 Ti4200, but NOT getting tearing. <br><br></td></tr></table><br>
<a name="587527"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Weird is right. :) I'm all out of ideas on this one. <br><br></td></tr></table><br>
<a name="587561"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> This whole sync thing is no longer an exact science. Some people told me Vsync didn't work on their machine. On my machine Flip doesn't wait anymore (flip true acts like flip false) but only after installing a new OS.<br><br>After all I came to the conclusion that it's best to measure the time that elapses, this should tell you if it works at all. When it's 50 Hz to say 120 Hz then there seens to be a working vsync. If the delay is almost zero, then you should try Flip true. If that is almost zero too then you're in troubles, but you still can use Millisecs to sync things "manually". <br><br></td></tr></table><br>
<a name="587563"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, as I said, my monitor is using a 60Hz refresh rate but it's not working - it used to, though. I can use Flip True to sync to the monitor refresh but this can be disabled in the driver so isn't a guaranteed method.<br><br>I can use a timer to guarantee 60FPS but this doesn't get around the problem of tearing. For scrolling etc., it looks horrible. :/<br><br>[edit] Thinking about it, vwait MUST BE working in a way - if it wasn't then the bar (in my demo) would move across the screen as quickly as possible. However, by the time the flip command is executed, the monitor has already started re-scanning the display. There seems to be some delay between the v-blank signal being received and the execution of Flip. Maybe the problem's with the Flip command, then? <br><br></td></tr></table><br>
<a name="587575"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> OK, I just managed to get rid of the tearing...<br><br>I shut down all non-essential background tasks - virus scanner, firewall etc. - and the smooth scrolling returned! <br><br>So, it would seem the problem is other background tasks are grabbing the CPU right between the 'VWait' and the 'Flip False' commands. By the time the blitz app regains control, the v-blank signal has long past and the monitor has already started re-scanning.<br><br>I can't really think of a way to prevent this from happening, though. It would be nice to have a 'VFlip' command that combines the two and doesn't relinquish the CPU to other processes until it's fully executed. <br><br></td></tr></table><br>
<a name="588482"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> ha! Vertical Blank Interrupts! This sounds so very 68000ish. Remember the times when we altered the 10 Bit Palette in  VBlank Interrupts only to get a few more than 16 Colors onscreen! Coding bloody asm interrupts for a hand full of colors.<br>Hmm - this kind of surprises me, wasn't it the way there ain't no proper VBlank Interrupts on x86 machines, because they need to be polled? Well maybe I'm wrong. But I remember the developer of the MenuetOS asked me(!) how to implement a VBlank Hardware Interrupt on the x86. Seems like it's not as easy as on a Atari ST...<br><br>oops, back on topic.<br><br>EDIT - uh, wait a minute, that palette interrupt used the horizontal blank interrupt. Color cycling used the vertical. <br><br></td></tr></table><br>
<a name="588760"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Trixx</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can simulate vwait using scanline().<br>Just a quick dirty example,put this instead of vwait:flip false :<br><br>Delay 5<br>Repeat: Until ScanLine()&gt;=0 And ScanLine()&lt;20 Or ScanLine()&gt;600<br>Flip False<br><br>This removes tearing on my machine. If yours is much faster, try increasing delay value, or decreasing that "&lt;20" . However, for perfect results on every machine, you should take into account time elapsed for the delay value, and also screen resolution.  <br>Tell me if this removes tearing ... <br><br></td></tr></table><br>
<a name="589036"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> Trixx: That does reduce the tearing considerably but not completely. Also, the bar still scrolls with frequent jerks. The problem is that other processes can take control of the CPU between the 'repeat:until' and 'flip false', thus we have the same problem as with 'vwait:flip false'.<br><br>TBH, I'm a bit confused as to why other processes can grab the CPU so much - I thought Blitz3D apps hogged 100% of CPU time, pretty much!?<br><br>BTW, you can actually dispense with the delay command by using the following method instead:<br><pre class=code>
Repeat: Until ScanLine() &gt; 600
Flip False
Repeat: Until ScanLine() &lt; 600
</pre> <br><br></td></tr></table><br>
<a name="589176"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Trixx</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> It is normal that other processes can "take control" anytime, because you can't reserve CPU just for yourself. And because of that, you should free some CPU time and power with Delay command, so other processes can finish their job. This way, it is less likely that they will interrupt you on "flip false". <br>As I said, for this to work perfect, you should calculate time for the next frame and use " delay timeRemaining" before "flip false". <br>Compare 'CPU usage' between my example and yours. If you use " Repeat: Until ScanLine() &gt; 600 " , you are using 100% of the CPU, and then other processes will still fight for some CPU time immediately after that, i.e. just when you need to 'flip' . So, give them enough time to finish their job and everything should be fine. <br>Using "delay timeRemaining" B3D will use, let's say 20-40% of the CPU ( depends on system and your game of course ), and this practice is much better than standard 100% which we can see in majority of B3D games! <br><br></td></tr></table><br>
<a name="589197"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sledge</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>So, it would seem the problem is other background tasks are grabbing the CPU right between the 'VWait' and the 'Flip False' commands...I can't really think of a way to prevent this from happening, though.<br> <br></div><br><br>You could up the priority of the app'. Perturbatio wrote an app' launcher for me a few years ago to do this, perhaps he still has it (or the C source) knocking around. I'll have a look and see if I can find it.<br><br>EDIT: <i>However</i>, having just done some quick experimentation (because I get the same problem on my Ti4200), Trixx's Delay advice looks good. <br><br></td></tr></table><br>
<a name="589290"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> Which'll be why my addition of a Delay was helping earlier on. Nice info. Thanks. <br><br></td></tr></table><br>
<a name="589358"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> OK, I see what you're getting at now, Trixx - I really shouldn't read posts when I've had a few beers. :)<br><br>Anyway, things are much improved if I use the following code, but still not perfect (occasional slight tearing and jerking):<br><pre class=code>
	Graphics 800,600
	SetBuffer BackBuffer()

	While Not KeyHit(1)
		frame_start = MilliSecs()

		Cls
		Rect x,0,100,600,True
		x = x + 10
		If x &gt; 800 Then x = 0
		
		frame_time = MilliSecs() - frame_start	

		If frame_time &lt; 10 Then Delay (10 - frame_time)
		Repeat: Until (ScanLine()&gt;=0 And ScanLine()&lt;20) Or ScanLine()&gt;600
		Flip False
	Wend

	End
</pre><br>However, I still don't understand the need for the scanline polling - that's <i>essentially</i> what VWait does anyway. If you change the repeat:until line in the above code with VWait, it works just as well.<br><br>Also, the way I'm calculating the delay is pretty rough-and-ready. Is there a better way? <br><br></td></tr></table><br>
<a name="589641"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Trixx</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> big10p, there are more than 600 scanlines in 800x600. I'm not sure about the exact number, but I think there are 624 of them and they are not all visible, i.e. let's say first 12 and last 12 are not really visible on your monitor.(I'm really not sure about these numbers) . VWait will wait until last scanline is 'drawn' on screen, but in this example you are 'flipping' a little bit earlier ( anywhere after 600'th line ) and this gives you better chance to flip on time than vwait. <br>Here is corrected version of your last example:<br><pre class=code>
Graphics 800,600
	SetBuffer BackBuffer()
	
	Const TargetFPS=85 
	timePerFrame = 1000/TargetFPS
	
	While Not KeyHit(1)
		frame_start = MilliSecs()

		Cls
		Rect x,0,100,600,True
		x = x + 10
		If x &gt; 800 Then x = 0
		
		usedTime  = MilliSecs() - frame_start
		remaining = timePerFrame - usedTime
		If remaining &gt; 0 Then 
			Delay(remaining)
		End If
		Repeat: Until ScanLine()&gt;=0 And ScanLine()&lt;30 Or ScanLine()&gt;600
		Flip False
	Wend
End
</pre><br>Also, I forgot to tell you why you need that " If Scanline()&gt;=0 And ScanLine()&lt;30) ...  Take this example : On some slower machine, when logic+rendertime finish just 1ms later than it's needed to be on time , Scanline will already pass 624, and will be probably between 0-30. But, this is still not too late to flip, especially if top of the screen is static picture, like in my current project.  If you use vwait, you would lose that frame, because vwait will wait for scanline to became 624 again, and you will end up with less FPS. On very slow machine, however, this won't help, but you can always experiment with these values, depending of your game. Obviously, this should go in combination with tweening. ( Delta time should be fine also ). <br><br></td></tr></table><br>
<a name="589833"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> Trixx: I see what you're trying to do with the scanline polling but I don't think it makes much difference from using VWait, TBH - I still get a bit of tearing and jerking. Also, changing the FPS in the code you posted to 60 (which is what I want - my monitor refresh is 60Hz, too), the tearing and jerking is really bad.<br><br>I think I'm just going to have to come to some compromise and admit I'm not going to get rid of the tearing and jerking completely. Thanks for your input though - it's been interesting. :) <br><br></td></tr></table><br>
<a name="602961"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> Your original code is very smooth on mind BUT the occasional flicker occurs at the top of the bar. <br><br></td></tr></table><br>
<a name="603340"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Boulderdash</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#32">[#32]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks I tried using delay 1 until the right amount of time elapsed (16 millisecs) and things ran smoother, CPU usage showed 2 or 3% drop while still connected to internet. <br><br></td></tr></table><br>
<a name="603346"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Boulderdash</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#33">[#33]</a></td></tr></table></td></tr><tr ><td class="posttext"> I tried this to keep my emulator at 60fps and it worked great! a small drop in CPU usage is a plus.Thanks for the tip!<br><br>timer#=MilliSecs()<br>f=timer#-oldtimer#<br>f=16-f<br>If f&gt;0 Then Delay f<br>oldtimer#=timer# <br><br></td></tr></table><br>
<a name="603348"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#34">[#34]</a></td></tr></table></td></tr><tr ><td class="posttext"> I didn't read the whole thread, so maybe it was already said: Whatever you do, you can never be sure wether Flip 1 or Vwait:Flip 0 will work on all machines. If you want your game as compatible as possibe, you need to determine how a machine handles them and then use a custom sync method (this is really a FAQ now).<br><br>First check how much time elapses between two vwaits. If it's near zero then it's likely vwait is not working as desired. So you should try to use Flip 1 instead. Test the time that elapses between 2 Flip 1 Calls. If this is near zero too, you need to use a special timing method, using millisecs, or scanline as it was mentioned before.<br><br>Basicly you need to replace all your FLIP Calls with something like MyFlip()<br><br>and a function MyFlip would look like this:<br><br><pre class=code>
global FlipCounter ; is used to determine the current
;Frontbuffer (see tutorial section, hidden alerts)

global FlipMode ; this is set by the determination 
;described before, eg. 0 for vwait, 1 for flip true, 2 
;for millisecs solution.

global FlipTimer ; used for the millisecs solution
global FlipRate=17 ; used for millisecs solution
;...

function MyFlip(waitsync=1)
FlipCounter=FlipCounter xor 1
 if flipmode=0
  if waitsync&lt;&gt;0 then vwait
  flip 0
 endif
 if flipmode=1
  flip waitsync
 endif
 if flipmode=2
  if waitsync&lt;&gt;0
  while millisecs()&lt; FlipTimer
   delay 1
  wend
  flip 0
  FlipTimer=millisecs()+FlipRate
  endif
 endif
end function
</pre><br>This may be not fully perfect of course. I only want to show you, you need to catch sync troubles and handle them individually. <br><br></td></tr></table><br>
<a name="603481"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#35">[#35]</a></td></tr></table></td></tr><tr ><td class="posttext"> jfk:<br><br>I've not heard of a machine where VWait doesn't work (i.e. pause until a vblank signal is received). Does this happen with TFT screens, or something?<br><br>Also, in your code above, why have you got the VWait after the Flip, and not before it? <br><br></td></tr></table><br>
<a name="603596"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VP</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#36">[#36]</a></td></tr></table></td></tr><tr ><td class="posttext"> Certain gfx drivers will disable vsnc'ing as part of their neverending 'we get faster FPS than the competition' battle. /Rather, I should say they provide an <i>option</i> to disable vsync.<br><br>What is wrong with just plain old Flip? Does that really not work on all machines? I've never put the vwait in, unless I'm not using double buffering (rare). <br><br></td></tr></table><br>
<a name="603653"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#37">[#37]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sure, you can turn off vsyncing on the GFX card, but VWait let's the CPU handle the signal, which I don't see how you could turn off or wouldn't work on ALL machines.<br><br>From the docs:<br><div class="quote"> Note that this command is different to the vertical blank waiting mechanism in Flip because Flip will cause the graphics card (as opposed to the CPU) to wait for the next vertical blank. The vertical blank can be disabled on some graphics cards, hence it is quite common to use "VWait : Flip False" to ensure consistent updates on all setups. <br> <br></div> <br><br></td></tr></table><br>
<a name="603957"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VP</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#38">[#38]</a></td></tr></table></td></tr><tr ><td class="posttext"> The CPU can only check what the gfx card, therefore the gfx driver, tells it. <br><br></td></tr></table><br>
<a name="603976"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#39">[#39]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm pretty sure the vertical blank is a non-maskable hardware signal that has nothing to do with the driver. Again, the docs seems to suggest this, too:<br><div class="quote"> The vertical blank can be disabled on some graphics cards, hence it is quite common to use "VWait : Flip False" to <b>ensure consistent updates on all setups</b>. <br></div> <br><br></td></tr></table><br>
<a name="604045"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#40">[#40]</a></td></tr></table></td></tr><tr ><td class="posttext"> sorry, I ment vwait:flip 0, of course.<br><br>AFAIK unlike eg. the Atari ST that had a VBlank Hardware Interupt, in the X86 Architecture the CPU has to poll a Vsync Signal and then trigger an interrupt, Of course this can be turned off easily. Sometimes it's even hard not to miss the signal. Maybe this is diffrent on modern machines, but I think it really used to be this way.<br><br>The reason why someone would like to use Wvait:Flip 0 instead of Flip 1 is:<br>-Flip 1 is not synchronized with the Monitor Refresh rate, so Vwait will give a smoother gameplay.<br>-On some machines Flip 1 doesn't wait at all, but continues immediately, like Flip 0.<br><br>BTW I have never seen a machine that didn't support vwait, but some Blitz users told me about that. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
