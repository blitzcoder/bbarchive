<!DOCTYPE html><html lang="en" ><head ><title >Findong out which way a triangle is pointing</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Findong out which way a triangle is pointing</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Findong out which way a triangle is pointing</a><br><br>
<a name="742190"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gburgess</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is one of those questions that I think everyone knows the answer to except me. I'm currently looking into doing dynamic damage effects for spaceships, and I've decided on a method. If it works out, you all get free screenshots ;)<br><br>So, I'm going to be removing triangles from spaceship meshes (I hope...) but before I do I'd like to generate some debris as though part of the hull is being "blasted out". To do that, I'll need to know which direction to throw debris in.<br><br>I guess I can start with the centrepoint of the triangle, which will be the average of it's three vertices, right? Okay, then. Now I need to know what direction to throw the debris in. Is there some way I can get that, maybe in the form of a vector?<br><br>EDIT: Oops, comedy "dong" reference in the thread title. Apparently can't change it with the edit function so you're all stuck with it. This is just to let you know that. And to let you know that I know. So now you know that I know, and I know that you know that I know. <br><br></td></tr></table><br>
<a name="742201"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> <pre class=code>
e0x# = v3x# - v2x#
e0y# = v3y# - v2y#
e0z# = v3z# - v2z#
e1x# = v2x# - v1x#
e1y# = v2y# - v1y#
e1z# = v2z# - v1z#

normal_x# = (e0y# * e1z# - e0z# * e1y#)
normal_y# = (v1y# - light_y#) * (e0z# * e1x# - e0x# * e1z#)
normal_z# = (v1z# - light_z#) * (e0x# * e1y# - e0y# * e1x#)</pre><br><br>v1x v1y v1z, v2x v2y... are the triangle coordinates.<br>nx ny nz are the normals.<br><br>also for some uses you need to normalize it. that means to make the vector exact 1 meter long.<br><br><pre class=code>do# = sqr(nx#^2+ny#^2+nz#^2)
nx#=nx#/do#
ny#=ny#/do#
nz#=nz#/do#</pre> <br><br></td></tr></table><br>
<a name="742225"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Also, you may be able to hack something useful out of this code:<br><br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=680" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=680</a> <br><br></td></tr></table><br>
<a name="742240"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> that source code is too long to be understood.<br><br>what you need is a particle engine<br><a href="http://www.blitzbasic.com/toolbox/toolbox.php?tool=174" target="_blank">http://www.blitzbasic.com/toolbox/toolbox.php?tool=174</a> <br><br></td></tr></table><br>
<a name="742245"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ricky Smith</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> One "easy" way is to use linepicks or camerapicks for your "shots" and just use the PickedNX#(),PickedNY#() and PickedNZ#() functions to get the normals of the picked tri. <br><br></td></tr></table><br>
<a name="742253"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>So, I'm going to be removing triangles from spaceship meshes (I hope...) but before I do I'd like to generate some debris as though part of the hull is being "blasted out". To do that, I'll need to know which direction to throw debris in.<br> <br></div><br><br>To remove a single triangle you need to rebuild the whole mesh and omit said triangle so it could be very slow.  <br><br>I'd recommend using a particle engine ( not necessarily devils as there are loads about ).  The general idea would be to create an emitter at the point of contact, align it to the contact normal vector and spew some particles from the emitter.<br><br>How are you determining which triangle you've hit in the first place?<br><br>Stevie <br><br></td></tr></table><br>
<a name="742266"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> actually, i dont see the reason why you sould use triangle explosion...<br>use a particle system! <br><br></td></tr></table><br>
<a name="742454"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gburgess</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay, just to be clear:<br><br>I have a perfectly good particle system, creating explosions in the right areas. However, yesterday I was inspired by this screen shot:<br><br><a href="http://fileanchor.com/84119.jpeg" target="_blank">http://fileanchor.com/84119.jpeg</a><br><br>Specifically, the ship near the bottom with the holes, and I suddenly realised how it was done. Should've occurred to me sooner, having played Bridge Commander years ago, but there you go.<br><br>Since my initial post in this thread, I've written the code that turns polygons progressively darker, the more damage they take. Ones that turn black completely are them removed. The black vertexes left behind on the adjacent polys will then create the scorch effect seen in the screenshot.<br><br>I've got all this working just fine now.<br><br>However, I was wondering about attaching firey particle-emitters to the areas that had been blasted away, and possibly some debris to go with the initial removal of polys. And, for this, I need to know where the middle of a given poly lies.<br><br>Thanks for all the advice, guys. I have, however, just got one question which should help me understand a lot of it:<br><br>What's a normal? <br><br></td></tr></table><br>
<a name="742472"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> A normal is a vector which is perpendicular to a plane. So in the case of polygons in 3d models a normal is a vector which is perpendicular to a particular triangle.  Usually the normal is 'normalised' to be length '1' (ie a unit vector). <br><br></td></tr></table><br>
<a name="742481"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gburgess</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ah, right. So I'm basically looking for the normal of a given poly, then? Hmm, I'm surprised there's no built-in command for that in Blitz3D.<br><br>Oh well, thanks for the info, guys! <br><br></td></tr></table><br>
<a name="742484"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well there kind of is. Each vertex has a normal, so I guess you could retrieve the vertex normal of each of the three vertices and average it for a poly normal? Would that work?<br><br>Check out VertexNX() VertexNY() and VertexNZ() in the docs, I think. Sorry I can't be more specific, but I don't have B3D installed at the moment and my CD appears to have died on me. <br><br></td></tr></table><br>
<a name="742487"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gburgess</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ahh, yes, I saw those yesterday. Right, that sounds like it should works. Thanks! <br><br></td></tr></table><br>
<a name="742490"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Well there kind of is. Each vertex has a normal, so I guess you could retrieve the vertex normal of each of the three vertices and average it for a poly normal? Would that work? <br></div> No, unfortunately. Since vert normals are smoothed between all connected tris, these normals could feasibly be pointing in just about any direction.<br><br>[edit] <br><br></td></tr></table><br>
<a name="742505"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gburgess</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh, okay. <br><br></td></tr></table><br>
<a name="742513"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just use the cross product method to calc surface normals, as shown in this code:<br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=976" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=976</a> <br><br></td></tr></table><br>
<a name="742514"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gburgess</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh I wish I had a better grasp on maths. I dunno what other people read, but all I saw was:<br><br>"Just use the BLLEEAAAUUGGGHHHHHH to calc surface normals"<br><br>Seriously, that code seems much longer than what Devil posted near the top. This one also seems to calculate stuff for an entire mesh. Are either of the two examples better in any way? <br><br></td></tr></table><br>
<a name="742527"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Heh, don't worry about the math - you don't need to know how it works, just that it does work. :)<br><br>OK, I've chopped the code down into a simple function to calculate the surface normal of a triangle:<br><pre class=code>
Global result_nx#, result_ny#, result_nz#

; Given the 3 vertex positions of a triangle, this function calculates
; the surface normal of the defined triangle, and returns the result via
; the global variables result_nx#, result_ny# and result_nz#.
; Note that the 3 vertex positions must be supplied to this function in
; clockwise order to get the correct result.
Function calc_surf_normal(v0x#,v0y#,v0z#, v1x#,v1y#,v1z#, v2x#,v2y#,v2z#)

	; Get the vectors for two edges of the triangle.
	vec1x# = v0x# - v1x#
	vec1y# = v0y# - v1y#
	vec1z# = v0z# - v1z#
	
	vec2x# = v1x# - v2x#
	vec2y# = v1y# - v2y#
	vec2z# = v1z# - v2z#
	
	; Compute their cross product.
	x# = vec1y# * vec2z# - vec1z# * vec2y#
	y# = vec1z# * vec2x# - vec1x# * vec2z#
	z# = vec1x# * vec2y# - vec1y# * vec2x#

	; Normalize vector.
	l# = Sqr(x# * x# + y# * y# + z# * z#)
	
	result_nx# = x# / l#
	result_ny# = y# / l#
	result_nz# = z# / l#

End Function
</pre><br><br>I haven't tested this but it should work (famous last words). <br><br></td></tr></table><br>
<a name="742530"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gburgess</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> You're a hero. I won't be able to try it until next week, because I'm travelling to Ireland to fix my aunt's computer. I kid you not.<br><br>Thanks again! <br><br></td></tr></table><br>
<a name="742535"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> No problem, but save the thanks until you get back and can confirm it works! :p <br><br></td></tr></table><br>
<a name="742538"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> big10p: i already posted one:<br><br><div class="quote"> e0x# = v3x# - v2x#<br>e0y# = v3y# - v2y#<br>e0z# = v3z# - v2z#<br>e1x# = v2x# - v1x#<br>e1y# = v2y# - v1y#<br>e1z# = v2z# - v1z#<br><br>normal_x# = (e0y# * e1z# - e0z# * e1y#)<br>normal_y# = (v1y# - light_y#) * (e0z# * e1x# - e0x# * e1z#)<br>normal_z# = (v1z# - light_z#) * (e0x# * e1y# - e0y# * e1x#)<br><br><br><br>v1x v1y v1z, v2x v2y... are the triangle coordinates.<br>nx ny nz are the normals.<br><br>also for some uses you need to normalize it. that means to make the vector exact 1 meter long.<br><br>do# = sqr(nx#^2+ny#^2+nz#^2)<br>nx#=nx#/do#<br>ny#=ny#/do#<br>nz#=nz#/do# <br></div> <br><br></td></tr></table><br>
<a name="742541"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> That's not a function.<br><br>Also, I have no idea what's going on here:<br><div class="quote"> <br>normal_x# = (e0y# * e1z# - e0z# * e1y#)<br>normal_y# = (v1y# - light_y#) * (e0z# * e1x# - e0x# * e1z#)<br>normal_z# = (v1z# - light_z#) * (e0x# * e1y# - e0y# * e1x#)<br> <br></div> <br><br></td></tr></table><br>
<a name="742587"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>Also, I have no idea what's going on here:<br><br><br>normal_x# = (e0y# * e1z# - e0z# * e1y#)<br>normal_y# = (v1y# - light_y#) * (e0z# * e1x# - e0x# * e1z#)<br>normal_z# = (v1z# - light_z#) * (e0x# * e1y# - e0y# * e1x#)<br><br><br> <br></div><br><br>Agree, that light x/y stuff will have no bearing on the calculated normal so it makes no sense, even if the cross product portion is correct.<br><br>Stevie <br><br></td></tr></table><br>
<a name="742592"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> No, unfortunately. Since vert normals are smoothed between all connected tris, these normals could feasibly be pointing in just about any direction.<br> <br></div><br>I realise that, but they can't be pointing in "just about any direction" as they are only joined to triangles with which they share a smoothing group. Thus they are already being lit to smooth across that join and I would argue that the averaged normal is a closer approximation of the direction the surface *appears* to be facing than the true normal of the triangle. <br><br></td></tr></table><br>
<a name="742601"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I realise that, but they can't be pointing in "just about any direction" as they are only joined to triangles with which they share a smoothing group. Thus they are already being lit to smooth across that join and I would argue that the averaged normal is a closer approximation of the direction the surface *appears* to be facing than the true normal of the triangle. <br></div>OK, I admit saying "just about any direction" was overstating things a bit, but I simply assumed Glenny-boy wanted the 'true' direction of the tri. I'm still sceptical that averaging normals will work in any meaningful way. I'm prepared to be proved wrong, though. :) <br><br></td></tr></table><br>
<a name="742670"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> oh sorry, i forgot to take that light x/y by stealing the code from my shadow system :o <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
