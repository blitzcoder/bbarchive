<!DOCTYPE html><html lang="en" ><head ><title >FreeEntity and FreeTexture problems</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >FreeEntity and FreeTexture problems</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >FreeEntity and FreeTexture problems</a><br><br>
<a name="462283"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dock</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm having a bit of trouble with sswift's shadow system at the moment.  However, I have managed to track down what the problem is, and I'd really appreciate it if someone could help me fix the bug.  <br><br>The bug is, basically, that is crashes on the THIRD time it tries to update the static shadows.  I tested it, and yes - the first two times it is okay, but the third it gives errors of "Entity does not exist". <br><br><pre class=code>	; Delete all the static shadow meshes.
	For ThisShadow.Static_Shadow = Each Static_Shadow
		FreeEntity ThisShadow\Mesh
	Next

	; Delete all the static shadow textures.
	For ThisTexture.Static_Shadow_Texture = Each Static_Shadow_Texture
		FreeTexture ThisTexture\Texture
	Next </pre><br>Initially it is "FreeEntity ThisShadow\Mesh" that crashes, whereas if I comment it out, it crashes on "FreeTexture ThisTexture\Texture".  If I comment both of them out, then the shadows just get darker and darker each time, as new shadows are created without killing the old ones.  <br><br>Does anyone have any idea why it would choke on FreeEntity?  I even tried this:<br><pre class=code>"If ThisShadow\Mesh Then FreeEntity ThisShadow\Mesh"</pre><br>It runs the line, and then crashes.  Surely this is checking that the entity exists before it tries to free it, so it seems strange that it crashes. <br><br>Help? <br><br></td></tr></table><br>
<a name="462291"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Surely this is checking that the entity exists before it tries to free it <br></div>No.  FreeEntity does not reset the pointer to 0.  All you're doing is checking if the pointer is true (non-zero) or false (zero).  It will always return true unless you do 'ThisShadow\Mesh = 0' after FreeEntity.<br><br>I'm sure EntityClass could be 'fixed' so it returns a specific value for a non-existent entity instead of throwing a runtime error. <br><br></td></tr></table><br>
<a name="462303"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dock</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Gfk - wow, you're right! <br>All I needed to do was add "ThisShadow\Mesh = 0" (and the same for texture), and it fixed the function entirely.  I should probably email Mr Swift. <br><br>Thanks a lot, this has been causing me trouble for days! :D <br><br></td></tr></table><br>
<a name="462314"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Knotz</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> From me, my collegues, family, cats and hamsters: Thanks! <br><br></td></tr></table><br>
<a name="462366"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey!<br><br>I think you did in fact find a bug, but I don't think the problem here is that mesh is not being set to 0.  Setting it to 0 might stop the crashing, but it won't fix the actual bug.<br><br>The actual bug here is that after I free the mesh and the texture, I failed to delete the type that was containing it.  That means that the next time you update, the leftover types, which should no longer exist, are pointing to memory locations that no longer contain meshes.  <br><br>So the problem is not that the types point to meshes that no longer exist, but that the types themselves still exist.<br><br>This modification should fix the problem:<br><br><pre class=code>
	; Delete all the static shadow meshes.
	For ThisShadow.Static_Shadow = Each Static_Shadow
		FreeEntity ThisShadow\Mesh
		Delete ThisShadow
	Next

	; Delete all the static shadow textures.
	For ThisTexture.Static_Shadow_Texture = Each Static_Shadow_Texture
		FreeTexture ThisTexture\Texture
		Delete ThisTexture
	Next 	
</pre><br><br>Unless deleting a type element inside a loop that is looping through that type causes the loop to exit prematurely that is...  I hope that is not the case. <br><br></td></tr></table><br>
<a name="462367"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Knotz:<br>Were you having problems with this too? <br><br></td></tr></table><br>
<a name="462414"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rottbott</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sswift, no it doesn't mess up the loop. This is valid code:<br><br>For A.Thing = Each Thing<br>Delete A<br>Next<br><br>It does exactly the same as Delete Each Thing. <br><br></td></tr></table><br>
<a name="462510"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Knotz</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> @swift<br>No not yet, i just started to use your last system today. Sofar i didn't do any testing. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
