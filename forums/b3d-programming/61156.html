<!DOCTYPE html><html lang="en" ><head ><title >reading z buffer</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >reading z buffer</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >reading z buffer</a><br><br>
<a name="682890"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >b32</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is is possible to read the z buffer after RenderWorld() other than using CameraPick ? <br><br></td></tr></table><br>
<a name="682937"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DareDevil</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> no!<br>:( <br><br></td></tr></table><br>
<a name="682939"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >fredborg</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can make all your entities black and then render with white fog (or vice-versa). That will give you a low quality z-buffer. <br><br></td></tr></table><br>
<a name="682999"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >b32</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ah, okay I will try that, thanks.<br>I've read this topic:<br><a href="http://www.blitzbasic.com/Community/posts.php?topic=30568" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=30568</a><br>And it made me curious how to search through the blitz allocated memory. I know there is a command rtlmovememory in a dll and you can move to and from banks. I'm just confused about where to find Blitz's memory.<br><br>Would it be possible the create a new ZBuffer yourself and then reading from that ZBuffer instead of the Blitz's? <br><br></td></tr></table><br>
<a name="683145"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't know if it's blitz that creates the z-buffer. I'm sure it's the graphics card that creates that. Could be wrong though :o) <br><br></td></tr></table><br>
<a name="683182"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I am pretty sure too it's the graphics card that is managing  it (well the drivers and probably directx).<br><br>To be honest I am not sure if the video ram is mapped in the 32 Bit adress space at all, is it? But, no matter how it's mapped, whenever you access ram that is located in the Vram, your machine has to go the long way, take the bus to the other coast so to say, that's why Vram access is very slow. I tried to fool Blitz in bending the data pointer of a bank to an image, but the access was slow as Readpixelfast, where true Bank access is quick. accessing textels of mipmapped textures is even slower, that's why the flag 256 may speed things up a little.<br><br>Well that's sligthly off topic. I think you could access the zbuffer if you knew where it is. Probably there are some ways with userlib to optain this adress. <br><br></td></tr></table><br>
<a name="683201"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >b32</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I tried the bufferimage functions you pointed out the last time, they were very interesting, thanks again. <br>Finally, I wrote a DLL that writes to an ImageBuffer. <br>Reading from an Imagebuffer is slow, however writing to it is fast. Maybe a graphic card is optimized for uploading data?<br><br>I used this technique to write a scaleimage .DLL, it is here: <a href="http://www.codersworkshop.com/viewshowcase.php?id=911" target="_blank">http://www.codersworkshop.com/viewshowcase.php?id=911</a><br><br>I think the zbuffer is a DirectDrawSurface:<br><a href="http://externalweb.exhedra.com/DirectX4VB/Tutorials/DirectX7/IM_ZBuffer.asp" target="_blank">http://externalweb.exhedra.com/DirectX4VB/Tutorials/DirectX7/IM_ZBuffer.asp</a><br>And I think the frontbuffer and backbuffer are ddsurfaces as well. Indeed they have a fair chance of being on the VRAM, unless you have an old graphic card.<br><br>Now if the ZBuffer is a surface, would it be possible to replace it with an ImageBuffer ? <br><br></td></tr></table><br>
<a name="683232"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have no idea. I guess Tom wold know that, and some other DirectX front experienced. <br><br></td></tr></table><br>
<a name="683295"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tom</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> ZBuffers don't store RGB information, they store floats, I don't know if that info can be quickly retrieved in DX.<br><br>FYI, I'm sure there's a function to do it in GL, just not DX unfortunately. <br><br></td></tr></table><br>
<a name="683376"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> well in theory you could try to hack this structure. I'd do the following, wich is completely unprofessional, of course:<br><br>use Linepick to determine the Z-Depth of a number of pixels, eg. one line of the screen and store the depths in an array.<br><br>Then calculate the realtions between them and eg. the very first pixels depth.<br><br>Then scan the memory of the vram for a sequence of relations that are very similar or exactly the same as you have detemined with Linepick. If you once got this adress, you may scan the memory for pointers, using this adress as a value. Probably you are able to find out if there is a certain static offset to a handle that is returned by one of the dx7 surface commands.<br><br>BTW the RTLMoveMemory call doesn't work the same in winXP and win9x. In XP access may be limited to nonprotected areas. <br><br></td></tr></table><br>
<a name="684284"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >b32</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the help! I think I made some progress, I copy the content of the attached surface (zbuffer) to the main surface (backbuffer), and it looks like this:<br><img src="http://members.home.nl/bramdenhond/strange.JPG"><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Graphics3D 800,600,32,2
SetBuffer BackBuffer()

Direct3DDevice7=SystemProperty$("Direct3DDevice7")

;create camera
cam = CreateCamera()
PositionEntity cam, 0, 0, -4

Dim sphere(100)

;create some shapes
For i = 0 To 100
	sphere(i) = CreateSphere()
	PositionEntity sphere(i), Rnd(-10, 10), Rnd(-10, 10), Rnd(-10, 10)
	RotateEntity sphere(i), Rand(360), Rand(360), Rand(360)
Next

RenderWorld

LockZBuffer(Direct3DDevice7)

Flip

WaitKey()

End
</textarea><br>It requires this .DLL<br><a href="http://members.home.nl/bramdenhond/test.zip" target="_blank">http://members.home.nl/bramdenhond/test.zip</a><br>However I'm not sure how to convert from this clipped RGB format back into ZBuffer. If anybody has an idea, please let me know! <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
