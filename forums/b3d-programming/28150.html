<!DOCTYPE html><html lang="en" ><head ><title >Code to collide with a moving object and move with it.</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Code to collide with a moving object and move with it.</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Code to collide with a moving object and move with it.</a><br><br>
<a name="295715"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="http://www.balpoint.com/~squishy/dcol.zip" target="_blank">http://www.balpoint.com/~squishy/dcol.zip</a><br><br>This is a modified version of Simon harrison's dynamic collison code.  Someone asked me how to make the code allow you to walk onto a moving platform and move with it, and I coded a new function for the collision system which handles that in a basic way.  I leave it to you to figure out how to apply fristion and stuff if you so desire.  This basically will tell you where a specific point on the moving platform is one frame, and where it has moved to in the next.  I just make the model move in the same realtive manner as that collision point for one frame after the collision if that collision point appears to be on a floor.  If the models continue to collide, then it continues to stick.  This works with rotating platforms as well.  And you can of course move about on the platform normally as you continue to move with it.<br><br>The only thing this code needs now is the ability to scale the dynamic collision objects without breaking the collision, and the ability to collide with more than one such object at the same time.  (I think that would involve translating all the copies of the colliding object at once, and determining when the first collision occured and then moving all the colliding objects to that location.)<br><br>Don't email me for support. If you have a question use the forums. :-) <br><br></td></tr></table><br>
<a name="295779"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Binary_Moon</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> :)<br><br>Have you managed to get the character to rotate with the object, or is it just the position that changes? <br><br></td></tr></table><br>
<a name="295783"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rob</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Excellent work swift ;) <br><br></td></tr></table><br>
<a name="295793"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just position.<br><br>To do rotation, one method you could use is to create a second point offset from the collision point by one unit in the direction of the object's Z axis, and then transform that point in the same manner from one frame to the next.  Then each frame, use aligntovector to align the object's Z axis to the vector formed by the two points. <br><br></td></tr></table><br>
<a name="295828"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Binary_Moon</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> ok - I got rotation working... kinda.<br><br>Occassionally the collision goes wonky, which I don't want (obviously).<br><br>Play it and you will see what I mean.<br><br><a href="http://www.binarymoon.co.uk/preview/dccol03.zip" target="_blank">http://www.binarymoon.co.uk/preview/dccol03.zip</a><br><br>edit : just noticed you need to change the include name to get this to work. <br><br></td></tr></table><br>
<a name="295876"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm sorry but I can't fix that.  You broke something.  And you didn't do what I said to do. :-)  I don't see an aligntovector or a point being transformed anywhere. :-) <br><br></td></tr></table><br>
<a name="295878"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I notice you put some new code in DCO_Update.  You should not do that.  Any code for handling friction should go in that seperate function dofriction.  People may not want this sort of fake-friction cheat in the physics, and so it needs to be seperate.  And it makes things simpler to understand. <br><br></td></tr></table><br>
<a name="295879"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Why in the world did you remove the # symbol from all the floating point numbers in the dofriction function?  It may make the code a little easier to read but it will inevitably lead to bugs where you have failed to typecast a variable as float without realising it. <br><br></td></tr></table><br>
<a name="295882"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I tried using your example code without the friction stuff I added, and when you turn the enetity weird things happen.  And I tried the old example code without turning with the new system and weird things did not happen.  Therefore, the turning of the colliding entity... the sphere and cube, is revealing a bug in the original collision code with dealing with such a thing.  Or it could be the person who sent me their version of the collision code to repair to make this collision code work caused the bug, because the version of the collision code I got from them had all new collision normal getting functions, since the old ones seemed to be broken when working with multiple entities.  But I know he changed more than that.<br><br>So for now I guess the system is broken.  I'll see if the original version of the system has this issue. <br><br></td></tr></table><br>
<a name="295897"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yup, the original code has the same problem.  Nobody tested with collider entity which can rotate, and doing so causes glitches.  I don't know how to fix this issue, and I don't have time to go over the code with a fine toothed comb to figure out why it occurs.<br><br>So I guess you didn't break anyhting.  Well, you DID, but not by doing something wrong. :-) <br><br></td></tr></table><br>
<a name="295910"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rob</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Then UNBREAK it perminantly :) <br><br></td></tr></table><br>
<a name="295953"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bot Builder</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Aye. I'm 'anxiously waiting" for this routine to be "finalized". okay, not really. but still... I don't understand how it works and can't really help in making it better. I probably *could* get it if I put effort into it, but eh. <br><br></td></tr></table><br>
<a name="295958"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Each time you create a new pair of objects, it creates two new  invisible entities at some far off location in the world.  I will refer to these as the collider, and the collidee.<br><br>Imagine the original collidee is a rotating block.  And imagine the original collider is a ball that is unmoving.<br><br>In this case, the invisible objects would be doing the opposite.  The copy of the colidee never actually moves.  The invisible ball would be rotating around the colidee to simulate how and where it would hit the colidee if the collidee were actually rotating and the ball were sitting still, as the real copies are.<br><br>This is how the system fools Blitz's collision system which can't handle tweo moving objects colliding.<br><br>It should also be notedm that in addition to rotating around the copy of the collidee if the collidee is rotating, the collider will also move relative to the copy of the collidee in the same relative manner that it moves relative to the real collidee.<br><br>If it sounds complicated, it is.  I understand it well enough, but still was having problems getting scaling to also work, and I'm pretty sure you can get that to work as long as you scale uniformly on all axes. <br><br></td></tr></table><br>
<a name="296223"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Binary_Moon</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I'm sorry but I can't fix that. <br></div><br><br>I CAN - I worked out what was wrong<br><br><div class="quote"> You broke something. And you didn't do what I said to do. :-) <br></div><br><br>I broke nothing, and what I did is based on a method you suggested in the original dynamic collision thread.<br><br><div class="quote"> I notice you put some new code in DCO_Update. <br></div><br><br>I did, but the code I added was not specific to the friction command, all it does is store the amount of rotation of the dco. It affects nothing else and saves adding another for next loop in the friction function.<br><br>So does anyone want to know how I fixed it... lol ?<br><br><div class="quote"> If it sounds complicated, it is <br></div><br><br>Not really. All I did was change a single line of code.<br><br>What got me stumped was why the rotation mattered, the src entity is a sphere regardless of its rotation so why should its angle mess things up. <br><br>At first I thought it was the collision normals that were being read wrong because of the different angles... but nope, that doesn't matter. The normal is the normal of the mesh to the sphere which won't change. Below that, though, is the command <br><br><pre class=code>
moveentity c\src_ent... blah de blah
</pre><br><br>Of course, rotate the entity and its going to move in the direction the entity is facing rather than move in world coords (as required). Change the command to 'TranslateEntity' and everything works fine. <br><br></td></tr></table><br>
<a name="296313"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ah I think I foufn that bug before, and I fixed it in the version fo the library I was cleaning up, but then people sent me all these modified versiond of the original code so I said screw it and went back to using the regular library and forgot about what I fixed. :-) <br><br></td></tr></table><br>
<a name="296743"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >poopla</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> May I ask for a breif overview of how this is being done? <br><br></td></tr></table><br>
<a name="296778"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Marcelo</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> That's what I've done in my game, I don't know if it's the same approach as this lib:<br><br>In your GameUpdate() function:<br>- Move the player, thus applying gravity;<br>- UpdateWorld(0);<br>- Check if the player collided with the "ground" (CollisionNY()), if yes, add the player as a child at the collided entity;<br>- Move the entities (platforms, trains, elevators), if the player is standing on these entities he will be moved together;<br>- Restore old player parent (EntityParent()) and scale (ScaleEntity()), scale get messed up if you collide with a scaled entity;<br>- UpdateWorld(animspeed);<br><br>This worked perfectly in my games, and the player also is rotated;<br><br>Some details of this approach:<br>- You need to use some "verlet-like" integration for player physics (derivating the speed from the old position), this way, if the player is in the top of a moving train for example, it will behave correctly if you jump; it also allows to make an catapult to throw the player away, hehe;<br><br>- It only works if the player collides with the object, but you can assign an ellipse to the object so it can push the player also. But it's very hard to assign an elipse to an odd shaped thing like a platform or a train;<br><br>- Two UpdateWorld()'s per frame doesn't seems to slow down anything, because I think blitz only check collision for moving things. <br><br></td></tr></table><br>
<a name="296787"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Marcelo:<br>The method in this library allows the object to push the player.  So if the player collides with a moving, rotating box, they will be pushed back.  The method you describe does not allow that.  <br><br>But the verlet-like physics trickery sounds useful. <br><br></td></tr></table><br>
<a name="296817"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >poopla</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> sswift, would you care to explain what it is doing?<br><br>[edit]  Just saw your explanation above. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
