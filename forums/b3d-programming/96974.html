<!DOCTYPE html><html lang="en" ><head ><title >Array index out of bounds?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Array index out of bounds?</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Array index out of bounds?</a><br><br>
<a name="1123879"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Can someone please tell me why array index is out of bounds, when it's clearly not?<br><br><br>Here's the media &amp; source files:<br><br><br><a href="http://www.mediafire.com/?btghxqav03ua2t6" target="_blank">http://www.mediafire.com/?btghxqav03ua2t6</a><br><br><br>I couldn't make a demo this time, because it's complaining about the array -.- Sorry Guys....<br><br><br><br>Thanks guys! :) <br><br></td></tr></table><br>
<a name="1123882"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Where are you getting the error? This actually works perfectly when I run it, debug mode or not. I had no trouble creating an exe and using all functions listed at the top of the screen. <br><br></td></tr></table><br>
<a name="1123884"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> This line: <br><br><br>Map(X,Y)=ReadInt(FI)<br><br><br>in both loops <br><br></td></tr></table><br>
<a name="1123885"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Can you post instructions on replicating the error? (i.e. where exactly do we have to place objects, switch to G mode, load, save, whatever... in sequence?) <br><br></td></tr></table><br>
<a name="1123888"></a>

<a name="1123889"></a>

<a name="1123894"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Alright. Well. 1st thing I did was went into the level editor. (editor1.bb)<br><br><br><br>I then drew a couple of test tiles in random places on the green background (or map), then saved the map by pressing F1. Then I closed the level editor. Opened it, pressed F2 to load the map, I THEN took lvl1.map that the level editor generated, and put it in the Game folder, and it worked fine in the LEVEL EDITOR. BUT in the GAME for some reason, I'm getting that stupid array index is out of bounds error, when it clearly is NOT &gt;&lt;<br><br>Here's the level editor: <br><br><br><a href="http://www.mediafire.com/download.php?btghxqav03ua2t6" target="_blank">http://www.mediafire.com/download.php?btghxqav03ua2t6</a><br><br><br><br>Let me know if you need more information! :)<br><br><br>Thanks, Yasha :)<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1123893"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh, whoops. I only thought to test the editor - didn't realise there was meant to be a game as well.<br><br>The other three files are Hud.bb, scancodes.bb and testlevel.bb. Going out on a limb and assuming scancodes isn't the game, neither of the other two work due to a missing Include "Globals.bb". So you might want to update the download... <br><br></td></tr></table><br>
<a name="1123895"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> O, ignore that...<br><br><br>Here's the new files, 2 zip files contained in 1 master zip file. just extract the main zip file, then extract the other 2. I have included both the game AND the level editor in this update. with ONLY the files needed for them both to run.<br><br><br><a href="http://www.mediafire.com/?sgn80045htdl4aw" target="_blank">http://www.mediafire.com/?sgn80045htdl4aw</a><br><br><br>Thanks, Yasha! :) <br><br></td></tr></table><br>
<a name="1123896"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wtf? I reset IDEAL, and the stupid thing works o.O... That is SO weird...<br><br><br>Anyways, now that it works, can u tell me why it's not drawing the tiles like it should? <br><br></td></tr></table><br>
<a name="1123897"></a>

<a name="1123898"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> ...well actually I can tell you what the error is in the version you just uploaded.<br><br>Classic one: your Dim statement comes <i>after</i> your call to Load. So initially the array has no elements. Blitz is a bit weird this way in that globally declared names are visible throughout the program no matter where the declaration happens, but the initialisation (either sizing an array or putting things into a global) happens "in sequence" as you go down the main scope.<br><br>As for the other bit... it draws what I quickly drew out in the editor (once the Dim statement is moved above the call to Load). What's going wrong there?<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1123899"></a>

<a name="1123901"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, I replaced the code for the Game.<br><br><br>Here's the fix for Dim, but for some reason, I can't get it to draw the tiles in the right places: <br><br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">Graphics 800,600,0,2

SetBuffer BackBuffer()

;this is just were i call the scan codes for the keys i will be using
Const LeftKey=203
Const RightKey=205
Const UpKey=200
Const DownKey=208

Global offsetx
Global offsety

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;Make sure this graphics points to the Ztileset.bmp Image!
Global tiles = LoadAnimImage("gfx\Ztileset.bmp",32,32,0,10)
MaskImage tiles, 255, 0, 255
Global Map_Tiles_Width,Map_Tiles_Height



Dim Map(1000,1000)
Dim MapCol(1000,1000)



;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;But level name here!
Load("lvl1.map")



Map_Length=50
Map_Height=50



Global playerx = GraphicsWidth()/2-Map_Length/2
Global playery = GraphicsHeight()/2-Map_Height/2



;Added Needed Variables
MapWidth = Map_Length*32 + 1
MapHeight = Map_Height*32 + 1
PlayerSize = 32
;//



While Not KeyDown(1)
	
	
	
	Cls
	
	
	
	PlayerSpeed=10
	
	
	
	If KeyDown(RightKey) Then playerx = playerx + PlayerSpeed
	If KeyDown(LeftKey) Then playerx = playerx - PlayerSpeed
	If KeyDown(DownKey) Then playery = playery + PlayerSpeed
	If KeyDown(UpKey) Then playery = playery - PlayerSpeed
	
	
	
	If playerx&lt;=0 Then playerx=0
	If playery&lt;=0 Then playery=0
	If playerx&gt;=MapWidth-PlayerSize Then playerx=MapWidth-PlayerSize
	If playery&gt;=MapHeight-PlayerSize Then playery=MapHeight-PlayerSize
	
	
	
	offsetx=GraphicsWidth()/2-(playerx+PlayerSize/2)
	offsety=GraphicsHeight()/2-(playery+PlayerSize/2)
	
	
	
	If offsetx&gt;0 Then offsetx=0
	If offsetx&lt;MapWidth*-1+GraphicsWidth() Then offsetx=MapWidth*-1+GraphicsWidth()
	If offsety&gt;0 Then offsety=0
	If offsety&lt;MapHeight*-1+GraphicsHeight() Then offsety=MapHeight*-1+GraphicsHeight()
	
	
	
	; // Draw ou our array, replace Rect with appropriate DrawImage
	For x=0 To Map_Length
		
		For y=0 To Map_Height
			
			DrawImage tiles,x*32+offsetx,y*32+offsety,Map(X,Y)
			
		Next
		
	Next
	
	
	
	Color 0, 255, 0
	Oval playerx+offsetx, playery+offsety, 32, 32, 1
	Color 255, 255, 255
	
	
	
	Color 255, 255, 255
	
	
	
	Text GraphicsWidth()/2, GraphicsHeight()/2, "offsetx: "+offsetx, 1, 1
	Text GraphicsWidth()/2, GraphicsHeight()/2+20, "Map_Length: "+Map_Length, 1, 1
	Text GraphicsWidth()/2, GraphicsHeight()/2+40, "playerx: "+playerx, 1, 1
	Text GraphicsWidth()/2, GraphicsHeight()/2+60, "playery: "+playery, 1, 1
	
	
	
	Flip
	
	
	
Wend



Function Load(FileName$)
	;Open the file
	FI=ReadFile(FileName$)
	
	;If the File failed to open, return False (also known as 0)
	If FI=0 Then Return 0
	
	;Set X &amp; Y's maximum amount
	SX=32
	SY=24
	
	
	;Set the Global values of X,Y
	Map_Tiles_Width=SX
	Map_Tiles_Height=SY
	
	;Begin Map Read
	For Y=0 To Map_Tiles_Height
		For X=0 To Map_Tiles_Width
			Map(X,Y)=ReadInt(FI)
		Next
	Next
	
	;Begin MapCol Read
	For Y=0 To Map_Tiles_Height
		For X=0 To Map_Tiles_Width
			MapCol(X,Y)=ReadInt(FI)
		Next
	Next
	
	;Release the Handle of the file
	CloseFile(FI)
	
	;Return True for a completed load! (also known as 1)
	Return 1
	
End Function</textarea><br><br><br>It's not drawing my tiles at ALL o.o Even though it reads the file<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1123902"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Once again, this seems to work fine for me. Loads my smiley face map correctly. <br><br></td></tr></table><br>
<a name="1123903"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> wtf?... o.o Why wont it load my Ztileset.bmp map? :/ <br><br></td></tr></table><br>
<a name="1123904"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, it seems to work now.. I don't know WHAT it is with IDEAL. Now... One more question, then this is complete :)<br><br><br>How can I make a map the same size as the map in the game?<br><br><br>Is there a way I can make the level editor allow for scrolling with the arrow keys so that I can create a map the same size as the one in the game? :) <br><br></td></tr></table><br>
<a name="1123905"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> All you have to do is have an offset for the current top left corner of the editor view. Draw the tiles "For x = xOffset to screenXsize + xOffset" and "For y = yOffset to screenYsize + yOffset" or something like that, and make sure that the maximum value for the offsets is "maxXsize - screenXsize" and the equivalent for Y.<br><br>You might want to make your map sizes variable and load them from the saved map file, too; just make them the first two ints saved to the file, and read before the tile loading loop. <br><br></td></tr></table><br>
<a name="1123906"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> How do I get the offset for the current top left corner of the editor? <br><br></td></tr></table><br>
<a name="1123910"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here's what I have so far: <br><br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">Include "scancodes.bb"

Graphics 1024,768,0,2
AppTitle "Platform editor v2.0"
SetBuffer BackBuffer()
AutoMidHandle False		;Images placed by their top left
TFormFilter 0
;32
Dim map(32,24)
Dim mapcol(32,24)
Dim mapData(32,24)

Global mapx = 32
Global mapy = 24
Global mapx1 = 0
Global skypos
Global gridon = False
Global mapview = 1024

Global tiles = LoadAnimImage("gfx/Ztileset.bmp",32,32,0,10)
Global sky = LoadImage("gfx\sky1.bmp")
MaskImage tiles,255,0,255
TileImage sky

Global cursorx,cursory
Global gx,gy
Global currenttile=1
Global rpik,rpik2
Global rcol,rcol1,rcol2
Global mode=1
Global coltype=1

Const erasetile = 0

fill()

Global X1 = 0
Global Y1 = 0

; Main
While Not KeyHit(1)
	
	
	
	Cls
	
	
	
	If KeyDown(k_left)
		X1 = X1 - 1
		If X1 &lt; -1000 
			X1 = -1000
		EndIf
	EndIf
	
	
	
	If KeyDown(k_right)
		X1 = X1 + 1
		If X1 &gt; 10 
			X1 = 10
		EndIf
	EndIf
	
	
	
	If KeyDown(k_up)
		Y1 = Y1 - 1
		If Y1 &lt; 0 
			Y1 = 0
		EndIf
	EndIf
	
	
	
	If KeyDown(k_down)
		Y1 = Y1 + 1
		If Y1 &gt; 36
			Y1 = 36
		EndIf
	EndIf
	
	

sky()
update()
grid()
control()
info()



Flip



Wend



Function control()
	
	
	
If mode=1
   ; If KeyDown(k_left) = mapx Then mapx = mapx+1 : mapx1 = mapx1 +1
	If KeyHit(12) And mode=1 Then currenttile=currenttile-1
	If KeyHit(13) And mode=1 Then currenttile=currenttile+1

	
	If KeyHit(34) 
	If gridon=True
	gridon=False
	Else
    gridon=True
	EndIf
	EndIf
	
	If currenttile&lt;0 Then currenttile=9
	If currenttile&gt;9 Then currenttile=0
    If KeyHit(46) Then mode=2	
    gx=MouseX()/32
    gy=MouseY()/32
	Color 256,0,0
	Line MouseX()-10,MouseY(),MouseX()+10,MouseY()
	Line MouseX(),MouseY()-10,MouseX(),MouseY()+10
	If MouseDown(1) And gx &lt; 32 And gy &lt; 24 Then map(gx,gy)=currenttile
	If MouseDown(2) And gx &lt; 32 And gy &lt; 24 Then map(gx,gy)=0
	
EndIf

If mode=2 
	If KeyHit(12) And mode=2 Then coltype=coltype-1
	If KeyHit(13) And mode=2 Then coltype=coltype+1
	If coltype&lt;1 Then coltype=1
	If coltype&gt;2 Then coltype=2
	
	Color 256,0,0
	Line MouseX()-10,MouseY(),MouseX()+10,MouseY()
	Line MouseX(),MouseY()-10,MouseX(),MouseY()+10
    gx=MouseX()/32
    gy=MouseY()/32
	If KeyHit(46) Then mode=1
	If MouseDown(1) And gx &lt; 32 And gy &lt; 24 And coltype=1 Then  mapcol(gx,gy)=1
	If MouseDown(1) And gx &lt; 32 And gy &lt; 24 And coltype=2 Then  mapcol(gx,gy)=2
	If MouseDown(2) And gx &lt; 32 And gy &lt; 24 Then mapcol(gx,gy)=0
EndIf


	If KeyHit(59)
		save("lvl1.map")
		supersave("lvl1_decrypted.map")
	EndIf
	
	If KeyHit(60)
    load("lvl1.map")
	EndIf
	
	If KeyHit(203)
	mapview=mapview+1
	EndIf
	
	If KeyHit(208)
	
	EndIf
	
End Function



Function update()

If mode=1
For x=0 To mapx
	For Y=0 To mapy
		DrawImage tiles,X1+x*32,Y1+y*32,map(x,y)	
	Next	
Next

Color 0,0,0
Rect 0,0,40,40,1
DrawImage tiles,3,3,currenttile
EndIf

If mode=2
For x=0 To mapx
	For Y=0 To mapy
	DrawImage tiles,x*32,y*32,map(x,y)	
	If mapcol(x,y)=1
	Color 0,0,0
    Rect x*32,y*32,32,32,0
    EndIf	
	If mapcol(x,y)=2
	Color 255,0,0
    Rect x*32,y*32,32,32,0
    EndIf	
	Next
	Color 0,0,0
    Rect 0,0,40,40,1
    If coltype=1 
	Color 0,0,0
	Rect 3,3,32,32,1
	EndIf
	If coltype=2
	Color 255,0,0 
	Rect 3,3,32,32,1
	EndIf
Next


EndIf

End Function


Function sky()

TileBlock sky,skypos,0 

skypos=skypos+1

End Function


Function info()

If mode=1
Text 100,0,"Press C to change to collision mode   leftclick = place tile   rightclick = remove tile   + and - change tiles"
Text 100,20,"F1 to save - F2 to load   Unfortunatly it only saves as (lvl1.lvl) SOZ"
Text 100,40,"Press D to change to data mode    Press G for grid mode " 

EndIf
If mode=2
Text 100,0,"Press C to change to scenery mode   leftclick = place collision   rightclick = remove collision"
EndIf

End Function



Function save(filename$)

	f=WriteFile(filename$)

	For y=0 To 24
		For x=0 To 32
			WriteInt f,map(x,y)
		Next
	Next
	
	For y=0 To 24
		For x=0 To 32
			WriteInt f,mapcol(x,y)
		Next
	Next

	CloseFile f

End Function



Function supersave(filename$)
	
	f=WriteFile(filename$)
	
	For y=0 To 24
		For x=0 To 32
			WriteLine f, "TileNumber: "+map(x,y)
		Next
	Next
	
	For y=0 To 24
		For x=0 To 32
			WriteLine f,"CollisionTileNumber: "+mapcol(x,y)
		Next
	Next
	
	CloseFile f
	
End Function


Function load(filename$)

	f=OpenFile(filename$)

	For y=0 To 24
		For x=0 To 32
			i=ReadInt(f)
			map(x,y)=i
		Next ;x
	Next ;y
	
	For y=0 To 24
		For x=0 To 32
			i=ReadInt(f)
			mapcol(x,y)=i
		Next ;x
	Next ;y

	CloseFile f

End Function


Function grid()

If gridon=True
For x=0 To mapx
	For y=o To mapy
	Rect x*32,y*32,32,32,0
	Next
Next
EndIf

End Function


Function fill()
For x=0 To mapx
	For y=0 To mapy
    map(x,y)=5
	Next
Next
End Function</textarea> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
