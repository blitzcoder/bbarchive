<!DOCTYPE html><html lang="en" ><head ><title >collision problem (fps game mode)</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >collision problem (fps game mode)</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >collision problem (fps game mode)</a><br><br>
<a name="1148315"></a>

<a name="1148316"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >yoshark</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm in the process of creating an fps game...with multiplayer and have been running into a bunch of problems.  One of the main problems is the collision effects of the bullets when they are shot from the gun. When I fire a bullet, the bullet stays in a certain position and does not follow the guns movement.....I know it may be difficult to understand but heres the code...I'm pretty much a beginnner so no answers extremely difficult to understand plz. thanks!<br><br>[bbcode]<br>welcome()<br>Function welcome()<br>Graphics 1280,960<br>screen=LoadImage("fps welcome.bmp")<br>DrawImage screen,0,0,0<br>While Not KeyDown(1)<br>If KeyDown(61) Then<br>screen=LoadImage("fps controls.bmp")<br>DrawImage screen,0,0,0<br>End If<br>If KeyDown(29) Then<br>screen=LoadImage("fps welcome.bmp")<br>DrawImage screen,0,0,0<br>End If<br>If KeyDown(62) Then<br>screen=LoadImage("fps map.bmp")<br>DrawImage screen,0,0,0<br>End If<br>If KeyDown(63) Then<br>screen=LoadImage("fps credits.bmp")<br>DrawImage screen,0,0,0<br>End If<br>If KeyDown(59) Then Return<br>Wend<br>End Function<br><br><br>Graphics3D 1280,960<br>SetBuffer BackBuffer()<br><br>;types<br>type_player=1<br>type_city=2<br>type_bullet=3<br>type_boundary=4<br><br>;camera<br>camera=CreateCamera()<br>Cam_range=100000<br>EntityType camera,type_player<br><br>;light<br>light=CreateLight()<br><br>;city<br>city=LoadMesh("metro 1.3ds")<br>tex=LoadTexture("metro01.jpg","metro02.jpg")<br>EntityTexture city,tex<br>PositionEntity city,0,-30,+100<br>ScaleEntity city,10,10,10<br>EntityType city,type_city<br><br>;soldier<br>soldier=LoadMesh("soldier.3ds")<br>tex3=LoadTexture("swattex.jpg")<br>RotateEntity soldier,0,180,0<br>ScaleEntity soldier,.08,.08,.08<br>EntityTexture soldier,tex3<br>PositionEntity soldier,EntityX(camera),EntityY(camera)-5,EntityZ(camera)+.5<br>EntityParent soldier,camera<br><br>;aimer<br>HidePointer<br>aimer=LoadImage("aimer.jpg")<br>MaskImage aimer,0,0,0<br>MidHandle aimer<br><br>;Creating the gun<br>gun=LoadMesh("paintball.3ds")<br>EntityColor gun,255,0,0<br>ScaleEntity gun,.007,.007,.007<br>PositionEntity gun,EntityX(camera)+1.2,EntityY(camera)-1.7,EntityZ(camera)-.2<br>EntityParent gun,camera<br><br>;Creating the bullets<br>maxbull = 100<br>Dim bullet(maxbull)<br>For i=0 To maxbull<br>bullet(i)=CreateSphere()<br>EntityColor bullet(i),255,0,0<br>ScaleEntity bullet(i),.1,.1,.1<br>EntityType bullet(i),type_bullet<br>Next<br><br>;boundary<br>boundary=CreateCube()<br>PositionEntity boundary,0,0,0<br>ScaleEntity boundary,2200,2200,2200<br>FlipMesh boundary<br>EntityAlpha boundary,0<br>EntityType boundary,type_boundary<br><br>;sky<br>sky=CreateSphere()<br>tex2=LoadTexture("sky8.jpg")<br>EntityTexture sky,tex2<br>ScaleEntity sky,100000,100000,100000<br>FlipMesh sky<br><br>;collisions<br>Collisions type_player,type_city,2,2<br>Collisions type_player,type_boundary,2,2<br>Collisions type_bullet,type_city,2,1<br>EntityRadius camera,2<br><br>;pro run<br>velocity#=0<br><br>While Not KeyDown(1)<br><br>;network game<br>If KeyDown(60)=True Then<br>Select StartNetGame()<br>Case 0<br>End<br>Case 1<br>	Print "Joined!"<br>Case 2<br>	Print "Server!"<br>End Select<br>End If<br><br>;changing sky texture<br>If KeyDown(42) Then<br>night=LoadTexture("star sky.jpg")<br>EntityTexture sky,night<br>End If<br>If KeyDown(54) Then<br>tex2=LoadTexture("sky8.jpg")<br>EntityTexture sky,tex2<br>End If<br><br>yaw#=yaw#-.01<br>roll#=roll#-.01<br>RotateEntity sky,0,yaw#,roll#<br><br>If KeyDown(47)=True Then <br>velocity2#=velocity2#-.4<br>TranslateEntity camera,0,-velocity2#,0<br>End If<br><br>;velocity<br>If CountCollisions (camera)<br>time=0<br>velocity#=0<br>velocity2#=0<br>End If<br>If KeyHit(57) Then<br>time=time+1<br>velocity#=2-.01*time<br>TranslateEntity camera,0,velocity#,0<br>End If<br><br>If MouseDown(3)=True Then MoveEntity camera,0,0,1<br>If MouseDown(3)=True Then cam_range=cam_range+1<br>CameraRange camera,1,cam_range<br>time=time+1<br>velocity#=velocity#-.01*time<br>TranslateEntity camera,0,velocity#,0<br><br>UpdateWorld<br><br>RenderWorld<br><br>If MouseHit(1) And reload=0 Then<br>PositionEntity bullet(t),EntityX(gun,1),EntityY(gun,1),EntityZ(gun,1)<br>RotateEntity bullet(t),EntityPitch#(gun,1),EntityYaw#(gun,1),EntityRoll#(gun,1)<br>EntityColor bullet(t),255,0,0<br>t=t+1<br>EndIf<br>For q = 0 To maxbull<br>MoveEntity bullet(q), 0,0,3<br>Next<br><br><br>bulletcount=100-t<br> 	If t=100 Then<br>         reload=1<br>    	EndIf <br>    	If KeyDown (19) = True Then<br>         t=0<br>        reload=0<br>    EndIf<br><br>DrawImage aimer,MouseX()+250,MouseY()+200<br><br>mxs#=mxs#+MouseXSpeed()/4<br>mys#=mys#+MouseYSpeed()/4<br><br>If mxs#&lt;0 Then mxs#=360<br>If mxs#&gt;360 Then mxs#=0<br>If mys#&gt;80 Then mys#=80<br>If mys#&lt;-80 Then mys#=-80<br><br>RotateEntity camera,mys#,-mxs#,0<br>MoveMouse 400,300<br><br>Color 255,255,255<br>Text 500,10,"Bullets Remaining: "+bulletcount<br>Color 0,255,0<br>Text 0,10,"Press Esc to Exit"<br><br>If reload=1 Then <br>Color 255,0,0<br>Text GraphicsWidth()/2, GraphicsHeight()/2,"Press R to Reload",1,1<br>End If<br><br>Flip<br><br>Wend<br>End<br>[/bbcode]<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1148329"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Midimaster</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> When you create a bullet, it should be the child of the gun. So you need not to care about starting point and direction, when fire.<br><br>The better way is to create the bullet even in the moment, when you fire.<br><br>to use your code:<br><pre class=code>If MouseHit(1) And reload=0 Then
     Bullet[t]=CreateSphere(8,Gun)
     ; now do all things to build up your bullet but not position and direction
     EntityColor Bullet[t] ....
     .....
     t=t+1

     ; then cut the relationship
     EntityParent Bullet[t],0
</pre><br><br>by the way: to optimize your code I would not use an array for the bullets but a type-list. There you could create bullets,when needed and delete them at the end of lifecycle without use of index numbers:<br><br><pre class=code>Type BulletTyp
   Field Entity%
End Type

If MouseHit(1) And reload=0 Then
     local Bullet.BulletType = New BulletType
     Bullet\Entity=CreateSphere(8,Gun)
     ; now do all things to build up your bullet
     EntityColor  Bullet\Entity....
     .....
     t=t+1

     ; then cut the relationship
     EntityParent Bullet\Entity,0
</pre><br><br>to cylce through all bullets you can use this:<br><br><pre class=code>For local locBullet = Each BulletType
     MoveEntity locBullet\Entity, 0,0,3

     ; kill a bullet at the end f.e.:
     If locBullet\EntityZ&gt;100
          Delete locBullet
     Endif
Next
</pre> <br><br></td></tr></table><br>
<a name="1148335"></a>

<a name="1148336"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>When I fire a bullet, the bullet stays in a certain position and does not follow the guns movement...<br> <br></div><br><br>I don't have the files to be able to test it but i think it is because you create the bullet at the position, orientation of the gun, and not at the position, orientation of the end of the barrel (where the bullet should start to move freely).<br><br>What you can do is to create a pivot, child to the gun and positioned where the barrel ends. Then you can use this pivot to position and to turn your bullet correctly.<br><br>Here :<br><pre class=code>
PositionEntity bullet(t),EntityX(gun,1),EntityY(gun,1),EntityZ(gun,1)
RotateEntity bullet(t),EntityPitch#(gun,1),EntityYaw#(gun,1),EntityRoll#(gun,1)
</pre><br><br>Then will be :<br><pre class=code>
RotateEntity bullet(t),EntityPitch(Barrel,True),EntityYaw(Barrel,True),EntityRoll(Barrel,True)
PositionEntity bullet(t),EntityX(Barrel,True),EntityY(Barrel,True),EntityZ(Barrel,True)
</pre><br><br><br>Another thing that may help you is to create another pivot, child of the barrel, and move it at +1000Z, and when a new bullet is created, you can use PointEntity(Bullet(i),Target) so that your bullet goes toward this target.<br><br>Of course a more appropriate way would be to add a mode where the user can put his weapon at the center of the screen in order to be able to aim accurately and the bullet will always move at the center of the screen. (as in Fallout 3)<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1148648"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >yoshark</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> thanks midimaster...I was first thinking that I could just create a bullet each time that I clicked the mouse.....only the blitz3d programming book creates the bullets before hand, but your point is working to. Thanks again! <br><br>Make sure to check more on this game that I'm making...there is gona be alot of question.. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
