<!DOCTYPE html><html lang="en" ><head ><title >Smart Cam Problems</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Smart Cam Problems</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Smart Cam Problems</a><br><br>
<a name="401251"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >-Rick-</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm writing up a Solar System Tour program and I'm running into some trouble that I hope someone can help out with.<br><br>I'm using Anthony's Smart Cam code found in the CodeArchives. I just dont understand the usages of TFormVector and TFormX and the like so I cant quite follow his code. I've done a few searches with those keywords with no good hits so I'm left in the dark on what those mean and exactly what those do.<br><br>Blitzs lacking help file mentions vector's, but i'm even MORE at a loss with that. I'd alway thought these commands had something to do with terraforming and working with vertices.<br><br>Anyway, the problem I'm having is that when I send the smart cam after something extremly small (.1 - .000001) that it get very jittery and bouncy. I'm guessing that at that small size its losing accuracy on where its looking and going somehow. Anyone got any suggestions on how I could fix this?<br><br>The scales are that small because of the way the solar system is. Pluto is 6 billion kilometers out, some moons are only 8 kilometers big .. for whatever reason if I ratio pluto's distance to where its more than 1000 out from sun then I get screwy effects. This means I have to use a ratio of 10,000,000 : 1 for distance, which also effect size. A moon or planet with a 1000 km radius suddenly just went to a size of .00001 ... Leda is only 8 km across = .00000008<br><br>Space is just so big I lose either way. <br><br></td></tr></table><br>
<a name="401299"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Your definately loosing floating point accuracy which explains the jittering.  Other people have tried to recreate a solar system and run into the same problems due to scale.  <br><br>Imagine you have spaceship flying around the solar system .. One possible way to resolve the problem is to store all the x,y,z global positions of each object, including the spaceship but positionentity each entity relative to the spaceship as it moves ... so the ship is always at world coords 0,0,0.  Not sure if I explained that right but it's a bit like a tilemap in 2d - hopefully you get the jist. <br><br></td></tr></table><br>
<a name="401406"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >-Rick-</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> At first I thought that sounded like a mad crazy change in program to accomplish, but after more searching I found a relevant link that explains the process of "Normalizing". This helped me to better understand what I'm going to need to do.<br><br>Thanks for getting me pointed in the right direction Stevie G! Here's the link I found that explains the idea and provides some code.<br><br>I'll give this a go and then let ya know how it works out.<br><br><a href="http://www.blitzcoder.com/cgi-bin/ubb-cgi/postdisplay.cgi?forum=Forum4&amp;topic=000352" target="_blank">http://www.blitzcoder.com/cgi-bin/ubb-cgi/postdisplay.cgi?forum=Forum4&amp;topic=000352</a> <br><br></td></tr></table><br>
<a name="401489"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >kalimon</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> WEll... I'd propose another solution BEcasue I ebt you still ahve rpoblems :P  (we programmers always have rpobelms, you know)   This is an algorthm Id eveloped 1 decade ago on good old  QuickBAsic 4.5 (tm I think) ....<br><br>I create an array of supspaces  (a big space contains a series of supspaces) those supspaces are a partition of the collection. (that means no subspace shares anything between, no rpeated space,  but all compelte the space.  I recomend multiples of 3 for each of the idmensions: 3*3*3 boxes form the unveerse, which would be 27 boxes, I'd recomend 12*12*12 for the first layer.<br><br>Now you can use -relative- coordinates to the center of each subspace. Whe your ship travels, you need to load 27 subspaces at once (the one you're on all and the surrounders) each coordinate woudl now be of 4 components, x,y,z and Subspace.<br><br><br>If numebrs are still to big, I recomend a largesubs ystem of 30*30*30 or a second layer of subspaces, which would be more complicated.<br><br>a mutidmiensional array could use a subspace of 60000,60000,60000  with no problems (except RAM, that'd be  LOTS of MB) 120*120*120 should suffice.<br><br>I hope someone undrstands mi blabbering. <br><br></td></tr></table><br>
<a name="401490"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >-Rick-</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey Stevie, just an update. I've managed to get things working a bit. Still got some tinkering to do to tie up loose ends and whatnot, but I think its licked. I just flew to the outer reaches of Pluto with the resolution set pretty high and the jittering was gone.<br><br>Here is the code I got that someone else may find of use if the previous link should come up dead. Huge HUGE thanks to Andy!<br><br><pre class=code>
Function housekeeping()
		
	;Call this function from your main loop as often as you need it
	;		to "Normalize" your environment. This is used to keep your environment
	;		moving while you remain the center of the universe and not suffer
	;		from the loss of floating point accuracy and weird effects from moving
	;		too far from 0,0,0 location. Rather than using controls to move the 
	;		player, use them to move all your stuff around them!
	;'Camera' should be your "player" pivot
	;'MasterPivot' is the pivot your universe is tied to. Or you can run a loop
	;		to move all your entities if they arent tied to a single pivot. 
	;HUGE thanks to Andy at Blitzcoder for this function.

	fieldsize#=2000
	mmx = 0.0
	mmy = 0.0
	mmz = 0.0 
	
	If EntityX(Camera,True)&gt;fieldsize Then
	PositionEntity Camera,EntityX(Camera,True)-fieldsize,EntityY(Camera,True),EntityZ(Camera,True)
	mmx = -fieldsize : mmy = 0.0 : mmz = 0.0 
	MoveEntity MasterPivot,mmx,mmy,mmz
	EndIf

	If EntityZ(Camera,True)&gt;fieldsize Then
	PositionEntity Camera,EntityX(Camera,True),EntityY(Camera,True),EntityZ(Camera,True)-fieldsize
	mmx = 0.0 : mmy = 0.0 : mmz = -fieldsize
	MoveEntity MasterPivot,mmx,mmy,mmz
	EndIf

	If EntityX(Camera,True)&lt;-fieldsize Then
	PositionEntity Camera,EntityX(Camera,True)+fieldsize,EntityY(Camera,True),EntityZ(Camera,True)
	mmx = fieldsize : mmy = 0.0 : mmz = 0.0
MoveEntity MasterPivot,mmx,mmy,mmz
	EndIf

	If EntityZ(Camera,True)&lt;-fieldsize Then
	PositionEntity Camera,EntityX(Camera,True),EntityY(Camera,True),EntityZ(Camera,True)+fieldsize
	mmx = 0.0 : mmy = 0.0 : mmz = fieldsize
	MoveEntity MasterPivot,mmx,mmy,mmz
	EndIf

End Function ;housekeeping
</pre> <br><br></td></tr></table><br>
<a name="401749"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >-Rick-</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Heh kalimon, you must have posted as I was writing mine out, didnt see yours till just now.<br><br>Maybe I didnt quite understand what you where saying? It sounds like a rougher version of what Stevie suggested and what I'm currently going with. However you've defined specific zones or regions to pass thru?  <br><br>I really like housekeeping because I can tie everything to a single pivot to be moved and I need only exchange my movement controls from controling the player/observer with that central pivot and my whole program is still intact.<br><br>I dont mean to belittle your suggestion, I just dont fully comprehend it. Heh, the suggestion of moving my universe around the player rather than vice versa gave me a brain ache the first time I read it. <br><br></td></tr></table><br>
<a name="401790"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >kalimon</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's not  moving the universe....  you jsut have  3 coords od ship x y z,  supose 30*30*30 bxes compound the universe sized 10000,10000,10000 so  you just load 27 pivots each one with a small distance between them and your ship.<br><br>distance to objecto woudl be  signed distance ship-pivot + signed distance  pivot-object.<br><br>dividing the universe into sveral minr pieces coudl give you 3 more decimals per dimension (1000,1000,1000 divisions subspace)  whicih I think is what you are missing by using regular numbers. <br><br></td></tr></table><br>
<a name="402455"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >-Rick-</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> kalimon, in theory your idea sounds like a hugely complicated procedure that I dont quite understand how to correctly go about. Without some kind of example code or something for me to actually see what you are talking about I wouldn't be able to even attempt what you suggest. Remember, I'm working in 3d space using all 3 coordinates. A buddy of mine thought that what you proposed might only work for a 2d environment.<br><br>Stevie, I've fully implemented the idea of moving the universe around the player. I've tried 2 different variations. Variation 1 was to keep the player locked at 0,0,0 and move everything else thru the use of a single MasterPivot. Variation 2 took the approach outlined by Andy and Nmuta on Blitzcoder and still moving the player, but then normalizing (i think correct use of the term) everything back to 0,0,0 when the player went a set range from that point.<br><br>Both variations work in a limited sense. Being around the planets/moons/sun now has no graphical artifacts or weird effects, however I do still get those weird effects from objects that are far away and still visible such as Orbit Lines (Torus meshes I use to represent the planets orbital path)<br><br>Space is big and moving too fast is a problem. While moving out to far far distances the "speed" or how much you move sometimes is greater than the distance in which I normalize. This leads to space flickering, blacking out, and then after I stop "catching up". At first I thought I could use that as a "hyperspace" effect, but without full control of gfx and effects you just dont know how its going to look on other computers.<br><br>I'm still tinkering until I either :<br><br>a) find a better method<br>b) solve the problems<br>c) give up<br><br>I want to work on gfx and effects so bad right now, but I don't want to waste my time if I can't work out the basic underlying mechanics. <br><br></td></tr></table><br>
<a name="402461"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SoggyP</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Folks,<br><br>When you get to these excessive speeds, why not kick in a separate 'grey space' effect?<br><br>Later,<br><br>Jes <br><br></td></tr></table><br>
<a name="402613"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >kalimon</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well  I also suggest to change the FOV of the camera. <br><br><br>Aslo make speed in inverse function of gravity, the cosest and the bigger the obejct is, the slower you move:  speed= MAxspeed- (sum off all (distance of obejct from  ship  *mass)   /(amount of obejcts *adjuster)<br><br>adjuster depends on maxspeed nad minimum speed you desire.  also an imprved speed funciton:<br><br>maxspeed- max(minspeed,(sum off all (distance of obejct from  ship  *mass)   /(amount of obejcts *adjuster)  )<br><br><br>I espect this one to be easier :D<br><br>the other one is compelx indeed. But looks floats will work good enough for you. (this algorythm I rpesented days back is a ogood sibstitute for creating a woel BIg numbers  sysem for floats, but you don't need it at the end. <br><br></td></tr></table><br>
<a name="404268"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Andy</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey I didn't see this thread until now....<br><br>&gt;Huge HUGE thanks to Andy!<br><br>You are welcome, but the concept isn't my invention. I lifted it from the AMOS 3D manual back on the Amiga.<br><br>&gt;however I do still get those weird effects from objects <br>&gt;that are far away and still visible such as Orbit Lines <br>&gt;(Torus meshes I use to represent the planets orbital path) <br><br>Have you considered dual pass rendering for longer view distances?<br><br>near#=1.0<br>intermediate#=5000.0<br>far#=1000000.0<br><br>    ;far<br>    CameraRange cam,intermediate#,far# <br>    CameraClsMode cam,1,1 <br>    RenderWorld frameTween<br><br>    ;near <br>    CameraRange cam,near#,intermediate#+500 <br>    CameraClsMode cam,0,1 <br>    RenderWorld frameTween<br><br>    ;The overlap is to compensate for how B3D renders terrains with LOD etc... It shouldn't be needed for a meshes only world.<br><br>Change the near/far range to something larger...<br><br>Dual rendering is, however, very costly in graphics rendering time.<br><br>Andy <br><br></td></tr></table><br>
<a name="404561"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Andy</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Another thing you could do, is to change the near/far range to reflect the closest and furthest object...<br><br>Basically just calculate the distance from the camera to every object and set the near value to the closest distance-something and the far value to the furthest distance-something. Something being the width of the largest object in the game.<br><br>In the code above, you write: <br><br>'Rather than using controls to move the player, use them to move all your stuff around them!'<br><br>Just remember that calling it every frame is redundant, CPU intensive and can lead to problems with collision.<br><br>Andy <br><br></td></tr></table><br>
<a name="404831"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >-Rick-</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the feedback everyone!<br><br>I've managed to actually get things working well together now. My sollution to the moving too fast thing was to call the Housekeeping() function redundantly until it brought things back under control. There is no noticeable effect or loss of framerate from doing this and the camera can move from the outter orbit of Sedna (about 90 billion km away) back to Sol in about 5 seconds. Course this is on my computer - wait till i get a workable version for others to try and see what kind of headaches i get hehe<br><br>Pluto being only 6 billion km out can be traversed in about 2-3 seconds. I'm not sure out that smart cam works its speed, but it seems the farther you are the faster it runs heh.<br><br>Thanks for the ideas Andy. I'll give those a go and let you know how it works out. Thanks for all the help everyone! I've run into another small snafu that I'll stick in a seperate post to keep things topically correct. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
