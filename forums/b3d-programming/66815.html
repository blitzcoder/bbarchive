<!DOCTYPE html><html lang="en" ><head ><title >The Blitz3D 'Export Project'  wants YOU!</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >The Blitz3D 'Export Project'  wants YOU!</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >The Blitz3D 'Export Project'  wants YOU!</a><br><br>
<a name="746189"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >D4NM4N</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Prehaps this can be stickied?!?<br><br>Possible community project<br><br>What i am trying to do:<br>Compile an entire suite of SOLID, reliable exporters for b3d together in one place(here?) for tools developers (theyre a bit spread out in the codearcs &amp; not all are fully functional).<br><br>Im after ones that can save images etc. and mesh ones that can not only simply save a mesh, but <b>export everything exactly 'as is' from a mesh with children, all attached to a parent pivot</b>, complete with as many supported features (all surfs, textures, uvs, normals, color, alpha, blend, fx, specular etc.) as possible/are supported by the format.<br><br>If anyone has <b>complete</b> Static &amp; animated exporters for X, OBJ, B3D, COB, LWO, or any others and they work in the way described above, please add, stating the limitations/functions.<br><br><b>Please put all improvement posts/comments in the relevent codearcs pages to keep the topic clean</b><br><br>Importers are also welcome :)<br><br>The list so far:<br>-----------------------------------------------------------<br>TYPE: STATIC DIRECTX(Complete mesh hierachy) by dan at D-Grafix<br>www.blitzbasic.com/codearcs/codearcs.php?code=1906<br><br> It saves a complete mesh hierachy with texture refs, meshnames, colors, alpha, normals, MT Matricies etc. (cant get rid of specular shininess though (dont know which one it is and shine appears black!)<br>(thanks to shambler, i used your file template code for a guide to the X format:) Note for blender, remove all texture refs and giles doesnt seem to like the vertex color section (may cause vertex color 'rainbows')<br><br>------------------------------------------------------<br>TYPE: ANIMATED DIRECTX by B32<br>www.blitzbasic.com/codearcs/codearcs.php?code=1740<br><br>Limitations are: meshes don't work without using LoadAnimMesh, because the static versions are all placed at 0,0,0.<br>Another thing is, that it sometimes exports 'NAN' as a float, and some importers can't deal with it, so they have to be replaced with zeros<br>And, Blender doesn't load this file, because the Materials tag is incomplete. saves surfs, textures, uvs, normals<br>doesn't save: color, alpha, blend, fx, specular<br><br>-----------------------------------------------------<br>TYPE STATIC B3D (Single Mesh) by JFK<br>www.melog.ch/dl/saveb3d_2007a.zip<br><br>Can save only one mesh at a time, may be modified (parallel nodes in file). Due to the nature of it, it isn't SOLID nor ROBUST, nor CLEAN or BUGFREE at all, use at your own risk :) At least, it used to save a big map that was exported by giles "AS IS". The source also contains some info on how to save lights that can be read by giles.<br>There may be a problem with redundant texture references. I doubt it causes a memory leak, but if it does then I'd be glad if somebody's gonna help to debug it. (the problem is mentioned in the code) Make sure to read the notes in the source.<br><br><br>------------------------------------------------------------<br>TYPE: X &amp; B3D import/export By Devils Child<br>dc.chat-blitz.de/upload/files/Devils%20Child/[x]port.zip <br>its a framework with 3ds/b3d/x import and x export.<br><br><br><br>------------------------------------------------------<br>OTHERS (Not reported on/sorted yet) thankx b32:<br><br><div class="quote"> <br>These were all the links I could find in the archives:<br>Save X<br>www.blitzbasic.com/codearcs/codearcs.php?code=1906<br>Save 3DS<br>www.blitzbasic.com/codearcs/codearcs.php?code=1815<br>Save Anim B3D<br>www.blitzbasic.com/codearcs/codearcs.php?code=1794<br>SaveAnimFile<br>www.blitzbasic.com/codearcs/codearcs.php?code=1740<br>SingleFile<br>www.blitzbasic.com/codearcs/codearcs.php?code=1500<br>ASC saver<br>www.blitzbasic.com/codearcs/codearcs.php?code=1033<br>Save B3D<br>www.blitzbasic.com/codearcs/codearcs.php?code=866<br>ASE-&gt;B3D<br>www.blitzbasic.com/codearcs/codearcs.php?code=707<br>Save .X multisurface<br>www.blitzbasic.com/codearcs/codearcs.php?code=631<br>Save .X single surface<br>www.blitzbasic.com/codearcs/codearcs.php?code=111<br>Animb3D<br>www.blitzbasic.com/codearcs/codearcs.php?code=1764<br>B3D-&gt;XML-&gt;B3D<br>www.blitzbasic.com/codearcs/codearcs.php?code=665<br>import .cob/.scn<br>www.blitzbasic.com/codearcs/codearcs.php?code=335<br>Save DDS<br>www.blitzbasic.com/codearcs/codearcs.php?code=1813<br>Import OBJ<br>www.blitzbasic.com/codearcs/codearcs.php?code=1323<br>Load Giles .gls<br>www.blitzbasic.com/codearcs/codearcs.php?code=1134<br>Convert .X/.3DS-&gt;.B3D<br>www.blitzbasic.com/codearcs/codearcs.php?code=342<br>Save .TGA<br>www.blitzbasic.com/codearcs/codearcs.php?code=1<br>Save Stevies format :)<br>www.blitzbasic.com/Community/posts.php?topic=26973#283228<br>Save FLE<br>www.blitzbasic.com/toolbox/toolbox.php?tool=167<br>Save 3DS<br>www.blitzforum.de/forum/viewtopic.php?t=20214&amp;sid=9a9fdb3fe33470707f7c5c86e7b63b82<br>DX8-&gt;B3D<br>www.blitzbasic.com/toolbox/toolbox.php?tool=64<br> <br></div> <br><br></td></tr></table><br>
<a name="746190"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >D4NM4N</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> . <br><br></td></tr></table><br>
<a name="746200"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >b32</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I made an .x exporter too, with animation support:<br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=1740" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=1740</a><br>Limitations are: meshes don't work without using LoadAnimMesh, because the static versions are all placed at 0,0,0.<br>Another thing is, that it sometimes exports 'NAN' as a float, and some importers can't deal with it, so they have to be replaced with zeros<br>And, Blender doesn't load this file, because the Materials tag is incomplete.<br>I have worked on this, but I made it fit my own program. However it would be nice to update it sometime.<br>saves surfs, textures, uvs, normals<br>doesn't save: color, alpha, blend, fx, specular <br><br></td></tr></table><br>
<a name="746606"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> You know it's pretty easy to write a B3D mesh file. It's much harder to obtain information about a brush (fx, alpha, blendmode etc.) or about a texture (blend, flags, scale, rotation...) wich is required when you want to save a mesh that is stored in memory as a blitz mesh entity.<br><br>In this thread:<br><a href="http://www.blitzbasic.com/Community/posts.php?topic=66551" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=66551</a><br>I have released all my current "wisdom" about B3D export in Blitz3D. Based on those infos I used to write a static B3D exporter that actually works well. It is woven deeply into my app code, right now I ain't got the nerves to extract it, maybe later. <br><br></td></tr></table><br>
<a name="746663"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >b32</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I was thinking about writing an .OBJ exporter (lightwave). That format is pretty basic. It would be handy, because there are a lot of programs that can import it. However, it doesn't support much more than basic vertex/triangle information.<br>And I would like to make a more complete version of the animated .x exporter. Entityshininess/mesh color support would be nice. And maybe use the binary .x format instead of the text version.<br>Another idea would be making an importer, that converts other formats into .b3d before loading. I believe the newer versions of the .x format support vertex weights? Maybe it is possible to first convert such a file into a .b3d and then load it?<br>For my own project, the .obj exporter and the animated .x exporter would be handy, so I would mainly like to focus on those. <br><br></td></tr></table><br>
<a name="746714"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >D4NM4N</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> sounds a good idea binary would be great to save on huge filesize, but is difficult to debug.<br><br>"OBJ (lightwave)"<br>i though obj was wavefront and lwo was lightwave. could be wrong. <br><br></td></tr></table><br>
<a name="746816"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, i think the main pain about writing a .b3d exporter, was as jfk says, the brushes and textures. I also found a problem with finding the scaling and rotation of textures applied to a mesh. You can obviously read a .b3d file from the hard disc and find it's texture scale and rotation, but it would be a bit hard to read .x and .3ds files for this information. <br><br>You would also need the user to store his information, if he's coding an editor, in a certain way, so it can be retreived, because some information cannot be taken from meshes just using the blitz3d commands. Good luck and i'll try and help out when i get home. <br><br></td></tr></table><br>
<a name="746830"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >b32</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have updated the animated .x exporter. The transform matrix was not exported correctly. So, now the files can be loaded with LoadMesh as well.<br>www.blitzbasic.com/codearcs/codearcs.php?code=1740 <br><br></td></tr></table><br>
<a name="746939"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ross - yes you may read scaling and rotation etc. directly from the file, but I think it' smuch more handy to get them from the loaded entity, this way you can use all the powerful commands, like AddMEsh and so on, and then finally save the entity as it is displayed onscreen (see the thread I mentioned, scale and rotation can be retrieved) <br><br></td></tr></table><br>
<a name="747169"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> I agree jfk. I can at present save a supposed unlimited number of meshes to a .b3d file. BUT, the big problem is the texture list. When saving a .b3d file, you must list all the textures and brushes at the beginning of the file. SO, you'd need to first of all scan through every mesh, grab the brush's and texture's, and store them, then proceed to save.<br><br>The actual saving of the mesh(es) is easy and could be easily done with a recursive function. The hardest part is the textures/brushes.<br><br>I don't have much of an interest for saving animated entities. You would need the bones and weightings, which are currently not possible to get from the entity structure. <br><br></td></tr></table><br>
<a name="747180"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Another thought. I remember Beaker mentioning, parenting everything to a parent. Now, upon saving, you simply perform a recursive function, using FindChild. You should be able to search every entity without the use of types. <br><br></td></tr></table><br>
<a name="747284"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think it's possible to save multiple meshes in one B3D file using multiple (nested?) Nodes. Not sure if you can access the meshes as children. I guess you'd have to load them with LoadAnimMesh. Parsing the hierarchy recursively would also allow to seperate pivots from meshes using the EntityClass$(). Not sure if you have to/can nest the nodes.<br><br>Personally I never use this, because my editors first use AddMesh to unify the map to a single mesh with an optimized number of surfaces. a modified version of the SaveB3D from the code archives is used. Basicly the addition is little, just obtain the brush and tedxture properties as mentioned and use them instead of the static values of the example.<br><br>yes brush and texture was the hardest part, but finally it's done and it works with everything but DDS. when a dds texture is detected, the flags must be set manually cause I would need the TextureBuffer to retrieve the current flags, and that TextureBuffer is always zero with DDS textures. <br><br></td></tr></table><br>
<a name="748008"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, here's mine, latest B3D exporter. Can save only one mesh at a time, may be modified (parallel nodes in file). Due to the nature of it, it isn't SOLID nor ROBUST, nor CLEAN or BUGFREE at all, use at your own risk :) At least, it used to save a big map that was exported by giles "AS IS". The source also contains some info on how to save lights that can be read by giles.<br>There may be a problem with redundant texture references. I doubt it causes a memory leak, but if it does then I'd be glad if somebody's gonna help to debug it. (the problem is mentioned in the code)<br><br><a href="http://www.melog.ch/dl/saveb3d_2007a.zip" target="_blank">http://www.melog.ch/dl/saveb3d_2007a.zip</a><br>Make sure to read the notes in the source.<br><br>Now, since this thread is sticky and everything, how about somebody collects all links to export sources found in the archives and elsewhere, and lists them here, preferably in the very first post? Thanks. <br><br></td></tr></table><br>
<a name="748306"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >D4NM4N</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nice one(added it to list above), unfortunately havent had the time to look at it yet :( <br><br></td></tr></table><br>
<a name="748321"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >b32</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> He Dan, I updated my exporter, now it is compatible with LoadMesh and I added a Nan removal function. <br><br></td></tr></table><br>
<a name="748329"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh just realized there's a bug in my code. In the BRUS writing section a brush named lo_bru is created (Using GetSurfaceBrush()). This should be freed after processing, at the corresponding loop end. I'll update the zip, later. :-° <br><br></td></tr></table><br>
<a name="749559"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >b32</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> These were all the links I could find in the archives:<br>Save X<br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=1906" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=1906</a><br>Save 3DS<br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=1815" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=1815</a><br>Save Anim B3D<br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=1794" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=1794</a><br>SaveAnimFile<br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=1740" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=1740</a><br>SingleFile<br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=1500" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=1500</a><br>ASC saver<br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=1033" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=1033</a><br>Save B3D<br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=866" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=866</a><br>ASE-&gt;B3D<br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=707" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=707</a><br>Save .X multisurface<br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=631" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=631</a><br>Save .X single surface<br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=111" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=111</a><br>Animb3D<br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=1764" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=1764</a><br>B3D-&gt;XML-&gt;B3D<br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=665" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=665</a><br>import .cob/.scn<br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=335" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=335</a><br>Save DDS<br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=1813" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=1813</a><br>Import OBJ<br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=1323" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=1323</a><br>Load Giles .gls<br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=1134" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=1134</a><br>Convert .X/.3DS-&gt;.B3D<br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=342" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=342</a><br>Save .TGA<br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=1" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=1</a><br>Save Stevies format :)<br><a href="http://www.blitzbasic.com/Community/posts.php?topic=26973#283228" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=26973#283228</a><br>Save FLE<br><a href="http://www.blitzbasic.com/toolbox/toolbox.php?tool=167" target="_blank">http://www.blitzbasic.com/toolbox/toolbox.php?tool=167</a><br>Save 3DS<br><a href="http://www.blitzforum.de/forum/viewtopic.php?t=20214&amp;sid=9a9fdb3fe33470707f7c5c86e7b63b82" target="_blank">http://www.blitzforum.de/forum/viewtopic.php?t=20214&amp;sid=9a9fdb3fe33470707f7c5c86e7b63b82</a><br>DX8-&gt;B3D<br><a href="http://www.blitzbasic.com/toolbox/toolbox.php?tool=64" target="_blank">http://www.blitzbasic.com/toolbox/toolbox.php?tool=64</a> <br><br></td></tr></table><br>
<a name="749709"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wow, thanks! Finally, that's a lot! <br><br></td></tr></table><br>
<a name="749882"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>Save Stevies format :)<br>www.blitzbasic.com/Community/posts.php?topic=26973#283228<br> <br></div><br><br>What a useless piece of crap that format is!  Did it's job for me back in the day though ;) <br><br></td></tr></table><br>
<a name="750066"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >D4NM4N</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> Great list, thx <br><br></td></tr></table><br>
<a name="753550"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> i've been thinking about something like that previously, so i would like to make the framework!<br><br>in a few days or today, i will show a demo where we can develop on...<br><br>i think we need a name. how about "[x]port"? <br><br></td></tr></table><br>
<a name="753562"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> http://dc.chat-blitz.de/upload/files/Devils%20Child/[x]port.zip <br><br></td></tr></table><br>
<a name="753872"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> Before I download (sitting at a linux box here) What exactly is it?<br><br>There's also some news about my new AS-IS B3D exporter (see prev. post): Although it saves redundant textures (eg: the lightmap textures may be the same for many brushes, noless it's indexed multiple times), this doesn't seem to be a problem since Blitz will auto-optimize VRam usage, not only when you load a texture by code multiple times with the same flags and settings, but also if it's referenced multiple times in a mesh file.<br><br>The point is, a brush is described by texture indexes, so this makes the whole approach somewhat more compicated (or maybe there's a simple solution and I just don't see it right now, however).<br><br>I can save myself a lot of debugging work and forget about this. After all, a 2 MB map mesh is only a few kb bigger with this unoptimized texture list, and VRam usage is the same.<br><br>At least (unless I made a mistake), it seems to me that's the way it is. Confirmations welcome. <br><br></td></tr></table><br>
<a name="753889"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> its a framework with 3ds/b3d/x import and x export.<br>i'm sitting here and implementing more exports!<br><br>ps: updated: dc.chat-blitz.de/upload/files/Devils%20Child/[x]port.zip <br><br></td></tr></table><br>
<a name="754213"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ShadowTurtle</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey, jfk EO-11110. You forgot one thing: another 3D engines does not optimize all Object/Mesh/Textures directly after loading. At moment only Genesis3D, the Unreal-Engine (1-3) and Blitz3D does this. <br><br></td></tr></table><br>
<a name="754591"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> You're right, but then again Blitz3D is the target render Engine for this B3D exporter. I'd like to know how UU3D handles this. Giles for example would not optimize it, but this isn't a desaster since we usually import meshes without lightmaps in giles. After all, this allows to easily export a scene "AS IS" (with all visual fx such as blendmodes, vertex settings etc.) from within Blitz3D. I think currently there's no sustitute for it.<br><br>You are however welcome to add a texture list optimizer to the function :)  (Index references in the brushes must be altered correspondingly)<br><br>DC - sounds good! Keep it up! <br><br></td></tr></table><br>
<a name="755992"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >D4NM4N</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> oooh more stuff, cool<br><br>added and looking now :)<br><br>A real asset would be a dx92b3d bones. this would complement my spriteforge app nicely :) <br><br></td></tr></table><br>
<a name="756627"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >IPete2</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's funny how threads suddenly get your attention - great work going on here, what a great idea.<br><br>IPete2. <br><br></td></tr></table><br>
<a name="758434"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> here: i've been working on:<br>http://www.dc.chat-blitz.de/upload/files/Devils%20Child/[x]port.zip <br><br></td></tr></table><br>
<a name="760276"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Barliesque</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> Great work, Devil!  :) <br><br></td></tr></table><br>
<a name="766142"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >D4NM4N</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> added it :) <br><br></td></tr></table><br>
<a name="772705"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Alienforce</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#32">[#32]</a></td></tr></table></td></tr><tr ><td class="posttext"> Does anyone have any code for bvh ?? <br><br></td></tr></table><br>
<a name="773359"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#33">[#33]</a></td></tr></table></td></tr><tr ><td class="posttext"> There was a release, I named it "bvhdemo_bb.zip" when I downloaded it, not sure if this is the original name.<br><br>If you use the advanced search options of yahoo and search for "bvh" on the specific page www.blitzbasic.com then you'll find a lot of bvh discussion topics.<br><br>EDIT done some research, the 1st and second host has vanished, so I uploaded the blitz bvh demo here:<br><a href="http://www.melog.ch/dl/bvhdemo.zip" target="_blank">http://www.melog.ch/dl/bvhdemo.zip</a><br><br>Not much, a walking guy, using a "walk.bvh" file. (Not by me, BTW) <br><br></td></tr></table><br>
<a name="774122"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Alienforce</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#34">[#34]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks jfk. <br><br></td></tr></table><br>
<a name="800843"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >D4NM4N</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#35">[#35]</a></td></tr></table></td></tr><tr ><td class="posttext"> Has anyone got ones for avi, gif or mpeg? This would be fantastic if there is such code :D <br><br></td></tr></table><br>
<a name="801794"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#36">[#36]</a></td></tr></table></td></tr><tr ><td class="posttext"> avi export is in the code archives, in userlibs section. <br><br></td></tr></table><br>
<a name="850069"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Leon Drake</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#37">[#37]</a></td></tr></table></td></tr><tr ><td class="posttext"> i made an XMF/CMF cal3d importer exporter. i have yet to submit it. <br><br></td></tr></table><br>
<a name="910647"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Play</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#38">[#38]</a></td></tr></table></td></tr><tr ><td class="posttext"> Can somobody reupload the Devils Child's [x]port ? ;) <br><br></td></tr></table><br>
<a name="1206054"></a>

<a name="1206055"></a>

<a name="1206056"></a>

<a name="1206057"></a>

<a name="1206058"></a>

<a name="1206059"></a>

<a name="1206060"></a>

<a name="1206067"></a>

<a name="1206068"></a>

<a name="1206069"></a>

<a name="1206073"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#39">[#39]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry to bring up an old topic but just because I got sick &amp; tired of seeing the B3D2PMK / PMK2B3D example not working correctly, I decided to fix it for a project I'm working on because I needed animated B3D files exported.<br><br>Anyway, without further delay... The code..<br><br>b3dfile.bb: <br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">;
;b3d file utils to be included
;

Dim b3d_stack(100)
Global b3d_file,b3d_tos
Global br$ = Chr$(13)+Chr$(10)

Function b3dSetFile( file )
	b3d_tos=0
	b3d_file=file
End Function

;***** functions for reading from B3D files *****

Function b3dReadByte()
	Return ReadByte( b3d_file )
End Function

Function b3dReadInt()
	Return ReadInt( b3d_file )
End Function

Function b3dReadFloat#()
	Return ReadFloat( b3d_file )
End Function

Function b3dReadString$()
	Repeat
		ch=b3dReadByte()
		If ch=0 Return t$
		t$=t$+Chr$(ch)
	Forever
End Function

Function b3dReadChunk$()
	For k=1 To 4
		tag$=tag$+Chr$(b3dReadByte())
	Next
	sz=ReadInt( b3d_file )
	b3d_tos=b3d_tos+1
	b3d_stack(b3d_tos)=FilePos( b3d_file )+sz
	Return tag$
End Function

Function b3dExitChunk()
	SeekFile b3d_file,b3d_stack(b3d_tos)
	b3d_tos=b3d_tos-1
End Function

Function b3dChunkSize()
	Return b3d_stack(b3d_tos)-FilePos( b3d_file )
End Function

;***** Functions for writing to B3D files *****

Function b3dWriteByte( n )
	WriteByte( b3d_file,n )
End Function

Function b3dWriteInt( n )
	WriteInt( b3d_file,n )
End Function

Function b3dWriteFloat( n# )
	WriteFloat( b3d_file,n )
End Function

Function b3dWriteString( t$ )
	For k=1 To Len( t$ )
		ch=Asc(Mid$(t$,k,1))
		b3dWriteByte(ch)
		If ch=0 Return
	Next
	b3dWriteByte( 0 )
End Function

Function b3dBeginChunk( tag$ )
	b3d_tos=b3d_tos+1
	For k=1 To 4
		b3dWriteByte(Asc(Mid$( tag$,k,1 )))
	Next
	b3dWriteInt( 0 )
	b3d_stack(b3d_tos)=FilePos( b3d_file )
End Function

Function b3dEndChunk()
	n=FilePos( b3d_file )
	SeekFile b3d_file,b3d_stack(b3d_tos)-4
	b3dWriteInt( n-b3d_stack(b3d_tos) )
	SeekFile b3d_file,n
	b3d_tos=b3d_tos-1
End Function</textarea><br><br>PMK2B3D_example1.bb: <br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">Graphics3D 800,600, 16,2

Include "b3dfile.bb"

Dim PMK_tex_id%(255,255)
Const PMK_ERROR_NONE=True
Const PMK_ERROR_NOFILE=-1
Const PMK_ERROR_FILENOTVALID =-2
Const PMK_ERROR_WRONGVERSION =-3

Const PMK_FLAG_StripTexturePaths=1
Const PMK_FLAG_StripBrushPaths=2
Const PMK_FLAG_StripNodePaths=4
Const PMK_FLAG_SkipVertices=8
Const PMK_FLAG_SkipTriangles=16
Const PMK_FLAG_SkipKeys=32
Const PMK_FLAG_SkipWeights=64

Const PMK_MAX_KEYS = 5000
Const PMK_MAX_VRTS = 50000
Const PMK_MAX_TRIS = 20000
Const PMK_MAX_TEXS = 255
Const PMK_MAX_BRUS = 255

Global PMK_emf
Global PMK_xml$
Global PMK_xmlpos
Global PMK_xmlpos2
Global PMK_xmlpos3
Global PMK_kflags
Global PMK_brushtexcount
Global PMK_vflags
Global PMK_vtexsets
Global PMK_vtexsize

.types
Type  NodeChunk
	Field name$
	Field x_pos#				
	Field y_pos#
	Field z_pos#
	Field x_scl#
	Field y_scl#
	Field z_scl#
	Field w_rot#
	Field x_rot#
	Field y_rot#
	Field z_rot#
	Field gui_id%
	Field joint
	Field geo
	;Field bone.ray
	Field prename$
	Field class$
	Field xrot#
	Field yrot#
	Field zrot#
	Field norm=0
	;Field bp.bodypoint
	Field newborn=0
	Field Parent
	;Field rb.ODEGeom
	;Field loangle#=-Pi*0.25;-45 degrees
	;Field hiangle#=Pi*0.25;-45 degrees
	;Field Axis1=1
	;Field Axis2=2
	;Field joint_type% = 2
	;Field max_force#=0.0
	;Field vel#=0.0
	;Field angulardamp#=0.5
	;Field lineardamp#=0.5
	;Field fixed=False
	;Field nproxy
	Field anim_flags%,Num_Frames%,FramesPS#
	
	Field mesh_brush_id 
	
; VrtsChunk
	Field vrts_count%,vrts_flags%,texturecoordsets%,texturecoordsize%
	;fieldrS#[PMK_MAX_VRTS],gS#[PMK_MAX_VRTS],bS#[PMK_MAX_VRTS]
	Field vrts_index%[PMK_MAX_VRTS],x#[PMK_MAX_VRTS],y#[PMK_MAX_VRTS],z#[PMK_MAX_VRTS]
	Field u0#[PMK_MAX_VRTS],v0#[PMK_MAX_VRTS],w0#[PMK_MAX_VRTS];UVW coords
	Field u1#[PMK_MAX_VRTS],v1#[PMK_MAX_VRTS],w1#[PMK_MAX_VRTS];2nd UVW coords
	Field nx#[PMK_MAX_VRTS],ny#[PMK_MAX_VRTS],nz#[PMK_MAX_VRTS]
	Field r#[PMK_MAX_VRTS],g#[PMK_MAX_VRTS],b#[PMK_MAX_VRTS],a#[PMK_MAX_VRTS]
	Field vrts_ent%[PMK_MAX_VRTS],joint1%[PMK_MAX_VRTS],joint2%[PMK_MAX_VRTS],joint3%[PMK_MAX_VRTS],joint4%[PMK_MAX_VRTS]
	Field weight1#[PMK_MAX_VRTS],weight2#[PMK_MAX_VRTS],weight3#[PMK_MAX_VRTS],weight4#[PMK_MAX_VRTS]
	Field Frontfacing[PMK_MAX_VRTS]
;End
	
; BoneChunk
	Field weight_count%,vert_target%[PMK_MAX_VRTS],weight#[PMK_MAX_VRTS]
;End
	
; KeysChunk
	Field keys_flag%,keys_count%,moved=0
	Field frame%[PMK_MAX_KEYS],frameP%[PMK_MAX_KEYS],frameS%[PMK_MAX_KEYS],frameR%[PMK_MAX_KEYS]
	Field key_px#[PMK_MAX_KEYS],key_py#[PMK_MAX_KEYS],key_pz#[PMK_MAX_KEYS]
	Field key_sx#[PMK_MAX_KEYS],key_sy#[PMK_MAX_KEYS],key_sz#[PMK_MAX_KEYS]
	Field key_rw#[PMK_MAX_KEYS],key_rx#[PMK_MAX_KEYS],key_ry#[PMK_MAX_KEYS],key_rz#[PMK_MAX_KEYS]
	;Field key_qrw#[PMK_MAX_KEYS],key_qrx#[PMK_MAX_KEYS],key_qry#[PMK_MAX_KEYS],key_qrz#[PMK_MAX_KEYS]
	;Field key_brw#[PMK_MAX_KEYS],key_brx#[PMK_MAX_KEYS],key_bry#[PMK_MAX_KEYS],key_brz#[PMK_MAX_KEYS]
	;Field key_pitch#[PMK_MAX_KEYS],key_yaw#[PMK_MAX_KEYS],key_roll#[PMK_MAX_KEYS]
	;Field bone_w#,bone_x#,bone_y#,bone_z#
	
End Type

Type Texs
	Field mesh
	Field name$[PMK_MAX_TEXS]
	Field flags%[PMK_MAX_TEXS]
	Field blend%[PMK_MAX_TEXS]
	Field xpos#[PMK_MAX_TEXS]
	Field ypos#[PMK_MAX_TEXS]
	Field xscale#[PMK_MAX_TEXS]
	Field yscale#[PMK_MAX_TEXS]
	Field rot#[PMK_MAX_TEXS]
	Field texs_count%
End Type

Type Brus
	Field 	name$[PMK_MAX_BRUS]
	Field 	red#[PMK_MAX_BRUS]
	Field	grn#[PMK_MAX_BRUS]
	Field	blu#[PMK_MAX_BRUS]
	Field	alp#[PMK_MAX_BRUS]
	Field 	shi#[PMK_MAX_BRUS]
	Field 	blend%[PMK_MAX_BRUS]
	Field 	fx%[PMK_MAX_BRUS]
		;	Field   tex_id%[PMK_MAX_TEXS]
	Field   brus_count%
	Field   brus_tex_count%
End Type

Type TrisChunk
	Field mesh,tris_count%,tris_brush_id%,tv0%[PMK_MAX_TRIS],tv1%[PMK_MAX_TRIS],tv2%[PMK_MAX_TRIS]
End Type

Global b3dbrush.Brus
Global b3dtex.Texs
Global b3dnode.NodeChunk
Global b3dmesh.NodeChunk
Global b3dtris.TrisChunk
;Global b3dseq.sequence
Global Cnode.NodeChunk
Global DoneRefKey=False
Global retval

;Dim leaf(100)
Global NodeCount=0
Global NewJointNo=0
;Dim Joint(100)
Global level

Global frameindex
Global meshindex
Global animindex
Global orgmesh

Const recursive_resize=1024
Global recursive_bank=CreateBank(recursive_resize),recursive_size=recursive_resize
Global recursive_entity,recursive_parent,recursive_id,recursive_start,recursive_total,recursive_offset

Global cam = CreateCamera()
PositionEntity cam, 0, 1, -10
CameraRange cam, .1, 100000

file1$=CurrentDir$()+"Levels\Level_1\Meshes\good dwarf\dwarf1.b3d"
file2$=CurrentDir$()+"Levels\Level_1\Meshes\good dwarf\dwarf3.b3d"

Global mesh

;RuntimeError mesh

retval=b3d2pmk(file1$) ;Load and Parse Saving all info to types
If retval=PMK_ERROR_NONE
	Repeat
		Text 10,10,"Hit Enter to save Animated (static?) B3D mesh"
		Flip
	Until KeyHit(28) Or KeyHit(1)
	retval=pmk2b3d(file2$, mesh);Save animated model using values held in types
Else
	RuntimeError "Error loading file: "+Str(retval)
End If
FreeEntity mesh
FreeBank recursive_bank

Function StripPath$(name$)
	Local pos
	
	For pos=Len(name$) To 1 Step -1
		If Mid$(name$,pos,1)="\" Or Mid$(name$,pos,1)="/" Then Exit
	Next
	Return Right$(name$,Len(name$)-pos)
	
	
End Function

Function findchildentity(entity,name$)
	name$=Lower$(name$)
	recursive_parent=entity
	recursive_start=1
	recursive_offset=0
	.recursive_label
	recursive_total=CountChildren(recursive_parent)
	For recursive_id=recursive_start To recursive_total
		recursive_entity=GetChild(recursive_parent,recursive_id)
		If name$=Lower$(EntityName$(recursive_entity))
			Return recursive_entity
		Else
			If recursive_offset+8 &gt; recursive_size-1
				ResizeBank(recursive_bank,recursive_size+recursive_resize)
				recursive_size=recursive_size+recursive_resize
			End If
			PokeInt(recursive_bank,recursive_offset,recursive_id+1)
			PokeInt(recursive_bank,recursive_offset+4,recursive_parent)
			recursive_offset=recursive_offset+8
			recursive_start=1
			recursive_parent=recursive_entity
			Goto recursive_label
		End If
	Next
	If recursive_offset=0
		Return 0
	Else
		recursive_start=PeekInt(recursive_bank,recursive_offset-8)
		recursive_parent=PeekInt(recursive_bank,recursive_offset-4)
		recursive_offset=recursive_offset-8
		Goto recursive_label
	End If
End Function

Function AddressOf(Bank) ; Find the correct Adress of a Bank (for C *Pointer)
	Local Address = CreateBank(4) 
	api_RtlMoveMemory(Address,Bank+4,4) 
	Return PeekInt(Address,0) 
End Function

Function string_in_bank(s$,bankhandle) ; Put a String in a Bank
	Local pos=1
	Local pos2=0
	Repeat
		PokeByte(bankhandle,pos2,Asc(Mid(s$,pos,Len(s$))))
		pos=pos+1
		pos2=pos2+1
	Until pos=Len(s$)+1
End Function

Function bank_in_string$(bankhandle) ; Get a String from a Bank
	Local s$=""
	Local pos=0
	Repeat
		s$=s$+Chr(PeekByte(bankhandle,pos))
		pos=pos+1
	Until pos=BankSize(bankhandle)
	s$=Replace$(s$,Chr(0)," ")
	Return s$
End Function

Function b3d2pmk(b3dfile$,dumpflags=0)
	mesh=LoadAnimMesh(b3dfile$)
	Local file
	
	file=ReadFile( b3dfile$)
	If Not file Return PMK_ERROR_NOFILE
		
		b3dSetFile( file )
		
		If b3dReadChunk$()&lt;&gt;"BB3D"  Return PMK_ERROR_FILENOTVALID ;RuntimeError "Invalid b3d file"
			
			version=b3dReadInt()
			
			If version/100&gt;0 Return  PMK_ERROR_WRONGVERSION ;RuntimeError "Invalid b3d file version"
				
				DumpChunks(dumpflags,"*")
				
				b3dExitChunk()
				
				CloseFile file
				
				Return PMK_ERROR_NONE
				
End Function



Function DumpChunks(dumpflags, tab$="",level%=0)
	tt$=tab$
	tab$=tab$+"  "
	level%=level%+1
	While b3dChunkSize()
		chunk$=b3dReadChunk$()
		
		.anim		
		Select chunk$
			Case "SEQS"
				
		;	b3dseq.sequence=New sequence
		;	b3dseq\name$=b3dReadString()
		;	b3dseq\fstart%=b3dReadInt()
		;	b3dseq\fend%=b3dReadInt()
		;	b3dseq\seq%=ExtractAnimSeq (mesh,b3dseq\fstart%,b3dseq\fend%)
		;	b3dseq\gui_id=AddListBoxItem( lstSeq, 0, b3dseq\seq% + " - " + b3dseq\name$)
			Case "PHYS"
		;	b3dnode\joint_type=b3dReadInt()
		;	b3dnode\loangle#=b3dReadFloat() 
		;	b3dnode\hiangle#=b3dReadFloat() 
		;	b3dnode\Axis1=b3dReadInt() 
		;	b3dnode\Axis2=b3dReadInt() 	
				
				
			Case "ANIM"
				
				flags=b3dReadInt()
				n_frames=b3dReadInt()
				FPS=b3dReadFloat()			
				
				AnimFrames%=n_frames
		;	DebugLog "Anim Frames :" + AnimFrames
				AnimFPS#=FPS
				
			;___________________________________
				
				b3dnode\anim_flags%=flags
				b3dnode\Num_Frames%=n_frames
				b3dnode\FramesPS#=FPS
			;_____________________________________
				.keys
			Case "KEYS"
				
			;For mark=0 To PMK_MAX_KEYS;b3dmesh\Num_Frames%
			;			b3dnode\frame%[mark]=-1
			;			b3dnode\frameP%[mark]=-1
			;			b3dnode\frameS%[mark]=-1
			;			b3dnode\frameR%[mark]=-1
		;	Next 
				flags=b3dReadInt()
				
				
				
				
				b3dnode\keys_flag%=flags
				
				
				sz=4
				If flags And 1 sz=sz+12
					If flags And 2 sz=sz+12
						If flags And 4 sz=sz+16
							n_keys=b3dChunkSize()/sz
							b3dnode\keys_count%=n_keys
							
							
							
							If n_keys*sz=b3dChunkSize() 
								
								While b3dChunkSize()
									frame=b3dReadInt()
									
									
									
									b3dnode\frame%[frame]=frame
									
									
									If flags And 1
										b3dnode\frameP%[frame]=frame
										key_px#=b3dReadFloat()
										key_py#=b3dReadFloat()
										key_pz#=b3dReadFloat()
										
										
										
										b3dnode\key_px#[frame]=key_px#
										b3dnode\key_py#[frame]=key_py#
										b3dnode\key_pz#[frame]=key_pz#			
										
									EndIf
									
									If flags And 2
										b3dnode\frameS%[frame]=frame
										key_sx#=b3dReadFloat()
										key_sy#=b3dReadFloat()
										key_sz#=b3dReadFloat()
										
										
										
										b3dnode\key_sx#[frame]=key_sx#
										b3dnode\key_sy#[frame]=key_sy#
										b3dnode\key_sz#[frame]=key_sz#
										
									EndIf
									
									If flags And 4
										b3dnode\frameR%[frame]=frame
										key_rw#=b3dReadFloat()
										key_rx#=b3dReadFloat()
										key_ry#=b3dReadFloat()
										key_rz#=b3dReadFloat()
										
										
										
										b3dnode\key_rw#[frame]=key_rw#
										b3dnode\key_rx#[frame]=key_rx#
										b3dnode\key_ry#[frame]=key_ry#
										b3dnode\key_rz#[frame]=key_rz#
										
									EndIf
									
									
				;	If frame  &gt; highframe Then highframe=frame						
									
								Wend
							Else
				;;;DebugLog tab$+"***** Illegal number of keys *****"
							EndIf
						Case "TEXS"
							b3dtex.Texs=New Texs
							index=0
							While b3dChunkSize()
								name$=b3dReadString$()
								flags=b3dReadInt()
								blend=b3dReadInt()
								x_pos#=b3dReadFloat()
								y_pos#=b3dReadFloat()
								x_scl#=b3dReadFloat()
								y_scl#=b3dReadFloat()
								rot#=b3dReadFloat()
								
								
								
								If dumpflags And PMK_FLAG_StripTexturePaths Then  name$=StripPath(name$)
								
								
								
								
								
								b3dtex\name$[index]=name$
								b3dtex\flags%[index]=flags
								b3dtex\blend%[index]=blend
								b3dtex\xpos#[index]=x_pos#
								b3dtex\ypos#[index]=y_pos#
								b3dtex\xscale#[index]=x_scl#
								b3dtex\yscale#[index]=y_scl#
								b3dtex\rot#[index]=rot#
								
								index=index+1	
							Wend
							b3dtex\texs_count%=index
							.brus
						Case "BRUS"
							b3dbrush.Brus=New Brus
							n_texs=b3dReadInt()
							b3dbrush\brus_tex_count%=n_texs
							
							
							
							index=0
			;read all brushes in chunk...
							While b3dChunkSize()
								name$=b3dReadString$()
								red#=b3dReadFloat()
								grn#=b3dReadFloat()
								blu#=b3dReadFloat()
								alp#=b3dReadFloat()
								shi#=b3dReadFloat()
								blend=b3dReadInt()
								fx=b3dReadInt()
								
								
								
								b3dbrush\name$[index]=name$
								b3dbrush\red#[index]=red#
								b3dbrush\grn#[index]=grn#
								b3dbrush\blu#[index]=blu#
								b3dbrush\alp#[index]=alp#
								b3dbrush\shi#[index]=shi#
								b3dbrush\blend%[index]=blend
								b3dbrush\fx%[index]=fx
								
								
								
								
								
								If dumpflags And PMK_FLAG_StripBrushPaths Then  name$=StripPath(name$)
								
								
								
								
								For k=0 To n_texs-1
									tex_id=b3dReadInt()
									
									PMK_tex_id%(index,k)=tex_id
								Next
								
								
								index=index+1
							Wend
							b3dbrush\brus_count%=index
							
							
							
							.verts				
						Case "VRTS"
							flags=b3dReadInt()
							tc_sets=b3dReadInt()
							tc_size=b3dReadInt()
							sz=12+tc_sets*tc_size*4
							If flags And 1 Then sz=sz+12
							If flags And 2 Then sz=sz+16
							n_verts=b3dChunkSize()/sz
							
							
							
							
							
							
							
							
							b3dnode\vrts_count%=n_verts		
							b3dnode\vrts_flags%=flags
							b3dnode\texturecoordsets%=tc_sets
							b3dnode\texturecoordsize%=tc_size
							
							
							
							
							
							
							If n_verts*sz=b3dChunkSize() 
								index%=0
				;read all verts in chunk
								While b3dChunkSize()
									
									
									b3dnode\vrts_index%[index]=0; Used for Selection !
									
									
									x#=b3dReadFloat()
									y#=b3dReadFloat()
									z#=b3dReadFloat()
									
									
									
									b3dnode\x#[index]=x#
									b3dnode\y#[index]=y#
									b3dnode\z#[index]=z#
									
									
									
									
									
									
									
									
									
									
									
									
									
									If flags And 1
										nx#=b3dReadFloat()
										ny#=b3dReadFloat()
										nz#=b3dReadFloat()
										
										
										
										b3dnode\nx#[index]=nx#
										b3dnode\ny#[index]=ny#
										b3dnode\nz#[index]=nz#
										
										
									EndIf
									If flags And 2
										r#=b3dReadFloat()
										g#=b3dReadFloat()
										b#=b3dReadFloat()
										a#=b3dReadFloat()
										
										
										
										
										b3dnode\r#[index]=r#
										b3dnode\g#[index]=g#
										b3dnode\b#[index]=b#
										b3dnode\a#[index]=a#
										
										
									EndIf
;Parent vert boxes				
				;	b3dnode\vrts_ent[index]=CreateCube()
				;	NameEntity b3dnode\vrts_ent[index],index
				;	EntityColor b3dnode\vrts_ent[index],255,255,255
				;	EntityParent b3dnode\vrts_ent[index],b3dnode\joint
				;	PositionEntity b3dnode\vrts_ent[index],x,y,z,0
				;	ScaleMesh b3dnode\vrts_ent[index],.1,.1,.1
				;	b3dnode\rS#[index]=255
				;	b3dnode\gS#[index]=255
				;	b3dnode\bS#[index]=255
				;	EntityPickMode b3dnode\vrts_ent[index],2
									coordnameindex=0
									set=0
					;read tex coords...
									For j=1 To tc_sets*tc_size
										uvw#=b3dReadFloat()
										
										coordnameindex=coordnameindex + 1
										If coordnameindex&gt;tc_size Then
											coordnameindex =1
											set=set+1
										EndIf
										
										If coordnameindex=1
											cn$="u"
											If Not set Then
												b3dnode\u0#[index]=uvw
											Else
												b3dnode\u1#[index]=uvw
											End If
											
											
										ElseIf coordnameindex=2
											cn$="v"
											If Not set Then
												b3dnode\v0#[index]=uvw
											Else
												b3dnode\v1#[index]=uvw
											End If
											
											
											
										Else
											cn$="w"
											If Not set Then
												b3dnode\w0#[index]=uvw
											Else
												b3dnode\w1#[index]=uvw
											End If
											
											
											
										EndIf
										
										
										
									Next
									
									
									
									
									index=index+1
									
								Wend
							Else
				;;;DebugLog tab$+"***** Illegal number of vertices *****"
							EndIf
						Case "TRIS"
							b3dtris.TrisChunk=New TrisChunk
							
							brush_id=b3dReadInt()
							sz=12
							n_tris=b3dChunkSize()/sz
							
							
							
							
							b3dtris\tris_count%=n_tris
							b3dtris\tris_brush_id%=brush_id	
							
							.tris			
							If n_tris*sz=b3dChunkSize()
								index%=0
				;read all tris in chunk
								While b3dChunkSize()
									v0=b3dReadInt()
									v1=b3dReadInt()
									v2=b3dReadInt()
									
									
									b3dtris\tv0%[index]=v0
									b3dtris\tv1%[index]=v1
									b3dtris\tv2%[index]=v2
									index%=index%+1
								Wend
							Else
				;;;DebugLog tab$+"***** Illegal number of triangles *****"
							EndIf
						Case "MESH"
							brush_id=b3dReadInt()
							
							
							
							b3dnode\mesh_brush_id=brush_id
							b3dnode\class$="mesh"
							b3dmesh=b3dnode
			;HideEntity b3dmesh\geo				
							.bone			
						Case "BONE"
							
							
							sz=8
							n_weights=b3dChunkSize()/sz
							b3dnode\weight_count%=n_weights
							
							b3dnode\class$="bone"
							index%=0
							If n_weights*sz=b3dChunkSize()
				;read all weights
								While b3dChunkSize()
									vertex_id=b3dReadInt()
									weight#=b3dReadFloat()
									
			;		If weight#&gt;b3dnode\weight#[index]
									b3dnode\vert_target%[vertex_id]=1;vertex_id
									
									b3dnode\weight#[vertex_id]=weight
									
				;	Else
									
				;	n_weights=n_weights-1
				;	End If
									
				;	For tmp.NodeChunk=Each NodeChunk
				;	EntityParent b3dmesh\vrts_ent[vertex_id],b3dnode\joint
				;	DebugLog "Parenting "+ EntityName(b3dnode\vrts_ent[vertex_id])+" to "+ b3dnode\name$
									flag=0					
									If  b3dmesh\joint1[vertex_id]=0 And flag=0 Then
										b3dmesh\joint1[vertex_id]=b3dnode\joint
										b3dmesh\weight1#[vertex_id]=weight
										flag=1
									End If
									
									If  b3dmesh\joint2[vertex_id]=0 And flag=0 Then
										b3dmesh\joint2[vertex_id]=b3dnode\joint
										b3dmesh\weight2#[vertex_id]=weight
										flag=2
									End If
									
									If  b3dmesh\joint3[vertex_id]=0 And flag=0 Then 
										b3dmesh\joint3[vertex_id]=b3dnode\joint
										b3dmesh\weight3#[vertex_id]=weight
										flag=3
									End If
									
									If  b3dmesh\joint4[vertex_id]=0 And flag=0 Then
										b3dmesh\joint4[vertex_id]=b3dnode\joint
										b3dmesh\weight4#[vertex_id]=weight
										flag=4
									End If
									
									
									
									
									
									
									
									
									
									index%=index%+1
								Wend
							Else
				;;;DebugLog tab$+"***** Illegal number of bone weights *****"
							EndIf
							
							
							
							
							.nodes
						Case "NODE"
							
			;If level%&gt;1
							b3dnode.NodeChunk=New NodeChunk
		;	End If
							b3dnode\class$="root"			;
							name$=b3dReadString$()
							x_pos#=b3dReadFloat()
							y_pos#=b3dReadFloat()
							z_pos#=b3dReadFloat()
							x_scl#=b3dReadFloat()
							y_scl#=b3dReadFloat()
							z_scl#=b3dReadFloat()
							w_rot#=b3dReadFloat()
							x_rot#=b3dReadFloat()
							y_rot#=b3dReadFloat()
							z_rot#=b3dReadFloat()
	;		If w_rot#&lt;&gt;1.0 Then b3dnode\norm=1
							
							;RuntimeError "Mesh: "+Str(mesh)
							
							b3dnode\joint=findchildentity(mesh,name$)
		;	DebugLog "creating "+name$ +" "+ b3dnode\joint
							
							
							b3dnode\name$=name$
							b3dnode\x_pos#=x_pos#
							b3dnode\y_pos#=y_pos#
							b3dnode\z_pos#=z_pos#
							b3dnode\x_scl#=x_scl#
							b3dnode\y_scl#=y_scl#
							b3dnode\z_scl#=z_scl#
							b3dnode\w_rot#=w_rot#
							b3dnode\x_rot#=x_rot#
							b3dnode\y_rot#=y_rot#
							b3dnode\z_rot#=z_rot#
							
							For mark=0 To PMK_MAX_KEYS;b3dmesh\Num_Frames%
								b3dnode\frame%[mark]=-1
								b3dnode\frameP%[mark]=-1
								b3dnode\frameS%[mark]=-1
								b3dnode\frameR%[mark]=-1
							Next
			;b3dnode\loangle#=-45.0;-45;-Pi*0.25;-45 degrees
			;b3dnode\hiangle#=45.0;Pi*0.25;-45 degrees
			;b3dnode\Axis1=1
			;b3dnode\Axis2=2
			;b3dnode\joint_type% = 2
			;b3dnode\max_force#=0.0
			;b3dnode\vel#=0.0
			;b3dnode\angulardamp#=0.5
			;b3dnode\lineardamp#=0.5
			;b3dnode\nproxy=CreatePivot()
		;	DebugLog  b3dnode.NodeChunk\name$
							
							If b3dnode\joint=0 Then
		;b3dnode\gui_id=AddTreeViewNode( treeJoints, name$ );
	;	DebugLog "adding node  :"+b3dnode\name$ +"  parent="+b3dnode\joint+"   mesh="+mesh
								
							Else If GetParent(b3dnode\joint)=mesh Then
								
			;b3dnode\gui_id=AddTreeViewNode( treeJoints, name$ )
								b3dnode\Parent=mesh
							Else
								
								For tmp.Nodechunk=Each NodeChunk
	;	DebugLog "looking for.."+tmp\joint+"  parent   :"+GetParent (b3dnode\joint)
									If tmp\joint=GetParent (b3dnode\joint) Then
				;b3dnode\gui_id=AddTreeViewNode( tmp\gui_id, name$ )
			;	DebugLog "adding child node  :"+b3dnode\name$+"  to  "+ tmp\name$
				;dad.nodechunk=getnodechunk(GetParent (b3dnode\joint))
				;b3dnode\bone=createRay.ray(EntityX#(dad\joint,1),EntityY#(dad\joint,1),EntityZ#(dad\joint,1),EntityX#(b3dnode\joint,1),EntityY#(b3dnode\joint,1),EntityZ#(b3dnode\joint,1), punit#*0.1,dad\joint, 1)
				;EntityOrder b3dnode\bone\entity,-1
				;UpdateRay(b3dnode.nodechunk)
									Else 
										
			;b3dnode\gui_id=AddTreeViewNode( treeJoints, name$ )
									End If
								Next
								
							End If
							
	;b3dnode\geo=CreateSphere()
							hnd.NodeChunk=b3dnode.NodeChunk
	;NameEntity b3dnode\geo,"Sphere: " + name$
	;EntityPickMode b3dnode\geo,2
	;EntityAlpha b3dnode\geo,0.6
	;EntityOrder b3dnode\geo,-3
	;EntityColor b3dnode\geo,0,0,255
	;EntityParent b3dnode\geo,b3dnode\joint,0
	;EntityOrder b3dnode\geo,-1 - make optional 
	;HideEntity b3dnode\geo
	;If b3dnode\ent&gt;0 DebugLog EntityName(b3dnode\geo) + " : " + EntityName(b3dnode\ent)
	;joint(NodeCount)=CreateSphere();
	;ScaleEntity b3dnode\geo,.1,.1,.1;
	;EntityParent joint(NodeCount),findchildentity(mesh,name$),0;
	;NodeCount=NodeCount+1;
	;NewJointNo=NewJointNo+1
	;PositionEntity ball,x_pos#,y_pos#,z_pos# ,True
							
							If dumpflags And PMK_FLAG_StripNodePaths Then  name$=StripPath(name$)	
							
							
							
						Default
			; OBS untested!
							
	;		out$=BeginTag$(chunk$)
	;		out$=AddIntegerAttrib(out$,"size",b3dChunkSize())
	;		out$ = CloseTag(out$)				
	;		emit out$
							
	;		out$="&lt;![CDATA[" 
							
	;		While b3dChunkSize()
	;			out$=out$ + Chr$(b3dReadByte())	
	;		Wend
							
	;		out$=out$ + "]]&gt;"
	;		emit out$
							
							
					End Select
					
					DumpChunks(dumpflags, tab$,level%)	;dump any subchunks
					b3dExitChunk()					;exit this chunk
					
					
					
					
				Wend
End Function

;;;;;;;;;;;;;;;;;;;EXPORT FUNCTIONS:::::::::::::::::::::::::::::::::

Function pmk2b3d( f_name$,mesh )
	
	file=WriteFile( f_name$ )
	
	b3dSetFile( file )
	
	b3dBeginChunk( "BB3D" )
	DebugLog "Begin BB3d"
	b3dWriteInt( 1 )	;version
	If b3dtex.Texs&lt;&gt;Null  Then
		b3dBeginChunk("TEXS")
		DebugLog "Begin Chunk Texs"
		For x=0 To b3dtex\texs_count%-1
			b3dWriteString b3dtex\name$[x]
			b3dWriteInt b3dtex\flags%[x]
			b3dWriteInt b3dtex\blend%[x]
			b3dWritefloat b3dtex\xpos#[x]
			b3dWritefloat b3dtex\ypos#[x]
			b3dWritefloat b3dtex\xscale#[x]
			b3dWritefloat b3dtex\yscale#[x]
			b3dWritefloat b3dtex\rot#[x]
			
		Next
		
		b3dEndChunk();TEXS
		DebugLog "End Chunk Texs"
	End If								
	.brus			
	If b3dbrush.Brus &lt;&gt; Null Then
		For tmpbrush.brus=Each Brus
			
			b3dBeginChunk( "BRUS" )
			DebugLog "Begin Chunk Brus"
			b3dWriteInt tmpbrush\brus_tex_count%
			
			For x=0 To tmpbrush\brus_count%-1
																		;0 textures per brush
				b3dWriteString  tmpbrush\name$[x]		;name
				b3dWriteFloat   tmpbrush\red#[x]					;red
				b3dWriteFloat   tmpbrush\grn#[x] 					;green
				b3dWriteFloat   tmpbrush\blu#[x] 					;blue
				b3dWriteFloat   tmpbrush\alp#[x] 					;alpha
				b3dWriteFloat   tmpbrush\shi#[x] 				;shininess
				b3dWriteInt     tmpbrush\blend%[x] 					;blend
				b3dWriteInt     tmpbrush\fx%[x] 
				
				For k=0 To tmpbrush\brus_tex_count%-1
					b3dWriteInt PMK_tex_id% (x,k)
				Next
			;b3dWriteInt x
				
			Next	
			
			
			b3dEndChunk()	;end of BRUS chunk
			DebugLog "End Chunk Brus"
		Next
	End If
	DebugLog "Begin NODE Chunk"
	b3dBeginChunk("NODE")
	b3dWriteString b3dmesh\name$
	b3dWritefloat b3dmesh\x_pos#
	b3dWritefloat b3dmesh\y_pos#
	b3dWritefloat b3dmesh\z_pos#
	b3dWritefloat b3dmesh\x_scl#
	b3dWritefloat b3dmesh\y_scl#
	b3dWritefloat b3dmesh\z_scl#
	b3dWritefloat b3dmesh\w_rot#
	b3dWritefloat b3dmesh\x_rot#
	b3dWritefloat b3dmesh\y_rot#
	b3dWritefloat b3dmesh\z_rot#
	
	
	b3dBeginChunk("MESH")
	DebugLog tab$+"Begin Chunk Mesh"
	b3dWriteInt b3dmesh\mesh_brush_id
	
	b3dBeginChunk("VRTS")
	DebugLog tab$+"Begin Chunk Vrts"
	
	b3dWriteInt b3dmesh\vrts_flags%
	b3dWriteInt b3dmesh\texturecoordsets%
	b3dWriteInt b3dmesh\texturecoordsize%
	
	
	For x=0 To b3dmesh\vrts_count%-1
		
		
		b3dWritefloat b3dmesh\x#[x]
		b3dWritefloat b3dmesh\y#[x]
		b3dWritefloat b3dmesh\z#[x]
		
		
		
		If b3dmesh\vrts_flags% And 1
			b3dWritefloat b3dmesh\nx#[x]
			b3dWritefloat b3dmesh\ny#[x]
			b3dWritefloat b3dmesh\nz#[x]						
			
		EndIf
		If b3dmesh\vrts_flags% And 2
			b3dWritefloat b3dmesh\r#[x]
			b3dWritefloat b3dmesh\g#[x]
			b3dWritefloat b3dmesh\b#[x]
			b3dWritefloat b3dmesh\a#[x]
		EndIf
		
		
		If b3dmesh\texturecoordsets%=1 Then
			
			
			If b3dmesh\texturecoordsize%&gt;0 Then b3dWritefloat b3dmesh\u0#[x]
			If b3dmesh\texturecoordsize%&gt;1 Then b3dWritefloat b3dmesh\v0#[x]				
			If b3dmesh\texturecoordsize%&gt;2 Then b3dWritefloat b3dmesh\w0#[x]
			
		End If
		
		If b3dmesh\texturecoordsets%=2 Then
			
			If b3dmesh\texturecoordsize%&gt;0 Then b3dWritefloat b3dmesh\u0#[x]
			If b3dmesh\texturecoordsize%&gt;1 Then b3dWritefloat b3dmesh\v0#[x]				
			If b3dmesh\texturecoordsize%&gt;2 Then b3dWritefloat b3dmesh\w0#[x]
			
			If b3dmesh\texturecoordsize%&gt;0 Then b3dWritefloat b3dmesh\u1#[x]
			If b3dmesh\texturecoordsize%&gt;1 Then b3dWritefloat b3dmesh\v1#[x]				
			If b3dmesh\texturecoordsize%&gt;2 Then b3dWritefloat b3dmesh\w1#[x]
			
		End If
		
		
		
		
		
	Next
	b3dEndChunk();VRTS
	DebugLog tab$+"End Chunk Vrts"
	For b3dtris.TrisChunk=Each TrisChunk
		
		b3dBeginChunk("TRIS")
		DebugLog tab$+"Begin Chunk Tris"
		
		b3dWriteInt b3dtris\tris_brush_id%
		
		For x = 0 To b3dtris\tris_count%-1
			
			b3dWriteInt b3dtris\tv0%[x]
			b3dWriteInt b3dtris\tv1%[x]
			b3dWriteInt b3dtris\tv2%[x]
		Next
		
		b3dEndChunk();TRIS
		
	Next
	
	DebugLog tab$+"End Chunk Tris"
	
	
	
	
	
	
	b3dEndChunk();MESH
	DebugLog tab$+"End Chunk Mesh"
	
	b3dBeginChunk("ANIM")
	DebugLog tab$+"Begin Chunk Anim"
	b3dWriteInt b3dmesh\anim_flags%
	b3dWriteInt b3dmesh\Num_Frames%
	b3dWriteFloat b3dmesh\FramesPS#
	b3dEndChunk();ANIM
	DebugLog tab$+"End Chunk Anim"
	
	If CountChildren(mesh)&gt;0 Then	
		WriteNodes(mesh); write joint hierarchy
		
	End If
	
	
	
	
	DebugLog "End Chunk ROOT"	
	b3dEndChunk();End B3D Chunk
	
	
	CloseFile  file
	Return PMK_ERROR_NONE
	
End Function

Function WriteNodes(parent,tab$="")
	tab$=tab$+"	 "
	WriteNode (parent,tab$)
	If CountChildren(parent)&gt;0 Then
		For a=1 To CountChildren(parent)
		 	child=GetChild(parent,a)
			fin=WriteNodes(child,tab$)
			
			
		Next
	End If
	b3dEndChunk(); end NODE chunk
	DebugLog tab$+"End Chunk NOde ***********"+ EntityName(parent)
	
	
	
	
	;If parent=mesh Then	b3dEndChunk(); end NODE chunk
	;DebugLog tab$+"End Chunk NOde"+ currname$
	
	
	
End Function







Function WriteNode(child,tab$)
	For tmp.NodeChunk=Each NodeChunk
		If tmp\joint=child And tmp\class$="bone" Then
			currname$=tmp\name$
			
			b3dBeginChunk("NODE")
			DebugLog tab$+"Begin Chunk Node  "+currname$
			b3dWriteString tmp\name$
			b3dWritefloat tmp\x_pos#
			b3dWritefloat tmp\y_pos#
			b3dWritefloat tmp\z_pos#
			b3dWritefloat tmp\x_scl#
			b3dWritefloat tmp\y_scl#
			b3dWritefloat tmp\z_scl#
			b3dWritefloat tmp\w_rot#
			b3dWritefloat tmp\x_rot#
			b3dWritefloat tmp\y_rot#
			b3dWritefloat tmp\z_rot#
			
			
			
			
			
			
			
			If tmp\class$="bone" Then
				b3dBeginChunk("BONE")
				DebugLog tab$+"Begin Chunk Bone"
				
				;If tmp\weight_count%&gt;0
				For x=0 To b3dmesh\vrts_count%-1
					If tmp\vert_target[x]=1
						b3dWriteInt x
						b3dWriteFloat tmp\weight#[x]
					;	DebugLog tab$+"VERT "+tmp\vert_target%[x]+"  WEIGHT "+tmp\weight#[x]
					End If
				Next
				;End If
				b3dEndChunk(); end BONE Chunk
				DebugLog tab$+"End Chunk Bone"
				
				
				
				If tmp\keys_count%&gt;0 Then 
					b3dBeginChunk("KEYS")
					DebugLog tab$+"Begin Chunk Keys"
					
					b3dWriteInt (1);Compressed for now....Pos and Rot only - get flag value at import
					
					For x=0 To PMK_MAX_KEYS-1;animframes;b3dmesh\Num_Frames%
						If tmp\frameP%[x]&gt;-1 Then
							b3dWriteInt x
							
				;	If tmp\keys_flag% And 1
							
							b3dWritefloat tmp\key_px#[x]
							b3dWritefloat tmp\key_py#[x]
							b3dWritefloat tmp\key_pz#[x]
							
				;	EndIf
							
				;	If tmp\keys_flag% And 2
							
				;	b3dWritefloat (1.0);tmp\key_sx#[x]
				;	b3dWritefloat (1.0);tmp\key_sy#[x]
				;	b3dWritefloat (1.0);tmp\key_sz#[x]
							
				;	End If
							
				;	If tmp\keys_flag% And 4
							
				;	b3dWritefloat tmp\key_rw#[x]
				;	b3dWritefloat tmp\key_rx#[x]
				;	b3dWritefloat tmp\key_ry#[x]
				;	b3dWritefloat tmp\key_rz#[x]
						End If
					Next
					
					b3dEndChunk(); end KEYS chunk
					
			;b3dBeginChunk("KEYS")
			;	DebugLog tab$+"Begin Chunk Keys"
					
			;	b3dWriteInt (2);Compressed for now....Pos and Rot only - get flag value at import
					
			;	For x=0 To PMK_MAX_KEYS-1;b3dmesh\Num_Frames%
			;		If tmp\frameS%[x]&gt;-1 Then
			;		b3dWriteInt x
					
				;	If tmp\keys_flag% And 1
					
				;	b3dWritefloat tmp\key_px#[x]
				;	b3dWritefloat tmp\key_py#[x]
				;	b3dWritefloat tmp\key_pz#[x]
					
				;	EndIf
					
				;	If tmp\keys_flag% And 2
					
			;		b3dWritefloat tmp\key_sx#[x]
			;		b3dWritefloat tmp\key_sy#[x]
			;		b3dWritefloat tmp\key_sz#[x]
					
				;	End If
					
				;	If tmp\keys_flag% And 4
					
				;	b3dWritefloat tmp\key_rw#[x]
				;	b3dWritefloat tmp\key_rx#[x]
				;	b3dWritefloat tmp\key_ry#[x]
				;	b3dWritefloat tmp\key_rz#[x]
			;		End If
			;	Next
					
		;	b3dEndChunk(); end KEYS chunk
					
					b3dBeginChunk("KEYS")
					DebugLog tab$+"Begin Chunk Keys"
					
					b3dWriteInt (4);Compressed for now....Pos and Rot only - get flag value at import
					
					For x=0 To PMK_MAX_KEYS-1;b3dmesh\Num_Frames%
						If tmp\frameR%[x]&gt;-1 Then
							b3dWriteInt x
							
				;	If tmp\keys_flag% And 1
							
				;	b3dWritefloat tmp\key_px#[x]
				;	b3dWritefloat tmp\key_py#[x]
				;	b3dWritefloat tmp\key_pz#[x]
							
				;	EndIf
							
				;	If tmp\keys_flag% And 2
							
				;	b3dWritefloat (1.0);tmp\key_sx#[x]
				;	b3dWritefloat (1.0);tmp\key_sy#[x]
				;	b3dWritefloat (1.0);tmp\key_sz#[x]
							
				;	End If
							
				;	If tmp\keys_flag% And 4
							
							b3dWritefloat tmp\key_rw#[x]
							b3dWritefloat tmp\key_rx#[x]
							b3dWritefloat tmp\key_ry#[x]
							b3dWritefloat tmp\key_rz#[x]
						End If
					Next
					
					b3dEndChunk(); end KEYS chunk
			;PMK_write_physics_nodes(tmp.nodechunk)
					DebugLog tab$+"End Chunk Keys"
			;b3dEndChunk();End Node
					Return True
				End If
			End If
			
		End If			
		
	Next
	Return False
End Function</textarea><br><br>I hope you enjoy!<br><br>To use, simply change the location of "file1$" &amp; "file2$".<br><br>"file1$" is the location of the mesh you wish to create an exported, animated B3D mesh FROM.<br>"file2$" is the location AND NEW file name of the exported B3D animated mesh.<br><br>NOTE 1: If the textures are not embedded WITHIN the model, do NOT forget to add ALL relevant texture files to the same folder as both the "file1$" anim B3D file, &amp; the "file2$" anim B3D file.<br><br>NOTE 2: Milkshape exported, animated B3D models MAY or MAY NOT load. If not, the program will crash. So far, however, I have NOT experienced a crash after fixing this. <br><br></td></tr></table><br>
<a name="1206149"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Happy Sammy</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#40">[#40]</a></td></tr></table></td></tr><tr ><td class="posttext"> (bookmarked) <br><br></td></tr></table><br>
<a name="1207607"></a>

<a name="1207608"></a>

<a name="1207609"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#41">[#41]</a></td></tr></table></td></tr><tr ><td class="posttext"> Attention all. After about 5 hours of testing today with the help of a GREAT friend, I have discovered that the function "DumpChunks()" has a HUGE memory leak. After only saving ONE 3D animated, multi-textured dwarf B3D file, we were FINALLY able to narrow the memory leak down to the function, "DumpChunks()". This is a HUGE problem, because the amount of memory for 1 dwarf to be exported is ~ 300/320 MB processing memory. Which is NOT good at all. If anyone could locate, confirm, and destroy this bug, that would be GREAT. I've been at this problem for 5 hours, probably going on another 10 tomorrow.<br><br>Thank you all!<br><br>Guy Fawkes <br><br></td></tr></table><br>
<a name="1207617"></a>

<a name="1207626"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#42">[#42]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ahahah, always the same thing with you, "i have improved the code of another coder, but now there is a problem".<br>Debuglog("")<br>Flushkeys()<br>Waitkey()<br>are your friends if you need to find a bug. <br><br></td></tr></table><br>
<a name="1207801"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#43">[#43]</a></td></tr></table></td></tr><tr ><td class="posttext"> Worked on it some more yesterday, making very little headway. Anyone care to chime in? <br><br></td></tr></table><br>
<a name="1207817"></a>

<a name="1207818"></a>

<a name="1207819"></a>

<a name="1207823"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#44">[#44]</a></td></tr></table></td></tr><tr ><td class="posttext"> Are you sure that this is a memory leak and not simply the dim arrays or banks which take so much memory ?<br><br>Have you tried to import, then to analyze (surfaces, triangles per surface, vertices per surface, materials, textures, etc...), then to export a simple mesh, like a cube ?<br><br>I have not tried the code but this is what i would do. It can be very difficult to see where is the problem with a complex mesh. I would try to debug step by step with a simple mesh first.<br><br>Good luck <br><br></td></tr></table><br>
<a name="1207829"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#45">[#45]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yea, I did try that. I found out that the problem lies inside the "DumpChunks()" function. I used multiple "Stops" as well as multiple "DebugLogs". <br><br></td></tr></table><br>
<a name="1208848"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#46">[#46]</a></td></tr></table></td></tr><tr ><td class="posttext"> I even made my own DLL to check the exact amount of bytes that my current blitzcc file was using, and still to no avail. Alls I know, is the bug is DEFINITELY in "DumpChunks()".<br><br>I've tried Stop(). I've tried DebugLog.. I've gone line by line and added a stop, I've used the debug stepper mode... I've tried everything. and something is causing it to memory leak and wrack up on almost 1 GB of memory usage.. <br><br></td></tr></table><br>
<a name="1208875"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#47">[#47]</a></td></tr></table></td></tr><tr ><td class="posttext"> There's GIF routines in the code arcs too... <br>If I don't find the links I have the code saved somewhere... <br><br></td></tr></table><br>
<a name="1208884"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#48">[#48]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm not after a 2D image strip animation. I just want to destroy this memory leak and move on with life. <br><br></td></tr></table><br>
<a name="1208916"></a>

<a name="1208918"></a>

<a name="1208919"></a>

<a name="1208920"></a>

<a name="1208921"></a>

<a name="1208922"></a>

<a name="1208923"></a>

<a name="1208924"></a>

<a name="1208925"></a>

<a name="1208926"></a>

<a name="1208927"></a>

<a name="1208928"></a>

<a name="1208929"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#49">[#49]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, so after a rather long &amp; boring process, my friend and I were able to isolate which functions in memory might be causing the memory leak.<br><br>Here is a list of total sizes: <br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">---- .b3dChunkSize(). -------------------------- 
 total mem used = 336596992 = 336 mega (approx) 
 visit count = 154
                 
 total mem freed = 4096
 net mem used   =  336592896
                 
 ---- .While b3dChunkSize(). -------------------------- 
 total mem used = 336601088 = 336 mega (approx) 
 visit count = 29
                 
 total mem freed = 4096
 net mem used   =  336596992
                 
 ---- .chunk$=b3dReadChunk$(). -------------------------- 
 total mem used = 0
 visit count = 167
                 
 ---- .Select chunk$. -------------------------- 
 total mem used = 251359232 = 251 mega (approx) 
 visit count = 167
                 
 total mem freed = 4096
 net mem used   =  251355136
                 
 ---- .TEXS. -------------------------- 
 total mem used = 126976
 visit count = 1
                 
 ---- DumpChunks(dumpflags, tab$,level%)_2 -------------------------- 
 total mem used = 336596992 = 336 mega (approx) 
 visit count = 154
                 
 total mem freed = 4096
 net mem used   =  336592896
                 
 ---- .b3dExitChunk(). -------------------------- 
 total mem used = 0
 visit count = 154
                 
 total mem freed = 4096
 net mem used   =  -4096
                 
 ---- .BRUS. -------------------------- 
 total mem used = 0
 visit count = 1
                 
 ---- .NODE. -------------------------- 
 total mem used = 250224640 = 250 mega (approx) 
 visit count = 41
                 
 ---- .MESH. -------------------------- 
 total mem used = 0
 visit count = 1
                 
 ---- .VRTS. -------------------------- 
 total mem used = 0
 visit count = 1
                 
 total mem freed = 4096
 net mem used   =  -4096
                 
 ---- .TRIS. -------------------------- 
 total mem used = 1007616 = 1 mega (approx) 
 visit count = 4
                 
 ---- .ANIM. -------------------------- 
 total mem used = 0
 visit count = 1
                 
 ---- .BONE. -------------------------- 
 total mem used = 0
 visit count = 39
                 
 ---- .KEYS. -------------------------- 
 total mem used = 0
 visit count = 78</textarea><br><br>As you can clearly see, I get a megabyte memory usage total just after saving only "<b><i>1</i></b>" "<i><b>dwarf1.b3d</b></i>" mesh, of "<i>336 <b>megabytes</b>, <b>approximately</b></i>". This should NOT happen.<br><br>Also, ".NODE" is being called "<i><b>41 times</b></i>", which most likely ALSO should NOT be happening.<br><br>So this memory leak has SOMETHING to do with the " <i>Case "Node"</i> " section inside the function, "<i>DumpChunks()</i>". <br><br></td></tr></table><br>
<a name="1208948"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#50">[#50]</a></td></tr></table></td></tr><tr ><td class="posttext"> How many surfaces has your mesh ?<br>How many vertices per surface has your mesh ?<br>How many triangles per surface has your mesh ?<br>How many materials has your mesh ?<br>How many joints has your mesh ?<br>How many animation frames has your mesh ?<br>Do the routines use arrays or banks to store the datas ?<br><br>Knowing this you can calculate an estimation of the maximum memory it should take. <br><br></td></tr></table><br>
<a name="1208997"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#51">[#51]</a></td></tr></table></td></tr><tr ><td class="posttext"> What program is free that I can use to get these values? <br><br></td></tr></table><br>
<a name="1209002"></a>

<a name="1209003"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#52">[#52]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can retrieve these infos with Blitz3d.<br>or<br>Try the demo version of Fragmotion<br><a href="http://www.fragmosoft.com/downloads/" target="_blank">http://www.fragmosoft.com/downloads/</a><br><br>Why do you think it is a memory leak ? The code may use a lot of memory space without being necessarily a memory leak.<br><br>PS : i have not read the code... <br><br></td></tr></table><br>
<a name="1209007"></a>

<a name="1209008"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#53">[#53]</a></td></tr></table></td></tr><tr ><td class="posttext"> Memory leak function: <br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">Function DumpChunks(dumpflags, tab$="",level%=0)
	tt$=tab$
	tab$=tab$+"  "
	level%=level%+1
	While b3dChunkSize()
		chunk$=b3dReadChunk$()
		
		.anim		
		Select chunk$
			Case "SEQS"
				
		;	b3dseq.sequence=New sequence
		;	b3dseq\name$=b3dReadString()
		;	b3dseq\fstart%=b3dReadInt()
		;	b3dseq\fend%=b3dReadInt()
		;	b3dseq\seq%=ExtractAnimSeq (mesh,b3dseq\fstart%,b3dseq\fend%)
		;	b3dseq\gui_id=AddListBoxItem( lstSeq, 0, b3dseq\seq% + " - " + b3dseq\name$)
			Case "PHYS"
		;	b3dnode\joint_type=b3dReadInt()
		;	b3dnode\loangle#=b3dReadFloat() 
		;	b3dnode\hiangle#=b3dReadFloat() 
		;	b3dnode\Axis1=b3dReadInt() 
		;	b3dnode\Axis2=b3dReadInt() 	
				
				
			Case "ANIM"
				
				flags=b3dReadInt()
				n_frames=b3dReadInt()
				FPS=b3dReadFloat()			
				
				AnimFrames%=n_frames
		;	DebugLog "Anim Frames :" + AnimFrames
				AnimFPS#=FPS
				
			;___________________________________
				
				b3dnode\anim_flags%=flags
				b3dnode\Num_Frames%=n_frames
				b3dnode\FramesPS#=FPS
			;_____________________________________
				.keys
			Case "KEYS"
				
			;For mark=0 To PMK_MAX_KEYS;b3dmesh\Num_Frames%
			;			b3dnode\frame%[mark]=-1
			;			b3dnode\frameP%[mark]=-1
			;			b3dnode\frameS%[mark]=-1
			;			b3dnode\frameR%[mark]=-1
		;	Next 
				flags=b3dReadInt()
				
				
				
				
				b3dnode\keys_flag%=flags
				
				
				sz=4
				If flags And 1 sz=sz+12
					If flags And 2 sz=sz+12
						If flags And 4 sz=sz+16
							n_keys=b3dChunkSize()/sz
							b3dnode\keys_count%=n_keys
							
							
							
							If n_keys*sz=b3dChunkSize() 
								
								While b3dChunkSize()
									frame=b3dReadInt()
									
									
									
									b3dnode\frame%[frame]=frame
									
									
									If flags And 1
										b3dnode\frameP%[frame]=frame
										key_px#=b3dReadFloat()
										key_py#=b3dReadFloat()
										key_pz#=b3dReadFloat()
										
										
										
										b3dnode\key_px#[frame]=key_px#
										b3dnode\key_py#[frame]=key_py#
										b3dnode\key_pz#[frame]=key_pz#			
										
									EndIf
									
									If flags And 2
										b3dnode\frameS%[frame]=frame
										key_sx#=b3dReadFloat()
										key_sy#=b3dReadFloat()
										key_sz#=b3dReadFloat()
										
										
										
										b3dnode\key_sx#[frame]=key_sx#
										b3dnode\key_sy#[frame]=key_sy#
										b3dnode\key_sz#[frame]=key_sz#
										
									EndIf
									
									If flags And 4
										b3dnode\frameR%[frame]=frame
										key_rw#=b3dReadFloat()
										key_rx#=b3dReadFloat()
										key_ry#=b3dReadFloat()
										key_rz#=b3dReadFloat()
										
										
										
										b3dnode\key_rw#[frame]=key_rw#
										b3dnode\key_rx#[frame]=key_rx#
										b3dnode\key_ry#[frame]=key_ry#
										b3dnode\key_rz#[frame]=key_rz#
										
									EndIf
									
									
				;	If frame  &gt; highframe Then highframe=frame						
									
								Wend
							Else
				;;;DebugLog tab$+"***** Illegal number of keys *****"
							EndIf
						Case "TEXS"
							b3dtex.Texs=New Texs
							index=0
							While b3dChunkSize()
								name$=b3dReadString$()
								flags=b3dReadInt()
								blend=b3dReadInt()
								x_pos#=b3dReadFloat()
								y_pos#=b3dReadFloat()
								x_scl#=b3dReadFloat()
								y_scl#=b3dReadFloat()
								rot#=b3dReadFloat()
								
								
								
								If dumpflags And PMK_FLAG_StripTexturePaths Then  name$=StripPath(name$)
								
								
								
								
								
								b3dtex\name$[index]=name$
								b3dtex\flags%[index]=flags
								b3dtex\blend%[index]=blend
								b3dtex\xpos#[index]=x_pos#
								b3dtex\ypos#[index]=y_pos#
								b3dtex\xscale#[index]=x_scl#
								b3dtex\yscale#[index]=y_scl#
								b3dtex\rot#[index]=rot#
								
								index=index+1	
							Wend
							b3dtex\texs_count%=index
							.brus
						Case "BRUS"
							b3dbrush.Brus=New Brus
							n_texs=b3dReadInt()
							b3dbrush\brus_tex_count%=n_texs
							
							
							
							index=0
			;read all brushes in chunk...
							While b3dChunkSize()
								name$=b3dReadString$()
								red#=b3dReadFloat()
								grn#=b3dReadFloat()
								blu#=b3dReadFloat()
								alp#=b3dReadFloat()
								shi#=b3dReadFloat()
								blend=b3dReadInt()
								fx=b3dReadInt()
								
								
								
								b3dbrush\name$[index]=name$
								b3dbrush\red#[index]=red#
								b3dbrush\grn#[index]=grn#
								b3dbrush\blu#[index]=blu#
								b3dbrush\alp#[index]=alp#
								b3dbrush\shi#[index]=shi#
								b3dbrush\blend%[index]=blend
								b3dbrush\fx%[index]=fx
								
								
								
								
								
								If dumpflags And PMK_FLAG_StripBrushPaths Then  name$=StripPath(name$)
								
								
								
								
								For k=0 To n_texs-1
									tex_id=b3dReadInt()
									
									PMK_tex_id%(index,k)=tex_id
								Next
								
								
								index=index+1
							Wend
							b3dbrush\brus_count%=index
							
							
							
							.verts				
						Case "VRTS"
							flags=b3dReadInt()
							tc_sets=b3dReadInt()
							tc_size=b3dReadInt()
							sz=12+tc_sets*tc_size*4
							If flags And 1 Then sz=sz+12
							If flags And 2 Then sz=sz+16
							n_verts=b3dChunkSize()/sz
							
							
							
							
							
							
							
							
							b3dnode\vrts_count%=n_verts		
							b3dnode\vrts_flags%=flags
							b3dnode\texturecoordsets%=tc_sets
							b3dnode\texturecoordsize%=tc_size
							
							
							
							
							
							
							If n_verts*sz=b3dChunkSize() 
								index%=0
				;read all verts in chunk
								While b3dChunkSize()
									
									
									b3dnode\vrts_index%[index]=0; Used for Selection !
									
									
									x#=b3dReadFloat()
									y#=b3dReadFloat()
									z#=b3dReadFloat()
									
									
									
									b3dnode\x#[index]=x#
									b3dnode\y#[index]=y#
									b3dnode\z#[index]=z#
									
									
									
									
									
									
									
									
									
									
									
									
									
									If flags And 1
										nx#=b3dReadFloat()
										ny#=b3dReadFloat()
										nz#=b3dReadFloat()
										
										
										
										b3dnode\nx#[index]=nx#
										b3dnode\ny#[index]=ny#
										b3dnode\nz#[index]=nz#
										
										
									EndIf
									If flags And 2
										r#=b3dReadFloat()
										g#=b3dReadFloat()
										b#=b3dReadFloat()
										a#=b3dReadFloat()
										
										
										
										
										b3dnode\r#[index]=r#
										b3dnode\g#[index]=g#
										b3dnode\b#[index]=b#
										b3dnode\a#[index]=a#
										
										
									EndIf
;Parent vert boxes				
				;	b3dnode\vrts_ent[index]=CreateCube()
				;	NameEntity b3dnode\vrts_ent[index],index
				;	EntityColor b3dnode\vrts_ent[index],255,255,255
				;	EntityParent b3dnode\vrts_ent[index],b3dnode\joint
				;	PositionEntity b3dnode\vrts_ent[index],x,y,z,0
				;	ScaleMesh b3dnode\vrts_ent[index],.1,.1,.1
				;	b3dnode\rS#[index]=255
				;	b3dnode\gS#[index]=255
				;	b3dnode\bS#[index]=255
				;	EntityPickMode b3dnode\vrts_ent[index],2
									coordnameindex=0
									set=0
					;read tex coords...
									For j=1 To tc_sets*tc_size
										uvw#=b3dReadFloat()
										
										coordnameindex=coordnameindex + 1
										If coordnameindex&gt;tc_size Then
											coordnameindex =1
											set=set+1
										EndIf
										
										If coordnameindex=1
											cn$="u"
											If Not set Then
												b3dnode\u0#[index]=uvw
											Else
												b3dnode\u1#[index]=uvw
											End If
											
											
										ElseIf coordnameindex=2
											cn$="v"
											If Not set Then
												b3dnode\v0#[index]=uvw
											Else
												b3dnode\v1#[index]=uvw
											End If
											
											
											
										Else
											cn$="w"
											If Not set Then
												b3dnode\w0#[index]=uvw
											Else
												b3dnode\w1#[index]=uvw
											End If
											
											
											
										EndIf
										
										
										
									Next
									
									
									
									
									index=index+1
									
								Wend
							Else
				;;;DebugLog tab$+"***** Illegal number of vertices *****"
							EndIf
						Case "TRIS"
							b3dtris.TrisChunk=New TrisChunk
							
							brush_id=b3dReadInt()
							sz=12
							n_tris=b3dChunkSize()/sz
							
							
							
							
							b3dtris\tris_count%=n_tris
							b3dtris\tris_brush_id%=brush_id	
							
							.tris			
							If n_tris*sz=b3dChunkSize()
								index%=0
				;read all tris in chunk
								While b3dChunkSize()
									v0=b3dReadInt()
									v1=b3dReadInt()
									v2=b3dReadInt()
									
									
									b3dtris\tv0%[index]=v0
									b3dtris\tv1%[index]=v1
									b3dtris\tv2%[index]=v2
									index%=index%+1
								Wend
							Else
				;;;DebugLog tab$+"***** Illegal number of triangles *****"
							EndIf
						Case "MESH"
							brush_id=b3dReadInt()
							
							
							
							b3dnode\mesh_brush_id=brush_id
							b3dnode\class$="mesh"
							b3dmesh=b3dnode
			;HideEntity b3dmesh\geo				
							.bone			
						Case "BONE"
							
							
							sz=8
							n_weights=b3dChunkSize()/sz
							b3dnode\weight_count%=n_weights
							
							b3dnode\class$="bone"
							index%=0
							If n_weights*sz=b3dChunkSize()
				;read all weights
								While b3dChunkSize()
									vertex_id=b3dReadInt()
									weight#=b3dReadFloat()
									
			;		If weight#&gt;b3dnode\weight#[index]
									b3dnode\vert_target%[vertex_id]=1;vertex_id
									
									b3dnode\weight#[vertex_id]=weight
									
				;	Else
									
				;	n_weights=n_weights-1
				;	End If
									
				;	For tmp.NodeChunk=Each NodeChunk
				;	EntityParent b3dmesh\vrts_ent[vertex_id],b3dnode\joint
				;	DebugLog "Parenting "+ EntityName(b3dnode\vrts_ent[vertex_id])+" to "+ b3dnode\name$
									flag=0					
									If  b3dmesh\joint1[vertex_id]=0 And flag=0 Then
										b3dmesh\joint1[vertex_id]=b3dnode\joint
										b3dmesh\weight1#[vertex_id]=weight
										flag=1
									End If
									
									If  b3dmesh\joint2[vertex_id]=0 And flag=0 Then
										b3dmesh\joint2[vertex_id]=b3dnode\joint
										b3dmesh\weight2#[vertex_id]=weight
										flag=2
									End If
									
									If  b3dmesh\joint3[vertex_id]=0 And flag=0 Then 
										b3dmesh\joint3[vertex_id]=b3dnode\joint
										b3dmesh\weight3#[vertex_id]=weight
										flag=3
									End If
									
									If  b3dmesh\joint4[vertex_id]=0 And flag=0 Then
										b3dmesh\joint4[vertex_id]=b3dnode\joint
										b3dmesh\weight4#[vertex_id]=weight
										flag=4
									End If
									
									
									
									
									
									
									
									
									
									index%=index%+1
								Wend
							Else
				;;;DebugLog tab$+"***** Illegal number of bone weights *****"
							EndIf
							
							
							
							
							.nodes
						Case "NODE"
							
			;If level%&gt;1
							b3dnode.NodeChunk=New NodeChunk
		;	End If
							b3dnode\class$="root"			;
							name$=b3dReadString$()
							x_pos#=b3dReadFloat()
							y_pos#=b3dReadFloat()
							z_pos#=b3dReadFloat()
							x_scl#=b3dReadFloat()
							y_scl#=b3dReadFloat()
							z_scl#=b3dReadFloat()
							w_rot#=b3dReadFloat()
							x_rot#=b3dReadFloat()
							y_rot#=b3dReadFloat()
							z_rot#=b3dReadFloat()
	;		If w_rot#&lt;&gt;1.0 Then b3dnode\norm=1
							
							;RuntimeError "Mesh: "+Str(mesh)
							
							b3dnode\joint=findchildentity(mesh,name$)
		;	DebugLog "creating "+name$ +" "+ b3dnode\joint
							
							
							b3dnode\name$=name$
							b3dnode\x_pos#=x_pos#
							b3dnode\y_pos#=y_pos#
							b3dnode\z_pos#=z_pos#
							b3dnode\x_scl#=x_scl#
							b3dnode\y_scl#=y_scl#
							b3dnode\z_scl#=z_scl#
							b3dnode\w_rot#=w_rot#
							b3dnode\x_rot#=x_rot#
							b3dnode\y_rot#=y_rot#
							b3dnode\z_rot#=z_rot#
							
							For mark=0 To PMK_MAX_KEYS;b3dmesh\Num_Frames%
								b3dnode\frame%[mark]=-1
								b3dnode\frameP%[mark]=-1
								b3dnode\frameS%[mark]=-1
								b3dnode\frameR%[mark]=-1
							Next
			;b3dnode\loangle#=-45.0;-45;-Pi*0.25;-45 degrees
			;b3dnode\hiangle#=45.0;Pi*0.25;-45 degrees
			;b3dnode\Axis1=1
			;b3dnode\Axis2=2
			;b3dnode\joint_type% = 2
			;b3dnode\max_force#=0.0
			;b3dnode\vel#=0.0
			;b3dnode\angulardamp#=0.5
			;b3dnode\lineardamp#=0.5
			;b3dnode\nproxy=CreatePivot()
		;	DebugLog  b3dnode.NodeChunk\name$
							
							If b3dnode\joint=0 Then
		;b3dnode\gui_id=AddTreeViewNode( treeJoints, name$ );
	;	DebugLog "adding node  :"+b3dnode\name$ +"  parent="+b3dnode\joint+"   mesh="+mesh
								
							Else If GetParent(b3dnode\joint)=mesh Then
								
			;b3dnode\gui_id=AddTreeViewNode( treeJoints, name$ )
								b3dnode\Parent=mesh
							Else
								
								For tmp.Nodechunk=Each NodeChunk
	;	DebugLog "looking for.."+tmp\joint+"  parent   :"+GetParent (b3dnode\joint)
									If tmp\joint=GetParent (b3dnode\joint) Then
				;b3dnode\gui_id=AddTreeViewNode( tmp\gui_id, name$ )
			;	DebugLog "adding child node  :"+b3dnode\name$+"  to  "+ tmp\name$
				;dad.nodechunk=getnodechunk(GetParent (b3dnode\joint))
				;b3dnode\bone=createRay.ray(EntityX#(dad\joint,1),EntityY#(dad\joint,1),EntityZ#(dad\joint,1),EntityX#(b3dnode\joint,1),EntityY#(b3dnode\joint,1),EntityZ#(b3dnode\joint,1), punit#*0.1,dad\joint, 1)
				;EntityOrder b3dnode\bone\entity,-1
				;UpdateRay(b3dnode.nodechunk)
									Else 
										
			;b3dnode\gui_id=AddTreeViewNode( treeJoints, name$ )
									End If
								Next
								
							End If
							
	;b3dnode\geo=CreateSphere()
							hnd.NodeChunk=b3dnode.NodeChunk
	;NameEntity b3dnode\geo,"Sphere: " + name$
	;EntityPickMode b3dnode\geo,2
	;EntityAlpha b3dnode\geo,0.6
	;EntityOrder b3dnode\geo,-3
	;EntityColor b3dnode\geo,0,0,255
	;EntityParent b3dnode\geo,b3dnode\joint,0
	;EntityOrder b3dnode\geo,-1 - make optional 
	;HideEntity b3dnode\geo
	;If b3dnode\ent&gt;0 DebugLog EntityName(b3dnode\geo) + " : " + EntityName(b3dnode\ent)
	;joint(NodeCount)=CreateSphere();
	;ScaleEntity b3dnode\geo,.1,.1,.1;
	;EntityParent joint(NodeCount),findchildentity(mesh,name$),0;
	;NodeCount=NodeCount+1;
	;NewJointNo=NewJointNo+1
	;PositionEntity ball,x_pos#,y_pos#,z_pos# ,True
							
							If dumpflags And PMK_FLAG_StripNodePaths Then  name$=StripPath(name$)	
							
							
							
						Default
			; OBS untested!
							
	;		out$=BeginTag$(chunk$)
	;		out$=AddIntegerAttrib(out$,"size",b3dChunkSize())
	;		out$ = CloseTag(out$)				
	;		emit out$
							
	;		out$="&lt;![CDATA[" 
							
	;		While b3dChunkSize()
	;			out$=out$ + Chr$(b3dReadByte())	
	;		Wend
							
	;		out$=out$ + "]]&gt;"
	;		emit out$
							
							
					End Select
					
					DumpChunks(dumpflags, tab$,level%)	;dump any subchunks
					b3dExitChunk()					;exit this chunk
					
					
					
					
				Wend
End Function</textarea><br><br><div class="quote"> How many surfaces? Don't know.<br>How many vertices per surface? Don't know.<br>How many triangles per surface? Don't know.<br>How many materials? Approx. 3 materials.<br>How many joints? Don't know.<br>How many animation frames? Approx. 400 frames.<br>Do the routines use arrays or banks to store the data? It uses a bit of both CreateBank() AND Dim(). <br></div><br><br>For the 'Don't know' answers, how do I use fragmotion to get each of those?<br><br>Thanks! <br><br></td></tr></table><br>
<a name="1209026"></a>

<a name="1209027"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#54">[#54]</a></td></tr></table></td></tr><tr ><td class="posttext"> Open fragmotion<br>Load the .b3d file<br><br>At left there is tabwindow named "Model"<br>Here you can see infos about the mesh<br>Below "Material" you can see each surface and each material properties<br>If you double click on a surface, that selects the corresponding faces and vertices<br>Once you have selected the faces and vertices of a surface, you can click on "Mesh" to see the selected vertices count and selected faces count<br><br>At left there is a tabwindow named "Skeleton"<br>Here you can see infos about the skeleton with all joints<br><br>At left there is tabwindow "Animation"<br>Here you can see infos about the animation sequences and the frames for each sequence<br>double click on the animation to see infos about the frames <br><br></td></tr></table><br>
<a name="1209028"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#55">[#55]</a></td></tr></table></td></tr><tr ><td class="posttext"> I tried that.<br><br>Anyways, it's the good dwarf model that was created by Psionic. So I HIGHLY doubt it has anything wrong with it. <br><br></td></tr></table><br>
<a name="1209360"></a>

<a name="1209361"></a>

<a name="1209362"></a>

<a name="1209363"></a>

<a name="1209364"></a>

<a name="1209365"></a>

<a name="1209366"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#56">[#56]</a></td></tr></table></td></tr><tr ><td class="posttext"> So I've finally found where the bug is coming from, but do NOT know how to stop it.<br><br>It's coming from function "DumpChunks()", specifically, <br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">While b3dChunkSize()

  frame=b3dReadInt()
  b3dnode\frame%[frame]=frame
  
  If flags And 1

    b3dnode\frameP%[frame]=frame

    key_px#=b3dReadFloat()
    key_py#=b3dReadFloat()
    key_pz#=b3dReadFloat()

    b3dnode\key_px#[frame]=key_px#
    b3dnode\key_py#[frame]=key_py#
    b3dnode\key_pz#[frame]=key_pz#			

  EndIf

  If flags And 2

    b3dnode\frameS%[frame]=frame

    key_sx#=b3dReadFloat()
    key_sy#=b3dReadFloat()
    key_sz#=b3dReadFloat()

    b3dnode\key_sx#[frame]=key_sx#
    b3dnode\key_sy#[frame]=key_sy#
    b3dnode\key_sz#[frame]=key_sz#

  EndIf

  If flags And 4

    b3dnode\frameR%[frame]=frame

    key_rw#=b3dReadFloat()
    key_rx#=b3dReadFloat()
    key_ry#=b3dReadFloat()
    key_rz#=b3dReadFloat()

    b3dnode\key_rw#[frame]=key_rw#
    b3dnode\key_rx#[frame]=key_rx#
    b3dnode\key_ry#[frame]=key_ry#
    b3dnode\key_rz#[frame]=key_rz#

  EndIf

Wend</textarea><br><br>How do I stop this so I can move on with my life?<br><br>Thank You! <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
