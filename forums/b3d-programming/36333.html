<!DOCTYPE html><html lang="en" ><head ><title >Multiplayer Buffer</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Multiplayer Buffer</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Multiplayer Buffer</a><br><br>
<a name="397567"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Banshee</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello,<br><br>I've nearly finished writting a multiplayer game in Blitz but i'm a little stuck on 1 problem.  I'm still fairly new to Blitz but i've had a good look through the commands and cannot see the solution.<br><br>When too many players connect to the server the game looses sync.<br><br>I want to support up to 32 players and my data packet for each player is 36 bytes.<br><br>I think what is happening is that the network buffer is only 512bytes, so when I have more than 14 players the network buffer is overfilling and getting cropped.<br><br>Is it possible to increase the buffer size at all?  I'm using the TCP command set and need a buffer size of 1152 bytes.<br><br>Here's a piccy to wet your lips :)<br><img src="http://www.bansheestudios.com/img/DMI500.jpg"> <br><br></td></tr></table><br>
<a name="397572"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> wet eyes would be more realistic when I look at the washed out non-contrast textures <br><br></td></tr></table><br>
<a name="397578"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rob</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Dreamora is a troll.<br><br>They look great andy!<br><br>Best look at a lib like rottnet on the general discussion forum as this uses UDP and is likely not to suffer those limitations. Worth a look? <br><br></td></tr></table><br>
<a name="397587"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Banshee</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks HaemoglobinLocust, i've asked in that thread about the network buffer although i'm dreading the thought of rewritting all my network code !<br><br>Thanks also Dreamora, if nothing else you helped keep my thread higher up the forum list...  I think perhaps you should look again when I post more pictures of the game and you get to see more than just a tiny segment from just 1 of the 27 maps which feature many texture sets and contrast levels. <br><br></td></tr></table><br>
<a name="397597"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>I want to support up to 32 players and my data packet for each player is 36 bytes. <br> <br></div><br><br>What is the frequency of packet transmission?<br><br>Is it a dedicated server program or player hosted?<br><br>If there were buffers involved they would be per connection so I doubt that is your problem. When you say lose sync do you mean the data communications fail or you are suffering timing problems. If it is a timing problem you should describe exactly how your server is managing it's connections. <br><br></td></tr></table><br>
<a name="397618"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Banshee</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the start skid, but it is 36 bytes for 32 players to each player.<br><br>The data is "typically" sent 4 times a second (250ms delay), but for players experiencing high action that can raise slightly.  Each player is receiving a 36 byte data packet per active player/bot in the game, so alas it does go over 512bytes per player on a single data packet.<br><br>The problem I think is that when this overflows the packet gets chopped off so my next attempt to read 36bytes gets an offset in the data stream, causing the link to fail.  This happens whenever I have a certain number of players or more (my calculations say this should be 14, but I cant test properly until tonight but that seems roughly right).<br><br>It is player hosted.  The host receives a 35 byte packet from each player and then returns a "36 byte per player" packet back to the sender. <br><br></td></tr></table><br>
<a name="397625"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you check the ReadBytes command docs you will note the command returns actual bytes returned, I'm guessing you are not taking this into account. <br><br>The easiest way to read from a socket is either with fixed packet sizes so you can easily use ReadAvail() to confirm a data packet is available or with a 4 byte header which get's quite a bit messier. <br><br></td></tr></table><br>
<a name="397643"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Banshee</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I hadn't realised that asset of readbytes however there would still be complications in using that because it would meen I could keep a stable connection for 14 players but anything beyond that is just not going to get through.<br><br>That's why i'm trying to increase the buffer size for each connection.  I would have thought it would just be 1 command, but BB doesnt seem to have it :/.  I wonder if UDP has a similar limit?<br><br>512 bytes is only 4kbits.  I'm trying to use 1152 which is 9.216kbit, 4 times a second is 36.504k/bits a second, which doesnt seem excessive to me, especially as some commercial games are now demanding LAN/Broadband to play multiplayer. <br><br></td></tr></table><br>
<a name="397657"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> for a somewhere fluent game experience you need 10 - 20 transfers per second ... which gives 92 to 184 kbit ... which is a bit high.<br><br>anything above 100ms isn't fluent enough for a 3D shooter and especially people on broadband ( most europeans as there are no flatrates for ISDN / 56k anymore ) won't really enjoy 250ms pings <br><br></td></tr></table><br>
<a name="397671"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Banshee</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think you are confusing transmission frequency with ping.<br><br>How about you lay off the flak until you've played the game, in the meentime i'm trying to find a solution to a networking problem, not discuss how much data broadband users want to have as a minimum standard. (can you say "gameplay"?).<br><br>I'm not saying my game is good, i'm just saying it's unfair to slate it's visuals when you haven't seen them, and slating it's network play when it isn't even finished yet is hardly fair.<br><br>I see nothing wrong with 4 updates a second (rising during action as said above) with the gameplay on offer in my game.<br><br>Thanks <br><br></td></tr></table><br>
<a name="397709"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rottbott</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> 4 updates a second is just fine for most game types. Dreamora, you don't really seem to know what you're talking about.<br><br>Andy, it sounds like this is a TCP problem. Do you get the same problem if you make a small test program using TCP to transfer 512+ byte packets? That way I could look at your code and try and find a workaround. Either that or use UDP (RottNet or BlitzPlay) :-) <br><br></td></tr></table><br>
<a name="397714"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >IPete2</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Andy,<br><br>Looking very nice.<br><br>Is there anyway you can try to compress the packet before you send it and unpack it when it arrives? - BlitzPlay uses a few tricks and saves quite a lot of bits in doing something similar.<br><br>IPete2. <br><br></td></tr></table><br>
<a name="397720"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Banshee</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Short of compression routines I really cant seperate the data down much more without infringing on gameplay, I already have quite a polymorphic data packet design.  Wheter it's sending player chat, bullet info, or chat it all squeezes into those 36 bytes so the only way to compress beyond that is either to do things like make yaw 256 directional and after that, .zip/.rar style compression which has an overhead.<br><br>All of that has a system overhead.<br><br>The thing is i'm hoping the buffer size is just a variable, perhaps an internal one to Blitz, that can just be changed.<br><br>I think i'll email the Blitz team about it and see if they can offer sollice, otherwise i'll have to recode the multiplayer stuff to UDP or one of the userlibs you guys have kindly suggested. <br><br></td></tr></table><br>
<a name="397723"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >IPete2</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Andy,<br><br>How about sending the chat separate as most wont be fighting and chatting at the same time.<br><br>IPete2. <br><br></td></tr></table><br>
<a name="397726"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Banshee</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> I sort of already have because the data packet is polymorphic, so if there is chat to send the data packet sends chat info instead of other information, the frequency also fluctuates to compensate and large messages are sent over several packets. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
