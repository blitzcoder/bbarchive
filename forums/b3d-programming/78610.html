<!DOCTYPE html><html lang="en" ><head ><title >Problems wrapping a dll</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Problems wrapping a dll</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Problems wrapping a dll</a><br><br>
<a name="882222"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> hi!<br><br>i wanted to make a wrapper for this dll:<br><a href="http://xprofan.com/xprofan/h/hashdll-5930-0.html" target="_blank">http://xprofan.com/xprofan/h/hashdll-5930-0.html</a><br><br><br>my decls file looks like this and works well with all hash algorithms. but somehow it won't work in some circumstances...<br><pre class=code>.lib "hash.dll"
CreateHash$(file$, algorithm$):"testit"</pre><br><br>example:<pre class=code>;Only working in debug mode
Print "Hello world!"
RuntimEerror CreateHash("Test.txt", "MD5")</pre><pre class=code>;Working!
RuntimEerror CreateHash("Test.txt", "MD5")</pre><br><br>i just don't have a clue and i would be glad to receive some help :)<br><br><br>### This is my example you may try:  <a href="http://www.dev-ch.de/upload/files/Devils%20Child/HashTest.zip" target="_blank">http://www.dev-ch.de/upload/files/Devils%20Child/HashTest.zip</a> <br><br></td></tr></table><br>
<a name="882256"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sweenie</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Most likely the calling convention...<br>If the dll uses the cdecl convention and blitz the stdcall convention the stack will be messed up.<br>You can usually tell if it's stdcall by the export name.<br>Should be "_testit@8" or something like that if it was using stdcall. <br><br></td></tr></table><br>
<a name="882259"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> <pre class=code>CreateHash$(file$, algorithm$):"testit@8"
CreateHash$(file$, algorithm$):"_testit@8"</pre><br>both are not working because "Userlib function not found !?!" <br><br></td></tr></table><br>
<a name="882264"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sweenie</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> No, what I meant was that since the exported function isn't named like that it's most likely using the cdecl calling convention meaning it won't work with Blitz3d.<br><br>A solution would be to make a wrapper in c++ that exports using the stdcall convention.<br>Not the ideal solution since you will end up with two dlls, the hash.dll and your wrapper dll. <br><br></td></tr></table><br>
<a name="882266"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> oh my god...<br>is there any other solution, because i don't know how to make a wrapper using c++?<br>is it easy so i can ask anyone to do it without bothering?<br>would you do it :)? <br><br></td></tr></table><br>
<a name="882291"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sweenie</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Try if this one works... haven't been able to test it myself.(Don't have blitz3d on this computer)<br><br><a href="http://www.svenberra.net/hashwrap.zip" target="_blank">http://www.svenberra.net/hashwrap.zip</a><br><br>you will need the hashes.dll file as well. <br><br></td></tr></table><br>
<a name="882297"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> hey thanks for helping me out buddy :)<br>but on the other hand, it's not working.<div class="quote"> Userlib function not found. <br></div><br>or am i doing something significantly wrong?<br><br>edit: what do you mean by "need 'hashes.dll' as well" ?<br>i placed your dll and your decls in my userlibs folder (B+) <br><br></td></tr></table><br>
<a name="882340"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> its a wrapper DLL so the original library (hashes.dll) must be present as well, not only the wrapper dll <br><br></td></tr></table><br>
<a name="882343"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> yeah right, Sweenie already mentioned that, but when i'm putting all these 3 files in my B+ userlibs folder, i still get "User lib function not found"... <br><br></td></tr></table><br>
<a name="882437"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Vertigo</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sometimes you need to have the .dll file in the same folder as the one you are executing from.  For instance I have a mysql dll that will produce a userlib not found error if its not in the directory of blitz's bin or the exe directory i am compiling in.  Even though its in the userlibs and even in system32 I have still had issues with some libs that have hard coded paths and the like... very odd I know, but try it out.  Plus Im not sure what exactly it is you are doing with MD5's but there is plenty of md5 info and even demo code here on the site, you can do it all within blitz. <br><br></td></tr></table><br>
<a name="882464"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> by planting everything in all possible directories (eg. Blitz+\bin and system32) it still returns the same error. <br><br></td></tr></table><br>
<a name="882484"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sweenie, you did such a great job on your TokaMak wrapper. i guess it's a piece of cake to wrap the hash dll for me :)<br>it's not that i'm begging someone to do my work - please don't take it this way! <br><br></td></tr></table><br>
<a name="882547"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> hm, tried do make a wrapper using FreeBasic<pre class=code>dim library as any ptr
dim hashfunc as function(file as string, algorithm as string) as string

library = dylibload("hashes")
hashfunc = dylibsymbol(library, "testit")
print hashfunc("Test.txt", "MD5")
dylibfree library</pre><br>same crash as when trying it with bb :( <br><br></td></tr></table><br>
<a name="882803"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sweenie</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi.<br><br>Ok, took a closer look at this one and the readme makes no sense.<br>It does seem to be using stdcall afterall (might be a delphi dll or something)<br>I found an older version and according to that the declaration should look like this...<br><br>.lib "hashes.dll"<br>CreateHash$(filein$, algorithm$,fileout) : "testit"<br><br>Notice I don't declare 'fileout' as a string since the dll will output the hash to a new file if any value is supplied.<br>Just call it like this...<br><br>Print CreateHash$("test.txt","MD5",0)<br><br>If you want it to output the hash to a file just change the declaration like this...<br>.lib "hashes.dll"<br>CreateHash$(filein$, algorithm$,fileout$) : "testit"<br><br>and call it like this...<br><br>CreateHash$("test.txt","MD5","hashresult.txt") <br><br></td></tr></table><br>
<a name="882823"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh my gosh, this seems to work!!<br>and it works with no wrapper :)<br>i gotta test this out at home. thanks buddy ;) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
