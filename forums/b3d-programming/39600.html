<!DOCTYPE html><html lang="en" ><head ><title >Carving in a mesh</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Carving in a mesh</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Carving in a mesh</a><br><br>
<a name="441851"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >semar</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi all,<br>I would like to understand how can I carve inside a mesh.<br><br>Say I build up a box (mesh1) using addvertex and addtriangle commands. Later, if I wanted to carve a smaller box (mesh2) inside it, how could I accomplish this task ?<br><br>In the code archive I've found some code about CSG functions - Boolean Union/Subtraction/Intersection - but I don't really get it, due to the lack of comments and explanations - no offence for the authors though :-)<br><br>What puzzles me, is how should I arrange the new vertex that comes from the second mesh, and combine it with the vertex from the first mesh, in order to create the new triangles which will form the - now carved - surface.<br><br>I may get how to realize that using two simple meshes like two boxes; but the problem comes when I want, for example, carve a cone in a box, or other complex meshes.<br><br>Is there any tutorial about ?<br><br>Thanks for attention,<br>Sergio. <br><br></td></tr></table><br>
<a name="441870"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think basically you do this:<br><br>For any boolean operation:<br><br>Split all the polygons in A with the planes of the polygons in B, and vice versa.<br><br>Operate on these split versions of the meshes.<br><br>To subtract B from A:<br>1. Flip polygons in B.  <br>2. Find all the polygons of B which lie inside A.  Add those to final mesh.<br>3. Find all polygons in A which lie outside B.  Add those to the final mesh.<br>4. Weld vertices of final mesh if desired.<br><br>To add A and B:<br>1. Find all polygons of B which lie outside A.  Keep them.<br>2. Find all polygons of A which lie outside B.  Keep them.<br>4. Weld vertices of final mesh if desired.<br><br><br>AND and NOT operations aren't all that useful so I won't bother to explain those. <br><br></td></tr></table><br>
<a name="441879"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >semar</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Swift for the reply.<br><br>I don't really get what you mean with polygons and planes.<br><br>I think you mean triangle for polygons, but what about plane ?<br><br>&lt;&lt;Flip polygons&gt;&gt; = I guess you mean to reverse the mesh here ? So that is not visible from outside, but from inside ?<br><br>&lt;&lt;Find all the polygons of B which lie inside A&gt;&gt;<br>That's not a trivial task I guess. It's exactly what puzzles me now. How I can determine that a triangle (of mesh B) is inside the mesh A ? Should I check all the vertex coordinates (of that triangle) against all the vertex coords of the mesh A ?<br><br>And more, how can I determine the vertex sequence to use, in order to add the mesh b surface triangles to ones which belongs to mesh a ? Maybe using TriangleVertex ?<br><br>The problem here is that is not enough to add just the (flipped) triangles which lie inside the mesh A, because the surface of the mesh A should also change. It does not change automatically when you add new triangles.<br><br>Suppose a big cube A and a cube B which is one half smaller of cube A.<br><br>Cube B penetrates for its half height through a face of cube B.<br><br>In case of carving (subtracting), the two triangles of that face (the one being penetrated) should be deleted, and the whole face structure should be re-arranged with the new triangles added...<br><br>My brain hurts now..<br><br>You know, conceptually I can get your drift; but I find really tricky to actually realize it, having to use only the surface and vertex commands.<br><br>Anyway, I'll try to realize your concepts. Thank you. :)<br><br>Sergio. <br><br></td></tr></table><br>
<a name="441899"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BlackD</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Because I suck at 3D ;) this is the only way I can think of to tell if a polygon from MeshB is inside MeshA.<br><br>1. Find the furthest point from MeshA on MeshB.<br>2. Create a pivot (PivotB) there.<br>3. Find the XYZ coordinates of the vertex on MeshB that you're testing.<br>4. Create a pivot (PivotA) there.<br>5. Find the vector angle between the two points.<br>6. Move PivotB towards PivotA along this vector until it collides.<br>7. Move PivotB back one frame to where it was before it collided.<br>8. Hide MeshB.<br>9. Use EntityPick to find the nearest entity to the PivotA.<br>10. If it returns MeshA, the polygon is inside MeshA. If it returns PivotB, the polygon is outside MeshA.<br><br>While that process would only take a hundredth of a second to process, it seems a very long and cubersome method of checking what should be a simple process. Anyone got a better method?<br><br>+BlackD<br><br>[edit:]<br>Actually, just realised afterward, you could shorten that to:<br>1. Using vectors, find the furthest polygon from MeshA on MeshB.<br>2. Create a pivot there.<br>4. Move the pivot towards the polygon you're checking, testing for collision with MeshA.<br>5. If it never collides, then the polygon is outside MeshA. If a collision with MeshA does occur, then obviously the polygon is inside MeshB. Though you'll probably want to test individual vertices, not triangles, as part of a triangle may be inside while the center of it is outside.<br><br>This assumes that there is some point of meshB outside meshA. If there isn't, then the carve won't happen as it won't find any polygons which meet - which they shouldn't.. they're all inside.[/edit] <br><br></td></tr></table><br>
<a name="441971"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> "I think you mean triangle for polygons, but what about plane?"<br><br>When I said planes, I mean the planes which the triangles lie in.<br><br>A triangle is three points, which lie on a plane.  A quad is two triangles which lie on a plane.  A polygon is a bunch of triangles connected together that lie on a plane.<br><br><br>"I guess you mean to reverse the mesh here ? So that is not visible from outside, but from inside?"<br><br>Basically, yes.  But you don't actually have to flip any polygons exept those which you ultimately end up keeping that belong to the object I said to flip.<br><br><br>"That's not a trivial task I guess. It's exactly what puzzles me now. How I can determine that a triangle (of mesh B) is inside the mesh A ? Should I check all the vertex coordinates (of that triangle) against all the vertex coords of the mesh A?"<br><br>I think you're in a bit over your head trying to tackle CSG if you have to ask things like this. :-)  <br><br>(CSG = Constructive Solid Geometry = Boolean opaerations on 3D models)<br><br>To find out which polygons of B are inside A, assuming you have used the planes defined by the polygons in A to split all the polygons in B, all polygons in B will now either be entirely inside, or entirely outside A.  That's why you do the split.  <br><br>To find out if they are inside or outside, all you need to do then is check every vertex in B to see which side of every polygon in A it is on.  If it is on the inside side of every plane defined by a polygon in A, then it is inside A. <br><br>You then check each triangle and if any vertex that it uses is inside A then it too is inside A.  <br><br>If A can be a concave object, which it may very well be if you already did one CSG operation on it, then you'll have to do a slightly different test to determine if each point is inside A.  To do that, you need to cast a ray from the vertex in any direction to infinity.  Let's say, along the X axis in the positive direction.  If your ray crosses an odd number of polygons, then you are inside A, otherwise you are outside A. <br><br>"And more, how can I determine the vertex sequence to use, in order to add the mesh b surface triangles to ones which belongs to mesh a ? Maybe using TriangleVertex?"<br><br>Basically, find all the vertcies which you're gonna keep, and add those, and then find all the tirnagles you're going to keep, and then use that command I guess it is to find the original vertex indexes for that triangle and convert them to the new vertex indexes, because the numebrs will be different cause you have fewer vertices.<br><br><br>If you need more help type CSG 3D POLYGON into google and it will come up with lots of pages with info. <br><br></td></tr></table><br>
<a name="441981"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >semar</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thank you very much sswift, I'll try out the above concepts.<br><br>Sergio. <br><br></td></tr></table><br>
<a name="442011"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Semar - where did you find the existing CSG functions?  Were they written in B3d 'cos I wouldn't mind a look? <br><br></td></tr></table><br>
<a name="442034"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >.rIKmAN.</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=560" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=560</a><br><br>:) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
