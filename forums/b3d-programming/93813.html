<!DOCTYPE html><html lang="en" ><head ><title >undo/redo technique</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >undo/redo technique</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >undo/redo technique</a><br><br>
<a name="1074278"></a>

<a name="1074279"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Charrua</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi<br><br>I'm thinking a way to implement an undo/redo in a world creator <br><br>Basically a list of object with some properties, fields, entities..<br><br>I think that there are some differents aproaches like:<br><br>a) store the current state<br>b) store the difference<br>c) store the command/transformation made<br><br>an operation should delete, modify and/or create new objects<br><br>a) pro/cons: i think to much redundancy waste of memory? easiear at first?<br><br>b) related to trasformations like move, rotation and the like, storing the realtive change is an interesting one, simply add/substract the deltas... for each element (tagged?) but wich is a delta related with textures, and or if i deleted the object or created a new one?<br><br>c) probably the most efficient but i think more complicated to code, with many Select Case statement's.<br><br>Has some one a pseudo code or a simply set of rules?<br><br>Thank's in advance<br><br>Juan<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1074649"></a>

<a name="1074650"></a>

<a name="1074651"></a>

<a name="1074652"></a>

<a name="1074653"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Danny</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I personally think that storing relative changes is probably the most efficient way, however, I also think you'll be opening a can of worms:<br>- You'll have to keep an entire history starting from some original state to start from. If any thing at any stage goes wrong in the partial re-construction (due to a relative undo system) then the entire system collapses.<br>- You will have to support a special mechanism to deal with every possible action/operation the user can do.<br>- You'll probably have to add support for all sorts of exceptional conditions and situations to your undo system every time you add a new feature to the one of your engines.<br>Thus you might end up spending nearly the same amount of time on you undo system as on your 'do' systems..<br><br>Most likely your internal database will allow you to store 'complete instances' or duplicates of your original in-world entities (incl. their properties, settings, transformation data, etc.), this was you can be sure that the content will be reliably un-do'd - regardless of your world's current feature-set. Yes that will take a couple bytes of memory but what the heck, memory is plenty and cheap these days..<br><br>When replacing an entity with a previous state, simply purge the current one (Free Entities/textures/etc,), replace it with the previous data stored in the undo system. And then your engines will simply have to re-initialise that new asset (light, mesh, animated character, terrain, whatever it is); And most likely, you have that last bit of code already.<br>Using this approach you can simply reserved a fixed amount of records  if you like (e.g. max 20 or 50 undos).<br><br>Just my thoughts / gut feeling on the subject i.e. I've never done or researched this topic at length..<br><br>Danny<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1074659"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Charrua</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> thank's<br>i have benn playing with some alternatives, and put my hands to work on the subject.<br>I already have Cut, Copy and Paste feature so my aproach (by now) is an extension of the copy/paste feature.<br>Basically i have a list of "Normal copy objects" the ones you manage with Ctrl+C and Ctrl+V (tagged Normal) and many more Copy objects Tagged diferently depending on the "Undo-Level"<br>I copy any set of objectes that should change in one operation. When doing Undo/Redo i analize wich objects are in both (now and after or now and before depending on Undo/Redo) sets of copy objects and Keep, Delete, Paste based on the analysis. <br>I implemented only 5 functions: Undo, Redo, ResetUndoSystem and 2 for saving the state: SaveState and SaveNewState that are called after and before any modification.<br>The UndoLevel used as a tag is 0 for normal copy objects and cycle between 1 and MaxRingValue (20 by now), every time the head reaches the tail i simply delete the oldest undo info on the list.<br><br>As far as i tested is working say... 99% (better than i spect at first)<br><br>i agree that relative changes are a headhache, and no one is so simple as it can seems at first<br><br>Juan <br><br></td></tr></table><br>
<a name="1074840"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Bah, Undo is for the lazy people. Seriously. If I hit UNDO several times, I never know exactly what I've been undoing, esp. in a 3D world editor, where you won't see everything on the screen. More than 10 UNDO Steps won't make much sense IMHO.<br><br>Anyway, you may think about to save the entire level after every siginificant change. In theory this would be only a matter of drive space, shouldn't be a problem. It would however allow to undo/redo anything that can be saved. If your level saving routine is fast then this may work well. In my editor the level file is only a text file with a few hundred lines of text, it's saved in a couple of millisecs.<br><br>This method may be brute force and very unelegant, but at least it's bulletproof and stabile, and easily implemented (assuming your editor can load a saved level).<br><br>Bundle the user actions, eg: moving an item 15 times will save only one undoable copy, to undo moving the item. That's about what eg.  Photoshop does. <br><br></td></tr></table><br>
<a name="1074846"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Charrua</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> thank's<br><br>my editor is incorporating some csg routines, so, in the world should be some meshes (not blitz natives) and i'm saving eshaustive mesh info inside the file, so a world could be very little if only primitives are used or some hundreds of kilobytes if some complex meshes are inside. One aproach could be, save this meshes as .b3d and use them as if you dropped a b3d on the world (wasting a few bytes of the file like it was a primitive)...<br><br>Probably some day i take this way.<br><br>And, is true, when debuging, i put a counter to see in which undo i am, and some undo/redo seems to do nothing as you say. When adding 2 shapes, the resulting one is visible the same as before, but only in the objects list you see the difference or/and if you select/unselect the objects.<br><br>Juan <br><br></td></tr></table><br>
<a name="1074893"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Warner</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Csg routines? May I ask, how did you incorporate those? I'm writing csg routines myself. I spent months getting them to work right. <br><br></td></tr></table><br>
<a name="1074912"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Charrua</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi<br><br>i just want to thank you!<br><br>i'm testing your's (and other with less success)<br><br>With some good's and some unespected results.<br><br>basically i think that most fails are related with shapes that are side by side but not intercepting each other...<br><br>The easy way (sure is not the correct one) was to scale slightly: none, one A or B, or both.<br><br>i do very little modifications due to some problems working with meshes with surfaces with diferent brushes.<br><br>Now i'm coding sonme weld funtions, not to reduce the amount of vertex, the intention is to joint some vertex that result slightly moved.<br><br>if you like to see your csg (with little modifications) in action:<br><br><a href="http://blitzbasic.com/Community/posts.php?topic=93544#1073241" target="_blank">http://blitzbasic.com/Community/posts.php?topic=93544#1073241</a><br><br>thank's again and of course you will be (among others) in the credits<br><br>Juan <br><br></td></tr></table><br>
<a name="1074942"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Warner</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> That's cool. It seems like a nice program. Very elaborate. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
