<!DOCTYPE html><html lang="en" ><head ><title >Rendering static image onto models?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Rendering static image onto models?</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Rendering static image onto models?</a><br><br>
<a name="1229272"></a>

<a name="1229273"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Cubed Inc.</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is gonna be a tough one to explain. Would it be possible to "render" a static image onto a model that does not necessarily map to the model itself and is not affected by depth? I'm experimenting with a 3d game with pre-rendered background (Grim Fandango, Resident Evil, Final Fantasy 7) and I'm trying to make certain parts of the pre-rendered background have depth so that the 3d character can walk in front and behind them. The idea I got was to create a 3d collision model that matched up over the pre-rendered background, and apply the same pre-rendered background image to the collision model so that I could achieve the illusion of depth. The image technique I speak of can be easily seen in this picture from the new Monkey Island games (notice the man's suit.)<br><br><img src="http://buttonbasher.files.wordpress.com/2009/12/stan-the-man.jpg"><br><br><img src="http://bulk2.destructoid.com/ul/153334-talesofmi104_stan_souvenirstand.jpg"><br><br>If all of this still doesn't make a lick of sense, just let me know and I'll try to explain it better. But if anyone does understand, I'd really appreciate your thoughts, feedback, and suggestions. <br><br></td></tr></table><br>
<a name="1229333"></a>

<a name="1229334"></a>

<a name="1229335"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> The effect for that man's shirt comes from automatic texture coordinate generation. The shirt is mapped based on the view direction; the positions of the vertices of the shirt are used as texture coordinates, so the shirt texture always "faces" the camera.<br><br>In D3D (which Blitz3D uses), it's the D3DTSS_TCI_CAMERASPACEPOSITION method:<br><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/bb172339(v=vs.85).aspx" target="_blank">http://msdn.microsoft.com/en-us/library/windows/desktop/bb172339(v=vs.85).aspx</a><br><br>In OpenGL, the equivalent method is GL_EYE_LINEAR:<br><a href="http://resumbrae.com/ub/dms424_s04/15/03.html" target="_blank">http://resumbrae.com/ub/dms424_s04/15/03.html</a><br><br>- - - - -<br><br>I don't think this is what you'll use to make 2d-in-3D backgrounds such as those from Alone in the Dark, Resident Evil, Final Fantasy etc.<br>To do backgrounds such as these...<br><br><b>1)</b> You first render the background from the fixed point of view of your choice. For this you use 3DS Max, Blender etc. to get a nice quality of rendering.<br><br><b>2)</b> Using an image program such as the GIMP or Photoshop, you break that rendered image into separate layers based on how you want the layers to be ordered in relation to the dynamic objects (characters etc.).<br><br><b>3)</b> This is the most complicated part. You don't change the rendering order of any of those layers when rendering them among the characters. Leave them as they are.<br>Rather, you distance a certain layer <i>away from the camera</i> based on the farthest vertex from the camera that was rendered into that layer.<br><br>Reference image:<br><br><img src="http://s28.postimg.org/406sgdpkd/layer_Depth.png"><br><br>So the camera distance of that wall layer on the right side is taken as the distance between the red point and the camera - ignore the green dot at the bottom, since it's not the farthest vertex of that object from the camera. You do this in your modelling application, getting the XYZ position of the vertex of that red point and the XYZ position of the camera, and calculating the distance between these 3D points.<br>Then you use that distance to move the layer away from the camera, in the local Z direction of the camera. <br><br>You will also need to <b>scale</b> the layer based on the camera field-of-view to preserve the layer size. You are moving each layer so they are correctly ordered when rendered with characters etc., and when you do this they become smaller the farther they are from the camera and you need to compensate for that.<br>With a camera of a 90º field-of-view (the default when you create a camera in Blitz3D), I believe you use the distance of a layer as scale factor: it's 1.0 when the layer is right on the near-plane, and 'n' when the distance of the layer to the camera is 'n.'<br>If you're using a different field-of-view for your camera (you control this with CameraZoom( camera, zoom ) ), I think you scale the layer based on this expression: scale = ( distance_from_camera x ( 1.0 / zoom ) ) <br><br></td></tr></table><br>
<a name="1229338"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> An alternative method for rendering FF7-style backgrounds is to produce two outputs from your detail scene: a regular image rendered from the desired perspective, and a simplified 3D model.<br><br>You can then do a three-pass render: first render the simplified model. Then, draw the image over the whole screen (simple 2D operation). Finally, render your dynamic meshes but with the camera set to <i>not clear the Z-buffer or colour buffer</i> - not clearing the colour buffer will leave the background image in place (common technique), and not clearing the Z-buffer will give it the depth effect from the simplified mesh pass, so that wherever the character would be behind the simple mesh, they aren't drawn over the background image either. Set the camera back to clear the Z buffer for the start of the next frame. <br><br></td></tr></table><br>
<a name="1229341"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> That's fascinating, much simpler. <br><br></td></tr></table><br>
<a name="1229344"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Cubed Inc.</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yasha<br>Do you have an example of this method in action in Blitz3d? I was never too savvy with messing around with the program's buffer functions. <br><br></td></tr></table><br>
<a name="1229361"></a>

<a name="1229362"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Cubed Inc.</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Does it entail using the CameraClsMode function of Blitz3d? I'm trying to experiment with it and your method, but I can't get it to work. <br><br></td></tr></table><br>
<a name="1229427"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, you would use that one.<br><br>Example:<br><pre class=code>While ...
    ; 1: draw the simple mesh to get its depth
    HideEntity all dynamic meshes
    ShowEntity simplified world mesh
    CameraClsMode cam, 1, 1    ;Colour flag actually doesn't matter here
    RenderWorld
    
    ; 2: draw the background image
    DrawImage background, 0, 0    ;This step is actually more difficult if you're using a 2D-in-3D draw system
    
    ; 3: draw the foreground objects
    HideEntity simplified world mesh
    ShowEntity all relevant dynamic meshes
    CameraClsMode cam, 0, 0
    RenderWorld
    
    2D HUD, Flip etc
Wend</pre><br><br>The important thing is that there are two separate calls to RenderWorld with two separate ClsMode settings for them. The first one has to clear the Z-buffer, because it is creating a new Z buffer for the frame (overwriting the positions of the characters last frame and so on); the second one mustn't clear either buffer, because it uses the specially-created depth map to determine when characters are obscured (and treats the 2D image as though it were the old colour map). <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
