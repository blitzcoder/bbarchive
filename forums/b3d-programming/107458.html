<!DOCTYPE html><html lang="en" ><head ><title >Faster Loop</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Faster Loop</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Faster Loop</a><br><br>
<a name="1331019"></a>

<a name="1331020"></a>

<a name="1331021"></a>

<a name="1331022"></a>

<a name="1331023"></a>

<a name="1331028"></a>

<a name="1331029"></a>

<a name="1331274"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dna</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello<br><br>I use this to loop through a type variable to place a specific one into another type variable.<br>For very large lists, 4 million and higher, it can take 15 minutes for more.<br>Is there a faster method?<br><br><pre class=code>
WHILE CT&gt;0
For AB.CH=Each CH:BC=BC+1
If BC=BTR Then OB.CH=New CH:OB\BT=AB\BT:Text 20,20,CT:Delete AB.CH:CT=CT-1:Flip:Cls:Exit
Next
Wend HALT
</pre><br><br>The loop Actually takes longer now for some reason with large bodies of data over 4 million in size.<br>Debug is off and only the Chrome browser is running in the background. Running this section of the code now takes 45 minutes to complete. <br><br></td></tr></table><br>
<a name="1331032"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >steve_ancell</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm pretty sure a lot of coders use some sort of zoning system, in other words update only objects that are upto a certain distance from the player at that time. <br><br></td></tr></table><br>
<a name="1331033"></a>

<a name="1331034"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you are flipping inside the for loop with 4 million entries it will be limited by the vertical sync...ie about 60 frames per second which means that for loop will run at 1 iteration per 16ms approx....take the text and flip outside of the for loop.<br><br>Edit...oops...i didnt see the exit command....running all your if statement commands on one line makes for unreadable code. <br><br></td></tr></table><br>
<a name="1331035"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> 4 million iterations should take a second.  Yoyr slowdown is somewhere else. <br><br></td></tr></table><br>
<a name="1331142"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dna</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> The program still moves sluggishly.<br><br>It's definitely the for loop. Now I remember that it was used for timing and so looping through 4 million items when looping just 1500 times was approximately a second, <br>equals 2794 seconds, approximately 46 minutes .<br><br>There may be no faster method inside a loop. <br><br></td></tr></table><br>
<a name="1331143"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Floyd</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm with Matty on this one. There has to be something else happening.<br><br><div class="quote"> just 1500 times was approximately a second <br></div><br>For ease of calculation I will assume a very leisurely 1.5GHz processor. That means one million CPU cycles to process each type instance. <br><br></td></tr></table><br>
<a name="1331149"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dna</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes but the code exits the FOR loop and reenters it if CT &gt; 0 which it will be for 4 millions times.<br><br>I probably need to use another method for this, just thought there was another way or a shortcut. <br><br></td></tr></table><br>
<a name="1331151"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flanker</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> From what I understand from your code you delete only one type and add it to the end of your list. The CT value must be equal to 1 before the loop, and if it take a while to compute, the BTR value must be huge.<br><br>My suggestion is that instead of BC=BC+1, you can count how many types you have in your list one time, then calculate the FLOORED number of time you need to increment that value to reach BTR, and then do the BC=BC+1 stuff from that value. You can probably use the Mod command with success here.<br><br>Maybe it's not clear, but unless you post a complete example it's hard to go further. <br><br></td></tr></table><br>
<a name="1331158"></a>

<a name="1331159"></a>

<a name="1331160"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Midimaster</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Can you please send some more code? And can you descripe, what is purpose of the algo? What is BTR? Does it change? <br><br>I redesigned your code for better reading and there are two questions:<br><pre class=code>Type CH
	Field BT% 
End Type

While CT&gt;0
For AB.CH=Each CH
	BC=BC+1
	If BC=BTR Then 
		OB.CH=New CH
		OB\BT=AB\BT
		Text 20,20,CT
		Delete AB.CH
		CT=CT 1 ;Why this "1" behind the CT?
		Flip
		Cls
		Exit
	EndIf	
Next
Wend Halt ;What is HALT?
</pre> <br><br><br>Is it a kind of sorting algo? For me it look like you always try to continue at the point, where you leaved the loop  at the previous time. So why not stay in the loop?<br><br>your problem is the FLIP command. It comes to often. How many list elements will fit to the conditions? Already 3600 will need one minute!<br><br>Only for testing purposes: Please do a test without FLIP and TEXT and check the time needed in total, similar to this:<br><pre class=code>Type CH
	Field BT% 
End Type

Global Check=Millisecs()
While CT&gt;0
For AB.CH=Each CH
	BC=BC+1
	If BC=BTR Then 
		OB.CH=New CH
		OB\BT=AB\BT
		Delete AB
		Exit
	EndIf	
Next
Wend
print "TIME=" + ( Millisecs()- Check )
WaitKey()
</pre> <br><br></td></tr></table><br>
<a name="1331169"></a>

<a name="1331171"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Krischan</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think the Text command causes the slowdown, too. And you should use Flip 0 instead of Flip only.<br><br>You could update the text once a second to fix this, a quick example:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">Graphics3D 800,600,32,2

ms=MilliSecs()
start=MilliSecs()

For i=1 To 100000000
	
	If KeyDown(1) Then End
	
	If MilliSecs()&gt;ms+60 Then
		
		Cls
		
		Text 0,0,i
		ms=MilliSecs()
		
	EndIf
	
	Flip 0
	
Next

Cls
Text 0,0,"Time: "+(MilliSecs()-start)
Flip
WaitKey

End</textarea><br><br>It takes at least 5.3 seconds here to iterate 100 Million times. <br><br></td></tr></table><br>
<a name="1331209"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >steve_ancell</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> @dna:<br><br>Just of of curiosity, are you running in windowed mode or fullscreen?. I noticed a while back that Blitz seems to lag in windowed mode. <br><br></td></tr></table><br>
<a name="1331249"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dna</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm running the program in a windowed mode.<br><br>Global GWID=600,GHEI=600,TY,LIP:Graphics3D GWID,GHEI,16,2 <br><br></td></tr></table><br>
<a name="1331275"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dna</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> I updated the posted code.<br><br>It was missing a minus sign in the expression. It should have read<br><br>.<br>.<br>.<br>If BC=BTR Then OB.CH=New CH:OB\BT=AB\BT:Text 20,20,CT:Delete AB.CH:CT=CT-1:Flip:Cls:Exit<br>.<br>.<br>.<br><br>With a CT=CT-1 before the flip. It's in my source that way but fell out during the transfer. It runs the same <br><br></td></tr></table><br>
<a name="1331310"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flanker</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Why put CT=CT-1 instead of CT=0 ? If CT is superior to 1 before the loop it will mess everything. <br><br></td></tr></table><br>
<a name="1331318"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Midimaster</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> did you try the test i descriped in my first post? <br><br>Can you send more code. We cannot do experiments without knowing the complete type and how it is filled. And we know to less about the conditions that leads to the EXIT. Without knowing how big CT and BTR are, and how they are changing... it is difficult <br><br>Here is a simulation to check the speed difference betweenn with or without FLIP<br><pre class=code>Type CH
	Field BT% 
End Type

For i%=0 To 100
		OB.CH=New CH
		OB\BT=123
Next	

Global GWID=600,GHEI=600,TY,LIP
Graphics3D GWID,GHEI,16,2 
CT=100
Global Check=MilliSecs()
While CT&gt;0
	BTR=BTR+1
	For AB.CH=Each CH
		BC=BC+1
		If BC=BTR Then 
			OB.CH=New CH
			OB\BT=AB\BT
			Delete AB.CH
			CT=CT-1
			Text 20,20,CT
			Flip 0
			Cls
			Exit
		EndIf	
	Next
Wend 
Print "TIME=" + ( MilliSecs()- Check )
WaitKey()</pre><br><br>With a simple FLIP it needs 1660msec, with "FLIP 0" 17msec. When removing CLS and TEXT too, it needs 1msec. <br><br></td></tr></table><br>
<a name="1331339"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dna</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> It takes at least 5.3 seconds here to iterate 100 Million times.  <br></div><br><br>I ran you code, it takes 19.3 secs on my older machine but that is much faster than 40 minutes.<br><br>I'll try the flip 0 code next <br><br></td></tr></table><br>
<a name="1331477"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dna</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here is the additional code that you requested.<br><br><pre class=code>
seedrnd millisecs()
While EE&lt;4000000
	W=Rand(1,100):AB.CH=New CH:AB\BT=W:EE=EE+1
Wend
CT=4000000
FH2=WriteFile(FLO$+"SFO2.TXT"):If FH2=0 Then End
While CT&gt;0
BTR=Rand(1,CT):BC=0
For AB.CH=Each CH:BC=BC+1
If BC=BTR Then WriteByte(FH2,AB\BT):Delete AB.CH:CT=CT-1:Exit

Next
Wend
CloseFile(FH2)
Print"DONE"
</pre><br><br>The algorithm pulls a byte out of the type element at random <br><br></td></tr></table><br>
<a name="1331489"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Floyd</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> You set up a list of size N, in this case 4000000.<br><br>Then you step through the list, deleting one element each time. On average the length of the list is N/2 at this step.<br><br>At each step you select a random element, which on average will be in the middle of the size N/2 list. That is a total of about N * (N/2)/2 things to do. <br><br>So a list of initial size 1000 will do about 250000 things. Your 4000000 example will do 4000000 * 1000000 things. <br><br></td></tr></table><br>
<a name="1331499"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dna</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> That's probably the issue then.<br>It will always be slow due to the large loops.<br><br>But I wrote this piece and thought that it should speed up as the type list begins to shrink. <br>I thought that would make it improve over time.<br><br>I may have to do it with another method or abandon the idea. <br><br></td></tr></table><br>
<a name="1331532"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Krischan</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> And what's the purpose of this algorithm? What will you achieve? Perhaps there is another way. <br><br></td></tr></table><br>
<a name="1331539"></a>

<a name="1331540"></a>

<a name="1331541"></a>

<a name="1331542"></a>

<a name="1331689"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Midimaster</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> You better use a type array instead of a type list. So you can access each member of the list  (on a certain position) directly:<br><br>this code is already faster than your code, but still not the optimum:<br><pre class=code>Type CH
	Field BT% 
End Type
max%=40000;00

Dim Source.CH(max)


SeedRnd MilliSecs()

For i%=0 To max
	W=Rand(1,100)
	Source(i)=New CH
	Source(i)\BT=W
Next

CT=max


FH2=WriteFile(FLO$+"SFO2.TXT")
If FH2=0 Then End

Global Check=MilliSecs()
While CT&gt;0
	;If ( MilliSecs()- Check )&gt;15000 End

	BTR=Rand(1,max)
	If Source(BTR)&lt;&gt;Null
		;Print btr +" " + ct
		WriteByte(FH2,Source(BTR)\BT)
		Delete Source(BTR)
		CT=CT-1
	EndIf
Wend

CloseFile(FH2)
Print "TIME=" + ( MilliSecs()- Check )
WaitKey()
</pre><br>Tested with 40000 elements your last code needs 9300msec, this piece of code 99msec.<br><br>Perhaps other forum members can help? The code above runs fast (136msec) upto 65000 elements. With 66000 elements the times rises dramatically to &gt;15000msec. What happens?<br><br>In BlitzMax (also free) this job can be done with 1,000,000 elements within 19sec:<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">SuperStrict

Type CH
	Field BT% 
End Type

Global Maxi%=1000000

Global Source:CH[]=New CH[Maxi]


SeedRnd MilliSecs()

For Local i%=0 To Maxi-1
	Source[i]=New CH
	Source[i].BT=Rand(1,100)
Next

Global CT%=Maxi


Global FH2:TStream=WriteFile("SFO2.TXT")
If FH2=Null Then End

Global Check%=MilliSecs()
While CT&gt;0
	;If ( MilliSecs()- Check )&gt;60000 End

	Local BTR%=Rand(0,Maxi-1)
	If Source[BTR]&lt;&gt;Null
		'Print btr +" " + ct
		WriteByte FH2,Source(BTR).BT
		Source[BTR]=Null
		CT=CT-1
	EndIf
Wend

CloseFile(FH2)
Print "TIME=" + ( MilliSecs()- Check )
WaitKey()
</textarea> <br><br></td></tr></table><br>
<a name="1331567"></a>

<a name="1331568"></a>

<a name="1331569"></a>

<a name="1331572"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flanker</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> Same as Midimaster, using an array to store type handles, but with a difference, when a type is deleted, its handle in the array is replaced by the handle of the last type so the random function can't pick an empty element :<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">Type CH
	Field BT% 
End Type

CT = 400000

Dim hnd(CT)


SeedRnd MilliSecs()

For i=1 To CT
	n.CH = New CH
	n\BT = Rand(1,100)
	hnd(i) = Handle(n)
Next

FH2=WriteFile("SFO2.TXT")
If FH2=0 Then End

Global Check=MilliSecs()

While CT&gt;0

	BTR=Rand(1,CT)
		
	AB.CH = Object.CH(hnd(BTR))
	
	WriteByte(FH2,AB\BT)
	Delete AB
	
	hnd(BTR) = hnd(CT)
	
	CT=CT-1

Wend

CloseFile(FH2)
Print "TIME=" + ( MilliSecs()- Check )
WaitKey()</textarea><br><br>It's slower with 40000 elements, but it goes straight with more, I tested with 4.000.000 and it takes 17 seconds here. Tested with a bank instead of an array : same time.<br><br>Strange thing with your code Midimaster, the barrier is 65536 elements wich is exactly the maximum value of a short (2-bytes), maybe that the Rand() function is somehow based on this... <br><br></td></tr></table><br>
<a name="1331593"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Midimaster</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Flanker<br>nice idea with the HANDLEs. Did not know that  the function exist in B3D.<br><br>And what a genius idea to "copy" the handle, pointing to the last object, to the handle, which was just selected! I needed some minutes to understand...<br>But this way the random area is "shrinking" all the time! Great <br><br></td></tr></table><br>
<a name="1331645"></a>

<a name="1331647"></a>

<a name="1331649"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> In the last example you're doing 4 million WriteByte calls.<br>Why not use PokeByte into a temporary Bank in the loop, and then after it ends do a single <a href="/b3ddocs/command.php?name=WriteBytes&amp;ref=2d_cat" target="_blank">WriteBytes</a> to the file.<br>It might squeeze some more milliseconds.<br><br>Edit: also, use more descriptive variable names! Keeping them short like that won't impact performance at all, the compiler uses its own names for these variables later. <br><br></td></tr></table><br>
<a name="1331658"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dna</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> I thought that when you deleted a type variable the list points to the next one in the list.<br>If so then, when you point your handle to the next one in the list, that should achieve the same effect. <br><br></td></tr></table><br>
<a name="1331687"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> An alternative way to do this is to simply sort the list in a random order on creation then delete them in sequence. <br><br></td></tr></table><br>
<a name="1332045"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dna</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  Matty<br>An alternative way to do this is to simply sort the list in a random order on creation then delete them in sequence.  <br></div><br><br>That's what the first EE loop does. It starts from 1 to 4000000 but the integers are random when chosen for insertion. Basically your idea.<br><br>From that I'm pulling them out randomly within the CT loop.<br><br>What Floyd posted was right, 4000000 * 1000000 is too large for speed.<br><br>I will have to rethink the method for doing this. <br><br></td></tr></table><br>
<a name="1332053"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> But but but....if they are inserted randomly why then delete them in random order...it is already random...instead just delete them in sequential order...!?? <br><br></td></tr></table><br>
<a name="1332057"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Midimaster</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> But isnt the solution of Flanker not fast enough? 17 sec instead of 45min. That's more than 100 times faster!<br><br>Which speed do you need? Could you test this with your original code? <br><br></td></tr></table><br>
<a name="1332113"></a>

<a name="1332114"></a>

<a name="1332115"></a>

<a name="1332117"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dna</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> I did not test the code of flanker yet.<br><br>I have never seen the handle pointers before and need to find the documentation on the syntax.<br><br>It's new to some of us.<br><br><br>* I just tried his code and get a memory access violation.  What version of BB is he using?*<br><br>** I'm using B3D, I think this is particular to Bmax ** <br><br></td></tr></table><br>
<a name="1332124"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Midimaster</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> It is 100% B3D. I tested it on my B3D Version 1.106 and it works perfect.<br>Did you change anything, or did you copy the code without changing it?<br><br>Switch on the DEBUG ENABLED option to see, where the problem is! <br><br></td></tr></table><br>
<a name="1332155"></a>

<a name="1332157"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flanker</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#32">[#32]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes it's 100% B3D, i'm using the last version (1.108c), but this should work on any recent version.<br><br>If you want informations about types handles, check this thread : <a href="http://www.blitzbasic.com/Community/posts.php?topic=75556" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=75556</a><br><br>When you delete a type, its handle is freed but others keep theirs, it's like the linked lists in Bmax.<br><br>BTW, on my I7 CPU it takes only 8 seconds to complete with 4 millions elements. <br><br></td></tr></table><br>
<a name="1332165"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BlitzSupport</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#33">[#33]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just tried Flanker's code in Blitz3D v1.108 and with CT set to 4 million it completes in 10.5 seconds here. (AMD FX6350 @ 3.9 GHz.) <br><br></td></tr></table><br>
<a name="1332209"></a>

<a name="1332212"></a>

<a name="1332215"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dna</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#34">[#34]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey, I got the code to work.<br><br>I did the same as yesterday copy and paste and today for some reason it works.<br>Probably needed to reboot yesterday.<br><br>Now I need to understand the handle function documentation wherever it exists.<br><br>* There is no help file for the handle function. Does someone have a reference or does someone understand the syntax? *<br><br>** Runs in 25.75 Secs on my older machine. Now I just need to get it to process the information ** <br><br></td></tr></table><br>
<a name="1332217"></a>

<a name="1332218"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Floyd</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#35">[#35]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can search the forums for Object and Handle using Google.<br><pre class=code>object handle site:www.blitzbasic.com</pre><br>The code archives can also be searched.<br><pre class=code>object handle site:www.blitzbasic.com/codearcs</pre> <br><br></td></tr></table><br>
<a name="1332237"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Midimaster</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#36">[#36]</a></td></tr></table></td></tr><tr ><td class="posttext"> an "easy to understand" explanation:<br><br>Each element (instance) of your type CH is saved anywhere in the RAM. A HANDLE is the adress, where this is. So the HANDLE() function returns an integer value which is representing the adress of the type element in the RAM.<br><pre class=code>Type CH
	Field BT% 
End Type
ab.CH=New CH
ab\BT=123
A.INT=handle(ab)
Print "Adress=" + A</pre><br><br>The "invers function" is...<br><pre class=code>xy.CH = Object.CH(A)
Print "Content=" + xy\BT</pre><br>Here you "cast" the content of a RAM adress to a type. Afterwards you can access this part of the RAM like a element of your type CH. <br><br></td></tr></table><br>
<a name="1332348"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dna</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#37">[#37]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Mididmaster<br><br>It's incredible that you do not have to define xy as new to use it for the object function. <br><br></td></tr></table><br>
<a name="1332359"></a>

<a name="1332360"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Floyd</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#38">[#38]</a></td></tr></table></td></tr><tr ><td class="posttext"> The variable xy.CH really just holds the address of a Type object.<br><br>xy.CH = New CH <br><br>New allocates memory for the object and returns an address, which is stored in xy.<br><br>xy.CH = Object.CH(A)<br><br>In this case Object.CH(A) returns the address of an object and that is stored in xy. <br><br></td></tr></table><br>
<a name="1332769"></a>

<a name="1332770"></a>

<a name="1332771"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bobysait</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#39">[#39]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry if I don't get it at all, and I apologize in advance for what'I'm going to say<br>(it's been monthes I have a big headacke, so perhaps I missed something in the topic)<br><br>But what's the purpose of all this ?<br>Basically, you just start with nothing and end generating a 4000000 random data file and destroying the temporary stuff<br>So, I guess the only purpose is to generate a random data file.<br><br>The problem is : It doesn't require any of all the stuff involved here, type or array or handle/object, and it does even not require to randomize picking/poking at an index ...<br><br><pre class=code>
Local Bank = CreateBank(4000000)
For i = 0 To 4000000-1
	PokeByte(bank, i, Rand(1,100))
Next
WriteBytes(bank, WriteFile("out.txt"), 0, BankSize(bank))
Print "Done"
WaitKey()
End
</pre><br><br>This will do the same and should not tale more than a second.<br><br>(I benchmarked it, it takes 300 ms in release, and 850 ms in debug mode)<br><pre class=code>
Local t0 = MilliSecs()

Local Bank = CreateBank(4000000)
Local t1 = MilliSecs()

For i = 0 To 4000000-1
	PokeByte(bank, i, Rand(1,100))
Next
Local t2 = MilliSecs()

WriteBytes(bank, WriteFile("out.txt"), 0, BankSize(bank))
Local t3 = MilliSecs()

Print "total         : "+(t3-t0)+".ms"
Print "Empty bank    : "+(t1-t0)+".ms"
Print "Randomiz bank : "+(t2-t1)+".ms"
Print "Write File    : "+(t3-t2)+".ms"

Print "file is located at :"
Print CurrentDir()+"out.txt"
Print ""
Print "Hit Any Key To End"
WaitKey()
End
</pre><br><br><br>So, what is the purpose ?<br>Does anyone here have a clue on why you're trying to solve something that is probably senseless ?<br>I have the feeling dna is a beginner who wanted something but started something way to complicated for a simple task ... but I might be wrong.<br><br><br>ps : Else, if you really need to have a data structur, then midimaster (I think it was him) is right, you already randomize the input, so randomizing the output is useless.<br><br>And if it's the case, this will work too<br><pre class=code>
Type CH
	Field BT%
End Type

; randomize input
Local n.CH
Local i%
For i = 1 To 4000000
	n.CH = New CH
	n\BT = Rand(1,100)
Next

; create a bank, for faster export
Local bank = Createbank(4000000)
Local o% = 0

; fill the bank with the random values
Local a.CH = First CH
For a = Each CH
	PokeByte bank,o, a\BT : o=o+1
Next

; export the bank to the file.
WriteBytes(bank, WriteFile("out.txt"), 0, BankSize(bank))

; if required, then you can delete all the instances of CH.
Delete Each CH

Print "Done - hit any key to end"
WaitKey()
End
</pre> <br><br></td></tr></table><br>
<a name="1332772"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Floyd</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#40">[#40]</a></td></tr></table></td></tr><tr ><td class="posttext"> It was never precisely stated but I think the goal was really just to pick random items from a type list.<br><br>The problem is easy with an array, but quite difficult with a list. If the list has reached its final form then the easiest way is probably just to copy it to an array. The problem is what to do if the list is dynamically growing/shrinking. <br><br></td></tr></table><br>
<a name="1332796"></a>

<a name="1332797"></a>

<a name="1332798"></a>

<a name="1332799"></a>

<a name="1332800"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bobysait</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#41">[#41]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, there are at the same time tons of algorithm to do this task in an efficient way, and no real way to do it properly in a "generic" way.<br><br>I suppose the worst case would be a random access of all the entries of a dynamic list in realtime (once or more times per loop), so it would need to be both fast on access, and fast on creation/destruction<br><br>For all the other cases, there are sorting algorithm that will do it efficiently like qsort/bubble sort etc ... or a nested tree - the choice of the algorithm require to be aware of the final purpose, if it's made to be used once only in the program (or only for some tasks that don't suffer of realtime requirements, like saving data etc ...), if the data are persistent or only used for the task (so, a simple array can be created on the fly without complex structure to store the objects), and some more parameters like single or multiple access to an object are allowed or not, etc ...<br><br>On the worst case, the biggest challenge would be to randomly access all the data in a different order anytime the task is run and have a list that is frequently updated<br>Building the structure will depend on : is it more often updated or accessed ?<br><br>A "not that bad" generic way to do it is to use a tree-like structure, like a TMap (where the key would be a random position) which is both fast and slow.<br><br><br>ps : does the flanker's code works efficiently ?<br>I didn't test it, but I'm pretty sure that it will not access randomly "all" the objects and will instead try to access them by order anytime the array limit decreases (whenever he removes an object, the array position of the removed object is updated to point to the last entry, so the removed slots all point to the same object which give it an higher probability to be accessed)<br>but, once more, it depends on the need to export an efficiently randomized stuff or not. <br><br></td></tr></table><br>
<a name="1332838"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Midimaster</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#42">[#42]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think the given question was:<br><div class="quote"> ... to loop through a type variable to place a specific one into another type variable... <br></div><br>original code was:<br><br><pre class=code>While CT&gt;0
For AB.CH=Each CH
	BC=BC+1
	If BC=BTR Then 
		OB.CH=New CH
		OB\BT=AB\BT
		Text 20,20,CT
		Delete AB.CH
		CT=CT 1 ;Why this "1" behind the CT?
		Flip
		Cls
		Exit
	EndIf	
Next
Wend Halt ;What is HALT?</pre><br><br>we did not get more informations...<br><br>All additional code lines where added by me only to get a running example. So the type field with 4000000 entries is given, but the numbers of fields inside are maybe much more than one. Also the values are not  defined as random. I only created random values to have anything in the fields.<br><br>Now Dna wants to pick a type at a specific position BTR (not necessarily a random value) copy that hit type to a file and remove the entry. <br><br>Mine and Flankers solutions are closed to this given situation. all others are long shots... <br><br></td></tr></table><br>
<a name="1332846"></a>

<a name="1332847"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flanker</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#43">[#43]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> ps : does the flanker's code works efficiently ?<br>I didn't test it, but I'm pretty sure that it will not access randomly "all" the objects and will instead try to access them by order anytime the array limit decreases (whenever he removes an object, the array position of the removed object is updated to point to the last entry, so the removed slots all point to the same object which give it an higher probability to be accessed) <br></div><br><br>Yes it's efficient, at any time all the objects have the same probality to be accessed. When an object is removed, its array "pointer" is replaced by the last object in the list, but the Rand() function is also decreased by 1 (CT = CT - 1), so it will always be Rand(1,number of objects remaining).<br><br>And as Midimaster stated, we don't exactly know what is the purpose of this, but if you want to access randomly to all your types, then here you go. <br><br></td></tr></table><br>
<a name="1332921"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dna</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#44">[#44]</a></td></tr></table></td></tr><tr ><td class="posttext"> @MIDIMASTER<br><br>The minus sign was missing in the original post. Here you can see it in the right spot.<br><br><pre class=code>seedrnd millisecs()
While EE&lt;4000000
	W=Rand(1,100):AB.CH=New CH:AB\BT=W:EE=EE+1
Wend
CT=4000000
FH2=WriteFile(FLO$+"SFO2.TXT"):If FH2=0 Then End
While CT&gt;0
BTR=Rand(1,CT):BC=0
For AB.CH=Each CH:BC=BC+1
If BC=BTR Then WriteByte(FH2,AB\BT):Delete AB.CH:CT=CT-1:Exit

Next
Wend
CloseFile(FH2)
Print"DONE"</pre> <br><br></td></tr></table><br>
<a name="1333009"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#45">[#45]</a></td></tr></table></td></tr><tr ><td class="posttext"> dna never answered my comment above earlier anyway which was that he has inserted items into the list in random order in any case so why not just delete them in sequence....they will be no less random than if he deletes them in random order after having inserted them? <br><br></td></tr></table><br>
<a name="1333010"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#46">[#46]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you add randomly - the stack is randomized<br>if you then select randomly you will "fetch" things according to the distribution type of your "Pseudo Random Number Generator" - so eg.it often chooses "the center" (gaussian, normal distribution ...)<br><br>If you now remove "in sequence", you will just move the "likelyness" to the right (or "bottom" of the stack).<br><br>If you remove "randomly" (with the same PRNG) then you will propably remove one from the center - bringing some others more near the former center of the random number distribution.<br><br><br>If your PRNG is doing a "equally distributed thing" then yes, it should not matter from which spot in a stack/list you remove. And of course only if you _always_ remove with "random" and nowhere with "remove first/last". And also you never should then do "draw the first 10 of a stack".<br><br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1333092"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dna</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#47">[#47]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Matty<br><br>The code I submitted used numbers which it did not have to do.<br>I did present it in a odd way by using numbers without clearly defining what it was supposed to to which was to randomize a list. <br><br>Supposed to have some application or a game that you want to randomize the placement of the items in your maze.<br><br>EI: The refrigerator or, Ruler or, what ever else is in the game to be picked up, those items must not be in the same place every time the application is run.<br><br>This can do that. I was just thinking ahead given the notion that the items were already randomized and so the next time the application is run, they would need to be randomized again to have them in a different spot. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
