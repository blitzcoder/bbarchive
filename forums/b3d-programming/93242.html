<!DOCTYPE html><html lang="en" ><head ><title >Masking or Alpha Channel?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Masking or Alpha Channel?</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Masking or Alpha Channel?</a><br><br>
<a name="1065464"></a>

<a name="1065465"></a>

<a name="1065466"></a>

<a name="1065467"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ClayPigeon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've created a descent grass system that can cover a 256x256 terrain with dense grass without dropping below 60FPS, and it's completely up to my standards except for one thing. Since the grass texture on the quads is masked, so when a blade of grass in the grass texture is smaller than one pixel, it isn't rendered. So, this effectively limits the distance grass is rendered depending on the user's screen resolution. I didn't notice it at first, because my screen is 1440x900. But when I drop the resolution to 800x600, it becomes evident that the grass stops a few feet it front of you:<br><img src="http://img269.imageshack.us/img269/7862/demoq.png"><br>So, I tried using alpha channel, but even though it ended the first problem, it made all grass look blackish, because it was interpolating the grass color to black (color behind 0 alpha). I was happy with how it looked with masking, but I want it to be visible further. Anyone know what to do about this?<br><br><font class="tiny">Last edited 2010</font><br><br><font class="tiny">Last edited 2010</font><br><br><font class="tiny">Last edited 2010</font> <br><br></td></tr></table><br>
<a name="1065480"></a>

<a name="1065481"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rroff</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Using alpha will result in all sorts of sorting and lighting (colored lighting not having effect, etc.) issues even if you batch it. It might be possible with careful use of additive blending to fade it out nicer at a distance.<br><br>If you use FastExt some of the custom alpha blends do work differently i.e. 1bit alpha which works like mask but handle distance better, tho again issues with light and sorting if your not really careful.<br><br><font class="tiny">Last edited 2010</font> <br><br></td></tr></table><br>
<a name="1065606"></a>

<a name="1065706"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Rroff is correct about the Z-Sorting Dilemma with alpha blending. Something we are suffering of since the begining. It has always been a bit of a mystery to work around this problem. I used to release a Grass Demo some years ago, and somebody else made it a singlesurface thing and added a Vertex structure based alpha sorting.<br><br>Later I made a grass system for my engine, see demo 8 on my fps project page. There I used a further method to alphasort by code. The trick is to reposition all entities starting with the one that is closest to the camera, ending with the one that is farthest away from it. It depends on if it is a single surface system, or if the grass quads or meshes are seperate entities. Using Copyentity allows individual entities using the same brush (alafair), but a singlesurface system is still faster.<br><br>Mask will most likely always look bad. Especially simple BMP or so. You have to use DDS, get an export pugin for gimp or photoshop, see also code archives for an exporter in Blitz (tho not sure how it will handle alpha etc.).<br><br>The DXT3 and 5 of DDS formats will allow you to save alpha and masks in a much more sophisticated way. For masks you can force directX to interpolate your outline, like in vector graphics. Here's a sample:<br><img src="http://www.melog.ch/dropper/images/galleries/v80_8.jpg"><br>See the rounded shapes (it's 512 pixels)? A masked BMP would not only be much blockier, with checkerboardlike seams, it would also bleed to black at the seams.<br><br>Here's an important trick on how to make the image use a good matte color:<br>in your Graphics app make an additional layer to the texture, behind the original. Set the layer to about 2% opaque (or 98% transparent), almost invisible. Then blur it. This way the "matte color" is used as desired, but the masking remains as in the original.<br>Save this as DDS with alpha of course.<br><br>In the DDS options you can also define how it should handle the various stages of mipmapping, and therefor you can allow exceptional rendering depending on distance. For example a wirefence that fades to a semitransparent grey when the structure becomes so small that it normally would fade away (as in your description).<br>Now that I have revealed the top secrets of alpha grass, let me show off my grass :)<br><img src="http://www.melog.ch/dropper/images/galleries/v80_1.jpg"><br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1065614"></a>

<a name="1065620"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ClayPigeon</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay, I got the exporter for DDS textures in GIMP. But, when I try to load it in Blitz, it tells me the texture doesn't exist. I don't know if I'm exporting it wrong or what, but how do I set the mask and get the sharp-edge effect you were were referring to? BTW, I think I can solve my distance problem by giving the grass billboard image custom mipmaps in which the further away mipmaps have thicker grass. Also I don't have each grass quad as a separate entity. I have the land divided into squares. Each square is a separate mesh, filled with grass quads (AddMesh). I can't EntityAutoFade every single grass quad as an individual entity since it's kind of slow, so I devised this square-mesh plan and just EntityAutoFade'd those. And also, do DDS textures automatically set the texture flags, or do I still have to set them myself?<br><br>EDIT: Okay, never mind. I figured it out. I found one of your older posts which helped tremendously. Thanks for your help!<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1065623"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >D4NM4N</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Alpha all the way i say. Masks look poo. <br><br></td></tr></table><br>
<a name="1065625"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ClayPigeon</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Alpha more than doubles the processing power required where it is not really required. Plus, it makes the edges look blurry. It depends on what you are going for. <br><br></td></tr></table><br>
<a name="1065645"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Did Gabriel just post something here and it vanished? The forum shows he made a post 1 hour ago from this message of mine, but it isn't showing up. <br><br></td></tr></table><br>
<a name="1065699"></a>

<a name="1065700"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> He should know it. Maybe there's a redundant topic somewhere?<br><br>BTW I think Alpha is not always double as slow as simple diffuse mode: when A texel is full transparent then it should be even faster, at least in theory. When it is fully opaque the there also needs to be no mixing. Furthermore the blurness of the alpha mode is caused mostly by mipmapping, something you can control or even turn off in DDS, if you want. Where Alpha has this tendency for blurry edges, masked ones will always be bound to the screen pixel width. It may look ok in a high resolution when you don't watch it closely, but the edges are too sharp to look realistic. In my opinion the only problem with alpha is the sorting issue. Masks are ok for certain things, shure. Especially things that really need sharp edges. At the other hand you should try to use Alpha for a few things only, so you only have to sort a few things.<br><br>Using Masks for grass because it is technically easier, or faster, wouldn't be that much of a wise decision IMHO. At the end of the day, a screenshot must look convincing. And later on, it must look good when you walk trough it.<br><br>For all kinds of Vegetation you have to use some LOD tricks to make it rea fast. There are methods that are using Billboard quads or sprites for distant patches, speeding things up by enormous amounts. Instead of rendering the same grass patch hundreds of times, render it one time, copy the texture to a billboard quads texture and use this instead, the player most likely won't see any diffrence.<br><br>This way you can display highly dense content. If you try to render everything in a NON-LOD way, then that's not really efficient or professional. (Have to say, as long as an engine is not really designed for outdoor scenes, LOD implementation is not always given. For indoor stuff people may prefere some sort of VIS Occlusion instead, rather than in combination with LOD, except maybe for NPCs)<br><br>It is nice if you offer the ability to load aditional LOD meshes to whatever your leveleditor allows to load, but for something like an embeded Grass system for huge outdoor worlds I'd say LOD is mandatory.<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1065701"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ClayPigeon</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> <b>DDS Saves the day!!!:</b><br><br><img src="http://img600.imageshack.us/img600/1675/screenien.png"><br><br>If you look closely, you can see the grass continues to the distance I originally intended it to reach. Also, it took me forever to figure out how to get the transition from real grass to flat grass texture to be unnoticeable. I was wondering, is there a way to make custom mipmaps with DDS textures? <br><br></td></tr></table><br>
<a name="1065705"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Looks much better! My experience with the settings for the Mipmaps is not really substancial, I tried many combinations and found it rather hard to find good settings, also because the phtoshop plugin by Nvidia often crashed my machine after a dozen or two savings. I would guess the Gimp Plugin gives access to all options too, so you may have to spend some time in trial and error, then note down the useful settings. Custom mipmaps? Do you mean from custom images? I don't think so. You can define the number of levels, the distances they are fadeing, and eg. if they should fade to a color or to transparency. Well maybe I'm wrong about that. <br><br></td></tr></table><br>
<a name="1065749"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ClayPigeon</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Furthermore the blurness of the alpha mode is caused mostly by mipmapping, something you can control or even turn off in DDS <br></div><br><br>No, I'm referring to the effect of linear interpolation. The alpha values are interpolated through the image as well and I don't think there's a way to turn off interpolation in B3D except for (like your image above) it uses a threshold-type thing that quantizes alpha values to 1 or 0.<br><br><div class="quote"> I'd say LOD is mandatory. <br></div><br><br>Well, dur! :) How do ya think I was getting 60FPS on a (now) 512x512 terrain? BTW, I think I'm going to start a thread as a database for people to share methods of efficiently yet realistically rendering different types of vegetation. It would be really helpful to those who want to make good outdoor scenes. <br><br></td></tr></table><br>
<a name="1065824"></a>

<a name="1065825"></a>

<a name="1065826"></a>

<a name="1065981"></a>

<a name="1065982"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >D4NM4N</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Alpha more than doubles the processing power required where it is not really required. <br></div>Does it? and anyway, unless you are coding for a 10+ year old pc i dont see where this would be a problem. <div class="quote"> Plus, it makes the edges look blurry.  <br></div>not if you draw them properly.<div class="quote"> It depends on what you are going for.  <br></div>Exactly, although mask looks terrible i can think of very few cases where it would be useful anymore in 2d or 3d tbh... except where there extreme size or processing issues (eg. programming games for a non-smart phone or where you are -really- going for the retro look)<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1066291"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Alpha in blitz3D i've found, really kills the frame rate, if your using it for particle, or anything that is repeated/overlapped on the screen many times, like grass. The DDS masking is a really nice way to do it :) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
