<!DOCTYPE html><html lang="en" ><head ><title >Nasty bitmap font bug : won't draw from backbuffer</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Nasty bitmap font bug : won't draw from backbuffer</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Nasty bitmap font bug : won't draw from backbuffer</a><br><br>
<a name="656462"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have a windowed Blitz program for setting up my software's options. I'm using Cyberseth's BMPFont lib (http://www.blitzcoder.com/cgi-bin/showcase/showcase_showentry.pl?id=cyberseth05162003013142&amp;comments=no) to render text in a textbox.  I clear the backbuffer, write the text to the backbuffer, then copy the backbuffer to a texture on a quad for the textbox with a call to this function...<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Function TG_Change_Text(indx%,replacement_text$, forced%=0)
	; FUNCTION : updates texts(indx) with new text
	; Force forces the graphics draw without the speed optimization of checking for duplication of graphics
	If texts(indx)\txt$&lt;&gt;replacement_text$ Or forced		; If changing the text
		texts(indx)\txt$=replacement_text$
		Cls
		If texts(indx)\txt$&lt;&gt;""
			BMPText font_gothic, (texts(indx)\siz_x/2), (texts(indx)\siz_y/2), texts(indx)\txt$,1,1
		Else
			BMPText font_gothic, (texts(indx)\siz_x/2), (texts(indx)\siz_y/2), texts(indx)\default_txt$,1,1
		EndIf
		CopyRect 0,0,texts(indx)\siz_x,texts(indx)\siz_y,0,0,BackBuffer(),TextureBuffer(texts(indx)\texture)
		EntityTexture(texts(indx)\sprite,texts(indx)\texture)
	EndIf
End Function</textarea><br><br>It works fine, until all of a sudden I've received a report and picture that shows it isn't working properly. Instead of writing text to the backbuffer and copying that to the textbox with lovely writing, the textbox shows the backbuffer with the UI drawn on. Either it's copying the backbuffer after the UI has been drawn, or is not clearing the biffer and writing  the text, or it's copying the front buffer instead of the backbuffer.<br><br>I need some info from the client on their system which will have to wait until tomorrow, but I'm wondering if anyone has any ideas or similar experience? Could some chipsets return the frontbuffer instead of the backbuffer in windowed mode, for example? I can see I'm not directly addressing the backbuffer prior to CLS and text-drawing operations, but I understand the buffer is still the backbuffer as that's how it works on the other computers tested. <br><br></td></tr></table><br>
<a name="656815"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DH</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Whats the specs of the machine in question? <br><br></td></tr></table><br>
<a name="656882"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just got them.<br><br>Pentium 4 3.6GHz CPU<br><br>1Gb Ram<br>Windows XP Pro SP2<br>ATI Fire GL v3100 128mb GPU<br><br>The fire GL is 9600 based I think. I guess that's like the nVidia Quadro's in being a professional card? Yes, looking at ATi's website it's a workstation GPU. Not much chance of me being able to test on that particular card! <br><br></td></tr></table><br>
<a name="657003"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DH</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> hmmm, I see no reason why the code shouldnt work....<br><br>Other than perhaps putting a setbuffer(backbuffer()) in the function for safe keeping..  <br><br>You could add a debug type command (like if a commandline switch is used) the first time this function is called, it saves the buffer (texture buffer) out to an image file to see what is being captured..<br><br>Wish I had a better answer for you, but the only addition I can think of is the setbuffer in this function to ensure your doing all you can.<br><br>Since you dont have the ability to test that card, its hard to say where the problem lys.  Perhaps putting that card on a knowns issues and non-compadible list for your app is your best option. <br><br></td></tr></table><br>
<a name="657206"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> From what I hear, the FireGL series has low game compatibility. These workstation GPUs tend to have drivers optimised for OpenGL. I've tried to contact ATi but they make you jump through a zillion hoops and reply to queries without actually reading the question, instead just looking up the various options you ahve to select about problem type and giving a generic answer.<br><br>It's probably a compatibility issue and it'd be fair to say FireGL and other workstation class GPUs aren't supported, but it's quite embrassing when you submit a program to a government body to ratify it for usefulness in the education sector, and the first computer they run it on has the mind-numbingly obvious bug. I'm sure that instills them with confidence in my programming capabilities! <br><br></td></tr></table><br>
<a name="657301"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Further, the program using the same method fullscreen works, so it appears to be a DirectX in windowed mode limit of the Workstation card. Not something most people here will have to worry about :) <br><br></td></tr></table><br>
<a name="657396"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> How many other machines has your code been tested on?<br><br>Have you tested the code with the desktop in both 16 and 32 bit modes (and possibly 24 depending on OS) on an ATI card?<br><br>What textureflags is the texture being created with? <br><br></td></tr></table><br>
<a name="657503"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's been tested on four PCs, with GeForce Ti4200, Old ATi Rage I think, one modern Dell with inbuilt 3D chipset, and a Radeon 9800 IIRC, without problems. The bit-depth is set from the desktop so that'll only have been tested on 32 bit. Texture flags are none (or rather, Blitz defaults).<br><br>Here's a picture that shows exactly what's wrong...<br><img src="http://www.softwaregeezers.com/SecretThings/GZRS_1.JPG"><br><br>In the textboxes the textures are copies of the backbuffer. There should also be white text from Blitz's text command in the middle between the Registration Key and the Options banner.<br><br>I'm going to replace it with a 2D drawing method. In this example I just used my 3D quad-based UI interface from the program for a quick solution. Hopefully it'll have a better time with just 2D drawing ops. <br><br></td></tr></table><br>
<a name="657623"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I was referring to the current Desktops depth not the one specified in graphics3d as I'm thinking the most likely problem in your code is a problem dependent on the driver's DirectDraw implementation and may very well fail on all ATI cards running in 16 bit desktop mode.<br><br>If it could be made to fail on consumer ATI cards it would obviously help with a workaround... <br><br></td></tr></table><br>
<a name="657696"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RGR</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Did you make the variable font_gothic Global ?<br>If not your code may point to space you don't expect and copies anything else instead of a Font... <br><br></td></tr></table><br>
<a name="657877"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> @ skidracer  : I don't know his desktop setting. Given he's got a 128 MB workstation card I'd be surprised if he's running 16 bit! But I'll be sure to get it tested on some lower bitdepth ATi cards too.<br><br>@ RaGR : Yep, font_gothic is declared global in another linked library. Even if not that wouldn't explain why Blitz's text drawing function doesn't work either.<br><br>Something I've experience creating the 2D drawn alternative, is Flip doesn't seem necessary. This is a point worth asking in an alternative thread... <br><br></td></tr></table><br>
<a name="657909"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> In typical embarrassing fashion, I've just found my code has the same problem on my PC and it isn't just their GPU. I changed the text drawing to speed it up and was only testing on fullscreen, and didn't test my setup after that it seems. The Setup executable I'm using works though. I don't know if that was an earlier build or what. I'm confused, but at least I have a not-working computer that I can test and fix. <br><br></td></tr></table><br>
<a name="657916"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> And to further embarrasment, it is fixed with a setbuffer Backbuffer() command on the textdrawing... <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
