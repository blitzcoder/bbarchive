<!DOCTYPE html><html lang="en" ><head ><title >B3D Collisions &amp; reflection</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >B3D Collisions &amp; reflection</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >B3D Collisions &amp; reflection</a><br><br>
<a name="1033972"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I only just realisefd the CollisionNX etc. commands should make things a lot easier for collisions. Previously, I was working on getting the collisiontriangle and figuring its planar vector and then the normal that way :D<br><br>Anywho, I've ended up with this function that should work for 2 dimensional rebounding (This all assumes the Y value (vertical height) is constant and irrelevant)<br><br>But the values I get out dont match hat I estimate they should be (I really suck at trig though... )<br><br>Overall I just need to know if this is correct, or at least on the right lines:<br><br><br><pre class=code>
	DebugLog "Rebound"
	;Returns the Yaw angle of reflection for CollisionEntity after a collision
	nX=CollisionNX(CollidedEntity,CollisionIndex)
	nZ=CollisionNZ(CollidedEntity,CollisionIndex)
	DebugLog "Collision="+collisionIndex+"  :  "+collidedentity
	
	Yaw=((ASin(nx)+ACos(nz)*2*Pi)) ; THIS IS PARTICULARLY THE LINE I AM NOT SURE ABOUT!
	
	DebugLog "Old Yaw="+EntityYaw(CollidedEntity,True)

	DebugLog "New Yaw="+Yaw

	Return Yaw

</pre><br><br>Al;ternatively, if this is all a complete load of rubbish and there's better, easier, faster or more 'standard' ways to achieve this result, please let me know :D <br><br></td></tr></table><br>
<a name="1034120"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Floyd</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> The angle for the Normal vector would be:<br><br><pre class=code>Yaw = ATan2( nz, nx )</pre><br>If I understand what you want there is an old yaw value and a "reflected" new value:<br><br><pre class=code>NewYaw = 2*Yaw - OldYaw - 180</pre><br>NewYaw may not be in the range of -180 to 180. That could be adjusted as follows:<br><br><pre class=code>NewYaw = NewYaw mod 360
If NewYaw &gt; 180 then NewYaw = NewYaw - 360
if NewYaw &lt;= -180 then NewYaw = NewYaw + 360</pre><br>You will have to test this as I'm just making it up as I go. But it seems right.<br><br>EDIT: If anyone saw this post earlier I have made one change. Originally I imagined the Old and New entity movement vectors as both coming out of the collision point. Of course that gets the Old backward. It should be moving into the collision point. So I changed the Old one to point in the opposite direction, i.e. change by 180 degrees.<br><br>That is why there is now a 180 in NewYaw = 2*Yaw - OldYaw - 180. <br><br></td></tr></table><br>
<a name="1034234"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> That's great, Floyd, thanks. <br><br>This also helps me to understand ATan2() better, it's one of the trig functions I understood the least!<br><br>Rather than deal with rotating the bouncing entity  itself in the function, I wanted to keep it simple as I am using pivots to control the movement of meshes whilst meshes need to face the right way, and of course, only the geometry of meshes can be used to collide as above.<br><br>Thanks too for the fix for the range. With that included it all appears to work as intended :) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
