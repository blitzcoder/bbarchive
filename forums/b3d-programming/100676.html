<!DOCTYPE html><html lang="en" ><head ><title >Bone root (Ragdoll)</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Bone root (Ragdoll)</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Bone root (Ragdoll)</a><br><br>
<a name="1190922"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yue</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> <img src="http://i39.tinypic.com/35i3lsl.jpg"><br><br>I have a problem, is that when you activate the rag doll effect, the main bone of the mesh (Scene_Root), not going behind the screen, this means that if the character falls from the platform and the camera goes behind the mesh , the character disappears, since the root stay somewhere where you start the rag doll effect.<br><br>Any possible help in this regard.<br><br>In the picture the bone stayed where this green bucket.<br><br>Greetings. <br><br></td></tr></table><br>
<a name="1190925"></a>

<a name="1190926"></a>

<a name="1190928"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> <pre class=code>Const INFINITY = 1000000000

MeshCullBox( character, -INFINITY, -INFINITY, -INFINITY, 2*INFINITY, 2*INFINITY, 2*INFINITY )</pre>Just call that once, after loading the animated mesh. <br><br></td></tr></table><br>
<a name="1190931"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> the root stay somewhere where you start the rag doll effect. <br></div><br><br>Actually I'd say the problem is with this. Why <i>isn't</i> the root moving? This is why you'd normally want your root to be centred on the character rather than separated from it - if the root itself is also being controlled by a physics object, you won't have this problem. <br><br></td></tr></table><br>
<a name="1190934"></a>

<a name="1190935"></a>

<a name="1190936"></a>

<a name="1190937"></a>

<a name="1190938"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yue</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> oO?? Thanks Kryzon!!<br><br>everything was left running perfectly with the fragment of code that you post.<br><br>Now, I had found a little dirty solution that is:<br><br><br><pre class=code>
	If PlayerDie% = True Then 
	PositionEntity  BoneRoot,EntityX(Camera\Objetct%),EntityY(Camera\Objetct%),EntityZ(Camera\Objetct%)   
	End If 
</pre><br><img src="http://i44.tinypic.com/es3l0h.jpg"> <br><br></td></tr></table><br>
<a name="1190939"></a>

<a name="1190940"></a>

<a name="1190941"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Why isn't the root moving? This is why you'd normally want your root to be centred on the character rather than separated from it - if the root itself is also being controlled by a physics object, you won't have this problem. <br></div><br>I'm not sure how the bones react with the physics engine - I'm guessing they keep imitating the physics objects' positions and rotations, while still keeping their parentage to the mesh's node.<br>If that's the case, then while the bones are imitating the physics objects, if you moved the mesh's node you would get a paradoxal behavior?<br><br>I agree that the mesh node should be close to the geometry or skeleton in all cases, as to avoid the problem that the OP had. But a robust solution must be found for this. <br>I'm not only talking about Blitz3D, but also Unity and other engines. It's something that ocasionally pops in my mind. How to deal with skeletal meshes and their root nodes?<br><br>- For some actions like running, jumping etc. I think you can animate your character performing them "in place". That is, if he's running, make him run on the same spot as if on a treadmill. Then in your program you only move this character's mesh node through code, based on keystrokes or gamepad input, while he's animating "in place"; Thus you have him actually walking etc.<br><br>- The problem comes with cinematics (cutscenes) or actions that require a more elaborate, non-cyclic animation. Climbing, for instance:<br><br><img src="http://i40.tinypic.com/34j3otu.gif"><br><br>If the character is animated like that, his mesh node becomes separated from the geometry (the geometry and the skeleton are going up, while the mesh node remains still on the ground).<br>The target is to keep this mesh's node mobile, not static. The couple of ways I thought to address this are:<br>1) Animate the character as usual, leaving the mesh node static during the sequence. When you're done producing the animation, <i>cut</i> the keyframes from the root bone and <i>paste</i> these keys onto the mesh's node timeline (this all inside the animation software). <br>The result shouldn't be visually different, and the mesh node would now animate along.<br><br>2) Animate the character as usual, leaving the mesh node static during the sequence. <br>In the game program, when the animation sequence <i>finishes</i> performing, you move the mesh node to where the skeleton is, and since the skeleton would be dragged along with the mesh node, you also move the skeleton's root bone in an <i>inverse</i> manner. That is, if the mesh node moves by XYZ and rotates by ABC, you move the skeleton's root bone by -XYZ and rotate it by -ABC.<br>The result shouldn't be visually different, and the mesh node would be relocated to be close to the mesh.<br><br>#2 should work best for small in-game actions (where there's almost no risk of missing the camera view) such as pulling levers, the climbing above etc. while #1 should work best for big cinematics where the characters walk around, big distances and all.<br><br>- Physics and ragdolls are still an unknown to me, I haven't thought of how to "attach" the mesh node to the physics in order for it to follow the skeleton along and not compromise the ragdoll behavior. If anyone has any insight on this I'd love to hear. <br><br></td></tr></table><br>
<a name="1190951"></a>

<a name="1190952"></a>

<a name="1190954"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yue</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> In my case my mesh has 16 bones in the mesh construction'm implemented and affected by the rag doll physics, however, what happens is that in Blender to export the character to make an extra bone, which is not affected by physics and this is amid character legs if this bone will remain an object physical attachment between the legs colliding with both legs, I think something weird at the time of activating the rag doll.<br><br>So the problem but still do not understand very well what code solves my friend Krizon.<br><br><img src="http://i39.tinypic.com/j835mh.jpg"> <br><br></td></tr></table><br>
<a name="1190991"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> After sleeping on it I have thought of a better way to blend between cutscenes or elaborate actions and player-controlled actions. By "elaborate actions" I mean actions where the character <i>walks around on his own</i>, without the player controlling him.<br><br>So the procedure:<br>Animate your character as usual and leave the mesh node static.<br><br>Keep in mind your skeleton needs a parent bone - that is, one bone at the top of the chain (this is what Yue is probably using). I recommend placing this root bone on the ground, between the character's feet, right on the origin of the world of your scene if you're just exporting a single character. <br>In your animation software, you also need to place your mesh's pivot point at this same location - so the root bone and mesh pivot point are aligned.<br>Since this root bone will control the entire skeleton hierarchy, it being on the ground facilitates all sorts of <i>alignment</i> you may want while you're producing animation or programming.<br>If you're animating several characters together (so it's a cutscene), make sure each character's mesh pivot point starts the animation aligned with their own root bones. So when you're preparing your scene and placing your characters around (you haven't animated anything yet), make sure you preserve the alignment of each mesh's pivot point with its corresponding root bone. Then start animating and at this moment the root bones can move around, with the mesh pivot points remaining static as they should.<br><br><img src="http://i42.tinypic.com/2v96hk1.png"><br><br>Now for the second part.<br>Take that climbing animation of before, for instance. If at the end of it your program would play the character's idle animation, the skeleton and geometry would snap back to the ground instead of being placed at the new height it just climbed, because in this idle sequence being played the root bone starts at the same position as the mesh's node. <br>So somehow we'd need to <i>commit</i> the new location of the skeleton to the mesh node.<br>With this we get this maxim: whenever a cutscene or elaborate animation sequence finishes playing, you realign the character's mesh node with its root bone. Since all of your animation sequences start with the root bone and mesh node aligned, this fixes all scenarios. <br><pre class=code>If climbingSequence_finished Then 
	PositionEntity( Character\Mesh, EntityX(Character\RootBone,True), EntityY(Character\RootBone,True), EntityZ(Character\RootBone,True), True )
	RotateEntity( Character\Mesh, EntityPitch(Character\RootBone,True), EntityYaw(Character\RootBone,True), EntityRoll(Character\RootBone,True), True )

	currentSequence = IDLE ;or WALKING, or whatever. Change the sequence to something the player will control. 
EndIf</pre> <br><br></td></tr></table><br>
<a name="1190997"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yue</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> My Mesh.<br><img src="http://i44.tinypic.com/34quxqu.jpg"><br><br>Well, you always learn something every day, at this point I have many questions because I do not know everything.<br><br>MI mesh is skeletonized as shown in the picture, but the bone in the middle half of the legs appears after export to b3d format.<br><br>Although the problem is already solved, I'm stuck on several things if you can not do.<br><br>1 * It is possible that after making the rag doll effect, restore the character to the original position. For example a car runs him over but it is not dead, so you stand nevus.<br><br>if this is possible, as is done?<br><br>A greeting. <br><br></td></tr></table><br>
<a name="1191007"></a>

<a name="1191011"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't know why the exporter creates that extra bone. I read through the script and couldn't find anything responsible for it.<br><br>But if you want to restore the character after he goes into ragdoll mode, you need to resort to your code. <br>How are you "turning on" the ragdoll mode?<br><br>I believe somewhere in your code you're <i>attaching</i> each bone to a rigidbody object, and these rigidbody objects are connected to each other with physics joints.<br>When the character dies, you let the rigidbodies take control of the bones. <br>To restore the character, you just need to turn off that relationship between bones and rigidbodies, and make your character perform some sequence with Animate(). <br><br></td></tr></table><br>
<a name="1191185"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yue</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok no proble with scene_root, i confuse export new root.<br><br><img src="http://i41.tinypic.com/2nkri44.jpg"> <br><br></td></tr></table><br>
<a name="1191301"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> To reiterate how important that ground bone is for proper game character skeletons.<br>I've discovered that Autodesk's MotionBuilder also deals with this root bone between the character's feet, on the ground.<br><br><img src="http://i39.tinypic.com/a1tqar.png"><br><br>They call it a "Reference" bone, and the documentation goes on to present a couple of uses for it:<br><a href="http://download.autodesk.com/global/docs/motionbuilder2013/en-us/files/GUID-A900A0BA-A1A6-4707-A6AE-26FE8F49BEC6.htm#SECTION_AFFED949B4494AAC97735591BC2556BA" target="_blank">HIK Character - Special Nodes</a> <br><br></td></tr></table><br>
<a name="1191634"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yue</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> <img src="http://i40.tinypic.com/2gvsmkz.png"><br><br>ok, thanks for the info, the only thing that occurred to me is to put half the mesh soil and main root is in the middle of the character, things to fit properly in B3D physics. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
