<!DOCTYPE html><html lang="en" ><head ><title >Freeing Entities and Images</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Freeing Entities and Images</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Freeing Entities and Images</a><br><br>
<a name="269866"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ChrML</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I looked with AvailVidMem() how much memory my video card has left after loading, and unloading, but it seems to always forget to unload something (because I always loose 3 mb video memory, for each time I unload, and load something). This is my code:<br><br><br><br>Load_Mainmenu.bb:<br>;Goto start<br>.load_mainmenu<br><br>;Display loadingscreen<br>ShowLoadingScreen("Data\images\loadscr_main.bmp",showcoords)<br><br>;Create camera<br>camera=CreateCamera()<br>PositionEntity camera,0,0,0<br>RotateEntity camera,0,0,0<br><br>;Set ambient light<br>AmbientLight 15,15,15<br><br>;Load scene<br>If FileType("Data\world\mainmenu.x")=0 Then<br>  RuntimeError "Couldn't locate mainmenu.x"<br>EndIf<br>scene=LoadMesh("Data\world\mainmenu.x")<br>PositionEntity scene,0,0,0<br>RotateEntity scene,0,0,0<br><br>;Load mousepointer<br>LoadMousePointer("Data\images\mouse\menu.bmp","Data\images\mouse\1pic.bmp",255,0,255)<br><br>;Load menues<br>; Validating<br>If FileType("Data\images\menues\menutop_main.bmp")=0 Then<br>  RuntimeError "Couldn't locate menutop_main.bmp"<br>EndIf<br>If FileType("Data\images\menues\menutop_load.bmp")=0 Then<br>  RuntimeError "Couldn't locate menutop_load.bmp"<br>EndIf<br>If FileType("Data\images\menues\menu_new.bmp")=0 Then<br>  RuntimeError "Couldn't locate menu_new.bmp"<br>EndIf<br>If FileType("Data\images\menues\menu_save.bmp")=0 Then<br>  RuntimeError "Couldn't locate menu_save.bmp"<br>EndIf<br>If FileType("Data\images\menues\menu_load.bmp")=0 Then<br>  RuntimeError "Couldn't locate menu_load.bmp"<br>EndIf<br>If FileType("Data\images\menues\menu_multi.bmp")=0 Then<br>  RuntimeError "Couldn't locate menu_multi.bmp"<br>EndIf<br>If FileType("Data\images\menues\menu_quit.bmp")=0 Then<br>  RuntimeError "Couldn't locate menu_quit.bmp"<br>EndIf<br>If FileType("Data\images\menues\loadmenu_gamenames.bmp")=0 Then<br>  RuntimeError "Couldn't locate loadmenu_gamenames.bmp"<br>EndIf<br>If FileType("Data\images\menues\menufoot.bmp")=0 Then<br>  RuntimeError "Couldn't locate menufoot.bmp"<br>EndIf<br><br>; Loading<br>menutop_main=LoadImage("Data\images\menues\menutop_main.bmp")<br>menutop_load=LoadImage("Data\images\menues\menutop_load.bmp")<br>menu_new=LoadAnimImage("Data\images\menues\menu_new.bmp",201,20,0,2)<br>menu_save=LoadAnimImage("Data\images\menues\menu_save.bmp",201,20,0,2)<br>menu_load=LoadAnimImage("Data\images\menues\menu_load.bmp",201,20,0,2)<br>menu_quit=LoadAnimImage("Data\images\menues\menu_quit.bmp",201,20,0,2)<br>menu_multi=LoadAnimImage("Data\images\menues\menu_multi.bmp",201,20,0,2)<br>loadmenu_gamenames=LoadImage("Data\images\menues\loadmenu_gamenames.bmp")<br>menufoot=LoadImage("Data\images\menues\menufoot.bmp")<br><br>; Masking<br>MaskImage(menutop_main,255,0,255)<br>MaskImage(menutop_load,255,0,255)<br>MaskImage(menu_new,255,0,255)<br>MaskImage(menu_load,255,0,255)<br>MaskImage(menu_save,255,0,255)<br>MaskImage(loadmenu_gamenames,255,0,255)<br>MaskImage(menu_multi,255,0,255)<br>MaskImage(menu_quit,255,0,255)<br>MaskImage(menufoot,255,0,255)<br><br>; Menu positions<br>mainmenux=588<br>mainmenuy=434<br>newgamemenux=0<br>newgamemenuy=0<br>loadgamemenux=86<br>loadgamemenuy=225<br>loadgametextx=187<br>loadgametexty=230<br>onlinemenux=0<br>onlinemenuy=0<br><br>;Variables<br>menux=mainmenux<br>menuy=mainmenuy<br>menumode=1<br>camerawander_main_first=0<br><br>;Load fonts<br>font_gamenames=LoadFont("Alfredo's Dance",20)<br>font_standard=LoadFont("Arial",16)<br><br>;Create lights<br>Dim light(3000)<br>light(1)=CreateLight(3)<br>PositionEntity light(1),-106.893,49.8281,14.2249<br>RotateEntity light(1),24.1333,-98.297,0<br>LightRange light(1),400<br><br>;Create Dims<br>Dim save_gamenames$(6)<br>Dim save_health%(6)<br>Dim save_checkpoint%(6)<br><br>;Hide loadingscreen<br>Cls<br>CameraViewport camera,0,0,resx-camleft,resy-camtop<br><br>;Main loop<br>Include "Loop_Mainmenu.bb"<br><br>;Unload<br>.unload_mainmenu<br>Include "Unload_Mainmenu.bb"<br><br>;City Level<br>.load_city<br>Include "Load_City.bb"<br><br><br><br><br><br><br><br><br><br><br>And this code for unloading ("Unload_Mainmenu.bb"):<br>;Images<br>FreeImage menutop_main<br>FreeImage menutop_load<br>FreeImage menu_new<br>FreeImage menu_save<br>FreeImage menu_load<br>FreeImage menu_quit<br>FreeImage menu_multi<br>FreeImage loadmenu_gamenames<br>FreeImage menufoot<br><br>;World<br>FreeEntity scene<br><br>;Cameraes<br>FreeEntity camera<br><br>;Lights<br>FreeEntity light(0)<br><br>;Fonts<br>FreeFont font_gamenames<br>FreeFont font_standard<br><br>If leveltoload$="City" Then<br>  Goto load_city<br>EndIf<br><br><br>Anyone see where the memory loss is? <br><br></td></tr></table><br>
<a name="269869"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Don't forget that your desktop/windows takes up vidmem as well!  I have a 32Mb card but the most AvailVidMem ever reports is about 28.5Mb. <br><br></td></tr></table><br>
<a name="269870"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ChrML</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> No, it's not that. Didn't you read that I'm loosing more and more memory for each time I reload inside the game? First when I am at the mainmenu, I have 58 megs left. Then I load the City, now I have 55 which is understandable, cuz it's bigger. Then I load the Mainmenu again, but now I only have 53. Then I load the city again, and have 50 megs. The freeing and loading for the mainmenu is over. Anyone see the memory loss? <br><br></td></tr></table><br>
<a name="269872"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >fredborg</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Assuming your models are textured, you should also free the textures. You can find out which ones are used with the new GetTexture/GetBrush commands, or simply call ClearWorld after freeing all the models.<br><br>That should work, try it out! <br><br></td></tr></table><br>
<a name="269909"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ChrML</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Does ClearWorld free all textures in the models? <br><br></td></tr></table><br>
<a name="269912"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ChrML</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm, I used ClearWorld() in the unloading script now, and after that, I unloaded all images, but it still looses memory. Any other stuff that can cause it? <br><br></td></tr></table><br>
<a name="269985"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ChrML</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Bump ^ <br><br></td></tr></table><br>
<a name="270198"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Graythe</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> FreeEntity Light(1) should be FreeEntity Light(0) but Clearworld() should cure that.<br><br>Include is a thing that should only be executed once per inclusion as there is no way to unload an include.<br><br>I hope it helps. <br><br></td></tr></table><br>
<a name="270213"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ChrML</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm, but all entities as freed in UnloadMainmenu.bb (as shown above), or isn't that possible? When I use include, it copies and pastes the code in, and the loop itself (no loading), is in Loop_Mainmenu.bb. What makes that impossible? Are there any ways to see if an entity exists or not? <br><br></td></tr></table><br>
<a name="271372"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Graythe</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> The last line of code is a goto. At the destination is an include command. I assume the include is being included each time the goto is executed. This may not be the problem but it is the likeliest thing I can see.<br><br>;City Level <br>.load_city <br>Include "Load_City.bb" <br><br>And this code for unloading ("Unload_Mainmenu.bb"): <br>;Images <br>FreeImage menutop_main <br>FreeImage menutop_load <br>FreeImage menu_new <br>FreeImage menu_save <br>FreeImage menu_load <br>FreeImage menu_quit <br>FreeImage menu_multi <br>FreeImage loadmenu_gamenames <br>FreeImage menufoot <br><br>;World <br>FreeEntity scene <br><br>;Cameraes <br>FreeEntity camera <br><br>;Lights <br>FreeEntity light(0) <br><br>;Fonts <br>FreeFont font_gamenames <br>FreeFont font_standard <br><br>If leveltoload$="City" Then <br>Goto load_city <br>EndIf <br><br></td></tr></table><br>
<a name="271374"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Was it posted somewhere that when freeing entites blitz won't actually free the memory until it's needed, it just deletes the pointer refering to the model. I'm sure that was the case. Just can't find the post anywhere... <br><br></td></tr></table><br>
<a name="271523"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Genexi2</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wasnt that for Types Joker? <br><br></td></tr></table><br>
<a name="271568"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes it was with types. But bear in mind, that you have to make a call to UpdateWorld or RenderWorld ( one of em, I forget which ) before things are freed from video memory. Unless that's changed in a recent update. Certainly used to be that way. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
