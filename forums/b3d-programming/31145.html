<!DOCTYPE html><html lang="en" ><head ><title >multithreaded texture loading (C/C++)</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >multithreaded texture loading (C/C++)</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >multithreaded texture loading (C/C++)</a><br><br>
<a name="332095"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LAB[au]</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> hello,<br>i found a way to load an image into a texturebuffer, from inside a dll.  so now you could load your texture-images into a blitz3D scene using a separate thread...<br><br>the idea is to do a bit of pointer magic to cast a (BB) ImageBuffer to a (C/C++) DirectDrawSurface  &amp; fill it up with RGB data from inside your dll code..<br><br>problem (if any DirectX developer got an idea..): still not supporting mipmapping.<br><br>mail me pieter(at)lab-au.com for source-code -- don't mail me to distribute binaries. <br><br></td></tr></table><br>
<a name="332223"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sweenie</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've been playing around with multithreaded loading as well.<br><br>So far I've only fiddled with meshes but i'm about to start experimenting with images as well.<br>One thing that is important to me is that I don't want to load the data into a memorybuffer at once, but instead stream it piece by piece directly from file.<br>To allow for smooth streaming I written a little app in Blitz that loads any mesh of choice and then writes the rawdata into a new file in the following order:<br><br>Total number of surfaces<br>Texturename for first surface(if used)<br>Number of vertices in first surface<br>VertexList of first surface(pos, uv's, normals &amp; colors)<br>Number of triangles in first surface<br>TriangleList of first surface<br>... and repeat for the rest of the surfaces.<br><br>When I load a mesh using this raw datafile I actually managed to load it faster than Blitz's LoadMesh command.<br>For example,<br>I loaded the castlemodel(from the samples) 100 times using LoadMesh and using My rawmesh loader.<br>With LoadMesh it took 11717 milliseconds<br>With RawMeshloader it took 2877 milliseconds.<br><br>As an extra bonus I can manipulate the vertices at loadtime,<br> such as setting vertexcolors &amp; scale the mesh.<br><br>I also tried a renderworld after each added triangle, and it's so cool to see the mesh gradually build up, though it slows down the loading ALOT, wonder why? ;) hehe<br><br>Anyway, so far it's not really multithreading but more like streamed loading.<br><br>Tonight, I will try the same approach on images.<br><br>What worries me are the sounds.<br>Meshes and textures can be created in Blitz but afaik sounds must be loaded. <br><br></td></tr></table><br>
<a name="332250"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LAB[au]</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> sounds cool,  very interesting.<br><br>must be great to see the geometry being streamed into the scene<br><br>till now, i didn't try to find the data structure BB is using for representing 3D geometry (and to use it in C/C++ for true multithreaded loading). guess it must be quite a lot more complicated than imagebuffer... <br><br></td></tr></table><br>
<a name="332255"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sweenie</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> LAB[au],<br>Do you load the imagedata directly into the texturebuffer or do you first create a separate imagebuffer(in blitz),load the imagedata into it and then copy the image to the texturebuffer with copyrect? <br><br></td></tr></table><br>
<a name="332259"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rob</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can stream music in using playmusic, however I don't imagine sound samples taking up much space anyway. <br><br></td></tr></table><br>
<a name="332276"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >mrtricks</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've often thought about his kind of thing - loading a file bit by bit. I'm using multitasking routines to build up and destroy my scenery bit by bit so as not to interrupt the frame rate - that's with custom meshes built inside the program, but I've been thinking about loading stuff too. Would allow for great big levels... <br><br></td></tr></table><br>
<a name="332286"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sweenie</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I thought about using a DLL, but I'm gonna try using only Blitz3D first.<br><br>To keep the framerate up I'm gonna use a timeoutvalue in the meshloaderroutine.<br>For example, if I set the timeoutvalue to 10 milliseconds the meshloader will load the data for a maximum of 10 milliseconds and then bail out, letting Blitz move on with the loop.<br>The next time the meshloaderfunction is called it will continue where it was.<br>A low timeoutvalue should be equal to high framerate and slow loading while a high timeoutvalue should be equal to low framerate and fast loading. <br><br></td></tr></table><br>
<a name="332298"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LAB[au]</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> ...answering question from Sweenie (Posted 2004-03-03 04:16:03)<br><br>i load the imagedata immediately into the buffer, not needing CopyRect etc. or any other blitzcommand.  <br><br>(btw. using CopyRect you still need to write immediately to a buffer -- as it is not possible to copy a bank into a buffer..)<br><br>i needed this for loading massive amount of imagedata (&gt; 1300 512x512 textures) into a scene -- where i load (&amp; unloaded) the images from the harddisk just when i need them. <br><br></td></tr></table><br>
<a name="332324"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sweenie</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> problem (if any DirectX developer got an idea..): still not supporting mipmapping. <br></div><br><br>I thought that the mipmapping wouldn't work because of your "behindthescene" altering of the texture buffer.<br>But maybe if you first create an ordinary blitz imagebuffer, fill it with data using your DLL and then copyrect this image to the texturebuffer it would work.<br><br>Or have you simply forgotten to set the mipmap flag when using CreateTexture()? <br><br></td></tr></table><br>
<a name="332410"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LAB[au]</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> i really want to generate the mipmap in a background thread --   so it doesn't disturb smooth animation/interaction (generating mipmaps is quite fast, but user-noticable &amp; results in shocking motion)<br><br>(btw: your tip works: mipmaps are generated, thnx !) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
