<!DOCTYPE html><html lang="en" ><head ><title >Falling though a terrain mesh</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Falling though a terrain mesh</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Falling though a terrain mesh</a><br><br>
<a name="417472"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I am experiencing a really bad problem falling through the terrain in a large mesh.  The terrain is about 130,000x130,000 units, and each segment is 16,000 units wide, and about 1024 polys.  This happens when I go up inclines, and it is in the middle of a single terrain mesh, not on the seams between meshes. <br><br></td></tr></table><br>
<a name="417473"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've experienced this with Blitz terrains, my own terrain meshes, etc., I honestly haven't found a way to fix it.  I guess you could always switch to using Coldet and write a bit of code for sliding and such.  I intend to try that as a small project, since it seems to be fairly simple given you're using elias_t's wrapper. <br><br></td></tr></table><br>
<a name="417481"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wow, at first I thought it was because the terrain was jagged, but I smoothed it out and I am falling through pretty much everything.<br><br>Has anyone had success using Nuclear Glory with this?  This is a terrible problem! <br><br></td></tr></table><br>
<a name="417483"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >poopla</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> My first thought here is your scale is wrong, and you're at the low FPS your having, the floating point precision is causing problems.   Ya might try scaling everythign down.<br><br>If that's not it, then I'll keep braingstorming. <br><br></td></tr></table><br>
<a name="417484"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> What does scale have to do with floating point precision?<br><br>I reverted to my old method of line picking to avoid slope sliding, and I was able to travel even the most jagged terrain.  It seems like I only solve problems once I post about them.  It's weird, I am stuck on something, I post a thread, and then immediately solve it.<br><br>This engine is going to rock.  I have put so much work into figuring out all the little nuances of Blitz. <br><br></td></tr></table><br>
<a name="417487"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MadJack</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've had similar. The only solution is to break your terrain up into smaller mesh chunks to avoid floating point errors - else institute a backup linepick routine. <br><br></td></tr></table><br>
<a name="417507"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jeremy Alessi</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmmm... strange problem.  It's probably floating point precision but it could be that you have too much gravity and not enough normal force.  I mean Blitz is supposed to stop object from moving through each other but it doesn't work very well with moving objects especially if the scale of the movement to the objects is a large ratio. <br><br></td></tr></table><br>
<a name="417709"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Extron</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Halo check this :<br><a href="http://www.blitzbasic.com/Community/posts.php?topic=26738#279339" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=26738#279339</a><br><br>As you read this a massive land 524288x524288 units terrain.<br><br>No linepick, just find what quad of the terran mesh is inside your position (if your mesh terran is formated in certain manner) and perform a pseudo linepick function just in the two triangles of this quad, returning the intersection point + angle of greater slope + sliding vector.<br>Blitz collision detection is inacurate beyond 8000 units.<br>It's why i use now the Nuclear Glory detection collision. <br><br></td></tr></table><br>
<a name="417714"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Warren</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  What does scale have to do with floating point precision?  <br></div><br><div class="quote"> This engine is going to rock. <br></div><br>These statements are in direct conflict with each other.  :) <br><br></td></tr></table><br>
<a name="417736"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> You idiot, scale is irrelevant to floating point precision if all objects use the same scale. <br><br></td></tr></table><br>
<a name="417761"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Warren</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Shh, use your big boy voice. <br><br></td></tr></table><br>
<a name="417765"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jeremy Alessi</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't think that's true.  Blitz will run out of precision regarding the global transforms of the characters thus making the collision detection less accurate. <br><br></td></tr></table><br>
<a name="417767"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Andy</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> &gt;You idiot, scale is irrelevant...<br><br>Stop namecalling or i'll strap you to a rock and let you roll down mount ego!<br><br>Andy <br><br></td></tr></table><br>
<a name="417770"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Warren</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> If scale doesn't matter to precision, the physics programmer here will be thrilled!  I'll go let him that he's been working under a misconception for years... <br><br></td></tr></table><br>
<a name="417773"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Floyd</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Scale doesn't matter if *everything* is scaled the same way.<br><br>But that is almost certainly not the case. The entities may have similar scale, but what about movement? Does the player move ten times as fast when he is ten times as far from the origin? That's not likely.<br><br>The problem almost certainly floating point precision. This would typically cause problems which get worse as you move farther away from (0,0,0). <br><br></td></tr></table><br>
<a name="417774"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> You clearly have no concept of the subject.  If I scaled everything down the same way, it would have no effect on floating point precision.  I don't have the patience to explain why every reason you have offered is self-defeating, and have no hope in your ability to understand anyways. <br><br></td></tr></table><br>
<a name="417786"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jhocking</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Scale definitely has an affect vis a vis floating point precision.  Are you high or sleep deprived or something?  Because usually you're a pretty knowledgable programmer.<br><br>Let's look at an example.  If you use a scale of 1 unit=1 meter, then a millimeter (perfectly reasonable for, say, the amount an idling character has moved between frames) is 0.001 units.  If you were to change the scale to 1 unit=1 kilometer (for example) the a millimeter would be 0.000001 units.  Admittedly this is kind of a silly example (although even smaller changes are routine in a lot of calculations) but the point is that scale and floating point precision certainly are related.<br><br><br>As for your specific problem however, I would guess that it's a scale problem in the other direction.  130,000x130,000 units is huge, much bigger than Blitz can comfortably handle.  You might consider trying a larger scale for your game (ie. scale down all of the objects proportionally) so that the terrain won't be as large. <br><br></td></tr></table><br>
<a name="417795"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> I repeat, you clearly have no concept of the subject.<br><br><pre class=code>a#=0.0000001
b#=0.0000003
Print (a+b);no imprecision
Print (1.0+a);floating point imprecision, biatch
WaitKey</pre> <br><br></td></tr></table><br>
<a name="417804"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Floyd</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Print (a+b);no imprecision<br>Print (1.0+a);floating point imprecision<br><br><br>That is exactly the point about the very large terrain. Your current position has a certain x value and you take step. The new x is x+xStep. The size of xStep would usually be roughly constant. But on your huge terrain x could be 1 or 100000. <br><br>Assuming xStep is rather small the expression 1+xStep is done very accurately but 100000+xStep is not. <br><br></td></tr></table><br>
<a name="417806"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> Jesus, how simple do I have to make this?  If your values are enough magnitudes different, scaling them down will make no difference.<br><pre class=code>a#=0.0000001
b#=1.0
Print (a+b);floating point imprecision
a=a/10000.0
b=b/10000.0
Print (a+b);still floating point imprecision
WaitKey</pre><br>This is in response to the suggestion that I scale the entire world smaller:<br><div class="quote"> My first thought here is your scale is wrong, and you're at the low FPS your having, the floating point precision is causing problems. Ya might try scaling everythign down. <br></div> <br><br></td></tr></table><br>
<a name="417817"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Floyd</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> We can't say anything based solely on the scale of the terrain. The issue is the interaction of movement, usually small values, and position.<br><br>The original problem was falling through the terrain. Where does this happen? If it is very far from (0,0,0) then you should suspect floating point accuracy as the reason. <br><br>Similarly, there are issues with very steep terrain. Again, this is most likely a result of mixing large and small numbers. On steep terrain a small horizontal movement induces a large vertical movement. <br><br></td></tr></table><br>
<a name="417835"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Warren</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Jesus, how simple do I have to make this? If your values are enough magnitudes different, scaling them down will make no difference.  <br></div><br>Sounds like someone needs a nap. <br><br></td></tr></table><br>
<a name="417840"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dirk Krause</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> As a totally different approach: couldn't you implement a set of ghost triangles 'under your feet' that closely resembles the terrain, is not visible but does the collision detection? <br><br></td></tr></table><br>
<a name="417875"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you look back at the posts, I solved this awhile back, but thanks. <br><br></td></tr></table><br>
<a name="417879"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dirk Krause</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> ok, I see. This was just in case you wanted to return to the method you used before.<br><br>I am looking forward to see a demo of that engine you're working on. <br><br></td></tr></table><br>
<a name="417922"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TomToad</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> halo, have you even tried scaling everything down?  It's a known fact that Blitz3D collision detection gets more inaccurate the further from 0,0,0 you get.  Supposedly, collisions are only reliable up to about 10,000 units from the origin.  I can't tell you if it's floating point inaccuracies, or some other bug causing this, but by scaling your world so everything is below 10,000 would help.<br><br>I know you came up with your own solution which is great, but don't immediately disregard someone elses idea simply just because it doesn't make sense to you.<br><br>On BlitzCoder.com, someone has come up with another method in which, when your character gets to be more than a certain number of units from 0,0,0, the whole world gets shifted over to put the character back at 0,0,0.<br><pre class=code>
If playerx &gt; 5000 or playery &gt; 5000 or playerx &lt; -5000 or playery &lt; -5000
 terrainx = terrainx - playerx
 terrainy = terrainy - playery
 PositionEntity terrain, terrainx, terrainy, 0
 PositionEntity player, 0, 0, EntityZ(player)
 playerx = 0
 playery = 0
End If
</pre><br><br>If your world contains many objects, such as trees and buildings, then you'd move only what was visible in the immediate area, then move the rest of the world little by little every few frames or so to prevent a sudden pause in the game. <br><br></td></tr></table><br>
<a name="417962"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Beaker</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> I can't believe "halo" is questioning the mathematical judgement of the great "floyd".<br><br>Wonders will never cease. <br><br></td></tr></table><br>
<a name="417994"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MadJack</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> Big meshes -&gt; blitz native collisions will fail intermittantly.<br><br>Halo -&gt; Derek Smart? <br><br></td></tr></table><br>
<a name="418120"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >poopla</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't have to explain myself now since everyone else already stated the facts.  Yay!<br><br>(Go study collision detection halo.  It might have helped you avoid sounding like an idiot multiple times.)<br><br><div class="quote"> <br>You idiot, scale is irrelevant to floating point precision if all objects use the same scale.<br> <br></div><br><br>Scale is irrelevant.  Were talking about simple math imprecisions when the values stored in blitz's limited floating point mechanism are overrun by a lack of decimal point "locations" to store small values. <br><br></td></tr></table><br>
<a name="418164"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Caff</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> pwned <br><br></td></tr></table><br>
<a name="418195"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Neochrome</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> Might help, i had this before, i fixed it by toning down the floating numbers.<br>I understand that blitz Can do floating numbers, but there not precice. make it about 1.00 two numbers after the point should fix things, it will do 3, but nyhight than 5 numbers after the point, things start falling through walls. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
