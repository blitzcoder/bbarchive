<!DOCTYPE html><html lang="en" ><head ><title >Write to terrain texture</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Write to terrain texture</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Write to terrain texture</a><br><br>
<a name="251934"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >abacadabad</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi there,<br>Can anyone help me with this bit of code;<br><br>;////////////<br>terrain2=LoadTerrain ("Heightmap.bmp")<br>ScaleEntity terrain2, 1,12,1<br>PositionEntity terrain2,0,7,0<br>EntityTexture terrain2,tex1<br><br>texbuf=TextureBuffer(tex1)<br>LockBuffer db<br><br>	For x=0 To 256<br>		For y=0 To 256<br>		height=TerrainHeight# ( terrain2,x,y )<br>				If height&gt;0.5<br>				Color 255,0,0<br>WritePixel x,y,(Color),texbuf<br>EndIf<br>		Next<br>	Next<br>	UnlockBuffer texbuf<br>;///////////		<br><br>When the program runs, a large patch of the terrain texture (seemingly unrelated to height) is painted black, and the onscreen text goes red. <br>I would actually like the texture to write depending on the height of the returned terrain, which could make lots of cool effects (snow on mountains changing with seasons etc), but this deosnt seem to work? <br><br>Thanks, :-) <br><br></td></tr></table><br>
<a name="251997"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >makakoman</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> You need to get the rgb value of the color for your WritePixel command.<br><br>For 32 bit RGB values:<br><br>alpha = bits 24 to 31<br>red = bits 16 to 23<br>green = bits 8 to 15<br>blue = bits 0 to 7<br><br>argb = (red shl 16) + (green shl 8) + blue<br><br>or in your case<br><br>argb = (255 shl 16) ; you don't use green and blue<br><br>or you could just use $FF0000 for red.<br><br>Then:<br><br>WritePixel x, y, argb, texbuf<br><br>and if you are going to bother to lock the buffer then use:<br><br>WritePixelFast x,y,argb, texbuf<br><br>You might also want to check your LockBuffer db.<br><br>Shouldn't that be LockBuffer texbuf?<br><br>One more thing, I think your loops should be 0 to 255, not 0 to 256.<br><br><br><pre class=code>
;//////////// 
terrain2=LoadTerrain ("Heightmap.bmp") 
ScaleEntity terrain2, 1,12,1 
PositionEntity terrain2,0,7,0 
EntityTexture terrain2,tex1 

texbuf=TextureBuffer(tex1) 
LockBuffer texbuf

For x=0 To 255
For y=0 To 255 
height=TerrainHeight# ( terrain2,x,y ) 
argb = $FF0000
If height&gt;0.5 
WritePixelFast x,y,argb,texbuf 
EndIf 
Next 
Next 
UnlockBuffer texbuf 
;/////////// 
</pre><br><br>Hope this helps.<br>MK <br><br></td></tr></table><br>
<a name="252504"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >abacadabad</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi!<br>Thankyou for your reply :-) Fortunately the code paints the colour red, but unfortuanelty the area painted doesnt match up to the height. It seems to paint it correctly, just offset in the wrong place. Any ideas?<br><br>Thanks :-) <br><br></td></tr></table><br>
<a name="252508"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >abacadabad</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi again,<br>After mucking around it seems that the texture is painted correctly, but just reversed onto the terrain. Why do you think this would happen and how would you fix it? I tried putting in a "RotateTexture" command, but that just clears the texture of the red completely :-(<br><br>Thanks again <br><br></td></tr></table><br>
<a name="252543"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bolo_Loco</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> hi<br><br>try this :<br><br>WritePixelFast x,255-y,argb,texbuf <br><br>Bolo <br><br></td></tr></table><br>
<a name="252611"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >makakoman</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> abacadabad,<br><br>The reason the texture looks like it paints upside down is because the 2D origin is at the upper left of the texture, and the 3D origin is at the lower left.  The easiest way to fix this that I know of is to just scale the texture with a negative value on the Y axis.  <br>For instance: ScaleTexture(1, -1) or ScaleTexture(256, -256)<br><br>Although the method Bolo_Loco suggest will work just as well!<br><br>Good Luck,<br>MK <br><br></td></tr></table><br>
<a name="252668"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DrakeX</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> i'm not sure why B3D uses the lower-left as UV (0,0), when every other 3d language (and DirectX itself) uses the top left as UV (0,0).  very confusing and annoying. <br><br></td></tr></table><br>
<a name="252896"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >abacadabad</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br>It works!! :-) Thankyou very much! Ill get cracking and post some screenshots later on on how it hoes...thanks again! <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
