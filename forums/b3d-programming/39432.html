<!DOCTYPE html><html lang="en" ><head ><title >Image handles in global types don't work?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Image handles in global types don't work?</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Image handles in global types don't work?</a><br><br>
<a name="439825"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >pangyan</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've got the following code: <br>Type InterfaceGlobals <br>Field interfaceImage <br>end type <br><br>Then in another file I have: <br>global theInterfaceGlobals.InterfaceGlobals <br><br>I call a function: <br>function loadinterfaceImage(filename$) <br>theInterfaceGlobals = new interfaceGlobals <br>theInterfaceGlobals\interfaceImage = loadimage(filename$) <br>end function <br><br>I've done a Stop in this function and verified that a image handle is got. <br><br>However trying to access the image handle does not work from any other functions. I have to move the image handle outside into a global variable and then access it. Can't I store a image handle in a global type? <br><br></td></tr></table><br>
<a name="439850"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tiger</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> How do you access handle to the image??<br>You can store image handle like you do, so you must do something wrong when you try to access it. <br><br></td></tr></table><br>
<a name="440099"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >pangyan</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I use it like so:<br>DrawImage(theInterfaceGlobals\interfaceImage,.....)<br>It doesn't work... I get a memory access violation, eventhough I placed a Stop to ensure that the handle has the same value as when I load up the image. <br><br></td></tr></table><br>
<a name="440103"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mo</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Maybe you set/reset the graphics-mode after loading the image? <br><br></td></tr></table><br>
<a name="443020"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >pangyan</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> No I didn't change anything in the graphics mode. I only set it once. <br><br></td></tr></table><br>
<a name="443032"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tiger</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Can you post the source code so we can have a good look at it?? Or it is all you have?? (in the first post?) <br><br></td></tr></table><br>
<a name="443036"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tiger</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Test this:<br><pre class=code>

Graphics 800,600

Type InterfaceGlobals 
Field interfaceImage% 
End Type 

im=CreateImage(800,600)
SetBuffer ImageBuffer(im)
For x=0 To 40
Color x*2+50,x*2+50,x*2+50
Rect Rand(0,800),Rand(0,600),Rand(10,20),Rand(10,20),1
Next
SetBuffer BackBuffer()

SaveImage(im,"Test.bmp")
FreeImage(im):im=0

;Then in another file I have: 
Global theInterfaceGlobals.InterfaceGlobals 


 loadinterfaceImage("Test.bmp")

 DrawImage(theInterfaceGlobals\interfaceImage,0,0)
 Flip
 WaitKey
 
Function loadinterfaceImage(FileName$) 
theInterfaceGlobals = New interfaceGlobals 
theInterfaceGlobals\interfaceImage = LoadImage(FileName$)  
End Function
</pre><br><br>Works for me. <br><br></td></tr></table><br>
<a name="443115"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Graythe</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> That works here too. <br><br></td></tr></table><br>
<a name="443126"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> i think that<br><br><pre class=code>
function loadinterfaceImage(filename$) 
theInterfaceGlobals = new interfaceGlobals 
theInterfaceGlobals\interfaceImage = loadimage(filename$) 
end function
</pre><br><br>Would make that type variable a local one. Usually any variables created in a function will become local, and override any global ones. <br><br></td></tr></table><br>
<a name="443141"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tiger</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ross C:<br>It don't get local because you don't make it local.<br>if you want it local you must type:<br><pre class=code>
function loadinterfaceImage(filename$) 
Local theInterfaceGlobals = new interfaceGlobals ;&lt;--Local
theInterfaceGlobals\interfaceImage = loadimage(filename$) 
end function
</pre> <br><br></td></tr></table><br>
<a name="443156"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ah, sorry, never noticed the Global at the top :o) <br><br></td></tr></table><br>
<a name="443170"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RiverRatt</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Type InterfaceGlobals <br>Field interfaceImage <br>end type <br><br>Should Field interfaceImage be Field interfaceImage$ ?<br><br>Fogive me I'm still new <br><br></td></tr></table><br>
<a name="443172"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> nope it might be interfaceImage%<br>but as this is the default, the % is not needed <br><br></td></tr></table><br>
<a name="443818"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >pangyan</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> That code worked strangely enough, of course I do have a LOT more code in my program. Let me see if I can reproduce the bug. (I fixed the code, by taking the image handle out of the type and putting it in a global variable). <br><br></td></tr></table><br>
<a name="444042"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >aab</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> would THIS not work?<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
function loadinterfaceImage(filename$) 
theInterfaceGlobals.interfaceGlobals  = new interfaceGlobals 
theInterfaceGlobals\interfaceImage = loadimage(filename$) 
end function 

</textarea><br><br>Its the pointer to the type object collections that allows globality, not the individual objects on their own (i think). This is the way i usually do it.<br><br>EDIT: checked it: works perfectly <br><br></td></tr></table><br>
<a name="448670"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >pangyan</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here's my code, it's driving me crazy. It's just not working, no matter how many times I look at it. It feels like a bug, but I know there must be something wrong:<br><br>First file: (Main.bb)<br>Include "RobotCommandClass.bb"<br>Include "globalDefinitions.bb"<br>Include "StartupClass.bb"<br><br>SetupGlobals()<br>SetupRobotCommandTools()<br>SetupGraphics()<br>While Not KeyHit(1)<br>	Cls<br>	SetBuffer BackBuffer()<br>	DrawRobotCommandTools()<br>	Flip<br>Wend<br><br>Second file: (Globaldefinitions.bb)<br>;This handles all the functions related to handling a robot command<br><br>Type RobotCommandGlobals<br>	;This image is obsolete due to an annoying bug.<br>	;Field Image<br>	Field deployedCommandIndexToUse<br>	Field commandOnCursor<br>	Field toolboxScreenX<br>	Field toolboxScreenY<br>	Field toolboxWidth<br>	Field toolboxHeight<br>End Type<br><br>Type RobotCommandTool<br>	Field screenX<br>	Field screenY<br>	Field Number<br>	Field Total;Number of this type of command available to player to place on level<br>End Type<br><br>Type DeployedCommand<br>	Field Number<br>	Field LevelCol<br>	Field LevelRow<br>	Field State<br>End Type<br><br>Const MAX_ROBOT_COMMANDS = 100<br>Const MAX_COMMAND_TYPES = 11<br><br>Global theRobotCommandGlobals.RobotCommandGlobals<br><br>Global robotImage<br>Global robotCommandImage<br><br>Third file: (robotCommandClass.bb)<br>Dim theRobotCommandTools.RobotCommandTool(MAX_COMMAND_TYPES)<br>Dim theDeployedCommands.DeployedCommand(MAX_ROBOT_COMMANDS)<br><br>Function CreateRobotCommandGlobals(filename$, toolboxX, toolboxY, toolboxWidth, toolboxHeight)<br>	theRobotCommandGlobals = New RobotCommandGlobals <br>	robotCommandImage = LoadAnimImage(filename$, 48, 48, 0, 12)<br>	theRobotCommandGlobals\deployedCommandIndexToUse = 0<br>	theRobotCommandGlobals\commandOnCursor = COMMAND_NONE<br>	theRobotCommandGlobals\toolboxScreenX = toolboxX<br>	theRobotCommandGlobals\toolboxScreenY = toolboxY<br>	theRobotCommandGlobals\toolboxWidth = toolboxWidth<br>	theRobotCommandGlobals\toolboxHeight = toolboxHeight<br>End Function<br><br>Function DrawRobotCommandTools()<br><br>Local toolIndex<br><br>For toolIndex = 1 To MAX_COMMAND_TYPES<br>	DrawRobotCommandTool(toolIndex)<br>Next<br><br>End Function<br><br>Function DrawRobotCommandTool(toolIndex)<br><br>;Draw command tile<br>DrawImageRect(robotCommandImage, theRobotCommandTools(toolIndex)\screenX, theRobotCommandTools(toolIndex)\screenY, 0, 0, 48, 48, 0)<br><br>;Draw command icon on tile<br>DrawImageRect(robotCommandImage, theRobotCommandTools(toolIndex)\screenX, theRobotCommandTools(toolIndex)\screenY, 0, 0, 48, 48, theRobotCommandTools(toolIndex)\Number)<br><br>;Print number of tools remaining<br>Local numberDrawX, numberDrawY<br><br>numberDrawX = theRobotCommandTools(toolIndex)\screenX + 48 - FontWidth() <br>numberDrawY = theRobotCommandTools(toolIndex)\screenY + 48 - FontHeight()<br><br>Color (255, 255, 255)<br>Text (numberDrawX, numberDrawY, Trim(Str(theRobotCommandTools(toolIndex)\Number)))<br> <br>End Function<br><br>Function CreateRobotCommandTool(drawX, drawY, number, Total)<br><br>theRobotCommandTools(number) = New RobotCommandTool <br>theRobotCommandTools(number)\Number = number<br>theRobotCommandTools(number)\Total = Total<br>theRobotCommandTools(number)\screenX = drawX<br>theRobotCommandTools(number)\screenY = drawY<br><br>End Function<br><br>Function DrawAllCommands()<br><br>Local commandIndex<br><br>For commandIndex = 1 To theRobotCommandGlobals\deployedCommandIndexToUse - 1<br>	If theDeployedCommands(commandIndex)\State = STATE_TAKEN Then DrawCommand(commandIndex)<br>Next<br><br>End Function<br><br>Function DrawCommand(commandIndex)<br><br>Local drawAtX, drawAtY<br>Local cacheDisplayCol, cacheDisplayRow <br><br>cacheDisplayCol = 0<br>cacheDisplayRow = 0<br><br>If cacheDisplayCol &lt;&gt; LEFT_EDGE And cacheDisplayCol &lt;&gt; RIGHT_EDGE And cacheDisplayRow &lt;&gt; LEFT_EDGE And cacheDisplayCol &lt;&gt; RIGHT_EDGE Then<br>	drawAtX = cacheDisplayCol * 48 <br>	drawAtY = cacheDisplayRow * 48 <br>	;Draw the command tile first of all<br>	DrawImageRect(robotCommandImage, drawAtX, drawAtY, 0, 0, 48, 48, 0)<br>	;Draw command icon on tile<br>	DrawImageRect(robotCommandImage, drawAtX, drawAtY, theDeployedCommands(commandIndex)\Number * 48, 0, 48, 48)<br>EndIf<br><br>End Function<br><br>FInal file: Startupclass.bb<br>Function SetupGraphics()<br>	Graphics 1024, 768, 16<br>End Function<br><br>Function SetupGlobals()<br>	CreateRobotCommandGlobals("Assets/Graphics/robotCommands.bmp", 768, 0, 200, 200)<br>End Function<br><br>Function SetupRobotCommandTools()<br>	CreateRobotCommandTool(0, 0, 1, 1)<br>	CreateRobotCommandTool(120, 120, 2, 2)<br>	CreateRobotCommandTool(0, 0, 3, 0)<br>	CreateRobotCommandTool(120, 120, 4, 0)<br>	CreateRobotCommandTool(0, 0, 5, 0)<br>	CreateRobotCommandTool(120, 120, 6, 0)<br>	CreateRobotCommandTool(0, 0, 7, 0)<br>	CreateRobotCommandTool(120, 120, 8, 0)<br>	CreateRobotCommandTool(0, 0, 9, 0)<br>	CreateRobotCommandTool(120, 120, 10, 0)<br>	CreateRobotCommandTool(0, 0, 11, 0)<br>	<br>End Function<br><br>Can anyone help me out? I just don't know why the image can't be found, even though when it errors out, there is a handle in robotCommandImage. <br><br></td></tr></table><br>
<a name="448674"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> You need to reorder your include files so that your Globals are the first thing that are defined in your program:<br><br>Include "globalDefinitions.bb"<br>Include "StartupClass.bb"<br>Include "RobotCommandClass.bb" <br><br></td></tr></table><br>
<a name="448678"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dangerdave</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Remember that when Blitz sees an include it just pastes the contents where the include line is. <br><br></td></tr></table><br>
<a name="448680"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >pangyan</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> No, thats not it. I still get the error. Could someone please confirm:<br>1) That my code gives an error <br><br></td></tr></table><br>
<a name="448683"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >pangyan</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thought so, it is a glitch with the program. I knew something didn't feel right. Anyway the above code compiles on Blitz Plus, but does not compile on Blitz3D 1.87. Am I missing something? <br><br></td></tr></table><br>
<a name="448684"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> You ALSO will need to call SetUpGraphics before you call SetupGlobals, the Graphics command puts Blitz in a graphics mode so it is able to handle images, at present your program is calling LoadAnimImage before it calls the Graphics command. <br><br></td></tr></table><br>
<a name="449165"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >pangyan</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks a lot! That was the problem, namely setting up the graphics first. I've just regained my faith in Blitz Basic :) I was confused because the Image handle seemed to have a value and it was still unable to display the image. <br><br></td></tr></table><br>
<a name="450075"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Strider Centaur</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> Alot of times I will creat a image just to be sure to avoid the errors.  This way the image handel is valid and will, in worlst case display nothing.  If you have a default errer graphic, as I do when I do tile based games, this will instantly allert you to problems in the code when you see that read and yellow, ERROR, in your map, without crashing the game, good for running while still in development.<br><br>This is usually only a problem when trying to alter tiles on the map at runtime, so its nice to see the problem so clearly. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
