<!DOCTYPE html><html lang="en" ><head ><title >floting-point camerazoom distortion</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >floting-point camerazoom distortion</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >floting-point camerazoom distortion</a><br><br>
<a name="838303"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H. T. U.</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm making an fps/tps but ran into a problem a while ago.<br><br>When in third person mode, to get an adequate view of your surroundings, the camera must be placed outside of the characters collision radius.  But this allowed the camera to go through objects.  To correct this problem I moved the camera inside the radius and gave the camerazoom a value of 0.2.  However, this results in severe distortion of the image somewhat like looking at a strongly concave mirror.  I finally corrected this problem by putting the camera's image on a convex square and watching the square through another camera.  This works, but takes up significant system resources.  To make it worse, this is a multiplayer game, and this technique will have to be used on all the players to make it look good<br><br>Could you use a simple mathematical formula to correct the problem? <br><br></td></tr></table><br>
<a name="838316"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> You lost me at "to correct this problem.."<br><br>Why is it even a problem that the camera needs to be outside of the character's collision radius? <br><br></td></tr></table><br>
<a name="838318"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> The camera really shouldn't be colliding with the player anyway? I think what he means Gab, is that he's using a larger FOV, but it's causing distorsion at the egdes, which it shouldn't do. I thought you only got weird bending when you zoomed the camera IN. <br><br></td></tr></table><br>
<a name="839205"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H. T. U.</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> The camera isn't involved in collisions.  But the camera has to be inside the radius otherwise it can go slightly into walls, causing an ugly "see through" effect.<br><br>To prevent this, I placed the camera inside the radius and zoomed it out.  But this increased its FOV causing a problem I have illustrated below (though I can't make it look right when I post it):<br><br>Normal FOV<br><br>                         \ object  /<br>                          \0000000/<br>                           \     /<br>                            \   /<br>                             \ /<br>                              Y<br>                           camera<br>Rendered to screen as: 0000000<br><br>Larger FOV<br><br>                    \ _    object     _/<br>                       \_  0000000  _/<br>                         \_       _/<br>                           \_   _/<br>                             \ /<br>                              Y<br>                           camera<br>Rendered to screen as: OO0o0OO<br><br>Objects further from the center take up a larger percentage of the FOV than the center does.  I anticipated this problem but solvig it wasn't easy (have you ever tried to put a drastically round surface on a square?).  It still takes up too much memory though. <br><br></td></tr></table><br>
<a name="839210"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sledge</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> If the problem is that the camera is going slightly into walls perhaps adjusting CameraRange() so that the near value is smaller could help. <br><br></td></tr></table><br>
<a name="839216"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H. T. U.</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Already tried, small objects the character runs over disappear when they get close to the camera.  Some sort of formula is the best option. <br><br></td></tr></table><br>
<a name="839217"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ah right, now I get you. The problem is with the camera intersecting the level geometry. <br><br>Well I would tend towards making the camera more dynamic, leaving it a good distance away and then only moving it closer to the character when it intersects a wall. So you don't have to change the FOV, most of the time it's exactly where you want, but the player only gets a close-up view when there is no alternative. <br><br>Of course, doing this would mean you would need to hack some kind of no-response collisions because you would want to *know* when the camera was intersecting but not actually have a collision response ( because you're handling the response yourself. )<br><br>I'm not sure whether you would fancy that though, so I won't go digging around for ways of handling no-response collisions unless it sounds like something you would want to do. <br><br></td></tr></table><br>
<a name="839222"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >stayne</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> small objects the character runs over disappear when they get close to the camera <br></div><br><br>changing the near value of CameraRange to a small floating number might fix that (eg: CameraRange camera, .1,1000) <br><br></td></tr></table><br>
<a name="839321"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Zethrax</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Avoid making the near camerarange value too small, as this can cause problems with the z-buffer. The z-buffer has much greater resolution up close than it does far away, and this resolution is based on the relative distance ratios between the the near and far clipping planes and the camera. If you decrease the near clipping distance too much, you can dramatically increase the amount of work that the z-buffer has to do.<br><br>To get an idea of how third person cameras are done you might want to take a look at the Castle demo in the Blitz3D 3D samples folder ( C:\Program Files\Blitz3D\Samples\Blitz 3D Samples\mak\castle ). Essentially, the camera has its own collision sphere which has the same, or greater, radius as the near clipping range of the camera. You will still get situations where the camera sees through things, though. Sometimes the third person camera just gets caught between a rock and a hard place, so to speak.<br><br>Also, if you want a normall looking camera focus, I recommend a CameraZoom setting of 1.6. <br><br></td></tr></table><br>
<a name="839566"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H. T. U.</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't thint I was properly understood when I told you that I already tried the CameraRange option.  I had the same problem as before AND have the problem with running over small objects.<br><br>Because all of the players are in the same building, even if the camera sees through things in only one place it allows the players to cheat.  I also want to keep the camera in the same place relative to the character which rules out moving it when it encounters a wall.<br><br>The "screen" I've been using works perfectly, but it takes up way too many resources (you can easily see the fps difference when it isn't in use).  It works simply by scaling the pixles along the outside more than the pixles toward the center.  It's simple, but hard to write an equation to substitute.  The other options just don't work right.<br><br>As strange as it sounds, Blitz probrably has a similar system built in because the viewing area increases the farther away it is from the camera.  If the cameras unrealistically looked strictly ahead, this wouldn't be a problem. <br><br></td></tr></table><br>
<a name="839630"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> There is no way around CameraRange. Imagine your camera was the head of a person. YOu can't put your head into the wall, but you can get pretty close to the wall with your eyes. Depending on the level scale you may have to allow distances down to about 2 inches, or about 5 cm. If one BlitzUntit is one meter then this would mean a camera start range of 0.05. <br>If your level is scaled even smaller , then it may be even less than that. CameraZoom is doing a completely diffrent job.<br><br>So you need both, a low camera start range and a collision mode for your camera that prevents the camera from dipping into a wall. <br><br></td></tr></table><br>
<a name="839638"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Easy but poor method - if you don't want the camera to alter the distance between itself and the player, but don't want it to show what is on the other side of a wall - linepick from the player to the camera and if the linepick picks an obstacle, like a level, set the cameraprojmode to 0 to basically present a black screen.  Not pretty but will do what you have said. Then set the cameraprojmode back to 1 when the linepick does not strike an object between the player and the camera. <br><br></td></tr></table><br>
<a name="839650"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> I use CameraRange Camera, 0.1, 4000<br><br>It's always worked for me. <br><br></td></tr></table><br>
<a name="839855"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H. T. U.</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> The problem isn't in first person mode but in third person mode.  This makes it more difficult.  You can't simply put the camera inside the character's head.  <br><br>This demands a fairly high CameraRange minimum parameter (in my case, about 100).  However, if I do that, you can see through a object simply next to him.  To fix that, you need to set the CameraRange parameter to be quite low.  This results in being able to see through objects just behind him (as well as an unusual predicament).<br><br>As you can see, in my case, adjusting the CameraRange results in a frustrating paradox.<br><br>P.S. Does anyone know the ratio that the FOV diverges to the distance from the camera?  If I knew that, then I could probrably adjust the CameraRange in conjunction with looking down at the character a slight amount and know the minimum limit this amount could be. <br><br></td></tr></table><br>
<a name="859463"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H. T. U.</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> After trying to fix this problem for months, I have finally decided that solving this problem is far more difficult than it originally appeared.  The only goodlooking and effective method I have seen so far has been the screen, which in itself takes up at least half of my computers CPU power (not to mention the size of the 3D world).  Therefore, I have reluctantly decided to stop investigating until a later date.  I will still happily accept any suggestions on this problem.  If it helps I discovered that setting the cameraprojmode to 2 completely eliminates the problem, but also throws all perspective out the window (because it eliminates the divergence of the FOV).<br><br>Thanks for all your help. <br><br></td></tr></table><br>
<a name="859535"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Why not have the camera collide with the surroundings? That way you can force it back until it collides with something. OR, have the smaller rooms equipted with a pivot, which show the best camera position in that room in order to see it all, and move the camera there.<br><br>As you say, it's not an easy problem to get around, impossible sometimes. I suppose you could help by improving the level design so there are no really small rooms. <br><br></td></tr></table><br>
<a name="859606"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H. T. U.</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> The problem is more profound in hallways as opposed to small rooms.  As you say, moving the camera around would be an easier fix.  But this is a shooting game, and moving the camera makes aiming nearly impossible.  For now I am just using it in first person mode.<br><br>How exectly do Blitz3D cameras work?  Does anyone know what kind of formula they use to get the image? <br><br></td></tr></table><br>
<a name="859627"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> How do you mean?<br><br>I think what you need is clipping planes. Clip the hallway behind the camera, bring the camera back, so the camera can see into the hallway from the outside, but not see the room it has forced itself in.<br><br>The FASTLIB extensions library can do this.<br><br>Barring that, you hide any rooms + enemies that lie behind the camera and bring the camera through the wall. <br><br></td></tr></table><br>
<a name="859794"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H. T. U.</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Huh?  My problem is that the camera can intersect other meshes, so you can see through them.  I need to keep the camera in the same place relative to the player so that he can aim.  I doubt clipping would fix this (the game is multiplayer too).  Initially I tried to fix this by setting CameraZoom to 0.2 but, while it widened the view, it caused distortion, which I have found almost impossible to fix.  Take a look at my code archives entry to see what I mean. <br><br></td></tr></table><br>
<a name="859831"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well clip planes would fix what you suggest. It would allow the camera to go through the wall behind the player, whilst not showing what is on the other end of the wall, whilst allowing the player to get a good aim. It really is the only way your going to give the player a decent view of whats going on. <br><br></td></tr></table><br>
<a name="859842"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Naughty Alien</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> arent clip planes same as Camerarange? <br><br></td></tr></table><br>
<a name="859885"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> Not really. You could place a clip plane 5 units in front of the camera and rotate it 45 degrees. You couldn't do that with camera range. Basically if you put a clip plane across the line of the wall, then anything behind that wall wouldn't get drawn. You can place them anywhere. I think the FAST extend library only supports 6 of them?<br><br><a href="http://www.whiterockscience.com/moritz/clip.html" target="_blank">http://www.whiterockscience.com/moritz/clip.html</a><br><br>You couldn't do that with camerarange. <br><br></td></tr></table><br>
<a name="859896"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Naughty Alien</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> oh..you mean they are not attached to the camera?? <br><br></td></tr></table><br>
<a name="859940"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nope :o) It's like rendering a scene and cutting out a section of it. <br><br></td></tr></table><br>
<a name="860175"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H. T. U.</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm kind of confused with this clipping plane concept, but I have tried several variants of CameraRange, none of which worked.  Basically, even though the front range of the camera has been moved up, that view still intersects objects. <br><br>I think I get what you mean with the clipping planes and will look into it.  I see how it would fix it but won't it cause other problems?  Wouldn't it keep the character in the same position on the screen and clip out the unwanted view, but get closer to the character when the clipping is needed, starting my camerazoom problem again?  I would post a diagram showng what I mean but if you look above you'll see that it may not be any good. <br><br></td></tr></table><br>
<a name="860528"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well you can dynamically move clipping planes, so technically, you can do what you want with them. I'm not sure what you mean though. <br><br></td></tr></table><br>
<a name="873286"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H. T. U.</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm afraid I can't post an example of what I mean and have it make any sense.  However, I have been trying to move the camera like in the castle demo for a month without success.  Blitz doesn't seem to recognize that the camera (or a pivot, I've tried it both ways) is colliding, even though all the collisions are set up.  I'm having a similar problem in a simple physics engine I'm writing: the objects slide off one another, but when I use countcollisions() to try to detect a collision to calculate friction, a collision is never registered.  I believe that moving the camera will be faster than clipping planes and look pretty good, but if I can't detect collisions, I can't tell the camera how to move.  Has anyone experienced this before, and is it a b3d bug? <br><br>P.S. Both of these occurences happen in functions, but the castle's chasecam is a function too. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
