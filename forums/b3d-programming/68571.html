<!DOCTYPE html><html lang="en" ><head ><title >3rd-Person Camera</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >3rd-Person Camera</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >3rd-Person Camera</a><br><br>
<a name="766234"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mattizzle</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> What would you folks suggest as the best way to determine if a camera's view of the player is being obstructed by any object? My setup up so far is a main pivot always positioned at the player's center and gets rotated by the mouse. Then the camera is parented to that pivot and moved back some. And then I've got another pivot that is parented to the main pivot and stays in a preset location for the camera to move back to when  there is no longer any obstruction. Now, I've tried several different things and failed every attempt. So now I'm resorting to you geniouses for help.<br><br>Thanks in advance,<br>Mattizzle <br><br></td></tr></table><br>
<a name="766259"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >puki</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I've tried several different things and failed every attempt <br></div><br><br>The above is potentially a key to all of this - whose to say something that you tried was correct, but you implemented it wrong and therefore do not know it was the answer.<br><br>Most people go the route of 'picking' - whether it be creating a system of linepicking or by using Blitz3D's built-in 'Pickmode'.<br><br>You can set an entity (ie a mesh/piece of scenery) as being an 'obscurer' via EntityPickMode.<br><br>If you've not tried that then play around with it - other than that post a bit more info regarding what you have tried as the 'PickMode' solution is normally the first thing someone would try. <br><br></td></tr></table><br>
<a name="766265"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mattizzle</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, I too believe I've implemented my attempts incorrectly... &gt;.&lt; <br><br>I've tried EnitityVisible, EntityInView, Linepick, and even having a cube scaled to the length of the distance between the camera and player and tested for collision. And so since nothing I tried worked, rather than spending hours and hours trying to correctly implement one of those methods, I decide to find out here the way that is best and then spend my time implementing the best way. <br><br></td></tr></table><br>
<a name="766268"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I did a 3rd person camera some time ago. I'd suggest to smooth the camera motion: When there's a pivot at the cameras desired position then move the camera towards it, by a fraction of the distance. This gives a nice rubberband effect.<br><br>There may also be a target pivot, usually the characters head or shoulders. During the camera positioning the pickmode of the Character should be disabled. The worlds mesh(es) must be pickable. Now simply LinePick from the target pivot to the cameras current location. If linepick will return zero then there's nothing between them. If it's not, then position the camera at the pickedx, pickedy, pickedz location, point towards target, move a little bit forward.<br><br>This way the camera will always use the best location and won't get stuck in corners. <br><br></td></tr></table><br>
<a name="766278"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mattizzle</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Jfk. I knew you'd show up with your linepick. :-P I did try to linepick but I don't really understand the parameters it takes. Why doesn't it just ask for a source and target entity? I know you're the master of linepick, could you give me a code example of how to use it in this situation (with a pivot at the player and a pivot at a preset location behind the player)<br><br>Thanks in advance,<br>Matt<br><br>Ps - using a fraction of the distance is great! I've always thought Cos was the way people smooth motion. <br><br></td></tr></table><br>
<a name="766285"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> linepick is simple<br>p=linepick( entityx(npc),entityy(npc),entityz(npc),  entityx(camera)-entityx(npc),entityy(camera)-entityy(npc),entityz(camera)-entityz(npc) ) <br><br></td></tr></table><br>
<a name="766335"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mattizzle</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> OH! I've been reversing the entities! So it goes from target to camera and not camera to target. Thanks JFK I 'll try it! <br><br></td></tr></table><br>
<a name="766691"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mattizzle</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> It is starting to shape up but I'm still having a problem:<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
	If Not LinePick(EntityX(c\Pivot,1),EntityY(c\Pivot,1),EntityZ(c\Pivot,1),EntityX(c\Cam,1)-EntityX(c\Pivot,1),EntityY(c\Cam,1)-EntityY(c\Pivot,1),EntityZ(c\Cam,1)-EntityZ(c\Pivot,1)) = 0
		PositionEntity c\Cam, PickedX(),PickedY(),PickedZ(),1
		PointEntity c\Cam,c\Pivot
		MoveEntity c\Cam, 0,0,0.5
	Else
		If EntityZ(c\Cam) &gt; EntityZ(c\tzPivot) Then MoveEntity c\Cam, 0,0,-0.5
	EndIf
</textarea><br><br>And c\Pivot is the parent pivot that is moved to the player's location every frame (before this code), c\Cam is the camera of course, and c\tzPivot is the target pivot (the preset location to move the camera back to.)<br><br>The above works well except when the camera is positioned at the picked xyz, the screen starts shaking intensly. And when i comment out the else block which moves the camera back, there is no longer any shaking. Thus, its like the else is being executed <i>with</i> the if.<br><br>...While typing this post I just realized hey why not try and run two linepicks one for false and one for true:<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
	If Not LinePick(EntityX(c\Pivot,1),EntityY(c\Pivot,1),EntityZ(c\Pivot,1),EntityX(c\Cam,1)-EntityX(c\Pivot,1),EntityY(c\Cam,1)-EntityY(c\Pivot,1),EntityZ(c\Cam,1)-EntityZ(c\Pivot,1)) = 0
		PositionEntity c\Cam, PickedX(),PickedY(),PickedZ(),1
		PointEntity c\Cam,c\Pivot
		MoveEntity c\Cam, 0,0,0.5
	EndIf
	If LinePick(EntityX(c\Pivot,1),EntityY(c\Pivot,1),EntityZ(c\Pivot,1),EntityX(c\Cam,1)-EntityX(c\Pivot,1),EntityY(c\Cam,1)-EntityY(c\Pivot,1),EntityZ(c\Cam,1)-EntityZ(c\Pivot,1)) = 0
		If EntityZ(c\Cam) &gt; EntityZ(c\tzPivot) Then MoveEntity c\Cam, 0,0,-0.5
	EndIf
</textarea><br><br>Works flawlessly...<br><br>Any idea why the first doesn't work and the latter does?<br><br>Edit: After more testing I noticed the camera would still shake if it got close to the player (like against a wall) and so out of pure luck and just messing around I came up with this:<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
If EntityZ(c\Cam) &lt; -1.5
		If Not LinePick(EntityX(c\Pivot,1),EntityY(c\Pivot,1),EntityZ(c\Pivot,1),EntityX(c\Cam,1)-EntityX(c\Pivot,1),EntityY(c\Cam,1)-EntityY(c\Pivot,1),EntityZ(c\Cam,1)-EntityZ(c\Pivot,1)) = 0
			PositionEntity c\Cam, PickedX(),PickedY(),PickedZ(),1
			PointEntity c\Cam,c\Pivot
			MoveEntity c\Cam, 0,0,0.5
		EndIf
	EndIf

	If LinePick(EntityX(c\Pivot,1),EntityY(c\Pivot,1),EntityZ(c\Pivot,1),EntityX(c\Cam,1)-EntityX(c\Pivot,1),EntityY(c\Cam,1)-EntityY(c\Pivot,1),EntityZ(c\Cam,1)-EntityZ(c\Pivot,1)) = 0
		If EntityZ(c\Cam) &gt; EntityZ(c\tzPivot) Then MoveEntity c\Cam, 0,0,(EntityZ(c\tzPivot)-EntityZ(c\Cam))*0.1
	EndIf
</textarea> <br><br></td></tr></table><br>
<a name="766703"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >puki</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> The second version is a choice of 2 states - it is absolute.<br><br>The first version is either something or anything. <br><br></td></tr></table><br>
<a name="766707"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mattizzle</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well think about it logically though: The way I've set it up with "if not 'nothing in the way' " and the only other option being "nothing in the way", how could an 'else' <i>not</i> work in this case? I just can't figure it out. But besides that, I now have a perfect 3rd person camera regardless of else staments if you check the edit (especially examine the second 'MoveEntity' - I got that idea from what jfk said earlier - jfk's my hero now :-P ) <br><br></td></tr></table><br>
<a name="766888"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> In the last version you do 2 linepicks, although you could simply store it in a variable<br>p=linepick(...<br>if p&lt;&gt;0<br>...<br>if p=0<br>(They are the same linepicks, no?)<br><br><br>But basicly I don't understand this line:<br>	If EntityZ(c\Cam) &gt; EntityZ(c\tzPivot) Then MoveEntity c\Cam, 0,0,-0.5<br><br>What's your goal? If Z of cam &lt; Z of char then move cam away from char ??<br><br>Note, MoveEntity works relative to the entities orientation. Probably you meant TranslateEntity ? <br><br></td></tr></table><br>
<a name="766999"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Vertigo</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just out of curiosity, has anyone tried this?<br><br>alpha a cube to 0 so its hidden.  <br>Parent the camera to that. <br>Check collisions against the cube only.<br>Parent the cube to the player. <br><br>Before collisions check, hide the entity of the cube.<br>Place the cube at 0,0,0 orientation relative to the player.<br>Unhide the entity of the cube to check for collisions once again, and then just move its z negative until it hits something.<br><br>Isnt this a lot faster than doing line picks every frame?<br>Just an idea... and mine are usually bad ones haha <br><br></td></tr></table><br>
<a name="767013"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mattizzle</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> @ My hero :-P - That line is actually this now:<br><pre class=code>
If EntityZ(c\Cam) &gt; EntityZ(c\tzPivot) Then MoveEntity c\Cam, 0,0,(EntityZ(c\tzPivot)-EntityZ(c\Cam))*0.1
</pre><br>But besides the z parameter change, I think you're thinking that 'c\tzPivot' is at the player, which it is <b>not</b>. 'c\tzPivot' is actually a child pivot that is always at a local 0,0,-20 position relative to the main camera pivot (which is at the head of the player). Thus, my line of code there will move the camera back until it reaches that pivot (0,0,-20). The reason for it is so when there's nothing between the camera and player (ie linepick = 0) that the camera doesn't just fly off into space. 'tzPivot' is the limit. (hehe it rhymes)<br><br><br>@ Verty - Sure you'd have a faster fps but of course in compromize it would be taking alot more frames to check where the camera should be, plus if I read correctly you'd need two 'updateworld()'s'. But something I tried was along those lines:<br><div class="quote"> <br>and even having a cube scaled to the length of the distance between the camera and player and tested for collision<br> <br></div><br>+ moving the camera to the collision xyz globaly...<br>And that didn't work well, however I probably just implemented it wrong because it sure makes sense in theory.<br><br>On a lighter note -- I now have an extremely fast an optimized 3rd person camera that works perfectly for a ninja fight!<br><br>Many thanks to all!<br>Mat -- tizzle<br><br>PS - I think an addition to the code archives is in order... ;-) <br><br></td></tr></table><br>
<a name="767345"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey, cool sig &lt;:o) . You may want to see my merchandising products as well :P <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
