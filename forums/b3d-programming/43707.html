<!DOCTYPE html><html lang="en" ><head ><title >Another verlet question - suspension.</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Another verlet question - suspension.</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Another verlet question - suspension.</a><br><br>
<a name="487859"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I realise that this topic has had the arse kicked out of it in the past but I can not find a download or code for the  community verlet car project which DMC started - anyone remember this?<br><br>I have a working car model which turns / slides rolls  &amp; collides with other cars etc.. It's physically quite accurate on a flat surface and uses Jacobsens verlet method.<br><br>In making the 9 particle cage completely rigid it causes the car to slip &amp; slide unrealistically on bumpy terrain.  (e.g. only one wheel is actually touching the terrain on some occasions when at least 3 should be &amp; a traction force is only applied to which is touching the ground )<br><br>I now realise that having a suspension model is a must and <br>what I'm looking for are ideas on the best way to incorporate this into an existing verlet system.  The contraints I'm using allow for a stiffness component of less than 1.0.  Do I need a new contraint type or will this be sufficient?<br><br>I thought of having an additional 4 x particles directly underneath the wheel particles which have rigid contraints as shown below but have springs attaching each particle to the corresponding wheel particle.  <br><br>Is this the way to go ... please help?  I'm more than willing to share code once I'm finished.<br><br><br><br><br><pre class=code>

10--11
! \/ !
! /\ !
13--12

</pre> <br><br></td></tr></table><br>
<a name="487863"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >flying willy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'd prolly use ODE to be honest... <br><br></td></tr></table><br>
<a name="487891"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >NewtSoup</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Kudos to you Stevie for getting as far as you have done, I dont know the first thing about verlets and have yet to find a step by step guide to their principles and practice.  Keep at it and you can write your own version of libraries like ODE and Tokomak and have people like flying willy begging for your code<br><br>/salute. <br><br></td></tr></table><br>
<a name="487925"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Luke, setting up the verlet cage and applying forces based on rear car physics is quite straightforward.  There's loads of resources online but none which explain a suspension model.  I'm hoping that Bouncer , DMC (if he's still about ) , BotBuilder or anyone who has done some advanced verlet stuff reads this and is feeling generous!  I won't be giving up on this yet!!<br><br>@ Flying Willy - using a wrapped 3d party library is a cop out for me.  I'd much rather code the engine myself as it's easier to implement in my own code. <br><br></td></tr></table><br>
<a name="487926"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >IPete2</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Stevie,<br><br>E-mail me and I'll let you have the demo I have - they are archived on my drive.<br><br><br>IPete2. <br><br></td></tr></table><br>
<a name="487939"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Cheers IPete2 - e-mail on route. <br><br></td></tr></table><br>
<a name="487954"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jeremy Alessi</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> You should get your friction by utilizing pressure i.e. if only one wheel is on the ground the friction is increased due to higher pressure.  You wouldn't even need a real suspension system but if you wanted the wheels to move you'd have to put spings in place. <br><br></td></tr></table><br>
<a name="487983"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Not sure I get what you're saying Jeremy?<br><br>Say I have a max friction 10.0 for all 4 wheels - apply this evenly between the no of tyres on the ground ..e.g.<br><br>1 tyre  friction 10 <br>2 tyre  friction 5 each<br>3 tyre friction 3.3 each<br><br>etc..<br><br>If this is what you mean then I'm not sure it would work.  Can you explain more?<br><br>I do already apply a roll restistance to each tyre in the opposite direction of the tyre orientation if the wheel is on the ground but this is based on a Constant RollResistance Force * velocity component in the tyres forward direction. <br><br></td></tr></table><br>
<a name="488020"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jeremy Alessi</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah well you should have a friction force per tire calculated by surface area / weight ... something like that.  So 4 tires has 4 times the surface area so it's less pressure per tire.  Friction would still be less on only 1 tire but if you bring pressure into it the whole weight of the vehicle on 1 tire would be a lot more pressure and thus more friction so your vehicle wouldn't go nuts as the friction would be reasonable. <br><br></td></tr></table><br>
<a name="488030"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Clarks</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> What you can do is use a matrix to perform some calcuations of where the wheels should be positioned relative to the body in the cars body coordinates. <br><br>What your interested in is directly setting the x and z coordinates of each wheel relative to the car and let a verlet constraint handle the y coordinate. But it highly depends on how your verlet particles are connected as they must be connected to support suspension. <br><br></td></tr></table><br>
<a name="488049"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think I got you Jeremy, basically calculate how the car mass spreads a load over each of the wheels which is touching the ground.  I'm pretty sure I could do that.<br><br>I'm trying something similar atm Clarks - the suspension is reasonable i.e. the car body moves about while the wheels are better at hugging the track.  I'm getting wheels coming off the surface when I do a fast turn but I think a kind of downforce applied as above should stabalise this.  Here's hoping!!<br><br>The cool thing is that the body automatically nosedives when you slam the brakes on now and vice verca when you accelerate. <br><br></td></tr></table><br>
<a name="488120"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Clarks</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> i would like to play a demo stevie. <br><br></td></tr></table><br>
<a name="488199"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Once I have this stable I'll post a demo.  Trouble with the system I'm using is that the suspension cage below the body has is obviously more flexible than the body and it's breaking with hard collisions.  I'll keep playing with this though. <br><br></td></tr></table><br>
<a name="488263"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >NewtSoup</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well a real car suspension works something like this<br><br>the wheel is supported on a swingarm and a spring/damper limits the up/down movement think of the triangular shape of a formula 1 car (Indy500 car for  you people in the US ;) )<br>you could use this regardles of the actual shape of your car because the verlets and constraints are not visible right? only the meshes attached to them<br><br>now the spring (having looked up on the net) a constraint is like an infinately stiff spring. soooooo what I would do is add a default parameter to all constraints saying that they are of stiffness 1 and then setting that to &lt;1 would allow "error" in their lenght over a period of time but the relaxation function will still bring them back to their natural length over a period of frames.<br><br>just an idea I may be reading wrong.<br><br>so one side of your car would look like (from the back)<br><br><pre class=code>


   shared verlet by car body And "spring"
   |
o--o\
|\/| \&lt;-----this Constraint has "relaxed" stiffness And can vary in Lenght
|/\|  \
o--o---o&lt;---wheel here on this verlet
   ^
   |
   |
   Shared verlet by car body And swingarm (2 of To make the arm And make a hinge)
</pre><br><br>this might have been what you had in mind anyway <br><br></td></tr></table><br>
<a name="488266"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >NewtSoup</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is what gives me the above idea:<br><br><div class="quote"> <br>The number of necessary iterations varies depending on the physical system simulated and the amount of motion. It can be made adaptive by measuring the change from last iteration. If we stop the iterations early, the result might not end up being quite valid but because of the Verlet scheme, in next frame it will probably be better, next frame even more so etc. This means that stopping early will not ruin everything although the resulting animation might appear somewhat sloppier. <br><br> <br></div><br><br>Source: <a href="http://www.gamasutra.com/resource_guide/20030121/jacobson_pfv.htm" target="_blank">http://www.gamasutra.com/resource_guide/20030121/jacobson_pfv.htm</a><br><br>seems to me that at the point where you compare the actual difference in length of the constraint to its restlength and correct if you intentionally slow the rate of change you will simulate a perfectly damped spring. (perfectly damped is one that returns to its rest length from a displacement with no oscillation) <br><br></td></tr></table><br>
<a name="488275"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >NewtSoup</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yep it works, I just did a global constraint change on someone elses code so that it takes twice as long for the constraints to return to their natural length and now the falling cube deforms as if it were made of sponge when it hits the "ground" <br><br></td></tr></table><br>
<a name="488289"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> I was setting up the verlets differently - directly beneath the rigid body but I see how the above verlet / constraint combinations would make it far more stable provided I add more constraints than you suggest -e.g.  connecting the wheel to a few more of the rigid body verlets.<br><br>I'm already doing what you suggest to get springs working.  I may be back for more help<br><br>Thanks Luke .. will post back with results. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
