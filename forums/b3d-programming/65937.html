<!DOCTYPE html><html lang="en" ><head ><title >Deletefile can't delete this exe?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Deletefile can't delete this exe?</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Deletefile can't delete this exe?</a><br><br>
<a name="736672"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is that true, a running exe cannot delete itself?<br><br>How would you solve this?<br><br>EG. my app is named test.exe and it sould contain this:<br>DeleteFile "test.exe".<br><br>The code is executed, but the file isn't really deleted as it should. Maybe the file is locked during execution? Can i unlock it? <br><br></td></tr></table><br>
<a name="736680"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Is that true, a running exe cannot delete itself? <br></div>I would imaging that windows will deny access to it.<br><div class="quote"> How would you solve this? <br></div>Get it to run an other EXE then close itself down, then the other exe waits a bit then deletes the first exe. {That isnt to say this would work, its just how I would go about solving it} <br><br></td></tr></table><br>
<a name="736682"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >b32</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think you need the MoveFileEx api: <a href="http://support.microsoft.com/kb/140570" target="_blank">http://support.microsoft.com/kb/140570</a> <br><br></td></tr></table><br>
<a name="736692"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Fuller</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Why would you want to delete the .exe? <br><br></td></tr></table><br>
<a name="736797"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's the uninstaller exe. Finally the whole diskspace should be released. So a second exe would still be left back.<br>B32 - thanks, will read now. <br><br></td></tr></table><br>
<a name="736800"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok it seems MoveFileEx is used to remove files that are locked by the system because they are system drivers etc. This will be executed when the machine boots the next time.<br><br>My exe is loaded, then executed. The file is not touched anymore. So in theory it should be no problem to delete it, unless an exe works as some kind of streaming program code that is executed before it's fully loaded.<br><br>The deletion of files in the boot sequence is a bit of an overkill for a simple screensaver imho.<br><br>Maybe I can use a smaller uninstaller exe, not a blitz exe. So when there are a few kb wasted on the users disk, who cares. Maybe a batch file. <br><br></td></tr></table><br>
<a name="736804"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> THis is really getting funny. Now I wa able to use execfile a bachfile that would delay 2 seconds, then delete the calling  exe. Problem: there seems to be no good command in msdos to wait for a certain time. "Choice" can be used, but AFAIK it' snot suported by NT, 2K, XP. A very good tutorial then suggests to use the PING command (ping -n 2 127.0.0.1&gt;NUL). THis really works, but a firewall alert will pop up - no way.<br><br>I think I really got to use an other win32 compiler. BlitzMAX would be perfect, but I didn't buy it yet but decided to wait for the Max3D modules.<br><br>Ah, the sooner or later I will nail this. :/ <br><br></td></tr></table><br>
<a name="736806"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rroff</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've never seen a windows machine including xp and 2k that choice wasn't present on... <br><br></td></tr></table><br>
<a name="736813"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >OJay</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> why not just use a thirdparty installer like innosetup or something? they care about all installation/remove processes so you dont have to reinvent the wheel... <br><br></td></tr></table><br>
<a name="736843"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, maybe I should use innosetup. Neverless, reinventing the wheel may be useful sometimes. I also thought a fullfledged installer isn't neccesary for a simple SCR file. <br><br></td></tr></table><br>
<a name="736845"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bregors</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> . <br><br></td></tr></table><br>
<a name="736961"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> It's the uninstaller exe. Finally the whole diskspace should be released. So a second exe would still be left back <br></div>Not if the second exe is the installed application. You start the application from the installer with a command line dir to the path it was installed from, then it deletes the installer and closes. When you run the application for real, there is no command path, and so it doesnt delete anything or exit, but runs the program. <br><br>Also, as your application is going to have an uninstaler you could just use that as the second exe and not the main exe. That is, if the uninsatler is run and passed the dir of the installer <b>it</b> deletes the instaler and closes down. <br><br></td></tr></table><br>
<a name="737038"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> H&amp;K -  We're talking about a SCR, not EXE. I cannot run the SCR file with a commandline argument, windows will remove it and use "/S" instead.<br><br>Deleting the installer is not an issue. It's the uninstaller that needs to be removed. So no matter how you turn it around, one exe will always be left back. The proper solution would be to use MoveFileEx and make windows delete the file during the next OS loading sequence.<br><br>I'll probably add this later, right now I'm tired of the bad puter karma I got these days. It's like I'm doomed. Sometimes everything goes quick, but when you have a bad karma phase then every little stupid bug takes days to be fixed.<br><br>BTW yes, Innosetup is powerful. Now I just spent an hour or so to make it install my screensaver, including the call to rundll32.exe to open the desk.cpl with screensaver settings etc. It compiled without errors, but the setup file didn't work. I just ain't got the patience to read trough tons of gui elements with more or less cryptic labels. Maybe I'll look into that one an other day.<br><br>Thanks for your help everyone. <br><br></td></tr></table><br>
<a name="737047"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ahhhh, yep. Shutting up.<br><br>Edit: ohohohoho. How about.... the program copies itself to the windows temp dir, then runs the copy and closes. Then the copy, which knows its the copy, cos it in the temp dir, runs and it can delete the original.<br><br>OK so a copy now exists in temp, but What the hell, loads of things exist in temp. And the next time you do a system cleanup, it just get deleted. <br><br></td></tr></table><br>
<a name="737056"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> good point! <br><br></td></tr></table><br>
<a name="737058"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kev</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> this might help<br><br><a href="http://www.codeproject.com/file/cpselfdestruct2.asp" target="_blank">http://www.codeproject.com/file/cpselfdestruct2.asp</a> <br><br></td></tr></table><br>
<a name="737073"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >b32</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> The article says that .bat files can remove themself. I tried running the .scr file from CMD, and the commandline isn't changed into "/S". I have WinXPHE and I don't know if other versions of Windows do the same, but maybe you could use a .bat file for the uninstall. <br><br></td></tr></table><br>
<a name="737802"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Subirenihil</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="/codearcs.php?code=1892" target="_blank">Self-Destructing .exe</a> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
