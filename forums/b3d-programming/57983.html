<!DOCTYPE html><html lang="en" ><head ><title >Extracting a rotation from 3D points</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Extracting a rotation from 3D points</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Extracting a rotation from 3D points</a><br><br>
<a name="645012"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John J.</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm working on a verlet physics engine. A rigid body is represented by a list of verlette particles (points in 3D space), which are physically simulated realistically. Now, to draw a cube, for example, would require the position and rotation to be extracted from these points (so PositionEntity and RotateEntity can be called appropriately).<br><br>Getting the position is easy - simply calculate the average (center) position of all the points. But I can't think of a way to extract the rotation from the points. How can this be done? <br><br></td></tr></table><br>
<a name="645044"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I use align to vector on the x and z axis.  A quick code snippet.<br><br>b\Mesh is your visible box, p[0] is your center vertet and p[5] .. p[8] are the top verlets starting from front left moving clockwise to rear left.<br><br><pre class=code>
PositionEntity b\Mesh , EntityX( b\p[0]\pivot ) , EntityY( b\p[0]\pivot ) , EntityZ( b\p[0]\pivot )
x# = EntityX( b\p[6]\pivot ) - EntityX( b\p[5]\pivot ) + EntityX( b\p[7]\pivot ) - EntityX( b\p[8]\pivot )
y# = EntityY( b\p[6]\pivot ) - EntityY( b\p[5]\pivot ) + EntityY( b\p[7]\pivot ) - EntityY( b\p[8]\pivot )
z# = EntityZ( b\p[6]\pivot ) - EntityZ( b\p[5]\pivot ) + EntityZ( b\p[7]\pivot ) - EntityZ( b\p[8]\pivot )
AlignToVector b\Mesh, x,y,z,1 , 1
x# = EntityX( b\p[6]\pivot ) - EntityX( b\p[7]\pivot ) + EntityX( b\p[5]\pivot ) - EntityX( b\p[8]\pivot )
y# = EntityY( b\p[6]\pivot ) - EntityY( b\p[7]\pivot ) + EntityY( b\p[5]\pivot ) - EntityY( b\p[8]\pivot )
z# = EntityZ( b\p[6]\pivot ) - EntityZ( b\p[7]\pivot ) + EntityZ( b\p[5]\pivot ) - EntityZ( b\p[8]\pivot )
AlignToVector b\Mesh, x,y,z, 3 , 1
</pre><br><br>Stevie <br><br></td></tr></table><br>
<a name="645232"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John J.</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks! Now all I need to do is figure out how to make it work with any number of vertices (my engine will hopefully support more than square-shaped objects), and how AlignToVector works (I'm making the engine as a plug-in DLL with C++) :(. <br><br></td></tr></table><br>
<a name="645270"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> No probs, I find it much easier to determine body / body collisions when using a cube .. it's also stable and easy to detect when it's "broken" and needs some correction.  <br><br>Mind you .. you'll be able to use more iterations of the relaxation phase if your going for raw c++ speed.  Are you planning on simulating vehicles too?  <br><br>Good luck with it.<br><br>[EDIT] Oh, and for multiple pointmasses .... all you need to do is store a pointer to 1 constraint which is used to align on the x-axis and another to align on the z-axis.  You know the vector direction of this constraint due to the position of the pointmasses connecting it.  Hope that makes sense.<br><br>Stevie <br><br></td></tr></table><br>
<a name="645350"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John J.</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Are you planning on simulating vehicles too? <br></div><br>I'm making the engine mainly for the next version of my tank game, so it will at least support tank physics. I'm also going to try to make simulate buildings and other objects being blown up/smashed through :)<br><br><div class="quote"> Oh, and for multiple pointmasses .... all you need to do is store a pointer to 1 constraint which is used to align on the x-axis and another to align on the z-axis. You know the vector direction of this constraint due to the position of the pointmasses connecting it. Hope that makes sense. <br></div><br>That makes sense. But how would I connect these ghost "pointmasses" to the actual object? Would a constraint need to be added connecting each "pointmass" in the object to the ghost "pointmasses". Hopefully only a few constraints would need to be added, or else things may get slow.<br><br>P.S. I discovered something very interesting about using square root estimation to improve speed - for some reason using C++ sqrt() is actually <b>faster</b> to a noticeable degree than using estimation! I can't understand it - the estimation I used took only about 3 multiplications, 1 division, and 2 additions, and yet calculating the exact square root is faster?? <br><br></td></tr></table><br>
<a name="645476"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Tanks are actually pretty easy ... I did something a while back where I could use the left / right analogues to control the power to each track.  Basically it could turn on the spot by locking them in opposite directions ... worked well :)   You will need to use a few tricks with very bumpy terrain though.<br><br>You don't need to add any new constraints/pointmasses ... just store references to ones already there.  Using a box, for example, for the roll-axis alignment you will already create a constraint which connects the front lower left to the front lower right verlet.  For each rigid body, simply store this same constraint in Roll-Axis_Align.constraint.<br><br>Then get the vector by subtracting the x,y,z positions of the two verlets which are connected by the constraint and aligntovector using this.<br><br>Make sense?<br><br>Stevie <br><br></td></tr></table><br>
<a name="645856"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John J.</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah that makes sense - I like that idea. But what I mean is, what if there are no existing constraints along the x and z axis? <br><br></td></tr></table><br>
<a name="645897"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> There will be other ways .. what type of objects are you intending to make ... other than buildings and tanks which should work fine using this method?<br><br>Stevie <br><br></td></tr></table><br>
<a name="645908"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John J.</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I hope to simulate broken segments of building walls when you blow up or smash through houses. <br><br></td></tr></table><br>
<a name="645994"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Now that's gonna be tough ... I've tried to simulate a destructable brick wall using verlet.  Getting blocks to rest on each other is very tough.  I gave up in the end. I'd imagine arbitrary blocks will be a nightmare to simulate. <br><br>You'd probably have to construct each piece in such a way that they have additional constraints which can be used to align the axis'.   <br><br>Personally, if you're going down this route, I think you should consider using one of the 3rd party physics libs which have these features inbuilt and may save you a few headaches in the long run.<br><br>Sorry I can't be of more help.<br>Stevie <br><br></td></tr></table><br>
<a name="646477"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John J.</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> I plan to disable physics on building fragments (so they'll remain stationary) until an active physics object comes in contact with it. Otherwise, I'm sure it would be a nightmare, as you said.<br><br>I may try a 3rd part physics lib as a last resort, although I have some ideas which may get my current system to work. Thanks for all your help :) <br><br></td></tr></table><br>
<a name="646522"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> No problem John ... I'm happy to share my experiences of using verlet.  Just give me a shout if you think I can help.<br><br>Stevie <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
