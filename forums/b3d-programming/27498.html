<!DOCTYPE html><html lang="en" ><head ><title >Possible to detect texture collision?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Possible to detect texture collision?</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Possible to detect texture collision?</a><br><br>
<a name="288143"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jeroen</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi!<br><br>I was wondering: I'm trying to make a footstep system. E.g: grass, snow, brick, etc. The problem is that the level is just one big mesh. It would be great if Blitz could recognise which texture I'm colliding with...perhaps technically impossible :P<br>What would be a good approach? <br><br>Thank you. <br><br></td></tr></table><br>
<a name="288168"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Each texture needs to be on a different surface.  So you need to find out which surface you collided with.  CollisionSurface() returns the pointer to said surface.  <br><br>Hopefully this pointer will be the same as the pointer that you get when you try to get a surface handle to manipulate it.   If so, then you can store which texture is applied to specific surfaces in the mesh.<br><br>Ie, when you load the mesh, surface 1 should always be the same surface.  You can get the pointer to this surface, and then compare that pointer with the pointer returned by collisionsurface.  As surface 1 always gets the same material, you'll know which material is applied to surface 1.  You'll have to manually store this of course.  There MIGHT be a way to get the texture filename applied to that surface but I can't help you there. <br><br></td></tr></table><br>
<a name="288182"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Version 1.85 of Blitz3D features the useful commands:<br><br>brush=GetSurfaceBrush( surface )<br>texture=GetBrushTexture( brush[,index] )<br>name$=TextureName$( texture )<br><br>Remember to use FreeBrush and FreeTexture after you have finished using the results to avoid memory leaks. <br><br></td></tr></table><br>
<a name="288183"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rob</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> When you do<br><br>texture=GetBrushTexture( brush[,index] )<br><br>is this an actual pointer to the live texture or a copy? <br><br></td></tr></table><br>
<a name="288186"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Beaker</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> A copy. <br><br></td></tr></table><br>
<a name="288188"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's a copy of the handle not the texture, the reference / handle count of the actual texture is incremented hence the need for the Free. <br><br></td></tr></table><br>
<a name="288190"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> HOwever, if you track it down to the texture filename you can easily decide what sound should be used. SSwift was wrong when he said the order of surfeces loads always the same (you said that, did you?), because (no idea why) the order is randomly choosen, everytime diffrent, so yo never know "surface number 1 is grass.jpg"...<br><br>Using skidracers tipp you can assign a sound to each surface, you should do this one time right after loading and not multiple times in the game loop. <br><br></td></tr></table><br>
<a name="288247"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >semar</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Jeroen,<br>another way could be the use of Droplet (or another way) to place fixed pivot on the mesh. Each pivot will have a circle assigned, which determines the terrain composition.<br><br>Depending on the distance between the main character and each pivot, you can decide which sfx to use.<br><br>Sergio. <br><br></td></tr></table><br>
<a name="288256"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jeroen</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>Hmmmm interesting point of debate :)<br>The game has much height difference as well, so I think the pivot system as Semar suggested is not precise enough. <br><br>I hoped that it worked the same as alpha channels: Blitz basic looks for filename suffixes like alpha_blah.png...<br><br>I'll try Sswift's suggestion, but the first tries were unsuccesful <br><br></td></tr></table><br>
<a name="288286"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >(tu) sinu</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> @jeroen i've been doing this too, using similar methods to above, where all ground textures have a _grass, _wood etc prefix and then i parse the surface the player is on to decide which sound to play.<br>Had problems with it though and haven't thought much of it till your post.<br><br>"HOwever, if you track it down to the texture filename you can easily decide what sound should be used. SSwift was wrong when he said the order of surfeces loads always the same (you said that, did you?), because (no idea why) the order is randomly choosen, everytime diffrent, so yo never know "surface number 1 is grass.jpg"... "<br><br>finally, at least i now know they're chosen randomly, thought it was a bug or was doing something wrong. Mayb i can get my footsteps working properly. <br><br></td></tr></table><br>
<a name="288333"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SabataRH</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  finally, at least i now know they're chosen randomly, thought it was a bug or was doing something wrong. Mayb i can get my footsteps working properly.<br> <br></div><br><br>Yup they are choosen randomly, you may get the same order 10 times in a row then all of sudden poof! they are diffrent.. This is a MAJOR thorn in the side as many things could be possible if the order was not randomly tossed about.. I suppose  Mark has his reasonings behind this.. But none this less - its still a major 'holdback'. <br><br></td></tr></table><br>
<a name="288411"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> JFK:<br>HOwever, if you track it down to the texture filename you can easily decide what sound should be used. SSwift was wrong when he said the order of surfeces loads always the same (you said that, did you?)<br><br><br>I said "SHOULD" be the same.  Not is the same. :-)  <br><br>I don't know how in the hell Mark managed to make it random without actually TRYING to do so.  It's completely unfathomable to me how that could occur.<br><br><br>Okay so say you can't figure out the texture on a particular surface for whatever reason.  <br><br>Another thing you could do is make a second copy of the mesh, and set the vertex colors and use those to determine what the texture at that location is.  <br><br>But this is a big pain to do, and I think you can get the texture thing to work with these commands that the others described:<br><br>brush=GetSurfaceBrush( surface )<br>texture=GetBrushTexture( brush[,index] )<br>name$=TextureName$( texture ) <br><br>Just remember as they said to free the texture and brush after you get the texture name each time.<br><br>But don't do what I said, they said the surfaces will be random, so you can't just rely on the surface number being the same, or the polygon having the same number and what not.  You NEED to get the texture name.<br><br>So do this:<br><br><br>SURFACE_Level = CollisionSurface(MESH_Level, Collision_Index)<br>BRUSH_Level = GetSurfaceBrush(SURFACE_Level)<br>TEX_Level = GetBrushTexture(BRUSH_Level)<br><br>TextureName$ = TextureName$(TEX_Level)<br><br>FreeBrush(BRUSH_Level)<br>FreeTexture(TEX_Level)<br><br><br>And TextureName$ will now contain the filename of the texture that the entity that collided with the level, which has the COllision_Index specified. (In other words, it was the first, or tenth entity to be detected colliding with the level.  You have to find out the collision index when the collision is determined) <br><br>You can also specify a specific texture layer on GetBrushTexture if you have textures your level with two or more textures at once.  If you haven't, or the texture you want is the first texture applied to the level then you need not worry about that. <br><br></td></tr></table><br>
<a name="288420"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> ehm - I think it is faster when you parse trough all surfaces and assign a sound vector to an array before the game starts, right after loading. So finally you only have to check the collided Surface and find its sound in a small array.<br><br>something like:<br><pre class=code>
snd_grass=loadsound("grassstep.wav")
snd_street=loadsound("streetstep.wav")
snd_water=loadsound("waterstep.wav")
snd_wood=loadsound("woodstep.wav")

global numsurfs=countsurfaces(level)
dim footsound(numsurfs,1)
for i=1 to numsurfs
  footsound(i,0)=getsurface(level,i)
  footsound(i,1)=snd_street ; default

  brush = GetSurfaceBrush(getsurface(level,i)) 
  tex = GetBrushTexture(brush) 
  name$ = TextureName$(tex) 
  FreeBrush(brush) 
  FreeTexture(tex) 

  ; here you need to insert a fuction call that will strip 
  ; the path and leave the filename without path (because 
  ; TextureName$ delivers the complete path)

  select name$
    case "grass.jpg"
      footsound(i,1)=snd_grass
    case "wood.jpg"
      footsound(i,1)=snd_wood
    case "water.jpg"
      footsound(i,1)=snd_water
  end select
next

;...

while game
  snd_to_play=snd_street ; default
  collsurf = CollisionSurface(Level,Collision_Index)
  for i=1 to numsurfs
    if collsurf=footsound(i,0)
      snd_to_play=footsound(i,1)
      exit()
    endif
  next
  playsound snd_to_play
  ;...
</pre><br><br>of course you might use a Type Structure as well. <br><br></td></tr></table><br>
<a name="288429"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Asuuming that will even work, (cause blitz pointers are funny) it is a silly optimization.  <br><br>You won't even save a fraction of a second over comparing a few texture names per frame.<br><br>In this case, I say go with the simplest most straightforward method. <br><br></td></tr></table><br>
<a name="288455"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> try this:<br><br>a$=""<br>for i=0 to 1000000<br> a$=a$+" "<br>next<br><br>you can easily go for a cup of coffee meanwhile... <br><br></td></tr></table><br>
<a name="288534"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> A$ = A$ + " "  <br>is not the same as<br>if A$ = B$<br><br>You're allocating a million bytes of ram there, a few bytes at a time.<br><br>Try this:<br><br>a$=""<br>For i=0 To 1000000<br>If a$="blah.bmp" Then Print "Blah"<br>Next <br><br>It's virtually instantaneous.  Or close enough anyhow.  You're not gonna compare the string a million times a frame.  You'll be lucky if you compare it against 100 strings a frame. <br><br></td></tr></table><br>
<a name="288563"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, of course. But I think you CAN use Surface Handles since they will not change after Loading unless you mess around with them. <br><br></td></tr></table><br>
<a name="288567"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you can get the handle to a texture that a brush uses and it won't be the same handle you got when you loaded the texture, what makes you think that the handle you get from the collision  surface function will be the same as the handle you get when enumarating the surfaces in the object initially?<br><br>Besides, it's easier to just use the method I outlined and store the texture names than to make a bunch of arrays and surface indexing code. <br><br></td></tr></table><br>
<a name="288568"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Beaker</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Uuh! they will be the same surface IDs.  Trust me. :) <br><br></td></tr></table><br>
<a name="288591"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mustang</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> How about doing it like this (My planned way of doing it):<br><br>-get/pick the surface<br>-get/pick the UV pos<br>-check "mask" texture UV value<br>-play sound<br><br>Mask texture would be basically a copy of your texture map, but instead of textures it has only plain color areas - and in can/will be much smaller of course since it does not change the way how UV values work. These colored areas would define what sound you should play... nice thing is that if you have a texture that has many materials like wood, metal or glass you can still play the approriate sound... for example if you have a floor texture that looks like metal plates supported by wooden frame, then you would get mostly "metal" sounds, but occasionally "wood" sound when you step on the wooden frame. Picked color value can corrspond directly to the sound array value for speeed "optimization".<br><br>Nice thing here is that same method will work also for shooting/hit sounds... :)<br><br>Above assuming that you do your texturing "right" ie pack a lot of smaller textures to a bigger one. <br><br></td></tr></table><br>
<a name="288635"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jeroen</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> hmmmm seems like hard solutions :(<br>I wonder how other programmers which succesfully implemented this managed to handle this. <br><br></td></tr></table><br>
<a name="288650"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> sswift - nevertheless - the method that will track it down each time an information is required is shurely much slower, and the reason why is:<br><br>brush=GetSurfaceBrush( surface ) <br>texture=GetBrushTexture( brush[,index] ) <br>name$=TextureName$( texture ) <br><br>will create a copy of the texture and of the brush.<br><br>I have approx. 400 Surfaces in a complete Level including Items and loaded Interior Meshes. Now should I create 400 Textures each loop?<br><br>I doupt this would be usable. Instead I quickly compare 400 Ints in no time.<br><br>@Mustang - seems to be a pretty flexible solution, but I agree wuth Jeroen as well, seems to be a lot of work.<br><br>@Jeroen some time ago, when there were no Texture-trackdown Commands like the mentioned ones I wrote a silly brute-force comparing function for wmaass. It created a copy of the mesh and textured each surface manually with all of the Textures which were found by parsing the file. It created an additional Quad for every Surface in front of the camera while the Mesh itself was somewhere off the plot. It rendered then both, first the original and then the copy. The copy was rendered with each possible texture applied until the checksums of both rendered images matched.<br><br>As I said: pretty complicated and pretty silly - at least it worked. <br><br></td></tr></table><br>
<a name="288695"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SabataRH</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  I wonder how other programmers which succesfully implemented this managed to handle this.   <br></div><br><br>They spend $1000's and $1000's on a commerical, feature enriched graphics engine. <br><br></td></tr></table><br>
<a name="288701"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Beaker</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm with jfk on this.  It works for me as well. <br><br></td></tr></table><br>
<a name="288709"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >simonh</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> I use the new V1.85 commands (GetBrush etc) to assign different amounts of friction to different textures in Super Hamster Ball. Before starting the level, I parse all the texture names that are returned by GetBrushTexture, and assign the current surface handle they are attached to, to a friction value. Then when playing, I check the current collision surface against the one stored earlier, and apply the friction value. Works every time. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
