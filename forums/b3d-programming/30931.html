<!DOCTYPE html><html lang="en" ><head ><title >Occlusion using EntityVisible()</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Occlusion using EntityVisible()</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Occlusion using EntityVisible()</a><br><br>
<a name="329752"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Techlord</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've been pondering over the idea of using EntityVisible(entity,camera) to perform simple occlusion.<pre class=code>;Simple Occlusion
If EntityVisible(entity,camera)
ShowEntity entity
Else 
HideEntity entity
EndIf</pre><br><br>I'm curious has anyone else tried this command for this purpose and hows the performance? <br><br></td></tr></table><br>
<a name="329759"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >fredborg</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Once you've hidden the model, it cannot be visible to the camera, can it? So the first time it's not visible, it will stay hidden forever :D <br><br></td></tr></table><br>
<a name="329771"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Techlord</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Fredborg,<br><br>Thats a good point and I'm going to have to play with this. <br><br></td></tr></table><br>
<a name="329790"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> From what I know about the EntityVisible() Command, this works diffrent. <br><br></td></tr></table><br>
<a name="395209"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >maximo</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> &gt;Once you've hidden the model, it cannot be visible to the camera, can it? So the first time it's not visible, it will stay hidden forever :D <br> <br>how about this:<br><br>Make entity visible each time at before occulsion checkin. If it is visible to camera it stays that way if not it's hidden for this frame and so on. Next frame the same thing, you unhide it before checking and so on. This should work for simple occulsion, no?<br><br>;reset<br>ShowEntity entity<br>UpdateWorld ;perhaps this update here so EntityVisible can see it?<br><br>;Simple Occlusion<br>If EntityVisible(entity,camera)<br>ShowEntity entity<br>Else <br>HideEntity entity<br>EndIf<br><br>UpdateWorld<br>RenderWorld<br><br><br>you reset the entity each loop, and if camera doesn't see it you hide it, if it does see it it stays visible, this should work good I think ;) right? <br><br></td></tr></table><br>
<a name="395216"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Setting EntityAlpha to zero will also occlude the object from the Blitz3D rendering pipeline. <br><br></td></tr></table><br>
<a name="395219"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Warren</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is Blitz not doing this automatically?  If it knows you can't see the entity, why is it drawing it? <br><br></td></tr></table><br>
<a name="395221"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bot Builder</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah. I think Blitz has some basic frustrum culling in.  This is one of the reasons TrisRendered() changes without you adding any geometry (the other being terrains). <br><br></td></tr></table><br>
<a name="395249"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rogue Vector</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Blitz 3D really needs an occlusion system. <br><br>You only start to realise how important occlusion is when your level maps start going over 25,000 polys.<br><br>I tried, with not much success, to create a simple occlusion system using EntityDistance().<br><br>Something along the lines of this:<br><pre class=code>
range = 200
For object.TObject = Each TObject
  If (EntityDistance(camera, object) =&gt; range)
     EntityAlpha object, 0.0
  Else
     EntityAlpha object, 1.0
  Endif
</pre><br>In fact, you could ramp the alpha value up or down gradually, thus avoiding abrupt pop-ups.<br><br>Regards,<br><br>Rogue Vector <br><br></td></tr></table><br>
<a name="395264"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> You better use HideEntity in that case, when Collision of the invisible parts is not required. Because EntityAlpha 0 keeps checking Collisions and that slows down as well.<br><br>But hey -when you use a simple distance based occlusion system (as I do as well, btw.) then you only have to set the camerarange to a low value, eg. cameraRange cam,0.1,50.0 . This makes things real fast. But it requires the Mep Design to be pretty limited. No long halls (no matter how lowpoly they are) etc.<br><br>You cannot use ENtityVisible for Occlusion since it only checks for the visibility of the center pivot of an object. When an object is partially visible, but it's logical center is not, entityvisible will still return zero. I already tried to use this (slow anyway) EntityVisible Command for the precalculated Visibility Array Method.<br><br>The best thing you can get is a working portal system that will use 10 thousand tris or something per portal. This way you can use huge worlds and still have a bearable Occlusion of 90% of the level.<br><br>I already described somewhere else how I would implement this. the easiest thing would be a manual placement of Zone-Boxes. Once you have defined a number of zone boxes, it's up to the program to split a level in a number of parts, one for each box. Depending on the player position in the game, zones will be hidden or shown. Usually the current zone plus the surrounding zones may be shown. It depends on the level design, and the Designer needs to make it useful. Eg: if you add an s-shaped corridor between two zones, you'll be able to hide one of them properly because you cannot see from one place to the other. So Room 1 would be a zone, the cooridor and room 2 are further zones. <br><br></td></tr></table><br>
<a name="395270"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >puki</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have been trying something similar to "Frank Taylor's" idea but I found with 'If EntityVisible(entity,camera)' then the entity was always seen regardless of where, so I used EntityInView (entity,camera) instead this actually works especially for indoor levels with the camera range short.<br><br>Am I doing something wrong?  I can't get 'EntityVisible(entity,camera)' to work, but 'EntityInView (entity,camera)' works. <br><br></td></tr></table><br>
<a name="395406"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TartanTangerine (was Indiepath)</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Remember that when using entityvisible you need to set up objects as occluders (trees, houses etc..).  Do this by setting the EntityPickMode ie. EntityPickMode entity,pick_geometry[,obscurer] ; the obscurer bit is what you need to set.<br><br>HOWEVER this is very sloooow, essentially a linepick cast from the camera to the object, if the pick does not hit the object then it must be obscured!!! <br><br></td></tr></table><br>
<a name="395430"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rogue Vector</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> You've hit upon the problem with most of the occlusion systems I've tried to implement in Blitz 3D.<br><br>They're so slow that any gain is slight. In some extreme cases, when I removed the occlusion system, I got a higher frame rate.<br><br>Of course, it could just be that my code was crap.<br><br>Regards,<br><br>Rogue Vector <br><br></td></tr></table><br>
<a name="395448"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TartanTangerine (was Indiepath)</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> True, it's often faster just to chuck all of the polys at the GPU and let it deal with it. <br><br></td></tr></table><br>
<a name="395542"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Beaker</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="/posts.php?topic=34893" target="_blank">PortalPal</a>, even in a worse case scenario, gives you twice as many frames per second. <br><br></td></tr></table><br>
<a name="395621"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >maximo</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> well is this pp out? if not then it's not of any use right now ;) <br><br></td></tr></table><br>
<a name="395845"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Beaker</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> The point is that it can be done, and that it is worth doing.<br><br>I often hear people say "just throw it at the GPU, it will handle it", and while this may be true of newer and newer hardware, it is also true that you will still speed things up if you occlude as much as possible in the first place. <br><br></td></tr></table><br>
<a name="395876"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> This may not always be true. If you occlude as much as possible, you need to create multiple copies of surfaces to be able to hide and show map-parts dynamicly. Then, when you show a number of them, there may be a high number of double surfaces in the render pipeline and the number of Polys is not significant lower. You need to find a good balance between surfaces and polys. Don't worry about a few hundred polys, and when your level has no more than 20 Tirs, then you shouldn't even waste a thought about occlusion.<br><br>It is nice when you have a real big level, &gt;100 thousand tris. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
