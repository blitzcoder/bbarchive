<!DOCTYPE html><html lang="en" ><head ><title >Align Mesh on Terrain</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Align Mesh on Terrain</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Align Mesh on Terrain</a><br><br>
<a name="290719"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >CSauer</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi all!<br><br>I am creating a game with a terrainy water. The player can swim and dive, so that I must solve the view, where I have a splitted screen: a)upper water and b)under water.<br><br>Therefore I would like to align a mesh on the terrain in front of the camera (to show the under water in a foggy look). For a first and easy solution I tried to test this with only a rectangle. Later it should be better to have a complete alignment to the first visible terrain peaks. Here is what I actually use to create the mesh:<br><br>camera_lens_underwater = CreateMesh(camera)<br>camera_lens_underwater_surface=CreateSurface(camera_lens_underwater)<br>AddVertex camera_lens_underwater_surface,-.1,0,0,0,0<br>AddVertex camera_lens_underwater_surface,+.1,0,0,1,0<br>AddVertex camera_lens_underwater_surface,+1.5,-5,0,1,1<br>AddVertex camera_lens_underwater_surface,-1.5,-5,0,0,1<br>AddTriangle camera_lens_underwater_surface,0,1,2<br>AddTriangle camera_lens_underwater_surface,0,2,3<br>PositionEntity camera_lens_underwater,0,0,1<br>EntityFX camera_lens_underwater,16<br>EntityOrder camera_lens_underwater,-1<br>EntityColor camera_lens_underwater,13,95,205<br>EntityAlpha camera_lens_underwater,.6<br>HideEntity camera_lens_underwater<br><br>camera_lens_pivot_left = CreatePivot(camera)<br>PositionEntity camera_lens_pivot_left,-1,0,1<br>camera_lens_pivot_right = CreatePivot(camera)<br>PositionEntity camera_lens_pivot_right,1,0,1<br><br>Parallel to the animation I tried to align the mesh realtime to the terrain, but this does not work correctly:<br><br>ty# = TerrainY(water,EntityX(camera_lens_pivot_left,1),0,EntityZ(camera_lens_pivot_left,1)) - EntityY(camera_lens_pivot_left,1)<br>VertexCoords camera_lens_underwater_surface,0,EntityX(camera_lens_pivot_left),EntityY(camera_lens_pivot_left),EntityZ(camera_lens_pivot_left)<br>	<br>ty# = TerrainY(water,EntityX(camera_lens_pivot_right,1),0,EntityZ(camera_lens_pivot_right,1)) - EntityY(camera_lens_pivot_right,1)<br>VertexCoords camera_lens_underwater_surface,1,EntityX(camera_lens_pivot_right),EntityY(camera_lens_pivot_right),EntityZ(camera_lens_pivot_right)<br><br>This does not align to the camera view (although I used the mesh as a child of the camera) and this does not align to the terrain-peaks.<br><br>What do you think?<br>Has somebody a hint or a function to solve this problem?<br>Thanks a lot in advance. <br><br></td></tr></table><br>
<a name="290833"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sunteam Software</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's difficult to say without seeing what the problem looks like on screen but if your manually aligning the object to the camera then I wouldn't parent it. <br><br></td></tr></table><br>
<a name="291013"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >CSauer</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for your answer.<br>Here is a example screenshot:<br><img src="http://www.xideas.de/piratesbattle2/Example1.jpg"><br><br>The rect - which I have drawn manually onto the screenshot in red - I want to create as a mesh in front of the camera and set it to a alpha of .5 to look under the water surface.<br><br>Do you know any solution? <br><br></td></tr></table><br>
<a name="291050"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Marcelo</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Did you tried to reduce the camera near clip plane? <br><br></td></tr></table><br>
<a name="291054"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rob</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> it will not be a rect. It can possibly have a maximum of five, not four points where the corners meet.<br><br>If you switch to mesh deformation, you can easily get the closest vertices in view and deform a polygon to match. This would be an easy thing to do. But not realistic. what you envision isn't realistic anyway.<br><br>Consider real life, does water look like a slice of cake to you? Reduce the near clip plane or simply force the player to miss this with a splash effect or move slightly below or above... <br><br></td></tr></table><br>
<a name="291067"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >CSauer</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Rob,<br><br>your are right, but I have problems to define beeing above or below. I actually use this when the player is swimming (not diving):<br><br>PositionEntity player(m%)\player_pivot,EntityX(player(m%)\player_pivot,1),(TerrainY(water,EntityX(player(m%)\player_pivot),0,EntityZ(player(m%)\player_pivot,1))+.4),EntityZ(player(m%)\player_pivot,1) <br><br>But this seems to be not exact, because I can create the above shown screenshot. I to this every time I animate the waves, so it isn't a tweening issue, I think.<br><br>I changed from water-mesh to terrain, because it was hard to define the position above water (swimming).<br><br>Therefore I want to create a look like water in a glas. It is a bit realistic if you say, players-eyes are a camera. A real eye cannot have lens-flares.<br><br>Rob, can you help me to create the function for a mesh-water version?<br>Thanks. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
