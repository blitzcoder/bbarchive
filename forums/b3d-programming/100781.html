<!DOCTYPE html><html lang="en" ><head ><title >Program a door to move or animate it?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Program a door to move or animate it?</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Program a door to move or animate it?</a><br><br>
<a name="1192848"></a>

<a name="1192849"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Imperium</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm trying to think of the best approach to add in simple doors into my fps game. Should I animate the objects or just manipulate the door itself in real time? Examples would be great. Think of in Doom or Wolfenstein 3d. Doors went up an down and only side to side.<br><br><img src="http://tcrf.net/images/6/67/Doom-E2M2RedKeyDoor12.png"><br><img src="http://2.bp.blogspot.com/-_vMtUpf-M3A/T5qbYgUukyI/AAAAAAAAAHQ/KC073nLeYyU/s400/e4l3doors.png"> <br><br></td></tr></table><br>
<a name="1192858"></a>

<a name="1192860"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I would say this is a matter of style really. A decision like this reflects the architecture of your program.<br><br>-- animated objects place the movement code in your media/data. The program has no control over what actually happens, only over the trigger. Users can replace or modify the movement in mods.<br><br>-- manipulating the object places the movement code in your program/engine. The program is completely aware of the concept of "a door" and has direct control over it, but the downside is that there's a limit to the number of things you can control this way and it is harder to mod and extend.<br><br>Given the nature of your game and level design (based on the other threads), it seems like doors and potentially any other moving platforms probably ought to "belong" to the engine in this setup, because of the simple design that "claims" a lot of ownership of the level design already.<br><br>The other thing is that doors are inherently more connected to the second category, because animations are normally used to <i>visualise</i> an effect that's already actually happening in the world (e.g. a player emitting a spray of bullets is not dependent on them bracing against the recoil), whereas here the door opening is an effect in and of itself, so it should be represented at a less ephemeral level. If I wanted to mod in more kinds of moving platform at a later date (how many kinda can there be anyway?), I would feel "cleaner" having script hooks attached to my level rather than using animation effectively as a scripting tool it wasn't designed to be.<br><br>Plus, using code lets you take more control over every aspect of what the door is doing and lets you have a proper locking and keycard or remote switch system: you'd have to have this anyway so tying it in with animation would just stretch your concerns over a wider area of implementation.<br><br>Finally, the fine control of animation seems overkill for linear movement.<br><br>(I know there are intermediate positions like the aforementioned scripts attached to a level, or config files to control animation parameters, but these are distractions from the issue of problem ownership: that's still a code/data distinction.) <br><br></td></tr></table><br>
<a name="1192882"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Imperium</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Programmed manipulation is response I anticipated. Like you already stated I need to code a locking/keycard/remote system anyway so it would likely work best if the doors function as part of the level itself. I'm not doing anything very fancy yet so this should work well enough. <br><br></td></tr></table><br>
<a name="1192883"></a>

<a name="1192884"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Your question is about if it is better to use MoveEntity or/and TurnEntity rather than AnimateEntity ?<br><br>I think that there is no best answer, that's your choice.<br><br>You can also create animations inside blitz3d with code if you want to add complex movements of the parts. <br><br></td></tr></table><br>
<a name="1192966"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> All I will say is this:<br><br>Depending on how much of your program code requires some form of frame-limiting or time - management will affect the ease of which method you choose.<br><br>ANimateEntity is somethign that takles a little more work in setting up, i.e. loading or defining the animation frames and keys - but is a lot easier to manage once done.<br>However, it also adds a little to VRam I believe (possibly not an issue  in real terms though)<br><br>When Turn or Rotate etc. is used, however, these may need to be time-dependant.<br>Imagine a game running at 60fps - A door opening at 1 degree per frame is going to take 1.5 seconds to open<br>If the time taken is to be controlled, then it may be necessary to ensure that flags for the door state (i.e. closed, opemn, openING or closING) are used, and a record of the timing and 'speed'. <br><br></td></tr></table><br>
<a name="1193010"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Imperium</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> My game runs at 60fps but the logic is limited to 30fps. I think a door would be a great candidate for createtimer(). <br><br></td></tr></table><br>
<a name="1193012"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> well that would be delta timing, pretty easy to implement. i suggest not to use animation because it will cause troubles with collision. handling doors is really one of the easier things. a swinging door can even determine the players position and swing away from him automaticly. you can use tricky atan code for that, or simply stick a pivot to each side of the door and check which one is closer to the player.<br><br>hold an array or type list in memory that stores the state of each door. check them frequently and if one door is open for 10+ secs, close it automaticly and set its state to ""can be opened again.<br>if a door should be opened, turn it repeatedly, until it reaches eg. 90 degrees do the same in reverse to close it. turn it every frame a few degrees, depending on the framerate. note delta timing has been explained several times, should be easy to search for. <br><br></td></tr></table><br>
<a name="1193549"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I do agree with all of the above.<br>But also bear in mind that an animated entity which has the animation built in by the modelling program will open, but Blitz read the collisions from the first frame (e.g. closed) so you'll never be able to walk through.<br>I wasted many weeks until I realised this was happening.<br><br>Manually opened doors are of course far more work, but allow greater control, e.g. a door opening sound, slamming sound.<br><br>I have type HINGED, LIFTING, SLIDING, then jump to the appropriate section of code when triggered, and also monitor the angle/height/position to stop when at the maximum.<br>Unfortunately my code is integral to the engine, so could not be separated to be given away, but just work away at it logically.<br>It's a great feeling to see your first Doom-type door open! <br><br></td></tr></table><br>
<a name="1193553"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>But also bear in mind that an animated entity which has the animation built in by the modelling program will open, but Blitz read the collisions from the first frame (e.g. closed) so you'll never be able to walk through.<br> <br></div><br>Not if you create a separate collider and set it as a child of the joint which move|rotate the door.<br>But i understand what you mean. <br><br></td></tr></table><br>
<a name="1193814"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> you're right about that, but it requires some sort of joint naming rules and complicates things, eg. who will make the collider?<br><div class="quote">  It's a great feeling to see your first Doom-type door open! <br></div><br><br>my words! <br><br></td></tr></table><br>
<a name="1193825"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  an animated entity which has the animation built in by the modelling program will open, but Blitz read the collisions from the first frame (e.g. closed) so you'll never be able to walk through. <br></div><br><br>I know this is definitely true for bone-based animations because they just redraw the vertices rather than moving anything, but is it also true for segmented-mesh animation (i.e. classic 3DS style)? Segmented animation genuinely moves the whole mesh, after all, not just the control pivot. <br><br></td></tr></table><br>
<a name="1193947"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Imperium</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> <img src="http://nostalgicalgorithms.com/images/AOR_door_wip_animation.gif"><br><img src="http://nostalgicalgorithms.com/images/door_coding_help.PNG"><br><br>Replace "HAVE" with "HAVING" in above explanation.<br><br>I hope all of this makes sense. Basically if you step on the hidden red trigger the door moves up if you hit spacebar. Then the door stops moving up when it hits the green trigger. Finally it then resets after a certain amount of time. Seems simple enough right? <br><br></td></tr></table><br>
<a name="1193954"></a>

<a name="1193955"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>Basically if you step on the hidden red trigger the door moves up if you hit spacebar. Then the door stops moving up when it hits the green trigger. Finally it then resets after a certain amount of time. Seems simple enough right? <br> <br></div><br>Too simple !<br><br>What if :<br>The door is closing and the player or a bot collides with it  ?<br>The door is opening an the player or a bot collides with it ?<br><br>Keep in min that with Blitz3d you can only retrieve infos about a collision between a moving collider sphere and a static collider sphere, or collider box, or collider mesh, or between a moving collider sphere and a moving collider sphere...<br>But there is also Mesh intersect which can be useful in this case (with a distance check before doing the mesh intersect check, to make sure the player or a bot is near enough, because meshintersect takes time. Whatever approach you choose, i suggest to use low tris colliders hidden with EntityAlpha set to 0.0)<br><br>Where are the buttons ? From your explanations you don't want buttons, you use triggers.<br><br>Where are the locks ?<br><br>Where are the keys ? or the keycards ?<br><br>Think about it.<br><br>For the movement of a door, i use these states :<br>IsClosed<br>IsOpening<br>IsBlockedWhileOpening<br>IsOpened<br>IsClosing<br>IsBlockedWhileClosing <br><br></td></tr></table><br>
<a name="1193970"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Imperium</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> What if :<br>The door is closing and the player or a bot collides with it ?<br>The door is opening an the player or a bot collides with it ? <br></div><br>The Door1 model is tagged as a solid object so you should simply not be able to move through it because the players mass restricts what you can and cannot move into. The player can still try and move through the door while it's opening but they won't pass though until its high enough to allowl the invisible mass of the player or bot to pass through. This should work in theory.<br><br><div class="quote"> <br>Where are the buttons ? From your explanations you don't want buttons, you use triggers. <br></div><br>The buttons are on the door lol. Basically this is a Doom style door so if you are roughly in front of it you can trigger it to open.<br><br><div class="quote"> <br>Where are the keys ? or the keycards ? <br></div><br>This will be handled by inventory items or should the key actually be tied specifically to the door itself? <br><br></td></tr></table><br>
<a name="1193998"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>This will be handled by inventory items or should the key actually be tied specifically to the door itself? <br> <br></div><br>You do as you want, this is your game, i suggested these things because i had to think about the same things for my game. <br><br></td></tr></table><br>
<a name="1194046"></a>

<a name="1194047"></a>

<a name="1194048"></a>

<a name="1194049"></a>

<a name="1194050"></a>

<a name="1194051"></a>

<a name="1194052"></a>

<a name="1194053"></a>

<a name="1194054"></a>

<a name="1194055"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi. Using colliders the way you're doing has you not taking the player's orientation in consideration. The player would be able to open a door by stepping on its collider, facing the opposite way and hitting the action button.<br>You need to check if the player is 'looking' at the door, and only allow him to open it if this is true.<br><br>I think using colliders at all for this may be a bit over-engineering. <br><br>You can try a different approach: <br>At any moment the player uses the action button, you resort to CameraPick( camera, screenCenterX, screenCenterY ), so you can see if-<br>A) The player is facing the door (the picked entity is the door mesh, as some part of it is right on the middle of the screen).<br>B) The player is close enough to the door (<a href="/b3ddocs/command.php?name=pickedtime" target="_blank">PickedTime</a> from the CameraPick multiplied by the camera-range = distance in 3D units).<br>Then if the above is true you can change the door's "moving" state flag to True. So the player can keep pressing the action button and even if the conditions above are true, this flag will prevent the door from repeatedly opening\closing.<br><br>Now for actually animating the door; You're interpolating between two transformation "stages". That is, in one stage the door is with a specific position\rotation\scale combo, and in the other stage the door has another position\rotation\scale combo.<br>What you can do is define these two stages. For this you can either manually store somewhere these transformation values, or you can use a pair of pivots as facilitators to hold these values (so each pivot is positioned\rotated\scaled to represent the final state of how you want the door to be on each stage).<br>With stages like these, you can program code that based on a normalized fractional value (that is, a variable going from 0.0 ~ 1.0), transforms the door by interpolating between these two stages. Each door has its own fractional value, it's just a Float field in the door Type.<br><br>You also need another Float field in the door Type which is the speed by which this fractional value changes (you can do some interesting Ease-In, Ease-Out effects by changing this speed instead of keeping it constant).<br>Every frame the door's "moving" state is True, you add the speed to the interpolation value, and check if this value has reached one of the extremes.<br><br>You can make some definitions based on the fractional value used to interpolate between the stages. If the value is '0', you know the door is closed. If it's '1', you know the door is open.<br>Once the fractional value reaches one of these extreme values, you can switch the "moving" state flag to False so the player can use the door again, and you can also flip the sign of the speed value that changes the fractional value (this means the next time the door's "moving" state is True, it changes to the other stage). <br>You can also automate it so that when the "moving" state flag is False (meaning, the door is stationary as it has reached one of the stages), and its fractional value is 1.0 (it's the open stage, the door is open), it times it and switches the "moving" flag back to True so the door changes to the other stage (that is, it closes automatically after some time). <br><br></td></tr></table><br>
<a name="1194082"></a>

<a name="1194083"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> If your doors will only be at front, at back, at left, at right, you could also use a XZcoordinates calculation to know if a character is on a trigger, and deltayaw to know if he is looking towards the door or not. <br><br></td></tr></table><br>
<a name="1194114"></a>

<a name="1194115"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Colliders seem like overkill for this (they're intended to stop objects, not work as tripwires and can be buggy in that respect if objects aren't moving exactly as expected) - I'd suggest replacing them with a check against an oriented bounding box.<br><br>There's some existing code for that here: <a href="/codearcs/codearcs.php?code=1920" >Lib to create an OBB and test if a point or entity is inside its space</a> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
