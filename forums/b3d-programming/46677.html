<!DOCTYPE html><html lang="en" ><head ><title >Blitzplay help</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Blitzplay help</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Blitzplay help</a><br><br>
<a name="519243"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Farflame</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is specific to Blitzplay I think. I've tried emailing Surreal who created it but have had no reply, and can't get help on the Blitzcoder forums :(<br><br>Basically, I have a large server program that's doing alot of sending/receiving data using Blitzplay. It was working fine until recently when I was trying to send 192 strings from the server to the client. The strings were no more than 50 bytes, including the header information. I was sending using BP's reliable sending because I NEED all of the strings to get there.<br><br>It wasn't all arriving, so I wrote the details out to logs and found that exactly 11 of the strings were arriving each time. When I changed to non-reliable sending, all of them were arriving (mind you, this is between two computers linked via a router, so it's not so surprising), and when I changed to ordered sending, none of them arrived at all.<br><br>As I say, I need to have reliable messages, so I can't just switch to non-reliable ones, and I doubt they'd be that reliable on a real internet connection anyway.<br><br>What I'm confused about, is why exactly 11 would be arriving every time I test it. It's almost as if I've reached some kind of limit, yet when I test Blitzplay on a test program it seems quite happy to send endless amounts of data at almost any speed I ask of it (well, it's happy to be stuck in a continual sending/receiving loop).<br><br>Any ideas what might be causing this? <br><br></td></tr></table><br>
<a name="519246"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KuRiX</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here is your answer:<br><br>BlitzPlay uses an Ack ID for every reliable message, so until the message has not been correctly sent the Ack Id is no available again.<br><br>so if you send more than the maximum, the rest are ignored.<br><br>The solution is not easy. Increasing that maximum is impossible, cause it uses one byte (255 maximum).<br><br>Perhaps you should use TCP own sockets... <br><br></td></tr></table><br>
<a name="519255"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Farflame</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> How do you mean by TCP own sockets? Do you mean use Blitz's TCP commands, instead of using Blitzplay?<br><br>Also, what is the maximum number of messages I can send then? 255? Is this different with TCP?<br><br>Is there a detailed explanation of all of this somewhere? I feel like I'm programming in the dark here. <br><br></td></tr></table><br>
<a name="519264"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KuRiX</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, the limit of 255 Max Reliable messages *at the same moment* is a limit of Surreal¡s DirectPlay Library. <br><br>He thought that no one would send 255 messages at the same time and when sending more, no one would have arrived.<br><br>TCP socket's don't have this problem, because it uses the windows socket library, that manages all of this.<br><br>There are a function in BlitzPlay that tells you how many free Ack Id's you have. Perhaps you should block all the sending until one Id is free. <br><br></td></tr></table><br>
<a name="519281"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Farflame</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, that sounds like a plan. I'll discuss it with Surreal aswell and hopefully I can edit my copy of the library or somethng. At least it looks like there are solutions, thanks :) <br><br></td></tr></table><br>
<a name="519288"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KuRiX</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have emailed Surreal with this problem some weeks ago, with no response. I am modifying this great library on my own, getting some interesting improvements.<br><br>Although i have not corrected that problem. What i do is sent all the "must arrive" messages with priority, sending them first, or reserving some ACK ID's. <br><br></td></tr></table><br>
<a name="519307"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Farflame</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah, he used to answer emails very quickly, but he seems to have disappeared off the face of the Earth lately.<br><br>Luckily, for this particular problem, I can get around it by sticking the strings together and parsing them at the client end. I'll just have to hope this problem of 255 max signals is fixed by the time I have 10,000 people playing my game :) <br><br></td></tr></table><br>
<a name="519372"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Farflame</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Don't suppose you know how to use the BP_AckInUse function do you? I can't get it to work. My theory is to put the send message in a loop until the Ack reports false (i.e sent), but I'm doing something wrong. Could you tell me which part of this is wrong?<br><br><pre class=code>
Repeat
AckID=BP_Message(p\net_ID,BP_Host_ID,2,packet$,BP_Ordered)
ID=BP_FindPlayersConn(p\net_ID)
Until BP_AckInUse(ID,AckID)=False
</pre> <br><br></td></tr></table><br>
<a name="519426"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KuRiX</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Of course. The function that sent the messages, check the ack's, etc, is BP_UPDATENETWORK. So if you don't call that function, you will never update the status of the variables.<br><br>Repeat<br>AckID=BP_Message(p\net_ID,BP_Host_ID,2,packet$,BP_Ordered)<br>ID=BP_FindPlayersConn(p\net_ID)<br>BP_UPDATENETWORK()<br>Until BP_AckInUse(ID,AckID)=False<br><br>Anyway, you are sending a message and waiting for its ack. This kind of protocol is called "Stop and Wait", so you only will send one message at a time, in a blocking way. Easy solution, but not too efficient.<br><br>P.D: Don't forget to check after that test the incoming messages that BP_UPDATENETWORK could have created...<br><br>The Best solution for Surreal would be to put the "not sent" messages in a queue until some Ack ID Slot is free. He uses types for the messages, so putting a new field called queueid should kick the problem. Then in every BP_UPDATENETWORK let's see if there is any unsent message due to insufficient ack id's. <br><br></td></tr></table><br>
<a name="519515"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Farflame</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah, I assumed it was a messy solution, but was wondering if it would work anyway. Joining the strings together has solved this main problem, but I hope that Surreal will fix this as I can envisage all sorts of problems if I had alot of players in my game.<br><br>By the way, I still get an error with that code above. On the line 'ID=BP_FindPlayersConn(p\net_ID) I get an 'Illegal Type Conversion' error. Where exactly do I get the ID from? Surely the net_ID in the players details is what it's after? <br><br></td></tr></table><br>
<a name="519532"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KuRiX</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> BP_FindPlayersConn returns a connection, not an ID.<br>Soy if ID is not of type BP_connection (i don't know only seeing the code above) you must:<br><br>Conn.BP_Connection = BP_FindPlayersConn(blablabla... <br><br></td></tr></table><br>
<a name="519621"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Farflame</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm afraid I'm struggling with this. It has a problem with the p\net_ID I think. In my program, p\net_ID is created with this piece of code......<br><br><pre class=code>
Case BP_PLAYERHASJOINED		;Someone joined!
p.pdata = New pdata		;Create a new player and initialize their data
p\net_id = msg\msgFrom
</pre><br><br>So is p\net_id not the correct variable to be feeding into BP_FindPlayerConn(?)? <br><br></td></tr></table><br>
<a name="519704"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KuRiX</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Your above code is correct. So i don't know what is the problem... <br><br></td></tr></table><br>
<a name="519999"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Farflame</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> This may sound like a dumb question, but in the BP library itself, I see the lines.....<br><br>Field ACKbuffer.BP_ReliablePacket[255]<br><br>... a couple of times. If I just increased the 255 to say... 10,000, would that fix the problem mentioned above? <br><br></td></tr></table><br>
<a name="520011"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KuRiX</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> No, because later, when sending the messages, Surreal Uses only one byte of the udp message header containing the number of ID.<br><br>One Byte gives only 255 numbers, so... <br><br></td></tr></table><br>
<a name="520080"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Farflame</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> And there's no way to change that by altering the library itself? Is it something only Surreal could do? <br><br></td></tr></table><br>
<a name="520194"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KuRiX</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Of course there is a way!. You could use more than one byte for the Ack Counter. The problem is that is a very internal check. For example, one reliable message would be like:<br><br>senderid,receiverid,ackid,msgtype,msgdata,timerid<br><br>senderid = one byte (by default)<br>receiverid = one byte(by default)<br>etc...<br><br>then, if you want to use two bytes for the ackid you must change all places where the message is parsed, telling them that there are N bytes for the Ack Id. Then you must change all the functions that returns the next free ack id, etc...<br><br>What i say is that this is a "relatively easy job" for Surreal. So why spend lot of hours changing it ourselves? I have made lot of changes to the library, but only easy things.<br><br>And of course, Surreal thought that you would have a limit anyway, so the user should check that. Although as i have commented before, the best solution is to put the "not free ack id" messages in a queue, then send them when possible. I think this is an easier solution... <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
