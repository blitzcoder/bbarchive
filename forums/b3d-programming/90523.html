<!DOCTYPE html><html lang="en" ><head ><title >Shadows For a Large Environment</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Shadows For a Large Environment</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Shadows For a Large Environment</a><br><br>
<a name="1029256"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ClayPigeon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello. I'm working on a FPS in which many of the levels consist of an entire island with plants and all. I'm having to do a lot of optimization (fading plants, dynamic LOD with terrain, etc.) to prevent slowdown. What I want to know is what shadow technique would work best for such a large environment? Obviously, stencil/volume shadows are out of the question. All the detail I require is enough to get rid of the "flatness" of the scene. Shadows that are far from the camera don't have to be detailed, just enough to see a hill cast a shadow on the ground. I do, though, want to have small objects up close have a low detail shadow as well, but there just needs to be enough detail that the player can SEE there's a shadow there. I was thinking the best method would be shadow mapping, as it only requires you to create a camera at the light sources. But, from what I've read, people here seem to be convinced it's impossible. Anyone got any ideas?? <br><br></td></tr></table><br>
<a name="1029262"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Robert Cummings</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Vert shading sounds like an easy bet. <br><br></td></tr></table><br>
<a name="1029266"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ClayPigeon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Shadows, not shading. If you mean to make shadows using vertex colors, that would be too CPU costly, having to go through each of the vertices and do a linepick to find out if there was a straight line between the camera and the vertex. <br><br></td></tr></table><br>
<a name="1029305"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> NEVER underestimate the power of vertex coloring. It is being used by <b>professional game developers</b> up to this day.<br>It provides you with a shading capability at no cost of performance and memory (since every vertex already have those attributes to start with).<br><br>I want you to look carefully at the following screen grabs from Super Mario Sunshine for the GameCube.<br><br>Full scene as in the game:<br><img src="http://img176.imageshack.us/img176/521/sunshine1.png"><br><br>WITHOUT vertex color:<br><img src="http://img405.imageshack.us/img405/7074/sunshine2.png"><br><br>ONLY vertex color:<br><img src="http://img535.imageshack.us/img535/332/sunshine3.png"><br><br>Pretty much all the shading is done through vertex colors. There are some baked textures like the ones for the roofs of the huts and for the trees (that aren't seen in these screens, but you can see one baked tree shadow at the middle, leftmost side of the screens). <br><br></td></tr></table><br>
<a name="1029313"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ClayPigeon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> You are right - I agree. Except that appears to be made for static shadows, and it actually looks like they modelled the shadows into the level. I've played SMS and the sun never changes angle. Also, if you look at Mario's shadow and compare it to those seen on the walls, you will see that Mario's shadow is all pixelated, whereas the shadows on the wall are perfectely smooth. From this, I'm guessing they are using shadow mapping for dynamic shadows, and static for.. static. Also, if I remember correctly, when Mario runs into a static shadow, his shadow is still visible, even though it is completely obscured by a wall. <br><br></td></tr></table><br>
<a name="1029331"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Indeed, they did model the shadows in the level (if I turn on wireframe I can see the edges for the shadows, even though these extra polygons don't interfere with the original topology). <br><br>As it is for lots of games out there: static lightmaps\vertex-shadows for environment and static objects; dynamic shadows for dynamic objects.<br><br>Not only the problems you pointed out, but also the fact that since all these shadows are coming from the <b>same light source</b> (the sun), they should all meld together to the same tone. However, when mario steps under a tree's shadow or these shadowed zones from levels, his shadow gets even darker as it's being blended into the ground. This doesn't happen in real-life.<br>However, we are dealing with a <b>simulation</b> here. It's very easy to point out irregularities since it will be always far from reality.<br><br>Let's realize that the experts at Nintendo were aware of these problems and still let them go by because the "juice wasn't worth the squeeze". <br>With all these things you and I pointed out, Super Mario Sunshine still <b>has a metascore of 92%</b>, from <a href="http://www.metacritic.com/games/platforms/cube/supermariosunshine" target="_blank">MetaCritic</a>. <br><br></td></tr></table><br>
<a name="1029419"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I agree you shouldn't get too bogged down on the technical details like that. It's going to be near impossible to have this kind of lighting, in blitz3d, real time. <br><br></td></tr></table><br>
<a name="1029523"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ClayPigeon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I realize what you're saying, but without shadows, everything just is terrible. I need something to show lighting. Is there some super-lowres method that gives big blurry shadows or something? I'm actually not sure how slow linepicks are, so I might try that. <br><br></td></tr></table><br>
<a name="1029529"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >puki</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> but without shadows, everything just is terrible <br></div><br>Yeh, this has proven to be a problem for me.  I use FastExtension and LOD it like a mother.<br><br><img src="http://img9.imageshack.us/img9/3116/blitz3d.jpg"><br><br><img src="http://img13.imageshack.us/img13/296/blitz3d2.jpg"><br><br><a href="http://www.youtube.com/watch?v=B99AGwi-VFE" target="_blank">http://www.youtube.com/watch?v=B99AGwi-VFE</a><br><br><br>The point being this is all near-range.<br><br>Without it - the whole thing sucks when you have seen it with shadows.<br><br>Your CPU is potentially going to hold you back.  I'm going to have to upgrade my CPU to deliver more oomph to Blitz3D.<br><br>I use real-time shortcuts by using EntityColor, 127, 127, 127, etc to apply fake shadow cover to entire meshes.  So, if I have a rock in shade behind a house, I just EntityColor the equivalant shade to it, I don't need to apply the shadow, unless it is partly shadowed - this method is handy for things which are sheltered by buildings, etc.  You can real-time alter this on the fly and also use it convincingly for animated meshes, such as characters - so you cast a shadow from the building to the ground mesh then, use EntityColor to apply fake shading to anything that falls within this area.  It is certainly faster than trying to blanket a whole area of vedgetation, etc with a real-time shadow.<br><br>I wouldn't worry too much about the distant objects, like hills, etc as it is just not practical.<br><br>FastExtension is not really designed for this; however, I find it works a treat for indoor FPS-type environments. <br><br></td></tr></table><br>
<a name="1029530"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I realize what you're saying, but without shadows, everything just is terrible. I need something to show lighting. Is there some super-lowres method that gives big blurry shadows or something? I'm actually not sure how slow linepicks are, so I might try that. <br></div><br>Oh, sure, I didn't mean "don't use shadows at all". Lightmaps and shadowmaps are really the way to go (and you could also use vertex-coloring to spice things up a notch, if the sun isn't moving).<br>What I wanted to say was something like "don't dwell in the attempt of perfection, since you won't get it anyway. Stick with the acceptable".<br>Oh, and I'd advise against linepicking\raycasting, as nobody uses that because it's too slow to do it real-time.<br><br>I don't know how FastExtension works for shadow-maps. I do know that of all the [few] shadow-map solutions available, it's definitely <a href="http://fastlibs.com/images/fe/shadow2.jpg" target="_blank">one of, if not the best</a> (both visually and performatically speaking). <br>You could try to use lower resolution shadow maps for distant objects (similar to a method known as "Parallel-split shadow-maps") and blur that a bit (or not at all). Pay special attention to the bias of the shadow, if it spreads too far from the object in an unrealistic manner.<br><br>If you're in doubt of where to begin, start with the Lightmap(s) of your level. Use something like Gile[s] (<a href="http://www.frecle.net/giles/" target="_blank">freeware</a>) to do it, and set up the quality you want (it has a good packer and can split your level into several lightmap textures to ensure a very good quality).<br>After that, get your hands dirty with dynamic shadows for objects, even if they don't go beyond simple faded sprites at ground level (what matters is the final result, after all). <br><br></td></tr></table><br>
<a name="1029556"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ClayPigeon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Lightmapping? I've been down that dark, cruel road. In the beginning, it seems "so nice" and "perfect for everything"! That is, until you try to move the sun, and *POOF!* you hate it permanently.<br><br><div class="quote"> Your CPU is potentially going to hold you back. I'm going to have to upgrade my CPU to deliver more oomph to Blitz3D. <br></div><br><br>Sounds familiar. I have a Celeron D. Talk about SLOWWWWW!!<br><br>I'm gonna see if I can make some kind of primitive shadow map system real quick. <br><br></td></tr></table><br>
<a name="1029596"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm, I'm not sure I agree with you in that; lightmaps have been used for "decades". At the cost of a static sun, of course.<br>Does a day~night cycle play an important role in your game? there might be other ways to simulate that.<br><br>But then, can you tell me what game before Crysis had the feature of environmental dynamic shadows for a moving sun? so, any game that came before Crysis that had a day~night cycle system probably used some other method. <br><br></td></tr></table><br>
<a name="1029731"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ClayPigeon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> can you tell me what game before Crysis had the feature of environmental dynamic shadows for a moving sun? <br></div><br><br>Well, there's one I can think of right off the top of my head: Uru. But, it doesn't have a day-night cycle; it just stays how it is when you get there and you can play it for days, but it stays the same. I guess I'll have to do away with the day-night cycle.. Man, I miss the days when blob shadows were enough, 'cause then you could just move the sun anywhere, and the shadows didn't really matter. So, maybe I can keep my day and night cycle and just make the shadows always be casted straight down? <br><br></td></tr></table><br>
<a name="1029736"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> That could work. <br>You'd have the environment's and sky's color change between day and night tints, to give the illusion of time passing. That should be more than enough to give the feeling, as well as changing the ambient sound. <br><br></td></tr></table><br>
<a name="1029737"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ClayPigeon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sounds good. I've got a simple top-down shadow system going. Now, I just can't figure out how to get the orthographic camera to have the edges of its view exactly at the edges of the terrain? Something about the zoom level? <br><br></td></tr></table><br>
<a name="1029848"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm, there must be some ugly math to do that. It's related to getting the bounding rectangle for the top-view of the terrain, and getting the best fit of that with the current camera FOV angle (which makes a pyramid).<br><br>EDIT: Actually, scratch that. Use trigonometry (which I think would only work for a 90 degree FOV camera):<br><img src="http://img227.imageshack.us/img227/3879/camheight.png"><br>To get the top-view bounding rectangle of the terrain, get the extremity vertices at the Z and X axis (no Y, since this axis is removed in an orthogonal top-view). You need to find out the Height of the triangles formed by the Z or X axis in relation to the camera's FOV slopes (they form a triangle, like the one seen in the image). Finding the height of this triangle is the same as finding the best-fit-height that the camera has to be. If your terrain is not square-sized, then one of them will have a bigger height, and that is the one you should use (if your terrain IS square-size, I presume they will both result in the same height).<br><br>You could spend some time trying to find that out, but I'd go the easy route and in 3DS Max position a camera with the FOV of 90 Degrees (this corresponds to a zoom of 1.0 in Blitz3D) until I've got the best fit on the viewport. Then I'd write down the height of the camera and use that in Blitz3D (or export the scene as a .B3D and set a Dummy in place of the camera, so that is read as a Pivot inside Blitz3D). <br><br></td></tr></table><br>
<a name="1029936"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ClayPigeon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Man, I miss 3DS Max! I used to have it, but then I migrated to a newer computer with XP and Maxis didn't make the drivers for the hardware lock thingies for XP. (that's because I used Max 3!! XD) Also, the exporting and dummy = pivot stuff would be really useful to make realtime cutscenes for games which is another thing I've been trying to figure out.<br><br>And, about the alignment of the camera, sorry, but I'm still a little confused. Why would there be a triangle for orthogonal projection? The only thing that changes when you move the camera on the Y axis is the position of the clipping planes..? <br><br></td></tr></table><br>
<a name="1029942"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's all abstraction, it's just a way to look at the problem.<br><br>The camera has an angle for it's Field of View. We can <i>imagine</i> the frustrum based on this angle:<br><img src="http://img101.imageshack.us/img101/2020/camerafrustrum.png"><br>If you can write down the equation for the problem above, in post <a href="/posts.php?topic=90523#1029848" target="_blank">#16</a>, then you could set the Height of this triangle as the unknown value, and find it out.<br><br>Well, since you mentioned Orthogonal, I guess the height of the camera needs to be the same as the size of the bigger side of the top-view bounding-rectangle of the terrain.<br>Find the bounding-rectangle, get the biggest side of it, center your camera on the terrain, and lift it up until that height. Then point it down. <br><br></td></tr></table><br>
<a name="1029964"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ClayPigeon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Whoops! It appears I have gone all my life thinking orthogonal was just another way of saying orthographic.. Well since I have the camera set to ortho, nothing happens when I move the cam up. It's going to have to be done purely through CameraZoom. The terrain is 512x512, and the camera is 512 above the terrain, and the closest to the perfect CameraZoom I've gotten is 0.01. <br><br></td></tr></table><br>
<a name="1030005"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rroff</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you have a 512x512 unit terrain and a 512x512 pixel camera then you can set the zoom to 1.0/256 to frame it perfectly in an ortho camera mode. <br><br></td></tr></table><br>
<a name="1030010"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ClayPigeon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> Doublewhoops!!! I just realized all my problems were due to thinking my terrain was 512x512. It's actually 256x256 and 1.0/128 is working perfect - thanks.<br>Here's what I've got:<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">AppTitle "Shadow Map on Terrain"
Graphics3D 1024,768,0,1
SetBuffer BackBuffer()
SeedRnd MilliSecs()
;WireFrame True

AmbientLight 255,255,255

;Vars
camyaw% = 0
campitch% = 0
camspeed# = 1

;Timers
TIM_Timer = CreateTimer(60)

;Textures
TEX_SM = CreateTexture(512,512)
ScaleTexture TEX_SM,256,256

;Entities
ENT_Terrain = LoadTerrain("Heightmap.jpg")
EntityColor ENT_Terrain,0,127,0
PositionEntity ENT_Terrain,-128,0,-128
EntityTexture ENT_Terrain,TEX_SM
;For z = 1 To 63
;	For x = 1 To 63
;		ModifyTerrain ENT_Terrain,x,z,Rnd#(0,1),True
;	Next
;Next

ENT_Cube = CreateCube()
PositionEntity ENT_Cube,0,16,0
ScaleEntity ENT_Cube,1,1,16

ENT_Camera = CreateCamera()
CameraClsColor ENT_Camera,127,127,127
PositionEntity ENT_Camera,0,12,-16

ENT_SMCamera = CreateCamera()
CameraClsColor ENT_SMCamera,255,255,255
CameraProjMode ENT_SMCamera,2
CameraViewport ENT_SMCamera,0,0,512,512
CameraZoom ENT_SMCamera,1.0/128
PositionEntity ENT_SMCamera,0,512,0
RotateEntity ENT_SMCamera,90,0,0

;====MAIN LOOP====
While Not KeyHit(1)
	WaitTimer(TIM_Timer)
	
	camyaw = camyaw-MouseXSpeed()
	campitch = campitch+MouseYSpeed()
	MoveMouse GraphicsWidth()/2,GraphicsHeight()/2
	If campitch &lt; -90
		campitch = -90
	EndIf
	If campitch &gt; 90
		campitch = 90
	EndIf
	If camyaw &gt; 360
		camyaw = camyaw-360
	EndIf
	If camyaw &lt; 0
		camyaw = camyaw+360
	EndIf
	RotateEntity ENT_Camera,campitch,camyaw,0
	
	If KeyDown(42)
		camspeed = 2
	Else
		camspeed = 1
	EndIf
	If KeyDown(17)
		MoveEntity ENT_Camera,0,0,camspeed
	EndIf
	If KeyDown(31)
		MoveEntity ENT_Camera,0,0,-camspeed
	EndIf
	If KeyDown(30)
		MoveEntity ENT_Camera,-camspeed,0,0
	EndIf
	If KeyDown(32)
		MoveEntity ENT_Camera,camspeed,0,0
	EndIf
	
	TurnEntity ENT_Cube,3,2,1
	
	UpdateWorld
	
	CameraProjMode ENT_Camera,0:CameraProjMode ENT_SMCamera,2
	AmbientLight 0,0,0
	HideEntity ENT_Terrain
	RenderWorld
	CopyRect 0,0,512,512,0,0,BackBuffer(),TextureBuffer(TEX_SM)
	AmbientLight 255,255,255
	ShowEntity ENT_Terrain
	CameraProjMode ENT_Camera,1:CameraProjMode ENT_SMCamera,0
	
	RenderWorld
	
	Flip
Wend
;====EO MAIN LOOP====

End</textarea><br>It's <b>VERY</b> simple, but it can be modified to be better. What I can't figure out is the coloring thing. To get the shadows to all be black, the only way I could get the entities to be black was to set the ambient light to 0,0,0 and hide the shadow-receiving objects and make the camera's cls color 255,255,255. Is there a better way of doing this??<br><br>EDIT: Also, when an object is lower than the ground it still casts a shadow. I think I could somehow change the terrain during the shadow render  instead of hiding it so that it could obscure the objects that intersect with it.<br><br>ALSO EDIT: I think it would be more efficient to have a small section of terrain that conforms to the ground as it follows the cameraor something  and is transparent, because then I could have the shadow camera follow me above and render a higher quality shadow map for the close objects then do some kind of lower-quality render that doesn't happen every frame for further away objects.<br><br>LAST EDIT (I'M SERIOUS): Basically, what would make my life easier would be how to change a mesh to a solid color TEMPORARILY regardless of the texture on it and be able to return it to its previous state. With this, I could turn all the casting objects white, and the shadow map texture would be a lot easier to render! <br><br></td></tr></table><br>
<a name="1030118"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think, day and night cycle or not, you should use something static, prerendered for static objects, everything else is an overkill. How about to render 12 Lightmaps, then use a texture crossfading every 10 minutes or so. Because, in realtime you won't notice that the sun is animated, it looks static.<br><br>It may be a further challenge to get something like additional, dynamic lights in the scene, like a flashlight or a cars lights. <br><br></td></tr></table><br>
<a name="1030123"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ClayPigeon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> OK, I guess you're right. But, <i>do</i> you know of a way to make a mesh a solid color even if it's textured and be able to change it back to the way it was? <br><br></td></tr></table><br>
<a name="1030143"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> I remember I usually used a white, small texture. Just use GetBrush to store the original brush. Note this will create a new brush that is identic with the one in the loaded mesh, so don't recreate it again and again. <br><br></td></tr></table><br>
<a name="1030152"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >puki</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> Or just get a chuffingly fast CPU and Large-it real-time - that's the option I am taking.  The point being that real-time is just so beautiful - it just really is. <br><br></td></tr></table><br>
<a name="1030165"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can't expect everyone to have a hitech cpu and gfx card. And even then there will always be limits, esp. for outdoor scenes. If I had to do everything in realtime and I had the power do do it, I'd rather use a pixelbased Raytracing, sort of "what is the 3d location of this pixel, and what light can see it." But this is one of those things that works better on optimized customr risc chips than on a CPU with bus and everything.<br><br>I tried it in plain Blitzcode :) I had a very low resolution with a framerate of 1 fps or so. Maybe someone else can do it better. <br><br></td></tr></table><br>
<a name="1030216"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rroff</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> I tried pure blitz3D based raytracing, just for shadowing, no light interactions, caustics, etc. and even using low accuracy and some "hacks" the best performance was 4-5fps at 640x480 (the actual tracing quality was lower but it could be upsampled to 640x480 before you started to really notice the glitches in the sampling.) <br><br></td></tr></table><br>
<a name="1030220"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >puki</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> I wonder how well Xors3D shunts shadows in Blitz3D?  I've never really used it, it certainly does have a lot more jiggery-pokery than FastExtension. <br><br></td></tr></table><br>
<a name="1030228"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> Rroff that's not bad. You should test that on Pukis machine. <br><br></td></tr></table><br>
<a name="1030238"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rroff</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh I forgot to mention... that was on a fast clocked (4GHz) core 2 duo heh... unfortunatly I messed the code up somewhat trying to tweak it even more or I'd share tho its not that interesting. <br><br></td></tr></table><br>
<a name="1030550"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ClayPigeon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> @jfk: That's what I was thinking the other day, conjure up a 1x1 tex with the desired color and add a layer it. <br><br></td></tr></table><br>
<a name="1030726"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#32">[#32]</a></td></tr></table></td></tr><tr ><td class="posttext"> I recall Spellforce (2003)  had some nice environmental and character shadows that woul elongate and fade as the sun moved through the sky and finalyl disappeared when it set. The LOD was quite aggressive, though, so at the (rather short) long-distance, the shadows et al would simply vanish.<br><br><br>That's about all I can contribute, sorry :( <br><br></td></tr></table><br>
<a name="1032019"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Zmatrix</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#33">[#33]</a></td></tr></table></td></tr><tr ><td class="posttext"> problem is that core2duo, only getting half its speed, blitz only uses 1 core  that i can tell...least on a X2 64 , i don't recall ever checking on my 6800 duo when i had it.<br>maybe someone else can check, run in a window and bring up task manager and see if it can get above 50% , <br><br>so at 3.1 ghz per core id be better off with a 3.7ghz single core p4 extreme?<br><br>now back on topic..lol<br><br>its pretty easy to manipulated textures u/v on the terrain<br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=384" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=384</a><br><br>maybe you can combine that with the code above and and generate a map around the player position . The edges would need some kind of falloff,  probably similar to fables shadows they had a smooth falloff at distance, that was a cube map im guessing.<br>but this would allow for sharper shadow maps as they wouldnt have to scale over the entire map.<br>hope that gives you some idea's atleast.<br><br><br>Sam <br><br></td></tr></table><br>
<a name="1032037"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#34">[#34]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> problem is that core2duo, only getting half its speed, blitz only uses 1 core that i can tell <br></div><br><br>You can use the free <a href="http://www.fastlibs.com/index.php" target="_blank">FastPointer</a> library to get multithreading in B3D (although be aware that you have to ensure thread-safety yourself).<br><br><div class="quote"> see if it can get above 50% <br></div><br><br>A high processor-usage statistic is a <i>bad</i> thing. You should be aiming to keep your usage a low as possible, to keep the CPU nice and cool and let the operating system have some time to itself. Since Blitz3D hogs processor time, it'll actually always stay at 50% or 100% or whatever the maximum available to it on your system is, unless you force it to free time with Delay. <br><br></td></tr></table><br>
<a name="1032084"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#35">[#35]</a></td></tr></table></td></tr><tr ><td class="posttext"> ...or WaitTimer(). <br><br></td></tr></table><br>
<a name="1032121"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#36">[#36]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's generally a GOOD thing for applications to be ABLE to use all processing power availablewhen required. Hence why multithreading across cores &gt; single threads only using one core.<br>It pervents slowdowns and bottlenecks if the processor usage is limited and that limit reached.<br>However, Yasha's point is correct, that the allocation of processor time ought to be freed up a little (I find best with a delay of between 1 and 15 milliseconds during each "loop") for the runing of background processees etc. <br><br></td></tr></table><br>
<a name="1032240"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Zmatrix</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#37">[#37]</a></td></tr></table></td></tr><tr ><td class="posttext"> thanks for the clear up Yasha :)<br><br><br><br><div class="quote"> can you tell me what game before Crysis had the feature of environmental dynamic shadows for a moving sun? <br></div><br><br>oblivion,(2006)  but only only some objects , doesnt seem to have a unified lighting system ( you can turn it on in the INI, but it breaks after a few min, like the first few npc's and items you run into will have full shadow mapping casting onto the environment (up to like six seperate dynamic lights), you can put object with holes over the a light and it will cast out correctly  ,,,but eventually it just stops working and nothing has shadows<br><br>and fable, but now that i think about it...while it had a full day night cycle, and the bumpmaps updated  to the sun/moon position, i dont think the shadows moved at all.<br>maybe someone can clarify.<br> <br>Sam <br><br></td></tr></table><br>
<a name="1032631"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rroff</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#38">[#38]</a></td></tr></table></td></tr><tr ><td class="posttext"> For outdoor stuff oblivion just had a projected shadow image that often didn't even match the object supposedly projecting the shadow - i.e. all trees had the same leaf/branches pattern shadow even completely different types of tree. Only the inside sections had proper dynamic lighting and as you say it breaks easily.<br><br>Farcry had a dynamic shadow system to a certain extent with some advanced options you could enable via the console.<br><br>A few racing games prior to Crysis also have dynamic shadows cast by the sun but thats a fairly easy thing to hack up as the player is limited as to where they can go and what angles they can see things from. <br><br></td></tr></table><br>
<a name="1033589"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#39">[#39]</a></td></tr></table></td></tr><tr ><td class="posttext"> 'nother thing someone might try is a static implementation of Shadow Volumes, kinda like <a href="http://devil-engines.dev-ch.de/Frame_Main_DSS.html" target="_blank">the ones Devil's Child has made for Blitz3D</a>.<br>If you could stop the shadow updating and just let them static like that, it shouldn't be much of an overhead to render and would still allow you to slightly move the light-source ocasionally (just to update the shadow's position), or if the system has this feature, to <b>pre-calculate</b> all the positions (the Devils Child's system allows this). <br><br></td></tr></table><br>
<a name="1033666"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rroff</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#40">[#40]</a></td></tr></table></td></tr><tr ><td class="posttext"> Someone wrote a function to create shadow volumes and posted it on here and someone else half implemented  the ability to clip them (purely b3d code) - obviously too slow for realtime useage but would be perfect for pre-computed static stencil shadows. <br><br></td></tr></table><br>
<a name="1033976"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#41">[#41]</a></td></tr></table></td></tr><tr ><td class="posttext"> You know, the shadow volume for a whole environment would be very complex and fill-rate demanding.<br>However, with the appropriate combination of occlusion and PVS techniques, that could be reduced to a very good performance.<br><br>The benefit would be to have your environment cast shadows on the characters and dynamic objects at almost no cost. <br>But special things like trees and picket-fences that use an alpha-blended texture to simulate detail might make things a bit tougher. They would need special, simpler meshes for the volumes, or a shadow-map. <br><br></td></tr></table><br>
<a name="1034235"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#42">[#42]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> But special things like trees and picket-fences that use an alpha-blended texture to simulate detail might make things a bit tougher. They would need special, simpler meshes for the volumes, or a shadow-map. <br><br> <br></div><br>In a way, wouldn't this somwhat defeat the "point" of using alpha'd textures rather than meshes with the holes in? <br>Apart from collision detections I suppose..... <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
