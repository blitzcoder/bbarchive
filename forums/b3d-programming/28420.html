<!DOCTYPE html><html lang="en" ><head ><title >Simple video filter...</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Simple video filter...</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Simple video filter...</a><br><br>
<a name="298862"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >mearrin69</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> ***Code Updated***<br><br>Hi all,<br>I was going to ask if someone had any code laying around that would simulate a grainy video window but I decided 'what the heck' and did it myself. It's not the fastest, smallest, or best but I think it looks pretty darn cool. Anyway, it's good enough for my purposes now but I humbly offer this snippet for any that want to use it/improve it.<br><br>You'll need to include your own image file...just keep it pretty small because this per pixel stuff is slow as Christmas to do.<br><br>Anyway, this is going to be used to overlay a small 3D window to make it look like really crummy web-cam-type video. Think 'Aliens'. Remember those little helmet-cam feeds they were watching in the APC? You'll get the point if you see them.<br><br>Hope someone can use it.<br>Cheers,<br>M<br><br>[CODE]<br>; vidfilter.bb<br>; Experiment to create video-like scanlines and static<br>; by Michael Arrington (mearrin69 on BlitzCoder.com)<br>; michaela@...<br><br>; Set up <br>Graphics 320, 200, 16, 2<br>SetBuffer BackBuffer()<br>AppTitle "Video Filter by Michael Arrington (mearrin69)"<br>SeedRnd MilliSecs()<br><br>; Load and create test images<br>Global imgFeed = LoadImage("camtest2.bmp")<br>Global imgVideo = CreateImage(ImageWidth(imgFeed), ImageHeight(imgFeed))<br><br>; Loop until esc is hit<br>While Not KeyHit(1)<br>	Cls<br><br>; **************************************<br>; Uncomment one to see different effects<br>; **************************************<br>	; -----------------------------------------<br>	; Straight from the feed, no filter effects<br>;	imgVideo = VideoFilter(imgFeed, 1.0, 1.0, 1.0, 0, 0, 0, 0)<br>	; -----------------------------------------<br>	; Just green shift<br>;	imgVideo = VideoFilter(imgFeed, 0.5, 1.0, 0.5, 0, 0, 0, 0)<br>	; -----------------------------------------<br>	; Just scan lines<br>;	imgVideo = VideoFilter(imgFeed, 1.0, 1.0, 1.0, 40, 0, 0, 0)<br>	; -----------------------------------------<br>	; Just some minor static<br>;	imgVideo = VideoFilter(imgFeed, 1.0, 1.0, 1.0, 0, 25, -5, 25)<br>	; -----------------------------------------<br>	; Just major static<br>;	imgVideo = VideoFilter(imgFeed, 1.0, 1.0, 1.0, 0, 75, -25, 75)<br>	; -----------------------------------------<br>	; Light green shift, light scan lines, light static<br>;	imgVideo = VideoFilter(imgFeed, 0.8, 1.0, 0.8, 15, 25, -5, 25)<br>	; -----------------------------------------<br>	; Heavy green shift, heavy scan lines, heavy static<br>	imgVideo = VideoFilter(imgFeed, 0.3, 1.0, 0.3, 40, 75, -25, 75)<br>	; -----------------------------------------<br>	; White out<br>;	imgVideo = VideoFilter(imgFeed, 1.1, 1.1, 1.1, 40, 90, 75, 150)<br>	; -----------------------------------------<br>; **************************************<br><br>	DrawBlock imgVideo, (GraphicsWidth() / 2) - (ImageWidth(imgVideo) / 2), (GraphicsHeight() / 2) - (ImageHeight(imgVideo) / 2)<br>	Flip<br>Wend<br><br>; Exit<br>End<br><br><br>; ====================================================================<br>; VideoFilter(imgIn%, pRGain#, pGGain#, pBGain#, pSLGain%, pSTPct%,<br>;               pSTLow%, pSTHigh%)<br>; ====================================================================<br>; Apply video effects to passed image. Returns image of same size.<br>; ====================================================================<br>; Parameter Descriptions:<br>; imgIn = Image handle - Watch the size, slows way down on large imgs.<br>; pRGain# = Red Gain - Float value controlling red shift. Use &lt;1.0 for<br>;           less red in image, &gt;1.0 for more red in image.<br>; pGGain# = Green Gain - See pRGain<br>; pBGain# = Blue Gain - see pRGain<br>; pSLGain% = Scan Line Gain - Int value controlling boost to every other<br>;           line, simulating video scan lines. This is just additive.<br>; pSTPct% = Static Percentage - Int value from 0 - 100 specifying how<br>;           much of the screen will be covered by static each frame.<br>; pSTLow% = Static Low Gain - Int value specifying the bottom of the <br>;           static gain range. Use negative numbers to get darker static.<br>;           Should be lower than pSTHigh.<br>; pSTHigh% = Static High Gain - Int value specifying the top of the<br>;           static gain range. Higher gives lighter static. Should be<br>;           higher than pSTLow.<br>; ====================================================================<br>Function VideoFilter(imgIn%, pRGain#, pGGain#, pBGain#, pSLGain%, pSTPct%, pSTLow%, pSTHigh%)<br>	; Set up local variables<br>	Local lWidth% = ImageWidth(imgIn), lHeight% = ImageHeight(imgIn), lSrc% = ImageBuffer(imgIn)<br>	Local imgOut% = CreateImage(lWidth, lHeight), lDst% = ImageBuffer(imgOut)<br>	Local lARGB%, lR%, lG%, lB%, lCGain%, lSLGain%, lSTGain%, l<br>	; See if we are doing any color shifting to optimize a bit<br>	If pRGain &lt;&gt; 1.0 Or pGGain &lt;&gt; 1.0 Or pBGain &lt;&gt; 1.0 Then lCGain = 1 Else lCGain = 0<br>	; Set to draw to composite and lock it<br>	SetBuffer lDst<br>	LockBuffer lDst	<br>	; Lock buffer on video feed<br>	LockBuffer lSrc<br>	; Do image processing<br>	lSTGain = 0<br>	; Loop through each row<br>	For lY = 0 To (lHeight - 1)<br>		; Calc scanline color shift, if any, by bumping gain every other line<br>		If pSLGain Then lSLGain = (lY Mod 2) * pSLGain<br>		; Loop through each column<br>		For lX = 0 To (lWidth - 1)<br>			; Do we need to place static? Skip if not<br>			lSTGain = 0<br>			If pStPct Then<br>				; Calc static for this pixel?<br>				If Rand(0, 100) &lt;= pSTPct Then lSTGain = Rand(pSTLow, pSTHigh)<br>			End If<br>			; Precalc static and scan line gain to save a couple mS<br>			lTmp = lSLGain + lSTGain<br>			; Get pixel value<br>			lARGB = ReadPixelFast(lX, lY, lSrc)<br>			; If there's no color gain then we can skip some multiplies<br>			If lCGain Then<br>				lR = (((lARGB Shr 16) And $ff) * pRGain) + lTmp<br>				lG = (((lARGB Shr 8) And $ff) * pGGain) + lTmp<br>				lB = (((lARGB) And $ff) * pBGain) + lTmp<br>			Else<br>				lR = ((lARGB Shr 16) And $ff) + lTmp<br>				lG = ((lARGB Shr 8) And $ff) + lTmp<br>				lB = ((lARGB) And $ff) + lTmp<br>			End If<br>			; Check bounds<br>			If lR &lt; 0 Then lR = 0 Else If lR &gt; 255 Then lR = 255<br>			If lG &lt; 0 Then lG = 0 Else If lG &gt; 255 Then lG = 255<br>			If lB &lt; 0 Then lB = 0 Else If lB &gt; 255 Then lB = 255<br>			; Write the pixel<br>			WritePixelFast lX, lY, (lB Or (lG Shl 8) Or (lR Shl 16) Or ($ff000000))<br>		Next<br>	Next<br>	; Unlock buffers and draw to back buffer again<br>	UnlockBuffer lDst<br>	UnlockBuffer lSrc<br>	SetBuffer BackBuffer()<br>	; Return the image<br>	Return imgOut<br>End Function<br>[/CODE] <br><br></td></tr></table><br>
<a name="298936"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> cool! looks line it's coded pretty optimized. other than the imagebuffer() call which could be precalculated to a variable I don't see any optimation options atm. - oh  yes, precalc lWidht-1 and lHeight-1 in the For-commands. But it's peanuts. <br><br></td></tr></table><br>
<a name="298970"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >mearrin69</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey thanks. BTW, I didn't even think about pre-calcing the imagebuffer() call. That might indeed save a few mS, especially on large images, since it's in the inner loop. Thanks for the tip.<br>M<br><br><br>[edit]Heh, guess you inspired me. I took your advice on pre-calcing the ImageBuffer() call - it made a noticeable savings. I also tightened up a few other areas. If you're not doing color shifting, or static, or scanlines then you save a few mS on each call. I need all three effects so I hadn't thought about making them optional.[/edit] <br><br></td></tr></table><br>
<a name="299128"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gpete</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I haven't tried your code yet....but this is what I use to make rain or scanlines.... (excerpt from my program-"Nautilus") -&gt;<br><br>rain=CreateCube(camera)<br>EntityParent rain,camera<br>raintex=LoadTexture("scanl.png")  ;or rain.png bitmap<br>ScaleEntity rain,.1,10,10<br>ScaleTexture raintex,.2,.2<br>EntityAlpha rain,.7    ;or set texture to mask ie. "2"<br>EntityTexture rain,raintex<br>TurnEntity rain,0,90,0<br>PositionEntity rain,0,0,2   ;in front of camera<br><br>set rainpos=0.0 before Main loop, then after UpdateWorld in prog:   -&gt;<br><br>PositionTexture raintex,0,rainpos  ;rotates texture!!!<br>rainpos=rainpos+.1<br><br>So simple, and yet so cool!<br><br>gpete <br><br></td></tr></table><br>
<a name="300033"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >mearrin69</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Whoops. There was an error in the code above...fixed now. I switched around the x and y loops to optimize on drawing scanline gain but forgot to change the loop end conditions. Didn't show itself until I tried a non-square window. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
