<!DOCTYPE html><html lang="en" ><head ><title >many objects in one level/zones?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >many objects in one level/zones?</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >many objects in one level/zones?</a><br><br>
<a name="752178"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >b32</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> What methods are recommended for using many objects in one level ? I tried several methods allready: collapsing everything into one object with AddMesh and using CopyEntity instead of loading the same mesh over and over again. <br><br>I remember a code in the archives that stores only the object's coordinates and creates new meshes 'on the fly' when the camera gets in a certain range. Unf. I cannot find it anymore. But would that be a better method?<br><br>Here and there I've heard the term 'zones' in this context. What are zones ? Are they 'clusters' of meshes that are hidden/showed when the camera gets near ? What is the idea behind that ?<br>Thanks for any suggestions. <br><br></td></tr></table><br>
<a name="752198"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Naughty Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> ..maybe this can help..<br><br><br>; Definit le Frustum <br>Global p1x,p1y <br>Global p2x,p2y <br><br>; Enfants du Quadtree <br>Const CHILD00 = 0 <br>Const CHILD01 = 1 <br>Const CHILD11 = 2 <br>Const CHILD10 = 3 <br><br>; CAMERA <br>Type CAMERA <br>  Field x,y      ; Position de la camera <br>  Field fov      ; Angle de vue <br>End Type <br><br>; creation d'une camera <br>Function Camera.CAMERA(x,y,fov) <br>  this.CAMERA = New CAMERA <br>  this\x = x : this\y = y : this\fov = fov <br>  Return this <br>End Function <br><br>; Renvoie True si un point est dans le plan Left du Frustum <br>Function PointInFrustumL(this.CAMERA,x,y) <br>  Return ( -(x - this\x) * (p1y - this\y) + (y - this\y) * (p1x - this\x) &gt;= 0) <br>End Function <br><br>; Renvoie True si un point est dans le plan Right du Frustum <br>Function PointInFrustumR(this.CAMERA,x,y) <br>  Return ( -(x - this\x) * (p2y - this\y) + (y - this\y) * (p2x - this\x) &lt;= 0) <br>End Function <br><br>; Renvoie True si un point est dans le plan Front du Frustum (pas utilisé ici) <br>Function PointInFrustumF(this.CAMERA,x,y) <br>  Return ( -(x - this\x) * (p3y - this\y) + (y - this\y) * (p3x - this\x) &gt;= 0) <br>End Function <br><br>; QUADTREE <br>Type QUADTREE <br>  Field Child.QUADTREE[3]  ; Les 4 enfants du quadtree <br>  Field xmin,ymin      ; Coordonnées du sommet haut gauche <br>  Field xmax,ymax    ; Coordonnées du sommet bas droite <br>End Type <br><br>; Creation d'un quadtree de profondeur depth <br>; et associé à un carré de cotés xmax-xmin, ymax-ymin <br>Function Quadtree.QUADTREE(xmin,ymin,xmax,ymax,depth) <br>  this.QUADTREE = New QUADTREE <br>  this\xmin = xmin <br>  this\xmax = xmax <br>  this\ymin = ymin <br>  this\ymax = ymax <br><br>  If (depth &gt; 0) <br>    ; On crée 4 enfants <br>    xmoy = (xmin+xmax) / 2 <br>    ymoy = (ymin+ymax) / 2 <br>    depth = depth - 1 <br>    this\Child[CHILD00] = Quadtree(xmin,ymin,xmoy,ymoy,depth) ; Haut gauche <br>    this\Child[CHILD01] = Quadtree(xmin,ymoy,xmoy,ymax,depth) ; Bas gauche <br>    this\Child[CHILD11] = Quadtree(xmoy,ymoy,xmax,ymax,depth) ; Bas droite <br>    this\Child[CHILD10] = Quadtree(xmoy,ymin,xmax,ymoy,depth) ; Haut droite <br>  EndIf <br>  Return this <br>End Function <br><br>; On teste si un des 4 sommets du carré associé au quadtree <br>; est visible par la camera <br>Function QuadInFrustum(this.QUADTREE,cam.CAMERA) <br>  Local nbPlansInterieur <br><br>  ; Plan de gauche <br>  nbPlansInterieur = 0 <br>  nbPlansInterieur = nbPlansInterieur + PointInFrustumL(cam,this\xmin,this\ymin) <br>  nbPlansInterieur = nbPlansInterieur + PointInFrustumL(cam,this\xmin,this\ymax) <br>  nbPlansInterieur = nbPlansInterieur + PointInFrustumL(cam,this\xmax,this\ymin) <br>  nbPlansInterieur = nbPlansInterieur + PointInFrustumL(cam,this\xmax,this\ymax) <br>  If nbPlansInterieur = 0 Return False <br><br>  ; Plan de droite <br>  nbPlansInterieur = 0 <br>  nbPlansInterieur = nbPlansInterieur + PointInFrustumR(cam,this\xmin,this\ymin) <br>  nbPlansInterieur = nbPlansInterieur + PointInFrustumR(cam,this\xmin,this\ymax) <br>  nbPlansInterieur = nbPlansInterieur + PointInFrustumR(cam,this\xmax,this\ymin) <br>  nbPlansInterieur = nbPlansInterieur + PointInFrustumR(cam,this\xmax,this\ymax) <br>  If nbPlansInterieur = 0 Return False <br><br>  Return True <br>End Function <br><br>; Rendu du Quadtree <br>Function RenderQuadtree(this.QUADTREE,cam.CAMERA,depth) <br>  If QuadInFrustum(this,cam) <br>    If (depth &gt; 1) <br>      Color 128,128,128 <br>      Line (this\xmin+this\xmax)/2,this\ymin,(this\xmin+this\xmax)/2,this\ymax <br>      Line this\xmin,(this\ymin+this\ymax)/2,this\xmax,(this\ymin+this\ymax)/2 <br>      <br>      depth = depth - 1 <br>      <br>      RenderQuadtree(this\Child[CHILD00],cam,depth) <br>      RenderQuadtree(this\Child[CHILD01],cam,depth) <br>      RenderQuadtree(this\Child[CHILD11],cam,depth) <br>      RenderQuadtree(this\Child[CHILD10],cam,depth) <br>    Else <br>      Color 196,196,196 <br>      Rect this\xmin+1,this\ymin+1,this\xmax-this\xmin-1,this\ymax-this\ymin-1,True <br>    EndIf <br>  EndIf <br>End Function <br><br>;============================================================================================== <br>; EXAMPLE <br>;============================================================================================== <br><br>AppTitle "Simple Quadtree Demo - Seyhajin" <br>Graphics 512,512,0,2 <br>SetBuffer BackBuffer() <br><br>; Variables de configuration <br>QuadDepth = 7        ; Profondeur du quadtree (nb de fois qu'on decoupe le plan) <br>QuadSize = 512        ; Taille initiale du quadtree <br>CamSpeed# = 2      ; Vitesse de deplacement de la camera <br>CamFOV# = 60.0 / 2.0    ; Angle de vue de la camera (default = 90) <br>ViewLine = 300        ; Taille de la ligne des plans <br><br>; Creation de la camera <br>cam.CAMERA = Camera(QuadSize/2,QuadSize/2,CamFOV) <br>; Creation du Quadtree principale <br>root.QUADTREE = Quadtree(0,0,QuadSize,QuadSize,QuadDepth) <br><br>;---------------------------------- <br>; BOUCLE PRINCIPALE <br>;---------------------------------- <br>While Not KeyHit(1) <br>  Cls <br><br>  ; Update Camera position <br>  If KeyDown(200) ; Up <br>    cam\y = cam\y - CamSpeed# <br>  ElseIf KeyDown(208) ; Down <br>    cam\y = cam\y + CamSpeed# <br>  EndIf <br>  If KeyDown(203) ; Left <br>    cam\x = cam\x - CamSpeed# <br>  ElseIf KeyDown(205) ; Right <br>    cam\x = cam\x + CamSpeed# <br>  EndIf <br><br>  ; Rendu du quadtree <br>  Color 255,255,255 <br>  Rect root\xmin,root\ymin,root\xmax,root\ymax,1 <br>  RenderQuadtree(root,cam,QuadDepth) <br>  <br><br>  ; Dessine la pyramide de vue (Frustum) <br>  x# = MouseX() - cam\x <br>  y# = MouseY() - cam\y <br>  angle# = 180+ATan2(-y#,-x#) <br>  Color 255,255,0 <br>  Line cam\x,cam\y,cam\x+(ViewLine/2)*Cos(angle#),cam\y+(ViewLine/2)*Sin(angle#) <br>  Color 255,0,0 <br>  ; Plan gauche <br>  p1x = cam\x+ViewLine*Cos(angle#-CamFOV) <br>  p1y = cam\y+ViewLine*Sin(angle#-CamFOV) <br>  Line cam\x,cam\y,p1x,p1y <br>  ; Plan droit <br>  p2x = cam\x+ViewLine*Cos(angle#+CamFOV) <br>  p2y = cam\y+ViewLine*Sin(angle#+CamFOV) <br>  Line cam\x,cam\y,p2x,p2y <br>  ; Dessine la camera <br>  Color 0,0,255 <br>  Oval cam\x-3,cam\y-3,6,6,True <br><br>  Flip <br>Wend <br><br>Delete Each CAMERA <br>Delete Each QUADTREE <br><br></td></tr></table><br>
<a name="752237"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >b32</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the example. In a way, I understand what it does. But should I hide entites that are not in view? <br><br></td></tr></table><br>
<a name="752243"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wings</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> use<br>Entity Auto Fade <br><br></td></tr></table><br>
<a name="752246"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> But should I hide entites that are not in view? <br></div><br><br><div class="quote"> use<br>Entity Auto Fade <br></div>o_O<br><br>Don't do anything.  Blitz automatically doesn't render stuff that isn't in view. <br><br></td></tr></table><br>
<a name="752269"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Some infos:<br><br>Blitz can only "hide" things that are (A) behind the camera or (B) out of the camera range IF they are individual entities. This means, if you have a big level that is loaded as one mesh and has say 20k triangles, then Blitz will always render 20k Triangles, no matter if you only watch a single wall or have a very low camera range. <br><br>So it may be important to cut the level in pieces.  (See ClusterizeMesh in the archives)<br><br>While the fragmentation of a big level mesh may feel a little tricky, additional meshes in the scene will be hidden automaticly and efficiently, as long as they don't cover wide areas. Example: trees: not every tree should be an entity, nor should you add all trees to a single mesh. The golden middle way would be to add groups of trees to a grid of meshes using a polycount that makes sense.<br><br>If it's an indoor level then it's even easier, make sure the various level places are connected by fairly long tunnel systems, so you'll never render more than one place.<br><br>There are more systems to cull things and "optimize" the speed. VIS-Zones is one. BSP VIS Occlusion and more. A lot of people tried many things and there's a good chance that if you implement one of these complicated culling techniques then it will be slower than the unculled counterpart at the end of the day, so KISS, keep it simple.<br><br>If you use fragmentation and a low camera range then the speed is ok. All you have to do is to design the level with a low camerarange in mind. <br><br></td></tr></table><br>
<a name="752293"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >b32</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks a lot <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
