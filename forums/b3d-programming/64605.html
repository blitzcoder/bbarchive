<!DOCTYPE html><html lang="en" ><head ><title >Netcode - How to design</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Netcode - How to design</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Netcode - How to design</a><br><br>
<a name="721191"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AJirenius</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, I've never tried coding any netcode before but I figure my current project would be a perfect start to get experience.<br>Still I just don't want to jump into it unless i'm certain that I do have a good design of my game so I know it's optimized for netcoding so here comes a few questions to those who might have more experience than me in this area:<br><br>Gamedescription: Two players fight each other on a small fully visible arena. They control one unit each and the unit will probably have up to 3 bullets on screen at the same time. The player can before match choose from 10 different units so the steering, movements, weapons and their behaviour is very different.<br>There are also obstacles on the battlearena (animated walls going up/down)<br><br>Question #1: What kind of information should I send back and fourth? Is it simply position and rotation of the units/bullets? May I instead send over just controldata (mouse and keyboardpresses) and let both computers calculate it?<br><br>Question #2: Who does the calculation? Will both the computers do collisionchecks or just the server? How do I transfer this correctly? What about velocities, damage etc?<br><br>Question #3: Do you have any good tutorials or sourcecode where a similar game is setup so I can get any ideas? <br><br></td></tr></table><br>
<a name="721296"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> It realy depends on if you want to play this over LAN only, or if it has to work over the web. Let me tell you, playing such a thing over the Web is pretty hard. Especially the moving walls make it hard to sync things correctly, and fairly.<br><br>Maybe you'll have to use a mandatory Lag on the controls of all players, to be able to snyc things correctly. Because the web connection may take 200 millisecs or more. Dead Rekoning etc. as it is used for FPS games is not very usable here.<br><br>So a LAN game would be much easier.<br><br>There are several models. The most fair one is: one computer calcualtes everything, and the other computers only display things. This forces the mentioned LAG. At least, every player will see the things that are really counting.<br><br>Whatever you gonna do, make sure nobody can cheat. For this you can send a checksum with every packet, that was made using a secret algorithm. The client will then use the paket only if the checksum is correct.<br><br>There are several Network examples, in the archives as well as in the toolbox. They may work fine for you. MAybe you should use BPlay Lite from SurReal, that's free and open source. RakNEt uses an external DLL and allows a seperate thread for tcp calls during the came, so it won't pause (see userlib forum). <br><br></td></tr></table><br>
<a name="721305"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AJirenius</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> This will be a webonline-game only. It will all be connected via a lobbyserver that let players meet together and challenge each other. The lobbyserver will also contain lots of statistics and rankingsystems over all players.<br>When a challenge is made and accepted the both players will be connected to each other (the challengercomputer will act as server in game)<br><br>I've been studyin hard now (and as i can see it it will probably need lots of more studying) and this is some things that I was thinking about:<br><br>I actually think extrapolation (and interpolation) is the way I must use with most units but i guess I probably will have to do one net-method for each unit (as they move very differently.<br>Harder than I even expected.<br><br>I am also thinking about each computer (both the server and the client) will calculate their own collisions and damage due to what happens on THEIR computer. They will also then send data about their own unit, it's position, rotation and gunstate.<br><br>The only thing that server will control is the animated walls (will just send a moveup or movedown command to the client). Rest of the collisiondetection against wall is made by each computer.<br><br>What will be the big flaws in this way of facing the netcode? <br><br></td></tr></table><br>
<a name="721452"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Even if you send the moveup/down commands from the server, there will be a lag, and it will be diffrent on each machine. It will be hard to sync things. One player may think he didn't collide, where he collided on the other players machine.<br><br>Interpolation will be needed anyway, you can't sent a packet every frame (= 17ms), more reasonable would be somthing like 200 ms.<br><br>If you find a good way to integrate a static Lag into the game concept then you might simplify the whole thing the way I suggested before. Sorry, I have no better Idea.<br><br>Even in FPS MP syncing is a completely unexact science. <br><br></td></tr></table><br>
<a name="721497"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rroff</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> with UDP you should have no problem sending game updates every 17ms or whatever...<br><br>The clients need to be able to change their view point and do a certain amount of movement independant of the server - with the server correcting that movement via updates - which is where client side prediction becomes important - if you were to send every mouse move and key press to the server and wait for the server to respond you'd get very jerky movement. <br><br></td></tr></table><br>
<a name="721514"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Regular K</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Something to consider is to take "screenshots" every 100 ms (a tick) and use those for references. So you can actually tell when the player *tried* to move according to their client, etc. And for the server, send the tick when a player is moving so the client can figure out "oh, they actually moved 300 ms ago, I should interpolate 300ms - 399ms into the future..." kind of thing. <br><br></td></tr></table><br>
<a name="721542"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> call it "interpolate into the future", or "dead reckoning" it will however always be a vague guess of what's going to be.<br><br>In a game concept that is based on quick reaction (eg. Ping-Pong) this can be fatal. Especially when the update frequence is higher than say every 100 ms.<br><br>I still don't believe you can use a frequence of only 17 ms for the following reason:<br><br>Data is transmitted trough cables, or trough the air by radio. Both use the speed of light for the transmission. Even if there is only one totally clean cable from EG. New York to Hong Kong, the distance is about 20 thousand kilometers. Since the speed of light is about 300 thousand km/s, it will take a min of 67 millisecs. In the real world there are lots of hubs, routers, gateways etc. that will delay it even more. A ping of about 200ms is realistic.<br><br>So I don't see the sense of sending packets every 17 ms. Although the connection Lag doesn't have to affect the update frequency in theory, I guess this would end in buffer overflows and chaos etc.<br><br>Please correct me if I'm wrong.<br><br>(you may also consider there may be machines that will run with less than 60 frames per second) <br><br></td></tr></table><br>
<a name="721562"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AJirenius</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I for sure know that 17ms totally impossible to achieve as you must make the game so mostly everyone can play it from around the world. Yes maybe if you are playing with people within your own region but not half around the world. It's at the moment physically impossible.<br><br>Now, then again if such reactionbased game as UT200*** can make great (at least what it looks like) lagfree environment with let's say 8 people online (extra and interpolating all bullets and people) I think I could do that to at least playable level with 2 units.<br><br>Still I know it's a hard task and using UDP I will start up with no interpolation at all and then start working my way back to some kind of smoothness in game. <br><br>If we take Ping-Pong as an example, remember that the ball is very easy to predict it's course and you are updating your own paddle (and collisions) on your own machine giving no lag whatsoever. The only thing that you might find jerky is the other players paddle which in one way doesnt impact your gameplay.<br><br>Now this is the 4 main different movements that can be used in the game I'm creating:<br><br>Car-style: Meaning you accelerate with up, steer with left,right and reverse with down. Also you cannot rotate unit unless you do have some kind of speed. There is no skid whatsoever so when rotating it is kind of easy to somewhat predict where it will go (unless player does something else of course)<br><br>Teleport: Now this is plain simple as the unit are not moving at all but teleporting to different places. No comments.<br><br>8-ways: Press up and the unit goes up, down it goes down etc. This one is the trickiest to predict as the unit can instantly change 180 without slowing in or rotating (well it does rotate but that does not impact the movement)<br>Here it will be small interpolating with maybe lots of extrapolating)<br><br>Floating: Just like Car-style except that it does contain lots of skid (like it's hovering over ground). So one vector for current movement and another one for thrust.<br>This one may be tricky as well. Lots of interpolating and some extrapolating. <br><br></td></tr></table><br>
<a name="721623"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> 17ms is extremely low *although* I did get out racer demo running on one update per frame (though in MP it ran at 30fps, around 34ms.) Thats a pretty impressive feat and we did test it quite playable with one player in the UK and the other over near California... <br><br></td></tr></table><br>
<a name="721729"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is good to hear. What was the ping? I think we can say:<br>Lag=Ping/2.0, right?<br><br>How did you handle the lag? prediction? Or did you simply ignore it and accept some inaccuracy in the synchronisation of events? <br><br></td></tr></table><br>
<a name="721743"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rroff</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> "So I don't see the sense of sending packets every 17 ms. Although the connection Lag doesn't have to affect the update frequency in theory, I guess this would end in buffer overflows and chaos etc."<br><br>The last bit is what I was trying to say the connection lag doesn't prevent you running a high update frequency - and it doesn't result in buffer overflows as the client is generally a fairly constant delay off the server and you just send the latest snapshot when they are ready - one of the important things is to make the network code work independantly of the renderer or you will get a lot of weird stuff happening and clients being able to use higher/lower fps to give themselves an unfair advantage. <br><br></td></tr></table><br>
<a name="721779"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah, maybe I was wrong. I usually test my client/server code on one desktop, and there you better use a delay of say 200ms when there are multiple 3D windows open.<br><br>But I totally agree, the framerate should not be connected with the net packet handler. Using a poll system may allow this even in plain blitz (without seperate dll threads). <br><br></td></tr></table><br>
<a name="721987"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wings</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Counter strike source is mine favorite.<br>but it aint fun to have 200ms to Server.. that i can tell you :)<br>in fact as soon as 50ms its realy crappy. <br><br></td></tr></table><br>
<a name="723861"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Subirenihil</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> My only suggest (no, it doesn't answer any of your questions) is that you <b>DO NOT</b> make your players type in any IP information.  It is a hassle that detracts from gameplay and also gives a "unprofessional" feel to your game.  I have seen it all too many times with the multiplayer games around here; most require that you type in the IP address of the host.  It is a really annoying issue that doesn't have to be there.<br><br>Here is an example of how this can be done.  Feel free to use any of the code.<br><br><a href="/codearcs.php?code=1821" target="_blank">TCP/IP Network - WITHOUT typing IP's</a> <br><br></td></tr></table><br>
<a name="723866"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> This Lib of Krylar - didn't you say it's using DX9, does that mean it wont work with Blitz3D?<br><br>I used to write however something similar too, although in plain Blitz3D. A PHP script is using a mysql database to store the active games. When the game host is calling the webserver for some reason, it usually takes several seconds until the handshake is complete, that's why a lot of people are using external DLLs to do that, that are running as a parallel thread in the background. A simple solution for blitz is not to wait for the answer, but read the webservers answer at a later state using a polling solution for incoming data (that needs an identifier, of course)<br><br>And there's also Gnet: <a href="http://www.blitzbasic.com/toolbox/toolbox.php?tool=61" target="_blank">http://www.blitzbasic.com/toolbox/toolbox.php?tool=61</a> , that's what it was made for! <br><br></td></tr></table><br>
<a name="725416"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Subirenihil</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> It works fine with Blitz - try my <a href="/codearcs.php?code=1821" target="_blank"> code</a>.  You just have to have DX9 installed on your computer (go to the microsoft website and you can probly find a free download.  Any of the more recent store-bought games will likely have it as well. <br><br></td></tr></table><br>
<a name="725438"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks. I have DX9 already installed. <br><br></td></tr></table><br>
<a name="725497"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Subirenihil</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> No problem.  You may use the code all you want.  I just don't want anybody else to spend more than a week trying to find a way to join a multiplayer game WITHOUT typing in a stupid IP address.<br><br>Yes, it took me nearly two weeks with the help of Kevin8084 to find a way to do this. <br><br></td></tr></table><br>
<a name="726046"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nmuta</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> You may also want to contact RifRaf (from empowergames.com)... he is good at this type of stuff <br><br></td></tr></table><br>
<a name="726893"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Buggy</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> But doesn't the K-Lib thing only work on a LAN? Not across the world?  I suppose searching every computer everywhere would be too much... <br><br></td></tr></table><br>
<a name="726908"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rroff</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> There is no getting around using IP addresses to connect to network games on the internet... even if its just your mate on the same ISP, he could run a dynamic DNS host but you'd still have to type that in...<br><br>The best I've seen so far is battle.net but that requires the developer/publisher to tie up some signifcant hardware costs. <br><br></td></tr></table><br>
<a name="726980"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Subirenihil</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> For online games, yes, either you type in an IP address or the developer sets up a server. (ex. Blizzard set up battle.net)<br>For a small online game, try GNet. (I personally don't know much about it, except that it is hosted right here on blitzbasic.com)<br><br>But <b>PLEASE!!!</b> don't make the players have to type in IP addresses for LAN games. <br><br></td></tr></table><br>
<a name="727081"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Buggy</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> What about having a website that somehow stores the number of online hosts and their IPs, for games that are hosted on players' computers?  Can PHP do that? <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
