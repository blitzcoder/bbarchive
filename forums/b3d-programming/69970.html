<!DOCTYPE html><html lang="en" ><head ><title >memory leak?  Weirdness, slowdown...</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >memory leak?  Weirdness, slowdown...</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >memory leak?  Weirdness, slowdown...</a><br><br>
<a name="783121"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_33</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>I've spent lots of time figuring out a good terminal system for my game.  But I sort of found lately a memory leak.  Seems every time I send a page clear, the framerates go down... (!)  So I figured, maybe my code contains a leak.  So I copy/pasted it here so I could get a visu idea of wether this is good practice coding or not.<br><br><pre class=code>Function clear_term_screen(page_num% = 9, chars% = 1, colors% = 1, attrs% = 1, fonts% = 1)
   If page_num = 9 Then page_num = term\current_page
   term\page[page_num]\cursor_col      = 0
   term\page[page_num]\cursor_row      = 0
   Local disp_end% = term\page[page_num]\cols * term\page[page_num]\rows - 4
   Local t_color_clear% = term\page[page_num]\cls_t_color Shl 24 + term\page[page_num]\cls_t_color Shl 16 + term\page[page_num]\cls_t_color Shl 8 + term\page[page_num]\cls_t_color
   Local b_color_clear% = term\page[page_num]\cls_b_color Shl 24 + term\page[page_num]\cls_b_color Shl 16 + term\page[page_num]\cls_b_color Shl 8 + term\page[page_num]\cls_b_color
   Local char_clear% = term\page[page_num]\cls_char Shl 24 + term\page[page_num]\cls_char Shl 16 + term\page[page_num]\cls_char Shl 8 + term\page[page_num]\cls_char
   Local attr_clear% = term\page[page_num]\cls_attr Shl 24 + term\page[page_num]\cls_attr Shl 16 + term\page[page_num]\cls_attr Shl 8 + term\page[page_num]\cls_attr
   Local font_clear% = term\page[page_num]\cls_font Shl 24 + term\page[page_num]\cls_font Shl 16 + term\page[page_num]\cls_font Shl 8 + term\page[page_num]\cls_font
   For disp% = 0 To disp_end Step 4
      If colors Then PokeInt term\page[page_num]\t_color_table, disp, t_color_clear ;text color palette id's
      If colors Then PokeInt term\page[page_num]\b_color_table, disp, b_color_clear ;background color palette id's
      If chars Then  PokeInt term\page[page_num]\text_table, disp, char_clear ;text
      If attrs Then  PokeInt term\page[page_num]\attr_table, disp, attr_clear ;character attributes
      If fonts Then  PokeInt term\page[page_num]\font_table, disp, font_clear ;font id's and sizes
   Next
End Function</pre><br><br>These tables, are initialized as follows:<br><pre class=code>   term\page[page_num]\text_table        = CreateBank(term\page[page_num]\cols * term\page[page_num]\rows)
   term\page[page_num]\t_color_table     = CreateBank(term\page[page_num]\cols * term\page[page_num]\rows)
   term\page[page_num]\b_color_table     = CreateBank(term\page[page_num]\cols * term\page[page_num]\rows)
   term\page[page_num]\attr_table        = CreateBank(term\page[page_num]\cols * term\page[page_num]\rows)
   term\page[page_num]\font_table        = CreateBank(term\page[page_num]\cols * term\page[page_num]\rows)</pre><br><br>Any hint appreciated.<br><br>BTW, what happens is, when I start the terminal, I get decent 750+ fps.  The first clear I do (cls command in console calls this function), as all of them, will blank the page nicely.  Yet, the framerates go down.  Every clear page I do drops the fps by 50, up to a point where I get around 400 fps, and then it stops dropping fps!  So I'm rather intrigued on how this could be possible.  There are no fancy tricks as to wether I change pages, or change some pointer/size values.  It's just a simple and clean bank init routine really. <br><br></td></tr></table><br>
<a name="783126"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Not easy to spot. Try to isolate it further. <br><br></td></tr></table><br>
<a name="783134"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_33</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I tought maybe it was in the usage of the bit shifting, or maybe in the PokeInt, or usage of Int defined variables with PokeInt.  These can corrupt memory easily.<br><br>It could be somewhere else thoe.  But I was confused and posted this here to make sure I'm not off track with the code. <br><br></td></tr></table><br>
<a name="783184"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> There is another potential thing that could cause the slow down: Massive amount of data and just not enough RAM to hold it ... (or too many type instances created but without any exact numbers on that, its hard to say ...) <br><br></td></tr></table><br>
<a name="783196"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_33</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm not creating more pages all the time.  There are 5 layer of, say 80x60 characters (80 cols, by 60 rows).  That's equal to 4800 bytes per layer, meaning 4800*5 = 24K bytes.  There's say 8 pages of those, that means 24K * 8 = 192K.  So, yea, if I had a Commodore 64 then I'd be in trouble, but I have 2 gigs of ram :P<br><br>It's not massive amount of data, and it's not a lot of ram usage.  When I quick check the ram from the console, I still have 1.3 gigs free, plus I use TaskInfo to report the ram.  It's definately not anything of that nature.<br><br>It's possible the problem is not in this particular piece of code.  I'm just double checking with my fellow coders to see if I have missed something.<br><br>EDIT:  OK, I found the problem.  It has absolutely no relation with memory leaks or whatnot.  Happy!  It was another problem I have with things that don't show up on screen but take processor time, and that ti should show up.  It's something else I have to fix.<br><br>Cheers. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
