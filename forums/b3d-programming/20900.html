<!DOCTYPE html><html lang="en" ><head ><title >Terrain Texture Splatting???</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Terrain Texture Splatting???</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Terrain Texture Splatting???</a><br><br>
<a name="214327"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >makakoman</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Has anyone read about or understand 'texture splatting'?<br><br><a href="http://www.cbloom.com/3d/techdocs/splatting.txt" target="_blank">http://www.cbloom.com/3d/techdocs/splatting.txt</a><br><br>Specifically, how it works with terrains.  I have read several articles (none with example code :( ), but cannot get a grasp on how this would work with Blitz.  It sounds like they are making multiple render passes, maybe 1 pass for each unique texture using alpha masks to leave transparency where the texture does not belong.  But then, wouldn't you need to build the alpha masks on the fly in real time???  Also, it seems you would need a separate camera for your terrain so as not to render everything else every frame.  Can this work in Blitz??<br><br>Thanks,<br>MK <br><br></td></tr></table><br>
<a name="214335"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> With the advent of vertex alpha support in Blitz, there is no need to create alpha maps on the fly.  You can render it the right way.<br><br>And no, it doesn't require multiple passes... well not many.<br><br>What you need to do is render your sky and terrain in one pass, and then your level entites in a second pass.<br><br>Then, for your each triangle on your terrain where you want one texture to blend into another, you simply add two or more triangles to the terrain which exactly overlap, with the first one being opaque, and the ones to be layered on top of it being added in the order you want them drawn, and with the appropriate vertex alphas.<br><br>This works because Blitz draws the triangles in the mesh in the order in which they are added to the mesh.  If you want, you could even just stick all the first pass triangles in the mesh first and then add all the second or third pass triangles to the end, but you can intermix them if you want as long as each individual set of triangles is added in the right order.<br><br>And no you don't need more than one camera.  All you need to do is do a hideentity and showentity for every object in your level every frame... Which mark optimized a ton not too long alog making hiding and showing just about as fast as setting a variable to true or false.<br><br>Of course to do this you need to keep a list of your entities, but you should be doing that anyway because that is  the best and cleanest way to do things. <br><br></td></tr></table><br>
<a name="214337"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh and btw, this is for terrains you make yourself out of meshes, not for Blitz terrains.  There's no way to do vertex alpha effects witht he built in terrains.  Those terrains are really slow anyhow.  My terrain system for example 2-5x as fast, with 5x as much detail, and you can tile textures on it and rotate them.  Now that vertex alpha is in perhaps it's time for a re-write to get rid of that cracking issue and support texture splatting instead of tiling textures which requires really high res textures to get a good level of detail and as a result also limits how fast the terrain can go because of the actual number of tiles I have to make the terrain out of. <br><br></td></tr></table><br>
<a name="214351"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >makakoman</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the reply Shawn.  I understand what you are saying, but a couple of questions.<br><br>I thought I read there is a problem with z-order with vertex alpha.  Are you saying that by adding the triangles in the right order, this is avoided?<br><br>Couldn't this approach double or more your poly count?  <br><br>Also, I just realized, this probably requires unwelded verts, right?<br><br>Thanks,<br>MK <br><br></td></tr></table><br>
<a name="214395"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jhocking</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't know much about the whole vertex alpha thing but the recent addition of support for the second UV set in Ultimate Unwrap adds a lot of possibilities as far as texturing terrain.  As soon as I clear off some of the tasks on my plate right now I will be writing a tutorial for Ultimate Unwrap in which I use the 2nd UV set to texture terrain.  The gist is all about multiple texture layers: a main non-tiled texture for color, a tiled detail texture over that, and then a third layer with alpha transparency placed using the 2nd set of UV coordinates. <br><br></td></tr></table><br>
<a name="214409"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ratboy</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> We experimented with that on Mechcommander 2, then to a variation of that technique that saved out a custom texture library for each level (major cd-space hog mode) then went to a single giant (1536 x 1536)hand-painted land jpeg (divided into 256x256 textures at runtime) plus a small tiled detail texture. While it was fuzzier, it saved a huge wad of texture space for more important things.<br><br>It's a great system if you use a lot of randomly generated terrain, but the draw overhead is pretty fierce. <br><br></td></tr></table><br>
<a name="214442"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> "Couldn't this approach double or more your poly count?"<br><br>It could, but you can make large areas with just one texture, and thus one layer and then only make a thin border between them as a transition area and then it would only increase poly count of 10% or so.<br><br><br>"Also, I just realized, this probably requires unwelded verts, right?"<br><br>It requires one surface per texture, per entity, so if your terrain is divided into tiles that ar 10 meters across, and one has two textures on it, it will need two surfaces.<br><br>As for unwelded vertices, I'm not sure what you mean exactly by that.  If you mean that you intend to store all the textures as part of one big texture and tile them by having unwelded edges on every tri/quad, then I would edvise against that.<br><br>I wasn't thinking about the seprate textures thing before.  What you need to do is have at least one surface per texture per entity which the terrain is made up of, but each entity only needs surfaces for those specific textures it uses.  So usually that means each entity would have two surfaces, though it may go as high as three or four surfaces.<br><br>I suppose since the major cost is surfaces and not entities that this reduces my prediction for the amount of savings I would get over my current method, but I think that I could probavbly still save at least 2x if not 6x the surfaces with this method over trying to make each entity have a non-tiling texture.  Cause if I can make the texture tile a lot, then I can use lower res textures and make the entity as wide as I want instead of trying to keep it narrow and use a 1024x1024 texture to try and eek as much detail into is possible.<br><br>Anyhow, so you would like have a tile in your terrain with two surfaces.  The surfaces have to be added in the order which you want the textures drawn for that whole tile cause that's the order they'll be drawn in.<br><br>So like you have a surface of rock, and grass.  Each texture scaled to tile 8 times across the object.<br><br>Then you use vertex alpha on the grass layer to blend with the rock layer.  Then you delete all polygons in the grass layer which have all 3 vertcies at alpha 0, and all polygons in the rock layer which have all three vertcies at alpha 0, since those will be covered up completely by the other texture.  As long as your transition is pretty tight from one texture to the other you should only get 10-20% extra polygons where the overlap is.<br><br>And that's it.  Blitz will then render the obejct in surface order, and within each surface in triangle order.  But teh triangle order doesn't matter if you're not trying to blend triangles in the same surface. <br><br></td></tr></table><br>
<a name="214568"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >makakoman</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, I tried this theory out and I've encountered several issues with vertex alpha.  Here is my test program (it is REALLY CRAPPY CODE because I was just kludging on the fly, trying out the theory, so BE NICE!).  (Textures/Heightmap included)<br><br><a href="http://mywebpages.comcast.net/hnorse1/test_splatting.zip" target="_blank">http://mywebpages.comcast.net/hnorse1/test_splatting.zip</a><br><br>The docs say you must set EntityFX with 32 to get vertex alpha to work.  I found that I also had to set flag 2, Use Vertex Colors, also.<br><br>I have two surfaces.  The primary surface containing the base texture, and the second surface that has a patch or splatting texture.  Order is really important.  You need to add the splatting surfaces first or it won't show up.  Hence the butchering of my code.  Obviously in a real splatting code you would create the splats based on height and slope.<br><br>Anyways, it seems that the primary Surface now has some transparency although all of its vertices have vertex alpha set to 1.0!  Move the camera left and right, you can see through hills.<br><br>Also, I originally was contemplating unwelded vertices and being unacheivably skillful at setting their uv coords to map a single combination texture to all the splats.  Only one surface, ooh, ahh!  But it dawns on me that without layers, what would it blend with??? Duh!<br><br>I have a real reservation about this approach because it will require probably a minimum of 3 surfaces, if not four,  to get the appropriate terrain detail, as Shawn mentioned previously.  If this were a single static terrain mesh, that would be OK.  But with a tiled terrain engine, you will now have 3-4 surfaces per tile - easily 300-1000 surfaces.  That Won't work!  The option is to make the tiles bigger and have less tiles, but for Dynamic Level of Detail, you can only get away with rebuilding tiles 32x32 in real time.  Also, I would also now have to rebuild all of the surfaces for the splats.  Sure would be nice to have a deletetriangle command without clearing the entire surface.  <br><br>Now that I think about it, I was reading an article that suggested splatting only the near tiles and using a colormap and single detail texture for far tiles, since detail far off in the distance won't be important.  That would reduce the number of surfaces dramatically, especially if it was limited even more to only the tiles in the view area (EntityVisible).<br><br>Anyways, anyone else have any ideas, input, theories, suggestions, solutions, innovations, inspirations, contemplations, ascertations, interpretations...<br><br>Thanks, <br>MK <br><br></td></tr></table><br>
<a name="214582"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> " but for Dynamic Level of Detail, you can only get away with rebuilding tiles 32x32 in real time."<br><br>You should not be doing dynamic level of detail if you value your framerate! :-)<br><br>That will kill your FPS a lot faster than adding extra surfaces will, that's for sure. :-)<br><br>If you use static levels of detail like I do, but set it so that the distance the highest level of detail is used is pretty far out then you can't see the snapping much.<br><br>Blitz is just not designed properly for a morphing terrain engine.  You need geomipmapping support for that, which I think requires like DX8 or something.<br><br>I'll try your test out now and report the results I get.<br><br>Also, while perhaps you may need to have 3 or 4 diffrent surfaces per tile in some instances, surely you won't need to have that much variation on more than 30% of the tiles in your terrain or so. <br><br></td></tr></table><br>
<a name="214586"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay tested it.  Crap.  I know what the problem is, and I don't like it.<br><br>It's not the vertex alpha.  That's just fine.<br><br>It's that Blitz is not zbuffering.<br><br>I totally forgot about zbuffering being disabled when you disable transparency, but for the record I do recall mentioning to Mark that we needed to be able to enable zbuffering when rendering transparent objects around the same time I talked to him about adding vertex alpha, for this reason, and for the reason of rendering particles onto the scene with alpha.<br><br>Without zbuffering you cannot fix this issue.  I have a feeling Mark forgot to enable it and nobody has been using this feature so nobody complained.  I'll send him an email pointing him to this topic. <br><br></td></tr></table><br>
<a name="214588"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay Mark has been emailed on the issue. <br><br></td></tr></table><br>
<a name="214692"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >makakoman</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Shawn, <br><br><div class="quote"> <br>If you use static levels of detail like I do, but set it so that the distance the highest level of detail is used is pretty far out then you can't see the snapping much.  <br></div><br><br>This approach works really good for a fixed size terrain, but I am trying to make my terrain infinate.  This requires using a fixed set of tiles and modifying them to look like the current terrain view.<br><br>Thanks for looking at the example and the input.<br><br>MK <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
