<!DOCTYPE html><html lang="en" ><head ><title >Need help on a System Call - $25 reward! :)</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Need help on a System Call - $25 reward! :)</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Need help on a System Call - $25 reward! :)</a><br><br>
<a name="850484"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Midnight</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> [Note: solution has been found and posted - scroll down a few posts for download.]<br><br><br>Hi all,<br><br>I need a little help converting a C++ system call to Blitz3D. I don't think it should be a big deal, but I'm horrible at these things. If someone were willing to do this, I'd be happy to <br>a) paypal him/her $25 for games/pizza/beer/etc as a token of appreciation <br>b) post the resulting code here so that anyone else in the community can use it for free.<br><br>The code in question is related to giving Blitz programs full-write access to common user folders (this is almost a requirement for Vista, given that you simply can no longer write to the "Program Files" directory without resulting in files being virtualized and other headaches).<br><br>The code itself is used in a BlitzMax version by Grey Alien, and is discussed here:<br><a href="http://www.blitzbasic.co.nz/Community/posts.php?topic=73305" target="_blank">http://www.blitzbasic.co.nz/Community/posts.php?topic=73305</a><br><br>(and yes, I've asked for Grey's permission to do this before posting here)<br><br>Specifically, I need the B3d equivalent of this C++ code (or a way to run this from Blitz3D the way Grey runs it from BlitzMax):<br><br><br>[CODE]<br>#include &lt;windows.h&gt;<br>#include &lt;aclapi.h&gt;<br><br>extern "C" bool GiveDirectoryUserFullAccess(LPCTSTR lpPath)<br>{	<br>	HANDLE hDir = CreateFile(lpPath,READ_CONTROL|WRITE_DAC,0,NULL,OPEN_EXISTING,FILE_FLAG_BACKUP_SEMANTICS,NULL);<br>	if(hDir == INVALID_HANDLE_VALUE) return false;<br>	<br>	ACL* pOldDACL=NULL;<br>	SECURITY_DESCRIPTOR* pSD = NULL;<br>	GetSecurityInfo(hDir,SE_FILE_OBJECT,DACL_SECURITY_INFORMATION,NULL,NULL,&amp;pOldDACL,NULL,&amp;pSD);<br>	<br>	EXPLICIT_ACCESS ea={0};<br>	ea.grfAccessMode = GRANT_ACCESS;<br>	ea.grfAccessPermissions = GENERIC_ALL;<br>	ea.grfInheritance = CONTAINER_INHERIT_ACE|OBJECT_INHERIT_ACE;<br>	ea.Trustee.TrusteeType = TRUSTEE_IS_GROUP;<br>	ea.Trustee.TrusteeForm = TRUSTEE_IS_NAME;<br>	ea.Trustee.ptstrName = TEXT("Users");<br>	<br>	ACL* pNewDACL = NULL;<br>	SetEntriesInAcl(1,&amp;ea,pOldDACL,&amp;pNewDACL);<br>	<br>	SetSecurityInfo(hDir,SE_FILE_OBJECT,DACL_SECURITY_INFORMATION,NULL,NULL,pNewDACL,NULL);<br>	<br>	LocalFree(pSD);<br>	LocalFree(pNewDACL);<br>	CloseHandle(hDir);<br>	return true;<br>}<br>[/CODE]<br><br>The code is designed to set a directory to "full access", which is required for other users to write/modify files originally created on a different user profile.<br><br>If you can do this, please let me know (e-mail to midnight@...). <br><br>Cheers,<br>Patrick <br><br></td></tr></table><br>
<a name="850486"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Vertigo</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Try doing an exec command to call and external command file..<br><br>something like this <a href="http://support.microsoft.com/kb/318754" target="_blank">http://support.microsoft.com/kb/318754</a><br><br>Im not entirely sure that works under vista... but im sure you could find some app that will change the folder permissions from the command like... of course the end user will be prompted once for "do you wish to allow" blah blah... after that the folder should be writable by blitz.<br><br>May be a lot easier that hacking some other code up. <br><br></td></tr></table><br>
<a name="850488"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kev</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> check your mail Midnight.<br><br>kev <br><br></td></tr></table><br>
<a name="850529"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >puki</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey, "Kev" - can I have the prize?<br><br>I need the food.<br><br>Email in sig.<br><br>I'll spend it on pizza.<br><br>Thanks. <br><br></td></tr></table><br>
<a name="850545"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Puki, you didn't do anything! <br><br></td></tr></table><br>
<a name="850713"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Midnight</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Alright, Kev was able to solve this for me. As promised, here is the code to enable write access (also includes a function to find special folder locations), for anyone else to use.<br><br>Many thanks!<br><br><a href="http://www.midnightsynergy.com/other/blitz3d_folder_access.zip" target="_blank">http://www.midnightsynergy.com/other/blitz3d_folder_access.zip</a><br><br>Cheers,<br>Patrick <br><br></td></tr></table><br>
<a name="850731"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for sharing this. Very generous :o) <br><br></td></tr></table><br>
<a name="850791"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kev</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I got my reward and a tip :) very generous patrick <br><br></td></tr></table><br>
<a name="850795"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Who was John Galt?</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I like your style, Midnight. If only more people offered cash rewards!!! <br><br></td></tr></table><br>
<a name="850842"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >nrasool</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Midnight, Thanks for that, but just a question please, How comes you didn't use the following to get the folder in Vista and My document. <br><br>I used it and it works fine in Blitz3d:<br><a href="http://www.blitzbasic.com/Community/posts.php?topic=69963#783368" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=69963#783368</a><br><br>Just pondering really :) <br><br></td></tr></table><br>
<a name="850871"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Midnight</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> nrasool - the code I needed was to make that folder write-accessible to all users. Kev was kind enough to add the other part (getting the folder location) into the same dll. <br><br></td></tr></table><br>
<a name="850950"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >nrasool</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ahhh that is really useful!, Many thanks for explaining that :) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
