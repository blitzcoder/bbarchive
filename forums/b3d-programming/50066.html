<!DOCTYPE html><html lang="en" ><head ><title >Precalculating mouse zones?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Precalculating mouse zones?</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Precalculating mouse zones?</a><br><br>
<a name="556768"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have a bunch of points on the screen, around 120 of them. At any given time, I will want to know which of them the mouse pointer is nearest to. Clearly I can do this by calculating the distance, but that 120 calculations every frame or two, and since the points never move, it seems like a waste really. So I'm just wondering if anyone has any good pieces of lateral thinking which might enable me to precalculate or speed this up in some way. <br><br>The points are relatively equally spread out, but they're not in an easily recognizable pattern, so I don't think I can do it purely mathematically as I could if it was a squared grid.<br><br>I suppose I could precalculate every pixel in a 800x600 array too, but that seems like memory overkill, huh? :P<br><br>Any other ideas on making this fast? <br><br></td></tr></table><br>
<a name="556788"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >octothorpe</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wow!  Interesting problem!  Here are some ideas:<br><br>A cheap and dirty solution might be to divide the screen up into a small number of sectors, and have a hardcoded list of which points the mouse might be closest to in each sector, then calculate the distance between each of them.  For a slight optimization you can cheat and forego taking the squareroot if you're comparing distances.<br><br>Or you could determine the bounding boxes for each point's area of control.  Then you'd need to get a list of all the bounding boxes which contain the mouse and check the distance between the mouse and each point.<br><br>Instead of checking distances, you might be able to rely on the fact that the areas each point controls will be separated by a line.  A straight line.  A line that you can use mathematically to figure out which of two points the mouse is closest to.<br><br>If you wouldn't mind, post a screenshot of your 800x600 precalculated array.  I find this kind of problem easier to deal with if I can visualize it.  :) <br><br></td></tr></table><br>
<a name="556791"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >octothorpe</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> A way crazier idea!<br><br>This relies on the fact that areas of control will be polygons, and I can't imagine them having any concave parts.  Instead of starting from scratch each frame, assume that the mouse hasn't moved far and keep track of the polygon the mouse was in last frame.  Keep track of each polygon's neighbours (for each edge.)  When the mouse leaves the polygon, guess which edge it left via (by figuring out which two radii it's between) and check if it's in that polygon.  If the player moves the mouse extremely quickly, you might have to chase it through several polygons. <br><br></td></tr></table><br>
<a name="556900"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> You would be surprised how fast a distance calculation is Syb.<br><br>This on my computer takes between 1 and 2 milli-seconds and it's doing 10,000 distance checks. I can't measure any lower really.<br><br><pre class=code>
Delay 100

x# = 100
y# = 200

Dim array(10000,1)
For loop = 0 To 10000
	array(loop,0) = Rand(0,800) ; x co-ord
	array(loop,1) = Rand(0,600) ; y co-ord
Next

time = MilliSecs()

For loop = 0 To 10000

	d# = Sqr(   (array(loop,0)-x)*(array(loop,0)-x) + (array(loop,1)-y)*(array(loop,0)-y))
	
Next

Print "Time taken = " + (MilliSecs() - time)
</pre> <br><br></td></tr></table><br>
<a name="556931"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Some interesting thoughts there, Octothorpe, thanks for those. I'll see if I can find a good way to represent the zones as an image so that I can post that. I guess a different color for each zone would work.<br><br>Thanks for bringing that to my attention, Ross. It does seem that it's probably overkill to optimize this. If a 2200 can do 10,000 checks in one millisecond, then I probably don't need to worry about doing 100-150 of them on anything greater than   a 486DX. I can even optimize it further because - as Octothorpe mentions - I don't need to Square Root if I'm comparing like with like.<br><br>In fact, in BlitzMax, I have to go up to 1,000,000 calculations before it actually takes 1 millisecond. <br><br></td></tr></table><br>
<a name="556946"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BlackJumper</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm sure this is crying out for a binary partition (Quadtree)treatment (like a BSP but even simpler since it will only be in 2D)<br><br>In essence, make a binary tree that holds the coords of each of your 120 points and walk the tree to home in on the coord you are nearest to. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
