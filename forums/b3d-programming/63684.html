<!DOCTYPE html><html lang="en" ><head ><title >Need opinions: Best occlusion method.</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Need opinions: Best occlusion method.</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Need opinions: Best occlusion method.</a><br><br>
<a name="710782"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >OrcSlayer</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, I've started using a new method for building levels for our game, which gives us a bit more flexibility. However, I can see surface count (and possibly polycount) getting quickly out of hand.<br><br>Basically, a level is created out of tiles...there will be floor tiles, wall tiles, ceiling tiles, even secenery tiles. The level will be created using a grid of sorts, where every tile is fit for a 10x10x10 cube. Tiles can be rotated as well, in 90 degree increments (mainly useful for the walls, obviosuly).<br><br>Doors will be implemented much like those in the old Descent game, except instead of animated textures they will be animated meshes, which will work like this:<br>Blocks characters unless fully open.<br>Blocks line of sight only when fully closed.<br><br>Anyway, this will quickly end up being a seriously big drain as far as surface count and polycount goes. I think I have a few options:<br><br>Single surface - Turn the whole map into a single surface mesh, sharing a single huge texture with all our tile skins on it. I can see the polycount getting high really fast here, and other possible rendering issues.<br><br>Visual Culling - If the cam can't see it, don't render it. I get the feeling this could get really slow, since it would need to check every entity within visual range and manually hide/unhide based on the result. Even with a short view range, that could get nasty because of how many tiles can be used in that small of an area. Plus the result STILL might have too many surfaces...<br><br>Modified Single Surface - Make groups of single surface meshes out of the level, seperated by key elements like doors and such. If the camera can't see a group, hide it.<br><br>I don't really know of any other methods...and I'm not quite sure how to implement some that I do (single surface). Can anyone give me some advice on what the best method would be for this kind of environment? <br><br></td></tr></table><br>
<a name="710800"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mike0101</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think this is good enough<br><br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=1244" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=1244</a> <br><br></td></tr></table><br>
<a name="710849"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >OrcSlayer</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> So basically you're saying turning the whole map into a single surface mesh, and then splitting it up into managable pieces, would be the best way to go? <br><br></td></tr></table><br>
<a name="710855"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mike0101</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> For make shadowreceiving map is not good solution.<br>I was try to make but is no good <br><br></td></tr></table><br>
<a name="710979"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >OrcSlayer</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, here's an idea...say I assemble my map tiles in gile[s] instead, so I can lightmap them and export each map as a whole unit.<br><br>I assume there will only be as many surfaces as their are unique textures, correct? <br><br></td></tr></table><br>
<a name="711011"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sweenie</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> If your level is an indoor dungeon-like environment portals would work perfectly.<br>But how to implement portals efficiently in Blitz3D I don't know.<br>Sometimes you could implement an occlusion culling system that spends more time calculating what's visible than it would take to just render the whole level by brute force.<br><br>Here is a good explanation of how portals work...<br><a href="http://www.3dkingdoms.com/weekly/weekly.php?a=26" target="_blank">http://www.3dkingdoms.com/weekly/weekly.php?a=26</a> <br><br></td></tr></table><br>
<a name="711053"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'd suggest to load the level as one huge mesh, then "clusterize" it. finally let direct X do the occusion job, based on camera range and view angle. I've done some tests and as Sweenie said, hiding/showing things may be even slower than brute force rendering. The Level design should however support this philosophy and spread the map in a way that allows to skp parts due to their distance. (aka "long ziczac corridors" between places) <br><br></td></tr></table><br>
<a name="711055"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >OrcSlayer</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Portals did sound like a good idea from what I know, perhaps I'll do more research on them.<br><br>However, this is my problem...I want to be able to dynamically create the levels from the base tiles (thus making map files very small, and able to contain all the data I need in a simple, easy to work with format). <br><br>I suppose if I can merge large parts of the mesh into a single surface system (perhaps set up zones in my editor, which dictates which tiles are merged into a group), I could still "chunk it up" and let direct X handle the rendering based on view angle alone...brute force.<br><br>Still, I have the problem of making single surface work.<br><br>Has anyone ever done a simple single surface system that can combine multiple static meshes using the same texture into a single, single surface static mesh which still maintains it's ability to do collision detection? How complicated would such a task be? <br><br></td></tr></table><br>
<a name="711061"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> "Single Surface" is not really what you need, it means "only one texture file for everything". But you surely could optimize the surface count! You only have to ADDMESH all objects to a new Mesh, then delete the originals (works atleast with static meshes, the animated ones may have to be handled seperately).<br><br>After ADDMESH everthing to one mesh, the surface count will be optimized automaticly. For this purpose you should store each Entities position, rotation and scaling, then reset them to the creation states (position, rotation =0, scale=1.0)<br>then use the PositionMesh, RotateMesh and ScaleMesh commands with the stored values, then add the meshes together.<br><br>You also need to use PainMesh or PaintSurface on the basic object to make them work with AddMEsh (don't use EntityTexture).<br><br>If you once have a single mesh, you still may clusterize it, as described before.<br><br>Collision detection still can be done, altough you won't be able to seperate the basic objects the map is made of. <br><br></td></tr></table><br>
<a name="711065"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Naughty Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> what I did it make whole level, do lightmapping properly and then slice out smaller chunks of level, and then load them separately, and let blitz do his own occlusion stuff...result? faster than any method i apply for occlusion... <br><br></td></tr></table><br>
<a name="711068"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >OrcSlayer</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok JFK, I think I see what you mean (did some poking around in the Mesh section of the manual). So by optimizing surface counts, do you mean it will combine all surfaces that use the same texture? If so, this may be a good deal easier than I thought.<br><br>Naughty Alien makes a good point about lightmapping, however because of the method I want to use I suppose I'll have to use a different technique to create lightmaps...<br><br>EDIT: Just tested the addmesh thing out, and it seems it does combine all surfaces using the same texture. And indeed it maintains collision ability.<br><br>So, in effect, if my artist uses the same texture on all the tile meshes in a particular tileset (a huge texture with all of them, made possible with DDS thankfully), this would actually become a single surface system automatically then?<br><br>Of course characters, doors, and such are another story, but I'm much less concerned with that at the moment. The tests I've done show that with a little optimizing, this should work out great as long as the levels don't bring me down. <br><br></td></tr></table><br>
<a name="711073"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, as long as the brushes use the same texture flags etc. then it should optimize it this way.<br><br>Don't forget to split the mesh is clusters after the union, this will give you a high speed based on a good relation between surface count and Tris rendered. Clusterisation will double some surfaces, but don't worry too much about Single surface. The card can easly handle some dozens of sufaces, if the number of triangles is not too high. You should not reduce the surface count at ALL costs. Because, what ever is part of a mesh that lies within the camera viewrange, it will be rendered, even if most of it is behind the camera, or out of its range. That's why clusterisation makes sense. <br><br></td></tr></table><br>
<a name="711127"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >OrcSlayer</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Good point...and I actually think I have it figured out perfectly. In my editor I'll give each tile a group value...and when the map is assembled all tiles that share the same group are merged into a single, low surface count mesh.<br><br>That way DirectX can handle the rendering "brute force" without having to do the whole freaking map...only the groups that can readily be seen. <br><br></td></tr></table><br>
<a name="711391"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >OrcSlayer</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, I have another question. Since I've figured out that this method does in fact work and is exactly what I'm after...there's one thing remaining. Lightmapping.<br><br>So basically I'm thinking of this:<br>Create map in editor.<br>Export file telling engine which tiles go where, and which ones need to be merged into groups.<br>Render and export level lightmap.<br>Load map info into game engine, build level out of base tiles according to saved info and merge into pre-defined groups.<br>Load and apply level lightmap.<br><br>I've pretty much figured out how to do everything but the lightmap. I'm concerned it might become quite difficult to render and apply a lightmap to a level that is made of several meshes that are created out of merged groups of smaller meshes.<br><br>I'm not looking for ultra-fine detail lightmaps by the way, just simple ones. <br><br></td></tr></table><br>
<a name="711449"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shambler</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Depends what editor you are using but I do this,<br><br>Build level as chunks in 3DWS,<br>Import chunks into Gile[s] then position and lightmap them,<br>Export to .b3d.<br><br>Engine just loads in the lightmapped chunks with no need to separately position them or apply a lightmap. <br><br></td></tr></table><br>
<a name="711466"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >OrcSlayer</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, problem is I'm creating my own editor.<br><br>So far it's working great, maps are stored as simple data files that are very, very tiny. The engine builds the map by arranging tiles in a grid of 10x10x10 "cubes." <br><br></td></tr></table><br>
<a name="711526"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> The problem will be: lightmapping takes a lot of time, several minutes, up to hours, probably. This is why people render them once, and then load the finished level map, with the lightmap applied on texturelayer 2.<br><br>Personally I have to say, tiny files are nice, but not neccessary. These days people download 20 megabytes even if it's only a stupid movie that they will watch once and then delete it. So I wouldn0t care too much about the level file size. Anyway, it's the textures that are "eating" the megabytes.<br><br>BTW there are several lightmapping sourcecodes in the archives. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
