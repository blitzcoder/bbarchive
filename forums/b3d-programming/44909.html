<!DOCTYPE html><html lang="en" ><head ><title >Why isn't Null a constant in Blitz?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Why isn't Null a constant in Blitz?</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Why isn't Null a constant in Blitz?</a><br><br>
<a name="499680"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> As the title says. I need to be able to pass an optional type handle to a function, like:<br><br><pre class=code>
Function do_stuff(x, y, parent.myType=Null)
</pre><br><br>I just get an error message basically saying that Null isn't a constant. This little gem has really screwed up my plans. :/<br><br>Anyone know why Null isn't a constant in blitz, then? Beats me. <br><br></td></tr></table><br>
<a name="499682"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Completely agree .... I ran into this recently with a routine where I wanted to average between 2 and 4 vector types ... <br><br>Avg ( 2 [no of vectors], v1.vector , v2.vector , v3.vector, v4.vector )<br><br>If I only wanted to average the 1st two vectors , the only way I could get round it was to create a dummy vector type and pass that as both V3 and V4... even though I had no use for them.  I just stuck to haveing a different function for each ... quite annoying.<br><br>I'd be interested if anyone has a better solution. <br><br></td></tr></table><br>
<a name="499685"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> The only other way I could think of was to have a Global type handle which I set before calling the function - like having a global function param. Yuck!<br><br>Unfortunately, I don't really have the option of duplicating the function for different amounts of params because it contains a large Select/Case for initializing types to presets. Duplicating this and remembering to keep them in sync would be a real pain.<br><br>I just can't think of a reason why Null isn't a constant. :/ <br><br></td></tr></table><br>
<a name="499687"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>The only other way I could think of was to have a Global type handle which I set before calling the function - like having a global function param. Yuck!<br> <br></div><br><br>That's what I meant ... total pish!! <br><br></td></tr></table><br>
<a name="499688"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gosse</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, you can always have a Global instance to compare with.<br><br>example:<br><pre class=code>
type mytype
  ...
end type

global nullmytype.mytype

function dostuff(param1.mytype, param2.mytype = nullmytype)
   if param2 = nullmytype then
       ... you have it when its null
end function
</pre> <br><br></td></tr></table><br>
<a name="499697"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Can't do that ... you get an illegal type conversion. <br><br></td></tr></table><br>
<a name="499703"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Floyd</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Null really is not constant. <br><br>When you Delete a Type object it isn't actually deleted. It is moved to an 'inactive objects' list. Any variable referring to such an object is considered Null, even though the value of that variable is not zero. A call to New will recycle an inactive object, if one is available, rather than allocate new memory.<br><br>This speeds up the New/Delete system, but has the annoying side effect that Null is not a valid default value.<br><br>It's usually not too hard to work around this. <br>The Avg ( 2 [no of vectors], v1.vector , v2.vector , v3.vector, v4.vector ) is one example. You can't have a variable number of type arguments, so the [number of vectors] argument is needed. You must then supply four vectors no matter how many you really wanted. Example:<br><br>Avg ( 2 , v1, v2 , v1, v1 )<br><br>to average the first two vectors. The final v1,v1 will be ignored. <br><br></td></tr></table><br>
<a name="499706"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> So, when I have a line like:<br><br><pre class=code>
If this.myType = Null Then ...
</pre><br><br>It's not only checking to see if this.myType equals 0, but also checking to see if this.myType matches a handle of any of the deleted types held in the 'inactive objects' list?<br><br>Ahhh, that would explain why Null isn't a constant, then. Thanks for the explanation, Floyd. ;)<br><br>However, this raises a few other concerns:<br> - If I have many (thousands) of deleted types, wouldn't the If check above take a relatively long time, since it would have to go through the handles of all the deleted types?<br> - If memory used by deleted types is never actually freed (until the program ends), it's possible to have memory bloated with thousands of deleted types, pushing the memory requirements of an app up unnecessarily. <br><br></td></tr></table><br>
<a name="499709"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Floyd</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> 1. I assume this is implemented in such a way that Biltz knows which list an object is in without actually searching the list. So checking =Null should not slow down as the number of deleted objects increases.<br><br>2. It is true that memory used by Type objects goes up but never down. It is always a kind of 'high water mark'. I suppose you could cook up an example of this which causes problems. But in practice I doubt you will see any bad effects. <br><br></td></tr></table><br>
<a name="499711"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Koriolis</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> This speeds up the New/Delete system, but has the annoying side effect that Null is not a valid default value.<br> <br></div>This is all but a reason for having Null not being seen as a constant. When you do "If MyObject = Null" the compiler knows perfectly well you're not comparing apple to bananas, but an object reference to a another object reference.<br>Internally these references are nothing but straight pointers. If Null simply maps to the pointers whose address is 0, comparing a reference r1 to another reference r2 could simply be done like that (pseudo C code, p1 and p2 being the corresponding pointers):<br>result = (isDead(p1) ? 0 : p1) == (isDead(p2) ? 0 : p2)<br><br>That is, before doing the comparison, simply force the pointers to 0 if they point to a dead object (every dead object could have a simple flag set).<br><br>By doing this, the blitz compiler could simply map Null to the pointer of address 0 (that is, a constant, so no problem).<br><br>Given that this is certainly what Blitz already does internally, there is AFICT really no good reason to have Null not being seen as constant.<br>It's just done like that. <br><br></td></tr></table><br>
<a name="499787"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Barliesque</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't think that whether Null is a constant or not is really the issue--It's certainly not a variable.  Regardless of what Null is, big10p's function declaration ought to compile.  If a variable of MyType can be initialized to Null, then it stands to reason that Null should be a valid default value.  I say, post it in the bug reports forum. <br><br></td></tr></table><br>
<a name="499952"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >nawi</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is an awful workaround, but seemed like good idea to post<br><br><br><pre class=code>
Type Foo
	Field Bar
End Type

TestFoo()

fish.Foo = New Foo

TestFoo(Foo(fish))

Function TestFoo(t=0)
	f.Foo = Object.Foo(t)
	
	If f.Foo = Null Then Print "Foo is null!" Else Print "Foo is not null!"
End Function

WaitKey

Function Foo(f.Foo)
	Return Handle(f.Foo)
End Function
</pre> <br><br></td></tr></table><br>
<a name="499973"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Koriolis</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  I don't think that whether Null is a constant or not is really the issue--It's certainly not a variable <br></div>By definition if it's not a variable it's a constant and vice versa. So yes it's the issue.<br><div class="quote"> If a variable of MyType can be initialized to Null, then it stands to reason that Null should be a valid default value <br></div>Certainly.<div class="quote"> I say, post it in the bug reports forum.  <br></div>Problem is, this is all but a new issue. It was already reported several times, and if it wasn't fixed before BlitzMax, chances are slim that it will be from now. Sadly. <br><br></td></tr></table><br>
<a name="499982"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Warren</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Free Noel! <br><br></td></tr></table><br>
<a name="500053"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rook Zimbabwe</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have always thought that foo was null... Was I wrong? <br><br></td></tr></table><br>
<a name="500238"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Barliesque</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> By definition if it's not a variable it's a constant and vice versa. So yes it's the issue. <br></div><br>It seems to be behaving as neither constant nor variable (despite the syntax), but as a keyword of the compiler.  Which means it's up to the compiler to interpret that keyword appropriately.  I'm suggesting that it would be appropriate for the compiler to interpret NULL in a useful way as a function parameter default.<br><br><div class="quote"> <br>Problem is, this is all but a new issue. It was already reported several times, and if it wasn't fixed before BlitzMax, chances are slim that it will be from now. Sadly. <br></div><br>Well, I'd have thought it to be the other way round.  They're a small team and can't really be expected to divide their attention evenly across several products all the time.  Once BlitzMAX is released for PC and initial bug reports are cleared, I would imagine they'll be better able to divert attention back to Blitz3D.  Anyway...<br><br><div class="quote"> This is an awful workaround, but seemed like good idea to post <br></div><br>Well, I don't think it's a bad work-around at all--especially it's brought to light a function I had no idea even existed: Handle()  ...How long has that little beauty been around?!  I just updated my help system with the latest, and that's <i>still</i> not in there!  ...Aaaargh!  :-S <br><br></td></tr></table><br>
<a name="500278"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Koriolis</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  Which means it's up to the compiler to interpret that keyword appropriately <br></div>Excatly my point of view.<br><div class="quote"> How long has that little beauty been around <br></div>Very long. Search in the forums you'll find pleanty of threads.<br>Byt I agree with nawi, the sample is pretty awful. Being able to have Null as a default parameter is just a neat convenience, and this workaround is all but nice to use, which defeats the purpose IMHO.<br><br>Oh and when I say it's been requested several times, I am not lying. I had requested it myself:<br><a href="http://www.blitzbasic.com/archive/posts.php?topic=19612" target="_blank">http://www.blitzbasic.com/archive/posts.php?topic=19612</a><br><br>It was 2 years ago, so guess what are the chances of getting it implemented... <br><br></td></tr></table><br>
<a name="500357"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Barliesque</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Actually, I take that back.  It's great that it works and it's possible to do, but it's hardly the kind of elegant program construction that I've generally found possible with Blitz3D.<br><br>Is there anywhere in particular that hidden functions like Handle() have been collected and documented? <br><br></td></tr></table><br>
<a name="500391"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Koriolis</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> There's a bit of information on undocumented features onblitzcoder<br><a href="http://www.blitzcoder.com/cgi-bin/code/code_listentries.pl?id=UD" target="_blank">http://www.blitzcoder.com/cgi-bin/code/code_listentries.pl?id=UD</a><br><br>I wouldn't say it's complete, but ta least it does exist.<br><br>Then for more information on specific features, google is your friend. By example you can find quite a lot of thread about handle/object:<br>http://www.google.com/search?hl=fr&amp;q=site%3Ablitzbasic.com+handle+object&amp;btnG=Recherche+Google&amp;meta= <br><br></td></tr></table><br>
<a name="500556"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Barliesque</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the tip.  The BlitzCoder site has a lot of useful information.  Seems to me it would still be worthwhile collecting together information about ALL of the undocumented features, in one place. <br><br></td></tr></table><br>
<a name="500994"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nexic</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> Uhhh I thought Null just equals 0? <br><br></td></tr></table><br>
<a name="501128"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nope. Read Floyd's first post to see why.<br><br>In the end, I got around the problem by making the type params mandatory, and then just passing in Null when I don't need them. <br><br></td></tr></table><br>
<a name="501208"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Scherererer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>Well, you can always have a Global instance to compare with.<br><br>example:<br><br>type mytype<br>  ...<br>end type<br><br>global nullmytype.mytype<br><br>function dostuff(param1.mytype, param2.mytype = nullmytype)<br>   if param2 = nullmytype then<br>       ... you have it when its null<br>end function<br> <br></div><br><br>Remedied with Handle()...<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
type mytype
  ...
end type

global nullmytype.mytype

function dostuff(param1.mytype, param2.mytype = nullmytype)
   if Handle(param2) = Handle(nullmytype) then
       ... you have it when its null
end function
</textarea><br><br>It should work. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
