<!DOCTYPE html><html lang="en" ><head ><title >ODE and multiplayer</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >ODE and multiplayer</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >ODE and multiplayer</a><br><br>
<a name="536041"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jeroen</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi there!<br><br>I am thinking to make a new game that will be multiplayer and use ODE for physics and collisions. But, I have some questions on that.<br><br>In my previous multiplayer game, I simply sent the local player coordinates to all the other players. On their computers, it was simply a matter of receiving the coordinates and placing the entity using positionEntity (absolute).<br><br>But, now with physics, there's a problem. When player A hits player B, it will cause a reaction, for example they will bounce. <br><br>In theory, only one computer will actually need to perform physics and send coordinates, right? Or...I really don't have an idea what happens when all clients run physics and what I need to send through the network.<br><br>How am I going to implement a right way to do this?<br>How is this usually done? Sending absolute coordinates and positioning entities here...it feels just wrong, somehow.<br><br>Thanks! <br><br></td></tr></table><br>
<a name="536055"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>In theory, only one computer will actually need to perform physics and send coordinates, right?<br> <br></div><br><br>Depends how you do it.<br><br>I prefer to distribute the power between machines, though this gives an opening for cheaters....<br><br><br>How i did it:<br><br>Send position and rotation, plus velocities...<br>You will have to consider Lag-<br>I've done a Lag system where i tell the program how many frames each computer can fall behind- and the server waits for everyone to be on the same frame, or within that lag value, before continuing.<br><br>To be honest, This works really well over LAN... And its playable over the internet but sometimes you get flung really hard- And physics dont work really well unless synchronised... <br><br></td></tr></table><br>
<a name="536079"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >IPete2</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Can I ask a stupid question???<br><br>If the ODE physics engine is active on all players machines, and co-ordinates for initial positions and rotations and velocities are sent, why not just let each players programme run their own physics on the local pc vehicles?<br><br>Would this be a disaster?  What are the consequences of allowing each local PC determine the outcomes of collisions etc?  <br><br>Perhaps on collision then the position, rotation, velocity etc are sent to allow everyone to have the same data before attempting the physics reactions?  <br><br>Would this be too slow? Would lag have too great an effect on everyone?<br><br>IPete2.<br><br>Just realised that is more than one question, sorry!  Lol! <br><br></td></tr></table><br>
<a name="536081"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KuRiX</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, i will give you a solution. It is called the Dead Reckoning Algorithm. I have implemented it in my Racing Game and is working very good over internet. The only problem with this method is the lag fluctuation.<br><br>Dead Reckoning:<br><br>- Each computer runs all the simulation.<br>- Every certain time, all the positions, rotations, linear velocities and angular velocities are broadcasted over the net. Then, if the received values are over some limit (this means that the difference between last pos and actual pos is greater than the limit), then all the values are updated.<br>- The rest of the time all the computers run their own simulation.<br><br>I have adapted this making a matrix of inputs. So each computer knows its ping time. During this ping time the computer saves all the input of the player in a vector, and then sends this vector to the rest of the computers. Then the computers update the remote players with that update.<br><br>The matrix of inputs has the advantage of giving very smooth results, but has the disadvantage of positioning players later than they should be, and it is very affected by collisions.<br><br>Well, hope this helps. Good Luck.<br>Cheers, KuRi. <br><br></td></tr></table><br>
<a name="536099"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I can confirm this works by the way- I played with it.<br>However, i chose not to use it because i liked the idea of "more computers=shared power, Less CPU usage per computer"<br><br>You simply wont avoid lag. Over the internet, I'd probably use Kurix solution. Over lan, i find mine works well.<br><br>Oh, and dont forget to convert everything to floats/bytes before sending over the network :P then recompose the values at the other end.<br><br>EG:<br><br>A wheel is parented to the car body.... so you can get its local x/y/z coords... Now, usually, you could store the wheel locations LOCAL positions say... in a byte, by dividing the actual local position... so say, 0 means -1 and 256 means 1.... So you can send each wheel's coordinate in 3 bytes....<br><br>Usually, this will do fine, but it can give odd results because of its inacuracy with positioning. <br><br>you cant really use this with rotation- you can tell when youre not using floats :P so use FloatToStr :)<br>(Actually, the rotation of a wheel can be done using bytes- because theyre small)<br><br><br>So, just optimise... I hope you understand what i wrote... hehe... <br><br></td></tr></table><br>
<a name="536145"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KuRiX</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, of course you should use bytes as Cygnus says.<br><br>For example, for rotations using quaternions:<br><br>qx = dBodyGetQuaternionX(body) / 1000.0<br><br>Then you send qx as a byte, because this value will be always in the [-1,1] range!<br><br>OR something like that... <br><br></td></tr></table><br>
<a name="536158"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'll just emphasize on the fact that you cant use bytes to position objects globaly... <br><br>Reason i may seem like im stating the obvious is that Network Debugging is horrendous, and if you do something like this without thinking.....!<br><br>Have fun :) <br><br></td></tr></table><br>
<a name="536173"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Picklesworth</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Counter-Strike Source has the physics calculated individually on every computer, which saves a lot of bandwidth and nobody really notices unless they're telepathic (or discussing the weird position of a person's dead body). Mind you, the physics in that game aren't much more than ragdolls...<br><br>Maybe a player only sends out physics information if they have done something to cause it?<br><br>I think KuRiX and Cygnus have the best suggestions so far. <br><br></td></tr></table><br>
<a name="536175"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KuRiX</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Cygnus, we would make a good team programming racing games hehe :D<br><br>Of course, i was talking about global rotations, not positions. <br><br></td></tr></table><br>
<a name="536182"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Indeed we would!, and i would worry about why you would use Quartonians to position something :D hehe. <br><br></td></tr></table><br>
<a name="536885"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jeroen</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay those are really nice solutions! Especially when a game concept involves physics (not CS:Source just using it for rag dolls) it is important to find some kind of system.<br><br>I am curious about this:<br><br><div class="quote"> <br>- Every certain time, all the positions, rotations, linear velocities and angular velocities are broadcasted over the net. Then, if the received values are over some limit (this means that the difference between last pos and actual pos is greater than the limit), then all the values are updated. <br></div><br><br>How are you going to determin a good limit? What if physics can do lots of weird things (low and high values)? <br><br></td></tr></table><br>
<a name="536887"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KuRiX</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hehe, nice question. In my racing game, the limit is small enough to give smooth solutions, but greater than the minimum movement at slow speed (gear 1).<br><br>The best is to make some tests... <br><br></td></tr></table><br>
<a name="537158"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tibit</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Depending on how advanced you want to make it you could let the server be in charge still let the client do some work like this:<br><br>This is the Unreal Model in short:<br>Client Send --&gt; Server<br>Client continues to update physics..<br>Server get msg from Client. <br>Server checks the time the packet took to arrive. (Your Ping). The message contained position and acceleration. The server predicts where the client should be.<br>Server Send --&gt; Client with this prediction.<br>Server sends this prediction to all other players too.<br>Client receives MSG and checks the time the packet took to arrive. The Client then steps back in time (you need to save some previous data) to where the prediction was. The client now sets the location of this server packet and now steps forward in time with the latency of the message. In this way all clients see the other clients closer to their true positions<br><br><br>A more simple approach would be to send player input (which keys he is holding down) and updating the physics at all clients. To make sure you don't get out-of-sync you need to (once in a while) send Full updates with X,Y,Dir. A good way is also to send more updates when a collision occur. Also when you apply updates you should consider the delay the packet took.<br><br>To get the time for a packet I would recommend you to Sync-clocks <br><br></td></tr></table><br>
<a name="537440"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jeroen</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Wave,<br><br>That sound like a great way to do it! I think I'll try this approach. Thanks. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
