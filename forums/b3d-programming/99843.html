<!DOCTYPE html><html lang="en" ><head ><title >Best data structure for variable dimension arrays?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Best data structure for variable dimension arrays?</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Best data structure for variable dimension arrays?</a><br><br>
<a name="1174319"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Axel Wheeler</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm looking to create a library to allow a use to create Perlin noise maps and then apply various deformations to them to create the desired noise.  I've realized that some of these variations require other Perlin noise maps, sometimes of different sizes that the user might experiment with.  So, I can't just start with one global array or a fixed number of them; I want to be able to have a function essentially return the noise map as an array of floats, or something that can be interpreted as an array of floats.  I've thought of a few ways of doing this, and I want your advice on which may be better:<br><br>1. Using Blitz arrays (with the []).  Disadvantage; I need a separate function for each size (since they must be dimensioned at startup).  Since Perlins have to be a power of two anyway (that's part of the Perlin algorithm) that might be ok.  Then again, I don't think the two dimensions have to be the same power of two (x and y can be different sizes) so that would still be a slight limitation.<br><br>2. Use images to store the data.  Assuming I can use all four bytes of the image ARGB, it should be possible to put the floats (also four bytes I understand?) into that data.  This might be the easiest way?<br><br>3. Use memory banks of some kind?  I haven't used them before.  Is it possible for a function to return one and then call that function any number of times to get banks of various sizes?<br><br>4. Something I haven't thought of?<br><br>Thanks for any help youse all can provide! <br><br></td></tr></table><br>
<a name="1174344"></a>

<a name="1174345"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  Is it possible for a function to return one and then call that function any number of times to get banks of various sizes? <br></div><br><br>Yes. Banks essentially fill the same niche as dynamic arrays in other languages: they can be any size, they can be resized, they can be passed both up and down the callchain and stored wherever you like, and you're not limited to a single global instance.<br><br>The price is that you have to use the peek and poke functions instead of array indexing, and that they're slower; but in practice they're usually the best option because there's simply no obvious alternative in B3D.<br><br>You can think of a bank as being like an image, but without the overhead of the "renderable stuff", and with extra features like dedicated Peek and PokeFloat commands so you don't have to do any messy casting to get floats in there. It's also likely to be faster for arbitrary memory work since you don't need to do any locking of buffers and swapping to/from video memory. A bank is definitely superior to an image in all respects for this kind of task (if you want to render the final version of the map, better to develop it in a bank and then copy the pixels to an image later).<br><br>Blitz arrays have two big advantages: their speed, and convenient notation. The speed is nice but unlikely to be necessary unless you're having major performance problems. Being able to use array notation instead of function calls (especially for setting data) is a really nice way to make your code clearer: bank-based code can be extremely hard to read. So you need to weigh up which factors are more important to you.<br><br><br><div class="quote"> Something I haven't thought of? <br></div><br><br>You could use a Dim array (resizeable, and can be shrunk to zero when not in use) to generate the map, then copy the result to a bank for storage and moving around? That way you get the advantages of speed, nice (multidimensional!) array notation, <i>and</i> portability of result data. You only need to deal with the bank at the end of the function when you copy the data out of the array, keeping your algorithm code cleaner.<br><br>Using this technique you could even go all-out silly and pass the data around as strings if you wanted, and never need to worry about freeing a bank again because strings are garbage collected (<i>note: I am not seriously recommending strings for data storage</i>).<br><br><font class="tiny">Last edited 2013</font> <br><br></td></tr></table><br>
<a name="1174366"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Axel Wheeler</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Cool.  This is so helpful.  Thank you.  I'll ponder these issues.<br><br>I did this once before for my terrain generator, but I never liked the method.  It used a Dim'd array like this: Dim CloudArray(sizeX,sizeY,4) with the last value determining how many I could play with at once.  Not only was it wasteful, it limited all the arrays to the biggest size, and I realized that most of the other noisemaps I needed should be quite small by comparison.  <br><br>I'll try out banks.  Thanks! (Hey that rhymes!) <br><br></td></tr></table><br>
<a name="1174685"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>2. Use images to store the data. Assuming I can use all four bytes of the image ARGB, it should be possible to put the floats (also four bytes I understand?) into that data. This might be the easiest way?<br><br>3. Use memory banks of some kind? I haven't used them before. Is it possible for a function to return one and then call that function any number of times to get banks of various sizes?<br> <br></div><br>Essentially these two are equivalent, although with the IMages, you may need to work with buffer locking etc. which can be slower than directly peeking/poking the memory.<br><br>So Banks are preferable, very much as Yasha suggested, although I would perhaps include a Blitzarray to act as a hash table of memory locations. This will allow much faster access to the specific bytes. <br><br></td></tr></table><br>
<a name="1175947"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Axel Wheeler</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm experimenting with banks.  Folks say that the peek/poke commands are slow, but I find the PeekFloat and PokeFloat are many times quicker than the corresponding commands for the other datatypes.  Also, it is much faster than ReadPixelFast/WritePixelFast.<br><br>I couldn't find a thread about this in my quick search (Floats being so much faster than other datatypes in banks).  Is this a known thing?<br><br>Arrays (both Blitz and Dimmed) are much faster than anything else,  so I'll probably use a dimmed array within the perlin function, but then use a bank of floats to pass them around, combine them, etc. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
