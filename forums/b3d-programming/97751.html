<!DOCTYPE html><html lang="en" ><head ><title >Path calculation with non grid nodes</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Path calculation with non grid nodes</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Path calculation with non grid nodes</a><br><br>
<a name="1137373"></a>

<a name="1137374"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi, :)<br><br>I'm currently coding the pathfinding routines for a video game.<br><br>I have already coded a routine to create nodes, a routine to create links between the nodes, a routine to calculate the shortest path depending on the links between the nodes and AStar concepts, a routine to make a npc follow the path.<br><br>This works well, but the nodes are positioned on a grid, so it is easy to find the start node and the end node with a simple distance check between the npc and the nodes of the room or the player and the nodes of the room.<br>Like this :<br><img src="http://img823.imageshack.us/img823/2769/nodespositionnedwithagr.jpg"><br><br>I want to be able to use nodes positionned around the obstacles (furnitures or buildings) like this :<br><img src="http://img401.imageshack.us/img401/227/nodespositionnedwithout.jpg"><br><br>As you can see there are nodes around each obstacle, and links have been already precalculated with linepick.<br><br>But with these nodes i can't simply use a distance check to know what is the start node and the end node because the nearest node may be behind an obstacle...<br>I know i can use linepick to check if the nearest node is behind an obstacle or not,but i don't want to kill my fps if several npcs want to create a path at the same time.<br><br>Do you know others ways to achieve this ?<br><br>Your thoughts ?<br><br>Thanks,<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1137376"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >stayne</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is EntityInView slow?  I don't know much about it. <br><br></td></tr></table><br>
<a name="1137379"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Rem,<br>if I'm not mistaken A* will still work in this case. It can be applied to any structure of nodes, even if they're not on a grid.<br><br>Distant nodes (in your case, the ones behind the obstacles) will have a bigger walk distance and thus a bigger cost to travel.<br>A* will first process the closest ones (the ones that don't reach the goal) until it processes the costlier ones that circumvent the obstacles and actually reach the goal.<br><br>For further info check this link: <a href="http://theory.stanford.edu/~amitp/GameProgramming/MapRepresentations.html#polygonal-maps" target="_blank">http://theory.stanford.edu/~amitp/GameProgramming/MapRepresentations.html#polygonal-maps</a> <br><br></td></tr></table><br>
<a name="1137382"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Stayne&gt;&gt; Good idea, i will do some tests. Thanks.<br><br><br><br>Kryzon&gt;&gt;Thanks, but i know how to use Astar. The question was how to find without too many calculations, what is the nearest node from a character or what is the nearest node from the Player, knowing that with nodes positionned without a grid, there can be an obstacle between two nodes, so the distance check is not reliable.<br><br><br><br>So i guess linepick or entityvisible is the best way to do it ? <br><br></td></tr></table><br>
<a name="1137383"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >stayne</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I do remember EntityVisible being VERY slow. <br><br></td></tr></table><br>
<a name="1137385"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> The fastest way would be to create a cell diagram covering your space (AKA Voronoi map), which would allow you to quickly attach whole areas of space to nodes.<br><br>You could use a pixel-based version, finding the nearest position on a very fine grid to where the character is and testing the "colour" of the matching pixel; or you could create convex-hull descriptions of each cell and test if a point falls "within" any given hull, starting with those belonging to nodes nearest to it (but for this to be any good you'd need a way to quickly pre-sort small groups of nodes, perhaps using quadtrees).<br><br>On the other hand... remember that premature optimisation is the root of all evil. Until you've <i>seen</i> that LinePick isn't fast enough for your needs, assume that it is. When it gets slow, swap from B3D collisions to ColDet and keep using LinePicks until again you need change strategy later - but remember, <i>how you do it</i> is just an optimisation and implementation detail - get your whole system working first. <br><br></td></tr></table><br>
<a name="1137386"></a>

<a name="1137388"></a>

<a name="1137389"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Thanks, but i know how to use Astar. <br></div><br>I know you know, you mentioned it in your post! :)<br>I like to give context because some people that read these threads might not be initated.<br><br>I did misunderstand the question...<br><br>Since we're talking about a 2D top-view, you can use a 2D euclidean distance check on the X ~ Z plane.<br><br>Thing is, you're comparing distances with themselves, so you can optimize your distance function by <b>removing the Sqr()</b>. <br>You won't be able to consider the result as an actual distance value, but you will be able to compare results and tell which node is <i>closer</i>.<br><pre class=code>
Function QuickDistance#( X1#, Y1#, X2#, Y2# )
	Return Abs( (X1 - X2)*(X1 - X2) + (Y1 - Y2)*(Y1 - Y2) )
EndFunction

;Run the above for every node against the player, and pick the one with the smallest result.
;This will be your closest node.
</pre>This is something GfK always recommended around here. Without the Sqr() the above is quite fast.<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1137395"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Stayne&gt;&gt;I think EntityVisible is not appropriate in this situation because i need to check if a path with a radius is possible between a point to a node (the radius is the width of the character).<br><br><br><br>Yasha&gt;&gt;I hear your advice, but i guess that if my program has to use 10 times linepick for each character during a loop, this will surely kill my fps.<br><br>But a try is better than a guess, so i will try :)<br><br><br><br>Kryzon&gt;&gt;Ok now i know that you know that i know. :) <br><br></td></tr></table><br>
<a name="1137397"></a>

<a name="1137398"></a>

<a name="1137399"></a>

<a name="1137400"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have another question about collisions detection related to this topic :<br><br>Let's say i use a collider sphere with a radius of 0.5 (the max width of the characters), and all furnitures are collider meshes.<br><br>I use collisions detection instead of using linepick, i calculate the VLength# between the character X,Z coordinates and the node X,Z coordinates using a 2D distance calculation.<br> <br>I put the collider sphere at the character position, then i use PointEntity or RotateEntity to make the collider sphere faces the node, then i use :<br><pre class=code>
MoveEntity(Colliderphere,0,0,VLenght#)
</pre><br><br>In theory if i use :<br><pre class=code>
NCCS% = CountCollisions(SphereCollider) 
If(NCCS% &gt; 0)
 OCEntity% = CollisionEntity(SphereCollider,1)
 OCName$ = EntityName(OCEntity%)
 CX# = CollisionX#(SphereCollider,1)
 CY# = CollisionY#(SphereCollider,1)
 CZ# = CollisionZ#(SphereCollider,1)
 CNX# = CollisionNX#(SphereCollider,1)
 CNY# = CollisionNY#(SphereCollider,1)
 CNZ# = CollisionNZ#(SphereCollider,1)
EndIf
</pre><br><br>this will check the collisions which have happenned  between the collider sphere and the collider meshes before reaching the node.<br><br>However how am i supposed to use the index of collisions ?<br>What does this index mean ?<br><br>My guess is that the first index (1) represents the first collision and thus i should use this first index (1) in order to retrieve the parameters of the first collision ?<br><br>Yes ? No ? Why ?<br><br>Thanks,<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1137401"></a>

<a name="1137406"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Pretty much. Internally a list of collisions is built for each collider; CountCollisions give you the length of the list and that index lets you get at specific elements of it. This is essentially useful only if the entity collided with more than one thing.<br><br>It's a convoluted solution you're going for there though. I would repeat the suggestion that you look at ColDet. Not only is it blazingly fast (dozens of times faster than native collisions), it also supports linepick-with-radius (not called that, but eh) so it basically has the function you want built-in.<br><br><br><b>EDIT:</b> Checking the docs and... OK, I honestly just <i>forgot</i> B3D also supports pick-with-radius as part of the standard LinePick command. Well, ColDet should hopefully be faster anyway.<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1137405"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok i'm going to do some tests with Blitz3d Linepick, Blitz3d collisions, and Codlet.<br><br>I will post the results.<br><br>Thanks, <br><br></td></tr></table><br>
<a name="1137516"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Danny</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Not sure if this was suggested before - or applies to you, but a good way to deal with costly routines during your main loop, is to NOT try to solve everything in the same frame. For example if you need 25 linepicks to reach your solution, Split your routine so (for example) it does do more than 4 linepicks per main loop - so it doesnt kill your frame rate. As a result your Npcs will need more time to 'think' about the solution, but thats only realistic, and still only a matter of milliseconds...<br><br>D. <br><br></td></tr></table><br>
<a name="1137521"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rroff</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> ^^ Also AI generally doesn't need to be updated every frame for things like path finding/movement - infact most AI stuff won't need to be done more than at about 10fps which give a good compromise between them reacting to stuff quickly enough but also giving them some "thinking" time. The only potential issue then is uneven frametimes creating "lumpy" rendering performance makign the game feel unsmooth but thats something thats possible to work around i.e. like you said distributing the payload over multiple frames when needed. <br><br></td></tr></table><br>
<a name="1137523"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Danny</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> And you can actually use it to your advantage. Put low-priority npcs in a queue, and play an animation where they scratch their beard, look around if lost, etc whilst their routines are waiting to be served ;)  it's fun stuff to toy around with.. <br><br></td></tr></table><br>
<a name="1137546"></a>

<a name="1137547"></a>

<a name="1137548"></a>

<a name="1137549"></a>

<a name="1137550"></a>

<a name="1137551"></a>

<a name="1137553"></a>

<a name="1137554"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> And if the environments of your levels are non-dynamic (they aren't destructable or change while playing), you can pre-calculate the visibility all nodes have of eachother, and which zones give access to which nodes.<br><br>Having 'n' nodes, node visibility would be a <b>bit array</b> (only 'true' or 'false' values) of: NodeVisibility(n, n).<br>-&gt; which 'n' nodes are visible to a certain 'n' node (used for pathfinding).<br><br>Having 'z' zones, each zone's visibility of nodes would be a bit array of: ZoneVisibility(z, n).<br>-&gt; which 'n' nodes are visible for zone 'z' (used to dock the player to the closest visible node and initiate pathfinding). <br><br>Zones are delimited by obstacles and the shape of the level - depending on which zone the player is at, he won't be able to see certain nodes (if I'm not mistaken this is what RemCoder's been concerned about). Zones don't overlap with eachother.<br>Somewhat similar to NavMeshes.<br><br>Pack all this data in those look-up tables (which are nothing more than arrays smartly indexed for loop efficiency) and you got lightning fast path-finding without doing anything real-time except reading data.<br><br><div class="quote"> Pre-calculate, pre-calculate &amp; pre-calculate. That's the way AAA games do it.™ <br></div><br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1137557"></a>

<a name="1137558"></a>

<a name="1137559"></a>

<a name="1137560"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Danny&gt;&gt;Good idea. I can run a "try to see where the player is" animation when a npc enters a new room, and during this time i have all the time i need to calculate what is the start node (near the npc) and the end node (near the player).<br>Thanks :)<br><br><br>Kryzon&gt;&gt;All you say is ok, i already use zones and i have already precalculated the links between the nodes of each zone.<br>However when a npc detects the player, the routine must determine what is the nearest and accessible node from the npc, and what is the nearest and accessible node to the Player, and this requires a distance check and a path check (with linepick or the movement of  a collider sphere).<br><br>Interesting topic :)<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1325808"></a>

<a name="1325809"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> What Danny and Rroff mentioned are very good concepts to always keep in mind : for AI, you don't need to calculate everything for each AI, each frame, it could be one AI per frame, or one part of an AI (sense, think, act) per frame, but the player will not  notice it since there are usually 15-30 frames (updates) per second... <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
