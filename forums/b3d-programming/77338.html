<!DOCTYPE html><html lang="en" ><head ><title >Drawing triangles quickly</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Drawing triangles quickly</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Drawing triangles quickly</a><br><br>
<a name="865330"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >amitjf</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I need to draw many triangle shapes on a texture quickly(either red or blue). can someone suggest the quickest way to do that? <br><br></td></tr></table><br>
<a name="865334"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> All the same size? Or different sizes? Are they supposed to be solid, or alphaed (see through)? <br><br></td></tr></table><br>
<a name="865483"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >amitjf</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> different size and alphaed.<br>if you know how to color a selected triangle on a textured mesh/surface, in an alphaed color it would be better.<br>EDIT:<br>it not must be alphaed, i can use multiple layers. <br><br></td></tr></table><br>
<a name="865525"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, you can use VertexColor() to alter each individual vertex.<br><br>I'm afraid i can't think of any quick way of doing what you need though... <br><br></td></tr></table><br>
<a name="865527"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >amitjf</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> and slow way?<br>quick= not more then ~15 sec for a 2048*2048 bitmap <br><br></td></tr></table><br>
<a name="865532"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Slow would be writepixelfast and readpixel fast.<br><br>What i'd do is create a triangle mesh. Entitycolor it the colour i need, and scale it the scale i need. Then, renderworld, readpixel on the triangle and copy the whole thing onto the texture. Obviously missing any black pixels, and manually writeing the alpha info at the same time.<br><br>I'd say about 0.3 secs per triangle tops. Depends on the size of course. Very large triangles will take alot more time. <br><br></td></tr></table><br>
<a name="865535"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >amitjf</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, I think I will need here an external .net program using gdi+. does blitz supports gdi+? <br><br></td></tr></table><br>
<a name="865539"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't think so. Can you explain more about what your trying to do? <br><br></td></tr></table><br>
<a name="865542"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >amitjf</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm having a b3d textured(2048*2048) model loaded to blitz(done). Now i have the camera movin there using keys and mouse(done). now i also want that when user press a specified key all the visible polygons to the camera on the model(done) would be coloured blue and the rest would be red(not done).<br><br>The loaded model may vary. <br><br></td></tr></table><br>
<a name="865548"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> In which case use vertexcolor .... you can also use the optional alpha parameter if you set entityfx to 2+32.<br><br>First unweld the mesh if you haven't already done so to ensure you can colour each individual triangle it's own color.  I have a function which does this if you need it.  Next use a function which calculates the triangle normal rather than the averaged shared vertex normal ( as per updatenormals ) function ..<br><br><pre class=code>
Function MESHnormals( mesh )

	For su = 1 To CountSurfaces(mesh )
		s = GetSurface( mesh , su )

		For t = 0 To CountTriangles( s )-1
			v0 = TriangleVertex( s, t, 0 )
			v1 = TriangleVertex( s, t, 1 )
			v2 = TriangleVertex( s, t, 2 )
			ax# = VertexX( s, v1 ) - VertexX( s, v0 )
			ay# = VertexY( s, v1 ) - VertexY( s, v0 )	
			az# = VertexZ( s, v1 ) - VertexZ( s, v0 )	
			bx# = VertexX( s, v2 ) - VertexX( s, v1 )
			by# = VertexY( s, v2 ) - VertexY( s, v1 )	
			bz# = VertexZ( s, v2 ) - VertexZ( s, v1 )	
			Nx# = ( ay * bz ) - ( az * by )
			Ny# = ( az * bx ) - ( ax * bz )
			Nz# = ( ax * by ) - ( ay * bx )
			Ns# = Sqr( Nx * Nx + Ny*Ny + Nz*Nz ) 
			Nx = Nx / Ns
			Ny = Ny / Ns
			Nz = Nz / Ns
			
			For v = v0 To v2
				VertexNormal s, v, Nx, Ny, Nz 
			Next
		Next
	Next

End Function
</pre><br><br>Then use a function like so ... by passing both the mesh and the camera entities.<br><br><pre class=code>
Function TRIScolor( Mesh , Camera )

	;set mesh to vertexcolor
	EntityFX Mesh, 2

	;get cameras direction normal
	TFormNormal 0,0,1,Camera, 0
	CamNx# = TFormedX()
	CamNy# = TFormedY()
	CamNz# = TFormedZ()

	For su = 1 To CountSurfaces( Mesh )
		s = GetSurface( Mesh , su )
		For t = 0 To CountTriangles( s ) - 1
		
			;get first vertex in triangle - normals should be same on each
			v0 = TriangleVertex( s, t, 0 )
			TriNX# = VertexNX( s, v0 )
			TriNy# = VertexNY( s, v0 )
			TriNz# = VertexNZ( s, v0 )			 
			
			;compute dot product of camera normal and tri normal
			CdotN# = CamNx*TriNx + CamNY * TriNy + CamNz * TriNz
			
			If CdotN &lt; 0 Then
			
				;triangle facing camera - color red
				For v = v0 To v0 + 2
					VertexColor s, v, 255,0,0
				Next
			
			Else
			
				;triangle not facing camera - color white
				For v = v0 To v0 + 2
					VertexColor s, v, 255,255,255
				Next
			
			EndIf

		Next
	Next
	
End Function
</pre><br><br>Stevie <br><br></td></tr></table><br>
<a name="865555"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >amitjf</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> thank you very much. somewhy the algorithm for finding the facing triangles is not fine, because... it just wrong, it colours me some wrong triangles and some wont be coloured. When using the function I refer to the camera pivot and not the camera itselfs as its parent is the pivot.<br>EDIT:<br>Wait checking again.... don't respond<br><br>EDIT:<br>Checked and yes it not workin right<br>In every place im placing the camera it shows the same. just rotating the camera change the colors <br><br></td></tr></table><br>
<a name="865578"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oops, sorry just typed that in without proper testing ..  forgot to transform the vertex normal into worldspace coords.<br><br>This works ..<br><br><pre class=code>
Function TRIScolor( Mesh , Camera )

	;set mesh to vertexcolor
	EntityFX Mesh, 2+4

	;get cameras direction normal
	TFormNormal 0,0,1,Camera, 0
	CamNx# = TFormedX()
	CamNy# = TFormedY()
	CamNz# = TFormedZ()

	For su = 1 To CountSurfaces( Mesh )
		s = GetSurface( Mesh , su )
		For t = 0 To CountTriangles( s ) - 1
		
			;get first vertex in triangle - normals should be same on each
			v0 = TriangleVertex( s, t, 0 )
			TFormVector VertexNX( s, v0 ), VertexNY( s, v0 ) , VertexNZ( s, v0 ) , Mesh , 0
			TriNx# = TFormedX() 
			TriNy# = TFormedY() 
			TriNz# = TFormedZ() 			 
			
			;compute dot product of camera normal and tri normal
			CdotN# = CamNx*TriNx + CamNY * TriNy + CamNz * TriNz
			
			If CdotN &lt;= .001 Then
			
				;triangle facing camera - color red
				For v = v0 To v0 + 2
					VertexColor s, v, 255,0,0
				Next
			
			Else
			
				;triangle not facing camera - color white
				For v = v0 To v0 + 2
					VertexColor s, v, 255,255,255
				Next
			
			EndIf

		Next
	Next
	
End Function
</pre> <br><br></td></tr></table><br>
<a name="865582"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >amitjf</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Not working yet. only the rotation of the camera change the colors. I need that when i am on a specified place it would color different the model than on another position.<br>EDIT:<br>I thought about it and I may didn't explained myself well. i need to detect if i pass a line from the triangle to the camera, would be there any other triangles in the way. <br><br></td></tr></table><br>
<a name="865615"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> If there are other triangles in the way then the triangle is probably hidden from view so you wouldn't be able to see the colour?<br><br>Sorry but you're still not making perfect sense?  Tell us what the purpose of this function would be in game. <br><br></td></tr></table><br>
<a name="865829"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >amitjf</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok sorry. I have 2 cameras. one above the model(top view) and one is the character. when running this function, a line would be passed to every single triangle and would check whether there are triangles in the way or not. if there aren't,  the camera can see the triangle and it would be colored red. if there are some in the way, the camera cant see it, and the triangle would colored blue or white and some of them might be visible for the camera of the top view.<br><br>EDIT:<br>It just like EntityVisible, but for Entity-Triangle instead of Entity-Entity mode. <br><br></td></tr></table><br>
<a name="865920"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well that's a fair bit different from what you originally posted!!<br><br>Ok, I can't think of a faster solution atm.  This will likely be slow due to the number of linepicks required.<br><br>......<br><br>* Make the level geometry pickable : entitypickmode 2.<br>* Set each mesh to vertexcolor : EntityFX Mesh, 2<br>* In the function below, the 'Viewer' is whatever entity you want the triangles to be coloured in relation to.  It can be a camera, entity, pivot etc..<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Function TRIScolor( Mesh , Viewer )

	;get viewers direction normal
	TFormNormal 0,0,1,Viewer, 0
	CamNx# = TFormedX()
	CamNy# = TFormedY()
	CamNz# = TFormedZ()

	For su = 1 To CountSurfaces( Mesh )
		s = GetSurface( Mesh , su )
		For t = 0 To CountTriangles( s ) - 1
		
			;get vertices in triangle - normals should be same on each
			v0 = TriangleVertex( s, t, 0 )
			v1 = TriangleVertex( s, t, 1 )
			v2 = TriangleVertex( s, t, 2 )
			
			;get triangle normal in world space coords
			TFormVector VertexNX( s, v0 ), VertexNY( s, v0 ) , VertexNZ( s, v0 ) , Mesh , 0
			TriNx# = TFormedX() 
			TriNy# = TFormedY() 
			TriNz# = TFormedZ() 			 
			
			;compute dot product of camera normal and tri normal
			CdotN# = CamNx * TriNx + CamNY * TriNy + CamNz * TriNz
			
			;default rgb to white
			tR = 255
			tG = 255
			tB = 255
			
			If CdotN &lt;= .000001 Then

				;this triangle is facing camera so check whether obscured
			
				;get vertex positions in world space coords
				TFormPoint VertexX( s, v0 ) , VertexY( s, v0 ) , VertexZ( s, v0 ), mesh, 0
				vx0# = TFormedX() : vy0# = TFormedY() : vz0# = TFormedZ()
				TFormPoint VertexX( s, v1 ) , VertexY( s, v1 ) , VertexZ( s, v1 ), mesh, 0
				vx1# = TFormedX() : vy1# = TFormedY() : vz1# = TFormedZ()
				TFormPoint VertexX( s, v2 ) , VertexY( s, v2 ) , VertexZ( s, v2 ), mesh, 0
				vx2# = TFormedX() : vy2# = TFormedY() : vz2# = TFormedZ()

				;find the mid point	of triangle			
				gtx# = ( vx0 + vx1 + vx2 ) / 3.0
				gty# = ( vy0 + vy1 + vy2 ) / 3.0
				gtz# = ( vz0 + vz1 + vz2 ) / 3.0
				
				;get direction vector from viewer to triangle mid point
				Dx# = gtx - EntityX( viewer, 1 )
				Dy# = gty - EntityY( viewer, 1 )
				Dz# = gtz - EntityZ( viewer, 1 )

				;do line pick from viewer to triangle mid point				
				Picked = LinePick( EntityX( viewer , 1 ) , EntityY( viewer , 1 ) , EntityZ( viewer , 1 ) , Dx, Dy , Dz )
				If PickedTriangle() &lt;&gt; t
				  ;this triangle is obscured by another so set rgb to red
					tR = 255
					tG = 0
					tB = 0
				EndIf

			EndIf
	
			;color this triangle
			For v = v0 To v2
				VertexColor s, v, tR, tG , tB
			Next

		Next
	Next
	
End Function
</textarea><br><br>If it still doesn't work for you then you will need to either send or post me some code.<br><br>Stevie <br><br></td></tr></table><br>
<a name="865934"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >amitjf</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> "now i also want that when user press a specified key all the visible polygons to the camera on the model..." but nvm. Thank you very much for your help, most of the triangles are colored correct, some aren't maybe if ill change the model it would be better. <br><br></td></tr></table><br>
<a name="865937"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Your welcome.  Try playing about with the .000001 threshold for determining whether a poly is facing the camera.  <br><br>Alternatively, post your code. <br><br></td></tr></table><br>
<a name="867252"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Axel Wheeler</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is probably several days late and dollars short, but:<br><br>Why not put a bright blue spotlight at the camera position?  Depending on your needs this might suit and would be fast and easy, although:<br><br>- It would also light up other objects (but not the player's ship itself if you do it right)<br><br>- It would not be a pure blue color, but would alter the base texture color according to distance and angle.<br><br>If you can tolerate those factors, it might simplify things. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
