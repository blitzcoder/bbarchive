<!DOCTYPE html><html lang="en" ><head ><title >Freeing single-surface "sprites" (quads)</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Freeing single-surface "sprites" (quads)</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Freeing single-surface "sprites" (quads)</a><br><br>
<a name="585268"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >octothorpe</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> As part of my ongoing strategy to reinvent as many wheels as I possibly can, I'm writing a single-surface pixel-perfect sprites system using quads.  I'm stuck on how to remove quads no longer in use.<br><br>Are there more options available than these two?<br><br>1. rebuild the entire surface without that one quad (I reckon this might be a little slow)<br><br>2. move the vertices off-screen and tag them for re-use later if I need another quad on that surface <br><br></td></tr></table><br>
<a name="585271"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Not really :o) <br><br></td></tr></table><br>
<a name="585272"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jhocking</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Recycling is generally the way to go, although for a general purpose system I'm not sure how to make sure you're moving them off-screen.  Maybe move all the vertices to a single point so that the polygon isn't visible? <br><br></td></tr></table><br>
<a name="585309"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Would recommend recycling ...<br><br>If you set entityfx to 32+2 then you can set the vertexalpha on the individual vertices for the quad to 0 ... the it won't be rendered at all.<br><br>Stevie <br><br></td></tr></table><br>
<a name="585317"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Pickford</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I used to hide the unused ones, but I switched to rebuilding the surface every frame.   Very slightly slower 'worst case' but most of the time this works out much faster. <br><br></td></tr></table><br>
<a name="585390"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >octothorpe</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the feedback, everyone!  I especially like the VertexAlpha idea as it seems very intuitive to me.<br><br>John Pickford: that seems odd to me.  Do you have any theories on why rebuilding the entire surface every frame might be faster?  Is it because your quads don't end up being recycled as much as was hoped and the increased triangle count slows down rendering? <br><br></td></tr></table><br>
<a name="585469"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Pickford</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Generally you'll be repositioning each active quad every frame anyway which isn't much different in CPU terms from building it from scratch.<br><br>Even if you alter only one vertex position the whole mesh gets re-sent to the video card anyway.    Rebuilding each time means that the mesh is only ever as big as it needs to be. <br><br></td></tr></table><br>
<a name="585501"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> John, do you free the mesh and create a new one each time, or do you keep the same mesh but just clear the verts/tris from it? Just wondered if one way was slightly faster than the other. Probably not, though. <br><br></td></tr></table><br>
<a name="585959"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Pickford</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I free the mesh each time. <br><br></td></tr></table><br>
<a name="586003"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Right. I'm just curious whether using ClearSurface would be slightly quicker. Maybe even just clear the triangles and leave the verts of 'deleted' quads unconnected, until they're needed again. <br><br></td></tr></table><br>
<a name="586011"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Techlord</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've performed test with single surface sprites and you cannot free them individually. You can only clear the surface and redraw as John P described.<br><br>You can hide them, but, they are still rendered (at least accounted for with TrisRendered()). <br><br></td></tr></table><br>
<a name="590269"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >octothorpe</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> I just ran a comparison between repositioning 1000 quads' verticies and re-adding them after a clearsurface().  Repositioning was faster by 2fps, which on my machine is the equivilent of rendering roughly 1800 more quads.<br><br>1.6GHz P4, nVidia GeForce 4 MX 440<br><br>A combination of the two techniques would be pretty cool: queuing surfaces to be rebuilt when a threshold percentage of the quads on it are not in use - and restricting rebuilding to one surface per render.<br><br>I haven't tried freeing the entire mesh yet to see if that makes a difference.  I imagine that would be even slower.<br><br>For now I'm going to go the simple route: clear my surfaces when I load a new map (this will happen frequently with my game - a 2d platformer) and hope I don't accumulate too many unused quads in the meantime! <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
