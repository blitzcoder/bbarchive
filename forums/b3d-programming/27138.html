<!DOCTYPE html><html lang="en" ><head ><title >How do you handle Momentum?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >How do you handle Momentum?</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >How do you handle Momentum?</a><br><br>
<a name="284096"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PaulF</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I know that there is a lot of information on collisions in these forums, but I can't seem to find anything which addresses my particular query.  I hope that some of you out there will be able to help.<br><br>From what I've read, and have found by experimenting, for any collision between two spheres, the contents of the collision table indexed by CountCollisions(entity) seems to vary depending upon the circumstances of the collision.  i.e whether both objects are travelling in opposing directions, both in the same direction but at differing speeds, or if either is stopped.<br><br>Sometimes there seem to be multiple entries for the same entity, I guess if there have been multiple collisions within a single UpdateWorld.<br><br>It appears that once a collision has happened, there may be one, two or even more entries in the collision table for the same event.  I know that if these were collisions with infinite mass objects, this would probably not matter since the rebounds of each can be calculated from the collision normals for each, but if one is trying to handle the momentum properly, collecting all entries which relate to the same event seems to be tricky, to say the least.<br><br>Am I understanding things properly, and is there an 'approved' method of linking up these entries, or am I missing something and in reality its all extremely easy? <br><br></td></tr></table><br>
<a name="284101"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rob Farley</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Check the code archives<br><br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=751" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=751</a> <br><br></td></tr></table><br>
<a name="284106"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PaulF</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Many thanks for that speedy reply.  I missed that example in the code archives and it is certainly very interesting.<br><br>Whilst it does thoroughly answer part of my query, it doesn't in any way answer the query as to how the collision table is populated by Blitz3D.<br><br>From further experimentation, you seem to get one entry if two spheres collide whilst one is stopped, two entries if they are both moving at similar velocities, and three entries if their speeds vary considerably. (And not surprisingly, no entries if they are both stopped!!)<br><br>I think I'm comfortable as to why that should be, but would like to feel that my findings can be relied upon. Also, are there circumstances when the same two spheres can cause 4 or more entries in the collision table?<br><br>The example to which you referred completely avoids the normal collision mechanism, and whilst its a fascinating way to do things, I shudder to think how it could be developed into a general solution in a more complicated 3D world.<br><br>Can anyone point me to an article which fully explains the collision table? <br><br></td></tr></table><br>
<a name="284119"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Paul:<br>I've been using Blitz3D for a long time, and I've never heard of more than one collision being reported when two objects collide.  I doubt that you will find any information on that.  I also don't reccomend that you assume that more than one collision will be reported when two objects are moving at certain speeds.  It seems very likely that that would change in the future, as only a single collision should be reported in a properly functioning collision system that functions as Blitz's does.<br><br>I do know that Blitz's collision system doesn't handle most collisions between moving objects correctly and that Mark has mentioned that it needs to be fixed.  Mark designed the system so that objects that collide will not interpenetrate, but when more than one object is moving and they collide, they do interpentrate, and that's an issue that needs to be corrected.  The fact that the two objects are interpenetrating is likely what leads to the erroneous reporting of multiple collisions.<br><br>I thought the one exception to the moving object interpenetration issue was between moving spheres, and that collisions between these could be relied upon.  However, if what you say is true, then that is clearly not the case.<br><br>I suppose it's possible Mark broke moving sphere collisions when he implemented ellipsoid collisions.  <br><br>Some folks were complaining in the bug reports forum about ellipsoid collisions not working as expected.  I think some other folks also complained about regular sphere collisions being broken in some way as a result as well. <br><br></td></tr></table><br>
<a name="284122"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rob Farley</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> In my latest project I've noticed that with basic sphere-polygon collision the sphere sometimes drops through the mesh. I can't seem to find any rhyme or reason why this happens but it does... bloody annoying... trying to find a way round it. <br><br></td></tr></table><br>
<a name="284189"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PaulF</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> OK - You may shoot me down in flames for this, but here's the program with which I've been testing.<br>Apologies for the sloppy code, but that wasn't the idea of this.<br><br>I would prefer that I'm doing something wrong here because if it's a bug, surely it could be quite significant.<br><br>Assuming I've not made a boo-boo, could someone please explain just how this collision table is supposed to work.<br><br>The circumstance with only a single collision recorded when one ball is stopped is reasonable.  I feel that the other cases though need to be explained. - Cases 2 and 5<br><br>; Very unfinished - Test framework only<br>; Run with debug, when it stops, view debug log<br>; then kill program and repeat with different option<br>; Probably I'm doing something wrong but I can't find it<br>; Essentially all these variants are surely the same thing??<br><br>.Begin<br>Global v1#,v2#<br>Print "1 - Opposite Directions Similar Speed (2)"<br>Print "2 - Opposite Directions Differing Speeds (3)"<br>Print "3 - Ball1 Stopped (2)"<br>Print "4 - Ball2 Stopped (1)"<br>Print "5 - Same Directions (1)"<br>Print "6 - Both Stopped (Takes Quite a While)!"<br>Print<br>Print "Which Test 1-6"<br><br>.Here<br>If KeyDown(2) Then v1# = 0.3  : v2# = -0.3  : Goto Doit<br>If KeyDown(3) Then v1# = 1.5  : v2# = -0.02 : Goto Doit<br>If KeyDown(4) Then v1# =   0  : v2# = -0.3  : Goto Doit<br>If KeyDown(5) Then v1# = 0.3  : v2# =     0 : Goto Doit<br>If KeyDown(6) Then v1# = 0.3  : v2# =  0.05 : Goto Doit<br>If KeyDown(7) Then v1# =   0  : v2# =     0 : Goto Doit<br><br>Goto here<br><br>.Doit<br><br>Const Coll_Wall   = 1<br>Const Coll_Ground = 2<br>Const Coll_Ball   = 3<br><br>Const FPS=30<br>Global period=1000/FPS<br>Global time=MilliSecs()-period<br><br>Const ScrWid = 640<br>Const ScrHgt = 480<br><br>Global Camera1_Pivot,Camera1<br><br>Type ball<br>	Field entity<br>	Field index%<br>	Field name$<br>	Field mass#<br>	Field xvel#,yvel#,zvel#<br>End Type<br><br><br>Global collcount<br>Dim collsubj$(20),collobj$(20),colltriangle#(20)<br><br>Dim coltab#(20)<br>Global colmod%<br><br>SetBuffer BackBuffer()<br>Graphics3D ScrWid,ScrHgt<br><br><br><br>Buildworld()<br><br>PositionEntity Camera1,0,15,-20<br>RotateEntity Camera1,30,0,0<br>RotateEntity Camera1_Pivot,0,0,0<br><br>Collisions Coll_Ball,Coll_Ball,1,1<br>														; Main Loop<br>While Not KeyHit(1)<br><br>	Repeat<br>		elapsed=MilliSecs()-time<br>	Until elapsed<br><br>	ticks=elapsed/period<br>	tween#=Float(elapsed Mod period)/Float(period)<br>	<br>	For k=1 To ticks<br>		time=time+period<br>		If k=ticks Then CaptureWorld<br>		UpdateBalls()<br>		UpdateWorld<br>	Next<br>	<br>	RenderWorld tween<br><br>	Flip<br>Wend<br><br>End<br><br>Function BuildWorld()<br>	Cls<br>	HidePointer<br>	AmbientLight(255,255,255)<br>	<br>	Camera1_Pivot = CreatePivot()<br>	PositionEntity Camera1_Pivot,0,0,0<br>	Camera1 = CreateCamera(Camera1_Pivot)<br>	<br>	Board = CreateCube()<br>	ScaleMesh Board,20,0.2,20<br>	EntityColor Board,100,200,100<br>	EntityType Board,Coll_Ball<br>	EntityRadius board,2<br>	PositionEntity Board,0,-0.2,0<br><br>	b.ball = New ball				; Yellow Ball<br>	b\index% = 1<br>	b\name$ = "Yellow"<br>	b\entity = CreateSphere()<br>	EntityColor b\entity,255,255,20<br>	EntityType b\entity,Coll_Ball<br>	ScaleEntity b\entity,2,2,2<br>	EntityRadius b\entity,2<br>	PositionEntity b\entity,-10,10,10<br>	b\mass# = 1<br>	b\xvel# = v1#<br>	b\yvel# = 0<br>	b\zvel# = 0<br>	<br>	b.ball = New ball				; Magenta Ball<br>	b\index% = 2	<br>	b\name$ = "Magenta"<br>	b\entity = CreateSphere()<br>	EntityColor b\entity,255,0,255<br>	EntityType b\entity,Coll_Ball<br>	ScaleEntity b\entity,2,2,2<br>	EntityRadius b\entity,2<br>	PositionEntity b\entity,10,10,10<br>	b\mass# = 1<br>	b\xvel# = v2#<br>	b\yvel# = 0<br>	b\zvel# = 0<br><br>End Function<br><br><br>Function UpdateBalls(dt#=1);<br>	DebugLog "UpdateBalls Begins"<br>	collcount = 0<br>	For b.ball = Each ball<br>	  c = CountCollisions(b\entity)<br>	  If c = 0 Then	; No collision<br>		DebugLog "No collisions for ball "+b\name$<br>	  Else<br>		For i = 1 To c												; For each collision for this ball<br>		  collcount% = collcount% + 1								; Store Index of collision object<br>		  d$ = "" <br>		  d$ = d$ + b\name$ + "-"<br>		  collsubj$(collcount%) = b\name$<br>		  ent = CollisionEntity(b\entity,i)<br>		  For b2.ball = Each ball									; Find name of collision object<br>			If ent = b2\entity Then<br>			  collobj$(collcount%) = b2\name$<br>			  d$ = d$ + b2\name$ + " "<br>			  Nx# = CollisionNX#(b\entity,i)						; Get Collision Suface Normals<br>			  Ny# = CollisionNY#(b\entity,i)	<br>			  Nz# = CollisionNZ#(b\entity,i)		<br>			  VdotN# = (b\xvel#*Nx#)+(b\yvel#*Ny#)+(b\zvel#*Nz#)	; Vector Product<br>			  NFx# = -2 * Nx# * VdotN#								; Normal Force (direction)<br>			  NFy# = -2 * Ny# * VdotN#<br>			  NFz# = -2 * Nz# * VdotN#						<br>			  b\xvel# = b\xvel# + NFx#				<br>			  b\yvel# = b\yvel# + NFy#<br>			  b\zvel# = b\zvel# + NFz#<br>			EndIf<br>		  Next<br>		  DebugLog d$<br>		Next<br>	  EndIf<br>	Next<br><br>	<br>	For b.ball = Each ball	<br><br>		TranslateEntity (b\entity,b\xvel#,b\yvel#,b\zvel#)<br>	Next<br>	ShowStats()<br>	DebugLog "UpdateBalls Ends"<br>	DebugLog ""<br>End Function<br><br><br>Function ShowStats()<br><br>	If collcount &gt; 0<br>		Text 10,10,Str(collcount) + " Collisions Logged"	<br>		For j = 1 To collcount<br>			Text 10,30+(j*15),collsubj$(j)+"-"+collobj$(j)+" "<br>		Next<br>		Flip<br>		Stop<br>	End If<br><br><br>End Function<br><br><br>My thanks go to anyone who cares to explain. <br><br></td></tr></table><br>
<a name="284190"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Would that mesh happen to be a terrain?<br><br>Terrains change their meshes dynamically as you move around.  A polygon which had a sharp indentation a moment ago beneath the sphere, may suddenly get smoothed over as more detail is added, resulting in the sphere interpenetrating the mesh.  Interpenetration breaks the collision system.<br><br>Of course I'm just guessing that Mark didn't code some workaround to this issue into his terrain system. <br><br></td></tr></table><br>
<a name="284498"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PaulF</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I realise now that I probably asked the wrong question at the start of this thread!<br><br>Can anyone please tell me if this is a bug or am I just not unerstanding.<br><br>Thanks. <br><br></td></tr></table><br>
<a name="284518"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm pretty sure it's a bug.  If you want to do collisions between two moving spheres, you may have to write your own sphere to sphere collision routine. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
