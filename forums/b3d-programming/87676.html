<!DOCTYPE html><html lang="en" ><head ><title >child coordinates from AnimMesh</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >child coordinates from AnimMesh</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >child coordinates from AnimMesh</a><br><br>
<a name="994253"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >semar</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> All,<br>basically the question is: how to get the 3D world coordinates of a child entity contained in a mesh, which has been loaded into B3D with LoadAnimMesh ?<br>The coordinates I get are always 0,0,0, even if in the .b3D model, the cube is located in another place than 0,0,0.<br><br>I wonder why ?<br><br>I describe the steps I follow:<br><pre class=code>

mesh = LoadAnimMesh("test.b3d")
child = FindChild(mesh,"cube01")
Print EntityX(child) ;prints 0
Print EntityY(child)
Print EntityZ(child)
</pre><br><br>Now, using EntityX(child,true) or EntityX(child) makes no difference. I still get 0 - for all three coordinates.<br><br>I've seen, there's a workaround to this problem; using TFormVector on a surface of the child, and then using TFormedX and the like.<br><br>But doing so, I obtain the coordinates of a vertex surface, while I need to get the center of the child entity.<br><br>I explain the scenario where I'm working on, to give a better understanding.<br><br>I'm creating a 3d level - a dungeon for example.<br>In the level, I put other entities to be used as 'torches'. Then, there will be put a particle emitter at each torch coordinates.<br><br>Now, I need to get the right coordinates of the torches, in order to attach the particle emitters in a correct way.<br><br>How would you do that ? Would you use a different approach to accomplish this task ?<br><br>[EDIT]Seems that loading a .x file does give the right coordinates for the child. So does the B3D format retain the child coordinates, or is it flawed ? (or perhaps the problem is located in the B3D exporter that DeleD 3D uses...) <br>???<br><br>[EDIT 2]<br>So I've found two solutions:<br>1) export the model as .X file. Then, EntityX(child,true) does provide the right 3D World coordinates of the child entity.<br><br>- OR -<br>2) use the .B3D file, but instead of EntityX(child,true), which sadly provides always 0, use this function instead:<br><pre class=code>
For i = 1 To CountSurfaces(child)
surf = GetSurface(child,i)
nb_vert = CountVertices(surf)
tot_nb_vert = tot_nb_vert + nb_vert
For j = 0 To (nb_vert - 1)
x = x + VertexX(surf,j)
y = y + VertexY(surf,j)
z = z + VertexZ(surf,j)
Next
Next

;then the x,y,zcoords are : x/tot_nb_vert,y/tot_nb_vert,z/tot_nb_vert 
</pre><br><br><br>Sergio. <br><br></td></tr></table><br>
<a name="994333"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Charrua</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> hi<br>i think you have to use the Global flag.<br>i you don't use it, you have the coords relative to the parent.<br>if an entity haven't a parent EntityX returns the global coordinates but ir it has one, then, ir returns the position of the child relative to it parent,<br><br>hope it helps<br><br>(sorry, i didn't read all the thread, oviously didn't help!)<br><br>juan <br><br></td></tr></table><br>
<a name="994459"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >semar</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Mucias gracias, pero hay siempre lo mismo problemo !<br><br>Thanks, but the problem still remains. The function I've posted must be used in order to retrieve the correct coordinates.<br><br>Hasta luego,<br>Sergio. <br><br></td></tr></table><br>
<a name="994476"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Charrua</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> i have little or no experience with loadanimesh and 3d formats in general, but i think that is the Exporter you are using.<br><br>See the demo example of Giles (you know it?) in the .bb they give, they use GetChild to search (recursively) for specific objects (to get custon variables) and i inserted EntityX, Y and Z (after each entity is reached) with and without global flag and both game the correct 3d world coordinates. (working with a .b3d).<br><br>try to ger another exporter, is it posibly, or a config setting on the software, may be?<br><br>Juan <br><br></td></tr></table><br>
<a name="994486"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is a common problem i've found. You need to loop through every vertex in the child mesh, and find the centre co-ord.<br><br>What happens is the centre of the mesh, upon using loadanimmesh, is the same as the centre of any attached mesh. The mesh seems to have been rebuild off it's axis. I first noticed this when using Gile[s]. Your entity you import will rotate about it's own centre axis fine and well, until you save the scene (or export as .b3d). Upon loading the whole mesh still has it's seperate entities, but they now all share the same centre point, mesh wise and entity wise.<br><br>So anyway, you need to:<br>- loop through all the vertices in the child mesh,<br>- find the centre point using that information,<br>- move the MESH (PositionMesh?) the opposite of the centre point, so it's positioned back at the 0,0,0 ,<br>- move the ENTITY back to the centre point location<br><br>I'm sure someone created a function for this... <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
