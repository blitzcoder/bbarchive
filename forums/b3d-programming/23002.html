<!DOCTYPE html><html lang="en" ><head ><title >Lost normals ...</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Lost normals ...</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Lost normals ...</a><br><br>
<a name="236806"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >necky</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>   I have a problem with my code below, for some reason once I've rebuilt my mesh I can't seem to get the vertex normals for the new model? It's also refusing to accept any light. I've looked over my code and it seems to be okay and I'm now at a loss at what could be causing the problem.<br><br>  If anyone could help I'd be very grateful :)<br><br>thanx,<br>        Mike    <br><br>;-----------Code starts here -----------<br><br>;********************<br>;*                  *<br>;* Shoot to Deflate *<br>;*                  *<br>;*  by Mike Oakley  *<br>;*                  *<br>;********************<br><br>Graphics3D 640,480,32,2<br><br>SetBuffer BackBuffer()<br><br>;AmbientLight 0,0,0<br><br>Global sphere=CreateSphere()<br>EntityPickMode sphere,2<br><br>Global camera=CreateCamera()<br>MoveEntity camera,0,0,-2<br><br>;Global light=CreateLight()<br>;MoveEntity light,0,0,3<br><br>Global xa#,xb#,xc#,ya#,yb#,yc#,za#,zb#,zc#<br>Global vxa,vya,vxb,vyb,vxc,vyc,nx,ny<br><br>Global verta,vertb,vertc<br>Global newpointx#,newpointy#,newpointz#<br>Global tria,trib,tric<br>Global tx#,ty#,tz#<br>Global pp<br>Global gbb<br><br>Dim vertsmain#(CountVertices(GetSurface(sphere,1))*2,2)<br>Dim verts#(CountVertices(GetSurface(sphere,1))*2,2)<br>Dim tris#(CountTriangles(GetSurface(sphere,1))*2,2)<br>Dim newfaces(CountTriangles(GetSurface(sphere,1))*2,2)<br>Dim wobblepos#(CountVertices(GetSurface(sphere,1))*2)<br>Dim tVertexN#(CountVertices(GetSurface(sphere,1))*2,2)<br>Dim Sine#(360)<br><br>While gg&lt;360<br>	Sine#(gg)=Sin(gg)<br>	gg=gg+1<br>Wend<br>gg=0<br><br>gp=0<br><br>While gp&lt;CountVertices(GetSurface(sphere,1))*2<br><br>	wobblepos#(gp)=Rnd(0,360)<br>	gp=gp+1<br>	<br>Wend<br><br>While gk&lt;CountVertices(GetSurface(sphere,1))<br><br>	vertsmain#(gk,0)=VertexX#(GetSurface(sphere,1),gk)<br>	vertsmain#(gk,1)=VertexY#(GetSurface(sphere,1),gk)<br>	vertsmain#(gk,2)=VertexZ#(GetSurface(sphere,1),gk)<br>	gk=gk+1<br><br>Wend<br><br>gk=0<br><br>WireFrame 1<br><br>;********<br>;* MAIN *<br>;********<br><br>While Not KeyDown(1)=1<br><br>Cls<br><br>r#=r#+0.5<br><br>;If MouseHit(1)=True Then CameraPick(camera,MouseX(),MouseY()):gettridata():getmeshdata():rebuildmesh()<br><br>wobblemesh():UpdateWorld():getmeshdata():UpdateWorld():rebuildmesh()<br><br>RotateMesh sphere,0,r,r<br><br>UpdateWorld()<br>RenderWorld()<br><br>printtext()<br><br>Flip<br><br>Wend<br><br>;*****************<br>;* Get Mesh Data *<br>;*****************<br><br>Function getmeshdata()<br><br>vv=0<br>ff=0<br><br>Local vertices=CountVertices(GetSurface(sphere,1))<br>Local faces=CountTriangles(GetSurface(sphere,1))<br><br>While vv&lt;vertices<br>	<br>	verts#(vv,0)=vertsmain#(vv,0)	<br>	verts#(vv,1)=vertsmain#(vv,1)<br>	verts#(vv,2)=vertsmain#(vv,2)<br>	<br>	vv=vv+1<br>Wend<br>vv=0<br><br>While ff&lt;faces<br><br>	tris#(ff,0)=TriangleVertex(GetSurface(sphere,1),ff,0)<br>	tris#(ff,1)=TriangleVertex(GetSurface(sphere,1),ff,1)<br>	tris#(ff,2)=TriangleVertex(GetSurface(sphere,1),ff,2)<br>	ff=ff+1<br><br>Wend<br>ff=0<br><br>vv=0<br>While vv&lt;vertices<br>	<br>	tVertexN#(vv,0)=VertexNX#(GetSurface(sphere,1),vv)<br>	tVertexN#(vv,1)=VertexNY#(GetSurface(sphere,1),vv)<br>	tVertexN#(vv,2)=VertexNZ#(GetSurface(sphere,1),vv)<br>	<br>	If gbb&lt;2 Then DebugLog vv+" = "+VertexNX#(GetSurface(sphere,1),vv)<br>	<br>	vv=vv+1<br>Wend<br>vv=0<br><br>If gbb=0 Then DebugLog "================================"<br>gbb=gbb+1<br><br>End Function<br><br>;****************<br>;* Rebuild Mesh *<br>;****************<br><br>Function rebuildmesh()<br><br>vv=0<br>ff=0<br><br>Local vertices=CountVertices(GetSurface(sphere,1))<br>Local faces=CountTriangles(GetSurface(sphere,1))<br><br>FreeEntity sphere<br><br>sphere=CreateMesh() <br>CreateSurface (sphere)<br>EntityPickMode sphere,2<br>EntityColor sphere,255,255,255<br>EntityFX sphere,4<br><br>While vv&lt;vertices<br><br>tx#=Sine#(wobblepos#(vv))/40<br>ty#=Sine#(wobblepos#(vv))/40<br>tz#=Sine#(wobblepos#(vv))/40<br><br>;tx#=tVertexN#(vv,0) * Sine#(wobblepos#(vv))<br>;ty#=tVertexN#(vv,1) * Sine#(wobblepos#(vv))<br>;tz#=tVertexN#(vv,2) * Sine#(wobblepos#(vv))<br><br>	AddVertex(GetSurface(sphere,1),verts#(vv,0)+tx#,verts#(vv,1)+ty#,verts#(vv,2)+tz#)<br><br>	vv=vv+1<br><br>Wend<br><br>vv=0<br><br>While ff&lt;faces<br><br>	AddTriangle(GetSurface(sphere,1),tris#(ff,0),tris#(ff,1),tris#(ff,2))<br>	ff=ff+1<br><br>Wend<br>ff=0<br><br>End Function<br><br><br>;****************<br>;* Get Tri Data *<br>;****************<br><br>Function gettridata()<br><br>If PickedTriangle()&lt;65535 Then xa#=VertexX(GetSurface(sphere,1),TriangleVertex(GetSurface(sphere,1),PickedTriangle(),0))<br>If PickedTriangle()&lt;65535 Then ya#=VertexY(GetSurface(sphere,1),TriangleVertex(GetSurface(sphere,1),PickedTriangle(),0))<br>If PickedTriangle()&lt;65535 Then za#=VertexZ(GetSurface(sphere,1),TriangleVertex(GetSurface(sphere,1),PickedTriangle(),0))<br><br>If PickedTriangle()&lt;65535 Then xb#=VertexX(GetSurface(sphere,1),TriangleVertex(GetSurface(sphere,1),PickedTriangle(),1))<br>If PickedTriangle()&lt;65535 Then yb#=VertexY(GetSurface(sphere,1),TriangleVertex(GetSurface(sphere,1),PickedTriangle(),1))<br>If PickedTriangle()&lt;65535 Then zb#=VertexZ(GetSurface(sphere,1),TriangleVertex(GetSurface(sphere,1),PickedTriangle(),1))<br><br>If PickedTriangle()&lt;65535 Then xc#=VertexX(GetSurface(sphere,1),TriangleVertex(GetSurface(sphere,1),PickedTriangle(),2))<br>If PickedTriangle()&lt;65535 Then yc#=VertexY(GetSurface(sphere,1),TriangleVertex(GetSurface(sphere,1),PickedTriangle(),2))<br>If PickedTriangle()&lt;65535 Then zc#=VertexZ(GetSurface(sphere,1),TriangleVertex(GetSurface(sphere,1),PickedTriangle(),2))<br><br>If PickedTriangle()&lt;65535 Then CameraProject(camera,xa#,ya#,za#):vxa=ProjectedX():vya=ProjectedY()<br>If PickedTriangle()&lt;65535 Then CameraProject(camera,xb#,yb#,zb#):vxb=ProjectedX():vyb=ProjectedY()<br>If PickedTriangle()&lt;65535 Then CameraProject(camera,xc#,yc#,zc#):vxc=ProjectedX():vyc=ProjectedY()<br><br>If PickedTriangle()&lt;65535 Then tria=TriangleVertex(GetSurface(sphere,1),PickedTriangle(),0) <br>If PickedTriangle()&lt;65535 Then trib=TriangleVertex(GetSurface(sphere,1),PickedTriangle(),1) <br>If PickedTriangle()&lt;65535 Then tric=TriangleVertex(GetSurface(sphere,1),PickedTriangle(),2) <br><br>newpointx#=(xa#+xb#+xc#)/3<br>newpointy#=(ya#+yb#+yc#)/3<br>newpointz#=(za#+zb#+zc#)/3<br><br>If PickedTriangle()&lt;65535 Then CameraProject(camera,newpointx#,newpointy#,newpointz#):nx=ProjectedX():ny=ProjectedY()<br><br>End Function<br><br><br>;**************<br>;* Print Text *<br>;**************<br><br>Function printtext()<br><br>Text 10,10,"Triangles = "+CountTriangles(GetSurface(sphere,1)),0,0<br>Text 10,25,"Vertices  = "+CountVertices(GetSurface(sphere,1)),0,0<br>Text 10,40,"Surfaces  = "+CountSurfaces(sphere),0,0<br><br>Text 10,80,"tri picked= "+PickedTriangle()<br>Text 10,100,"    tria = "+tria,0,0<br>Text 10,120,"    trib = "+trib,0,0<br>Text 10,140,"    tric = "+tric,0,0<br><br>Text 10,180,"wobblepos#(0)="+(wobblepos#(0)),0,0<br>Text 10,200,"wobblepos#(1)="+(wobblepos#(1)),0,0<br>Text 10,220,"wobblepos#(2)="+(wobblepos#(2)),0,0<br><br>Text 10,260,"tx#= "+tVertexN#(10,0),0,0<br><br>Color 255,255,0<br><br>Rect MouseX()-1,MouseY()-1,2,2<br><br>;While gg&lt;CountVertices(GetSurface(sphere,1))<br>;	Plot gg,100+(100*Sine#(wobblepos#(gg)))<br>;	gg=gg+1<br>;Wend<br>;gg=0<br><br>End Function<br><br>;***************<br>;* Wobble Mesh *<br>;***************<br><br>Function wobblemesh()<br><br>gp=0<br><br>While gp&lt;CountVertices(GetSurface(sphere,1))<br><br>	wobblepos#(gp)=wobblepos#(gp)+8<br>	If wobblepos#(gp)&gt;360 Then wobblepos#(gp)=0<br>	gp=gp+1<br>	<br>Wend<br><br>End Function <br><br></td></tr></table><br>
<a name="236835"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Koriolis</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> You have to use the VertexNormal commands to set the normal of the vertices.<br>Or you could just use UpdateNormals that will set all the normals of a mesh according to his geometry (note that in this case you won't have the control on how the normals are exactly set but in most cases it does exactly what you want anyway). <br><br></td></tr></table><br>
<a name="236927"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >-=Darkheart=-</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I could be totally wrong here but I think you have to use UpdateNormals after you use VertexNormal otherwise it doesn't update them.<br><br>Darkheart <br><br></td></tr></table><br>
<a name="236928"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't think so. I never use UpdateNormals after setting normals manually. Just make sure the normals you set are unified (have a length on 1). <br><br></td></tr></table><br>
<a name="236983"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >necky</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> thanx guys, it was the UpdateNormals that I forgot :) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
