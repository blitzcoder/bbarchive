<!DOCTYPE html><html lang="en" ><head ><title >Terrain problem - height &amp; smoothness</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Terrain problem - height &amp; smoothness</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Terrain problem - height &amp; smoothness</a><br><br>
<a name="897806"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >CakeMonitor</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>I've created a heightmap, adjusted the image levels so it uses the full tonal range from black to white, and applied a gaussian blur to ensure it is smooth. Here is a compressed jpeg version:<br><img src="http://img368.imageshack.us/img368/8522/heightmap2oi5.jpg"><br><br>When I load this image using the LoadTerrain command it appears to be entirely flat - I have to use <pre class=code>ScaleEntity scene, 1, 150, 1</pre>just to get it to look like this:<br><img src="http://img151.imageshack.us/img151/5713/wholeterrainrr2.jpg"><br><br>From a distance this looks fine, but up close you can see what should be a smooth hillside in fact consists of lots of 'flat-step' polygons and 'too-steep' polygons. I've tried to highlight the problem in these two images:<br><img src="http://img161.imageshack.us/img161/3148/terrainproblem1wp1.jpg"><br><img src="http://img161.imageshack.us/img161/4341/terrainproblem2yc1.jpg"><br><br>The red triangles clearly have 3 vertices all at the same height, what I was expecting is for the vertex where a red triangle meets a yellow triangle to be higher... a height about equal to half way up the pink line.<br><br>Has anyone encountered this before?<br>What am I doing wrong?<br><br>Thanks,<br>Martin <br><br></td></tr></table><br>
<a name="897821"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Billp</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> perhaps the guassian blur is the cause, blurring averages the pixels, try less blur or no blur and scale the x,y,z axis to arrive at the desired "steepness" <br><br></td></tr></table><br>
<a name="897824"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >chwaga</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I smell  compression.  Try a totally uncrompressed bitmap, compression tends to average certain groups of colors to save space. <br><br></td></tr></table><br>
<a name="897829"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rob Farley</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> The fact that it's scaled 150 in the y axis means that the smallest incline will be just over .5 a unit tall.<br><br>I think the design of the blitz terrain is built for the LOD hence the wacky 4 triangle stepping thing. It's generally not very good. Also the problem with using the built in terrain is that you only have 256 different heights over the whole thing.<br><br>Personally I build my own terrain system and use a 16 bit value rather than 8, otherwise it will never be smooth unless your terrain is only very slight undulations. <br><br></td></tr></table><br>
<a name="897862"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >chwaga</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> true. <br><br></td></tr></table><br>
<a name="897961"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >CakeMonitor</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks everyone for the help and advice.<br><br>I since tried creating a .b3d terrain mesh in milkshape and loading that, but I ran into some different problems there. I've read some other info on pros and cons of blitz terrains... for what it's worth the LOD stuff is quite useful in my project so I'm going to stick with it for now. However, I figured that I simply don't need as many vertices as were being created (I had to zoom right in to the camera's clip range to get those 'bad' images above)... so I have simply resized my heightmap from 512x512 to 128x128 and increased the X and Z terrain scale by a factor of 4. This reduction of detail has smoothed out my terrain perfectly - even when viewed up close, and Blitz can now put it's 2000 terrain-polygons to better use making the distant regions look better :)<br><br>I hadn't realised that blitz loads terrains with each point at a height between 0.0 and 1.0, that explains why my unscaled version was flat and useless!! - thanks for the tip! <br><br></td></tr></table><br>
<a name="898231"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >D4NM4N</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> make sure you are not using JPEG files. The artifacting causes some nasty chaos sometimes that is similar to that.<br><br>If you are using jpg, i reccomend loading it in a paintapp and doing a blur then save again as png. <br><br></td></tr></table><br>
<a name="898241"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >CakeMonitor</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> the jpeg was just for the forum post. in the actual project i'm already using png files throughout. cheers for the thought though. <br><br></td></tr></table><br>
<a name="898736"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H. T. U.</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I never use jpgs for anything, the compression and other tecniques it uses almost always cause trouble for me.  Every time you use it, the quality gets worse.  Stick to bitmaps if you ask me. <br><br></td></tr></table><br>
<a name="899606"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Axel Wheeler</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> The "terracing" problem you illustrated is due to the fact that Blitz terrains only support 256 actual heights.  It is not due to the jpeg or other issues people mentioned.  <br><br>Even though terrain heights are alleged to contain a 0.0-1.0 value, the result is actually rounded off to the nearest (0-255)/256 value. (or rounded down, I don't remember).<br><br>To prove this, try setting a vertex with ModifyTerrain(terrain,1,1,.323452) or whatever (make up a value between 0 and 1.).  Then read it back with TerrainHeight(terrain,1,1).  You will see it is not the same.<br><br>The problem becomes especially apparent when you need a scaled up terrain for a mountain area, but also have a mostly flat area (but not entirely flat).  Then the terraces are really obvious.  It's a great feature - if your game involves rice paddies!  (They kind of look like that).<br><br>I've got a bug report on this (link follows) in which Stevie G. suggests the problem exists because Blitz terrains are assumed to be loaded from heightmaps, which get their height from the red value which is limited to 0-255 anyway.  This is a good point.  However, since the CreateTerrain and ModifyTerrain commands do exist, terrains should support the actual values people use in them, and not change them to something else without mention in the docs.<br><br><a href="http://www.blitzbasic.com/Community/posts.php?topic=75011" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=75011</a><br><br>I also have a little program in there which illustrates the problem.<br><br>One more point; if you're going to be playing with these commands, use a float array to do all your math and just copy the values to the terrain one-way for display.  Otherwise each time you modify the terrain the problem gets more noticeable.<br><br>Good luck! <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
