<!DOCTYPE html><html lang="en" ><head ><title >Need maths help - rotating a scaling XYZ for shadows</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Need maths help - rotating a scaling XYZ for shadows</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Need maths help - rotating a scaling XYZ for shadows</a><br><br>
<a name="290751"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rottbott</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm sure this is a very simple problem but I'm totally stumped!<br><br>I'm doing shadows by flattening a black-coloured copy of my player's mesh onto the ground. I use a LinePick to get the position and normal of the ground point where my player is standing, then I use PositionEntity and AlignToVector to position and rotate my shadow on the ground.<br><br>Next I set the Roll angle of the shadow to the Yaw value of the player. This makes the shadow sideways on to the ground when the player is sideways on to the light source that is casting the shadow.<br><br>However I then have to scale the shadow to be flat on the ground and that has me stumped. I use a scale of 1.2, 1.2, 0.05, but when I rotate my shadow with the player's Yaw, this must obviously be adjusted so the shadow is scaled to 0.05 in the direction of the Global Y-axis and 1.2 on the X and Z axes.<br><br>I've tried just about every combination of TFormVector I can think of and none work. The closest I have got to a solution is some simple trigonometry, but it only works at -180, -90, 0, 90, and 180 degree rotations - angles in between cause problems.<br><br>Here's the code (with my trig scaling solution):<br><br><pre class=code>
        Result = LinePick(EntityX#(pThis\EN), EntityY#(pThis\EN), EntityZ#(pThis\EN), 0, -1000.0, 0)
        If Result
          PositionEntity pThis\ShadowEN, PickedX#(), PickedY#() + 3.0, PickedZ#()
          AlignToVector pThis\ShadowEN, PickedNX#(), PickedNY#(), PickedNZ#(), 2
          Yaw# = EntityYaw#(pThis\EN)
          RotateEntity pThis\ShadowEN, EntityPitch#(pThis\ShadowEN), 0.0, Yaw#
          TurnEntity pThis\ShadowEN, -90.0, 0.0, 0.0
          MoveEntity pThis\ShadowEN, 0.0, MeshHeight#(pThis\EN) / 2.0, 0.0
; FIXME
          XScale# = Abs(Sin#(Yaw#)) * 0.05 : XScale# = XScale# + (1.2 * ((0.05 - XScale#) * 20.0))
          ZScale# = Abs(Cos#(Yaw#)) * 0.05 : ZScale# = ZScale# + (1.2 * ((0.05 - ZScale#) * 20.0))
          ScaleEntity pThis\ShadowEN, XScale#, 1.2, ZScale#
        EndIf
</pre><br><br>pThis = Player type instance<br>pThis\EN = Player mesh<br>pThis\ShadowEN = Player shadow mesh<br><br>At 90 degree rotation intervals for the player mesh it works beautifully, but at anything in between (37 degrees, -52 degrees, etc.) the shadow is not flattened to the ground - it sticks up at an angle and goes through the ground, because the scale is not correct.<br><br>Heeeeeeeelp! *pulls hair out* <br><br></td></tr></table><br>
<a name="290867"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rottbott</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> OK, I just figured out that my rotation code is totally wrong as well so now I need even *more* help.<br><br>I need some way to AlignToVector, except with a floating point axis. So I have an axis defined by a vector XYZ, and I need to align *that* vector, to the normal of the ground I get from LinePick. Instead of just the X, Y or Z axis.<br><br>THEN I need to work out the scaling thing.<br><br>Sswift... Floyd... anyone? :-) Someone must know this! <br><br></td></tr></table><br>
<a name="290886"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Mmmmm. How about using the collision normals you get from the linepick collision, and taking the Sin of that, and rotating it? Also, since you shadow is flat, why are you scaling it in the y direction? See the shadow when it's not rotated, is it like a a billboard, in regards to rotation? <br><br></td></tr></table><br>
<a name="290898"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rottbott</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ross,<br><br>I scale it in the Y direction because it's basically a copy of the player mesh, so it needs height. It only needs to be flattened on the local axis which corresponds to the global Y-axis - which in actual fact is a bit on the X axis and a bit on the Z axis.<br><br>The first thing I need to do is work out how to get "rotation XYZ" for my shadow mesh which will cause "vector XYZ" in the shadow mesh to algin with "normal XYZ" which I get from the LinePick. <br><br></td></tr></table><br>
<a name="290914"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TartanTangerine (was Indiepath)</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Try not to overcomplicate things.<br><br>Try this piece of code after you do a line pick and delete everything else<br><br>nx# = PickedNX() <br>ny# = PickedNY() <br>nz# = PickedNZ() <br>AlignToVector pThis\ShadowEN,nx,ny,nz,0 <br><br>That's all I use and it works perfectly. <br><br></td></tr></table><br>
<a name="290923"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Why don't you use a sprite for you shadow?<br><br>Set the camera to the lights position,<br><br>Point the camera at the player, <br><br>Color your entity a couple of shades above black, <br><br>Set the cameraclscolor to black, <br><br>Copy this to a sprite (using copyrect and the VRAM flag on) and you'll have a sprite shadow from the light's location. <br><br>You'll need to hide all other entities and lights when doing this, apart from the entity you want a shadow of, of course :). <br><br></td></tr></table><br>
<a name="290950"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rottbott</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ross, doing that for 50 players, 20 horses and maybe some enemies as well, every single frame, would kill it!<br><br>Flynn, that seems to be exactly the same as AlignToVector with the third (Z) axis. It works, but I want my shadow to change shape as the player rotates. So if my player turns side-on to the light source, the shadow-player mesh should roll to match the player's yaw, and then it needs rescaling to be flat on to the ground. The problem is getting that to work at any angle.<br><br>So the first thing to do is find how to AlignToVector using a local-vector to align with, rather than an axis as Blitz's AlignToVector function uses. <br><br></td></tr></table><br>
<a name="290954"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_Skully</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> lol.. and flattening and displaying "50 players, 20 horses and maybe some enemies as well" wouldn't kill it?<br><br>skully <br><br></td></tr></table><br>
<a name="290972"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rottbott</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> It will merely render each twice, except rather faster since the shadow copies have much smaller textures. The time for flattening should be negligible.<br><br>No CopyRect-ing involved, and everything is rendered in one call to RenderWorld. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
