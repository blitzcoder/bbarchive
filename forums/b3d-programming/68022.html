<!DOCTYPE html><html lang="en" ><head ><title >Reading UDP stream</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Reading UDP stream</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Reading UDP stream</a><br><br>
<a name="759903"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jasu</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Since there's no threads in B3D, how should I read the stream? If I have a game that loops say with 60 fps (17ms per loop), it might not be enough to perform RecvUDPMsg only once in that loop.<br><br>One resolution I thought was loop RecvUDPMsg over until it returns 0. Isn't there a risk that during a peak this could cause fps to drop? If I define a maximum number of packets read in one loop, would it help?<br><br>The ideal method would be creating another Blitz exe to deal with the communications only (a separate thread), but it would need to communicate somehow (UDP also?) with the client program, which would still be looping with 17ms?<br><br>How about the buffer of received packets? If the game reads the packets too slowly, when do they start to drop out? Does Blitz buffer these packets or the OS? What's the size of that buffer? <br><br></td></tr></table><br>
<a name="759926"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> The idea is not to send at that rate. send as little info as possible, at as low a rate as possible.<br><br>Generally send slower than the lowest ping. This minimises data-rearrangement (does NOT solve it completely). <br><br></td></tr></table><br>
<a name="759994"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jasu</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have a work-around on the data rearrangement, so it's not an issue here.<br><br>I'm not going to send all data every tick. It's just that there could be situations where multiple packets are sent about things not related to each other. The question is that if such bursts arrive, should the program read multiple packets per loop or just one.<br><br>I'm also afraid that if the frame rate drops for some reason I'm only able to guess, it would danger the fluidness of the net game, causing important packets being read really late or even timing out. <br><br></td></tr></table><br>
<a name="760711"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Personally I'd read the stream until it will return null, every frame. Someone correct me if I'm wrong here, but I guess to read out the UDP stream means to read out a buffer of incoming data, so this may be much faster than the connection speed. UPD has never been a problem to me, but TCP, and especially when sending data to a webserver. In that case I do non longer wait for a handshake of the server, but simply close the stream right after sending data to it. But that's a TCP issue.<br><br>In your situation I'd make some speed tests to make sure if there's a buffer or not. Or maybe there's some information about it, somewhere out there. <br><br></td></tr></table><br>
<a name="760778"></a>

<a name="1134243"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RGR</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> .<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="761306"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Chroma</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Reading the stream until there's no info to read could be disastrous especially if you're using just one socket for all clients.  Make a client type and pass the new connection socket to the client type socket.  Then check each client socket once per cycle for a packet.  Reading 1 packet per cycle from each player should be plenty to keep the game smooth.  CounterStrike sends anywhere from 10 to 30 packets per second just to give you an idea of what's average for a commercial FPS.  But of course it depends on your game type also. <br><br></td></tr></table><br>
<a name="761579"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jasu</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I was thinking about that net-pgm thingy for the server side, where received data from client has to be resent to other clients without delay. <br><br>Communication between net-pgm and game logic program using disk sounds like a real bad idea. Especially when Windows buffers disk I/O. I was originally thinking about UDP for this. I think it might be better than TCP since there's no change of packet loss (or is there?) and there's no need to send files (pictures or sound).<br><br>It's a nuisance to do special programs to test only one thing, but I guess I have to because this affects the fundamentals of the multiplayer code. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
