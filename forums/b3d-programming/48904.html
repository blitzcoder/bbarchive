<!DOCTYPE html><html lang="en" ><head ><title >Collision problem</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Collision problem</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Collision problem</a><br><br>
<a name="544159"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >HappyCat</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm having a wee problem with Blitz collisions. I sometimes get bullets passing right through enemies - it seems to only happen when 2 bullets hit the enemy in the same frame - one of them gets a collision, the other doesn't and keeps going.<br><br>My collisions are set up as:<br><br>Collisions PlayerShotType, EnemyType, 1, 1<br><br>and checked as:<br><br>EntityCollided(Shot, EnemyType)<br><br>and each shot and enemy has their EntityType and EntityRadius set.<br><br>Anyone got any ideas? <br><br></td></tr></table><br>
<a name="544180"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >lo-tekk</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> You might use EntityDistance instead of the collisions. Or you might give Nuclear Glory Collision Plugin a try. Have bought it recently because of the lack of No-Respond-Collisions in Blitz.<br><br><a href="http://www.blitzbasic.com/toolbox/toolbox.php?tool=49" target="_blank">http://www.blitzbasic.com/toolbox/toolbox.php?tool=49</a><br><br>-------------------------<br>www.moonworx.de <br><br></td></tr></table><br>
<a name="544193"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >HappyCat</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm using EntityDistance for all other collisions in the game but I went with Collisions for players bullets because they move so fast and, ironically, at lower frame rates occasionally bullets were passing right over enemies in a single frame.<br><br>I have verified the problem described above several times using Fraps to record the session and playing it back slowly and I can quite clearly see the missiles going right through the enemy. Having done a bit more searching around here I'm suspecting it's related to the reported problems with detecting collisions between two moving entities.<br><br>In light of this problem I'm seriously considering going back to just using EntityDistance, especially as I'm also on the verge of going with a fixed rate logic system, which would mean that I could guarantee collisions not being missed. <br><br></td></tr></table><br>
<a name="544208"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sledge</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> You could use multiple updateworld's to move the enemy separately to the bullets. That would negate the problem because only one collision type would be in motion at any one time. <br><br></td></tr></table><br>
<a name="544318"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hujiklo</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> You're best off looking at the linepick commands for these sort of collisions... If a bullet is going too fast then it may already be through the target before Blitz gets a look in. <br>Set up a line pick from your gun and if it hits an enemy then you've registered a hit. I've never had this method  fail. <br><br></td></tr></table><br>
<a name="544363"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >HappyCat</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sledge: that didn't help I'm afraid. Same thing is happening  :-(<br><br>Hujiklo: I'll have a look, thanks. <br><br></td></tr></table><br>
<a name="544507"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nicstt</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> seems to me that the first one to register the collision will always get acted on.<br><br>how about using EntityCollided and then changing the position of the bullet that didnt so it hits just after instead? If it doesnt matter if the target has alrdy been hit, just do something instead with the projectiles <br><br></td></tr></table><br>
<a name="544618"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Maybe you did call ResetEntityon the enemy after the first detection? Or you did hide him, or even free him or something? You could use CountCollisions to check if the enemy was hit one or two times. Additionaly I'd suggest to use polygonal collision.<br><br>BTW instead of EntityCollided you may use somethin like<br><pre class=code>
For i=1 to countcollisions(shot)
 impact=collisionentity(shot,i)
 if impact=enemy then do something
next
</pre> <br><br></td></tr></table><br>
<a name="544622"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sledge</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>and checked as:<br><br>EntityCollided(Shot, EnemyType)<br> <br></div><br><br>Leaving the whole two-object-types-moving-at-once problem to one side for the moment, if that's all you're doing when looking for collisions then it's not enough. In fact it's the wrong command entirely - see my example below (EntityCollided not used once).<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Graphics3D 640,480,0,0
SetBuffer BackBuffer()

SeedRnd MilliSecs()

cam=CreateCamera()
PositionEntity cam,0,10,-20

ground=CreateCube()
ScaleEntity ground,50,.1,50
EntityType ground,1
sineBase=0

PointEntity cam,ground

Type ball
	Field velocity#
	Field model
End Type
ballTemplate=CreateSphere(8)
For i=1 To 100
	currentBall.ball=New ball
	currentBall\velocity=-Rnd(.01,.1)
	currentBall\model=CopyEntity(ballTemplate)
	EntityColor currentBall\model,Rand(100,255),Rand(100,255),Rand(100,255)
	PositionEntity currentBall\model,Rnd(-10,10),10,Rnd(-10,10)
	EntityType currentBall\model,2
Next
FreeEntity ballTemplate

Collisions 2,1,2,1

While Not KeyDown(1)
	For currentBall=Each ball
		TranslateEntity currentBall\model,0,currentBall\velocity,0
		currentBall\velocity=currentBall\velocity-.1
	Next
	
	UpdateWorld	


	For currentBall=Each ball
		numberOfCollisions=CountCollisions(currentBall\model)
		If numberOfCollisions&gt;0
			For i=1 To numberOfCollisions
				If GetEntityType(CollisionEntity(currentBall\model,i))=1
					currentBall\velocity=1
				EndIf
			Next
		EndIf
	Next

RenderWorld
Flip
Wend
</textarea><br><br>As you can see, you have to iterate through all the collisions for each object (of the entitytype that leads in the collisions command), then you can decide what to do based on the entitytype of the collided entity for each one of those collisions.<br><br>Edit: Whoops, just noticed jfk EO-11110 totally beat me to most of that and that I'd misread him with my first edit. But you have a working example now. <br><br></td></tr></table><br>
<a name="544631"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sledge</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br> Sledge: that [multiple updateworld's] didn't help I'm afraid. Same thing is happening :-(<br> <br></div><br>Sorry - it's a bit more complex and, thinking a on it a little more, not really suited to multiple targets (because it involves translating the colliding objects along with the collided one then subtracting the translated figures from the colliding objects regular movement. I can post if you like though.) <br><br>Everyone is going to yell "IT'S SLOW! IT'S SLOW!" but my gut reaction to solving the two-object-types-moving-at-once problem would, in this case, be to check the distance of the bullets to each enemy and <i>if they're very close</i> then go on to see if their meshes intersect. <br><br></td></tr></table><br>
<a name="545030"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >HappyCat</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hujiklo - I can't get LinePick to do anything. Are there any tricks to it (I'm doing EntityRadius and EntityPickMode and making sure I'm using the delta). But nothing.<br><br>Sledge - CountCollisions always returns 1 so I think the problem is more fundamental than that. I'm also intrigued as to why EntityCollided is "the wrong command entirely" as apart from this one problem (which also happens with CollisionEntity) it's been working fine.<br><br>And the last thing you suggest is basically what I was doing before - but at low frame rates the missiles would occasionally skip over an enemy in a single frame - which is why I thought Blitz collisions would help.<br><br>jfk EO-11110 - I don't call ResetEntity (at all) or hide the entity (until it's been destroyed at least, which takes &gt; 1 missile). <br><br></td></tr></table><br>
<a name="545042"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hujiklo</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> So you've set your enemy's pickmode to 'pickable' right?<br>look at this code example below....<br><br>Linepick should be set by your gun. The 'gunhit' variable will return the ' pickable' entity it has picked.<br><br>You then cycle through your enemies to check if their handle corresponds to the 'gunhit' handle...if it does, either do damage or kill it.<br><br><pre class=code>
If MouseHit (1) 
	TFormVector 0,0,10000,GUN,0 ; vector does not have to be so large!!!
	If weapontype=1 ; Check which type of gun if necessary
    gunhit=LinePick (EntityX(GUN,True),EntityY(GUN,True),EntityZ(GUN,True),TFormedX(),TFormedY(),TFormedZ(),0.2)
	recoilgun#=0.01
	EndIf 
endif
</pre> <br><br></td></tr></table><br>
<a name="545361"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sledge</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>CountCollisions always returns 1 <br> <br></div><br><br>Yup, it should - for each bullet that hits the enemy in question. Are you checking each bullet, because it sounds like you're only checking one? The code I posted shows you how to check though lots of bullets (balls in this case) hitting a mesh (a scaled cube, but any mesh would do fine) simultaneously using CollisionEntity - if you can't work out where you're going wrong then post more of your code and we'll mull it over. HOWEVER, for fast moving objects you should take Hujiklo's advice and consider a linepick - it's a much more straightforward solution. <br><br></td></tr></table><br>
<a name="545640"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >HappyCat</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> I was checking each bullet - only ever 1 collision each (which is how it should be).<br><br>If I swapped it round and checked the enemies then I could get multiple collisions ... some of the time ... at other times it would return 1 (or even 0) when there quite blatantly should have been 2 collisions.<br><br>As I say, I think it's something going wrong in the Blitz collisions (rather than my code) as CountCollisions just doesn't always return the correct value (but at other times it does). As such, I've abandoned that approach and instead have been trying LinePick ...<br><br>... and it's getting there - having some fun with the scaling (Sprite Control does a lot of internal scaling to get pixel perfect sprites) - a little more time should get it working ... <br><br></td></tr></table><br>
<a name="545691"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >HappyCat</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey hey! Got it - with LinePick. Rock solid - thanks guys! <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
