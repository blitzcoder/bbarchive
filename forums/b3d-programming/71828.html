<!DOCTYPE html><html lang="en" ><head ><title >I'm trying to get 30FPS even</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >I'm trying to get 30FPS even</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >I'm trying to get 30FPS even</a><br><br>
<a name="802727"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_33</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have no clue how, as the technique I use gives me 31.2 FPS...  Any help appreciated.<br><br>MadJack?<br><br>:D <br><br></td></tr></table><br>
<a name="802769"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >semar</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> You're probably using floats in your fps calculation.<br><br>You my convert your fps value to an integer using Floor or Ceil.<br><br>IntFPS = Ceil(FPS#) ;rounds up<br>or<br>IntFPS = Floor(FPS#) ;rounds down <br><br><br>Sergio. <br><br></td></tr></table><br>
<a name="802792"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jasu</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you want the FPS to be exactly 30, then use CreateTimer/WaitTimer commands. <br><br></td></tr></table><br>
<a name="802810"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Vorderman</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Use Mark's Castle Timing code framework from the archives and just set the FPS counter to 30. <br><br></td></tr></table><br>
<a name="802841"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> If you want the FPS to be exactly 30, then use CreateTimer/WaitTimer commands.<br> <br></div><br>Won't work. If the computer can't keep up, you can't wait negative time to get up to 30 FPS.<br><br>To clarify the OP do you want to render at 30fps, update at 30FPS or both? <br><br></td></tr></table><br>
<a name="802884"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> 31.2 Hummmm, Are you sure its not 31.25?<br><br>If it is, it might be because you have a fixed refresh rate of 16Milli (ie 62.5 Hrtz).<br>The main problem of trying to anwser you question, is that without any code, or even a description of how you are trying to maintain 30FPS, we are all just guessing <br><br></td></tr></table><br>
<a name="802926"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wings</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Some tipps.<br><br>1) Remove som objects.  for testing prupose.<br><br>2) Flip False    ; False make blitz skipp vbl. <br><br></td></tr></table><br>
<a name="802991"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MadJack</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> _33<br><br>I just used timer commands. <br><br>Of course it assumes your proggy will run faster than 30fps if running unlimited and it assumes one cycle = one logic update + one renderworld - so it's pretty basic. <br><br></td></tr></table><br>
<a name="802992"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >puki</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Personally, if I was aiming for 30 FPS but I got 31.2 FPS - I'd be rather chuffed. <br><br></td></tr></table><br>
<a name="802996"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_33</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh boy!!  Great to have so much feedback!  I'm building a music video, and I need 30FPS straight to test and sync the music with the refresh for live tests, but the final will be a render, so I have my own timer for that.  Yes, H&amp;K, it might just be 31.25 hz refresh rate in reality.  I absolutely need 30 fps because this code may be used for live performances.  That's true H&amp;K that my same code does 62.5 hz refresh rate if I try to sync with the monitor refresh of 60 hz, well it flips between 62.5 and 57.5...<br><br>Gabriel, eventually it will be at a point where the image won't keep up, but presently I just want a perfect 30 fps refresh so I can sync the music that I have been given and my 3D work that I need to time it to.<br><br><div class="quote"> Use Mark's Castle Timing code framework from the archives and just set the FPS counter to 30.  <br></div><br><br>Thanks Vorderman, I'll look into this ASAP.<br><br>Thanks all for the excellent feedback and prompt reply!<br><br>I'll consider that easy option MadJack, thanks! <br><br></td></tr></table><br>
<a name="803272"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Adam Novagen</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> If you want the FPS to be exactly 30, then use CreateTimer/WaitTimer commands. <br></div><br>Not true. CreateTimer() and WaitTimer() cause unecessary slowdown. A program demo I made once ran at 24FPS normally. When I added CreateTimer(60) &amp; WaitTimer(timername) to limit it on faster PCs, the framerate on the original PC dropped to 20. <br><br></td></tr></table><br>
<a name="803300"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>Not true. CreateTimer() and WaitTimer() cause unecessary slowdown. A program demo I made once ran at 24FPS normally. When I added CreateTimer(60) &amp; WaitTimer(timername) to limit it on faster PCs, the framerate on the original PC dropped to 20. <br> <br></div><br><br>I beg to differ.  I always use it. <br><br></td></tr></table><br>
<a name="803315"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I beg to differ. I always use it.  <br></div><br>Why? It sounds mathematically correct to me.<br><br> You've got a timer going off 60 times per second. That's once every ~17 milliseconds. But your main loop takes ~41 milliseconds, because you're getting 24fps. So when your main loop finishes running, it waits for the timer to hit, but it's already passed 17 and 34, so it's not going to hit now until it reaches 51 milliseconds. 1000/51 is 20 frames per second, give or take the rounding I did to get to 17 and 41. <br><br></td></tr></table><br>
<a name="803382"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you put it like that, I hereby retract the above statement!  <br><br>The problem I have with using physics stuff is that I MUST keep a fixed timestep and simply allow processors to update as fast as they can so that while it may only be able to run at 30fps it's still smooth.<br><br>Probably best to re-think my strategy - any thoughts? <br><br></td></tr></table><br>
<a name="803417"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Indeed you must have a fixed timestep if you're doing any integration. I've always used render tweening for that. If you were using anything other than B3D, it might be a bit messy, because you have to SLERP quaternion orientations and animation can be a real pain, but B3D makes tweening easy.<br><br>See here for the theory :<br><br><a href="http://www.gaffer.org/game-physics/fix-your-timestep/" target="_blank">http://www.gaffer.org/game-physics/fix-your-timestep/</a><br><br>And here for the B3D Practice :<br><br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=1497" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=1497</a> <br><br></td></tr></table><br>
<a name="803441"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> You've got a timer going off 60 times per second. That's once every ~17 milliseconds. But your main loop takes ~41 milliseconds, because you're getting 24fps. So when your main loop finishes running, it waits for the timer to hit, but it's already passed 17 and 34, <b>so it's not going to hit now until it reaches 51 milliseconds</b>. 1000/51 is 20 frames per second, give or take the rounding I did to get to 17 and 41.  <br></div>Are you sure? (Not with the Maths), but wouldnt the timmer alreay have fired? That is wouldnt you have two timers events already on the event queue? <br><br></td></tr></table><br>
<a name="803458"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>Indeed you must have a fixed timestep if you're doing any integration. I've always used render tweening for that. If you were using anything other than B3D, it might be a bit messy, because you have to SLERP quaternion orientations and animation can be a real pain, but B3D makes tweening easy.<br> <br></div><br><br>Can't use tweening as my velocity is implied by current position - previous position and it'd be prone to lurching and maybe simulation explosion.  Also, all my objects are part of a collection of single surfaces.  I'll leave well alone I think. <br><br></td></tr></table><br>
<a name="803460"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Are you sure? <br></div><br>No, I just did Adam's numbers in my head real quick and they came out exactly right, which seemed like too much of a coincidence to be one.<br><br>I've never used timers, and I doubt I ever will. They're a hackish solution and I've always found the proper solution perfectly workable. Hopefully I'll never find myself in a situation like StevieG where I have no choice.<br><br>And before anyone asks me if I'm sure StevieG has no choice, again, no. Both problems he raises with tweening sound like problems I could solve, but I'm sure he knows his physics better than I do, so I'm going to assume he's right. <br><br></td></tr></table><br>
<a name="803477"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> They're a hackish solution <br></div>Oh<br><br>My basic framework is based arround self-running hooked Function. (Bit like Skids Fakeing mutitasking).<br>I must admit I never go 100%cpu and it just seemed to me that event passing was the way to go rather than linea logic.<br><br>Would you say that I was on the wrong track to begin with?<br><br>I will say that I wouldnt question it, if Bmax had PreEmtive hooks. <br><br></td></tr></table><br>
<a name="803522"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Would you say that I was on the wrong track to begin with? <br></div><br>I'm not sure what you're trying to achieve, and I'm not familiar with Skidracer's fake multitasking.<br><br>When I say they're a hackish solution, I mean specifically in relation to game timing. They only ever slow your game down, they can't speed it up, so they're only solving half the problem. Granted you may hope that less than half the people are going too slow, but you get my drift. Moreover because anyone who is going too slow won't be well-served, it encourages you to overcompensate and set your fixed rate too low to make sure that most people are covered, and I don't like low fixed-rates very much. Furthermore, I'm not particularly fond of tying refresh and update framerates to each other, I think they work much better if you decouple updates from rendering, render at a fixed rate and render as fast as you can. I guess you could say, they're a perfectly good solution to half a problem.<br><br>In other respects, they may have perfectly valid uses, but as I say, I'm not sure what you're doing. <br><br></td></tr></table><br>
<a name="803783"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_33</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've tried the following:<pre class=code>Global timer = CreateTimer(30)
While user_input &lt;&gt; CTRL_W
   ticks = WaitTimer(timer)
   ...
   UpdateScene()
   UpdateWorld
   ...
Wend</pre><br>With using a timer, I narrowed down the problem a bit.  While I previously had a time difference of 10 seconds between video/music and the timer + screen refresh after 4 minutes of playing, now I have 2.5 seconds using this code.  It is still quite unacceptable, but better.<br><br>I'm trying to find Mark's Castle example code...  Cheers.<br><br>Maybe if I could use the remainder of the previous frame timer and make sure I don't loose anything, I could create a very precise timer... <br><br></td></tr></table><br>
<a name="803912"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_33</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, here's the solution I came up with, and it's rock solid:<pre class=code>
Global sys_timer%         = MilliSecs()
Dim framePeriod%(3)
Global framePeriod_id% = 1
framePeriod(1)     = 34
framePeriod(2)     = 33
framePeriod(3)     = 33
Global frameElapsed%      = 0
Global frameTime%  	      = 0
Global framecounter%      = 0

While user_input &lt;&gt; CTRL_W
   frameTime = sys_timer + framePeriod(framePeriod_id)
   Repeat
      sys_timer = MilliSecs()
      frameElapsed = sys_timer - frameTime
   Until frameElapsed &gt;= 0
   framePeriod_id = (framePeriod_id Mod 3) + 1

   UpdateScene()
   UpdateWorld
   ...
   framecounter = framecounter + 1
Wend</pre> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
