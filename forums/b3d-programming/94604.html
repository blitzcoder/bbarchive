<!DOCTYPE html><html lang="en" ><head ><title >Verify Function, anyone got one?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Verify Function, anyone got one?</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Verify Function, anyone got one?</a><br><br>
<a name="1085727"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ThePict</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> My game related data files are downloaded from web at start of game, then sometimes altered during play, but not always.<br><br>I had an idea today about downloading datafile, copying a backup to local drive. Then if the main datafile is altered a quick Verify Function to compare the main and backup would tell me if any changes had been made. If none then there is no need to upload the file, saving time and bandwidth and roaming charges if you're out and about.<br><br>I thought I'd ask the forum if anyone has written a bb func to compare two files and return True if they are., before I go off re-inventing the wheel. <br><br></td></tr></table><br>
<a name="1085773"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Warner</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Maybe you could give the file a version number o.s., and then compare the two numbers? Ie: check their "last modified date". I believe that is a very common method. Else, I often heard the term 'checksum', but I'm not completely sure what it is, but it must have a wikipedia page. It is used to verify if a file transfer has transfered all data properly. Somewhat along the lines of: if both checksums match, it is rather safe to assume that both file contents are the same. <br><br></td></tr></table><br>
<a name="1085843"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> a simple checksum test would work this way:<br>read the file byte by byte, add these  values to a variable, then "cut off" everything above the 16th bit (a=a and $FFFF). the result is the 16 bit checksum. do it with both files, compare the checksums, if they are the same, the files are identic (99.999999 percent for sure).<br><br>a=a+readbyte(file)<br>a=a and $ffff<br>... <br><br></td></tr></table><br>
<a name="1085918"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ThePict</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes I thought about a checksum type thing, but on a different tack.<br>My datafiles are straight ascii text files, quite readable with Notepad, and thus could be compared line by line with Readline(f1)=Readline(f2).<br>Cumbersome and clunky but would detect any tampering.<br><br>I'd hoped to Encrypt the datafiles with a simple key. thereby making it a binary file, less tamperable and certainly not readable with Notepad. Not sure if my compare-line-by-line would still work. Could be worth experimenting with.... <br><br></td></tr></table><br>
<a name="1085927"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Note that comparing the files line by line requires them to both be present, so you'd be negating the whole saving-bandwidth advantage (how big are these data files?). A checksum can be worked out once in advance, and costs next to nothing to download.<br><br>There's apparently (haven't looked at it) an MD5 function here: <a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=278" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=278</a> (Wikipedia suggests MD5 should not be used for anything important) <br><br></td></tr></table><br>
<a name="1085931"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ThePict</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'd be comparing the files locally on the users computer to check for changes prior to uploading updated files - if there have been no changes there's no need to update the remote file. <br>Had a look at the MD5 link - all Greek to me I'm afraid.<br>I'll continue my experiments with my Verify function to compare two 'local' files for identicalness. I'll roll out the results on the codearcs section. <br><br></td></tr></table><br>
<a name="1085932"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> If that's the route you want to take, I have a couple of suggestions:<br><br>1) Compare file <b>size</b> before you compare file content - the majority of changes to a human-readable text file will change its size too, so you never need to open the file to see that it's different. Big performance improvement.<br><br>2) Don't bother with ReadLine. Use ReadBytes to dump the binary contents of both files into a bank, then iterate over its length, comparing each four-byte chunk as an integer (you could compare the individual bytes, but that just means four times as many jump and compare instructions for the loop).<br><br>Suggestion 2) has one slight problem in that if Mac or Linux users edit your files, they may use the wrong line ending characters, and create "differences" when none appear to exist to the reader... but I don't know if ReadLine accounts for this anyway (to be honest very few if any such false positives of this sort will occur... it's probably a small enough number that it's more efficient to ignore it). <br><br></td></tr></table><br>
<a name="1086014"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> if you read the bank byte by byte or int by int, both is very fast, assuming the file is not in the gigs range. But using ints requires the size to be dividable trough 4, complicating things a little bit. <br><br></td></tr></table><br>
<a name="1086566"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I use something a little more complex, but the basic is here:<br><br><pre class=code>	Local nc_Byte
	Local n4_Size%=FileSize(sfp_CheckFile)
	Local n4_End%=n4_Size-1
	
	Local nc_Start%=False
	Local hst_ReadFile=ReadFile(sfp_CheckFile)
	
	If (n4_Size=1)
		nc_Byte=ReadByte(hst_ReadFile)
	End If
	
	Local nc_Chunks%=Log(n4_Size) Mod 256
	nc_Byte=nc_Chunks
	
	Local n4_IterByte%=nc_Start
	
	While (n4_IterByte &lt; n4_End)
		SeekFile(hst_ReadFile,n4_IterByte)
		nc_Byte=nc_Byte+ReadByte(hst_ReadFile)
		nc_Byte=nc_Byte Mod 256
		If (n4_End-n4_IterByte)&gt;nc_Chunks
			n4_IterByte=n4_IterByte+nc_Chunks
		Else
			n4_IterByte=n4_IterByte+1
		End If
	Wend
	CloseFile hst_ReadFile
	
	Print nc_Byte
	</pre><br><br>Basically, this checks against a single byte checksum, by testing bytes at key points throughout the file. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
