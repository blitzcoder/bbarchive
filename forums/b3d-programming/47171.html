<!DOCTYPE html><html lang="en" ><head ><title >Movie Control Alternatives</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Movie Control Alternatives</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Movie Control Alternatives</a><br><br>
<a name="524555"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I am still searching for a method to control Movies. The Solutions offered by several people here (like BlitzMovie) didn't satisfy my needs so far. Blitz's built in Movie capabilities also don't offer the functions I need. Currently I am using a Userlib for MCISendString.<br><br>My project needs the following functions: Seek Frame and UpdateFrame, as well as a funtion that returns the length of the movie in frames. I still can combine it with Blitz's Movie Commands, eg. to read the movie width and height using the Blitz Commands.<br><br>As I said, currently I use MCSendString. In theory it supports SeekFame and UpdateFrame. The problem is, using the commands works sometimes and sometimes not. I think everyody can imagine that I better don't release a tool that uses a function that works "sometimes".<br><br>The tool makes great progress and I really have big plans for it since I got ideas for a market niche that is still not saturated. It's only this MCI SendString Problem that stops me.<br><br>Now I need to know - are there any Alternatives? How reliable are the Seek and Update Fame Commands in DirectShow's Movie Functions. Do they exist at all? And would it be possible to use them trough Userlibs?<br><br>Are there any other sources that allow to utilize windows installed Video Codecs? <br><br></td></tr></table><br>
<a name="524582"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Uh, maybe somebody has an idea on how to use AVISYNTH as a frameserver for Blitz? ( <a href="http://www.avisynth.org/" target="_blank">http://www.avisynth.org/</a> )<br><br>EDIT<br>It seems it's possible to use the TCP server option to send frames to blitz in an easy way, tho I still don't understand how to order a certain frame - so I became member of the doom9.org forum, that is the default forum for avisynth. A lot of knowhow there, but this was extremly annoying:<br><br><div class="quote"> <br> vBulletin Message	<br>You are not allowed to post or reply until you have been registered for at least 5 days.<br> <br></div><br><br>so after Downloading Avisynth, I first have to wait 5 days until I can ask a question... è_é <br><br></td></tr></table><br>
<a name="524632"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Jfk, just a quick thought:<br>Are you using the 'wait' string in your MCIsendstring calls?<br>I remember that many of mine appeared to malfunction until I added ' wait' at the end of every string sent.<br>Basically you are telling MCI not to execute any other MCI calls until this one is finished (with no noticeable loss).<br>Yes, it really was that simple and effective. <br><br></td></tr></table><br>
<a name="524892"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks - I already tried that, although I am not sure if I did this right. I think you are referring to this:<br>lpszFlags<br><br><div class="quote"> <br><br>wsprintf(<br>  lpszCommand, <br>  "seek %s %s %s", <br>  lpszDeviceID, <br>  lpszSeekFlags, <br>  lpszFlags<br>); <br><br>...<br><br>lpszFlags:<br>Can be "wait", "notify", or both. For digital-video and VCR devices, "test" can also be specified. For more information about these flags, see The Wait, Notify, and Test Flags.<br><br> <br></div><br><br>I still don't know what the bit values of these constants should be:<br>MCI_WAIT<br>MCI_NOTIFY<br>MCI_TEST<br><br>If it's 1 for wait, then I think I already tried it without success. But I'll surely doublecheck this.<br><br>EDIT:<br>Ah, good old pascal programmers:<br>const MCI_WAIT = 2<br>const MCI_NOTIFY = 1<br>...testing...<br><br>Ah, i've just realized that I am doing something completely wrong. I've tried to use the last parameter of mciSendString for this flag, but the parameter should be used for a callbackHWND!<br>But how should I add the flag to the command string? Should I simply Space-delimit-append it at the end of the string? Or comma delimited? And what do I have to use, it's value, "2" or "wait"? I have no idea.<br><br>EDIT2:<br>uh, infact you already said it, it should be " wait", so i take it it's comma delimited. ...<br>It seems it still don't works. I tried various combinations, like seek with wait, update with wait and both, but it's still some kind of random game. <br><br>I think I really got to try Avisynth since it's a highly advanced Frameserver, especially compared to MCISendstring. <br><br></td></tr></table><br>
<a name="525499"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> No, you were nearly there.<br><br>It's actually 'wait' (no quotes) with one space in front, and no delimiting commas.<br><br>Which is shown by your line:  "seek %s %s %s"<br>-where the separater space is correctly placed just before the last %s.<br><br>Nothing else is needed.<br>The word 'wait' is substituted for the last %s.<br>Certainly no numerical value is needed.<br><br>That was, and still is, the beauty of the MCIsendstring calls, you can think in English!<br>And as I said, adding ' wait' to the end of all my calls made the difference.<br>My conclusion was that the MCI subsystem really is multitasking, but the ' wait' parameter forces it to do the given tasks one at a time.<br><br>For example, when you say 'stop', you mean 'stop'.<br><br>You don't mean 'send a stop command to the MCI queue, but run anything else that may need processing while the media stop command is waiting to be executed'<br><br>But MCI is quite capable that sort of logic!<br>(Don't you just love Microsoft.) <br><br></td></tr></table><br>
<a name="525504"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> So, other than all that.... how's it coming jfk?<br>Are you getting any closer to using MCIsendstring to draw a movie to the Blitz window?<br><br>With the 'seek' and other fine tuning controls it really was a useful library. I'm still running a 'Media Player' I coded in GFA Basic about 10 years ago, and it still works like a dream.<br><br>Err, just in case you don't know, the MCI system could also 'crop' the source (magnify an area) and all sorts of useful things in realtime. <br><br></td></tr></table><br>
<a name="525687"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks. Well it seems this doesn't work for me for some reason. I used 'wait' at the end of the command string, and it clearly had an impact on the behaviour, so I guess after all I did it right, but it still didn't function correctly.<br>I have a timeline that can be clicked by the mouse. MCI should then "jump" to that frame. This works sometimes, and sometimes not. So I had to add a "manual Update" button that would repeat the seek command. Now the user sometimes has to click this 5 or so times until it finally works. Using "wait" produced some stuttering program flow, so it looked like MC gained a higher priority in the background, but it still didn't work for some reason.<br><br>I have tried to capture frames in windowed mode in blitz without success, I have really tried for a long time with all kinds of tricks. In the end I was only capable of grabing frames in blitz' fullscreen mode, from the frontbuffer. Unfortunately the BlitzAvi.dll that saves me the result, required windowed mode at least for a second to start some processes. So I had to minimize and then re-maximize the Blitz fullscreen window, using some horrible tricks, to make them work together. So, yes, I really NEED something that can grab frames in windowed mode.<br><br>I know, MCI is cool, it has a lot of nice features. Only the seek problem and the non-windowed Mode in  Blitz problem makes it very, very hard to use for me.<br><br>I am really thinking about to use Avisynth since it's a real Frameserver, as in "Frameserver", and it's developed by a wide open source community, already offers a zillion of up to date filters and scripts. Now I only got to make it work in blitz.<br><br>It's really good that I have organised DrGreen, my video compositing app in a way that allows me to replace the whole MCI Code by something else cause everything goes trough a function named "GrabFrame(n)".<br><br>Thank you for your help nevertheless. If I can make use of avisynth in blitz, I'll let you know. <br><br></td></tr></table><br>
<a name="525738"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, I made some tests with Avisynth 2.55. I create a .AVS scriptfile using Blitz on the fly, containing the following lines:<br><br>DirectShowSource("avifilename.avi")<br>Trim(seekframe,seekframe)<br><br>where seekframe is the frame I want to be displayed (Trim is usually used with startfame and endframe). I then can use Blitz's Openmovie command with the .AVS file. Avisynth now delivers an Avi Clip containig a trimed version of the source Avi, in this case only one Frame long. In Blitz I have to DrawMovie it once then I can close the handle.<br><br>The entire Framegrabbing process consistently takes about 2 seconds, no matter if I seek for a frame at the end or the beginning of the clip.<br><br>It sounds like a long time, but maybe it's better than what MCI does, sometimes 100 Milliscs, sometimes never. I still try to find a faster way. Probably it's Blitz that loses significant time in Opening the movie. And, of course, there is the video memory problem you described in the bug reports that may make troubles when used this way.<br><br>There is still an option to use AviSynth as a TCP Server for frames, maybe that's better.<br><br>EDIT - uh, it seems TCPServer() is no option since it requires some App to open the .AVS scipt in the first place to start the TCP Server at all. And I also don't have an Idea how the protocol works. It is a very handy command when you want to send video over a LANs tcp. On the client side you'd use TCPClient() as an Avi-Source in a Script, so you can stream movies easily. But for Blitz it's no solution.<br><br>I have measured when I grab frames from 2 Movies simultanously, eg. from one indeo encoded 50 Megs and one uncompressed 800 Megs Avi, the frame-access time still remains the same, 2 seconds for each frame. 500 Millisecs are used by Blitz for each Openmovie command. Currently I have no idea how to make it faster. Unfortunately you cannot send commands to Avisynth like to MCI (AFAIK). You have to open an AVS Script and the opening app thinks it's an ordinary movie file. <br><br></td></tr></table><br>
<a name="525894"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's more likely that the load time of an AVI depends on DirectX rather than Blitz.<br>My impression is that Mark (or whoever) is merely wrapping the DirectX calls with his own 'OpenMovie' etc calls, which is fine. It's how I'd do it.<br><br>But the route you are taking seems to be a long way away from the type of control that you and I are really looking for - using a frame server...?<br><br>I feel that it's worth mentioning that the likely reason for the stutter is much more simple than you think; that what you should be doing to achieve a 'seek' is to a) stop the movie first, b) seek, then c)play again.<br>This is what I meant by MCI multitasking.... 'seek' will not cause the movie to stop playing, then seek. It _will_ seek, but also carry on with any other running tasks.<br>Do you see what I mean?<br><br>I just wish I had more time to actually bring my original MCI code into Blitz. (I am my own boss - dare I justify the time?)<br><br>Which brings me to the question: surely once you have the window handle (via BlitzSys?) then what more do you need?<br>It should not matter to MCI whether the Blitz window is windowed or full-screen... it just needs a window handle. Why do you feel you need to go windowed then back to full-screen to get it to react?<br><br>By the way how are you calling MCI? Are you using a decls lib? <br><br></td></tr></table><br>
<a name="525899"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, the Avisynth frame server method was up and running in 2 minutes. Compared to the troubles I had and have with MCI that's a pleasure.<br><br>But with MCI I tried to solve all kinds of problems for several months now, all in all surely over 100 hours of MCI hacking and troubleshooting. Believe me, MCI is capable of playing its movie on the blitz window, but (and this is the point) you will not be able to grab the frame from front or backbuffer since MCI will use an Overlay when blitz runs in windowed mode. It will not use that overlay in fullscreen. Of course, you can try it too, but let me tell you that I have wasted 30 or so hours just with this very problem. I tried a lot of work-arounds, without success (bitblit etc.). I couldn't believe it too that MCI makes a big diffrence if it's windowed or fullscreen, unfortunately it's a fact, but feel free to try your luck as well.<br><br>Of course I know about the multitasking behaviour of MCI. The movie is not playing when I try to seek a frame. I wrote a movieplayer too, with fancy buttons. Play, Stop, ffwd, reverse, doubl speed, half speed, resize, whatever. But direct-accessing a single specific frame seems to be something that isn't so easy for the MCI system. It works most times when you seek frame by frame, from zero to the end, but when you jump to any frame, it oftenly fails.<br><br>BTW I don't FEEL like I need to go windowed and then back - I simply HAVE to do that, it's a hard fact as well. But it has nothing to do with MCI. I am using BlitzAvi.dll to save the result of the image-processing as an Avi, and this DLL requires to be in windowed mode right after codec selection, if it's not, it will freeze. You know, it's not the way that I tried something halfhearted for 10 Minutes and then gave up. I have worked out an insane workaround for this problem (especially since MCI needs to be in fullscreen in the same time) and it took me many many hours.<br><br>Of course I use MCIs window command to make Blitz the parent of the canvas, and it also works in fullscreen mode. There is no need for BlitzSys, if you want to know blitz' HWND, simply use SystemProperty$("AppHWND"), so you even don't need to know the App Class Name.<br><br>Yes, I use a Decls lib for MciSendstring, the one in the code archives.<br><br>After a long time with MCISendString, I probably have to drop it. Well maybe I'm gonna use it to read out a movies properties, but that's it.<br><br>I really need an alternative. Avisynth is such an alternative, but maybe there's more. Also, in a few days they let me ask questions in their forum (5 days delay after registration, as mentioned), and then maybe somebody can tell me if there's a faster way. It supports plugins, and maybe a plugin could process runtime parameters like "seek frame". <br><br></td></tr></table><br>
<a name="525904"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry jfk, I didn't mean to suggest that you'd done half a job.<br>I already know your reputation, and you leave me standing.<br><br>If it makes you feel any better I just purchased your CSP Interior Pack 1 while I was waitng for your reply.<br>Nice stuff!<br><br>As I last thought, would you say that it would be no use me following MCI through, since what I most need to do is to render each frame to a texture on a mesh, to get a TV/billboard effect?<br><br>By the way I get the impression that you guys are either Swiss or German. How come you speak and write such excellent English - better than we English! <br><br></td></tr></table><br>
<a name="525906"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> No problem. Thank you for purchasing the interior package.<br><br>And thanks for the comment about my english as well. I don't think it's very good. I can hardly express myself in english. Yes, I live in switzerland.<br><br>MCI may be ok when you grab frames one by one sequentially and when it's not that vital if you miss a frame sometimes.<br>But you could also use Blitzs' OpenMovie command, it's probably faster and it's realtime oriented. And it can be used in windowed mode too. <br><br></td></tr></table><br>
<a name="526021"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> If only I could use OpenMovie()!<br><br>Please see the Blitz3D bugs forum:<br><a href="http://www.blitzbasic.co.nz/Community/posts.php?topic=46958" target="_blank">http://www.blitzbasic.co.nz/Community/posts.php?topic=46958</a><br><br>As much as I would like to have a 'seek' command, it far more important to me to have OpenMovie/CloseMovie working without a memory leak. <br><br></td></tr></table><br>
<a name="526432"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, I know that bug report, and it's probably gonna stop me from using it too, especially for continous single frame access as described.<br><br>But there is still a chance that blitz (or diretctX) will do a carbage collection only when it runs out of videoram. We should do some tests and see what happens when OpenMovie used to eat all memory and then the app tries to reserve VRam for a texture... <br><br></td></tr></table><br>
<a name="526440"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've just tested it, it's definitively some kind of bug. Although I can create 20 times a 1024*1024 Texture after I did continously open and close a movie, which used to lower my AvailVidMem to 1.2 Megs, the framerate drops to something like 1 fps when I put the 20 textures onto some spheres and turn them in fromt of a camera (as if the texture Vram was swapped from system ram or something). when I skip the Movie Commands and execute the 20-textures and spheres test only, it runs at max/normal speed.<br><br>well, this is good news since I see a small chance that mark will also add exact frame access and an option for not playing realtime oriented movies (well, play them frame by frame, no matter what), if he once has to revisit this chapter due to the fact that we have a real bug here. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
