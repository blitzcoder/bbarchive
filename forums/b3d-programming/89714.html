<!DOCTYPE html><html lang="en" ><head ><title >Best Dynamic Lighting Setup?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Best Dynamic Lighting Setup?</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Best Dynamic Lighting Setup?</a><br><br>
<a name="1019347"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ClayPigeon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey! I have been using lightmaps in my games for a while now, and I think they look nice. The only problem is that now I need dynamic lighting, but shadows add a great deal of realism. Trashing the shadows is like taking the plate out from under your spaghetti and expecting someone to eat it off the floor!! The only method I've thought of so far is to make the lightmap slightly transparent, so that even the darkest of places will be visible when I light it up. Now, that won't work, because then the parts on the outside of my island will be dark because if I set it to full-bright, then it can't be lit any brighter. I just want to have a point in the game where the player gets into a pitch black cave, and finds a handle which, when pulled, makes a glowing liquid flow into a bowl. As this is happening, I just want to have a greenish point light in the center of the cave slowly increase its intensity so the the cave is dimly visible. Is this possible? <br><br></td></tr></table><br>
<a name="1019356"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, the only way i can think, and which i did try (far too slow though!) was to generate a realtime lightmap, and blend it down onto the existing lightmap. That way, it should cancel out the existing black areas. I tried making the lightmap from the light source, very low resolution.... meh. Was too slow and pretty ugly... <br><br></td></tr></table><br>
<a name="1019693"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ClayPigeon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> ..feel free to say "It's not possible." or "There's only one way, and it's not practical - try this instead:". I didn't mean to scare you! <br><br></td></tr></table><br>
<a name="1019704"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's really not 'correctt', and very much a  cheat-kludgey workaround, but  perhaps you could kill (hide) the ambient light and any other lights while the player is in the  'dark room'.<br>As the bowl fills, place the green light (starting off at 0,1,0 and increasing) and raise the ambient light back up too? <br><br></td></tr></table><br>
<a name="1019711"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ClayPigeon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't think that will work, because the player needs to be able to see the handle to turn on the faucet, so I have light streaming in from the entrance cave just far enough for the player to dimly see the handle and nothing else. If I hide the ambient light when I get in, the light in the entrance cave will suddenly go dark. <br><br></td></tr></table><br>
<a name="1019717"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sledge</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can switch lightmaps programatically and you can also use EntityColor to 'light' fullbright objects (which is what your lightmapped objects should really be) -- this should be all you need. I'll rustle you up an example if you give us a mo.<br><br><div class="quote"> If I hide the ambient light when I get in, the light in the entrance cave will suddenly go dark. <br></div>The player isn't going to be looking in that direction because you have the handle to misdirect them. You could also start the mixed-light lightmap off with a high enough entity colour that the entrance looks fine. Or you could seal the entrance. Or have the entrance around a corner etc. There are a myriad of options. <br><br></td></tr></table><br>
<a name="1019723"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Perhaps not putting the cave to fullbright might work, if you balance things well. That way, it will still receive light from the "glow light" you place around the bowl, while retaining the lightmap. That "glow light" being a standard point-light you create.<br>Also if you think about it, in the real world, when you light something in a place that has shadows from a 'different' light source (like the sun, for instance), these shadows don't go away. They simply become "lighter" (which is what would happen if you don't put the lightmapped cave as Fullbright).<br><br>Just make sure to have enough polygons in the cave to actually show the fade-off from that light. <br><br>Since B3D uses vertex lighting, the fewer vertices, the less noticeable the lighting is:<br><br>Left quad: ~60 triangles.  Right quad: 2 triangles.<br><img src="http://i42.tinypic.com/1547gna.jpg"><br>(both quads had perfectly aligned point lights, but the one with most vertices shows the fade-off) <br><br></td></tr></table><br>
<a name="1019725"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sledge</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay, a very quickly cobbled together example, mostly to show how you switch lightmaps:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Graphics3D 800,600,32,2

player = CreatePivot()
cam = CreateCamera(player)
CameraClsColor cam,150,150,200
cave = LoadMesh("LightTest.b3d")
EntityFX cave,1
trigger = CreateSphere()
PositionEntity trigger,0,0,1.5
HideEntity trigger

lightmap1 = LoadTexture("LightTest1_lm.bmp") : TextureCoords lightmap1,1
lightmap2 = LoadTexture("LightTest2_lm.bmp") : TextureCoords lightmap2,1

EntityTexture cave,lightmap1,0,1

PositionEntity cam,0,2,0
PositionEntity player,0,0,-6

EntityType player,1
EntityType cave,2

Global lightCave = False
Global caveColor = 0
Global lightDelay = 0

Collisions 1,2,2,2




While Not KeyHit(1)
	If lightCave
		lightDelay = lightDelay + 1
		If lightDelay &gt; 1
			lightDelay = 0 
			caveColor = caveColor + 1
			If caveColor&gt;255 caveColor = 255
			EntityColor cave,caveColor,caveColor,caveColor  
		EndIf
	EndIf

	MovePlayer(player)
	If Not lightCave
	If (EntityDistance(player,trigger)&lt;2.0)
		caveColor = 25
		lightCave = True
		EntityColor cave,caveColor,caveColor,caveColor
		EntityTexture cave,lightmap2,0,1
	EndIf
	EndIf
	UpdateWorld
	RenderWorld
	Flip True
Wend



Function MovePlayer(entity_arg)
	If KeyDown(200) MoveEntity entity_arg,0,0, .05
	If KeyDown(208) MoveEntity entity_arg,0,0,-.05
	If KeyDown(203) TurnEntity entity_arg,0, 3,0
	If KeyDown(205) TurnEntity entity_arg,0,-3,0	
End Function
</textarea><br><br>Just approach the pedestal to bring up the green lighting. Like I said before, there are a bunch of things you can do to make the transition as seamless as you need. I've uploaded the assets and a pre-compiled exe to <a href="http://www.into-games.com/temp/MultiLightMap.zip" target="_blank">this temporary location</a>. Cursor keys to walk about.<br><br>EDIT: Removed some peripheral info. One thing at once. <br><br></td></tr></table><br>
<a name="1019728"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry I didnt realise the  entrance to the cave would still be visible.<br><br>The ambient light only needs to be dimmed down, then. Really I can see how messing wih the universal-ness of ambient light is a pretty 'bad' thing to do. That's why I thought it may be resetrved for just such a special situation like this.<br><br>LightMesh too, which can be used to light an individual mesh without affecting any actual lights or other meshes. Could be done for the tap (faucet)?<br><br>Though, Sledge &amp; Kryzon both seem to know a lot more about this kinda stuff :) <br><br></td></tr></table><br>
<a name="1019732"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Geez, nice sample Sledge.<br><br>It must've taken some good-hearted effort to build it. Nice work. <br><br></td></tr></table><br>
<a name="1019760"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Krischan</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Right now I experiment with lightmaps, too. I try to get an effect like in Gothic II, take a look:<br><br><b>Midnight</b><br><img src="http://www.christianhart.de/bb/lightmap/night.jpg"><br><br><b>Dawn</b><br><img src="http://www.christianhart.de/bb/lightmap/dawn.jpg"><br><br><b>Noon</b><br><img src="http://www.christianhart.de/bb/lightmap/noon.jpg"><br><br>You always see the same scene - the "trick" is to use this texture order:<br><br>Layer0 = Lightmap, Blendmode 2<br>Layer1 = Brightmap1, Blendmode 3<br>Layer2 = Texture, Blendmode 2<br>Layer3 = Brightmap2, Blendmode 5<br><br>Brightmap1/2 are two small 2x2 pixel textures updated according to time (night/dawn/noon) using my Blitzsky system and this simple function:<br><br><pre class=code>Function UpdateTex(tex%,r%,g%,b%)
	
	Local tb%=TextureBuffer(tex)
	Local rgb%=r*$10000+g*$100+b
	Local x%,y%
	
	LockBuffer tb
	For x=0 To 1
		For y=0 To 1
			WritePixelFast x,y,rgb,tb
		Next
	Next
	UnlockBuffer tb
	
End Function</pre><br>It makes the lightmap so bright that it "vanishes" below the texture. The disadvantage is that the day scene looks a little bit flat, so I need further tests with it. <br><br></td></tr></table><br>
<a name="1019761"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ClayPigeon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wow, nice example. That actually looks like a plausible solution. Of course, it's still kind of "semi-static" as you can't move lights. I have two questions - 1: What if I have multiple places that I want to have lights be able to turn on and off independently? They can't both occupy the same lightmap.. 2: What program did you use to make the lightmaps in that example you made? I make my lightmaps in DeleD which automatically applies the lightmap to the model and sets it to fullbright. It would be a great advantage to be able to apply the lightmaps in B3D as I could modify them though their texture handle.<br><br>Also, why is there a need to adjust the ambient light? Why can't you just fade between texture layers? <br><br></td></tr></table><br>
<a name="1019762"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Krischan</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> I only used <a href="http://dev.alientrap.org/wiki/netradiant" target="_blank">NETRadiant</a> for the level, compiled a BSP with the lightmap using q3map2 (comes with NETRadiant) and converted the BSP to B3D with <a href="http://www.unwrap3d.com/u3d/index.aspx" target="_blank">Ultimate Unwrap</a> (with the BSP plugin). The lamps/flares are seperate models/quads placed using my own BSP parse function to extract the positions. I use linepick to check if the flare crosses the level geometry and show/hide them accordingly.<br><br>The B3D mesh is loaded and converted with this function because the lightmap is "above" the texture and so I needed to switch the layers like i described and add my 2x2 pixel brightmaps to the whole mesh:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">Function PatchLevel()
	
	Local s%,surf%,brush%,newbrush%
	Local tex0%,tex1%
	
	; cycle all surfaces
	For s=1 To CountSurfaces(level)
		
		; get surface, brush and textures/lightmaps
		surf=GetSurface(level,s)
		brush=GetSurfaceBrush(surf)
		tex0=GetBrushTexture(brush,0)		; Texture
		tex1=GetBrushTexture(brush,1)		; Lightmap
		
		; reset blend modes
		TextureBlend tex0,2
		TextureBlend tex1,2
		TextureBlend tex2,3
		TextureBlend tex3,5
		
		; create a new brush
		newbrush=CreateBrush()
		
		; rearrange textures to this brush
		BrushTexture newbrush,tex1,0,0
		BrushTexture newbrush,tex2,0,1
		BrushTexture newbrush,tex0,0,2
		BrushTexture newbrush,tex3,0,3
		
		; paint surface with new brush
		PaintSurface surf,newbrush
		
		; clear old brush
		FreeBrush brush
		
	Next
	
End Function</textarea><br><br>You can even use EntityFX 2 (my example uses FX 1) and light it with a DX light, but then you need a lot of triangles to get a nice lighting effect. But I'm happy with the static lightmap and even Gothic II doesn't use dynamic lightmaps as far as I see - but the effect is still stunning.<br><br>Here is a screenshot with FX2 and a tree mesh lit by the player light:<br><br><img src="http://www.christianhart.de/bb/lightmap/fx2example.jpg"><br><br>For multiple places I think you need to use portals/zones with different lightmaps. <br><br></td></tr></table><br>
<a name="1019783"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Layer0 = Lightmap, Blendmode 2<br>Layer1 = Brightmap1, Blendmode 3<br>Layer2 = Texture, Blendmode 2<br>Layer3 = Brightmap2, Blendmode 5<br><br>Brightmap1/2 are two small 2x2 pixel textures updated according to time (night/dawn/noon) using my Blitzsky system and this simple function:<br> <br></div><br>I admit I know virtually nothing about lightmaps and multitexturing etc. but this sounds too good to be true!<br>Can you explain a bit more about how two tiny textures can have such an effect? <br><br></td></tr></table><br>
<a name="1019795"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ClayPigeon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry, Krischan. I forgot to refresh before I posted and I didn't see your post. I wanted to know what Sledge used. <br><br></td></tr></table><br>
<a name="1019798"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Krischan</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Malice - it is just the blending order and a proper use of colors which create this effect. Just take a look at this demo (copy the two textures in the same folder) - with LMB and RMB you can increase/decrease the time of day (and so the light intensity). This simulates a full night-day-night cycle.<br><br><b>texture.jpg</b><br><img src="http://www.christianhart.de/bb/lightmap/texture.jpg"><br><br><b>lightmap.png</b><br><img src="http://www.christianhart.de/bb/lightmap/lightmap.png"><br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">Graphics3D 800,600,32,2

; Gradient stuff
Dim GP#(0),GR%(0),GG%(0),GB%(0)
Const ColorSteps%=3600
Global BM1R%[ColorSteps],BM1G%[ColorSteps],BM1B%[ColorSteps]
Global BM2R%[ColorSteps],BM2G%[ColorSteps],BM2B%[ColorSteps]
Restore Brightmap1 : CreateGradient(11,ColorSteps,False,BM1R,BM1G,BM1B)
Restore Brightmap2 : CreateGradient(11,ColorSteps,False,BM2R,BM2G,BM2B)

; create a "level"
level=CreateQuad()
EntityFX level,1
RotateEntity level,25,25,0


; load / create textures
tex0=LoadTexture("texture.jpg")				; wall texture
tex1=LoadTexture("lightmap.png")			; lightmap
tex2=CreateTexture(2,2)						; brightmap 1
tex3=CreateTexture(2,2)						; brightmap 2

; blend textures
TextureBlend tex0,2
TextureBlend tex1,2
TextureBlend tex2,3
TextureBlend tex3,5

; apply textures to "level"
EntityTexture level,tex1,0,0
EntityTexture level,tex2,0,1
EntityTexture level,tex0,0,2
EntityTexture level,tex3,0,3

cam=CreateCamera()
MoveEntity cam,0,0,-1.5

MoveMouse 400,300

While Not KeyHit(1)
	
	; LMB/RMB = decrease / increase time of day
	i=(MouseDown(1)-MouseDown(2))*8
	
	; Keys 0-9 = time of day
	For k=2 To 11
		If KeyHit(k) Then c=(k-2)*400
	Next
	
	; colorstep counter
	c=c+i
	If c&lt;0 Then c=ColorSteps
	If c&gt;ColorSteps Then c=0
	
	; update brightmaps
	UpdateTex(tex2,BM1R[c],BM1G[c],BM1B[c])
	UpdateTex(tex3,BM2R[c],BM2G[c],BM2B[c])
	
	UpdateWorld
	RenderWorld
	
	; output time of day and colorstep counter
	Text 0, 0,"Time...: "+CalculateTime(c)
	Text 0,15,"Step...: "+c
	Text 0,30,"Percent: "+Int((c*100.0)/ColorSteps)
	
	Flip
	
Wend

End

; calculates the time of day out of the colorstep counter
Function CalculateTime$(value%)
	
	Local time%=value/10.0*4
	Local hours%=Int(Floor(time/60.0))
	Local minutes%=time-(hours*60)
	
	Return ZERO(hours)+":"+ZERO(minutes)
	
End Function

Function ZERO$(number%,lenght%=2)
	
	Local i%,r$
	
	For i=0 To lenght-Len(Str(number))-1 : r$=r$+"0" : Next
	Return r$+Str(number)
	
End Function

; updates the brightmap
Function UpdateTex(tex%,r%,g%,b%)
	
	Local tb%=TextureBuffer(tex)
	Local rgb%=r*$10000+g*$100+b
	Local x%,y%
	
	LockBuffer tb
	For x=0 To 1
		For y=0 To 1
			WritePixelFast x,y,rgb,tb
		Next
	Next
	UnlockBuffer tb
	
End Function

; creates a quad
Function CreateQuad()
	
	Local s#=0.5
	
	Local mesh%=CreateMesh()
	Local surf%=CreateSurface(mesh)
	
	AddVertex (surf,-s, s,0,1,0)
	AddVertex (surf, s, s,0,0,0)
	AddVertex (surf,-s,-s,0,1,1)
	AddVertex (surf, s,-s,0,0,1)
	
	AddTriangle(surf,0,1,2)
	AddTriangle(surf,3,2,1)
	
	Return mesh
	
End Function

; creates a smooth color gradient
Function CreateGradient(colors%,steps%,inverse=False,R%[ColorSteps],G%[ColorSteps],B%[ColorSteps])
	
	Dim GP(colors)
	Dim GR(colors),GG(colors),GB(colors)
	
	Local i%,pos1%,pos2%,pdiff%
	Local rdiff%,gdiff%,bdiff%
	Local rstep#,gstep#,bstep#
	Local counter%=0
	
	; read data, inverse if set
	If inverse Then
		For i=colors To 1 Step -1
			Read GP(i),GR(i),GG(i),GB(i)
			GP(i)=100.0-GP(i)
		Next
	Else
		For i=0 To colors-1
			Read GP(i),GR(i),GG(i),GB(i)
		Next
	EndIf
	
	; gradient loop
	While counter&lt;colors
		
		; convert percent to step position
		pos1=GP(counter)*steps*1.0/100
		pos2=GP(counter+1)*steps*1.0/100
		
		; calc delta and steps
		pdiff=pos2-pos1
		rdiff%=GR(counter)-GR(counter+1)
		gdiff%=GG(counter)-GG(counter+1)
		bdiff%=GB(counter)-GB(counter+1)
		rstep#=rdiff*1.0/pdiff
		gstep#=gdiff*1.0/pdiff
		bstep#=bdiff*1.0/pdiff
		
		; calc new colors and store to blitzarray
		For i=0 To pdiff
			
			R[pos1+i]=Int(GR(counter)-(rstep*i))
			G[pos1+i]=Int(GG(counter)-(gstep*i))
			B[pos1+i]=Int(GB(counter)-(bstep*i))
			
		Next
		
		; increase counter
		counter=counter+1
		
	Wend
	
End Function

.Brightmap1
Data   0.0,  0, 16, 32
Data  15.0,  0, 16, 32
Data  20.0, 64, 64, 64
Data  25.0,128,128,128
Data  30.0,192,192,192
Data  50.0,192,192,192
Data  70.0,192,192,192
Data  75.0,128,128,128
Data  80.0, 64, 64, 64
Data  85.0,  0, 16, 32
Data 100.0,  0, 16, 32

.Brightmap2
Data   0.0,224,192,160
Data  15.0,224,192,160
Data  20.0,224,192,160
Data  25.0,160,160,160
Data  30.0,128,128,128
Data  50.0,128,128,128
Data  70.0,128,128,128
Data  75.0,160,160,160
Data  80.0,224,192,160
Data  85.0,224,192,160
Data 100.0,224,192,160</textarea> <br><br></td></tr></table><br>
<a name="1019846"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sledge</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> What program did you use to make the lightmaps in that example you made? I make my lightmaps in DeleD which automatically applies the lightmap to the model and sets it to fullbright. It would be a great advantage to be able to apply the lightmaps in B3D as I could modify them though their texture handle. <br></div>I would normally use DeleD also, but for the example I used <a href="/img/maplet.php" target="_blank">Maplet</a> -- it's just a little bit faster for roughs (although you do have the palaver of making texture paths relative). But yeah, DeleD or Maplet, it's just a matter of re-lighting your scene with the various combinations of lights that can occur within, and re-exporting to get each lightmap.<br><br>I'm not sure what good being able access the lightmaps will do you -- they're pre-calculated for a reason, unfortunately. :(<br><br><div class="quote"> What if I have multiple places that I want to have lights be able to turn on and off independently? They can't both occupy the same lightmap. <br></div>You would need one lightmap for each combination of lights. So for the example it's either the entrance light alone or the entrance light + green glow, hence two lightmaps. (Obviously this approach entails splitting your scene into discreet sections, but that's helpful for keeping the rendering overhead low so already recommended.) <br><br></td></tr></table><br>
<a name="1020073"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ClayPigeon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I'm not sure what good being able access the lightmaps will do you -- they're pre-calculated for a reason, unfortunately. :( <br></div><br>Sorry, I should have said that differently - I meant I could apply them more than once, set their layer index, set their blend mode, etc. When they're part of the model, I can't change them at all. I didn't mean perform realtime manipulations, I agree, that would defeat the whole purpose.<br><br><div class="quote"> You would need one lightmap for each combination of lights. <br></div><br>I'm not so sure about that. If there are many dynamic lights in the scene, that could defeat the whole purpose too - backwards support for older systems. Think about how much space that could potentially take up.<br>eg:<br>2 adjustable lights, 2 states for each, 2*2=4 -sure, OK, just 4 lightmaps<br>but,<br>8 adjustable lights, 2*2*2*2*2*2*2*2=256 -that means you need to make 256 lightmaps. -woah.<br><br>If I exported each section of the level that was affected by each light, each could have their own on/off lightmap. That way, I could change the lightmap for each separate model without ridiculous amounts of lightmaps. Unfortunately, that would not work so well with lights whose range overlap. <br><br></td></tr></table><br>
<a name="1020107"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BIG BUG</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> How to combine Blitz Lights with lightmap:<br><br>Store your lightmap in the first layer and use TextureBlend 3 so it will be added to the Blitz lighting. <br>The regular level texture uses the second layer and gets multiplied with the lightmap.<br>Set ambient light to black.<br><br>Here an example which shows the necessary setup(1.4 MB):<br><a href="http://www.mein-murks.de/software/Donut.zip" target="_blank">http://www.mein-murks.de/software/Donut.zip</a> <br><br></td></tr></table><br>
<a name="1020114"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ClayPigeon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> That's actually a really good idea, and it would work well, except I can't get the model to have fullbright turned off. I think I need to use gile[s] because I've seen choices in it to turn off automatic fullbright. It just doesn't make sense sometimes. Sometimes, I set the model to have lightmap instead of vertex lighting, and I set it to cast shadows and all, but when I render, it doesn't show anything. I need a good tut for gile[s], because I can't seem to find one with Google.. <br><br></td></tr></table><br>
<a name="1020167"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh, there aren't any tuts for it - you're not alone, that crushed my heart too (well, there is a simple one, I think it comes with the program or is in the help file or whatever).<br><br>You're better off practicing yourself - in the end, it's somewhat simple to use. Only trust the viewports right AFTER you render the lightmap, if you made any changes in your scene. <br><br></td></tr></table><br>
<a name="1020221"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ClayPigeon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, I don't know how its directional lights are set up, but I created a direction light as the sun for my level and rendered it, but everything stayed dark. Then, I moved it closer, rendered again, and got a light streak across my mesh. (??) <br><br></td></tr></table><br>
<a name="1020236"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah, the preparation of the scene might be the hardest thing with Gile[s]. <br><br>I think you should start with everything small.<br><br>Put the directional light\any light you'll use really close up to the mesh (almost touching it), then go bringing it far away, increasing the far value, adjusting the intensity etc. <br><br></td></tr></table><br>
<a name="1020261"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ClayPigeon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, what I can't figure out is how to make a directional light in Gile[s] that is basically like a sun. Whatever angle I set it to it will shine light indefinitely. I know it's possible, I just can't figure out how to do it. <br><br></td></tr></table><br>
<a name="1020265"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Oiduts Studios</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> Same here, there are no tutorials and it seems complicating. When you place a light you can not see it, or is that just me? I have had it for about 2 months and kind of gave up on it but I would love to be able to use it. <br><br></td></tr></table><br>
<a name="1020274"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ClayPigeon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't see a light when I place one -- the only way I can tell it's there is when it's selected, it gets a white box around it, but that's about it. You can select it from the panel to the right. <br><br></td></tr></table><br>
<a name="1020289"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sledge</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I'm not so sure about that. If there are many dynamic lights in the scene, that could defeat the whole purpose too - backwards support for older systems. Think about how much space that could potentially take up.<br>eg:<br>2 adjustable lights, 2 states for each, 2*2=4 -sure, OK, just 4 lightmaps<br>but,<br>8 adjustable lights, 2*2*2*2*2*2*2*2=256 -that means you need to make 256 lightmaps. -woah.<br><br>If I exported each section of the level that was affected by each light, each could have their own on/off lightmap. That way, I could change the lightmap for each separate model without ridiculous amounts of lightmaps. <br></div>Well that's exactly what is meant by "splitting your scene into <u>discreet</u> sections", so award yourself a big fat Fail for English comprehension (I blame the teachers) but also a pat on the back for independently arriving at the same conclusion. :D<br><br>Nevertheless, within each <u><i>discreet</i></u> section, you'll still need a lightmap for each possible lighting state. Given this, one possible way of keeping the total number of lightmaps minimal (taking it as read that more than a couple of lights per area is MADNESS) would be to construct your levels from prefabs -- hence many sections of your level(s) could share lightmaps while being textured differently for variety.<br><br><div class="quote"> Unfortunately, that would not work so well with lights whose range overlap. <br></div>Then don't have them overlap; Keep them <i><u><b>discreet</b></u>, distinct, separate</i> from one another. :D<br><br>Really this is half the battle -- recognising the constraints of the technology at your disposal and working within them. As soon as you aspire to any kind of dynamic lighting it will immediately start to dictate level design, mostly because it's so costly to get them to appear to interact. <br><br></td></tr></table><br>
<a name="1020293"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ClayPigeon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, it appears that the example BIG BUG posted might work well. <br><br><div class="quote"> award yourself a big fat Fail for English comprehension <br></div><br>I wasn't sure what kind of 'sections' you were talking about. (mesh? lightmap? texture??) <br><br></td></tr></table><br>
<a name="1021194"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sledge</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I wasn't sure what kind of 'sections' you were talking about. <br></div>Yeah I know. It's annoying to have what you said repeated back at you as if you didn't say it, but kinda unavoidable given our multifaceted jargon. No sweat.<br><br><div class="quote"> the example BIG BUG posted might work well <br></div>Depends what you're after as vertex lights won't cast shadows, but that could still be a good fit for your cave scenario. Bear in mind that vertex lights aren't free, though -- you might be able to get the effect you want just by altering the colour of the cave's interior (ie from dark grey to brighter green), no light-map swapping or vertex lights necessary.<br><br>Tangentially, there was an example of "shining" a vertex light onto a surface and having it burn through to an underlying texture posted yonks ago. I'll just mention that in case it jogs someone's (the author's?) memory as I can't remember the specifics. <br><br></td></tr></table><br>
<a name="1021218"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> there was an example of "shining" a vertex light onto a surface and having it burn through to an underlying texture <br></div><br><br>Quake II did this, I think? Vertices (or points of some description - Quake II obviously not using the same 3D system as Blitz) attached to the walls at the location of each lightmap pixel, and then the lightmap updated with the lighting of each such vertex...? (i.e. not actually using hardware lighting at all - the vertices are just "lit" using background maths).<br><br>EDIT: I remember this got my attention for two reasons: 1) Q2 is astonishingly fast on modern hardware even in software-rendered mode, so dynamic lightmaps can't be that slow; and 2) the only hard/slow part of this is working out the 3D coordinates of a given lightmap UV, which you can pre-calc with the rest of your lightmap (tedious but not actually very difficult). <br><br></td></tr></table><br>
<a name="1021418"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ClayPigeon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Depends what you're after as vertex lights won't cast shadows, but that could still be a good fit for your cave scenario. <br></div><br>All I'm trying to get is dynamic lighting accompanied by a precalculated lightmap, and so far, vertex lighting seems to be doing the best. If Blitz lights had shadows that would be GREAT! ..but yeah, they don't. Bummer. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
