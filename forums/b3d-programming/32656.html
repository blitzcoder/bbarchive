<!DOCTYPE html><html lang="en" ><head ><title >2 pass renders and blending</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >2 pass renders and blending</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >2 pass renders and blending</a><br><br>
<a name="350233"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MadJack</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I know that you can set a camera to render without clearing the last render's image (colour).<br><br>However, what if you want to blend a camera's render with the last rendered frame? <br><br>Do you have to resort to copying to a texture applied to a quad covering the canera? Is that the only way? <br><br></td></tr></table><br>
<a name="350662"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MadJack</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm - either I've asked a blindingly obvious question or nobody knows (which is unlikely)?<br><br>Rob, Sswift? Anyone? <br><br></td></tr></table><br>
<a name="350667"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Define "blend". <br><br></td></tr></table><br>
<a name="350668"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >fredborg</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, you need to copy it to a texture and apply it to a quad. <br><br></td></tr></table><br>
<a name="350670"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> "However, what if you want to blend a camera's render with the last rendered frame?"<br><br>If you want to blend with the previous camera view, you may also want to clear the zbuffer, but that depends on whether you're doing something like lightmapping, in which case you don't.<br><br>As for how to blend... well, you just set the blend mode for all the entities to something other than alpha, since you obviousyl don't have any alpha maps enabled or you'd be blending already. :-)  <br><br>For lightmaps, like if you render the lightmap first, you'll want multiply or multiply x2 for the entities.<br><br>Keep in mind that blended entities don't write to the zbuffer.  But so long as your lightmap pass has laid down the right z values you should be okay.  But if you're not doing lightmapping then you might find it hard to get whatever effect you're going for. <br><br></td></tr></table><br>
<a name="350690"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MadJack</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, forgive my programming dodginess, what I want is the following;<br><br>I want to display my level geometry with essentially three texture layers using three different UV sets. Basically the level texturing (e.g. wall textures), a lightmap (say from Giles), and then for quick and (very) dirty lighting effects (avert your eyes Halo), a planar mapped bitmap onto which light circle's can be drawn to give brilliant 'flashes of light'. <br><br>I thought a possibility would be to render the level proper (with wall textures and lightmap) and then do a second pass rendering a copy of the level showing only the planar mapped light circle, and then blending the two renders.<br><br>Is this possible? <br><br></td></tr></table><br>
<a name="350722"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AntonyWells</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> You'll want to disable color buffer clearing, cameraClsMode,0,true.<br><br>also, disable z buffer if you want following renders to 'integrate' into the already rendered 3d scene properly(Good for multi-pass fx.)<br><br>to blend in the light..i'd suggest mod5 on the second render mesh, and then setting the second pass to entityblend mesh,3(add) so you'll render in over the top rather than replacing it. alpha's no good 'cos then you'll get all the unseen polys showing up. <br><br></td></tr></table><br>
<a name="350725"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MadJack</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Otacon<br><br>Thanks for the tips - I'll give that a go this evening. <br><br></td></tr></table><br>
<a name="350727"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MadJack</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I guess the other issue is that using a planar mapped lightmap will mean that vertical walls will be lit by only one pixel in the y axis (from the lightmap), and that a light on the floor would also light the ceiling above with the same intensity, no matter how high that ceiling.<br><br>And I guess the solution is to use a non planar lightmap, get the polys affected by the light, calculate their UV's and draw appropriate shading onto the lightmap so that the appropriate polys light up within the level?<br><br>Am I on the right track? <br><br></td></tr></table><br>
<a name="350793"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> No.<br><br>I considered makign such a system, but be warned.  I have come to the conclusion that even with advanced culling methods, it's likely to be too slow to do in a real scenario.  You might get away with two lights.<br><br>Here's what you do though:<br><br>Create one light texture which is a circle of light.  Turn on UV clamping.  Texture should be black all around edge.<br><br>Copy middle row of pixels to a second texture.  Set this to have UV clamping as well.<br><br>Now find the polygons that fall within the region of light, and create a new mesh.  Set the first set of UV coordinates to the XY planar projection from that location.  Place the first texture in the first texture unit and set it to multiply.  (Textures are multiply by default, so you don't actually have to set it.)  Then project the Z coordinate as well and set that to the second set of UV coordinates.  Then place the second texture in the second texture channel of your mesh.  This will also be multiply blended.  <br><br>Finally, set the mesh to add with the lightmaps behind it.<br><br>All done!<br><br>What you're basically doing is projectcing a cylynder of light perpendicular to the XY plane that falls off towards the outside of the cylynder from the center.  But you are then multiplying the brightness of that cylynder by the falloff on the Z axis as well.  This results in a spherical region of light.<br><br>With two 2D maps, you might even be able to create a cone of light so you have something more akin to a spotlight.  But I'll leave that as an exercise fo rthe reader. <br><br></td></tr></table><br>
<a name="350859"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> It can be done pretty easily if you are using brush geometry.  I just use a version of CShop's UV mapper to do these kinds of lights.  I wouldn't use any more than about 5 at a time, but they work fine, and are fast as long as there aren't too many.<br><br>You don't even have to calculate tex coords for each vertex.  Just UV-map them at load time and then you only need to adjust the texture offset to "map" them during the loop. <br><br></td></tr></table><br>
<a name="351632"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MadJack</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sswift/Halo<br><br>Thanks for the info guys. I've set things up in the following way;<br><br>The level geometry is vertex lit for static lights, with occluded vertices not being lit.<br><br>Entities (within a short range) are dynamically vertex lit (3 lights max). Beyond range, they're set to DX shading.<br><br>For bright 'flashes', planar mapped coloured light circles can be drawn onto the level geometry. These can blend into one another and don't require building a mesh. They're pretty fast - the downside is that being planar, they'll cover a vertical wall with one colour, regardless of how high it is.<br><br>However, by using a simple top-down wall mask over the light circle image and repeated re-rendering, I can 'smear' the mask outwards over the light circle image, achieving a simple shadow fx.<br><br>Also by fading the light circles by their distance from camera and by their height above level geometry, I hope to mitigate problems. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
