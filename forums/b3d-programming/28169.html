<!DOCTYPE html><html lang="en" ><head ><title >EntityDistance Vs Sqr(a^2+b^2+C^2) speeds.</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >EntityDistance Vs Sqr(a^2+b^2+C^2) speeds.</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >EntityDistance Vs Sqr(a^2+b^2+C^2) speeds.</a><br><br>
<a name="296007"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >poopla</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've found on my system EntityDistance() is about 25% faster then using pythagoras' method.  So start using entity distance in 3d instead! <br><br></td></tr></table><br>
<a name="296010"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rob</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think most of us do use entitydistance.<br><br>And ^ is dead slow... very very slow! use this equation instead!<br><br>Sqr(xd*xd + yd*yd + zd*zd) <br><br></td></tr></table><br>
<a name="296016"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >poopla</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Good find!  I just tested that myself as I was curious about what overhease ^2 would have.  Thanks for the update. <br><br></td></tr></table><br>
<a name="296017"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Almo</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah... ^ supports 2^2.5 which is quite a slow calculation. x*x is less general, and is faster. <br><br></td></tr></table><br>
<a name="296023"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Eole</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> But if you read some book about game <br><br>the distance =|x1-x2 | + |y1-y2| + |z1-z2|<br><br>@+<br>Eole <br><br></td></tr></table><br>
<a name="296025"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> which book? you never know, maybe pythagoras was wrong.<br><br>BTW don't forget that you need two entities to use entitydistance. to calulate the distance of two points it would probably be faster to use the maths than to create two pivots and get entitydistance and then delete them again. <br><br></td></tr></table><br>
<a name="296029"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >poopla</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Why create two pivots every loop?  Just make them global, and reuse them every time. <br><br></td></tr></table><br>
<a name="296038"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> ok. but you still need to position them :P <br><br></td></tr></table><br>
<a name="296051"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Koriolis</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> But if you read some book about game <br><br>the distance =|x1-x2 | + |y1-y2| + |z1-z2| <br> <br></div>It's not the same, it's called L1 distance (well some mathematicians call it that way). The "real" distance is really Sqr( (x1-x2)^2 +(y1-y2)^2 +(z1-z2)^2) and is called the L2 distance. In situations where accuracy matters less than speed, then the L1 distance is worth using. <br><br></td></tr></table><br>
<a name="296057"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> for distance comparisons you can also optimize by staying in squared space:<br><br>If Sqr(x*x+y*y+z*z)&lt;d<br><br>can be written:<br><br>If (x*x+y*y+z*z)&lt;(d*d) <br><br></td></tr></table><br>
<a name="296061"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Floyd</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>the distance = |x1-x2 | + |y1-y2| + |z1-z2| ... <br><br>It's not the same, it's called L1 distance (well some mathematicians call it that way).<br> <br></div><br>When I studied topology that measure of distance was also called the Taxicab Metric.<br><br>It measures distance when you are confined to a grid.<br><br>In a city suppose you need to travel to a place 3 blocks north and 4 blocks east. <br>The distance is 3 + 4 = 7 if you travel along the streets.<br><br>The distance is Sqr( 9 + 16 ) = 5 if you can fly. <br><br></td></tr></table><br>
<a name="296062"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >poopla</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Precisely. <br><br></td></tr></table><br>
<a name="296091"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rob</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> SR, do you have a demo of any of this stuff you're doing? <br><br></td></tr></table><br>
<a name="296183"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Eole</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> For culling or other thing, you never need the real distance, so use it <br><br></td></tr></table><br>
<a name="296219"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> So L1 distance would be 2 if you go from one corner of a square to the other, because it goes up one side, and across the other, and L2 distance would be 1.414213562 because it calculates the distance of the true shortest route, which is across the diagonal.<br><br>There's several other ways to estimate distance as well.  Isn't the L1 distance also known as the Manhattan distance?  That would make sense because Manhattan is divided into a grid.  I've never heard any distance measurement called the "Taxicab metric". <br><br></td></tr></table><br>
<a name="296275"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Koriolis</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  Isn't the L1 distance also known as the Manhattan distance? <br></div>Yep, exactly. Reminds me my old math courses. Seems so far now... <br><br></td></tr></table><br>
<a name="296298"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Eole</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, a link :-)<br><br><a href="http://www.flipcode.com/articles/article_fastdistance.shtml" target="_blank">http://www.flipcode.com/articles/article_fastdistance.shtml</a><br><br>in this article there a Fast Approximate Distance Functions<br><br>@+<br>eole <br><br></td></tr></table><br>
<a name="296311"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm pretty sure there's an article on gamasutra.com which offers several distance approximation functions as well, because there was an article in game developer magazine on that several years back.<br><br>Personally, I think if you're optimizing your distance function then it's very likley that you're doing the wrong thing and could get much greater speed improvements by improving your algorithm.  <br><br>For example, in my Bunny Blast screensaver, I had a thousand land mines spread out over a feild, and a hundred bunnies.  I needed to know if any bunnies approached any of the land mines too closely.<br><br>My first attempt was the brute force method.  But in Dark Basic, which is what I coded the screensaver in, doing 100,000 distance calculations per frame was just too slow.  (In Blitz, it might have been more realistic since I didn't have much else going on in the world.)<br><br>Now, I could have tried to optimize the distance function and simply used an approximation.  But even then, who's to say it would have been fast enough?  Dark Basic was an interpreted language after all.<br><br>So I decided to alter my algorithm instead.  There were many different kinds of algorithm I could have used to solve this problem, but the one _I_ chose for this scenario, was to place the landmines in a grid, with a maximum of one land mine per grid square, and centered in the grid square.<br><br>Then it became a simple matter of creating an array which said if a land mine was in a particular square, and each frame I merely calculated which square the center of each bunny was in.  Then I determined the distance to the land mine if there was a land mine in that square that was active.<br><br>This drastically reduced the number of computations I needed to do.  But there were other ways I could have solved the problem without restrting to having one land mine per grid square.  I could have done awya with the grid entirely and used an octree, or simply made the grid system a little more sophisticated and had a linked list containing all land mines that had radii which fell within a particular grid square. <br><br></td></tr></table><br>
<a name="296343"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rob</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Not true sswift. There are many situations where you need to check the distances of many things, for example vertexes. <br><br></td></tr></table><br>
<a name="296379"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, but even if you need to do that, then there are ways to approximate the result that you could use which would be far faster than calculating an exact result.<br><br>For example, if you have a 64,000 vertices in a model, but you need to find the center of mass, you can create a 3d grid, and then weight each grid square according to how many vertices it contains.  You can then calculate the median location of only to those grid squares which contain vertcies.<br><br>Okay that might actually be slower than simply adding up the locations of all the vertices and then dividing by the number of vertices.  But if you need to do that  once a frame it implies the data will be changing, and then such an angorithm could have big benefits because you'd only need to add or subtract a few values from your total for cubes that change the number of vertices they contain.  Anyhow, you get my point.  There's rarely a situation you cannot optimize better by using a better algorithm than by writing faster code. <br><br></td></tr></table><br>
<a name="296403"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Eole</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> There is not small optimization.  3 or 4 optimizations put end to end can save 1 FPS.  If all it is counted on the totality of a game one, this small thing arrives has a considerable profit of FPS. <br><br></td></tr></table><br>
<a name="296405"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> French to English translation:<br><br>"The little stuff can add up."<br><br><br><br>I have to disagree.  While optimizing this distance function might save you 5fps, optimizing the ALGORITHM will save you 10, and the optimization of the distance function then, since it will only be called 20 times instead of 20,000, will only give you a 0.005 fps increase on top of that.<br><br>And while every little bit counts, you have to consider if it's worthwhile to even bother with.<br><br>Of course I encourage anyone to use the SQUARED distance when possible, because that requires no extra effort.  But you can't always use these weird alternative distance functions and get away with it.  And anyhow, my point was that you should optimize the algorithm FIRST, not that you should not attempt to optimize the distance function.<br><br>What I suggest is that if something is too slow, you examine the algorithm first, and see if you can divide the problem up into a set of smaller problems... gorup objects together for example, and then only work on those within a certain region.  And THEN, once you're sure you've got a good algorithm, you can go for the smaller optimizations.  But I can't recall a time when I have really needed to optimize a distance function in my code.  I use the squared distance when I can out of habit, but I don't think I've had any situations where it actually provided a significant benefit.<br><br>Btw, that's another trick you should be aware of.  If you are merely COMPARING two distances then you can just delete the square root, and compare the two results, and you will get perfeclty accurate results with very little cost. <br><br></td></tr></table><br>
<a name="296419"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rob</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> That said, there is considerable speed difference between ^ and *. <br><br></td></tr></table><br>
<a name="296423"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Koriolis</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> And while every little bit counts, you have to consider if it's worthwhile to even bother with. <br></div>Glad to see this bunch of wiseness :)<br>That's my whole phylosophy: don't count your time when it comes to optimize globally (algorithm-wise) or locally (like using faster distance computations) but only in the very few critical areas, like in a loop that gets executed thousands of times per frame. Never, ever lose your time (and your source readability and maintainability) doing local optimizations on a part of the code that has no significant impact on the speed (and that's 95% of the code).<br>And also as stated by Sswift, optimize globally first, and start to do local optimizations as the very last stage, once everything is stable and well architectured. <br><br></td></tr></table><br>
<a name="296483"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >semar</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> Very good advices here. Worth reading.<br><br>This community is a gold mine.<br><br>Thanks to all,<br>Sergio. <br><br></td></tr></table><br>
<a name="296527"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> How about using three if statements. Surely that must be super quick? check the x then the y then the z? <br><br></td></tr></table><br>
<a name="296542"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Koriolis</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hem, probably not. 'If' statements are usually the slowest part of the code, because it gets compiled to conditional jumps. And  jumps are slow because it empties the CPU pipeline, ie it discards the instructions that were being executed ahead of time (though branching prediciton tempers a bit this fact). <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
