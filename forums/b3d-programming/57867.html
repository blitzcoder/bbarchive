<!DOCTYPE html><html lang="en" ><head ><title >Realisitic movement in space using a joystick</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Realisitic movement in space using a joystick</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Realisitic movement in space using a joystick</a><br><br>
<a name="643617"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >my_name_is_alex_hello__</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi, I'm currently working on a space simulator, and since im doing a level maths i thought i'd introduce the principles of taking moments and resolving into the movement of the spaceship. The way this works is to define thrusters, their force, their position relative to the ship and their direction, and then enable or disable these thrusters depending on the joystick position, and then resolve and take moments to find out the movement and rotation of the ship. However, although ive worked this out on paper and as far as i know it should work, when I try to fly the ship in game, the angles are clearly not getting translated into proper forces in the proper directions. <br>It would be great if someone would look over the following code and tell me if ive put a cos in the wrong place or somthing stupid like that. Thanks in advance, Alex<br><br>--------------IMPORANT-----------------<br>The code below will not work on its own, you need to make a text document called '1.txt' in the same directory which contains data about the thrusters on the ship. The text for 1.txt is below the code for the program.<br><br><br>The code itself is here:<br><br>[CODE]<br>;Controls- either joystick input OR<br>;use arrows for pitch and yaw, Q and E for roll left and roll right. W and S are forwards and backwards<br>;A and D are strafe left and right<br>;When the ship turns, the downward force of the thrusters not only turns the ship but also causes<br>;it to move, this is intended since it is what would actually happen.<br><br>;The problem with this code, I suspect, is that I am either taking the angle of the ship incorrectly<br>;or I am using sin and cos in the wrong places, or another stupid error like that :(<br>Graphics3D 800,600,32,2<br>SetBuffer BackBuffer()<br>;Cubes for frame of reference<br>For c=1 To 20<br>cu=CreateCube()<br>PositionEntity cu,Rand(-20,20),Rand(-20,20),Rand(-20,20)<br>Next<br>;Star background<br>s=CreateSphere(32)<br>FlipMesh s<br>ScaleEntity s,100,100,100<br>t=CreateTexture(512,512)<br>SetBuffer TextureBuffer(t)<br>For i=1 To 300<br>	size=Rand(1,2)<br>	Rect Rand(0,512),Rand(0,512),size,size<br>Next<br>EntityTexture s,t<br>SetBuffer BackBuffer()<br>;Globals<br>Global x#,y#,z#,xv#,yv#,zv#,ax#,ay#,az#,axv#,ayv#,azv#<br>Global shipname$,shipmass#<br>;Types<br>Type thruster<br>Field ax#,ay#,az#,x#,y#,z#,thrust#,parent,on#,id<br>End Type<br>;Load the thruster profile for the ship (this textfile must be made in order for the program to funtion)<br>loadthrusters("1.txt")<br>Global ship=CreateCube()<br>Global cam=CreateCamera(ship)<br>EntityType ship,1<br>EntityRadius ship,2<br>EntityType s,2<br>Collisions 1,2,2,3<br>While Not KeyHit(1)<br><br>;DETECT JOYSTICK INPUT. (For the purposes of this test I have also enabled key input)<br>;LEFT Y AXIS<br>roll#=JoyRoll()<br>If Abs(roll#)&lt;1 Then roll#=0<br>If roll#&lt;0.01  Then<br>	choosethruster(4,(roll#/180.0))<br>	choosethruster(5,(roll#/180.0))<br>EndIf<br>If KeyDown(203) Then<br>	choosethruster(4,1)<br>	choosethruster(5,1)<br>EndIf<br>;RIGHT Y AXIS<br>If roll#&gt;0.01 Then<br>	choosethruster(3,(roll#/180.0))<br>	choosethruster(6,(roll#/180.0))<br>EndIf<br>If KeyDown(205) Then<br>	choosethruster(3,1)<br>	choosethruster(6,1)<br>EndIf<br>;UP X AXIS<br>pitch#=JoyY()<br>If pitch#&lt;0.01 Then<br>;steer down<br>choosethruster(7,pitch#)<br>choosethruster(10,pitch#)<br>EndIf<br>If KeyDown(208) Then<br>choosethruster(7,1)<br>choosethruster(10,1)<br>EndIf<br>If pitch#&gt;0.01 Then<br>;steer up<br>choosethruster(8,pitch#)<br>choosethruster(9,pitch#)<br>EndIf<br>If KeyDown(200) Then<br>	choosethruster(8,1)<br>	choosethruster(9,1)<br>EndIf<br>;ROLLING<br>yaw#=JoyX()<br>If yaw#&gt;0.01 Then<br>	choosethruster(12,yaw#)<br>	choosethruster(11,yaw#)<br>EndIf<br>If KeyDown(16) Then<br>	choosethruster(12,1)<br>	choosethruster(11,1)<br>EndIf<br>If yaw#&lt;0.01 Then<br>	choosethruster(13,yaw#)<br>	choosethruster(14,yaw#)<br>EndIf<br>If KeyDown(18) Then<br>	choosethruster(13,1)<br>	choosethruster(14,1)<br>EndIf<br>;Primary Engine Thrusters<br>If KeyDown(31) Then choosethruster(1,1)<br>If KeyDown(17) Then choosethruster(2,1)<br>If KeyDown(30) Then<br>	choosethruster(3,1)<br>	choosethruster(5,1)<br>EndIf<br>If KeyDown(32) Then<br>	choosethruster(5,1)<br>	choosethruster(6,1)<br>EndIf<br><br>takemoments()<br>resolve()<br>updateship()<br>UpdateWorld()<br>RenderWorld()<br><br>Text 10,10,"Pitch "+EntityPitch(ship)<br>Text 10,30,"Yaw "+EntityYaw(ship)<br>Text 10,50,"Roll "+EntityRoll(ship)<br><br>Text 10,70,"z acc "+zv#<br>Text 10,90,"x acc "+xv#<br>Text 10,110,"y acc "+yv#<br>Flip<br>Wend<br><br><br>Function choosethruster(id,amount#)<br>;Enables the correct thruster for the input recieved, with the correct force as determined<br>;by the joystick push amount<br>	For t.thruster= Each thruster<br>		If t\id=id Then<br>			t\on#=Abs(amount#)<br>		EndIf<br>	Next<br>End Function<br><br>Function takemoments()<br>;Takes moments of the thrusters, this increases the angle of the ship depending on thruster angle,<br>;power, and distance fromt the center of mass of the ship<br>For t.thruster=Each thruster<br>	If Not t\on#=0 Then<br>		axv#=axv#+(((t\z#)*(t\on#*Sin(-t\ax#)))/shipmass#)<br>		azv#=azv#+(((t\x#)*(t\on#*Sin(-t\ax#)))/shipmass#)<br>		ayv#=ayv#+(((t\z#)*(t\on#*Sin(-t\ay#)))/shipmass#)<br>	EndIf<br>Next<br>End Function<br><br>Function resolve()<br>;Increases the velocity of the ship taking into account the angle of the ship relative to the<br>;absolute coordinate vectors (if that is what they are named)<br>For t.thruster=Each thruster<br>If Not t\on=0 Then<br>yv#=yv#+((t\on#*Sin(ax#-t\ax#))/shipmass#)<br>xv#=xv#+((t\on#*Sin(ay#-t\ay#))/shipmass#)<br>zv#=zv#+((t\on#*Cos(ay#-t\ay#))/shipmass#)<br>EndIf<br>t\on#=0<br>Next<br>End Function<br><br>Function updateship()<br>;Limits the maximum speed of the ship, dampens the velocity of the ship, and <br>;moves and rotates the ship using turn and translateentity.<br>	If ayv#&lt;-2 Then ayv#=-2<br>	If ayv#&gt;2 Then ayv#=2<br><br>axv#=axv#*0.99<br>ayv#=ayv#*0.99<br>azv#=azv#*0.99<br>xv#=xv#*0.99<br>yv#=yv#*0.99<br>zv#=zv#*0.99<br>;Translateentity is used rather than moveentity because if the entity was moved, the spaceship<br>;Would not behave in the correct way.<br>TranslateEntity ship,xv#,yv#,zv#<br>TurnEntity ship,axv#,ayv#,azv#<br>End Function<br><br><br>Function loadthrusters(name$)<br>Print "loading ships..."<br>f=OpenFile(name$)<br>For i=1 To 13<br>ReadLine$(f)<br>Next<br><br>shipname$=ReadLine$(f)<br>shipmass#=ReadLine$(f)<br>Print shipname$+" at"+shipmass+"Kg"<br>numthrust=ReadLine$(f)<br>Repeat<br>reached=reached+1<br>t.thruster=New thruster<br>ReadLine$(f)<br>t\id=ReadLine$(f)<br>t\thrust#=ReadLine$(f)<br>t\x#=ReadLine$(f)<br>t\y#=ReadLine$(f)<br>t\z#=ReadLine$(f)<br>t\ax#=ReadLine$(f)<br>t\ay#=ReadLine$(f)<br>t\az#=ReadLine$(f)<br>If reached=numthrust Then Exit<br>Forever<br>Print "Loaded "+numthrust+"thrusters"<br>;WaitKey()<br><br>End Function<br><br>[/CODE]<br><br>THE ALL IMPORTANT SHIP THRUSTER DATA IS HERE:::<br><br>[CODE]<br>FORMAT FOR SHIP THRUSTERS IS AS FOLLOWS: (ship info followed by as many thrusters as you like)<br>shipname<br>shipmass<br>numthrusters<br>editinfo<br>thrusterid<br>thrusterthrust<br>thrusterx<br>thrustery<br>thrusterz<br>thrusterxa<br>thrusterya<br>thrusterza<br>viper<br>1000<br>14<br>Primary thruster<br>1<br>10<br>0<br>0<br>-1<br>0<br>180<br>0<br>Reverse thruster<br>2<br>3<br>0<br>0<br>5<br>0<br>0<br>0<br>Steer left thruster<br>3<br>1<br>0<br>0<br>5<br>0<br>90<br>0<br>Steer right thruster<br>4<br>1<br>0<br>0<br>5<br>0<br>-90<br>0<br>steer left (rear) thruster<br>6<br>2<br>0<br>0<br>-2.5<br>0<br>-90<br>0<br>steer right (rear) thruster<br>5<br>2<br>0<br>0<br>-2.5<br>0<br>90<br>0<br>steer down thruster<br>7<br>1<br>0<br>0<br>5<br>-90<br>0<br>0<br>steer up thruster<br>8<br>1<br>0<br>0<br>5<br>90<br>0<br>0<br>steer down (rear) thruster<br>10<br>2<br>0<br>0<br>-2.5<br>90<br>0<br>0<br>steer up (rear) thruster<br>9<br>2<br>0<br>0<br>-2.5<br>-90<br>0<br>0<br>roll left thruster<br>12<br>1<br>2<br>0<br>0<br>90<br>0<br>0<br>roll right thruster<br>13<br>1<br>-2<br>0<br>0<br>90<br>0<br>0<br>roll left (opposite) thruster<br>11<br>1<br>-2<br>0<br>0<br>-90<br>0<br>0<br>roll right (opposite) thruster<br>14<br>1<br>2<br>0<br>0<br>-90<br>0<br>0<br>[/CODE]<br><br>Good Luck :D <br><br></td></tr></table><br>
<a name="643742"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=327" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=327</a><br><br><br>I also ran into some problems with trying this mthod, and instead resorted to a pivot and vector-driven style, having a separate velocity for 3 dimensions. <br><br></td></tr></table><br>
<a name="643892"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >my_name_is_alex_hello__</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is that not what i'm doing, or are you talking about vectors that rotate with the ship? If thats the case then the only difference is that you would use moveentity instead of translateentity, otherwise im not sure I get what you mean <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
