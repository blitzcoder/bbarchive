<!DOCTYPE html><html lang="en" ><head ><title >Normal mapping</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Normal mapping</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Normal mapping</a><br><br>
<a name="376851"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Anyone have any ideas on how to use this on the walls of a map?<br><br>I was thinking you could adjust each BSP face's color by surface, in order to get the normal maps to work in tangent space.  However, you can't go splitting your map up into separate surfaces like that, without making the scene unusable for realtime rendering.  I tried using vertex colors, but these aren't used in the dot3 calculation.<br><br>I guess you could split the map up into surfaces that have the same texture and the same normal, but that seems kind of ridiculous, and would cause at least a 6x increase in the number of surfaces.<br><br>I am starting to think the solution to the surfaces limitation may involve copying chunks of memory to a temporary "render" mesh, from the source meshes which are hidden.  I'll have to run some tests. <br><br></td></tr></table><br>
<a name="377260"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kozmi</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> You'll get it dude!! Just keep at it!! I have faith in your abilities! ;) <br><br></td></tr></table><br>
<a name="377378"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> If your walls are in 90 degree angles, i can an app i'm working on just for this. Basically create world space maps. I'm working just now to produce them imported geometry. You basically apply the heightmap texture to the model/level and it will convert the heightmpa to world space normal mapping. <br><br></td></tr></table><br>
<a name="377391"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AntonyWells</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I did a normal mapping that did this..basically you map a scene as if you were lightmapping, so you already know that, but instead of calculating light, map the normal map onto it. But convert the normal map rgb into it's vector, then transform this by the facing of the triangle you're mapping onto.<br><br>Now you hae a valid 3d normal map for the entirely level that's also just 1 texture (use texture leafs, to pack them...you probably already did this for cshop anyway)<br><br>To get just per pixel-lighting on a level though, just do the above, but instead of mapping a normal map, for each pixel get it's 3d position on the triangle in world space,  normalize this, then convert this vector into a normal rgb and paint it onto the normal map. Now just use entityColor with the vector of your light from the mesh, and you get amazing looking volumetric cloudly lighting.  (You still dot3 in this map) (Although you could probably use a cube-map with a 360 degree normal map to do this run time too..might be faster<br><br>Works best on small entities..so you'll probably wanna segment your level anyway. <br><br></td></tr></table><br>
<a name="378815"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Are you suggesting non-tiling normal maps?  The resolution of a normal texture, but the area of a lightmap?<br><br>Could you post a demo of your per-pixel lighting?  I am having trouble visualizing it.  Thanks.<br><br>I did, however, find out that vertex colors do actually affect normal mapping.  So these will be used from here on out.<br><br>This begs the question why the *%&amp;^%?!!! does the dot3 calculation not just use the vertex normal, since it can be performed on a per-vertex basis, and normals transform to world space?!!<br><br><img src="http://www.leadwerks.com/post/matedit.jpg"> <br><br></td></tr></table><br>
<a name="378824"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> WICKED SICK!<br><br><img src="http://www.leadwerks.com/post/matedit01.jpg"> <br><br></td></tr></table><br>
<a name="378882"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AntonyWells</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, the thing is vertex colors do affect dot3(As it changes the base color you dot3 the normal map with)<br>but if you use vertex colors, you have to use tangant mapping, if using traditional 'tiling' textures. <br><br>I.e you have to transform the light vector into the 'tangant' space of each tri. It's freakin' tricky and not a lot of fun.(And slow in blitz. You have to update every vert whenever the mesh and or light source moves/rotates)<br><br>Failing that, you bake the texture it.i.e make the conversation pre-runtime) I.e directly into the geo as you would a lightmap, instead of just mapping the texture thoug, you transform each pixel by the normal of the tri's face.<br><br>Then you can use vert color, but this time just rely on simple vert/tri to light vectors in the colors, rather than the ugly tangant mapping. Or if it's a small object, just use entity color. but with vert color obviously you can use multiple lightsources as you just blend the results colors.<br><br>As for posting the per-pixel lighting demo..I'll have to ask ad if he still has them. I don't. <br><br></td></tr></table><br>
<a name="378883"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AntonyWells</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nm, I'll just use the source to throw a new one together..do you have a mesh I can use? I have one that's not (c) but it's awful and won't exactly show it off.(I made it..nuff said) <br><br></td></tr></table><br>
<a name="379048"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Use EntityColor for small, moving entities.<br><br>Use vertex colors for the non-moving walls of your map.  This lets you create the proper light vector, but lets you keep everything merged into a single surface.  It only has to be calculated once, because the walls don't move around. <br><br></td></tr></table><br>
<a name="379099"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rambus</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> I made a front end for the tangent to world space normal map converter by ATI... I hate using the console; Hopefully this helps some one else out there.<br><br><br>www.g0dsoft.com/conversion.zip <br><br></td></tr></table><br>
<a name="379288"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> In my tests, "per-pixel" lighting with just a flat normal map looks EXACTLY like vertex lighting, and is slower, since you have to calculate the vertex colors. <br><br></td></tr></table><br>
<a name="379365"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AntonyWells</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nah-ah...;)<br><br>I was doing test yesterday as well...And it works great still. I'll upload it soon as I've had a smoke and watch some seinfeld...<br><br>one issue I can't seem to get my head around is dealing with near by vectors..I mean for whatever tri you're you calculating, there's an 'eye' of the vector that just f#$#$ things up royally...<br><br>It's sick to think in this day and age we still have to do such cheap things for decent lighting on even the best gpus. <br><br></td></tr></table><br>
<a name="379412"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tom</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> What I noticed in tests was that you really need a decently subdivided mesh to get a full effect, much like using vertex lighting. This demo shows exactly what I mean.<br><br><a href="http://www.tomspeed.com/bb/subdivision_mesh_normals.zip" target="_blank">http://www.tomspeed.com/bb/subdivision_mesh_normals.zip</a><br><br>3 wall meshes, each subdivided more than the last (hit 'w' to see the subdivision amount)<br><br>mouse to move the light, cursors to move in/out and pan left/right.<br><br>Obiously updating what could be thousands of verts every game loop isn't an ideal situation.<br><br>Tom <br><br></td></tr></table><br>
<a name="379547"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> But doing it once for static lights is fine.  I wouldn't really expect to have a million moving bumpmapped surfaces.  At this point, I don't see anything really great about using this to replace lightmaps or decal lights. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
