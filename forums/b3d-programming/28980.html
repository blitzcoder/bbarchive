<!DOCTYPE html><html lang="en" ><head ><title >Tipp: How to fix that EntityVisible Bug</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Tipp: How to fix that EntityVisible Bug</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Tipp: How to fix that EntityVisible Bug</a><br><br>
<a name="305714"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, I hope it's really a bug and not only some mistake in my code.<br><br>however. In my game I am using light-flare sprites. they become visible whenever the player can see the lightbulb and turn off as soon as the lightbulb is hidden somehow.<br><br>Now it happens oftenly (you might remember the csp demo 1&amp;2) that such a light flare sprite was flashing even when there was a wall or something between the light and the player. (seen on diffrent videocards)<br><br>This only happend ON THE SCREEN BORDER. So if you want to make shure this two guys (EntityInView and EntityVisible) work correctly, then you need to filter it this way:<br><br><pre class=code>
if entityinview(bulb,camera)
 if entityvisible(camera,bulb)
  dummy=cameraproject camera,entityx(bulb),entityy(bulb),entityz(bulb)
  x=projectedx()
  y=projectedy()
  if x&gt;0 and y&gt;0 and x&lt;graphicswidth()-1 and y&lt; graphicsheight()-1 then
   showentity flare ; ok, it is really visible
  endif
 endif
endif
</pre> <br><br></td></tr></table><br>
<a name="305731"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks :) I did notice that in your secret of manes game. Wasn't that big a deal i didn't think, cause the rest of it was very nice :) <br><br></td></tr></table><br>
<a name="306088"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> really? but i thought this wouldn't happen anymore in the secret of manes demo since I added said filter?... well it happened only 1 out of 100 times compared with the older demos without that filter. at least on my machine. Are you shure you are not confusing the demo versions? <br><br></td></tr></table><br>
<a name="306117"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Why not fade the lens flare in or out over the course of 250 milliseconds instead of simply turning it on or off instantly?  Then it wouldn't be so harsh turning on instantly when the center of a light source comes into view, and it would solve your problem. <br><br></td></tr></table><br>
<a name="306172"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> this might work for things coming in view, but it looks unrealistic for lights which are already in the middle of the screen imho.<br><br>I was thinking about this. I will probably do it this way, fade it in when something is near the screen border. and turn it on quickly when it is only flashing in the middle of the screen.<br><br>But there is still the question why does EntityVisible act like this. <br><br></td></tr></table><br>
<a name="306173"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> FYI EntityVisible works for me ok (for Hunted's coronas) I dont know about entities that are 'offset' from their center tho. I would recommend a fade speed of .1 per renderworld this gives a nice 'Unreal' style corona fade. <br><br></td></tr></table><br>
<a name="306175"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, as I said, I am not shure if this is only a mistake in my code, so maybe the title was probably a bad choice. Well, I decided to turn on the flares when they are near the camera range. Since I project their Screen coords anyway, I can also turn them on when they are somehow near EntityInView. This way I can completely replace the EntityInView Command (where x and y are the projected coords):<br>  if x&gt;-200 and y&gt;-200 and x&lt;graphicswidth()+200 and y&lt; graphicsheight()+200 then<br><br>This is only possible cause ProjectedX() is capable of negative values for offscreen coords.<br>But "200" should be a variable that is screen resolution dependent. <br><br></td></tr></table><br>
<a name="306190"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Pretty sure entityvisible on uses centre position. I had to give up using it for occulsion because of this. EntityInView, in regard to sprites, works funny. Have you tried increasing the entityradius for the sprite? <br><br></td></tr></table><br>
<a name="306203"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> No, but I'll try that, thanks for the tip. I didnt define a radius at all since I don't use them for collision. I just tested offscreen projected coords and that works pretty good as well btw.<br><br>EDIT - oops: I use it with the lightbulb mesh - to decide if I got to hide the flare sprite - not visa versa. <br><br></td></tr></table><br>
<a name="306270"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Any joy ? :) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
