<!DOCTYPE html><html lang="en" ><head ><title >How do hardware lights work?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >How do hardware lights work?</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >How do hardware lights work?</a><br><br>
<a name="262616"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I know you can't light a level using hardware lights because you only get 8 of them, but it just occured to me that one could light a level and then have hardware lights in it for the entities.  That doesn't solve the problem of having dynamic lights in your level, but it's a start.<br><br>Anyhow, what I was thinking is if I have like a hundred Blitz lights in my level, then EACH object will be lit by the closest  8 lights to that object...  Is that correct?<br><br>If so then hardware lights are more useful than I was thinking they were for a long time.  I mean they're still no good for lighting your level if you have a lot of bullets that cast light, but 8 lights is more than enough for making said bullets cast light on the individual entities in a level if in fact the 8 closest lights to an entity are used. <br><br></td></tr></table><br>
<a name="262632"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bouncer</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I thought you couldn't do more than eight lights with blitz... but it's cool if it is like you suggest. <br><br></td></tr></table><br>
<a name="262692"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bot Builder</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ah yes. I remember people did a limited version of this. They wanted maplet lights to affect a charachter, so they made a list of light positions, and made the nearest 3 lights affect the player. <br><br>I don't think that's how blitz lights work.Though you can do somthing like it.<br><br>It's possible you might be able to create a whole bunch of lights all over your level, and simply showeentity the ones you need. As far as I know, there's no way to use dx lights on a speciphic object. Yet simply rendering the dx lights that are closest should be pretty effective, as the surfaces they affect are the ones your most likely to see. Though their might be "light popup" problems, whereit suddenly switches. Maybe maintain 5 lights at once, and use three more for transition lights. IE fade in the new lights as you fade the old out.<br><br>You might even try creating whole light priority system. priority would be greater for visible lights, closer lights, more intense lights, more important lights, etc. <br><br></td></tr></table><br>
<a name="262701"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mustang</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Cubemaps would be much better and faster solution for lighting entities on a (lightmapped) level... I hope that we get those and not just cubrmapped reflections when the new Blitz3D update arrives. <br><br></td></tr></table><br>
<a name="262732"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jeremy Alessi</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I created a light swapping routine for and interior and there is some light pop up but it's not terrible in the environment I was dealing with.  What I don't get is why can't you use the lights for bullets or whatever?  They may not look great but it would still have the same affect as other games. <br><br></td></tr></table><br>
<a name="262766"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> "What I don't get is why can't you use the lights for bullets or whatever? They may not look great but it would still have the same affect as other games."<br><br>My tank game has a LOT of bullets.  One of my bullets is the burst shot where you fire one bullet, and it explodes into 8 more after a couple seconds.  That right there would nearly exceed the number of hardware lights available.  Now imagine there's 4 people firing bullets around which can each spawn three, five, or even eight bullets.<br><br>And on top of that, I have powerups that I would like to cast light when they spawn.<br><br>So, using hardware lights for bullets and firing in my game just isn't realistic.  It's not like a first person game where you can only see a few guys on the screen at once.<br><br><br>"Cubemaps would be much better and faster solution for lighting entities on a (lightmapped) level..."<br><br>And how do you figure that?  Cubemaps require you to render six views of the current scene.  Any object that's moving would need to be constantly updated.<br><br>There's no way that's faster than hardware lights.<br><br>The only thing it would be acceptable to use it for is outdoors.  Then you could render a single cubemap of the light cast from the sun and refelcted from the ground and sky, blur it a lot, and use it so long as your character is standing on ground of a particular color. <br><br></td></tr></table><br>
<a name="262768"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> "As far as I know, there's no way to use dx lights on a speciphic object."<br><br>That's not what I meant.<br><br>I meant the 3D card, or Direct3D, would choose the 8 nearest lights, and use them.<br><br>Well I guess there's a way to test it. <br><br></td></tr></table><br>
<a name="262773"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay I just tested using mark's trong demo.  I made 50 lights, each a different color with little spheres so I could see where the lights were.<br><br>It looks like only the first 8 lights which are visible are acutally used to light anything in the world.  The other lights cast no light at all no matter how far I am from the other lights. <br><br></td></tr></table><br>
<a name="262822"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mustang</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> "Cubemaps would be much better and faster solution for lighting entities on a (lightmapped) level..." <br><br>And how do you figure that? Cubemaps require you to render six views of the current scene. Any object that's moving would need to be constantly updated. <br><br>There's no way that's faster than hardware lights. <br><br>The only thing it would be acceptable to use it for is outdoors. Then you could render a single cubemap of the light cast from the sun and refelcted from the ground and sky, blur it a lot, and use it so long as your character is standing on ground of a particular color. <br></div><br><br>Sswift,<br><br>Oop, no, I didn't meant that cube(s) would be better for "bullet lights"... just look/function better generally speaking. What I tried to say was that they are good for describing complex lighting setup with one simple cube - and that's why they are better/faster. <br><br>With complex I mean same kind of setup you described above. But I think that it would work well (good enough) with indoor level geometry too, although it would be incorrect in the far ends of the "room" too. Until I can test that, I don't know. <br><br></td></tr></table><br>
<a name="262909"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >IPete2</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay,<br><br>I don't know if this helps, but I am working a team currently who do a render pass for each light (in C++).  <br><br>Now maybe with 8 lights you can get more out of them by doing multiple rendering, is there anyway of adding to a render pass?  <br><br>Perhaps in Blitz this is not quite possible, just a thought.<br><br>IPete2. <br><br></td></tr></table><br>
<a name="262946"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Miracle</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Note that you can fake lights any number of ways. The easiest is to make glowing things cast a big fuzzy "bright shadow." And there's always the fake vertex lighting stuff.<br><br>The 8 HW lights is a limitation of the graphics card, by the way, not Blitz or DX7. Some older cards can only do 4 or even 2. <br><br></td></tr></table><br>
<a name="262974"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh sure I could do multiple passes to render lights, but multiple passes aren't free.<br><br>Hm... My levels don't have too many vertices... maybe I could get away with vertex lighting manually.  Just take every light in the level, calculate their distance from a vertex add them all together and then set each vertice's color once per render loop.  Might be able to get away with it.  My levels have less than 10K polys...  <br><br>Hm..... <br><br></td></tr></table><br>
<a name="263106"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BlitzSupport</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> See if EdzUp's code is any use for your purposes...<br><br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=509" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=509</a> <br><br></td></tr></table><br>
<a name="263136"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FlameDuck</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  Oh sure I could do multiple passes to render lights, but multiple passes aren't free.  <br></div>Neither are multiple hardware lights. I think Miracle's "bright shadow" is probably the best way to do it.<br><br>Incidently the "8 lights restriction" is a T&amp;L restriction. Before there was hardware T&amp;L you could do as many as you wanted, but you had to do it all in software. Look up Gouraud Shading on Google for more info. Oh, and doing this manually in Blitz would probably be way too slow to also be practical. <br><br></td></tr></table><br>
<a name="263143"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> I know that the 8 lights restriction is a T&amp;L restriction, and what goraud shading is.<br><br>And I know that hardware lights aren't free, but they're a hell of a lot more free than multiple render passes.<br><br>As for your assetion that it's too slow to do it manually in Blitz, that may be true for a lot of cases, but if you don't have a lot of polygons to light then I think you might be able to get away with it.  My shadow system probably is probably way more costly to render than some simple vertex lights.<br><br>And I don't know why you mention goraud shading.  You don't have to do any goraud shading to do vertex lights.  That's all done by the hardware.  You just change the vertex colors. <br><br></td></tr></table><br>
<a name="263148"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> I thought u could use up to 16 and maybe even more 'lights' in Blitz, only it was just some graphics cards that didnt like this?<br>(If i could find where it was written I'd insert the link) <br><br></td></tr></table><br>
<a name="263173"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FlameDuck</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> And I don't know why you mention goraud shading. <br></div>It was in response to "How does hardware lighting work". I figured that since you where asking the question, you wanted to know.<br><div class="quote"> You don't have to do any goraud shading to do vertex lights. That's all done by the hardware. <br></div>Duh. Except the hardware can only do 8 lights, so if you want more you *will* have to do any Gouraud Shading. Manually. In software.<br><div class="quote"> And I know that hardware lights aren't free, but they're a hell of a lot more free than multiple render passes.  <br></div>Probably not. Although I haven't done any tests to confirm it, I see no reason why multiple lights should be "more free" than multiple renders.<br><br>What I'm really curious about tho', is since you know all of this already, why are you asking about it? <br><br></td></tr></table><br>
<a name="263235"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> "Duh. Except the hardware can only do 8 lights, so if you want more you *will* have to do any Gouraud Shading. Manually. In software."<br><br><br>Uh, Flameduck, you do not have to do goraud shading to do more lights than the 8 supproted in hardware.<br><br>All you need to do is calculate the amount of light that hits each vertex and set the vertex colors on the mesh.  The hardware does the interpolation.<br><br><br>"Although I haven't done any tests to confirm it, I see no reason why multiple lights should be "more free" than multiple renders."<br><br>Because Flameduck, hardware lights are done on the chip, and only need to do a calculation per vertex.  Multiple render passes on the other hand require you to draw the scene completely two or more times.  That requires a LOT of memory accesses and memory accesses are slow.<br><br>If you're getting 60fps with one pass, and you do two, your framerate will drop to 30fps.  But if you add 8 hardware lights, you're unlikely to lose more than 5-10fps.<br><br><br>"What I'm really curious about tho', is since you know all of this already, why are you asking about it?"<br><br>Obviously you did not read my first post in this thread.<br><br>What I was asking was if I have 8 hardware lights, if each entity is lit by the 8 closest ones, or wehther only the first 8 lights you create cast any light at all.<br><br>I have since done a test of my own since nobody knew, and unfortunately it looks like only the first 8 you create cast any light.<br><br>If it had been the other way then you could stick lights all over the place and you would not have to worry about them cause as an entity moved about it would be lit by the 8 lights closest to it.  But as it does not work that way, the best you can do is to manually hide all the lights but the 8 which are closest to the camera.<br><br>All this other discussion has been about how to implement lights with a partially software solution. <br><br></td></tr></table><br>
<a name="263256"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shambler</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> I did a test for lights recently <a href="http://www.blitzbasic.com/bbs/posts.php?topic=25124" target="_blank">http://www.blitzbasic.com/bbs/posts.php?topic=25124</a><br><br>I've done another test today regarding speed hit for hardware lights and it went something like this.<br><br>I created 100 32 segment spheres and placed different numbers of lights in front of them and checked the millisecs for each frame with flip false.<br><br>No lights 7 ms<br>1 light   12ms<br>2 lights  18ms<br>3 lights  24ms<br>4 lights  30ms<br>5 lights  35ms<br>6 lights  40ms<br>7 lights  45ms<br>8 lights  50ms<br><br>quite a performance hit per light and meaning fps from 142fps for no lights to just 20fps with 8 lights on.<br><br>Something else I noticed which was quite worrying is that light range makes no difference to the fps =/<br><br>I set a light range of 1 for all 8 lights and moved them a huge distance away from the spheres so that no lighting could be seen on them and still got 50ms per frame.<br><br>This means my graphics card is not checking the light range to see which geometry it needs to calculate lighting on...something I wasn't expecting to see at all.<br><br>Maybe the card is so fast at calculating lighting that they didn't bother with an early out test to see if the lights are in range? <br><br></td></tr></table><br>
<a name="263290"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> In that test, with just one light your framerate is cut in half, and with three it's cut in a third.  Ouch.<br><br>You know though, this test assumes that all polygons in the world are affected by the lights.  And you've got 400,000 polygons there.<br><br>Could you do a test with all the objects set to fullbright?  I'd like to see if haivng objects set to fullbright means the lights cause no performance hit on them.<br><br><br>"I set a light range of 1 for all 8 lights"<br><br>A light range of 1 just means that the light STARTS falling off a that distance.  It actually carries out quite a long ways from there.  If the radius is 80, then the light will fall off completely 5200 units away from the light source.  That's where it reaches 0.99 and gets clipped to 0.<br><br>I don't know if 3D cards stop having them affect objects even at that great a distance though.<br><br><br><br>The question is though not wehther hardware lights are slow, but whether dynamic lightmaps are slower.  <br><br>You could do up to 9 passes to render 8 dynamic lights, with no other lightmaps.  10 passes if you have other lightmaps.<br><br>However, multitexturing would probably be possible and cut that down quite a bit.  However you need to remember that to do just one dynamic lighting pass you actually need to use two texture units, one for X and Y axis mapping, and one for Z, to create a 3D sphere texture.<br><br>So, because most cards only have 4 texture units, you could only really cut that 9 passes in half.  So you'd still need to do about 5 passes to render 8 lights plus your textures and maybe your lightmaps.<br><br><br>142fps / 5 = 30fps  So that is faster than the 8 hardware lights IF you can do that lighting in just 5 passes.  <br><br>But I'm not convinced that you CAN combine two dynamic lighting passes into one.<br><br>To do a dynamic lighting pass you need a 2d texture in texture channel 0 set to multiply, and a 1d texture in texture channel 1 set to multiply.  Texture channel 1 darkens the result after texture channel 0 has been applied, and this creates the 3d texture.  You then use ADD blending to add this dynamic light pass on top of the static lightmap pass.<br><br>But can you do this twice in one pass?  I'm not sure you can with the way texture unit operations work.  <br><br>But I could be wrong.  It's complicated.<br><br><br>Anyhow, it's not cut and dry which is faster in this situation.  However, with far fewer polygons in the scene, I think the scales might tip in favor of the hardware lights. <br><br></td></tr></table><br>
<a name="263392"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jeremy Alessi</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>My tank game has a LOT of bullets. One of my bullets is the burst shot where you fire one bullet, and it explodes into 8 more after a couple seconds. That right there would nearly exceed the number of hardware lights available. Now imagine there's 4 people firing bullets around which can each spawn three, five, or even eight bullets. <br> <br></div><br><br>Each player should have 1 light for all of their pojectiles and it could rotate around each one every frame or on a timer.  This would also give off a twinking effect which you'd probably want anyway.<br><br>Then use the other 4 lights for the powerups. <br><br></td></tr></table><br>
<a name="263394"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shambler</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> FullBright...<br>Fullbright does mean that the sphere is ignored by the hardware lights.<br><br>I get the same fps with no lights as I do with 8 lights and 100 fullbright spheres.<br><br><br>LightRange...<br>I set a light range of 1 and moved the lights somewhere really far away like PositionEntity hl(n),60000,60000,60000<br><br>LightRange should be the point at which the light has no effect and can be ignored.<br><br>At least that's what it does in C++/DirectX and the Blitz Docs state...<br><br><div class="quote"> <br>Description:<br><br>Sets the range of a light.<br>The range of a light is how far it reaches. Everything outside the range of the light will not be affected by it.<br><br>The value is very approximate, and should be experimented with for best results.<br> <br> <br></div><br><br>BackFace Culling...<br>EntityFX 16 ( Disable backface culling ) has no effect on performance, which tells me the lighting calculation is being done before backface removal, lighting faces that the camera can't see? O.o<br><br>Poly Count...<br>The number of poly in the scene does make a big difference.<br><br>With 8 lights on<br><br>3968 Tri  = 1000 fps<br>7936 Tri  = 1000 fps<br>15872 Tri = 500 fps<br><br>There appears to be a cutoff point, above which hardware lights give a very slight performance hit, this will of course be different on other hardware. <br><br></td></tr></table><br>
<a name="263405"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mustang</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> LightRange should be the point at which the light has no effect and can be ignored. <br></div><br><br>that would be logical but it just isn't so... there was talk about in these forums (even Mark commented) but I can't find that post... I think that Sswift also posted the actual formula that is used (he got it from Mark) which clearly shows that LightRange command is NOT like the description would make you believe. ALL lights will affect your meshes, no matter how far they are. <br><br>Would be nice to have flags to lights/entities so that you could say that this light affects only this entity, but I don't know if it's possible. <br><br></td></tr></table><br>
<a name="263408"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shambler</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> From what you say it looks like Blitz is setting the directx light parameter 'Range' to its maximum and that lightrange in blitz is actually setting the directx 'Attenuation' parameters.<br><br>This means that lighting has to be calculated for all entities(meshes) regardless on whether they are affected by the light or not.<br><br>Although this makes it easier to set up a light it does give us a performance hit when we want a localised hardware light and gives us less control over a lights parameters.<br><br>nm, maybe in BMax? ^^ <br><br></td></tr></table><br>
<a name="263413"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> AH- I knew it- <br><br><div class="quote"> <br>There is a DirectX limit on the number of lights available per scene - this is either 8 or 16 depending on your video card, but you should always assume 8. <br> <br></div><br>So more than 8 lights IS possible (just not good for compatibility) <br><br></td></tr></table><br>
<a name="263460"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> "At least that's what it does in C++/DirectX and the Blitz Docs state..."<br><br>The Blitz docs are wrong, and Blitz's lights work just like DirectX.  I know this for a fact because I researched it thouroughly when developing my shadow system after I noticed that my shadows were not matching up with the falloffs of the hardware lights which were illuminating the world.<br><br>Here are the comments in my shadow system on the whole thing about how the lights work.  And this is based on information straight from Mark, and the Direct 3D docs, and asking other 3D programers on Flipcode.<br><br>; DX7 Lighting equation:<br>; Attenuation = 1.0 / (C0 + C1*D + C2*D*D)<br>;<br>; In Blitz:<br>; C0,C2 = 0.  C1=1<br>;<br>; So the revised lighting equation is:<br>; A = 1.0 / D<br>;<br>; With this equation, when D=1, A=1.<br>;<br>; Now in Blitz, a light has a radius, which defines where the light BEGINS to fall off. <br>; At this radius, A will equal 1.<br>; Inside this radius, A is greater than 1, reaching infinity when D = 0.<br>; Outside this radius the light falls off exponentially.<br>;<br>; So we change the equation to read like so:<br>; A = R / D<br>;<br>; And then all we need to do once we calculate A is multiply the light's color by it, and we get the<br>; color of our vertex at a distance of D.<br>;<br>; It is interesting to note that multiplying the light's color by a factor equal to the radius will<br>; give us the same results.  That means that rather than thinking about radius as a mininium radius at<br>; which the light is fullbright, you can think about the radius as a brightness mutliplier instead.<br>;<br>; However, it is more useful to consider it as the radius inside of which the light is fullbright.<br><br><br>"The value is very approximate, and should be experimented with for best results."<br><br><br>Yeah I'll say it's very approximate.  It's off by like 5000 units! :-)<br><br><br><br>"There appears to be a cutoff point, above which hardware lights give a very slight performance hit"<br><br>That drop there was just caused by the fact that 1000fps means each frame takes 1ms, and 500fps means each frame takes 2ms.  Not a cuttoff point.  Just the fact that your millisecond timer isn't precise enough to see the difference between the first two.  The second is probably like 750fps but you cna't have 1.5ms. <br><br></td></tr></table><br>
<a name="263471"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> Shambler:<br><br>Call this FPS code once per renderworld, and you will see that the FPS is over 1000, and that there is a difference between 1 and 2 lights.<br><br>This is much more accurate FPS code than your basic FPS code, because it counts the actual number of frames that happened in a second rather than trying to compute how much time an inidvidual frame took and extrapolating that to the entire second.<br><br><pre class=code>
Global FPS_Timer
Global FPS_FrameCount
Global FPS_FPS

Function FPS()
	
	FPS_FrameCount = FPS_FrameCount + 1
	
	If MilliSecs() &gt;= FPS_Timer
		
		FPS_FPS        = FPS_FrameCount
		FPS_FrameCount = 0  
		FPS_Timer      = MilliSecs() + 1000
		
	EndIf

	Return FPS_FPS
	
End Function
</pre> <br><br></td></tr></table><br>
<a name="263505"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> The lights are useless because they don't use an inverse square falloff.  Use vertex lighting for dynamic lights. <br><br></td></tr></table><br>
<a name="263632"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shambler</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> I see , using your FPS code there is no cutoff point as such, just a linear falloff of performance as more poly are added to the scene.<br><br>Incidentaly I got 2000fps with 1 light and 1 sphere.<br><br>As far as range goes though this is what I remember from my C++ days.<br><br>The range parameter in a D3DLight structure had nothing to do with the attenuation formula.<br><br>I remember distinctly that setting the range parameter to a low value you could abruptly stop the light affecting vertices.<br><br>I remember it because it didn't look too good ^^ having a bright area around the light suddenly plunge into blackness even gouraud shading couldn't make that look nice.<br><br>What I believe blitz lights do is set the range parameter to maximum ( square root of 'FLT_MAX' ) so each light is pretty much infinite.<br><br>This means that even when the attenuation has got the light intensity down to 0, DirectX is still having to calculate vertex lighting.<br><br>The reason why blitz's light range is approximate, its trying to simplify things for the programmer so they don't have to get their head around the attenuation parameters.<br><br>Instead they just give it a range value and blitz calculates the attenuation parameters to try and get somewhere near.<br><br><br><br>@Malice the only card I could find that supported more than 8 lights could handle 32...cost £1500 though =) <br><br></td></tr></table><br>
<a name="263637"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> "Instead they just give it a range value and blitz calculates the attenuation parameters to try and get somewhere near."<br><br>Nope.  That's wrong.  What I said is fact. :-)<br><br>There's three parameters which control the DX light behavior.  Blitz has a certain setting for those.  If you change those, you can change the falloff to be linear instead of expoential.  That might be why you got a different result.  Or, it could be because early versions of Direct3D used a different lighting equation. <br><br></td></tr></table><br>
<a name="263649"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shambler</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think we agree but don't realise it =)<br><br>Where you quoted me, 'they' are Blitz programmers, I wasn't talking about what Blitz does behind the scenes.<br><br>Like I said, Blitz programmers just give it a range value e.g. <br><br><pre class=code>
LightRange mylight,500
</pre><br><br>When you tell Blitz 'I want a light range of 500' Blitz doesn't set the range parameter of the DirectX light to 500 though.<br><br>It sets the attenuation parameters you spoke of to 'guesstimate' the correct attenuation so that the light intensity falls off 'roughly' around 500 units.<br><br>As you rightly say it is quite a way off.<br><br>The thing I am getting at is that because Blitz sets the range parameter of the light to its maximum this is telling DirectX to compute lighting even when the intensity of the light is extremely low.<br><br>Let me pull from the DirectX docs the meaning of the range parameter...<br><br><div class="quote"> <br>If d is greater than the light's range, that is, the Range member of a D3DLIGHT9 structure, Microsoft® Direct3D® makes no further attenuation calculations and applies no effects from the light to the vertex.<br> <br></div><br><br>This range parameter did the same thing in DX7.<br><br>So to come to the point...what was it again? lol<br><br>Oh yes, Because blitz sets the range parameter to a very high value DirectX never stops having to calculate vertex lighting.<br><br>No matter how far an entity is away from the light, the way Blitz sets up the lighting, DirectX never stops having to light the entities verts and so causing a performance hit. <br><br></td></tr></table><br>
<a name="263655"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#32">[#32]</a></td></tr></table></td></tr><tr ><td class="posttext"> "It sets the attenuation parameters you spoke of to 'guesstimate' the correct attenuation so that the light intensity falls off 'roughly' around 500 units."<br><br><br>No, I didn't misunderstand you.  You're WRONG. :-)<br><br>Blitz does not 'guesstimate' anything.<br><br>If you set the range to 500, that is the distance that the light BEGINS to fall off.  It's like an "inner radius".  <br><br>There is no way to set the "outer" radius.  Technically the light falls off forever.  The only thing that creates an effective "outer" radius to any light in Blitz is the fact that once the value of the light drops below 1, the closest integer RGB is 0,0,0.<br><br><br>"The thing I am getting at is that because Blitz sets the range parameter of the light to its maximum this is telling DirectX to compute lighting even when the intensity of the light is extremely low."<br><br><br>I concede that there may be a range parameter which Blits sets to infinity, or close to it.  <br><br>However, that doesn't change the fact that you're still confused about the range parameters on the lights. :-) <br><br></td></tr></table><br>
<a name="263682"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#33">[#33]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here's a possible alternative approach.  Instead of using multiple render passes, how about a light-culling mechanism where each object in the scene is rendered by itself with only the lights that are within range.  CameraClsMode should be false, false, then set to true, true at the end of each frame.<br><br>As a quick test (without lights), I wanted to see what the frame rate hit was for rendering objects individually.  I set up fifty spheres and a key that would toggle between rendering all at once or one at a time.  The fps changed from 686 to 350 or so.  'Might be worth it to do it that way in some circumstances so I thought I'd pass that info along... <br><br></td></tr></table><br>
<a name="263822"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#34">[#34]</a></td></tr></table></td></tr><tr ><td class="posttext"> 686fps = 1.45 ms per frame<br>350fps = 2.85 ms per frame<br><br>A difference of about 1.4 milliseconds.<br><br>Would you post the code to your demo so we can add stuff to it and try it ourselves? <br><br></td></tr></table><br>
<a name="264551"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#35">[#35]</a></td></tr></table></td></tr><tr ><td class="posttext"> The test has nothing to do with lights and I literally spent about 15 minutes on it so I hadn't thought it worth posting, but just in case, here it is.<br><br>It would be interesting, I suppose, to find out the differences on various graphics cards.<br><br><br><pre class=code>
; Test the frame rate difference between rendering
; 50 spheres at once or one at a time.

; The "1" key toggles between them.

Global msecs, test = False
Global fpsIndex, fpsTime, fpsOldMSecs, fpsCount

Type ent
	Field obj
End Type

Graphics3D ( 1024, 768, 32 )

cam = CreateCamera ()
PositionEntity ( cam, 10, 40, -100 )

For i = 1 To 50
	ents.ent = New ent
	ents\obj = CreateSphere ()
	PositionEntity ( ents\obj, Rand ( -100, 100 ), Rand ( 0, 100 ), 0 )
Next

While Not KeyHit ( 1 )

	msecs = MilliSecs ()
	If KeyHit ( 2 ) Then
		If test Then
			test = False
			CameraClsMode ( cam, True, True )
			For e.ent = Each ent
				ShowEntity ( e\obj )
			Next
		Else
			test = True
			CameraClsMode ( cam, False, False )
			For e.ent = Each ent
				HideEntity ( e\obj )
			Next
		End If
	End If

	If test Then
		For e.ent = Each ent
			ShowEntity ( e\obj )
			RenderWorld ()
			HideEntity ( e\obj )
		Next
	Else
		RenderWorld ()
	End If
	Color ( 0, 0, 0 )
	Rect ( 0, 0, 50, 25, True )
	Color ( 255, 255, 255 )
	Text ( 0, 0, fps() )
	Flip ( False )

Wend
EndGraphics
End


Function fps ()
	fpsIndex = fpsIndex + 1
	fpsTime = fpsTime + mSecs - fpsOldMSecs
	If fpsTime =&gt; 1000
		fpsCount = fpsIndex
		fpsTime = 0
		fpsIndex = 0
	End If
	fpsOldMSecs = mSecs
	Return fpsCount
End Function

</pre> <br><br></td></tr></table><br>
<a name="264604"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AbbaRue</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#36">[#36]</a></td></tr></table></td></tr><tr ><td class="posttext"> LT<br>I get 871 when I first start it. <br>Then  445 when I hit the 1 key.<br>You didn't say which is which.<br>And here is what I own: <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
