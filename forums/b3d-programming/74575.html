<!DOCTYPE html><html lang="en" ><head ><title >Aligning a shadow to a mesh</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Aligning a shadow to a mesh</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Aligning a shadow to a mesh</a><br><br>
<a name="833256"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Vorderman</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I need to align a shadow sprite below a car mesh onto a track mesh.<br><br>Currently I'm using the code below.<br><br>"temppivot" is just a temporary b3d pivot.<br>"mesh" is the car<br>"shadow" is a b3d sprite for the shadow<br><br>I'm performing a vertical linepick straight down from the car onto the track. If it hits the track, the following code is performed.<br><br>The problem is that the track mesh is not flat, it has cambers and hills in all directions, and I *must* point the shadow sprite in the same direction as the car (it's a proper car shaped shadow, not a round blob) so I'm rotating it around the Y axis with the line - RotateEntity shadow,0,EntityYaw#(mesh,True),0<br><br>It ALMOST works but on hills as the car turns to run across the hill (so the hill is sloping upwards from left to right relative to the car) the shadow does not follow its yaw correctly, always being rotated off by a few degrees.<br><br>When the car points straight up or down the hill it works OK.<br><br>Can anyone help me with this? There must be a simple solution.<br><br><pre class=code>
		PositionEntity temppivot,PickedX#(),PickedY#(),PickedZ#(),True
		dist# = EntityDistance#(temppivot,mesh)
		alpha# = 1.0 - ((1.0 / 10.0) * dist#)
		If (alpha# &gt; 1.0) alpha# = 1.0
		If (alpha# &lt; 0.0) alpha# = 0.0
		PositionEntity shadow,PickedX#(),PickedY#(),PickedZ#(),True
		RotateEntity shadow,0,EntityYaw#(mesh,True),0
		AlignToVector shadow,-PickedNX#(),-PickedNY#(),-PickedNZ#(),1,1
		AlignToVector shadow,-PickedNX#(),-PickedNY#(),-PickedNZ#(),3,1
		EntityAlpha shadow,alpha#
		ScaleSprite shadow,((alpha#) * 3.5),((alpha#) * 3.5)
		MoveEntity shadow,0,0,-0.05;-0.025

</pre> <br><br></td></tr></table><br>
<a name="833267"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Once you've rotated the shadow to the same as the mesh just use a single align to vector on the y axis but not on -ve normals.<br><br><pre class=code>
AlignToVector shadow, PickedNX#(), PickedNY#(),PickedNZ#(),2,1
</pre><br><br>By using both x and z axis' you're effectively re-doing the rotateentity. <br><br></td></tr></table><br>
<a name="833370"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Vorderman</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Stevie, I'll give that a try tonight! <br><br></td></tr></table><br>
<a name="833525"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Vorderman</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> OK, that seems to work, cheers.<br><br>It was returning some odd results when the car was upside down, but I just found that I had set the car body to be pickable, no idea why...<br><br>Turned that off and it's fine now. <br><br></td></tr></table><br>
<a name="833676"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is this you back on the stunt car game?  About time!! <br><br></td></tr></table><br>
<a name="833692"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Vorderman</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yep, I've got the programming bug again!<br><br>Currently have an 8-car AI race working, and the AI is competent enough that I can't beat them, despite them driving using the same controls and physics the player has.<br>Watching one opposite-lock his way around the track is oddly hypnotic.<br><br>There's something very satisfying about teaching your AI to perform a task, then watching as they do it better than you can.<br><br>Just need to finish the front end, which is what put me off ages ago...I hate front ends :( <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
