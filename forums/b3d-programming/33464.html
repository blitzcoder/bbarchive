<!DOCTYPE html><html lang="en" ><head ><title >UserLibs using VB.NET</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >UserLibs using VB.NET</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >UserLibs using VB.NET</a><br><br>
<a name="360843"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PetBom</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Has anybody used VB.NET to create userlibs for usage from Blitz3D. I have problem passing parameters to and from the userlib. <br><br>I've manipulated the IL code based on the great article in the code archives by Defiance (Thanks btw, great stuff):<br><br><a href="/codearcs.php?code=716" target="_blank"> Using The Microsoft .NET Framework with Blitz</a><br><br>But I can't get passing of parameters to work. So what I looking for is someone that has is experienced in using VB.NET together with Blitz3D on a more advanced level. I can manage to get an "Hello World" app running, but as soon as I try getting a bit more advanced (multiple function parametrs, returning cocatunated strings etc.) I run into problem. My guess is that it has to do with VB.NET's rather loose definition of data types. But I really need some pointers where to go next, for more information.<br><br>Note that I do not have problems like this with C#. Everything works beautifully. But I really want to get my VB.NET code working as well, since I have quite a lot of rather nifty graphic routrines developed in that specific language (mainly GUI controls in GDI++)<br><br>Anyone?<br><br>//PetBom <br><br></td></tr></table><br>
<a name="361148"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sweenie</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I was fiddling with this as well.<br>But all I managed to accomplish was an "application shutdown function"... that is, as soon as I called a function in the .NET DLL, blitz shut down without any errormessage or anything.<br>VB6 did the same thing.<br><br>And all the function did was adding two integers together and returned the result. <br><br></td></tr></table><br>
<a name="361155"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PetBom</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well I really don't have a problem passing things from the VB.NET DLL to blitz. My problems start when I need to pass parameters from blitz to a method in the DLL. Calling methods and returning data to blitz is not a problem. It's when I need to pass parameters _to_ the method the problems start. I'm pretty certain that it's a data type problem. I just can't figure out what. Looking at the IL code I cannot se any obvious faults. There is one thing that worries me though. It seems that the order of the methods in the class gets reversed in the IL code if you use VB.NET as aposed to C#. This shouldn't matter (check the Defiance article above) if you set up the v-Tables correctly. But maybe something else is reversed as well, say paramaters to a function. I can't see it happening, but then I'm not an expert on IL-code.<br><br>How did you edit the IL code? I found this yesterday which is kind of helpful when 'un-managing' the .NET DLL (by hacking the IL-code):<br><br><a href="http://ilide.europe.webmatrixhosting.net/" target="_blank">ILIDE</a><br><br>It's a simple editor for IL code. It does syntax highlighting and has built in support for de-compiling and compiling (DLL -&gt; IL and IL -&gt; DLL)<br><br>Your issues with VB6 probably is another problem, since VB6 is all unmanaged code<br><br>I'm going to dig a bit deeper and try to report my findings.<br><br>Or maybe there is someone out there that actually has managed to pass parametrs to VB.NET userlibs?<br><br>//PetBom <br><br></td></tr></table><br>
<a name="361186"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Deldy</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I dont know if it will help, but I saw somewhere that and Integer in a un-managed is the same as a VB-Short.<br><br>So try to replace your paremteres into Shorts. (Will maybe help) <br><br></td></tr></table><br>
<a name="361234"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sweenie</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> no, what I meant with VB6 is that when I call the .net dll from VB6 it shuts down aswell, just like blitz do.<br><br>It seems I have a similar problem as what I try do to is to pass two integers to the .net DLL. <br><br></td></tr></table><br>
<a name="361258"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Robert</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Neither VB6 nor VB.NET can make normal DLLs.  They are ActiveX controls which are a totally different and rather more complex beast. <br><br></td></tr></table><br>
<a name="361261"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sweenie</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Perhaps not VB6, but with the method above(see link in the first post) you can make the .NET DLL expose it's functions as if it were unmanaged code.<br>I haven't got it working yet, but Defiance who wrote the article has got it working. <br><br></td></tr></table><br>
<a name="361325"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PetBom</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Neither VB6 nor VB.NET can make normal DLLs. They are ActiveX controls which are a totally different and rather more complex beast. <br></div><br><br>Not entirely true Robert. As for VB6 the dll's created actually are COM compontents (which AcitveX controls are a subset of) that interacts with other applications using a COM intreface/COM interop.<br><br>And as for .NET, Microsoft has actually dropped the term ActiveX, since the introtuction of the .NET framework. Whatever language you use everything will be parsed to IL and CRL, so it makes more sense to speak about managed an unmanaged code. So you could say that VB.NET cant create unmanaged code (but as we've seen, it can!) but that doesn't really make the resulting DLL an ActiveX control.<br><br>Sweenie - Ok i thought you were calling a VB6 dll from blitz. BTW have you done any tests with C#? As I said I've done some and everything has worked fine. Have you tried doing a call from VB6 to an unmanaged (By IL manipulating) C#.NET dll? If you can do that I guess that it's safe to say that some other components of the IL need tweaking in the case of VB.NET code.<br><br>I could send you my VB.NET dll if you'd like. As I have mentioned it does not work all the way. But at least it does not shut down blitz. The only thing that does not work is the input parameters. It returns data to blitz quite happily. It would be interesting to see if you can run it.<br><br>//PetBom <br><br></td></tr></table><br>
<a name="361680"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sweenie</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sure, check my profile for the emailadress. <br><br></td></tr></table><br>
<a name="361689"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sweenie</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Do you know what calling convention a .NET DLL use? <br><br></td></tr></table><br>
<a name="361703"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sweenie</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> hmm, I successfully managed to pass a string and return it.<br>look at this piece of IL-code...<br><pre class=code>
    .method public instance string  SayHi(string Name) cil managed
    {
      // Code size       16 (0x10)
      .maxstack  2
      .locals init (string V_0)
	.vtentry 1:1
	.export [1] as SayHi
      IL_0000:  ldstr      "Hej "
      IL_0005:  ldarg.1
      IL_0006:  call       string [mscorlib]System.String::Concat(string,
                                                                  string)
      IL_000b:  stloc.0
      IL_000c:  br.s       IL_000e

      IL_000e:  ldloc.0
      IL_000f:  ret
    } // end of method Foo::SayHi

  } // end of class Foo

</pre><br><br>I changed the row that says...<br> IL_0005:  ldarg.1<br>to<br> IL_0005:  ldarg.0<br><br>The question is why the VB.NET DLL(or the IL-assembler) tries to get the stringparameter from position 1<br><br>[Swedish]<br>Vad dumt det känns att prata engelska med någon som man vet är svensk. :)<br>[/Swedish] <br><br></td></tr></table><br>
<a name="361747"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PetBom</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm...You're right. It seems that my VB IL does tha same thing. I tries to pass parameter 1 (Which does not exist). Really weird! There must be something in the IL code that we are missing. I've got a colleague that is something of a IL/CRL wizard. I must discuss this with him and see if he can give some pointers. <br><br>But I realize that if you actually have to debug the IL code it's not worth the effort, messing with VB. It would be faster to convert the code to C#...<br><br>[Swedish]<br>Hehe! Själv är jag ganska van att snacka engelska med svenskar. Fler och fler företag har engelska som corp. language och all kommunikation och dokumentation skall vara på engeska (Jag jobbar i konsult branschen). Men jag kan hålla med om att det är lite fånigt. Jag visste inte att du var svensk. Kul!<br>[/Swedish]<br><br>//PetBom <br><br></td></tr></table><br>
<a name="361964"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kanati</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> [quote]Neither VB6 nor VB.NET can make normal DLLs. They are ActiveX controls which are a totally different and rather more complex beast.<br> <br></div><br><br><br>Not entirely true Robert. As for VB6 the dll's created actually are COM compontents (which AcitveX controls are a subset of) that interacts with other applications using a COM intreface/COM interop. <br>[/quote]<br><br>VB6:  Can create standard windows DLLs.  You have to use a 3rd party tool to do it.  My BlitzData and BlitzPrinter dlls are both created with VB6.<br><br>VB.NET:  You can force standard windows DLLs, but it takes some doing. <br><br></td></tr></table><br>
<a name="478704"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LostCargo</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> has anyone made any headway?<br>i have spent some time tooling up in vb.net and suddenly realized the dealing with D3d sux. way to much granularity for what i want to do.<br><br>Is there any instance where someone has succeeded in passing a variable to a dll function and getting a response? <br><br></td></tr></table><br>
<a name="604281"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LostCargo</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> has anyone made headway? <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
