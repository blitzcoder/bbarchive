<!DOCTYPE html><html lang="en" ><head ><title >Client/Server and updating npc's</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Client/Server and updating npc's</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Client/Server and updating npc's</a><br><br>
<a name="1182130"></a>

<a name="1182131"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ferret</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> The server is written in BMax and the client in B3D.<br>The client uses physics to move the player and npc's.<br><br>I can move the npc's from the server but don't know how to keep track of there position.<br>Physics are aplyed on the client, there is no physics simulation on the server so the server has no idea where the npc will end up.<br><br>One idea i have is asking random clients for npc updates.<br><br>Any other ideas on how to do this? <br><br></td></tr></table><br>
<a name="1182155"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> You could try looking at this:<br><br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=2789" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=2789</a><br><br>Its been ages since I wrote it, but it was a progression from code Wings did a few moons ago. The Server basically maintains x &amp; y co-ords of where every 'client' is and pumps out where each client &amp; other clients are with every communication from a client.<br><br>Quite a tough topic though, I gave up on networking stuff ages ago. <br><br></td></tr></table><br>
<a name="1182441"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> What i would do is use a structure like this :<br><br>Client program :<br>Repeat<br> GetInput()<br> Logic1()<br> Send()<br> Receive()<br> Logic4()<br> HideShowMeshes()<br> PlayAnimations()<br> Render3d()<br> Render2d()<br>  HUD()<br>  GUI()<br> Flip()<br> PlaySounds()<br>Until()<br><br>Server program :<br>Repeat<br> Receive()<br> Logic2()<br> Collisions()<br> Physics()<br> Logic3()<br> Send()<br>Until()<br><br>In Logic1() the client program only calculates the state of the user and his orientation depending on the new input, his previous state, his previous orientation.<br><br>By state i mean for example : <br>IsIdle<br>IsWalkingForward<br>IsWalkingBackward <br>IsJumping <br>IsFalling <br>IsLanding <br>etc...<br><br>Each state illustrating a movement + an animation.<br><br>Then, the client program sends the state and the orientation to the server program.<br><br>Depending on the state and the orientation of each user, the server program is able to calculate the movement, the collisions detection and response, the bodies behaviors of all entities.<br><br>Then the server program sends the results (state, orientation, position) to each client program and the game will be the same on all machines.<br><br>Also if there is a packet sent by a client program which is not received by the server program, this is not really important because the server program being able to calculate the movement and behavior of each character with his state, if a packet is not received, the server program can use the last known state and orientation to continue to update the game.<br><br>So, i suggest to calculate the state, orientation, movement, colliders collisions, bodies physics, on the server program but only for entities which can affect others entities (characters, projectiles, weapons, doors, traps, etc...) and to calculate the state, orientation, movement on the client program for entities which can't affect others entities (particles, effects, etc...)<br><br>That's how i plan to do it for one of my project. <br><br></td></tr></table><br>
<a name="1182443"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> What sort of game is it? If it is an action game that would be done much differently than if it is a slower paced game.... <br><br></td></tr></table><br>
<a name="1182856"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ferret</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> The game is a online rpg/fps.<br><br>Getting npc position updates from random clients seems to work. <br><br></td></tr></table><br>
<a name="1182862"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MCP</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Why random? Some clients may be asked for frequent updates, others rarely. Wouldn't it be better to ask each client for an update in rotation? <br><br></td></tr></table><br>
<a name="1182866"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ferret</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Good point!<br><br>Rotation would be better, it will even the load nicly bewteen clients.<br>I think it will be more accurate too.<br><br>Thx! <br><br></td></tr></table><br>
<a name="1182924"></a>

<a name="1182925"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SabataRH</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is an odd way of doing online physics..  your server should handle the initialization of a physic object them dispurse the data to clients in range. <br><br></td></tr></table><br>
<a name="1182941"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ferret</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> The server sends a move message to a npc with the angle and force.<br>The clients use newton physics to aply the force.<br>Then the server asks a client for an update.<br><br>How else can the server keep track? <br><br></td></tr></table><br>
<a name="1182945"></a>

<a name="1182946"></a>

<a name="1182948"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> The server must manage the calculation of movements, rotations, collisions, physics, then send the results (position + orientation of each entity) to the client programs. (except for unimportant entities which have no impact on the world, like particles, effects, and in this cases you can send a simple message and manage the movement, rotations of the particles/effects on the client program)<br><br>If you don't do it this way, or in a similar way, the game will not be the same on all machines.<br><br>I thought my previous post was clear about that.<br><br>Now of course you do what you want, but there are not hundreds ways to have the same world on all client programs... The way i use is to send the input of the client programs to the server program and let the server program do the calculations, the client programs then display the results. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
