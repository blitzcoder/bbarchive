<!DOCTYPE html><html lang="en" ><head ><title >Do UV maps affect how cube maps are drawn?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Do UV maps affect how cube maps are drawn?</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Do UV maps affect how cube maps are drawn?</a><br><br>
<a name="1114216"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gburgess</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm getting really confused here, and I can't figure out the solution. I'm rendering a single cube map texture so I can reflect the environment onto a model.<br><br>I'm then taking this texture, and applying it as the last texture layer on all objects in my game (there aren't many)<br><br>The texture is correctly showing up on the objects, but is badly stretched and distorted over the skin of the model, like it's trying to adhere to a UV map.<br><br>Most (not all) of these objects have UV maps, but even the ones without don't seem to be displaying the texture quite right.<br><br>Am I taking the right approach here? Can I used one single cube map for all my objects like this? <br><br></td></tr></table><br>
<a name="1114231"></a>

<a name="1114232"></a>

<a name="1114233"></a>

<a name="1114234"></a>

<a name="1114235"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Cube-maps don't use UV information in any instance. They use 3D vectors to sample a "surrounding cube" around the mesh (the cube-map).<br>This 3D vector can be the normal of each triangle in your mesh (the diffuse mode of SetCubeMode), it can also be a reflection vector (a vector going from the camera to a vertex, reflected against the triangle this vertex belongs to; this would be the specular SetCubeMode).<br><br>So the UV information you have shouldn't pose any difference. What you can do, though, is try changing the <a href="/b3ddocs/command.php?name=SetCubeMode&amp;ref=3d_cat" target="_blank">SetCubeMode</a> value to see if there's any different mode that suits you; you can also try repairing your meshes' normals with your modelling software, using UpdateNormals() or even using <a href="/codearcs.php?code=975" target="_blank">an equivalent in the code archives</a>.<br><br>In case the above doesn't work, please post a screenshot.<br>Cya.<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1114244"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gburgess</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks, that cube map explanation was brilliant.<br><br>I tried all the stuff you said, but unfortunately none of it helped. UpdateNormals() and the code archive snippet actually caused their own oddities: polygons that seemed to be anchored partially to 0,0 on the screen, connected to each model. I assume there's some invalid part of the meshes that UpdateNormals is stumbling on a bit, maybe some two-point polys. Still, I knew that what you said must be right - either my models' normals weren't right, or I was screwing up the cube map itself.<br><br>I eventually found that the problem seemed to lie in smoothed normals. If they were smoothed over quite sharp angles, the texture would distort into a banded portion of itself, stretched hard over the polygons. Using Ultimate Unwrap's autosmoothing option, I was able to alleviate this quite substantially. It's added another step to the pipeline, but hey, it works. <br><br>Thanks for setting me on the right track! <br><br></td></tr></table><br>
<a name="1114245"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gburgess</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Actually, I think I spoke too soon:<br><br>The banding effect is still happening no matter what I do to the models.<br><br>Here's an example. The underside of this model suffers quite badly, where as the top side has relatively little banding.<br><br><img src="http://img835.imageshack.us/img835/4275/unled2ul.png"><br><img src="http://img805.imageshack.us/img805/2334/unled3yp.png"><br><br>The cube map is intended to be a very low resolution (cheap blurring!) reflection of the background. The top image shows the texture being stretched into bands around certain vertices. The bottom image only shows this on a single polygon at the upper-right edge of the spacecraft as we look at it.<br><br>What do you think, are my normals just screwed, or is this an artifact of Blitz3D's/DirectX7's cubemapping? <br><br></td></tr></table><br>
<a name="1114263"></a>

<a name="1114264"></a>

<a name="1114266"></a>

<a name="1114267"></a>

<a name="1114268"></a>

<a name="1114269"></a>

<a name="1114270"></a>

<a name="1114272"></a>

<a name="1114273"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> If your model doesn't have any anormalities when looked at with a smooth shading then you can be sure your normals are correct.<br><br>Is your cubemap texture arranged properly? remember it must fit all 6 sides horizontally, and these sides are <a href="/b3ddocs/command.php?name=SetCubeFace&amp;ref=3d_cat" target="_blank">specifically ordered</a>. <br>All of the 6 sides must have the <i>same size</i>, be <i>square</i> and <i>power-of-two</i>. <br>The width of the final texture holding them all will never be power-of-two, but that's correct.<br><br>You can also make a cube-map texture for debugging purposes with something like a checkered pattern just so you see if it's working correctly.<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1114297"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gburgess</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Cube map's good. I made it cycle through each face with SetCubeFace, CopyRect'd it into an image, and saved. I get six different, correct images, all 16x16 (which is the right size). <br><br></td></tr></table><br>
<a name="1114358"></a>

<a name="1114360"></a>

<a name="1114375"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, you can always use that checkered cubemap texture to see if it's behaving the right way.<br><br>As a last resort, remember you have the <a href="/b3ddocs/command.php?name=CreateTexture&amp;ref=3d_cat" target="_blank">Spherical Environment texture</a> (flag 64 when creating or loading one). <br>You can render what's behind the camera and CopyRect it onto that environment texture so it keeps varying as the camera moves, and acts like a simple reflection.<br>Satisfaction guaranteed :)<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1114395"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BIG BUG</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm pretty sure this is due to faulty normals. <br>Just try to split all polygons from each other, so every polygon has its own vertices(normals are stored per vertex) and then use sswift's or <a href="/codearcs.php?code=2176" target="_blank">mine(Click!)</a> function to recalculate normals with hard edges.<br>Only if it still doesn't work, you could rule out wrong normals as cause. <br><br></td></tr></table><br>
<a name="1114447"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gburgess</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Kryzon - an interesting idea, although it would need an additional render each frame. Still, if it works, it works.<br><br>BIG BUG - I've pretty much done that by unwelding the model in Ultimate Unwrap, and then re-exporting. I've also used it's autosmoothing feature which seems to do the same as your nice function. So unless UU is outputting bad UVs itself... <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
