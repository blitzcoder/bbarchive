<!DOCTYPE html><html lang="en" ><head ><title >shared vertex problems</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >shared vertex problems</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >shared vertex problems</a><br><br>
<a name="409474"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello. Im trying to create a REAL CreateMirror function in blitz.. in theory it works, but practically, it failed bigtime. Until i learn more, i cant do it....<br><br>What it was going to do:<br>All entire triangles below Min_y are removed<br>all triangles with at least one vertice above Min_y are cropped to min_y, Then, when this is complete, create a copy of the mesh below min_y which is flipped in the Y direction.. a plane is then placed at min_y and is returned from the function.<br>the mirrored mesh is child to the plane<br><br>Problem now is:<br><br>some triangles share vertices... which means it ends up distorting rather than working proberly.. Shame<br><br>Does anyone have any ideas for a fix for this? i believe this function would bean excelent function and will make mirroring feasible in blitz games :)<br><br><br>Cheers all <br><br></td></tr></table><br>
<a name="409490"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rob</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think the best kind of mirror is texture based. Even Doom3 uses this kind of mirror.<br><br>Polygon mirrors are too much trouble. <br><br></td></tr></table><br>
<a name="409502"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, I think when you only remove some tris, you still have those Tris that are intersecting the mirror surface, and this may look wrong.<br> What I would suggest to do, if you realy want to remake the CreateMirror command this way, is the following:<br><br>Create a clone of the mesh with all tris that are above the mirror. There shouldn't be a problem with shared vertices if you use the Trianglevertex Function together with the CountTriangles Command etc.<br><br>You would  create the meshes from scratch, by adding the Surfaces and Triangles one by one, ignoring those you don't want to be part of the clone mesh.<br><br>Then you create an additional mesh that contains all Tris that ARE INTERSECTING the mirror, means one or two Vertices of each Triangle are below and the other one or two are above the mirror. <br><br>Then you take the Fast CSG Functions in the code archive (guess by Markus Rauch) and cut off the part of the INTERSECTION mesh that is below the mirror. The reason why you create a seperate Mesh for the intersecting parts is: Speed.<br><br>THen you flip both, intersection mesh and above-part mesh. There is still one tiny but hard problem: After cutting the intersection mesh, you need to set the UV Coords for the new Tris created by the CSG operation. Now this seems to be the most tricky part. Some 3D Gurus may be able to do it easily, but personally I couldn't do it.<br><br>Maybe you should think about to make a CreateMirrorRect(x,y,z,w,h,d,p,y,r) command instead, that will allow to use cubic enviroment mapping with any beloved rectangular quad mesh of  whatever size and orientation.<br><br>At least all Mirrors in the Level would require only one Cubic-6-Render pass alltogether - and you could also use it for other things (chrome FX etc.) too. <br><br></td></tr></table><br>
<a name="409530"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Bloodlocust: I have made two versions of the function, the first being texture based but it isnt very clear.. i tried only texturing a smaller area of the mirror (where the camera is) but i cant get the maths right.<br><br>JFK:<br>I will look into cubic mapping, i never thought of it<br>Also, something else you said might fix my problem.. by making the intersected triangles a seperate mesh, i should be able to split the vertices... this would sort the issue out, i think! <br><br></td></tr></table><br>
<a name="409681"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> for the cubemapping you may download fredborgs "bathroom" demo from <a href="http://www.frecle.net/giles," target="_blank">http://www.frecle.net/giles,</a> it includes a working example of a mirroring towel (well, water in that case, but anyway). <br><br></td></tr></table><br>
<a name="410252"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> cool, i shall go and take a look :D <br><br></td></tr></table><br>
<a name="410472"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Another problem with doing a mesh mirror is the lighting - it'll be wrong for the 'reflection' mesh. e.g.<br><br><pre class=code>

     /\         &lt;-- lighting shining straight down

    (  )        &lt;-- sphere

-------------   &lt;-- mirror plane

    (  )        &lt;-- reflected sphere mesh

</pre>Here, the top of the sphere will be illuminated while the bottom half will be in shadow. This will also be the case for the reflected sphere mesh but it should be the other way around, as it's supposed to represent a reflection.<br><br>Anyway, I've managed to come up with a way of cutting a mesh in half (or, whatever) on a given plane. An effect I mentioned to Cygnus in another thread and wondered how it was done. The effect also manages to maintain correct UVs and vert normals for the clipped tris. My brain is throbbing somewhat, now. :)<br><br>So, it is possible - and pretty fast, too. ;)<br><br>Here's a pic of it in action. You'll just have to trust me that this is being done in blitz and not with a modeller. :)<br><br><img src="http://mysite.wanadoo-members.co.uk/big10p/clipped_sphere.jpg"> <br><br></td></tr></table><br>
<a name="410510"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I hate you tell you this, but while clipping tris will work, it is unlikely to be near fast enough to use in any real situations.  Throw one high poly character at it, and your framerate is kaputski.  <br><br>If you pre-clipped the level itself to the mirror, then you MIGHT be able to handle clipping if you only clipped those characters which intersected the mirror, and those characters had less than say... 64K polygons total.<br><br>But consider this.  You can't really clip an animated character to the mirror.  You have no way of knowing where the bones have moved the vertices in a particular frame, and the only way in Blitz to apply bones to a new mesh is to create a file and then reload the mesh, which is going to cause stuttering and again, kill the framerate.<br><br>If all you wanted to do was mirror some spheres or cubes or something in water, and allow them to intersect with it, then you might be able to do that at realtime framerates.  You might even get away with doing some simple car models intersecting with a reflective mud puddle.  But humanoid animated characters with bones aren't likely to be possible. <br><br></td></tr></table><br>
<a name="410521"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> big10p - looks nice. well, with the csg function from the archives this would be pretty easy :) Anyway, if you use lightmapping, the light problem would not arise.<br><br>But I agree with sswift. there is a problem with animated meshes an moving stuff, as well as with anything in motion such as particle emitters etc.<br><br>Maybe it's easier to use the CEM method. As I mentioned earlier, if you once have rendered the cubemap, you can use it for an unlimited number of meshes (eg. Mirrors and chrome parts in the WC etc.) <br><br></td></tr></table><br>
<a name="410713"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I hate you tell you this, but while clipping tris will work, it is unlikely to be near fast enough to use in any real situations. Throw one high poly character at it, and your framerate is kaputski. <br></div><br>True, for a mirror effect but I'm using this technique for something else - a per-entity effect to clip the mesh at a given plane. It's easily fast enough for what I want. :) <br><br>[edit]<br>Infact, one of the biggest speed bottlenecks I've found is making an exact copy of the mesh to be clipped. I can use CopyMesh for single surface meshes, and then repaint it with a brush extracted from the mesh being copied. However, CopyMesh seems to combine surfaces unless they are using different textures. I need to maintain the exact same structure in the copied mesh as exists in the original one. I can, of course, read vert info one at a time and then apply to it the new mesh but this seems to be slow(ish). Any ideas how I can do this more quickly?<br>[/edit]<br><br><div class="quote"> big10p - looks nice. well, with the csg function from the archives this would be pretty easy :) <br></div><br>Maybe, but, where's the fun in using someone elses code?! I've learnt quite a bit working this stuff out. :)<br><br><div class="quote"> But I agree with sswift. there is a problem with animated meshes an moving stuff, as well as with anything in motion such as particle emitters etc. <br></div><br>Well, the effect I have in mind isn't for animated meshes, really. However, I haven't found a problem with meshes in motion - that sphere in that screenie above is actually rotating as the clipping plane gradually moves up, erasing it. <br><br></td></tr></table><br>
<a name="411291"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ashmantle</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Someone mentioned Doom3... have you noticed how they don't mirror you at all? Its a whole other thing going on behind the mirror.. do this test:<br>Grab your flashlight and shine it at the wall while standing parallell to the mirror.. (so that you see the lighted wall both through the mirror and otherwise..) ^^<br><br><br><br><br><br><br><br><br><br><br><br>Spoiler ^^<br>The light in the mirror moves around alot and doesn't look at all like yours.. perhaps its a demon of hell who's playing a joke on me? *shudder* <br><br></td></tr></table><br>
<a name="412136"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> @ Sswift:<br><br>Im only doing the clipping once.. and with my games i tend to keep the polycount well low, because i can get more gameplay in (like supernova can now handle 80 ships at any time onscreen with no slowdown)<br><br>For character reflections, i just have a copy of the entity rotated around.<br><br>@Big10p: Nice effect! any chance we could see a demo of this in action? <br><br></td></tr></table><br>
<a name="412242"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> OK, I'll try and get a demo up this weekend, maybe Monday. :) <br><br></td></tr></table><br>
<a name="412934"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> very, very nice stuff. of course, the next pit stop for this kinda thing is a maplet clone! That would require a bit more maths though! <br><br></td></tr></table><br>
<a name="413207"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> OK, the demo's up - grab it here:<br><br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=1143" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=1143</a> <br><br></td></tr></table><br>
<a name="414434"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> woohoo! cheers :D and nice work! <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
