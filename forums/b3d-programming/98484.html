<!DOCTYPE html><html lang="en" ><head ><title >Set entity rotation from a dll</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Set entity rotation from a dll</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Set entity rotation from a dll</a><br><br>
<a name="1150731"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Lagrange</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>i'm trying to move and rotate entities from a dll ( in order to do physics there and apply it directly to the objects ).<br><br>The dll recieves the entities address. I already found the list of offsets for the different properties.<br>Setting Entity X, Y, Z works - but the rotations don't.<br>I know, that you have to set the value at address + 44 to 3 to apply the changes.<br><br>Changing the value for Pitch doesn't do anything, changing Yaw scales and rotates the entity somehow - not the way i want it to.<br><br>Are the offsets wrong or is there another trick to do rotations?<br>And what ist the 4x4 Matrix for, you can also access?<br><br>Thank you <br><br></td></tr></table><br>
<a name="1150732"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> The 4x4 matrix is a translation matrix. It controls rotation, position <i>and</i> scale. That sort of thing is described in detail here: <a href="http://www.blitzbasic.com/Community/posts.php?topic=42657" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=42657</a><br><br>There are no stored values for pitch, yaw or roll, so I don't know what you've been setting. You <i>have</i> to use the matrix.<br><br>Another, probably better, option would be to use a hack to get function pointers, and simply pass a Blitz function (e.g. a little "SetPositionAndRotation" wrapper) to the DLL, that it can call with the right values. <br><br></td></tr></table><br>
<a name="1150733"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Lagrange</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> ah, ok i'll think about using function pointers, as you said - thanks.<br><br>The values i was setting where:<br>Offset 48 ( float )    for Pitch<br>Offset 52 ( float )    for Yaw<br>Offset 56 ( float )    for Roll<br><br>because i found these in a list. Seems to be wrong information.<br>Im not exactly sure, but they were somehow connected with the entitys rotation.<br>Turning the object would make them change values ( between -1 and 1, but no sin/cos function, if i saw it right ) <br><br></td></tr></table><br>
<a name="1150734"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sounds like you found one of the places where the entity stores its rotation as a quaternion. Blitz translates between quaternions and Euler angles every time you use one of the rotation or angle functions.<br><br>There's quite a lot of redundancy in the entity's transformation data (cached values to make accessing it very fast and reduce the amount of recomputation). Setting certain fields "manually" runs a minor risk of breaking this system as certain things might not be updated properly, when the engine expects things to be changed only through the right access functions.<br><br>That's a second reason for suggesting the function pointer (as well as reducing the amount of hacking from several offsets to one pointer method): you'd still technically be using the "expected" methods of access for manipulating the entity, so it's highly unlikely you'd make many errors. <br><br></td></tr></table><br>
<a name="1150763"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tom</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> This stuff should have been exposed to the user many years ago. <br><br></td></tr></table><br>
<a name="1150765"></a>

<a name="1150766"></a>

<a name="1150767"></a>

<a name="1150768"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Lagrange</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've been reading for hours now, what i learned so far is:<br><br>The best example for function pointers was this: <a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=1639" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=1639</a><br><br>I havn't tried it out yet - don't know if i could make it run - it uses a bit of assembler code in the dll, which i don't understand.<br>The problem is, that you can't pass arguments ( euler angles ).<br>So the blitz function would have to "call back" dll functions to receive the arguments.<br>Would be ok.<br><br>The other thing with the matrices:<br>The 4x4 gives the transformation from global zero to objects actual orientation, position and scaling. I have seen the standard transformation matrices to do either rotation, translation or scaling.<br>And i guess, that combined operations like scaling and rotating - respectively transforming an already transformed object - would have to include inverse matrices too if its done only with mat. multiplication.<br><br>Directly changing the entries in the last row (4,1) (4,2) (4,3) sets x, y, z.<br>What i don't understand: the x value appears also in the last column, element (3,4).<br><br>But i can't imagine how to do a rotation, because rotating the "upper left" 3x3 matrix in the usual way is probably wrong, because the values in the last column have to change somehow to.<br><br>Also i didn't even find all the elements of the matrix, some i found twice, as you said, its complicated. But is there a list of the addresses? Maybe i'll try this "magic number scan" - but that will probably take a lot of time.<br><br>Anyway, its not that important if i can get the function pointers to work. I haven't used the maths about geometry before ( don't even know what quaternions are ) but it would interest me to try it out a bit more.<br><br>I read the link you posted, but i couldn't get that much out of it.<br>If you know a tutorial where the 4x4 matrix, quaternions and things concerning 3d math are dealt with, that would be great, i didn't find it yet.<br><br><br>Edit: Or is there a possibility to call function pointers with arguments? ( without using additional dll's ).<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1150769"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> To use function pointers, your best bet is MikhailV's FastPointer library: <a href="http://www.fastlibs.com/index.php" target="_blank">http://www.fastlibs.com/index.php</a><br><br>It's both reliable for taking the pointer, and able to accept arguments (although it doesn't do return values - you can always work around that with a global variable or something). In my experience it doesn't like taking the pointer for builtin functions, only user-defined ones (the library relies on extremely specific assembly instructions in the backend, so e.g. the varpointers example doesn't work with locals because that generates different code: similarly the function pointers example only works with the right kind of functions).<br><br>Anyway the important bit is <i>getting</i> the function pointer; writing a userlib wrapper function to <i>call</i> a function pointer with the right arguments and return value is utterly trivial (if you need one beyond what FastPointer offers, ask and I'll show you). <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
