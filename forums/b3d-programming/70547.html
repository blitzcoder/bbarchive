<!DOCTYPE html><html lang="en" ><head ><title >Shadow Mapping - I made it!</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Shadow Mapping - I made it!</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Shadow Mapping - I made it!</a><br><br>
<a name="788659"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> i've always been thinking, you must render and project a shadow texture. but this causes the glitch that behind the light source, no shadows are casted.<br>so i use a cubemap<br><br><br>download incl exe (controls are explained there):<br><a href="http://dev-ch.de/upload/files/Devils%20Child/ShadowMapping.zip" target="_blank">http://dev-ch.de/upload/files/Devils%20Child/ShadowMapping.zip</a> <br><br></td></tr></table><br>
<a name="788671"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Danny</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> well done!<br><br>If you add flag 256 (load in vram) to your shadow texture, the speed goes up from 170 fps to 240 fps on my machine.. <br><br></td></tr></table><br>
<a name="788675"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> ok, thanks for that. i've been thinking of that, too ;D<br>*added it.<br>i also added transparent shadows.<br>use the same download link again <br><br></td></tr></table><br>
<a name="788682"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Danny</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I know it's just a test/demo but in the for loop where you create the 100 cubes, you're also creating 100 textures ("EntityTexture c, LoadTexture("Media\SandStone.jpg")" - if in stead you load the texture once, and apply it in the loop... you gain another 15 to 20 fps :) <br><br></td></tr></table><br>
<a name="788685"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Danny</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> oh and if you remove all the Text commands (except the one to show the FPS) you get another 60 FPS !!!!! Blitz Text S#cks! :))) - sorry man, just playing with it! It's cool ;) <br><br></td></tr></table><br>
<a name="788690"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> blitz optimizes the textures. if the user loads a texture twice, blitz wont load it again. if it would, tha whole program would propably crash.<br>that without text it is faster - i know that, but what can i do;D<br><br>i better concentrate on the main problem: shadows are not always projected correctly. also they seem to work indoor, not outdoor... <br><br></td></tr></table><br>
<a name="788694"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Danny</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> yes I checked because loading the texture 100 times I would expect it to consume MORE memory - but it doesn't!!!<br>So yeah you'd say Blitz does optimize, but it's funny that it still scores an extra 20fps....<br>It's like having a cool car - but not being alowed to look under the bonnet ;) <br><br></td></tr></table><br>
<a name="788701"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> what i'm still hunting for is, that the shadows are projected wrong sometimes :P<br>when its finished, we'll be able to use shadow maps!<br>i may check out depth shadows as well. <br><br></td></tr></table><br>
<a name="788709"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> We've been able to use shadow maps for a while.  My shadow system uses shadow maps.  Doesn't use cubemaps though.  Cubemaps would be expensive.  I'm not sure why you're using those.<br><br>I guess your intent is to make a single shadow map for all objects a light is casting shadows from?  That might work in a simple square room, but wouldn't work well in an actual FPS level.  Shadows would end up being placed where they shouldn't be.  Also it would limit the resolution of your shadows. <br><br></td></tr></table><br>
<a name="788712"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> what your shadow system is slow about is the polygon clipping. also i dont understand it.<br>i got the idea. everyone is programming shadow maps the same way i do except they use a single texture instead of a cubemap.<br>i got the right attempt, but the shadows still get projected wrong and i dont know why.<br>sswift: i programmed YOUR swift shadow scene in my stencil shadow sys and i tried it here, too. but it didnt work. somehow, its for indoor only (not for outdor...) <br><br></td></tr></table><br>
<a name="788771"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >puki</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> I found it most exciting. <br><br></td></tr></table><br>
<a name="788845"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> oh thank you puki ;D<br>also it would be if i can solve the problem of the wrong shadow projection :) <br><br></td></tr></table><br>
<a name="788848"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >IPete2</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Devil,<br><br>As with all things it depends on how you use them and how much effort you put into them.  I have been using Swift's shadow system for years, and love it.  There have been occasions where I needed to find out more to do more or resolve problems.  By breaking up a level into smaller sections Swift's excellent system (which can cast from animated b3d meshes) works really well.  <br><br>I will have another quick look at your system (which I believe is very good too from what I hear), but without anmated b3d meshes included I can't make use of it.<br><br>Best regards,<br><br>Peter. <br><br></td></tr></table><br>
<a name="788849"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DareDevil</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> good work! ;)<br><br>bye <br><br></td></tr></table><br>
<a name="788857"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >mongia2</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> it is a goooodd!!<br><br>thanks <br><br></td></tr></table><br>
<a name="788860"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MadMunky</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Good work!<br><br>I'm gonna stress test this in my game (hundreds of meshes and hundreds of shadow receivers) :P <br><br></td></tr></table><br>
<a name="788882"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tom</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Devils Child: The bad projection is when the light is not at the same position as the mesh with the cubemap. For dynamic cubemaps to look correct, the camera used to render the cubemap should be at the same position as the mesh that will recieve the cubemap, obviously the light moves around in the demo which causes an offset.<br><br>It might be possible to fix with some kind of offset texture matrix applied using a DLL, SetTransform(texLayer, D3DTRANSFORMSTATE_TEXTURE0+texLayer, matrixType). <br><br></td></tr></table><br>
<a name="788885"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> i dont quite understand: the shadows are even more un-correct if i render from the center of the shadow receiver.<br>i think the solutiuon is very easy and i dont see it :(...<br><br>the shadow projection seems correct as long as the shadow light stays at the position of the shadow receiver.... <br><br></td></tr></table><br>
<a name="788968"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tom</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> the shadow projection seems correct as long as the shadow light stays at the position of the shadow receiver.... <br></div><br><br>Exactly! You are rendering from the light position right? So it will only look correct when the light is at the same position as the receiver. <br><br></td></tr></table><br>
<a name="788970"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Naughty Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> ..hmm..this sounds interesting...mmm <br><br></td></tr></table><br>
<a name="789053"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> whats the value for D3DTRANSFORMSTATE_TEXTURE0 ? <br><br></td></tr></table><br>
<a name="789055"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >puki</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sausages. <br><br></td></tr></table><br>
<a name="789068"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_33</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> Found these constants for you Devils Child:<br><a href="http://kevincg.wordpress.com/tag/directx/" target="_blank">http://kevincg.wordpress.com/tag/directx/</a><br><br>Could be for DX9 thoe...<br><br>Also found this very interesting D3D pascal source, which contains a lot of constants!<br><a href="http://www.koders.com/delphi/fidF30DE49A7FDD6BD2AB9557AEE9A071DBA3550D0D.aspx" target="_blank">http://www.koders.com/delphi/fidF30DE49A7FDD6BD2AB9557AEE9A071DBA3550D0D.aspx</a> <br><br></td></tr></table><br>
<a name="789106"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tom</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> D3DTRANSFORMSTATE_TEXTURE0 = 16<br>..1 = 17<br>..2 = 18 e.t.c <br><br></td></tr></table><br>
<a name="789108"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> thank you. when i have time, i will engage my self with this. <br><br></td></tr></table><br>
<a name="789216"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Naughty Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> ..when I load another mesh (plane) and place it under shadow receiving sphere in the sample, there is no shadows at all..just sometimes surface change color (default white, no texture) in to shadow color.. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
