<!DOCTYPE html><html lang="en" ><head ><title >Main Game Loop</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Main Game Loop</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Main Game Loop</a><br><br>
<a name="781235"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Buggy</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here's my main game loop:<br><br><pre class=code>
While Not KeyDown(1)

   currentTime = Millisecs()

   ;prevents timePassed being too small
   If currentTime &gt; lastTime + 10

      timePassed = currentTime - lastTime
      lastTime = currentTime
      
      Cls

      doEverything()
      drawEverything()

      Text 0, 0, timePassed

      Flip

   Endif

Wend
</pre><br><br>...or something like that.<br><br>Everything in my game is scaled against timePassed (it's a 2D game, so no tweening), so the movement should be pretty steady.<br><br>On average, the timePassed value flickers between 16 and 17 (milliseconds), but when there's a ton of stuff going on, rather than having timePassed go to 20~ish, it jumps straight to 32 - 34, which is exactly double the normal amount.  Then, when the game calms down again, it goes right back to 16 and 17.  The effect is very noticeable.<br><br>Is there something wrong with my code that's causing this?  The reason I have the "If currentTime &gt; lastTime + 10" is so that I can do things like "timePassed = timePassed / 4", which makes everything go slow-mo.  If I didn't make sure that the difference was greater than 10, then on a fast computer, "timePassed = timePassed / 4" could make timePassed round down to zero, effectively stopping the game.<br><br>If that made any sense whatsoever, please help me. <br><br></td></tr></table><br>
<a name="781247"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Problem here lies in the Flip function I would think.  It'll either wait for one vertical blank, or two vertical blanks, and so on.  It can't wait for one-and-a-bit vertical blanks.  Hence the jump in framerate.<br><br>Try changing it to Flip False so your code doesn't wait for a whole vertical blank before flipping. <br><br></td></tr></table><br>
<a name="781312"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Buggy</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah, I had<br><br>Vwait : Flip False<br><br>...but will my taking the Vwait out make it appear sloppy on some computers? <br><br></td></tr></table><br>
<a name="781352"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sledge</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> The display will probably tear, yes -- but then you either wait for the vertical blank or you don't, and each has its own downside.<br><br>By the way, "Vwait: Flip False" will reportedly look dodgy on some machines. "Flip True" is more reliable I believe (and in any case why use two commands when one will suffice). <br><br></td></tr></table><br>
<a name="781359"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> By the way, "Vwait: Flip False" will reportedly look dodgy on some machines. "Flip True" is more reliable I believe (and in any case why use two commands when one will suffice). <br></div>I think that's the other way around, TBH.<br><br>[edit]<br>from the manual for VWait:<br><div class="quote"> <br>Note that this command is different to the vertical blank waiting mechanism in Flip because Flip will cause the graphics card (as opposed to the CPU) to wait for the next vertical blank. The vertical blank can be disabled on some graphics cards, hence it is quite common to use "VWait : Flip False" to ensure consistent updates on all setups. <br> <br></div> <br><br></td></tr></table><br>
<a name="781415"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> It may be in the docs, but it's wrong, or misleading at least. VWait and Flip False will look dodgy on some machines, and Flip True is more reliable, insomuch as it produces a more reliable visual appearance. Yes it can't detect a vertical blank if there aren't any, but fake-syncing to a non-existant vertical blank isn't very good either. It won't catch you up if you're rendering below your desired frame rate ( quite the opposite ) and it won't ensure a smooth, high quality visual appearance ( because it won't be smooth and it can't stop tearing. )<br><br>The only potential use of VWait and Flip False would be if you can't be bothered to write a proper tweening/delta time system to manage game timing properly, but as I said, you end up paying a high price for that, so it would be better to use a proper timing system. Particularly since we're talking B3D which does all the hard work for you when it comes to tweening. Now if you had to write your own, I could maybe understand, but Mark's Mario demo and several code archive entries do it all for you. <br><br></td></tr></table><br>
<a name="781558"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Buggy</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> ...unless you're not using any 3D commands. <br><br></td></tr></table><br>
<a name="781585"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >cyberyoyo</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Normally using flip(true) or flip false shouldn't change anything since you'll catch up on this wait time the next time you catch millisecs.<br><br>IMO the problem is that you shouldn't check if elapsed time is &gt;10, there is no reason to do that. I think that's what's causing the jerkyness. <br>Just process the loop, regardless of how small the time has passed. <br><br>I'm using a very similar method (except the I don't check if time is above a certain value) and I have no problems. <br><br></td></tr></table><br>
<a name="781594"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Buggy</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> 1. I like to have that, so I can do cool things like slow-mo by using "timePassed = timePassed / 4."<br><br>2. How would this check make any problems?  It shouldn't double the normal timePassed, since as long as it's greater than 10, it works fine. <br><br></td></tr></table><br>
<a name="781606"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> ...unless you're not using any 3D commands.  <br></div><br>I thought it was obvious that the reference to tweening was more general, since you've already said you use delta-timing, and therefore you have no need to try to force syncing with a non-existant vertical blank. <br><br></td></tr></table><br>
<a name="781844"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Buggy</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh.  Ok then. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
