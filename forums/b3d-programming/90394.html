<!DOCTYPE html><html lang="en" ><head ><title >flashlight sfx</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >flashlight sfx</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >flashlight sfx</a><br><br>
<a name="1027348"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Amanda Dearheart</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> OK, I'm trying to design a flashlight effect for my game?<br>Y'know, if a person was to shine a flashlight on a surface, how would I go about it?<br><br>Would I use animated textures,  the light entity, or something else? <br><br></td></tr></table><br>
<a name="1027392"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> What does sfx mean in this context? Typically I read sfx as sound effects, but you seem to be asking about visual effects. I'm assuming you want visual effects for the purposes of my answer, in any case. Tell me if I'm off-track.<br><br>I normally use a projected texture for flashlight type effects. Blitz3D, out of the box, doesn't support "true" texture projection but you can make a pretty good job of it just the same. Fredborg's version is pretty effective and simple to understand, I think.<br><br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=1000" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=1000</a><br><br>You might want to use this technique in combination with a real light or by itself. I think Fredborg's example uses a light. <br><br></td></tr></table><br>
<a name="1027429"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hotshot2005</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> DO You mean flashlight GFX? <br><br></td></tr></table><br>
<a name="1027465"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shambler</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="http://en.wikipedia.org/wiki/SFX" target="_blank">http://en.wikipedia.org/wiki/SFX</a><br><br>I am sure fredborg posted this in the code archives...searching...here he is...<br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=1000" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=1000</a> <br><br></td></tr></table><br>
<a name="1027541"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >puki</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> We are talking S-FX as in special effects - also known as SPFX.<br><br>Get with the flow people.  I cannot continue to drag this community behind me.<br><br>Easiest way is using FastExtension.  "fredborg" has a somewhat ugly code archive entry - I don't like it, but others love it.<br><br>Some people go the double-render route, you just light the scene and mask out a spot (an image, not an actual hardware spotlight) and then render the scene with the normal lighting (ie not much) with your 'captured' spot overlayed - if that makes sense. <br><br></td></tr></table><br>
<a name="1027580"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Half Life 2 and Quake IV use a projected "flashlight" texture. They blend the texture using <b>Addition</b>, so it lights up the surface that get's lit.<br><br>You can use that method (with the cost of having to use the 2nd UV layer for it, not allowing you to have a lightmap!), or you could also try to use a cone with vertex alpha.<br><br>You can get a flashlight volumetric cone out of that:<br><img src="http://img228.imageshack.us/img228/9559/valphalight.png"><br><br>Note that cone is not Add-blended; giving it a whiter color and making it Add-blended might give better results - that screen was just a test I was doing with vertex alpha from 3DS to B3D. <br><br></td></tr></table><br>
<a name="1028503"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Certainly the posters above know way more about this kinda thing than I do, but I'm wondering, what specifically is the 'bit' you're after?<br><br>1) The cone of the flashllight<br>2) The "End" iof the flashlight beam, reflecting off a surface it hits?<br><br>3) Both the above, i.e. the whole flashlight deal<br><br>#1 I really wouldn't have the first clue about, but I think this is what Kryzon is getting at.<br>#2 Could be solved perhaps in a similar method to casting shadows, some kinda camerapick that picks out the surfaces the light would fall on. Where a circular sprite or texture modification is shown lighting things up<br><br>Overall, I find the whole subject so 'common' and almsot 'necessary', bt at the same timer extremely complicated relatively for what it is, just to get a torch beam! I'd be really interested to know how this is solved in the end! <br><br></td></tr></table><br>
<a name="1030120"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> A Flashlight (in a game) usually only makes sense in a dark, greedy enviroment or so. So you want the walls to be lit, also indirectional to some degree, to explore the darkness. I found it rather easy to combine the cone mentioned with a Light Entity that is fixed to the big end of the cone. There may also be a 2nd, smaller light right at the start of the cone, to prevent the active light from being to far away to light a wall when you're very close to it. It is however essential that all the walls and Meshes are fragmented in rather small pieces in order to allow the directX light to make detailed use of vertices. It other words: A cube cannot be lit well by a Directx Point light based Flashlight, a sphere at the other hand can. <br><br></td></tr></table><br>
<a name="1030164"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Amanda Dearheart</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah Puki, you know what I'm talking about!<br><br>Malice, you're half-right. My immediate concerns are for texture-based lighting, but for future reasons, I may want the whole flashlight effect.<br><br>jfk, you've come closest to what I'm trying to describe.<br><br>Games like Oblivion, Morrowind etc. when they are in a dark dungeon, use a torch to light up the scene when they're traveling in the darkness! <br><br></td></tr></table><br>
<a name="1030167"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Would this be for first person perspective, third person perspective behind Character, Topdown, or anything else?<br>edit, anyway, here's a sample with a rather smart third person camera btw.<br><br>It shows clearly the vertex problem with lowpoly models.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">

Graphics3D 800,600,32,2
SetBuffer BackBuffer()

AmbientLight 15,15,15

Global bounce_cam=1 ;  smooth camera motion? (0/1)
Global bounce_div#=10.0 ; the higher, the more sluggish the camera will follow. Recc: 3.0 to 20.0

; collision types
Global type_world=2
Global type_camera=3
Global type_player=4

; some globals used by ChaseCam
Global old_x#
Global old_y#
Global old_z#

; desired distance between camera and player mesh
Global x_dis#=5.0
Global y_dis#=2.5
Global z_dis#=5.0
Global y_dis_or#=y_dis#

; a dummy world enviroment ...
Global plane=CreateCube()
ScaleEntity plane,1000,0.1,1000

EntityColor plane,128,128,64
EntityPickMode plane,2
EntityType plane,type_world

; some test walls. ;
; PLEASE NOTE: extreme low poly objects like big cubes don't work well with
; directX point lights: the light simply doesn't get enough vertices to obtain a good "grip" on the
; normals. To illustrate this you may use the CreateCube command instead (see a few lines below).
Global n_c=10
Dim cube(n_c)
For i=0 To n_c
 cube(i)=CreateSphere()
 PositionEntity cube(i),Rnd(-20,20),0,Rnd(-20,20)
 ScaleEntity cube(i),1,10,Rand(4,10)
 RotateEntity cube(i),0,Rand(360),0
 EntityColor cube(i),Rand(255),Rand(255),Rand(255)
 EntityPickMode cube(i),2
 UpdateNormals cube(i)
 EntityType cube(i),type_world
Next



; a player character mesh dummy
; (Note: probably replace this by a pivot that is located at the characters head)
player=CreateCube()
FitMesh player,-.5,0,-.5,1,-2,1
TranslateEntity player,0,2,0
EntityType player, type_player
;EntityPickMode player,2  ; if picking on the player mesh is required, it needs to be deactivated temporarily in the UpdateChaseCam function!
EntityRadius player,1.0,2.0  ; radius needs to big enough to allow a camera between player and walls etc!


camera=CreateCamera()
CameraRange camera,0.05,300
EntityType camera,type_camera
EntityRadius camera,0.1


;light=CreateLight()
;RotateEntity light,45,45,0

sp#=0.1 ; nav speed
gravity#=0.1

Collisions type_player,type_world,2,2
Collisions type_camera,type_world,2,2

flashlite = CreateFlashLite(player)
TranslateEntity player,0,2,0
; ----------------------------------------- MAIN LOOP ------------------------------------------
While KeyDown(1)=0
 ; player controls...
 If KeyDown(200) Then:MoveEntity player,0,0,sp#:EndIf
 If KeyDown(208) Then:MoveEntity player,0,0,-sp#:EndIf
 If KeyDown(203) Then:MoveEntity player,-sp#,0,0:EndIf
 If KeyDown(205) Then:MoveEntity player,sp#,0,0:EndIf
 mxs#=MouseXSpeed()/4.0
 mys#=(MouseYSpeed()/100.0)
 y_dis=y_dis+mys
 If y_dis&lt;-y_dis_or Then y_dis=-y_dis_or
 If y_dis&gt;y_dis_or*2 Then y_dis=y_dis_or*2

 MoveMouse GraphicsWidth()/2,GraphicsHeight()/2
 TurnEntity player,0,-mxs,0
 ;------
 
 UpdateChaseCam(camera,player)
 TranslateEntity player,0,-gravity#,0

 UpdateWorld()
 RenderWorld()
 ; Text 0,0, "cursor keys to navigate, mouse to turn/look"
 Text 0, 0,EntityX(camera)+" , "+EntityY(camera)+" , "+EntityZ(camera)
 Text 0,20,"Tris rendered: "+TrisRendered()
 VWait
 Flip 0
Wend

End




Function UpdateChaseCam(camera,player)
 PositionEntity camera,EntityX(player,1),EntityY(player,1),EntityZ(player,1)
 ResetEntity camera

 x#=EntityX(player)+Sin(-EntityYaw(player)+180)*x_dis#
 y#=EntityY(player)+y_dis#
 z#=EntityZ(player)+Cos(-EntityYaw(player)+180)*z_dis#
 obstacle=LinePick(EntityX(player),EntityY(player),EntityZ(player),   (x-EntityX(player)),  y_dis#,    (z-EntityZ(player))  ,0.1)

 If obstacle=0
  new_x#=x
  new_y#=y
  new_z#=z
 Else
  new_x#=PickedX()
  new_y#=PickedY()
  new_z#=PickedZ()
 EndIf

 If bounce_cam=0
  PositionEntity camera,new_x,new_y,new_z
 Else
  x=old_x+((New_x-old_x)/bounce_div#)
  y=old_y+((New_y-old_y)/bounce_div#)
  z=old_z+((New_z-old_z)/bounce_div#)
  PositionEntity camera,x,y,z
 EndIf

 PointEntity camera,player
 ;TurnEntity camera,-10,0,0     ; if you want the player mesh more on the bottom of the screen
 
 old_x#=EntityX(camera)
 old_y#=EntityY(camera)
 old_z#=EntityZ(camera)
End Function


Function CreateFlashLite(parent=0)
 Local n#,tex,piv,i,sz#
 tex=CreateFlashLiteTex()
 piv=CreatePivot()
 n=40
 m#=0.5
 m2#=0.2
 For i=0 To n
  iflo#=Float(i)
  s=CreateSprite(piv)
  EntityBlend s,3
  EntityTexture s,tex
  TranslateEntity s,0,0,m
  m=m*1.08
  EntityAlpha s, 0.05;13
  sz#=3.0
  ScaleSprite s,m2,m2
  m2=m2*1.07 ;085
 Next
 If parent&lt;&gt;0 Then
  TranslateEntity piv,0,3,0
  EntityParent piv,parent
 EndIf

 li=CreateLight(3,piv)
 LightConeAngles li,0,60 
 LightRange li,6.0
 LightColor li,255,255,255
 PositionEntity li,EntityX(parent),EntityY(parent),EntityZ(parent),1


 li2=CreateLight(3,piv)
 PositionEntity li2,EntityX(parent),EntityY(parent),EntityZ(parent),1
 LightConeAngles li2,0,180 
 LightRange li2,2.0
 MoveEntity li2,0,1,0
 LightColor li2,512,512,512



 Return piv
End Function

Function CreateFlashLiteTex()
 Local tex,gr,i,j,blue
 tex=CreateTexture(128,128,(2 Or 48))
 SetBuffer BackBuffer()
 For i=64 To 0 Step -1
  gr=(65-i)*8
  If gr&gt;255 Then gr=255
  If gr&lt;0 Then gr=0
  Color gr,gr,gr
  Oval 64-i,64-i,Abs(i+i),Abs(i+i),1
  Oval 63-i,64-i,Abs(i+i),Abs(i+i),1
  Oval 64-i,63-i,Abs(i+i),Abs(i+i),1
  Oval 63-i,63-i,Abs(i+i),Abs(i+i),1
 Next
 LockBuffer(BackBuffer())
 For j=0 To TextureHeight(tex)-1
  For i=0 To TextureWidth(tex)-1
   blue=(ReadPixelFast(i,j) And $ff)/3.0
   WritePixelFast i,j,(blue Shl 24) Or $ffffff
  Next
 Next
 UnlockBuffer(BackBuffer())
 SetBuffer BackBuffer()
 CopyRect 0,0,128,128,0,0,BackBuffer(),TextureBuffer(tex)
 Return tex
End Function
</textarea> <br><br></td></tr></table><br>
<a name="1030172"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >puki</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeh, this is why some people will just opt to double render and get a pure spotlight - which means you can get away with surfaces of a couple of triangles and nobody would know, until you shunted any other form of lighting at them. <br><br></td></tr></table><br>
<a name="1030727"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is also a common thing I've noticed with Blitz Terrains, as the tri's of the mesh show up with all their jagged ugliness if the contrast of the light is too high...<br><br>I'm really glad for this thread, as I mentined previously, things like flashlights (and again, I'll draw the analogy code/graphics-wise to accurate shadows) are so common in games, but are a difficult aspect to get right even with the latest hardware and DX9million or whatever they use nowadays. Until computers are powerful enough to have totally accurate and photorealistic raytracing and such in realtime :) Though I guess, een when that becomes a possibility, game devs'd begin fussing about why their photons aren't accurately portraying wave/particle duality XD <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
