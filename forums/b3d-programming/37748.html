<!DOCTYPE html><html lang="en" ><head ><title >Best Dynamic Lighting method for levels?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Best Dynamic Lighting method for levels?</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Best Dynamic Lighting method for levels?</a><br><br>
<a name="416104"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AntonyWells</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've got player/prop lighting sorted, thanks to cube maps. But the level is lightmapped, so no good for vertex lighting.<br><br>I could map a light texture to the level, but that means multiple passes(1 for each light)..So, is there a better way to do it all in one pass(or two/three, as long as it doesn't mean more passes for each each additional light).<br><br>I've heard of dynamic sphere mapping..can't find any tutorials on it though. <br><br></td></tr></table><br>
<a name="416108"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> "But the level is lightmapped, so no good for vertex lighting."<br><br>Not true.  It is possible to render a level so that vertex lighting brightens lightmaps.  This comes at the cost of one additional surface for every surface in your level supporting up to 8 vertex lights. <br><br>However the only other method I can think of which you might use, dynamic lightmaps, would come at an even greater cost, of one additional surface per surface, per light.<br><br>Here's how to set up the lightmaps so vertex light affects them:<br><br>Imagine you have a mesh with a simple quad.  This represents a wall.<br><br>First, you add a surface to the mesh which contains the quad.  This is textured with the texture normally.  Lighting is disabled for this surface.<br><br>Second, you add another surface to the mesh.  This surface should contain new polygons at the same location as those in the first.  This surface IS affected by lighting, and is textured with the lightmap, but the lightmap is set to ADD blend. <br><br>Now here's what happens:<br><br>Blitz renders surface 1... all polygons within it, with the texture, to the screen, fullbright.<br><br>Blitz then render surface 2 and all it's polygons on top of the first set of polygons.  Now assuming you have no dynamic lights, the underlying mesh color will go from white to black, because it is not being lit.  HOWEVER, the lightmap layer is set to add blend, so when this is blended with the object color, black, because we have no lights, this becomes white where there is light, or other colors where the lightmap is other colors.<br><br>On the other hand, if you add a light to the scene, or have ambient light, this light will make the lightmap surface base color lighter in those locations.  The lightmap then adds with that.  And everywhere where the object is no longer black because of a lack of light, the blackness of the lightmap in those locations will not show, as black + some base color = base color.<br><br>A few last things...  <br><br>The ligthmap surface (not the texture layer) can be set to multiply x2 so that the lightmaps brighten the textures as well as darken them.  This looks better than just darkening them. <br><br>With this method, fog may not work properly.  I beleive the lightmaps will lighten some areas of the fog.  I'm pretty sure fog will not affect add blended textures.<br><br>One more thing...<br><br>For vertex lighting to look okay you'll have to subdivide the walls a bit.  But cards today can push so many polygons that's probably not a problem. <br><br></td></tr></table><br>
<a name="416142"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >morduun</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nice and thorough explanation swifty -- all very straightforward and logical.  Thanks for sharing. <br><br></td></tr></table><br>
<a name="416150"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think "decal" lights, where a texture is rendered on the wall in a second pass, are best for weapon flashes, etc.<br><br>If you terrain is high-res enough, use hardware lights, otherwise use decal lights.  They look about the same on a high-res terrain, but decal offers a little more control.<br><br>Your characters and moving things should each be rendered in a separate pass, where you set up lighting based on what lights are visible to the player.  Use a visibility line check, and you will get a good approximation of the correct lighting when standing in the shadows or in direct light. <br><br></td></tr></table><br>
<a name="416392"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AntonyWells</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah thanks swwift/halo. Think I'm going to try dynamiclightmaps first..can't stand the idea of additional passes per light.<br><br>Halo, the only problem I see with the decal method is on curve geo. Do you wrap the decal around it, or just align a quad to the surface normal? <br><br></td></tr></table><br>
<a name="416397"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I only use these on brush geometry. <br><br></td></tr></table><br>
<a name="416398"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> "Think I'm going to try dynamiclightmaps first..can't stand the idea of additional passes per light."<br><br>Dynamic lightmaps are what require additional passes per light, not dynamic vertex lights.  One additional pass is required for X number of vertex lights, X being the number of dynamic lights your card supports.  You can't exceed X, but X is probably 4 or 8 which is better than 4 or 8 passes with dynamic lightmaps either way. <br><br></td></tr></table><br>
<a name="416400"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Warren</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  I only use these on brush geometry.  <br></div><br>Brush geometry can still have bevelled edges and such.  Are you wrapping to the shape of the geometry or just aligning a quad? <br><br></td></tr></table><br>
<a name="416402"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AntonyWells</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>Dynamic lightmaps are what require additional passes per light, not dynamic vertex lights. One additional pass is required for X number of vertex lights, X being the number of dynamic lights your card supports. You can't exceed X, but X is probably 4 or 8 which is better than 4 or 8 passes with dynamic lightmaps either way. <br></div><br><br>Yeah, I mean in additional passes in terms of gpu hits.<br><br>The method I'm using, goes through all recievers and sets up a list of tris, and does all the prep work, so come run time I just have to render 16x16 (or less if I want, variable) pixels per poly. Since the texture is flat, I can probably trform it into a already rendered spherical light and can then reduce it to one copyrect per poly, per light, hardly any maths.. Should mean per-pixel lights/fast enough for high speed set ups.(Not up and running yet..will post a demo if it goes well anyway)<br><br>Halo, I meant level wise. The lights I'm using only need to light level geo, which is curved/flat..never use brushes myself. <br><br></td></tr></table><br>
<a name="416465"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Unless Halo is not wrapping his "decal" to the surface of the level... Which would produce really stupid looking results, (a big fuzzy circle pressed up against the wall that sticks out when it is a near a corner) then the method he suggests is likely too slow to use.<br><br>If you're talking about rendering Quake-like dynamic lights, by using a spherical lightmap, comprised of one 2d map and one 1d map mapped on perpendicular axes to produce a "spherical" region of light, then that is stimply not going to be fast enough fro realtime except on the simplest of levels.<br><br>I can say this with fair certainty, because in essence, doing this is very much like rendering shadows in my shadow system.  For maximum speed, what you would end up doing is having to clip all the polygons in your level, or at least, all those in sections that are currently visible, using sutherland-hodgeman clipping.  You would clip them to a cube which defines the region of the spherical light, with the cube's borders being the maximum extent of the light.  The result of this clipping is a list of clipped polygons that you then need to build into a new mesh with proper lightmap coordinates.<br><br>But clipping polygons is not free, nor is building new meshes.  And because this is so similar to how my shadow system works... except for the fact that you will be "shadowing" roughly six times as many polygons per light, as each light effectively casts in all directions whereas a shadow casts in only one, this is how I can predict the speed of such a system as being slower than my shadow system by a significant degree.  <br><br>Plus, because lights will cover such large areas in all likelyhood, they will create more overdraw than my shadow system as well. <br><br></td></tr></table><br>
<a name="416472"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's easy.  Your system sucks. <br><br></td></tr></table><br>
<a name="416478"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AntonyWells</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> His shadow system works fines. In the current built of cryo there's two static lights casting 4 shadows of 1,000poly+ animated characters+weapon, plus a moving light, in total 6 shadows, plus every gun shot casts shadows from the muzzle, + all the game's other stuff/lighting, and still runs ok on a p-800. <br>I don't think you could do shadows much faster in blitz alone. though I'm going to port as much as I can to C++, use coldet for collisions..should speed it up even more.<br><br>Anyway, swwift, when you say it's too slow are you on about what I suggested or halo? The way I does only updates polys within the light's radius, and they don't cast shadows. (only characters cast real time shadows, done seperately)<br>And does it all in one pass(accumlative r+g+b) on the original mesh, no copies generated. <br><br></td></tr></table><br>
<a name="416483"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Halo:<br>Your wit is razor sharp as always!<br><br>Dude:<br>If I am not mistaken, my last benchmarks showed that the major bottleneck is not the actual clipping of the polygons, but rather, the creation of the shadow mesh itself.  And by that I mean, the act of adding polygons to a mesh, not of determining the locations of said polygons.  Perhaps I will do another check now and be sure of this. <br><br></td></tr></table><br>
<a name="416497"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >puki</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oooh, this thread is good enough to eat.  Shame none or it is any good for my text adventure game - unless, I use a 3D, stone effect, alphabet. <br><br></td></tr></table><br>
<a name="416531"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rob</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> sswifts system is too slow for general levels. I suspect something similar would be ideal if used on bsp style levels with proper culling.<br><br>The 2 surface idea is good but it's the same as overlaying another mesh isn't it? So thats like 2 pass rendering. <br><br></td></tr></table><br>
<a name="416638"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Anyone who uses the word "wit" is looking for a good ass-kicking.  What are you, British?<br><br>BL, I use multipass and 2 surfaces interchangably, since they are really the same thing.  Using 2 surfaces in one pass does give a little better results when z-fighting is an issue.<br><br>You have the right idea with BSP.  Just use a point-plane distance function to see if the light affects the plane, then offset and scale the light texture to fit the setting (faster than changing UV coords) and render a copy of the plane.  It's really fast, and works fine for big maps.  You probably only have a light calculation every other second, and maybe a couple of moving dynamic lights. <br><br></td></tr></table><br>
<a name="416701"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AntonyWells</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> I can't help but laugh at Americans who think they're being clever demeaning British people. Without us, there would be no you. I repeat, YOU WOULD NOT EXIST.<br>At the very least you'd all be speaking french! Is that what you want!? You'd all be canadadian bacon hey.<br><br>Anyway seriously, Halo, a few issues pop up in my head trying to visulize your technique, again curved surfaces.<br><br>In case I'm doing an half arsed job of explaining it,<br>Imagine any non flat surface in game...(Like say a lamp shade, or a football. Any back ground non moving geo)<br><br>There's no way a plane can wrap around those sort of surfaces, as far as I can see. (Automatically that is, obviously nothing's impossible if you're manually wrapping the plane.. but then it wouldn't be a plane except for it's initial projection.<br><br>I'm not knocking it, just trying to understand how you're avoiding these problems, or if you just live with them? <br><br></td></tr></table><br>
<a name="416744"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> You only use these for walls and floors, stuff made out of brushes.<br><br>There is no good way to dynamically light your merged static meshes.  I am assuming all your lamps, etc. will be merged into a single mesh, or groups of meshes.  You might be able to render a copy of the mesh in a second pass, with a light mapped into it. <br><br></td></tr></table><br>
<a name="416760"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> "Anyone who uses the word "wit" is looking for a good ass-kicking. What are you, British?"<br><br><br>Anyone who thinks the word "wit" is used solely by the British must have an incredibly small vocabulary.  What are you, from California? <br><br></td></tr></table><br>
<a name="416764"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AntonyWells</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>There is no good way to dynamically light your merged static meshes. I am assuming all your lamps, etc. will be merged into a single mesh, or groups of meshes. You might be able to render a copy of the mesh in a second pass, with a light mapped into it. <br></div><br><br>Actually nah, as actors/props(Be it soldier or say computers) are seperate for lod, and cos they use a custom cubic lighting engine the game has, per pixel lights,<br>which believe it or not is done with 1 texture in one pass, no matter how many lights there are. Character lighting will be the same again ;) <br>if only levels were so damned easy.. Will give your method a go anyway, the real-time lightmap idea is too slow currently.. <br><br></td></tr></table><br>
<a name="416777"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> Dude, I am smarter than you, and cooler. <br><br></td></tr></table><br>
<a name="416820"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Warren</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  Dude, I am smarter than you, and cooler.  <br></div><br>That's like a nickel bragging to a penny. <br><br></td></tr></table><br>
<a name="416822"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AntonyWells</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Dude, I am smarter than you, and cooler. <br></div><br>I would disagree, but you've managed to sell thoushands of copies of programs that don't work...so you must have something going on up there.<br><br>as for the cool remark, i'll reserve judgement until your next political rant. They're ice baby. <br><br></td></tr></table><br>
<a name="416849"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> Actually, I mean that towards "swift" not "dude". <br><br></td></tr></table><br>
<a name="416853"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AntonyWells</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Actually, I mean that towards "swift" not "dude". <br></div><br><br>Oh...well in that case sorry.  I oughta change my name, too many californians around here.;p <br><br></td></tr></table><br>
<a name="442589"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kalisme</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> erm... Ok... back to dynamic lighting... Can anyone<br>link some Kewl example code or NEthing to help me or<br>NEone else?<br>That would be nice... <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
