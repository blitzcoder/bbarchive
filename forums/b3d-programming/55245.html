<!DOCTYPE html><html lang="en" ><head ><title >character affected by lightmap</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >character affected by lightmap</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >character affected by lightmap</a><br><br>
<a name="615043"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jhocking</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm pretty sure I have some sample code for this, but I can't find it.  How do you make a character affected by the level's lightmap?  So that the character darkens when you walk into a shadow. <br><br></td></tr></table><br>
<a name="615050"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tyler</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I remember seeing a code somewhere that linepicked straight down, and got the color info of the collided model's texture. I'm gonna need this soon too, so if you find it, share the wealth :D <br><br></td></tr></table><br>
<a name="615069"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >puki</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="http://www.blitzcoder.com/ubb/Forum14/HTML/001711.html" target="_blank">http://www.blitzcoder.com/ubb/Forum14/HTML/001711.html</a><br><br>Came with full source code - it was the one whereby you steer a sphere around a lightmapped level and as it moved into shade it darkened in relation to the shade. <br><br></td></tr></table><br>
<a name="615076"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >t3K|Mac</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> the links to DSS_VLM.zip do not work fore me. anyone having a working one? i'd love to read and learn... <br><br></td></tr></table><br>
<a name="615079"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Naughty Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have whole source for this stuff, but I am not sure is it same author..anyway, it is stuff Puki explained before...you can move scaled sphere over lightmapped level and its changin light over sphere surface according to lightmap light source... <br><br></td></tr></table><br>
<a name="615082"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >t3K|Mac</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> thats exactly what i am looking for ;) do you mind if you mail it to me? adress is in my profile... <br><br></td></tr></table><br>
<a name="615083"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Naughty Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> ..of course, here is download link, enjoy this excellent stuff...<br><br><a href="http://www.sendmefile.com/00224913" target="_blank">http://www.sendmefile.com/00224913</a> <br><br></td></tr></table><br>
<a name="615091"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I still have file however my ISP kept booting me off for running a server- I had to remove the file. Sorry all! <br><br></td></tr></table><br>
<a name="615092"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Naughty Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> ..hmm..my previous link doesnt work...try this one..<br><br><a href="http://www.freefileupload.net/file.php?file=files/110106/1136977441/SMART_LIGHT_SYSTEM.zip" target="_blank">http://www.freefileupload.net/file.php?file=files/110106/1136977441/SMART_LIGHT_SYSTEM.zip</a> <br><br></td></tr></table><br>
<a name="615097"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> "A connection with the server could not be established."<br>??? <br><br></td></tr></table><br>
<a name="615100"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Naughty Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> huhh...maybe this one...<br><a href="http://www11.rapidupload.com/d.php?file=dl&amp;filepath=4581" target="_blank">http://www11.rapidupload.com/d.php?file=dl&amp;filepath=4581</a><br><br>this one working..I try just now.. <br><br></td></tr></table><br>
<a name="615132"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jhocking</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks! <br><br></td></tr></table><br>
<a name="615338"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Avrigus</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wow that's a fantastic example! Here's a simpler version I downloaded a few years ago (this example was created by kusanagi@... ):<br><a href="http://www.secretsally.com/lightmap_col.zip" target="_blank">http://www.secretsally.com/lightmap_col.zip</a> <br><br></td></tr></table><br>
<a name="615616"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RifRaf</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> What i do for this is similar . on my main mesh i will go <br>through the lightmap, and give the appropriate vertexcolor <br>to the nearest vertex of the pixel.<br><br>Then after i mirror the lightmap to vetexcolors (i dont <br>remove the lm though)  i can then do a linepick , and get <br>the vertexcolor below the player, wich is much faster than <br>getting the texture uv coords and reading the texture pixel<br>color as well.<br><br>Your lightmap, or colormap will need to be tweaked to use<br>this method. as the additional vertexcoloring will darken <br>the lightmap some. <br><br></td></tr></table><br>
<a name="615691"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> You don't need to mess around reading pixels from the lightmap.<br><br>Just keep track of where all your lights are.  If they are visible to the player, and in range, use them to light the player model, either with vertex colors, or by settings up DX lights and rendering the model in a separate pass. <br><br></td></tr></table><br>
<a name="615735"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jhocking</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> The determining if they are visible to the player, wouldn't that be slow?  I mean, that's occlusion culling you're talking about, to determine if the player is in the shadow of an object in the level.<br><br>Of course, it doesn't need to be super accurate, so just doing a linepick between the player and the light would do.  Hm, I should code that and see how it works out. <br><br></td></tr></table><br>
<a name="615757"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RifRaf</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> You don't need to mess around reading pixels from the lightmap. <br></div><br><br>the original question was about using the lightmap, not a lighting "system" <br><br></td></tr></table><br>
<a name="615775"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jhocking</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> True, but halo's answer addresses the real intent behind my question.  That is, he responded to my underlying concern, not just the literal question.<br><br>Incidentally, your vertexcolor suggestion wouldn't work.  The whole point of lightmaps is that vertex color isn't detailed enough to show stuff like shadows.  Note that the original request specifically referred to having characters affected by shadows in the level. <br><br></td></tr></table><br>
<a name="615804"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RifRaf</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes it works very well. you dont remove the lightmap, you simply vertex color a best batch to the dark tones of the lightmap.  the shot below has both lightmap and vertexcoloring for the purpose of picking the vertexcolor instead of reading pixels from the texture..<br><br><a href="http://www.empowergames.com/pubimages/mc_treepack2.jpg?" target="_blank">http://www.empowergames.com/pubimages/mc_treepack2.jpg?</a><br><a href="http://www.empowergames.com/pubimages/mc_newlm4.jpg?" target="_blank">http://www.empowergames.com/pubimages/mc_newlm4.jpg?</a><br><br>Plenty accurate if your using say a mesh terrain. as i am, i havent tried it in say an interior scene, you would be right in that case unless you segmented flat areas to accomodate the vertex light effects<br><br>but then i was just offering a suggestion to try, didnt realize you would want to debate it. I agree that Halos idea is a good one. <br><br></td></tr></table><br>
<a name="615805"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jhocking</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> Geez dude.  You'll pick on somebody else's response, but you can't take your own medicine? <br><br></td></tr></table><br>
<a name="615808"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RifRaf</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> if you say so, i was just trying to offer an alternative idea. <br><br></td></tr></table><br>
<a name="618725"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >OrcSlayer</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've tried out the smart light system by Loki, but I've got a few issues with it I hope someone can help me with...<br><br>First it makes a big difference if you have lights set to be real or not. This shouldn't effect it, from what I can tell, because the data comes from gile[s] lights, not blitz lights (right?). However, with real lights turned off, a few lights work (very well I might add) but others seem to simply not exist (they are there on the lightmap, but it doesn't recognize them, or it just doesn't display them). On the other hand, with real lights enabled you have colors bleed through walls since there is no occlusion culling for the DirectX lights (obviously).<br><br>Another problem is if I do use it with real lights enabled, which is the only way that seems to work, what is going to happen when I overstep the DirectX limit? No way I'm going to use maps that have less than eight lights in them...so this would certainly be a problem.<br><br>Any help would be appreciated! <br><br></td></tr></table><br>
<a name="618730"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KuRiX</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have a very fast solution for 1 height levels (for example a simple city).<br><br>You create a bitmap top view of the rendered scene in gray scale, then you load the file before starting the game into a Matrix of Colors.<br><br>Then you calculate the position of the character in the matrix and assign the color. It works very well and is the fastest solution.<br><br>If you have different lightmaps for the same X,Z value then you will need several matrixes.<br><br>Good Luck! <br><br></td></tr></table><br>
<a name="618757"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sir Gak</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> Umm, what about setting the AmbientLight to 0,0,0, and then let the character/object be lit by whatever local lights there are? <br><br></td></tr></table><br>
<a name="618786"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jhocking</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> You seem to have missed the entire point of the question.  At any rate, halo's suggestion worked great (at least for my needs, since the lighting setup is just a directional light.) <br><br></td></tr></table><br>
<a name="618804"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >OrcSlayer</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'd really like to use the smart light system by loki myself, if anyone knows why it only wants to work with "real" lights.<br><br>Small update, after doing some testing it seems that all the guile[s] light objects end up being treated as if they are at xyz 0 when not using real lights. I think this would explain the problem, but I don't understand why it happens. Perhaps I need to look inside the code itself...which is bad since it all seems to be in french... <br><br></td></tr></table><br>
<a name="619794"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Another problem is if I do use it with real lights enabled, which is the only way that seems to work, what is going to happen when I overstep the DirectX limit? No way I'm going to use maps that have less than eight lights in them...so this would certainly be a problem. <br></div><br>Once you eliminate lights that are too far away, or occluded from the player view, it is unlikely your character will be lit by more than 8 lights.  If he is, dismissing lights over 8 won't make any difference in his appearance.<br><br>You could also calculate lighting per vertex and change the vertex colors.  Advantages are you don't need to render the player in a separate pass, and you don't have to worry about the 8-light limitation (although this doesn't really matter anyways).  A disadvantage is that calculating vertex lighting is rather slow compared to hardware lights.<br><br>Once you establish your lighting system, you may want to refine it by storing a list of lights that affect a model each frame.  Instead of re-calculating the lighting each frame, which can make the lighting appear to change suddenly and sharply, you can fade out lights that no longer affect the model, for a smoother transition. <br><br></td></tr></table><br>
<a name="619806"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> To be quickier, wouldn't an EntityVisible be better than a linepick? You still need to set a pickmode for everything that will be in the way of lights. I used this method for a space shooter. If the sun could see the player, I disabled the SLIGHTLY larger, black copy of the mesh acting of a shadow. It does work well :o) <br><br></td></tr></table><br>
<a name="619832"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, entityvisible is usually faster than linepick.  The former will exit the function as soon as one occlusion occurs, while the latter will create a list of all occlusions and return the closest one. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
