<!DOCTYPE html><html lang="en" ><head ><title >Texture blending and Z buffer problem</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Texture blending and Z buffer problem</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Texture blending and Z buffer problem</a><br><br>
<a name="553841"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Makepool</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have a problem that I¡Çm not sure can be solved but I¡Çll ask anyway. I wanted to do texture blending on my levels but found that Blitz couldn¡Çt actually do this. There are a few blending options in blitz but none will let you create for example a terrain textured with one texture and then say a path going round it. You can manage to fake it with the right combination of colours as in the demo provided with Blitz called ¡Æinsaner¡Ç but that does work with the level colour scheme we have.<br><br>We finally managed to fake it using models with two layers, the top layer having an alpha channel, and that appeared to work very well. Unfortunately I then found that when I fire the rocket launcher in my game over the ground the areas that are blended appear in front of the smoke trail that has an alpha value of 0.5. I assume this is due to a hardware error when multiple objects with lower than full alpha are rendered on top of each other. The renderer can get confused about the Z-order and render the scene incorrectly.<br><br>Has anybody encountered this before and does anybody have a solution? <br><br></td></tr></table><br>
<a name="554268"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Makepool</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> ANYBODY AT ALL? <br><br></td></tr></table><br>
<a name="554274"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shambler</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Try this <a href="http://www.d-grafix.com/" target="_blank">http://www.d-grafix.com/</a> <br><br></td></tr></table><br>
<a name="554485"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Makepool</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> TED's programmed in Blitz so I don't see how its multitexturing could have been achieved any other way than the way we're doing it and hence we'd get the same problem occurring. <br><br></td></tr></table><br>
<a name="554495"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shambler</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> [Edit] Perhaps d-grafix can tell us if overlaying an alpha effect over that sort of terrain is possible? <br><br></td></tr></table><br>
<a name="557317"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Duck</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I believe Blitz3D sorts transparent entities by their distance from the camera.  The distance used would be to the entity's position. Depending on where the smoke trail sprites are relative to the terrain chunk's position the sort order could fail to produce correct results. This is not a hardware error.<br><br>Try using EntityOrder with a value less than zero. This will draw your sprites after everything else has rendered. It will not update the Z-Buffer but I think it will use it to render them. This will probably have problems but might be worth a try. <br><br></td></tr></table><br>
<a name="557393"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here's some information that may prove useful:<br><br>In Blitz, each surface in a mesh is rendered in the order it is created.<br><br>Also, transparent objects are compared against the zbuffer, but do not write to it.<br><br>If you enable the vertex alpha flag on a surface without transparency, it will be rendered as a transparent surface.<br><br>So the solution to your problem is to have a mesh with one solid surface, and additional surfaces with identical polygons that have a different texture and the vertex alpha flag set.  Then you simply set the vertex alpha the way you want to in order to make some areas of the terrain show the top texture(s), and others show the bottom opaque layer.<br><br>You might also combine this technique with alpha maps to get better looking blends between tiles, but that's probably a lot more complicated.<br><br>If it helps though, you can render alpha without an alpha map by multiplying the bottom layer by the inverse of the alpha map, then adding the top layer after it has been multiplied by the original alpha map.  That last bit is the tricky part though.  If you use multiple entities to accomplish it, you'll probably have problems with stuff drawing in the wrong order. <br><br></td></tr></table><br>
<a name="558134"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >D4NM4N</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> ted uses a limiting aproach to alpha blending. When i started writing it i did tonnes of research and experiments. I eventually found out that as long as the camera doesnt overtake the terrains axis and the alpha values balance each other it seem to be a bit more Z stable. <br><br><img src="http://www.d-grafix.com/gfx/screenshots/alpha.jpg"><br><br>here is a tree with alpha on the leaves, with multitexturing and is stable (&amp; thats on my old geforce 4 and my laptop w/intel 82815) <br><br></td></tr></table><br>
<a name="558424"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> why do i have a feeling cameraclsmode may be handy here?<br><br>Just theory, as im at work:<br><br>Have a solid, non alpha of the surface you wish to render in alpha.<br>Hide the original alpha mesh and show the solid version.<br><br>Use cameraclsmode to clear both colour and zbuffer.<br>Render this. This writes that information to the zbuffer.<br><br>Now, use cameraclsmode to clear colour but not Zbuffer.<br><br>Now, hide the solid mesh you used above, and show the alpha one, render the rest of the scene. Return CameraCLSmode to normal if necesarry<br><br>Could someone test that? im at work :D haha. just a thought though :D <br><br></td></tr></table><br>
<a name="562499"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >D4NM4N</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> sussed it ( i think )<br><br>try this<br>www.d-grafix.com/sourcecode.html<br>this is a TED terrain which uses vertex alpha with some alpha bushes sitting happily on it with no apparent problems.<br><br>This is after the T.Ed v2.1 update which is still being tested for bugs. <br><br></td></tr></table><br>
<a name="563624"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Makepool</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ay up lads, TED uses Blitz's own dodgy multitexturing so that you can't completely get one texture looking correct on top of others. In other words if you had a texture with a pattern on top of it then put a texture of solid colour over the top you'd be able to see the pattern underneath where it should be solid colour.<br><br>ALE uses alpha channels as we were doing and so we get the same Z buffer problems with smoke as we did before.<br><br>I now believe that it's not possible to properly solve this problem in Blitz 3D and hope to GOD that MAX includes proper support for multitexturing. <br><br></td></tr></table><br>
<a name="563651"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >D4NM4N</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Which version are you running? if its before 2.1 there is problems with alpha textures. 2.2 however seems stable with alpha textures and can be seen running on the latest mountain and island demos from here www.d-grafix.com/softwareted.html<br><img src="http://www.d-grafix.com/gfx/screenshots/alpha2.jpg"><br>Here is one on a multimesh from the mountain demo showing the alpha working too. <br><br>If anyone has problems after rel 2.2 let me know the video hardware as it may be a card specific thing. <br><br></td></tr></table><br>
<a name="563653"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Makepool, I use a base layer of all black in T.ED, and the blending works fantastic, you can then see as much or little of each layer as you want.<br><br>I'm having NO Z buffer problems with demos using smoke, or bushes.<br><br>Check the T.ED demos and see for yourself. The z buffer issues are not present.<br><br>*preception is reality* <br><br></td></tr></table><br>
<a name="563661"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >D4NM4N</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> In other words if you had a texture with a pattern on top of it then put a texture of solid colour over the top you'd be able to see the pattern underneath where it should be solid colour. <br></div><br>As it says in the manual, base layer 1 should not have a strong pattern or color, as it will show through. This is not an error, i designed ted this way so no alpha layer can go higher than .5 this allows the water to be displayed with no problems and also (after 2.1) the alpha textures too.<br><br><div class="quote">  Using a black layer will make the others stand out more <br></div><br>Using a black layer will make the others stand out a lot more and look really good as wayne says. bHowever, that is not what ive done in the demos. I used the sand 4 the island and neural stone on the mountains <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
