<!DOCTYPE html><html lang="en" ><head ><title >Framerate drops</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Framerate drops</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Framerate drops</a><br><br>
<a name="470869"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >fall_x</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>I have a large terrain and two player objects. It runs smoothly at around 50fps. But then I added some trees (+-250, each has about 50 polygons), there's usally 5-6 onscreen at the same time, and the framerate drops to +-28. I use camerarange.<br>The models use transparant png's.<br><br>Anything I can do to make it run faster? (commenting out all my code so it just has to render doesn't make it faster so it's not my code that's running slow).<br><br>Thanks. <br><br></td></tr></table><br>
<a name="470870"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >fall_x</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> here's a screenshot : <br><br><img src="http://www.ontspoord.com/stuff/screen_trees.jpg"> <br><br></td></tr></table><br>
<a name="470917"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hujiklo</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> It will be your transparency textures on your trees...do a test and replace the trees with objects with the same poly count but no transparency textures and you'll probably see no frame rate drop. <br><br></td></tr></table><br>
<a name="470922"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Koriolis</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Actually the problem is most probably the number of individual objetcs. Blitz doesn't handle this very well. The more individual objects, the more individual surfaces, anf blitz doesn't like that. To handle well numerous objetcs, you might want to try to merge your objects: take several trees, and for each surface with the same properties (same texture, same color, etc) you can merge both surfaces into a single one.<br><br>Do a search in the forum, you should find some intersesting threads on the subject.<br><br>Sweet graphics by theway. <br><br></td></tr></table><br>
<a name="470930"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >fall_x</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> "It will be your transparency textures on your trees...do a test and replace the trees with objects with the same poly count but no transparency textures and you'll probably see no frame rate drop. "<br>OK, I'll try removing the texturefilter option that makes them transparant and see if it's an improvement.<br><br>"Actually the problem is most probably the number of individual objetcs. Blitz doesn't handle this very well. The more individual objects, the more individual surfaces, anf blitz doesn't like that. "<br>Do you mean the number of total objects, or the number of objects on screen at one time?<br><br>"To handle well numerous objetcs, you might want to try to merge your objects: take several trees, and for each surface with the same properties (same texture, same color, etc) you can merge both surfaces into a single one."<br>I don't really understand what you mean. I tried searching for "merge surfaces" but didn't find anything. Could you explain, or point me in the right direction?<br><br>"Sweet graphics by theway. "<br>That's motivating. Thanks! <br><br></td></tr></table><br>
<a name="470935"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Koriolis</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Do you mean the number of total objects, or the number of objects on screen at one time? <br></div>The second one, as objects entirely out of the viewport are not rendered.<br><br>These systems are often called "single surface system"<br><br>When you search on the forum, don't use the built-in search facility, it is too limited. Instead use google and restrict the search to this site, like:<br><br>site:blitzbasic.com surface merge "single-surface"<br><br><br>By doing that I have found some threads from which you could get some useful information. In particular there is a code archive here:<br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=389" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=389</a><br><br>An additional note: don't merge all the objects into a single one big object, because as soon as an object is even partly visible on screen, it is rendered. If your forest is only one big object then it will always be entirely rendered, and even if it is rendered faster thanks to the smaller number of surfaces, you will on the other hand have more polygons rendered. So the idea is to try to take a middle solution: create chunks of several trees. You"ll have to make some tests to find the best balance (that is, how many trees to group into a single object). <br><br></td></tr></table><br>
<a name="470943"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> 250 objects will not cause this much slowdown<br>ive had literally thousands of things on screen at max frame rate.<br><br><img src="http://www.damiensturdy.pwp.blueyonder.co.uk//enbmassacre.JPG"><br><br>That would run at 60fps (but it was vsynced, so i have no idea how fast it could run) without ever slowing down.. also remember that theres around 2-3 times that many ships but theyre all off screen. im not doing anything special either. <br><br></td></tr></table><br>
<a name="470944"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Koriolis</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> It obviously depends heavily on your hardware, as well as the number of surfaces per object.<br>Though it's quite possible indeed that the slowdown has nothing to do with the number of objects. <br><br></td></tr></table><br>
<a name="470945"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I agree with the surfaces per object. The above code has run fine on the last 4 machines (i use newer versions of it it as a benchmark, y'see) theyve all been 2ghz+ but of mixed hardware. I did however come across a problem where alpha/masked textures caused program death though.. dont know :) <br><br></td></tr></table><br>
<a name="470952"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >fall_x</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Koriolis, I've read the code in that link and I understand how it works (adding the meshes from child-entities to the same mesh). But I'm still not entirely sure how this would make it faster. Basically, I don't know what you mean with surfaces (the code in that link sais "Merge your high entity count into one entity matching surfaces " - but I don't get how the matching is done, I only see "addmesh")- is this the same as a "face" or a polygon? And placing them in the same mesh would be faster than when they're in a different mesh? Am I right?<br>Thanks. <br><br></td></tr></table><br>
<a name="470953"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Koriolis</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> What is called "surface" in blitz is just a bunch of polygons that are rendered the same way. So basically I'd say your trees have 2 surfaces: one for the trunk, and one for the leaves.<br>The thing is surfaces are per object: even though all your trees are the same, they all have these 2 separate surfaces.<br>When blitz renders such a bunch of polygons, it performs a rendering state switch (simply put, it sets the rendering pipeline in the state that is appropriate : setting the current texture(s) and so on). These state switches are costly, so trying to mimimize them is a good idea. And to minimize them the simplest is to minimize the number of surfaces.<br><br>In all honestly a good 3d engine should be able to minimize the number of state changes automatically (by rendering in one shot all the polygons that share the same rendering properties), but blitz doesn't do that and you have to take that into account.<br><br><br><div class="quote"> but I don't get how the matching is done, I only see "addmesh" <br></div>It's precisely this function that does the job. It will merge 2 objects by merging - when possible - the surfaces that make up the objects. <br><br></td></tr></table><br>
<a name="470961"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >fall_x</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> So basically, adding a bunch of trees (the amount I'll have to experiment on) to one mesh with AddMesh will make sure there will be a lot less surface switches which would make it run faster? edit : oh, I didn't see the last paragraph in your last post, thanks.<br><br>And yeah my hardware probably has a lot to do with it. I have a fairly good pc (don't remember the specs :s) but there's something wrong with it (most 3D games don't run very well, and scrolling in windows makes my sound skip, and most blitz programs that use an interface run very badly (the mouse doens't follow very well and I have to click a few times). Still I want it to run smoothly here, because that way it'll run good everywhere. <br><br></td></tr></table><br>
<a name="471043"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >fall_x</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay, I spent till 4am last night trying to get this implemented in my tree-population code (which, based on soms images, creates the forrest).<br>It works, I believe it's a bit faster now (not sure though), but I found out that now sometimes I can see trees entirely trough other trees that are in front of it. It's like the drawing order within my bigger meshes isn't correct. Is there anything I can do about this? <br><br></td></tr></table><br>
<a name="471050"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> That'll be to do with the transparency. When a single surface has trasparency, it loses the z-order, and there are drawn in the order they were created in. I don't think the amount of object should make that much of a difference, because blitz automatically doesn't draw any entities which aren't in view.<br><br>It maybe very well be the collisions. You should maybe split up the forest part into sectors. When the player moves into a sector, hide the trees in all the other sectors, and show the ones in the sector the character is in. Hiding an entity disables collisions for it, until it is shown again.<br><br>Also, have you tried disabling the v-snyc option? It sometimes leaves some tearing when rendering, but makes sure the game renders as quick as it can. <br><br></td></tr></table><br>
<a name="471065"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >fall_x</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> I just reversed the order in which my trees are created (the camera is never rotated in my game so I could do this) but the problem remains.<br>How do I turn off vsync? <br><br></td></tr></table><br>
<a name="471075"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Koriolis</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Flip false<br><a href="http://www.blitzbasic.com/b3ddocs/command.php?name=Flip&amp;ref=goto" target="_blank">http://www.blitzbasic.com/b3ddocs/command.php?name=Flip&amp;ref=goto</a> <br><br></td></tr></table><br>
<a name="471090"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >fall_x</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks. But it doesn' work :(<br>Any ideas are welcome. <br><br></td></tr></table><br>
<a name="471196"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >fall_x</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> I decided this is just not worth it. I tried a lot of things, and I could still see some trees trough other ones, even when I disabled the transparancy of my trees. So I turned off this mesh merging, and the framerate difference isn't that big and at least it all works the way it should. To compensate for the framerate drop, I made all my movements so they're relative to the time between frames - I just let my main loop run as fast as possible, and the slower the game runs, the more units I move everything. That way it'll run always run equally fast, just not as smoothly.<br><br>Thanks to everybody who tried helping me out. <br><br></td></tr></table><br>
<a name="471267"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >wizzlefish</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> There are probably non-Blitz-specific speed optimization tips out there on a site like "GameDev" or "CCN." <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
