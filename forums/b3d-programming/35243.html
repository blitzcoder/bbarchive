<!DOCTYPE html><html lang="en" ><head ><title >YAL code - flat shaded?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >YAL code - flat shaded?</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >YAL code - flat shaded?</a><br><br>
<a name="382761"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rottbott</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi all,<br><br>  I've been playing around with YAL from the code archives, and I've noticed what seems to be quite a big problem with it. It works perfectly to lightmap cubes, rooms, or other objects with sharp edges, but if I try to lightmap a sphere, terrain, barrel, or anything like that, the result looks a bit like it's flat shaded.<br><br>  Is this a "feature" of all lightmappers, or is there a way to make YAL lightmap curved surfaces properly that I'm missing? :-)<br><br>  If it's important I'm using sswift's version.. it was nearest the top.<br><br>  Link - <a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=794" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=794</a> <br><br></td></tr></table><br>
<a name="382825"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> As far as I know this is a "feature" of all lightmappers - unless they utilize some crazy magic. I think it's the way it works. A LightMapper would have to check for DX lights to realize how the smoothing should be added to the lightmap.<br><br>I think if at all, there are only a very few Lightmappers which do support smoothed surfaces. How about gile[s]? I don't know, just a question. <br><br></td></tr></table><br>
<a name="382830"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >fredborg</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> gile[s] preserves smoothing :) But you can set it to use flat shading if you like.<br><br>It's not crazy magic, but it's not that easy to do either :) <br><br></td></tr></table><br>
<a name="382831"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> &gt;&gt;not that easy&lt;&lt;<br><br>bah - you do use magic, confess! (someone call an inqisitor - you know, a holy one) :P<br><br>Seriously - hats off. <br><br></td></tr></table><br>
<a name="382945"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jhocking</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> This certainly is not true of all lightmappers.  gile[s] handles smoothing fine, as does lightmap calculation in tons of level editing tools (Worldcraft, etc.) plus baking lighting into textures in tools like 3D Studio Max and Maya is smoothed correctly.  Thing is YAL unwelds everything before lightmapping. <br><br></td></tr></table><br>
<a name="383153"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rottbott</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Fredborg, I can't use Gile[s] for this, I have to do it in code. :P<br><br>If I stop YAL breaking up the triangles, how can I make it handle each smoothing group in the same way as it currently handles each triangle? Is that even what I want to do to achieve smooth shading? Or do I have to somehow write my own lightmapper? Perhaps Mr BlitzSupport has a useful link? (He has one for just about everything else..)<br><br>Argh, I'm getting a headache just thinking about it! <br><br></td></tr></table><br>
<a name="383168"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rottbott</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've been doing some reading, and I *think* the problem is this:<br><br>YAL just takes a normal for the whole triangle, instead of interpolating the light levels based on the vertex normals of the triangle.<br><br>So:<br><br>A) Fredborg, can you tell me if I'm even along the right lines here? You've written one, you ought to know :)<br><br>B) Am I right in thinking that it would actually be fairly simple to make YAL interpolate the normals to adjust the colour of the lightmap texels, rather than write a whole new lightmapper? <br><br></td></tr></table><br>
<a name="393309"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rottbott</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> OK, I've narrowed it down to this:<br><br>I simply need a way (in YAL), to get the vertex indices of the triangle which the current lumel is on, when adding light to a lumel.<br><br>Anyone got any ideas? (Sswift? You've worked on YAL). <br><br></td></tr></table><br>
<a name="393335"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rob</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just pull the finger and wallet out and pay for your betters: gile[s]... <br><br></td></tr></table><br>
<a name="393348"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> As he said, he needs it in code, so gile[s]'s not the solution here.<br><br>Rottbott. You need to be able to read the smooting information, or, you could also use an average smoothing on angles less than say 45° then simply throw some sinus factors onto the lumel brihtness and there you go. the only problem seems to be to involve NX,NY and NZ to determine the angle of two tris (or maybe you need to do it quad-wise?) <br><br></td></tr></table><br>
<a name="393766"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Marcelo</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="/codearcs/codearcs.php?code=514" >YAL - Yet Another LightMapper (update 1.5 )</a><br><img src="http://raintree.hpg.com.br/smooth.jpg"><br><br>BTW, I haven't cleaned the code before posting. :) <br><br></td></tr></table><br>
<a name="393784"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rottbott</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Brilliant, thanks very much Marcelo!<br><br>Now to try and figure out how the heck you did that &gt;:-] <br><br></td></tr></table><br>
<a name="393804"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Difference</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Looks good, but isn't the sphere still flatshaded? Or at least showing seems? <br><br></td></tr></table><br>
<a name="393836"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Peter:<br>Looks smooth to me... but there's jpeg blocky artifacts all over the image.<br><br>[edit]<br>No.. you're right.. I ran the demo... the sphere is not smoothed properly.  I think it's better than it used to be but still has quite obvious seams.<br>[/edit] <br><br></td></tr></table><br>
<a name="393866"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Anyway, a step forward. thanks a lot! <br><br></td></tr></table><br>
<a name="393882"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Out of curiosity, if I were to make a system (for sale) which would render lightmaps a hundred times faster than YAL, would that interest anyone?  I think I know how to do it, but unless there's interest it's not worth my time cause I have no need of a lightmapper myself. <br><br></td></tr></table><br>
<a name="393888"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> how big should that interest be, in $? and would this include smoothing groups? <br><br></td></tr></table><br>
<a name="393891"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh I'd sell it for the same thing I sell everything else for probably.  And yes, it would support smoothing through vertex normals. <br><br></td></tr></table><br>
<a name="394399"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dragon57</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Swift, I would probably buy it. <br><br></td></tr></table><br>
<a name="394807"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> speed isn't such an issue to me since i can easily render a huge lightmap over night if I once know how to use a tool "blindly". What matters is the quality. If you beat gile[s] in features I would think about it - tho I hate to buy tools twice. <br><br></td></tr></table><br>
<a name="394822"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> Gile[s]? Ahahaha. :-)  Fraid not.  If I wrote something of the level of Giles I'd have to charge a lot more for it than I do for my systems, that would take months to write!<br><br>Anyhow it was jsut a thought.  I'm probably not going to attempt it. <br><br></td></tr></table><br>
<a name="394823"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> I mean, it's always a good thing to make something faster. How about to do somethng together with Fredborg? You can send him a simple demo, he may buy the idea or let you participate. <br><br></td></tr></table><br>
<a name="394829"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> I had a play with Marcelo's latest version and still puzzling over the smoothing algorithm.<br><br>Once I confirm that the triangle area ratio is fine and that better spherical shading is not possible without a special case (as in you can not use linear interpolation without suffering seams) I'll post some of the optimizations I made while testing. <br><br></td></tr></table><br>
<a name="394831"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >boomboom</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> a good quality real time light mapper based on lights placed in the blitz scene, if you could do that swift then i would buy it. maybe even intigrated with your shadow system and made as an overall lighting package <br><br></td></tr></table><br>
<a name="394834"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Marcelo</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> For smoothed objects, maybe a simple per-vertex LightMesh() is the better option. :)<br><br>This is a quite old code, the planer mapping is not suitable for smoothed objects, there are much better unwrapping algorithms for this. <br><br>FredBorg, what about a gile[s] SDK, possible? :) <br><br></td></tr></table><br>
<a name="394851"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ice9</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> One thing about YAL if you have an odd triangle that won't<br>make a full quad it ends up with odd shading on corners <br><br></td></tr></table><br>
<a name="394956"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> really? I never realized this. <br><br></td></tr></table><br>
<a name="394985"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ice9</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> I can't use giles. The way my levels are built prohibits<br>that without writing a bunch of code to convert the levels<br>back and forth. My light maps aren't as important ot the<br>game as other things. YAL does the job great but it would<br>be nice to have a Giles SDK similar to YAL. You could sell<br>a version for personal tool building and a more expensive<br>version for redistribution. <br><br></td></tr></table><br>
<a name="395004"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> The problem with YAL is that it combines lightmaps into "surfaces" which are polygons that are adjacent and have similar normals.<br><br>If it just mapped each tri seperately, then it would be trivial to get the smoothing right.<br><br>The problem is not knowing which triangle the particular lumel you're mapping is in.  Now, one could write a slow algorithm to figure this out after the fact, but it would really be much simpler and faster to toss out the special case stuff.  There is no need to compress lightmaps so much in today's games. <br><br></td></tr></table><br>
<a name="426046"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nikko</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sswift, if you do this lightmapper, I'll buy it. <br><br></td></tr></table><br>
<a name="426538"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Zethrax</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'd certainly buy the lightmapper, Sswift. I'm working on a world editor at the moment, which I'd like to add a lightmapper to. I'd happily pay the commercial license price (or more) for it, too, as it would save me a heap of work. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
