<!DOCTYPE html><html lang="en" ><head ><title >Portals, simplified</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Portals, simplified</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Portals, simplified</a><br><br>
<a name="380201"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> 1.  Create boxes surrounding different areas of your map.<br><br>2.  Boxes that touch each other are considered adjacent.<br><br>3.  If the camera is in one box, all adjacent box areas are drawn.  Areas that are two degrees away are hidden.<br><br>Simple, effective, easy to set up, easy to implement. <br><br></td></tr></table><br>
<a name="380216"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> That's a good idea actually... :) <br><br></td></tr></table><br>
<a name="380222"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >poopla</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> it's also not going to work very well. <br><br></td></tr></table><br>
<a name="380223"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ayup. <br><br></td></tr></table><br>
<a name="380232"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Techlord</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Areas that are two degrees away are hidden. <br></div><br>halo,<br><br>Please elaborate. I assume each box stores a list of potentially visible polygons (meshes|areas|etc)? If so, will this not require preprocessing? If this data is preprocessed, why would it require areas that are two degrees away be hidden?<br><br>I've dubbed the technique above Cubic Space Partitions (CSP). With CSP each box (cube) contains a list of potentially visible polygons. When the player moves from one cube to another, the previous cube's polygon are hidden and the next cube's polygons are shown.<br><br>The cool thing about CSP is that it works on any type of geometry and is very flexible at a high level.  The trick is acquiring the list of potentially visible polygons and myself and few others have developed a algorithm/process to automatically acquire this data.<pre class=code>;frankie t's identify color by uniqueness (icu) algorithm
array vis(n,n,n)
global worldscale#=.1

loadanimmesh levelmap.b3d

for each childmesh within mesh
	apply unique color equal to childmesh index
	set childmesh attributes to fullbright, flat shading, disable fog, disable backface culling, no texture
next

repeat 
	increment camera through level map geometry on x,y,z planes
	cameraPosition camera,{camera.increment * worldscale#}
	vis(camera.increment.x%,camera.increment.y%,camera.increment.z%)=create bank
	for cameraAngles% = 1 to 6;(up,down,left,right,front,behind)
		cameraAngle camera
		snapshot=cameraSnapshot(camera)
		for each snapshot
			for x = 0 to snapshotWidth
				for y = 0 to snapshotHeight
					color%=readpixel(snapshot,x,y)
					if color&gt;0 and not on vis(camera.increment.x%,camera.increment.y%,camera.increment.z%)
						poke(vis(camera.increment.x%,camera.increment.y%,camera.increment.z%),++,color)
					endif					
				next
			next	
		next
	next
until camera completes level
</pre> <br><br></td></tr></table><br>
<a name="380247"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry, I left out that if an object is within that box, it is hidden and shown with the portal section.  I would actually merge the meshes within one area into a single mesh, for walls and stuff that doesn't move.  So if a portal area gets hidden, that part of the map is hidden, and any entity within its bounds can skip updating.<br><br>Obviously, you would set the portals up so that they meet as they go around corners.  You have to plan how they are aligned, but if you just lay them out, the system takes care of the rest.  Look at the UT2003 map "Training Day" for an example of this.<br><br>As for the two naysayers lacking explanations, you're just contradictary idiots that will argue with anything I say, because you know I am a million times better than you at everything.  You are useless and have accomplished nothing, so just shut up already. <br><br></td></tr></table><br>
<a name="380253"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> "As for the two naysayers lacking explanations, you're just contradictary idiots that will argue with anything I say, because you know I am a million times better than you at everything. You are useless and have accomplished nothing, so just shut up already."<br><br><br>Et tu, Brute?  <br><br>He jests at scars that never felt a wound! <br><br></td></tr></table><br>
<a name="380333"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >CyberHeater</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Lordy lord.  Will you two just stop it and kiss and make friends.<br>The irony here is that in real life, you'd probably be good buddys cause you share a lot in common. <br><br></td></tr></table><br>
<a name="380353"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I hardly think the fact that we are both caucassian and we both program in Blitz basic counds as "a lot in common". <br><br>Besides, you're mistaking witty barbs for attacks. :-) <br><br></td></tr></table><br>
<a name="380361"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >CyberHeater</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> sswift	(Posted 2004-06-13 03:30:39)<br>I hardly think the fact that we are bouth caucassian and we both program in Blitz basic counds as "a lot in common".<br><br>Besides, you're mistaking witty barbs for attacks. :-)  <br></div><br><br>Good to hear :) <br><br></td></tr></table><br>
<a name="380364"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dan_upright</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> i believe this is how the terrain in morrowind works - it's not a great system though, because if your "boxes" are small you'll potentially have a poor view distance and if they're fairly large you won't get much benefit (or you'll have agonising pauses for loading like in morrowind) <br><br></td></tr></table><br>
<a name="380366"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AntonyWells</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> I wanna be a idiot too. (Mission accomplised. Procede to Level 2.)<br><br><br>That was quick...<br><br>as for the idea, I already posted this idea a while back, but insted of manually creating the boxes that 'touch', it genereates them it's self, then creates bounding boxes for each sub-group, and then come run-time it displays the one you're in and the surrounding ones.<br><br>I believe any feature that can't be 'integrated' code-wise is never going to have the same popularity as one that can. Mostly because I and million coders like me have no talent when it comes to setting up portals and messing about with 3d apps.  for example, normal mapping. Great feature when used right, but really needs to be set up in a 3d app for world space due to the lack of tangant 'conversation' in blitz(Why mark, why!?) Result? Not a single game or proper demo that uses it made in blitz. <br><br>Still, good to have in a 3d app too, for those of us lucky enough to have artist doing all our dirty work ;) <br><br></td></tr></table><br>
<a name="380382"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ZombieWoof</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Octagon: couldnt agree more -- I want a fully integrated turnkey solution -- create extreme (terrain+(building with complicated interiors)), run it through a compiler and have it run like the wind when loaded in Blitz :) And I frankly dont care how long it takes to compile -- I got a dual 2.8 xeon for doing grunt work like that. Now to learn enough about the issues and the techniques to contribute to making the integrated solution we want !!<br><br>@Frank Taylor: how well do you think CSP/ICU could handle a situation like I'm trying to work with -- say a terrain with a dozen 2 story buildings loaded from .X files, each bulding with 2-10 rooms, and lots of static furniture/props in each room. For example, using an ALE terrain and the props file it generates as the source. Each X file represents an entire building. Say &gt;2.5 million polys total.<br><br>Perhaps 2 levels of CSP data ? One for outside, one for inside, possibly seperate interior data for each building ? <br><br></td></tr></table><br>
<a name="380388"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AntonyWells</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Terrains are easier, because you can just segment it and use regular dynamic lod on each segment. I don't believe any solution which involves dynamic mesh rebuilding is ever going to be worth bothering with, at least not until pci...<br><br>It takes *ages* to resend mesh data over to agp space, which you have to do once the mesh is rebuilt. Or you could use vertex arrays to render from system memory but again the speed hit will be so 'massive' it 'renders' the whole excersise pointless. Unless perhaps maybe you're using a real-time lod/dynamic mesh method that only resends a tri indice list over... which is possible...might be fast enough.<br><br>So segmented terrains with lod, and ideally for buildings you'll use lod too for the outter surface, and make the 'innerds' a seperate surface that is activated once it's parent mesh lod level raises above a certain 'trigger'.<br><br>Also for props as you mentioned, single surface them. If they're static that is, if not, copy entity them. Never use multiple versions of the same mesh, it eats up too much agp memory for a decent level and will cripple bandwidth/surface changes.<br><br>It's all about minimizing overheads and bandwidth. Pure poly count is only a small factor in the overall speed of a engine. <br><br></td></tr></table><br>
<a name="380464"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Warren</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> What if you're looking out of a window that sees an area more than 2 degrees away?<br><br>Oops.<br><br>There's a reason professional games haven't picked up this brilliant idea yet. <br><br></td></tr></table><br>
<a name="380468"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Techlord</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> ZombieWoof,<br><br>CSP/ICU could be used as long as you can divide the mesh into smaller sets. You will have a large VIS data set. I would also recommend using some form of LOD. <br><br></td></tr></table><br>
<a name="380544"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ZombieWoof</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> @octagon: tri-index-list possible in blitz or possible if I do my own engine ?? Lets assume for the moment that solution must work with the current blitz3d :) <br><br>For the props, I get them as a X or 3DS file that defines the entire building -- would take some work walking the graph of sub-meshes to detect duplicates.<br><br>@frank: thats the whole point of the compiler :) I think you just defined part of the process flow chart :)<br><br>I'll take the hickey on vis dataset size if it can work reasonably fast.<br><br>@all: Have we had enough theory yet ? are we ready to try an implementation ? modular enough that we can replace pieces with better code as it comes along ? like this:<br><br>1. process terrain into chunks. assign props to chunks. props with bounding boxes that span chunks belong to both chunks.<br><br>2. build terrain lod info.<br><br>3. perform CSP on each chunk considering only the mesh, not any props that have been dropped on the terrain. Can be fairly coarse here to avoid frequent mesh updates to gpu during movement. <br><br>4. seperate interior/exterior mesh of eash prop and create lod data for exterior (in the process detecting props for which exterior extraction doesnt signifigantly reduce the number of polys, just create lod data for those.)<br><br>5. on props for which it was possible to create seperate interior / exterior mesh, perform internal CSP or other PVS operation at the entity level, no point in dealing with tri visibility here. (could go all out here, divide the mesh into rooms and regroup the meshes to make each room an entity, then do an auto-portal setup)<br><br>outputs to this point:<br>1. segmented terrain, and lod'd versions of same<br>2. prop/exterior meshes, and lod'd versions of same<br>3. terrain csp data + prop placement<br>4. rebuilt interior meshes/mesh sections with vis data<br>5. control file to tie the whole mess together, and tell the BB lib code what to load :)<br><br>Most of this can be done as small apps that handle a single step independent of other steps. Can y'all help me out with existing code that does any portion of the process, or demonstrates useful techniques ?? Especially the mesh chopping stuff :)<br><br>All this makes me want do a project management system that will control the build process and only update the portions that need updating when parts change. If an auto-portal system is used, will also need a mesh/portal viewer/editor so the portals can be fine tuned, or created manually (option to not auto-portal a mesh after seperating it into entity meshes for the masochists that want to manually setup portals) <br><br></td></tr></table><br>
<a name="380587"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> This isn't for distance, this is for indoor culling.  If you are in the red area, everything is shown.  If you are in the green area, the red and green areas are show.  In the blue area, the red and blue areas are shown.  Before anyone points this out, you would obviously need to adjust the areas so that your line of site was blocked between the blue and green areas, by the corners of the walls.<br><br>I'm not posting this for your approval, but just because it is a cool easy way to do this.<br><br><img src="http://www.leadwerks.com/post/cull.jpg"> <br><br></td></tr></table><br>
<a name="380813"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Techlord</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> halo,<br><br>Looks promising. I would like to see the concept in action to get a real for it. I'm very interested in how it will handle non-orthogonal geometry.<br><br>ZombieWoof,<br><br>I'm currently working on a new VIS/CSP/ICU Processor for <a href="/posts.php?topic=32550" target="_blank">Open Source Project PLASMA 2004.</a> You are more then welcome to use it when complete. No Estimate Time of Completion, but I'm shooting for next week. <br><br></td></tr></table><br>
<a name="380831"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ZombieWoof</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> perfect == should have the code for seperating hi poly meshes into internal and external by then -- I think I got it working but its not displaying right -- very brute force approach:<br><br>from each vertex, linepick along the vertex normal -- if any mesh is picked, mark the vertex as culled.<br><br>scan all tris, if the tri has a vertex in the cull list, skip it, else copy the tri to a new mesh.<br><br>I've blown something copying the triangles tho, cause newmesh is showing up only every other render as I add verts/tris and rerender after processing each surface. When its done, it only shows the original mesh, though the poly count has increased for the new mesh. <br><br>doesnt do too badly though -- 40K face mesh down to 14K - and could probably do a lot better with a better external face detect algorithm.<br><br><a href="http://www.camelot-software.com/files/exterior.zip" target="_blank">http://www.camelot-software.com/files/exterior.zip</a> if someone wants to look over the code and tell me where murphy tossed in the monkey wrench :) <br><br></td></tr></table><br>
<a name="380832"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> The drawing is square because that was easy to draw.  The angles of the walls are totally irrelevant. <br><br></td></tr></table><br>
<a name="380838"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ZombieWoof</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> @halo -- trying to understand what you are getting at -- are the colored boxes generated automatically, or are you drawing them on a bitmap and then using that bitmap like a CSP dataset to determine whats visbile ?? (i.e. the current color and any adjacent colors ?) <br><br></td></tr></table><br>
<a name="380844"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ZombieWoof</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> updated www.camelot-software.com/files/exterior.zip<br><br>I fixed a coupla bugs, but its still not showing the new mesh. I thought I had it right, copying verts, creating tris, copying normals and brushes. RenderWorld is processing more tris, but nothing new is showing up.<br><br>help !!<br><br>Edit: ok.. forget that method -- these meshes I'm testing with have to many overlaping surfaces that cause mesh hits when part of the surface is obscured<br><br>On to Method #2 -- UCI and pan around the building with flat perspective camera settings <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
