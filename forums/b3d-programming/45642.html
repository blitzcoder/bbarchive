<!DOCTYPE html><html lang="en" ><head ><title >Elite NPC movement</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Elite NPC movement</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Elite NPC movement</a><br><br>
<a name="507440"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Anyone have any ideas on how to do the roll to required angle then pitch to face target thingy that the NPC's do in Elite?<br><br>Ive been wracking me brain trying to work this one out to no great success. I can get the ships to face thier target but without rolling and pitching which I want as its homage to Elite :).<br><br>Any ideas as triganometry isnt my strong point nor is quaterions etc. <br><br></td></tr></table><br>
<a name="507445"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_PJ_</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> What's required, is for the AI ships' movement to be limited to just pitching and rolling. Then, ensure the only thrust will be from behind the craft.<br><br>Use TFormPoint and some pivots placed LOCALLY ABOVE &amp; BELOW the ai craft to work out the correct angle required so the roll places the target craft LOCALLY VERTICAL* from the AI craft. Then, pitch the craft until it faces the target.<br><br>*Hope this makes sense. <br><br></td></tr></table><br>
<a name="507758"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> thanks will have a look, if anyone has a code example it would be appreciated ;) <br><br></td></tr></table><br>
<a name="508215"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> If anyone has a code example it would be appreciated ;). I need the roll so I know what to roll the entity to the desired angle so that when it pitches it faces its quarry. <br><br></td></tr></table><br>
<a name="508354"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KuRiX</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think i don't understand quite well what you need but:<br><br>Pointentity enta,entb,rollangle#<br><br>could help you... <br><br></td></tr></table><br>
<a name="508437"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jeremy Alessi</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> You mean you just want the ships to have the same roll so neither is upside down relative to the other?  Makes sense to me that you'd adjust the roll of the targeting ship to match the target's roll and then you'd use:<br> <br><pre class=code>
DeltaPitch(ship, target) 
</pre><br><br>to get the pitch the ship should be at to be facing the target and slowly adjust it's pitch until DeltaPitch equals zero. <br><br></td></tr></table><br>
<a name="508460"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> In Elite all NPC's roll first to an angle that places thier target in place so all they have to do is pitch up or down to get them in line to shoot at. They never roll along all axis its always roll first then pitch up or down.<br><br>What im trying to work out is the roll angle required to roll the ship so they are on the pitching line. <br><br></td></tr></table><br>
<a name="508461"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jeremy Alessi</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Um ... I mean you could always pitch to face a ship no matter what the roll is ... it's more yaw that would matter not roll I would think.  Still you could do a combo yaw and roll.  Use DeltaYaw and also roll the ship simultaneously so that it's roll is right side up relative to the target and then use DeltaPitch.  I wish I had ever played Elite so I could see what you're talking about because it's not making a whole lot of sense right now.  Nevertheless, DeltaYaw and DeltaPitch are your friends I'm sure. <br><br></td></tr></table><br>
<a name="508533"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> 3 Vectors:<br><br>AI Ship's forwards vector  =A<br>AI Ship's "up" vector      =B<br>Vector of line from AI Ship to AI target ship. = C<br><br>Cross product of A &amp; C should have the same direction (but not magnitude so convert the results to unit vectors) as the Cross product of B &amp; C if I am understanding you correctly when the ship has rolled to its correct position.<br><br>Vector A does not change while rolling.<br>So you want to roll the craft until the direction of the vector A x C equals the direction of the vector B x C<br><br>So:<br>Calculate A x C and convert the resulting vector to a unit vector (ie length of 1).<br><br>Calculate B x C and convert it to a unit vector as well.<br>Roll the craft and check again.<br><br>When the difference between these two resulting unit vectors is small then you have gotten pretty darn close to having the correct roll and you can then start pitching. <br><br></td></tr></table><br>
<a name="508642"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Viperfish</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> <pre class=code>
;Determine targetleaders x,y,z location relative to the enemy ship
			EntityParent TargetLeader,e\entity
			TargetX# = EntityX(TargetLeader,False)
			TargetY# = EntityY(TargetLeader,False)
			TargetZ# = EntityZ(TargetLeader,False)
			EntityParent TargetLeader,pvt
			;--------------------------
			;Calculate Steering factor. The further away an entity is the higher the factor
			SteeringFactor# = EntityDistance(TargetLeader,e\entity)/1000
			
			;--------------------------
			;Rotate z based on x position (Roll the ship so target is near vertical axis)
			If targetX &lt; -30*(SteeringFactor#-RandomFactor#) 
				If TargetY &lt; 0 ;Below and to the left, turn right
					e\roll# = e\roll# -(e\spz/TurningFactor%)
				Else
				 	e\roll# = e\roll# +(e\spz/TurningFactor%);Above and to the left, roll left
				End If
			End If
			If TargetX &gt; 30*SteeringFactor# 
				If TargetY &gt; 0;Above And To the Right, turn Right
					e\roll# = e\roll# -(e\spz/TurningFactor%)
				Else 
					e\roll# = e\roll# +(e\spz/TurningFactor%);Below and to the right, turn left
				End If
			End If
			
			;--------------------------
			;Rotate x based on y (Climb or dive to face the target only if the target is near the 
			;vertical axis). Climb is the target is behind.
			If TargetZ &lt; 0 Then 
				e\pitch# = e\pitch# - (e\spx/TurningFactor%)
			Else
				If Abs(TargetX) &lt;(100* (SteeringFactor#-RandomFactor#)) Then
					If TargetY &gt; 30*SteeringFactor# Then
						e\pitch# = e\pitch# - (e\spx/TurningFactor%)
					End If
					If TargetY &lt; -30*SteeringFactor# Then
						e\pitch# = e\pitch# + (e\spx/TurningFactor%)
					End If				
				End If
			End If
		;************* TURN AND MOVE THE SHIP  **********************************	
		
		;Rotate z based on roll position so craft flies horizontal
			If Abs(e\roll)&lt;0.1 And Abs(e\pitch)&lt;0.1 Then
				If EntityRoll(e\entity) &lt; -5 
					;e\roll# = e\roll# +(e\spz/TurningFactor%)
					TurnEntity e\entity,0,0,(e\spz/TurningFactor%)
				End If
				If EntityRoll(e\entity) &gt; 5 
					;e\roll# = e\roll# -(e\spz/TurningFactor%)
					TurnEntity e\entity,0,0,-(e\spz/TurningFactor%)
				End If	
			End If

		e\pitch = e\pitch/1.1
		e\roll = e\roll/1.1
		e\yaw = e\yaw/1.1
		TurnEntity e\entity,e\pitch#*FL\SpeedFactor,e\yaw#*FL\SpeedFactor,e\roll#*FL\SpeedFactor
		MoveEntity e\entity, 0, 0 ,e\spd*FL\SpeedFactor
		;--------------------------


</pre><br><br>This is a small snippet of code from the AI function in my current project TRAFFIKA. It is also based on Elite and is coming along fantastically well. <br>It basically rolls the ship until the target is relatively vertical then pitches until it is infront. There are many other parts to this function to speed up, slow down, dodge, etc. But, I think this is the sort of thing you were after. <br><br>You can download a working copy of the game so far at <a href="http://www.blitzcoder.com/cgi-bin/showcase/showcase_showentry.pl?id=bigjohnno03142005145609&amp;comments=no." target="_blank">http://www.blitzcoder.com/cgi-bin/showcase/showcase_showentry.pl?id=bigjohnno03142005145609&amp;comments=no.</a> It's about 40% complete and has come along way since I posted it. Check it out and let me know how you get along.<br><br>Oh, a few things to note;<br>e\entity  -  enemy entity<br>e\roll    - enemy's roll<br>e\pitch   - enemy's pitch<br>e\spx     - enemy's climb speed<br>e\spz     - enemy's pitch speed<br>e\randomfactor - random number to give each ship slightly different action. It is very noticable when groups of 5 or more are flying together.<br>e\targetleader   - distanceof a pivot infront of the target which the enemy aims at. If it aims at the target it never hits it because its moving. e\targetleader is recalculated every round by taking into acount distances and speeds. <br><br></td></tr></table><br>
<a name="508706"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> thanks will have a look :) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
