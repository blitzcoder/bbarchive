<!DOCTYPE html><html lang="en" ><head ><title >Memory Leak...need help</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Memory Leak...need help</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Memory Leak...need help</a><br><br>
<a name="453681"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >OrcSlayer</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, I've been working with Blitz for quite a while now and finally I caused a memory leak. Sadly, I created a large part of my game engine before I realised it was there. I added a counter to show me video memory usage, and as I expected the available memory drops like a rock as soon as the game fires up. At first it crashed me after a couple minutes, but now it just saps it down to five-six megs and gets really sluggish. I have no clue what could be responsible, so what I'm asking is, what is the best way to track down memory leaks? I've already checked for rampant entity creation...nothing there. Particles, projectiles, and effects rarely exist in the game for more than a second, and there is nothing else that I know of that could be a cause for this. How should I go about debugging this? Thanks in advance for any suggestions. <br><br></td></tr></table><br>
<a name="453686"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RiverRatt</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I just read something like this in blitz coder. Don't know if it will help but...<br>It says, you should always return a value from your fuctions. Even your destructor functions.<br>"By having your Destroy function return a false value when you try to pass it a null type instance, its one more clue to help you track down where things are going bad in your code. Management functions can return how many objects they've processed, and just about any routine can return a true or false based on whether the operation succeeded or not." by Kryler<br>Well thats all I got. Hope it helps. <br><br></td></tr></table><br>
<a name="453790"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >OrcSlayer</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmmm, I'll try that. Somehow I get the feeling this is going to be nasty to deal with... <br><br></td></tr></table><br>
<a name="453843"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> just track all created meshes, and make sure youre freeing them before you "re"create them. same with sounds- also, remember sounds dont get cleared at a "graphics" command.... <br><br></td></tr></table><br>
<a name="453847"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >OrcSlayer</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, ruling one thing out, I haven't implemented sounds yet...<br><br>As far as freeing entities, I'm 90% sure I do that for everything, but now that you mention it...I'll check through everything and make sure I free the meshes and sprites...I'm pretty sure I'm doing that though. Unless I accidently screwed something up and didn't notice it (wouldn't be the first time). <br><br></td></tr></table><br>
<a name="453930"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Curtastic</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> make sure you do not have any loadtexture/loadsprite/loadimage in your loop or createparticle() or anything like that. <br><br></td></tr></table><br>
<a name="453935"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hujiklo</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Not generating any invisible pivots are you? - I watched my frame rate go from 60 to 2 in the space of 30 seconds by generating non stop pivots by accident. <br><br></td></tr></table><br>
<a name="453981"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >OrcSlayer</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, some projectiles are invisible pivots, but they are freed and deleted just like the mesh and sprite ones. Odd thing is that the memory starts to drain the instant the game starts, before any projectiles/other entities have had a chance to be created anyway... <br><br></td></tr></table><br>
<a name="454178"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MSW</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Are you textureing your models/levels in code?<br><br>When loading certain 3D model files with texture links, the loadmesh() function will try to load and apply the associated textures too... <br><br></td></tr></table><br>
<a name="454181"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >IPete2</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Orc,  <br><br>The key to solving a problem of this nature is to be thoroughly logical about the search for it.  You cannot afford to mess up so start one morning fresh and clear headed, determined not to stop until you find it.  You will find it.<br><br>Here is how I would possibly approach this problem.<br><br>Set up a counter. Everywhere you create something, increment this counter.  Everywhere you delete, free, destroy something, decrement this counter.<br><br>Run the game and check that the counter is increasing conitnually.  Then you will have proved that is the problem.  Until then do not believe that this is the problem.  Before you attempt to spend a lot of time to solve a problem, you should first prove that the problem you think you have, actually exists in the area you believe it is in.<br><br>Then try one by one to turn off each system in you game.  Watch the counter carefully.  You should find the system which is causing the problem.  Then  remove the counter from everywhere else and leave it in just that system.<br><br>From the top, down remove the counter one by one to find the actual problem.<br><br>Hope this helps!<br><br>IPete2. <br><br></td></tr></table><br>
<a name="455110"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >OrcSlayer</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, setting aside today to run my search...I'll take all your advice into account and see if  I can pull this off. Thanks for all the support guys, I'll let you know how it works out. <br><br></td></tr></table><br>
<a name="455556"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >OrcSlayer</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, results are in...whatever is causing it is in the main game document (the one that contains the main loop and adds everything else with includes). The strange thing is it's almost identical to all my other former projects, and they never had this issue...<br><br>At least I have a much smaller area to search now. When I figure out what stupid mistake I made to cause it, I'll let everyone know. Thanks again for all the suggestions! <br><br></td></tr></table><br>
<a name="455560"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >OrcSlayer</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, fixed it...I feel like the worlds greatest idiot...<br><br>Somewhere towards the end of the main loop, it was running:<br><br>LoadFont("Ariel",10)<br><br>EVERY SINGLE FRAME.<br><br>No wonder 256 megs of available memory got sapped down to nothing in a couple minutes.<br><br>Somehow I feared this would turn out to be the result of a really stupid mistake...*sigh* <br><br></td></tr></table><br>
<a name="455585"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh dear. :) <br><br></td></tr></table><br>
<a name="455795"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >OrcSlayer</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> I could have sworn I put that before the main loop...then again it was six AM when I wrote that if I remember correctly...ick. <br><br></td></tr></table><br>
<a name="455803"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >aab</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> l O l<br>My friend done that two weeks ago! <br><br></td></tr></table><br>
<a name="455835"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >OrcSlayer</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> The moral of this story: Drink plenty of caffine if you want to risk writing code early in the morning. If I was on a caffine high I doubt this would have happened :-P <br><br></td></tr></table><br>
<a name="456060"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Anyway, well done for having the balls to admit to this gaff. This kind of thing happens to everyone, at some point. :) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
