<!DOCTYPE html><html lang="en" ><head ><title >Cel-Shading in Blitz3D</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Cel-Shading in Blitz3D</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Cel-Shading in Blitz3D</a><br><br>
<a name="376837"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gun Ecstasy</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is this possible? <br><br></td></tr></table><br>
<a name="376843"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dock</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yep, and have been used numerous times in blitz 3D :)<br><br><a href="http://www.blitzbasic.com/Community/posts.php?topic=30801" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=30801</a><br><br>I'm curious as to how they would be implemented more accurately with cube-mapping though, since we now have that and people are familiar with it. <br><br></td></tr></table><br>
<a name="376883"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Cube mapping, unlike sphere mapping is a mapping which depends on world space, rather than camera space.  So as the camera moves around you view the cube mapping form different angles, whereas you do not view a sphere map from different angles.  The sphere map thus appears to move with the camera.<br><br>As the sphere map contains your light source, whose direction is implicitly encoded into the texture, if it moves with the camera, then the light source appears to move with the camera.<br><br>Cube mapping does not have this problem.  If the left face of the cube map has the light source, then when the camera moves around, the light source will always appear to come from the west, regardless of which direction the camera looks at the object from.<br><br>You can generate a cube map by making a vertical 1D texture of light from light to dark, with different bands of color rather than a smooth gradient and then applying this to a sphere mesh rotated so that it's north pole points down the negative Z axis.  Then you flip it inside out, and make it fullbright.  Then you rotate the entity to aim your light source, just as you would a directional light, scale it up, and place your camera inside the sphere facing down positive Z, and render a cube map from inside.<br><br>That cube map now will look like cel shading when applied to an object, with a light source coming a directional light.<br><br>Making point light sources is more diffiuclt and requires re-rendering the map for every object as it changes position relative to the light. <br><br></td></tr></table><br>
<a name="376887"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ashmantle</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Please, please, please don't just make another "black-outline-and-therefore-cel-shading" game.. <br><br></td></tr></table><br>
<a name="376983"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Warren</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think he can do whatever he wants if he actually ships. <br><br></td></tr></table><br>
<a name="376988"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Cel Shading has nothing to do with Cel Outlining.  Shading means changing brightness. <br><br></td></tr></table><br>
<a name="377008"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dock</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's the shading which I'm most interested in capturing.  <br><br>Thanks for the detailed explanation Shawn, that definitely helps a lot and I'll be sure to give that a shot with my next project.  Is there any examples of this already?  It makes sense that the cube map would be limited to directional lights, but I can definitely cope with that restriction. Thanks again. ^_^ <br><br></td></tr></table><br>
<a name="377034"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gun Ecstasy</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> That's pretty clever or an outline. Load the mesh with textures, then load the mesh again without textures, change color to black, flip, the scale. Pretty damn clever.<br><br>But an outline has nothing to do with Cel-Shading. Cel-Shading requires vast knowledge of normals, lighting, shading, and some other stuff. <br><br></td></tr></table><br>
<a name="377181"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JaviCervera</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> You don't have to scale the mesh, it will look ugly. You have to EXTRUDE the mesh, which is move every vertex in the direction it is facing. If i remeber right, there was a code snippet to do it. <br><br></td></tr></table><br>
<a name="377500"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jhocking</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the explanation sswift.  I have no immediate plans to do a game with cel shading, but I think I'll try what you described to play with cel shading using cube mapping. <br><br></td></tr></table><br>
<a name="377948"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gun Ecstasy</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> "You don't have to scale the mesh, it will look ugly. You have to EXTRUDE the mesh, which is move every vertex in the direction it is facing. If i remeber right, there was a code snippet to do it."<br><br>Would that not be exactly the same as scaling? If that's not what blitz's scaling does then there must be something wrong with it. <br><br></td></tr></table><br>
<a name="377957"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Warren</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> If the mesh is convex, scaling is the same as extruding.  <br><br>Otherwise, no. <br><br></td></tr></table><br>
<a name="377995"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jhocking</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Extruding is not the same thing as scaling.  It's complicated to explain the difference (they are similar) so just trust us all that he is correct, what you would want to do is extrude the mesh and not simply scale it.<br><br>Oh, and thus Blitz's scaling works perfectly, it's just that scaling is not what you'd want in this situation. <br><br></td></tr></table><br>
<a name="378006"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Warren</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry, to amend my post ... If the mesh is convex and the origin is in the exact center, scaling is the same as extruding.<br><br>Any other situation, and they are very different things. <br><br></td></tr></table><br>
<a name="378022"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AntonyWells</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Not that I've really ever tried cel shading, but if you want to extude a tri in the direction it's facing, no matter what type of mesh it is, do this.<br><br><pre class=code>
function extrude(mesh,extrude#=1)
local vp[3]
     for j=0 to countSurfaces(mesh)
          srf=getSurface(mesh,j)
          for k=0 to countTriangles(srf)-1
               v0=triangleVertex(srf,k,0)
               v1=trianglevertex(srf,k,1)
               v2=trianglevertex(Srf,k,2)
               triNrom(vertexX(srf,v0),vertexy(srf,v0),vertexz(srf,v0),vertexx(srf,v1),vertexy(srf,v1),vertexz(srf,v1),vertexz(srf,v2),vertexy(srf,v2),vertexnz(srf,v2))
               for v=0 to 2
                   vert=triangleVertex(srf,v)
                   vertexcoords srf,vertexX(srf,vert)+triNX*extrude,vertexY(srf,vert)+triNY*extrude,vertexZ(srf,vert)+triNZ*extrude
               next
          next
     next
endfunction

global triNX,triNY,triNZ
Function TriNorm(x1#, y1#, z1#, x2#, y2#, z2#, x3#, y3#, z3#)
    ux#= x1# - x2#
    uy#= y1# - y2#
    uz#= z1# - z2#
    vx#= x3# - x2#
    vy#= y3# - y2#
    vz#= z3# - z2#	
    nx#= (uy# * vz#) - (vy# * uz#)
    ny#= (uz# * vx#) - (vz# * ux#)  
    nz#= (ux# * vy#) - (vx# * uy#)
    nl#= Sqr((nx*nx) + (ny*ny) + (nz*nz))  
    If NormLen &gt; 0
		nx = nx/NL 
            ny = ny/NL
            nz = nz/NL
	Else
		nx = 0 : ny = 0 : nz = 1
	EndIf
	TriNX = nx
	TriNY = ny
	TriNZ = nz
End Function
</pre><br><br>extrude =scale of extrud..err...extrudation..(cough). Go well below 1 or you'll just create one funky looking mesh.<br><br><br><br>(Not tested..so use at your own caution...;) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
