<!DOCTYPE html><html lang="en" ><head ><title >How to get current Disk Space Free?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >How to get current Disk Space Free?</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >How to get current Disk Space Free?</a><br><br>
<a name="1130497"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Danny</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I want to check if there's enough disk space on a given volume before saving an amount of data. But haven't got a clue to do this :)<br><br>I found a BMax reference here, but don't know how/if this can be done in B3D. <a href="http://www.blitzbasic.com/Community/posts.php?topic=64341" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=64341</a><br><br>Is uses kernal32's:<br><pre class=code>GetDiskFreeSpaceEx:Long( WindowText$z, FreeBytesToCaller:Long Ptr, TotalBytes:Long Ptr, TotalFree:Long Ptr ) = "GetDiskFreeSpaceExA@16"</pre><br><br><br>Cheers,<br>Danny. <br><br></td></tr></table><br>
<a name="1130523"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> The proper documentation for the function is here: <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa364937%28v=vs.85%29.aspx" target="_blank">http://msdn.microsoft.com/en-us/library/windows/desktop/aa364937%28v=vs.85%29.aspx</a><br><br>There's also this related function (which is probably not what you want, but let's mention it anyway): <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa364935%28v=vs.85%29.aspx" target="_blank">http://msdn.microsoft.com/en-us/library/windows/desktop/aa364935%28v=vs.85%29.aspx</a><br><br>Note that the first of these is not declared in the Kernel32 code archives userlib, and the second one is declared incorrectly (awesome going, guys!). Um. The correct userlib declaration for the function GetDiskFreeSpaceEx is as follows:<br><br><pre class=code>.lib "Kernel32.dll"

API_GetDiskFreeSpaceEx%(lpDirectoryName$, lpFreeBytesAvailable*, lpTotalNumberOfBytes*, lpTotalNumberOfFreeBytes*) : "GetDiskFreeSpaceExA"</pre><br><br>The first parameter should be the path to check, and the other three should be the handles to banks (or pointers to objects) of at least eight bytes in length. These will receive the space data in three separate long-integers (note that the long integer data type is <i>not</i> natively supported by B3D - you'll have to find a way to decode this).<br><br>The function's main return value is a success/fail indicator.<br><br><br>A (possibly accurate) example of how to wrap this in a simpler-to-use function might look something like this:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">Print GetFreeSpace("C:\Documents and Settings\person\My Documents\")

WaitKey
End


Type LongInt
	Field a, b
End Type

Global GFS_out_FABytes.LongInt, GFS_out_TotBytes.LongInt, GFS_out_TFBytes.LongInt

Function GetFreeSpace(path$)
	If GFS_out_FABytes = Null Then GFS_out_FABytes = New LongInt
	If GFS_out_TotBytes = Null Then GFS_out_TotBytes = New LongInt
	If GFS_out_TFBytes = Null Then GFS_out_TFBytes = New LongInt
	
	If API_GetDiskFreeSpaceEx(path, GFS_out_FABytes, GFS_out_TotBytes, GFS_out_TFBytes)
		Return GFS_out_FABytes\a	;Truncated! Process this value *properly* for real use
	Else
		Return 0
	EndIf
End Function</textarea><br><br>Note however:<br><br>The value returned by this example is <i>unusable</i>, because the number of bytes of free space on a modern hard disk will rarely fit into a Blitz-style short integer (which overflows at 4.2 billion) - that's why this function returns the data into LongInts. You'll need some way to use the massive values it returns without putting them into Blitz ints (perhaps you could shift it right a few points and use the free space rounded to the nearest megabyte?).<br><br>Also, I make no guarantee that this example is the right way to go about this anyway, 'cause I'm an idiot and I've never used this before. <br><br></td></tr></table><br>
<a name="1130546"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Danny</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Excellent! Thanks for your time and explanation Yasha. Yes I noticed those long integers and they gave me the shivers :)<br><br>By the way, I didn't see that trick before using types in stead of banks to get values back like that, nice one!<br><br>In my situation I only need to know if there's, for example 2 Or 3 megabytes free before writing a file to disk. So this solution will surely suffice!<br><br>Thanks!<br><br>Danny <br><br></td></tr></table><br>
<a name="1130580"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I only need to know if there's, for example 2 Or 3 megabytes free <br></div><br><br>In that case you probably don't need to bother with trying to do maths on the Long value. You can instead do simpler checks on the int components:<br><br>-- if \b is nonzero, there are more than 4.2 GBs free. Yay.<br>-- if \b is zero but \a is negative, there are more than 2.1 GBs free. Yay.<br>-- if neither of those, the value in \a can be checked as a regular Blitz int.<br><br>I know it's not great practice to assume things about byte order and word sizes, but Blitz3D ain't likely to change any time soon (besides, too much existing code depends on things staying as they are). <br><br></td></tr></table><br>
<a name="1130587"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Adam Novagen</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I would suggest coding an extremely simple DLL which takes the long integer directly from <b>API_GetFreeDiskSpaceEx%()</b>, splits it into two integers using something like the following Blitz code:<br><br><pre class=code>Global LongHigh,LongLow

LongHigh = (FreeSpace("C:\") And %1111111111111111111111111111111100000000000000000000000000000000) Shr 32
LongLow = FreeSpace("C:\") And %0000000000000000000000000000000011111111111111111111111111111111</pre><br>then just returns the two integers for use. Having never attempted a Blitz3D DLL in my life, though, I have no idea how easy this would be to put into practice. Might be a worthwhile experiment for me! <br><br></td></tr></table><br>
<a name="1131650"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Danny</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> If I had the skills, I would make a dll for it, but unfortunately I don't.<br><br>I've added the function to the code archives. <br><br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=2934" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=2934</a><br><br>Thanks for helping out!<br><br>Danny. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
