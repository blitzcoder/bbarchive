<!DOCTYPE html><html lang="en" ><head ><title >Keyboard handling of held keys</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Keyboard handling of held keys</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Keyboard handling of held keys</a><br><br>
<a name="789612"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_33</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> OK this will require a little reflection.  I've been working on my terminal emulation for quite some time and am getting in the polishing phase.  I've prepared code for handling key repeating if a key is held.  But, here's the issue:<br><br>I get my keys from GetKey().  This works really well for 99.9% of my needs.  But, as soon as I wanted to figure out if a key is held down, from the GetKey() back to a KeyDown(), I stumbled upon a big issue.<br><br>GetKey() returns ascii values and in that regards, it doesn't have any idea where the key is placed on the keyboard.  On the other hand, KeyDown() is exactly the location of the key on the keyboard.  As we all know, keyboards come in all shapes and form, from various countries around the world.  A Russian, french, English, north american, etc. keyboard is all unique to each other, which GetKey() doesn't care about.  Yet, when you want to code something about key auto repeat, you can't place the ascii code to the key instantly, as scancodes vary from each keyboard layout.<br><br>If anyone has answers as to how I could read the auto repeat from the keyboard controller, or if I could get that from a win api, that would be of great help!<br><br>Cheers. <br><br></td></tr></table><br>
<a name="789775"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> We recently discussed this here, try to seek "key repeat". I am using a key repeat emulation, based on millisecs, getkey and keydown, this works nicely. Haven't got the source on this machine, sorry.<br><br>Simplify the implemetation by wrapping the whole thing in a function like "myGetKey()" that will return ANY key, including keyrepeat, backspace, del etc. with their ascii values. <br><br></td></tr></table><br>
<a name="789804"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_33</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> We recently discussed this here <br></div><br><br>I doubt!<br><br>Is your suggestion good only for north american type keyboards, or is it also international?  Are you sure you understand the issue I stated?<br><br>Z on QWERTY, QWERTZ and AZERTY are all different scancodes in a KeyDown(), for example.<br><br><a href="http://www.microsoft.com/globaldev/reference/keyboards.mspx" target="_blank">http://www.microsoft.com/globaldev/reference/keyboards.mspx</a><br><br>I'll look into User32...  Some people have found keyboard handling stuff in there. <br><br></td></tr></table><br>
<a name="789835"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mr.Waterlily</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> The discussion we had about this is located here:<br><br><a href="http://www.blitzbasic.com/Community/posts.php?topic=68624" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=68624</a><br><br>There´s some code there I made with the tips I got from jfk EO-11110 for you to try out. <br><br></td></tr></table><br>
<a name="789869"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_33</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks!  I haven't found that one from my search.  I guess, I could support SOME keys at least.<br><br>Cheers. <br><br></td></tr></table><br>
<a name="789894"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SLotman</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> You would be better off using the getasynckeystate from windows api if you plan to use diferent keyboard layouts.<br><br>Just use the API call and the VK_ codes and it should work everywhere. <br><br></td></tr></table><br>
<a name="789897"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_33</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> \o/<br>Thanks! <br><br></td></tr></table><br>
<a name="789933"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_33</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> OK, got this sample code, should work on all keyboards around, some keys won't repeat, but they are not really useful to repeat.<br><br><pre class=code>Dim scancodes(256)
For i = 0 To 255
   scancodes(i) = api_OemKeyScan(i) And $ff
Next
repeat_delay = 500
repeat_rate = 100
Print "TYPE HERE:"
While Not KeyDown(1)
   timer = MilliSecs()
   ascii% = GetKey()
   If ascii &gt; 0 Then
      ascii_repeat = ascii
      scancode% = scancodes(ascii)
      repeat_timer = timer + repeat_delay
      Write Chr$(ascii)
   EndIf
   If KeyDown(scancode) = True Then
      If timer &gt;= repeat_timer Then
         Write Chr$(ascii_repeat)
         repeat_timer = timer + repeat_rate
      EndIf
   Else
      scancode = 0
   EndIf
Wend</pre><br><br>Just make sure you have api_OemKeyScan in your DECLS (user32.DLL) <br><br></td></tr></table><br>
<a name="790157"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey _33, thanks for that. Can you give me the decls line too (parameters etc.)?<br>How doesn it work, will this return any keyhits, or only the keyhits when your blitz app has focus?<br><br>The solution I suggested and Mr.Waterlily worked out is of course only a hack to make something useful out of the really limited GetKey and Keydown (although it supports country keys!), but at least this works with older versions of Blitz3D too. <br><br></td></tr></table><br>
<a name="790174"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_33</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Make sure this is in user32.DECLS :<br><pre class=code>api_OemKeyScan% (wOemChar%) : "OemKeyScan" </pre><br><br>It returns the scancode from an ascii code corresponding to the application that is running, and it is based on the windows system that determined the keyboard layout in the first place, and it is specially for the applic ation running (from my understanding of the MSDN info).  So it is as reliable as windows, in a way. LOL!<br><br>But this code should work on all Blitz3D versions, and OemKeyScan should be in all versions of windows from Win95 and up (I hope).  I'm taking a slight chance thoe, but I have a good feeling on this.<br><br>The worst that could happen IMHO is that the key won't repeat.  What I noticed, is that most keys that won't repeat are keys that are of character code greater than 127, such as éèä£ù³ÌýÃæ×® ...  I don't think I can do anything about that, and I don't think it really is a big issue. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
