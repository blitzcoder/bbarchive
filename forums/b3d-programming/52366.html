<!DOCTYPE html><html lang="en" ><head ><title >Blitzsys File Requester</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Blitzsys File Requester</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Blitzsys File Requester</a><br><br>
<a name="584535"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoeGr</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've been using Rob Hutchinson's blitzsys dll with an app I'm making to bring up a Windows file requester. It works very well, but does anyone know how I might:<br><br>1) Make the file requester appear initially at coordinates other than the very top left corner of the screen (which looks a bit messy)?<br><br>2) Ensure that the file requester maintains the focus until the user either chooses a file or closes the window?<br><br>I suspect that if I could just get the relevant window handle I could figure out how to do these things using WinAPI commands. Any suggestions?<br><br>Thanks <br><br></td></tr></table><br>
<a name="584613"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> No, I can't do it either, and it is so annoying!<br><br>Yes please, can anyone help? <br><br></td></tr></table><br>
<a name="584973"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I guess the filerequest window has a HWND handle. If it has one, you only have to find it and then position the window using the Api Calls. Although not sure how to find its HWND. GetActiveWindow may work, but probably it isn't very save. <br><br></td></tr></table><br>
<a name="584988"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >solitaire</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> After opening the filerequester the programm stopps,<br>so it isn't possible to get the handle.<br>But if you able to use API, it is a better way to use<br>the API to open a filerequester. <br><br></td></tr></table><br>
<a name="585244"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> "it is a better way to use the API to open a filerequester. "<br>Any clues how to do this? <br><br></td></tr></table><br>
<a name="585266"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoeGr</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Solitaire is quite right - the program is 'paused' until a file is selected or the file requester window is closed, and this seems to be the main obstacle to getting the required window handle. As for using WinAPI commands directly, I can deal with the easy ones but the GetOpenFileName function requires "an OPENFILENAME structure that contains information used to initialize the dialog box." (MSDN) which I'm pretty sure I don't have enough experience to create. Might it possible to modify the blitzsys.bb include or the dll itself slightly so that coordinates are specified for the window?<br><br>I did find this:<br><br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=916" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=916</a><br><br>but I haven't tested it yet. To be honest I would rather use blitzsys if at all possible as its simple and it works. I just wish it could do these two extra little things. <br><br></td></tr></table><br>
<a name="585361"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've given it a quick try.<br>It's fine but no different from the BlitzSys function.<br><br>It's still not possible to get a window handle, and it _is_ still possible to click the parent window to be on top of the Dialog - which to me is the real problem. <br><br></td></tr></table><br>
<a name="585842"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> did you try GetActiveWindow right after opening the box? Using WinwowPos you should be able to force it alwaysontop. Of course, only when the req box is running parallely with the blitz app and won't pause it. <br><br></td></tr></table><br>
<a name="585852"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BlackD</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> The only way to do what you're describing is to write a DLL which as such launches a different process which will handle the file request, positioning, and focus of the window, so you can simply program your software to wait for the returned file from the DLL. <br><br>If you don't know C++ then you're in trouble. :\<br><br>+BlackD <br><br></td></tr></table><br>
<a name="585929"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> jfk, the call is effectively a one-liner:<br>pseudo: 'result = Fileselect()'<br>so there is no chance (in Blitz) of interaction.<br>BlackD is right.<br><br>But we're open to any other ideas. <br><br></td></tr></table><br>
<a name="585999"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoeGr</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think I might have found a way round. It may be impossible to get the file requester's window handle, but its possible to disable the main application window immediately before calling the requester with <br><br><pre class=code>AppHWND=SystemProperty("AppHWND")
api_EnableWindow(AppHWND,False)</pre><br>which as far as I can tell amounts to the same thing as forcing the file requester to be on top. There is a small problem though. I expected to be able to re-enable the main window with<br><br><pre class=code>api_EnableWindow(AppHWND,True)</pre><br>but strangely, using this code seems to stop the window being disabled in the first place.<br><br>EDIT: You can still click on the application's taskbar entry to bring it to the front, so this isn't quite perfect. <br><br></td></tr></table><br>
<a name="586141"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoeGr</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Regarding what I said there about<br><pre class=code>api_EnableWindow(AppHWND,True)</pre>screwing things up, it does cause me problems when I use it with the archive code that I linked to above but it works as it should with blitzsys. Try the following.<br><br><pre class=code>AppHWND=SystemProperty("AppHWND")
api_EnableWindow(AppHWND,False)

path$=DLLGetOpenFileName$() ;Fill in parameters

api_SetForegroundWindow(AppHWND)
api_EnableWindow(AppHWND,True)</pre>This still has its flaws but at least it stops the user bringing the Blitz app back in front of the file requester by clicking in its window. <br><br></td></tr></table><br>
<a name="586278"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Joe, absolutely brilliant!<br>We've needed this for so long.<br><br>I implemented it completely through my app in 5 minutes, and it works perfectly.<br><br>Can I suggest that you add this to the code archives. <br><br></td></tr></table><br>
<a name="586399"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoeGr</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks John, glad to be of help. I'd like to improve this further if possible before adding it to the archives though. <br><br></td></tr></table><br>
<a name="586584"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Slightly off the topic, I've just found an added bonus use of api_SetForegroundWindow:<br><pre class=code>
apptitlename$ = "Help"
handlewinhlp% = api_FindWindow(0,apptitlename$) 
If handlewinhlp%=0
 ExecFile("help\help.chm")
Else
 api_SetForegroundWindow(handlewinhlp%) 
EndIf
</pre><br>i.e. If the help file is already running but hidden by the main window, when I click my help button it jumps the help file back on top of the main window. Hee-hee. <br><br></td></tr></table><br>
<a name="587568"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoeGr</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> I finally discovered how to do this properly! All it needed in the end was a simple adjustment to MPZ's code from the code archives.<br><br>First, get MPZ's code here:<br><br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=916" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=916</a><br><br>Add the line<br><pre class=code>Global hWnd=SystemProperty("AppHWND")</pre>just after the Graphics command. Then in the getOpenFile$() and getSaveFile$() functions, change<br><pre class=code>hwndOwner=0</pre>to<br><pre class=code>hwndOwner=hWnd</pre>That's it. A proper Windows file requester which appears at the top left of the app's client area instead of the top left of the screen, and which maintains its focus. Woohoo!<br><br>Note: Be sure to use the 'updated' getOpenFile$() function found a little way down the code archive thread. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
