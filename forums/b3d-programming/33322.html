<!DOCTYPE html><html lang="en" ><head ><title >Realtime vertex lighting?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Realtime vertex lighting?</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Realtime vertex lighting?</a><br><br>
<a name="358971"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Isaac P</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is it possible in blitz?<br><br>And if so could someone suggest some code reference.. either in blitz or other.<br><br>I contacted a maker of one of my favourite games atm and wanted to try implementing the same lighting.<br><br>Here is the response i got:<br><br>Lighting is done by controlling the RGB value for each polygon. You have to compare <br>each vertice of each poly to every light source and increase the RGB an amount <br>based on the distance from that light source.<br><br>You can also use the reverse of that system where you set all RGBs to max and then <br>darken them where there are no light sources. <br><br><br><br>I looked at the code archives and this seems exactly what robs maths lights example does.. <br><br></td></tr></table><br>
<a name="359090"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bot Builder</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Um, yeah. Sounds like a dx point light to me. otherwise, you could use your own code. <br><br></td></tr></table><br>
<a name="359606"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Isaac P</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Any ideas on this?<br><br>The game im talking about is www.xenimus.com  It has a free trial if u wish to see what i mean. <br><br>I want to implement this code in my dungeon questing game <br><br></td></tr></table><br>
<a name="359693"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slave_of_time</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> hmmm...something like that?<br><br>EntityFX Mesh,2<br>light=createpivot()<br><br><br>Function UpdateLight(mesh,light)<br><br>	surf_nr = CountSurfaces(mesh)<br>	For i = 1 To surf_nr<br>		surf = GetSurface(mesh,i)<br>		vert_nr = CountVertices(surf)-1<br>		For z = 0 To vert_nr<br>			<br>		;Code...	<br> 			<br>		VertexColor surf,z,red,grn,blu					<br>		Next<br>	Next<br>	<br>End Function <br><br></td></tr></table><br>
<a name="359697"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jhocking</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> "each vertice of each poly"<br><br>The word is VERTEX!  Sorry, that's a hangup of mine.<br><br>I'm not sure what you're asking for here.  I must be reading your post wrong because to me it sounds like you are describing a regular ole point light ie. CreateLight(2) <br><br></td></tr></table><br>
<a name="359727"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Isaac P</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I know thats why i used vertex in the title of the post... It was the creator of the game that sent an email that i included in my post, so it is indeed him who made the mistake.<br><br>A point light is exactly what i want to use.. but i know for a fact there will be times when i will need more than 8 lights.  So i was wondering the implementation of such a system, using vertex colours.<br><br>Thanks for your help all of you... Im still unsure as to which system Ill use, A directx lights based system which dynaically creates and culls lights.. or this vertex colour system. <br><br>Will have to knock up some speed tests to check <br><br></td></tr></table><br>
<a name="359821"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Miracle</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Also:<br><br><a href="http://www.blitzbasic.com/b3ddocs/command.php?name=LightMesh&amp;ref=3d_cat" target="_blank">http://www.blitzbasic.com/b3ddocs/command.php?name=LightMesh&amp;ref=3d_cat</a><br><br>:D <br><br></td></tr></table><br>
<a name="360140"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Neochrome</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Does Lightmesh slow things down? i mean is, DX only lets you use 8 at anyone time, does LightMesh have a limit? <br><br></td></tr></table><br>
<a name="360316"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Miracle</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I haven't tested it for speed, but I understand there's no limit. Of course, you have to do a LightMesh on every mesh that's affected by a "light", so that could slow things down a little and make for some complicated code if you have several objects, especially moving ones. <br><br></td></tr></table><br>
<a name="360431"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Neochrome</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> i dont realy understand LightMesh, either its not explained very well or more likely i just simply dont understand, has anyone here got away to explain it in more, (idiot proof?) hehe <br><br></td></tr></table><br>
<a name="360462"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Use a function to color all vertices black, then use lightmesh.  Only do it before a render.<br><br>For even faster lighting, just make all the vertices one uniform color.  This should be an option in your game menu. <br><br></td></tr></table><br>
<a name="360581"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Isaac P</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Halo you got any ideas for having maybe 10-15 fake lights in the seen merely lighting verts.. its for a top down dungeon crawl game where i want torches to illuminate the dungeons <br><br></td></tr></table><br>
<a name="360609"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah, first do a distance check, and don't light the mesh if it is out of range.<br><br>Second, just calculate the distance between the light and mesh for the light intensity.  Don't check distance for every vertex.<br><br>Finally, take the crossproduct of the normal of the vertex and the vector between the mesh and the light, and multiply that by the distance intensity from step 2 to get the color for each vertex.<br><br>This is the method I am using in my engine, and it's very fast. <br><br></td></tr></table><br>
<a name="360619"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Picklesworth</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> hey, thanks for that halo. I think I'll try this soon so I can play about with proper math stuff. <br><br></td></tr></table><br>
<a name="361151"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Isaac P</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks halo... will have a try to implement what you said, sounds very technical but if i manage to understand what everything is I'll throw together a demo and see how fast it is.<br><br>Thankyou :) <br><br></td></tr></table><br>
<a name="361253"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> This has a recursive and a smooth lighting option.  The smooth lighting will keep your vertices from harshly flashing from one color to another.  This function doesn't account for range, right now:<br><br>Function LightMesh_(mesh,r,g,b,range#=0,x#=0,y#=0,z#=0,smooth=0,rec=0)<br>If EntityClass(mesh)="Mesh"<br>	Normalize x,y,z<br>	dx#=VectorX()<br>	dy#=VectorY()<br>	dz#=VectorZ()<br>	For s=1 To CountSurfaces(mesh)<br>		surf=GetSurface(mesh,s)<br>		For v=0 To CountVertices(surf)-1<br>			intensity#=DotProduct(dx,dy,dz,VertexNX(surf,v),VertexNY(surf,v),VertexNZ(surf,v))<br>			If intensity&gt;0<br>				If intensity&gt;1 intensity=1<br>				vr=VertexRed(surf,v)<br>				vg=VertexGreen(surf,v)<br>				vb=VertexBlue(surf,v)<br>				If smooth<br>					If vr&lt;r<br>						vr=vr+smooth<br>						If vr&gt;r*intensity vr=r*intensity<br>						EndIf<br>					If vg&lt;g<br>						vg=vg+smooth<br>						If vg&gt;g*intensity vg=g*intensity<br>						EndIf<br>					If vb&lt;b<br>						vb=vb+smooth<br>						If vb&gt;b*intensity vb=b*intensity<br>						EndIf<br>					If vr&lt;AMBIENTRED vr=AMBIENTRED<br>					If vg&lt;AMBIENTGREEN vg=AMBIENTGREEN<br>					If vb&lt;AMBIENTBLUE vb=AMBIENTBLUE<br>					Else<br>					vr=vr+r*intensity<br>					vg=vg+g*intensity<br>					vb=vb+b*intensity<br>					If vr&gt;255 vr=255<br>					If vg&gt;255 vg=255<br>					If vb&gt;255 vb=255<br>					EndIf<br>				VertexTexCoords surf,v,vr/255.0,vg/255.0,0,1<br>				VertexColor surf,v,vr,vg,vb,vb/255.0<br>				EndIf<br>			Next	<br>		Next<br>	EndIf<br>If rec<br>	For c=1 To CountChildren(mesh)<br>		TFormVector x,y,z,mesh,GetChild(mesh,c)<br>		LightMesh_(GetChild(mesh,c),r,g,b,range#,TFormedX(),TFormedY(),TFormedZ(),smooth,1)<br>		Next<br>	EndIf<br>End Function <br><br></td></tr></table><br>
<a name="361255"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> And then use this to darken it each lighting cycle.  I would use a darken smooth value of about 20, and a liting smooth value of like 40.  So this function would be like "MeshColor mesh,-20,-20,-20,true,true":<br><br>Function MeshColor(mesh,r,g,b,change=False,rec=0)<br>If EntityClass(mesh)="Mesh"<br>	For s=1 To CountSurfaces(mesh)<br>		surf=GetSurface(mesh,s)<br>		For v=0 To CountVertices(surf)-1<br>			If change<br>				vr=VertexRed(surf,v)+r<br>				vg=VertexGreen(surf,v)+g<br>				vb=VertexBlue(surf,v)+b<br>				If vr&lt;AMBIENTRED vr=AMBIENTRED<br>				If vg&lt;AMBIENTGREEN vg=AMBIENTGREEN<br>				If vb&lt;AMBIENTBLUE vb=AMBIENTBLUE<br>				If vr&gt;255 vr=255<br>				If vg&gt;255 vg=255<br>				If vb&gt;255 vb=255			<br>				VertexColor surf,v,vr,vg,vb<br>				;VertexTexCoords surf,v,(vr+r)/255.0,(vg+g)/255.0,0,1<br>				;VertexColor surf,v,vr,vg,vb,(vb+b)/255.0<br>				Else<br>				VertexColor surf,v,r,g,b<br>				EndIf<br>			Next	<br>		Next<br>	EndIf<br>If rec<br>	For c=1 To CountChildren(mesh)<br>		MeshColor GetChild(mesh,c),r,g,b,change,True<br>		Next<br>	EndIf<br>End Function <br><br></td></tr></table><br>
<a name="361344"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Isaac P</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks halo its as if you knew of my headache .. :)<br><br>one quick question<br><br>Function LightMesh_(mesh,r,g,b,range#=0,x#=0,y#=0,z#=0,smooth=0,rec=0) <br><br>x,y,z is for the position of the light right? what is range for? and rec? <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
