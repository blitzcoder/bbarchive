<!DOCTYPE html><html lang="en" ><head ><title >Need assistance: Geometric shadows</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Need assistance: Geometric shadows</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Need assistance: Geometric shadows</a><br><br>
<a name="339133"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ChrML</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> For characters and highpoly shadowcasting elements, I will use shadow textures (rendered from light's perspective, etc...), but for 4-poly objects that casts shadows, I will use geometric shadows. One problem is there (a BIG problem). Here's how it have to look for geometric shadows to work:<br><br><img src="http://brainsoft.hostxg.net/shadow.JPG"><br><br>The four vertexes in the shadowcasting, 4-poly object is no problem (that's just to shoot out 4 pivots, and see where they collide). The problem are the vertexes inside those 4 polies, which must be duplicated, and then created triangles between in the same way as the mesh the shadow land on is, so it can be colored black, and then be given an alpha value of 0.5 or something. Any good suggestion on how to get that part working? <br><br></td></tr></table><br>
<a name="339256"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rob</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> A cube is likely to be 8 verts, so it may actually be quicker to deform a real mesh copy flat. <br><br></td></tr></table><br>
<a name="339277"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ruz</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> ChrML hope you make a great new shadow system, that would be fantastic.<br>good luck mate <br><br></td></tr></table><br>
<a name="339389"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AntonyWells</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> The problem with that is when your projected mesh goes over uneven surfaces. There's not enough verts/polys to hug the surface correctly so it ends up looking very odd. And you get a lot of z fighting amoung the projected meshes polys resulting in mad flickering.<br><br>At least it did for me(On both counts) ;)<br><br>Blitz really needs a good/fast shadow system... Swwifts relies too much on texture writing which is just a frame-rate killer on a lot of old(Pre-g2) cards. <br><br></td></tr></table><br>
<a name="339439"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rob</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> As far as I'm concerned, only two things are really missing from blitz:<br><br>fast shadows<br>occlusion<br><br>Those two can really help forward projects. As for pixel shaders, well I'm pretty sure they are out of the question until bmx cos thats a dx8/9/thingy re-write isn't it? <br><br></td></tr></table><br>
<a name="339441"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AntonyWells</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I agree, occlusion is even more important than Shadows. To the point where we were forced to do our own gl engine for our next game.<br><br>Our test level(40,000 polys ran at over 380fps in our gl engine on a G4. Around 30fps in blitz's!<br>So I'm personally glad Mark's taking the time to do a new engine for bmax... As long as he does it right rather than simplified and slow as a result of that. <br><br></td></tr></table><br>
<a name="339518"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RetroBooster</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Otacon, don't take this as a personal insult, but if you can't write an occlusion system for a 40K poly level in blitz, should you realy be writing an OpenGL engine? (I mean OpenGL is a bit more complex then blitz as you should know) The reasons I would start writing an OpenGL engine would definately not be occlusion, but rather high level shaders, stencil buffer access, render to texture and the ability to use an object oriented programming language for development. (not to state that blitz isn't a great language on it's own)<br><br>After the completion of the engine and games we (Shattered Reality and myself) are currently working on, we will probably have to decide between C++ and DirectX/OpenGL or blitzmax as our new platform. <br><br></td></tr></table><br>
<a name="339537"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AntonyWells</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> It wasn't a case of many objects making up 40k. We had one surface per unique texture type. So each surface/mesh was pretty much viewable from anywhere.<br>So what blitz needs is something like BSP(In rendering terms, not bsp the format) that very quickly generates a list of 'viewable' polys on the fly, regardless of surface.<br><br>I did write something that generates a list of viewable polys from any point in 3d space, but without lower-level access to rendering it meant having to reconstruct unique surfaces on the fly...<br>And don't take this as an insult, if you think you can do it any other way, I'll need to see it before I believe it.<br><br>But anyway, in GL we didn't even use occlusion and got speeds that high. Other reason was for our custom fx system using vertex/pixel shaders called Fx skins.<br>And GL isn't complex.. Compared to DX it's a breeze. <br><br></td></tr></table><br>
<a name="339597"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tom</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> chrML, I've briefly looked at this method of projecting geometry, and come to the conclusion it would take too much CPU time to get them looking right.<br><br>Even if you were to project a cubes geometry to a wall &amp; floor, you'd have to do some CSG operations to see if a Tri overlapped both the floor and the wall, and slice it up appropriately, then project the new Tris geometry. This would be needed to have shadow geometry 'hugging' scenery correctly. Too much math I think.<br><br>Why not stick with the shadow mapping?<br><br>I'm still working on my own shadows using this method, for now I'm concentrating on what I think is most important, which is good looking shadows from characters onto static scenery:<br><br>Load my level<br>Load a copy with no textures e.t.c (the level shadow geometry)<br>Weld all vertices<br>Offset all vertices along their Normals (so later on the shadow map surface shows 'above' the level geometry)<br>Store all the shadow levels Tri Normals, Vert positions e.t.c<br>Delete the shadow mesh<br><br>Now in the update shadow function check what Tris are viewable from active lights, there's a few ways to do it, you could check if a Tris verts arewithin the lights range, check the dot product of the Tri Normal and triVert to Light vector to see if the Tri is facing the light.<br><br>There's some other checks I'm looking into, like seeing if the Tris Verts are within the lights view frustrum (for projection/cone/spot lights)<br><br>You can also check if the distance of a Tris center point to light is shorter than the shadow caster to lights distance, useful to see if the caster is behind level geometry.<br><br>From these checks we end up with minimal geometry to which you texture with the shadow map.<br><br>Still a lot of work to be done:<br><br><img src="http://www.tomspeed.com/sh2.jpg"><br><img src="http://www.tomspeed.com/sh1.jpg"><br><br>Cya!<br>Tom <br><br></td></tr></table><br>
<a name="339615"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ChrML</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> I see, I've now read carefully through your posts, and I will now look at this.<br><br>Tom: I think I will use shadow mapping for static shadows, but for special areas where lights moves, I  may use character shadows method (as suggested from you), only with a 4 poly shadowcaster (if that isn't too much, thinking about the shadow receiver). I will reply if I wonder at anything more. Thanks.<br><br>I think I will post my library if I get a good result, to help others with this thing. <br><br></td></tr></table><br>
<a name="339623"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Filax</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> really good shadow rendering !!! <br><br></td></tr></table><br>
<a name="339673"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ruz</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> looks really good.<br>can you make it less black/more tranparent <br><br></td></tr></table><br>
<a name="339733"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tom</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi all,<br><br>Yup, it can be whatever color you want. The mesh the shadow map is projected onto uses EntityBlend 2. The shadows from the pillars are lightmaps, so the character shadow is just blended over it, matching the shadow color could be a problem, idealy you want the cast shadows the same color as the lightmap shadow at its darkest.<br><br>My current problem is transforming vertices to camera space, for working out the UVs when mapping the shadow map onto the shadow mesh geometry. Blitzs CameraProject() clips values behind the camera, this is not so good for the following reason.<br><br>Take the floor in the above pics for example, the main square (not including the alcoves, is made of 2 large Tris. If the light is in the middle of the room, and the camera takes the shadow map piccy from that position, then 1 maybe 2 of each of the Tris vertices will be behind the camera, so I can't project these points into camera space using CameraProject() without getting a 0,0 return value.<br><br>In those pics I'm cheating, I'm changing the camera to an ortho view and zooming out so all verts are in view, and in front of the camera, but that kills the perspective element and makes the shadow appear smaller than it should be.<br><br>The other option would be to perform a CSG slice on any tris whos vert(s) are behind the camera plane, more unwanted math :|<br><br>Tom <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
