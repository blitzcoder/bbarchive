<!DOCTYPE html><html lang="en" ><head ><title >Slight Lens Flare Problem ???</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Slight Lens Flare Problem ???</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Slight Lens Flare Problem ???</a><br><br>
<a name="257811"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rogue Vector</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>I have a lens flare system the works fine when the camera moves and the light source is fixed.<br><br>However, it doesn't work in reverse.<br><br>That is, when the camera is static and the light source orbits around it.<br><br>Does anyone know how to code around this?<br><br>Cheers,<br><br>RV <br><br></td></tr></table><br>
<a name="257831"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Odds On</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> you need to be more specific... otherwise I have to make a lot of assumptions. I assume you're using the lens flare that comes with one of the Blitz demos, I assume you're probably moving the wrong thing... if I remember correctly there's a sun flare and a sun pivot, you have to move the pivot.<br><br>If you post an example (code that will compile to show the problem) I could be a lot more specific. <br><br></td></tr></table><br>
<a name="257952"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rogue Vector</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay, here's my code:<br><br>;Load in Flare images<br>Function LoadLenses()<br><br>	;Load 2D lens flare images<br>	LensFOrig1 = LoadSprite( "Resources\Sprites\lens1.jpg" )<br>	If LensFOrig1 = 0 Then RuntimeError "file 'lens1.jpg' does not exist!"<br>	HideEntity LensFOrig1	;hide as these entitys only used for CopyEntity()<br><br>	LensFOrig2 = LoadSprite( "Resources\Sprites\lens2.jpg" )<br>	If LensFOrig2 = 0 Then RuntimeError "file 'lens2.jpg' does not exist!"<br>	HideEntity LensFOrig2<br><br>	LensFOrig3 = LoadSprite( "Resources\Sprites\lens3.jpg" )<br>	If LensFOrig3 = 0 Then RuntimeError "file 'lens3.jpg' does not exist!"<br>	HideEntity LensFOrig3<br><br>	LensFOrig4 = LoadSprite( "Resources\Sprites\lens4.jpg" )<br>	If LensFOrig4 = 0 Then RuntimeError "file 'lens4.jpg' does not exist!"<br>	HideEntity LensFOrig4<br><br>End Function<br><br><br>;Create the Lens Flares<br>Function CreateLensFlares()<br><br>	LensFlare1 = CopyEntity( LensFOrig1, hud_overlay ) ;primary flare<br>	ScaleSprite LensFlare1, .35, .35		;scale according to screen size and size of sprite picture<br>	EntityAlpha LensFlare1, .3			;set alpha blend amount<br>	EntityOrder LensFlare1, -2			;place in front of other entitys<br>	HideEntity LensFlare1				;hide initially<br>	<br>	LensFlare2 = CopyEntity( LensFOrig3, hud_overlay ) ;first halo<br>	ScaleSprite LensFlare2, .25, .25	;scale is 1/2 of lens flare #1<br>	EntityAlpha LensFlare2, .3<br>	EntityOrder LensFlare2, -3			;place in front of previous lens flare<br>	HideEntity LensFlare2<br><br>	LensFlare3 = CopyEntity( LensFOrig3, hud_overlay ) ;small burst<br>	ScaleSprite LensFlare3, .125, .125	;scale is 1/4 of lens flare #1<br>	EntityAlpha LensFlare3, .2<br>	EntityOrder LensFlare3, -4			;place in front of previous lens flare<br>	HideEntity LensFlare3<br><br>	LensFlare4 = CopyEntity( LensFOrig2, hud_overlay ) ;next halo<br>	ScaleSprite LensFlare4, .27, .27		;same scale as lens flare #1<br>	EntityAlpha LensFlare4, .2<br>	EntityOrder LensFlare4, -5			;place in front of previous lens flare<br>	HideEntity LensFlare4<br><br>	LensFlare5 = CopyEntity( LensFOrig4, hud_overlay ) ;next burst<br>	ScaleSprite LensFlare5, .25, .25	;scale is 1/2 of lens flare #1<br>	EntityAlpha LensFlare5, .15<br>	EntityOrder LensFlare5, -6			;place in front of previous lens flare<br>	HideEntity LensFlare5<br><br>	LensFlare6 = CopyEntity( LensFOrig2, hud_overlay ) ;next halo<br>	ScaleSprite LensFlare6, .125, .125	;scale is 1/4 of lens flare #1<br>	EntityAlpha LensFlare6, .2<br>	EntityOrder LensFlare6, -7			;place in front of previous lens flare<br>	HideEntity LensFlare6<br>	<br>	LensFlare7 = CopyEntity( LensFOrig3, hud_overlay ) ;next burst<br>	ScaleSprite LensFlare7, .125, .125	;scale is 1/4 of lens flare #1<br>	EntityAlpha LensFlare7, .2<br>	EntityOrder LensFlare7, -8			;place in front of previous lens flare<br>	HideEntity LensFlare7<br><br>	LensFVisible% = False			;lens flares are hidden by default<br><br>	FreeEntity LensFOrig1<br>	FreeEntity LensFOrig2<br>	FreeEntity LensFOrig3<br>	FreeEntity LensFOrig4<br><br>End Function<br><br><br>Function UpdateLensFlares(sun, cam, d_height, d_width)<br>	<br>	If LensFlareON=False <br>		<br>			HideEntity LensFlare1<br>			HideEntity LensFlare2<br>			HideEntity LensFlare3<br>			HideEntity LensFlare4<br>			HideEntity LensFlare5<br>			HideEntity LensFlare6<br>			HideEntity LensFlare7<br>	<br>	Else<br>				<br>			;-- is the sun in view? and make sure it's not blocked by other blocking entities<br>			If EntityInView( sun, cam ) = True And EntityVisible( cam, sun ) = True<br>		<br>				;determine sun visible x/y coords using camera 3d to 2d conversion<br>				CameraProject cam, EntityX(sun,True), EntityY(sun,True), EntityZ(sun,True)<br>			    lx = ProjectedX() ;position on 2d screen<br>			    ly = ProjectedY()<br>			<br>				;determine center of screen<br>				cx = d_width / 2<br>				cy = d_height / 2<br>		<br>				;determine vector from center to sun's x/y screen position<br>				vx = cx - lx<br>				vy = cy - ly<br>				If vx = 0 And vy = 0<br>					distance# = 1.0 ;to fix sqr(0) fail<br>				Else<br>					distance# = Sqr( (vx*vx)+(vy*vy) )	;determine length of vector (pythagoras)<br>				EndIf<br>		<br>				;normalise vector (determine 1 unit size in x and y coordinates)<br>				nx# = vx / distance#<br>				ny# = vy / distance#<br>		<br>				;== calculate lens flare positions<br>			<br>				;calculate lens flare 1 position (maximum distance)<br>				f1x = cx - (nx# * distance)<br>				f1y = cy - (ny# * distance)<br>		<br>				;calculate lens flare 2 position (half distance)<br>				f2x = cx - (nx# * (distance/2)) ;could optimize but leaving as divide for readability<br>				f2y = cy - (ny# * (distance/2))<br>			<br>				;calculate lens flare 3 position (one third of distance)<br>				f3x = cx - (nx# * (distance/3))<br>				f3y = cy - (ny# * (distance/3))<br>			<br>				;calculate lens flare 4 position (one eight distance)<br>				f4x = cx - (nx# * (distance/8))<br>				f4y = cy - (ny# * (distance/8))<br>			<br>				;calculate lens flare 5 position<br>				f5x = cx - (nx# * (-distance/2))<br>				f5y = cy - (ny# * (-distance/2))<br>			<br>				;calculate lens flare 6 position<br>				f6x = cx - (nx# * (-distance/4))<br>				f6y = cy - (ny# * (-distance/4))<br>			<br>				;calculate lens flare 7 position<br>				f7x = cx - (nx# * (-distance/5.5))<br>				f7y = cy - (ny# * (-distance/5.5))<br>			<br>			<br>				;=== position lens flares entities (relative to camera hud fixed pivot)<br>		<br>				PositionEntity LensFlare1, f1x, f1y, 1<br>				PositionEntity LensFlare2, f2x, f2y, 1<br>				PositionEntity LensFlare3, f3x, f3y, 1<br>				PositionEntity LensFlare4, f4x, f4y, 1<br>				PositionEntity LensFlare5, f5x, f5y, 1<br>				PositionEntity LensFlare6, f6x, f6y, 1<br>				PositionEntity LensFlare7, f7x, f7y, 1<br>		<br>				;make flares visible? (if not already visible)<br>				If  LensFVisible% = False<br>					ShowEntity LensFlare1<br>					ShowEntity LensFlare2<br>					ShowEntity LensFlare3<br>					ShowEntity LensFlare4<br>					ShowEntity LensFlare5<br>					ShowEntity LensFlare6<br>					ShowEntity LensFlare7<br>					<br>					 LensFVisible% = True<br>				EndIf<br>		<br>		<br>			;sun not visible from camera<br>			Else<br>				;lens flares previously visible? then hide them<br>				If  LensFVisible% = True<br>					HideEntity LensFlare1<br>					HideEntity LensFlare2<br>					HideEntity LensFlare3<br>					HideEntity LensFlare4<br>					HideEntity LensFlare5<br>					HideEntity LensFlare6<br>					HideEntity LensFlare7<br>		<br>					 LensFVisible% = False<br>				EndIf<br>			EndIf<br>	EndIf<br>	<br>End Function<br><br><br>;Example Usage ------------------------------------------<br><br>;Sun = CreatePivot()				<br>;PositionEntity Sun, -199.0, 1000.0, -220.0<br>;LoadLenses()<br>;CreateLensFlares()<br>;EntityParent Sun, SkyBox<br><br><br>;Main Loop<br>;Repeat<br>;.<br>;.<br>;TurnEntity SkyBox, 0, -4*g_DeltaT, 0<br>;UpdateLensFlares(Sun, g_cam, g_scrheight, g_scrwidth)<br>;.<br>;.<br>;UpdateWorld()<br>;Renderworld()<br>;Flip<br>;Until KeyHit(1)=True<br>;-------------------------------------------------------<br><br><br>Cheers,<br><br>RV <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
