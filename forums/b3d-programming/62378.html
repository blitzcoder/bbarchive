<!DOCTYPE html><html lang="en" ><head ><title >The 'Stencil shadow' thread</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >The 'Stencil shadow' thread</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >The 'Stencil shadow' thread</a><br><br>
<a name="697110"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello everybody!<br><br>You might remember me and DareDevil... we are the developer of the DevilShadowSystem<br><br>Worklog to the <b>new 0.6Beta release</b>: www.blitzbasic.com/logs/userlog.php?user=8270&amp;log=660 <br><br>So i decided to create a 'stencil shadow' thread. If you have any shadow systems in development or any questions about stencils, post them HERE!<br><br><b>This is the stencil shadow thread.</b><br><br>Regards... <br><br></td></tr></table><br>
<a name="697113"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >mindstorms</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Don't know why your link doesn't work, here is one that should.<br><br><br><a href="http://www.blitzbasic.com/logs/userlog.php?user=8270&amp;log=660" target="_blank">http://www.blitzbasic.com/logs/userlog.php?user=8270&amp;log=660</a> <br><br></td></tr></table><br>
<a name="697114"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> oops, edited, sry! <br><br></td></tr></table><br>
<a name="697117"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >mindstorms</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is there any reason why I get about 30 fps for the other demos but only 4-6 fps for the busts? <br><br></td></tr></table><br>
<a name="697119"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> yes, your computer is slow, OR you have still turned the debugger on :) <br><br></td></tr></table><br>
<a name="697124"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >mindstorms</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wow, turning the debugger off helps...;) <br><br></td></tr></table><br>
<a name="697158"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Picklesworth</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> WOW!<br>60 FPS for everything except the "game" one with the complicated room, which starts stays around 60 but drops to 50 on occasion.<br><br>Athlon XP 2500+ (1.8 GHz), Radeon 9600 Pro, 1280 MB RAM,  and Windows XP Professional.<br><br>I think you should have a few more demos of shadows casting onto uneven surfaces in there. Currently the only ones that show that are the tank one and the Swifty clone one.<br>A staircase would be a nice showcase :) <br><br></td></tr></table><br>
<a name="697163"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mustang</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> 1 - 16-20 fps<br>2 - 16 fps<br>3 - 8 fps<br>4 - 8 fps<br>5 - 4 fps<br>6 - 10 fps<br><br>These results from my laptop with crappy integrated Intel82855/82855GM GPU (debug off). I'm amazed that demos worked flawlessly although fps was not that great :) <br><br></td></tr></table><br>
<a name="697183"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >IPete2</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey Devils Child,  Great work (so far).<br><br>A quick question if I may, what is the shw file in this line please?<br><br>SetShadowMesh(Caster, True, "Media\Warrior.shw")<br><br>IPete2. <br><br></td></tr></table><br>
<a name="697221"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >degac</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> G R E A T   W O R K <br><br>@Ipete2: It uses a file .shw to save the info about the shadows as Devils said in his worklog - or I think. <br><br></td></tr></table><br>
<a name="697222"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> thx for compliments :)<br><br><b>the shw file:</b><br><br>before a caster can cast a volume, he has to initialise the volum caster... this takes 20 secounds for 5.000 polys. Then he saves the 'hacked' data into a file and afterwards he doesnt have to hack the mesh again! he just reads out of this file which is 100-100.000 times faster :) <br><br></td></tr></table><br>
<a name="697225"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> How about a command refferecne?<br><br><b>InitShadows(Camera)</b> Initialises the shadows. The first command which should be called!<br><b>FreeShadows()</b> deletes everything about the shadows.<br><b>SetShadowColors(alpha#, r, g, b)</b> Alphe sets the shadow alpha and rgb decides about the shadow colors(should be between 0,0,0 and 40,40,40 at all the times !)<br><b>SetShadowLight(ent)</b> Light caster! If you set a secon one, the old one will be automaticly deleted!<br><b>SetShadowMesh(ent, casting, path$)</b> - set a shadow mesh. if casting = true then it is a caster and a receiver. otherwise it is a receiver only. when you set a path he writes the informations about the caster down there(this is for the InitTime faster!!!!)<br><b>Render(mode)</b> use this instead of renderworld and updateworld. mode0 = no shadows; mode1 = shadows; mode2 = debugmode, volumes only.<br><br>do not toucxh any other functions casue the are internal functions. setshadowcaster() is an internal function(for example)<br><br>have fun:) <br><br></td></tr></table><br>
<a name="697267"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sledge</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is this using the new algorithms from <a href="/posts.php?topic=62176" target="_blank">here</a>? <br><br></td></tr></table><br>
<a name="697287"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> yes, it is using the third one, but after initvolumecaster() he saves the caster's informations into a file(faster)!<br><br>the shadow volume algorithm is by DareDevil, and optimized by me, so i cant take all the credits :)<br><br>btw: where is daredevil again? a big part of this shadow system is by him!!! <br><br></td></tr></table><br>
<a name="697423"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> I guess that' s the most complete stecil shadows implementation for BLitz3D so far, is it?<br>Great Job! <br><br></td></tr></table><br>
<a name="697509"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >mr.keks</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Tjo, I also like your work, Devils Child! (=<br><br>By the way: What's about integrating depth fail? <a href="http://en.wikipedia.org/wiki/Shadow_volume#Depth_fail" target="_blank">http://en.wikipedia.org/wiki/Shadow_volume#Depth_fail</a><br>(Oha, I just read that there's a patent on the method.. ) <br><br></td></tr></table><br>
<a name="697525"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Naughty Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> ..this is very nice, but its still far away from real use..I hope you'll make it faster.. <br><br></td></tr></table><br>
<a name="697531"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> thx inarie :)<br>it has 60% of the speed of andreymans fx libary yet! i think we wont speed it up, we rather solve the bugs!<br><br>inarie: i cant take all the credits... DareDevil is wokring on the shadow volumes, but he is disappeared yet!? <br><br></td></tr></table><br>
<a name="697560"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Filax</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Great job devil :) ! <br><br>But i have a question ? do you plan to increase the shadow rendering on curved surface ? because stencil shadow on<br>a sphere draw some strange stuff :)<br><br>Continue this great lib ! <br><br></td></tr></table><br>
<a name="697573"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> what you mean filax is soft self shadowing. i dont know how it works, but the only thing left to do is improve shadow rendering!<br><br>but maybee i can make ENBM work in our system... :) <br><br></td></tr></table><br>
<a name="697585"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> seems like stencil shadows and ENBM doesnt like each other :( <br><br></td></tr></table><br>
<a name="697615"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Filax</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> Maybe this links help you ? :)<br><br><a href="http://www.devmaster.net/articles/shadow_techniques/" target="_blank">http://www.devmaster.net/articles/shadow_techniques/</a><br><br><a href="http://graphics.cs.lth.se/theses/projects/shadows/so_thesis_lq.pdf" target="_blank">http://graphics.cs.lth.se/theses/projects/shadows/so_thesis_lq.pdf</a><br><br><a href="http://www.devmaster.net/articles/shadows/" target="_blank">http://www.devmaster.net/articles/shadows/</a><br><br><a href="http://www.gamedev.net/reference/articles/article1873.asp" target="_blank">http://www.gamedev.net/reference/articles/article1873.asp</a><br><br><a href="http://www.gamedev.net/community/forums/topic.asp?topic_id=133985" target="_blank">http://www.gamedev.net/community/forums/topic.asp?topic_id=133985</a><br><br><a href="http://www.3dkingdoms.com/weekly/weekly.php?a=28" target="_blank">http://www.3dkingdoms.com/weekly/weekly.php?a=28</a><br><br><a href="http://www.racer.nl/tutorial/shadows.htm" target="_blank">http://www.racer.nl/tutorial/shadows.htm</a> <br><br></td></tr></table><br>
<a name="697623"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> thanks filax, just checking them out, but i dont think i can improve shadow rendering. the only one who can, is tom!<br><br>common tom, let us see you shadow rendering algorith(i mean that one, where are no problems with the camera_inside_volume) <br><br></td></tr></table><br>
<a name="697655"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >mr.keks</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> öhm, i've been trying to integrate your shadow system into a game of mine (just for a test.. ^^), but öhm, the shadow caster entities  aren't rendered at all and every other entity except for my sky cube quad and some few other ones is black. öhm, i guess that you change some rendermodes in a way i don't understand. (i have no clue regarding all these renderstates xD) have you any idea what has to be changed? (the volume building seems to work... render(2) works fine)<br><br>ah, and one other thing: how to set a parallel light source? (this of course will only be of interest for me, if you can help me make the shadows working at all ^^) <br><br></td></tr></table><br>
<a name="697694"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sledge</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>But i have a question ? do you plan to increase the shadow rendering on curved surface ? because stencil shadow on<br>a sphere draw some strange stuff :)<br> <br></div><br>It's the self-shadowing that's a bit poppy, isn't it? It would be nice to be able to toggle that off, but this is splendid stuff regardless. <br><br></td></tr></table><br>
<a name="697698"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> @inarie<br><br>every entity in the space must be at least a shadow receiver. and remember: you can set as many receivers as you want, it is no speedloss<br><br>just check out the next update which will come in 5 minutes :)<br>SetShadowLight(entity, parallel = False) <br><br></td></tr></table><br>
<a name="697699"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> <b>UPDATE FOR PARALLEL LIGHT:</b><br><br><b>DevilShadowSystem.bb</b><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">Include "Includes\ShadowVolumes.bb"
Include "Includes\DX7Const.bb"

Type ShadowMesh
	Field ent, casting
End Type
Type ShadowLight
	Field ent, parallel
End Type
Global ShadowCam, ShadowPlane
Global Debug_TimeRender, Debug_TimeInitVolumes, Debug_TimeVolumesBuilt, Debug_ShadowPolys

Function InitShadows(Cam)
ShadowCam = Cam
;ShadowPlane
ShadowPlane = CreateSprite()
ScaleSprite ShadowPlane, 10, 10
EntityParent ShadowPlane, ShadowCam, 0
MoveEntity ShadowPlane, 0, 0, GetCamRangeStart(ShadowCam) + .001
;Volumes
InitVolumes()
;Init DirectX7
If DX7_SetSystemProperties(SystemProperty$("Direct3D7"), SystemProperty$("Direct3DDevice7"), SystemProperty$("DirectDraw7"), SystemProperty$("AppHWND"), SystemProperty$("AppHINSTANCE")) Then RuntimeError "Error initializing dx7."
If DX7_GetStencilBitDepth() &lt; 8 Then
	DX7_CreateStencilBuffer()
	If DX7_GetStencilBitDepth() &lt; 8 Then RuntimeError "Graphic card does not support stencil buffers."
End If
;Misc
Debug_TimeInitVolumes = 0
SetShadowColors(.5, 0, 0, 0)
End Function

Function FreeShadows()
DX7_RemoveSystemProperties()
FreeVolumes()
Delete Each ShadowMesh
Delete Each ShadowLight
End Function

Function SetShadowColors(alpha#, r = 0, g = 0, b = 0)
If alpha# &lt; 0 Then alpha# = 0
If alpha# &gt; .99 Then alpha# = .99
EntityAlpha ShadowPlane, alpha#
If r &lt; 0 Then r = 0 ElseIf r &gt; 255 Then r = 255
If g &lt; 0 Then g = 0 ElseIf g &gt; 255 Then g = 255
If b &lt; 0 Then b = 0 ElseIf b &gt; 255 Then b = 255
EntityColor ShadowPlane, r, g, b
End Function

Function SetShadowLight(ent, parallel = False)
Delete Each ShadowLight
sl.ShadowLight = New ShadowLight
sl\ent = ent
sl\parallel = parallel
End Function

Function SetShadowMesh(ent, casting = True, path$ = "***")
If casting Then
	ms = MilliSecs()
	RecursiveShadowCaster(ent, path$)
	Debug_TimeInitVolumes = Debug_TimeInitVolumes + MilliSecs() - ms
Else
	sm.ShadowMesh = New ShadowMesh
	sm\ent = ent
EndIf
End Function

Function RecursiveShadowCaster(ent, path$, file = -1)
If FileType(path$) = 1 Then
	LoadVolumeCaster(ent, path$)
Else
	If file = -1 And path$ &lt;&gt; "***" Then file = WriteFile(path$)
	sm.ShadowMesh = New ShadowMesh
	sm\ent = ent
	sm\casting = True
	InitVolumeCaster(sm\ent)
	If file &lt;&gt; - 1 Then
		For etem.ETE_Mesh = Each ETE_Mesh
			If etem\ent = sm\ent Then
				cnt_tris = etem\cnt_tris
				WriteInt file, cnt_tris
				For v = 0 To cnt_tris
					tri.ETE_Triangle = etem\tri[v]
					v1.Point3D = tri\v1
					v2.Point3D = tri\v2
					v3.Point3D = tri\v3
					WriteFloat file, v1\x#
					WriteFloat file, v1\y#
					WriteFloat file, v1\z#
					WriteFloat file, v2\x#
					WriteFloat file, v2\y#
					WriteFloat file, v2\z#
					WriteFloat file, v3\x#
					WriteFloat file, v3\y#
					WriteFloat file, v3\z#
					WriteFloat file, tri\nx#
					WriteFloat file, tri\ny#
					WriteFloat file, tri\nz#
					WriteInt file, tri\tri
					WriteInt file, tri\ta
					WriteInt file, tri\tb
					WriteInt file, tri\tc
				Next
			EndIf
		Next
	EndIf
	cnt_children = CountChildren(ent)
	If cnt_children = 0 Then Return
	For i = 1 To cnt_children
		RecursiveShadowCaster(GetChild(ent, i), "***", file)
	Next
EndIf
End Function

Function Render(mode = 0, tween# = 1)
Select mode
	Case 0, 2
		ClearSurface VolumeSurf
		If mode = 2 Then
			BuildVolumes()
			ShowEntity VolumeMesh
			EntityFX VolumeMesh, 17
			EntityAlpha VolumeMesh, .5
		EndIf
		For sm.ShadowMesh = Each ShadowMesh
			ShowEntity sm\ent
		Next
		HideEntity ShadowPlane
		CameraClsMode ShadowCam, True, True
		ms = MilliSecs()
		UpdateWorld
		RenderWorld tween#
		Debug_TimeRender = MilliSecs() - ms
		If mode = 0 Then
			Debug_TimeVolumesBuilt = 0
			Debug_ShadowPolys = 0
		EndIf
	Case 1
		EntityFX VolumeMesh, 0
		EntityAlpha VolumeMesh, .0001
		ms = MilliSecs()
		RenderShadows(tween#)
		Debug_TimeRender = MilliSecs() - ms - Debug_TimeVolumesBuilt
	Default
		RuntimeError "Wrong render mode."
End Select
End Function

Function RenderShadows(tween#)
HideEntity ShadowPlane
HideEntity VolumeMesh
For sm.ShadowMesh = Each ShadowMesh
	ShowEntity sm\ent
Next
DX7_SetRenderState(D3DRS_ZWRITEENABLE, True)
DX7_SetRenderState(D3DRS_STENCILENABLE, False)
DX7_SetRenderState(D3DRS_ALPHABLENDENABLE, False)
DX7_DeviceClear(7, $00008080, 1, 0)
CameraClsMode ShadowCam, True, True
UpdateWorld
RenderWorld tween#
CameraClsMode ShadowCam, False, False
BuildVolumes()
For sm.ShadowMesh = Each ShadowMesh
	HideEntity sm\ent
Next
ShowEntity VolumeMesh
DX7_SetRenderState(D3DRS_ZWRITEENABLE, False)
DX7_SetRenderState(D3DRS_STENCILENABLE, True)
DX7_SetRenderState(D3DRS_STENCILFUNC, D3DCMP_ALWAYS)
DX7_SetRenderState(D3DRS_STENCILREF, 1)
DX7_SetRenderState(D3DRS_STENCILMASK, $FFFFFFFF)
DX7_SetRenderState(D3DRS_STENCILWRITEMASK, $FFFFFFFF)
DX7_SetRenderState(D3DRS_CULLMODE, D3DCULL_CCW)
DX7_SetRenderState(D3DRS_STENCILZFAIL, D3DSTENCILOP_KEEP)
DX7_SetRenderState(D3DRS_STENCILFAIL, D3DSTENCILOP_KEEP)
DX7_SetRenderState(D3DRS_STENCILPASS, D3DSTENCILOP_INCR)
DX7_SetRenderState(D3DRS_ALPHABLENDENABLE, True)
DX7_SetRenderState(D3DRS_SRCBLEND, D3DBLEND_ZERO)
DX7_SetRenderState(D3DRS_DESTBLEND, D3DBLEND_ONE)
RenderWorld tween#
DX7_SetRenderState(D3DRS_STENCILPASS, D3DSTENCILOP_DECR)
DX7_SetRenderState(D3DRS_CULLMODE, D3DCULL_CW)
RenderWorld tween#
DX7_SetRenderState(D3DRS_CULLMODE, D3DCULL_CCW)
HideEntity VolumeMesh
DX7_SetRenderState(D3DRS_ZWRITEENABLE, True)
DX7_SetRenderState(D3DRS_STENCILENABLE, False)
DX7_SetRenderState(D3DRS_ALPHABLENDENABLE, False)
DX7_SetRenderState(D3DRS_ZENABLE, False)
DX7_SetRenderState(D3DRS_STENCILENABLE, True)
DX7_SetRenderState(D3DRS_ALPHABLENDENABLE, True)
DX7_SetRenderState(D3DRS_SRCBLEND, D3DBLEND_SRCALPHA)
DX7_SetRenderState(D3DRS_DESTBLEND, D3DBLEND_INVSRCALPHA)
DX7_SetRenderState(D3DRS_STENCILREF, 1)
DX7_SetRenderState(D3DRS_STENCILFUNC, D3DCMP_LESSEQUAL)
DX7_SetRenderState(D3DRS_STENCILPASS, D3DSTENCILOP_REPLACE)
ShowEntity ShadowPlane
RenderWorld tween#
DX7_SetRenderState(D3DRS_ZENABLE, True)
DX7_SetRenderState(D3DRS_STENCILENABLE, False)
DX7_SetRenderState(D3DRS_ALPHABLENDENABLE, True)
HideEntity ShadowPlane
DX7_SetRenderState(D3DRS_ALPHABLENDENABLE, False)
End Function

Function BuildVolumes()
ms = MilliSecs()
sl.ShadowLight = First ShadowLight
ClearSurface VolumeSurf
CreateVolume(sl\ent, sl\parallel)
Debug_ShadowPolys = CountTriangles(VolumeSurf)
Debug_TimeVolumesBuilt = MilliSecs() - ms
End Function</textarea><br><br><b>ShadowVolumes.bb</b><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">Type ETE_Mesh
	Field ent
	Field cnt_tris, tri.ETE_Triangle[ETE_MaxTriang]
End Type
Type ETE_Triangle
	Field v1.Point3D, v2.Point3D, v3.Point3D, nx#, ny#, nz#
	Field tri, ta, tb, tc
End Type
Type Point3D
	Field x#, y#, z#
End Type
Const ETE_MaxTriang = 65000
Global VolumeMesh, VolumeSurf
Dim TriangleClone.ETE_Triangle(ETE_MaxTriang)

Function InitVolumes()
For i = 0 To ETE_MaxTriang
	TriangleClone.ETE_Triangle(i) = New ETE_Triangle
	TriangleClone(i)\v1 = New Point3D
	TriangleClone(i)\v2 = New Point3D
	TriangleClone(i)\v3 = New Point3D
Next
VolumeMesh = CreateMesh()
VolumeSurf = CreateSurface(VolumeMesh)
EntityColor VolumeMesh, 255, 0, 0
EntityAlpha VolumeMesh, .5
EntityFX VolumeMesh, 17
End Function

Function FreeVolumes()
Delete Each ETE_Mesh
Delete Each ETE_Triangle
Delete Each Point3D
If VolumeMesh Then FreeEntity VolumeMesh
End Function

Function InitVolumeCaster(ent, file = -1)
Local ad1[ETE_MaxTriang], ad2[ETE_MaxTriang], ad3[ETE_MaxTriang]
copy = SingleSurfaceMesh(ent)
etem.ETE_Mesh = New ETE_Mesh
etem\ent = ent
surf = GetSurface(copy, 1)
cnt_tris = CountTriangles(surf) - 1
etem\cnt_tris = cnt_tris
For v = 0 To cnt_tris
	etem\tri[v] = New ETE_Triangle
	etet.ETE_Triangle = etem\tri[v]
	etet\v1 = New Point3D
	etet\v2 = New Point3D
	etet\v3 = New Point3D
	v1.Point3D = etet\v1
	v2.Point3D = etet\v2
	v3.Point3D = etet\v3
	vert0 = TriangleVertex(surf, v, 0)
	vert1 = TriangleVertex(surf, v, 1)
	vert2 = TriangleVertex(surf, v, 2)
	v1\x# = VertexX(surf, vert0)
	v1\y# = VertexY(surf, vert0)
	v1\z# = VertexZ(surf, vert0)
	v2\x# = VertexX(surf, vert1)
	v2\y# = VertexY(surf, vert1)
	v2\z# = VertexZ(surf, vert1)
	v3\x# = VertexX(surf, vert2)
	v3\y# = VertexY(surf, vert2)
	v3\z# = VertexZ(surf, vert2)
	e0x# = v3\x# - v2\x#
	e0y# = v3\y# - v2\y#
	e0z# = v3\z# - v2\z#
	e1x# = v2\x# - v1\x#
	e1y# = v2\y# - v1\y#
	e1z# = v2\z# - v1\z#
	etet\nx# = e0y# * e1z# - e0z# * e1y#
	etet\ny# = e0z# * e1x# - e0x# * e1z#
	etet\nz# = e0x# * e1y# - e0y# * e1x#
	etet\tri = v
	etet\ta = -1
	etet\tb = -1
	etet\tc = -1
	ad1[v] = True
	ad2[v] = True
	ad3[v] = True
Next
For a = 0 To cnt_tris
	ATriang.ETE_Triangle = etem\tri[a]
	v1 = ATriang\v1
	v2 = ATriang\v2
	v3 = ATriang\v3
	For b = a + 1 To cnt_tris
		state1 = ad1<b>
		state2 = ad2[b]
		state3 = ad3[b]
		If a &lt;&gt; b And (state1 Or state2 Or state3) Then
			BTriang.ETE_Triangle = etem\tri[b]
			v2A.Point3D = BTriang\v1
			v2B.Point3D = BTriang\v2
			v2C.Point3D = BTriang\v3
			If state1 Then
				If CheckLine(v1, v2A, v2, v2B) Then
					ATriang\ta = b
					BTriang\ta = a
					ad1[b] = False
					Goto SIDEA
				EndIf
			EndIf
			If state2 Then
				If CheckLine(v1, v2B, v2, v2C) Then
					ATriang\ta = b
					BTriang\tb = a
					ad2[b] = False
					Goto SIDEA
				EndIf
			EndIf
			If state3 Then
				If CheckLine(v1, v2C, v2, v2A) Then
					ATriang\ta = b
					BTriang\tc = a
					ad3[b] = False
				EndIf
			EndIf
			.SIDEA
			If state1 Then
				If CheckLine(v2, v2A, v3, v2B) Then
					ATriang\tb = b
					BTriang\ta = a
					ad1[b] = False
					Goto SIDEB
				EndIf
			EndIf
			If state2 Then
				If CheckLine(v2, v2B, v3, v2C) Then
					ATriang\tb = b
					BTriang\tb = a
					ad2[b] = False
					Goto SIDEB
				EndIf
			EndIf
			If state3 Then
				If CheckLine(v2, v2C, v3, v2A) Then
					ATriang\tb = b
					BTriang\tc = a
					ad3[b] = False
				EndIf
			EndIf
			.SIDEB
			If state1 Then
				If CheckLine(v3, v2A, v1, v2B) Then
					ATriang\tc = b
					BTriang\ta = a
					ad1[b] = False
					Goto SIDEC
				EndIf
			EndIf
			If state2 Then
				If CheckLine(v3, v2B, v1, v2C) Then
					ATriang\tc = b
					BTriang\tb = a
					ad2[b] = False
					Goto SIDEC
				EndIf
			EndIf
			If state3 Then
				If CheckLine(v3, v2C, v1, v2A) Then
					ATriang\tc = b
					BTriang\tc = a
					ad3[b] = False
				EndIf
			EndIf
			.SIDEC
		EndIf
	Next
Next
FreeEntity copy
End Function

Function LoadVolumeCaster(ent, path$, file = -1)
If file = -1 Then file = ReadFile(path$)
sm.ShadowMesh = New ShadowMesh
sm\ent = ent
sm\casting = True
etem.ETE_Mesh = New ETE_Mesh
etem\ent = sm\ent
etem\cnt_tris = ReadInt(file)
For v = 0 To etem\cnt_tris
	etem\tri[v] = New ETE_Triangle
	etet.ETE_Triangle = etem\tri[v]
	tri.ETE_Triangle = etem\tri[v]
	tri\v1 = New Point3D
	tri\v2 = New Point3D
	tri\v3 = New Point3D
	v1.Point3D = tri\v1
	v2.Point3D = tri\v2
	v3.Point3D = tri\v3
	v1\x# = ReadFloat(file)
	v1\y# = ReadFloat(file)
	v1\z# = ReadFloat(file)
	v2\x# = ReadFloat(file)
	v2\y# = ReadFloat(file)
	v2\z# = ReadFloat(file)
	v3\x# = ReadFloat(file)
	v3\y# = ReadFloat(file)
	v3\z# = ReadFloat(file)
	tri\nx# = ReadFloat(file)
	tri\ny# = ReadFloat(file)
	tri\nz# = ReadFloat(file)
	tri\tri = ReadInt(file)
	tri\ta = ReadInt(file)
	tri\tb = ReadInt(file)
	tri\tc = ReadInt(file)
Next
cnt_children = CountChildren(ent)
For i = 1 To cnt_children
	LoadVolumeCaster(GetChild(ent, i), "", file)
Next
End Function

Function CreateVolume(light, parallel = False)
light_x# = EntityX(light, True) * (1 + parallel * 1000000)
light_y# = EntityY(light, True) * (1 + parallel * 1000000)
light_z# = EntityZ(light, True) * (1 + parallel * 1000000)
volume_lenght = 1000
For etem.ETE_Mesh = Each ETE_Mesh
	cnt_tris = etem\cnt_tris
	For v = 0 To cnt_tris
		etet.ETE_Triangle = TriangleClone(v)
		CloneTriangle(etet, etem\tri[v])
		v1.Point3D = etet\v1
		v2.Point3D = etet\v2
		v3.Point3D = etet\v3
		TFormPoint v1\x#, v1\y#, v1\z#, etem\ent, 0
		v1\x# = TFormedX()
		v1\y# = TFormedY()
		v1\z# = TFormedZ()
		TFormPoint v2\x#, v2\y#, v2\z#, etem\ent, 0
		v2\x# = TFormedX()
		v2\y# = TFormedY()
		v2\z# = TFormedZ()
		TFormPoint v3\x#, v3\y#, v3\z#, etem\ent, 0
		v3\x# = TFormedX()
		v3\y# = TFormedY()
		v3\z# = TFormedZ()
		TFormNormal etet\nx#, etet\ny#, etet\nz#, etem\ent, 0
		normlight_x# = (v1\x# + v2\x# + v3\x#) / 3.0 - light_x#
		normlight_y# = (v1\y# + v2\y# + v3\y#) / 3.0 - light_y#
		normlight_z# = (v1\z# + v2\z# + v3\z#) / 3.0 - light_z#
		If TFormedX() * normlight_x# + TFormedY() * normlight_y# + TFormedZ() * normlight_z# &lt; 0 Then etet\tri = -1
	Next
	For v = 0 To cnt_tris
		etet = TriangleClone(v)
		If etet\tri =&gt; 0 Then
			ta = etet\ta
			tb = etet\tb
			tc = etet\tc
			If ta &gt; -1 Then check1 = TriangleClone(ta)\tri Else check1 = -1
			If tb &gt; -1 Then check2 = TriangleClone(tb)\tri Else check2 = -1
			If tc &gt; -1 Then check3 = TriangleClone(tc)\tri Else check3 = -1
			If check1 &lt; 0 Or check2 &lt; 0 Or check3 &lt; 0 Then
				v1 = etet\v1
				v2 = etet\v2
				v3 = etet\v3
				If check1 &lt; 0 Then
					rax# = v1\x# + (v1\x# - light_x#) * volume_lenght
					ray# = v1\y# + (v1\y# - light_y#) * volume_lenght
					raz# = v1\z# + (v1\z# - light_z#) * volume_lenght
					rbx# = v2\x# + (v2\x# - light_x#) * volume_lenght
					rby# = v2\y# + (v2\y# - light_y#) * volume_lenght
					rbz# = v2\z# + (v2\z# - light_z#) * volume_lenght
					vert1 = AddVertex(VolumeSurf, v1\x#, v1\y#, v1\z#)
					vert2 = AddVertex(VolumeSurf, rax#, ray#, raz#)
					vert3 = AddVertex(VolumeSurf, rbx#, rby#, rbz#)
					vert4 = AddVertex(VolumeSurf, v2\x#, v2\y#, v2\z#)
					AddTriangle(VolumeSurf, vert1, vert2, vert3)
					AddTriangle(VolumeSurf, vert1, vert3, vert4)
				EndIf
				If check2 &lt; 0 Then
					rbx# = v2\x# + (v2\x# - light_x#) * volume_lenght
					rby# = v2\y# + (v2\y# - light_y#) * volume_lenght
					rbz# = v2\z# + (v2\z# - light_z#) * volume_lenght
					rcx# = v3\x# + (v3\x# - light_x#) * volume_lenght
					rcy# = v3\y# + (v3\y# - light_y#) * volume_lenght
					rcz# = v3\z# + (v3\z# - light_z#) * volume_lenght
					vert1 = AddVertex(VolumeSurf, v2\x#, v2\y#, v2\z#)
					vert2 = AddVertex(VolumeSurf, rbx#, rby#, rbz#)
					vert3 = AddVertex(VolumeSurf, rcx#, rcy#, rcz#)
					vert4 = AddVertex(VolumeSurf, v3\x#, v3\y#, v3\z#)
					AddTriangle(VolumeSurf, vert1, vert2, vert3)
					AddTriangle(VolumeSurf, vert1, vert3, vert4)
				EndIf
				If check3 &lt; 0 Then
					rax# = v1\x# + (v1\x# - light_x#) * volume_lenght
					ray# = v1\y# + (v1\y# - light_y#) * volume_lenght
					raz# = v1\z# + (v1\z# - light_z#) * volume_lenght
					rcx# = v3\x# + (v3\x# - light_x#) * volume_lenght
					rcy# = v3\y# + (v3\y# - light_y#) * volume_lenght
					rcz# = v3\z# + (v3\z# - light_z#) * volume_lenght
					vert1 = AddVertex(VolumeSurf, v1\x#, v1\y#, v1\z#)
					vert2 = AddVertex(VolumeSurf, rax#, ray#, raz#)
					vert3 = AddVertex(VolumeSurf, rcx#, rcy#, rcz#)
					vert4 = AddVertex(VolumeSurf, v3\x#, v3\y#, v3\z#)
					AddTriangle(VolumeSurf, vert1, vert3, vert2)
					AddTriangle(VolumeSurf, vert1, vert4, vert3)
				EndIf
			EndIf
		EndIf
	Next
Next
End Function

Function SingleSurfaceMesh(ent)
ret = CopyMesh(ent)
If CountSurfaces(ret) = 1 Then
	Return ret
Else
	FreeEntity ret
	ret = CreateMesh()
	new_surf = CreateSurface(ret)
	For s = 1 To CountSurfaces(ent)
		surf = GetSurface(ent, s)
		For t = 0 To CountTriangles(surf) - 1
			v0 = TriangleVertex(surf, t, 0)
			v1 = TriangleVertex(surf, t, 1)
			v2 = TriangleVertex(surf, t, 2)
			new_v1 = AddVertex(new_surf, VertexX(surf, v0), VertexY(surf, v0), VertexZ(surf, v0))
			new_v2 = AddVertex(new_surf, VertexX(surf, v1), VertexY(surf, v1), VertexZ(surf, v1))
			new_v3 = AddVertex(new_surf, VertexX(surf, v2), VertexY(surf, v2), VertexZ(surf, v2))
			AddTriangle new_surf, new_v1, new_v2, new_v3
		Next
	Next
	Return ret
EndIf
End Function

Function CloneTriangle(dst.ETE_Triangle, src.ETE_Triangle)
dst\v1\x# = src\v1\x#
dst\v1\y# = src\v1\y#
dst\v1\z# = src\v1\z#
dst\v2\x# = src\v2\x#
dst\v2\y# = src\v2\y#
dst\v2\z# = src\v2\z#
dst\v3\x# = src\v3\x#
dst\v3\y# = src\v3\y#
dst\v3\z# = src\v3\z#
dst\nx# = src\nx#
dst\ny# = src\ny#
dst\nz# = src\nz#
dst\tri = src\tri
dst\ta = src\ta
dst\tb = src\tb
dst\tc = src\tc
End Function

Function CheckLine(a1.Point3D, b1.Point3D, a2.Point3D, b2.Point3D)
c1 = (a1\x# = a2\x# And a1\y# = a2\y# And a1\z# = a2\z#)
c2 = (b1\x# = b2\x# And b1\y# = b2\y# And b1\z# = b2\z#)
c3 = (a1\x# = b2\x# And a1\y# = b2\y# And a1\z# = b2\z#)
c4 = (b1\x# = a2\x# And b1\y# = a2\y# And b1\z# = a2\z#)
If (c1 And c2) Or (c3 And c4) Then Return True Else Return False
End Function</textarea><br><br>[b]DX7Const.bb</b><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">Const D3DCULL_NONE = 1
Const D3DCULL_CW = 2
Const D3DCULL_CCW = 3
Const D3DSTENCILOP_KEEP = 1
Const D3DSTENCILOP_ZERO = 2
Const D3DSTENCILOP_REPLACE = 3
Const D3DSTENCILOP_INCRSAT = 4
Const D3DSTENCILOP_DECRSAT = 5
Const D3DSTENCILOP_INVERT = 6
Const D3DSTENCILOP_INCR = 7
Const D3DSTENCILOP_DECR = 8
Const D3DSTENCILOP_FORCE_DWORD = $7FFFFFFF
Const D3DCMP_NEVER = 1
Const D3DCMP_LESS = 2
Const D3DCMP_EQUAL = 3
Const D3DCMP_LESSEQUAL = 4
Const D3DCMP_GREATER = 5
Const D3DCMP_NOTEQUAL = 6
Const D3DCMP_GREATEREQUAL = 7
Const D3DCMP_ALWAYS = 8
Const D3DCMP_FORCE_DWORD = $7FFFFFFF
Const D3DBLEND_ZERO = 1
Const D3DBLEND_ONE = 2
Const D3DBLEND_SRCCOLOR = 3
Const D3DBLEND_INVSRCCOLOR = 4
Const D3DBLEND_SRCALPHA = 5
Const D3DBLEND_INVSRCALPHA = 6
Const D3DBLEND_DESTALPHA = 7
Const D3DBLEND_INVDESTALPHA = 8
Const D3DBLEND_DESTCOLOR = 9
Const D3DBLEND_INVDESTCOLOR = 10
Const D3DBLEND_SRCALPHASAT = 11
Const D3DBLEND_BOTHSRCALPHA = 12
Const D3DBLEND_BOTHINVSRCALPHA = 13
Const D3DBLEND_FORCE_DWORD = $7FFFFFFF
Const D3DRS_ANTIALIAS= 2
Const D3DRS_TEXTUREPERSPECTIVE = 4
Const D3DRS_ZENABLE = 7
Const D3DRS_FILLMODE = 8
Const D3DRS_SHADEMODE = 9
Const D3DRS_LINEPATTERN = 10
Const D3DRS_ZWRITEENABLE = 14
Const D3DRS_ALPHATESTENABLE = 15
Const D3DRS_LASTPIXEL = 16
Const D3DRS_SRCBLEND = 19
Const D3DRS_DESTBLEND = 20
Const D3DRS_CULLMODE = 22
Const D3DRS_ZFUNC = 23
Const D3DRS_ALPHAREF = 24
Const D3DRS_ALPHAFUNC = 25
Const D3DRS_DITHERENABLE = 26
Const D3DRS_ALPHABLENDENABLE = 27
Const D3DRS_FOGENABLE = 28
Const D3DRS_SPECULARENABLE = 29
Const D3DRS_ZVISIBLE = 30
Const D3DRS_STIPPLEDALPHA = 33
Const D3DRS_FOGCOLOR = 34
Const D3DRS_FOGTABLEMODE = 35
Const D3DRS_FOGSTART = 36
Const D3DRS_FOGEND = 37
Const D3DRS_FOGDENSITY = 38
Const D3DRS_EDGEANTIALIAS = 40
Const D3DRS_COLORKEYENABLE = 41
Const D3DRS_ZBIAS = 47
Const D3DRS_RANGEFOGENABLE = 48
Const D3DRS_STENCILENABLE = 52
Const D3DRS_STENCILFAIL = 53
Const D3DRS_STENCILZFAIL = 54
Const D3DRS_STENCILPASS = 55
Const D3DRS_STENCILFUNC = 56
Const D3DRS_STENCILREF = 57
Const D3DRS_STENCILMASK = 58
Const D3DRS_STENCILWRITEMASK = 59
Const D3DRS_TEXTUREFACTOR = 60
Const D3DCLEAR_TARGET = $00000001
Const D3DCLEAR_ZBUFFER = $00000002
Const D3DCLEAR_STENCIL = $00000004</textarea> <br><br></td></tr></table><br>
<a name="697703"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tom</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here's a demo of my effort, www.tomspeed.com/ss12.zip<br><br>w,s,a,d &amp; mouse to move camera, lmb/rmb shadow alpha value, cursors &amp; kepyad 1,0 moves light<br><br>Works with static geometry only at the moment, I'm just now looking for a solution for skinned meshes, but I don't think it's gonna be too fast whatever I end up with :)<br><br>If you leave the mouse alone when it boots, my FPS settles at 333 fps. 3ghz 32bit XP cpu, ATI x800 gfx card here.<br><br>Had some weird results from other people, like 81fps from an amd 800mhz cpu &amp; radeon 9600 (not bad!) ... but only 24 - 40 fps from a 64bit amd 3500 with a I think an FX 5200 card ?!?!? <br><br></td></tr></table><br>
<a name="697708"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> great job man :-)<br><br>can you please make it open source, or can you at least show <br>me the render code, because the rendering isnt that cute at my system :(... <br><br></td></tr></table><br>
<a name="697714"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> i have just replaced the fan model with the scene of the swifty sample(i got 36 fps and 200 when SPACE pressed)<br><br>your shadow volume function is slow, and my rendering is rubish... how about a deal:<br><br>you can juse whatever you want of our system and i can youse your render function?<br><br>agree? <br><br></td></tr></table><br>
<a name="697794"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Naughty Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> ..hey Tom..this is something what can be used in real project..its seems to be very fast buddy..I hope skinned animated mesh will be supported and then..whoa..circle is rounded..by the way, this is results on my machine..<br><br>290-320 FPS<br>P4, 2.4 GHz, 1 Gig RAM, nVidia 5600FX, 256MB VRAM, Win XP Pro <br><br></td></tr></table><br>
<a name="697824"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#32">[#32]</a></td></tr></table></td></tr><tr ><td class="posttext"> As far as I know Tom released a stencil shadow source some time ago (well at least the BB source that was calling some dx stuff in a dx7test.dll). Tho I guess he improved it since then. Wasn't there a problem with some Graphicscards that are not creating a stencil buffer by default?<br><br>However, great work. This would be really nice, if you both add your work together.<br><br>The speed of stencil shadows isn't that great naturally (Of course, the faster you can make it, the better!). You have to deal with it. For example, higher poly meshes could use an invisible LOD clone for the volume creation. Additionally I'd suggest to use a priority flag for every caster: depending on the machines speed meshes with a certain lower priority won't cast shadows automaticly - or the user may choose a detail level manually. <br><br></td></tr></table><br>
<a name="697842"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mustang</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#33">[#33]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>Had some weird results from other people, like 81fps from an amd 800mhz cpu &amp; radeon 9600 (not bad!) ... but only 24 - 40 fps from a 64bit amd 3500 with a I think an FX 5200 card ?!?!? <br> <br></div><br><br>R9600PRO beats FX5200 and I think that plain 9600 does that too:<br><br><img src="http://www.bjorn3d.com//Material/Images/264_3dmark2001se.gif"><br><br><img src="http://www.bjorn3d.com//Material/Images/264_rtcw.gif"><br><br>Just because it has FX in the name doesn't mean it's fast :)<br><br><a href="http://www.bjorn3d.com/read.php?cID=264" target="_blank">http://www.bjorn3d.com/read.php?cID=264</a> <br><br></td></tr></table><br>
<a name="697906"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >mr.keks</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#34">[#34]</a></td></tr></table></td></tr><tr ><td class="posttext"> "every entity in the space must be at least a shadow receiver."  &lt;- oh, that's definitely a problem... if i make every entity a receiver (i actually don't want my hud to receive shadows...), i'll also have to remove the receiver-entries when i use freeentiy... and i'll have to register new receivers and so on... is there really no other way? :/ <br><br></td></tr></table><br>
<a name="697986"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tom</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#35">[#35]</a></td></tr></table></td></tr><tr ><td class="posttext"> Damn it, that'll teach me to type in a long post then accidentaly lose the page :|<br><br>Anyways, I'll post an updated DLL &amp; info later, then start updating my worklog.<br><br>Inarie: That's not always the case don't worry. It'll just be how Devil has coded his system to work, maybe an oversight in his current method.<br><br>Devil: I'll pass on some info later to you. I finaly have a way to have full control of all render states, including (when it comes to stencil workflow) the all important ZWriteEnable &amp; ZTestEnable.<br><br>The model from Swifts demo, do you mean beethoven? That thing is near 5000 polys! It would hit the frame rate in most shadow volume systems out there.<br><br>On another note, it's NOT a suitable mesh to test with as it's isn't a closed mesh. This causes rendering errors which is a bad idea when you're trying to code stencil shadow routines, you'll be blaming your code and searching for bugs that may not exist! :)<br><br>More later.<br>Tom <br><br></td></tr></table><br>
<a name="697998"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >t3K|Mac</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#36">[#36]</a></td></tr></table></td></tr><tr ><td class="posttext"> tom, this one looks great. i have to say again: you should team up with mark ;-) <br><br></td></tr></table><br>
<a name="698044"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#37">[#37]</a></td></tr></table></td></tr><tr ><td class="posttext"> Great work from both of you.  If it can be made to work a bit faster I'd love to try this out in my verlet engine :)))<br><br>@ Tom / Devils CHild, <br><br>As you seem to be the Shadow specialists atm, a couple of questions ...<br><br>1. As JFK mentions,  is it your intention to include the possibility of the system creating proxy shadow volumes based on a lower poly version of the mesh?  <br><br>2. Again, on a similar note to Jfk, one thing which I've noticed in alot of games ( even some of the next gen stuff ) is that dynamic shadows appear to be disabled on objects which are over a certain distance from the camera .. such a feature would be great for slower systems.<br><br>3. With such systems and a static light source is it possible to render a static lightmap mesh which is included in the rendering process but not the volume building?<br><br>4. Can directional light sources be used with stencil shadows?<br><br>Cheers<br>Stevie <br><br></td></tr></table><br>
<a name="698047"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#38">[#38]</a></td></tr></table></td></tr><tr ><td class="posttext"> 1. yes, i tried that a certain time ago and it looks really ugly!<br>2. you mean that object shoul cast their shadows only a few meters far, and that the self-shadowing of spheres should be improved... that is not so easy and i think it would need shaders!<br>3. maybe i include static objects when i have time for it :) let's see..<br>4. what you mean is parallel light, and this is supported in the update a few screens above(the 3 codeboxes are the include files!). it works pretty easy! he just moves the light source very far away from the scene. so it is a 99.9% parallel light <br><br></td></tr></table><br>
<a name="698054"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#39">[#39]</a></td></tr></table></td></tr><tr ><td class="posttext"> Re ..<br><br>1.  It probably would look ugly if they also self-shadowed 'cos your visible mesh will be different.  Without self-shadowing I'm sure they'd be fine.<br>2.  Not as low as a a few metres and not really related to self shadowing.  Simply a built in lod type thing to ensure that closer objects project shadows but those further than a certain threshold from the camera don't.<br>3.  Fair enough. Looks forward to seeing what you do.<br>4. Ah ... never head it being called parallel light before and haven't tried the new demo.<br><br>Cheers<br>Stevie <br><br></td></tr></table><br>
<a name="698085"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tom</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#40">[#40]</a></td></tr></table></td></tr><tr ><td class="posttext"> 1: In my own system, I've not looked at that yet.<br>2: That'd be easy to implement<br>3: Stencil shadows render on top of whatever other light you use, lots of games do it<br>4: Mine just does point lights at the moment, but same answer as #2. <br><br></td></tr></table><br>
<a name="698087"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#41">[#41]</a></td></tr></table></td></tr><tr ><td class="posttext"> wrote you a little email tom :) <br><br></td></tr></table><br>
<a name="698128"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dock</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#42">[#42]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just tried this out, it runs great - nice work! ^-^ <br>It's a shame that self shadowing is a bit 'poppy', but otherwise the results are great. <br><br>1. Is there any way to specific a specific mesh to have no self shadowing, but still cast and receive shadows?<br><br>2. Do you think it would it be possible to make this code work with vertex animated objects in future? <br><br></td></tr></table><br>
<a name="698129"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#43">[#43]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think people are forgetting too, that alot of games don't cast shadows onto the actual geometry, but they create a less complex mesh to receive the shadows. A bit like creating a low poly version of your landscape, that is invisible and only used for collisions.<br><br>Shadow systems look great guys :o) <br><br></td></tr></table><br>
<a name="698376"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#44">[#44]</a></td></tr></table></td></tr><tr ><td class="posttext"> thx guys :)<br><br>@dock:<br>1. yes, it would be easy to impement, but nobody wants that :P<br>2. i guess not. i got too many problems with b3d animations! <br><br></td></tr></table><br>
<a name="698380"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#45">[#45]</a></td></tr></table></td></tr><tr ><td class="posttext"> @ Devils Child, <br><br>1. If it's easy then you should consider it as a user option.  I for one would like to see it in 'cos some of that self shadowing can look awful on low poly meshes.<br><br>I can't deny that it had potential to be a great system though.  <br><br>Stevie <br><br></td></tr></table><br>
<a name="698409"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sledge</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#46">[#46]</a></td></tr></table></td></tr><tr ><td class="posttext"> 1: Ditto - if it's easy to implement then it would be appreciated. <br><br></td></tr></table><br>
<a name="698423"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mike0101</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#47">[#47]</a></td></tr></table></td></tr><tr ><td class="posttext"> This topic is very good, everybody try to make something good shadow system.<br>But I don't understand  the author of Blitz3D why not <br>give help or why not give shadow system at Blitz3D.<br>I like Blitz and this is an opinion only.<br>Today every lowcost gamemaker system (free engines too)  has shadow system. <br><br></td></tr></table><br>
<a name="698424"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >t3K|Mac</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#48">[#48]</a></td></tr></table></td></tr><tr ><td class="posttext"> i want it! no self shadowing.... as an user option. this would be great. <br><br></td></tr></table><br>
<a name="698426"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mike0101</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#49">[#49]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, selfshadowing is a plus thing optional, but a fast , simple shadow system would be very important <br><br></td></tr></table><br>
<a name="698428"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#50">[#50]</a></td></tr></table></td></tr><tr ><td class="posttext"> first at all i have to improve rendering, because all i will improve now, will be overwritten by the new render algorithm! thats the meaning of why it doesnt support it yet :P <br><br></td></tr></table><br>
<a name="698431"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mike0101</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#51">[#51]</a></td></tr></table></td></tr><tr ><td class="posttext"> The must important thing is the efficiency.<br>I was buy adreyman system for 25 $ but is very buggy<br>and slow and no support no anwers from the russian. <br>Now in a simple TPS action game are 3-6-8 lowpoly (cca. 1.500/model ) animated models in same time on scene.<br>The map ( 30.000 ), other dynamic objects ( 10.000).<br>A good shadowsystem can (must) render this with good 40 - 50 fps.<br><br>Right? <br><br></td></tr></table><br>
<a name="698437"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#52">[#52]</a></td></tr></table></td></tr><tr ><td class="posttext"> yes :) but this is not that easy, our system works takes 20 millisecs on 20.000 shadow polys! to initialise 20.000 polys it takes 1:20 minutes when you disable file-saving. when you enable: 110 millisecs. so you can say it is fast enough! <br><br></td></tr></table><br>
<a name="698471"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#53">[#53]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>The model from Swifts demo, do you mean beethoven? That thing is near 5000 polys! It would hit the frame rate in most shadow volume systems out there.<br><br>On another note, it's NOT a suitable mesh to test with as it's isn't a closed mesh. This causes rendering errors which is a bad idea when you're trying to code stencil shadow routines, you'll be blaming your code and searching for bugs that may not exist! :)<br> <br></div><br><br>Muahahaha!  That's what you get for stealing my model which I stole from a website with free 3D models and duplicating my demo exactly!<br><br>Actually I don't care.  I'm more bemused than anything.  <br><br>And I would like to point out that MY system handles boned vertex-animated B3D meshes, AND beethovens! :-) <br><br></td></tr></table><br>
<a name="698473"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Chroma</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#54">[#54]</a></td></tr></table></td></tr><tr ><td class="posttext"> Tom, those shadows look just awesome.  They'd go well with my rpg I'm working on.  All the walls are very simple geometry.  Can't wait to try this out. <br><br></td></tr></table><br>
<a name="698609"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#55">[#55]</a></td></tr></table></td></tr><tr ><td class="posttext"> sswift:andreyman stole your shadow system demo exactly, too! and i did, to compare them :)<br><br>tom: yeah, i would like to see it, too! <br><br></td></tr></table><br>
<a name="699117"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Xilvan</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#56">[#56]</a></td></tr></table></td></tr><tr ><td class="posttext"> When I start a demo, I get the following error:<br>Function 'DX7_SetSystemProperties' not found <br><br></td></tr></table><br>
<a name="699130"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#57">[#57]</a></td></tr></table></td></tr><tr ><td class="posttext"> move the userlibs into your blitz userlib directory. <br><br></td></tr></table><br>
<a name="699131"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Carrot</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#58">[#58]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi and well done on this fantastic contribution!<br><br>I have one problem though. You say that you've had problems using B3D files, but because MD2s aren't meshes, it means that most of my current models (all md2/b3d) are unusable with the shadow system!<br>I'd imagine that most people here use one or both of these for animated models and so it might be worth trying to figure out a way of getting b3d models to work with the engine...<br><br>thanks, and good luck! <br><br></td></tr></table><br>
<a name="699133"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >mr.keks</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#59">[#59]</a></td></tr></table></td></tr><tr ><td class="posttext"> b3d models work! but those models that vertices you cant handle with b3d might make trouble (md2, terrains, bsp) <br><br></td></tr></table><br>
<a name="699140"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#60">[#60]</a></td></tr></table></td></tr><tr ><td class="posttext"> carrot: i tried to figure it out, but there was no way yet!! b3d animations might be possible some day, but not md2!! because md2 models are no meshes, and they havent got any vertices or triangles which can be accessed by blitz!<br><br>for terrains you just have to use a meshterrain loader ;)<br><br>btw: andreymans stencil fw libary doesnt support b3d animations yet, too. so dont matter about that! <br><br></td></tr></table><br>
<a name="699180"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JustLuke</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#61">[#61]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just because another library doesn't support b3d animations does not mean that it isn't important. I've been following this thread with interest (and I'm impressed with your work), but I suspect that for many, if not most, people, support for animated b3d models is essential. <br><br></td></tr></table><br>
<a name="699183"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >kevin8084</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#62">[#62]</a></td></tr></table></td></tr><tr ><td class="posttext"> if you go here to look at the md2 specs, I think that perhaps the vertices and triangles CAN be accessed:<br><a href="http://tfc.duke.free.fr/coding/md2-specs-en.html" target="_blank">http://tfc.duke.free.fr/coding/md2-specs-en.html</a> <br><br></td></tr></table><br>
<a name="699185"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Barliesque</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#63">[#63]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'll second JustLuke's comments.<br><br>I'm hoping that GrumpyOldMan's library may offer a new solution.  We'll have to wait and see how that progresses, but at the moment, it appears to handle boned animation better than Blitz's own system.  So perhaps, his library may also allow access to the information needed to create stencil shadows for bone-animated meshes. <br><br></td></tr></table><br>
<a name="699188"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Barliesque</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#64">[#64]</a></td></tr></table></td></tr><tr ><td class="posttext"> ...also, at some point in the render process, the data of an MD2 is turned into polygons, just like any other mesh.  Again, it's a matter of gaining access to the necessary data. <br><br></td></tr></table><br>
<a name="699261"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >kevin8084</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#65">[#65]</a></td></tr></table></td></tr><tr ><td class="posttext"> After playing around with the .md2 format I came up with a little program that accesses a single vertex. I checked it against the .md2 model that I created and it is accurate. The code can be adapted to read ALL of the vertices and triangles. Pardon the mess as I left in unused types (they WILL be used, however, if you are to read the entire .md2 file). The file has only minimal error checking and you have to provide your own model (I have the filename hard coded)<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">


Graphics 800,600

Type model_t 
   Field magic; must be 844121161
   Field version; must be 8
   Field skinWidth; 
   Field skinHeight; 
   Field frameSize; 
   Field numSkins; 
   Field numVertices; number of vertices per frame
   Field numTexCoords; 
   Field numTriangles; 
   Field numGlCommands; 
   Field numFrames; 
   Field offsetSkins; 
   Field offsetTexCoords; 
   Field offsetTriangles; the position in bytes from the beginning of the file to the triangle data
   Field offsetFrames; 	the position in bytes from the beginning of the file to the frames data
   Field offsetGlCommands; 
   Field offsetEnd; the position in bytes from the beginning of the file to the end of the file
End Type

Type vertex
	Field x,y,z
End Type

Type triangleVertex_t
   Field vertex;
   Field lightNormalIndex;
End Type

Type scale
	Field x#,y#,z#
End Type

Type translate
	Field x#,y#,z#
End Type


Type frame_t
    Field  scale
    Field translate
    Field name$
    Field vertices.triangleVertex_t
End Type

Type vertexIndices
	Field x#,y#,z#
End Type

Type textureIndices
	Field x#,y#,z#
End Type

Type triangle_t
	Field vertexIndices
   	Field textureIndices
End Type

Type textureCoordinate_t
	Field s
	Field t
End Type

Type glCommandVertex_t
	Field s#
	Field t#
	Field vertexIndex
End Type

Type md2_skin_t
	Field name$
End Type

; dim vert#(3)
; vert(i)=(triangleVertex_t.vertex(i)*frame_t.scale(i))+frame_t.translate(i)
; The above is how to convert the scaled vertex position into it's real position


ReadMd2Model("temp.md2",model_t)
WaitKey()
End

Function ReadMD2Model(filename$,model_t)
file=OpenFile(filename$)
If Not file
	End
End If
header=CreateBank(15308*10) ; the 15308 is what I found in offsetEnd
amount=ReadBytes(header,file,0,15308)
If amount=0 Then
	End
End If
CloseFile file

skins_offset=PeekInt(header,44) ; offset for skins
num_skins=PeekInt(header,20) ; number of skins
num_tris=PeekInt(header,32) ; number of triangles
num_verts=PeekInt(header,24) ; number of vertices
tris_offset=PeekInt(header,52) ; offset for triangles
frame_offset=PeekInt(header,56) ; offset to frame start
num_frames=PeekInt(header,40) ; number of frames
frame_size=PeekInt(header,16) ; frame size
end_file=PeekInt(header,64) ; offset for end of file
scaled_x=PeekByte(header,frame_offset+24)
scaled_y=PeekByte(header,frame_offset+28)
scaled_z=PeekByte(header,frame_offset+32)
x_scale=PeekFloat(header,frame_offset)
y_scale=PeekFloat(header,frame_offset+4)
z_scale=PeekFloat(header,frame_offset+8)
x_trans=PeekFloat(header,frame_offset+12)
y_trans=PeekFloat(header,frame_offset+16)
z_trans=PeekFloat(header,frame_offset+20)
real_x=scaled_x*x_scale+x_trans
real_y=scaled_y*y_scale+y_trans
real_z=scaled_z*z_scale+z_trans
Print "Number of Vertices per frame: "+num_verts
Print "Size of each frame: "+frame_size
Print "X Scale: "+PeekFloat(header,frame_offset)
Print "Y Scale: "+PeekFloat(header,frame_offset+4)
Print "Z Scale: "+PeekFloat(header,frame_offset+8)
Print "X Translate: "+PeekFloat(header,frame_offset+12)
Print "Y Translate: "+PeekFloat(header,frame_offset+16)
Print "Z Translate: "+PeekFloat(header,frame_offset+20)
Print "First Vertex X Scaled Position: "+PeekByte(header,frame_offset+24)
Print "First Vertex Y Scaled Position: "+PeekByte(header,frame_offset+28)
Print "First Vertex Z Scaled Position: "+PeekByte(header,frame_offset+32)
Print "Real Position of First Vertex is: "+real_x+","+real_y+","+real_z
freeBank header
End Function
</textarea><br><br>**** EDIT *******<br>Looking back at my code I see some minor errors such as not making some variables "float". The principle, however, remains the same. This code is free for any to use, by the way.<br>Kevin <br><br></td></tr></table><br>
<a name="699311"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#66">[#66]</a></td></tr></table></td></tr><tr ><td class="posttext"> thx kevin. i will check it out now :) <br><br></td></tr></table><br>
<a name="699366"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >kevin8084</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#67">[#67]</a></td></tr></table></td></tr><tr ><td class="posttext"> No problem. Hope that it helps :) <br><br></td></tr></table><br>
<a name="699580"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hellei</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#68">[#68]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have downloaded your DSS_Release_0.6b, but when I start the program, he sais he doesn't find the getcamrangestart. Where can I download it? <br><br></td></tr></table><br>
<a name="699593"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#69">[#69]</a></td></tr></table></td></tr><tr ><td class="posttext"> just added b3d animations:<br><img src="http://xware.chat-blitz.de/scripts/upload/Screen42.jpg"><br><br>now *.x *.3ds and *.b3d animated objects are supported!<br>the next release will be in aproxx 2 months(without garanty) <br><br></td></tr></table><br>
<a name="699597"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >b32</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#70">[#70]</a></td></tr></table></td></tr><tr ><td class="posttext"> he, that's nice work devil! <br><br></td></tr></table><br>
<a name="699666"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jhocking</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#71">[#71]</a></td></tr></table></td></tr><tr ><td class="posttext"> This looks really interesting.  However, the sudden changes in shading of polygons is really jarring.  Is there any way to smooth that out?<br><br><div class="quote"> I have downloaded your DSS_Release_0.6b, but when I start the program, he sais he doesn't find the getcamrangestart. Where can I download it? <br></div><br>I was getting that error to until I copied the userlibs into Blitz3D's userlibs directory. <br><br></td></tr></table><br>
<a name="699749"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >mongia2</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#72">[#72]</a></td></tr></table></td></tr><tr ><td class="posttext"> thanks<br><br>2 months .........<br><br><br>goood work! <br><br></td></tr></table><br>
<a name="699764"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#73">[#73]</a></td></tr></table></td></tr><tr ><td class="posttext"> i dont know how to smooth it out. maybee playing arroud with the ambient light should do it... <br><br></td></tr></table><br>
<a name="699766"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#74">[#74]</a></td></tr></table></td></tr><tr ><td class="posttext"> There is a bug in the Init function.<br><br>It tries to init 1024x786 instead of 1024x768 :) (wanted to see its true speed so put it into full screen, with no waittimer and flip 0 ... get up to 100 FPS in the example 5 on my 7600Go which is quite nice :) <br><br></td></tr></table><br>
<a name="699770"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#75">[#75]</a></td></tr></table></td></tr><tr ><td class="posttext"> oops mistyped (sry)<br>a wonder you got 100 fps in the stress test!<br>i get 30 fps, and i am using the stress test to see wether my current optimazion was good, or not... <br><br></td></tr></table><br>
<a name="699838"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >t3K|Mac</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#76">[#76]</a></td></tr></table></td></tr><tr ><td class="posttext"> nice work!!! <br><br></td></tr></table><br>
<a name="700139"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flame</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#77">[#77]</a></td></tr></table></td></tr><tr ><td class="posttext"> I get only 10 FPS on my end :|<br><br>Anyways, is it possible to use MD2's or will it simply not work...<br><br>If it can't, does any one know of a MD2 -&gt; B3D converter? I would really like to use this in a game but until then, I'll use my theory: Squish everything to a pancake, move it down at the feet, then keep it there until the Y axis of the parent model is constant then move the Y of the shadow. It doesn't do Devil's stencil system, but for something that doesn't kill FPS that much and it's the only thing I know to use... <br><br></td></tr></table><br>
<a name="700155"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#78">[#78]</a></td></tr></table></td></tr><tr ><td class="posttext"> if you wanna get more speed, you have to turn off the debugger!!<br><br>if have studied the md2 model format, but without any result!<br>btw: there is no shadow system which supports md2!! (or at least no STENCIL shadow system or a better one ...) <br><br></td></tr></table><br>
<a name="700161"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Baystep Productions</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#79">[#79]</a></td></tr></table></td></tr><tr ><td class="posttext"> Umm I get a missing function error for <br><br>MoveEntity ShadowPlane, 0, 0, GetCamRangeStart(ShadowCam) + .001<br><br>That GetCamRangeStart function is not there. <br><br></td></tr></table><br>
<a name="700226"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flame</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#80">[#80]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, I use MD2's alot, and I've made a shadow system... but with no name. I'll take a screen shot of what I'm using/made.<br><br>EDIT: <img src="http://firecatdan.googlepages.com/MD2_shadow.jpg"><br>...AH Heck... I have no clue what the forum cmds are... <br><br></td></tr></table><br>
<a name="700339"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mustang</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#81">[#81]</a></td></tr></table></td></tr><tr ><td class="posttext"> forum codes:<br><br><a href="http://www.blitzbasic.com/faq/faq_entry.php?id=2" target="_blank">http://www.blitzbasic.com/faq/faq_entry.php?id=2</a> <br><br></td></tr></table><br>
<a name="700354"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#82">[#82]</a></td></tr></table></td></tr><tr ><td class="posttext"> flame: is this a stencil shadow system or a texture shadow system? <br><br></td></tr></table><br>
<a name="700372"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Carrot</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#83">[#83]</a></td></tr></table></td></tr><tr ><td class="posttext"> Devil: Do we need to wait for the next release in 2 months before we can use the new code for the b3d models?<br><br>Also, it seems that using the sample code provided Kevin above should make md2 models possible at some stage.<br><br>Again, great work. <br><br></td></tr></table><br>
<a name="700373"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#84">[#84]</a></td></tr></table></td></tr><tr ><td class="posttext"> b3d models are not supported in the 0.6 beta above^^<br>but you can implentate your shadow code, and let the b3d models be receivers only until in 2 months!<br><br>also i cannot promise that b3d models will work perfectly. my ant is working seamless, but all my other models are doing strange things!<br><br>we'll see whether b3d models will work seamless! if not, don't be angry at me :) <br><br></td></tr></table><br>
<a name="700439"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tom</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#85">[#85]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Devils Child: I'll be on Irc at 7pm GMT if you wanna catch up on this stuff ok :)<br><br><div class="quote"> but all my other models are doing strange things! <br></div><br><br>I've had problems with skinned meshes too. This is what I think is the cause.<br><br>To get a transformed vert from a skinned mesh, I store all vertices positions in the local space of the bone which has major influence on them. I'm discarding blended weighting for now in the hope it speeds things up a bit.<br><br>Bones in a mesh have a 'rest pose'. You must do the above routine when the bones are in this rest pose, else their recorded local bone offset will be wrong, which will cause your TFormB3DVertex() function (or DLL or whatever method you're using) to return bad values.<br><br>When creating a skinned mesh, record the rest pose at frame 0, this seems to work ok for me.<br><br>You can just see the errors this causes on this robot2.b3d mesh, look closely at the gun/hands and the antenna, there's what looks like ghost geometry. This mesh has no keyed rest pose at frame 0!<br><br>In fact, as a quick test, load 2 versions of your mesh, one using LoadMesh() and the other using LoadAnimMesh()<br><br>If they don't look exactly the same... you're going to have problems.<br><br><img src="http://www.tomspeed.com/ss3.jpg"> <br><br></td></tr></table><br>
<a name="700446"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#86">[#86]</a></td></tr></table></td></tr><tr ><td class="posttext"> i'll be there! <br><br></td></tr></table><br>
<a name="700521"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#87">[#87]</a></td></tr></table></td></tr><tr ><td class="posttext"> here is another screenshot to keep you entertaining :)<br> <img src="http://xware.chat-blitz.de/scripts/upload/Screen43.jpg"> <br><br></td></tr></table><br>
<a name="700606"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flame</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#88">[#88]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sry I didnt' respond in a long time. No, my system doesn't use either... well, It's not a true stencil system, and it's not texture based... so I'm not sure what to put it under as...<br><br>All that happens is I do some tweeking with the model that has to be shadowed so it creates a shadow of itself... Is that stencil, because if it is, then I might have the only MD2 compatible Shadow system... <br><br></td></tr></table><br>
<a name="700610"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#89">[#89]</a></td></tr></table></td></tr><tr ><td class="posttext"> as far as i understood, you are squishing the md2 mesh down to the floor, right?<br><br>this is no stencil shadow system. and it is not very compatible :/ <br><br></td></tr></table><br>
<a name="700621"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flame</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#90">[#90]</a></td></tr></table></td></tr><tr ><td class="posttext"> For something that barely hurts FPS and is understandable, it works fine with me... sure, it's not the BEST thing out there, but again... for something that requires no brain surgery or headaches...or both... <br><br></td></tr></table><br>
<a name="700976"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#91">[#91]</a></td></tr></table></td></tr><tr ><td class="posttext"> i can understand you, and now i wanna tell you the story of my life:<br><br>one year ago, in the thread "stencil shadow volume demo" by tom, if found my idea to make a stencil shadow system.<br>i tested the code, but at first it was ATI unfirendly! But then he made a fix, and i tried harder on it!<br>then i made a function which creates volumes from each polygon. not just from the edges! that means a caster with 100 triangles would cast 600 shadow polys. just *6! this looks weird with toms old stencil demo, so i improved it to the carmacks reverse by braincell!<br>well, for a long time i frozen all researches, cause i thought, i never make a good shadow system :D.<br>2 months ago, daredevil made a stencil shadow system, too. he had a good volume system, but a slow software-stencil-buffer. so we decided to move together. so we put his volume function optimized into my current system! then, i made some samples and we published the first alpha version of this shadow system! 3 weeks after it he made a new algorithm for shadow volumes...and when he was ready, i checked out that aglorithm. it took a lot of time to initialise the casters, so i build a *.shw caching file.<br>then i was playing arround with bona animation, and found out, that they can easily be set to a shadow caster by recursive setting each bones!<br>then i published it to this 0.6 beta!<br>not b3d models are barely working and the system was more flexible ever :)<br><br>this was the time of my life!<br>between all that sentences were hundrets of ours of research!<br><br>bye <br><br></td></tr></table><br>
<a name="701008"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dock</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#92">[#92]</a></td></tr></table></td></tr><tr ><td class="posttext"> Great work Devil's Child. You and Tom and Daredevil have achieved amazing things with this system. <br><br>I'd love to see an EXE demo of the ant test you have there, even if there is no source. I'd still like to be able to disable self-shadowing on certain objects if at all possible. <br><br></td></tr></table><br>
<a name="701141"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#93">[#93]</a></td></tr></table></td></tr><tr ><td class="posttext"> first tom and i have to improve the rendering, before i can improve all other wishes :) but i will do it! <br><br></td></tr></table><br>
<a name="701166"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DareDevil</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#94">[#94]</a></td></tr></table></td></tr><tr ><td class="posttext"> Good .... Good Work!! <br><br></td></tr></table><br>
<a name="701231"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DareDevil</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#95">[#95]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Devils Child<br><br>Hi All<br><br><br>This is a light optimization , in the "sample 5 " is increment 10-15%<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Function CreateVolume(light, parallel = False)
	;===&gt;
	RangeLight# = 10 ; is a range light, all object over range is jump
	;===&gt;
	light_x# = EntityX(light, True) * (1 + parallel * 1000000)
	light_y# = EntityY(light, True) * (1 + parallel * 1000000)
	light_z# = EntityZ(light, True) * (1 + parallel * 1000000)
	volume_lenght = RangeLight
	;===&gt;
	For etem.ETE_Mesh = Each ETE_Mesh
		;===&gt;
		cnt_tris = etem\cnt_tris
		For v = 0 To cnt_tris
			;===&gt;
			etet.ETE_Triangle = TriangleClone(v)
			CloneTriangle(etet, etem\tri[v])
			;===&gt;
			v1.Point3D = etet\v1
			;===&gt;
			TFormPoint v1\x#, v1\y#, v1\z#, etem\ent, 0
			v1\x# = TFormedX()
			v1\y# = TFormedY()
			v1\z# = TFormedZ()
			;===&gt;
			TFormNormal etet\nx#, etet\ny#, etet\nz#, etem\ent, 0
			normlight_x# = (v1\x# - light_x#) * TFormedX()
			normlight_y# = (v1\y# - light_y#) * TFormedY()
			normlight_z# = (v1\z# - light_z#) * TFormedZ()
			;===&gt;
			If (normlight_x# +  normlight_y# + normlight_z#) &lt; 0 Then
				;===&gt;
				etet\tri = -1
			Else
				;===&gt;
				v2.Point3D = etet\v2
				TFormPoint v2\x#, v2\y#, v2\z#, etem\ent, 0
				v2\x# = TFormedX()
				v2\y# = TFormedY()
				v2\z# = TFormedZ()
				;===&gt;
				v3.Point3D = etet\v3
				TFormPoint v3\x#, v3\y#, v3\z#, etem\ent, 0
				v3\x# = TFormedX()
				v3\y# = TFormedY()
				v3\z# = TFormedZ()
				;===&gt;
			EndIf
			;===&gt;
		Next
		;===&gt;

		For v = 0 To cnt_tris
			etet = TriangleClone(v)
			If etet\tri =&gt; 0 Then
				ta = etet\ta
				tb = etet\tb
				tc = etet\tc
				If ta &gt; -1 Then check1 = TriangleClone(ta)\tri Else check1 = -1
				If tb &gt; -1 Then check2 = TriangleClone(tb)\tri Else check2 = -1
				If tc &gt; -1 Then check3 = TriangleClone(tc)\tri Else check3 = -1
				If check1 &lt; 0 Or check2 &lt; 0 Or check3 &lt; 0 Then
					v1 = etet\v1
					v2 = etet\v2
					v3 = etet\v3
					If check1 &lt; 0 Then
						rax# = v1\x# + (v1\x# - light_x#) * volume_lenght
						ray# = v1\y# + (v1\y# - light_y#) * volume_lenght
						raz# = v1\z# + (v1\z# - light_z#) * volume_lenght
						rbx# = v2\x# + (v2\x# - light_x#) * volume_lenght
						rby# = v2\y# + (v2\y# - light_y#) * volume_lenght
						rbz# = v2\z# + (v2\z# - light_z#) * volume_lenght
						vert1 = AddVertex(VolumeSurf, v1\x#, v1\y#, v1\z#)
						vert2 = AddVertex(VolumeSurf, rax#, ray#, raz#)
						vert3 = AddVertex(VolumeSurf, rbx#, rby#, rbz#)
						vert4 = AddVertex(VolumeSurf, v2\x#, v2\y#, v2\z#)
						AddTriangle(VolumeSurf, vert1, vert2, vert3)
						AddTriangle(VolumeSurf, vert1, vert3, vert4)
					EndIf
					If check2 &lt; 0 Then
						rbx# = v2\x# + (v2\x# - light_x#) * volume_lenght
						rby# = v2\y# + (v2\y# - light_y#) * volume_lenght
						rbz# = v2\z# + (v2\z# - light_z#) * volume_lenght
						rcx# = v3\x# + (v3\x# - light_x#) * volume_lenght
						rcy# = v3\y# + (v3\y# - light_y#) * volume_lenght
						rcz# = v3\z# + (v3\z# - light_z#) * volume_lenght
						vert1 = AddVertex(VolumeSurf, v2\x#, v2\y#, v2\z#)
						vert2 = AddVertex(VolumeSurf, rbx#, rby#, rbz#)
						vert3 = AddVertex(VolumeSurf, rcx#, rcy#, rcz#)
						vert4 = AddVertex(VolumeSurf, v3\x#, v3\y#, v3\z#)
						AddTriangle(VolumeSurf, vert1, vert2, vert3)
						AddTriangle(VolumeSurf, vert1, vert3, vert4)
					EndIf
					If check3 &lt; 0 Then
						rax# = v1\x# + (v1\x# - light_x#) * volume_lenght
						ray# = v1\y# + (v1\y# - light_y#) * volume_lenght
						raz# = v1\z# + (v1\z# - light_z#) * volume_lenght
						rcx# = v3\x# + (v3\x# - light_x#) * volume_lenght
						rcy# = v3\y# + (v3\y# - light_y#) * volume_lenght
						rcz# = v3\z# + (v3\z# - light_z#) * volume_lenght
						vert1 = AddVertex(VolumeSurf, v1\x#, v1\y#, v1\z#)
						vert2 = AddVertex(VolumeSurf, rax#, ray#, raz#)
						vert3 = AddVertex(VolumeSurf, rcx#, rcy#, rcz#)
						vert4 = AddVertex(VolumeSurf, v3\x#, v3\y#, v3\z#)
						AddTriangle(VolumeSurf, vert1, vert3, vert2)
						AddTriangle(VolumeSurf, vert1, vert4, vert3)
					EndIf
				EndIf
			EndIf
		Next
	Next
End Function
</textarea><br><br><br>the system is improve create a check for control object in range light, if object in range calculate, if not jump<br><br>;)<br><br>Bye <br><br></td></tr></table><br>
<a name="701258"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#96">[#96]</a></td></tr></table></td></tr><tr ><td class="posttext"> allright dare :)<br>just improved it!<br>cya <br><br></td></tr></table><br>
<a name="701431"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Panno</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#97">[#97]</a></td></tr></table></td></tr><tr ><td class="posttext"> cool  <br><br>can i disable the self shadows ? i mean if i will have shadows <br>only on grounds or walls ? <br><br></td></tr></table><br>
<a name="701447"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#98">[#98]</a></td></tr></table></td></tr><tr ><td class="posttext"> no, i said not yet! it will be supported in the next demo! <br><br></td></tr></table><br>
<a name="701705"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bytecode77</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#99">[#99]</a></td></tr></table></td></tr><tr ><td class="posttext"> <b>~CLOSED~</b><br><br><b>this shadow thread is now ready to burst.<br>please write ahead in the new stencil shadow thread 2!!!<br>http://www.blitzbasic.com/Community/posts.php?topic=62809</b><br><br><i>@any moderator: close this thread please!</i> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
