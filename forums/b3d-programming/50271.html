<!DOCTYPE html><html lang="en" ><head ><title >Division</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Division</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Division</a><br><br>
<a name="559042"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Subject: Integer division in blitz3D.<br><br> 11 / 2 = 5 ; Fine - just as expected.<br><br>-11 / 2 = -5 ; Fine - just as expected.<br><br>a = -11<br>a / 2 = -6 ; Uh?<br><br>Discuss. <br><br></td></tr></table><br>
<a name="559049"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sledge</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Look at it this way and you can see it's consistent:<br><pre class=code>
a=-10
While Not KeyHit(1)
Print a+"/2     "+a/2
a=a+1
WaitKey
Wend
</pre><br><br>EDIT: Sorry, my original post's code was not actually very illustrative of the consistency - what's there now is better.<br><br>Anyway, to give an example: If you try 9/2 (which is 4.5) Blitz will return 4, which is rounded down. Well, if you round down -4.5 then you get -5. This accounts for the discrepancy you are seeing. <br><br></td></tr></table><br>
<a name="559108"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Floyd</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is actually a bug. The results with constants are evaluated by the compiler and are correct.<br><br>The problem with variables is that Blitz tries to optimize division by a power of 2, replacing it with a sign-preserving shift. This rounds the wrong direction for negative numbers.<br><pre class=code>
m1 = -1

Write " -1 divided by 7, 8, 9  =  "
Print ( m1 / 7 ) +  ", " + ( m1 / 8 ) + ", " +  ( m1 / 9 )

WaitKey</pre><br>No matter what you think about which way the rounding should go it is clear those three numbers should be the same. In fact they should all be zero. <br><br></td></tr></table><br>
<a name="559238"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Banshee</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> floor(), int(), ceil() <br><br></td></tr></table><br>
<a name="559324"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Koriolis</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> That's still a bug Becky Rose.<br>By using Floor, int or ceil you'll effectively work around the problem, but only because then blitz will work on floats, in which case it won't try to be clever and use shifting. Also you then have a more limited range of values where it can work (basically the range of the floating points matissa), and not the whole integer range. <br><br></td></tr></table><br>
<a name="559335"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Look at it this way and you can see it's consistent: <br></div><br>Yes, it is consistent - consistently wrong! :)<br><br><div class="quote"> The problem with variables is that Blitz tries to optimize division by a power of 2, replacing it with a sign-preserving shift. This rounds the wrong direction for negative numbers. <br></div><br>That does explain it. TBH, I'm gob-smacked this bug exists ("-1 / 8 = -1" :O lol) - it could cause bugs that would be very hard to track down. Mark must have realized there'd be problems doing it this way with negative numbers. :/<br><br><div class="quote"> No matter what you think about which way the rounding should go... <br></div><br>As far as I'm concerened, an integer division should simply throw away any remainder - whether it's +ve or -ve numbers involved. Blitz is supposed to appeal to novice programmers who have little understanding of what a compiler is doing under the hood. When encountering such a bug, they (and me) would just see the results as being plain wrong. We shouldn't have to take bugs like this on the chin and accept them, IMO. Silly.<br><br>[/end rant] :) <br><br></td></tr></table><br>
<a name="559342"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sledge</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>Yes, it is consistent - consistently wrong! :)<br> <br></div><br><br>The point being that, because it's consistent, you can account for it. You don't have to account for it using floats, either. <br><br></td></tr></table><br>
<a name="559343"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> The point being that, because it's consistent, you can account for it. <br></div><br>I understand what you mean, my point was that we shouldn't have to. :) <br><br></td></tr></table><br>
<a name="559368"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sledge</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>I understand what you mean, my point was that we shouldn't have to. :) <br> <br></div><br><br>I know what you're saying. The opposite side of the argument would be to ask why folk should have to put up with slower, more scientifically accurate math in a game-oriented BASIC.<br><br>ie <a href="http://www.blitzbasic.com/Community/posts.php?topic=39883&amp;hl=floating%20point%20error" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=39883&amp;hl=floating%20point%20error</a><br><br>It's also not like it isn't documented:<br><a href="http://www.blitzbasic.com/faq/faq_entry.php?id=35" target="_blank">http://www.blitzbasic.com/faq/faq_entry.php?id=35</a><br><br>EDIT: Although, oddly, the docs in the first link and the second make slightly different claims. It would be nice to be able to switch to whichever method was required - grant you that. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
