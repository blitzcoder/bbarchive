<!DOCTYPE html><html lang="en" ><head ><title >Passworded screensaver</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Passworded screensaver</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Passworded screensaver</a><br><br>
<a name="600047"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Graythe</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> When boxes loaded with XP and Win2K resume from a passworded screensaver Blitz breaks with "Memory acces violation". I believe the error actually occurs when the screensaver is invoked. Oddly, it doesn't happen when the screensaver is not password protected.<br><br>Is there a way around that? (other than remove password protection?) <br><br></td></tr></table><br>
<a name="602229"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Graythe</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> bump <br><br></td></tr></table><br>
<a name="602705"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'd also like to know a solution for this, esp. since I aint got Win2000 or XP here, but I used to release Screensavers :/<br>Graythe - did you try to isolate the problem? With a very simlpe failsave program? Are you sure it isn't caused by your program only because it's paused by the prompt that will mess up the timing?<br><br>Maybe you should try something like <br><br>While keydown(1)=0<br>delay 10<br>wend<br>end<br><br>So you know it's not your fault when it happens again. <br><br></td></tr></table><br>
<a name="602744"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Graythe</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi JFK,<br><br>I wrote a VB6 dll that checks the name of the active window. If it returns an empty string then I do not call renderworld. When the name of the active window reverts to a readable sequence then I do a clearworld and re-select the graphics mode and recreate objects.<br><br>Probably I'm using a nuke  to crack a walnut but it seems to work!<br><br>It will also solve some problems that I had with the calculation of durations in BB. My thanks to Kurtz and Kanati for information which allowed me to create the dll (www.vbadvance.com).  <br><br><a href="http://blitzbasic.com/Community/posts.php?topic=28210" target="_blank">http://blitzbasic.com/Community/posts.php?topic=28210</a> <br><br></td></tr></table><br>
<a name="602820"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Graythe</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Screensavers eh? What with all the wizz wazz like password and configurable options an' all?! <br><br></td></tr></table><br>
<a name="602825"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Picklesworth</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I wrote a VB6 dll that checks the name of the active window. If it returns an empty string then I do not call renderworld. When the name of the active window reverts to a readable sequence then I do a clearworld and re-select the graphics mode and recreate objects. <br></div><br>I'm almost sure you can do this in Blitz with User32.decls. <br><br></td></tr></table><br>
<a name="602828"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Graythe</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Doh! <br><br></td></tr></table><br>
<a name="603353"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Everything other than /S in the commandline will end the app immediately. So there's no Configuration or Preview (/C + /P). The password dialog is done by Windows, isn't it?<br><br>The hard part is to make sure the App will find its content. I came away from renaming the exe to scr and copying it to the system folder. Instead I use the Clickteam Installer that allows to install something as the active Screensaver, it will also open the Screensaver settings after the installation.<br><br>One problem with a SCR that is copied to the system folder is: Due to some internal windows stuff the SCR app won't know where it was started, so even when its media files are in the system folder too (wich is real messy) it won't find it unless you do a "ChangeDir SystemProperty$("systemdir")" first. Now when you use the Clickteam installer, it will create a Folder in th Programs Folder of the OS, so you can keep the mediafiles there, a much more proper solution. Nevertheless you still need to do a ChangeDir SystemProperty$("appdir") first to allow your screensaver to find it's media files. And the EXE still need to be renamed to .SCR. <br><br></td></tr></table><br>
<a name="603403"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yan</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> The password dialogue is done by Windows, isn't it? <br></div>On 2K, XP and NT (I think), then yes, but it's the responsibility of the screen saver on 9x.<br><br><br>@Graythe - Try running this and let your saver start (wont work for a preview)...<pre class=code>; user32.decl
;------------------
; .lib "user32.dll"
; SystemParametersInfo(uAction%, uParam%, lpvParam*, fuWinIni%) : "SystemParametersInfoA"
; MessageBeep(wType%)
;------------------

; Should work on 9x, 2K and XP

Const SPI_GETSCREENSAVERRUNNING = $72

Local time = MilliSecs()
Local bnk = CreateBank(1)

Repeat
    If (MilliSecs() - time) &gt;= 1000
        If SystemParametersInfo(SPI_GETSCREENSAVERRUNNING, 0, bnk, 0)
            If PeekByte(bnk, 0) Then MessageBeep(-1)
        EndIf
        time = MilliSecs()
    EndIf
    
    Delay 10
Until KeyHit(1)

End</pre>Here's a more fully featured version I have. Written for BMax, but should be easy enough to convert...<pre class=code>'Conversion of some C source I found on the net.
' Should work on 9x, 2K, XP and NT

Extern "win32"
    Function GetLastError()
    Function SystemParametersInfo(uiAction, uiParam, pvParam Var, fWinIni) = "SystemParametersInfoA@16"
    Function OpenDesktop(lpszDesktop$z, dwFlags, fInherit, dwDesiredAccess) = "OpenDesktopA@16"
    Function CloseDesktop(hDesktop)
End Extern

Const ERROR_ACCESS_DENIED = $5
Const SPI_GETSCREENSAVERRUNNING = $72
Const MAXIMUM_ALLOWED = $2000000

Function SaverIsRunning()
    Local running = False
        
    If SystemParametersInfo(SPI_GETSCREENSAVERRUNNING, 0, running, 0)
        If running Then Return True
    EndIf
        
    Local hDesk = OpenDesktop("screen-saver", 0, False, MAXIMUM_ALLOWED)
    If hDesk
        CloseDesktop(hDesk)
        Return True
    EndIf
    
    If GetLastError() = ERROR_ACCESS_DENIED Then Return True
End Function</pre> <br><br></td></tr></table><br>
<a name="603727"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Graythe</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Yan,<br><br>I appreciate the effort, and I can see that your own construction is somewhat finer than my own - but the screensaver isn't the problem - it's the password routine. Only if the user's screensaver is passworded does my BB app fall over. No matter, my cludge is working. <br><br></td></tr></table><br>
<a name="603770"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Graythe</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, actually my cludge doesn't work, not all the time. I'll try the user32 route, thanks for illuminating the path. <br><br></td></tr></table><br>
<a name="604068"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Graythe</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, your User32.decls seems to work just dandy:- It tells me if the screensaver is running and also seems pin the error to renderworld after a passworded screensaver has been invoked.<br><br>Using Yan's method I can determine if the screensaver is running and do a clearworld (and also introduce a .1 second delay so as to allow other tasks more cpu cycles - before I did that the screensaver ran like it was powered by steam). When the screensaver is no longer running I delay for 2 seconds (1 second seems to work - much less that that and the dreaded "Unable to create 3D scene" message appears) and re-initialise the screen.<br><br>I'm purely guessing that the windows password routine somehow makes BB's hooks to the front/backbuffers invalid. However, other games/apps don't seem to suffer?!<br><br>Thanks, once again, for the routemap! <br><br></td></tr></table><br>
<a name="604084"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Graythe</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nope - I tell a lie - the app just fell over and it didn't seem to be doing a renderworld at the time. Hmmm. <br><br></td></tr></table><br>
<a name="604186"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Graythe</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> O.k. I've actually made some progress.<br><br>There seems to be a small period of time when the PC can be between applications. There is also the password window which can be running when the screensaver is not.<br><br>By implementing extra checks to cover those events it seems to hang together. <br><br></td></tr></table><br>
<a name="604427"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> What happens if I end the screensaver as soon as the mouse is moved ar a key was pressed? Shouldn't this end it before the crash happens? And wouldn't windows restart the screensaver if the password was not valid?<br>Unfortunately I cannot test it because I ain't got XP here. <br><br></td></tr></table><br>
<a name="604446"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yan</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hehe...Sounds like you're having fun there Graythe. ;o)<br><br>I'd somehow got it into my head that that API call would return true for the password window too. Sorry about that, but it seems like you're getting there, at least. :o)<br><br>If all else fails, you do have the option of disabling the screen saver whilst your app is running...<br><pre class=code>Const SPI_SETSCREENSAVEACTIVE = $11
SystemParametersInfo(SPI_SETSCREENSAVEACTIVE, False, Null, 0) ;'Disables
SystemParametersInfo(SPI_SETSCREENSAVEACTIVE, True, Null, 0) ;'Enables</pre>It's a bit heavy handed but better than a crash. <br><br></td></tr></table><br>
<a name="604726"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Graythe</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thats a great idea!<br><br>@JFK - Yep -If the screensaver starts and I immediately move the mouse or jab a key then the screensaver collapses without issue. I've never tried inputting the wrong password (so far) - so I dunno - yet.<br><br>Possibly - just very occaisionally, I think... the call to determine if the screensaver is running doesn't return me the correct result. More likely (of course) is that my code isn't flexible enough. Just possibly, windows starts the screensaver halfway thru a screen update so I may need to check before each graphical operation? Oh hum. Dunno how feasible that is.<br><br>I may have to resort to being heavy handed. It's great to know that it is an option! <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
