<!DOCTYPE html><html lang="en" ><head ><title >Problem with EntityParent et ScaleEntity</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Problem with EntityParent et ScaleEntity</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Problem with EntityParent et ScaleEntity</a><br><br>
<a name="442226"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RepeatUntil</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here is my problem: <br>  - I have an entity, which is not uniformely scale, and which is animated<br>  - I have an other entity that I parent to this entity<br>  - Problem: this entity is also scaled (as soon as I parent it to the scaled animated entity )!!!<br>  <br>  This problem is very well described here:<br>    <a href="http://www.blitzbasic.co.nz/b3ddocs/command.php?name=entityparent" target="_blank">http://www.blitzbasic.co.nz/b3ddocs/command.php?name=entityparent</a><br>  Some other people already ran into this problem:<br><a href="http://www.blitzbasic.co.nz/Community/posts.php?topic=37541" target="_blank">http://www.blitzbasic.co.nz/Community/posts.php?topic=37541</a><br><br>  But I can not used the solution proposed there (use scaleMesh instead of scaleEntity) because several entities share the same mesh, and I want to scale every entity differently...<br><br>  I was trying to find for a workaround for hours... Do someone has a solution for me???????<br><br>  Thanks! <br><br></td></tr></table><br>
<a name="442234"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Klaas</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> why not use a pivot!?<br>- create a pivot<br>- parent the scaled mesh to the pivot<br>- parent the other entity to the pivot<br>- apply all moves and rotations to the pivot insted of the scaled mesh <br><br></td></tr></table><br>
<a name="442318"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tom</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Scaling Child entitys along with their parents is common amongst 3D programs.<br><br>Thought of using ScaleMesh instead? <br><br></td></tr></table><br>
<a name="442374"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RepeatUntil</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Klaas: that's not possible in my case. In fact I have an entity (a player) and this player has the second entity (a ball) in his hand. And as the player is animated, the ball has to follow the hand of the player. In summary, I do this:<br>  scaleEntity player, 1., 2., 1.<br>  Find the hand (bone) -&gt; pivotHand<br>  animate player<br>  ...<br>  entityParent ball, pivotHand<br>    -&gt; And the ball is then scaled!!<br><br>  I tried to use an intermediate pivot like this:<br>  newPivot = createPivot()<br>  entityParent ball, newPivot<br>  entityParent newPivot, pivotHand<br>  -&gt; The ball is also scaled!!<br><br>  And, as for your solution, Klaas, I don't see how I can implement it as the ball has to follow the pivot pivotHand, which moves with the animation.<br><br>@Tom: as I said, I can't use scaleMesh instead  because several entities share the same mesh, and I want to scale every entity differently... <br><br>So still no solution..... <br><br></td></tr></table><br>
<a name="442831"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RepeatUntil</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I tried to use ScaleMesh instead of ScaleEntity, but that's even worse!! As my entity is animated with bones (using milkshape3D), scaleMesh mess up everything : the mesh itself + the animation. My entity is completely deformed!!<br><br>  So what can I do???????? <br><br></td></tr></table><br>
<a name="442853"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> why don't you scale down the other entity, on the factor of how much the parent entity is scaled up?<br><br><pre class=code>
ScaleEntity Parent,4,6,4

ScaleEntity Child,2,2,2
EntityParent Child,Parent
</pre><br><br>to...<br><pre class=code>
ScaleEntity Parent,4,6,4

ScaleEntity Child,0.5,0.333,0.5
EntityParent Child,Parent
</pre><br><br>Take the scale of the child, and divide the number by the parents scale.<br><br>ScaleEntity Parent,4,6,4<br>ScaleEntity Child,2,2,2<br><br>x = 2/4<br>y = 2/6<br>z = 2/4<br><br>That should sort it. The maths might be a bit off, but it should sort the problem :o) <br><br></td></tr></table><br>
<a name="442856"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Or, why not scale the entities before you parent them? <br><br></td></tr></table><br>
<a name="443232"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RepeatUntil</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Ross, I will try your first solution, even if it's not too practical given that the child is parented only from time to time and to different parents (and hence scale).<br><br>For your second proposition, I already do that, and the problem is still the same. <br><br></td></tr></table><br>
<a name="443240"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> This surprises me, I thought if you parent the ball to the hand AFTER scaling the hand, the ball will remain unscaled.<br>Well maybe I'm wriong, but I have this feeling.<br><br>Are you sure you didn't accidently set the parent before.<br><br>Probably you should do a renderworld, visualy check the ball, then parent it to the hand, then check again. <br><br></td></tr></table><br>
<a name="443395"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RepeatUntil</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, I am sure that I didn't parent the ball before. The ball is parented to the hand only when taken by a player, AFTER of course that the player was scaled. <br><br></td></tr></table><br>
<a name="444743"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RepeatUntil</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Very strange!!!<br>I did some more tests on this problem.<br>First I note that the solution of Ross doesn't work.<br>And now the surprising thing:<br>- if I parent the ball to the player with NO previous rotation of the ball --&gt; the ball is not scaled, everything is OK<br>- if I do a rotation first on the ball, and if after I parent the ball to the player --&gt; the ball is scaled, and there is no simple way to anti-scale it (as proposed by Ross)<br><br>So, in fact, the child is scaled as soon as its axis are not any more aligned with the one of the player (y axis not any more parallel). That sounds very strange! I don't see any way to unscale the ball easily: I should unscale it after a rotation in its space, but there that's very difficult, and I am not sure it's possible within blitz... <br><br></td></tr></table><br>
<a name="444838"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> See when your doing the scaleentity, have your tried using the global flag when it's parented?  It should scale the entity from a world point of view, same with positioning, use the global flag. Does that work? <br><br></td></tr></table><br>
<a name="444842"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Basically what i see happening with this, is when you scale the parent, the parents actual axis's are scaled too. Not for the parents movement, but for the childs movement. Like, if you scaled the parent 1,2,1, and moved the child one unit, it would move the child two world units. I suggest scaling the parent in a modelling program then loading it in. <br><br></td></tr></table><br>
<a name="444844"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, maybe not actually. Scale your parent as normal, but when positioning and scaling you child, use this<br><br><pre class=code>
ScaleEntity child,1,2,1,True
PositionEntity child,EntityX(child,True),EntityY(child,True)+1,EntityZ(child,True),True
</pre><br><br>Position the entity using entityx,y and z with true flags, and just add on which way you want to move them. Does the exact same as move entity, except it's global. Make sure you have the true flag at the very end in too :o)<br><br>That seems to work over here. <br><br></td></tr></table><br>
<a name="444862"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think it would be more logical to not attach the ball to your scaled player but instead position the ball at the location of the hand each frame using <br><br>positionentity ball,entityx(hand,true),entityy(hand,true),entityz(hand,true)<br><br>if the ball position is dependent on the orientation of the hand then child a pivot to the hand to get a correct reference point for positioning the ball <br><br></td></tr></table><br>
<a name="446219"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RepeatUntil</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Finally, I use the solution of skidracer! That works well! Thanks to everyone... <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
