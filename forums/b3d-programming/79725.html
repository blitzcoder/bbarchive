<!DOCTYPE html><html lang="en" ><head ><title >Triangle sorting / blending question</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Triangle sorting / blending question</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Triangle sorting / blending question</a><br><br>
<a name="895119"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Roland</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey all,  <br><br>strange question for ya.  If I create a mesh that has additive blending (entityblend,3) is there any way anyone can think of that I can control how the triangles are sorted?  I need to try to eliminate pieces of the mesh by having black triangles overlap the other pieces of the mesh (and black blended additively is transparent).  But it doesn't work.<br><br>End goal is to be able to cut chunks out of a flat surface using other chunks of a mesh without doing any fancy intersection math.  <br><br>Any ideas?<br><br>thanks,<br>roland <br><br></td></tr></table><br>
<a name="895165"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Fancy intersection math may be unavoidable.<br><br>Can you explain more about what you're trying to do - in a gameplay context?  e.g  Are you trying to do landscape deformation? <br><br></td></tr></table><br>
<a name="895168"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Roland</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks, Stevie.  <br><br>Not doing landscape stuff -- it's actually for a 2d light effect that is used in a puzzle-style game.  Currently the implementation that I have (which works ok) is to raycast out from a point source along an arc of a fixed width to determine if there is an intersection with a line that would block the light.  If such an intersection is found, I mark it and construct a mesh based on all of these intersections.<br><br>The problem is that as the number of lights grows, in order to have a smooth effect, I need to cast a vast number of rays.... Imagine a scenario where I have 5 lights, and each casts 100 rays... If there are 5 cubic objects that block those rays, each has 4 sides, or 4 lines.  So in order to properly build my mesh, I'm now looking at 5*100*20 iterations per frame.  that's 10,000 intersection checks per frame.<br><br>Granted, I've done all sorts of optimizations to try to limit this, but it is still possible to create scenarios that can bring everything to its knees.  <br><br>This is why I'm trying to seek out a new approach.  If, for example, I could simply draw a mesh that represented the light (without any intersection), then draw on top of that a mesh that represented all of the shadows from every line that the light would generate and have it knock out the light mesh were they overlapped, it would accomplish my goal without any complicated iteration at all.  But I haven't been able to come up with a system that does that, short of rendering the entire screen to a huge texture every frame and using that as a texture.  Again, though, if I have 9 lights, this becomes too expensive as well, and has a tendency to look crappy.<br><br>i'm open to any creative ideas! <br><br></td></tr></table><br>
<a name="895232"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, I think I get you ...<br><br>Assume MAINcamera is the main cam you use to show your visible level.<br>Set up a LIGHTcamera and position it far away from the main scene.<br>Set cameraclsmode to false, true<br>Create your shadow mesh<br>Set entityfx to 1<br>Colour it black<br>Set it's entityorder to be drawn last<br>Parent it to the LIGHTcamera<br>Position it the same as the visible level, but relative to the LIGHTcamera, rather than the MAINcamera.<br>Parent all your light cone meshes to the LIGHTcamera<br><br>Then do a 2 pass render ....<br><br>;render main camera<br>cameraprojmode MAINcamera, 2<br>cameraprojmode LIGHTcamera, 0<br>renderworld()<br><br>;render light camera over the top<br>cameraprojmode MAINcamera, 0<br>cameraprojmode LIGHTcamera, 2<br>renderworld()<br><br><br>Stevie <br><br></td></tr></table><br>
<a name="895295"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Roland</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Stevie,<br><br>Looks like this approach is for simple shadowmapping, right?  I've implemented this as a test before and unfortunately found that it wouldn't be fast enough.  Here's why:<br><br>1) The lights can each be of different colors, which is part of the puzzle-gameplay of the game.  which means that I can't just render 1 pass for all the lights<br><br>2) In truth, I actually need to be able to determine which light is responsible for contributing to the solution of the puzzle, so I might even need to be able to separate ALL of the lights.  That would be a maximum of 9 lights, meaning 10 render passes per frame... That would be asking a lot, I think!<br><br>But I should probably give this some more thought.  Even if I could keep it down to 3 passes, it might still be faster than my existing solution.<br><br>Thanks for the tip, and let me know if you have any other thoughts! <br><br></td></tr></table><br>
<a name="895355"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Can you post some mock screenshots to show the effect you're looking for  or maybe even what you have just now 'cos I'm none the wiser.  Plus, <br>are you actually using hardware lights? <br><br></td></tr></table><br>
<a name="895360"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Roland</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, here's a mockup of the effect in photoshop.  You can see there are 3 lights here, each of a different color.  The grey squares are the shadow casters.    You can see that the effect is pretty much just 2d.  <br><br>What's not shown here is that in-game, I need to know exactly what is being illuminated in order to use the lights to solve puzzles.  Currently, I just use the mesh to do that (calculating whether or not points are in the triangles of the mesh), but I'm sure there are other ways that could be accomplished as well.<br><br>If you refer back to my description before, hopefully it will make more sense now.  Using the white circles as the origin of the lights, i would cast my rays out starting at the far left of the light beam, and go until the end of the right, testing each ray for intersection with a shadow caster...  <br><br>Does this help?<br><img src="http://www.prayercore.com/temp/lightmockup.jpg"> <br><br></td></tr></table><br>
<a name="895362"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Roland</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> oh yeah -- in answer to your second question.  no hardware lights are needed for it.  it's all just done using additive mesh. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
