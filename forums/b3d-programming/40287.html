<!DOCTYPE html><html lang="en" ><head ><title >3d Slope Maths</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >3d Slope Maths</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >3d Slope Maths</a><br><br>
<a name="451830"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PaulJG</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> ----------------------- terrain height = 0<br><br>O<br>|          O<br>|          |<br>y1         y2<br><br>Not too sure if the above makes sense, but..<br><br>I've got this car which is facing to the right, the back wheel is at height y1 - the front wheel y2<br><br>As you can see its on a downwards slope, at the mo both points are below 0 on the terrain.<br><br>y1= -0.3465     y2= -0.4562<br><br>I'd like to work out the angle that I've got to rotate the car downwards. (x Axis) at the mo the car body is fixed to the back wheel - so I need to rotate the body to the angle of the slope.<br><br>I think I've got to use the Atan2 command, but I'm having problems with the result since its in the negative. (and counting down not up !)<br><br>Please Help !!!. <br><br></td></tr></table><br>
<a name="451832"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AramusM</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> You should be able to use simple trig.<br><br>Tan angle = opp/ adj.<br><br>opp = the difference in height between y1 and y2<br>adj = the difference in x posistion between y1 and y2<br><br>so i think angle = atan(opp/adj)<br><br>Been a while since i've done this stuff but just search for trig on google and you'll get it. <br><br></td></tr></table><br>
<a name="451834"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Pickford</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> atan2 (dy,dx) <br><br></td></tr></table><br>
<a name="451835"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> ** how about the don't get dirty method **<br>Put a pivot at each point.<br>pointEntity p1,p2<br>ang#=entitypitch(p1) <br><br></td></tr></table><br>
<a name="451899"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Can we just broaden this discussion, as I've spent all day tearing my hair out over this.<br>a) I implemented Mark's 'Driver' demo code, but with over 50 cars it slowed down to 1 fps or less, so scratch that.<br>b) Each of my cars has a main pivot (with body, camera, sounds connected etc), then I added a front and back pivot to the main pivot. I wanted to linepick down (to a 'road' mesh) from each to calculate the necessary 'slope' angle, but found that linepicking down returned integers, which were no use.<br>Are you all saying that such pivots should (not follow a master but) align to the terrain/mesh, then calculate the angle? <br><br></td></tr></table><br>
<a name="451909"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >IPete2</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> John,<br><br>Line pick is also a slow command.  Its probably okay for one or a few objects but 50! hmm.<br><br>Phone me on Thursday I have an cool idea which will defiantely help!  ;)<br><br>IPete2. <br><br></td></tr></table><br>
<a name="451913"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jhocking</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> LinePick can return floats; I do it all the time.  You probably are doing things wrong in your code (my guess would be calling PickedX etc. without the pound sign.) <br><br></td></tr></table><br>
<a name="451921"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> My guess is he used<br>a = PickedX() instead of<br>a# = PickedX() <br><br></td></tr></table><br>
<a name="451924"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Pete.<br>Can I share it with everyone?<br>(All I want is a simple method of aligning cars to a mild slope, so they don't stick out the front, and I suspect this is what PaulJG is describing).<br>Anyway Pete, what are you doing online at this time?<br>The missus'll kill you! <br><br></td></tr></table><br>
<a name="451960"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=67" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=67</a> is what I use.  It works fine on terrains, and/or custom terrains if you have a function which will return the height of the terrain at any point.  I guess it could be used fine with linepicks also (although on my old machine linepicks are very slow). <br><br></td></tr></table><br>
<a name="452097"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PaulJG</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> John: I'm using linepick to position the pivots above the terrain. (main back wheel pivot, front pivot, finally the body shell - all coming off the main back pivot)<br><br>So yes.. its exactly the same problem as you, just gotta get the body shell rotated down the angle of the slope. (havent tried the above ideas yet)<br><br>I had a shed load of problems with the child objects, alot of the commands will take the local coords of the child object instead of the global.<br><br>( Cheers Malice for pointing that out in the other thread!. :) ) <br><br></td></tr></table><br>
<a name="452291"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok. So I've spoken to IPete2 and he basically uses Mark's code for one test car, drives the car, and saves all positions and orientations to a file. Like recording, then playback. <br>Thanks Pete, but not quite what I'm looking for.<br><br>Dreamora, I take your point about linepick floats, but it seems that they are too slow anyway.<br><br>I tried to match the pitch of my pivot to the angle towards to the next waypoint, but unless the waypoint is at the exact height of the pivot then as the car approaches it dips its nose down (or up).<br><br>PaulJH, I think you've again summed up the problem succinctly. Any luck yet? <br><br></td></tr></table><br>
<a name="452447"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PaulJG</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeap.. sorted ! :)<br><br>3 pivot points + the main body shell<br>(Ya need the extra third pivot to counter the angle in all directions)<br><br>Here's my external functions if it helps:<br><pre class=code>
Function fixentity_height(ent,ofx,ofy,ofz)
Pick=LinePick(EntityX#(ent,1),EntityY#(ent,1)+20,EntityZ#(ent,1),0,-30,0)
offset#=-(EntityY#(ent,1)-PickedY#())
MoveEntity ent,ofx,offset#+ofy,ofz
End Function

Function fixentity_rotation_height(ob1,ob2_f,ob3_s,ob4)

fixentity_height(ob1,0,0,0)
fixentity_height(ob2_f,0,0,0)
fixentity_height(ob3_s,0,0,0)

yo3#=ATan2 ( EntityY#(ob1)-EntityY#(ob2_f,1),0.4)
yo4#=ATan2 ( EntityY#(ob1)-EntityY#(ob3_s,1),0.2)

RotateEntity ob4,yo3#,0,-yo4#

End Function
</pre><br><br>Eventually I'll do away with the line picks, I know the Y height of quad patches - so I'll find out the vertexes of the nearest quad to the car, find out the difference between the height of the 2 points.. do a calculation to find the car position: <br><br>finally times the remainder (how far the car has travelled across a quad) by the height difference per width unit.<br><br>Should work... I think ! <br><br></td></tr></table><br>
<a name="452460"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Back to the Driver demo:<br><div class="quote"> <br>but with over 50 cars it slowed down to 1 fps or less<br> <br></div><br><br><br>Hmm! Quad2 was based on a rewritten version of this code and it ran fine with 128 cars on a modern computer. It depends on what spec machine youre using..? <br><br></td></tr></table><br>
<a name="452725"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Damien: "it ran fine with 128 cars on a modern computer"<br>Spec is: Pentium 4 1.6G, GeForce4 Ti4200.<br>I understand what you're saying about newer machines, but if linepick is _that_ critical....<br><br>@PaulJG: Elegant code! I'm busy in the middle of rewriting multi-resolution rebooting at the moment. I'll implement your code and test it as soon as I can. Any apparent slowdowns? How many cars are you using? <br><br></td></tr></table><br>
<a name="452730"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PaulJG</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> John: Not cars - tanks !, so I dont really have a speed limit problem as you would with a shed load of cars.<br><br>Still, at the moment my tanks are quite happely travelling up and down the lumps and bumps in the terrain.<br><br>btw.. the '0' in the "RotateEntity ob4,yo3#,0,-yo4#" is where you'd put the objects current yaw. (didnt add that bit till later) <br><br></td></tr></table><br>
<a name="452731"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Paul, as I said at the moment I'm implementing user-choice of screen-res, which means that I now have to go back and rejig all display coordinates for 2D objects.<br>I'll get back to cars as soon as I can.<br>Please keep posting if you make any changes, or finding any new angles (-hah!) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
