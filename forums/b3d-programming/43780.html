<!DOCTYPE html><html lang="en" ><head ><title >Why is this code so slow</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Why is this code so slow</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Why is this code so slow</a><br><br>
<a name="488700"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >D4NM4N</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> The following code is some ive been playing with to wiggle some verticies up n down. Even with just one quad 32x32 'water' type it slows down real bad. Anyone know why? or is it because the vertexcoords command is slow?<br><br><br>For wa.water=Each water<br>  wa\phase=wa\phase+wa\speed<br>  mesh=wa\h <br>  la=0<br>  n_surf = CountSurfaces(mesh)<br>  For s = 1 To n_surf<br>    surf = GetSurface(mesh,s)<br>    n_vert = CountVertices(surf)-1<br>    For v = 0 To n_vert<br>      la=la+wa\speed<br>      VertexCoords surf,v,VertexX(surf,v),(Sin(wa\phase+la)*wa\amplitude),VertexZ(surf,v)<br>    Next<br>  Next<br>  UpdateNormals mesh<br>Next <br><br></td></tr></table><br>
<a name="488714"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Andy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Try to only 'wiggle' one vertex per frame.<br><br>Andy <br><br></td></tr></table><br>
<a name="488727"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >D4NM4N</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> wont that be too slow?<br><br>ive stored the vcount in the water type to eliminate the uneccacery code:<br><br>Function UpdateWater()<br>	For wa.water=Each water<br>		wa\phase=wa\phase+wa\speed<br>		la=wa\phase<br>		wa\v=wa\v+1:<br>		For v = 1 To wa\vcount<br>			la=la+wa\speed<br>			VertexCoords wa\surf,v,VertexX(wa\surf,v),(Sin(la)*wa\amplitude),VertexZ(wa\surf,v)<br>		Next<br>		UpdateNormals wa\h<br>	Next<br>End Function<br><br><br>Would it be faster with an animated mesh? <br><br></td></tr></table><br>
<a name="488730"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shambler</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> How many verts are there?<br><br>How fast is it without the UpdateNormals() function? <br><br></td></tr></table><br>
<a name="488734"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >D4NM4N</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> prety much the same without update.<br><br>its a quad 32x32 single sided <br><br></td></tr></table><br>
<a name="488738"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >flying willy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> moving one vert up to a point, is as slow as moving 100. Because it uploads the entire mesh to the card each frame.  Thats 1024 verts you're moving each frame.<br><br>See if it's any quicker without 1024 sin calls by using a lookup table.<br><br>And debug mode off? <br><br></td></tr></table><br>
<a name="488740"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >D4NM4N</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> ok, back 2 the drawing board. Ill try the lookup table but ultimately i think ill use animated meshes <br><br></td></tr></table><br>
<a name="488744"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >D4NM4N</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> tanks for the help everyone <br><br></td></tr></table><br>
<a name="488746"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> As willy said, adjusting a mesh on the fly can be slow, and moving one vertex forces the entire mesh to be reuploaded to the card.<br><br>I don't know how Blitz's bone system works, but it seems likely to me that most characters will have more than 1024 vertcies in them.  That being the case, and it being the case that thouands of Blitz users have not cried out in pain at bone animated meshes being too slow to do anyhting with, it may be that animating vertcies with bones is faster than animating them manually.  This could be because the 3D card controls the vertex movement in the case of a bone.  Or it could be that Blitz optimizes the mesh uploading for bones.<br><br>But it's an avenue to explore at least.  If you produce a mesh in your 3d program and attach bones to it and load it as a B3D file you might be able to animate water then by moving the bones instead of the vertcies and gain some speed.  <br><br>Maybe. <br><br></td></tr></table><br>
<a name="488798"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shambler</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have alot of animated meshes in my engine.<br><br>Instead of having a large mesh though I use one 4*4 quad mesh and then copyentity that mesh to where it is needed.<br><br>Adjusting the original mesh using VertexCoords means the copies animate too. <br><br>If you get the sine/cos frequency set right they will seamlessly tile next to each other and look like one larger mesh.<br><br>This does not help obviously if your mesh isn't repetetive in shape. <br><br></td></tr></table><br>
<a name="488801"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >flying willy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> I really like that idea. <br><br></td></tr></table><br>
<a name="488830"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bouncer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> updatenormals() is sloooow... <br><br></td></tr></table><br>
<a name="488847"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Shambler:<br>That's a clever idea.  <br><br>But Blitz runs slowly with too many entities, even when they are copies.  <br><br>So you would want to find the right balance between the number of vertices you're animating, and the number of entity copies you make.  It seems to me that unless your ocean waves are very low polygon, or wave very little that a 4x4 grid might not be the best mesh size to work with. <br><br></td></tr></table><br>
<a name="489034"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >doctorskully</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> D-Grafix--<br><br>To approach this from a completely different angle, it appears to me that you are only modifying the y axis.  Why not just use a terrain?  It's much, much faster (not to mention better detailed). <br><br></td></tr></table><br>
<a name="489049"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >D4NM4N</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> "hang on lads ive got an idea" :) <br>what about if i do all the mesh alterations into an animated mesh and animate it? Or move the mesh sideways until the sine peaks match. Is it possible to create an animated mesh within blitz <br><br></td></tr></table><br>
<a name="489054"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I don't know how Blitz's bone system works, but it seems likely to me that most characters will have more than 1024 vertcies in them. That being the case, and it being the case that thouands of Blitz users have not cried out in pain at bone animated meshes being too slow to do anyhting with, it may be that animating vertcies with bones is faster than animating them manually. This could be because the 3D card controls the vertex movement in the case of a bone. Or it could be that Blitz optimizes the mesh uploading for bones. <br></div><br><br>Perhaps there aren't enough Blitz users with bone animated models out there. Blitz does handle them very slowly. They're not done in hardware ( the only way is shaders AFAIK ) but you're right that there must be *some* optmization going on internally, because although it's horribly slow, it's not as horrendously slow as VertexCoords would be. <br><br></td></tr></table><br>
<a name="489055"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shambler</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes you can with SetAnimKey()...not sure if it takes into account vertex positions and I've not got Blitz near me to try it out but it sounds like it should work. <br><br></td></tr></table><br>
<a name="489066"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tom</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> setanimkey is for entity position/rotation/scale only. Use lookup tables as someone suggested, and if the deformation isn't extreme, calling it less frequently. <br><br></td></tr></table><br>
<a name="489130"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >D4NM4N</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks everyone, <br><br>i need a pretty dense mesh because i want to simulate tiny ripples on the water that effect a cubemap ive decided to use a movement method with fall-in fall-out zones as an animated mesh. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
