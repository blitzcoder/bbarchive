<!DOCTYPE html><html lang="en" ><head ><title >How to skin a window the NON-slow way?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >How to skin a window the NON-slow way?</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >How to skin a window the NON-slow way?</a><br><br>
<a name="1231698"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi all. I found a code that can skin my window, but the problem is it is EXTREMELY slow. It takes 3 seconds to load which should only take half a second to a second to load.<br><br>Can someone please show an example of how to skin an "interface" PNG image to a regular window and the ability to use alpha# from 0 to 255 so that the window is not completely invisible but also not completely visible just like Windows Vista &amp; up (Windows 7 preferably)?<br><br>Thanks alot guys &amp; happy 4th of July!<br><br>Sincerely, <br><br>~GF <br><br></td></tr></table><br>
<a name="1231883"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Can someone please assist?<br><br>Thank You so kindly!<br><br>Have a GREAT day!<br><br>Sincerely, <br><br>~GF <br><br></td></tr></table><br>
<a name="1231910"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >wmaass</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Notwithstanding other issues, 3 seconds to load seems reasonable IMHO. Are you trying to do a border-less, shaped window or something? What is this code you found? <br><br></td></tr></table><br>
<a name="1231937"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm basically trying to skin my own window you know like with a transparent title, the ability to make the window lose the whole title bar, and the ability to make the app look sleek &amp; clean. =) <br><br></td></tr></table><br>
<a name="1231953"></a>

<a name="1231954"></a>

<a name="1231955"></a>

<a name="1231965"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >wmaass</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I see. Can't really help there though I've done stuff with shaped/transparent windows with some C# WPF apps before. You might consider looking at AutoHotkey (http://www.autohotkey.com) which can manipulate windows in interesting ways.<br><br>Then again if you can live with 3 seconds to launch your app (I would) and it looks the way you want I would totally stick with that. <br><br></td></tr></table><br>
<a name="1232066"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rroff</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Doing that with B3D is quite advanced and requires fairly extensive knowledge of Windows UI programming even to do it in a language that supports it better.<br><br>Some people might know how to improve the code you have for performance but there won't be many people who have the time to create sample code for something like that from scratch unless they have extensive knowledge of it. <br><br></td></tr></table><br>
<a name="1232109"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, well here's the code: <br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">; ==============================
; Skin Window
; ==============================

Global skin=SkinApp("interface.png",$FF00FF)

api_ShowWindow(SystemProperty$("AppHWND"), 1)

	Repeat
	
		If MouseHit(1)

			End

		EndIf
	
		;Draw skin
		Draw_Skin(skin, 0, 0)

			Color 0, 0, 0
	
				Text GraphicsWidth()/2, GraphicsHeight()/2, "Press ESC to Exit", 1, 1
				Text GraphicsWidth()/2, GraphicsHeight()/2+20, "or", 1, 1
				Text GraphicsWidth()/2, GraphicsHeight()/2+40, "Click window to exit", 1, 1
	
			Color 255, 255, 255
	
		Flip
	
	Until KeyHit(1)

End

; ==============================
; Function
; ==============================
Function SkinApp%(Image$,MaskColor%)
	Local app=api_GetActiveWindow()
	
	;size of cli area
	Local cli=LoadImage(Image$)
	ScaleImage(cli, 2, 2)
	Graphics3D(ImageWidth(cli),ImageHeight(cli), 0, 2)
	SetBuffer BackBuffer()

	api_ShowWindow app,2
	
	;remove all borders around the cli aera
	Local bmp=LoadImage(Image$)
	ScaleImage bmp, 2, 2
	Local x=api_GetSystemMetrics($07)
	Local y=api_GetSystemMetrics($08)+api_GetSystemMetrics($04)		
	Local region=api_CreateRectRgn(x,y,x+GraphicsWidth(),y+GraphicsHeight())	

	Local yoffset = -1-(api_GetSystemMetrics($4)+api_GetSystemMetrics($2E))
	Local xoffset = -1-api_GetSystemMetrics($2D)

	;fix visual problem on non-XP computer
	If Not Instr(SystemProperty("OS"),"XP",1)	
		x=x+xoffset
		y=y+yoffset
	EndIf 

	;remove all useless pixels 
	Local pixel,px,py,c
	For py=0 To ImageHeight(bmp)-1
		For px=0 To ImageWidth(bmp)-1
		
			c=ReadPixelFast(px,py,ImageBuffer(bmp))	And $00FFFFFF 		

			If c=MaskColor
				pixel=api_CreateRectRgn(x+px,y+py,x+px+1,y+py+1)
				api_CombineRgn region,region,pixel, 3
				api_DeleteObject pixel
			EndIf 
			
		Next
	Next
		
	;set visible region
	api_SetWindowRgn(app,region,True)

	api_ShowWindow app,1

	Return bmp
End Function

Function Draw_Skin(skin, x, y)

	DrawBlock skin, 0, 0

End Function</textarea><br><br>Here's the example interface I drew quickly on paint: <br><br><img src="http://i.imgur.com/KWxdI2Z.png"><br><br>When downloading the image, rename it to: interface.png<br><br>To run this demo, you will need the following user32.decls commands, your user32.decls file should look something like this: <br><br>user32.decls: <br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">.lib "user32.dll"
api_GetSystemMetrics% (nIndex%) : "GetSystemMetrics"
api_SetWindowRgn% (hWnd%, hRgn%, bRedraw%) : "SetWindowRgn"
api_ShowWindow% (hwnd%, nCmdShow%) : "ShowWindow"</textarea><br><br>You will also need the following gdi32.decls file: <br><br>gdi32.decls: <br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">.lib "gdi32.dll"
api_CombineRgn% (hDestRgn%, hSrcRgn1%, hSrcRgn2%, nCombineMode%) : "CombineRgn"
api_CreateRectRgn% (X1%, Y1%, X2%, Y2%) : "CreateRectRgn"
api_DeleteObject% (hObject%) : "DeleteObject"</textarea><br><br>That should be all of it.<br><br>If you can't be bothered to add these to your user32.decls file &amp; your gdi32.decls file, just make a backup of both files then recreate user32.decls with the correct functions from above &amp; gdi32.decls with the correct functions from above. Just copy and paste.<br><br>Thanks, and have a GREAT morning everyone!<br><br>Sincerely, <br><br>~GF <br><br></td></tr></table><br>
<a name="1232511"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Can someone please assist?<br><br>Thank you so kindly!<br><br>Have a GREAT evening! :)<br><br>Sincerely, <br><br>~GF <br><br></td></tr></table><br>
<a name="1232525"></a>

<a name="1232531"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yan</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I was about to rebuke you for not searching the forum as I posted a slightly faster version of the above code years ago. However, I searched and couldn't find in myself. ;o)<br><br>It probably got annihilated by 'The Purge'. so...<br><br><a href="http://www.pasteall.org/pic/73836" target="_blank"><b><u>skin.png</u></b></a><br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">;---------------------------------------------------------------------------------
; User32.decls
;==============
;
;.lib "user32.dll"
;
;FindWindow%(ClassName$, WindowName$)
;GetSystemMetrics%(nIndex%) : "GetSystemMetrics"
;SetWindowRgn%(hWnd%, hRgn%, bRedraw%) : "SetWindowRgn"
;ReleaseCapture%()
;SendMessage%(hWnd%, Msg%, wParam%, lParam%)
;
;---------------------------------------------------------------------------------
;
; Gdi32.decls
;=============
;
;.lib "Gdi32.dll"
;
;CreateRectRgn%(nLeftRect%, nTopRect%, nRightRect%, nBottomRect%)
;CombineRgn%(hrgnDest%, hrgnSrc1%, hrgnSrc2%, fnCombineMode%)
;DeleteObject%(hObject%)
;
;---------------------------------------------------------------------------------

Const SM_CYCAPTION  = 4
Const SM_CXDLGFRAME = 7
Const SM_CYDLGFRAME = 8

Const SW_HIDE = 0
Const SW_SHOW = 5

Const RGN_XOR = 3

t = MilliSecs() ;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;

title$ = "test"
AppTitle title$
blitz_hnd = FindWindow("Blitz Runtime Class", title$) ; Find this window

img = LoadImage("skin.png")
window_w = ImageWidth(img)		
window_h = ImageHeight(img)
FreeImage img

Graphics3D window_w, window_h, 0, 2

ShowWindow(blitz_hnd, SW_HIDE)

x_off = GetSystemMetrics(SM_CXDLGFRAME)
y_off = GetSystemMetrics(SM_CYCAPTION) + GetSystemMetrics(SM_CYDLGFRAME)

rectrgn = CreateRectRgn(x_off, y_off, x_off + window_w, y_off + window_h)

img = LoadImage("skin.png")
img_w = ImageWidth(img) - 1
img_h = ImageHeight(img) - 1
img_buff = ImageBuffer(img)

LockBuffer img_buff

For pix_y=0 To img_h
	start_flag = 0
	start_x = 0
	For pix_x=0 To img_w
	
		c=ReadPixelFast(pix_x, pix_y, img_buff) And $F8F8F8 		

		If c=$F800F8 ; Mask Color - Magenta
			If start_flag = 0
				start_flag = 1
				start_x = pix_x
			EndIf
		Else
			If start_flag
				start_flag = 0
				mask_line = CreateRectRgn(x_off + start_x, y_off + pix_y, x_off + pix_x, y_off + pix_y + 1)
				CombineRgn(rectrgn, rectrgn, mask_line, RGN_XOR)
				DeleteObject(mask_line)
			EndIf
		EndIf 			
	Next
	If start_flag
		mask_line = CreateRectRgn(x_off + start_x, y_off + pix_y, x_off + pix_x, y_off + pix_y + 1)
		CombineRgn(rectrgn, rectrgn, mask_line, RGN_XOR)
		DeleteObject(mask_line)
	EndIf
Next

UnlockBuffer img_buff

SetWindowRgn(blitz_hnd, rectrgn, 1)

ShowWindow(blitz_hnd, SW_SHOW)

;-------------------------------------TEST---------------------------------------

tot = MilliSecs() - t ;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;

Repeat
	DrawBlock img, 0, 0
	
	If MouseDown(1)
		ReleaseCapture()
		SendMessage(blitz_hnd, $A1, 2, 0)
	EndIf
	
	Text MouseX(), MouseY(), tot
	
	Delay(1)
	Flip 0
Until KeyHit(1)

End</textarea><br><br><br>As for translucency...<br><a href="http://msdn.microsoft.com/en-us/library/ms997507.aspx" target="_blank"><b><u>http://msdn.microsoft.com/en-us/library/ms997507.aspx</u></b></a><br><br>A quick glance suggests that this may be a way to go for the whole thing. <br><br></td></tr></table><br>
<a name="1232529"></a>

<a name="1232532"></a>

<a name="1232533"></a>

<a name="1232535"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yan</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you just want a 'border-less' window, which is what I think you're *really* after, there's always this...<br><br><a href="/post.php?topic=62470&amp;post=698005" target="_blank"><b><u>http://www.blitzbasic.com/Community/post.php?topic=62470&amp;post=698005</u></b></a><br><br>Again, you can use the info I posted above to make it translucent. <br><br></td></tr></table><br>
<a name="1232547"></a>

<a name="1232549"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is GREAT, thanks ALOT, Yan! :)<br><br>Sincerely, <br><br>~GF <br><br></td></tr></table><br>
<a name="1232550"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey Yan. Mind if I turn it into a DLL in Purebasic, so it's even FASTER?<br><br>Thanks again! :)<br><br>Sincerely, <br><br>~GF <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
