<!DOCTYPE html><html lang="en" ><head ><title >Bug with Linedrawing in buffer?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Bug with Linedrawing in buffer?</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Bug with Linedrawing in buffer?</a><br><br>
<a name="602586"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Marcell</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm making a game. I have strange problem when drawing a figure from Bank (the coord offsets are stored there). Everytime I use my figure drawing code, I get some mess in screen, when the score variable reaches about 200000 in example program below. This problem does not occur with my laptop. The machine this bug comes up has Radeon 8500LE and hangs up occationally with some 3D games with which my laptop does not hang up. Do I do something illegal in the following code? Should it work? It does work without any bugs with my laptop.<br><br>The bug appears with the code line Line 40,40,100,100: the line is duplicated with pixel mess. And sometimes the debugger tells that there's memory access violation with lines where the figure is drawn. Offsets and coords are ok.<br><br><br>figure\lineBank = figure_up\lineBank<br><br>While Not KeyHit(1)<br>	SetBuffer ImageBuffer(gfxActionBuffer)<br>	Line 40,40,100,100<br>	GrabImage gfxBufferInside,0,0<br><br>	SetBuffer BackBuffer()<br>	DrawImage gfxBufferInside,XStart,YStart<br><br>	Text 90,225,score%<br>	score% = score% + 3<br><br>	For j = 1 To BankSize(figure\lineBank) Step 4<br>		Line ox+PeekByte(figure\lineBank,j-1),oy+PeekByte(figure\lineBank,j),ox+PeekByte(figure\lineBank,j+1),oy+PeekByte(figure\lineBank,j+2)<br>	Next<br><br>	Flip<br><br>Wend<br>End <br><br></td></tr></table><br>
<a name="602593"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VP</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> You're going from 1 to BankSize+2 in the final loop.<br><br><pre class=code>
for j = 1 To BankSize(figure\lineBank) Step 4
Line ox.......+PeekByte(figre\lineBank,j + 2)
                                          ^^^</pre><br><br>Also, have you CreateImage()'d gfxBufferInside ? <br><br></td></tr></table><br>
<a name="602597"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Marcell</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks! I didn't notice that myself, silly me!<br>I do exceed the legal area. I was always sure, that the problem was with this figure linedrawing routine, but somehow I was blind for the bug.<br><br>Yes, I have used CreateImage() with gfxBufferInside.<br><br>Again, thank You very much! <br><br></td></tr></table><br>
<a name="602612"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Marcell</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmmm, I checked, j gets values 1,5,9,13,17,21,25,29 in the for loop if I have 32 as bank size.<br><br>In the line drawing for-loop the offsets are fetched from positions 0-31 from the bank. So I don't exceed the bank limit. Still, the bug occurs. Strange, with this small code I get the bug into screen only with that line drawing code from bank, but to witness the bug I have have also "Line 40,40,100,100" code line so that I can see the mentioned pixel mess. <br><br></td></tr></table><br>
<a name="602724"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VP</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> You're pokeing and peeking bytes. Sure you're wanting bytes and not ints? Doesn't look like it but it's hard to tell without the full code.<br><br>I think it might be some other part of your code causing an error. <br><br></td></tr></table><br>
<a name="602818"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Graythe</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> It might be a @#!*y memory location. That could be a graphics card problem but on lower spec desktops may indicate an onboard memory problem. RU overclocking any part of your system? <br><br></td></tr></table><br>
<a name="602890"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Marcell</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> No, there's no overlocking.<br><br>In the full code I do most of the linedrawing in the gfxActionBuffer. In the example code above I have reduced the code to the minumum where the bug occurs.<br><br>I myself don't find anything "illegal" there. If I comment the for-loop away, I don't get the bug. If I keep the for-loop, but comment "Line 40,40,100,100" away I don't at least see any bugs. In the full code there's more drawing. If I don't use any Line-commands, only Rect-commands (screen offsets are fetched from Bank too) I don't get, or at least see, the bug.<br><br>I might try later use ints instead of bytes. Should it still work, if I add byte values into screen coordinates that are ints?<br><br>The problem may be with my hardware (the machine boots itself occationally, hangs up and so on, still with other applications I haven't seen drawing bugs); with my laptop the full code seems to be ok. <br><br></td></tr></table><br>
<a name="602898"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Repost the code as it is now, having sorted the bugs others have pointed out. I suspect you're peeking/poking values outside you're bank's bounds, still. You can only access bank bytes from 0 to BankSize(bank)-1. Anything outside this range is illegal. <br><br></td></tr></table><br>
<a name="602993"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Marcell</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> The following code is shortest test code I have, where I get the bug (not with my laptop). When score variable reaches about 300000 I seem to get the bug.<br><br>(How can I post the code as it should be posted as vinylpusher posted above?)<br><br>Graphics 1024,768,32,1<br><br>Const blocksize = 10<br><br>Type B_FIGURE<br>	Field lineBank<br>End Type<br><br>Type C_FIGURE<br>	Field lineBank<br>End Type<br><br>figure_up.B_FIGURE = New B_FIGURE<br>figure.C_FIGURE = New C_FIGURE<br><br>figure_up\lineBank = CreateBank(8*4)<br>figure\lineBank = CreateBank(8*4)<br><br>gfxActionBuffer = CreateImage(180,360)<br>gfxBufferInside = CreateImage(180,360)<br><br>For i = 0 To BankSize(figure_up\lineBank) - 1<br>	Read value<br>	PokeByte figure_up\lineBank,i,value<br>Next<br><br>figure\lineBank = figure_up\lineBank<br><br>While Not KeyHit(1)<br>	Cls<br><br>	SetBuffer ImageBuffer(gfxActionBuffer)<br>	Line 40,40,100,100<br>	GrabImage gfxBufferInside,0,0<br><br>;	Gosub drawIntoScreen<br><br>	SetBuffer BackBuffer()<br>	DrawImage gfxBufferInside,340,170<br><br>	Text 90,225,score%<br>	score% = score% + 3<br><br><br>	For j = 1 To BankSize(figure\lineBank) Step 4<br>		Line 440+PeekByte(figure\lineBank,j-1),170+PeekByte(figure\lineBank,j),440+PeekByte(figure\lineBank,j+1),170+PeekByte(figure\lineBank,j+2)<br>	Next<br><br>	Flip<br><br>Wend<br>End<br><br>Data blockSize,0,2*blockSize - 1,0<br>Data blockSize,0,blockSize,blockSize - 1<br>Data 2*blockSize - 1,0,2*blockSize - 1,blockSize - 1<br>Data 0,blockSize,blockSize - 1,blockSize<br>Data blockSize*2,blockSize,3*blockSize - 1,blockSize<br>Data 0,blockSize,0,2*blockSize - 1<br>Data blockSize*3 - 1,blockSize,blockSize*3 - 1,blockSize*2 - 1<br>Data 0,2*blockSize - 1,3*blockSize - 1,blockSize * 2 - 1 <br><br></td></tr></table><br>
<a name="603006"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> OK, to start with, I don't know why you're creating 2 banks but only using one. The line 'figure\lineBank = figure_up\lineBank' just makes figure's bank handle point at figure_up's bank. Doing this, you've now lost the handle to figure's bank.<br><br>P.S. The forum codes are here:<br><a href="http://www.blitzbasic.com/faq/faq_entry.php?id=2" target="_blank">http://www.blitzbasic.com/faq/faq_entry.php?id=2</a> <br><br></td></tr></table><br>
<a name="603323"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Marcell</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm making a Tetris kind of game. The Tetris-blocks are defined in BLOCK-type. Current block is defined in CBLOCK. That is why there's that figure\lineBank = figure_up\lineBank line. Could this cause a memory leak? A bank is created into figure\lineBank, but never used; instead figure\lineBank is made to refer to another bank. <br><br></td></tr></table><br>
<a name="603407"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Marcell</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> I tested, if I use only one bank and read values from there, I still get the bug... <br><br></td></tr></table><br>
<a name="603468"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Marcell</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> I tried figure-drawing from an array without using a bank, still got the bug. If I comment out the 3 lines where the figure is drawn in for-loop, I don't get the bug. So, it seems, that if there is something wrong with code, it should be in the for-loop. But really can't find anything wrong there... Should I suspect the problem is with my hardware (the machine hangs up occationally with some 3D games and so on (though, I have not had any drawing bugs with any other programs))? With my laptop the whole game program works fine. <br><br></td></tr></table><br>
<a name="603479"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sure sounds like a hardware issue, then. Try the usual driver shuffling to see if that makes a difference. Could also be a hardware fault, though. <br><br></td></tr></table><br>
<a name="603595"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VP</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> I could not reproduce the error at all. It must be something specific to your machine.<br><br>Are you using Blitz3D 1.91? Do you have an AGP graphics card (and is your AGP aperture set to 64MB in your BIOS)? Do you have antivirus or antispyware software active?<br><br>What processes are running on your machine (can you alt+PrtSc and post an image of your task manager tasklist?).<br><br>With you mentioning that your Radeon locks up in other games (not just blitz) it sounds like there is a problem with the RAM on your Radeon (probably not the core, you'd have to work very hard to kill a Radeon core). Was it, or is it overclocked? Does the fan on it work? Does the inside of your PC feel very warm when you take a side-panel off our case? Is there dust in the Radeon?<br><br>Too many questions, I know, but I'm just trying to eliminate things until the problem reveals itself! <br><br></td></tr></table><br>
<a name="603766"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Marcell</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmmm, I tested the program without Radeon, with motherboards's plain VGA and it worked, no bug! The bug may have hade something to do with Radeon's drivers.<br><br>My Radeon 8500LE is AGP card, no overlocking, Blitz IDE is 1.87, linker 1.64, runtime 1.87, I have AntiVir antivirus on background. <br><br></td></tr></table><br>
<a name="603954"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VP</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Marcell: Blitz 1.91 has been available for a number of weeks. You should really upgrade. You might want to temporarily uninstall your antivirus software to see if that eliminates the bug.<br><br>Make sure you have the latest Catalyst drivers for your Radeon. if the bug stil happens, try an older version of Catalyst.<br><br>If you still get the bug (and your other 3D games keep crashing as well) then I'm afraid it might mean your Radeon is faulty. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
