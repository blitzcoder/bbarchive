<!DOCTYPE html><html lang="en" ><head ><title >Water simulation</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Water simulation</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Water simulation</a><br><br>
<a name="297049"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >poopla</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm writting a smallish water simulation..  Has anyone seen any good tutorials/articles on wave harmonics?<br><br>Thanks. <br><br></td></tr></table><br>
<a name="297105"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mac M</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Check the water tutorials of <a href="http://www.naturewizard.com" target="_blank">http://www.naturewizard.com</a><br><br>The most easy way for realistic ocean waves is the Pierson-Moskowitz math model. <br><br></td></tr></table><br>
<a name="297181"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Richard Betson</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I used this code:<br><br><a href="http://freespace.virgin.net/hugo.elias/graphics/x_water.htm" target="_blank">http://freespace.virgin.net/hugo.elias/graphics/x_water.htm</a><br><br>as a basis for this 3D version:<br><br><a href="http://blitz.idigicon.com/project_detailb.asp?ProjectName=Water%20FX%20-%20Real%20Time" target="_blank">http://blitz.idigicon.com/project_detailb.asp?ProjectName=Water%20FX%20-%20Real%20Time</a><br><br>L8r, <br><br></td></tr></table><br>
<a name="297302"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TartanTangerine (was Indiepath)</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> here's some code I modified.<br><br>[CODE]<br>Const FPS=60<br><br>Include "start.bb"<br><br><br>light = CreateLight(2)<br>PositionEntity light,-100,20,100<br><br><br>Global faces_no# = 50<br><br>Dim buffer1#(faces_no+1,faces_no+1)<br>Dim buffer2#(faces_no+1,faces_no+1)<br><br>For x = 0 To faces_no<br>For y = 0 To faces_no<br>Buffer1#(x,y) = 0<br>Next<br>Next<br><br>; Load Patch<br>water = CreateFace(faces_no,1)<br>Global watersurf = GetSurface(water,1)<br>EntityAlpha water,1<br>EntityShininess water,1<br>ScaleEntity water,340,100,340<br>tex = LoadTexture ("water.tga")<br>EntityTexture water,tex<br>EntityType water,SEA_COL<br><br><br>; ########################## create ball ####################<br><br>Global ball,mid_ball,picked,ballx#,ballz#,seay#,movex#,boatpiv,boat2,div#,ttold,fps1#,fp2_av#<br>Global football, water_update = 8<br>Global accel# = 0, friction# = 0.99, hide=0<br><br>Dim  wave#(4)<br>Global floater[4]<br><br>; ##################create boat<br><br>boatpiv = CreatePivot()<br><br><br>Global campivot = CreatePivot(boatpiv)<br>Global camera = CreateCamera()<br>CameraZoom camera,0.8<br>CameraRange camera,0.1,10000<br><br><br><br><br>PositionEntity campivot,0,10,0<br>PositionEntity camera,0,-5,15<br>ball = CreateCube(boatpiv)<br>ScaleMesh ball,1,1,3<br>EntityColor ball,255,0,0<br><br>Dim col(4)<br><br><br>PositionEntity boatpiv,90,0,-120<br>ScaleEntity boatpiv,2,2,2<br>For z=1 To 4 <br>	floater[z]=CreateSphere(4,boatpiv)<br>	EntityAlpha floater[z],0.5<br>Next<br><br><br>PositionEntity camera,140,17,-140<br>PointEntity camera, campivot<br><br>Global direction# = -0.01<br><br>Global processnow = water_update<br><br>registerdrop(1)<br><br><br>period=1000/FPS<br>time=MilliSecs()-period<br><br><br>While Not KeyHit(1)<br>;Frame Limiting Code<br>	Repeat<br>		elapsed=MilliSecs()-time<br>	Until elapsed<br><br>	;how many 'frames' have elapsed	<br>	ticks=elapsed/period<br>	<br>	;fractional remainder<br>	tween#=Float(elapsed Mod period)/Float(period)<br>	<br>	For k=1 To ticks<br>		time=time+period<br>		If k=ticks Then CaptureWorld<br>; Main updates here &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br><br>	<br>	If processnow &lt;= 1 Then<br>			ProcessWater()<br>			processnow = water_update<br>			<br>		Else<br>			processnow = processnow - 1<br>		End If<br>	RegisterDrop()<br>	processboat()<br>    <br>		<br>	MoveEntity  boatpiv,0,0,-accel<br>	PointEntity camera,boatpiv<br>    TranslateEntity camera,0,MouseZ(),0<br>			<br>    UpdateWorld<br>	Next<br><br>RenderWorld tween<br><br>	If KeyDown(200) Then <br>		If accel &lt; 2 Then accel = accel + 0.01<br>		RotateEntity ball,accel*5,0,0<br>	Else<br>	    accel = accel * friction<br>	End If<br>	<br>	If KeyDown(208) Then accel = accel - 0.01<br>	If KeyDown(203) Then TurnEntity boatpiv,0,1,0<br>	If KeyDown(205) Then TurnEntity boatpiv,0,-1,0<br>	If KeyHit(57) Then<br>		water_update = water_update - 1<br>		If water_update = 0 Then water_update = 10<br>	End If<br><br><br>	If KeyHit(28) Then hide = 1 - hide<br>If Not hide<br>    Text 10,10,"Press Left and/or Right Mouse Button For Ripples"<br>    Text 10,22,"Use the cursors to move your boat thingie"<br>    Text 10,34,"(oh And don't go off the water cause the proggie will crash!)"<br>    Text 10,48,"Use the MouseWheel to Zoom in and out"<br>    Text 10,60,"Press the SpaceBar to cycle though update speeds"<br>    Text 10,72,"Current Update is every "+water_update+" Renders"<br>	Text 10,100,"Original Water Code by : Reda Borchardt"<br>	Text 10,120,"Additional Coding and Optimised by Flynn"<br>	Text 10,140,"Hit ENTER to hide this text and to get some real FPS!"<br>	Text 10,160,"Frames Limted at 60FPS"<br>End If	<br><br>    Flip False<br>Wend<br>End<br><br>; process ball position<br>Function processBoat()<br><br><br>	convert(ball)<br>	seay# = buffer2#(Int(ballx),Int(ballz)) <br>	<br><br>	<br>	<br>	; position the floaters around the cube<br>	<br>	cnt=1<br>	For z=1 To -1 Step -2<br>		For x=-1 To 1 Step 2<br>			convert(floater[cnt])<br>			dy# = (buffer2#(Int(ballx),Int(ballz))*70) - EntityY(floater[cnt])<br>			PositionEntity floater[cnt],x*2,EntityY(floater[cnt]),z*2<br>			TranslateEntity floater[cnt],0,dy# * 0.1,0<br>			cnt=cnt+1<br>		Next<br>	Next<br>		<br><br>	;align boat to floater<br>	zx#=(EntityX( floater[2],True )+EntityX( floater[4],True ))/2<br>	zx=zx-(EntityX( floater[1],True )+EntityX( floater[3],True ))/2<br>	zy#=(EntityY( floater[2],True )+EntityY( floater[4],True ))/2<br>	zy=zy-(EntityY( floater[1],True )+EntityY( floater[3],True ))/2<br>	zz#=(EntityZ( floater[2],True )+EntityZ( floater[4],True ))/2<br>	zz=zz-(EntityZ( floater[1],True )+EntityZ( floater[3],True ))/2<br>	AlignToVector ball,zx,zy,zz,1,0.8<br>	<br>	zx#=(EntityX( floater[1],True )+EntityX( floater[2],True ))/2<br>	zx=zx-(EntityX( floater[3],True )+EntityX( floater[4],True ))/2<br>	zy#=(EntityY( floater[1],True )+EntityY( floater[2],True ))/2<br>	zy=zy-(EntityY( floater[3],True )+EntityY( floater[4],True ))/2<br>	zz#=(EntityZ( floater[1],True )+EntityZ( floater[2],True ))/2<br>	zz=zz-(EntityZ( floater[3],True )+EntityZ( floater[4],True ))/2<br>	AlignToVector ball,zx,zy,zz,3,0.8<br>	<br>	dy#=(seay# * 70)-EntityY( ball ) <br>	<br>	TranslateEntity ball,0,dy*.2,0<br><br><br>End Function<br>	 <br>	;convert world to array co-order<br>Function convert(entity)<br>		div = 340 / faces_no<br>		ballx = faces_no-Abs((EntityX(entity,True)-(340/2))/div)<br>		ballz = faces_no-Abs((EntityZ(entity,True)-(340/2))/div)<br> 	<br>End Function<br><br>; Process Water Ripples<br>Function ProcessWater()<br><br>Local coef# = 2.1<br>Local dissolve# = 1.01<br>Local k = 0<br><br>    For x = 1 To faces_no + 1<br><br>        For y = 1 To faces_no + 1<br><br>            If (x &lt; (faces_no - 1)) And (y &lt; (faces_no - 1)) Then <br>				Buffer2#(x,y) = (Buffer1#(x-1,y) + Buffer1#(x+1,y) + Buffer1#(x,y+1) + Buffer1#(x,y-1)) / coef-Buffer2#(x,y) <br>    			Buffer2#(x,y) = Buffer2#(x,y) / dissolve<br>			EndIf<br><br>			VertexCoords(watersurf,k,VertexX(watersurf,k),buffer2#(y-1,x-1),VertexZ(watersurf,k))<br>			<br>			temp1# = Buffer1#(x-1,y-1)<br>            temp2# = Buffer2#(x-1,y-1)<br>            Buffer1#(x-1,y-1) = temp2#<br>            Buffer2#(x-1,y-1) = temp1#<br><br>			k = k + 1<br>        Next<br>    Next<br><br>End Function<br><br><br><br><br>; Register Drop<br>Function RegisterDrop(start=0)<br>  <br>    If MouseHit(1) Or start = 1<br>        For i = (faces_no - 4) To (faces_no - 3)<br>            For j = (faces_no /2) - 5 To (faces_no/2)<br>                buffer2#(i,j)=0.14<br>            Next<br>        Next<br>    End If<br>    If MouseHit(2) Or start = 1<br>        For i = 1 To 3<br>            For j = faces_no - 7 To faces_no - 3<br>                buffer2#(i,j)=0.34<br>            Next<br>        Next<br>    End If<br>End Function<br><br><br>;Creates a single sided face<br>;segmented<br>Function CreateFace(segs=1,double=False,parent=0)<br>mesh=CreateMesh( parent )<br>surf=CreateSurface( mesh )<br>stx#=-.5<br>sty#=stx<br>stp#=Float(1)/Float(segs)<br>y#=sty<br>For a=0 To segs<br>x#=stx<br>v#=a/Float(segs)<br>For b=0 To segs<br>u#=b/Float(segs)<br>AddVertex(surf,x,0,y,u,v) ; swap these for a different start orientation<br>x=x+stp<br>Next<br>y=y+stp<br>Next<br>For a=0 To segs-1<br>For b=0 To segs-1<br>v0=a*(segs+1)+b:v1=v0+1<br>v2=(a+1)*(segs+1)+b+1:v3=v2-1<br>AddTriangle( surf,v0,v2,v1 )<br>AddTriangle( surf,v0,v3,v2 )<br>Next<br>Next<br>UpdateNormals mesh<br>If double=True Then EntityFX mesh,16<br>Return mesh<br>End Function<br>[/CODE] <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
