<!DOCTYPE html><html lang="en" ><head ><title >Flat-shading</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Flat-shading</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Flat-shading</a><br><br>
<a name="563534"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> (I've bumped this coz I lost my image in the other thread, but it needs answering anyway;)<br><br>I'm trying to write an app which will display other people's models.<br><br>This flat-shading (or lack of it) has been a constant bug-bear. (Obviously when I make my own I weld all my vertices - I'm a good boy.)<br><br>I've tried the suggestion of EntityFx ent,4 but it made no difference as you can see below. Any other ideas?<br><br><img src="http://www.tla-data.co.uk/marina.jpg"> <br><br></td></tr></table><br>
<a name="563539"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Difference</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Forget about flag 4.<br><br>This is the first thinng I wrote in Blitz, so excuse the coding. It's not very stable, but it should show you what you need to do : <a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=273" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=273</a><br><br>Try it out on some simple primitive.<br><br>Remember: For a cube you need 24 vertices, and your own normals (stay away from Updatenormals()! ) <br><br></td></tr></table><br>
<a name="563565"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yep, flag 4 is a bodge. To do flat shading properly, you need surface normals to light it, which blitz meshes (or is it DX?) doesn't support. Flag 4 simply causes each triangle to be lit using one of it's vertex normals, as if it were a surface normal. Unfortunately, vertex normals are usually smoothed and so will not be perpendicular to the triangle.<br><br>John, if you simply want to load a mesh in your app and have it display using flat shading, then you're out of luck, I'm afraid. Your only real option is to do what Peter says and rebuild the mesh. <br><br></td></tr></table><br>
<a name="563579"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Brilliant response, thanks guys.<br><br>Vertices have normals?<br>I think I'm out of my depth here.<br>Peter I'll try your code, thanks.<br><br>So what's actually causing the problem in the picture above? Unwelded vertices? - Or is that incidental, and it's actually the vertex normals?<br><br>Normally, as a matter of course, I weld any vertices which occur at the same point in space - that seems to cure this effect in my own models.<br>But as I say, I'm trying to allow other people's models to be loaded. Is there an easy description for what has happened, and can I tell them to do 'such and such' when creating their own models, to prevent this. <br><br></td></tr></table><br>
<a name="563585"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TeraBit</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Vertices have normals which would point in the same direction as the face normals (Point the same way as the triangle face). When they share more than one triangle (as in welded vertices), the normals are averaged between the face normals of each face. <br><br>In Blitz, it appears, they are even averaged between vertices which share the same point in space even if they're not physically connected to the face.<br><br>You can specify normals in many model formats, and the best way to get exact results is to get the vertex normals included in the file format (.B3D for example).<br><br>There are also entries in the Code Archives to calculate vertex normals for a mesh which would give hard edges. <br><br></td></tr></table><br>
<a name="563587"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks, Lee.<br><br>I would say that I'm a fair modeller, but even so a lot of what has been said goes over my head.<br><br>Would there be a simple statement I could offer to potential users of my app, such as 'to prevent this effect you should &lt;make sure that your vertext normals point in the same direction as your face normals&gt;' (- or some such)? <br><br></td></tr></table><br>
<a name="563591"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >IPete2</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> John,<br><br>is your mobile switeched on?  ;)<br><br>IPete2. <br><br></td></tr></table><br>
<a name="563600"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Pete try my home number <br><br></td></tr></table><br>
<a name="563607"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TeraBit</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  &lt;make sure that your vertext normals point in the same direction as your face normals&gt;  <br></div><br><br>You could do, but unless the file format has the normals embedded, it wouldn't do much good.<br><br>Give this routine a try:<br><br><a href="http://www.blitzbasic.co.nz/codearcs/codearcs.php?code=975" target="_blank">http://www.blitzbasic.co.nz/codearcs/codearcs.php?code=975</a><br><br>And tell the users 'If you want a hard edge between polygons, unweld the vertices'.<br><br>Hopefully that should sort it out. <br><br></td></tr></table><br>
<a name="563608"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> That'll do nicely thanks Terabit.<br><br>Peter, the code works, but the offending model is 20 megs in size, so crashes on RenderWorld after changes implemented (hey-ho, not your fault). <br><br></td></tr></table><br>
<a name="563610"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think it is worth adding here, that the heart of the problem is that the light changes across the quad in a way that it should not. The two tris _are_ flat to each other, so it must be the vertex normals which are playing with the light effect. <br><br></td></tr></table><br>
<a name="563621"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> The two tris _are_ flat to each other, so it must be the vertex normals which are playing with the light effect. <br></div>Correct.<br><br>Try this little lib if you want to actually see which way the vertex normals are pointing:<br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=1085" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=1085</a> <br><br></td></tr></table><br>
<a name="563628"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Techlord</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Vertex Normals effect lighting. <br><br><a href="http://www.blitzbasic.co.nz/b3ddocs/command.php?name=UpdateNormals&amp;ref=3d_a-z" target="_blank">UpdateNormals</a><br><br><a href="http://www.blitzbasic.co.nz/b3ddocs/command.php?name=VertexNormal&amp;ref=3d_a-z" target="_blank">VertexNormal</a> <br><br></td></tr></table><br>
<a name="563670"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >puki</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Might be worth cleaning your screen - dirt can affect shading.<br><br><pre class=code>
; Monitor screen cleaning utility
; designed by "puki" - 29/08/05 

Graphics 640,480,16,1
WaitKey
ClsColor 255,255,255
Cls
WaitKey
End
</pre> <br><br></td></tr></table><br>
<a name="563678"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Puki, your reputation precedes you.<br>Need I say more? <br><br></td></tr></table><br>
<a name="563756"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> In Blitz, it appears, they are even averaged between vertices which share the same point in space even if they're not physically connected to the face. <br></div>That seems to be the case. I created a box of 8 verts, 12 tris, and another of 6 separate 4 vert 2 tri squares. Both had the same progessive shading over the surface despite the vertex norms all being the same a the faces. I then exploded the model so the faces had some space between them and the object's faces were flat shaded. Note that the distance they were exploded could n't be too small. At 1x10^-5 provided flat shading. Less then that and the vertices were averaged. <br><br></td></tr></table><br>
<a name="564050"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think I can quite happily finish off this thread.<br><br>The link TeraBit gave to sswift's code:<br>www.blitzbasic.co.nz/codearcs/codearcs.php?code=975<br>did the business!<br><br>This code works beautifully, and 'forces' a non-smooth look on meshes - particularly impressive if you want the edges of a vehicle or a building to have 'clean edges', instead of looking like it's been shaped from blancmange.<br><br>The only thing I changed was<br><pre class=code>Const swiftmax = 32768
Const maxtris = 32*4
Dim Face_NX#(swiftmax)
Dim Face_NY#(swiftmax)
Dim Face_NZ#(swiftmax)
Dim Vertex_ConnectedTris(swiftmax)
Dim Vertex_TriList(swiftmax, maxtris)</pre><br>32*4 - to allow for more tris potentially attached to each vertex.<br><br>Cheers everyone! <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
