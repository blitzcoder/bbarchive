<!DOCTYPE html><html lang="en" ><head ><title >Alpha'd sprites &amp; EntityOrder performance hit</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Alpha'd sprites &amp; EntityOrder performance hit</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Alpha'd sprites &amp; EntityOrder performance hit</a><br><br>
<a name="784302"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> So, I have 100 blitz sprites which are all positioned on the same vertical plane. Because they're alpha blended, I'm getting a horrible side effect: when sprite a and sprite b overlap, sometimes a is rendered on top of b, other times it's vice versa. Yuck!<br><br>I figured the best way around this problem was to assign each sprite it's own entity order, to guarantee each sprite will be drawn in a specific order. Indeed, this worked fine.<br><br>However, I'm noticing a performance hit using this method. Without setting the EntityOrder of the sprites, I get 1-2ms, with EntityOrder used, I get 5-6ms. This isn't actually too much of a problem with the thing I'm messing around with, but on a more intensive project, I image this could be a pain.<br><br>Anyone else notice this performance hit using EntityOrder and/or know why it's happening?<br><br>Also, re the overlapping sprites problem detailed above, what would be the best way around this if I were to use a single surface sprite system? In that case, using EntityOrder isn't an option, obviously.<br><br>Cheers. <br><br></td></tr></table><br>
<a name="784350"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Danny</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Doesn't make sense no that 'helping it to sort' would cost you...<br><br>Might (MIGHT?) it help if you offset the sprites by just a fraction ie. 0.001 so the offset won't be 'visible' but prevents them sprites from sharing the same 'space' - thus help Blitz to the sorting??? I use this for drop shadows for example, that are stuck to the floor, and then offset by 0.001 to prevent the same effect as you describe..<br><br>But yes, as far as I understand your 100 sprites would mean a 100 surfaces - thus a 'single surface' particle/sprite system should score you a serious speed increase..<br><br>Danny. <br><br></td></tr></table><br>
<a name="784355"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_33</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> The problem is not a BLitz3d problem but a Direct X prob lem IMHO. <br><br></td></tr></table><br>
<a name="784363"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Possibly a fill-rate thing.<br><br>Big10p - use a single surface system.  From experience,  the poly's on a surface are displayed in the order that they're created if on the same plane.  Using alpha ( fx 2+32 ) may screw this up though - not sure.  There is no harm ( unless you want pixel perfect ) in offsetting by a small margin as danny suggests.<br><br>That said, you may still get a bit of slowdown due to fillrate on your ageing rig ;) <br><br></td></tr></table><br>
<a name="784369"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Might (MIGHT?) it help if you offset the sprites by just a fraction ie. 0.001 so the offset won't be 'visible' but prevents them sprites from sharing the same 'space' - thus help Blitz to the sorting??? <br></div>Unfortunately, this doesn't work because z-buffering is disabled for all the sprites, as they're alpha blended.<br><br><div class="quote"> But yes, as far as I understand your 100 sprites would mean a 100 surfaces - thus a 'single surface' particle/sprite system should score you a serious speed increase.. <br></div>Yeah, if I was working on a 'serious' project that required loads of sprites, I'd wan't to use a single surface system. As it is, I'm just messing around with something that doesn't need too many sprites, anyway. I was just curious about the cause of the EntityOrder speed hit. And, I'd still like to know how a single surface system would get around this problem.<br><br><div class="quote"> The problem is not a BLitz3d problem but a Direct X prob lem IMHO. <br></div>I don't doubt that. :) [edit]Actually, bmax can use direct x and presumably doesn't have this problem, so I wonder how that get's around the issue?[/edit]<br><br><div class="quote"> Possibly a fill-rate thing. <br></div>Hmm, how would fill-rate be affected by using EntityOrder? The sprites are tiny, too.<br><br><div class="quote"> From experience, the poly's on a surface are displayed in the order that they're created if on the same plane. <br></div>Ah, so that must be the way single surface systems get around the overlapping sprites problem, then?!<br><br><div class="quote"> There is no harm ( unless you want pixel perfect ) in offsetting by a small margin as danny suggests. <br></div>As I say, this doesn't appear to work. I'm assuming this is because the alpha'd sprites are rendered after everything else, but the order they're rendered in isn't consistent, for some reason. Hence, the order they overlap changes. <br><br></td></tr></table><br>
<a name="784372"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_33</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> You'll get that speed situation in all cases of polygons which are stacked behind each other in the 100s where you put priorities, as the object's priority is possibly not in the same order as the objects themselves are in the Direct X Z buffer.  So as long as we can't access the z buffer, we can't decide who get's added in first, or maybe we can figure that out from the code.  But if you add the objects in random order and put random display priorities, that should yeld slower (if my logic holds).  That is why in my terminal system I draw each layer at a time from furthest to nearest. <br><br></td></tr></table><br>
<a name="784375"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stevie G</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> z-buffer is disabled when using alpha so render order is based on distance to camera. <br><br></td></tr></table><br>
<a name="784377"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> But, the z-buffer has nothing to do with the order entities are sent to be rendered in. Especially my alpha blended sprites, which aren't z-buffered at all, since the pixels representing the transparent parts can't be calculated until everything else has been rendered.<br><br>Also, I'm not stacking loads of sprites on top of each other. The sprites are tiny and only ocassionally will 1 or 2 overlap each other, yet the speed hit is consistent. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
