<!DOCTYPE html><html lang="en" ><head ><title >Lightmapping question</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Lightmapping question</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Lightmapping question</a><br><br>
<a name="305274"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I know it can be done in Blitz3d (decorator does it :) ) but how do you change a lightmap from one lightmap to the other, could someone explain it to me.<br><br>Thanks in advance :) <br><br></td></tr></table><br>
<a name="305291"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't understand that question - change a lightmap? You simply have to assign an other lightmap textue to the second coords set of the meshs UVs. So tell the texture to use the second UV set with <br><br>Texturecoords tex,1<br><br>and assign it to the mesh:<br><br>Entitytexture mesh,tex,0,1<br><br>To save the mesh with the new lightmap you can simply replace the filename in the file, or use a B3D Mesh exporter that will handle lightmaps. In that case you need to define the brushes with 2 Textures, where the 2nd will be the lightmap for all brushes. the blending mode must be 2 if I remember right and the entityFX must be 1=fullbright. <br><br></td></tr></table><br>
<a name="305303"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> The problem I get is this, when I change a lightmap I get the lightmap image ie the square texture and not the lighting as required. It would be the same as if I had gone throughout the level and assigned a square texture.<br><br>What I want to do is simply (within Blitz) change one lightmap for another one. EntityTexture doesnt seems to work unfortunately, this is why im asking. <br><br></td></tr></table><br>
<a name="305308"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is what I get with my entitytexturing (this is a Quill3d mesh):<br><br><img src="http://www.edzup.co.uk/images/working.jpg"><br>Working (just loading the mesh with LoadMesh<br><br><br><img src="http://www.edzup.co.uk/images/notworking.jpg"><br>Not working, applying texture with EntityTexture etc.<br><br><br>What I want is to be able to apply lightmaps in Blitz and get results like the Working picture. <br><br></td></tr></table><br>
<a name="305311"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I imagine the two lightmaps are produce by the same program? <br><br></td></tr></table><br>
<a name="305312"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Also, as jfk says, are you changing the tex co-ords to the second set?<br><br>Texturecoords tex,1 <br><br></td></tr></table><br>
<a name="305332"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yup TextureCoords are set to 1 and I use Entitytexture mesh, texture, 0, 1 too and fullbright. <br><br></td></tr></table><br>
<a name="305340"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> maybe quill is using the lightmap on the set 0 ? <br><br></td></tr></table><br>
<a name="305398"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Tried that one, unfortunately that just changes the backing texture :| <br><br></td></tr></table><br>
<a name="305417"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> did you visually compare the two lightmap textures, i mean as images? do they use the same UVs? how did you produce the second lightmap? If you exported the lihtmap from quill then maybe you have to ask Dave, he only knows if quill would save the same lightmap in diffrent ways, depending on weather or daytime... <br><br></td></tr></table><br>
<a name="305421"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> The first lightmap and second lightmap are exactly the same image, but applying with the EntityTexture method yeilds the second result. Loading the mesh as standard loads it as the first piccy. <br><br></td></tr></table><br>
<a name="305425"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JaviCervera</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Probably the UV coordinates required for the 2nd lightmap are different to the coordinates required for the 1st? <br><br></td></tr></table><br>
<a name="305441"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> possibly but is there a way of sorting this? <br><br></td></tr></table><br>
<a name="305602"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Richard Betson</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> EdzUp,<br><br>Have loaded or created a texture with the Texture UV clamped? For example LoadTexture("lightmap.bmp",16+32).<br><br>L8r, <br><br></td></tr></table><br>
<a name="305603"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> if the lightmap looks the same then the uv coordinates required for the second lightmap are the same. If you are using the same mesh and the 2 lightmaps are looking the same, it's only a question of the assignment.<br><br>maybe you need to spy the mesh structure...<br><br><pre class=code>
m=loadmesh("level.b3d")
surfs=countsurfaces(m)
for i=1 to surfs
 s=getsurface(m,i)
 b=getsurfacebrush(s)
 t0=getbrushtexture(b,0)
 t1=getbrushtexture(b,1)
 print "Brush "+i+" uses:" 
 print " texure set 0: "+texturename$(t0)
 print " texure set 1: "+texturename$(t1)
next
waitkey()
</pre> <br><br></td></tr></table><br>
<a name="305635"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> thanks guys will have a look :) <br><br></td></tr></table><br>
<a name="305682"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have created this function:<br><pre class=code>
Function SwitchLightMap( Mesh, NewTexture )
	;this function changes the lightmap on a mesh to a selected lightmap
	Local SurfS=CountSurfaces( Mesh ) 
	Local SurfI=0
	
	For SurfI=1 To Surfs
		s=GetSurface( Mesh, SurfI ) 
		b=GetSurfaceBrush(s) 
		t0=GetBrushTexture( b, 0 ) 
		t1=GetBrushTexture( b, 1 )
		
		BrushTexture b, t0, 0, 0
		BrushTexture b, newtexture, 0, 1
		
		PaintSurface s, b
	Next 
End Function
</pre><br><br>I still get the same result tho, anyone have any ideas? <br><br></td></tr></table><br>
<a name="305728"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> can you post the mesh? <br><br></td></tr></table><br>
<a name="305840"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Richard Betson</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah.. somthing we can test. :)<br><br>L8r, <br><br></td></tr></table><br>
<a name="305886"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> I will create a demo mesh as the current mesh is over 2Mb in size (inc lightmap) <br><br></td></tr></table><br>
<a name="305898"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >starfox</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> maybe you should unweld the mesh? <br><br></td></tr></table><br>
<a name="305907"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have located the problem, it seems the mesh I have is to complex (ATM it has over 40 different textures and is 1.05Mb in size). I have created a very simple mesh (a box with a pedestal and four pillars) and that lightmaps perfectly :|. This means basically I have to break up the levels if I want to do anything with the lightmapping stuff. <br><br></td></tr></table><br>
<a name="305930"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MSW</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> Those two lightmaps...they look the same right?...but are they the exact same pixel size...the exact same color depth...even if they are, how much video memory is left after loading in the mesh, the textures, the original lightmap, and the lightmap you want to swap it with and anything else that's loaded in video memory when the problem occurs...<br><br>Try this...load in the level...swap the lightmaps so the problem occurs (use entitytexture)...then swap back to the original lightmap(again useing entitytexture)...if doing this restores the original lighting then the problem is most likely related to the second lightmap...either it's not the same pixel size, or Blitz has had to do something funky to match up color depths (or even reduce the texture size so it can fit into videomemory)...but if you can't get back to the original lightmap after swapping them then possably the UVs are getting messed up... <br><br></td></tr></table><br>
<a name="306100"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> MSW: I think its the UV's as the lightmap is the original one for the level, im just swapping it back and forth. Strange tho it works perfectly on simple levels but not on complex ones. <br><br></td></tr></table><br>
<a name="306104"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MSW</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> EdzUp - so you can take your complex level...put the original lightmap on it, and it looks as you expect...but when you swap to the second lightmap it gets messed up...that I understand...but is it still messed up if you then swap back to the original lightmap? <br><br></td></tr></table><br>
<a name="306141"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> MSW: when I load the level it looks as expected, when I apply the lightmap for that level (that it was loaded with, I reload it as a texture) and apply that to the same level it gets screwed up. <br><br></td></tr></table><br>
<a name="306158"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="http://www.edzup.co.uk/images/edzuplighting.zip" target="_blank">(Here)</a> is a demo of what im trying to do, use 1 and 2 to turn on and off the lights at either end. Keypad 4, 6, 2, 8 to rotate and move forward and back. <br><br></td></tr></table><br>
<a name="306290"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MSW</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>MSW: when I load the level it looks as expected, when I apply the lightmap for that level (that it was loaded with, I reload it as a texture) and apply that to the same level it gets screwed up. <br> <br></div><br><br>Yes I fully realise that...what I have been asking is once it gets screwed up, can you at that point apply the original lightmap that was loaded in and have it return to the way it was?<br><br><br>Make a copy of your complex level .B3D file...in this copy strip out the refrence to the lightmap so that it doesn't load it with the level...if you can't do that then make a copy of the level textures, open them in some image editor and reduce all of them (except the lightmap) to half or quarter thier size (if they are 512 X 512, reduce them to 128 X 128 or even 64 X 64) set it up so the level will use these smaller test textures...or set up the graphics to run in 320 X 240 X 16 or 32-bit mode...<br>then use your example demo to load the level and two copies of the lightmap...then run that. <br><br></td></tr></table><br>
<a name="306311"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> I will give it a go :) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
