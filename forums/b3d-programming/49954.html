<!DOCTYPE html><html lang="en" ><head ><title >Buffer Swapping</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Buffer Swapping</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Buffer Swapping</a><br><br>
<a name="555259"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I needed to copy the frontbuffer to the backbuffer.<br><br>This was because the image resize code I found somewhere on this site used the back buffer to create the resized image, and then Flip was a couple of lines later... whoops, screen flash.<br><br>It seemed obvious (after the resize had done it's job) to use :-<br>CopyRect 0,0,GraphicsWidth(),GraphicsHeight(),0,0,FrontBuffer(),BackBuffer()<br><br>but this appears to have no effect.<br><br>Am I doing this right? <br><br></td></tr></table><br>
<a name="555300"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> What might be happening is your using a cls command in there somewhere, that's clearing the buffer before it's copied? <br><br></td></tr></table><br>
<a name="555366"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> No. Whats happening is that I execute the command then do a Flip to bring Back to Front (which should be the usual 3D scene) but I'm still seeing the corrupted BackBuffer.<br><br>In other words the CopyRect hasn't worked.<br><br>That's why I'm asking - is this the right way to copy from Front to Back? <br><br></td></tr></table><br>
<a name="555417"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >IPete2</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> John,<br><br>This may be a stupid question but are you using updateworld and renderworld before the flip?  Perhaps try not using them.<br><br>IPete2. <br><br></td></tr></table><br>
<a name="555994"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Pete.<br><br>No. Exactly as described.<br>CopyRect, then Flip. No other complication.<br><br>I've also tried as an experiment inserting UpdateWorld + RenderWorld then Flip, and 'cause I'm going thru line-by-line in debug mode I can see, as expected, the BackBuffer moved to the FrontBuffer just fine.<br><br>It's simply as if CopyRect fails when used between the two Blitz system buffers. <br><br></td></tr></table><br>
<a name="556005"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RGR</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm - what shall be useful doing this operation?<br>You see the frontbuffer - then copy it to the backbuffer and flip to see the copied frontbuffer again ? Would be timesaving to do nothing.<br>And instead of CopyRect you could quicker do Flip anyway because this has the same effect - would be done in case you want to draw something on the former frontbuffer and to show this make flip again. <br><br></td></tr></table><br>
<a name="556203"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is the code your using the super fast resizing code by any chance? <br><br></td></tr></table><br>
<a name="556207"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> <pre class=code>
This was because the image resize code I found somewhere on this site used the back buffer to create the resized image, and then Flip was a couple of lines later... whoops, screen flash.
</pre><br><br>Why don't you alter the code, so the image resize code, doesn't use the back buffer to put the image? <br><br></td></tr></table><br>
<a name="556233"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >nawi</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> nevermind :/ <br><br></td></tr></table><br>
<a name="556277"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nik Green</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi John<br><br>CopyRect between frontbuffer and backbuffer should work as you want it to. I did a quick test and it worked fine:-<br><br>Graphics 800,600<br>Setbuffer Frontbuffer()<br>image = LoadImage("a suitable image")<br>DrawImage image,0,0<br>CopyRect 0,0,GraphicsWidth(),GraphicsHeight(),0,0,FronBuffer(),BackBuffer()<br>Flip<br>WaitKey()<br>Flip<br>Waitkey()<br><br>This displays the image after each flip as expected.<br><br>A stab in the dark but does the code Lock either of the buffers and not Unlock them again? <br><br></td></tr></table><br>
<a name="556286"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> He's a thought. Is the downscaling function going to be as fast as a GPU scaling a texture? If you're downsizing might it be quicker to render the texture to a pixel-perfect quad, render that to the backbuffer, and grab a rectangle of the downsized quad? <br><br></td></tr></table><br>
<a name="556328"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Shifty, I think that's exactly what the resize code is doing.<br><br>It's jfk's (clever sod) and unfortunately I don't understand it enough to change the buffer.<br><br>@Nik, there's no locking going on.<br><br>Let's see if I can explain it again....<br><br>As I said, after any fast-resize the next Flip causes a flash since the Backbuffer is corrupted.<br>Therefore the simple logic was to copy the FrontBuffer (last render) to the BackBuffer, then Flip. So far so good?<br><br>The copy doesn't work - literally the FrontBuffer fails to copy to the BackBuffer; the BackBuffer is still corrupted for the next Flip.<br><br>So, crude as it may seem, I now have a global called NoFlip set to 1 at the end of the fast-resize function.<br>Then:<br>If NoFLip=0<br>  Flip<br>ELse <br><br></td></tr></table><br>
<a name="556330"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> (Damn, sorry - must have hit post before I was finished.<br>Here it is again:)<br><br>@Shifty, I think that's exactly what the resize code is doing.<br><br>It's jfk's (clever sod) and unfortunately I don't understand it enough to change the buffer.<br><br>@Nik, there's no locking going on.<br><br>Let's see if I can explain it again....<br><br>As I said, after any fast-resize the next Flip causes a flash since the Backbuffer is corrupted.<br>Therefore the simple logic was to copy the FrontBuffer (last render) to the BackBuffer, then Flip. So far so good?<br><br>The copy doesn't work - literally the FrontBuffer fails to copy to the BackBuffer; the BackBuffer is still corrupted for the next Flip.<br><br>So, crude as it may seem, I now have a global called NoFlip set to 1 at the end of the fast-resize function.<br>Then:<br>If NoFlip=0<br>  Flip<br>Else <br>  NoFlip=0<br>Endif <br><br></td></tr></table><br>
<a name="556589"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nik Green</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi John<br><br>In my humble opinion your 'crude' solution is better than the CopyRect solution, especially if you intended to CopyRect every program loop whether its needed or not.<br><br>Still doesn't explain why CopyRect didn't work though. Have you tried other (simpler) tests?<br><br>By the way, if you are using the fast resize code I think you are using you can't use a different buffer even if you understand the code. It uses RenderWorld which always uses the BackBuffer.<br><br>Nik Green <br><br></td></tr></table><br>
<a name="556619"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, it uses my idea. Or rather, I suggested jfk's idea. Erm...I think I'll patent the idea (despite jfk having it before me) and then sue anyone who uses it :p<br><br>But yeah, it renders the image to be scaled as a texture on a quad in the backbuffer, and grabs that to an image, and rendering is limited to the backbuffer only. <br><br></td></tr></table><br>
<a name="556659"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> NIck and Shifty - both correct on all counts.<br><br>I'm not doing CopyRect each cycle, just once for each image as it's loaded (sometimes 'in-game').<br><br>"Still doesn't explain why CopyRect didn't work though. Have you tried other (simpler) tests?"<br><br>What could be simpler? <br><br></td></tr></table><br>
<a name="556706"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nik Green</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi John<br><br>"What could be simpler?"<br><br>Write a quick test program that just copies the frontbuffer to the backbuffer using CopyRect. Try This:-<br><br>Graphics3D 800,600,32<br>SetBuffer BackBuffer()<br>ent = CreateSphere()<br>cam = CreateCamera()<br>PositionEntity cam,0,0,-2<br>RenderWorld<br>Text 0,0,"Original BackBuffer flipped from back to front"<br>Flip<br>Waitkey()<br>Cls<br>CopyRect 0,0,GraphicsWidth(),GraphicsHeight(),0,0,FrontBuffer(),BackBuffer()<br>Text 0,20,"...then copied from Front to Back and flipped again."<br>Flip<br>Waitkey()<br>End<br><br>Does it work?<br><br>If it does (and it does on my set up) then there is something in your code preventing CopyRect from copying as you want it to.<br><br>If it doesn't work then there must be a problem with CopyRect when used with the 'system' buffers on your set up.<br><br>Either way Good Luck :)<br><br>Nik Green <br><br></td></tr></table><br>
<a name="556715"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Your code works perfectly. Thanks.<br><br>These are the two main lines of my code:-<br><br>; \/ This creates the reduced size image.<br>CopyRect (GraphicsWidth()/2.0)-(w/2.0),(GraphicsHeight()/2.0)-(h/2.0),w,h,0,0,BackBuffer(),ImageBuffer(img2)<br>; \/ And immediately my line is used to reinstate the BackBuffer.<br>CopyRect 0,0,GraphicsWidth(),GraphicsHeight(),0,0,FrontBuffer(),BackBuffer()<br><br>It CAN only be that that the first CopyRect somehow prevents the second (???).<br><br>Thanks for all your help, guys, but personally I'm tired of this (as I'm sure everyone else is too).<br>I'll use my global NoFlip = 1 to prevent the next Flip, and call it a day. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
