<!DOCTYPE html><html lang="en" ><head ><title >Preloading assets without the busy cursor icon</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Preloading assets without the busy cursor icon</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Preloading assets without the busy cursor icon</a><br><br>
<a name="1255076"></a>

<a name="1255077"></a>

<a name="1255078"></a>

<a name="1255079"></a>

<a name="1255080"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >videz</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> The busy icon looks really awkward when loading some medium to heavy assets for a game. I was wondering if there is a way or workaround where you could preload assets with full control (progress bars, etc) and make it look like those in professional builds without having that busy cursor spinning around and make it seem more like to crash on any moment..<br><br>Could this be just easy as using threads in Blitz (fast pointers, external libs, etc.. if available), hacking the cursor icon and change it to the default?<br><br>Any ideas??.. <br><br></td></tr></table><br>
<a name="1255093"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Unfortunately no muktithreading im blitz.  However. .. it is still possible to have a progress bar by breaking your load routine up with statements to update the screen between each file that is loaded. <br><br></td></tr></table><br>
<a name="1255095"></a>

<a name="1255096"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rroff</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Can use fastpointer to thread stuff but... loading stuff in one thread and using it in another is a bit... complicated. At the very least you really need custom loading and hand off functions for model, texture, etc. loading and probably a 3rd party sound API, etc. <br><br></td></tr></table><br>
<a name="1255125"></a>

<a name="1255126"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >videz</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Matty,<br><br>Have you done something similar and how did other's got this to work?<br><br>@Rroff <br><br>Yep I see it is a possibility with fastpointer and I don't mind getting my hands dirty when it becomes complicated. Maybe set all asset names to globals or something. I might use default sound fmod and not use threading with ogg files only. <br><br><br>I see that the opensource Stranded 2 uses preload screen but looking at their models and assets, it's not much of a burden to get that windows cursor panic and switch to busy state.<br><br>There's also Kryzchan's BlitzTiles to get some idea.. <br><br></td></tr></table><br>
<a name="1255130"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rroff</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Its a lot more complicated than global defining assets as you have to make sure they are locked to the render thread, etc. if being manipulated by another thread and all the rest of that thread semaphoring fun. <br><br></td></tr></table><br>
<a name="1255131"></a>

<a name="1255133"></a>

<a name="1255134"></a>

<a name="1255135"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >videz</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok given that, maybe it comes back to not using threads. I've seen a lot of Blitz3D/Max games using it to some extent (BattleTanks 2, etc)<br><br>So what's the routine how can this be done? Is there a code archive or posts somewhere which demonstrates a basic idea?<br><br>I googled in "blitzbasic preloading" search and I don't see anything related.<br><br>Is this feature still a mystery here? <br><br>thank you. <br><br></td></tr></table><br>
<a name="1255136"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >videz</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok maybe the other way around.<br><br>The main loop loads all the asset one by one, then a separate thread for the loading screen or counter update. <br><br></td></tr></table><br>
<a name="1255143"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes....(I have done something similar)<br><br><br>Usually in a game you are loading a number of files from the user's hard drive (or elsewhere) and most likely you will keep a list of what files need to be loaded before loading them....<br><br>Often I design my game programs with the following structure (loosely)<br><br>Initialise - ie set up windows/main render loop etc<br>Load stuff<br>Play Game<br>Unload Stuff<br><br>during the 'loadstuff' stage you will most likely be reading files in one by one...<br><br>Override the standard loading functions (like loadimage etc) by writing your own load function...<br><br>eg instead of loadimage(filename$) write:<br><br><pre class=code>
function myloadimage(filename$)

;in here call the regular loadimage command but before you do call another function, and at the end call another function ...eg like so:

updatestatusbar("Opening file:"+filename)
myimage = loadimage(filename$)
if(myimage=0) then 
     updatestatusbar("Error opening file:"+filename)
     ;;perform any necessary error handling stuff if the file didn't load
    return 0
endif
updatestatusbar("Completed opening file:"+filename)
return myimage

end function 

;and your function for updatestatusbar would look like this:
function updatestatusbar(statustext$)

;draw status text in here (perhaps have a globally accessible loading image which gets displayed called global_loadingimage

cls
drawimage global_loadingimage,0,0
text 0,0,statustext
flip


end function 

</pre><br><br><br>Similar processed could be put in place for sounds, 3d models, everything really...<br><br>I've just written that in my lunch break - took about 5 minutes...but it would look something like that in a model without threads....<br><br><br>Now with a multithreaded model it is not that hard - if it is done right.<br>I don't know about blitz but in java what I would do (and what I currently do) is this:<br><br>Have a boolean flag indicating whether or not the "loading" thread is currently running.<br>Initially when the app/program boots up it will be set to false. Upon entering the load routine the first line checks if the boolean variable is true or not. If it is true then skip out of the method....otherwise continue and set the boolean to true and then immediately spawn the new thread. Inside the new thread do all your work. Then at the last statement in the thread (or if it exits early) set the boolean back to false.<br><br>Keep your main thread for UI stuff, and only use threads for anything which has to run in the background. <br><br></td></tr></table><br>
<a name="1255146"></a>

<a name="1255147"></a>

<a name="1255148"></a>

<a name="1255149"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >videz</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Matt for your ideas here.<br><br><div class="quote"> <br>I don't know about blitz but in java what I would do (and what I currently do) is this..<br> <br></div><br><br>Yes in other languages or engines there are lots of ways to do this, even supports it, I have done this already as well. I'm asking it when using Blitz products, at least B3D/BP+, now with external libs offering multithreading and pointers.<br><br><div class="quote"> <br>Now with a multithreaded model it is not that hard - if it is done right.<br> <br></div><br>ok sounds good, at least I got some opinion that this is plausible without modifying source or sth.<br><br><br>Noted on the gui main render loop.. yes I was thinking of a counter variable or just a splash screen just to show the game is loading in progress and doing something. <br><br></td></tr></table><br>
<a name="1255242"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rroff</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Problem is the non threaded nature of DX7 - if your mid way loading a graphic asset on the main (native) thread and try to do a render update on another thread it could cause all kinds of issues.<br><br>You can definitely use it for loading other stuff though while rendering a loading screen. <br><br></td></tr></table><br>
<a name="1255251"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >videz</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey Rroff, can you provide a small demo code or snippet on how you think this could work? <br><br></td></tr></table><br>
<a name="1255312"></a>

<a name="1255313"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rroff</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm if you don't call renderworld, etc. I guess you could do 2D flipping while loading meshes, textures, etc. on another thread, never tried it though.<br><br>(Most of my thought on this has been from the angle of streaming assets in during playing the game). <br><br></td></tr></table><br>
<a name="1255388"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >videz</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok I guess that needs to be tested. I'm up for any solution, threaded or not, that at least will not show the windows busy cursor. <br><br></td></tr></table><br>
<a name="1255391"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xlsior</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Ok I guess that needs to be tested. I'm up for any solution, threaded or not, that at least will not show the windows busy cursor.  <br></div><br><br>HidePointer  ;-) <br><br></td></tr></table><br>
<a name="1255407"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >videz</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks xlsior. That's really a quick solution but I still like having the default cursor show up just to inform users that the game is not hanging.<br><br>I guess that will be the fail safe solution for now. <br><br></td></tr></table><br>
<a name="1255410"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xlsior</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Thanks xlsior. That's really a quick solution but I still like having the default cursor show up just to inform users that the game is not hanging. <br></div><br><br>Draw a progressbar or text statement tot he screen indicating progress, update after each individual asset gets loaded? <br><br></td></tr></table><br>
<a name="1255411"></a>

<a name="1255412"></a>

<a name="1255413"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Hmm if you don't call renderworld, etc. I guess you could do 2D flipping while loading meshes, textures, etc. on another thread, never tried it though. <br></div><br><br>For anyone reading this still thinking about threads, it's worth mentioning that <i>the entire BlitzBasic runtime</i> is non-thread-safe. Strings and type instances and all manner of other things have hidden reference counts and other forms of global state that <i>absolutely will</i> become corrupted the second you try to do anything clever with this. Any function that uses <i>any</i> assets other than pure integers and floats is unsafe. <br><br></td></tr></table><br>
<a name="1255434"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rroff</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> ^^ Indeed hence my post above - however if you hand off globals to a thread to load assets and don't touch those variables until the thread has exited (would need to subsequently check those variables to make sure they had validly loaded something) and are careful what you do while the thread is in flight then it should all work ok.<br><br>Agreed though unless you have carnal knowledge of exactly what is going on under the hood in that section of code while the thread(s) are active its very possible to have unexpected things happen usually = crash. <br><br></td></tr></table><br>
<a name="1255454"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >videz</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Yasha for your input. While it is enlightening to get informed with all these details. At this time, I'd be more interested in something to tell 'what to do' and 'how to do it' rather than seeing 'what not to do'.<br><br>Main reason why I posted this question here and maybe others who have the same problem can also get something from it. With this kind of problem and feature that has been used on so many games esp. PC, I thought this has been done already by someone here (code arcs etc) and given the language/product is over ten years old.<br><br><br>As for fast pointers, I remember seeing one example there where the render routine (turning cube) is happening on the thread loop and not the main loop itself.<br><br>If hiding the mouse pointer is all I can get then I guess I'll settle for this solution with blitz.. <br><br></td></tr></table><br>
<a name="1255495"></a>

<a name="1255496"></a>

<a name="1255499"></a>

<a name="1255509"></a>

<a name="1255517"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry, I didn't read the thread in depth and thought you were now looking on a different track.<br><br>Anyway, looking into it some more, we can refine the above restriction. You can use local integers, local floats, and any other asset command <i>that you know is thread safe</i>. i.e. have looked at <a href="https://github.com/blitz-research/blitzplus" target="_blank">the source</a> to confirm that it <i>is</i> safe rather than assume safe until proven otherwise.<br><br>I haven't gone over it in the detail that one should to make that assessment, but I'm pretty sure 2D image blitting is semi-safe (i.e. no risk as long as only one thread is actually trying to do it). UDP messaging also looks safe. <br><br>Assuming the messaging system itself is safe, you can communicate between threads using networking the same way you'd otherwise communicate between separate processes on separate machines: the host OS takes care of synchronising the message for you (ridiculous overkill, but it is safe, unlike anything involving globals).<br><br>Hence:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Const WRITE_PORT = 6000, LISTEN_PORT = 6001
Const MSG_NONE = 0, MSG_UPDATE = 1, MSG_RETURN = 2


Graphics 800, 600, 32, 2
SetBuffer BackBuffer()

Local LoadScreenPtr = FunctionPointer() : Goto skip : LoadScreen(0)
.skip

Local speaker = CreateUDPStream(WRITE_PORT), lhip = LocalHost()

Local imgThread = CreateThread(LoadScreenPtr, 0)

Local loaded = 0
Repeat
	loaded = loaded + LongLoadTime()
	WriteInt speaker, MSG_UPDATE : WriteInt speaker, loaded
	SendUDPMsg speaker, lhip, LISTEN_PORT
Until loaded &gt;= 100

WriteInt speaker, MSG_RETURN
SendUDPMsg speaker, lhip, LISTEN_PORT

;give it a chance to clear itself up
While IsThread(imgThread) : Delay 1 : Wend

Cls
Text 400, 300, "Done! Press a key to exit...", 1, 1
Flip : WaitKey()
End


Function LoadScreen(percentage)
	Local img = CreateLoadImage(), fr = 0, nums = CreateNumImage() ; no strings!
	Local listener = CreateUDPStream(LISTEN_PORT), msgType = MSG_NONE, msg = 0
	
	Repeat
		msg = RecvUDPMsg(listener)
		
		If msg
			msgType = ReadInt(listener)
			Select msgType
				Case MSG_NONE, MSG_RETURN ; don't actually carry extra information atm
				Case MSG_UPDATE
					percentage = ReadInt(listener)
			End Select
		Else
			msgType = MSG_NONE
		EndIf
		
		Cls
		fr = (fr + 1) Mod 60
		DrawImage img, 400, 300, fr
		DrawImage nums, 400 - 10, 300 + 100, (percentage Mod 100) / 10
		DrawImage nums, 400 + 10, 300 + 100, (percentage Mod 10)
		Flip
	Until msgType = MSG_RETURN
	
	CloseUDPStream(listener) : FreeImage img : FreeImage nums
	Return
End Function

Function LongLoadTime()
	Delay 5000
	Return 25
End Function

Function LocalHost()
	CountHostIPs("localhost")
	Return HostIP(1)
End Function

Function CreateLoadImage()
	Local img = CreateImage(64, 64, 60)
	HandleImage img, 32, 32
	Local tmp = CreateImage(64, 64)
	SetBuffer ImageBuffer(tmp)
	Color 255, 255, 255
	Oval 0, 0, 64, 64, True
	Color 0, 0, 0
	Rect 0, 0, 32, 32, True
	Color 255, 255, 255
	HandleImage tmp, 32, 32
	Local i : For i = 0 To 59
		SetBuffer ImageBuffer(img, i)
		Local cp = CopyImage(tmp)
		RotateImage cp, i * 6
		DrawImage cp, 32, 32
		FreeImage cp
	Next
	FreeImage tmp
	SetBuffer BackBuffer()
	Return img
End Function

Function CreateNumImage()
	Local nums = CreateImage(20, 20, 10), i : For i = 0 To 9
		SetBuffer ImageBuffer(nums, i)
		Text 10, 10, i, True, True
	Next
	SetBuffer BackBuffer()
	HandleImage nums, 10, 10
	Return nums
End Function

</textarea> <br><br></td></tr></table><br>
<a name="1255507"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >videz</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> awesome this is great Yasha! Thanks for shedding new light on this. Yes, I haven't look at the thread safe part in source but that is good to know. :-)<br><br>great insight, as always! :) will try this example.. <br><br></td></tr></table><br>
<a name="1255514"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >videz</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> After testing the code, I'm still getting a busy cursor and it always crashes after a few seconds. <br><br>Any ideas on this Yasha? <br><br></td></tr></table><br>
<a name="1255519"></a>

<a name="1255522"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> Apart from a missing Flip at the end (added), the above runs correctly on two different machines, in both Debug and non-Debug, and even under Wine. Sorry, I got nothin'. I hope the underlying idea is useful even if the example is not.<br><br>The busy cursor might just be to do with lack of Delay pauses in the loops (don't know, don't see it here). <br><br></td></tr></table><br>
<a name="1255521"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> There are ways to asynchronously read data from a file, you can use the Win32 API for that.<br><br>The problem is that Blitz3D does not offer any official method of loading an asset from a memory buffer, which is the result of reading a file asynchronously. All of the Load[something] functions take in file paths as parameters and load from the hard disk.<br><br>Also, there isn't a way to add bones to a mesh procedurally. The API for that isn't exposed for some reason, so you can't do this with skinned meshes for example.<br><br>You can use BlitzMax and MiniB3D for that, with minor adjustments to read from a memory buffer instead of a file.<br>Like you said, Blitz3D is over ten years old. If the reason that you're using Blitz3D is that it's free, there are far more modern free and open source game engine alternatives that have asynchronous asset loading. <br><br></td></tr></table><br>
<a name="1255540"></a>

<a name="1255541"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>Also, there isn't a way to add bones to a mesh procedurally. The API for that isn't exposed for some reason, so you can't do this with skinned meshes for example.<br> <br></div><br>What about this :<br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=2485" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=2485</a><br><br>I have never tried it because i don't need it, but it may be useful. <br><br></td></tr></table><br>
<a name="1255554"></a>

<a name="1255563"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> I see the need to hack into the engine to add features that should've been standard as a sign that I need to use some other engine that is better suited to my needs. <br><br></td></tr></table><br>
<a name="1255558"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> How about running two separate Blitz3D executables. The main executable could write to a directory with a progress status - this could be simply a number, or potentially writing a numerous small text file(s) to said directory. The separate progress B3D executable could present a progress bar that would be dependent upon potentially how many files are present in said directory, or the number contained within said directory. Might need a semaphore to prevent both executables trying to access a single file at the same time. <br><br></td></tr></table><br>
<a name="1256215"></a>

<a name="1256216"></a>

<a name="1256217"></a>

<a name="1256218"></a>

<a name="1256219"></a>

<a name="1256220"></a>

<a name="1256221"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is some loading progress stuff - you could interleave writing out to a .dat file within the start of your main. Might not be what your looking for, but was something I'd been toying with myself for a while.<br><br>You'd need to interleave the loading of the 'big' assets with a write to a progress.dat file with an Integer of your choosing to depict what percentage has been loaded.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; Write Progress by Blitzplotter - 24 Jan 15
;
; Writes to a count of 0 to 100 to a progress file
;
; WriteProgress.bb
;

Graphics 300,130,16,2

AppTitle "Write progress data"

Print "Press Any Key once you have compiled"
Print "and ran the LoadProgress_Main.bb file....."
Print " "
Print "Left click in this window to:"
Print "  "
Print "... Press Any Key....."

;reset the counter

progress_filename$="./progress_file_Int.dat"

output = WriteFile(progress_filename$)

WriteInt output,1

CloseFile(output)

WaitKey

counter% = 1

While progress_counter&lt;=100
	
	counter=counter+1
	
	output = WriteFile(progress_filename$)
	
	WriteInt(output,counter)

	CloseFile(output)
		
	progress_counter=progress_counter+1
	
	oldTime=MilliSecs()
	While MilliSecs() &lt; oldTime + 90
		;Text 20,20,"Still waiting!: "+MilliSecs+" oldtime: "+oldTime
	Wend 
	
	Print "Progress Counter: "+progress_counter
	
Wend

;write out the current counter

output = WriteFile(progress_filename$)

WriteInt output,1

CloseFile(output)

End



</textarea><br><br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">

; Load Progress by Blitzplotter - 24 Jan 15
;
; LoadProgress_Main.bb
;
; Reads a local file progress_file_Int.dat
; and updates a progress bar with whatever
; is stored there
;
; Note: Compile and run the WriteProgress.bb first



Graphics 800,200,32,2

AppTitle "Loading Progress Monitor"


Counter%=10

Text 100,200,"This is the file load progress executable...."

;open the progress file for reading

progress_filename$="./progress_file_Int.dat"



;Loop around until progress read in as 100 percent

Text 200,80,"0"
Text 500,80, "100"

.keep_reading_file

filename = ReadFile (progress_filename$)	;load the config file



If filename &lt;&gt; 0								;only continue if the file exists
	;While Not Eof (filename)				;keep reading until the end of the file
		;If 1stlineone=0
		
	Counter% = ReadInt(filename)	
		
		Text 100,600,"Progress Counter at: "+Counter%
		
		CloseFile(filename)	
		
Else
	Text 100,300,"DEBUG: Progress_File_Locked, trying again soon...."
	
	Text 100,500,"Press Any Key to try again...."
	
	WaitKey
	
	End
EndIf




;Text 360,50,"File Loading Progress: "+Counter%

oldTime=MilliSecs()
While MilliSecs() &lt; oldTime + 10
	;Text 20,20,"Still waiting!: "+MilliSecs+" oldtime: "+oldTime
Wend 
	
VWait(50)

;make a little progress bar how_thick pixels tall

how_thick=20

For thickness=1 To how_thick
	Line 200,100+thickness,200+(Counter%*3),100+thickness
Next

If Counter% &lt; 100 Then Goto keep_reading_file

Text 200,140,"Finished Loading.... Press Any Key to Continue "

WaitKey

End

</textarea><br><br><img src="http://www.wishingwellsoftware.co.uk/progressgrab.png"> <br><br></td></tr></table><br>
<a name="1256222"></a>

<a name="1256223"></a>

<a name="1256224"></a>

<a name="1256225"></a>

<a name="1256226"></a>

<a name="1256227"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> Why not use hidepointer() and draw an image of the os cursor at mousex() mousey() ?<br><br>To capture the image of the os cursor, with windows :  <br>go to control panel&gt;mouse&gt;pointer and do a screen capture (print key) of the cursor, then paste this cursor in your favorite image editing program, then make sure the top left of the image is the edge of the cursor, then color all pixels which must be invisible, in black (0,0,0) then save this image as bmp or png.<br>Then load this image and the black pixels should be invisible and you will be able to draw the cursor at the mouse position.<br><br>Oh i have just noticed that it may not work if you are loading many/big files during a long time... <br>To prevent this you could load the files progressively and update the screen regularly (at least 1fps) (=stop to load files for this frame if the looptime is superior to 1000ms) <br><br></td></tr></table><br>
<a name="1256306"></a>

<a name="1256308"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> RemiD, that seems a little convoluted. I admit, I've read your post a few times - and it doesn't seem immediatly clear what your driving at.<br><br>Sorry, I suppose I should investigate the hidepointer() thingy... ;) <br><br></td></tr></table><br>
<a name="1256323"></a>

<a name="1256324"></a>

<a name="1256325"></a>

<a name="1256326"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> @blitzplotter&gt;&gt;Basically, what i meant was that if the "wait cursor" of Windows appears, it is probably after the program has been "unresponsive" after xs or xms, so in order to prevent that, the idea is to load components, a few at a time, and update the graphics window regularly. <br>I have not idea after how many s or ms Windows considers that a program becomes "unresponsive" so my suggestion is to continue to load components if the loop time is inferior to 1000ms (just an example, it can be more ms), then to update the graphics window, then to continue to load others components.<br><br>Here is an example :<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Graphics3D(1024,768,32,2)

SeedRnd(MilliSecs())

Global Arial14Font = LoadFont("Arial",14,False,False,False)

Global Camera = CreateCamera()
CameraRange(Camera,0.1,100)
CameraClsColor(Camera,1,1,1)

Global ProgramState% 
Const CLoadComponents% = 1
Const CInitialize% = 2
Const CUpdate% = 3
Const CEnd% = 4

ProgramState = CLoadComponents
DebugLog("ProgramState becomes LoadComponents")
SetFont(Arial14Font)
Color(255,255,255) 
Text(0,0,"Load components...")

Global ComponentName$ = "A"

Global LoopsCount% = 0

Main()

Function Main()

 While( ProgramState &lt;&gt; CEnd ) 

  LoopsCount = LoopsCount + 1

  If( ProgramState = CLoadComponents )
   MsStart% = MilliSecs()
   Repeat
    If( ComponentName$ = "A" )
     ;load A component
     MsTimeItTakesToLoadThisComponent% = Rand(100,1000)
     TMsStart% = MilliSecs()
     Repeat
      TMsTime% = MilliSecs() - TMsStart
     Until( TMsTime &gt;= MsTimeItTakesToLoadThisComponent )
     DebugLog("A component loaded")
     ;after having loaded the component, select the next component 
     ComponentName$ = "B"
    Else If( ComponentName$ = "B" )
     ;load B component
     MsTimeItTakesToLoadThisComponent% = Rand(100,1000)
     TMsStart% = MilliSecs()
     Repeat
      TMsTime% = MilliSecs() - TMsStart
     Until( TMsTime &gt;= MsTimeItTakesToLoadThisComponent )
     DebugLog("B component loaded")
     ;after having loaded the component, select the next component  
     ComponentName$ = "C"
    Else If( ComponentName$ = "C" )
     ;load C component
     MsTimeItTakesToLoadThisComponent% = Rand(100,1000)
     TMsStart% = MilliSecs()
     Repeat
      TMsTime% = MilliSecs() - TMsStart
     Until( TMsTime &gt;= MsTimeItTakesToLoadThisComponent )
     DebugLog("C component loaded")
     ;after having loaded the component, select the next component 
     ComponentName$ = "D"
    Else If( ComponentName$ = "D" )
     ;load D component
     MsTimeItTakesToLoadThisComponent% = Rand(100,1000)
     TMsStart% = MilliSecs()
     Repeat
      TMsTime% = MilliSecs() - TMsStart
     Until( TMsTime &gt;= MsTimeItTakesToLoadThisComponent )
     DebugLog("D component loaded")
     ;after having loaded the component, select the next component 
     ComponentName$ = "E"
    Else If( ComponentName$ = "E" )
     ;load E component
     MsTimeItTakesToLoadThisComponent% = Rand(100,1000)
     TMsStart% = MilliSecs()
     Repeat
      TMsTime% = MilliSecs() - TMsStart
     Until( TMsTime &gt;= MsTimeItTakesToLoadThisComponent )
     DebugLog("E component loaded")
     ;after having loaded the component, select the next component 
     ComponentName$ = "F"
    Else If( ComponentName$ = "F" )
     ;load F component
     MsTimeItTakesToLoadThisComponent% = Rand(100,1000)
     TMsStart% = MilliSecs()
     Repeat
      TMsTime% = MilliSecs() - TMsStart
     Until( TMsTime &gt;= MsTimeItTakesToLoadThisComponent )
     DebugLog("F component loaded")
     ;after having loaded the component, select the next component 
     ComponentName$ = "G"
    Else If( ComponentName$ = "G" )
     ;load G component
     MsTimeItTakesToLoadThisComponent% = Rand(100,1000)
     TMsStart% = MilliSecs()
     Repeat
      TMsTime% = MilliSecs() - TMsStart
     Until( TMsTime &gt;= MsTimeItTakesToLoadThisComponent )
     DebugLog("G component loaded")
     ;after having loaded the component, select the next component 
     ComponentName$ = "H"
    Else If( ComponentName$ = "H" )
     ;load H component
     MsTimeItTakesToLoadThisComponent% = Rand(100,1000)
     TMsStart% = MilliSecs()
     Repeat
      TMsTime% = MilliSecs() - TMsStart
     Until( TMsTime &gt;= MsTimeItTakesToLoadThisComponent )
     DebugLog("H component loaded")
     ;after having loaded the component, select the next component 
     ComponentName$ = ""
    EndIf
    MsTime% = MilliSecs() - MsStart
   Until( MsTime &gt;= 1000 Or ComponentName = "" )
   If( ComponentName = "" )
    ProgramState = CInitialize
    DebugLog("ProgramState becomes Iniatilize")
   EndIf 
  Else If( ProgramState = CInitialize )
   ;initialize things
   CameraClsColor(Camera,Rand(025,255),Rand(025,255),Rand(025,255))
   DebugLog("things initialized") 
   ProgramState = CUpdate
   DebugLog("ProgramState becomes Update")
  Else If( ProgramState = CUpdate )
   If( KeyHit(57) = 1)
    CameraClsColor(Camera,Rand(025,255),Rand(025,255),Rand(025,255))
    DebugLog("things updated")
   EndIf
   If( KeyDown(1) = 1 )
    ProgramState = CEnd
    DebugLog("ProgramState becomes End")
   EndIf
  EndIf

  If( KeyDown(2) = 1 )
   WireFrame(True)
  Else
   WireFrame(False)
  EndIf

  SetBuffer(BackBuffer())
  RenderWorld()
  
  SetFont(Arial14Font)
  Color(255,255,255) 
  If( ProgramState = CLoadComponents )
   Text(0,0,"Load components...")
  Else If( ProgramState = CInitialize )
   Text(0,0,"Initialize...")
  Else If( ProgramState = CUpdate )
   Text(0,0,"Update...")
  EndIf

  Text(0,14,"LoopsCount = "+LoopsCount)

  Flip(1)

 Wend

End Function

ClearWorld()

End()
</textarea><br><br>hidepointer() may not be necessary in this case.<br><br>(when ProgramState = CUpdate, press the escape key to exit the program) <br><br></td></tr></table><br>
<a name="1256328"></a>

<a name="1256330"></a>

<a name="1256353"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#32">[#32]</a></td></tr></table></td></tr><tr ><td class="posttext"> Another example :<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Graphics3D(1024,768,32,2)

SeedRnd(MilliSecs())

Global Arial14Font = LoadFont("Arial",14,False,False,False)

Global Camera = CreateCamera()
CameraRange(Camera,0.1,100)
CameraClsColor(Camera,1,1,1)

Global ProgramState% 
Const CLoadComponents% = 1
Const CInitialize% = 2
Const CUpdate% = 3
Const CEnd% = 4

ProgramState = CLoadComponents

Global ComponentsCount%
Dim ComponentKind%(100)
Dim ComponentName$(100)
Dim Component(100)

Const CFont% = 1
Const CImage% = 2
Const CMesh% = 3
Const CTexture% = 4
Const CAnimation% = 5

ComponentsCount = ComponentsCount + 1
Id% = ComponentsCount
ComponentKind(Id) = CFont
ComponentName(Id) = "A_Font.font"

ComponentsCount = ComponentsCount + 1
Id% = ComponentsCount
ComponentKind(Id) = CFont
ComponentName(Id) = "B_Font.font"

ComponentsCount = ComponentsCount + 1
Id% = ComponentsCount
ComponentKind(Id) = CFont
ComponentName(Id) = "C_Font.font"

ComponentsCount = ComponentsCount + 1
Id% = ComponentsCount
ComponentKind(Id) = CImage
ComponentName(Id) = "A_Image.png"

ComponentsCount = ComponentsCount + 1
Id% = ComponentsCount
ComponentKind(Id) = CImage
ComponentName(Id) = "B_Image.png"

ComponentsCount = ComponentsCount + 1
Id% = ComponentsCount
ComponentKind(Id) = CImage
ComponentName(Id) = "C_Image.png"

ComponentsCount = ComponentsCount + 1
Id% = ComponentsCount
ComponentKind(Id) = CMesh
ComponentName(Id) = "A_Mesh.b3d"

ComponentsCount = ComponentsCount + 1
Id% = ComponentsCount
ComponentKind(Id) = CMesh
ComponentName(Id) = "B_Mesh.b3d"

ComponentsCount = ComponentsCount + 1
Id% = ComponentsCount
ComponentKind(Id) = CMesh
ComponentName(Id) = "C_Mesh.b3d"

ComponentsCount = ComponentsCount + 1
Id% = ComponentsCount
ComponentKind(Id) = CTexture
ComponentName(Id) = "A_Texture.b3d"

ComponentsCount = ComponentsCount + 1
Id% = ComponentsCount
ComponentKind(Id) = CTexture
ComponentName(Id) = "B_Texture.b3d"

ComponentsCount = ComponentsCount + 1
Id% = ComponentsCount
ComponentKind(Id) = CTexture
ComponentName(Id) = "C_Texture.b3d"

ComponentsCount = ComponentsCount + 1
Id% = ComponentsCount
ComponentKind(Id) = CAnimation
ComponentName(Id) = "A_Animation.ani"

ComponentsCount = ComponentsCount + 1
Id% = ComponentsCount
ComponentKind(Id) = CAnimation
ComponentName(Id) = "B_Animation.ani"

ComponentsCount = ComponentsCount + 1
Id% = ComponentsCount
ComponentKind(Id) = CAnimation
ComponentName(Id) = "C_Animation.ani"

Global ACId% = 0 ;active component Id

Global LoopsCount% = 0

Global Line1Str$
Global Line2Str$
Global Line3Str$

Main()

Function Main()

 While( ProgramState &lt;&gt; CEnd ) 

  LoopsCount = LoopsCount + 1

  If( ProgramState = CLoadComponents )
   Line1Str = "loading components..."
   MsStart% = MilliSecs()
   Repeat
    ACId = ACId + 1
    ;If( ComponentKind(ACId) = CFont )
     ;Component(ACId) = LoadFont("./Fonts/"+ComponentName(ACId))
    ;Else If( ComponentKind(ACId) = CImage )
     ;Component(ACId) = LoadImage("./Images/"+ComponentName(ACId))
    ;Else If( ComponentKind(ACId) = CMesh )
     ;Component(ACId) = LoadMesh("./Meshes/"+ComponentName(ACId))
    ;Else If( ComponentKind(ACId) = CTexture )
     ;Component(ACId) = LoadTexture("./Textures/"+ComponentName(ACId))
    ;Else If( ComponentKind(ACId) = CAnimations )
     ;Component(ACId) = LoadAnimation("./Animations/"+ComponentName(ACId))
    ;EndIf
    Line2Str = "loading "+ComponentName(ACId)
    MsTimeItTakesToLoadThisComponent% = Rand(100,1000)
    TMsStart% = MilliSecs()
    Repeat
     TMsTime% = MilliSecs() - TMsStart
    Until( TMsTime &gt;= MsTimeItTakesToLoadThisComponent )
    Line2Str = ComponentName(ACId)+" loaded"
    SetBuffer(BackBuffer())
    ClsColor(000,000,000)
    Cls()
    ;RenderWorld() 
    SetFont(Arial14Font)
    Color(255,255,255) 
    Text(0,0*14,Line1Str)
    Text(0,1*14,Line2Str)
    Text(0,2*14,Line3Str)
    Flip(1)
    MsTime% = MilliSecs() - MsStart
   Until( MsTime &gt;= 1000 Or ACId = ComponentsCount )
   If( ACId = ComponentsCount )
    Line1Str = "all components loaded"
    ProgramState = CInitialize
   EndIf 
  Else If( ProgramState = CInitialize )
   Line1Str = "initializing things..."
   Line2Str = ""
   CameraClsColor(Camera,Rand(025,255),Rand(025,255),Rand(025,255))
   Line1Str = "things initialized" 
   ProgramState = CUpdate
  Else If( ProgramState = CUpdate )
   Line1Str = "updating things..."
   Line2Str = ""
   If( KeyHit(57) = 1)
    CameraClsColor(Camera,Rand(025,255),Rand(025,255),Rand(025,255))
    Line1Str = "things updated"
   EndIf
   If( KeyDown(1) = 1 )
    ProgramState = CEnd
   EndIf
  EndIf
  Line3Str = Str(Loopscount)

  If( KeyDown(2) = 1 )
   WireFrame(True)
  Else
   WireFrame(False)
  EndIf

  SetBuffer(BackBuffer())
  ClsColor(000,000,000)
  Cls()
  RenderWorld()
  
  SetFont(Arial14Font)
  Color(255,255,255) 
  Text(0,0*14,Line1Str)
  Text(0,1*14,Line2Str)
  Text(0,2*14,Line3Str)

  Flip(1)

 Wend

End Function

ClearWorld()

End()
</textarea><br><br>(when ProgramState = CUpdate, press the escape key to exit the program) <br><br></td></tr></table><br>
<a name="1256455"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#33">[#33]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ah, thanks for the additional clarification, appreciated. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
