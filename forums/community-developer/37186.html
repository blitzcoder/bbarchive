<!DOCTYPE html><html lang="en" ><head ><title >sswift shadow system Q</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >sswift shadow system Q</h1><a href="forums.php" >Community Forums</a>/<a href="topics.php?forum=83" >Developer Stations</a>/<a href="#bottom" >sswift shadow system Q</a><br><br>
<a name="408355"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> How can I prevent the lights will  cast trough walls? I have set the entitypickmode of the receiver(s) to 2, but there is still some shadows casted by a light that is behind a wall. How do I stop this? I cannot reduce the light range since the range is actually already small.<br><br>Is there a special forum for the sswift shadow system? <br><br></td></tr></table><br>
<a name="408362"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> No, there isn't a special forum.<br><br>As for your question... <br><br>There is nothing in the system to prevent a shadow being cast from an entity from light which is behind a wall.  I'm not a miracle worker. :-)  I cannot just use a linepick or an entityvisible call in order to determine if a light can see an entity, because that might conflict with whatever someone is using pickmodes for, and to be quite frank, I never thought of doing it.  There is no way for example to prevent a shadow from being cast though two walls, but yes, in theory you could stop a shaodw from being cast at all if the caster cannot see the light source.<br><br>I do not think it would be wise to implement such a thing in the shadow system as each game uses different methods to dtermine what is occluded and what is not, and that could be slow, or as I said, conflict with something else you want to do with linepicks.  <br><br>However, if you wish to modify the system to do this check, then it should be fairly simple.<br><br>In the Update_Shadows function, you will see the following code near the start:<br><br><pre class=code>
	; Loop through all the pairs of light sources and shadow casters.
	For ThisSet = Each Caster_Set

		; The reason we group these into sets is so that a texture can be created and maintained for each set. 
		; We don't always update the texture every frame, so we need to preserve the pointer to it.
		
		; We could probably perform the same operation with the meshes, however the only time a mesh be be able
		; to be retained from frame to frame would be if the caster, light source, and recevier had all stayed at
		; the same location in space between frames.
		
		; Implementing this would remove the need for static shadows, but would create the need to be able to specify
		; that certain light sources only affect certain caster/receiver pairs.

		; It is also tempting because removing the need for static shadows would remove the need to have two copies
		; of most of the below code, one for regular shadows and one for static shadows.

		ThisLight.Light_Caster   = ThisSet\Light
		ThisCaster.Shadow_Caster = ThisSet\Caster		
</pre><br><br><br>After this, ThisLight\Entity and ThisCaster\Entity hold the pointers to the entities that you are positioning in your world for each.   Right after this code, you can just stick a check to see if they can see eachother with entityvisible, or linepick, whichever pleases you.   If they can't see eachother then skip all the rest of the code in the loop and allow the loop to proceed to the next caster set.<br><br><br>You may get better performance however if you move this check a little bit further down in the code.  Immediately after the above, there is a check to see if the distance between the light and caster is too great.  This check is probably quite a bit faster than an entityvisible check, so you could put the entityvisible check AFTER the distance check so that you cull as many lights/caster pairs as possible just based on distance. <br><br></td></tr></table><br>
<a name="408779"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, thanks for that tip! <br><br></td></tr></table><br>
<a name="409569"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >poopla</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> On the subject, does your system only handle spot lights?  Or will it do omni?  If it does omni, how are you managing the texture generation for that? <br><br></td></tr></table><br>
<a name="409580"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Shattered:<br><br>My system uses a hybrid light source that behaves like an omni light.<br><br>Basically, I point the light's camera at each object, and render a texture.  Then I project that texture onto the surfaces behind the object.  <br><br>So it is as if each light is actually a bunch of spotlights, one pointed at each nearby object that casts a shadow.<br><br>I do this because it's efficient.  It allows high res shadows, with little overdraw. <br><br></td></tr></table><br>
<a name="413415"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, works great. Just added<br>If EntityVisible(ThisLight\Entity, ThisCaster\Entity)<br>right after the line<br>If Light_To_Caster_Distance# &lt;= ...<br>(that's line 772 here, but I made some modifications, so it may be somewhere around 772)<br><br>The only problem is now for example when a caster is walking behind a row of columns, his shadow switches on and off everytime a column is obscuring sight to the light source. Especially since EntityVisible checks only the center of the entity, and also because the lightmap has very soft shadows compared to the realtime shadows, but hey, nobody's perfect. Before I thougt it looks wrong when they STILL got shadows, regardless if they are standing in the shadow of eg. a column.<br>This method isn't too slow, the loss of speed trough EntityVisible is partially compensated by the saving of lightcasting of obscured lights.<br><br>Thanks for the help! <br><br></td></tr></table><br>
<a name="413420"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> "The only problem is now for example when a caster is walking behind a row of columns, his shadow switches on and off everytime a column is obscuring sight to the light source."<br><br><br>If you don't want columns to block the light, then you'll have to make the columns a sepetate mesh that cannot block line of sight.<br><br>The shadow system does have the ability to blur shadows, at a cost.  Look at the global variables.  It's not perfect, but it is hardware accelerated, and it might make the shadows match your lightmaps a little better. <br><br></td></tr></table><br>
<a name="413782"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I know, but I am already at the limit concerning framerate. <br><br>It's not that bad with the columns, and it would comlicate the engine too much since currently the whole static part is one Mesh, this also saves surfaces.<br><br>But anyway, I modded your system in a lot of ways. It is now using a copy of the level mesh that consists only the Tris that are near the player. This hidden (singlesurface) copy is frequently created clusterwise. The engine also dynamicly creates lightemitter, depending on the Character locations. I see, it works pretty good with one light in a scene, also with multiple Casters, but as soon as there are 2 or 3 light that are affecting one or more Character, the Framerate goes real down. So the conclusion is: Create the lights of a level with the realtime lighting system in mind, never position multiple lights too close to one another, unless you won't use them for realtime rendered shadows. At least it was pretty easy to extract the light positions from a gile[s] exported mesh, so maybe I only need to go back to giles and edit the lights. (which is an other issue due to unique loading and redering times of the 2k lightmapsize on a weak machine)<br><br>I am still trying to make hte shadows faster. I wonder how they did the shadow system of the hitman 2 engine (something similar, but faster). <br><br></td></tr></table><br>
<a name="414517"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Darn, it's gettin tricky. The camera entity is breaking trough the ceil when the player is crawling trough aircondition shafts and other small gangways. The camera (head) has its own collision because using one COllision radius only for the whole player would require to alter the collisionradius of it at runtime due to crouching, and this would result in fall-trough floor artifacts, which is even worse than breaking trough the ceil.<br><br>I am really stuck with this problem. I can deactivate the realtime shadows by hitting f10, and then it works without any problems.<br><br>Even when I shoot all casting Chars and their casters are removed and the framerate rises to the same like when realtime shadow are turned off, this still happens. So now I guess it's not the framerate. I also checked if the shadow include file does alter the entitytype of radius of the camera, but that's not the problem.<br><br>I simply can't track this bug down. Any ideas? <br><br></td></tr></table><br>
<a name="414537"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't understand the question. <br><br></td></tr></table><br>
<a name="414548"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> What could cause this behaviour of the camera entity? It works without the realtime shadow system, but doesn't when it's turned on. It feels like collision of the camera isn't handled anymore, but I explicitely reset the entitytype of the camera right after the UpdateShadows call, to make sure it is set correctly. <br><br></td></tr></table><br>
<a name="414562"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, nailed the sucker. Inside the UpdateShadows Function you need to:<br><br>change<br>HideEntity Current_Camera<br>to<br>CameraProjMode Current_Camera, 0<br><br>and<br>ShowEntity Current_Camera<br>to<br>CameraProjMode Current_Camera, 1<br><br>The sucker took me about 10 Hours so far. Hideentity performs some kind of Updateworld with hidden (thus collision off) state.<br><br>I have to say, I made the Shadow_cam global and mabe it to be created only once at startup, and then only hide and show it inside the UpdateShadows function. Maybe this causes this bugous behaviour. <br><br>However, I thought it should work with two cameras by hiding and showing then depending on usage. But it doesn't! So note: use CameraProjMode instead of HideEntity for the Cameras! <br><br></td></tr></table><br>
<a name="414586"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Why did you change code which didn't need to be changed?  If the creating and deleting of a camera isn't causing problems, I don't see why you changed that. :-P<br><br>I'll consider making the change you suggested to the system, but I would like to know if what you changed caused this problem.  I doubt it did.  You are probably right that hiding the camera even temporarily causes Blitz to mess up the collision stuff. <br><br></td></tr></table><br>
<a name="414591"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, I think so too it doesn't have anything to do with the Shadow_Cam at all, I just mentioned it to be fair.<br><br>Basicly I try to avoid to continously create and delete things because this almost every time leads to resource fragmentation.<br><br>I hardly suggest to use CameraProjMode since hideentity REALLY kills the current position and positions the entity where it would be without collision, <b>even when you don't call UpdateWorld</b>, and CameraProjMode leaves the position intact, and it's also faster, from what the docs say. <br><br></td></tr></table><br>
<a name="414620"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> As for the speed, the docs are out of date.  Mark fixed hiding entities so it's instant now. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
