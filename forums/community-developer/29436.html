<!DOCTYPE html><html lang="en" ><head ><title >Blitz Virtual Machine rocks!</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Blitz Virtual Machine rocks!</h1><a href="forums.php" >Community Forums</a>/<a href="topics.php?forum=83" >Developer Stations</a>/<a href="#bottom" >Blitz Virtual Machine rocks!</a><br><br>
<a name="311554"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JaviCervera</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have purchased BVM yesterday, and it's totally awesome. I am making some test to implement it into my game engine, so I can code the behaviour of my entities using scripts :)<br><br>I have some question about it tho:<br><br>I want my engine to do the following: When the engine runtime (the EXE) is executed, it loads all the .bbm modules it finds on its resource paths (by default, the EXE's folder, but you can define more paths), and then executes the main script (the same name as the EXE, but .bbm extension).<br><br>I can load a world in that script with the function csWorld_Load("world.b3d"). The world can contain some entities. For example, it would contain an entity named "info_player_start". In that case, one of the scripts loaded at bootup should contain a function called "info_player_start".<br><br>On the main loop of the main script, I call the function csFrame(), which wraps UpdateWorld, RenderWorld, Flip, and updates the entities.<br><br>To update the entities, i search on all the modules loaded for a function with the name of the entity. If that function is found, then i set that function as the entry point and call it. The problem is that BVM_Run() gives a "Memory Access Violation". Would you please Koriolis show me an example on how to do this? It's basically execute one script, which calls a function from another script and then continues executing.<br><br>It's maybe because i have both the main script and the entities scripts in the same contexts? <br><br></td></tr></table><br>
<a name="311615"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >IPete2</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have no idea what a virtual machine is?<br><br>Can anyone help?<br><br>IPete2. <br><br></td></tr></table><br>
<a name="311616"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >IPete2</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have no idea what a virtual machine is?<br><br>Can anyone help?<br><br>IPete2. <br><br></td></tr></table><br>
<a name="311618"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Physt</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> google good...<br><br><a href="http://koriolis.free.fr/news/index.html" target="_blank">http://koriolis.free.fr/news/index.html</a> <br><br></td></tr></table><br>
<a name="311619"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JaviCervera</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> A virtual machine is an application that acts as a processor. The usefulness of Blitz Virtual Machine is that it works embedded into a Blitz program.<br><br>You can for example create a script (which is simply a blitz source file) which controls every element in your game (the player, the enemies...) and compile them to bytecode (this would be understood as the 'machine code' that your virtual machine understands). Plug the scripts in an 'entities' folder (for example) and use the virtual machine from your main Blitz program to execute the scripts and control the entities using them. <br><br></td></tr></table><br>
<a name="311623"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >(tu) sinu</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> it's been posted about alot, maybe you should do a search on here for it. <br><br></td></tr></table><br>
<a name="311636"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Koriolis</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I have purchased BVM yesterday, and it's totally awesome <br></div>Cool :) Are you close to a demo? I can't wait to see some kick ass production using BVM.<br><br><div class="quote"> On the main loop of the main script, I call the function csFrame(), which wraps UpdateWorld, RenderWorld, Flip, and updates the entities <br></div>It would probably be better to keep the main loop in your host application, and to call in this loop a function in your "main script" that updates the entities. But that's only an advice.<br><br><div class="quote"> To update the entities, i search on all the modules loaded for a function with the name of the entity. If that function is found, then i set that function as the entry point and call it. The problem is that BVM_Run() gives a "Memory Access Violation". Would you please Koriolis show me an example on how to do this? It's basically execute one script, which calls a function from another script and then continues executing. <br> <br></div>If I understand correctly, you're trying to load &amp; execute a script from within another script. If so, you should either:<br>1) put your updating function rather in the host program, and use the scripts only for your entity functions. There shouldn't be any problem.<br>2) if you really want to load &amp; execute them from within another script, then you should indeed put your "main" script in another context.<br>I think I can make it so what you do right now works as is (I'll give you a firm answer on that issue later), but in the current version this is not doable that way.<br><br><br>BTW, the OO feature together with another one (I won't say too much right now, forgive me, as some things are still likely to change) that I'm adding will allow to do thies kind of things in much neater and simpler way :)<br>Shouldn't be that hard to convert your system later (when I release the new version), if you're ready to take the plunge into OO.<br><br><br>[EDIT]For questions, you may as well post on my new forum. Having a central place for this is better for BVM users[/EDIT] <br><br></td></tr></table><br>
<a name="311679"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >IPete2</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks guys,<br><br>I understand a bit more now.<br><br>IPete2. <br><br></td></tr></table><br>
<a name="311717"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GW</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Why not try this:<br><br>If all of your entitys are going to behave the same way, why not write one script <br>that process' that control.<br><br>Your script will have a function that takes a Type as a parameter. like:<br><pre class=code>
Function Update_Entity(E.Entity)

	;; do something with the E type instance
	
End function 
</pre><br><br>Your entitys are created and defined in your main application, and exposed to the scripting engine<br>then simply pass each entity into the function and process them.<br><br>example:<br><pre class=code>
;; setup your BVM context here ;;

For E.Entity =  each Entity
	BVM_PushInt(Handle(E))  
	BVM_SelectEntryPoint( &lt;your entry point&gt; )
	BVM_Invoke_&lt;whatever&gt;()
	BVM_PopInt()
Next 
</pre><br><br>(typeing from memory, the syntax may not be correct)<br><br>That way when you want to change the way your entitys behave, you just alter this one <br>script and reload. ;-) <br><br></td></tr></table><br>
<a name="311723"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Koriolis</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yep, that's grossly what I had in mind with point (1). It seems the simpler and effective alternative to me. <br><br>One note: better not use directly "Handle" to push the object, but rather use BVM_Push&lt;TYPE&gt;_&lt;CMDSET&gt; (cf the doc) and pass it the object. That way if I ever change the way objects from the host app are passed to BVM, that won't broke your code.<br><br>To refine it a bit, it *could* be:<br><pre class=code>;; setup your BVM context here ;;
;; let's have an additional field in Entity named 'hEntryPoint', that you previously intialized
;; to point to the suitable entry point (according to the entity name)

For E.Entity =  each Entity
	BVM_PushEntity_&lt;CMDSET&gt;(E) 
	BVM_SelectEntryPoint(E\hEntryPointP)
	BVM_Invoke_&lt;CMDSET&gt;()
	BVM_PopInt()
Next</pre><br>And to avoid letting the scripts accessing the 'hEntryPoint' field (which they don't need to), just don't mention this field in declaration of Entity in the command set file.<br><br>But again it's all up to Jedive to decide what suits best his needs. <br><br></td></tr></table><br>
<a name="312008"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JaviCervera</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thans for your answers. I worked on this very hard last night, and I have ducesfully implemented BVM in my engine the way I wanted to do it.<br><br>It were easier than I thought. I just created one context for the main script and another context for the entities.<br><br>When the csFrame() function is called from the main loop of the main script, it handles the entities the following way:<br><br>- Change the current context to the entities one.<br>- Do a For... Each loop to hanle all the entities (each entity has a Type variable)<br>- The entity var has a field with the script module of the entity, and another field with the entry point to the function that controls the entity, so i set the correct entry point for the context, i pop the entity, and invoke the virtual machine.<br>- After all the entities are processed, i restore the main context.<br><br>The good thing is that it works perfectly now and I have only lost 5 fps as much (the Century map ran @ 120-125 fps before with collisions and entities on it, now it rans @ about 120 fps).<br><br>A function that controls an entity has the following structure:<br><br><pre class=code>Function info_player_start(entity.csEntity)
Select Entity\Msg$
   Case "MsgCreate"
      ;Stuff that the entity has to initialize (mesh that it uses, etc)
   Case "MsgFrame"
      ;Standard frame nessage, the default message it receives every frame
   Case "MsgDestroy"
      ;Free stuff here, cos the entity will be deleted after executing this function
End Select
End Function</pre><br>"MsgFrame" is the message sent when no entities has sent a message to the current entity. A bullet would for example sent this entity a "MsgBulletHit" message, and this entity would react to this message (decrease health, etc).<br><br>I would like to see something on BVM: The possibility to define constants in the .bcs file. The engien uses a lot of constants for the function flags, and now I have to include a file on all the scripts. I would like to simply add these contants to the .bcs file and this way these constants are known when compiling the scripts :)<br><br>Oh! And '[]' type arrays would be also cool :D But this is not that important for me, I am currently simply hiding array fields inside types to the scripts, and read them using functions. <br><br></td></tr></table><br>
<a name="312031"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Koriolis</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> That's some nice news :)<br>I'm particularly glad to read <div class="quote"> It were easier than I thought <br></div>as the apparent complexity of implementing BVM is really this: an apparence. And as I always say, this setup is done once for all, so everything should go very smoothly now :)<br><br>Now you have no good reason not to release some demo soon, eh eh ;p<br><br><div class="quote"> I would like to see something on BVM: The possibility to define constants in the .bcs file <br></div>Agreed, it would be nice. I had originally considered this, but it wasn't very high on my TODO list as it's not required at all (using an include file as you do works without any problem), but "only" a bit more handy. I think I will add this, that will be more convenient that way.<br><br><div class="quote"> Oh! And '[]' type arrays would be also cool :D <br></div>I don't know right now if I will add it. <br><br></td></tr></table><br>
<a name="312113"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GW</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> What Koriolis said is good advice..<br>Move *all* of your constants to an include file.<br>Include that same file in any script that needs them. that way all your constants are always synchronized. It also helps with the manageabilty of your codebase. <br><br></td></tr></table><br>
<a name="312143"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Koriolis</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Actually GW, you'll see that's what Jedive currently does if you read more carefully his post :p<br><br>He's asking for being able to put some constants right in the bcs file. And indeed, for constants that are really part of the core engine it makes some sense to have them right in the .bcs file along with the exposed funcitons and global variables. That's why I'll probably add this possibility. <br><br></td></tr></table><br>
<a name="312512"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >WendellM</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> BTW, the OO feature together with another one (I won't say too much right now, forgive me, as some things are still likely to change) that I'm adding will allow to do thies kind of things in much neater and simpler way :)  <br></div><br><br>Sounds very interesting, Koriolis.  When I first started with Blitz years ago, I couldn't care less about OO stuff, but as I've learned more, I've developed a hunger for it.  One can sort of implement it in Blitz3D as it now is, but it's clunky.  So, while waiting for BlitzMax (though it's taboo to mention that these days &lt;g&gt;), I look forward to see what you're doing with BVM.  I *almost* bought BVM before, but since it sounds like it'll be getting more powerful, I fully expect to buy it after your next update - thanks.  (This isn't just dependent on the OO stuff - I really like what I've seen of BVM.) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
