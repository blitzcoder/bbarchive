<!DOCTYPE html><html lang="en" ><head ><title >XNA Float Parsing</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >XNA Float Parsing</h1><a href="forums.php" >Monkey Targets Forums</a>/<a href="topics.php?forum=508" >XNA</a>/<a href="#bottom" >XNA Float Parsing</a><br><br>
<a name="2012594"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raz</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Mark, I recently put a game I am working on (Ninjah) forward for peer review on Xbox. It failed because it would not work on systems that use a different decimal mark (e.g. spain uses a comma). This causes float.parse to fail. Here's a quote from the "Evil Checklist" <a href="http://forums.create.msdn.com/forums/t/19525.aspx" target="_blank">http://forums.create.msdn.com/forums/t/19525.aspx</a> <br><br><div class="quote"> Caveat 1: Floating point number parsing. If your game uses textual representations of floating point numbers in its save data (either in game data or in game saves) and then needs to parse this text back into a float value while loading, then you must be careful to avoid culture/locale-based parsing problems. (The "test case 9" of above is an attempt to find bugs caused by this.)<br>Background: Different countries use different characters as the decimal separator. For example in the US and UK, a dot "." is used. I.e. "1.5" or similar. But for example Spain and Germany use a comma "," - i.e. "1,5" or similar.<br>Whenever you convert a float into a string with "value.ToString()" or parse a text into a float with "float.Parse(text)", the .NET framework will use the decimal separator that matches the currently selected locale. On the Xbox, the locale in turn is defined by the language that the Xbox dashboard is set to. So if you have a value of 1/2 and do "value.ToString()" on it, then on a Xbox set to English, the resulting string will be "0.5" but on a Xbox set to Spanish, the resulting string will be "0,5". Similarly, "float.Parse(text)" will also expect the separator that matches the currently language, so if the text "0.5" is parsed on a Spanish Xbox (which expects a "," as the separator), the result will be incorrect.<br>This has a lot of potential for bugs: Assume that you deploy your game with data that uses the "." and this game is played on a Spanish Xbox. Loading your data will fail, or at least give unexpected results. Or assume that someone plays your game on a Spanish Xbox and saves his game. In the game save, a "," will be used as the separator. Now the player changes his Xbox language to English and restarts the game. When is game save is loaded, the parser will expect a "." as the separator, which does not match the "," that is actually in the data and will thus result in a loading error.<br>Therefore, you should under all circumstances avoid plain calls to value.ToString() and float.Parse(text).<br>Instead, use value.ToString(CultureInfo.InvariantCulture) whenever your need to convert a float to a text and float.Parse(text, CultureInfo.InvariantCulture) whenever you need to parse this text back into a float.<br>This will have the effect that the data is always written and parsed with a dot "." as the separator.<br>Of course you then also need to make sure that all data that you deploy with the game also uses the dot "." as the decimal separator.<br>Note: Simply "plussing" a float to a string is comparable to using the plain value.ToString(). So you should avoid doing stuff like "this is text" + floatValue + "more text" when saving data. Instead use "this is text " + floatValue.ToString(CultureInfo.InvariantCulture) + "more text".<br>And of course the above applies only to saving data. If you want to convert a float into a text for display on screen, you should continue to use the normal value.ToString(), so that each player sees the value with the correct decimal separator for his country.<br>Note, that the XMLSerializer is not affected by this problem. It is only something that you need to look out for if you are writing/parsing float values manually. <br></div> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
