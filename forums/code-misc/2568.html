<!DOCTYPE html><html lang="en" ><head ><title >Tetris</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='993 symbols, language=bmx, category=Miscellaneous'><meta name='author' content='Matt Merkulov'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 ><a href=codearcs.php>Code archives</a>/<a href=codearcs.php?cat=9>Miscellaneous</a>/Tetris</h1><div class="quote">This code has been declared by its author to be Public Domain code.</div><br><a href="2568.bmx">Download source code</a><br><br><table width="100%" cellspacing="0" cellpadding="0"><tr ><td width="100%"><table width=100% cellspacing=0 cellpadding=0><tr ><td class=headleft></td><td class=head><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tetris by Matt Merkulov</td><td align="right">2009 </td></tr></table></td><td class=headright></td></tr></table></td></tr><tr ><td class="cell"> Left / Right / Down - move block<br>Q / W - rotate block<br>Esc - exit </td></tr><tr ><td class="cell"><pre class="code">Global W[21,23],F[7,4,4,4],L[7];For S$=Eachin "ABEF,AEFJEFBC,IEFBABFG,BFJNEFGH,AEFGCBFJEFGKIJFB,EFGCBFJKIEFGABFJ,EFBGBFGJEFGJBEFJ".Split(",");L[M]=Len(S)/4-1;For I=0 To L[M];For J=0 To 3;A=S[I*4+J]-65;F[M,I,A&amp;3,A Shr 2]=1;Next;Next;M:+1;Next;Graphics 800,600;Y=19;Repeat;Cls;For I=0 To 20;W[1,I]=1;W[12,I]=1;W[I,20]=1;For J=1 To 12;If W[J,I] Then DrawRect J*8,I*8,8,8
Next;Next;For I=0 To 3;For J=0 To 3;If F[N,R,I,J] Then DrawRect (X+I)*8,(Y+J)*8,8,8
Next;Next;Flip;A=X+KeyHit(39)-KeyHit(37);B=Y+KeyDown(40);Q=(R+KeyHit(87)-KeyHit(81))&amp;L[N];IF C(A,B,N,Q)=0 Then X=A;Y=B;R=Q
M=Millisecs();If M&gt;T Then
T=M+999;If C(X,Y+1,N,R) Then
If Y=0 Then End
For I=0 To 3;For J=0 To 3;If F[N,R,I,J] Then W[X+I,Y+J]=1
Next;Next;D=0;For I=19 To 0 Step -1;Q=0;For J=2 To 11;If W[J,I] Then Q:+1
W[J,I+D]=W[J,I];Next;IF Q&gt;9 Then D:+1
Next;X=5;Y=-1;N=Rand(0,6);EndIf;Y:+1;End If;Until KeyHit(27);Function C(X,Y,N,R);For I=0 To 3;For J=0 To 3;If F(N,R,I,J)*W[I+X,J+Y] Then Return 1
Next;Next;EndFunction</pre></td></tr></table><br><a name="comments">Comments</a><br><br><table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >degac</td><td align="right"><font class=tiny>2009</font></td></tr></table></td></tr><tr ><td class="posttext"> Incredible! <br><br></td></tr></table><br><table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AndyGFX</td><td align="right"><font class=tiny>2009</font></td></tr></table></td></tr><tr ><td class="posttext"> nice <br><br></td></tr></table><br><table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ZJP</td><td align="right"><font class=tiny>2009</font></td></tr></table></td></tr><tr ><td class="posttext"> ? <br><br></td></tr></table><br><table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >spacerat</td><td align="right"><font class=tiny>2009</font></td></tr></table></td></tr><tr ><td class="posttext"> This is awesome. I tried to decipher it and figure out how it works but I failed. However for anyone else who wants to try I got this<br><pre class=code>Framework brl.blitz
Import brl.glmax2d
Import brl.random

Global W[21, 23], F[7, 4, 4, 4], L[7] ;

For S:String = Eachin "ABEF,AEFJEFBC,IEFBABFG,BFJNEFGH,AEFGCBFJEFGKIJFB,EFGCBFJKIEFGABFJ,EFBGBFGJEFGJBEFJ".Split(",") ;
	L[M] = Len(S) / 4 - 1;
	For I = 0 To L[M] ;
		For J = 0 To 3;
			A = S[I * 4 + J] - 65;
			F[M, I, A &amp; 3, A Shr 2] = 1;
		Next;
	Next;
	M:+1;
Next;

Graphics 50, 200;
Y = 19;

Repeat;
	Cls;
	For I = 0 To 20;
		W[1, I] = 1;
		W[12, I] = 1;
		W[I, 20] = 1;
		For J = 1 To 12;
			If W[J, I] Then DrawRect J * 8, I * 8, 8, 8
		Next;
	Next;
	
	For I = 0 To 3;
		For J = 0 To 3;
			If F[N, R, I, J] Then DrawRect(X + I) * 8, (Y + J) * 8, 8, 8
		Next;
	Next;
	
	Flip;
	
	A = X + KeyHit(39) - KeyHit(37) ;
	B = Y + KeyDown(40) ;
	Q = (R + KeyHit(87) - KeyHit(81)) &amp; L[N] ;
	IF C(A, B, N, Q) = 0 Then X = A;
	Y = B;
	R=Q
	M = Millisecs() ;
	If M &gt; T Then
		T = M + 999;
		If C(X, Y + 1, N, R) Then
			If Y = 0 Then End
	
			For I = 0 To 3;
				For J = 0 To 3;
					If F[N, R, I, J] Then W[X + I, Y + J] = 1
				Next;
			Next;
			
			D = 0;
			
			For I = 19 To 0 Step - 1;
				Q = 0;
				For J = 2 To 11;
					If W[J, I] Then Q:+1
					W[J, I + D] = W[J, I] ;
				Next;
				IF Q &gt; 9 Then D:+1
			Next;
			X = 5;
			Y = -1;
			N = Rand(0, 6) ;
		EndIf;
		Y:+1;
	End If;
Until KeyHit(27) ;

Function C(X, Y, N, R) ;
	For I = 0 To 3;
		For J = 0 To 3;
			If F(N, R, I, J) * W[I + X, J + Y] Then Return 1
		Next;
	Next;
EndFunction</pre><br><br>Also, you can cut a character off by changing graphics 800,600 to 50,200. <br><br></td></tr></table><br><table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dabhand</td><td align="right"><font class=tiny>2009</font></td></tr></table></td></tr><tr ><td class="posttext"> I love these... Reminds me of the Amstrad Actions 10-liners of auld!!!<br><br>On a similar note, we had a competition on something similar at BlitzMonkeys.com:-<br><br><a href="http://www.blitzmonkeys.com/index.php?topic=141.0" target="_blank">http://www.blitzmonkeys.com/index.php?topic=141.0</a><br><br>Anyhoo... Nice work there Matt! :)<br><br>Dabz <br><br></td></tr></table><br><table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MGE</td><td align="right"><font class=tiny>2009</font></td></tr></table></td></tr><tr ><td class="posttext"> close, but doesn't work. Still...very, very nice! <br><br></td></tr></table><br><table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nate the Great</td><td align="right"><font class=tiny>2009</font></td></tr></table></td></tr><tr ><td class="posttext"> NICE...<br><br>but a few comments here and there would help lol. <br><br></td></tr></table><br><table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matt Merkulov</td><td align="right"><font class=tiny>2009</font></td></tr></table></td></tr><tr ><td class="posttext"> Here's expanded and formatted version with comments<br>Enjoy!<br><pre class=code>
SeedRnd Millisecs()

Global World[ 21, 23 ] ' Game field, stretched right for the shorter way to make glass bottom
Global Figure[ 7, 4, 4, 4 ] ' Stored tetris figures ( 7 pieces, 4x4 matrix, up to 4 phases)
Global Phases[ 7 ] ' Quantity of phases for figure ( 1, 2 or 4 )

For S$ = Eachin "ABEF,AEFJEFBC,IEFBABFG,BFJNEFGH,AEFGCBFJEFGKIJFB,EFGCBFJKIEFGABFJ,EFBGBFGJEFGJBEFJ".Split(",")
	' There's all phases of figures stored in the sting, using 4 letters per phase, comma separates figure string chunks
	' Every letter means a quadratic piece of figure in certain position, corresponding to following matrix:
	' ABCD
	' EFGH
	' IJKL
	' MNOP
	
	Phases[ M ] = Len( S ) / 4 - 1 ' ( Quantity of phases - 1 ) can be calculated by dividing string chunk by 4 and subtracting 1
	For I = 0 To Phases[ M ] ' These cycles fills the Figure matrices
		For J = 0 To 3
			A = S[ I * 4 + J ] - 65 ' This number converts symbol to number in range from 0 to 15 
			Figure[ M, I, A &amp; 3, A Shr 2 ] = 1 ' 1 means filled square, 0 (by default) means empty
		Next
	Next
	M :+ 1 ' Incrementing figures counter
Next

Graphics 800, 600
Y = 19 ' current y-coordinate of figure, set to 19 to make initialization of new one

Repeat
	Cls
	For I = 0 To 20
		 ' Making glass boundaries
		World[ 1, I ] = 1 ' left wall (it is shifted from the edge to prevent error 
		' when figure matrix is situated partly outside of the game field)

		World[ 12, I ] = 1 ' right wall
		World[ I, 20 ] = 1 ' bottom
		
		' Drawing game field
		For J = 1 To 12
			If World[ J, I ] Then DrawRect J * 8, I * 8, 8, 8
		Next
	Next
	
	' Drawing current figure
	For I = 0 To 3 
		For J = 0 To 3
			If Figure[ N, R, I, J ] Then DrawRect ( X + I ) * 8, ( Y + J ) * 8, 8, 8
		Next
	Next
	
	Flip
	
	' This is cool controller handing method, that I borrowed from old Speccy magazines
	' If KEY_RIGHT is pressed then new value of X will be less than old by 1
	' If KEY_LEFT is pressed then new value of X will be more than old by 1
	A = X + KeyHit( KEY_RIGHT ) - KeyHit( KEY_LEFT )
	B = Y + KeyDown( KEY_DOWN )
	
	' Phase is "cycling" with (phases quantity - 1) = %0, %1 or %11 - by using logical operator AND
	Q = ( R + KeyHit( KEY_W ) - KeyHit( KEY_Q ) ) &amp; Phases[ N ]
	
	' If new-positioned figure is not colliding with game field then it will be moved
	IF CheckPosition( A, B, N, Q ) = 0 Then
		X = A
		Y = B
		R = Q
	End If
	
	M = Millisecs()
	
	If M &gt; T Then
		T = M + 999 ' figure will be moved down every second
		
		' Checking if figure collides with game field when moved down (if true then "finalize" it)
		If CheckPosition( X, Y + 1, N, R ) Then
			If Y = 0 Then End ' end of game because glass is filled to the top
			
			For I = 0 To 3 ' Transferring figure from its matrix to the game field (by filling corresponding squares)
				For J = 0 To 3
					If Figure[ N, R, I, J ] Then World[ X + I, Y + J ] = 1
				Next
			Next
			
			' This mechanism will check filled rows and also moving down upper stuff if there's any
			D = 0 ' Current steps to shift game field contents by
			For I = 19 To 0 Step -1
				Q = 0
				For J = 2 To 11
					If World[ J, I ] Then Q :+ 1
					World[ J, I + D ] = World[ J, I ]
				Next
				IF Q &gt; 9 Then D :+ 1 ' If there's 10 squares in a row then shift steps will be incremented by 1
			Next
			
			' Initializing new random figure on the top of the glass
			X = 5
			Y =  - 1
			N = Rand( 0, 6 )
		EndIf
		
		Y :+ 1 ' Moving figure down
	End If
Until KeyHit( KEY_ESCAPE )

' This function checks collisions of game field and figure N with phase R in ( X, Y ) coords
Function CheckPosition( X, Y, N, R )
	For I = 0 To 3
		For J = 0 To 3
		 	' Returns 1 if any filled figure square is placed on filled square of game field
			If Figure[ N, R, I, J ] * World[ I + X, J + Y ] Then Return 1
		Next
	Next
	' Returns 0 if there's no collision
EndFunction
</pre> <br><br></td></tr></table><br><a href="codearcs.php" >Code Archives Forum</a><table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
