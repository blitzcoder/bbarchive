<!DOCTYPE html><html lang="en" ><head ><title >Fire "empty" event to prevent freezing?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Fire "empty" event to prevent freezing?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=117" >MaxGUI Module</a>/<a href="#bottom" >Fire "empty" event to prevent freezing?</a><br><br>
<a name="976609"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Htbaa</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is it possible to, while executing some heavy operation, to fire empty events during the execution of the operation so Windows doesn't think the application is freezing and just update the gadgets (like a progressbar)?<br><br>I'm currently writing an application that'll upload a number of files. If these are big files then of course it's going to take a while. In bah.libcurl I can set a progressCallback that tells me how much data has been uploaded. At every call I update my progressbar. Which works, but due to Windows thinking it's freezing it soon stops redrawing the progressbar. In my progressCallback, which is called every second or so, I use a DebugLog to see if something is happening, and indeed, it is.<br><br>So. Would firing an empty event solve this and just update the progressbars? If so, how do I fire my empty event? Or would threading be the way to go? <br><br></td></tr></table><br>
<a name="976613"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> You might get away with calling PollSystem. <br><br></td></tr></table><br>
<a name="976614"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Htbaa</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Looks like I'm getting away with it :-). At least now I can get to see some visual progress. Thanks. <br><br></td></tr></table><br>
<a name="976641"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SebHoll</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yep, <b>PollSystem()</b> is the function you call to let the system do its stuff during long loops. <br><br></td></tr></table><br>
<a name="1076498"></a>

<a name="1076499"></a>

<a name="1076503"></a>

<a name="1076505"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Htbaa</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry for bringing up this old topic, but I'm running into some problems again.<br><br>I've been using PollSystem for a while now and it always worked fine. But due to some API changes my application stopped functioning, so I had to make some changes and do a rebuild. There has been over a year between these builds, so lots of module versions have changed.<br><br>I'm using MaxGUI 1.41 with BlitzMax 1.41, together with the latest versions of bah.libcurlssl with OpenSSL 1.0.0.4 and my own htbaapub.rest and htbaapub.rackspacecloudfiles module.<br><br>But for some reason the application freezes again even with the PollSystem call in place.<br><br><a href="https://github.com/Htbaa/Rackspace-Cloud-Files-Sync/blob/master/main/gui/Append.txt#L109" target="_blank">codelink</a><br><pre class=code>	Function progressFunction:Int(data:Object, dltotal:Double, dlnow:Double, ultotal:Double, ulnow:Double)
		Local updater:TProgressBarUpdater = TProgressBarUpdater(data)

		If TBackup.backupDirectory.Length &gt; 0
			updater.currentFileSize = ulnow
			updater.currentFileTotalSize = ultotal
		Else If TBackup.restoreDirectory.Length &gt; 0
			updater.currentFileSize = dlnow
			updater.currentFileTotalSize = dltotal
		End If

		updater.UpdateProgressBars()
		PollSystem()

		Return 0
	End Function</pre><br><br>This is a callback function passed down to libcurlssl to execute some tasks whilst progressing with a upload/download action.<br><br>The updater.UpdateProgressBars() updates 2 progress bars and updates a text label. Normally after the PollSystem() the gadgets would redraw, but this is no longer the case and the form just freezes, when checking a debug window it's processing downloads/uploads just fine, it's just seems that the PollSystem call is being ignored or something.<br><br>When I add the PollSystem call to another <a href="https://github.com/Htbaa/Rackspace-Cloud-Files-Sync/blob/master/main/gui/Append.txt#L83" target="_blank">place</a> (not in this actual file, but in my debug version) it's still not redrawing my gadgets. To add some context to this code, messages are constantly being sent to this message handler so PollSystem should execute every few seconds or so.<br><br>Yet, it's still being ignored. I'm building it with the GuiApp flag, but this doesn't seem to matter anything in my end results.<br><br>Any pointers on where to look?<br><br><strike>Strange thing is that when I'm instructing the program to download files I see the progress bars updating. But not when doing the uploading.</strike> Which is strange because both instructions use the same messenger. Although it does freeze up when trying to open a menu. Which it didn't in the past.<br><br><font class="tiny">Last edited 2011</font><br><br><font class="tiny">Last edited 2011</font><br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1076517"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jsp</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Could you try to use WaitSystem() instead of PollSystem(), if that makes any difference?<br>May add a little delay to give the system some time to update during heavy processing. <br><br></td></tr></table><br>
<a name="1076520"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Htbaa</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> The mainloop already uses WaitSystem whereas at the parts I want to update my gadgets I call PollSystem.<br><br>Instead of calling PollSystem, can't I just fire off an event that makes sure the gadgets are redrawn?<br><br>Currently to end-users it appears the application is crashing as well as to Windows (not-responding) even though it's doing fine. It's just that the front-end freezes. <br><br></td></tr></table><br>
<a name="1076656"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jsp</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Firing an additional event would not help me thinks.<br>When it looks like frozen there is no time for the system to recognize it's still running.<br>Can't you give some more time back to the system?<br>Even if you used already WaitSystem() in your mainloop I would give it a try and exchange the PollSystem as mentioned above. <br><br></td></tr></table><br>
<a name="1076702"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Htbaa</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I did try replacing the PollSystem with another WaitSystem call but it makes no difference at all.<br><br>I've really got no clue what's wrong though, as in the past the gadgets updated fine. I can't for the life find anything suspicious in changelogs or certain Windows updates. Very annoying. <br><br></td></tr></table><br>
<a name="1076837"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Chalky</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> when checking a debug window it's processing downloads/uploads just fine, it's just seems that the PollSystem call is being ignored or something. <br></div><br>Is function progressFunction() definitely being [repeatedly] called from within whatever code is doing the download/upload processing? <br><br></td></tr></table><br>
<a name="1076955"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Htbaa</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ehm yes, basically libcurl keep calling that function to give updates on download progress, how many bytes have been downloaded and how many there's left.<br><br>The only time when it does update for a moment is when downloading larger files, but when clicking in the GUI it all freezes up.<br><br>When syncing it mainly does HEAD requests, so it isn't even called at all, but the main loop should have returned to the beginning in that case so an update to the GUI should've been issued. <br><br></td></tr></table><br>
<a name="1077367"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Chalky</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry - I didn't mean "have you coded it correctly", I meant is the function actually getting called by the system - or is all CPU time being hogged by the download/upload process - resulting in progressFunction never being executed (or maybe only once or twice)? <br><br></td></tr></table><br>
<a name="1077405"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SLotman</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Try the opposite: change WaitSystem to Pollsystem. From bmax docs:<br><br><div class="quote"> <br>WaitSystem returns control back to the operating system, waiting until an event such as a keystroke or gadget action occurs. <br>Note that WaitSystem may wait indefinitely if there is no possibility of any events occuring, so use with caution. <br> <br></div><br><br>Maybe that's what happening? <br><br></td></tr></table><br>
<a name="1077540"></a>

<a name="1077542"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Htbaa</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Chalky I didn't take that as a "did you code it correctly"-question. My bad? Yes, when doing the downloading that function is being called. But also when it's not being called the UpdateProgressBars() method is being called in the message loop.<br><br>@SLotman I already tried that. Makes no difference at all. Am going to try a FLTK build to see if that would make a difference. Just to see if it's native Windows stuff that's giving me these headaches.<br><br>Edit: Nope, FLTK build didn't make a difference, aside from making it look really ugly.<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
