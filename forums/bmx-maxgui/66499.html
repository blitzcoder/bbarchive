<!DOCTYPE html><html lang="en" ><head ><title >Read memory usage directly from taskmanager?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Read memory usage directly from taskmanager?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Read memory usage directly from taskmanager?</a><br><br>
<a name="742986"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grisu</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello everyone!<br><br>Is it somehow possible to read out the amount of memory usage of a program directly from the taskmanger?<br><br><img src="http://img301.imageshack.us/img301/8997/bild2mk9.png"><br><br>Means: <br>I no longer have to open the taskmanager myself and watch the vaules. Instead my program reads all the informations and I can output them "inside" the app itself.<br><br>Grisu <br><br></td></tr></table><br>
<a name="742994"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >degac</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> GCMemAlloced() doen't report all the memory used by the application? Or am I wrong? <br><br></td></tr></table><br>
<a name="742995"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> No, the memory returned has actually not much to do with the really used memory. <br><br></td></tr></table><br>
<a name="743000"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grisu</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> ^^ Exactly my problem. <br><br>In addition GCMemAlloced() gives me strange results such as a memory usage of over 1 GB. So I'm looking for a workaround as GCCollector is not 100% bullet proofed. <br><br></td></tr></table><br>
<a name="743014"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Warren</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> You're saying the garbage collector isn't working?  You should post a code sample to the bug board showing this then.  That's kind of serious. <br><br></td></tr></table><br>
<a name="743024"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grisu</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> If I had an easy to use example code, I would post it.<br><br>Though the garbage collector is freeing the allocated memory as and when he wants to. So it's hard to spot memory leakes.<br>It's much easier imho to use the taskmanager to track the amount of system memory used by an app. Therefore I'm looking for this alternative. <br><br></td></tr></table><br>
<a name="743027"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >grable</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> The task manager isnt entirely accurate itself ;) <br><br></td></tr></table><br>
<a name="743030"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >degac</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Digging on MSDN I found what I think should get the info<br><br>GetProcessWorkingSetSize<br><a href="http://msdn2.microsoft.com/en-us/library/ms683226.aspx" target="_blank">http://msdn2.microsoft.com/en-us/library/ms683226.aspx</a><br><br>but it seems that a process has a min and a max of memory space, so the info is not accurate...<br><br>Then how make it to work with Bmax is another story...too much structures to define (and understand before!)<br>Byez <br><br></td></tr></table><br>
<a name="743034"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >grable</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> You could try shoehorning in a leak detector,<br>or roll your own by replacing <b>malloc/free</b> and overriding c++ <b>new/delete</b>.<br><br>But im not sure how max does its type allocation, eg wheter the GC has its own memory pool or uses the process heap.<br><br>Good luck =) hehe <br><br></td></tr></table><br>
<a name="743106"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> The GC is accurate in returning what it does.<br>But what it returns is not its current full memory usage on the OS. It is the memory it pools.<br><br>The difference comes here when you use anything outside the GC: MaxGUI, OGG, MemAlloc, Byte Ptr, CString ... <br><br></td></tr></table><br>
<a name="743298"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Fabian.</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sadly, I can't get this working on Linux or MacOS, since I don't know much about the APIs of that systems, however, since you asked about the Task-Manager, I assume that a Win32 only solution would be enough. Note that this code needs the Psapi.dll, I don't know whether this is always included into the system, but at least every XP Home and Pro should have this, since (I guess) the Task-Mamager uses the same dll:<pre class=code>Strict
Framework brl.blitz

Local Lib = LoadLibraryW ( "Psapi.dll".ToWString ( ) )
If Not Lib
  WriteStdout "Psapi.dll is missing, make sure that you've got a valid Windows XP installation~n"
  Return
EndIf
Global GetProcessMemoryInfo ( Process , MemCounters:Byte Ptr , Size ) = GetProcAddress ( Lib , "GetProcessMemoryInfo".ToCString ( ) )
If Not GetProcessMemoryInfo
  WriteStdout "Strange, couldn't find the GetProcessMemoryInfo function...~n"
  Return
EndIf
Local PMC:TProcessMemoryCounters = New TProcessMemoryCounters
PMC.Size = SizeOf TProcessMemoryCounters
Local N = GetProcessMemoryInfo ( GetCurrentProcess ( ) , PMC , SizeOf TProcessMemoryCounters )
If Not N
  WriteStdout "There was an error when calling the function...~n"
  Return
EndIf
N = PMC.WorkingSetSize
WriteStdout "This process takes " + N + " bytes in memory.~n"
WriteStdout "The taskmamager shows this size probably as " + N / 1024 + "K.~n"

Type TProcessMemoryCounters
  Field Size
  Field PageFaultCounter
  Field PeakWorkingSetSize
  Field WorkingSetSize
  Field QuotaPeakPagedPoolUsage
  Field QuotaPagedPoolUsage
  Field QuotaPeakNonPagedPoolUsage
  Field QuotaNonPagedPoolUsage
  Field PagefileUsage
  Field PeakPagefileUsage
EndType

Extern "Win32"
  Function GetCurrentProcess ( )
  Function LoadLibraryW ( Name:Short Ptr )
  Function GetProcAddress:Byte Ptr ( Lib , Name:Byte Ptr )
'  Function GetProcessMemoryInfo ( Process , MemCounters:Byte Ptr , Size ) 'Doesn't work, seems like BlitzMax doesn't
                                                                           'directly link to Psapi.dll (a bug?)
EndExtern</pre>P.S.: I assumed you wanted to get this information about the process where you called the function. If not you need first to create a handle to the process, which you want to get the information about. To get this handle you need either<br>- the process id<br>- a handle to a thread which belongs to the process<br>- an id of such a thread<br>- a handle to a window created such a thread<br>- (not secure) the caption of such a window<br>But as long as you just need this information for the current process, the code above should work. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
