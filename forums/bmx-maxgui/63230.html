<!DOCTYPE html><html lang="en" ><head ><title >Preventing the ALT key from triggering menus...</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Preventing the ALT key from triggering menus...</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=117" >MaxGUI Module</a>/<a href="#bottom" >Preventing the ALT key from triggering menus...</a><br><br>
<a name="706259"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi All.<br><br>When I press ALT in my app, it is supposed to rotate the camera, however, I need to use maxGUI for menu's.<br><br>What I'd like to do is prevent the ALT key from pausing my app and waiting for me to click on the menu items.<br><br>How can I do this? <br><br></td></tr></table><br>
<a name="706304"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Space_guy</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> uuuhg. i had the same problem. never did solve it though. Hope someone else did <br><br></td></tr></table><br>
<a name="706317"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>never did solve it though<br> <br></div><br><br>Darnit! :( <br><br></td></tr></table><br>
<a name="707125"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >fredborg</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> If your canvas (assuming you are using a canvas) pressing 'alt' will generate an EVENT_KEYDOWN when the canvas is the active gadget.<br><br>You could possibly use ActivateGadget to make it more or less permanently active. <br><br></td></tr></table><br>
<a name="707185"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AdrianT</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> yeah we have Ogre3D running in a Bmax canvas. The problem were having is that were using ALT as our camera mouselook control hotkey in our editor app, which works in a similar fashion to 3dsmax. <br><br></td></tr></table><br>
<a name="707505"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm afraid the "activategadget" idea doesnt work, the window is frozen before the code is executed :(<br><br>Thanks for the comment though, anything helps!!! <br><br></td></tr></table><br>
<a name="707519"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Normally I would say: use Hotkey event. But depending on what you want to do with the pressed ALT button this won't work.<br><br>But a different idea could be: if canvas is active and mouse within canvas, disable window menus. <br><br></td></tr></table><br>
<a name="707656"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> hmm, good idea, but i've tried this.<br><br>The window is still frozen when no menus actually exist, I can stop this from happening by not using the "Window_TitleBar" flag when creating the window itself, but then, who wants to do that? :(<br><br>Thanks for your help guys, any more ideas let me know :) <br><br></td></tr></table><br>
<a name="707696"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just tried it now.<br><br>If you handle the input through an eventhook you can easily use alt. Because if you use a mouse button while you are on alt, the menu won't be fired (at least XP Pro SP2)<br><br>Here is my testcode, perhaps I missed something:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
SuperStrict


Global window:TGadget	= CreateWindow("Canvas - ALT Test" , 0 , 0 , 800 , 600)

Global canvas:TGadget	= CreateCanvas(0,0, 640,480, window)
SetGraphics CanvasGraphics(canvas)

Global mnu_main:TGadget	= CreateMenu("File",0,WindowMenu(window))
CreateMenu("End",1,mnu_main)
UpdateWindowMenu window

Global flipTimer:TTimer	= CreateTimer(60)
Global MX:Int, MY:Int

AddHook EmitEventHook, InputHook

Global altdown:Int	= False

Repeat
	WaitEvent()
	Select EventID()
		Case EVENT_GADGETPAINT
			Cls
			If altdown
				DrawText "Alt is pressed", 0,0
			Else
				DrawText "Alt is not pressed!", 0,0
			EndIf
			DrawText "Mouse: ("+MX+","+MY+")",0,20
			Flip
		
		Case EVENT_TIMERTICK
			Select EventSource()
				Case flipTimer
					RedrawGadget(canvas)
					
			End Select
	End Select


Forever

End


Function InputHook:Object(id:Int, data:Object, context:Object)
	Local ev:TEvent	= TEvent(data)
	Select ev.id
		Case EVENT_MOUSEENTER
			If ev.source = Canvas
				ShowMouse()
				ActivateGadget(canvas)
			EndIf
		
		Case EVENT_MOUSELEAVE
			If ev.source = Canvas
				HideMouse()
				ActivateGadget(window)
			EndIf
		
		Case EVENT_MOUSEMOVE
			MX	= ev.x
			MY	= ev.y
		
		Case EVENT_KEYDOWN
			Select ev.data
				Case KEY_LALT, KEY_RALT
					altdown=True
					
			End Select
			
		Case EVENT_KEYUP
			Select ev.data
				Case KEY_LALT, KEY_RALT
					altdown=False
					
			End Select
	End Select
	Return data
End Function</textarea> <br><br></td></tr></table><br>
<a name="707753"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> hmm, see the problem is that while it does know ALT has been pressed, it then highlights the menu's and the mouse information is no longer updated etc... until you click on the canvas. This is the behaveor im trying to stop if at all possible.<br><br>Thanks for looking into it for me Dreamora :) <br><br></td></tr></table><br>
<a name="707760"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you want to have ALT for cam control, the canvas must be active anyway or at least the mouse must be over it (which is why I enable it on enter), because mouse events *which includes MOUSEMOVE* are only fired by Canvas and Panel with PANEL_ACTIVE flag.<br><br>Don't think you can disable this UI core behavior, as you can't stop Cacao from doing some stuff as it does them.<br>But you can prevent happening it by enable the "core action" gadget. If you want to use ALT / CTRL to have mouse based camera control, the mouse will be over the canvas anyway, so using the mouseenter to enable the gadget seems to be quite usable solution. If you want it to continue even outside the canvas, you will need to fill the window with a panel with PANEL_ACTIVE flag anyway or you won't get mousemove updates anymore. <br><br></td></tr></table><br>
<a name="708176"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm, thanks for the insight. I figured it might be hard to do- Guess i may have to go without maxgui for now, or find a working alternate control system- activating the gadgets doesnt stop it. Bummer.<br><br>Thanks again though :) <br><br></td></tr></table><br>
<a name="708179"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >fredborg</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Doesn't this work?<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">Strict

Local win:TGadget = CreateWindow("Hello",100,100,400,400,Null,WINDOW_TITLEBAR|WINDOW_STATUS|WINDOW_MENU|WINDOW_CLIENTCOORDS|WINDOW_RESIZABLE)
Local can:TGadget = CreateCanvas(0,0,ClientWidth(win),ClientHeight(win),win)
SetGadgetLayout can,1,1,1,1

Local men:TGadget = CreateMenu("&amp;Test",0,WindowMenu(win))
CreateMenu("&amp;Bla",0,men)
CreateMenu("&amp;Cla",0,men)

UpdateWindowMenu win

Local x:Int = 10
Local y:Int = 10
Local r:Int = 0
Local s:Float = 1.0

Local mx:Int = 0
Local my:Int = 0

Local edit:Int = False
Local mode:Int = 0

While WaitEvent()

	Select EventID()
		Case EVENT_GADGETPAINT
			Redraw(can,x,y,r,s)
	
		Case EVENT_MOUSEENTER
			If EventSource() = can
				ActivateGadget(can)
			EndIf
	
		Case EVENT_MOUSEMOVE
			Local dmx:Int = EventX()-mx
			Local dmy:Int = EventY()-my
			mx = EventX()
			my = EventY()
			If edit
				If mode = 1
					x :+ dmx
					y :+ dmy
				ElseIf mode = 2
					r :+ dmy
				ElseIf mode = 3 
					s :+ dmy*0.1
				EndIf
				
				Redraw(can,x,y,r,s)
			EndIf
	
		Case EVENT_MOUSEDOWN
			If EventData() = MOUSE_LEFT
				mode :| 1
			ElseIf EventData() = MOUSE_RIGHT
				mode :| 2
			EndIf
	
		Case EVENT_MOUSEUP
			If EventData() = MOUSE_LEFT
				mode :&amp; (~1)
			ElseIf EventData() = MOUSE_RIGHT
				mode :&amp; (~2)
			EndIf
	
		Case EVENT_KEYDOWN
			Select EventData()
				Case KEY_LALT, KEY_RALT
					edit = True
			EndSelect
			
		Case EVENT_KEYUP
			Select EventData()
				Case KEY_LALT, KEY_RALT
					edit = False
			EndSelect

		Case EVENT_WINDOWCLOSE
			End
					
	EndSelect

Wend

Function Redraw(canvas:TGadget,x:Int,y:Int,r:Int,s:Float)
	SetGraphics CanvasGraphics(canvas)
	SetViewport 0,0,ClientWidth(canvas),ClientHeight(canvas)
	Cls
	SetRotation r
	SetScale s,s
	DrawRect x,y,40,40
	Flip
End Function</textarea> <br><br></td></tr></table><br>
<a name="708203"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> hmm, not sure thats any different from before- interesting bit of code there.<br><br>The only problem with these bits of code is that the code execution stops as soon as alt is pressed then removed, because the menu is hilighted.<br><br>I will play with it again a bit tonight, maybe i can fathom something out.<br><br>The next thing I will need to do is grab an image of the canvas, which for some reason doesn't work when it it used as a render target from another lib<br><br>Thanks guys.<br><br><br>[edit]<br><br><br>Fredborg, I will try that code out when I get home. <br><br></td></tr></table><br>
<a name="708330"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Fredborg- Nope, not sure what your code is doing either hehe :) cheers for the help though. <br><br></td></tr></table><br>
<a name="708333"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >fredborg</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Press and hold alt and use the mouse to pan, rotate and scale. I was under the impression that's what you needed? <br><br></td></tr></table><br>
<a name="708354"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ah lol, well, I already have all that working you see, but as soon as you let go of alt, the menu is hilighted and the app is paused. thats what I need to stop, if possible. Doesn't look like it is though.<br><br>Thanks for your efforts though mate, Much apreciated. <br><br></td></tr></table><br>
<a name="708360"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >fredborg</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Why do you need to stop that? Surely being able to access the menu by keyboard is something you don't want to disable. <br><br></td></tr></table><br>
<a name="708362"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> its a specific app that needs to use the ALT key to control the camera. it would probrably be best if a quick tap of the alt key triggers menu's, but the functionality is more crippled by the behaveor.<br><br>We are creating a CAD application basically. the control is similar to that of 3DS Max. <br><br></td></tr></table><br>
<a name="708365"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >fredborg</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> On my machine the example I gave works exactly the same as 3dsmax. <br><br></td></tr></table><br>
<a name="708417"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >impixi</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay, here's a rough workaround example:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
SuperStrict

Const MENU_EXIT:Int = 101

Const SUBWIN_OFFX:Int = 7
Const SUBWIN_OFFY:Int = 60

Local window:TGadget = CreateWindow("ALT Test" , 0 , 0 , 800 , 600)
Local panel:TGadget = CreatePanel(0, 0, 800, 600, window, PANEL_ACTIVE)
Local subwindow:TGadget = CreateWindow("", GadgetX(window) + SUBWIN_OFFX, GadgetY(window) + SUBWIN_OFFY, 400, 400, window, 0)
Local canvas:TGadget = CreateCanvas(0,0, 640,480, subwindow)
SetGraphics CanvasGraphics(canvas)

Local filemenu:TGadget	= CreateMenu("File", 0, WindowMenu(window))
CreateMenu("Exit", MENU_EXIT, filemenu)
UpdateWindowMenu window

ActivateWindow(window)
ActivateGadget(panel)

Local flipTimer:TTimer = CreateTimer(100)
Local mx:Int, my:Int
Local altdown:Int = False
Local msg:String = ""

Repeat
	
	PollEvent
	
	Select EventID()
	
		Case EVENT_WINDOWCLOSE
			End
	
		Case EVENT_GADGETPAINT
			Cls
			DrawText msg, 0,0
			DrawText mx + "," + my, 0, 20
			Flip
		
		Case EVENT_TIMERTICK
			If EventSource() = flipTimer Then RedrawGadget(canvas)
			
		Case EVENT_MOUSEMOVE
			mx	= EventX()
			my	= EventY()
		
		Case EVENT_KEYDOWN
			Local data:Int = EventData()
			If (data = KEY_LALT) Or (data = KEY_RALT) 
				If EventSource() = panel 
					ActivateWindow(subwindow)
					ActivateGadget(canvas)
				EndIf
				altdown = True
			EndIf
			
		Case EVENT_KEYUP
			Local data:Int = EventData()
			If (data = KEY_LALT) Or (data = KEY_RALT) 
				If EventSource() = canvas 
					ActivateWindow(window)
					ActivateGadget(panel)
				EndIf
				altdown = False
			EndIf
			
		Case EVENT_MENUACTION
			Local data:Int = EventData()
			If data = MENU_EXIT Then 	End
	
		Case EVENT_WINDOWMOVE
			Local x:Int = GadgetX(window) + SUBWIN_OFFX
			Local y:Int = GadgetY(window) + SUBWIN_OFFY
			SetGadgetShape(subwindow, x, y, 400, 400)
									
	End Select
	
	If altdown
		msg = "Alt is pressed."
	Else 
		msg = "Alt is NOT pressed."
	EndIf

Forever

End
</textarea><br><br>Basically you must utilise a style-less sub-window to 'trap' the ALT keyup event so it's not handled by the main window's menu. <br><br>You will need to implement decent EVENT_WINDOWMOVE and EVENT_WINDOWSIZE event handling code.<br><br>If your target platform is Windows only, you may need to utilise the Win32 API for a better solution. <br><br></td></tr></table><br>
<a name="709205"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks, that works... In fact Chris tried this method, and the problem is that the windows dont update until you let go of the button. if blitz didnt behave like this, the solution would be perfect :-)<br><br>Nice bit of code there cheers! <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
