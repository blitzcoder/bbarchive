<!DOCTYPE html><html lang="en" ><head ><title >Add an event to a listview</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Add an event to a listview</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=117" >MaxGUI Module</a>/<a href="#bottom" >Add an event to a listview</a><br><br>
<a name="820234"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >andre72</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>based on the code by Ziltch I use a MultiColumn Listview.<br>I like to make it possible to sort the columns when the header is clicked.<br>But how to add an event to a listview and where can I found what value LVN_COLUMNCLICK has ...?<br><br>Strict<br><br>' Listbox Item edit Text and Drag 'n Drop example.<br>' Ziltch 29 August 2006.<br>' You can use this code if you credit Ziltch!<br>Const LBS_DISABLENOSCROLL   = 4096<br>Const LBS_EXTENDEDSEL       = $800<br>Const LBS_HASSTRINGS        = 64<br>Const LBS_MULTICOLUMN       = 512<br>Const LBS_MULTIPLESEL       = 8<br>Const LBS_NODATA	        = $2000<br>Const LBS_NOINTEGRALHEIGHT  = 256<br>Const LBS_NOREDRAW          = 4<br>Const LBS_NOSEL             = $4000<br>Const LBS_NOTIFY            = 1<br>Const LBS_OWNERDRAWFIXED    = 16<br>Const LBS_OWNERDRAWVARIABLE = 32<br>Const LBS_SORT              = 2<br>Const LBS_STANDARD          = $a00003<br>Const LBS_USETABSTOPS       = 128<br>Const LBS_WANTKEYBOARDINPUT = $400<br><br>Const LVM_FIRST          = $1000<br>Const LVM_GETCOLUMNA	 = (LVM_FIRST+25)<br>Const LVM_GETCOLUMNW	 = (LVM_FIRST+95)<br>Const LVM_SETCOLUMNA	 = (LVM_FIRST+26)<br>Const LVM_SETCOLUMNW	 = (LVM_FIRST+96)<br>Const LVM_INSERTCOLUMNA	 = (LVM_FIRST+27)<br>Const LVM_INSERTCOLUMNW	 = (LVM_FIRST+97)<br>Const LVM_DELETECOLUMN	 = (LVM_FIRST+28)<br>Const LVM_GETCOLUMNWIDTH = (LVM_FIRST+29)<br>Const LVM_GETITEMA	     = (LVM_FIRST+5)<br>Const LVM_GETITEMW	     = (LVM_FIRST+75)<br>Const LVM_SETITEMA	     = (LVM_FIRST+6)<br>Const LVM_SETITEMW	     = (LVM_FIRST+76)<br>Const LVM_INSERTITEMA	 = (LVM_FIRST+7)<br>Const LVM_INSERTITEMW	 = (LVM_FIRST+77)<br>Const LVM_DELETEITEM	 = (LVM_FIRST+8)<br>Const LVM_DELETEALLITEMS = (LVM_FIRST+9)<br>Const LVM_GETCALLBACKMASK= (LVM_FIRST+10)<br>Const LVM_SETCALLBACKMASK= (LVM_FIRST+11)<br>Const LVM_SETCOLUMNWIDTH = (LVM_FIRST+30)<br>Const LVM_GETTEXTCOLOR	 = (LVM_FIRST+35)<br>'Const LVM_SETTEXTCOLOR	 = (LVM_FIRST+36)<br>Const LVM_GETTEXTBKCOLOR = (LVM_FIRST+37)<br>'Const LVM_SETTEXTBKCOLOR = (LVM_FIRST+38)<br>Const LVM_SORTITEMS      = (LVM_FIRST+48)<br>Const LVM_ARRANGE	=(LVM_FIRST+22)<br>Const LVM_EDITLABELA	=(LVM_FIRST+23)<br>Const LVM_EDITLABELW	=(LVM_FIRST+118)<br>Const LVM_GETEDITCONTROL	=(LVM_FIRST+24)<br>Const LVM_CREATEDRAGIMAGE = (LVM_FIRST + 33)<br>Const LVM_HITTEST = (LVM_FIRST + 18)<br><br>Const LVCF_FMT	=1<br>Const LVCF_WIDTH	=2<br>Const LVCF_TEXT	=4<br>Const LVCF_SUBITEM	=8<br>'	#define LVCF_IMAGE 16<br>'	#define LVCF_ORDER =32<br>'	#define LVCFMT_LEFT	=0<br>Const LVCFMT_RIGHT	=1<br>Const LVCFMT_CENTER	=2<br>Const LVCFMT_JUSTIFYMASK	=3<br><br>Const LVN_FIRST = -100<br>Const LVN_LAST=-199<br>Const LVN_ITEMCHANGING=	LVN_FIRST<br>Const LVN_ITEMCHANGED	=(LVN_FIRST-1)<br>Const LVN_INSERTITEM	=(LVN_FIRST-2)<br>Const LVN_DELETEITEM	=(LVN_FIRST-3)<br>Const LVN_DELETEALLITEMS	=(LVN_FIRST-4)<br>Const LVN_BEGINLABELEDIT =	(LVN_FIRST-5)<br>Const LVN_BEGINLABELEDITW=	(LVN_FIRST-75)<br>Const LVN_ENDLABELEDIT=	(LVN_FIRST-6)<br>Const LVN_ENDLABELEDITW	=(LVN_FIRST-76)<br>Const LVN_COLUMNCLICK	=(LVN_FIRST-8)<br>Const LVN_BEGINDRAG	=(LVN_FIRST-9)<br>Const LVN_BEGINRDRAG	=(LVN_FIRST-11)<br>Const LVN_GETDISPINFOA	=(LVN_FIRST-50)<br>Const LVN_GETDISPINFOW	=(LVN_FIRST-77)<br>Const LVN_SETDISPINFOA	=(LVN_FIRST-51)<br>Const LVN_SETDISPINFOW	=(LVN_FIRST-78)<br>Const LVN_KEYDOWN	=(LVN_FIRST-55)<br><br>Const LVCF_IMAGE= 16<br>Const LVCF_ORDER =32<br>Const LVIF_TEXT = 1<br>Const LVIF_IMAGE =2<br>Const LVIF_PARAM =4<br>Const LVIF_STATE =8<br>Const LVIF_INDENT =$10 <br>Const LVIF_GROUPID =$100 <br>Const LVIF_COLUMNS =$200 <br>Const LVIF_NORECOMPUTE =$800  <br>Const LVIF_DI_SETITEM =$1000<br><br>Const LVS_ICON             =0<br>Const LVS_REPORT	        =1<br>Const LVS_SMALLICON	        =2<br>Const LVS_LIST	            =3<br>Const LVS_TYPEMASK         =3<br>Const LVS_SINGLESEL        =4<br>Const LVS_SHOWSELALWAYS    =8<br>Const LVS_SORTASCENDING    =16<br>Const LVS_SORTDESCENDING   =32<br>Const LVS_SHAREIMAGELISTS	=64<br>Const LVS_NOLABELWRAP      =128<br>Const LVS_AUTOARRANGE      =256<br>Const LVS_EDITLABELS       =512<br>Const LVS_NOSCROLL         =$2000<br>Const LVS_TYPESTYLEMASK    =$fc00<br>Const LVS_ALIGNTOP	        =0<br>Const LVS_ALIGNLEFT	       =$800<br>Const LVS_ALIGNMASK	       =$c00<br>Const LVS_OWNERDRAWFIXED  =$400<br>Const LVS_NOCOLUMNHEADER  =$4000<br>Const LVS_NOSORTHEADER	   =$8000<br>Const LVS_TREEVIEW  =  $4000<br>Const LVS_EX_GRIDLINES = $1<br>Const LVS_EX_SUBITEMIMAGES = $2<br>Const LVS_EX_CHECKBOXES = $4<br>Const LVS_EX_TRACKSELECT = $8<br>Const LVS_EX_HEADERDRAGDROP = $10<br>Const LVS_EX_FULLROWSELECT = $20    'applies to report mode only<br>Const LVS_EX_ONECLICKACTIVATE = $40<br>Const LVS_EX_TWOCLICKACTIVATE = $80<br>Const LVS_EX_FLATSB = $100          'cannot be cleared - Win32 &amp; IE4 only<br>Const LVS_EX_REGIONAL = $200        'Win32 &amp; IE4 only<br>Const LVS_EX_INFOTIP = $400<br><br>Const LVIS_FOCUSED = $1<br>Const LVIS_SELECTED = $2<br>Const LVIS_CUT = $4<br>Const LVIS_DROPHILITED = $8<br><br>Const LVIS_OVERLAYMASK = $F00<br>Const LVIS_STATEIMAGEMASK = $F000<br><br><br>Type  LVCOLUMN<br>	Field mask<br>	Field fmt<br>	Field cx<br>	Field pszText:Byte Ptr<br>	Field cchTextMax<br>	Field iSubItem<br>EndType<br><br>Type LVITEM<br>	Field mask<br>	Field iItem<br>	Field iSubItem<br>	Field iState<br>	Field stateMask<br>	Field pszText:Byte Ptr<br>	Field cchTextMax<br>	Field iImage<br>	Field lParam<br>	Field iIndent<br>	Field iGroupId<br>	Field cColumns<br>	Field puColumns<br>EndType<br><br>Type LV_HITTESTINFO<br>	Field ptX<br>	Field ptY<br>	Field flags<br>	Field iItem<br>EndType<br><br>Type tagLVKEYDOWN<br>	Field hwndFrom<br>	Field idFrom<br>	Field code<br>	Field  wVKey:Short<br>	Field  flags<br>EndType<br><br>Type tagNM_LISTVIEW<br>	Field hwndFrom<br>	Field idFrom<br>	Field code<br>	Field iItem<br>	Field iSubItem<br>	Field uNewState<br>	Field uOldState<br>	Field uChanged<br>	Field ptActionX<br>	Field ptActionY<br>	Field  lParam:Byte Ptr<br>EndType<br><br>Function AddListBoxColumn(ListBox:TGadget,Column,HeadingText$,width,Style=0)<br>	Local ListboxHwnd=QueryGadget(ListBox,QUERY_HWND)<br>	Local col:LVCOLUMN = New LVCOLUMN	<br>	Col.mask = LVCF_WIDTH | LVCF_TEXT | LVCF_FMT<br>	Col.fmt = Style<br>	Col.cx = width<br>	col.pszText = HeadingText$.ToCString()<br>	Local ListBoxstyle = GetWindowLongA(ListboxHwnd , GWL_STYLE)<br>	If (ListBoxstyle &amp;  LBS_MULTICOLUMN ) &lt;&gt; ( LBS_MULTICOLUMN ) Then<br>		ListBoxstyle  = ListBoxstyle  | LBS_MULTICOLUMN<br>		SetWindowLongA(ListboxHwnd , GWL_STYLE,  ListBoxstyle   ) 'change the style so that we have headings<br>	EndIf<br>	SendMessageA(ListboxHwnd,LVM_INSERTCOLUMNA,Column,Int(Byte Ptr Col))<br>End Function<br><br>Function AddListBoxItem(ListBox:TGadget,Text$,Row,Column)<br>	Local ListboxHwnd=QueryGadget(ListBox,QUERY_HWND)<br>	Local ColItem:LVITEM  = New LVITEM<br>	ColItem.mask = LVIF_TEXT<br>	ColItem.iSubItem = Column<br>	ColItem.iItem = Row<br>	ColItem.pszText = Text$.ToCString()<br>	ColItem.cchTextMax =  Text$.Length + 1<br>	SendMessageA( ListboxHwnd,LVM_SETITEMA,0,Int(Byte Ptr ColItem))<br>	ColItem=Null<br>End Function<br><br><br>Function GetListBoxItem:String(ListBox:TGadget,Row,Column)<br>	Local ListboxHwnd=QueryGadget(ListBox,QUERY_HWND)<br>	If ListboxHwnd Then<br>		Local Ans$<br>		Local TextBank:TBank=CreateBank(1024)<br>		'Local Text:Byte[256]<br>		Local ColItem:LVITEM  = New LVITEM<br>		ColItem.mask = LVIF_TEXT<br>		ColItem.iSubItem = Column<br>		ColItem.iItem = Row<br>		ColItem.pszText = BankBuf(TextBank)<br>		ColItem.cchTextMax =  255 <br>		SendMessageA( ListboxHwnd,LVM_GETITEMA,0,Int(Byte Ptr ColItem))<br>		If ColItem.pszText &lt;&gt; Null<br>			Ans$=Ans$.fromcstring(ColItem.pszText)<br>			ColItem=Null<br>		EndIf<br>		Return Trim(Ans$)<br>	EndIf<br>End Function<br><br>Function SetListBoxItem(ListBox:TGadget,Text:String,Row,Column=0)<br>	Local ListboxHwnd=QueryGadget(ListBox,QUERY_HWND)<br>	If Column=0 Then<br>		ListBox.items[Row].Text = Text<br>		DebugLog  "ListBox:TGadget text "+Text<br>	EndIf<br>	If ListboxHwnd Then<br>		Local ColItem:LVITEM  = New LVITEM<br>		ColItem.mask = LVIF_TEXT<br>		ColItem.iSubItem = Column<br>		ColItem.iItem = Row<br>		ColItem.pszText = Text.Tocstring()<br>		ColItem.cchTextMax =  Len(Text) <br>		Return SendMessageA( ListboxHwnd,LVM_SETITEMA,0,Int(Byte Ptr ColItem))<br>	EndIf<br>End Function<br><br>Function ListBoxHeading(ListBox:TGadget,Column,Text$,width=0)<br>	Local ListboxHwnd=QueryGadget(ListBox,QUERY_HWND)<br>	Local col:LVCOLUMN = New LVCOLUMN	<br>	If width = 0 Then<br>		Col.mask = LVCF_TEXT| LVCF_FMT <br>	Else<br>		Col.mask = LVCF_TEXT| LVCF_FMT | LVCF_WIDTH<br>		col.cx   = width<br>	EndIf<br>	col.pszText = Text$.ToCString()<br>	Local ListBoxstyle = GetWindowLongA(ListboxHwnd , GWL_STYLE)<br>	If (ListBoxstyle &amp;  LVS_NOCOLUMNHEADER ) Then<br>		ListBoxstyle  = ListBoxstyle  ~LVS_NOCOLUMNHEADER <br>		If ListBoxstyle &amp; LVS_EDITLABELS=0 Then ListBoxstyle  = ListBoxstyle  | LVS_EDITLABELS<br>		SetWindowLongA(ListboxHwnd , GWL_STYLE,  ListBoxstyle )  'change the style so that we have headings<br>	EndIf<br>	SendMessageA(ListboxHwnd,LVM_SETCOLUMNA,Column,Int(Byte Ptr Col))<br>End Function<br><br>Function ListBoxColumnWidth(ListBox:TGadget,Column,width)<br>	Local ListboxHwnd=QueryGadget(ListBox,QUERY_HWND)<br>	Local col:LVCOLUMN = New LVCOLUMN	<br>	Col.mask = LVCF_WIDTH<br>	col.cx   = width<br>	SendMessageA(ListboxHwnd,LVM_SETCOLUMNA,Column,Int(Byte Ptr Col))<br>End Function<br><br>Function ListBoxGadgetMultiSelect(ListBox:TGadget)<br>	Local ListboxHwnd = QueryGadget(ListBox,QUERY_HWND)<br>	Local ListBoxstyle = GetWindowLongA(ListboxHwnd , GWL_STYLE)<br>	If  (ListBoxstyle &amp; LVS_SINGLESEL) = LVS_SINGLESEL Then<br>		Return SetWindowLongA(ListboxHwnd , GWL_STYLE,  ListBoxstyle  ~ LVS_SINGLESEL )  'change the style 		<br>	EndIf<br>End Function<br><br>Global ExplorerWindow:TGadget = CreateWindow("Pic Explorer Window", 100, 100, 700, 470, Null, WINDOW_TITLEBAR | WINDOW_CLIENTCOORDS | WINDOW_STATUS) <br><br>Local Explorer:TGadget = CreateListBox(2,2,537,394,ExplorerWindow)<br><br>ListBoxHeading(Explorer, 0, "Row1") <br>AddListBoxColumn(Explorer, 1, "Row2", 40, 0) <br>AddListBoxColumn(Explorer, 2, "Row3", 110, 0) <br>AddListBoxColumn(Explorer, 3, "Row4", 110, 0) <br>AddListBoxColumn(Explorer, 4, "Row5", 89, 0) <br><br>AddGadgetItem (Explorer, "Test", 0, 0, "Hurz") <br>AddListBoxItem(Explorer, "Test2", 0, 1) <br>AddListBoxItem(Explorer, "Test3", 0, 2) <br><br>Repeat<br>	WaitEvent()<br>	<br>	Local Gadget:TGadget = TGadget(EventSource()) <br>	<br>	Select EventID()			<br>		Case EVENT_WINDOWCLOSE<br>			Exit<br>		Default<br>			DebugLog(EventID())<br>	End Select<br>Forever <br><br></td></tr></table><br>
<a name="820826"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ziltch</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Have a look at the code here;<br><a href="http://www.blitzbasic.com/Community/posts.php?topic=62706" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=62706</a><br><br>It detects the column headers being clicked with this code;<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Function NewListProc:Int(hWnd:Int,Msg:Int,wParam:Int,lParam) "win32"

	If Msg = WM_NOTIFY Then
		Local NotifyMess:HD_NOTIFY = New HD_NOTIFY
		Local Tstr$
		
		MemCopy( Byte Ptr(NotifyMess),Byte Ptr( lParam), SizeOf(HD_NOTIFY) )
		'DebugLog "hwndFrom  "+NotifyMess.hwndFrom
		'DebugLog "idFrom  "+NotifyMess.idFrom
		'DebugLog "code "+NotifyMess.code
		'DebugLog "iItem "+NotifyMess.iitem
		'DebugLog "iButton  "+NotifyMess.iButton
		'DebugLog "pitem  "+NotifyMess.pitem
		
		If NotifyMess.code = HDN_ITEMCLICKW Then
			SetStatusText(ExplorerWindow, "Column heading "+NotifyMess.iitem + " has been clicked.")
		EndIf
	EndIf
	
	If oldListProc &lt;&gt;0 Then Return CallWindowProc(oldListProc, hWnd, Msg, wParam,Int(Byte Ptr( lParam)))
EndFunction

Global oldListProc
oldListProc =SetWindowLongA(QueryGadget(Explorer,QUERY_HWND), GWL_WNDPROC,Int(Byte Ptr(NewListProc)))

</textarea><br><br>I hope this helps <br><br></td></tr></table><br>
<a name="821154"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >andre72</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Zitch it do - as I see I need just to have a better look to your source ...<br><br>This works fine but is it also possible to add an eventhook to so you can get it like BM events in a main loop? <br><br></td></tr></table><br>
<a name="821598"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ziltch</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I do not think you can use an eventhook to get WM_NOTIFY messages.<br><br>I guess you could create you own event and use emitevent inside NewListProc when NotifyMess.code = HDN_ITEMCLICKW.<br><br>At least we can use winprocs in Blitmax, to overcome some missing features. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
