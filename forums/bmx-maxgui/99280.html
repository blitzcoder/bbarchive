<!DOCTYPE html><html lang="en" ><head ><title >app in release mode is behaving weirdly?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >app in release mode is behaving weirdly?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=117" >MaxGUI Module</a>/<a href="#bottom" >app in release mode is behaving weirdly?</a><br><br>
<a name="1164687"></a>

<a name="1164688"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skn3</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey,<br><br>I have not been building my app in release mode up until now but have today attempted to.<br><br>Everything compiles fine but it seems that maxgui behaves very strangely in RELEASE compared to DEBUG mode.<br><br>In debug mode everything works fine, no issues! In release mode some proxygadgets start to not draw and they behave differently. I have a locking mechanism on most of my custom gadgets that let me lock the gadget, make changes, then unlock. When the gadget unlocks it will do all the updates and reapint (redrawgadget) if needed.<br><br>So there is potential that my code is not unlocking somewhere, but why would it work fine in DEBUG mode?<br><br>Has anyone experienced weird issues like this when in RELEASE mode?<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1164690"></a>

<a name="1164691"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skn3</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have a lot of modules that depend on other modules and do a lot of tweaking of these modules. I am using BLIDE module builder to build modules. Do I need to build blitzmax modules in the order of dependency?<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1164693"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skn3</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just made all events output and it seems after a while EVENT_MOUSEDOWN stops firing.. wtf! <br><br></td></tr></table><br>
<a name="1164739"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hummelpups</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Did you updated your MaxGUI?<br>What about debug and releasebuilds of the modules?<br>Did zu try to just recompile all modules in threaded and not threaded mode?<br><br>I had similar problems while using maxgui 1.41 with some gadget functions.<br>A downgrade to 1.40 or 1.42 beta from repository fixed the problems for me <br><br></td></tr></table><br>
<a name="1164886"></a>

<a name="1164887"></a>

<a name="1164888"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've had those exact problems when using the os api ( and also with c/c++ ) specifically with callbacks, which is caused by using the wrong calling convention across languages. BMax adds extra code with debug mode that somehow lets you get away with using the wrong convention, but when in release mode it behaves incorrectly ( or correctly depending on how you look at it! ).<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1164976"></a>

<a name="1164979"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skn3</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ooo interesting thanks, I will look into both methods :D<br><br>Any pointers on what you changed and examples would be very helpful?<br><br>Thanks again :)<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1165028"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jsp</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> In debug mode variables are not freed as in release mode to be able to show the content in the debugger. <br>I remember some problems related to that, when the GC frees variables at a time you didn't expect.<br>Compared to Windows some events are fired differently on the Mac, which sometimes makes me crazy, but as your app works fine in debug mode that should not be your problem. <br><br></td></tr></table><br>
<a name="1165051"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>Any pointers on what you changed and examples would be very helpful? <br></div><br><br>For the calling convention, specifically for Windows, the callbacks needs to conform to the windows convention ( all to do with the how variables are released from the stack ). Also, in BMax, the callback must be a Function as opposed to a Method. A method may work under certain circumstances, but it will certainly barf as the program size grows. Functions within Types are still ok.<br>The calling convention you'll need for callbacks from windows will need "Win32" appended to the end of the function definition.<br><br>Function WindowsWillCallMe(With,Various,Parameters)"Win32"<br>	'Do something<br>EndFunction<br><br>I honestly don't know if the same applies to Mac ( it has calling conventions, all OSs do, but I don't know it's specifics or how would it relate to BMax ) so hopefully someone else could help out :P<br><br>Of course it might not even be the problem, but it's a shot. <br><br></td></tr></table><br>
<a name="1165122"></a>

<a name="1165123"></a>

<a name="1165125"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skn3</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> In debug mode variables are not freed as in release mode to be able to show the content in the debugger. <br>I remember some problems related to that, when the GC frees variables at a time you didn't expect.<br>Compared to Windows some events are fired differently on the Mac, which sometimes makes me crazy, but as your app works fine in debug mode that should not be your problem. <br></div><br><br>I am able to avoid the problem if I turn off the garbage collector, but the moment I start to collect it throws a fit. So it seems <i>something</i> definitely happening with an unexpected release. I spent a day going over with a fine tooth comb, making sure all windows, gadgets, dialogues, resources, etc get freed. Seems like I will do some more investigation here too then.<br><br><div class="quote"> For the calling convention, specifically for Windows, the callbacks needs to conform to the windows convention ( all to do with the how variables are released from the stack ). Also, in BMax, the callback must be a Function as opposed to a Method. A method may work under certain circumstances, but it will certainly barf as the program size grows. Functions within Types are still ok.<br>The calling convention you'll need for callbacks from windows will need "Win32" appended to the end of the function definition.<br><br>Function WindowsWillCallMe(With,Various,Parameters)"Win32"<br>'Do something<br>EndFunction<br><br>I honestly don't know if the same applies to Mac ( it has calling conventions, all OSs do, but I don't know it's specifics or how would it relate to BMax ) so hopefully someone else could help out :P<br><br>Of course it might not even be the problem, but it's a shot. <br><br>Dave. <br></div><br><br>Well I am not using any additional windows hooks as far as I remember and just tapping into the existing ones that maxgui uses. I have potentially not defined my header files for blitzmax properly with the extern c { thang so that could be bothering it?<br><br>I'll need to investigate that one as well.<br><br>Thanks all for the help so far. I will be sure to post my findings once I am able to resolve it. Hopefully it will help someone looking for the issue in the future.<br><br><font class="tiny">Last edited 2012</font><br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1165142"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Regarding Hummelpups post, what version of MaxGUI are you using? <br><br></td></tr></table><br>
<a name="1165163"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I have potentially not defined my header files for blitzmax properly with the extern c { thang so that could be bothering it? <br></div><br><br>Hmm, anything is possible, but if the source is c++ you wouldn't even get it compiled and have linking errors everywhere. Regular C externs doesn't normally require a calling convention as BMax defaults to using the "C" convention as opposed to "Win32". I don't think the problem now though.<br><br>You mention using C, are you creating and passing BMax and C objects across the language boundary? Possible problems with scope can occur if thats the case. <br><br></td></tr></table><br>
<a name="1165230"></a>

<a name="1165231"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skn3</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Skid,<br><br>I am using the version from the repo (hard to tell as the version number is stuck at ModuleInfo "History: 1.33 Release")<br><br>I have made a few slightly modifications to add some functionality for some more events. One being a GADGETRESIZE event. Nothing major though. Anything that was modified has not really been anything that could break things apart from simply not compiling in the first place.<br><br>Iam potentially creating some BBSTRING and BBARRAY for return values but have followed the same process as used by other blitz modules. There is never a point where I am creating a non-temp object outside of blitzmax scope. Could that still be an issue?<br><br>Most of my wrapped stuff will be like:<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">Extern "Win32"
	Function GetEnvironmentVariable(lpName$z, lpBuffer:Byte Ptr, nSize) = "GetEnvironmentVariableA@12"
End Extern

Function GetEnv:String(envVar:String)
	Local buff@[64]
	
	Local rtn = GetEnvironmentVariable(envVar$, buff@, buff.length)
	If rtn &gt; buff.length
		buff@ = buff@...]
		rtn = GetEnvironmentVariable(envVar$, buff@, buff.length)
	EndIf
	
	Return string.FromBytes(buff@, rtn)
End Function</textarea><br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1165281"></a>

<a name="1165282"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Jonathan, if you are stuck and want me to have a look please feel free to send me the project source. <br><br>I would like to bump MaxGUI version for next release of BlitzMax so would be more than happy to make sure it is not something wrong in the module that is causing your problems.<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1165310"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>There is never a point where I am creating a non-temp object outside of blitzmax scope. Could that still be an issue? <br></div><br><br>As a say, anything is possible using BMax Objects outside of BMax, it is ok if you handle them correctly. Skid beat me to the offer of taking a look at the source. I don't mind looking too. The more the merrier to help get the issue resolved :P <br><br></td></tr></table><br>
<a name="1165485"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skn3</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the offer. When I get a chance I will look into it more and then probably will fail that and send it over to one of you :) It is quite large a project though haha. It wont be soon, quite busy trying to get kickstarter project off ground but will post an update here when I had a chance.<br><br>Thanks. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
