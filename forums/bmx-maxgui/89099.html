<!DOCTYPE html><html lang="en" ><head ><title >OSX: Stack warning and freezes with two threads</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >OSX: Stack warning and freezes with two threads</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=117" >MaxGUI Module</a>/<a href="#bottom" >OSX: Stack warning and freezes with two threads</a><br><br>
<a name="1011564"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >explosive</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi altogether,<br><br>I'm currently experimenting with threads and the MaxGUI. Very basically I have to main functions that I want to run parallel. Both functions create a window and load stuff to draw.<br><br>Now I experience two major things:<br><br>1) When starting the second window, the gadgets are added to the window very slowly.<br>2) Without the debugger the programme freezes and with it MacOS as well. When having the debugger turned on the performance is even worse and I get a hell a lot of warnings from the NS-library. Here are the last few lines from a sample programme:<br><pre class=code>
2010-02-16 17:58:18.482 pipestarter.debug.mt[611:4603] *** _NSAutoreleaseNoPool(): Object 0x457920 of class NSConcreteMutableAttributedString autoreleased with no pool in place - just leaking
Stack: (0x9335bf4f 0x93268432 0x90121784 0x90120c0d 0x900a3402 0x900a2fd5 0x900a2f5f 0x900a2ee0 0x90065b70 0x90065540 0x900653ee 0x17eb4 0x7fb9 0x5e04 0x1d3ec 0x55d8 0x447b4 0x15524b 0x92d26155 0x92d26012)
2010-02-16 17:58:18.594 pipestarter.debug.mt[611:4603] *** _NSAutoreleaseNoPool(): Object 0x489790 of class __NSFastEnumerationEnumerator autoreleased with no pool in place - just leaking
Stack: (0x9335bf4f 0x93268432 0x9006b1ae 0x9011945d 0x186fe 0x7fb9 0x5e04 0x1d3ec 0x55d8 0x447b4 0x15524b 0x92d26155 0x92d26012)
2010-02-16 17:58:18.595 pipestarter.debug.mt[611:4603] *** _NSAutoreleaseNoPool(): Object 0x481c40 of class NSDeviceRGBColor autoreleased with no pool in place - just leaking
Stack: (0x9335bf4f 0x93268432 0x1982c 0x987d 0x5f60 0x1d3ec 0x55d8 0x447b4 0x15524b 0x92d26155 0x92d26012)
2010-02-16 17:58:18.596 pipestarter.debug.mt[611:4603] *** _NSAutoreleaseNoPool(): Object 0x467130 of class NSCFString autoreleased with no pool in place - just leaking
Stack: (0x9335bf4f 0x93268432 0x1939d 0x987d 0x5f60 0x1d3ec 0x55d8 0x447b4 0x15524b 0x92d26155 0x92d26012)
2010-02-16 17:58:18.596 pipestarter.debug.mt[611:4603] *** _NSAutoreleaseNoPool(): Object 0x467150 of class NSObject autoreleased with no pool in place - just leaking
Stack: (0x9335bf4f 0x93268432 0x900dfd9a 0x900ff875 0x90065495 0x900653ee 0x19784 0x987d 0x5f60 0x1d3ec 0x55d8 0x447b4 0x15524b 0x92d26155 0x92d26012)
</pre><br><br>The programme is just the following lines:<br><pre class=code>
Import maxgui.drivers

SetHotKeyEvent(KEY_F5,Null)

win=CreateWindow("Main",0,0,250,ClientHeight(Desktop()),0,1)
Repeat
	event=WaitEvent()
	If event=EVENT_WINDOWCLOSE Then End
	If event=EVENT_HOTKEYHIT
		CreateThread(pipewin,Null)
	EndIf
Forever

Function pipewin:Object(data:Object)
	pwin=CreateWindow("Child",250,0,ClientWidth(Desktop())-250,ClientHeight(Desktop()),0,1)
	Repeat
		event=WaitEvent()
		If event=EVENT_WINDOWCLOSE Then FreeGadget(pwin);Return
	Forever
End Function
</pre><br><br>My questions are:<br> - Am I doing anything wrong?<br> - Is it just a bug on MacOS?<br> - Is there a better way to have two (or even more) windows running? TProcess sadly opens up a new dock icon and system_ halts the caller.<br><br>My system:<br>MacOS 10.5.8, 2x1,8Ghz Intel, 2GB Ram<br>BM 1.38, MaxGUI 1.36 (both just updated)<br><br>[Edit]<br>I let the code run on opensuse 11.2 and everything works fine. Maybe I try to port my big code with canvases and quite a few images tonight and can then report about the experiences under linux.<br>[/Edit]<br><br>Many thanks for your help anyway!<br>Simon <br><br></td></tr></table><br>
<a name="1011569"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  Am I doing anything wrong? <br></div><br>As far as I know, interaction with the GUI must be handled in the main thread only. <br><br></td></tr></table><br>
<a name="1011574"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >explosive</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Brucey,<br><br>I just let the code run under linux. The performance is poor as well even though now exceptions are thrown.<br><br>So what's actually the best way to have more than just a single window running? Creating all gadgets and fetching all events in the main thread and only letting the update-functions run in its own thread?<br><br>Do you have experiences with that?<br><br>Cheers<br>Simon <br><br></td></tr></table><br>
<a name="1011630"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jsp</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> In general there are two options with MaxGui. <br><br>First, you can create several windows and gadgets on top and check all events in the main thread with the standard WaitEvent() command or so. Depending on what should happen, there is no problem to do so. <br><br>Second, you can use hooks to hook one or more gadgets directly into the event-queue. Also here no problem, but it’s more complicated, though it has the advantage to be independent as it does not need an event loop.<br><br>If it will be a small tool or dialog thing I would use method one, as it is easier.<br>If it will be a medium to big project I would go for the second approach and try to create independent types.<br><br>To make your user response not too slow you can create a window in a hidden state during startup and then later hide and show as needed.<br>The gui should be handled in the main thread, you could run your ‘actions’ in the background then. <br><br></td></tr></table><br>
<a name="1017716"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rozek</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmmm,<br><br>if all interaction with the GUI must be done in the main thread, how do I implement a non-blocking "requestDir" or "requestFile" then?<br><br>I just tried to invoke these functions from within a separate thread (and properly hand over the result to the main thread) which worked fine under Windows, but fails (i.e. blocks and produces those nasty _NSAutoreleaseNoPool() messages) under MacOS X<br><br>Thanks in advance for any hint (as I really want to avoid blocking under MacOS X!) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
