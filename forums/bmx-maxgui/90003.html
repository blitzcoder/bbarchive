<!DOCTYPE html><html lang="en" ><head ><title >GLShareContexts() issue</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >GLShareContexts() issue</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=117" >MaxGUI Module</a>/<a href="#bottom" >GLShareContexts() issue</a><br><br>
<a name="1022755"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Short version: I either need to be able to turn OFF GLShareContexts() after I turn it on, OR I need to be able to draw multiple canvases without turning it on at all.<br><br><br>GLShareContexts() is not well supported on all graphics cards so it should be avoided, however I have 3 canvases, and they need to share a lot of images...<br><br>GLShareContexts() is working fine for this except that it causes MiniB3D to crash on one of my tester's systems... Short term fix, is there a way to turn share contexts OFF once you've turned it on? even if it requires resetting the graphics driver (which doesn't seem to work)? I can't find any way to get it off once it's been enabled without exiting the program...<br><br>Is there an alternative to shared contexts for re-using TImages? I don't need to retain the backbuffer for each context, so in theory do all the images belong to one context (It would appear the last one that was set via SetGraphics()...), which I could draw in, and then flip that to the area I need to display? <br><br></td></tr></table><br>
<a name="1022757"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SebHoll</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is there a specific reason why your canvases need to be divided into three?<br><br>For fear of stating the obvious, if they are next to each other, maybe you could just merge them together as one canvas and add the split screen logic to your rendering code.  Otherwise I'm stumped.  Not really a GFX programmer. <br><br></td></tr></table><br>
<a name="1022771"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> turning it of is no realistic option, that tripples the amount of VRAM and if he really has such a crap card that he requires it to be turned off I've to say that I am not sure if it runs on that system at all.<br><br><br>TImages are basically TPixmap + VRAM representation. The Pixmap is totally API / context independent so no problem there. But the VRAM representation will be context dependent. <br><br></td></tr></table><br>
<a name="1022774"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> the contexts are split up as seperate GUI elements, they have scroll bars attached to shift their contents, each is used for different things (one shows and allows re-ordering of thumbnails, one selects a modifier for the thumbnails, one show and allows re-ordering of groups of thumbnails...) but they are all distinct, they also get re-drawn at different times, so if possible I'd like to not have to draw all 3 every time any of them needs a change.<br><br>The problem with the shared contexts is not that it specifically is a problem. but when I try to go to full screen 3D in minib3d after closing down and releasing the window then on one computer it crashes. if I never turn on shared contexts then (obviously) my GUI elements are all fubar but the 3D switchover works fine.<br><br>So basically if I could turn GLShareContexts() off when I'm done with it, and switching to 3D, I shouldn't have a problem... but I see no way to turn it off... so I'm looking for that or alternatives.<br><br>And you're right, trippling the vram usage, even if it were possible would just cause many many more nasty nasty problems... <br><br></td></tr></table><br>
<a name="1022828"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've gone digging through the source for brl.glgraphics and I've hacked together something that seems to be working so far... basically when you setup shared contexts it creates an extra opengl context that all of the display contexts use to store their data (since they all use the same place for storage it's available to all of them). When you create a new context it tries to incorporate the share context at setup. if the share context is missing it doesn't use a share. The following will release the share context and set it back to nil so new contexts will not use it.<br><br>So far this has gotten my tester running, however he has noted some graphical glitches but I don't know what/where/when yet. And that was also on my first test I sent to him.<br><br>This WILL cause some bad things to happen if there's any context available when you call it so you should end everything before you call it.<br><br>Also, as noted by dreamora, timages have a VRAM managed component. You should clear all your images and preferably call GCCollect() before killing the shared context as well, otherwise stuff could be left behind and get loose...<br><br>Might cause a memory leaks, haven't had a chance to test that yet.<br><br>Obviously use at your own risk and if someone else with more openGL experience want to point out how this might cause disasters, or improve it in any way please do.<br><br>So far I only have it working on mac, the windows brl.glgraphics is far more intimidating, and I haven't even looked at the linux code yet...<br><br>Add this to mod/brl.mod/glgraphics.mod/glgraphics.macos.m<br><pre class=code>
void bbGLKillGraphicsShareContexts(){ // destroy shared context hack by ima747
	if( _sharedContext ){
		[_sharedContext clearDrawable];
		[_sharedContext release];
		_sharedContext = nil;
	}
}
</pre><br><br><br>Add this to mod/brl.mod/glgraphics.mod/glgraphics.bmx<br><pre class=code>
?MacOS
Rem
bbdoc: Dissable OpenGL context sharing
about:
This clears the shared context created by GLShareContexts.

It should be called after all opengl contexts are removed.

Mac os only
End Rem
Function GLGraphicsUnshareContexts()
	bbGLKillGraphicsShareContexts
End Function
?
</pre><br>Also at the top of the bmx file, in the extern declaration section add this<br><pre class=code>
	?MacOS
	Function bbGLKillGraphicsShareContexts()
	?
</pre><br><br>GLGraphicsUnshareContexts() is your new toy.<br><br>Rebuild modules, cross your fingers and don't blame me if things go horribly wrong ;0) <br><br></td></tr></table><br>
<a name="1022863"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Got to play on my tester's computer. It seems as long as I kill EVERYTHING I created before switching back and forth it works well... I have a nagging suspicion that I'm missing something important though... <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
