<!DOCTYPE html><html lang="en" ><head ><title >Strangest error/bug</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Strangest error/bug</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=117" >MaxGUI Module</a>/<a href="#bottom" >Strangest error/bug</a><br><br>
<a name="1045651"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sanctus</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey guys.<br>I'm trying to have a application with dynamic window(by that I mean that any number of windows of a certain type can be opened in the same time).<br><br>So I added the contentments of my window in a type, made a hook, a list.. <br><br>When I create a window I call this thing<br><pre class=code>
If list.Count() = 0
	AddHook(EmitEventHook, Hook)
EndIf
list.AddLast(ipw)
</pre><br><br>The hook takes care of all the windows of the same type. I also add the window object (that contains the window,canvas,whatever) in a list as you can see.<br><br>When the user presses the close button I call this:<br><pre class=code>
Method Close()
	list.Remove(Self)
	If list.Count() = 0
		RemoveHook(EmitEventHook, Hook)
	EndIf
	FreeGadget(canvas)
	FreeGadget(Window)
End Method
</pre><br>Basically if it's the last from the list I remove the hook so I don't waste processing power.<br><br>Now if I open up any number of windows( even a single one) when I close the last one I get a random error. I say random because it's in different places every time.<br>Here is one line that throws an error:<br><pre class=code>
Local tmpWrapper:TIntWrapper = New TIntWrapper
</pre><br><br>If I remove Freegadget(window) and freegadget(canvas) they won't appear anymore but that's not right. Since I can't just leave window wrecks and hide them.<br><br>From my experience I'd say this is a stack/heap something unbalanced. As you can see the error is thrown when allocating memory for a new object(another example of a crash place "Local t:TEvent=New TEvent")<br><br>Oh and the error is "EXCEPTION_ACCESS_VIOLATION"<br><br>Does anyone have any ideea on how to solve this?<br><br>Oh and I'm running windows 7, with latest blitzmax and maxgui. <br><br></td></tr></table><br>
<a name="1045655"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sanctus</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> After some more fiddling I noticed that if I commend this line "DrawImage(image, 0, 0, 0)" from my draw sequence the error goes away.<br>Though the error itself is not related to the image being drawn. That line of code does not get called afterwards.<br>I imagine it's something related to the wglsharelist from opengl or something. That would explain why the program crashes only when the last window is closed. <br><br></td></tr></table><br>
<a name="1046506"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sanctus</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I found the right solution for this. If anyone needs it then the answer is below.<br><br>When you create a device a link between the gadget (canvas) and the hardware is made.<br>When you load/create a image it is uploaded on the hardware.<br><br>Then when you release the gadget and the image the GC collects in a possible wrong way. The device gets closed and then GC forces the image to be freed but for example in OpenGL the Delete method requires the device to free the video memory. Since there isn't any device left there's a problem and a stack/heap memory error arises.<br><br>So when you close a window with a canvas or something you have to do this<br><pre class=code>
image=null
GCCollect()
FreeGadget(window)
</pre><br><br>I wrote image=null but you should free any image related to the canvas. That way when you close the last device there shouldn't be any image left.<br><br>It's a bit late and I'm very tired. If anyone feels like they should correct or add something to this then please feel free to add a comment.<br><br>Thanks. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
