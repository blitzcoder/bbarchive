<!DOCTYPE html><html lang="en" ><head ><title >collaboration rpg</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >collaboration rpg</h1><a href="forums.php" >Community Forums</a>/<a href="topics.php?forum=11" >Technical Discourse</a>/<a href="#bottom" >collaboration rpg</a><br><br>
<a name="1340797"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi folks.<br><br>Ive been meaning to say this for years and years and have started and deleted this post numerous times over the years.<br><br>Im wondering if some people would like to collaborate on a game together.<br><br>Ive written and completed numerous games over the years as programmer and designer.<br><br>But what I'm hoping to do is an rpg or fantasy game.  I have ideas for what id like to create but im happy to take a back seat and contribute in other ways.<br><br>Im thinking id like to be an assistant 2d artist on a project and to provide programming advice and assistance.<br><br>Im not expecting we'd make something ground breaking.  This is more for fun than money or accolades.<br><br>I have some ideas for a design for mobile.  I could build it myself easily enough but i want to take a smaller role in developing something.<br><br>On other posts ive made you can see my artwork.  Its raw and amateurish but if you can see yourself working with me to develop something simple and fun as a project let me know.<br><br>My goal with this is to have a reason to draw and paint some 2d fantasy images whether they be backgrounds or characters-with a rough sketchy feel.  And also to offer my programming skills when they are needed and wanted.<br><br>I would love to discuss this further here.  As i said its purely a fun project.  <br><br>When i get home i might post an image of a potential design on pen and paper explaining my idea.  Although I'm open to yours too as i see my role as going to be more the art side of this.<br><br>I'm not claiming to be an excellent artist by a long shot but i enjoy drawing and sketching and would love to see my images in a game as part of a team effort.  <br><br>I am a programmer by trade but am hoping to take more of a back seat in this.<br><br>Purely for fun and enjoyment.<br><br>Matt. <br><br></td></tr></table><br>
<a name="1340802"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Idea for design...open for changes..<br><br><img src="http://www.mattiesgames.com/gfx/ml7.jpg"><br><br>Basically.<br>Pick from a bunch of character presets for a party of four.  Allow alteration of stats.<br><br>Main interface is a 6x10 grid where each cell is a location that provides two options with different positive consequences such as stat changes info provided etc.<br><br>Combat takes place on some cells which is auto rolled for.<br><br>Adventures are played while waiting for the bus or on the train and are quick.  Multiple story based adventures ecist with distinct milestones.  Eg one may be to find the lost prince another to slay an evil dragon and so on.<br><br>Tapping on grid cells reveals surrounding cells and allows for further exploration.<br><br>Some cells are impassable and block exploration.<br><br>Map generated is random with story picked from a collection.<br><br>Game is part procedural part scripted.<br><br>Stats are damage output, health and focus or skill rating.<br><br>Tapping a grid square shows a set of options which player chooses that develops their character further.<br><br>Something like that. <br><br></td></tr></table><br>
<a name="1340803"></a>

<a name="1340804"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Example 2d standard (black and white)...so there would be a particular style to it..<br><br><img src="http://www.mattiesgames.com/gfx/ml8.jpg"><br><br>And in colour<br><br><img src="http://www.mattiesgames.com/gfx/2017p191.jpg"> <br><br></td></tr></table><br>
<a name="1340810"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rooster</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sure, I'd like to help if I can.<br><br>I could do sound effects and music. I'm not that good at it, but I'm not horrible ether (I hope).<br>I'm not sure how much code work I could do, and all I know well enough is Blitzmax. <br>I'm not sure how well I know it ether.<br><br>I like the style you have going, it would look good in a game.<br>There is another game called "The Secret of Tremendous Corporation" that has the hand drawn unpolished look. <br><br></td></tr></table><br>
<a name="1340813"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AdamStrange</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here's a thought.<br>I like the concept - more or less. But the design document images are utterly adorable and brilliant. There is a hand drawn charm about the tine blob men that I haven't seen before and it looks appealing &lt;-- that's a good thing....<br><br>using the hand drawn blob men would also mean your graphics are simple and could be colourful as needed or black and white &lt;-- again a great thing for clarity.<br><br>Suggestion here would be draw up very quickly what the game looks like, I can see 7 blob men already and it looks like 2 mountains and 2 tree squares.<br>Draw some more blob men and more squares just as you have already done, but more of it all ;) <br><br></td></tr></table><br>
<a name="1340814"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok.  Well maybe I will make a start myself and see how I go. I was mainly testing the waters with the idea.  <br><br>We will see. <br><br></td></tr></table><br>
<a name="1340823"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >EdzUp MkII</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> looking good :) <br><br></td></tr></table><br>
<a name="1340824"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> <img src="http://www.mattiesgames.com/gfx/tilefull2.png"><br><br>Starting on tiles... <br><br></td></tr></table><br>
<a name="1340826"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AdamStrange</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> mmm, yes and no. My comment here would be the colours are muddying the graphics a bit, and the line drawing is getting complex - which would be lost on a small screen.<br><br>But I like the general use of colours.<br><br>So... Here is another view:<br><img src="https://vjointeractive.files.wordpress.com/2017/05/dwarfen.gif"><br><br>First we have a neutral(ish) background color, and some tonal colors making a palette - note there is no black or white, but an 'almost' which gets the job down better as pure black/white would create a jarring effect.<br><br>taking your initial drawings, give a base grid and layers to draw on. here you find a very quick line drawing replicant of your drawings - note they are very quick, immediate drawings with light from the top left shadow bottom right.<br><br>Note also that some are breaking out of the grid.<br><br>Taking these line drawings, we can now add color. the green for the base background, green for the tree, grey for the rocks. notice we are not using fills, just hand draw rough, and quick and simple.<br><br>if you removed the color, you would still see the shapes and know instantly what was being shown.<br><br>OK. Thoughts so far. cell not visited has no things shown apart from neutral background.<br>visited cell could be the line drawing<br>cell that is close (left/right/up/down) could have the color layer added to the  line drawing.<br>You could also use different color palettes to give different looks - green for meadow, core for desert, and still use the same line drawings. <br><br></td></tr></table><br>
<a name="1340829"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Characters (player characters)<br><br><img src="http://www.mattiesgames.com/gfx/characters2.png"> <br><br></td></tr></table><br>
<a name="1340836"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Monsters:<br><img src="http://www.mattiesgames.com/gfx/monsters.png"> <br><br></td></tr></table><br>
<a name="1340838"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Why0Why</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> I like the idea.  Maybe the name could be Watercolor Fantasy. <br><br></td></tr></table><br>
<a name="1340839"></a>

<a name="1340840"></a>

<a name="1340841"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mainsworthy</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Matty, just an idea , but if you do everything from a topdown view you will be able to put your art in a virtual tabletop app.its possible to use as they are too. Plus Adam know his stuff lisen to him closly<br><br>I have made a VTT App I learned a lot from Adam, that could acomadate, the source code is included, <br><br><a href="https://numbergamer8.itch.io/miniatures-game-tool" target="_blank">https://numbergamer8.itch.io/miniatures-game-tool</a> <br><br></td></tr></table><br>
<a name="1340843"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rooster</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  Maybe the name could be Watercolor Fantasy.  <br></div><br>I like it. <br><br></td></tr></table><br>
<a name="1340849"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Time to go to bed.<br>Icons.<br>Scroll.<br><img src="http://www.mattiesgames.com/gfx/icons.png"><br><br><img src="http://www.mattiesgames.com/gfx/scroll1.png"> <br><br></td></tr></table><br>
<a name="1340855"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> &gt; Watercolor Fantasy. <br><br>Then you should consider playing with the words ... so do som "pun". Means to fight a witch you need to color her hat to red first ... or to make a stone go away, you cast the spell "ice color" - which then melts away as the sun is shining strong.<br><br><br><br>As Adam already told: your characters show too much "details" for the quality they have. Think of the axe/sword-icon in the "icons"-post (3rd row, 1st icon). It is not that easily to recognize because of the less "straight" (unjaggered/non-jittered) lines).<br><br>Have a look at Adams suggestions and see how these lines look "smooth" and as if they were drawn in "one stroke". Todays painting apps allow smoothing your draw strokes.<br>Did you consider painting in a vector drawing app? <br><br>Personally I like the "stroke handling" of "Autodesk Sketchbook" (there is a free version to try out). For me and my digitizer (the one of the HP EliteBook) it is producing the best looking pencil strokes. Benefit is of course layers and other cool things.<br>So do to what Adam did (the coloring) you do the outlines and then in a new layer, with a new "brush" you could paint colors (or maybe "shadow areas" if you really need to).<br><br><br>Nonetheless: the basic ideas in your monsters and icons is good and this is useful if you intend to improve them - which of course could be done step by step and later on (while doing the game development).<br><br><br>@ blob man<br>I think you are talking about that "circular shapes"-based sketches in post #2 ? Yes I think this could work too - do everying with "circular shapes". Dunno how hard things become to get drawn with this limitation but hey, isn't this part of the creative process we all like?<br><br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1340861"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes these graphics are a first pass...once I have a working game I will then begin refining them.  But I take your point. <br><br></td></tr></table><br>
<a name="1340862"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yue</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> In blitz3d? <br><br></td></tr></table><br>
<a name="1340863"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> There's no code yet Yue....only ideas so far. It is most likely going to be for mobile though and with exes being so hard to distribute these days it is unlikely to be blitz3d. <br><br></td></tr></table><br>
<a name="1340864"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yue</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think if you plan to use BlitzMax, I can collaborate with the menu system and load the resources. <br><br></td></tr></table><br>
<a name="1340870"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rooster</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> If we use BlitzMax I'll help where I can with code. <br><br></td></tr></table><br>
<a name="1340871"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm...this project is changing in my mind slightly.<br><br>Im getting inspired which is a good thing.  But because my idea was for mobile im likely to code in java.  But i also want to contribute to the community...so maybe i will continue posting media as i upgrade and create it for public use and can offer assistance with code if necessary but at the same time i can build my own app.  In an hour or so I'm going to build the map system and play around with exploring the map.  It may take a while.  What i might do is post in code boxes pseudo code for the process so that anyone else can build it with me in whatever language they choose...blitz monkey javascript java c etc. <br><br></td></tr></table><br>
<a name="1340878"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rooster</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Matty <br><div class="quote"> What i might do is post in code boxes pseudo code for the process so that anyone else can build it with me in whatever language they choose... <br></div><br>So basically a sort of blueprint for the code? <br><br></td></tr></table><br>
<a name="1340881"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AdamStrange</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> ok. I'm not saying anything apart from this:<br>Have you ever thought that the reason for lack of users, is because you are using java? <br><br></td></tr></table><br>
<a name="1340886"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> No...Android development is primarily done in java. <br><br></td></tr></table><br>
<a name="1340888"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AdamStrange</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> maybe try a desktop (non java) version first and see what the reception is? <br><br></td></tr></table><br>
<a name="1340891"></a>

<a name="1340892"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah...if I did desktop I'd use either blitz3d/plus or javascript (web) - and I'm still debating with myself about the design. I put together a prototype on my phone earlier and it doesn't quite grab me just yet...need to work a few things out still.<br><br>EDIT - Actually,, the whole point of this exercise was I was hoping to do the graphics for others rather than build an entire app myself....getting back to my original focus - I wanted to spend some time developing some graphics for others for a project that I was loosely attached to...somehow I've ended up making a whole game again..I think I will go back to the graphics that I have already worked on and redo them soon to bring them up to a better standard (and probably keep refining them)....but we will see... <br><br></td></tr></table><br>
<a name="1340895"></a>

<a name="1340896"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AdamStrange</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> You are sort of making a problem for yourself on the programming front.<br>java and javascript are not bltz related. So you will Never get any people wanting to work on those formats from here.<br><br>So... You have blitz3d, or blitzmax or monkey or monkey2<br><br>You will have to decide which, because everyone will need the same platform to work with.<br><br>Which means blitz3d and monkey are probably non-starters.<br><br>ok, next would be the graphics.<br>People will take one single look at one single frame and decide if they like it or not. then if they do like what they see - they will investigate further.<br><br><br><br>So... I'm afraid your graphics are not going to win any converts. Don't get me wrong. there is a lot that is good - but overall they don't look good enough to sell any type of game. they need a certain quality. I can't tell you what that quality is - but I can tell you these graphics don't have it.<br><br>People can instantly judge quality from the presentation. Roguelikes/dungeon crawlers are everywhere. so people know what quality looks like. even cheap knock off will buy in graphics to make their crud look like it might be good.<br>If any game does not meet a certain standard - it's dead in the water.<br><br>Now I know you are going to be a.Hurt, b.Angry, c.All of the above, so I am going to show what a quick google gives us:<br><br>This looks kinda dull, but is only a step away from what you are thinking<br><img src="http://indiegames.com/adventuringcompany.png"><br><br>Much more interesting - even in grey<br><img src="http://indiegames.com/fantasy%20dungeon.png"><br><br>Think about how your graphics would look in both of these - they would become muddy and indistinct<br><br>This looks brilliant!!!!!! Whatever quality is, this has it - don't know how it plays though<br><img src="https://pbs.twimg.com/media/Cf8G1YVXIAAW8aU.jpg"><br><br><br>Nice, but looks like a dullfest...<br><img src="http://slashwareint.com/ananias/igg/ananiasPreview.1.png"><br><br>Busy, kinda nice individual graphics, but one the whole - has selection errors that just make it look poor. colors look like one all messed up palette. very had to see what is going on<br><img src="http://flend.net/images/royalerl1.png"><br><br><br>Great character design:<br><img src="https://pbs.twimg.com/media/CBLYy9gUYAAMNj7.png"><br>place on a muted background and they would POP right out and look brilliant.<br><br><br>Adorable, very likeable<br><img src="https://media.indiedb.com/images/games/1/41/40409/auto/11150303_838982052888017_72391953953.png"><br><br><br>Really interesting use of a chosen palette:<br><img src="https://s-media-cache-ak0.pinimg.com/originals/13/41/59/134159f5b1705aed18f4d09450cadef5.png"><br><br><br>Just more adorable...<br><img src="http://i.imgur.com/lY1HIhN.png"><br><br><br>This is really interesting - shows a completely different style of presentation and look georgeous. But... It doesn't play that well and quickly becomes boring<br><img src="http://indiegames.com/2015/06/02/cardd_2.jpg"><br><br><br>This last one is the perfect example of what getting it right looks like:<br><img src="http://bestindiegame.com/wp-content/uploads/2011/09/Realm_of_the_Mad_God211.jpg"><br>Yep, there loads of strange text, but playing it is frenetic fun. it is even a good example of taking remade graphics and adding a little something else to them.<br>Even the UI on the right is an example of what 'Right' looks like <br><br></td></tr></table><br>
<a name="1340900"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah fair enough....I'll stick to doing it on my own then...not hurt, not angry....I can see my quality is not up to par. <br><br></td></tr></table><br>
<a name="1340947"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Pakz</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> I was reading a discussion a while ago and gfx artists said they expect around the sum of 50 euro an hour for their work. High quality art is expensive! So it must be difficult to get good in a short time.<br>I would expect that it would take a good number of years to get to a pro level. The educated artist i thought spend 6 years in art school. They would of spend years making art on theurself also.<br><br>Though with the breakthroughs in machine art and machine learning I expect artificial intelligence to be able to simplify or speed up art creation within the next years. I recently noticed a google tech being able to create emoticons from selfies. Quadrilions of variations iirc.<br><br>Another breakthrough last year was by a chinese man who was able to let the computer draw ( blurry) photo images from user input. You would type in gorgon and the ai would create a image showing a gorgon. Maybe this is the direction that art creation is going.<br><br>I joined a deep learning group on facebook to follow the news on things like this. <br><br></td></tr></table><br>
<a name="1340949"></a>

<a name="1340950"></a>

<a name="1340951"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> In my book, "quality" is not an attractive quantity in indie productions such as this. I think Matty's style is authentic and highly original. <br><br></td></tr></table><br>
<a name="1340954"></a>

<a name="1340956"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#32">[#32]</a></td></tr></table></td></tr><tr ><td class="posttext"> My opinion : don't consider any critic concerning the subjective aspects of your game (like graphics style or the sounds style), however consider the critics which are about the ease to understand/play the game, bugs, glitches, badly optimized meshes/textures/images/animations/effects/sounds, unconvincing animations, abnormal variation of the speed of the game, abnormal slowdowns, bad sounds normalization (db), etc...<br><br>Keep in mind that the appreciation of the graphics/sounds/gameplay of your game is subjective and a matter of taste, so don't expect praises from people who have different views/tastes...<br><br>However, about the graphics style, you could try to make it more clean / less drafty (as i explained in another post (=remove the black lines)) (but you do what you want!) <br><br></td></tr></table><br>
<a name="1340983"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#33">[#33]</a></td></tr></table></td></tr><tr ><td class="posttext"> There is the most important phrase in Adams post you all seem to ignore:<br><br><b>People will take one single look at one single frame and decide if they like it or not. then if they do like what they see - they will investigate further.</b><br><br><br>So while _we_ as programmers might see it a bit different, the overall gamer looks at a screenshot and says "nay" or "yay".<br>They do not say: "ohh, it looks a bit childish, lets read what others think about it and how cool the gameplay is".<br><br>Our eyes and ears are what comes first when looking pictures or watching videos. If the game looks "boring" it does not matter how much flexibility the game adds in later stages of a game, how much freedom you have.<br><br>These things are only important once you have some people with "powerful words of mouth"-skills (some famous lets players or so).<br><br>----<br><br>While prototyping these "wip" graphics are OK but still you should never forget that there are "basic skills" which should be existing in the wip-assets already: things like (nearly) consistent palettes or consistent art style.<br>As Matty is drawing them "all alone" the art style should be consistent/coherent - at least "icons versus icons".<br><br><br>@ Matty<br>Did you try a digital painting app (Autodesk Sketchbook was what I proposed). You will surely like how it removes the "jitter" from onces hand drawn lines. Some might not like it - I think it perfectly fits to vector-esque drawings.<br><br><br>@ Dungeon crawlers<br>Yes, there is plenty of them. So similar to the "water color" you/the "collaborative collection" should consider some distinctive feature, a "USP".<br>Eg. there could be some kind of levels/floors and on each movement or in certain situations tiles move up and down (z-value) or x/y.<br>I cannot think of a "reason" why it should behave that way but maybe it is interesting?!<br>Or something like tile-groups YOU have to add when exploring - so you add eg. 3x3 tiles - with all the bonus/malus they have.<br>So while the system generates some basic game, YOU create the details.<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1340984"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#34">[#34]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks folks...I've put together a prototype on my mobile phone but I don't like the gameplay that much...I think I'm going to revisit the gameplay...the method I had in place doesn't really inspire all that much...<br><br>and oh - I am going to redo the graphics...here is a wip of where I was going with the drawings before I temporarily gave up for a moment....<br><br><img src="http://mattiesgames.com/gfx/characters1.png"> <br><br></td></tr></table><br>
<a name="1340985"></a>

<a name="1340986"></a>

<a name="1340987"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#35">[#35]</a></td></tr></table></td></tr><tr ><td class="posttext"> What about doing this "blob"-style? And then of course do the same for the world/environment. Even spells could be "blob-based".<br><br>Blob means having a base for all your art - and it should automatically look more consistent.<br><br><br>While your drawings show creativity (what do they wear, how do they pose ...) they do not look very similar. So some of the units have visible "feet/shoes" and some do not have that detailled feet.<br>If you draw digitally, you could easily use your "creative sketches" as a basement. Decrease opacity to 25% and on a new layer, draw your corrections ... do that until it suits your needs and the image in your mind - and your brain which knows more about proportions than your "sketch mind" (drawing here and there and adding this and that.... dunno how to describe that better).<br>Afterwards you add a new layer doing your fine outline.<br><br>Of course this goes away from the "sketch look". In your case the "outline"-only units look more interesting than the colored ones. Dunno how to emphasize the units on a similar styled background (only outlines too) but it might be something interesting to look at - maybe some "cut out"-style like in the screenshot Adam linked to:<br><br><img src="http://indiegames.com/2015/06/02/cardd_2.jpg"><br><br>I mean, as if the units were drawn by someone, hastily cut out to to fight the enemy of is nightmare in a "come to live" boardgame. Hmm this sounds pretty interesting. So let's think about that some phrases longer.<br><br>Imagine you get a witched board game ... and a sheet of paper stating: this board is the only way  to rescue the world. It is full of magic and things you have drawn will come to live and fight for their live. But dare you to only draw good things, the game will judge your soul. If you do not also create ugly monsters and dangerous traps you and mindkind will die a cruelful death.<br>You scrap that paper and ignore it until you go sleeping that night. It was a nightmare of a dream and then you "wake up". Glowing lights outside the window and a dark voice talking to you in your head ...only in your head. "DRAW".<br>You start drawing these ugly monsters and units and suddenly they come alive, your hero is swinging his "insert start weapon".<br>You begin drawing for your live ... and the lives of every human being....<br><br>(sorry for the stupid story... I did not brainstorm before, just thinking-typing-thinking) <br><br><br>Gameplay ideas: As the world lives from your drawings, your "spells" should resample that idea: eg. items could contain "1 time spells" like "paint bridge" which allows to cross a river of melted stones...<br><br>To make things "strict" that "voice" could disallow cheating spells ("burn all enemies"). <br><br>This thing could be called "Paper Dungeon" (or - pun intended - "Draw Commander"). Even "DrawQuest" could sound nice.<br><br>Ok, back to gameplay ideas: The board was given by the "voice" so the scenery is defined before - but with certain spells you could replace "tiles". Maybe you only get these 1-time-spells when defeating certain bosses. So "ultra hard" tiles - or not "crossable ones" could get replaced by easier ones.<br><br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1340988"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AdamStrange</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#36">[#36]</a></td></tr></table></td></tr><tr ><td class="posttext"> the new monsters have a 'quality' about them. I love the idea of this being line drawing and then you paint them. don't know how it would work, but there is something interesting in there.<br><br>Also think that the cutout style could work very well. the colouring concept is pure genius ;)<br><br>Their is now a sort of child-like feel to the graphics. You could be in a childs nightmare <br><br></td></tr></table><br>
<a name="1340992"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#37">[#37]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay...not what you were expecting but I'm thinking a kind of arcade combat mode that has at its heart a system that is something like the below (blitz3d/blitzplus code)<br><br>Left click on the window to move to that location...units auto fight and auto shoot fireballs.....<br><br>Imagine a maze overlaid over this, a single screen to move around on like an arena, powerups and pickups and instead of dots proper character models and so on....this was put together in the twenty minutes I spent downloading windows updates for my PC that hasn't been updated since 2015!<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
;;sample prototype of gameplay idea
Graphics 1280,720,0,2
SetBuffer BackBuffer()
Type pc
Field x#
Field y#
Field cat ;0 fighter, 1 wizard, 2 healer, 3 monster
Field tx#
Field ty#
Field hp
End Type

Type bullet
Field x#
Field y#
Field vx#
Field vy#
Field life
End Type 

Global fighter.pc
Global ranger.pc
Global wizard.pc
Global cleric.pc

fighter.pc = New pc
fighter\cat = 0
fighter\x = 600
fighter\y = 300
fighter\tx = fighter\x
fighter\ty = fighter\y
fighter\hp = 10

ranger.pc = New pc
ranger\cat = 0
ranger\x = 610
ranger\y = 300
ranger\tx = ranger\x
ranger\ty = ranger\y
ranger\hp = 8

wizard.pc = New pc
wizard\cat = 1
wizard\x = 600
wizard\y = 320
wizard\tx = wizard\x
wizard\ty = wizard\y
wizard\hp = 4

cleric.pc = New pc
cleric\cat = 2
cleric\x = 610
cleric\y = 320
cleric\tx = cleric\x
cleric\ty = cleric\y
cleric\hp = 6

Function spawn()
monster.pc = New pc
monster\cat = 3
monster\hp = 2

q = Rand(1,4)
Select q
Case 1
	monster\y = 0
	monster\x = Rand(0,1280)
Case 2
	monster\y = 720
	monster\x = Rand(0,1280)
Case 3
	monster\x = 0
	monster\y = Rand(0,720)
Case 4
	monster\x = 1280
	monster\y = Rand(0,720)
End Select
monster\tx = monster\x
monster\ty = monster\y
End Function 

Repeat
time = MilliSecs()
Cls
If time &gt; otime Then 
	otime = time + 500
	spawn()
EndIf 
updategame()
drawgame()
Flip
dtime = MilliSecs()-time
If dtime&lt;15 Then 
	Delay 15-dtime
EndIf 
Until KeyDown(1)
End

Function drawgame()
For pc.pc = Each pc
	If pc\hp &gt; 0 Then 
		Select pc\cat
		Case 0
			Color 255,0,0
			name$ = "ftr"
		Case 1
			Color 255,0,255
			name$ = "wiz"
		Case 2
			Color 0,255,255
			name$ = "clr"
		Case 3
			Color 192,192,192
			name$ = "mon"
		End Select
		Oval pc\x,pc\y,6,6,1
		If pc\cat&lt;3 Then Text pc\x,pc\y-20,name+":"+pc\hp,1,1
	EndIf
Next
Color 255,255,0
For b.bullet = Each bullet
	Oval b\x,b\y,2,2,1
Next
End Function

Function updategame()
mx = MouseX()
my = MouseY()
lmb = MouseDown(1)
For pc.pc = Each pc
	If pc\cat&lt;3 Then 
		If lmb Then 
			pc\tx = mx
			pc\ty = my
		EndIf 
	Else
		If fighter\hp &gt; 0 Then 
			pc\tx = fighter\x
			pc\ty = fighter\y
		EndIf
		If ranger\hp &gt; 0 Then 
			pc\tx = ranger\x
			pc\ty = ranger\y
		EndIf
		If cleric\hp &gt; 0 Then 
			pc\tx = cleric\x
			pc\ty = cleric\y
		EndIf
		If wizard\hp &gt; 0 Then 
			pc\tx = wizard\x
			pc\ty = wizard\y
		EndIf 
	EndIf
	dx = Sgn(pc\tx-pc\x)
	dy = Sgn(pc\ty-pc\y)
	nx = pc\x+dx
	ny = pc\y+dy
	bump = False
	For a.pc = Each pc
		If a&lt;&gt;pc And a\hp &gt; 0 Then 
			If Abs(nx-a\x)&lt;6 And Abs(ny-a\y)&lt;6 Then 
				bump = True
				If a\cat&gt;2 And pc\cat&lt;3 Then 
					a\hp=a\hp-1
				EndIf	
				If a\cat&lt;3 And pc\cat=3 Then 
					If Rand(0,100)&lt;10 Then 	pc\hp=pc\hp - 1
				EndIf 
			EndIf 
		EndIf 
	Next
	If bump = False Then 
		pc\x = nx
		pc\y = ny
	EndIf
	If pc=cleric And pc\hp &gt; 0 Then
		If fighter\hp &lt; 4 And fighter\hp &gt; 0 And Rand(0,100)&lt;4 Then 
			fighter\hp = fighter\hp + 1
		EndIf 
		If ranger\hp &lt; 4 And ranger\hp &gt; 0 And Rand(0,100)&lt;4 Then 
			ranger\hp = ranger\hp + 1
		EndIf 
		If wizard\hp &lt; 2 And wizard\hp &gt; 0 And Rand(0,100)&lt;4 Then 
			wizard\hp = wizard\hp + 1
		EndIf 

	EndIf
	If pc=wizard And pc\hp &gt; 0 And Rand(0,100)&lt;2 Then 
		For a.pc = Each pc
			If a\cat=3 And a\hp&gt;0 Then 
				b.bullet = New bullet
				b\x = pc\x
				b\y = pc\y
				b\vx = Float(a\x - pc\x) / 50.0
				b\vy = Float(a\y - pc\y) / 50.0
				b\life = 50
				Exit
			EndIf
		Next
	EndIf 
Next 
For b.bullet = Each bullet
	b\x = b\x + b\vx
	b\y = b\y + b\vy
	b\life = b\life - 1
	For a.pc = Each pc
		If a\cat = 3 And a\hp &gt; 0 Then 
			If Abs(b\x-a\x)&lt;10 And Abs(b\y-a\y)&lt;10 Then 
				b\life = -1
				Delete a
			EndIf 
		EndIf 
	Next
	If b\life &lt; 0 Then Delete b
Next
End Function 
</textarea> <br><br></td></tr></table><br>
<a name="1341003"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rooster</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#38">[#38]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Matty<br>I took a stab at porting the code you posted to BMax, for anyone who wants it. I don't know if it is 100% accurate though.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
''sample prototype of gameplay idea
Graphics 1280,720,0,2
'SetBuffer BackBuffer()
Type pc
Field x#
Field y#
Field cat '0 fighter, 1 wizard, 2 healer, 3 monster
Field tx#
Field ty#
Field hp
End Type

Type bullet
Field x#
Field y#
Field vx#
Field vy#
Field life
End Type 

Global list_objects:TList=New TList

Global fighter:pc
Global ranger:pc
Global wizard:pc
Global cleric:pc

fighter:pc = New pc
fighter.cat = 0
fighterx = 600
fighter.y = 300
fighter.tx = fighter.x
fighter.ty = fighter.y
fighter.hp = 10
list_objects.AddLast fighter

ranger:pc = New pc
ranger.cat = 0
ranger.x = 610
ranger.y = 300
ranger.tx = ranger.x
ranger.ty = ranger.y
ranger.hp = 8
list_objects.AddLast ranger

wizard:pc = New pc
wizard.cat = 1
wizard.x = 600
wizard.y = 320
wizard.tx = wizard.x
wizard.ty = wizard.y
wizard.hp = 4
list_objects.AddLast wizard

cleric:pc = New pc
cleric.cat = 2
cleric.x = 610
cleric.y = 320
cleric.tx = cleric.x
cleric.ty = cleric.y
cleric.hp = 6
list_objects.AddLast cleric

Function spawn()
monster:pc = New pc
monster.cat = 3
monster.hp = 2

q = Rand(1,4)
Select q
Case 1
	monster.y = 0
	monster.x = Rand(0,1280)
Case 2
	monster.y = 720
	monster.x = Rand(0,1280)
Case 3
	monster.x = 0
	monster.y = Rand(0,720)
Case 4
	monster.x = 1280
	monster.y = Rand(0,720)
End Select
monster.tx = monster.x
monster.ty = monster.y

list_objects.AddLast monster
End Function 

Repeat
time = MilliSecs()
Cls
If time &gt; otime Then 
	otime = time + 500
	spawn()
EndIf 
updategame()
drawgame()
Flip
dtime = MilliSecs()-time
If dtime&lt;15 Then 
	Delay 15-dtime
EndIf 
Until KeyDown(1)
End

Function drawgame()
For character:pc = EachIn list_objects
	If character.hp &gt; 0 Then 
		Select character.cat
		Case 0
			SetColor 255,0,0
			name$ = "ftr"
		Case 1
			SetColor 255,0,255
			name$ = "wiz"
		Case 2
			SetColor 0,255,255
			name$ = "clr"
		Case 3
			SetColor 192,192,192
			name$ = "mon"
		End Select
		DrawOval character.x,character.y,6,6',1
		If character.cat&lt;3 Then DrawText name+":"+character.hp,character.x,character.y-20
	EndIf
Next
SetColor 255,255,0
For b:bullet = EachIn list_objects
	DrawOval b.x,b.y,2,2',1
Next
SetColor 255,255,255
End Function

Function updategame()
mx = MouseX()
my = MouseY()
lmb = MouseDown(1)
For character:pc = EachIn list_objects
	If character.cat&lt;3 Then 
		If lmb Then 
			character.tx = mx
			character.ty = my
		EndIf 
	Else
		If fighter.hp &gt; 0 Then 
			character.tx = fighter.x
			character.ty = fighter.y
		EndIf
		If ranger.hp &gt; 0 Then 
			character.tx = ranger.x
			character.ty = ranger.y
		EndIf
		If cleric.hp &gt; 0 Then 
			character.tx = cleric.x
			character.ty = cleric.y
		EndIf
		If wizard.hp &gt; 0 Then 
			character.tx = wizard.x
			character.ty = wizard.y
		EndIf 
	EndIf
	dx = Sgn(character.tx-character.x)
	dy = Sgn(character.ty-character.y)
	nx = character.x+dx
	ny = character.y+dy
	bump = False
	For a:pc = EachIn list_objects
		If a&lt;&gt;character And a.hp &gt; 0 Then 
			If Abs(nx-a.x)&lt;6 And Abs(ny-a.y)&lt;6 Then 
				bump = True
				If a.cat&gt;2 And character.cat&lt;3 Then 
					a.hp=a.hp-1
				EndIf	
				If a.cat&lt;3 And character.cat=3 Then 
					If Rand(0,100)&lt;10 Then 	character.hp=character.hp - 1
				EndIf 
			EndIf 
		EndIf 
	Next
	If bump = False Then 
		character.x = nx
		character.y = ny
	EndIf
	If character=cleric And character.hp &gt; 0 Then
		If fighter.hp &lt; 4 And fighter.hp &gt; 0 And Rand(0,100)&lt;4 Then 
			fighter.hp = fighter.hp + 1
		EndIf 
		If ranger.hp &lt; 4 And ranger.hp &gt; 0 And Rand(0,100)&lt;4 Then 
			ranger.hp = ranger.hp + 1
		EndIf 
		If wizard.hp &lt; 2 And wizard.hp &gt; 0 And Rand(0,100)&lt;4 Then 
			wizard.hp = wizard.hp + 1
		EndIf 

	EndIf
	If character=wizard And character.hp &gt; 0 And Rand(0,100)&lt;2 Then 
		For a:pc = EachIn list_objects
			If a.cat=3 And a.hp&gt;0 Then 
				b:bullet = New bullet
				b.x = character.x
				b.y = character.y
				b.vx = Float(a.x - character.x) / 50.0
				b.vy = Float(a.y - character.y) / 50.0
				b.life = 50
				Exit
			EndIf
		Next
	EndIf 
Next 
For b:bullet = EachIn list_objects
	b.x = b.x + b.vx
	b.y = b.y + b.vy
	b.life = b.life - 1
	For a:pc = EachIn list_objects
		If a.cat = 3 And a.hp &gt; 0 Then 
			If Abs(b.x-a.x)&lt;10 And Abs(b.y-a.y)&lt;10 Then 
				b.life = -1
				ListRemove( list_objects,a)
			EndIf 
		EndIf 
	Next
	If b.life &lt; 0 Then ListRemove( list_objects,b) 
Next
End Function 
</textarea><br><br>@Derron <br>The idea of the game being a nightmare of some kind sounds cool. <br><br></td></tr></table><br>
<a name="1341006"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#39">[#39]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Rooster.  I'm thinking I have an idea..I'll write in bplus b3d code and it can be ported to bmax as we go.  I'll create the graphics and post 5hem here as I do them and it can kind of be a community project of sorts but will mostly be lead by my work initially.  <br><br>So this thread will kind of become a worklog that shows the development of a game code and graphics. <br><br></td></tr></table><br>
<a name="1341012"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rooster</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#40">[#40]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> but will mostly be lead by my work initially.  <br></div><br>I hope we will still be able to contribute code.<br><br>Speaking of which, I put together a function for loading all the games images.<br><br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Function Load_All_Images (i:TImage [] Var)
Local in
Local a$ []
Local sizea =0
Local b
Local sort$ []
Local temp$ []

'opens the image folder
 in = ReadDir ("Images")
 Repeat 
  'gets the name of the next file
   a = a[..sizea+1]
   a [sizea] = NextFile$ (in)
  'checks to see if "a" has a file name, 
  'if "a" is blank the loop is exited
   If a [sizea] =""
     b =1
     sizea:-1
     a =a [..sizea+1]
   ElseIf a [sizea] =".." Or a [sizea] ="."
     a =a [..sizea]
   Else
     sizea:+1
   EndIf

 Until b =1
 CloseDir (in)

'sorts the file names into numerical order
 sort = sort [..sizea+1]
 For b=0 To sizea
   temp = a[b].Split("-")
   sort [Int(temp [0])-1] =a[b]
 Next

'loads the all the images
 i= i [..sizea+1]
 For b =0 To sizea
   i [b] = LoadImage ("Images\"+sort [b])
 Next
 
End Function
</textarea><br><br>The images are sorted so that you could give anything that needs them a "kind" field.<br>I hope this isn't overly messy, and helps some. <br><br></td></tr></table><br>
<a name="1341016"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#41">[#41]</a></td></tr></table></td></tr><tr ><td class="posttext"> When I finish work I'm going to come up with a code skeleton for how I see this game taking shape...<br><br>At this stage I won't be using any images or sounds or media - but they will be in the finished product...<br><br>But as a thought what I'm going to develop will be something along the lines of the following:<br><br>Gameplay action sequence similar to above demo (loosely based on it)<br>In between each gameplay action sequence is a series of images/text that are like static cinematic displays...<br>After each actions sequence the player will be able to level up their characters by incrementing some relevant stats on each of them.<br><br>I'm thinking code structure will be something along the lines of:<br><pre class=code>
CONSTS
Globals
Dims
Data Types
main()
     init()
     loop()
          if gamemode = menu
              ;do stuff
          if gamemode = actionscene
              ;do stuff
          if gamemode  = levelup
              ;do stuff
          if gamemode = staticcinematic
               ;do stuff
          ;any extra gamemodes go here (potentially some mini games of various sorts also built in
  
 </pre> <br><br></td></tr></table><br>
<a name="1341029"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#42">[#42]</a></td></tr></table></td></tr><tr ><td class="posttext"> Framework for code in more detail...<br><br>hopefully I/we can start filling this in...the basic design brief is in the comments of the code<br><br>Happy to answer questions if there is any confusion.....<br><br><br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
;This is both a learning exercise and hopefully a collaborative project of sorts
;or at least a project I can share with others on the blitz forum.
;It will be written initially in blitzplus/blitz3d and maybe someone will be keen on
;porting it to blitzmax...even blitzmax-ng to release on mobile perhaps?
;
;Interface:
;Left mouse button clicking only to make porting to 
;mobile interface much, much easier.
;Gameplay mechanic so far (15-May-2017)
;
;1. Arcade Action RPG Combat
;	Player controls 4 characters in a single screen dungeon.
;	Dungeon has a few walls and so on that prevent movement.
;	Monsters spawn from spawners and make their way around the map
;	Player taps the screen to move to location and characters fight things
;	in their path.
;	Powerups exist in the level such as:
;	Health pickups
;	Bombs - kill all monsters that have spawned or at least damage them.
;	
;2. After the arcade sequence the player is presented with options to upgrade their
;	character's stats. Stats to upgrade include:
;	Combat skill ('to hit roll')
;	Damage output ('damage points')
;	Health points ('hp')
;	Movement speed ('move')
;3.	After this a short cut scene is presented which may simply be a scrolling static
;	image with some fading in/fading out text to advance the story line
;0. Menu - toggle audio, play, credits
;
;Character types:
;1 Fighter - high hitpoint melee combat medium damage
;2 Ranger - medium hitpoint melee combat high damage
;3 Wizard - low hitpoint, ranged combat, medium damage
;4 Cleric - medium hitpoint, no combat, healer
;


;constants
Const SW=1280,SH=720,WIN=2
Const MODE_MENU = 0
Const MODE_COMBAT = 1
Const MODE_UPGRADE = 2
Const MODE_CUTSCENE = 3
Const PURE_2D = True ;if go to blitzmax can use 2d-in-3d commands such as alpha otherwise have to calculate manually.Change to false for blitzmax.

;categories for image types and object types
Const CAT_MENU_PLAY = 0
Const CAT_MENU_AUDIO = 1
Const CAT_MENU_SKIP_CUTSCENE = 2 ;cut scene mode
Const CAT_MENU_ADD_SKILL = 3 ;upgrade mode
Const CAT_MENU_ADD_DAMAGE = 4;upgrade mode
Const CAT_MENU_ADD_HEALTH = 5;upgrade mode
Const CAT_MENU_ADD_SPEED = 6;
Const CAT_MENU_MOUSE_CURSOR = 7;
Const CAT_FIGHTER = 10
Const CAT_RANGER = 11
Const CAT_WIZARD = 12
Const CAT_CLERIC = 13
Const CAT_HEALTH_PICKUP = 20
Const CAT_BOMB_PICKUP = 21
;CAT_BACKGROUND = 2000-3000 ; all the different image backgrounds
;CAT_MONSTER = 100-1000 , all the different monster types

;globals
Global mx,my,lmb,olmb ;mouse input
Global audiostate ;on/off
Global gamemode ;references const above
Global gamelevel ;for cutscenes
Global cutsceneframe ;for cutscenes ie trigger fades, text, motion etc on certain frames

;arrays
Dim wallmap(0,0) ;0/1 value at each element indicates whether wall is there or not - redimension later

;types
Type images

Field img ;handle
Field midhandled ;boolean
Field cat ;category //hooks into creature template

End Type 

Type creaturetemplate

Field img ;img handle
Field cat ;category
Field fullhp ;n (values range from about 10 to 200 for high level characters and monsters)
Field combatskill ;1-1000 (percentile out of a 1000 not 100) (roll under to hit/roll under to cast)
Field speed# ;n.m (movement speed)
Field damage ;n (damage per hit, also equal to hitpoints to heal per successful cast)

End Type 

Type bullet

Field img ;handle of image
Field team ;players or monsters - so no friendly fire
Field x#
Field y#
Field vx#
Field vy#
Field life
Field damage ;damage to inflict per hit then disappear

End Type

Type spawner

Field img
Field cat ;category to spawn
Field x
Field y
Field hp
Field timetospawn ;frames to count down from when respawning
Field spawndelay ;current frame count on spawner 0 to 'timetospawn'.

End Type 

Type creature

Field img
Field cat
Field x#
Field y#
Field tx#
Field ty#
Field hp

End Type 

Type menubutton

Field cat ;for menu buttons
Field img
Field x
Field y
Field w
Field h
Field state ;pressed/not pressed

End Type 

Type cutscene

Field cat
Field img
Field x
Field y
Field levelnum ;for the specific level num
Field upperframe ;for the upper limit on the frame number to show this image for
Field transitiontype ;define later for transitioning between frames...do all this in code 

End Type 

main()

Function main()
	quit = False
	gamemode = MODE_MENU
	init()
	Repeat
		frametime = MilliSecs()
		Cls
		;input 
		mx = MouseX()
		my = MouseY()
		olmb = lmb
		lmb = MouseDown(1)
		Select gamemode
		
		Case MODE_MENU
			handlemenu()
			drawmenu()		
		Case MODE_COMBAT
			handleinput()
			updategame()
			drawgame()
		Case MODE_CUTSCENE
			handlecutscene()
			drawcutscene()
		Case MODE_UPGRADE
			handleupgrade()
			drawupgrade()
		End Select
		
		Flip
		;very basic frame limiting
		endframetime = MilliSecs()
		dtime = endframetime - frametime
		If dtime &lt; 15 Then 
			Delay 15 - dtime
		EndIf 
		;end of frame limiting
	Until quit
	;;;;;;
	End
End Function 

Function init()
Graphics SW,SH,0,WIN
;load all images here
;load all sounds here
;load all music here

End Function 

Function handlemenu()
;;;
;;;;
;;;Check if 'PLAY' pressed..if so then initialise
;first cut scene and change gamemode
;;;Check if 'TOGGLE AUDIO' pressed if so toggle music/audio flags


End Function

Function drawmenu()
;draw backdrop
;draw buttons in relevant state
;draw mouse cursor

End Function

Function handleinput()
;assign tx,ty of creatures to player units
;

End Function

Function updategame()
;move all creatures
;move all bullets
;handle all collisions
;handle all pick ups
;handle all combat
;handle all spell casting (magic missiles and healing)


End Function

Function drawgame()
;draw background (fixed static 1280x720 image background)
;draw all creatures - don't worry about zordering them - it will be too fast to notice 
;draw all bullets


End Function 

Function handlecutscene()
;handle transitions,  handle skip button; 
;handle fading in and out text (bitmap fonts?)

End Function 

Function drawcutscene()
;draw cut scene background, draw transition, draw skip button

End Function 

Function handleupgrade()
;handle button press 'add stuff' to characters
;
;
;
End Function

Function drawupgrade()
;draw background
;draw buttons
;draw characters
;draw stats
;draw continue button

End Function 

</textarea> <br><br></td></tr></table><br>
<a name="1341032"></a>

<a name="1341033"></a>

<a name="1341034"></a>

<a name="1341035"></a>

<a name="1341039"></a>

<a name="1341040"></a>

<a name="1341041"></a>

<a name="1341042"></a>

<a name="1341091"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#43">[#43]</a></td></tr></table></td></tr><tr ><td class="posttext"> Character - Knight/Fighter<br><br><img src="http://www.mattiesgames.com/art/knight1.png"><br><br>Character - Ranger/hunter<br><br><img src="http://www.mattiesgames.com/art/ranger1.png"><br><br>Character - Wizard<br><br><img src="http://www.mattiesgames.com/art/wizard1.png"><br><br>Character - Cleric / Healer<br><br><img src="http://www.mattiesgames.com/art/cleric1.png"><br><br>I just drew these after work tonight.  Used some references from google images for ideas.<br><br>Edit - some more before bed...<br><br>Monster - Goblin 1<br><br><img src="http://www.mattiesgames.com/art/goblin1.png"><br><br>Monster - Goblin 2<br><br><img src="http://www.mattiesgames.com/art/goblin2.png"> <br><br></td></tr></table><br>
<a name="1341047"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mainsworthy</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#44">[#44]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Rooster I like that Loader<br><br>@matty, the art is far more impresive <br><br></td></tr></table><br>
<a name="1341102"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rooster</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#45">[#45]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Matty<br>Looking good! The knight look a little on the blurry side, but I really like the wizard. <br><br>@Mainsworthy<br>Thank you! =D <br><br></td></tr></table><br>
<a name="1341117"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Steve Elliott</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#46">[#46]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm a big fan of the rough sketch and 'water colour' look.  The only problem is I don't think they would suit this type of game - characters have to be large or they don't scale-down well.<br><br>This is a good example:<br><br><a href="http://www.blitzbasic.com/gallery/view_pic.php?id=1579&amp;gallery=hr&amp;page=11" target="_blank">http://www.blitzbasic.com/gallery/view_pic.php?id=1579&amp;gallery=hr&amp;page=11</a> <br><br></td></tr></table><br>
<a name="1341118"></a>

<a name="1341120"></a>

<a name="1341122"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#47">[#47]</a></td></tr></table></td></tr><tr ><td class="posttext"> Quick first pass prototype:<br><br>Run in blitz3d or blitzplus - press f5, use mouse to interact....this is just a beginning of sorts.<br><br>code:<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
;This is both a learning exercise and hopefully a collaborative project of sorts
;or at least a project I can share with others on the blitz forum.
;It will be written initially in blitzplus/blitz3d and maybe someone will be keen on
;porting it to blitzmax...even blitzmax-ng to release on mobile perhaps?
;
;Interface:
;Left mouse button clicking only to make porting to 
;mobile interface much, much easier.
;Gameplay mechanic so far (15-May-2017)
;
;1. Arcade Action RPG Combat
;	Player controls 4 characters in a single screen dungeon.
;	Dungeon has a few walls and so on that prevent movement.
;	Monsters spawn from spawners and make their way around the map
;	Player taps the screen to move to location and characters fight things
;	in their path.
;	Powerups exist in the level such as:
;	Health pickups
;	Bombs - kill all monsters that have spawned or at least damage them.
;	
;2. After the arcade sequence the player is presented with options to upgrade their
;	character's stats. Stats to upgrade include:
;	Combat skill ('to hit roll')
;	Damage output ('damage points')
;	Health points ('hp')
;	Movement speed ('move')
;3.	After this a short cut scene is presented which may simply be a scrolling static
;	image with some fading in/fading out text to advance the story line
;0. Menu - toggle audio, play, credits
;
;Character types:
;1 Fighter - high hitpoint melee combat medium damage
;2 Ranger - medium hitpoint melee combat high damage
;3 Wizard - low hitpoint, ranged combat, medium damage
;4 Cleric - medium hitpoint, no combat, healer
;


;constants
Const SW=1280,SH=720,WIN=2
Const MODE_MENU = 0
Const MODE_COMBAT = 1
Const MODE_UPGRADE = 2
Const MODE_CUTSCENE = 3
Const PURE_2D = True ;if go to blitzmax can use 2d-in-3d commands such as alpha otherwise have to calculate manually.Change to false for blitzmax.

;categories for image types and object types
Const CAT_MENU_PLAY = 0
Const CAT_MENU_AUDIO = 1
Const CAT_MENU_SKIP_CUTSCENE = 2 ;cut scene mode
Const CAT_MENU_ADD_SKILL = 3 ;upgrade mode
Const CAT_MENU_ADD_DAMAGE = 4;upgrade mode
Const CAT_MENU_ADD_HEALTH = 5;upgrade mode
Const CAT_MENU_ADD_SPEED = 6;
Const CAT_MENU_MOUSE_CURSOR = 7;
Const CAT_FIGHTER = 10
Const CAT_KNIGHT = 10 ;synonym
Const CAT_RANGER = 11
Const CAT_WIZARD = 12
Const CAT_CLERIC = 13
Const CAT_HEALER = 13 ;synonym
Const CAT_HEALTH_PICKUP = 20
Const CAT_BOMB_PICKUP = 21
;CAT_BACKGROUND = 2000-3000 ; all the different image backgrounds
;CAT_MONSTER = 100-1000 , all the different monster types

Const AI_WANDER = 0
Const AI_ATTACK = 1

Const TEAM_PLAYER = 0
Const TEAM_MONSTER = 1

;globals
Global mx,my,lmb,olmb ;mouse input
Global audiostate ;on/off
Global gamemode ;references const above
Global gamelevel ;for cutscenes
Global cutsceneframe ;for cutscenes ie trigger fades, text, motion etc on certain frames

;arrays
Dim wallmap(0,0) ;0/1 value at each element indicates whether wall is there or not - redimension later

;types
Type images

Field img ;handle
Field midhandled ;boolean
Field cat ;category //hooks into creature template

End Type 

Type creaturetemplate

Field img ;img handle
Field cat ;category
Field fullhp ;n (values range from about 10 to 200 for high level characters and monsters)
Field combatskill ;1-1000 (percentile out of a 1000 not 100) (roll under to hit/roll under to cast)
Field speed# ;n.m (movement speed)
Field damage ;n (damage per hit, also equal to hitpoints to heal per successful cast)

End Type 

Type bullet

Field img ;handle of image
Field team ;players or monsters - so no friendly fire
Field x#
Field y#
Field vx#
Field vy#
Field life
Field damage ;damage to inflict per hit then disappear

End Type

Type spawner

Field img
Field cat ;category to spawn
Field x
Field y
Field hp
Field timetospawn ;frames to count down from when respawning
Field spawndelay ;current frame count on spawner 0 to 'timetospawn'.

End Type 

Type creature

Field img
Field cat
Field x#
Field y#
Field tx#
Field ty#
Field hp
Field fullhp
Field speed#
Field damage
Field skill


Field aimode
Field aidelay
Field aitime

Field moving ;boolean

Field healingtime ;for healing effect/buff effect

End Type 

Type menubutton

Field cat ;for menu buttons
Field img
Field x
Field y
Field w
Field h
Field state ;pressed/not pressed

End Type 

Type cutscene

Field cat
Field img
Field x
Field y
Field levelnum ;for the specific level num
Field upperframe ;for the upper limit on the frame number to show this image for
Field transitiontype ;define later for transitioning between frames...do all this in code 

End Type 

main()

Function main()
	quit = False
	gamemode = MODE_MENU
	init()
	Repeat
		frametime = MilliSecs()
		Cls
		;input 
		mx = MouseX()
		my = MouseY()
		olmb = lmb
		lmb = MouseDown(1)
		Select gamemode
		
		Case MODE_MENU
			handlemenu()
			drawmenu()
		
		Case MODE_COMBAT
			handleinput()
			updategame()
			drawgame()
		Case MODE_CUTSCENE
			handlecutscene()
			drawcutscene()
		Case MODE_UPGRADE
			handleupgrade()
			drawupgrade()
		End Select
		
		Flip
		;very basic frame limiting
		endframetime = MilliSecs()
		dtime = endframetime - frametime
		If dtime &lt; 15 Then 
			Delay 15 - dtime
		EndIf 
		;end of frame limiting
		If(KeyHit(1)) Then quit = True		
	Until quit
	;;;;;;
	End
End Function 

Function init()
Graphics SW,SH,0,WIN
;load all images here
;load all sounds here
;load all music here
HidePointer 
img.images = New images
img\img = LoadImage("images\knight1.png")
img\cat = CAT_FIGHTER

img.images = New images
img\img = LoadImage("images\ranger1.png")
img\cat = CAT_RANGER

img.images = New images
img\img = LoadImage("images\wizard1.png")
img\cat = CAT_WIZARD

img.images = New images
img\img = LoadImage("images\cleric1.png")
img\cat = CAT_CLERIC

img.images = New images
img\img = LoadImage("images\goblin1.png")
img\cat = 100 ;goblin 1

img.images = New images
img\img = LoadImage("images\goblin2.png")
img\cat = 101 ;goblin 2


img.images = New images
img\img = LoadImage("images\btnplay.png")
img\cat = CAT_MENU_PLAY

img.images = New images
img\img = LoadImage("images\btnaudio.png")
img\cat = CAT_MENU_AUDIO

img.images = New images
img\img = LoadImage("images\cursor.png")
img\cat = CAT_MENU_MOUSE_CURSOR

img.images = New images
img\img = LoadImage("images\btnskip.png")
img\cat = CAT_MENU_SKIP_CUTSCENE

;we don't have backgrounds yet so create them on the fly for now
img.images = New images
img\img = CreateImage(SW,SH)
SetBuffer ImageBuffer(img\img)
For i = 1 To 100
	Color 100,100,100
	Oval Rand(SW),Rand(SH),100,100,1
Next
SetBuffer BackBuffer()
img\cat = 2000

End Function 

Function handlemenu()
;;;
;;;;
;;;Check if 'PLAY' pressed..if so then initialise
;first cut scene and change gamemode
;;;Check if 'TOGGLE AUDIO' pressed if so toggle music/audio flags

If lmb&lt;&gt;0 Then 
	If mx&gt;=1000 And mx&lt;=1200 Then 
		If my&gt;500 And my&lt;550 Then 
			;play hit
			initstartgame()
			gamemode = MODE_CUTSCENE
		EndIf 
		If my&gt;600 And my&lt;650 Then 
			audiostate = Not audiostate
			If Not audiostate
				;stop music
					
			EndIf 
		EndIf 
	EndIf 
EndIf 


End Function

Function drawmenu()
;draw backdrop
;draw buttons in relevant state
;draw mouse cursor

For img.images = Each images
	If img\cat = 2000 Then 
		DrawBlock img\img,0,0
	EndIf 
Next

For img.images = Each images
	If img\cat = CAT_MENU_PLAY
		DrawImage img\img,1000,500
	EndIf
	If img\cat = CAT_MENU_AUDIO
		DrawImage img\img,1000,600
	EndIf
Next

For img.images = Each images
	If img\cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img\img,mx,my
	EndIf
Next

End Function

Function handleinput()
;assign tx,ty of creatures to player units
;
If lmb&lt;&gt;0 Then 
	For pc.creature = Each creature
		If pc\hp&gt;0 And pc\cat&gt;=10 And pc\cat&lt;=13 Then 
			pc\tx = mx + (pc\cat Mod 2) * 30
			pc\ty = my + ((pc\cat - 10)/2) * 60
		EndIf 
	Next
EndIf 


End Function

Function updategame()
;move all creatures
;move all bullets
;handle all collisions
;handle all pick ups
;handle all combat
;handle all spell casting (magic missiles and healing)


For pc.creature = Each creature
	If pc\hp&gt;0 Then 
		If pc\cat &gt;= 100 Then 
			pc\aidelay=pc\aidelay-1
			switchon = False
			If pc\aidelay&lt;=0 Then 
				pc\aidelay = pc\aitime
				pc\aimode = Rand(-2,3)
				If pc\aimode &lt; 0 Then pc\aimode = 0
				If pc\aimode &gt; 1 Then pc\aimode = 1
				switchon = True
			EndIf 
			If pc\aimode = AI_WANDER Then 
					If switchon
						pc\tx = Rand(-600,600)+pc\x
						pc\ty = Rand(-600,600)+pc\y
						If pc\tx &lt; 0 Then pc\tx = 0
						If pc\ty &lt; 0 Then pc\ty = 0
						If pc\tx &gt; SW - 1 Then pc\tx = SW-1
						If pc\ty &gt; SH - 1 Then pc\tx = SH-1
					EndIf
			Else
				For a.creature = Each creature
					If a\cat &lt; 100 And a\hp&gt;0 Then 
						pc\tx = a\x
						pc\ty = a\y
						Exit 
					EndIf 
				Next
			EndIf 
		EndIf 
		dx = Sgn((pc\tx - pc\x)/(pc\speed*2))*pc\speed
		dy = Sgn((pc\ty - pc\y)/(pc\speed*2))*pc\speed
		If Abs(pc\tx-pc\x)&lt;pc\speed * 4 Then dx = 0
		If Abs(pc\ty-pc\y)&lt;pc\speed * 4 Then dy = 0
		pc\moving = False
		nx = pc\x + dx
		ny = pc\y + dy
		wallcollide = False
		;if nx&gt;=0 and nx&lt;SW and ny&gt;=0 and ny&lt;SH
		;	if wallmap(nx,ny)=1 then 
		;		wallcollide = true
		;	endif
		;endif
		If Not wallcollide Then 
			pccollide = False
			For a.creature = Each creature
				If a&lt;&gt;pc Then 
					If a\hp &gt; 0 Then 
						If Abs(a\x-nx)&lt;30 And Abs(a\y-ny)&lt;30 Then 
							pccollide = True						
							Exit 
						EndIf 
					EndIf 
				EndIf 
			Next
			If Not pccollide Then 
				pc\x = nx
				pc\y = ny
				If dx&lt;&gt;0 Or dy&lt;&gt;0 Then pc\moving = True		
			Else
				pc\tx = pc\x + Rand(-100,100)
				pc\ty = pc\y + Rand(-100,100)
				If pc\tx &lt; 0 Then pc\tx = 0
				If pc\ty &lt; 0 Then pc\ty = 0
				If pc\tx &gt; SW - 1 Then pc\tx = SW - 1
				If pc\ty &gt; SH - 1 Then pc\ty = SH - 1
			EndIf 
		EndIf
	Else
		Delete pc
	EndIf 
Next
For b.bullet = Each bullet
	b\life=b\life-1
	b\x = b\x + b\vx
	b\y = b\y + b\vy
	;check collisions with walls 
	If b\x &gt;=0 And b\y&gt;=0 And b\x &lt; SW And b\y&lt;SH Then 
		;if wallmap(b\x,b\y)=1 then 
		;	b\life = 0
		;endif 
		For a.creature = Each creature
			If b\team = TEAM_PLAYER And a\cat &gt;= 100 Then 
				If Abs(b\x - a\x) &lt; 20 And Abs(b\y - a\y) &lt; 20 Then 
					b\life = 0
					a\hp = a\hp - b\damage	
				EndIf 
			ElseIf b\team = TEAM_MONSTER And a\cat &lt; 100 Then 
				If Abs(b\x - a\x) &lt; 20 And Abs(b\y - a\y) &lt; 20 Then 
					b\life = 0
					a\hp = a\hp - b\damage	
				EndIf 
			EndIf 
		Next
	Else
		b\life = 0
	EndIf 
	;check collisions with other creatures
	
	If b\life &lt;=0 Then Delete b
Next
For pc.creature = Each creature
	If pc\hp &gt; 0 Then 
		If pc\healingtime &gt; 0 Then pc\healingtime = pc\healingtime - 1
		If pc\cat = CAT_CLERIC
			dieroll = Rand(0,1000)
			If dieroll &lt; pc\skill Then 
				For a.creature = Each creature
					If a\hp &gt; 0 And a\cat &lt; 100 And Abs(a\x-pc\x)&lt;160 And Abs(a\y-pc\y)&lt;160 Then 
						If a\hp &lt; a\fullhp Then 
							a\hp = a\hp + pc\damage
							If a\hp &gt; a\fullhp Then a\hp = a\fullhp
							a\healingtime = 60
						EndIf 
					EndIf 
				Next
			EndIf 
		EndIf
		For a.creature = Each creature
			If pc\cat &lt; 100 Then 
				If pc\cat = CAT_FIGHTER Or pc\cat = CAT_RANGER
					If a\cat &gt;= 100 And a\hp&gt;0 Then 
						If Abs(a\x-pc\x)&lt;60 And Abs(a\y-pc\y)&lt;60 Then 
							;combat 	
							dieroll = Rand(0,1000)
							If dieroll &lt; pc\skill Then 
								a\hp = a\hp - pc\damage
							EndIf 		
						EndIf
					EndIf 
				ElseIf pc\cat = CAT_WIZARD
					If a\cat &gt;= 100 And a\hp &gt; 0 And (Abs(a\x-pc\x)&gt;100 Or Abs(a\y-pc\y)&gt;100) Then 
						dieroll = Rand(0,1000)
						If dieroll &lt; pc\skill Then 
							b.bullet = New bullet
							b\img = none ;bullet image
							b\x = pc\x
							b\damage = pc\damage
							b\y = pc\y
							b\team = TEAM_PLAYER
							vx# = Float(a\x - b\x)
							vy# = Float(a\y - b\y)
							b\life = 50
							If vx&lt;&gt;0 Or vy&lt;&gt;0 Then 
								vv = Sqr(vx*vx+vy*vy)
								vx=10.0*vx/vv
								vy=10.0*vy/vv
								b\vx = vx
								b\vy = vy
							Else
								b\life = 0
							EndIf 

						EndIf 
						Exit
					EndIf
				EndIf 
			Else
				If a\cat &lt; 100 And a\hp &gt; 0 Then 
					If Abs(a\x-pc\x)&lt;60 And Abs(a\y-pc\y)&lt;60 Then 
						;combat 	
						dieroll = Rand(0,1000)
						If dieroll &lt; pc\skill Then 
							a\hp = a\hp - pc\damage
						EndIf 		
					EndIf 				
				EndIf 
			EndIf
		Next
	EndIf 
Next


End Function

Function drawgame()
;draw background (fixed static 1280x720 image background)
;draw all creatures - don't worry about zordering them - it will be too fast to notice 
;draw all bullets
For img.images = Each images
	If img\cat = 2001 ;change this later
		DrawBlock img\img,0,0
	EndIf
Next

For pc.creature = Each creature
	If pc\hp &gt; 0 Then 
		If pc\moving Then 
			aa = 4.0 * Sin(MilliSecs()*2)
		Else
			aa = 0
		EndIf 
		DrawImage pc\img,pc\x - ImageWidth(pc\img)/2,pc\y - 40 + aa
		dhp = 10 * pc\hp / pc\fullhp
		If dhp &lt; 4 Then Color 255,32,32
		If dhp &gt;=4 And dhp&lt;8 Then Color 255,255,32
		If dhp &gt;=8 Then Color 32,255,32
		For hp = 1 To 10 * pc\hp / pc\fullhp
			Rect hp*4 + pc\x - ImageWidth(pc\img)/3,pc\y - 50,3,3,1
		Next
		If pc\healingtime &gt; 0 Then 
			Color 32,255,255
			For i = 1 To 10
				x = pc\x - ImageWidth(pc\img)/2 + Rand(60)
				y = pc\y - 40 + aa + Rand(80)
				dd = Rand(2,8)
				Oval x,y,dd,dd,1
			Next
		EndIf 
	EndIf
Next
Color 255,255,0
For b.bullet = Each bullet
	If b\life &gt; 0  Then 
		If b\img=0 Then 
			Oval b\x,b\y,10,10,1	
		Else
			DrawImage b\img,b\x,b\y
		EndIf 
	EndIf
Next
Color 255,255,255
For img.images = Each images
	If img\cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img\img,mx,my
	EndIf
Next


End Function 

Function handlecutscene()
;handle transitions,  handle skip button; 
;handle fading in and out text (bitmap fonts?)

If lmb&lt;&gt;0 Then 
	If mx&gt;1000 And mx&lt;1200 And my&gt;600 And my&lt;650 Then 
		initlevel()
		gamemode = MODE_COMBAT
	EndIf 
EndIf 

End Function 

Function drawcutscene()
;draw cut scene background, draw transition, draw skip button
For img.images = Each images
	If img\cat = 2000 Then 
		DrawBlock img\img,0,0
	EndIf 
Next

For img.images = Each images
	If img\cat = CAT_MENU_SKIP_CUTSCENE
		DrawImage img\img,1000,600
	EndIf
Next

For img.images = Each images
	If img\cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img\img,mx,my
	EndIf
Next

End Function 

Function handleupgrade()
;handle button press 'add stuff' to characters
;
;
;
End Function

Function drawupgrade()
;draw background
;draw buttons
;draw characters
;draw stats
;draw continue button

End Function 

Function initstartgame()
pc.creature = New creature
pc\fullhp = 80
pc\hp = 80
pc\cat = CAT_FIGHTER
pc\x = 600
pc\y = 300
pc\tx = pc\x
pc\ty = pc\y
pc\skill = 30
pc\damage = 20
pc\speed = 4.0
For img.images = Each images
	If img\cat = CAT_FIGHTER Then 
		pc\img = img\img
		Exit 
	EndIf 
Next
pc.creature = New creature
pc\fullhp = 60
pc\hp = 60
pc\cat = CAT_RANGER
pc\x = 640
pc\y = 300
pc\tx = pc\x
pc\ty = pc\y
pc\skill = 50
pc\damage = 25
pc\speed = 5.0
For img.images = Each images
	If img\cat = CAT_RANGER Then 
		pc\img = img\img
		Exit 
	EndIf 
Next
pc.creature = New creature
pc\fullhp = 30
pc\hp = 30
pc\cat = CAT_WIZARD
pc\x = 600
pc\y = 360
pc\tx = pc\x
pc\ty = pc\y
pc\skill = 25
pc\damage = 10
pc\speed = 5.0
For img.images = Each images
	If img\cat = CAT_WIZARD Then 
		pc\img = img\img
		Exit 
	EndIf 
Next
pc.creature = New creature
pc\fullhp = 50
pc\hp = 50
pc\cat = CAT_CLERIC
pc\x = 640
pc\y = 350
pc\tx = pc\x
pc\ty = pc\y
pc\skill = 20
pc\damage = 10
pc\speed = 4.0
For img.images = Each images
	If img\cat = CAT_CLERIC Then 
		pc\img = img\img
		Exit 
	EndIf 
Next
End Function 

Function initlevel()
For pc.creature = Each creature
	If pc\hp &gt; 0 And pc\hp &lt; pc\fullhp Then pc\hp = pc\fullhp
	If pc\cat = CAT_FIGHTER
		pc\x = 600
		pc\y = 300
	EndIf
	If pc\cat = CAT_RANGER
		pc\x = 600
		pc\y = 350
	EndIf
	If pc\cat = CAT_WIZARD
		pc\x = 640
		pc\y = 300
	EndIf
	If pc\cat = CAT_CLERIC
		pc\x = 640
		pc\y = 350
	EndIf
	pc\tx = pc\x
	pc\ty = pc\y
	If pc\cat &gt;=100 Then Delete pc
Next

For i = 1 To 20
	pc.creature = New creature
	pc\x = Rand(0,SW)
	pc\y = Rand(0,SH)
	pc\tx = pc\x
	pc\ty = pc\y
	pc\cat = 100+Rand(0,1)
	pc\hp = 50
	pc\fullhp = 50
	pc\speed = 3
	pc\damage = 5
	pc\skill = 20
	
	pc\aimode = AI_WANDER
	pc\aitime = 250 + Rand(100)
	pc\aidelay = Rand(pc\aitime/10)
	For img.images = Each images
		If img\cat = pc\cat Then 
			pc\img = img\img
			Exit 
		EndIf 
	Next
Next

lmb = 0
olmb = 0
FlushMouse()
End Function 
</textarea><br><br>media: (most will be replaced as I go...this is just an initial demo)<br><br>btnaudio.png<br><img src="http://www.mattiesgames.com/art/btnaudio.png"><br><br>btnplay.png<br><img src="http://www.mattiesgames.com/art/btnplay.png"><br>btnskip.png<br><img src="http://www.mattiesgames.com/art/btnskip.png"><br>cleric1.png<br><img src="http://www.mattiesgames.com/art/cleric1.png"><br>cursor.png<br><img src="http://www.mattiesgames.com/art/cursor.png"><br>goblin1.png<br><img src="http://www.mattiesgames.com/art/goblin1.png"><br>goblin2.png<br><img src="http://www.mattiesgames.com/art/goblin2.png"><br>knight1.png<br><img src="http://www.mattiesgames.com/art/knight1.png"><br>ranger1.png<br><img src="http://www.mattiesgames.com/art/ranger1.png"><br>wizard1.png<br><img src="http://www.mattiesgames.com/art/wizard1.png"> <br><br></td></tr></table><br>
<a name="1341126"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rooster</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#48">[#48]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here is a first pass at porting the code to BMax.<br>It's slow as crap, and the image draw functions are messed up.<br>I'm not sure how inportent DrawBlock was, I replaced it DrawImage.<br>But it does run at a basic level (excuse the pun).<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
'This is both a learning exercise And hopefully a collaborative project of sorts
'Or at least a project I can share with others on the blitz forum.
'It will be written initially in blitzplus/blitz3d And maybe someone will be keen on
'porting it To blitzmax...even blitzmax-ng To Release on mobile perhaps?
'
'Interface:
'Left mouse button clicking only To make porting To 
'mobile interface much, much easier.
'Gameplay mechanic so far (15-May-2017)
'
'1. Arcade Action RPG Combat
'	Player controls 4 characters in a single screen dungeon.
'	Dungeon has a few walls And so on that prevent movement.
'	Monsters spawn from spawners And make their way around the map
'	Player taps the screen To move To location And characters fight things
'	in their path.
'	Powerups exist in the level such as:
'	Health pickups
'	Bombs - kill all monsters that have spawned Or at least damage them.
'	
'2. After the arcade sequence the player is presented with options To upgrade their
'	character's stats. Stats to upgrade include:
'	Combat skill ('to hit roll')
'	Damage output ('damage points')
'	Health points ('hp')
'	Movement speed ('move')
'3.	After this a Short cut scene is presented which may simply be a scrolling static
'	image with some fading in/fading out text To advance the story line
'0. Menu - toggle audio, play, credits
'
'Character types:
'1 Fighter - high hitpoint melee combat medium damage
'2 Ranger - medium hitpoint melee combat high damage
'3 Wizard - low hitpoint, ranged combat, medium damage
'4 Cleric - medium hitpoint, no combat, healer
'


'constants
Const SW=1280,SH=720,WIN=2
Const MODE_MENU = 0
Const MODE_COMBAT = 1
Const MODE_UPGRADE = 2
Const MODE_CUTSCENE = 3
Const PURE_2D = True 'If go To blitzmax can use 2d-in-3d commands such as alpha otherwise have To calculate manually.Change To False For blitzmax.

'categories For image types And Object types
Const CAT_MENU_PLAY = 0
Const CAT_MENU_AUDIO = 1
Const CAT_MENU_SKIP_CUTSCENE = 2 'cut scene mode
Const CAT_MENU_ADD_SKILL = 3 'upgrade mode
Const CAT_MENU_ADD_DAMAGE = 4'upgrade mode
Const CAT_MENU_ADD_HEALTH = 5'upgrade mode
Const CAT_MENU_ADD_SPEED = 6'
Const CAT_MENU_MOUSE_CURSOR = 7'
Const CAT_FIGHTER = 10
Const CAT_KNIGHT = 10 'synonym
Const CAT_RANGER = 11
Const CAT_WIZARD = 12
Const CAT_CLERIC = 13
Const CAT_HEALER = 13 'synonym
Const CAT_HEALTH_PICKUP = 20
Const CAT_BOMB_PICKUP = 21
'CAT_BACKGROUND = 2000-3000 ' all the different image backgrounds
'CAT_MONSTER = 100-1000 , all the different monster types

Const AI_WANDER = 0
Const AI_ATTACK = 1

Const TEAM_PLAYER = 0
Const TEAM_MONSTER = 1

'globals
Global mx,my,lmb,olmb 'mouse Input
Global audiostate 'on/off
Global gamemode 'references Const above
Global gamelevel 'For cutscenes
Global cutsceneframe 'For cutscenes ie trigger fades, text, motion etc on certain frames

'for Bmax -Rooster
Global list_objects:TList=New TList

'arrays
Global wallmap[0,0] '0/1 value at each element indicates whether wall is there Or Not - redimension later

'types
Type images

Field img 'handle
Field midhandled 'boolean
Field cat 'category //hooks into creature template

End Type 

Type creaturetemplate

Field img 'img handle
Field cat 'category
Field fullhp 'n (values range from about 10 To 200 For high level characters And monsters)
Field combatskill '1-1000 (percentile out of a 1000 Not 100) (roll under To hit/roll under To cast)
Field speed# 'n.m (movement speed)
Field damage 'n (damage per hit, also equal To hitpoints To heal per successful cast)

End Type 

Type bullet

Field img 'handle of image
Field team 'players Or monsters - so no friendly fire
Field x#
Field y#
Field vx#
Field vy#
Field life
Field damage 'damage To inflict per hit Then disappear

End Type

Type spawner

Field img
Field cat 'category To spawn
Field x
Field y
Field hp
Field timetospawn 'frames To count down from when respawning
Field spawndelay 'Current frame count on spawner 0 To 'timetospawn'.

End Type 

Type creature

Field img
Field cat
Field x#
Field y#
Field tx#
Field ty#
Field hp
Field fullhp
Field speed#
Field damage
Field skill


Field aimode
Field aidelay
Field aitime

Field moving 'boolean

Field healingtime 'For healing effect/buff effect

End Type 

Type menubutton

Field cat 'For menu buttons
Field img
Field x
Field y
Field w
Field h
Field state 'pressed/Not pressed

End Type 

Type cutscene

Field cat
Field img
Field x
Field y
Field levelnum 'For the specific level num
Field upperframe 'For the Upper limit on the frame number To show this image For
Field transitiontype 'define later For transitioning between frames...do all this in code 

End Type 

Main()

Function Main()
	quit = False
	gamemode = MODE_MENU
	init()
	Repeat
		frametime = MilliSecs()
		Cls
		'Input 
		mx = MouseX()
		my = MouseY()
		olmb = lmb
		lmb = MouseDown(1)
		Select gamemode
		
		Case MODE_MENU
			handlemenu()
			drawmenu()
		
		Case MODE_COMBAT
			handleinput()
			updategame()
			drawgame()
		Case MODE_CUTSCENE
			handlecutscene()
			drawcutscene()
		Case MODE_UPGRADE
			handleupgrade()
			drawupgrade()
		End Select
		
		Flip
		'very basic frame limiting
		endframetime = MilliSecs()
		dtime = endframetime - frametime
		If dtime &lt; 15 Then 
			Delay 15 - dtime
		EndIf 
		'End of frame limiting
		If(KeyHit(1)) Then quit = True		
	Until quit
	''''''
	End
End Function 

Function init()
Graphics SW,SH,0,WIN
'Load all images here
'Load all sounds here
'Load all music here
HideMouse() 
img:images = New images
img.img = LoadImage("images\knight1.png")
img.cat = CAT_FIGHTER
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\ranger1.png")
img.cat = CAT_RANGER
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\wizard1.png")
img.cat = CAT_WIZARD
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\cleric1.png")
img.cat = CAT_CLERIC
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\goblin1.png")
img.cat = 100 'goblin 1
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\goblin2.png")
img.cat = 101 'goblin 2
list_objects.AddLast img


img:images = New images
img.img = LoadImage("images\btnplay.png")
img.cat = CAT_MENU_PLAY
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\btnaudio.png")
img.cat = CAT_MENU_AUDIO
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\cursor.png")
img.cat = CAT_MENU_MOUSE_CURSOR
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\btnskip.png")
img.cat = CAT_MENU_SKIP_CUTSCENE
list_objects.AddLast img

'we don't have backgrounds yet so create them on the fly for now
img:images = New images
img.img = CreateImage(SW,SH)
'SetBuffer ImageBuffer(img.img) #
For i = 1 To 100
	SetColor 100,100,100
	DrawOval Rand(SW),Rand(SH),100,100',1
Next
'SetBuffer BackBuffer() #
img.cat = 2000
list_objects.AddLast img

'Bmax need to have it's draw color set back to default -Rooster
SetColor 255,255,255

End Function 

Function handlemenu()
'''
''''
'''Check If 'PLAY' pressed..if so then initialise
'first cut scene And change gamemode
'''Check If 'TOGGLE AUDIO' pressed if so toggle music/audio flags

If lmb&lt;&gt;0 Then 
	If mx&gt;=1000 And mx&lt;=1200 Then 
		If my&gt;500 And my&lt;550 Then 
			'play hit
			initstartgame()
			gamemode = MODE_CUTSCENE
		EndIf 
		If my&gt;600 And my&lt;650 Then 
			audiostate = Not audiostate
			If Not audiostate
				'stop music
					
			EndIf 
		EndIf 
	EndIf 
EndIf 


End Function

Function drawmenu()
'draw backdrop
'draw buttons in relevant state
'draw mouse cursor

For img:images = EachIn list_objects 
	If img.cat = 2000 Then 
		DrawImage img.img,0,0'DrawBlock img.img,0,0 #
	EndIf 
Next

For img:images = EachIn list_objects
	If img.cat = CAT_MENU_PLAY
		DrawImage img.img,1000,500
	EndIf
	If img.cat = CAT_MENU_AUDIO
		DrawImage img.img,1000,600
	EndIf
Next

For img:images = EachIn list_objects 
	If img.cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img.img,mx,my
	EndIf
Next

End Function

Function handleinput()
'assign tx,ty of creatures To player units
'
If lmb&lt;&gt;0 Then 
	For pc:creature = EachIn list_objects 
		If pc.hp&gt;0 And pc.cat&gt;=10 And pc.cat&lt;=13 Then 
			pc.tx = mx + (pc.cat Mod 2) * 30
			pc.ty = my + ((pc.cat - 10)/2) * 60
		EndIf 
	Next
EndIf 


End Function

Function updategame()
'move all creatures
'move all bullets
'handle all collisions
'handle all pick ups
'handle all combat
'handle all spell casting (magic missiles And healing)


For pc:creature = EachIn list_objects 
	If pc.hp&gt;0 Then 
		If pc.cat &gt;= 100 Then 
			pc.aidelay=pc.aidelay-1
			switchon = False
			If pc.aidelay&lt;=0 Then 
				pc.aidelay = pc.aitime
				pc.aimode = Rand(-2,3)
				If pc.aimode &lt; 0 Then pc.aimode = 0
				If pc.aimode &gt; 1 Then pc.aimode = 1
				switchon = True
			EndIf 
			If pc.aimode = AI_WANDER Then 
					If switchon
						pc.tx = Rand(-600,600)+pc.x
						pc.ty = Rand(-600,600)+pc.y
						If pc.tx &lt; 0 Then pc.tx = 0
						If pc.ty &lt; 0 Then pc.ty = 0
						If pc.tx &gt; SW - 1 Then pc.tx = SW-1
						If pc.ty &gt; SH - 1 Then pc.tx = SH-1
					EndIf
			Else
				For a:creature = EachIn list_objects 
					If a.cat &lt; 100 And a.hp&gt;0 Then 
						pc.tx = a.x
						pc.ty = a.y
						Exit 
					EndIf 
				Next
			EndIf 
		EndIf 
		dx = Sgn((pc.tx - pc.x)/(pc.speed*2))*pc.speed
		dy = Sgn((pc.ty - pc.y)/(pc.speed*2))*pc.speed
		If Abs(pc.tx-pc.x)&lt;pc.speed * 4 Then dx = 0
		If Abs(pc.ty-pc.y)&lt;pc.speed * 4 Then dy = 0
		pc.moving = False
		nx = pc.x + dx
		ny = pc.y + dy
		wallcollide = False
		'If nx&gt;=0 And nx&lt;SW And ny&gt;=0 And ny&lt;SH
		'	If wallmap(nx,ny)=1 Then 
		'		wallcollide = True
		'	EndIf
		'EndIf
		If Not wallcollide Then 
			pccollide = False
			For a:creature = EachIn list_objects 
				If a&lt;&gt;pc Then 
					If a.hp &gt; 0 Then 
						If Abs(a.x-nx)&lt;30 And Abs(a.y-ny)&lt;30 Then 
							pccollide = True						
							Exit 
						EndIf 
					EndIf 
				EndIf 
			Next
			If Not pccollide Then 
				pc.x = nx
				pc.y = ny
				If dx&lt;&gt;0 Or dy&lt;&gt;0 Then pc.moving = True		
			Else
				pc.tx = pc.x + Rand(-100,100)
				pc.ty = pc.y + Rand(-100,100)
				If pc.tx &lt; 0 Then pc.tx = 0
				If pc.ty &lt; 0 Then pc.ty = 0
				If pc.tx &gt; SW - 1 Then pc.tx = SW - 1
				If pc.ty &gt; SH - 1 Then pc.ty = SH - 1
			EndIf 
		EndIf
	Else
		ListRemove( list_objects, pc)
	EndIf 
Next
For b:bullet = EachIn list_objects 
	b.life=b.life-1
	b.x = b.x + b.vx
	b.y = b.y + b.vy
	'check collisions with walls 
	If b.x &gt;=0 And b.y&gt;=0 And b.x &lt; SW And b.y&lt;SH Then 
		'If wallmap(b.x,b.y)=1 Then 
		'	b.life = 0
		'EndIf 
		For a:creature = EachIn list_objects 
			If b.team = TEAM_PLAYER And a.cat &gt;= 100 Then 
				If Abs(b.x - a.x) &lt; 20 And Abs(b.y - a.y) &lt; 20 Then 
					b.life = 0
					a.hp = a.hp - b.damage	
				EndIf 
			ElseIf b.team = TEAM_MONSTER And a.cat &lt; 100 Then 
				If Abs(b.x - a.x) &lt; 20 And Abs(b.y - a.y) &lt; 20 Then 
					b.life = 0
					a.hp = a.hp - b.damage	
				EndIf 
			EndIf 
		Next
	Else
		b.life = 0
	EndIf 
	'check collisions with other creatures
	
	If b.life &lt;=0 Then ListRemove( list_objects,b)
Next
For pc:creature = EachIn list_objects 
	If pc.hp &gt; 0 Then 
		If pc.healingtime &gt; 0 Then pc.healingtime = pc.healingtime - 1
		If pc.cat = CAT_CLERIC
			dieroll = Rand(0,1000)
			If dieroll &lt; pc.skill Then 
				For a:creature = EachIn list_objects 
					If a.hp &gt; 0 And a.cat &lt; 100 And Abs(a.x-pc.x)&lt;160 And Abs(a.y-pc.y)&lt;160 Then 
						If a.hp &lt; a.fullhp Then 
							a.hp = a.hp + pc.damage
							If a.hp &gt; a.fullhp Then a.hp = a.fullhp
							a.healingtime = 60
						EndIf 
					EndIf 
				Next
			EndIf 
		EndIf
		For a:creature = EachIn list_objects 
			If pc.cat &lt; 100 Then 
				If pc.cat = CAT_FIGHTER Or pc.cat = CAT_RANGER
					If a.cat &gt;= 100 And a.hp&gt;0 Then 
						If Abs(a.x-pc.x)&lt;60 And Abs(a.y-pc.y)&lt;60 Then 
							'combat 	
							dieroll = Rand(0,1000)
							If dieroll &lt; pc.skill Then 
								a.hp = a.hp - pc.damage
							EndIf 		
						EndIf
					EndIf 
				ElseIf pc.cat = CAT_WIZARD
					If a.cat &gt;= 100 And a.hp &gt; 0 And (Abs(a.x-pc.x)&gt;100 Or Abs(a.y-pc.y)&gt;100) Then 
						dieroll = Rand(0,1000)
						If dieroll &lt; pc.skill Then 
							b:bullet = New bullet
							b.img = none 'bullet image
							b.x = pc.x
							b.damage = pc.damage
							b.y = pc.y
							b.team = TEAM_PLAYER
							list_objects.AddLast b
							vx# = Float(a.x - b.x)
							vy# = Float(a.y - b.y)
							b.life = 50
							If vx&lt;&gt;0 Or vy&lt;&gt;0 Then 
								vv = Sqr(vx*vx+vy*vy)
								vx=10.0*vx/vv
								vy=10.0*vy/vv
								b.vx = vx
								b.vy = vy
							Else
								b.life = 0
							EndIf 

						EndIf 
						Exit
					EndIf
				EndIf 
			Else
				If a.cat &lt; 100 And a.hp &gt; 0 Then 
					If Abs(a.x-pc.x)&lt;60 And Abs(a.y-pc.y)&lt;60 Then 
						'combat 	
						dieroll = Rand(0,1000)
						If dieroll &lt; pc.skill Then 
							a.hp = a.hp - pc.damage
						EndIf 		
					EndIf 				
				EndIf 
			EndIf
		Next
	EndIf 
Next


End Function

Function drawgame()
'draw background (fixed static 1280x720 image background)
'draw all creatures - don't worry about zordering them - it will be too fast to notice 
'draw all bullets
For img:images = EachIn list_objects 
	If img.cat = 2001 'change this later
		DrawImage img.img,0,0'DrawBlock img.img,0,0 #
	EndIf
Next

For pc:creature = EachIn list_objects 
	If pc.hp &gt; 0 Then 
		If pc.moving Then 
			aa = 4.0 * Sin(MilliSecs()*2)
		Else
			aa = 0
		EndIf 
		DrawImage pc.img,pc.x - ImageWidth(pc.img)/2,pc.y - 40 + aa
		dhp = 10 * pc.hp / pc.fullhp
		If dhp &lt; 4 Then SetColor 255,32,32
		If dhp &gt;=4 And dhp&lt;8 Then SetColor 255,255,32
		If dhp &gt;=8 Then SetColor 32,255,32
		For hp = 1 To 10 * pc.hp / pc.fullhp
			GLDrawRect (hp*4 + pc.x - ImageWidth(pc.img)/3,pc.y - 50,3,3)
		Next
		If pc.healingtime &gt; 0 Then 
			SetColor 32,255,255
			For i = 1 To 10
				x = pc.x - ImageWidth(pc.img)/2 + Rand(60)
				y = pc.y - 40 + aa + Rand(80)
				dd = Rand(2,8)
				DrawOval x,y,dd,dd',1
			Next
		EndIf 
	EndIf
Next
SetColor 255,255,0
For b:bullet = EachIn list_objects 
	If b.life &gt; 0  Then 
		If b.img=0 Then 
			DrawOval b.x,b.y,10,10',1	
		Else
	DrawImage b.img,b.x,b.y
		EndIf 
	EndIf
Next
SetColor 255,255,255
For img:images = EachIn list_objects 
	If img.cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img.img,mx,my
	EndIf
Next

End Function 

Function handlecutscene()
'handle transitions,  handle skip button' 
'handle fading in And out text (bitmap fonts?)

If lmb&lt;&gt;0 Then 
	If mx&gt;1000 And mx&lt;1200 And my&gt;600 And my&lt;650 Then 
		initlevel()
		gamemode = MODE_COMBAT
	EndIf 
EndIf 

End Function 

Function drawcutscene()
'draw cut scene background, draw transition, draw skip button
For img:images = EachIn list_objects 
	If img.cat = 2000 Then 
		DrawImage img.img,0,0'DrawBlock img.img,0,0 #
	EndIf 
Next

For img:images = EachIn list_objects 
	If img.cat = CAT_MENU_SKIP_CUTSCENE
		DrawImage img.img,1000,600
	EndIf
Next

For img:images = EachIn list_objects
	If img.cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img.img,mx,my
	EndIf
Next

End Function 

Function handleupgrade()
'handle button press 'add stuff' to characters
'
'
'
End Function

Function drawupgrade()
'draw background
'draw buttons
'draw characters
'draw stats
'draw Continue button

End Function 

Function initstartgame()
pc:creature = New creature
pc.fullhp = 80
pc.hp = 80
pc.cat = CAT_FIGHTER
pc.x = 600
pc.y = 300
pc.tx = pc.x
pc.ty = pc.y
pc.skill = 30
pc.damage = 20
pc.speed = 4.0
list_objects.AddLast pc

For img:images = EachIn list_objects 
	If img.cat = CAT_FIGHTER Then 
		pc.img = img.img
		Exit 
	EndIf 
Next
pc:creature = New creature
pc.fullhp = 60
pc.hp = 60
pc.cat = CAT_RANGER
pc.x = 640
pc.y = 300
pc.tx = pc.x
pc.ty = pc.y
pc.skill = 50
pc.damage = 25
pc.speed = 5.0
list_objects.AddLast pc

For img:images = EachIn list_objects 
	If img.cat = CAT_RANGER Then 
		pc.img = img.img
		Exit 
	EndIf 
Next
pc:creature = New creature
pc.fullhp = 30
pc.hp = 30
pc.cat = CAT_WIZARD
pc.x = 600
pc.y = 360
pc.tx = pc.x
pc.ty = pc.y
pc.skill = 25
pc.damage = 10
pc.speed = 5.0
list_objects.AddLast pc

For img:images = EachIn list_objects 
	If img.cat = CAT_WIZARD Then 
		pc.img = img.img
		Exit 
	EndIf 
Next
pc:creature = New creature
pc.fullhp = 50
pc.hp = 50
pc.cat = CAT_CLERIC
pc.x = 640
pc.y = 350
pc.tx = pc.x
pc.ty = pc.y
pc.skill = 20
pc.damage = 10
pc.speed = 4.0
list_objects.AddLast pc

For img:images = EachIn list_objects 
	If img.cat = CAT_CLERIC Then 
		pc.img = img.img
		Exit 
	EndIf 
Next
End Function 

Function initlevel()
For pc:creature = EachIn list_objects 
	If pc.hp &gt; 0 And pc.hp &lt; pc.fullhp Then pc.hp = pc.fullhp
	If pc.cat = CAT_FIGHTER
		pc.x = 600
		pc.y = 300
	EndIf
	If pc.cat = CAT_RANGER
		pc.x = 600
		pc.y = 350
	EndIf
	If pc.cat = CAT_WIZARD
		pc.x = 640
		pc.y = 300
	EndIf
	If pc.cat = CAT_CLERIC
		pc.x = 640
		pc.y = 350
	EndIf
	pc.tx = pc.x
	pc.ty = pc.y
	If pc.cat &gt;=100 Then ListRemove( list_objects,pc)
Next

For i = 1 To 20
	pc:creature = New creature
	pc.x = Rand(0,SW)
	pc.y = Rand(0,SH)
	pc.tx = pc.x
	pc.ty = pc.y
	pc.cat = 100+Rand(0,1)
	pc.hp = 50
	pc.fullhp = 50
	pc.speed = 3
	pc.damage = 5
	pc.skill = 20
	
	pc.aimode = AI_WANDER
	pc.aitime = 250 + Rand(100)
	pc.aidelay = Rand(pc.aitime/10)
	list_objects.AddLast pc
	
	For img:images = EachIn list_objects 
		If img.cat = pc.cat Then 
			pc.img = img.img
			Exit 
		EndIf 
	Next
Next

lmb = 0
olmb = 0
FlushMouse()
End Function 


</textarea> <br><br></td></tr></table><br>
<a name="1341127"></a>

<a name="1341128"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#49">[#49]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm...I wonder why it runs slow on blitzmax...it runs at a decent rate on my desktop which is nothing special<br><br>EDIT - gah...I know I'm being a pain but after spending some time playing the demo program I put together I'm finding it not very inspiring gameplay....think I need to alter it...yet again...however for the most part the code skeleton does not need to change.... <br><br></td></tr></table><br>
<a name="1341129"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rooster</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#50">[#50]</a></td></tr></table></td></tr><tr ><td class="posttext"> I figured it out now, BMax doesn't like Graphics being given more than three inputs.<br>I had this problem when I was porting my game.<br><br>I will post the fixes when I get the other problems fixed. <br><br></td></tr></table><br>
<a name="1341130"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#51">[#51]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm thinking of potentially changing it to be effectively turn based or at least 'step' based rather than continuous/real time - and to give the user more control over the actions of their characters....so instead this will occur:<br><br>There will be a maze of sorts...<br><br>player will move their character in a set sequence (fighter/ranger/wizard/cleric or similar) and will be able to tap the square in front of them and the character will move there, or tap a monster and the character will attack them (melee for fighter/ranger, wizard shoots fireball, cleric heals friend if tap friend but cannot attack enemy or perhaps has a basic attack).<br><br>I'm still toying with the idea...want to make something that is satisfying to play. <br><br></td></tr></table><br>
<a name="1341131"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rooster</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#52">[#52]</a></td></tr></table></td></tr><tr ><td class="posttext"> I was having fun with the real time less control.<br><br>Well I got everything fixed, except the knight and the second goblin are not masked, because I don't know how to do that.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
'This is both a learning exercise And hopefully a collaborative project of sorts
'Or at least a project I can share with others on the blitz forum.
'It will be written initially in blitzplus/blitz3d And maybe someone will be keen on
'porting it To blitzmax...even blitzmax-ng To Release on mobile perhaps?
'
'Interface:
'Left mouse button clicking only To make porting To 
'mobile interface much, much easier.
'Gameplay mechanic so far (15-May-2017)
'
'1. Arcade Action RPG Combat
'	Player controls 4 characters in a single screen dungeon.
'	Dungeon has a few walls And so on that prevent movement.
'	Monsters spawn from spawners And make their way around the map
'	Player taps the screen To move To location And characters fight things
'	in their path.
'	Powerups exist in the level such as:
'	Health pickups
'	Bombs - kill all monsters that have spawned Or at least damage them.
'	
'2. After the arcade sequence the player is presented with options To upgrade their
'	character's stats. Stats to upgrade include:
'	Combat skill ('to hit roll')
'	Damage output ('damage points')
'	Health points ('hp')
'	Movement speed ('move')
'3.	After this a Short cut scene is presented which may simply be a scrolling static
'	image with some fading in/fading out text To advance the story line
'0. Menu - toggle audio, play, credits
'
'Character types:
'1 Fighter - high hitpoint melee combat medium damage
'2 Ranger - medium hitpoint melee combat high damage
'3 Wizard - low hitpoint, ranged combat, medium damage
'4 Cleric - medium hitpoint, no combat, healer
'


'constants
Const SW=1280,SH=720,WIN=2
Const MODE_MENU = 0
Const MODE_COMBAT = 1
Const MODE_UPGRADE = 2
Const MODE_CUTSCENE = 3
Const PURE_2D = True 'If go To blitzmax can use 2d-in-3d commands such as alpha otherwise have To calculate manually.Change To False For blitzmax.

'categories For image types And Object types
Const CAT_MENU_PLAY = 0
Const CAT_MENU_AUDIO = 1
Const CAT_MENU_SKIP_CUTSCENE = 2 'cut scene mode
Const CAT_MENU_ADD_SKILL = 3 'upgrade mode
Const CAT_MENU_ADD_DAMAGE = 4'upgrade mode
Const CAT_MENU_ADD_HEALTH = 5'upgrade mode
Const CAT_MENU_ADD_SPEED = 6'
Const CAT_MENU_MOUSE_CURSOR = 7'
Const CAT_FIGHTER = 10
Const CAT_KNIGHT = 10 'synonym
Const CAT_RANGER = 11
Const CAT_WIZARD = 12
Const CAT_CLERIC = 13
Const CAT_HEALER = 13 'synonym
Const CAT_HEALTH_PICKUP = 20
Const CAT_BOMB_PICKUP = 21
'CAT_BACKGROUND = 2000-3000 ' all the different image backgrounds
'CAT_MONSTER = 100-1000 , all the different monster types

Const AI_WANDER = 0
Const AI_ATTACK = 1

Const TEAM_PLAYER = 0
Const TEAM_MONSTER = 1

'globals
Global mx,my,lmb,olmb 'mouse Input
Global audiostate 'on/off
Global gamemode 'references Const above
Global gamelevel 'For cutscenes
Global cutsceneframe 'For cutscenes ie trigger fades, text, motion etc on certain frames

'for Bmax -Rooster
Global list_objects:TList=New TList

'arrays
Global wallmap[0,0] '0/1 value at each element indicates whether wall is there Or Not - redimension later

'types
Type images

Field img 'handle
Field midhandled 'boolean
Field cat 'category //hooks into creature template

End Type 

Type creaturetemplate

Field img 'img handle
Field cat 'category
Field fullhp 'n (values range from about 10 To 200 For high level characters And monsters)
Field combatskill '1-1000 (percentile out of a 1000 Not 100) (roll under To hit/roll under To cast)
Field speed# 'n.m (movement speed)
Field damage 'n (damage per hit, also equal To hitpoints To heal per successful cast)

End Type 

Type bullet

Field img 'handle of image
Field team 'players Or monsters - so no friendly fire
Field x#
Field y#
Field vx#
Field vy#
Field life
Field damage 'damage To inflict per hit Then disappear

End Type

Type spawner

Field img
Field cat 'category To spawn
Field x
Field y
Field hp
Field timetospawn 'frames To count down from when respawning
Field spawndelay 'Current frame count on spawner 0 To 'timetospawn'.

End Type 

Type creature

Field img
Field cat
Field x#
Field y#
Field tx#
Field ty#
Field hp
Field fullhp
Field speed#
Field damage
Field skill


Field aimode
Field aidelay
Field aitime

Field moving 'boolean

Field healingtime 'For healing effect/buff effect

End Type 

Type menubutton

Field cat 'For menu buttons
Field img
Field x
Field y
Field w
Field h
Field state 'pressed/Not pressed

End Type 

Type cutscene

Field cat
Field img
Field x
Field y
Field levelnum 'For the specific level num
Field upperframe 'For the Upper limit on the frame number To show this image For
Field transitiontype 'define later For transitioning between frames...do all this in code 

End Type 

Main()

Function Main()
	quit = False
	gamemode = MODE_MENU
	init()
	Repeat
		frametime = MilliSecs()
		Cls
		'Input 
		mx = MouseX()
		my = MouseY()
		olmb = lmb
		lmb = MouseDown(1)
		Select gamemode
		
		Case MODE_MENU
			handlemenu()
			drawmenu()
		
		Case MODE_COMBAT
			handleinput()
			updategame()
			drawgame()
		Case MODE_CUTSCENE
			handlecutscene()
			drawcutscene()
		Case MODE_UPGRADE
			handleupgrade()
			drawupgrade()
		End Select
		
		Flip
		'very basic frame limiting
		endframetime = MilliSecs()
		dtime = endframetime - frametime
		If dtime &lt; 15 Then 
			Delay 15 - dtime
		EndIf 
		'End of frame limiting
		If(KeyHit(27)) Then quit = True		
	Until quit
	''''''
	End
End Function 

Function init()
Graphics SW,SH,0',WIN '# removed to speed up the game -Rooster
'Load all images here
'Load all sounds here
'Load all music here
HideMouse() 

img:images = New images
img.img = LoadImage("images\knight1.png")
img.cat = CAT_FIGHTER
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\ranger1.png")
img.cat = CAT_RANGER
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\wizard1.png")
img.cat = CAT_WIZARD
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\cleric1.png")
img.cat = CAT_CLERIC
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\goblin1.png")
img.cat = 100 'goblin 1
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\goblin2.png")
img.cat = 101 'goblin 2
list_objects.AddLast img


img:images = New images
img.img = LoadImage("images\btnplay.png")
img.cat = CAT_MENU_PLAY
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\btnaudio.png")
img.cat = CAT_MENU_AUDIO
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\cursor.png")
img.cat = CAT_MENU_MOUSE_CURSOR
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\btnskip.png")
img.cat = CAT_MENU_SKIP_CUTSCENE
list_objects.AddLast img

'we don't have backgrounds yet so create them on the fly for now
img:images = New images
img.img = CreateImage(SW,SH,DYNAMICIMAGE|MASKEDIMAGE)
LockImage(img.img)'needed to draw -Rooster

'SetBuffer ImageBuffer(img.img) #
For i = 1 To 100
	SetColor 100,100,100
	DrawOval Rand(SW),Rand(SH),100,100',1
Next
'SetBuffer BackBuffer() #

GrabImage img.img,0,0 'more stuff needed for BMax to draw to image -Rooster
UnlockImage (img.img)

img.cat = 2000
list_objects.AddLast img

'Bmax need to have it's draw color set back to default -Rooster
SetColor 255,255,255

End Function 

Function handlemenu()
'''
''''
'''Check If 'PLAY' pressed..if so then initialise
'first cut scene And change gamemode
'''Check If 'TOGGLE AUDIO' pressed if so toggle music/audio flags

If lmb&lt;&gt;0 Then 
	If mx&gt;=1000 And mx&lt;=1200 Then 
		If my&gt;500 And my&lt;550 Then 
			'play hit
			initstartgame()
			gamemode = MODE_CUTSCENE
		EndIf 
		If my&gt;600 And my&lt;650 Then 
			audiostate = Not audiostate
			If Not audiostate
				'stop music
					
			EndIf 
		EndIf 
	EndIf 
EndIf 


End Function

Function drawmenu()
'draw backdrop
'draw buttons in relevant state
'draw mouse cursor

For img:images = EachIn list_objects 
	If img.cat = 2000 Then 
		DrawImage img.img,0,0'DrawBlock img.img,0,0 #
	EndIf 
Next

For img:images = EachIn list_objects
	If img.cat = CAT_MENU_PLAY
		DrawImage img.img,1000,500
	EndIf
	If img.cat = CAT_MENU_AUDIO
		DrawImage img.img,1000,600
	EndIf
Next

For img:images = EachIn list_objects 
	If img.cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img.img,mx,my
	EndIf
Next

End Function

Function handleinput()
'assign tx,ty of creatures To player units
'
If lmb&lt;&gt;0 Then 
	For pc:creature = EachIn list_objects 
		If pc.hp&gt;0 And pc.cat&gt;=10 And pc.cat&lt;=13 Then 
			pc.tx = mx + (pc.cat Mod 2) * 30
			pc.ty = my + ((pc.cat - 10)/2) * 60
		EndIf 
	Next
EndIf 


End Function

Function updategame()
'move all creatures
'move all bullets
'handle all collisions
'handle all pick ups
'handle all combat
'handle all spell casting (magic missiles And healing)


For pc:creature = EachIn list_objects 
	If pc.hp&gt;0 Then 
		If pc.cat &gt;= 100 Then 
			pc.aidelay=pc.aidelay-1
			switchon = False
			If pc.aidelay&lt;=0 Then 
				pc.aidelay = pc.aitime
				pc.aimode = Rand(-2,3)
				If pc.aimode &lt; 0 Then pc.aimode = 0
				If pc.aimode &gt; 1 Then pc.aimode = 1
				switchon = True
			EndIf 
			If pc.aimode = AI_WANDER Then 
					If switchon
						pc.tx = Rand(-600,600)+pc.x
						pc.ty = Rand(-600,600)+pc.y
						If pc.tx &lt; 0 Then pc.tx = 0
						If pc.ty &lt; 0 Then pc.ty = 0
						If pc.tx &gt; SW - 1 Then pc.tx = SW-1
						If pc.ty &gt; SH - 1 Then pc.tx = SH-1
					EndIf
			Else
				For a:creature = EachIn list_objects 
					If a.cat &lt; 100 And a.hp&gt;0 Then 
						pc.tx = a.x
						pc.ty = a.y
						Exit 
					EndIf 
				Next
			EndIf 
		EndIf 
		dx = Sgn((pc.tx - pc.x)/(pc.speed*2))*pc.speed
		dy = Sgn((pc.ty - pc.y)/(pc.speed*2))*pc.speed
		If Abs(pc.tx-pc.x)&lt;pc.speed * 4 Then dx = 0
		If Abs(pc.ty-pc.y)&lt;pc.speed * 4 Then dy = 0
		pc.moving = False
		nx = pc.x + dx
		ny = pc.y + dy
		wallcollide = False
		'If nx&gt;=0 And nx&lt;SW And ny&gt;=0 And ny&lt;SH
		'	If wallmap(nx,ny)=1 Then 
		'		wallcollide = True
		'	EndIf
		'EndIf
		If Not wallcollide Then 
			pccollide = False
			For a:creature = EachIn list_objects 
				If a&lt;&gt;pc Then 
					If a.hp &gt; 0 Then 
						If Abs(a.x-nx)&lt;30 And Abs(a.y-ny)&lt;30 Then 
							pccollide = True						
							Exit 
						EndIf 
					EndIf 
				EndIf 
			Next
			If Not pccollide Then 
				pc.x = nx
				pc.y = ny
				If dx&lt;&gt;0 Or dy&lt;&gt;0 Then pc.moving = True		
			Else
				pc.tx = pc.x + Rand(-100,100)
				pc.ty = pc.y + Rand(-100,100)
				If pc.tx &lt; 0 Then pc.tx = 0
				If pc.ty &lt; 0 Then pc.ty = 0
				If pc.tx &gt; SW - 1 Then pc.tx = SW - 1
				If pc.ty &gt; SH - 1 Then pc.ty = SH - 1
			EndIf 
		EndIf
	Else
		ListRemove( list_objects, pc)
	EndIf 
Next
For b:bullet = EachIn list_objects 
	b.life=b.life-1
	b.x = b.x + b.vx
	b.y = b.y + b.vy
	'check collisions with walls 
	If b.x &gt;=0 And b.y&gt;=0 And b.x &lt; SW And b.y&lt;SH Then 
		'If wallmap(b.x,b.y)=1 Then 
		'	b.life = 0
		'EndIf 
		For a:creature = EachIn list_objects 
			If b.team = TEAM_PLAYER And a.cat &gt;= 100 Then 
				If Abs(b.x - a.x) &lt; 20 And Abs(b.y - a.y) &lt; 20 Then 
					b.life = 0
					a.hp = a.hp - b.damage	
				EndIf 
			ElseIf b.team = TEAM_MONSTER And a.cat &lt; 100 Then 
				If Abs(b.x - a.x) &lt; 20 And Abs(b.y - a.y) &lt; 20 Then 
					b.life = 0
					a.hp = a.hp - b.damage	
				EndIf 
			EndIf 
		Next
	Else
		b.life = 0
	EndIf 
	'check collisions with other creatures
	
	If b.life &lt;=0 Then ListRemove( list_objects,b)
Next
For pc:creature = EachIn list_objects 
	If pc.hp &gt; 0 Then 
		If pc.healingtime &gt; 0 Then pc.healingtime = pc.healingtime - 1
		If pc.cat = CAT_CLERIC
			dieroll = Rand(0,1000)
			If dieroll &lt; pc.skill Then 
				For a:creature = EachIn list_objects 
					If a.hp &gt; 0 And a.cat &lt; 100 And Abs(a.x-pc.x)&lt;160 And Abs(a.y-pc.y)&lt;160 Then 
						If a.hp &lt; a.fullhp Then 
							a.hp = a.hp + pc.damage
							If a.hp &gt; a.fullhp Then a.hp = a.fullhp
							a.healingtime = 60
						EndIf 
					EndIf 
				Next
			EndIf 
		EndIf
		For a:creature = EachIn list_objects 
			If pc.cat &lt; 100 Then 
				If pc.cat = CAT_FIGHTER Or pc.cat = CAT_RANGER
					If a.cat &gt;= 100 And a.hp&gt;0 Then 
						If Abs(a.x-pc.x)&lt;60 And Abs(a.y-pc.y)&lt;60 Then 
							'combat 	
							dieroll = Rand(0,1000)
							If dieroll &lt; pc.skill Then 
								a.hp = a.hp - pc.damage
							EndIf 		
						EndIf
					EndIf 
				ElseIf pc.cat = CAT_WIZARD
					If a.cat &gt;= 100 And a.hp &gt; 0 And (Abs(a.x-pc.x)&gt;100 Or Abs(a.y-pc.y)&gt;100) Then 
						dieroll = Rand(0,1000)
						If dieroll &lt; pc.skill Then 
							b:bullet = New bullet
							b.img = none 'bullet image
							b.x = pc.x
							b.damage = pc.damage
							b.y = pc.y
							b.team = TEAM_PLAYER
							list_objects.AddLast b
							vx# = Float(a.x - b.x)
							vy# = Float(a.y - b.y)
							b.life = 50
							If vx&lt;&gt;0 Or vy&lt;&gt;0 Then 
								vv = Sqr(vx*vx+vy*vy)
								vx=10.0*vx/vv
								vy=10.0*vy/vv
								b.vx = vx
								b.vy = vy
							Else
								b.life = 0
							EndIf 

						EndIf 
						Exit
					EndIf
				EndIf 
			Else
				If a.cat &lt; 100 And a.hp &gt; 0 Then 
					If Abs(a.x-pc.x)&lt;60 And Abs(a.y-pc.y)&lt;60 Then 
						'combat 	
						dieroll = Rand(0,1000)
						If dieroll &lt; pc.skill Then 
							a.hp = a.hp - pc.damage
						EndIf 		
					EndIf 				
				EndIf 
			EndIf
		Next
	EndIf 
Next


End Function

Function drawgame()
'draw background (fixed static 1280x720 image background)
'draw all creatures - don't worry about zordering them - it will be too fast to notice 
'draw all bullets
For img:images = EachIn list_objects 
	If img.cat = 2001 'change this later
		DrawImage img.img,0,0'DrawBlock img.img,0,0 #
	EndIf
Next

For pc:creature = EachIn list_objects 
	If pc.hp &gt; 0 Then 
		If pc.moving Then 
			aa = 4.0 * Sin(MilliSecs()*2)
		Else
			aa = 0
		EndIf 
		DrawImage pc.img,pc.x - ImageWidth(pc.img)/2,pc.y - 40 + aa
		dhp = 10 * pc.hp / pc.fullhp
		If dhp &lt; 4 Then SetColor 255,32,32
		If dhp &gt;=4 And dhp&lt;8 Then SetColor 255,255,32
		If dhp &gt;=8 Then SetColor 32,255,32
		For hp = 1 To 10 * pc.hp / pc.fullhp
			DrawRect (hp*4 + pc.x - ImageWidth(pc.img)/3,pc.y - 50,3,3)
		Next
		If pc.healingtime &gt; 0 Then 
			SetColor 32,255,255
			For i = 1 To 10
				x = pc.x - ImageWidth(pc.img)/2 + Rand(60)
				y = pc.y - 40 + aa + Rand(80)
				dd = Rand(2,8)
				DrawOval x,y,dd,dd',1
			Next
		EndIf 
	EndIf

   SetColor 255,255,255' BMax need to reset the drawcolor -Rooster	
	
Next
SetColor 255,255,0
For b:bullet = EachIn list_objects 
	If b.life &gt; 0  Then 
		If b.img=0 Then 
			DrawOval b.x,b.y,10,10',1	
		Else
	DrawImage b.img,b.x,b.y
		EndIf 
	EndIf
Next

SetColor 255,255,255' BMax need to reset the drawcolor -Rooster

For img:images = EachIn list_objects 
	If img.cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img.img,mx,my
	EndIf
Next

End Function 

Function handlecutscene()
'handle transitions,  handle skip button' 
'handle fading in And out text (bitmap fonts?)

If lmb&lt;&gt;0 Then 
	If mx&gt;1000 And mx&lt;1200 And my&gt;600 And my&lt;650 Then 
		initlevel()
		gamemode = MODE_COMBAT
	EndIf 
EndIf 

End Function 

Function drawcutscene()
'draw cut scene background, draw transition, draw skip button
For img:images = EachIn list_objects 
	If img.cat = 2000 Then 
		DrawImage img.img,0,0'DrawBlock img.img,0,0 #
	EndIf 
Next

For img:images = EachIn list_objects 
	If img.cat = CAT_MENU_SKIP_CUTSCENE
		DrawImage img.img,1000,600
	EndIf
Next

For img:images = EachIn list_objects
	If img.cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img.img,mx,my
	EndIf
Next

End Function 

Function handleupgrade()
'handle button press 'add stuff' to characters
'
'
'
End Function

Function drawupgrade()
'draw background
'draw buttons
'draw characters
'draw stats
'draw Continue button

End Function 

Function initstartgame()
pc:creature = New creature
pc.fullhp = 80
pc.hp = 80
pc.cat = CAT_FIGHTER
pc.x = 600
pc.y = 300
pc.tx = pc.x
pc.ty = pc.y
pc.skill = 30
pc.damage = 20
pc.speed = 4.0
list_objects.AddLast pc

For img:images = EachIn list_objects 
	If img.cat = CAT_FIGHTER Then 
		pc.img = img.img
		Exit 
	EndIf 
Next
pc:creature = New creature
pc.fullhp = 60
pc.hp = 60
pc.cat = CAT_RANGER
pc.x = 640
pc.y = 300
pc.tx = pc.x
pc.ty = pc.y
pc.skill = 50
pc.damage = 25
pc.speed = 5.0
list_objects.AddLast pc

For img:images = EachIn list_objects 
	If img.cat = CAT_RANGER Then 
		pc.img = img.img
		Exit 
	EndIf 
Next
pc:creature = New creature
pc.fullhp = 30
pc.hp = 30
pc.cat = CAT_WIZARD
pc.x = 600
pc.y = 360
pc.tx = pc.x
pc.ty = pc.y
pc.skill = 25
pc.damage = 10
pc.speed = 5.0
list_objects.AddLast pc

For img:images = EachIn list_objects 
	If img.cat = CAT_WIZARD Then 
		pc.img = img.img
		Exit 
	EndIf 
Next
pc:creature = New creature
pc.fullhp = 50
pc.hp = 50
pc.cat = CAT_CLERIC
pc.x = 640
pc.y = 350
pc.tx = pc.x
pc.ty = pc.y
pc.skill = 20
pc.damage = 10
pc.speed = 4.0
list_objects.AddLast pc

For img:images = EachIn list_objects 
	If img.cat = CAT_CLERIC Then 
		pc.img = img.img
		Exit 
	EndIf 
Next
End Function 

Function initlevel()
For pc:creature = EachIn list_objects 
	If pc.hp &gt; 0 And pc.hp &lt; pc.fullhp Then pc.hp = pc.fullhp
	If pc.cat = CAT_FIGHTER
		pc.x = 600
		pc.y = 300
	EndIf
	If pc.cat = CAT_RANGER
		pc.x = 600
		pc.y = 350
	EndIf
	If pc.cat = CAT_WIZARD
		pc.x = 640
		pc.y = 300
	EndIf
	If pc.cat = CAT_CLERIC
		pc.x = 640
		pc.y = 350
	EndIf
	pc.tx = pc.x
	pc.ty = pc.y
	If pc.cat &gt;=100 Then ListRemove( list_objects,pc)
Next

For i = 1 To 20
	pc:creature = New creature
	pc.x = Rand(0,SW)
	pc.y = Rand(0,SH)
	pc.tx = pc.x
	pc.ty = pc.y
	pc.cat = 100+Rand(0,1)
	pc.hp = 50
	pc.fullhp = 50
	pc.speed = 3
	pc.damage = 5
	pc.skill = 20
	
	pc.aimode = AI_WANDER
	pc.aitime = 250 + Rand(100)
	pc.aidelay = Rand(pc.aitime/10)
	list_objects.AddLast pc
	
	For img:images = EachIn list_objects 
		If img.cat = pc.cat Then 
			pc.img = img.img
			Exit 
		EndIf 
	Next
Next

lmb = 0
olmb = 0
FlushMouse()
End Function 
</textarea> <br><br></td></tr></table><br>
<a name="1341132"></a>

<a name="1341133"></a>

<a name="1341135"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#53">[#53]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay....I will continue developing the real time version but I will also develop another version and we can see which is more fun...<br><br>My design doc for the non real time version is written here:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Game Idea

I have another idea for how it will play...given it is for mobile:

1. You have 4 characters.

2. You tap on the character you want to activate.

3. The monsters then take turns activating as well.

Each of the 4 characters is different:

The game shows an arena where you do not move.

Instead you simply choose which of your characters you wish to activate each turn.

1. Fighter

If activate deals damage to all enemies (low)

2. Ranger

If activate deals high damage to one enemy

3. Wizard

If activate deals low damage to all enemies, each turn not activated does

more damage to enemies...so a slow recharge and build.

4. Cleric

If activate heals all friends.

If wait between heals heals more damage.

Wizard and Cleric have 3 levels of 'activating'

Wizard level 1 instant activation: Low damage to all enemies

Wizard level 2 activation: Medium damage to all enemies

Wizard level 3 activation: High damage to all enemies

Cleric similar but healing.

Fighter deals low-medium damage to all enemies every activation.

Ranger deals ultra high damage to one enemy (random) every activation.

Monsters:

Monsters have a chance to hit each character.

Character has a defense stat that gets rolled, if fail they take a hitpoint

of damage.

More damaging monsters do more damage if you fail your defense roll.

Complex monsters can do things like heal, cause their troops to take extra turns and so on.
</textarea><br><br>That allows for more strategy...I'll develop both simultaneously since they will mostly use the same media and design (cinematic/game play/upgrade loop)<br><br><br>New Sample Code for this alternative idea which I like better:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
;This is both a learning exercise and hopefully a collaborative project of sorts
;or at least a project I can share with others on the blitz forum.
;It will be written initially in blitzplus/blitz3d and maybe someone will be keen on
;porting it to blitzmax...even blitzmax-ng to release on mobile perhaps?
;
;Interface:
;Left mouse button clicking only to make porting to 
;mobile interface much, much easier.
;Gameplay mechanic so far (15-May-2017)
;
;1. Arcade Action RPG Combat
;	Player controls 4 characters in a single screen dungeon.
;	Dungeon has a few walls and so on that prevent movement.
;	Monsters spawn from spawners and make their way around the map
;	Player taps the screen to move to location and characters fight things
;	in their path.
;	Powerups exist in the level such as:
;	Health pickups
;	Bombs - kill all monsters that have spawned or at least damage them.
;	
;2. After the arcade sequence the player is presented with options to upgrade their
;	character's stats. Stats to upgrade include:
;	Combat skill ('to hit roll')
;	Damage output ('damage points')
;	Health points ('hp')
;	Movement speed ('move')
;3.	After this a short cut scene is presented which may simply be a scrolling static
;	image with some fading in/fading out text to advance the story line
;0. Menu - toggle audio, play, credits
;
;Character types:
;1 Fighter - high hitpoint melee combat medium damage
;2 Ranger - medium hitpoint melee combat high damage
;3 Wizard - low hitpoint, ranged combat, medium damage
;4 Cleric - medium hitpoint, no combat, healer
;


;constants
Const SW=1280,SH=720,WIN=2
Const MODE_MENU = 0
Const MODE_COMBAT = 1
Const MODE_UPGRADE = 2
Const MODE_CUTSCENE = 3
Const PURE_2D = True ;if go to blitzmax can use 2d-in-3d commands such as alpha otherwise have to calculate manually.Change to false for blitzmax.

;categories for image types and object types
Const CAT_MENU_PLAY = 0
Const CAT_MENU_AUDIO = 1
Const CAT_MENU_SKIP_CUTSCENE = 2 ;cut scene mode
Const CAT_MENU_ADD_SKILL = 3 ;upgrade mode
Const CAT_MENU_ADD_DAMAGE = 4;upgrade mode
Const CAT_MENU_ADD_HEALTH = 5;upgrade mode
Const CAT_MENU_ADD_SPEED = 6;
Const CAT_MENU_MOUSE_CURSOR = 7;
Const CAT_FIGHTER = 10
Const CAT_KNIGHT = 10 ;synonym
Const CAT_RANGER = 11
Const CAT_WIZARD = 12
Const CAT_CLERIC = 13
Const CAT_HEALER = 13 ;synonym
Const CAT_HEALTH_PICKUP = 20
Const CAT_BOMB_PICKUP = 21
;CAT_BACKGROUND = 2000-3000 ; all the different image backgrounds
;CAT_MONSTER = 100-1000 , all the different monster types

Const AI_WANDER = 0
Const AI_ATTACK = 1

Const TEAM_PLAYER = 0
Const TEAM_MONSTER = 1

;globals
Global mx,my,lmb,olmb ;mouse input
Global audiostate ;on/off
Global gamemode ;references const above
Global gamelevel ;for cutscenes
Global cutsceneframe ;for cutscenes ie trigger fades, text, motion etc on certain frames
Global levelfinishtime = 0

;arrays
Dim wallmap(0,0) ;0/1 value at each element indicates whether wall is there or not - redimension later
Dim blockmap(0,0) ;0/1 value - bigger version of wallmap lower resolution
;types
Type images

Field img ;handle
Field midhandled ;boolean
Field cat ;category //hooks into creature template

End Type 

Type creaturetemplate

Field img ;img handle
Field cat ;category
Field fullhp ;n (values range from about 10 to 200 for high level characters and monsters)
Field combatskill ;1-1000 (percentile out of a 1000 not 100) (roll under to hit/roll under to cast)
Field speed# ;n.m (movement speed)
Field damage ;n (damage per hit, also equal to hitpoints to heal per successful cast)

End Type 

Type bullet

Field img ;handle of image
Field team ;players or monsters - so no friendly fire
Field x#
Field y#
Field vx#
Field vy#
Field life
Field damage ;damage to inflict per hit then disappear

End Type

Type spawner

Field img
Field cat ;category to spawn
Field x
Field y
Field hp
Field timetospawn ;frames to count down from when respawning
Field spawndelay ;current frame count on spawner 0 to 'timetospawn'.

End Type 

Type creature

Field img
Field cat
Field x#
Field y#
Field tx#
Field ty#
Field hp
Field fullhp
Field speed#
Field damage
Field skill


Field aimode
Field aidelay
Field aitime

Field moving ;boolean

Field healingtime ;for healing effect/buff effect

Field activated ;boolean
Field waitcount ;int


End Type 

Type menubutton

Field cat ;for menu buttons
Field img
Field x
Field y
Field w
Field h
Field state ;pressed/not pressed

End Type 

Type cutscene

Field cat
Field img
Field x
Field y
Field levelnum ;for the specific level num
Field upperframe ;for the upper limit on the frame number to show this image for
Field transitiontype ;define later for transitioning between frames...do all this in code 

End Type 

main()

Function main()
	quit = False
	gamemode = MODE_MENU
	init()
	Repeat
		frametime = MilliSecs()
		Cls
		;input 
		mx = MouseX()
		my = MouseY()
		olmb = lmb
		lmb = MouseDown(1)
		Select gamemode
		
		Case MODE_MENU
			handlemenu()
			drawmenu()
		
		Case MODE_COMBAT
			handleinput()
			updategame()
			drawgame()
		Case MODE_CUTSCENE
			handlecutscene()
			drawcutscene()
		Case MODE_UPGRADE
			handleupgrade()
			drawupgrade()
		End Select
		
		Flip
		;very basic frame limiting
		endframetime = MilliSecs()
		dtime = endframetime - frametime
		If dtime &lt; 15 Then 
			Delay 15 - dtime
		EndIf 
		;end of frame limiting
		If(KeyHit(1)) Then quit = True		
	Until quit
	;;;;;;
	End
End Function 

Function init()
Graphics SW,SH,0,WIN
;load all images here
;load all sounds here
;load all music here
HidePointer 
img.images = New images
img\img = LoadImage("images\knight1.png")
img\cat = CAT_FIGHTER

img.images = New images
img\img = LoadImage("images\ranger1.png")
img\cat = CAT_RANGER

img.images = New images
img\img = LoadImage("images\wizard1.png")
img\cat = CAT_WIZARD

img.images = New images
img\img = LoadImage("images\cleric1.png")
img\cat = CAT_CLERIC

img.images = New images
img\img = LoadImage("images\goblin1.png")
img\cat = 100 ;goblin 1

img.images = New images
img\img = LoadImage("images\goblin2.png")
img\cat = 101 ;goblin 2


img.images = New images
img\img = LoadImage("images\btnplay.png")
img\cat = CAT_MENU_PLAY

img.images = New images
img\img = LoadImage("images\btnaudio.png")
img\cat = CAT_MENU_AUDIO

img.images = New images
img\img = LoadImage("images\cursor.png")
img\cat = CAT_MENU_MOUSE_CURSOR

img.images = New images
img\img = LoadImage("images\btnskip.png")
img\cat = CAT_MENU_SKIP_CUTSCENE

;we don't have backgrounds yet so create them on the fly for now
img.images = New images
img\img = CreateImage(SW,SH)
SetBuffer ImageBuffer(img\img)
For i = 1 To 100
	Color 100,100,100
	Oval Rand(SW),Rand(SH),100,100,1
Next
SetBuffer BackBuffer()
img\cat = 2000

End Function 

Function handlemenu()
;;;
;;;;
;;;Check if 'PLAY' pressed..if so then initialise
;first cut scene and change gamemode
;;;Check if 'TOGGLE AUDIO' pressed if so toggle music/audio flags

If lmb&lt;&gt;0 Then 
	If mx&gt;=1000 And mx&lt;=1200 Then 
		If my&gt;500 And my&lt;550 Then 
			;play hit
			initstartgame()
			gamemode = MODE_CUTSCENE
		EndIf 
		If my&gt;600 And my&lt;650 Then 
			audiostate = Not audiostate
			If Not audiostate
				;stop music
					
			EndIf 
		EndIf 
	EndIf 
EndIf 


End Function

Function drawmenu()
;draw backdrop
;draw buttons in relevant state
;draw mouse cursor

For img.images = Each images
	If img\cat = 2000 Then 
		DrawBlock img\img,0,0
	EndIf 
Next

For img.images = Each images
	If img\cat = CAT_MENU_PLAY
		DrawImage img\img,1000,500
	EndIf
	If img\cat = CAT_MENU_AUDIO
		DrawImage img\img,1000,600
	EndIf
Next

For img.images = Each images
	If img\cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img\img,mx,my
	EndIf
Next

End Function

Function handleinput()
;assign tx,ty of creatures to player units
;
acted = False
If lmb&lt;&gt;0 Then 
	For pc.creature = Each creature
		If pc\hp&gt;0 And pc\cat&gt;=10 And pc\cat&lt;=13 Then 
			If mx&gt;pc\x - ImageWidth(pc\img)/2 And mx&lt;pc\x + ImageWidth(pc\img)/2 And my&gt;pc\y-40 And my&lt;pc\y+40 Then 
				pc\waitcount = pc\waitcount + 1
				acted = True
				If pc\waitcount &gt; 3 Then pc\waitcount = 3
				If pc\cat = CAT_FIGHTER
					For a.creature = Each creature
						If a\cat &gt;= 100 And a\hp &gt; 0 Then 
							dieroll = Rand(1,1000)
							If dieroll &lt; pc\skill Then 
								a\hp = a\hp - pc\damage
							EndIf 
						EndIf 
					Next
				EndIf
				If pc\cat = CAT_RANGER
					maxhp = 0
					b.creature = Null;
					For a.creature = Each creature
						If a\cat &gt;= 100 And a\hp &gt; 0 Then 
							If a\hp &gt; maxhp Then 
								maxhp = a\hp
								b.creature = a.creature
							EndIf 
						EndIf 
					Next
					If b.creature&lt;&gt;Null Then 
						dieroll = Rand(1,1000)
						If dieroll &lt; pc\skill Then 
							b\hp = b\hp - pc\damage
						EndIf 
					EndIf 
				EndIf
				If pc\cat = CAT_WIZARD
					pc\waitcount = pc\waitcount - 1
					If pc\waitcount &lt; 0 Then pc\waitcount = 0
					damage = pc\damage * (pc\waitcount+1)
					For a.creature = Each creature
						If a\cat &gt;= 100 And a\hp &gt; 0 Then 
							dieroll = Rand(1,1000)
							If dieroll &lt; pc\skill Then 
								a\hp = a\hp - damage
							EndIf 
						EndIf 
					Next

				EndIf
				If pc\cat = CAT_CLERIC
					pc\waitcount = pc\waitcount - 1
					If pc\waitcount &lt; 0 Then pc\waitcount = 0
					damage = pc\damage * (pc\waitcount + 1)
					For a.creature = Each creature
						If a\cat &lt; 100 And a\hp &lt; a\fullhp And a\hp &gt; 0 Then 
							a\hp = a\hp + damage
							a\healingtime = 60
							If a\hp &gt; a\fullhp Then a\hp = a\fullhp
						EndIf 
					Next
				EndIf	
			EndIf 
		EndIf 
	Next
EndIf 
If acted
	For a.creature = Each creature
		If a\hp &gt; 0 And a\cat &gt;= 100 Then 
			dieroll = Rand(1,1000)
			If dieroll &lt; a\skill Then 
				count = 0
				For pc.creature = Each creature
					If pc\cat &lt; 100 And pc\hp &gt; 0 Then count = count + 1
				Next
				If count &gt; 0 Then 
					count = Rand(1,count)
					For pc.creature = Each creature
						If pc\cat &lt; 100 And pc\hp &gt; 0 Then count = count - 1
						If count = 0 Then 
							pc\hp = pc\hp - a\damage
							Exit 
						EndIf 
					Next
				EndIf 
			EndIf 
		EndIf 
	Next
EndIf

End Function

Function updategame()
;move all creatures
;move all bullets
;handle all collisions
;handle all pick ups
;handle all combat
;handle all spell casting (magic missiles and healing)

found = False

For pc.creature = Each creature
	If pc\hp&gt;0 Then 
		If pc\cat &gt;= 100 Then 
			found = True
			pc\aidelay=pc\aidelay-1
			switchon = False
			If pc\aidelay&lt;=0 Then 
				pc\aidelay = pc\aitime
				pc\aimode = Rand(-2,3)
				If pc\aimode &lt; 0 Then pc\aimode = 0
				If pc\aimode &gt; 1 Then pc\aimode = 1
				switchon = True
			EndIf 
			If pc\aimode = AI_WANDER Then 
					If switchon
						pc\tx = Rand(-600,600)+pc\x
						pc\ty = Rand(-600,600)+pc\y
						If pc\tx &lt; 0 Then pc\tx = 0
						If pc\ty &lt; 0 Then pc\ty = 0
						If pc\tx &gt; SW - 1 Then pc\tx = SW-1
						If pc\ty &gt; SH - 1 Then pc\tx = SH-1
					EndIf
			Else
				For a.creature = Each creature
					If a\cat &lt; 100 And a\hp&gt;0 Then 
						pc\tx = a\x
						pc\ty = a\y
						Exit 
					EndIf 
				Next
			EndIf 
		EndIf 
		dx = Sgn((pc\tx - pc\x)/(pc\speed*2))*pc\speed
		dy = Sgn((pc\ty - pc\y)/(pc\speed*2))*pc\speed
		If Abs(pc\tx-pc\x)&lt;pc\speed * 4 Then dx = 0
		If Abs(pc\ty-pc\y)&lt;pc\speed * 4 Then dy = 0
		dx = 0
		dy = 0
		pc\moving = False
		nx = pc\x + dx
		ny = pc\y + dy
		wallcollide = False
		;if nx&gt;=0 and nx&lt;SW and ny&gt;=0 and ny&lt;SH
		;	if wallmap(nx,ny)=1 then 
		;		wallcollide = true
		;	endif
		;endif
		If Not wallcollide Then 
			pccollide = False
			For a.creature = Each creature
				If a&lt;&gt;pc Then 
					If a\hp &gt; 0 Then 
						If Abs(a\x-nx)&lt;30 And Abs(a\y-ny)&lt;30 Then 
							pccollide = True						
							Exit 
						EndIf 
					EndIf 
				EndIf 
			Next
			If Not pccollide Then 
				If nx &lt; 0 Then nx = 0
				If ny &lt; 0 Then ny = 0
				If nx &gt; SW - 1 Then nx = SW - 1
				If ny &gt; SH - 1 Then ny = SH - 1
				pc\x = nx
				pc\y = ny
				If dx&lt;&gt;0 Or dy&lt;&gt;0 Then pc\moving = True		
			Else
				pc\tx = pc\x + Rand(-100,100)
				pc\ty = pc\y + Rand(-100,100)
				If pc\tx &lt; 0 Then pc\tx = 0
				If pc\ty &lt; 0 Then pc\ty = 0
				If pc\tx &gt; SW - 1 Then pc\tx = SW - 1
				If pc\ty &gt; SH - 1 Then pc\ty = SH - 1
			EndIf 
		EndIf
	Else
		Delete pc
	EndIf 
Next
For b.bullet = Each bullet
	b\life=b\life-1
	b\x = b\x + b\vx
	b\y = b\y + b\vy
	;check collisions with walls 
	If b\x &gt;=0 And b\y&gt;=0 And b\x &lt; SW And b\y&lt;SH Then 
		;if wallmap(b\x,b\y)=1 then 
		;	b\life = 0
		;endif 
		For a.creature = Each creature
			If b\team = TEAM_PLAYER And a\cat &gt;= 100 Then 
				If Abs(b\x - a\x) &lt; 20 And Abs(b\y - a\y) &lt; 20 Then 
					b\life = 0
					a\hp = a\hp - b\damage	
				EndIf 
			ElseIf b\team = TEAM_MONSTER And a\cat &lt; 100 Then 
				If Abs(b\x - a\x) &lt; 20 And Abs(b\y - a\y) &lt; 20 Then 
					b\life = 0
					a\hp = a\hp - b\damage	
				EndIf 
			EndIf 
		Next
	Else
		b\life = 0
	EndIf 
	;check collisions with other creatures
	
	If b\life &lt;=0 Then Delete b
Next
If found = False Then 
	levelfinishtime = levelfinishtime + 1
EndIf 
If levelfinishtime &gt; 250 Then 
	gamemode = MODE_MENU ;eventually change to mode_upgrade
EndIf 
For pc.creature = Each creature
	If pc\hp &gt; 0 Then 
		If pc\healingtime &gt; 0 Then pc\healingtime = pc\healingtime - 1
	EndIf 
Next

End Function

Function drawgame()
;draw background (fixed static 1280x720 image background)
;draw all creatures - don't worry about zordering them - it will be too fast to notice 
;draw all bullets
For img.images = Each images
	If img\cat = 2001 ;change this later
		DrawBlock img\img,0,0
	EndIf
Next
Color 180,180,180
For x = 0 To SW/20 - 1
	For y = 0 To SH/12 - 1
		If blockmap(x,y)=1 Then 
			Rect x*20,y*12,20,12,1
		EndIf 
	Next
Next
For pc.creature = Each creature
	If pc\hp &gt; 0 Then 
		If pc\moving Then 
			aa = 4.0 * Sin(MilliSecs()*2)
		Else
			aa = 0
		EndIf 
		DrawImage pc\img,pc\x - ImageWidth(pc\img)/2,pc\y - 40 + aa
		dhp = 10 * pc\hp / pc\fullhp
		If dhp &lt; 4 Then Color 255,32,32
		If dhp &gt;=4 And dhp&lt;8 Then Color 255,255,32
		If dhp &gt;=8 Then Color 32,255,32
		For hp = 1 To 10 * pc\hp / pc\fullhp
			Rect hp*4 + pc\x - ImageWidth(pc\img)/3,pc\y - 50,3,3,1
		Next
		If pc\healingtime &gt; 0 Then 
			Color 32,255,255
			For i = 1 To 10
				x = pc\x - ImageWidth(pc\img)/2 + Rand(60)
				y = pc\y - 40 + aa + Rand(80)
				dd = Rand(2,8)
				Oval x,y,dd,dd,1
			Next
		EndIf 
		If pc\waitcount &gt; 0 Then 
			Color 255,255,32
			For i = 1 To pc\waitcount
				Rect i * 4 + pc\x - ImageWidth(pc\img)/3,pc\y - 45,3,3,1
			Next
		EndIf 
	EndIf
Next
Color 255,255,0
For b.bullet = Each bullet
	If b\life &gt; 0  Then 
		If b\img=0 Then 
			Oval b\x,b\y,10,10,1	
		Else
			DrawImage b\img,b\x,b\y
		EndIf 
	EndIf
Next
Color 255,255,255
For img.images = Each images
	If img\cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img\img,mx,my
	EndIf
Next


End Function 

Function handlecutscene()
;handle transitions,  handle skip button; 
;handle fading in and out text (bitmap fonts?)

If lmb&lt;&gt;0 Then 
	If mx&gt;1000 And mx&lt;1200 And my&gt;600 And my&lt;650 Then 
		initlevel()
		gamemode = MODE_COMBAT
	EndIf 
EndIf 

End Function 

Function drawcutscene()
;draw cut scene background, draw transition, draw skip button
For img.images = Each images
	If img\cat = 2000 Then 
		DrawBlock img\img,0,0
	EndIf 
Next

For img.images = Each images
	If img\cat = CAT_MENU_SKIP_CUTSCENE
		DrawImage img\img,1000,600
	EndIf
Next

For img.images = Each images
	If img\cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img\img,mx,my
	EndIf
Next

End Function 

Function handleupgrade()
;handle button press 'add stuff' to characters
;
;
;
End Function

Function drawupgrade()
;draw background
;draw buttons
;draw characters
;draw stats
;draw continue button

End Function 

Function initstartgame()
Delete Each creature
pc.creature = New creature
pc\fullhp = 80
pc\hp = 80
pc\cat = CAT_FIGHTER
pc\x = 600
pc\y = 300
pc\tx = pc\x
pc\ty = pc\y
pc\skill = 30
pc\damage = 20
pc\speed = 4.0
For img.images = Each images
	If img\cat = CAT_FIGHTER Then 
		pc\img = img\img
		Exit 
	EndIf 
Next
pc.creature = New creature
pc\fullhp = 60
pc\hp = 60
pc\cat = CAT_RANGER
pc\x = 640
pc\y = 300
pc\tx = pc\x
pc\ty = pc\y
pc\skill = 50
pc\damage = 25
pc\speed = 5.0
For img.images = Each images
	If img\cat = CAT_RANGER Then 
		pc\img = img\img
		Exit 
	EndIf 
Next
pc.creature = New creature
pc\fullhp = 30
pc\hp = 30
pc\cat = CAT_WIZARD
pc\x = 600
pc\y = 360
pc\tx = pc\x
pc\ty = pc\y
pc\skill = 25
pc\damage = 10
pc\speed = 5.0
For img.images = Each images
	If img\cat = CAT_WIZARD Then 
		pc\img = img\img
		Exit 
	EndIf 
Next
pc.creature = New creature
pc\fullhp = 50
pc\hp = 50
pc\cat = CAT_CLERIC
pc\x = 640
pc\y = 350
pc\tx = pc\x
pc\ty = pc\y
pc\skill = 20
pc\damage = 10
pc\speed = 4.0
For img.images = Each images
	If img\cat = CAT_CLERIC Then 
		pc\img = img\img
		Exit 
	EndIf 
Next
End Function 

Function initlevel()
Dim wallmap(SW,SH)
Dim blockmap(SW/20,SH/12)
For pc.creature = Each creature
	If pc\hp &gt; 0 And pc\hp &lt; pc\fullhp Then pc\hp = pc\fullhp
	If pc\cat = CAT_FIGHTER
		pc\x = 300
		pc\y = 400
	EndIf
	If pc\cat = CAT_RANGER
		pc\x = 400
		pc\y = 400
	EndIf
	If pc\cat = CAT_WIZARD
		pc\x = 450
		pc\y = 400
	EndIf
	If pc\cat = CAT_CLERIC
		pc\x = 500
		pc\y = 400
	EndIf
	pc\x = pc\x + 200
	pc\tx = pc\x
	pc\ty = pc\y
	If pc\cat &gt;=100 Then Delete pc
Next

For i = 1 To 8
	pc.creature = New creature
	pc\x = 300 + i * 80;Rand(0,SW)
	pc\y = 200 ;Rand(0,SH)
	pc\tx = pc\x
	pc\ty = pc\y
	pc\cat = 100+Rand(0,1)
	pc\hp = 50
	pc\fullhp = 50
	pc\speed = 3
	pc\damage = 5
	pc\skill = 20
	
	pc\aimode = AI_WANDER
	pc\aitime = 250 + Rand(100)
	pc\aidelay = Rand(pc\aitime/10)
	For img.images = Each images
		If img\cat = pc\cat Then 
			pc\img = img\img
			Exit 
		EndIf 
	Next
Next

lmb = 0
olmb = 0
FlushMouse()
levelfinishtime = 0
End Function 
</textarea><br><br>Okay the plan when I get home from work tonight after I cook tea will be to develop the turn based version further.<br><br>I'll neaten up the code, add a few more monster types, get the basics of the gameplay loop working nicely, do some initial balancing and play testing and see how it feels.<br><br>I might add some rough loose pixelly effects for spell effects and so on - these may be tricky to do in blitzmax because I don't believe you have the writepixel buffer commands..I might use rects then or ovals to do it....eventually it will be with proper alphaed images though...for now will just use rects and ovals.<br><br>I will add a loose particle engine as well...very simple...basically a point emitter.<br><br>I'm looking forward to this...<br><br>I won't touch the 'upgrade' character stage of the game loop for a few more days I think...<br><br>Might redraw the knight and fix the alpha on the goblin and the knight (blitzplus uses black as transparent...blitzmax uses alpha...) <br><br></td></tr></table><br>
<a name="1341136"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rooster</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#54">[#54]</a></td></tr></table></td></tr><tr ><td class="posttext"> I was thinking; both ideas have advantages, a turn based style would be good for a tough fight. <br>Whereas using real time would be great for less dangerous of run of the mill fights.<br>I don't know how hard this would be to do in the code, but maybe it can be made so the player can switch freely between the two.<br>Sort of a sub-mode for the arcade mode.<br><br>And I'm off to bed now.<br>Good night. :) <br><br></td></tr></table><br>
<a name="1341140"></a>

<a name="1341143"></a>

<a name="1341144"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#55">[#55]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Rooster...I'm curious as to what time zone you are in - I'm in Australia - it's 11 hours after GMT (so 6pm) here....<br><br>Good night...<br><br>here's an update which has the turn based method in a bit more detail now...<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
;This is both a learning exercise and hopefully a collaborative project of sorts
;or at least a project I can share with others on the blitz forum.
;It will be written initially in blitzplus/blitz3d and maybe someone will be keen on
;porting it to blitzmax...even blitzmax-ng to release on mobile perhaps?
;
;Interface:
;Left mouse button clicking only to make porting to 
;mobile interface much, much easier.
;Gameplay mechanic so far (15-May-2017)
;
;1. Arcade Action RPG Combat
;	Player controls 4 characters in a single screen dungeon.
;	Dungeon has a few walls and so on that prevent movement.
;	Monsters spawn from spawners and make their way around the map
;	Player taps the screen to move to location and characters fight things
;	in their path.
;	Powerups exist in the level such as:
;	Health pickups
;	Bombs - kill all monsters that have spawned or at least damage them.
;	
;2. After the arcade sequence the player is presented with options to upgrade their
;	character's stats. Stats to upgrade include:
;	Combat skill ('to hit roll')
;	Damage output ('damage points')
;	Health points ('hp')
;	Movement speed ('move')
;3.	After this a short cut scene is presented which may simply be a scrolling static
;	image with some fading in/fading out text to advance the story line
;0. Menu - toggle audio, play, credits
;
;Character types:
;1 Fighter - high hitpoint melee combat medium damage
;2 Ranger - medium hitpoint melee combat high damage
;3 Wizard - low hitpoint, ranged combat, medium damage
;4 Cleric - medium hitpoint, no combat, healer
;


;constants
Const SW=1280,SH=720,WIN=2
Const MODE_MENU = 0
Const MODE_COMBAT = 1
Const MODE_UPGRADE = 2
Const MODE_CUTSCENE = 3
Const PURE_2D = True ;if go to blitzmax can use 2d-in-3d commands such as alpha otherwise have to calculate manually.Change to false for blitzmax.

;categories for image types and object types
Const CAT_MENU_PLAY = 0
Const CAT_MENU_AUDIO = 1
Const CAT_MENU_SKIP_CUTSCENE = 2 ;cut scene mode
Const CAT_MENU_ADD_SKILL = 3 ;upgrade mode
Const CAT_MENU_ADD_DAMAGE = 4;upgrade mode
Const CAT_MENU_ADD_HEALTH = 5;upgrade mode
Const CAT_MENU_ADD_SPEED = 6;
Const CAT_MENU_MOUSE_CURSOR = 7;
Const CAT_FIGHTER = 10
Const CAT_KNIGHT = 10 ;synonym
Const CAT_RANGER = 11
Const CAT_WIZARD = 12
Const CAT_CLERIC = 13
Const CAT_HEALER = 13 ;synonym
Const CAT_HEALTH_PICKUP = 20
Const CAT_BOMB_PICKUP = 21
;CAT_BACKGROUND = 2000-3000 ; all the different image backgrounds
;CAT_MONSTER = 100-1000 , all the different monster types

Const AI_WANDER = 0
Const AI_ATTACK = 1

Const TEAM_PLAYER = 0
Const TEAM_MONSTER = 1

;globals
Global mx,my,lmb,olmb ;mouse input
Global audiostate ;on/off
Global gamemode ;references const above
Global gamelevel ;for cutscenes
Global cutsceneframe ;for cutscenes ie trigger fades, text, motion etc on certain frames
Global levelfinishtime = 0

;arrays
Dim wallmap(0,0) ;0/1 value at each element indicates whether wall is there or not - redimension later
Dim blockmap(0,0) ;0/1 value - bigger version of wallmap lower resolution
;types
Type images

Field img ;handle
Field midhandled ;boolean
Field cat ;category //hooks into creature template

End Type 

Type creaturetemplate

Field img ;img handle
Field cat ;category
Field fullhp ;n (values range from about 10 to 200 for high level characters and monsters)
Field combatskill ;1-1000 (percentile out of a 1000 not 100) (roll under to hit/roll under to cast)
Field speed# ;n.m (movement speed)
Field damage ;n (damage per hit, also equal to hitpoints to heal per successful cast)

End Type 

Type bullet

Field img ;handle of image
Field team ;players or monsters - so no friendly fire
Field x#
Field y#
Field vx#
Field vy#
Field life
Field damage ;damage to inflict per hit then disappear

End Type

Type spawner

Field img
Field cat ;category to spawn
Field x
Field y
Field hp
Field timetospawn ;frames to count down from when respawning
Field spawndelay ;current frame count on spawner 0 to 'timetospawn'.

End Type 

Type creature

Field img
Field cat
Field x#
Field y#
Field tx#
Field ty#
Field hp
Field fullhp
Field speed#
Field damage
Field skill

Field defenseskill ;for players

Field aimode
Field aidelay
Field aitime

Field moving ;boolean

Field healingtime ;for healing effect/buff effect
Field lightningtime ;for lightning blasts on creature effect
Field strucktime ;for blood effects
Field attacktime 

Field activated ;boolean
Field waitcount ;int


End Type 

Type menubutton

Field cat ;for menu buttons
Field img
Field x
Field y
Field w
Field h
Field state ;pressed/not pressed

End Type 

Type cutscene

Field cat
Field img
Field x
Field y
Field levelnum ;for the specific level num
Field upperframe ;for the upper limit on the frame number to show this image for
Field transitiontype ;define later for transitioning between frames...do all this in code 

End Type 

;new emitters and particles
Type particle

Field r,g,b,a
Field x#,y#,vx#,vy#,ay#,gy#
Field life
Field dr,dg,db,da
Field sz,dsz

End Type



main()

Function main()
	quit = False
	gamemode = MODE_MENU
	init()
	Repeat
		frametime = MilliSecs()
		Cls
		;input 
		mx = MouseX()
		my = MouseY()
		olmb = lmb
		lmb = MouseDown(1)
		Select gamemode
		
		Case MODE_MENU
			handlemenu()
			drawmenu()
		
		Case MODE_COMBAT
			handleinput()
			updategame()
			drawgame()
		Case MODE_CUTSCENE
			handlecutscene()
			drawcutscene()
		Case MODE_UPGRADE
			handleupgrade()
			drawupgrade()
		End Select
		
		Flip
		;very basic frame limiting
		endframetime = MilliSecs()
		dtime = endframetime - frametime
		If dtime &lt; 15 Then 
			Delay 15 - dtime
		EndIf 
		;end of frame limiting
		If(KeyHit(1)) Then quit = True		
	Until quit
	;;;;;;
	End
End Function 

Function init()
Graphics SW,SH,0,WIN
;load all images here
;load all sounds here
;load all music here
HidePointer 
img.images = New images
img\img = LoadImage("images\knight1.png")
img\cat = CAT_FIGHTER

img.images = New images
img\img = LoadImage("images\ranger1.png")
img\cat = CAT_RANGER

img.images = New images
img\img = LoadImage("images\wizard1.png")
img\cat = CAT_WIZARD

img.images = New images
img\img = LoadImage("images\cleric1.png")
img\cat = CAT_CLERIC

img.images = New images
img\img = LoadImage("images\goblin1.png")
img\cat = 100 ;goblin 1

img.images = New images
img\img = LoadImage("images\goblin2.png")
img\cat = 101 ;goblin 2


img.images = New images
img\img = LoadImage("images\btnplay.png")
img\cat = CAT_MENU_PLAY

img.images = New images
img\img = LoadImage("images\btnaudio.png")
img\cat = CAT_MENU_AUDIO

img.images = New images
img\img = LoadImage("images\cursor.png")
img\cat = CAT_MENU_MOUSE_CURSOR

img.images = New images
img\img = LoadImage("images\btnskip.png")
img\cat = CAT_MENU_SKIP_CUTSCENE

;we don't have backgrounds yet so create them on the fly for now
img.images = New images
img\img = CreateImage(SW,SH)
SetBuffer ImageBuffer(img\img)
For i = 1 To 100
	Color 100,100,100
	Oval Rand(SW),Rand(SH),100,100,1
Next
SetBuffer BackBuffer()
img\cat = 2000

End Function 

Function handlemenu()
;;;
;;;;
;;;Check if 'PLAY' pressed..if so then initialise
;first cut scene and change gamemode
;;;Check if 'TOGGLE AUDIO' pressed if so toggle music/audio flags

If lmb&lt;&gt;0 Then 
	If mx&gt;=1000 And mx&lt;=1200 Then 
		If my&gt;500 And my&lt;550 Then 
			;play hit
			initstartgame()
			gamemode = MODE_CUTSCENE
		EndIf 
		If my&gt;600 And my&lt;650 Then 
			audiostate = Not audiostate
			If Not audiostate
				;stop music
					
			EndIf 
		EndIf 
	EndIf 
EndIf 


End Function

Function drawmenu()
;draw backdrop
;draw buttons in relevant state
;draw mouse cursor

For img.images = Each images
	If img\cat = 2000 Then 
		DrawBlock img\img,0,0
	EndIf 
Next

For img.images = Each images
	If img\cat = CAT_MENU_PLAY
		DrawImage img\img,1000,500
	EndIf
	If img\cat = CAT_MENU_AUDIO
		DrawImage img\img,1000,600
	EndIf
Next

For img.images = Each images
	If img\cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img\img,mx,my
	EndIf
Next

End Function

Function handleinput()
;assign tx,ty of creatures to player units
;
acted = False
If lmb&lt;&gt;0 And olmb = 0 Then 
	For pc.creature = Each creature
		If pc\hp&gt;0 And pc\cat&gt;=10 And pc\cat&lt;=13 Then 
			If mx&gt;pc\x - ImageWidth(pc\img)/2 And mx&lt;pc\x + ImageWidth(pc\img)/2 And my&gt;pc\y-40 And my&lt;pc\y+40 Then 
				For a.creature = Each creature
					If a\hp&gt;0 And a\cat&lt;100 Then a\waitcount = a\waitcount + 1
					If a\waitcount &gt; 3 Then a\waitcount = 3
				Next
				acted = True
				If pc\cat = CAT_FIGHTER
					pc\attacktime = 30
					For a.creature = Each creature
						If a\cat &gt;= 100 And a\hp &gt; 0 Then 
							dieroll = Rand(1,1000)
							If dieroll &lt; pc\skill Then 
								a\hp = a\hp - pc\damage
								a\strucktime = 10
							EndIf 
						EndIf 
					Next
					pc\waitcount = 0
				EndIf
				If pc\cat = CAT_RANGER
					maxhp = 0
					b.creature = Null;
					pc\attacktime = 30
					For a.creature = Each creature
						If a\cat &gt;= 100 And a\hp &gt; 0 Then 
							If a\hp &gt; maxhp Then 
								maxhp = a\hp
								b.creature = a.creature
							EndIf 
						EndIf 
					Next
					If b.creature&lt;&gt;Null Then 
						dieroll = Rand(1,1000)
						If dieroll &lt; pc\skill Then 
							b\hp = b\hp - pc\damage * (1 + pc\waitcount)
							b\strucktime = 15
						EndIf 
					EndIf 
					pc\waitcount = 0
				EndIf
				If pc\cat = CAT_WIZARD
					pc\attacktime = 30
					damage = pc\damage * (pc\waitcount+1)
					For a.creature = Each creature
						If a\cat &gt;= 100 And a\hp &gt; 0 Then 
							dieroll = Rand(1,1000)
							If dieroll &lt; pc\skill Then 
								a\hp = a\hp - damage
								a\lightningtime = 30
								a\strucktime = 20
							Else
								pc\hp = pc\hp - 5 ; bad spell casting inflicts damage to caster
								pc\lightningtime = 30
								Exit
							EndIf 
						EndIf 
					Next
					pc\waitcount = 0
				EndIf
				If pc\cat = CAT_CLERIC
					pc\attacktime = 30
					damage = pc\damage * (pc\waitcount + 1)
					For a.creature = Each creature
						If a\cat &lt; 100 And a\hp &lt; a\fullhp And a\hp &gt; 0 Then 
							a\hp = a\hp + damage
							a\healingtime = 60
							If a\hp &gt; a\fullhp Then a\hp = a\fullhp
						EndIf 
					Next
					pc\waitcount = 0
				EndIf	
			EndIf 
		EndIf 
	Next
EndIf 
If acted
	For a.creature = Each creature
		If a\hp &gt; 0 And a\cat &gt;= 100 Then 
			count = 0
			For pc.creature = Each creature
				If pc\cat &lt; 100 And pc\hp &gt; 0 Then count = count + 1
			Next
			If count &gt; 0 Then 
				count = Rand(1,count)
				For pc.creature = Each creature
					If pc\cat &lt; 100 And pc\hp &gt; 0 Then count = count - 1
					If count = 0 Then 
						dieroll = Rand(1,1000)
						If dieroll &gt; pc\defenseskill Then 
							pc\hp = pc\hp - a\damage
							pc\strucktime = 10
							a\attacktime = 30
						EndIf
						Exit 
					EndIf 
				Next
			EndIf 
		EndIf 
	Next
EndIf
End Function

Function updategame()
;move all creatures
;move all bullets
;handle all collisions
;handle all pick ups
;handle all combat
;handle all spell casting (magic missiles and healing)

found = False

For pc.creature = Each creature
	If pc\strucktime &gt; 0 Then 
		pc\strucktime = pc\strucktime - 1
		createbloodparticle(pc\x,pc\y)
		If pc\hp &lt;= 0 Then 
			createbloodparticle(pc\x,pc\y)
			createbloodparticle(pc\x,pc\y)
			createbloodparticle(pc\x,pc\y)
		EndIf 
	EndIf 
	If pc\hp&gt;0 Then 
		If pc\cat &gt;= 100 Then 
			found = True
		EndIf
	Else
		Delete pc
	EndIf 
Next
If found = False Then 
	levelfinishtime = levelfinishtime + 1
EndIf 
foundp = False
For pc.creature = Each creature
	If pc\hp &gt; 0 And pc\cat &lt; 100 Then foundp = True:Exit 
Next
If foundp = False Then 
	levelfinishtime = levelfinishtime + 1
EndIf 
If levelfinishtime &gt; 250 Then 
	gamemode = MODE_MENU ;eventually change to mode_upgrade
	If foundp Then gamemode = MODE_UPGRADE
EndIf 

For pc.creature = Each creature
	If pc\hp &gt; 0 Then 
		If pc\healingtime &gt; 0 Then pc\healingtime = pc\healingtime - 1
	EndIf 
Next
updateparticle()
End Function

Function drawgame()
;draw background (fixed static 1280x720 image background)
;draw all creatures - don't worry about zordering them - it will be too fast to notice 
;draw all bullets
For img.images = Each images
	If img\cat = 2001 ;change this later
		DrawBlock img\img,0,0
	EndIf
Next
For pc.creature = Each creature
	If pc\hp &gt; 0 Then
		aa# = 0
		bb# = 0
		If pc\attacktime &gt; 0 Then 
			pc\attacktime = pc\attacktime - 1
			aa# = -25.0 * Sin(pc\attacktime * 6)
			If pc\cat&gt;=100 Then aa = aa * -1.0
		EndIf 
		If pc\strucktime &gt; 0 Then 
			bb = Rand(-pc\strucktime/2,pc\strucktime/2)
		EndIf 
		DrawImage pc\img,bb + pc\x - ImageWidth(pc\img)/2,pc\y - 40 + aa
		dhp = 10 * pc\hp / pc\fullhp
		If dhp &lt; 4 Then Color 255,32,32
		If dhp &gt;=4 And dhp&lt;8 Then Color 255,255,32
		If dhp &gt;=8 Then Color 32,255,32
		If dhp = 0 Then dhp = 1
		For hp = 1 To dhp
			Rect hp*4 + pc\x - ImageWidth(pc\img)/3,pc\y - 50,3,3,1
		Next
		If pc\healingtime &gt; 0 Then 
			;Color 32,255,255
			;For i = 1 To 10
			;	x = pc\x - ImageWidth(pc\img)/2 + Rand(60)
			;	y = pc\y - 40 + aa + Rand(80)
			;	dd = Rand(2,8)
			;	Oval x,y,dd,dd,1
			;Next
			createhealparticle(pc\x,pc\y)
		EndIf 
		If pc\lightningtime &gt; 0 Then 
			pc\lightningtime = pc\lightningtime - 1
			drawlightning(pc\x,pc\y)
		EndIf 
		If pc\waitcount &gt; 0 Then 
			Color 255,32,255
			For i = 1 To pc\waitcount
				Rect i * 4 + pc\x - ImageWidth(pc\img)/3,pc\y - 55,3,3,1
			Next
		EndIf 
	EndIf
Next
drawparticle()
Color 255,255,255
For img.images = Each images
	If img\cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img\img,mx,my
	EndIf
Next


End Function 

Function drawlightning(x,y)

iy = 0
ix = x + Rand(-20,20)
While iy &lt; y
oy = iy
ox = ix
ix = x + Rand(-20,20)
iy = iy + Rand(10,25)
Color 200,200,255
Line ox,oy,ix,iy
Color 150,150,200
Line ox+1,oy+1,ix+1,iy+1
Line ox-1,oy-1,ix-1,iy-1
Color 100,100,150
Line ox+2,oy+2,ix+2,iy+2
Line ox-2,oy-2,ix-2,iy-2
Color 32,32,90
Line ox+3,oy+3,ix+3,iy+3
Line ox-3,oy-3,ix-3,iy-3

Wend 

End Function 

Function handlecutscene()
;handle transitions,  handle skip button; 
;handle fading in and out text (bitmap fonts?)

If lmb&lt;&gt;0 Then 
	If mx&gt;1000 And mx&lt;1200 And my&gt;600 And my&lt;650 Then 
		initlevel()
		gamemode = MODE_COMBAT
	EndIf 
EndIf 

End Function 

Function drawcutscene()
;draw cut scene background, draw transition, draw skip button
For img.images = Each images
	If img\cat = 2000 Then 
		DrawBlock img\img,0,0
	EndIf 
Next

For img.images = Each images
	If img\cat = CAT_MENU_SKIP_CUTSCENE
		DrawImage img\img,1000,600
	EndIf
Next

For img.images = Each images
	If img\cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img\img,mx,my
	EndIf
Next

End Function 

Function handleupgrade()
;handle button press 'add stuff' to characters
;
;
;
If lmb&lt;&gt;0 Then 
	If mx &gt; 1000 And mx&lt;1200 And my&gt;600 And my &lt;650
		gamemode = MODE_CUTSCENE
	EndIf
EndIf


End Function

Function drawupgrade()
;draw background
;draw buttons
;draw characters
;draw stats
;draw continue button
For img.images = Each images
	If img\cat = 2000 Then 
	;	DrawBlock img\img,0,0
	EndIf 
Next

i=-1
For pc.creature = Each creature
	If pc\cat &lt; 100 And pc\hp &gt; 0 Then 
		pc\hp = pc\fullhp
		i = i + 1
		DrawImage pc\img,100,i * 100 + 200
		Text 150,i*100+200,"Skill:"+pc\skill+" Defense:"+pc\defenseskill + " Health:"+pc\fullhp + " Power:"+pc\damage
	EndIf 
Next


For img.images = Each images
	If img\cat = CAT_MENU_SKIP_CUTSCENE
		DrawImage img\img,1000,600
	EndIf
Next

Text 0,0,"On this screen you would upgrade some of your characters"

For img.images = Each images
	If img\cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img\img,mx,my
	EndIf
Next




End Function 

Function initstartgame()
Delete Each creature
pc.creature = New creature
pc\fullhp = 90
pc\hp = 90
pc\cat = CAT_FIGHTER
pc\x = 600
pc\y = 300
pc\tx = pc\x
pc\ty = pc\y
pc\skill = 100
pc\defenseskill = 850
pc\damage = 10
pc\speed = 4.0
For img.images = Each images
	If img\cat = CAT_FIGHTER Then 
		pc\img = img\img
		Exit 
	EndIf 
Next
pc.creature = New creature
pc\fullhp = 75
pc\hp = 75
pc\cat = CAT_RANGER
pc\x = 640
pc\y = 300
pc\tx = pc\x
pc\ty = pc\y
pc\skill = 800
pc\defenseskill = 850
pc\damage = 50
pc\speed = 5.0
For img.images = Each images
	If img\cat = CAT_RANGER Then 
		pc\img = img\img
		Exit 
	EndIf 
Next
pc.creature = New creature
pc\fullhp = 45
pc\hp = 45
pc\cat = CAT_WIZARD
pc\x = 750
pc\y = 360
pc\tx = pc\x
pc\ty = pc\y
pc\skill = 650
pc\damage = 18
pc\speed = 5.0
pc\defenseskill = 500
For img.images = Each images
	If img\cat = CAT_WIZARD Then 
		pc\img = img\img
		Exit 
	EndIf 
Next
pc.creature = New creature
pc\fullhp = 60
pc\hp = 60
pc\cat = CAT_CLERIC
pc\x = 640
pc\defenseskill = 800
pc\y = 350
pc\tx = pc\x
pc\ty = pc\y
pc\skill = 100
pc\damage = 5
pc\speed = 4.0
For img.images = Each images
	If img\cat = CAT_CLERIC Then 
		pc\img = img\img
		Exit 
	EndIf 
Next
End Function 

Function initlevel()
Dim wallmap(SW,SH)
Dim blockmap(SW/20,SH/12)
For pc.creature = Each creature
	If pc\hp &gt; 0 And pc\hp &lt; pc\fullhp Then pc\hp = pc\fullhp
	If pc\cat = CAT_FIGHTER
		pc\x = 300
		pc\y = 400
	EndIf
	If pc\cat = CAT_RANGER
		pc\x = 375
		pc\y = 400
	EndIf
	If pc\cat = CAT_WIZARD
		pc\x = 450
		pc\y = 400
	EndIf
	If pc\cat = CAT_CLERIC
		pc\x = 500
		pc\y = 400
	EndIf
	pc\x = pc\x + 200
	pc\tx = pc\x
	pc\ty = pc\y
	If pc\cat &gt;=100 Then Delete pc
Next

For i = 1 To 8
	pc.creature = New creature
	pc\x = 300 + i * 80;Rand(0,SW)
	pc\y = 200 ;Rand(0,SH)
	pc\tx = pc\x
	pc\ty = pc\y
	pc\cat = 100+Rand(0,1)
	pc\hp = 70
	pc\fullhp = 50
	pc\speed = 3
	pc\damage = 5
	pc\skill = 80
	
	pc\aimode = AI_WANDER
	pc\aitime = 250 + Rand(100)
	pc\aidelay = Rand(pc\aitime/10)
	For img.images = Each images
		If img\cat = pc\cat Then 
			pc\img = img\img
			Exit 
		EndIf 
	Next
Next

lmb = 0
olmb = 0
FlushMouse()
levelfinishtime = 0
End Function 

Function createhealparticle(x,y)

For i = 1 To 36
	p.particle = New particle
	p\life = 20
	p\x = x + 25.0 * Cos(i*10)
	p\y = y + 20 + 25.0 * (Sin(i*5))
	p\vx = 0
	p\vy = Rand(-4,-2)
	p\ay = 0.1
	p\gy = p\y + 100
	p\r = 32
	p\g = 200
	p\b = 255
	p\sz = 4
	p\dsz = -0.1
	p\dr = 10
	p\dg = 2
	p\db = 0
Next

End Function 

Function createbloodparticle(x,y)

For i = 1 To 10
	p.particle = New particle
	p\life = 20
	p\x = x + Rand(-10,10)
	p\y = y + Rand(-10,10)
	p\vx = Rnd(-3,3)
	p\vy = Rnd(-3,3)
	p\ay = 0.05
	p\gy = y + 42
	p\r = 255
	p\g = 100
	p\b = 100
	p\dr = -2
	p\dg = -3
	p\db = -3
	p\sz = 4
	p\dsz = 0
Next

End Function 

Function updateparticle()
For p.particle = Each particle
	p\life = p\life - 1
	p\x = p\x + p\vx
	p\y = p\y + p\vy
	p\vy = p\vy + p\ay
	If p\y &gt; p\gy Then 
		p\vy = p\vy * -0.7
		If Abs(p\vy)&lt;0.01 Then p\life = 0
	EndIf 
	p\sz = p\sz + p\dsz
	p\r = p\r + p\dr
	p\g = p\g + p\dg
	p\b = p\b + p\db
	If p\sz &lt; 0 Then p\sz = 0
	If p\r &gt; 255 Then p\r = 255
	If p\g &gt; 255 Then p\g = 255
	If p\b &gt; 255 Then p\b = 255
	If p\r &lt; 0 Then p\r = 0
	If p\g &lt; 0 Then p\g = 0
	If p\b &lt; 0 Then p\b = 0
	If p\life &lt; 0 Then Delete p
Next
End Function 

Function drawparticle()
For p.particle = Each particle
	Color p\r,p\g,p\b
	Rect p\x,p\y,p\sz,p\sz,1
Next
Color 255,255,255
End Function 
</textarea> <br><br></td></tr></table><br>
<a name="1341149"></a>

<a name="1341152"></a>

<a name="1341154"></a>

<a name="1341155"></a>

<a name="1341156"></a>

<a name="1341157"></a>

<a name="1341158"></a>

<a name="1341161"></a>

<a name="1341162"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#56">[#56]</a></td></tr></table></td></tr><tr ><td class="posttext"> <strike>Two</strike> Six more graphics:<br><br>goblinshaman1.png<br><br><img src="http://www.mattiesgames.com/art/goblinshaman1.png"><br><br>troll1.png<br><br><img src="http://www.mattiesgames.com/art/troll1.png"><br><br>spiderbeast1.png<br><br><img src="http://www.mattiesgames.com/art/spiderbeast1.png"><br><br>giantspider1.png<br><br><img src="http://www.mattiesgames.com/art/giantspider1.png"><br><br>spiderwizard1.png<br><br><img src="http://www.mattiesgames.com/art/spiderwizard1.png"><br><br>spiderqueen1.png<br><br><img src="http://www.mattiesgames.com/art/spiderqueen1.png"><br><br>code Using new graphics:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
;This is both a learning exercise and hopefully a collaborative project of sorts
;or at least a project I can share with others on the blitz forum.
;It will be written initially in blitzplus/blitz3d and maybe someone will be keen on
;porting it to blitzmax...even blitzmax-ng to release on mobile perhaps?
;
;Interface:
;Left mouse button clicking only to make porting to 
;mobile interface much, much easier.
;Gameplay mechanic so far (15-May-2017)
;
;1. Arcade Action RPG Combat
;	Player controls 4 characters in a single screen dungeon.
;	Dungeon has a few walls and so on that prevent movement.
;	Monsters spawn from spawners and make their way around the map
;	Player taps the screen to move to location and characters fight things
;	in their path.
;	Powerups exist in the level such as:
;	Health pickups
;	Bombs - kill all monsters that have spawned or at least damage them.
;	
;2. After the arcade sequence the player is presented with options to upgrade their
;	character's stats. Stats to upgrade include:
;	Combat skill ('to hit roll')
;	Damage output ('damage points')
;	Health points ('hp')
;	Movement speed ('move')
;3.	After this a short cut scene is presented which may simply be a scrolling static
;	image with some fading in/fading out text to advance the story line
;0. Menu - toggle audio, play, credits
;
;Character types:
;1 Fighter - high hitpoint melee combat medium damage
;2 Ranger - medium hitpoint melee combat high damage
;3 Wizard - low hitpoint, ranged combat, medium damage
;4 Cleric - medium hitpoint, no combat, healer
;


;constants
Const SW=1280,SH=720,WIN=2
Const MODE_MENU = 0
Const MODE_COMBAT = 1
Const MODE_UPGRADE = 2
Const MODE_CUTSCENE = 3
Const PURE_2D = True ;if go to blitzmax can use 2d-in-3d commands such as alpha otherwise have to calculate manually.Change to false for blitzmax.

;categories for image types and object types
Const CAT_MENU_PLAY = 0
Const CAT_MENU_AUDIO = 1
Const CAT_MENU_SKIP_CUTSCENE = 2 ;cut scene mode
Const CAT_MENU_ADD_SKILL = 3 ;upgrade mode
Const CAT_MENU_ADD_DAMAGE = 4;upgrade mode
Const CAT_MENU_ADD_HEALTH = 5;upgrade mode
Const CAT_MENU_ADD_SPEED = 6;
Const CAT_MENU_MOUSE_CURSOR = 7;
Const CAT_FIGHTER = 10
Const CAT_KNIGHT = 10 ;synonym
Const CAT_RANGER = 11
Const CAT_WIZARD = 12
Const CAT_CLERIC = 13
Const CAT_HEALER = 13 ;synonym
Const CAT_HEALTH_PICKUP = 20
Const CAT_BOMB_PICKUP = 21
;CAT_BACKGROUND = 2000-3000 ; all the different image backgrounds
;CAT_MONSTER = 100-1000 , all the different monster types

Const AI_WANDER = 0
Const AI_ATTACK = 1

Const TEAM_PLAYER = 0
Const TEAM_MONSTER = 1

;globals
Global mx,my,lmb,olmb ;mouse input
Global audiostate ;on/off
Global gamemode ;references const above
Global gamelevel ;for cutscenes
Global cutsceneframe ;for cutscenes ie trigger fades, text, motion etc on certain frames
Global levelfinishtime = 0

;arrays
Dim wallmap(0,0) ;0/1 value at each element indicates whether wall is there or not - redimension later
Dim blockmap(0,0) ;0/1 value - bigger version of wallmap lower resolution
;types
Type images

Field img ;handle
Field midhandled ;boolean
Field cat ;category //hooks into creature template

End Type 

Type creaturetemplate

Field img ;img handle
Field cat ;category
Field fullhp ;n (values range from about 10 to 200 for high level characters and monsters)
Field combatskill ;1-1000 (percentile out of a 1000 not 100) (roll under to hit/roll under to cast)
Field speed# ;n.m (movement speed)
Field damage ;n (damage per hit, also equal to hitpoints to heal per successful cast)

End Type 

Type bullet

Field img ;handle of image
Field team ;players or monsters - so no friendly fire
Field x#
Field y#
Field vx#
Field vy#
Field life
Field damage ;damage to inflict per hit then disappear

End Type

Type spawner

Field img
Field cat ;category to spawn
Field x
Field y
Field hp
Field timetospawn ;frames to count down from when respawning
Field spawndelay ;current frame count on spawner 0 to 'timetospawn'.

End Type 

Type creature

Field img
Field cat
Field x#
Field y#
Field tx#
Field ty#
Field hp
Field fullhp
Field speed#
Field damage
Field skill

Field defenseskill ;for players

Field aimode
Field aidelay
Field aitime

Field moving ;boolean

Field healingtime ;for healing effect/buff effect
Field lightningtime ;for lightning blasts on creature effect
Field strucktime ;for blood effects
Field attacktime 

Field activated ;boolean
Field waitcount ;int

Field stunned ;int 0-n counts down each time active....

End Type 

Type menubutton

Field cat ;for menu buttons
Field img
Field x
Field y
Field w
Field h
Field state ;pressed/not pressed

End Type 

Type cutscene

Field cat
Field img
Field x
Field y
Field levelnum ;for the specific level num
Field upperframe ;for the upper limit on the frame number to show this image for
Field transitiontype ;define later for transitioning between frames...do all this in code 

End Type 

;new emitters and particles
Type particle

Field r,g,b,a
Field x#,y#,vx#,vy#,ay#,gy#
Field life
Field dr,dg,db,da
Field sz,dsz

End Type



main()

Function main()
	quit = False
	gamemode = MODE_MENU
	init()
	Repeat
		frametime = MilliSecs()
		Cls
		;input 
		mx = MouseX()
		my = MouseY()
		olmb = lmb
		lmb = MouseDown(1)
		Select gamemode
		
		Case MODE_MENU
			handlemenu()
			drawmenu()
		
		Case MODE_COMBAT
			handleinput()
			updategame()
			drawgame()
		Case MODE_CUTSCENE
			handlecutscene()
			drawcutscene()
		Case MODE_UPGRADE
			handleupgrade()
			drawupgrade()
		End Select
		
		Flip
		;very basic frame limiting
		endframetime = MilliSecs()
		dtime = endframetime - frametime
		If dtime &lt; 15 Then 
			Delay 15 - dtime
		EndIf 
		;end of frame limiting
		If(KeyHit(1)) Then quit = True		
	Until quit
	;;;;;;
	End
End Function 

Function init()
Graphics SW,SH,0,WIN
;load all images here
;load all sounds here
;load all music here
HidePointer 
img.images = New images
img\img = LoadImage("images\knight1.png")
img\cat = CAT_FIGHTER

img.images = New images
img\img = LoadImage("images\ranger1.png")
img\cat = CAT_RANGER

img.images = New images
img\img = LoadImage("images\wizard1.png")
img\cat = CAT_WIZARD

img.images = New images
img\img = LoadImage("images\cleric1.png")
img\cat = CAT_CLERIC

img.images = New images
img\img = LoadImage("images\goblin1.png")
img\cat = 100 ;goblin 1

img.images = New images
img\img = LoadImage("images\goblin2.png")
img\cat = 101 ;goblin 2

img.images = New images
img\img = LoadImage("images\troll1.png")
img\cat = 102 ;troll 1

img.images = New images
img\img = LoadImage("images\goblinshaman1.png")
img\cat = 103 ;goblin shaman

img.images = New images
img\img = LoadImage("images\giantspider1.png")
img\cat = 104 ;giant spider melee brute...

img.images = New images
img\img = LoadImage("images\spiderbeast1.png")
img\cat = 105 ;spider beast

img.images = New images
img\img = LoadImage("images\spiderwizard1.png")
img\cat = 106 ;spider wizard - stuns enemy units (reduces skill)

img.images = New images
img\img = LoadImage("images\spiderqueen1.png")
img\cat = 107 ;spider queen - stuns spell casters (reduces waitcount) and melee unit


img.images = New images
img\img = LoadImage("images\btnplay.png")
img\cat = CAT_MENU_PLAY

img.images = New images
img\img = LoadImage("images\btnaudio.png")
img\cat = CAT_MENU_AUDIO

img.images = New images
img\img = LoadImage("images\cursor.png")
img\cat = CAT_MENU_MOUSE_CURSOR

img.images = New images
img\img = LoadImage("images\btnskip.png")
img\cat = CAT_MENU_SKIP_CUTSCENE

;we don't have backgrounds yet so create them on the fly for now
img.images = New images
img\img = CreateImage(SW,SH)
SetBuffer ImageBuffer(img\img)
For i = 1 To 100
	Color 100,100,100
	Oval Rand(SW),Rand(SH),100,100,1
Next
SetBuffer BackBuffer()
img\cat = 2000

End Function 

Function handlemenu()
;;;
;;;;
;;;Check if 'PLAY' pressed..if so then initialise
;first cut scene and change gamemode
;;;Check if 'TOGGLE AUDIO' pressed if so toggle music/audio flags

If lmb&lt;&gt;0 Then 
	If mx&gt;=1000 And mx&lt;=1200 Then 
		If my&gt;500 And my&lt;550 Then 
			;play hit
			initstartgame()
			gamemode = MODE_CUTSCENE
		EndIf 
		If my&gt;600 And my&lt;650 Then 
			audiostate = Not audiostate
			If Not audiostate
				;stop music
					
			EndIf 
		EndIf 
	EndIf 
EndIf 


End Function

Function drawmenu()
;draw backdrop
;draw buttons in relevant state
;draw mouse cursor

For img.images = Each images
	If img\cat = 2000 Then 
		DrawBlock img\img,0,0
	EndIf 
Next

For img.images = Each images
	If img\cat = CAT_MENU_PLAY
		DrawImage img\img,1000,500
	EndIf
	If img\cat = CAT_MENU_AUDIO
		DrawImage img\img,1000,600
	EndIf
Next

For img.images = Each images
	If img\cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img\img,mx,my
	EndIf
Next

End Function

Function handleinput()
;assign tx,ty of creatures to player units
;
acted = False
If lmb&lt;&gt;0 And olmb = 0 Then 
	For pc.creature = Each creature
		If pc\hp&gt;0 And pc\cat&gt;=10 And pc\cat&lt;=13 Then 
			If mx&gt;pc\x - ImageWidth(pc\img)/2 And mx&lt;pc\x + ImageWidth(pc\img)/2 And my&gt;pc\y-40 And my&lt;pc\y+40 Then 
				For a.creature = Each creature
					If a\hp&gt;0 And a\cat&lt;100 Then a\waitcount = a\waitcount + 1
					If a\waitcount &gt; 3 Then a\waitcount = 3
					If a\stunned &gt; 0 Then 
						a\stunned = a\stunned - 1
					EndIf 
				Next
				acted = True
				If pc\cat = CAT_FIGHTER And pc\stunned &lt;=0
					pc\attacktime = 30
					For a.creature = Each creature
						If a\cat &gt;= 100 And a\hp &gt; 0 Then 
							dieroll = Rand(1,1000)
							If dieroll &lt; pc\skill Then 
								a\hp = a\hp - pc\damage
								a\strucktime = 10
							EndIf 
						EndIf 
					Next
					pc\waitcount = 0
				EndIf
				If pc\cat = CAT_RANGER And pc\stunned &lt;=0
					maxhp = 0
					b.creature = Null;
					pc\attacktime = 30
					For a.creature = Each creature
						If a\cat &gt;= 100 And a\hp &gt; 0 Then 
							If a\hp &gt; maxhp Then 
								maxhp = a\hp
								b.creature = a.creature
							EndIf 
						EndIf 
					Next
					If b.creature&lt;&gt;Null Then 
						dieroll = Rand(1,1000)
						If dieroll &lt; pc\skill Then 
							b\hp = b\hp - pc\damage * (1 + pc\waitcount)
							b\strucktime = 15
						EndIf 
					EndIf 
					pc\waitcount = 0
				EndIf
				If pc\cat = CAT_WIZARD And pc\stunned&lt;=0
					pc\attacktime = 30
					damage = pc\damage * (pc\waitcount+1)
					For a.creature = Each creature
						If a\cat &gt;= 100 And a\hp &gt; 0 Then 
							dieroll = Rand(1,1000)
							If dieroll &lt; pc\skill Then 
								a\hp = a\hp - damage
								a\lightningtime = 30
								a\strucktime = 20
							Else
								pc\hp = pc\hp - 5 ; bad spell casting inflicts damage to caster
								pc\lightningtime = 30
								Exit
							EndIf 
						EndIf 
					Next
					pc\waitcount = 0
				EndIf
				If pc\cat = CAT_CLERIC And pc\stunned &lt;=0
					pc\attacktime = 30
					damage = pc\damage * (pc\waitcount + 1)
					For a.creature = Each creature
						If a\cat &lt; 100 And a\hp &lt; a\fullhp And a\hp &gt; 0 Then 
							a\hp = a\hp + damage
							a\healingtime = 60
							If a\hp &gt; a\fullhp Then a\hp = a\fullhp
						EndIf 
					Next
					pc\waitcount = 0
				EndIf	
			EndIf 
		EndIf 
	Next
EndIf 
If acted
	For a.creature = Each creature
		If a\hp &gt; 0 And a\cat &gt;= 100 Then 
			count = 0
			For pc.creature = Each creature
				If pc\cat &lt; 100 And pc\hp &gt; 0 Then count = count + 1
			Next
			If count &gt; 0 Then 
				count = Rand(1,count)
				For pc.creature = Each creature
					If pc\cat &lt; 100 And pc\hp &gt; 0 Then count = count - 1
					If count = 0 Then 
						dieroll = Rand(1,1000)
						If a\cat = 103 Then ;goblin shaman
							If dieroll &lt; a\skill Then 
								pc\hp = pc\hp - a\damage
								pc\strucktime = 10
								a\attacktime = 30
								pc\lightningtime = 30
							EndIf
						ElseIf a\cat = 106 Then ;spider wizard
							If dieroll &lt; a\skill Then 
								pc\stunned = Rand(1,2)
								dieroll2 = Rand(1,1000)
								If dieroll2 &gt; pc\defenseskill Then 
									pc\hp = pc\hp - a\damage
									pc\strucktime = 10
									a\attacktime = 30
								EndIf
								Exit
							EndIf 
						ElseIf a\cat = 107 Then ;spider queen
							If dieroll &lt; a\skill Then 
								For c.creature = Each creature
									If c\cat &gt;= 100 And c\hp &gt; 0 And c\hp &lt; c\fullhp
										c\healingtime = 60
										c\hp = c\hp + a\damage
										Exit 
									EndIf 
								Next
								dieroll2 = Rand(1,1000)
								If dieroll2 &gt; pc\defenseskill Then 
									pc\hp = pc\hp - a\damage
									pc\strucktime = 10
									a\attacktime = 30
								EndIf
								If pc\cat = CAT_WIZARD Or pc\cat = CAT_CLERIC
									pc\waitcount = 0
									Exit 
								EndIf
							EndIf 
							If dieroll &gt; pc\defenseskill Then 
								pc\hp = pc\hp - a\damage
								pc\strucktime = 10
								a\attacktime = 30
							EndIf
							Exit
						Else
							If dieroll &gt; pc\defenseskill Then 
								pc\hp = pc\hp - a\damage
								pc\strucktime = 10
								a\attacktime = 30
							EndIf
							Exit
						EndIf  
					EndIf 
				Next
				
			EndIf 
		EndIf 
	Next
EndIf
End Function

Function updategame()
;move all creatures
;move all bullets
;handle all collisions
;handle all pick ups
;handle all combat
;handle all spell casting (magic missiles and healing)

found = False

For pc.creature = Each creature
	If pc\strucktime &gt; 0 Then 
		pc\strucktime = pc\strucktime - 1
		createbloodparticle(pc\x,pc\y)
		If pc\hp &lt;= 0 Then 
			createbloodparticle(pc\x,pc\y)
			createbloodparticle(pc\x,pc\y)
			createbloodparticle(pc\x,pc\y)
		EndIf 
	EndIf 
	If pc\hp&gt;0 Then 
		If pc\cat &gt;= 100 Then 
			found = True
		EndIf
	Else
		Delete pc
	EndIf 
Next
If found = False Then 
	levelfinishtime = levelfinishtime + 1
EndIf 
foundp = False
For pc.creature = Each creature
	If pc\hp &gt; 0 And pc\cat &lt; 100 Then foundp = True:Exit 
Next
If foundp = False Then 
	levelfinishtime = levelfinishtime + 1
EndIf 
If levelfinishtime &gt; 250 Then 
	gamemode = MODE_MENU ;eventually change to mode_upgrade
	If foundp Then gamemode = MODE_UPGRADE
	gamelevel = gamelevel + 1
EndIf 

For pc.creature = Each creature
	If pc\hp &gt; 0 Then 
		If pc\healingtime &gt; 0 Then pc\healingtime = pc\healingtime - 1
	EndIf 
Next
updateparticle()
End Function

Function drawgame()
;draw background (fixed static 1280x720 image background)
;draw all creatures - don't worry about zordering them - it will be too fast to notice 
;draw all bullets
For img.images = Each images
	If img\cat = 2001 ;change this later
		DrawBlock img\img,0,0
	EndIf
Next
For pc.creature = Each creature
	If pc\hp &gt; 0 Then
		aa# = 0
		bb# = 0
		If pc\attacktime &gt; 0 Then 
			pc\attacktime = pc\attacktime - 1
			aa# = -25.0 * Sin(pc\attacktime * 6)
			If pc\cat&gt;=100 Then aa = aa * -1.0
		EndIf 
		If pc\strucktime &gt; 0 Then 
			bb = Rand(-pc\strucktime/2,pc\strucktime/2)
		EndIf 
		DrawImage pc\img,bb + pc\x - ImageWidth(pc\img)/2,pc\y - 40 + aa
		dhp = 10 * pc\hp / pc\fullhp
		If dhp &lt; 4 Then Color 255,32,32
		If dhp &gt;=4 And dhp&lt;8 Then Color 255,255,32
		If dhp &gt;=8 Then Color 32,255,32
		If dhp = 0 Then dhp = 1
		For hp = 1 To dhp
			Rect hp*4 + pc\x - ImageWidth(pc\img)/3,pc\y - 50,3,3,1
		Next
		If pc\healingtime &gt; 0 Then 
			createhealparticle(pc\x,pc\y)
		EndIf 
		If pc\lightningtime &gt; 0 Then 
			pc\lightningtime = pc\lightningtime - 1
			drawlightning(pc\x,pc\y)
		EndIf 
		If pc\waitcount &gt; 0 Then 
			Color 255,32,255
			For i = 1 To pc\waitcount
				Rect i * 4 + pc\x - ImageWidth(pc\img)/3,pc\y - 55,3,3,1
			Next
		EndIf 
		If pc\stunned &gt; 0 Then 
			Color 255,255,32
			Oval pc\x - ImageWidth(pc\img)/2,pc\y-40,ImageWidth(pc\img),80,0
		EndIf 
	EndIf
Next
drawparticle()
Color 255,255,255
For img.images = Each images
	If img\cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img\img,mx,my
	EndIf
Next


End Function 

Function drawlightning(x,y)

iy = 0
ix = x + Rand(-20,20)
While iy &lt; y
oy = iy
ox = ix
ix = x + Rand(-20,20)
iy = iy + Rand(10,25)
Color 200,200,255
Line ox,oy,ix,iy
Color 150,150,200
Line ox+1,oy+1,ix+1,iy+1
Line ox-1,oy-1,ix-1,iy-1
Color 100,100,150
Line ox+2,oy+2,ix+2,iy+2
Line ox-2,oy-2,ix-2,iy-2
Color 32,32,90
Line ox+3,oy+3,ix+3,iy+3
Line ox-3,oy-3,ix-3,iy-3

Wend 

End Function 

Function handlecutscene()
;handle transitions,  handle skip button; 
;handle fading in and out text (bitmap fonts?)

If lmb&lt;&gt;0 Then 
	If mx&gt;1000 And mx&lt;1200 And my&gt;600 And my&lt;650 Then 
		initlevel()
		gamemode = MODE_COMBAT
	EndIf 
EndIf 

End Function 

Function drawcutscene()
;draw cut scene background, draw transition, draw skip button
For img.images = Each images
	If img\cat = 2000 Then 
		DrawBlock img\img,0,0
	EndIf 
Next

For img.images = Each images
	If img\cat = CAT_MENU_SKIP_CUTSCENE
		DrawImage img\img,1000,600
	EndIf
Next

For img.images = Each images
	If img\cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img\img,mx,my
	EndIf
Next

End Function 

Function handleupgrade()
;handle button press 'add stuff' to characters
;
;
;
If lmb&lt;&gt;0 Then 
	If mx &gt; 1000 And mx&lt;1200 And my&gt;600 And my &lt;650
		gamemode = MODE_CUTSCENE
	EndIf
EndIf


End Function

Function drawupgrade()
;draw background
;draw buttons
;draw characters
;draw stats
;draw continue button
For img.images = Each images
	If img\cat = 2000 Then 
	;	DrawBlock img\img,0,0
	EndIf 
Next

i=-1
For pc.creature = Each creature
	If pc\cat &lt; 100 And pc\hp &gt; 0 Then 
		pc\hp = pc\fullhp
		i = i + 1
		DrawImage pc\img,100,i * 100 + 200
		Text 150,i*100+200,"Skill:"+pc\skill+" Defense:"+pc\defenseskill + " Health:"+pc\fullhp + " Power:"+pc\damage
	EndIf 
Next


For img.images = Each images
	If img\cat = CAT_MENU_SKIP_CUTSCENE
		DrawImage img\img,1000,600
	EndIf
Next

Text 0,0,"On this screen you would upgrade some of your characters"

For img.images = Each images
	If img\cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img\img,mx,my
	EndIf
Next




End Function 

Function initstartgame()
gamelevel = 1
Delete Each creature
pc.creature = New creature
pc\fullhp = 90
pc\hp = 90
pc\cat = CAT_FIGHTER
pc\x = 600
pc\y = 300
pc\tx = pc\x
pc\ty = pc\y
pc\skill = 100
pc\defenseskill = 850
pc\damage = 10
pc\speed = 4.0
For img.images = Each images
	If img\cat = CAT_FIGHTER Then 
		pc\img = img\img
		Exit 
	EndIf 
Next
pc.creature = New creature
pc\fullhp = 75
pc\hp = 75
pc\cat = CAT_RANGER
pc\x = 640
pc\y = 300
pc\tx = pc\x
pc\ty = pc\y
pc\skill = 800
pc\defenseskill = 850
pc\damage = 50
pc\speed = 5.0
For img.images = Each images
	If img\cat = CAT_RANGER Then 
		pc\img = img\img
		Exit 
	EndIf 
Next
pc.creature = New creature
pc\fullhp = 45
pc\hp = 45
pc\cat = CAT_WIZARD
pc\x = 750
pc\y = 360
pc\tx = pc\x
pc\ty = pc\y
pc\skill = 650
pc\damage = 18
pc\speed = 5.0
pc\defenseskill = 500
For img.images = Each images
	If img\cat = CAT_WIZARD Then 
		pc\img = img\img
		Exit 
	EndIf 
Next
pc.creature = New creature
pc\fullhp = 60
pc\hp = 60
pc\cat = CAT_CLERIC
pc\x = 640
pc\defenseskill = 800
pc\y = 350
pc\tx = pc\x
pc\ty = pc\y
pc\skill = 100
pc\damage = 5
pc\speed = 4.0
For img.images = Each images
	If img\cat = CAT_CLERIC Then 
		pc\img = img\img
		Exit 
	EndIf 
Next
End Function 

Function initlevel()
Dim wallmap(SW,SH)
Dim blockmap(SW/20,SH/12)
For pc.creature = Each creature
	If pc\hp &gt; 0 And pc\hp &lt; pc\fullhp Then pc\hp = pc\fullhp
	If pc\cat = CAT_FIGHTER
		pc\x = 300
		pc\y = 400
	EndIf
	If pc\cat = CAT_RANGER
		pc\x = 375
		pc\y = 400
	EndIf
	If pc\cat = CAT_WIZARD
		pc\x = 450
		pc\y = 400
	EndIf
	If pc\cat = CAT_CLERIC
		pc\x = 500
		pc\y = 400
	EndIf
	pc\x = pc\x + 200
	pc\tx = pc\x
	pc\ty = pc\y
	If pc\cat &gt;=100 Then Delete pc
Next

For i = 1 To 8
	pc.creature = New creature
	pc\x = 300 + i * 80;Rand(0,SW)
	pc\y = 200 ;Rand(0,SH)
	pc\tx = pc\x
	pc\ty = pc\y
	
	If gamelevel = 1 Then 
	pc\cat = 100+Rand(0,1)
	pc\hp = 70
	pc\fullhp = 50
	pc\speed = 3
	pc\damage = 5
	pc\skill = 80
	EndIf
	If gamelevel = 2 Then 
		;trolls2
		If i = 1 Or i = 8 Then 
			pc\cat = 102
			pc\hp = 200
			pc\fullhp = 200
			pc\speed = 3
			pc\damage = 10
			pc\skill = 150
		Else
			pc\cat = 100+Rand(0,1)
			pc\hp = 70
			pc\fullhp = 50
			pc\speed = 3
			pc\damage = 5
			pc\skill = 80
		EndIf 
	EndIf 
	If gamelevel = 3 Then 
		;wizard and troll
		If i = 1 Or i = 8 Then
			pc\cat = 102
			pc\hp = 200
			pc\fullhp = 200
			pc\speed = 3
			pc\damage = 10
			pc\skill = 150
		ElseIf i = 4 Then
			pc\cat = 103
			pc\hp = 100
			pc\fullhp = 100
			pc\speed = 3
			pc\damage = 5
			pc\skill = 350
		Else
			pc\cat = 100+Rand(0,1)
			pc\hp = 70
			pc\fullhp = 50
			pc\speed = 3
			pc\damage = 5
			pc\skill = 80
		EndIf 
	EndIf
	If gamelevel = 4 Then
		;spiderbeasts and giant spiders
		If i = 1 Or i = 8 Then 
			pc\cat = 104
			pc\hp = 150
			pc\fullhp = 150
			pc\speed = 3
			pc\damage = 15
			pc\skill = 100
		Else
			pc\cat = 105
			pc\hp = 100
			pc\fullhp = 100
			pc\speed = 3
			pc\damage = 8
			pc\skill = 150
		EndIf 

	EndIf
	If gamelevel = 5 Then 
		;spiderbeasts, giant spiders and spider wizards
		If i = 1 Or i = 8 Then 
			pc\cat = 104
			pc\hp = 150
			pc\fullhp = 150
			pc\speed = 3
			pc\damage = 15
			pc\skill = 100
		ElseIf i = 2 Or i = 7
			pc\cat = 106
			pc\hp = 100
			pc\fullhp = 100
			pc\speed = 3
			pc\damage = 8
			pc\skill = 300
		Else
			pc\cat = 105
			pc\hp = 100
			pc\fullhp = 100
			pc\speed = 3
			pc\damage = 8
			pc\skill = 150
		EndIf 


	EndIf 
	If gamelevel = 6 Then 
		;spider queens and spiderbeasts
		If i = 1 Or i = 8 Then 
			pc\cat = 107
			pc\hp = 100
			pc\fullhp = 100
			pc\speed = 3
			pc\damage = 5
			pc\skill = 450
		Else
			pc\cat = 105
			pc\hp = 100
			pc\fullhp = 100
			pc\speed = 3
			pc\damage = 8
			pc\skill = 150
		EndIf 
	EndIf 
	If gamelevel = 7 Then 
		;spider queens and giant spiders and spider wizards
		If i = 4 Or i = 5 Then 
			pc\cat = 107
			pc\hp = 100
			pc\fullhp = 100
			pc\speed = 3
			pc\damage = 5
			pc\skill = 450
		ElseIf i = 2 Or i = 7
			pc\cat = 106
			pc\hp = 100
			pc\fullhp = 100
			pc\speed = 3
			pc\damage = 8
			pc\skill = 300
		Else
			pc\cat = 104
			pc\hp = 150
			pc\fullhp = 150
			pc\speed = 3
			pc\damage = 15
			pc\skill = 100
		EndIf 
	EndIf 
	For img.images = Each images
		If img\cat = pc\cat Then 
			pc\img = img\img
			Exit 
		EndIf 
	Next
Next

lmb = 0
olmb = 0
FlushMouse()
levelfinishtime = 0
End Function 

Function createhealparticle(x,y)

For i = 1 To 36
	p.particle = New particle
	p\life = 20
	p\x = x + 25.0 * Cos(i*10)
	p\y = y + 20 + 25.0 * (Sin(i*5))
	p\vx = 0
	p\vy = Rand(-4,-2)
	p\ay = 0.1
	p\gy = p\y + 100
	p\r = 32
	p\g = 200
	p\b = 255
	p\sz = 4
	p\dsz = -0.1
	p\dr = 10
	p\dg = 2
	p\db = 0
Next

End Function 

Function createbloodparticle(x,y)

For i = 1 To 10
	p.particle = New particle
	p\life = 20
	p\x = x + Rand(-10,10)
	p\y = y + Rand(-10,10)
	p\vx = Rnd(-3,3)
	p\vy = Rnd(-3,3)
	p\ay = 0.05
	p\gy = y + 42
	p\r = 255
	p\g = 100
	p\b = 100
	p\dr = -2
	p\dg = -3
	p\db = -3
	p\sz = 4
	p\dsz = 0
Next

End Function 

Function updateparticle()
For p.particle = Each particle
	p\life = p\life - 1
	p\x = p\x + p\vx
	p\y = p\y + p\vy
	p\vy = p\vy + p\ay
	If p\y &gt; p\gy Then 
		p\vy = p\vy * -0.7
		If Abs(p\vy)&lt;0.01 Then p\life = 0
	EndIf 
	p\sz = p\sz + p\dsz
	p\r = p\r + p\dr
	p\g = p\g + p\dg
	p\b = p\b + p\db
	If p\sz &lt; 0 Then p\sz = 0
	If p\r &gt; 255 Then p\r = 255
	If p\g &gt; 255 Then p\g = 255
	If p\b &gt; 255 Then p\b = 255
	If p\r &lt; 0 Then p\r = 0
	If p\g &lt; 0 Then p\g = 0
	If p\b &lt; 0 Then p\b = 0
	If p\life &lt; 0 Then Delete p
Next
End Function 

Function drawparticle()
For p.particle = Each particle
	Color p\r,p\g,p\b
	Rect p\x,p\y,p\sz,p\sz,1
Next
Color 255,255,255
End Function 
</textarea> <br><br></td></tr></table><br>
<a name="1341172"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rooster</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#57">[#57]</a></td></tr></table></td></tr><tr ><td class="posttext"> Looking good.<br>I think I'm actually liking your implantation of turn based mechanics.<br>Probably because it has fast iteration time, unlike some games I can think of.<br><br>I'm going to go port the code now, bye. <br><br></td></tr></table><br>
<a name="1341174"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rooster</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#58">[#58]</a></td></tr></table></td></tr><tr ><td class="posttext"> Code ported.<br>I think it all working right.<br>I did have to change how the stun effects were draw, because BMax doesn't do hollow ovals.<br><br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
'This is both a learning exercise And hopefully a collaborative project of sorts
'Or at least a project I can share with others on the blitz forum.
'It will be written initially in blitzplus/blitz3d And maybe someone will be keen on
'porting it To blitzmax...even blitzmax-ng To Release on mobile perhaps?
'
'Interface:
'Left mouse button clicking only To make porting To 
'mobile interface much, much easier.
'Gameplay mechanic so far (15-May-2017)
'
'1. Arcade Action RPG Combat
'	Player controls 4 characters in a single screen dungeon.
'	Dungeon has a few walls And so on that prevent movement.
'	Monsters spawn from spawners And make their way around the map
'	Player taps the screen To move To location And characters fight things
'	in their path.
'	Powerups exist in the level such as:
'	Health pickups
'	Bombs - kill all monsters that have spawned Or at least damage them.
'	
'2. After the arcade sequence the player is presented with options To upgrade their
'	character's stats. Stats to upgrade include:
'	Combat skill ('to hit roll')
'	Damage output ('damage points')
'	Health points ('hp')
'	Movement speed ('move')
'3.	After this a Short cut scene is presented which may simply be a scrolling static
'	image with some fading in/fading out text To advance the story line
'0. Menu - toggle audio, play, credits
'
'Character types:
'1 Fighter - high hitpoint melee combat medium damage
'2 Ranger - medium hitpoint melee combat high damage
'3 Wizard - low hitpoint, ranged combat, medium damage
'4 Cleric - medium hitpoint, no combat, healer
'


'constants
Const SW=1280,SH=720,WIN=2
Const MODE_MENU = 0
Const MODE_COMBAT = 1
Const MODE_UPGRADE = 2
Const MODE_CUTSCENE = 3
Const PURE_2D = True 'If go To blitzmax can use 2d-in-3d commands such as alpha otherwise have To calculate manually.Change To False For blitzmax.

'categories For image types And Object types
Const CAT_MENU_PLAY = 0
Const CAT_MENU_AUDIO = 1
Const CAT_MENU_SKIP_CUTSCENE = 2 'cut scene mode
Const CAT_MENU_ADD_SKILL = 3 'upgrade mode
Const CAT_MENU_ADD_DAMAGE = 4'upgrade mode
Const CAT_MENU_ADD_HEALTH = 5'upgrade mode
Const CAT_MENU_ADD_SPEED = 6'
Const CAT_MENU_MOUSE_CURSOR = 7'
Const CAT_FIGHTER = 10
Const CAT_KNIGHT = 10 'synonym
Const CAT_RANGER = 11
Const CAT_WIZARD = 12
Const CAT_CLERIC = 13
Const CAT_HEALER = 13 'synonym
Const CAT_HEALTH_PICKUP = 20
Const CAT_BOMB_PICKUP = 21
'CAT_BACKGROUND = 2000-3000 ' all the different image backgrounds
'CAT_MONSTER = 100-1000 , all the different monster types

Const AI_WANDER = 0
Const AI_ATTACK = 1

Const TEAM_PLAYER = 0
Const TEAM_MONSTER = 1

'globals
Global mx,my,lmb,olmb 'mouse Input
Global audiostate 'on/off
Global gamemode 'references Const above
Global gamelevel 'For cutscenes
Global cutsceneframe 'For cutscenes ie trigger fades, text, motion etc on certain frames
Global levelfinishtime = 0

'for Bmax -Rooster
Global list_objects:TList=New TList
Global stun_imag

'arrays
Global wallmap[0,0] '0/1 value at each element indicates whether wall is there Or Not - redimension later
Global blockmap[0,0] '0/1 value - bigger version of wallmap Lower resolution
'types
Type images

Field img 'handle
Field midhandled 'boolean
Field cat 'category //hooks into creature template

End Type 

Type creaturetemplate

Field img 'img handle
Field cat 'category
Field fullhp 'n (values range from about 10 To 200 For high level characters And monsters)
Field combatskill '1-1000 (percentile out of a 1000 Not 100) (roll under To hit/roll under To cast)
Field speed# 'n.m (movement speed)
Field damage 'n (damage per hit, also equal To hitpoints To heal per successful cast)

End Type 

Type bullet

Field img 'handle of image
Field team 'players Or monsters - so no friendly fire
Field x#
Field y#
Field vx#
Field vy#
Field life
Field damage 'damage To inflict per hit Then disappear

End Type

Type spawner

Field img
Field cat 'category To spawn
Field x
Field y
Field hp
Field timetospawn 'frames To count down from when respawning
Field spawndelay 'Current frame count on spawner 0 To 'timetospawn'.

End Type 

Type creature

Field img
Field cat
Field x#
Field y#
Field tx#
Field ty#
Field hp
Field fullhp
Field speed#
Field damage
Field skill

Field defenseskill 'For players

Field aimode
Field aidelay
Field aitime

Field moving 'boolean

Field healingtime 'For healing effect/buff effect
Field lightningtime 'For lightning blasts on creature effect
Field strucktime 'For blood effects
Field attacktime 

Field activated 'boolean
Field waitcount 'Int

Field stunned 'Int 0-n counts down each time active....

End Type 

Type menubutton

Field cat 'For menu buttons
Field img
Field x
Field y
Field w
Field h
Field state 'pressed/Not pressed

End Type 

Type cutscene

Field cat
Field img
Field x
Field y
Field levelnum 'For the specific level num
Field upperframe 'For the Upper limit on the frame number To show this image For
Field transitiontype 'define later For transitioning between frames...do all this in code 

End Type 

'New emitters And particles
Type particle

Field r,g,b,a
Field x#,y#,vx#,vy#,ay#,gy#
Field life
Field dr,dg,db,da
Field sz,dsz

End Type



Main()

Function Main()
	quit = False
	gamemode = MODE_MENU
	init()
	Repeat
		frametime = MilliSecs()
		Cls
		'Input 
		mx = MouseX()
		my = MouseY()
		olmb = lmb
		lmb = MouseDown(1)
		Select gamemode
		
		Case MODE_MENU
			handlemenu()
			drawmenu()
		
		Case MODE_COMBAT
			handleinput()
			updategame()
			drawgame()
		Case MODE_CUTSCENE
			handlecutscene()
			drawcutscene()
		Case MODE_UPGRADE
			handleupgrade()
			drawupgrade()
		End Select
		
		Flip
		'very basic frame limiting
		endframetime = MilliSecs()
		dtime = endframetime - frametime
		If dtime &lt; 15 Then 
			Delay 15 - dtime
		EndIf 
		'End of frame limiting
		If(KeyHit(27)) Then quit = True		
	Until quit
	''''''
	End
End Function 

Function init()
Graphics SW,SH,0',WIN
'Load all images here
'Load all sounds here
'Load all music here
HideMouse ()
img:images = New images
img.img = LoadImage("images\knight1.png")
img.cat = CAT_FIGHTER
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\ranger1.png")
img.cat = CAT_RANGER
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\wizard1.png")
img.cat = CAT_WIZARD
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\cleric1.png")
img.cat = CAT_CLERIC
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\goblin1.png")
img.cat = 100 'goblin 1
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\goblin2.png")
img.cat = 101 'goblin 2
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\troll1.png")
img.cat = 102 'troll 1
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\goblinshaman1.png")
img.cat = 103 'goblin shaman
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\giantspider1.png")
img.cat = 104 'giant spider melee brute...
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\spiderbeast1.png")
img.cat = 105 'spider beast
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\spiderwizard1.png")
img.cat = 106 'spider wizard - stuns enemy units (reduces skill)
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\spiderqueen1.png")
img.cat = 107 'spider queen - stuns spell casters (reduces waitcount) And melee unit
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\btnplay.png")
img.cat = CAT_MENU_PLAY
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\btnaudio.png")
img.cat = CAT_MENU_AUDIO
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\cursor.png")
img.cat = CAT_MENU_MOUSE_CURSOR
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\btnskip.png")
img.cat = CAT_MENU_SKIP_CUTSCENE
list_objects.AddLast img

'we don't have backgrounds yet so create them on the fly for now
img:images = New images
img.img = CreateImage(SW,SH)
LockImage(img.img)'needed to draw -Rooster

'SetBuffer ImageBuffer(img.img)
For i = 1 To 100
	SetColor 100,100,100
	DrawOval Rand(SW),Rand(SH),100,100',1
Next
'SetBuffer BackBuffer()

GrabImage img.img,0,0 'more stuff needed for BMax to draw to image -Rooster
UnlockImage (img.img)

img.cat = 2000
list_objects.AddLast img
SetColor 255,255,255'reseting the draw color for BMax -Rooster

End Function 

Function handlemenu()
'''
''''
'''Check If 'PLAY' pressed..if so then initialise
'first cut scene And change gamemode
'''Check If 'TOGGLE AUDIO' pressed if so toggle music/audio flags

If lmb&lt;&gt;0 Then 
	If mx&gt;=1000 And mx&lt;=1200 Then 
		If my&gt;500 And my&lt;550 Then 
			'play hit
			initstartgame()
			gamemode = MODE_CUTSCENE
		EndIf 
		If my&gt;600 And my&lt;650 Then 
			audiostate = Not audiostate
			If Not audiostate
				'stop music
					
			EndIf 
		EndIf 
	EndIf 
EndIf 


End Function

Function drawmenu()
'draw backdrop
'draw buttons in relevant state
'draw mouse cursor

For img:images = EachIn list_objects 
	If img.cat = 2000 Then 
		DrawImage img.img,0,0'DrawBlock img.img,0,0
	EndIf 
Next

For img:images = EachIn list_objects 
	If img.cat = CAT_MENU_PLAY
		DrawImage img.img,1000,500
	EndIf
	If img.cat = CAT_MENU_AUDIO
		DrawImage img.img,1000,600
	EndIf
Next

For img:images = EachIn list_objects 
	If img.cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img.img,mx,my
	EndIf
Next

End Function

Function handleinput()
'assign tx,ty of creatures To player units
'
acted = False
If lmb&lt;&gt;0 And olmb = 0 Then 
	For pc:creature = EachIn list_objects 
		If pc.hp&gt;0 And pc.cat&gt;=10 And pc.cat&lt;=13 Then 
			If mx&gt;pc.x - ImageWidth(pc.img)/2 And mx&lt;pc.x + ImageWidth(pc.img)/2 And my&gt;pc.y-40 And my&lt;pc.y+40 Then 
				For a:creature = EachIn list_objects 
					If a.hp&gt;0 And a.cat&lt;100 Then a.waitcount = a.waitcount + 1
					If a.waitcount &gt; 3 Then a.waitcount = 3
					If a.stunned &gt; 0 Then 
						a.stunned = a.stunned - 1
					EndIf 
				Next
				acted = True
				If pc.cat = CAT_FIGHTER And pc.stunned &lt;=0
					pc.attacktime = 30
					For a:creature = EachIn list_objects 
						If a.cat &gt;= 100 And a.hp &gt; 0 Then 
							dieroll = Rand(1,1000)
							If dieroll &lt; pc.skill Then 
								a.hp = a.hp - pc.damage
								a.strucktime = 10
							EndIf 
						EndIf 
					Next
					pc.waitcount = 0
				EndIf
				If pc.cat = CAT_RANGER And pc.stunned &lt;=0
					maxhp = 0
					b:creature = Null'
					pc.attacktime = 30
					For a:creature = EachIn list_objects 
						If a.cat &gt;= 100 And a.hp &gt; 0 Then 
							If a.hp &gt; maxhp Then 
								maxhp = a.hp
								b:creature = a:creature
							EndIf 
						EndIf 
					Next
					If b:creature&lt;&gt;Null Then 
						dieroll = Rand(1,1000)
						If dieroll &lt; pc.skill Then 
							b.hp = b.hp - pc.damage * (1 + pc.waitcount)
							b.strucktime = 15
						EndIf 
					EndIf 
					pc.waitcount = 0
				EndIf
				If pc.cat = CAT_WIZARD And pc.stunned&lt;=0
					pc.attacktime = 30
					damage = pc.damage * (pc.waitcount+1)
					For a:creature = EachIn list_objects 
						If a.cat &gt;= 100 And a.hp &gt; 0 Then 
							dieroll = Rand(1,1000)
							If dieroll &lt; pc.skill Then 
								a.hp = a.hp - damage
								a.lightningtime = 30
								a.strucktime = 20
							Else
								pc.hp = pc.hp - 5 ' bad spell casting inflicts damage To caster
								pc.lightningtime = 30
								Exit
							EndIf 
						EndIf 
					Next
					pc.waitcount = 0
				EndIf
				If pc.cat = CAT_CLERIC And pc.stunned &lt;=0
					pc.attacktime = 30
					damage = pc.damage * (pc.waitcount + 1)
					For a:creature = EachIn list_objects 
						If a.cat &lt; 100 And a.hp &lt; a.fullhp And a.hp &gt; 0 Then 
							a.hp = a.hp + damage
							a.healingtime = 60
							If a.hp &gt; a.fullhp Then a.hp = a.fullhp
						EndIf 
					Next
					pc.waitcount = 0
				EndIf	
			EndIf 
		EndIf 
	Next
EndIf 
If acted
	For a:creature = EachIn list_objects 
		If a.hp &gt; 0 And a.cat &gt;= 100 Then 
			count = 0
			For pc:creature = EachIn list_objects 
				If pc.cat &lt; 100 And pc.hp &gt; 0 Then count = count + 1
			Next
			If count &gt; 0 Then 
				count = Rand(1,count)
				For pc:creature = EachIn list_objects 
					If pc.cat &lt; 100 And pc.hp &gt; 0 Then count = count - 1
					If count = 0 Then 
						dieroll = Rand(1,1000)
						If a.cat = 103 Then 'goblin shaman
							If dieroll &lt; a.skill Then 
								pc.hp = pc.hp - a.damage
								pc.strucktime = 10
								a.attacktime = 30
								pc.lightningtime = 30
							EndIf
						ElseIf a.cat = 106 Then 'spider wizard
							If dieroll &lt; a.skill Then 
								pc.stunned = Rand(1,2)
								dieroll2 = Rand(1,1000)
								If dieroll2 &gt; pc.defenseskill Then 
									pc.hp = pc.hp - a.damage
									pc.strucktime = 10
									a.attacktime = 30
								EndIf
								Exit
							EndIf 
						ElseIf a.cat = 107 Then 'spider queen
							If dieroll &lt; a.skill Then 
								For c:creature = EachIn list_objects 
									If c.cat &gt;= 100 And c.hp &gt; 0 And c.hp &lt; c.fullhp
										c.healingtime = 60
										c.hp = c.hp + a.damage
										Exit 
									EndIf 
								Next
								dieroll2 = Rand(1,1000)
								If dieroll2 &gt; pc.defenseskill Then 
									pc.hp = pc.hp - a.damage
									pc.strucktime = 10
									a.attacktime = 30
								EndIf
								If pc.cat = CAT_WIZARD Or pc.cat = CAT_CLERIC
									pc.waitcount = 0
									Exit 
								EndIf
							EndIf 
							If dieroll &gt; pc.defenseskill Then 
								pc.hp = pc.hp - a.damage
								pc.strucktime = 10
								a.attacktime = 30
							EndIf
							Exit
						Else
							If dieroll &gt; pc.defenseskill Then 
								pc.hp = pc.hp - a.damage
								pc.strucktime = 10
								a.attacktime = 30
							EndIf
							Exit
						EndIf  
					EndIf 
				Next
				
			EndIf 
		EndIf 
	Next
EndIf
End Function

Function updategame()
'move all creatures
'move all bullets
'handle all collisions
'handle all pick ups
'handle all combat
'handle all spell casting (magic missiles And healing)

found = False

For pc:creature = EachIn list_objects 
	If pc.strucktime &gt; 0 Then 
		pc.strucktime = pc.strucktime - 1
		createbloodparticle(pc.x,pc.y)
		If pc.hp &lt;= 0 Then 
			createbloodparticle(pc.x,pc.y)
			createbloodparticle(pc.x,pc.y)
			createbloodparticle(pc.x,pc.y)
		EndIf 
	EndIf 
	If pc.hp&gt;0 Then 
		If pc.cat &gt;= 100 Then 
			found = True
		EndIf
	Else
		ListRemove( list_objects, pc)
	EndIf 
Next
If found = False Then 
	levelfinishtime = levelfinishtime + 1
EndIf 
foundp = False
For pc:creature = EachIn list_objects 
	If pc.hp &gt; 0 And pc.cat &lt; 100 
	  foundp = True
	  Exit 
	EndIf
Next
If foundp = False Then 
	levelfinishtime = levelfinishtime + 1
EndIf 
If levelfinishtime &gt; 250 Then 
	gamemode = MODE_MENU 'eventually change To mode_upgrade
	If foundp Then gamemode = MODE_UPGRADE
	gamelevel = gamelevel + 1
EndIf 

For pc:creature = EachIn list_objects 
	If pc.hp &gt; 0 Then 
		If pc.healingtime &gt; 0 Then pc.healingtime = pc.healingtime - 1
	EndIf 
Next
updateparticle()
End Function

Function drawgame()
'draw background (fixed static 1280x720 image background)
'draw all creatures - don't worry about zordering them - it will be too fast to notice 
'draw all bullets
For img:images = EachIn list_objects 
	If img.cat = 2001 'change this later
		DrawImage img.img,0,0'DrawBlock img.img,0,0
	EndIf
Next
For pc:creature = EachIn list_objects 
	If pc.hp &gt; 0 Then
		aa# = 0
		bb# = 0
		If pc.attacktime &gt; 0 Then 
			pc.attacktime = pc.attacktime - 1
			aa# = -25.0 * Sin(pc.attacktime * 6)
			If pc.cat&gt;=100 Then aa = aa * -1.0
		EndIf 
		If pc.strucktime &gt; 0 Then 
			bb = Rand(-pc.strucktime/2,pc.strucktime/2)
		EndIf 
		DrawImage pc.img,bb + pc.x - ImageWidth(pc.img)/2,pc.y - 40 + aa
		dhp = 10 * pc.hp / pc.fullhp
		If dhp &lt; 4 Then SetColor 255,32,32
		If dhp &gt;=4 And dhp&lt;8 Then SetColor 255,255,32
		If dhp &gt;=8 Then SetColor 32,255,32
		If dhp = 0 Then dhp = 1
		For hp = 1 To dhp
			DrawRect hp*4 + pc.x - ImageWidth(pc.img)/3,pc.y - 50,3,3',1
		Next
		SetColor 255,255,255'reseting the draw color for BMax -Rooster
		If pc.healingtime &gt; 0 Then 
			createhealparticle(pc.x,pc.y)
		EndIf 
		SetColor 255,255,255'reseting the draw color for BMax -Rooster
		If pc.lightningtime &gt; 0 Then 
			pc.lightningtime = pc.lightningtime - 1
			drawlightning(pc.x,pc.y)
		EndIf 
		SetColor 255,255,255'reseting the draw color for BMax -Rooster
		If pc.waitcount &gt; 0 Then 
			SetColor 255,32,255
			For i = 1 To pc.waitcount
				DrawRect i * 4 + pc.x - ImageWidth(pc.img)/3,pc.y - 55,3,3',1
			Next
		EndIf 
		If pc.stunned &gt; 0 Then 
		    SetColor 255,255,32
			drawOvate (pc.x - ImageWidth(pc.img)/2,pc.y-40,ImageWidth(pc.img),80)',0
		EndIf 
	EndIf
	SetColor 255,255,255'reseting the draw color for BMax -Rooster
Next
drawparticle()
SetColor 255,255,255
For img:images = EachIn list_objects 
	If img.cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img.img,mx,my
	EndIf
Next


End Function 

Function drawlightning(x,y)

iy = 0
ix = x + Rand(-20,20)
While iy &lt; y
oy = iy
ox = ix
ix = x + Rand(-20,20)
iy = iy + Rand(10,25)
SetColor 200,200,255
DrawLine ox,oy,ix,iy
SetColor 150,150,200
DrawLine ox+1,oy+1,ix+1,iy+1
DrawLine ox-1,oy-1,ix-1,iy-1
SetColor 100,100,150
DrawLine ox+2,oy+2,ix+2,iy+2
DrawLine ox-2,oy-2,ix-2,iy-2
SetColor 32,32,90
DrawLine ox+3,oy+3,ix+3,iy+3
DrawLine ox-3,oy-3,ix-3,iy-3

Wend 

End Function 

Function handlecutscene()
'handle transitions,  handle skip button' 
'handle fading in And out text (bitmap fonts?)

If lmb&lt;&gt;0 Then 
	If mx&gt;1000 And mx&lt;1200 And my&gt;600 And my&lt;650 Then 
		initlevel()
		gamemode = MODE_COMBAT
	EndIf 
EndIf 

End Function 

Function drawcutscene()
'draw cut scene background, draw transition, draw skip button
For img:images = EachIn list_objects 
	If img.cat = 2000 Then 
		DrawImage img.img,0,0'DrawBlock img.img,0,0
	EndIf 
Next

For img:images = EachIn list_objects 
	If img.cat = CAT_MENU_SKIP_CUTSCENE
		DrawImage img.img,1000,600
	EndIf
Next

For img:images = EachIn list_objects 
	If img.cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img.img,mx,my
	EndIf
Next

End Function 

Function handleupgrade()
'handle button press 'add stuff' to characters
'
'
'
If lmb&lt;&gt;0 Then 
	If mx &gt; 1000 And mx&lt;1200 And my&gt;600 And my &lt;650
		gamemode = MODE_CUTSCENE
	EndIf
EndIf


End Function

Function drawupgrade()
'draw background
'draw buttons
'draw characters
'draw stats
'draw Continue button
For img:images = EachIn list_objects
	If img.cat = 2000 Then 
	'	DrawBlock img.img,0,0
	EndIf 
Next

i=-1
For pc:creature = EachIn list_objects 
	If pc.cat &lt; 100 And pc.hp &gt; 0 Then 
		pc.hp = pc.fullhp
		i = i + 1
		DrawImage pc.img,100,i * 100 + 200
		DrawText "Skill:"+pc.skill+" Defense:"+pc.defenseskill + " Health:"+pc.fullhp + " Power:"+pc.damage,150,i*100+200
	EndIf 
Next


For img:images = EachIn list_objects 
	If img.cat = CAT_MENU_SKIP_CUTSCENE
		DrawImage img.img,1000,600
	EndIf
Next

DrawText "On this screen you would upgrade some of your characters",0,0

For img:images = EachIn list_objects 
	If img.cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img.img,mx,my
	EndIf
Next




End Function 

Function initstartgame()
gamelevel = 1
For c:creature = EachIn list_objects 'marking this because I don't know if it will work right in BMax -Rooster
ListRemove (list_objects,c)
Next

pc:creature = New creature
pc.fullhp = 90
pc.hp = 90
pc.cat = CAT_FIGHTER
pc.x = 600
pc.y = 300
pc.tx = pc.x
pc.ty = pc.y
pc.skill = 100
pc.defenseskill = 850
pc.damage = 10
pc.speed = 4.0
list_objects.AddLast pc

For img:images = EachIn list_objects 
	If img.cat = CAT_FIGHTER Then 
		pc.img = img.img
		Exit 
	EndIf 
Next
pc:creature = New creature
pc.fullhp = 75
pc.hp = 75
pc.cat = CAT_RANGER
pc.x = 640
pc.y = 300
pc.tx = pc.x
pc.ty = pc.y
pc.skill = 800
pc.defenseskill = 850
pc.damage = 50
pc.speed = 5.0
list_objects.AddLast pc

For img:images = EachIn list_objects 
	If img.cat = CAT_RANGER Then 
		pc.img = img.img
		Exit 
	EndIf 
Next
pc:creature = New creature
pc.fullhp = 45
pc.hp = 45
pc.cat = CAT_WIZARD
pc.x = 750
pc.y = 360
pc.tx = pc.x
pc.ty = pc.y
pc.skill = 650
pc.damage = 18
pc.speed = 5.0
pc.defenseskill = 500
list_objects.AddLast pc

For img:images = EachIn list_objects
	If img.cat = CAT_WIZARD Then 
		pc.img = img.img
		Exit 
	EndIf 
Next
pc:creature = New creature
pc.fullhp = 60
pc.hp = 60
pc.cat = CAT_CLERIC
pc.x = 640
pc.defenseskill = 800
pc.y = 350
pc.tx = pc.x
pc.ty = pc.y
pc.skill = 100
pc.damage = 5
pc.speed = 4.0
list_objects.AddLast pc

For img:images = EachIn list_objects 
	If img.cat = CAT_CLERIC Then 
		pc.img = img.img
		Exit 
	EndIf 
Next
End Function 

Function initlevel()
Local wallmap[SW,SH]
Local blockmap[SW/20,SH/12]
For pc:creature = EachIn list_objects 
	If pc.hp &gt; 0 And pc.hp &lt; pc.fullhp Then pc.hp = pc.fullhp
	If pc.cat = CAT_FIGHTER
		pc.x = 300
		pc.y = 400
	EndIf
	If pc.cat = CAT_RANGER
		pc.x = 375
		pc.y = 400
	EndIf
	If pc.cat = CAT_WIZARD
		pc.x = 450
		pc.y = 400
	EndIf
	If pc.cat = CAT_CLERIC
		pc.x = 500
		pc.y = 400
	EndIf
	pc.x = pc.x + 200
	pc.tx = pc.x
	pc.ty = pc.y
	If pc.cat &gt;=100 Then ListRemove( list_objects, pc)
Next

For i = 1 To 8
	pc:creature = New creature
	pc.x = 300 + i * 80'Rand(0,SW)
	pc.y = 200 'Rand(0,SH)
	pc.tx = pc.x
	pc.ty = pc.y
	
	If gamelevel = 1 Then 
	pc.cat = 100+Rand(0,1)
	pc.hp = 70
	pc.fullhp = 50
	pc.speed = 3
	pc.damage = 5
	pc.skill = 80
	
	EndIf
	If gamelevel = 2 Then 
		'trolls2
		If i = 1 Or i = 8 Then 
			pc.cat = 102
			pc.hp = 200
			pc.fullhp = 200
			pc.speed = 3
			pc.damage = 10
			pc.skill = 150
		Else
			pc.cat = 100+Rand(0,1)
			pc.hp = 70
			pc.fullhp = 50
			pc.speed = 3
			pc.damage = 5
			pc.skill = 80
		EndIf 
	EndIf 
	If gamelevel = 3 Then 
		'wizard And troll
		If i = 1 Or i = 8 Then
			pc.cat = 102
			pc.hp = 200
			pc.fullhp = 200
			pc.speed = 3
			pc.damage = 10
			pc.skill = 150
		ElseIf i = 4 Then
			pc.cat = 103
			pc.hp = 100
			pc.fullhp = 100
			pc.speed = 3
			pc.damage = 5
			pc.skill = 350
		Else
			pc.cat = 100+Rand(0,1)
			pc.hp = 70
			pc.fullhp = 50
			pc.speed = 3
			pc.damage = 5
			pc.skill = 80
		EndIf 
	EndIf
	If gamelevel = 4 Then
		'spiderbeasts And giant spiders
		If i = 1 Or i = 8 Then 
			pc.cat = 104
			pc.hp = 150
			pc.fullhp = 150
			pc.speed = 3
			pc.damage = 15
			pc.skill = 100
		Else
			pc.cat = 105
			pc.hp = 100
			pc.fullhp = 100
			pc.speed = 3
			pc.damage = 8
			pc.skill = 150
		EndIf 

	EndIf
	If gamelevel = 5 Then 
		'spiderbeasts, giant spiders And spider wizards
		If i = 1 Or i = 8 Then 
			pc.cat = 104
			pc.hp = 150
			pc.fullhp = 150
			pc.speed = 3
			pc.damage = 15
			pc.skill = 100
		ElseIf i = 2 Or i = 7
			pc.cat = 106
			pc.hp = 100
			pc.fullhp = 100
			pc.speed = 3
			pc.damage = 8
			pc.skill = 300
		Else
			pc.cat = 105
			pc.hp = 100
			pc.fullhp = 100
			pc.speed = 3
			pc.damage = 8
			pc.skill = 150
		EndIf 


	EndIf 
	If gamelevel = 6 Then 
		'spider queens And spiderbeasts
		If i = 1 Or i = 8 Then 
			pc.cat = 107
			pc.hp = 100
			pc.fullhp = 100
			pc.speed = 3
			pc.damage = 5
			pc.skill = 450
		Else
			pc.cat = 105
			pc.hp = 100
			pc.fullhp = 100
			pc.speed = 3
			pc.damage = 8
			pc.skill = 150
		EndIf 
	EndIf 
	If gamelevel = 7 Then 
		'spider queens And giant spiders And spider wizards
		If i = 4 Or i = 5 Then 
			pc.cat = 107
			pc.hp = 100
			pc.fullhp = 100
			pc.speed = 3
			pc.damage = 5
			pc.skill = 450
		ElseIf i = 2 Or i = 7
			pc.cat = 106
			pc.hp = 100
			pc.fullhp = 100
			pc.speed = 3
			pc.damage = 8
			pc.skill = 300
		Else
			pc.cat = 104
			pc.hp = 150
			pc.fullhp = 150
			pc.speed = 3
			pc.damage = 15
			pc.skill = 100
		EndIf 
	EndIf 
	For img:images = EachIn list_objects
		If img.cat = pc.cat Then 
			pc.img = img.img
			Exit 
		EndIf 
	Next
	list_objects.AddLast pc
Next

lmb = 0
olmb = 0
FlushMouse()
levelfinishtime = 0
End Function 

Function createhealparticle(x,y)

For i = 1 To 36
	p:particle = New particle
	p.life = 20
	p.x = x + 25.0 * Cos(i*10)
	p.y = y + 20 + 25.0 * (Sin(i*5))
	p.vx = 0
	p.vy = Rand(-4,-2)
	p.ay = 0.1
	p.gy = p.y + 100
	p.r = 32
	p.g = 200
	p.b = 255
	p.sz = 4
	p.dsz = -0.1
	p.dr = 10
	p.dg = 2
	p.db = 0
	list_objects.AddLast p
	
Next

End Function 

Function createbloodparticle(x,y)

For i = 1 To 10
	p:particle = New particle
	p.life = 20
	p.x = x + Rand(-10,10)
	p.y = y + Rand(-10,10)
	p.vx = Rnd(-3,3)
	p.vy = Rnd(-3,3)
	p.ay = 0.05
	p.gy = y + 42
	p.r = 255
	p.g = 100
	p.b = 100
	p.dr = -2
	p.dg = -3
	p.db = -3
	p.sz = 4
	p.dsz = 0
	list_objects.AddLast p
Next

End Function 

Function updateparticle()
For p:particle = EachIn list_objects 
	p.life = p.life - 1
	p.x = p.x + p.vx
	p.y = p.y + p.vy
	p.vy = p.vy + p.ay
	If p.y &gt; p.gy Then 
		p.vy = p.vy * -0.7
		If Abs(p.vy)&lt;0.01 Then p.life = 0
	EndIf 
	p.sz = p.sz + p.dsz
	p.r = p.r + p.dr
	p.g = p.g + p.dg
	p.b = p.b + p.db
	If p.sz &lt; 0 Then p.sz = 0
	If p.r &gt; 255 Then p.r = 255
	If p.g &gt; 255 Then p.g = 255
	If p.b &gt; 255 Then p.b = 255
	If p.r &lt; 0 Then p.r = 0
	If p.g &lt; 0 Then p.g = 0
	If p.b &lt; 0 Then p.b = 0
	If p.life &lt; 0 Then ListRemove( list_objects, p)
Next
End Function 

Function drawparticle()
For p:particle = EachIn list_objects 
	SetColor p.r,p.g,p.b
	DrawRect p.x,p.y,p.sz,p.sz',1
Next
SetColor 255,255,255
End Function 

'Had to add this to draw hollow ovals -Rooster
Function drawOvate( x# , y# , w# , h#)
For Local n% = 1 To 360
	Plot( x + w * Cos(n) , y + h * Sin(n) )
Next
End Function
</textarea> <br><br></td></tr></table><br>
<a name="1341178"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#59">[#59]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Rooster.  You're doing great.<br>I think we are now ready to work on the upgrade segment.  I'm busy today so I probably won't get much done.<br><br>After that it is content. Ie more monsters, cut scenes, story, background images etc. <br><br></td></tr></table><br>
<a name="1341180"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#60">[#60]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm thinking in terms of monster content we need to come up with themes.  As you can see there are two themes already..goblins and spiders.<br><br>I'm thinking each theme needs about five or six different monster types which fit into categories such as:<br>Basic grunt<br>Bigger badder grunt (tougher or more deadly)<br>Spell casters (lots of variety and can go wild with effects)<br><br>I have a few ideas already including:<br>Undead with powerful spell casters.<br>Beastmen/goatmen with powerful grunts (or maybe lizard people snake people?)<br>A powerful magic using race (eye beasts?) <br><br></td></tr></table><br>
<a name="1341182"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#61">[#61]</a></td></tr></table></td></tr><tr ><td class="posttext"> Update (did before I got up for work...)<br><br>btnaudio.png<br><img src="http://www.mattiesgames.com/art/btnaudio.png"><br><br>btnskip.png<br><img src="http://www.mattiesgames.com/art/btnskip.png"><br><br>btnplay.png<br><img src="http://www.mattiesgames.com/art/btnplay.png"><br><br>btndef.png<br><img src="http://www.mattiesgames.com/art/btndef.png"><br><br>btnhp.png<br><img src="http://www.mattiesgames.com/art/btnhp.png"><br><br>btnskill.png<br><img src="http://www.mattiesgames.com/art/btnskill.png"><br><br>btnpower.png<br><img src="http://www.mattiesgames.com/art/btnpower.png"><br><br><br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
;This is both a learning exercise and hopefully a collaborative project of sorts
;or at least a project I can share with others on the blitz forum.
;It will be written initially in blitzplus/blitz3d and maybe someone will be keen on
;porting it to blitzmax...even blitzmax-ng to release on mobile perhaps?
;
;Interface:
;Left mouse button clicking only to make porting to 
;mobile interface much, much easier.
;Gameplay mechanic so far (15-May-2017)
;
;1. Arcade Action RPG Combat
;	Player controls 4 characters in a single screen dungeon.
;	Dungeon has a few walls and so on that prevent movement.
;	Monsters spawn from spawners and make their way around the map
;	Player taps the screen to move to location and characters fight things
;	in their path.
;	Powerups exist in the level such as:
;	Health pickups
;	Bombs - kill all monsters that have spawned or at least damage them.
;	
;2. After the arcade sequence the player is presented with options to upgrade their
;	character's stats. Stats to upgrade include:
;	Combat skill ('to hit roll')
;	Damage output ('damage points')
;	Health points ('hp')
;	Movement speed ('move')
;3.	After this a short cut scene is presented which may simply be a scrolling static
;	image with some fading in/fading out text to advance the story line
;0. Menu - toggle audio, play, credits
;
;Character types:
;1 Fighter - high hitpoint melee combat medium damage
;2 Ranger - medium hitpoint melee combat high damage
;3 Wizard - low hitpoint, ranged combat, medium damage
;4 Cleric - medium hitpoint, no combat, healer
;


;constants
Const SW=1280,SH=720,WIN=2
Const MODE_MENU = 0
Const MODE_COMBAT = 1
Const MODE_UPGRADE = 2
Const MODE_CUTSCENE = 3
Const PURE_2D = True ;if go to blitzmax can use 2d-in-3d commands such as alpha otherwise have to calculate manually.Change to false for blitzmax.

;categories for image types and object types
Const CAT_MENU_PLAY = 0
Const CAT_MENU_AUDIO = 1
Const CAT_MENU_SKIP_CUTSCENE = 2 ;cut scene mode
Const CAT_MENU_ADD_SKILL = 3 ;upgrade mode
Const CAT_MENU_ADD_DAMAGE = 4;upgrade mode
Const CAT_MENU_ADD_HEALTH = 5;upgrade mode
;Const CAT_MENU_ADD_SPEED = 6;
Const CAT_MENU_ADD_DEF = 6
Const CAT_MENU_MOUSE_CURSOR = 7;
Const CAT_FIGHTER = 10
Const CAT_KNIGHT = 10 ;synonym
Const CAT_RANGER = 11
Const CAT_WIZARD = 12
Const CAT_CLERIC = 13
Const CAT_HEALER = 13 ;synonym
Const CAT_HEALTH_PICKUP = 20
Const CAT_BOMB_PICKUP = 21
;CAT_BACKGROUND = 2000-3000 ; all the different image backgrounds
;CAT_MONSTER = 100-1000 , all the different monster types

Const AI_WANDER = 0
Const AI_ATTACK = 1

Const TEAM_PLAYER = 0
Const TEAM_MONSTER = 1

;globals
Global mx,my,lmb,olmb ;mouse input
Global audiostate ;on/off
Global gamemode ;references const above
Global gamelevel ;for cutscenes
Global cutsceneframe ;for cutscenes ie trigger fades, text, motion etc on certain frames
Global levelfinishtime = 0


Global ftrpicked,rngpicked,wizpicked,clrpicked ;boolean for upgrades

;arrays
Dim wallmap(0,0) ;0/1 value at each element indicates whether wall is there or not - redimension later
Dim blockmap(0,0) ;0/1 value - bigger version of wallmap lower resolution
;types
Type images

Field img ;handle
Field midhandled ;boolean
Field cat ;category //hooks into creature template

End Type 

Type creaturetemplate

Field img ;img handle
Field cat ;category
Field fullhp ;n (values range from about 10 to 200 for high level characters and monsters)
Field combatskill ;1-1000 (percentile out of a 1000 not 100) (roll under to hit/roll under to cast)
Field speed# ;n.m (movement speed)
Field damage ;n (damage per hit, also equal to hitpoints to heal per successful cast)

End Type 

Type bullet

Field img ;handle of image
Field team ;players or monsters - so no friendly fire
Field x#
Field y#
Field vx#
Field vy#
Field life
Field damage ;damage to inflict per hit then disappear

End Type

Type spawner

Field img
Field cat ;category to spawn
Field x
Field y
Field hp
Field timetospawn ;frames to count down from when respawning
Field spawndelay ;current frame count on spawner 0 to 'timetospawn'.

End Type 

Type creature

Field img
Field cat
Field x#
Field y#
Field tx#
Field ty#
Field hp
Field fullhp
Field speed#
Field damage
Field skill

Field defenseskill ;for players

Field aimode
Field aidelay
Field aitime

Field moving ;boolean

Field healingtime ;for healing effect/buff effect
Field lightningtime ;for lightning blasts on creature effect
Field strucktime ;for blood effects
Field attacktime 

Field activated ;boolean
Field waitcount ;int

Field stunned ;int 0-n counts down each time active....

End Type 

Type menubutton

Field cat ;for menu buttons
Field img
Field x
Field y
Field w
Field h
Field state ;pressed/not pressed

End Type 

Type cutscene

Field cat
Field img
Field x
Field y
Field levelnum ;for the specific level num
Field upperframe ;for the upper limit on the frame number to show this image for
Field transitiontype ;define later for transitioning between frames...do all this in code 

End Type 

;new emitters and particles
Type particle

Field r,g,b,a
Field x#,y#,vx#,vy#,ay#,gy#
Field life
Field dr,dg,db,da
Field sz,dsz

End Type



main()

Function main()
	quit = False
	gamemode = MODE_MENU
	init()
	Repeat
		frametime = MilliSecs()
		Cls
		;input 
		mx = MouseX()
		my = MouseY()
		olmb = lmb
		lmb = MouseDown(1)
		Select gamemode
		
		Case MODE_MENU
			handlemenu()
			drawmenu()
		
		Case MODE_COMBAT
			handleinput()
			updategame()
			drawgame()
		Case MODE_CUTSCENE
			handlecutscene()
			drawcutscene()
		Case MODE_UPGRADE
			handleupgrade()
			drawupgrade()
		End Select
		
		Flip
		;very basic frame limiting
		endframetime = MilliSecs()
		dtime = endframetime - frametime
		If dtime &lt; 15 Then 
			Delay 15 - dtime
		EndIf 
		;end of frame limiting
		If(KeyHit(1)) Then quit = True		
	Until quit
	;;;;;;
	End
End Function 

Function init()
Graphics SW,SH,0,WIN
;load all images here
;load all sounds here
;load all music here
HidePointer 

img.images = New images
img\img = LoadImage("images\btndef.png")
img\cat = CAT_MENU_ADD_DEF

img.images = New images
img\img = LoadImage("images\btnhp.png")
img\cat = CAT_MENU_ADD_HEALTH

img.images = New images
img\img = LoadImage("images\btnpower.png")
img\cat = CAT_MENU_ADD_DAMAGE

img.images = New images
img\img = LoadImage("images\btnskill.png")
img\cat = CAT_MENU_ADD_SKILL


img.images = New images
img\img = LoadImage("images\knight1.png")
img\cat = CAT_FIGHTER

img.images = New images
img\img = LoadImage("images\ranger1.png")
img\cat = CAT_RANGER

img.images = New images
img\img = LoadImage("images\wizard1.png")
img\cat = CAT_WIZARD

img.images = New images
img\img = LoadImage("images\cleric1.png")
img\cat = CAT_CLERIC

img.images = New images
img\img = LoadImage("images\goblin1.png")
img\cat = 100 ;goblin 1

img.images = New images
img\img = LoadImage("images\goblin2.png")
img\cat = 101 ;goblin 2

img.images = New images
img\img = LoadImage("images\troll1.png")
img\cat = 102 ;troll 1

img.images = New images
img\img = LoadImage("images\goblinshaman1.png")
img\cat = 103 ;goblin shaman

img.images = New images
img\img = LoadImage("images\giantspider1.png")
img\cat = 104 ;giant spider melee brute...

img.images = New images
img\img = LoadImage("images\spiderbeast1.png")
img\cat = 105 ;spider beast

img.images = New images
img\img = LoadImage("images\spiderwizard1.png")
img\cat = 106 ;spider wizard - stuns enemy units (reduces skill)

img.images = New images
img\img = LoadImage("images\spiderqueen1.png")
img\cat = 107 ;spider queen - stuns spell casters (reduces waitcount) and melee unit


img.images = New images
img\img = LoadImage("images\btnplay.png")
img\cat = CAT_MENU_PLAY

img.images = New images
img\img = LoadImage("images\btnaudio.png")
img\cat = CAT_MENU_AUDIO

img.images = New images
img\img = LoadImage("images\cursor.png")
img\cat = CAT_MENU_MOUSE_CURSOR

img.images = New images
img\img = LoadImage("images\btnskip.png")
img\cat = CAT_MENU_SKIP_CUTSCENE

;we don't have backgrounds yet so create them on the fly for now
img.images = New images
img\img = CreateImage(SW,SH)
SetBuffer ImageBuffer(img\img)
For i = 1 To 100
	Color 100,100,100
	Oval Rand(SW),Rand(SH),100,100,1
Next
SetBuffer BackBuffer()
img\cat = 2000

;img.images = New images
;img\img = LoadImage("images\bk1.jpg")
;img\cat = 2001 ;dungeon

End Function 

Function handlemenu()
;;;
;;;;
;;;Check if 'PLAY' pressed..if so then initialise
;first cut scene and change gamemode
;;;Check if 'TOGGLE AUDIO' pressed if so toggle music/audio flags

If lmb&lt;&gt;0 Then 
	If mx&gt;=1000 And mx&lt;=1200 Then 
		If my&gt;500 And my&lt;550 Then 
			;play hit
			initstartgame()
			gamemode = MODE_CUTSCENE
		EndIf 
		If my&gt;600 And my&lt;650 Then 
			audiostate = Not audiostate
			If Not audiostate
				;stop music
					
			EndIf 
		EndIf 
	EndIf 
EndIf 


End Function

Function drawmenu()
;draw backdrop
;draw buttons in relevant state
;draw mouse cursor

For img.images = Each images
	If img\cat = 2000 Then 
		DrawBlock img\img,0,0
	EndIf 
Next

For img.images = Each images
	If img\cat = CAT_MENU_PLAY
		DrawImage img\img,1000,500
	EndIf
	If img\cat = CAT_MENU_AUDIO
		DrawImage img\img,1000,600
	EndIf
Next

For img.images = Each images
	If img\cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img\img,mx,my
	EndIf
Next

End Function

Function handleinput()
;assign tx,ty of creatures to player units
;
acted = False
If lmb&lt;&gt;0 And olmb = 0 Then 
	For pc.creature = Each creature
		If pc\hp&gt;0 And pc\cat&gt;=10 And pc\cat&lt;=13 Then 
			If mx&gt;pc\x - ImageWidth(pc\img)/2 And mx&lt;pc\x + ImageWidth(pc\img)/2 And my&gt;pc\y-40 And my&lt;pc\y+40 Then 
				For a.creature = Each creature
					If a\hp&gt;0 And a\cat&lt;100 Then a\waitcount = a\waitcount + 1
					If a\waitcount &gt; 3 Then a\waitcount = 3
					If a\stunned &gt; 0 Then 
						a\stunned = a\stunned - 1
					EndIf 
				Next
				acted = True
				If pc\cat = CAT_FIGHTER And pc\stunned &lt;=0
					pc\attacktime = 30
					For a.creature = Each creature
						If a\cat &gt;= 100 And a\hp &gt; 0 Then 
							dieroll = Rand(1,1000)
							If dieroll &lt; pc\skill Then 
								a\hp = a\hp - pc\damage
								a\strucktime = 10
							EndIf 
						EndIf 
					Next
					pc\waitcount = 0
				EndIf
				If pc\cat = CAT_RANGER And pc\stunned &lt;=0
					maxhp = 0
					b.creature = Null;
					pc\attacktime = 30
					For a.creature = Each creature
						If a\cat &gt;= 100 And a\hp &gt; 0 Then 
							If a\hp &gt; maxhp Then 
								maxhp = a\hp
								b.creature = a.creature
							EndIf 
						EndIf 
					Next
					If b.creature&lt;&gt;Null Then 
						dieroll = Rand(1,1000)
						If dieroll &lt; pc\skill Then 
							b\hp = b\hp - pc\damage * (1 + pc\waitcount)
							b\strucktime = 15
						EndIf 
					EndIf 
					pc\waitcount = 0
				EndIf
				If pc\cat = CAT_WIZARD And pc\stunned&lt;=0
					pc\attacktime = 30
					damage = pc\damage * (pc\waitcount+1)
					For a.creature = Each creature
						If a\cat &gt;= 100 And a\hp &gt; 0 Then 
							dieroll = Rand(1,1000)
							If dieroll &lt; pc\skill Then 
								a\hp = a\hp - damage
								a\lightningtime = 30
								a\strucktime = 20
							Else
								pc\hp = pc\hp - 5 ; bad spell casting inflicts damage to caster
								pc\lightningtime = 30
								Exit
							EndIf 
						EndIf 
					Next
					pc\waitcount = 0
				EndIf
				If pc\cat = CAT_CLERIC And pc\stunned &lt;=0
					pc\attacktime = 30
					damage = pc\damage * (pc\waitcount + 1)
					For a.creature = Each creature
						If a\cat &lt; 100 And a\hp &lt; a\fullhp And a\hp &gt; 0 Then 
							a\hp = a\hp + damage
							a\healingtime = 60
							If a\hp &gt; a\fullhp Then a\hp = a\fullhp
						EndIf 
					Next
					pc\waitcount = 0
				EndIf	
			EndIf 
		EndIf 
	Next
EndIf 
If acted
	For a.creature = Each creature
		If a\hp &gt; 0 And a\cat &gt;= 100 Then 
			count = 0
			For pc.creature = Each creature
				If pc\cat &lt; 100 And pc\hp &gt; 0 Then count = count + 1
			Next
			If count &gt; 0 Then 
				count = Rand(1,count)
				For pc.creature = Each creature
					If pc\cat &lt; 100 And pc\hp &gt; 0 Then count = count - 1
					If count = 0 Then 
						dieroll = Rand(1,1000)
						If a\cat = 103 Then ;goblin shaman
							If dieroll &lt; a\skill Then 
								pc\hp = pc\hp - a\damage
								pc\strucktime = 10
								a\attacktime = 30
								pc\lightningtime = 30
							EndIf
						ElseIf a\cat = 106 Then ;spider wizard
							If dieroll &lt; a\skill Then 
								pc\stunned = Rand(1,2)
								dieroll2 = Rand(1,1000)
								If dieroll2 &gt; pc\defenseskill Then 
									pc\hp = pc\hp - a\damage
									pc\strucktime = 10
									a\attacktime = 30
								EndIf
								Exit
							EndIf 
						ElseIf a\cat = 107 Then ;spider queen
							If dieroll &lt; a\skill Then 
								For c.creature = Each creature
									If c\cat &gt;= 100 And c\hp &gt; 0 And c\hp &lt; c\fullhp
										c\healingtime = 60
										c\hp = c\hp + a\damage
										Exit 
									EndIf 
								Next
								dieroll2 = Rand(1,1000)
								If dieroll2 &gt; pc\defenseskill Then 
									pc\hp = pc\hp - a\damage
									pc\strucktime = 10
									a\attacktime = 30
								EndIf
								If pc\cat = CAT_WIZARD Or pc\cat = CAT_CLERIC
									pc\waitcount = 0
									Exit 
								EndIf
							EndIf 
							If dieroll &gt; pc\defenseskill Then 
								pc\hp = pc\hp - a\damage
								pc\strucktime = 10
								a\attacktime = 30
							EndIf
							Exit
						Else
							If dieroll &gt; pc\defenseskill Then 
								pc\hp = pc\hp - a\damage
								pc\strucktime = 10
								a\attacktime = 30
							EndIf
							Exit
						EndIf  
					EndIf 
				Next
				
			EndIf 
		EndIf 
	Next
EndIf
End Function

Function updategame()
;move all creatures
;move all bullets
;handle all collisions
;handle all pick ups
;handle all combat
;handle all spell casting (magic missiles and healing)

found = False

For pc.creature = Each creature
	If pc\strucktime &gt; 0 Then 
		pc\strucktime = pc\strucktime - 1
		createbloodparticle(pc\x,pc\y)
		If pc\hp &lt;= 0 Then 
			createbloodparticle(pc\x,pc\y)
			createbloodparticle(pc\x,pc\y)
			createbloodparticle(pc\x,pc\y)
		EndIf 
	EndIf 
	If pc\hp&gt;0 Then 
		If pc\cat &gt;= 100 Then 
			found = True
		EndIf
	Else
		Delete pc
	EndIf 
Next
If found = False Then 
	levelfinishtime = levelfinishtime + 1
EndIf 
foundp = False
For pc.creature = Each creature
	If pc\hp &gt; 0 And pc\cat &lt; 100 Then foundp = True:Exit 
Next
If foundp = False Then 
	levelfinishtime = levelfinishtime + 1
EndIf 
If levelfinishtime &gt; 250 Then 
	gamemode = MODE_MENU ;eventually change to mode_upgrade
	If foundp Then gamemode = MODE_UPGRADE
	gamelevel = gamelevel + 1
	ftrpicked = False
	clrpicked = False
	rngpicked = False
	wizpicked = False 
EndIf 

For pc.creature = Each creature
	If pc\hp &gt; 0 Then 
		If pc\healingtime &gt; 0 Then pc\healingtime = pc\healingtime - 1
	EndIf 
Next
updateparticle()
End Function

Function drawgame()
;draw background (fixed static 1280x720 image background)
;draw all creatures - don't worry about zordering them - it will be too fast to notice 
;draw all bullets
For img.images = Each images
	If img\cat = 2001 ;change this later
		DrawBlock img\img,0,0
	EndIf
Next
For pc.creature = Each creature
	If pc\hp &gt; 0 Then
		aa# = 0
		bb# = 0
		If pc\attacktime &gt; 0 Then 
			pc\attacktime = pc\attacktime - 1
			aa# = -25.0 * Sin(pc\attacktime * 6)
			If pc\cat&gt;=100 Then aa = aa * -1.0
		EndIf 
		If pc\strucktime &gt; 0 Then 
			bb = Rand(-pc\strucktime/2,pc\strucktime/2)
		EndIf 
		DrawImage pc\img,bb + pc\x - ImageWidth(pc\img)/2,pc\y - 40 + aa
		dhp = 10 * pc\hp / pc\fullhp
		If dhp &lt; 4 Then Color 255,32,32
		If dhp &gt;=4 And dhp&lt;8 Then Color 255,255,32
		If dhp &gt;=8 Then Color 32,255,32
		If dhp = 0 Then dhp = 1
		For hp = 1 To dhp
			Rect hp*4 + pc\x - ImageWidth(pc\img)/3,pc\y - 50,3,3,1
		Next
		If pc\healingtime &gt; 0 Then 
			createhealparticle(pc\x,pc\y)
		EndIf 
		If pc\lightningtime &gt; 0 Then 
			pc\lightningtime = pc\lightningtime - 1
			drawlightning(pc\x,pc\y)
		EndIf 
		If pc\waitcount &gt; 0 Then 
			Color 255,32,255
			For i = 1 To pc\waitcount
				Rect i * 4 + pc\x - ImageWidth(pc\img)/3,pc\y - 55,3,3,1
			Next
		EndIf 
		If pc\stunned &gt; 0 Then 
			Color 255,255,32
			Oval pc\x - ImageWidth(pc\img)/2,pc\y-40,ImageWidth(pc\img),80,0
		EndIf 
	EndIf
Next
drawparticle()
Color 255,255,255
For img.images = Each images
	If img\cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img\img,mx,my
	EndIf
Next


End Function 

Function drawlightning(x,y)

iy = 0
ix = x + Rand(-20,20)
While iy &lt; y
oy = iy
ox = ix
ix = x + Rand(-20,20)
iy = iy + Rand(10,25)
Color 200,200,255
Line ox,oy,ix,iy
Color 150,150,200
Line ox+1,oy+1,ix+1,iy+1
Line ox-1,oy-1,ix-1,iy-1
Color 100,100,150
Line ox+2,oy+2,ix+2,iy+2
Line ox-2,oy-2,ix-2,iy-2
Color 32,32,90
Line ox+3,oy+3,ix+3,iy+3
Line ox-3,oy-3,ix-3,iy-3

Wend 

End Function 

Function handlecutscene()
;handle transitions,  handle skip button; 
;handle fading in and out text (bitmap fonts?)

If lmb&lt;&gt;0 Then 
	If mx&gt;1000 And mx&lt;1200 And my&gt;600 And my&lt;650 Then 
		initlevel()
		gamemode = MODE_COMBAT
	EndIf 
EndIf 

End Function 

Function drawcutscene()
;draw cut scene background, draw transition, draw skip button
For img.images = Each images
	If img\cat = 2000 Then 
		DrawBlock img\img,0,0
	EndIf 
Next

For img.images = Each images
	If img\cat = CAT_MENU_SKIP_CUTSCENE
		DrawImage img\img,1000,600
	EndIf
Next

For img.images = Each images
	If img\cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img\img,mx,my
	EndIf
Next

End Function 

Function handleupgrade()
;handle button press 'add stuff' to characters
;
;
;
If lmb&lt;&gt;0 Then 
	If mx &gt; 1000 And mx&lt;1200 And my&gt;600 And my &lt;650
		gamemode = MODE_CUTSCENE
	EndIf
	i = -1
	For pc.creature = Each creature
	If pc\cat &lt; 100 And pc\hp &gt; 0 Then 
		i = i + 1
		y = 100 * i + 200
		DrawImage pc\img,100,y
		If pc\cat = CAT_FIGHTER And (Not ftrpicked)
			If mx&gt;200 And mx &lt; 400 And my &gt; y And my &lt; y + 50 Then 
				;health picked
				ftrpicked = True
				pc\fullhp = pc\fullhp + 10
			EndIf 
			If mx&gt;450 And mx &lt; 650 And my &gt; y And my &lt; y + 50 Then 
				;damage picked
				ftrpicked = True
				pc\damage = pc\damage + 4
			EndIf 
			
			If mx&gt;700 And mx &lt; 900 And my &gt; y And my &lt; y + 50 Then 
				;skill picked
				ftrpicked = True
				ds# = (1000 - pc\skill) * 0.95
				pc\skill = 1000 - ds
			EndIf 
			
			If mx&gt;950 And mx &lt; 1150 And my &gt; y And my &lt; y + 50 Then 
				;def picked
				ftrpicked = True
				ds# = (1000 - pc\defenseskill) * 0.95
				pc\defenseskill = 1000 - ds
			EndIf 
		EndIf
		If pc\cat = CAT_RANGER And (Not rngpicked)
			If mx&gt;200 And mx &lt; 400 And my &gt; y And my &lt; y + 50 Then 
				;health picked
				rngpicked = True
				pc\fullhp = pc\fullhp + 10
			EndIf 
			If mx&gt;450 And mx &lt; 650 And my &gt; y And my &lt; y + 50 Then 
				;damage picked
				rngpicked = True
				pc\damage = pc\damage + 4
			EndIf 
			
			If mx&gt;700 And mx &lt; 900 And my &gt; y And my &lt; y + 50 Then 
				;skill picked
				rngpicked = True
				ds# = (1000 - pc\skill) * 0.95
				pc\skill = 1000 - ds
			EndIf 
			
			If mx&gt;950 And mx &lt; 1150 And my &gt; y And my &lt; y + 50 Then 
				;def picked
				rngpicked = True
				ds# = (1000 - pc\defenseskill) * 0.95
				pc\defenseskill = 1000 - ds
			EndIf 
		
		EndIf
		If pc\cat = CAT_WIZARD And (Not wizpicked)
			If mx&gt;200 And mx &lt; 400 And my &gt; y And my &lt; y + 50 Then 
				;health picked
				wizpicked = True
				pc\fullhp = pc\fullhp + 10
			EndIf 
			If mx&gt;450 And mx &lt; 650 And my &gt; y And my &lt; y + 50 Then 
				;damage picked
				wizpicked = True
				pc\damage = pc\damage + 4
			EndIf 
			
			If mx&gt;700 And mx &lt; 900 And my &gt; y And my &lt; y + 50 Then 
				;skill picked
				wizpicked = True
				ds# = (1000 - pc\skill) * 0.95
				pc\skill = 1000 - ds
			EndIf 
			
			If mx&gt;950 And mx &lt; 1150 And my &gt; y And my &lt; y + 50 Then 
				;def picked
				wizpicked = True
				ds# = (1000 - pc\defenseskill) * 0.95
				pc\defenseskill = 1000 - ds
			EndIf 

		EndIf
		If pc\cat = CAT_CLERIC And (Not clrpicked)
			If mx&gt;200 And mx &lt; 400 And my &gt; y And my &lt; y + 50 Then 
				;health picked
				clrpicked = True
				pc\fullhp = pc\fullhp + 10
			EndIf 
			If mx&gt;450 And mx &lt; 650 And my &gt; y And my &lt; y + 50 Then 
				;damage picked
				clrpicked = True
				pc\damage = pc\damage + 4
			EndIf 
			If mx&gt;700 And mx &lt; 900 And my &gt; y And my &lt; y + 50 Then 
				;skill picked
				clrpicked = True
				ds# = (1000 - pc\skill) * 0.95
				pc\skill = 1000 - ds
			EndIf 
			If mx&gt;950 And mx &lt; 1150 And my &gt; y And my &lt; y + 50 Then 
				;def picked
				clrpicked = True
				ds# = (1000 - pc\defenseskill) * 0.95
				pc\defenseskill = 1000 - ds
			EndIf 
		EndIf 
	EndIf 
Next


	
EndIf


End Function

Function drawupgrade()
;draw background
;draw buttons
;draw characters
;draw stats
;draw continue button
For img.images = Each images
	If img\cat = 2000 Then 
	;	DrawBlock img\img,0,0
	EndIf 
Next

i=-1
For pc.creature = Each creature
	If pc\cat &lt; 100 And pc\hp &gt; 0 Then 
		pc\hp = pc\fullhp
		i = i + 1
		y = 100 * i + 200
		DrawImage pc\img,100,y
	;	Text 150,i*100+200,"Skill:"+pc\skill+" Defense:"+pc\defenseskill + " Health:"+pc\fullhp + " Power:"+pc\damage
		If pc\cat = CAT_FIGHTER And (Not ftrpicked)
			For img.images = Each images
				If img\cat = CAT_MENU_ADD_HEALTH Then
					DrawImage img\img,200,y
				EndIf
				If img\cat = CAT_MENU_ADD_DAMAGE Then
					DrawImage img\img,450,y
				EndIf
				If img\cat = CAT_MENU_ADD_SKILL Then
					DrawImage img\img,700,y
				EndIf
				If img\cat = CAT_MENU_ADD_DEF Then 
					DrawImage img\img,950,y
				EndIf 
			Next
		EndIf
		If pc\cat = CAT_RANGER And (Not rngpicked)
			For img.images = Each images
				If img\cat = CAT_MENU_ADD_HEALTH Then
					DrawImage img\img,200,y
				EndIf
				If img\cat = CAT_MENU_ADD_DAMAGE Then
					DrawImage img\img,450,y
				EndIf
				If img\cat = CAT_MENU_ADD_SKILL Then
					DrawImage img\img,700,y
				EndIf
				If img\cat = CAT_MENU_ADD_DEF Then 
					DrawImage img\img,950,y
				EndIf 
			Next
		
		EndIf
		If pc\cat = CAT_WIZARD And (Not wizpicked)
			For img.images = Each images
				If img\cat = CAT_MENU_ADD_HEALTH Then
					DrawImage img\img,200,y
				EndIf
				If img\cat = CAT_MENU_ADD_DAMAGE Then
					DrawImage img\img,450,y
				EndIf
				If img\cat = CAT_MENU_ADD_SKILL Then
					DrawImage img\img,700,y
				EndIf
				If img\cat = CAT_MENU_ADD_DEF Then 
					DrawImage img\img,950,y
				EndIf 
			Next
		
		EndIf
		If pc\cat = CAT_CLERIC And (Not clrpicked)
			For img.images = Each images
				If img\cat = CAT_MENU_ADD_HEALTH Then
					DrawImage img\img,200,y
				EndIf
				If img\cat = CAT_MENU_ADD_DAMAGE Then
					DrawImage img\img,450,y
				EndIf
				If img\cat = CAT_MENU_ADD_SKILL Then
					DrawImage img\img,700,y
				EndIf
				If img\cat = CAT_MENU_ADD_DEF Then 
					DrawImage img\img,950,y
				EndIf 
			Next
		
		EndIf 
	EndIf 
Next


For img.images = Each images
	If img\cat = CAT_MENU_SKIP_CUTSCENE
		DrawImage img\img,1000,600
	EndIf
Next

Text 0,0,"On this screen you would upgrade some of your characters"

For img.images = Each images
	If img\cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img\img,mx,my
	EndIf
Next




End Function 

Function initstartgame()
gamelevel = 1
Delete Each creature
pc.creature = New creature
pc\fullhp = 90
pc\hp = 90
pc\cat = CAT_FIGHTER
pc\x = 600
pc\y = 300
pc\tx = pc\x
pc\ty = pc\y
pc\skill = 100
pc\defenseskill = 850
pc\damage = 10
pc\speed = 4.0
For img.images = Each images
	If img\cat = CAT_FIGHTER Then 
		pc\img = img\img
		Exit 
	EndIf 
Next
pc.creature = New creature
pc\fullhp = 75
pc\hp = 75
pc\cat = CAT_RANGER
pc\x = 640
pc\y = 300
pc\tx = pc\x
pc\ty = pc\y
pc\skill = 800
pc\defenseskill = 850
pc\damage = 50
pc\speed = 5.0
For img.images = Each images
	If img\cat = CAT_RANGER Then 
		pc\img = img\img
		Exit 
	EndIf 
Next
pc.creature = New creature
pc\fullhp = 45
pc\hp = 45
pc\cat = CAT_WIZARD
pc\x = 750
pc\y = 360
pc\tx = pc\x
pc\ty = pc\y
pc\skill = 650
pc\damage = 18
pc\speed = 5.0
pc\defenseskill = 500
For img.images = Each images
	If img\cat = CAT_WIZARD Then 
		pc\img = img\img
		Exit 
	EndIf 
Next
pc.creature = New creature
pc\fullhp = 60
pc\hp = 60
pc\cat = CAT_CLERIC
pc\x = 640
pc\defenseskill = 800
pc\y = 350
pc\tx = pc\x
pc\ty = pc\y
pc\skill = 100
pc\damage = 5
pc\speed = 4.0
For img.images = Each images
	If img\cat = CAT_CLERIC Then 
		pc\img = img\img
		Exit 
	EndIf 
Next
End Function 

Function initlevel()
Dim wallmap(SW,SH)
Dim blockmap(SW/20,SH/12)
For pc.creature = Each creature
	If pc\hp &gt; 0 And pc\hp &lt; pc\fullhp Then pc\hp = pc\fullhp
	If pc\cat = CAT_FIGHTER
		pc\x = 300
		pc\y = 400
	EndIf
	If pc\cat = CAT_RANGER
		pc\x = 375
		pc\y = 400
	EndIf
	If pc\cat = CAT_WIZARD
		pc\x = 450
		pc\y = 400
	EndIf
	If pc\cat = CAT_CLERIC
		pc\x = 500
		pc\y = 400
	EndIf
	pc\x = pc\x + 200
	pc\tx = pc\x
	pc\ty = pc\y
	If pc\cat &gt;=100 Then Delete pc
Next

For i = 1 To 8
	pc.creature = New creature
	pc\x = 300 + i * 80;Rand(0,SW)
	pc\y = 200 ;Rand(0,SH)
	pc\tx = pc\x
	pc\ty = pc\y
	
	If gamelevel = 1 Then 
	pc\cat = 100+Rand(0,1)
	pc\hp = 70
	pc\fullhp = 50
	pc\speed = 3
	pc\damage = 5
	pc\skill = 80
	EndIf
	If gamelevel = 2 Then 
		;trolls2
		If i = 1 Or i = 8 Then 
			pc\cat = 102
			pc\hp = 200
			pc\fullhp = 200
			pc\speed = 3
			pc\damage = 10
			pc\skill = 150
		Else
			pc\cat = 100+Rand(0,1)
			pc\hp = 70
			pc\fullhp = 50
			pc\speed = 3
			pc\damage = 5
			pc\skill = 80
		EndIf 
	EndIf 
	If gamelevel = 3 Then 
		;wizard and troll
		If i = 1 Or i = 8 Then
			pc\cat = 102
			pc\hp = 200
			pc\fullhp = 200
			pc\speed = 3
			pc\damage = 10
			pc\skill = 150
		ElseIf i = 4 Then
			pc\cat = 103
			pc\hp = 100
			pc\fullhp = 100
			pc\speed = 3
			pc\damage = 5
			pc\skill = 350
		Else
			pc\cat = 100+Rand(0,1)
			pc\hp = 70
			pc\fullhp = 50
			pc\speed = 3
			pc\damage = 5
			pc\skill = 80
		EndIf 
	EndIf
	If gamelevel = 4 Then
		;spiderbeasts and giant spiders
		If i = 1 Or i = 8 Then 
			pc\cat = 104
			pc\hp = 150
			pc\fullhp = 150
			pc\speed = 3
			pc\damage = 15
			pc\skill = 100
		Else
			pc\cat = 105
			pc\hp = 100
			pc\fullhp = 100
			pc\speed = 3
			pc\damage = 8
			pc\skill = 150
		EndIf 

	EndIf
	If gamelevel = 5 Then 
		;spiderbeasts, giant spiders and spider wizards
		If i = 1 Or i = 8 Then 
			pc\cat = 104
			pc\hp = 150
			pc\fullhp = 150
			pc\speed = 3
			pc\damage = 15
			pc\skill = 100
		ElseIf i = 2 Or i = 7
			pc\cat = 106
			pc\hp = 100
			pc\fullhp = 100
			pc\speed = 3
			pc\damage = 8
			pc\skill = 300
		Else
			pc\cat = 105
			pc\hp = 100
			pc\fullhp = 100
			pc\speed = 3
			pc\damage = 8
			pc\skill = 150
		EndIf 


	EndIf 
	If gamelevel = 6 Then 
		;spider queens and spiderbeasts
		If i = 1 Or i = 8 Then 
			pc\cat = 107
			pc\hp = 100
			pc\fullhp = 100
			pc\speed = 3
			pc\damage = 5
			pc\skill = 450
		Else
			pc\cat = 105
			pc\hp = 100
			pc\fullhp = 100
			pc\speed = 3
			pc\damage = 8
			pc\skill = 150
		EndIf 
	EndIf 
	If gamelevel = 7 Then 
		;spider queens and giant spiders and spider wizards
		If i = 4 Or i = 5 Then 
			pc\cat = 107
			pc\hp = 100
			pc\fullhp = 100
			pc\speed = 3
			pc\damage = 5
			pc\skill = 450
		ElseIf i = 2 Or i = 7
			pc\cat = 106
			pc\hp = 100
			pc\fullhp = 100
			pc\speed = 3
			pc\damage = 8
			pc\skill = 300
		Else
			pc\cat = 104
			pc\hp = 150
			pc\fullhp = 150
			pc\speed = 3
			pc\damage = 15
			pc\skill = 100
		EndIf 
	EndIf 
	For img.images = Each images
		If img\cat = pc\cat Then 
			pc\img = img\img
			Exit 
		EndIf 
	Next
Next

lmb = 0
olmb = 0
FlushMouse()
levelfinishtime = 0
End Function 

Function createhealparticle(x,y)

For i = 1 To 36
	p.particle = New particle
	p\life = 20
	p\x = x + 25.0 * Cos(i*10)
	p\y = y + 20 + 25.0 * (Sin(i*5))
	p\vx = 0
	p\vy = Rand(-4,-2)
	p\ay = 0.1
	p\gy = p\y + 100
	p\r = 32
	p\g = 200
	p\b = 255
	p\sz = 4
	p\dsz = -0.1
	p\dr = 10
	p\dg = 2
	p\db = 0
Next

End Function 

Function createbloodparticle(x,y)

For i = 1 To 10
	p.particle = New particle
	p\life = 20
	p\x = x + Rand(-10,10)
	p\y = y + Rand(-10,10)
	p\vx = Rnd(-3,3)
	p\vy = Rnd(-3,3)
	p\ay = 0.05
	p\gy = y + 42
	p\r = 255
	p\g = 100
	p\b = 100
	p\dr = -2
	p\dg = -3
	p\db = -3
	p\sz = 4
	p\dsz = 0
Next

End Function 

Function updateparticle()
For p.particle = Each particle
	p\life = p\life - 1
	p\x = p\x + p\vx
	p\y = p\y + p\vy
	p\vy = p\vy + p\ay
	If p\y &gt; p\gy Then 
		p\vy = p\vy * -0.7
		If Abs(p\vy)&lt;0.01 Then p\life = 0
	EndIf 
	p\sz = p\sz + p\dsz
	p\r = p\r + p\dr
	p\g = p\g + p\dg
	p\b = p\b + p\db
	If p\sz &lt; 0 Then p\sz = 0
	If p\r &gt; 255 Then p\r = 255
	If p\g &gt; 255 Then p\g = 255
	If p\b &gt; 255 Then p\b = 255
	If p\r &lt; 0 Then p\r = 0
	If p\g &lt; 0 Then p\g = 0
	If p\b &lt; 0 Then p\b = 0
	If p\life &lt; 0 Then Delete p
Next
End Function 

Function drawparticle()
For p.particle = Each particle
	Color p\r,p\g,p\b
	Rect p\x,p\y,p\sz,p\sz,1
Next
Color 255,255,255
End Function 
</textarea> <br><br></td></tr></table><br>
<a name="1341197"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rooster</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#62">[#62]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay I guess I will start working on functions and methods that will help with adding new content.<br><br>As far as themes go, reptile people and beast men sound good.<br>Eye beasts? You mean kind of like in that first drawing you posted? Because that would be cool.<br><br>How do these sound?<br>Dragons: Maybe really high level monsters?<br>Centaurs, satyrs and fauns<br>Shape shifter?: Probably too over complimented.<br>Tree spirits<br>Sirens<br>Unicorns: I seem to recall them being depicted as highly aggressive animals in fairy tales<br>Golems<br>Giants<br><br>Hope these help. <br><br></td></tr></table><br>
<a name="1341199"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#63">[#63]</a></td></tr></table></td></tr><tr ><td class="posttext"> hi Rooster<br><br>I think for the moment the code doesn't need a lot of changes...but perhaps what could be done is some work on creating new 'effects' ie spell and particle effects...have a look at the create'xxx'particle effect codes and make some new ones that look good.<br><br>I'm going to do some drawings over the next few days. <br><br></td></tr></table><br>
<a name="1341202"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rooster</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#64">[#64]</a></td></tr></table></td></tr><tr ><td class="posttext"> I guess I should have clearer.<br>I meant something to automatically do stuff like load images, with little to no new code.<br><br>I'm interested to see what you turn out. <br><br></td></tr></table><br>
<a name="1341204"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rooster</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#65">[#65]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay, I've ported the last iteration of the code for those who want it.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
'This is both a learning exercise And hopefully a collaborative project of sorts
'Or at least a project I can share with others on the blitz forum.
'It will be written initially in blitzplus/blitz3d And maybe someone will be keen on
'porting it To blitzmax...even blitzmax-ng To Release on mobile perhaps?
'
'Interface:
'Left mouse button clicking only To make porting To 
'mobile interface much, much easier.
'Gameplay mechanic so far (15-May-2017)
'
'1. Arcade Action RPG Combat
'	Player controls 4 characters in a single screen dungeon.
'	Dungeon has a few walls And so on that prevent movement.
'	Monsters spawn from spawners And make their way around the map
'	Player taps the screen To move To location And characters fight things
'	in their path.
'	Powerups exist in the level such as:
'	Health pickups
'	Bombs - kill all monsters that have spawned Or at least damage them.
'	
'2. After the arcade sequence the player is presented with options To upgrade their
'	character's stats. Stats to upgrade include:
'	Combat skill ('to hit roll')
'	Damage output ('damage points')
'	Health points ('hp')
'	Movement speed ('move')
'3.	After this a Short cut scene is presented which may simply be a scrolling static
'	image with some fading in/fading out text To advance the story line
'0. Menu - toggle audio, play, credits
'
'Character types:
'1 Fighter - high hitpoint melee combat medium damage
'2 Ranger - medium hitpoint melee combat high damage
'3 Wizard - low hitpoint, ranged combat, medium damage
'4 Cleric - medium hitpoint, no combat, healer
'


'constants
Const SW=1280,SH=720,WIN=2
Const MODE_MENU = 0
Const MODE_COMBAT = 1
Const MODE_UPGRADE = 2
Const MODE_CUTSCENE = 3
Const PURE_2D = True 'If go To blitzmax can use 2d-in-3d commands such as alpha otherwise have To calculate manually.Change To False For blitzmax.

'categories For image types And Object types
Const CAT_MENU_PLAY = 0
Const CAT_MENU_AUDIO = 1
Const CAT_MENU_SKIP_CUTSCENE = 2 'cut scene mode
Const CAT_MENU_ADD_SKILL = 3 'upgrade mode
Const CAT_MENU_ADD_DAMAGE = 4'upgrade mode
Const CAT_MENU_ADD_HEALTH = 5'upgrade mode
'Const CAT_MENU_ADD_SPEED = 6'
Const CAT_MENU_ADD_DEF = 6
Const CAT_MENU_MOUSE_CURSOR = 7'
Const CAT_FIGHTER = 10
Const CAT_KNIGHT = 10 'synonym
Const CAT_RANGER = 11
Const CAT_WIZARD = 12
Const CAT_CLERIC = 13
Const CAT_HEALER = 13 'synonym
Const CAT_HEALTH_PICKUP = 20
Const CAT_BOMB_PICKUP = 21
'CAT_BACKGROUND = 2000-3000 ' all the different image backgrounds
'CAT_MONSTER = 100-1000 , all the different monster types

Const AI_WANDER = 0
Const AI_ATTACK = 1

Const TEAM_PLAYER = 0
Const TEAM_MONSTER = 1

'globals
Global mx,my,lmb,olmb 'mouse Input
Global audiostate 'on/off
Global gamemode 'references Const above
Global gamelevel 'For cutscenes
Global cutsceneframe 'For cutscenes ie trigger fades, text, motion etc on certain frames
Global levelfinishtime = 0


Global ftrpicked,rngpicked,wizpicked,clrpicked 'boolean For upgrades

'for Bmax -Rooster
Global list_objects:TList=New TList

'arrays
Global wallmap[0,0] '0/1 value at each element indicates whether wall is there Or Not - redimension later
Global blockmap[0,0] '0/1 value - bigger version of wallmap Lower resolution
'types
Type images

Field img 'handle
Field midhandled 'boolean
Field cat 'category //hooks into creature template

End Type 

Type creaturetemplate

Field img 'img handle
Field cat 'category
Field fullhp 'n (values range from about 10 To 200 For high level characters And monsters)
Field combatskill '1-1000 (percentile out of a 1000 Not 100) (roll under To hit/roll under To cast)
Field speed# 'n.m (movement speed)
Field damage 'n (damage per hit, also equal To hitpoints To heal per successful cast)

End Type 

Type bullet

Field img 'handle of image
Field team 'players Or monsters - so no friendly fire
Field x#
Field y#
Field vx#
Field vy#
Field life
Field damage 'damage To inflict per hit Then disappear

End Type

Type spawner

Field img
Field cat 'category To spawn
Field x
Field y
Field hp
Field timetospawn 'frames To count down from when respawning
Field spawndelay 'Current frame count on spawner 0 To 'timetospawn'.

End Type 

Type creature

Field img
Field cat
Field x#
Field y#
Field tx#
Field ty#
Field hp
Field fullhp
Field speed#
Field damage
Field skill

Field defenseskill 'For players

Field aimode
Field aidelay
Field aitime

Field moving 'boolean

Field healingtime 'For healing effect/buff effect
Field lightningtime 'For lightning blasts on creature effect
Field strucktime 'For blood effects
Field attacktime 

Field activated 'boolean
Field waitcount 'Int

Field stunned 'Int 0-n counts down each time active....

End Type 

Type menubutton

Field cat 'For menu buttons
Field img
Field x
Field y
Field w
Field h
Field state 'pressed/Not pressed

End Type 

Type cutscene

Field cat
Field img
Field x
Field y
Field levelnum 'For the specific level num
Field upperframe 'For the Upper limit on the frame number To show this image For
Field transitiontype 'define later For transitioning between frames...do all this in code 

End Type 

'New emitters And particles
Type particle

Field r,g,b,a
Field x#,y#,vx#,vy#,ay#,gy#
Field life
Field dr,dg,db,da
Field sz,dsz

End Type



Main()

Function Main()
	quit = False
	gamemode = MODE_MENU
	init()
	Repeat
		frametime = MilliSecs()
		Cls
		'Input 
		mx = MouseX()
		my = MouseY()
		olmb = lmb
		lmb = MouseDown(1)
		Select gamemode
		
		Case MODE_MENU
			handlemenu()
			drawmenu()
		
		Case MODE_COMBAT
			handleinput()
			updategame()
			drawgame()
		Case MODE_CUTSCENE
			handlecutscene()
			drawcutscene()
		Case MODE_UPGRADE
			handleupgrade()
			drawupgrade()
		End Select
		
		Flip
		'very basic frame limiting
		endframetime = MilliSecs()
		dtime = endframetime - frametime
		If dtime &lt; 15 Then 
			Delay 15 - dtime
		EndIf 
		'End of frame limiting
		If(KeyHit(27)) Then quit = True		
	Until quit
	''''''
	End
End Function 

Function init()
Graphics SW,SH,0',WIN
'Load all images here
'Load all sounds here
'Load all music here
HideMouse ()

img:images = New images
img.img = LoadImage("images\btndef.png")
img.cat = CAT_MENU_ADD_DEF
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\btnhp.png")
img.cat = CAT_MENU_ADD_HEALTH
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\btnpower.png")
img.cat = CAT_MENU_ADD_DAMAGE
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\btnskill.png")
img.cat = CAT_MENU_ADD_SKILL
list_objects.AddLast img


img:images = New images
img.img = LoadImage("images\knight1.png")
img.cat = CAT_FIGHTER
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\ranger1.png")
img.cat = CAT_RANGER
		If img.img = 0
		  Print "trap 10"
		  End
		EndIf
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\wizard1.png")
img.cat = CAT_WIZARD
		If img.img = 0
		  Print "trap 11"
		  Print img.img
		  End
		EndIf
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\cleric1.png")
img.cat = CAT_CLERIC
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\goblin1.png")
img.cat = 100 'goblin 1
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\goblin2.png")
img.cat = 101 'goblin 2
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\troll1.png")
img.cat = 102 'troll 1
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\goblinshaman1.png")
img.cat = 103 'goblin shaman
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\giantspider1.png")
img.cat = 104 'giant spider melee brute...
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\spiderbeast1.png")
img.cat = 105 'spider beast
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\spiderwizard1.png")
img.cat = 106 'spider wizard - stuns enemy units (reduces skill)
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\spiderqueen1.png")
img.cat = 107 'spider queen - stuns spell casters (reduces waitcount) And melee unit
list_objects.AddLast img


img:images = New images
img.img = LoadImage("images\btnplay.png")
img.cat = CAT_MENU_PLAY
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\btnaudio.png")
img.cat = CAT_MENU_AUDIO
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\cursor.png")
img.cat = CAT_MENU_MOUSE_CURSOR
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\btnskip.png")
img.cat = CAT_MENU_SKIP_CUTSCENE
list_objects.AddLast img

'we don't have backgrounds yet so create them on the fly for now
img:images = New images
img.img = CreateImage(SW,SH)
LockImage( img.img,0,0) 'more stuff needed for BMax to draw to image -Rooster

For i = 1 To 100
	SetColor (100,100,100)
	DrawOval Rand(SW),Rand(SH),100,100',1
Next

GrabImage img.img,0,0 'more stuff needed for BMax to draw to image -Rooster
UnlockImage (img.img)

img.cat = 2000
list_objects.AddLast img

'img.images = New images
'img.img = LoadImage("images.bk1.jpg")
'img.cat = 2001 'dungeon
SetColor 255,255,255'reseting the draw color for BMax -Rooster

End Function 

Function handlemenu()
'''
''''
'''Check If 'PLAY' pressed..if so then initialise
'first cut scene And change gamemode
'''Check If 'TOGGLE AUDIO' pressed if so toggle music/audio flags

If lmb&lt;&gt;0 Then 
	If mx&gt;=1000 And mx&lt;=1200 Then 
		If my&gt;500 And my&lt;550 Then 
			'play hit
			initstartgame()
			gamemode = MODE_CUTSCENE
		EndIf 
		If my&gt;600 And my&lt;650 Then 
			audiostate = Not audiostate
			If Not audiostate
				'stop music
					
			EndIf 
		EndIf 
	EndIf 
EndIf 


End Function

Function drawmenu()
'draw backdrop
'draw buttons in relevant state
'draw mouse cursor

For img:images = EachIn list_objects 
	If img.cat = 2000 Then 
		DrawImage img.img,0,0
	EndIf 
Next

For img:images = EachIn list_objects
	If img.cat = CAT_MENU_PLAY
		DrawImage img.img,1000,500
	EndIf
	If img.cat = CAT_MENU_AUDIO
		DrawImage img.img,1000,600
	EndIf
Next

For img:images = EachIn list_objects 
	If img.cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img.img,mx,my
	EndIf
Next

End Function

Function handleinput()
'assign tx,ty of creatures To player units
'
acted = False
If lmb&lt;&gt;0 And olmb = 0 Then 
	For pc:creature = EachIn list_objects 
		If pc.hp&gt;0 And pc.cat&gt;=10 And pc.cat&lt;=13 Then 
			If mx&gt;pc.x - ImageWidth(pc.img)/2 And mx&lt;pc.x + ImageWidth(pc.img)/2 And my&gt;pc.y-40 And my&lt;pc.y+40 Then 
				For a:creature = EachIn list_objects 
					If a.hp&gt;0 And a.cat&lt;100 Then a.waitcount = a.waitcount + 1
					If a.waitcount &gt; 3 Then a.waitcount = 3
					If a.stunned &gt; 0 Then 
						a.stunned = a.stunned - 1
					EndIf 
				Next
				acted = True
				If pc.cat = CAT_FIGHTER And pc.stunned &lt;=0
					pc.attacktime = 30
					For a:creature = EachIn list_objects 
						If a.cat &gt;= 100 And a.hp &gt; 0 Then 
							dieroll = Rand(1,1000)
							If dieroll &lt; pc.skill Then 
								a.hp = a.hp - pc.damage
								a.strucktime = 10
							EndIf 
						EndIf 
					Next
					pc.waitcount = 0
				EndIf
				If pc.cat = CAT_RANGER And pc.stunned &lt;=0
					maxhp = 0
					b:creature = Null'
					pc.attacktime = 30
					For a:creature = EachIn list_objects 
						If a.cat &gt;= 100 And a.hp &gt; 0 Then 
							If a.hp &gt; maxhp Then 
								maxhp = a.hp
								b:creature = a:creature
							EndIf 
						EndIf 
					Next
					If b:creature&lt;&gt;Null Then 
						dieroll = Rand(1,1000)
						If dieroll &lt; pc.skill Then 
							b.hp = b.hp - pc.damage * (1 + pc.waitcount)
							b.strucktime = 15
						EndIf 
					EndIf 
					pc.waitcount = 0
				EndIf
				If pc.cat = CAT_WIZARD And pc.stunned&lt;=0
					pc.attacktime = 30
					damage = pc.damage * (pc.waitcount+1)
					For a:creature = EachIn list_objects 
						If a.cat &gt;= 100 And a.hp &gt; 0 Then 
							dieroll = Rand(1,1000)
							If dieroll &lt; pc.skill Then 
								a.hp = a.hp - damage
								a.lightningtime = 30
								a.strucktime = 20
							Else
								pc.hp = pc.hp - 5 ' bad spell casting inflicts damage To caster
								pc.lightningtime = 30
								Exit
							EndIf 
						EndIf 
					Next
					pc.waitcount = 0
				EndIf
				If pc.cat = CAT_CLERIC And pc.stunned &lt;=0
					pc.attacktime = 30
					damage = pc.damage * (pc.waitcount + 1)
					For a:creature = EachIn list_objects
						If a.cat &lt; 100 And a.hp &lt; a.fullhp And a.hp &gt; 0 Then 
							a.hp = a.hp + damage
							a.healingtime = 60
							If a.hp &gt; a.fullhp Then a.hp = a.fullhp
						EndIf 
					Next
					pc.waitcount = 0
				EndIf	
			EndIf 
		EndIf 
	Next
EndIf 
If acted
	For a:creature = EachIn list_objects 
		If a.hp &gt; 0 And a.cat &gt;= 100 Then 
			count = 0
			For pc:creature = EachIn list_objects 
				If pc.cat &lt; 100 And pc.hp &gt; 0 Then count = count + 1
			Next
			If count &gt; 0 Then 
				count = Rand(1,count)
				For pc:creature = EachIn list_objects 
					If pc.cat &lt; 100 And pc.hp &gt; 0 Then count = count - 1
					If count = 0 Then 
						dieroll = Rand(1,1000)
						If a.cat = 103 Then 'goblin shaman
							If dieroll &lt; a.skill Then 
								pc.hp = pc.hp - a.damage
								pc.strucktime = 10
								a.attacktime = 30
								pc.lightningtime = 30
							EndIf
						ElseIf a.cat = 106 Then 'spider wizard
							If dieroll &lt; a.skill Then 
								pc.stunned = Rand(1,2)
								dieroll2 = Rand(1,1000)
								If dieroll2 &gt; pc.defenseskill Then 
									pc.hp = pc.hp - a.damage
									pc.strucktime = 10
									a.attacktime = 30
								EndIf
								Exit
							EndIf 
						ElseIf a.cat = 107 Then 'spider queen
							If dieroll &lt; a.skill Then 
								For c:creature = EachIn list_objects 
									If c.cat &gt;= 100 And c.hp &gt; 0 And c.hp &lt; c.fullhp
										c.healingtime = 60
										c.hp = c.hp + a.damage
										Exit 
									EndIf 
								Next
								dieroll2 = Rand(1,1000)
								If dieroll2 &gt; pc.defenseskill Then 
									pc.hp = pc.hp - a.damage
									pc.strucktime = 10
									a.attacktime = 30
								EndIf
								If pc.cat = CAT_WIZARD Or pc.cat = CAT_CLERIC
									pc.waitcount = 0
									Exit 
								EndIf
							EndIf 
							If dieroll &gt; pc.defenseskill Then 
								pc.hp = pc.hp - a.damage
								pc.strucktime = 10
								a.attacktime = 30
							EndIf
							Exit
						Else
							If dieroll &gt; pc.defenseskill Then 
								pc.hp = pc.hp - a.damage
								pc.strucktime = 10
								a.attacktime = 30
							EndIf
							Exit
						EndIf  
					EndIf 
				Next
				
			EndIf 
		EndIf 
	Next
EndIf
End Function

Function updategame()
'move all creatures
'move all bullets
'handle all collisions
'handle all pick ups
'handle all combat
'handle all spell casting (magic missiles And healing)

found = False

For pc:creature = EachIn list_objects 
	If pc.strucktime &gt; 0 Then 
		pc.strucktime = pc.strucktime - 1
		createbloodparticle(pc.x,pc.y)
		If pc.hp &lt;= 0 Then 
			createbloodparticle(pc.x,pc.y)
			createbloodparticle(pc.x,pc.y)
			createbloodparticle(pc.x,pc.y)
		EndIf 
	EndIf 
	If pc.hp&gt;0 Then 
		If pc.cat &gt;= 100 Then 
			found = True
		EndIf
	Else
		ListRemove( list_objects, pc)
	EndIf 
Next
If found = False Then 
	levelfinishtime = levelfinishtime + 1
EndIf 
foundp = False
For pc:creature = EachIn list_objects
	If pc.hp &gt; 0 And pc.cat &lt; 100 Then
	  foundp = True
	  Exit 
	EndIf
Next
If foundp = False Then 
	levelfinishtime = levelfinishtime + 1
EndIf 
If levelfinishtime &gt; 250 Then 
	gamemode = MODE_MENU 'eventually change To mode_upgrade
	If foundp Then gamemode = MODE_UPGRADE
	gamelevel = gamelevel + 1
	ftrpicked = False
	clrpicked = False
	rngpicked = False
	wizpicked = False 
EndIf 

For pc:creature = EachIn list_objects
	If pc.hp &gt; 0 Then 
		If pc.healingtime &gt; 0 Then pc.healingtime = pc.healingtime - 1
	EndIf 
Next
updateparticle()
End Function

Function drawgame()
'draw background (fixed static 1280x720 image background)
'draw all creatures - don't worry about zordering them - it will be too fast to notice 
'draw all bullets
For img:images = EachIn list_objects 
	If img.cat = 2001 'change this later
		DrawImage img.img,0,0
	EndIf
Next
For pc:creature = EachIn list_objects 
	If pc.hp &gt; 0 Then
		aa# = 0
		bb# = 0
		If pc.attacktime &gt; 0 Then 
			pc.attacktime = pc.attacktime - 1
			aa# = -25.0 * Sin(pc.attacktime * 6)
			If pc.cat&gt;=100 Then aa = aa * -1.0
		EndIf 
		If pc.strucktime &gt; 0 Then 
			bb = Rand(-pc.strucktime/2,pc.strucktime/2)
		EndIf 
		DrawImage pc.img,bb + pc.x - ImageWidth(pc.img)/2,pc.y - 40 + aa
		dhp = 10 * pc.hp / pc.fullhp
		If dhp &lt; 4 Then SetColor 255,32,32
		If dhp &gt;=4 And dhp&lt;8 Then SetColor 255,255,32
		If dhp &gt;=8 Then SetColor 32,255,32
		If dhp = 0 Then dhp = 1
		For hp = 1 To dhp
			DrawRect hp*4 + pc.x - ImageWidth(pc.img)/3,pc.y - 50,3,3',1
		Next
		SetColor 255,255,255'reseting the draw color for BMax -Rooster
		If pc.healingtime &gt; 0 Then 
			createhealparticle(pc.x,pc.y)
		EndIf 
		SetColor 255,255,255'reseting the draw color for BMax -Rooster
		If pc.lightningtime &gt; 0 Then 
			pc.lightningtime = pc.lightningtime - 1
			drawlightning(pc.x,pc.y)
		EndIf 
		SetColor 255,255,255'reseting the draw color for BMax -Rooster
		If pc.waitcount &gt; 0 Then 
			SetColor 255,32,255
			For i = 1 To pc.waitcount
				DrawRect i * 4 + pc.x - ImageWidth(pc.img)/3,pc.y - 55,3,3',1
			Next
		EndIf 
		SetColor 255,255,255'reseting the draw color for BMax -Rooster
		If pc.stunned &gt; 0 Then 
			SetColor 255,255,32
			drawOvate (pc.x - ImageWidth(pc.img)/2,pc.y-40,ImageWidth(pc.img),80)',0
		EndIf 
		SetColor 255,255,255'reseting the draw color for BMax -Rooster
	EndIf
Next

drawparticle()
SetColor 255,255,255
For img:images = EachIn list_objects 
	If img.cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img.img,mx,my
	EndIf
Next
	SetColor 255,255,255'reseting the draw color for BMax -Rooster

End Function 

Function drawlightning(x,y)

iy = 0
ix = x + Rand(-20,20)
While iy &lt; y
oy = iy
ox = ix
ix = x + Rand(-20,20)
iy = iy + Rand(10,25)
SetColor 200,200,255
DrawLine ox,oy,ix,iy
SetColor 150,150,200
DrawLine ox+1,oy+1,ix+1,iy+1
DrawLine ox-1,oy-1,ix-1,iy-1
SetColor 100,100,150
DrawLine ox+2,oy+2,ix+2,iy+2
DrawLine ox-2,oy-2,ix-2,iy-2
SetColor 32,32,90
DrawLine ox+3,oy+3,ix+3,iy+3
DrawLine ox-3,oy-3,ix-3,iy-3

Wend 

End Function 

Function handlecutscene()
'handle transitions,  handle skip button' 
'handle fading in And out text (bitmap fonts?)

If lmb&lt;&gt;0 Then 
	If mx&gt;1000 And mx&lt;1200 And my&gt;600 And my&lt;650 Then 
		initlevel()
		gamemode = MODE_COMBAT
	EndIf 
EndIf 

End Function 

Function drawcutscene()
'draw cut scene background, draw transition, draw skip button
For img:images = EachIn list_objects 
	If img.cat = 2000 Then 
		DrawImage img.img,0,0
	EndIf 
Next

For img:images = EachIn list_objects
	If img.cat = CAT_MENU_SKIP_CUTSCENE
		DrawImage img.img,1000,600
	EndIf
Next

For img:images = EachIn list_objects 
	If img.cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img.img,mx,my
	EndIf
Next

End Function 

Function handleupgrade()
'handle button press 'add stuff' to characters
'
'
'
If lmb&lt;&gt;0 Then 
	If mx &gt; 1000 And mx&lt;1200 And my&gt;600 And my &lt;650
		gamemode = MODE_CUTSCENE
	EndIf
	i = -1
	For pc:creature = EachIn list_objects 
	If pc.cat &lt; 100 And pc.hp &gt; 0 Then 
		i = i + 1
		y = 100 * i + 200
		DrawImage pc.img,100,y
		If pc.cat = CAT_FIGHTER And (Not ftrpicked)
			If mx&gt;200 And mx &lt; 400 And my &gt; y And my &lt; y + 50 Then 
				'health picked
				ftrpicked = True
				pc.fullhp = pc.fullhp + 10
			EndIf 
			If mx&gt;450 And mx &lt; 650 And my &gt; y And my &lt; y + 50 Then 
				'damage picked
				ftrpicked = True
				pc.damage = pc.damage + 4
			EndIf 
			
			If mx&gt;700 And mx &lt; 900 And my &gt; y And my &lt; y + 50 Then 
				'skill picked
				ftrpicked = True
				ds# = (1000 - pc.skill) * 0.95
				pc.skill = 1000 - ds
			EndIf 
			
			If mx&gt;950 And mx &lt; 1150 And my &gt; y And my &lt; y + 50 Then 
				'def picked
				ftrpicked = True
				ds# = (1000 - pc.defenseskill) * 0.95
				pc.defenseskill = 1000 - ds
			EndIf 
		EndIf
		If pc.cat = CAT_RANGER And (Not rngpicked)
			If mx&gt;200 And mx &lt; 400 And my &gt; y And my &lt; y + 50 Then 
				'health picked
				rngpicked = True
				pc.fullhp = pc.fullhp + 10
			EndIf 
			If mx&gt;450 And mx &lt; 650 And my &gt; y And my &lt; y + 50 Then 
				'damage picked
				rngpicked = True
				pc.damage = pc.damage + 4
			EndIf 
			
			If mx&gt;700 And mx &lt; 900 And my &gt; y And my &lt; y + 50 Then 
				'skill picked
				rngpicked = True
				ds# = (1000 - pc.skill) * 0.95
				pc.skill = 1000 - ds
			EndIf 
			
			If mx&gt;950 And mx &lt; 1150 And my &gt; y And my &lt; y + 50 Then 
				'def picked
				rngpicked = True
				ds# = (1000 - pc.defenseskill) * 0.95
				pc.defenseskill = 1000 - ds
			EndIf 
		
		EndIf
		If pc.cat = CAT_WIZARD And (Not wizpicked)
			If mx&gt;200 And mx &lt; 400 And my &gt; y And my &lt; y + 50 Then 
				'health picked
				wizpicked = True
				pc.fullhp = pc.fullhp + 10
			EndIf 
			If mx&gt;450 And mx &lt; 650 And my &gt; y And my &lt; y + 50 Then 
				'damage picked
				wizpicked = True
				pc.damage = pc.damage + 4
			EndIf 
			
			If mx&gt;700 And mx &lt; 900 And my &gt; y And my &lt; y + 50 Then 
				'skill picked
				wizpicked = True
				ds# = (1000 - pc.skill) * 0.95
				pc.skill = 1000 - ds
			EndIf 
			
			If mx&gt;950 And mx &lt; 1150 And my &gt; y And my &lt; y + 50 Then 
				'def picked
				wizpicked = True
				ds# = (1000 - pc.defenseskill) * 0.95
				pc.defenseskill = 1000 - ds
			EndIf 

		EndIf
		If pc.cat = CAT_CLERIC And (Not clrpicked)
			If mx&gt;200 And mx &lt; 400 And my &gt; y And my &lt; y + 50 Then 
				'health picked
				clrpicked = True
				pc.fullhp = pc.fullhp + 10
			EndIf 
			If mx&gt;450 And mx &lt; 650 And my &gt; y And my &lt; y + 50 Then 
				'damage picked
				clrpicked = True
				pc.damage = pc.damage + 4
			EndIf 
			If mx&gt;700 And mx &lt; 900 And my &gt; y And my &lt; y + 50 Then 
				'skill picked
				clrpicked = True
				ds# = (1000 - pc.skill) * 0.95
				pc.skill = 1000 - ds
			EndIf 
			If mx&gt;950 And mx &lt; 1150 And my &gt; y And my &lt; y + 50 Then 
				'def picked
				clrpicked = True
				ds# = (1000 - pc.defenseskill) * 0.95
				pc.defenseskill = 1000 - ds
			EndIf 
		EndIf 
	EndIf 
Next


	
EndIf


End Function

Function drawupgrade()
'draw background
'draw buttons
'draw characters
'draw stats
'draw Continue button
For img:images = EachIn list_objects 
	If img.cat = 2000 Then 
	'	Drawimage img.img,0,0
	EndIf 
Next

i=-1
For pc:creature = EachIn list_objects
	If pc.cat &lt; 100 And pc.hp &gt; 0 Then 
		pc.hp = pc.fullhp
		i = i + 1
		y = 100 * i + 200
		DrawImage pc.img,100,y
	'	Text 150,i*100+200,"Skill:"+pc.skill+" Defense:"+pc.defenseskill + " Health:"+pc.fullhp + " Power:"+pc.damage
		If pc.cat = CAT_FIGHTER And (Not ftrpicked)
			For img:images = EachIn list_objects 
				If img.cat = CAT_MENU_ADD_HEALTH Then
					DrawImage img.img,200,y
				EndIf
				If img.cat = CAT_MENU_ADD_DAMAGE Then
					DrawImage img.img,450,y
				EndIf
				If img.cat = CAT_MENU_ADD_SKILL Then
					DrawImage img.img,700,y
				EndIf
				If img.cat = CAT_MENU_ADD_DEF Then 
					DrawImage img.img,950,y
				EndIf 
			Next
		EndIf
		If pc.cat = CAT_RANGER And (Not rngpicked)
			For img:images = EachIn list_objects 
				If img.cat = CAT_MENU_ADD_HEALTH Then
					DrawImage img.img,200,y
				EndIf
				If img.cat = CAT_MENU_ADD_DAMAGE Then
					DrawImage img.img,450,y
				EndIf
				If img.cat = CAT_MENU_ADD_SKILL Then
					DrawImage img.img,700,y
				EndIf
				If img.cat = CAT_MENU_ADD_DEF Then 
					DrawImage img.img,950,y
				EndIf 
			Next
		
		EndIf
		If pc.cat = CAT_WIZARD And (Not wizpicked)
			For img:images = EachIn list_objects 
				If img.cat = CAT_MENU_ADD_HEALTH Then
					DrawImage img.img,200,y
				EndIf
				If img.cat = CAT_MENU_ADD_DAMAGE Then
					DrawImage img.img,450,y
				EndIf
				If img.cat = CAT_MENU_ADD_SKILL Then
					DrawImage img.img,700,y
				EndIf
				If img.cat = CAT_MENU_ADD_DEF Then 
					DrawImage img.img,950,y
				EndIf 
			Next
		
		EndIf
		If pc.cat = CAT_CLERIC And (Not clrpicked)
			For img:images = EachIn list_objects 
				If img.cat = CAT_MENU_ADD_HEALTH Then
					DrawImage img.img,200,y
				EndIf
				If img.cat = CAT_MENU_ADD_DAMAGE Then
					DrawImage img.img,450,y
				EndIf
				If img.cat = CAT_MENU_ADD_SKILL Then
					DrawImage img.img,700,y
				EndIf
				If img.cat = CAT_MENU_ADD_DEF Then 
					DrawImage img.img,950,y
				EndIf 
			Next
		
		EndIf 
	EndIf 
Next


For img:images = EachIn list_objects 
	If img.cat = CAT_MENU_SKIP_CUTSCENE
		DrawImage img.img,1000,600
	EndIf
Next

DrawText "On this screen you would upgrade some of your characters",0,0

For img:images = EachIn list_objects 
	If img.cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img.img,mx,my
	EndIf
Next




End Function 

Function initstartgame()
gamelevel = 1
For pc:creature = EachIn list_objects 
  ListRemove( list_objects,pc)
Next

pc:creature = New creature
pc.fullhp = 90
pc.hp = 90
pc.cat = CAT_FIGHTER
pc.x = 600
pc.y = 300
pc.tx = pc.x
pc.ty = pc.y
pc.skill = 100
pc.defenseskill = 850
pc.damage = 10
pc.speed = 4.0
For img:images = EachIn list_objects 
	If img.cat = CAT_FIGHTER Then 
		pc.img = img.img
		If pc.img = 0
		  Print "trap 1"
		  End
		EndIf
		Exit 
	EndIf 
Next
list_objects.AddLast pc

pc:creature = New creature
pc.fullhp = 75
pc.hp = 75
pc.cat = CAT_RANGER
pc.x = 640
pc.y = 300
pc.tx = pc.x
pc.ty = pc.y
pc.skill = 800
pc.defenseskill = 850
pc.damage = 50
pc.speed = 5.0
For img:images = EachIn list_objects 
	If img.cat = CAT_RANGER Then 
		pc.img = img.img
		 If pc.img = 0
		  Print "trap 2"
		  End
		EndIf
		Exit 
	EndIf 
Next
list_objects.AddLast pc

pc:creature = New creature
pc.fullhp = 45
pc.hp = 45
pc.cat = CAT_WIZARD
pc.x = 750
pc.y = 360
pc.tx = pc.x
pc.ty = pc.y
pc.skill = 650
pc.damage = 18
pc.speed = 5.0
pc.defenseskill = 500
For img:images = EachIn list_objects 
	If img.cat = CAT_WIZARD Then 
		pc.img = img.img
		If pc.img = 0
		  Print "trap 3"
		  End
		EndIf
		Exit 
	EndIf 
Next
list_objects.AddLast pc

pc:creature = New creature
pc.fullhp = 60
pc.hp = 60
pc.cat = CAT_CLERIC
pc.x = 640
pc.defenseskill = 800
pc.y = 350
pc.tx = pc.x
pc.ty = pc.y
pc.skill = 100
pc.damage = 5
pc.speed = 4.0
For img:images = EachIn list_objects 
	If img.cat = CAT_CLERIC Then 
		pc.img = img.img
		If pc.img = 0
		  Print "trap 4"
		  End
		EndIf
		Exit 
	EndIf 
Next
list_objects.AddLast pc

End Function 

Function initlevel()
Local wallmap[SW,SH]
Local blockmap[SW/20,SH/12]
For pc:creature = EachIn list_objects 
	If pc.hp &gt; 0 And pc.hp &lt; pc.fullhp Then pc.hp = pc.fullhp
	If pc.cat = CAT_FIGHTER
		pc.x = 300
		pc.y = 400
	EndIf
	If pc.cat = CAT_RANGER
		pc.x = 375
		pc.y = 400
	EndIf
	If pc.cat = CAT_WIZARD
		pc.x = 450
		pc.y = 400
	EndIf
	If pc.cat = CAT_CLERIC
		pc.x = 500
		pc.y = 400
	EndIf
	pc.x = pc.x + 200
	pc.tx = pc.x
	pc.ty = pc.y
	If pc.cat &gt;=100 Then ListRemove( list_objects, pc)
Next

For i = 1 To 8
	pc:creature = New creature
	pc.x = 300 + i * 80'Rand(0,SW)
	pc.y = 200 'Rand(0,SH)
	pc.tx = pc.x
	pc.ty = pc.y
	
	If gamelevel = 1 Then 
	pc.cat = 100+Rand(0,1)
	pc.hp = 70
	pc.fullhp = 50
	pc.speed = 3
	pc.damage = 5
	pc.skill = 80
	EndIf
	If gamelevel = 2 Then 
		'trolls2
		If i = 1 Or i = 8 Then 
			pc.cat = 102
			pc.hp = 200
			pc.fullhp = 200
			pc.speed = 3
			pc.damage = 10
			pc.skill = 150
		Else
			pc.cat = 100+Rand(0,1)
			pc.hp = 70
			pc.fullhp = 50
			pc.speed = 3
			pc.damage = 5
			pc.skill = 80
		EndIf 
	EndIf 
	If gamelevel = 3 Then 
		'wizard And troll
		If i = 1 Or i = 8 Then
			pc.cat = 102
			pc.hp = 200
			pc.fullhp = 200
			pc.speed = 3
			pc.damage = 10
			pc.skill = 150
		ElseIf i = 4 Then
			pc.cat = 103
			pc.hp = 100
			pc.fullhp = 100
			pc.speed = 3
			pc.damage = 5
			pc.skill = 350
		Else
			pc.cat = 100+Rand(0,1)
			pc.hp = 70
			pc.fullhp = 50
			pc.speed = 3
			pc.damage = 5
			pc.skill = 80
		EndIf 
	EndIf
	If gamelevel = 4 Then
		'spiderbeasts And giant spiders
		If i = 1 Or i = 8 Then 
			pc.cat = 104
			pc.hp = 150
			pc.fullhp = 150
			pc.speed = 3
			pc.damage = 15
			pc.skill = 100
		Else
			pc.cat = 105
			pc.hp = 100
			pc.fullhp = 100
			pc.speed = 3
			pc.damage = 8
			pc.skill = 150
		EndIf 

	EndIf
	If gamelevel = 5 Then 
		'spiderbeasts, giant spiders And spider wizards
		If i = 1 Or i = 8 Then 
			pc.cat = 104
			pc.hp = 150
			pc.fullhp = 150
			pc.speed = 3
			pc.damage = 15
			pc.skill = 100
		ElseIf i = 2 Or i = 7
			pc.cat = 106
			pc.hp = 100
			pc.fullhp = 100
			pc.speed = 3
			pc.damage = 8
			pc.skill = 300
		Else
			pc.cat = 105
			pc.hp = 100
			pc.fullhp = 100
			pc.speed = 3
			pc.damage = 8
			pc.skill = 150
		EndIf 


	EndIf 
	If gamelevel = 6 Then 
		'spider queens And spiderbeasts
		If i = 1 Or i = 8 Then 
			pc.cat = 107
			pc.hp = 100
			pc.fullhp = 100
			pc.speed = 3
			pc.damage = 5
			pc.skill = 450
		Else
			pc.cat = 105
			pc.hp = 100
			pc.fullhp = 100
			pc.speed = 3
			pc.damage = 8
			pc.skill = 150
		EndIf 
	EndIf 
	If gamelevel = 7 Then 
		'spider queens And giant spiders And spider wizards
		If i = 4 Or i = 5 Then 
			pc.cat = 107
			pc.hp = 100
			pc.fullhp = 100
			pc.speed = 3
			pc.damage = 5
			pc.skill = 450
		ElseIf i = 2 Or i = 7
			pc.cat = 106
			pc.hp = 100
			pc.fullhp = 100
			pc.speed = 3
			pc.damage = 8
			pc.skill = 300
		Else
			pc.cat = 104
			pc.hp = 150
			pc.fullhp = 150
			pc.speed = 3
			pc.damage = 15
			pc.skill = 100
		EndIf 
	EndIf 
	For img:images = EachIn list_objects 
		If img.cat = pc.cat Then 
			pc.img = img.img
			If pc.img = 0
		      Print "trap 5"
		      End
		    EndIf
			Exit 
		EndIf 
	Next
	list_objects.AddLast pc
Next

lmb = 0
olmb = 0
FlushMouse()
levelfinishtime = 0
End Function 

Function createhealparticle(x,y)

For i = 1 To 36
	p:particle = New particle
	p.life = 20
	p.x = x + 25.0 * Cos(i*10)
	p.y = y + 20 + 25.0 * (Sin(i*5))
	p.vx = 0
	p.vy = Rand(-4,-2)
	p.ay = 0.1
	p.gy = p.y + 100
	p.r = 32
	p.g = 200
	p.b = 255
	p.sz = 4
	p.dsz = -0.1
	p.dr = 10
	p.dg = 2
	p.db = 0
	list_objects.AddLast p
Next

End Function 

Function createbloodparticle(x,y)

For i = 1 To 10
	p:particle = New particle
	p.life = 20
	p.x = x + Rand(-10,10)
	p.y = y + Rand(-10,10)
	p.vx = Rnd(-3,3)
	p.vy = Rnd(-3,3)
	p.ay = 0.05
	p.gy = y + 42
	p.r = 255
	p.g = 100
	p.b = 100
	p.dr = -2
	p.dg = -3
	p.db = -3
	p.sz = 4
	p.dsz = 0
	list_objects.AddLast p
Next

End Function 

Function updateparticle()
For p:particle = EachIn list_objects 
	p.life = p.life - 1
	p.x = p.x + p.vx
	p.y = p.y + p.vy
	p.vy = p.vy + p.ay
	If p.y &gt; p.gy Then 
		p.vy = p.vy * -0.7
		If Abs(p.vy)&lt;0.01 Then p.life = 0
	EndIf 
	p.sz = p.sz + p.dsz
	p.r = p.r + p.dr
	p.g = p.g + p.dg
	p.b = p.b + p.db
	If p.sz &lt; 0 Then p.sz = 0
	If p.r &gt; 255 Then p.r = 255
	If p.g &gt; 255 Then p.g = 255
	If p.b &gt; 255 Then p.b = 255
	If p.r &lt; 0 Then p.r = 0
	If p.g &lt; 0 Then p.g = 0
	If p.b &lt; 0 Then p.b = 0
	If p.life &lt; 0 Then ListRemove( list_objects, p)
Next
End Function 

Function drawparticle()
For p:particle = EachIn list_objects 
	SetColor p.r,p.g,p.b
	DrawRect p.x,p.y,p.sz,p.sz',1
Next
SetColor 255,255,255
End Function 


Function drawOvate( x# , y# , w# , h#) 'found on blitzbasic.com -Rooster
For Local n% = 1 To 360
	Plot( x + w * Cos(n) , y + h * Sin(n) )
Next
End Function
</textarea> <br><br></td></tr></table><br>
<a name="1341205"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#66">[#66]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Rooster...<br><br>I think one of my other tasks will be to tidy up the code - revisit the comments, remove the extraneous data types and so on.<br><br>I'm not going to get a chance to do any work on this tonight after work I believe but should be back at it tomorrow evening.<br><br>I'm enjoying this.<br><br>I'm toying with the idea of the cinematics being coloured sketches - hand drawn mainly because I'm not going to spend the money on paying an artist to put together highly detailed full screen images - too expensive - I know the quality will possibly suffer a bit but it's all I can actually do myself....I've learned my lesson when it comes to spending 1000s on artwork for game development...it will never be recouped....but it should still be fun...<br><br><br>Level progression as I see it (game level):<br><br>Goblins<br>Spiders<br>Beastmen/Barbaric Monsters<br>Undead<br>Aberrations/Eye Monsters etc <br><br>Each themed area will have 3-4 levels within it that showcases the different monster types and combat feel....<br><br>Total is therefore about 15-20 levels....<br><br>That means 15-20 cinematics...so to keep the content requirements low there will be significant re-use of assets  / art work...I don't want to draw 20 different images unless they're small and upscaled....but maybe. <br><br></td></tr></table><br>
<a name="1341206"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rooster</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#67">[#67]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay, I've finished the image loading function.<br>For it to load files with the proper category, the images need a name formated like this...<br><pre class=code>
00010knight1.png
00012wizard1.png
</pre><br>Hope this helps.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Function Load_All_Images ()
Local in
Local imgin.loadimagesT
Local b

;opens the image folder
in = ReadDir ("images")
Repeat

  imgin.loadimagesT = New loadimagesT
  ;gets the name of the Next file
  imgin\img = NextFile$ (in)
  ;checks To see If "a" has a file name,
  ;If "a" is blank the loop is exited
  If imgin\img =""
    b =1
  EndIf

Until b =1
CloseDir (in)

;loads the all the images

For imgin.loadimagesT= Each loadimagesT

  If imgin\img =""
    Delete imgin
  ElseIf imgin\img =".." Or imgin\img ="."
    Delete imgin
  ElseIf imgin\img ="Thumbs.db"
    Delete imgin
  Else
    img.images = New images
    img\img = LoadImage ("images\"+imgin\img)
    img\cat = Int(Left(imgin\img,5))
  EndIf
Next

End Function

Type loadimagesT

Field img$

End Type
</textarea><br><br>Glad to see you are enjoying yourself.<br><br>I keep seeing 20 levels, and thinking it isn't that much;<br>but I <b>know</b> how little things turn it to bigger ones. XD <br><br></td></tr></table><br>
<a name="1341207"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#68">[#68]</a></td></tr></table></td></tr><tr ><td class="posttext"> The other thing to remember - especially if this goes to mobile is that I know for myself I don't play mobile games all that long, one or two short sessions and then uninstalled if it's no good and maybe kept for a few days if it is - so having lots of levels is potentially wasted if no one ever gets to the higher levels. (My metrics in most of my other games show most players, the vast majority, play for a few minutes of any game at most) <br><br></td></tr></table><br>
<a name="1341208"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rooster</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#69">[#69]</a></td></tr></table></td></tr><tr ><td class="posttext"> Huh, I never though about it that way. <br><br></td></tr></table><br>
<a name="1341209"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#70">[#70]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's also good in my opinion to have a few well designed quality levels than oodles of filler. <br><br></td></tr></table><br>
<a name="1341211"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rooster</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#71">[#71]</a></td></tr></table></td></tr><tr ><td class="posttext"> Me too.<br>I just have a habit of biting off more than I can chew. lol <br><br></td></tr></table><br>
<a name="1341214"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rooster</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#72">[#72]</a></td></tr></table></td></tr><tr ><td class="posttext"> I messed around with particle effect system like you suggested, and I got a few that looked ok.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Function createsplashparticle(x,y,r,g,b)

For i = 1 To 10
	p:particle = New particle
	p.life = 30
	p.x = x + Rand(-3,3)
	p.y = y + Rand(-3,3)
	p.vx = Rnd(-3,3)
	p.vy = 5
	p.ay = Rnd(-3,3)
	p.gy = y + Rnd(-3,3)
	p.r =r
	p.g =g
	p.b =b
	p.dr = -2
	p.dg = -3
	p.db = -3
	p.sz = 4
	p.dsz = 0
	list_objects.AddLast p
Next

End Function

Function createspoutparticle(x,y,d)'d needs to be a one or negative one

For i = 1 To 10
	p:particle = New particle
	p.life = 30
	p.x = x + Rand(-3,3)
	p.y = y + Rand(-3,3)
	p.vx = 0
	p.vy = 10*d
	p.ay = 15*d
	p.gy = -1
	p.r =100
	p.g =200
	p.b =255
	p.dr = -2
	p.dg = -3
	p.db = -3
	p.sz = 4
	p.dsz = 0
	list_objects.AddLast p
Next

End Function 
</textarea> <br><br></td></tr></table><br>
<a name="1341215"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#73">[#73]</a></td></tr></table></td></tr><tr ><td class="posttext"> For testing the particles..<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Graphics 512,512,0,2
Type particle
Field x#,y#,vx#,vy#,life,ay#,gy#,r,g,b,dr,dg,db,sz#,dsz#
End Type 

Repeat
time = MilliSecs()
Cls
If KeyHit(57) Then 
;test particle with space bar

EndIf 
updateparticle()
drawparticle()
Flip
time = MilliSecs() - time
If time &lt; 15 Then Delay 15 - time
Until KeyDown(1)
End


Function createsplashparticle(x,y,r,g,b)

For i = 1 To 10
	p.particle = New particle
	p\life = 30
	p\x = x + Rand(-3,3)
	p\y = y + Rand(-3,3)
	p\vx = Rnd(-3,3)
	p\vy = 5
	p\ay = Rnd(-3,3)
	p\gy = y + Rnd(-3,3)
	p\r =r
	p\g =g
	p\b =b
	p\dr = -2
	p\dg = -3
	p\db = -3
	p\sz = 4
	p\dsz = 0
Next

End Function

Function createspoutparticle(x,y,d);d needs To be a one Or negative one

For i = 1 To 10
	p.particle = New particle
	p\life = 30
	p\x = x + Rand(-3,3)
	p\y = y + Rand(-3,3)
	p\vx = 0
	p\vy = 10*d
	p\ay = 15*d
	p\gy = -1
	p\r =100
	p\g =200
	p\b =255
	p\dr = -2
	p\dg = -3
	p\db = -3
	p\sz = 4
	p\dsz = 0
Next

End Function 

Function updateparticle()
For p.particle = Each particle
	p\life = p\life - 1
	p\x = p\x + p\vx
	p\y = p\y + p\vy
	p\vy = p\vy + p\ay
	If p\y &gt; p\gy Then 
		p\vy = p\vy * -0.7
		If Abs(p\vy)&lt;0.01 Then p\life = 0
	EndIf 
	p\sz = p\sz + p\dsz
	p\r = p\r + p\dr
	p\g = p\g + p\dg
	p\b = p\b + p\db
	If p\sz &lt; 0 Then p\sz = 0
	If p\r &gt; 255 Then p\r = 255
	If p\g &gt; 255 Then p\g = 255
	If p\b &gt; 255 Then p\b = 255
	If p\r &lt; 0 Then p\r = 0
	If p\g &lt; 0 Then p\g = 0
	If p\b &lt; 0 Then p\b = 0
	If p\life &lt; 0 Then Delete p
Next
End Function 

Function drawparticle()
For p.particle = Each particle
	Color p\r,p\g,p\b
	Rect p\x,p\y,p\sz,p\sz,1
Next
Color 255,255,255
End Function 
</textarea> <br><br></td></tr></table><br>
<a name="1341222"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#74">[#74]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm still thinking of the cut-scene / story telling side of the game and wondering whether I'll do it with some kind of in game sprites or whether it will be a static backdrop or what....I'm leaning towards a set of character sprites - talking heads type of things...perhaps...not sure...still just an idea in my head. <br><br></td></tr></table><br>
<a name="1341235"></a>

<a name="1341236"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#75">[#75]</a></td></tr></table></td></tr><tr ><td class="posttext"> More sprites:<br><br>00108beastcentaur.png<br><img src="http://www.mattiesgames.com/art/00108beastcentaur.png"><br><br>00109beastwarrior.png<br><img src="http://www.mattiesgames.com/art/00109beastwarrior.png"><br><br>00110minotaurshaman.png<br><img src="http://www.mattiesgames.com/art/00110minotaurshaman.png"> <br><br></td></tr></table><br>
<a name="1341252"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rooster</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#76">[#76]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ahh, thanks for the testbed.<br><br>I'm not sure what you're envisioning with using sprites, but that could really lend itself to being flexible.<br>Also on the topic of story, what are doing for that?<br>Are we going to do a linear quest type of story. Or maybe use random generator to "write" a new story for each play through?<br><br>The beast men are looking good. I'm guessing that undead are next?<br>I'm curious, what is your process for creating these sprites? <br><br></td></tr></table><br>
<a name="1341260"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#77">[#77]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks.  I just had a realisation idea at 4am about the story.  Rather than cinematics I can have a world map with 15 to 20 dungeons scattered across it and the player can simply pick the order to play them in.  Defeating 15 of them unlocks the final boss dungeon which must be defeated to win.<br><br>Re sprite creation:i do a google search of imagesfor inspiration then draw with wacom tablet on paint.net, scale down and alter colors. <br><br></td></tr></table><br>
<a name="1341263"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#78">[#78]</a></td></tr></table></td></tr><tr ><td class="posttext"> The characters postures looks quite convincing, well done. <br><br></td></tr></table><br>
<a name="1341264"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rooster</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#79">[#79]</a></td></tr></table></td></tr><tr ><td class="posttext"> I got a load stats function running, the only other thing you would need to add to the code is making pc:creature a global.<br>It shouldn't need to have the group of stats any order.<br><br>Info<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
The pl variable is ether true or false, and tells whether or not to load the defenseskill.
load_stats (600,300,CAT_FIGHTER,True)

The text file would be formated like this

name &lt;--for readability
cat
fullhp
hp
skill
damage
speed
defenseskill


And would look like something like this

knight
10
90
90
100
10
4.0
850
goblin 1
100
50
70
150
5
3
spacing
</textarea><br>Code<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Function load_stats (x,y,cat,pl)

Local in
Local b=0
Local t

 pc\x = x
 pc\y = y
 pc\cat = cat

 pc\tx = pc\x
 pc\ty = pc\y

 in =ReadFile ("data\creature-stats.txt")

   ReadLine(in);I using this To move the read position one String forward
   Repeat 

     If Int(ReadLine(in)) =cat
       b=1
     Else
       For t=1 To 7
         ReadLine(in);I using this To move the read position one String forward
       Next
     EndIf
     
   Until b=1   

   pc\fullhp = Int(ReadLine(in))
   pc\hp = Int(ReadLine(in))
   pc\skill = Int(ReadLine(in))
   pc\damage = Int(ReadLine(in))
   pc\speed = Float(ReadLine(in))

   If pl = True
     pc\defenseskill = Int(ReadLine(in))
   EndIf

 CloseFile (in)

End Function
</textarea><br><br>Re:story<br>Sounds good, I think that would be a more flexible solution to story telling. <br><br></td></tr></table><br>
<a name="1341279"></a>

<a name="1341284"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#80">[#80]</a></td></tr></table></td></tr><tr ><td class="posttext"> Update:<br><br>02003map.jpg (this will change - just for demo purposes right now)<br><img src="http://www.mattiesgames.com/art/02003map.jpg"><br><br>data file<br>data/map.dat<br><a href="http://www.mattiesgames.com/art/map.dat" target="_blank">Link</a><br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
;This is both a learning exercise and hopefully a collaborative project of sorts
;or at least a project I can share with others on the blitz forum.
;It will be written initially in blitzplus/blitz3d and maybe someone will be keen on
;porting it to blitzmax...even blitzmax-ng to release on mobile perhaps?
;
;Interface:
;Left mouse button clicking only to make porting to 
;mobile interface much, much easier.
;Gameplay mechanic so far (15-May-2017)
;
;1. Arcade Action RPG Combat
;	Player controls 4 characters in a single screen dungeon.
;	Dungeon has a few walls and so on that prevent movement.
;	Monsters spawn from spawners and make their way around the map
;	Player taps the screen to move to location and characters fight things
;	in their path.
;	Powerups exist in the level such as:
;	Health pickups
;	Bombs - kill all monsters that have spawned or at least damage them.
;	
;2. After the arcade sequence the player is presented with options to upgrade their
;	character's stats. Stats to upgrade include:
;	Combat skill ('to hit roll')
;	Damage output ('damage points')
;	Health points ('hp')
;	Movement speed ('move')
;3.	After this a short cut scene is presented which may simply be a scrolling static
;	image with some fading in/fading out text to advance the story line
;0. Menu - toggle audio, play, credits
;
;Character types:
;1 Fighter - high hitpoint melee combat medium damage
;2 Ranger - medium hitpoint melee combat high damage
;3 Wizard - low hitpoint, ranged combat, medium damage
;4 Cleric - medium hitpoint, no combat, healer
;


;constants
Const SW=1280,SH=720,WIN=2
Const MODE_MENU = 0
Const MODE_COMBAT = 1
Const MODE_UPGRADE = 2
Const MODE_CUTSCENE = 3
Const PURE_2D = True ;if go to blitzmax can use 2d-in-3d commands such as alpha otherwise have to calculate manually.Change to false for blitzmax.

;categories for image types and object types
Const CAT_MENU_PLAY = 0
Const CAT_MENU_AUDIO = 1
Const CAT_MENU_SKIP_CUTSCENE = 2 ;cut scene mode
Const CAT_MENU_ADD_SKILL = 3 ;upgrade mode
Const CAT_MENU_ADD_DAMAGE = 4;upgrade mode
Const CAT_MENU_ADD_HEALTH = 5;upgrade mode
;Const CAT_MENU_ADD_SPEED = 6;
Const CAT_MENU_ADD_DEF = 6
Const CAT_MENU_MOUSE_CURSOR = 7;
Const CAT_FIGHTER = 10
Const CAT_KNIGHT = 10 ;synonym
Const CAT_RANGER = 11
Const CAT_WIZARD = 12
Const CAT_CLERIC = 13
Const CAT_HEALER = 13 ;synonym
Const CAT_HEALTH_PICKUP = 20
Const CAT_BOMB_PICKUP = 21
;CAT_BACKGROUND = 2000-3000 ; all the different image backgrounds
;CAT_MONSTER = 100-1000 , all the different monster types

Const AI_WANDER = 0
Const AI_ATTACK = 1

Const TEAM_PLAYER = 0
Const TEAM_MONSTER = 1

;globals
Global mx,my,lmb,olmb ;mouse input
Global audiostate ;on/off
Global gamemode ;references const above
Global gamelevel ;for cutscenes
Global cutsceneframe ;for cutscenes ie trigger fades, text, motion etc on certain frames
Global levelfinishtime = 0
Global mapdelay ;timestamp
Global mapindex

Global ftrpicked,rngpicked,wizpicked,clrpicked ;boolean for upgrades

;arrays
Dim wallmap(0,0) ;0/1 value at each element indicates whether wall is there or not - redimension later
Dim blockmap(0,0) ;0/1 value - bigger version of wallmap lower resolution
;types
Type images

Field img ;handle
Field midhandled ;boolean
Field cat ;category //hooks into creature template

End Type 

Type creaturetemplate

Field img ;img handle
Field cat ;category
Field fullhp ;n (values range from about 10 to 200 for high level characters and monsters)
Field combatskill ;1-1000 (percentile out of a 1000 not 100) (roll under to hit/roll under to cast)
Field speed# ;n.m (movement speed)
Field damage ;n (damage per hit, also equal to hitpoints to heal per successful cast)

End Type 

Type bullet

Field img ;handle of image
Field team ;players or monsters - so no friendly fire
Field x#
Field y#
Field vx#
Field vy#
Field life
Field damage ;damage to inflict per hit then disappear

End Type

Type spawner

Field img
Field cat ;category to spawn
Field x
Field y
Field hp
Field timetospawn ;frames to count down from when respawning
Field spawndelay ;current frame count on spawner 0 to 'timetospawn'.

End Type 

Type mappos
Field x,y,index
End Type 

Type creature

Field img
Field cat
Field x#
Field y#
Field tx#
Field ty#
Field hp
Field fullhp
Field speed#
Field damage
Field skill

Field defenseskill ;for players

Field aimode
Field aidelay
Field aitime

Field moving ;boolean

Field healingtime ;for healing effect/buff effect
Field lightningtime ;for lightning blasts on creature effect
Field strucktime ;for blood effects
Field attacktime 

Field activated ;boolean
Field waitcount ;int

Field stunned ;int 0-n counts down each time active....
field poison ;int 0-n = damage inflicted
field regenerate ;boolean

End Type 

Type menubutton

Field cat ;for menu buttons
Field img
Field x
Field y
Field w
Field h
Field state ;pressed/not pressed

End Type 

Type cutscene

Field cat
Field img
Field x
Field y
Field levelnum ;for the specific level num
Field upperframe ;for the upper limit on the frame number to show this image for
Field transitiontype ;define later for transitioning between frames...do all this in code 

End Type 

;new emitters and particles
Type particle

Field r,g,b,a
Field x#,y#,vx#,vy#,ay#,gy#
Field life
Field dr,dg,db,da
Field sz,dsz

End Type



main()

Function main()
	quit = False
	gamemode = MODE_MENU
	init()
	Repeat
		frametime = MilliSecs()
		Cls
		;input 
		mx = MouseX()
		my = MouseY()
		olmb = lmb
		lmb = MouseDown(1)
		Select gamemode
		
		Case MODE_MENU
			handlemenu()
			drawmenu()
		
		Case MODE_COMBAT
			handleinput()
			updategame()
			drawgame()
		Case MODE_CUTSCENE
			handlecutscene()
			drawcutscene()
		Case MODE_UPGRADE
			handleupgrade()
			drawupgrade()
		End Select
		
		Flip
		;very basic frame limiting
		endframetime = MilliSecs()
		dtime = endframetime - frametime
		If dtime &lt; 15 Then 
			Delay 15 - dtime
		EndIf 
		;end of frame limiting
		If(KeyHit(1)) Then quit = True		
	Until quit
	;;;;;;
	End
End Function 

Function init()
Graphics SW,SH,0,WIN
;load data files
;load all images here
;load all sounds here
;load all music here
HidePointer 

infile = ReadFile("data\map.dat")
count = ReadShort(infile)
For i = 1 To count
m.mappos = New mappos
m\x = ReadShort(infile)
m\y = ReadShort(infile)
m\index = ReadByte(infile)
If m\index &gt; 0 Then 
index = index + 1
m\index = index
EndIf 
Next
CloseFile infile


img.images = New images
img\img = LoadImage("images\02003map.jpg")
img\cat = 2003


img.images = New images
img\img = LoadImage("images\btndef.png")
img\cat = CAT_MENU_ADD_DEF

img.images = New images
img\img = LoadImage("images\btnhp.png")
img\cat = CAT_MENU_ADD_HEALTH

img.images = New images
img\img = LoadImage("images\btnpower.png")
img\cat = CAT_MENU_ADD_DAMAGE

img.images = New images
img\img = LoadImage("images\btnskill.png")
img\cat = CAT_MENU_ADD_SKILL


img.images = New images
img\img = LoadImage("images\knight1.png")
img\cat = CAT_FIGHTER

img.images = New images
img\img = LoadImage("images\ranger1.png")
img\cat = CAT_RANGER

img.images = New images
img\img = LoadImage("images\wizard1.png")
img\cat = CAT_WIZARD

img.images = New images
img\img = LoadImage("images\cleric1.png")
img\cat = CAT_CLERIC

img.images = New images
img\img = LoadImage("images\goblin1.png")
img\cat = 100 ;goblin 1

img.images = New images
img\img = LoadImage("images\goblin2.png")
img\cat = 101 ;goblin 2

img.images = New images
img\img = LoadImage("images\troll1.png")
img\cat = 102 ;troll 1

img.images = New images
img\img = LoadImage("images\goblinshaman1.png")
img\cat = 103 ;goblin shaman

img.images = New images
img\img = LoadImage("images\giantspider1.png")
img\cat = 104 ;giant spider melee brute...

img.images = New images
img\img = LoadImage("images\spiderbeast1.png")
img\cat = 105 ;spider beast

img.images = New images
img\img = LoadImage("images\spiderwizard1.png")
img\cat = 106 ;spider wizard - stuns enemy units (reduces skill)

img.images = New images
img\img = LoadImage("images\spiderqueen1.png")
img\cat = 107 ;spider queen - stuns spell casters (reduces waitcount) and melee unit and heals friendlies


img.images = New images
img\img = LoadImage("images\btnplay.png")
img\cat = CAT_MENU_PLAY

img.images = New images
img\img = LoadImage("images\btnaudio.png")
img\cat = CAT_MENU_AUDIO

img.images = New images
img\img = LoadImage("images\cursor.png")
img\cat = CAT_MENU_MOUSE_CURSOR

img.images = New images
img\img = LoadImage("images\btnskip.png")
img\cat = CAT_MENU_SKIP_CUTSCENE

;we don't have backgrounds yet so create them on the fly for now
img.images = New images
img\img = CreateImage(SW,SH)
SetBuffer ImageBuffer(img\img)
For i = 1 To 100
	Color 100,100,100
	Oval Rand(SW),Rand(SH),100,100,1
Next
SetBuffer BackBuffer()
img\cat = 2000

;img.images = New images
;img\img = LoadImage("images\bk1.jpg")
;img\cat = 2001 ;dungeon

End Function 

Function handlemenu()
;;;
;;;;
;;;Check if 'PLAY' pressed..if so then initialise
;first cut scene and change gamemode
;;;Check if 'TOGGLE AUDIO' pressed if so toggle music/audio flags

If lmb&lt;&gt;0 Then 
	If mx&gt;=1000 And mx&lt;=1200 Then 
		If my&gt;500 And my&lt;550 Then 
			;play hit
			initstartgame()
			gamemode = MODE_CUTSCENE
		EndIf 
		If my&gt;600 And my&lt;650 Then 
			audiostate = Not audiostate
			If Not audiostate
				;stop music
					
			EndIf 
		EndIf 
	EndIf 
EndIf 


End Function

Function drawmenu()
;draw backdrop
;draw buttons in relevant state
;draw mouse cursor

For img.images = Each images
	If img\cat = 2000 Then 
		DrawBlock img\img,0,0
	EndIf 
Next

For img.images = Each images
	If img\cat = CAT_MENU_PLAY
		DrawImage img\img,1000,500
	EndIf
	If img\cat = CAT_MENU_AUDIO
		DrawImage img\img,1000,600
	EndIf
Next

For img.images = Each images
	If img\cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img\img,mx,my
	EndIf
Next

End Function

Function handleinput()
;assign tx,ty of creatures to player units
;
acted = False
If lmb&lt;&gt;0 And olmb = 0 Then 
	For pc.creature = Each creature
		If pc\hp&gt;0 And pc\cat&gt;=10 And pc\cat&lt;=13 Then 
			If mx&gt;pc\x - ImageWidth(pc\img)/2 And mx&lt;pc\x + ImageWidth(pc\img)/2 And my&gt;pc\y-40 And my&lt;pc\y+40 Then 
				For a.creature = Each creature
					If a\hp&gt;0 And a\cat&lt;100 Then a\waitcount = a\waitcount + 1
					If a\waitcount &gt; 3 Then a\waitcount = 3
					If a\stunned &gt; 0 Then 
						a\stunned = a\stunned - 1
					EndIf 
				Next
				acted = True
				If pc\cat = CAT_FIGHTER And pc\stunned &lt;=0
					pc\attacktime = 30
					For a.creature = Each creature
						If a\cat &gt;= 100 And a\hp &gt; 0 Then 
							dieroll = Rand(1,1000)
							If dieroll &lt; pc\skill Then 
								a\hp = a\hp - pc\damage
								a\strucktime = 10
							EndIf 
						EndIf 
					Next
					pc\waitcount = 0
				EndIf
				If pc\cat = CAT_RANGER And pc\stunned &lt;=0
					maxhp = 0
					b.creature = Null;
					pc\attacktime = 30
					For a.creature = Each creature
						If a\cat &gt;= 100 And a\hp &gt; 0 Then 
							If a\hp &gt; maxhp Then 
								maxhp = a\hp
								b.creature = a.creature
							EndIf 
						EndIf 
					Next
					If b.creature&lt;&gt;Null Then 
						dieroll = Rand(1,1000)
						If dieroll &lt; pc\skill Then 
							b\hp = b\hp - pc\damage * (1 + pc\waitcount)
							b\strucktime = 15
						EndIf 
					EndIf 
					pc\waitcount = 0
				EndIf
				If pc\cat = CAT_WIZARD And pc\stunned&lt;=0
					pc\attacktime = 30
					damage = pc\damage * (pc\waitcount+1)
					For a.creature = Each creature
						If a\cat &gt;= 100 And a\hp &gt; 0 Then 
							dieroll = Rand(1,1000)
							If dieroll &lt; pc\skill Then 
								a\hp = a\hp - damage
								a\lightningtime = 30
								a\strucktime = 20
							Else
								pc\hp = pc\hp - 5 ; bad spell casting inflicts damage to caster
								pc\lightningtime = 30
								Exit
							EndIf 
						EndIf 
					Next
					pc\waitcount = 0
				EndIf
				If pc\cat = CAT_CLERIC And pc\stunned &lt;=0
					pc\attacktime = 30
					damage = pc\damage * (pc\waitcount + 1)
					For a.creature = Each creature
						If a\cat &lt; 100 And a\hp &lt; a\fullhp And a\hp &gt; 0 Then 
							a\hp = a\hp + damage
							a\healingtime = 60
							If a\hp &gt; a\fullhp Then a\hp = a\fullhp
						EndIf 
					Next
					pc\waitcount = 0
				EndIf	
			EndIf 
		EndIf 
	Next
EndIf 
If acted
	;perform poison
	for pc.creature = each creature
		if pc\hp &gt; 0 and pc\poison &gt; 0 and pc\cat &lt; 100 then 
			pc\hp = pc\hp - pc\poison
			pc\strucktime = 10
			dieroll = rand(1,1000)
			if dieroll &lt; pc\defenseskill then 
				pc\poison = 0
			endif 
		endif 
	next
	For a.creature = Each creature
		If a\hp &gt; 0 And a\cat &gt;= 100 Then 
			count = 0
			if a\regenerate and a\hp &lt; a\fullhp then 
				diff = (a\fullhp - a\hp) / 2
				a\hp = a\hp + diff
			endif 
			For pc.creature = Each creature
				If pc\cat &lt; 100 And pc\hp &gt; 0 Then count = count + 1
			Next
			If count &gt; 0 Then 
				count = Rand(1,count)
				For pc.creature = Each creature
					If pc\cat &lt; 100 And pc\hp &gt; 0 Then count = count - 1
					If count = 0 Then 
						dieroll = Rand(1,1000)
						If a\cat = 103 Then ;goblin shaman
							If dieroll &lt; a\skill Then 
								pc\hp = pc\hp - a\damage
								pc\strucktime = 10
								a\attacktime = 30
								pc\lightningtime = 30
							EndIf
						ElseIf a\cat = 106 Then ;spider wizard
							If dieroll &lt; a\skill Then 
								pc\stunned = Rand(1,2)
								dieroll2 = Rand(1,1000)
								If dieroll2 &gt; pc\defenseskill Then 
									pc\hp = pc\hp - a\damage
									pc\strucktime = 10
									a\attacktime = 30
								EndIf
								Exit
							EndIf 
						ElseIf a\cat = 107 Then ;spider queen
							If dieroll &lt; a\skill Then 
								For c.creature = Each creature
									If c\cat &gt;= 100 And c\hp &gt; 0 And c\hp &lt; c\fullhp
										c\healingtime = 60
										c\hp = c\hp + a\damage
										Exit 
									EndIf 
								Next
								dieroll2 = Rand(1,1000)
								If dieroll2 &gt; pc\defenseskill Then 
									pc\hp = pc\hp - a\damage
									pc\strucktime = 10
									a\attacktime = 30
								EndIf
								If pc\cat = CAT_WIZARD Or pc\cat = CAT_CLERIC
									pc\waitcount = 0
									Exit 
								EndIf
							EndIf 
							If dieroll &gt; pc\defenseskill Then 
								pc\hp = pc\hp - a\damage
								pc\strucktime = 10
								a\attacktime = 30
							EndIf
							Exit
						Else
							If dieroll &gt; pc\defenseskill Then 
								pc\hp = pc\hp - a\damage
								pc\strucktime = 10
								a\attacktime = 30
								if a\poison &gt; 0 then 
									pc\poison = a\poison
								endif 
							EndIf
							Exit
						EndIf  
					EndIf 
				Next
				
			EndIf 
		EndIf 
	Next
EndIf
End Function

Function updategame()
;move all creatures
;move all bullets
;handle all collisions
;handle all pick ups
;handle all combat
;handle all spell casting (magic missiles and healing)

found = False

For pc.creature = Each creature
	If pc\strucktime &gt; 0 Then 
		pc\strucktime = pc\strucktime - 1
		createbloodparticle(pc\x,pc\y)
		If pc\hp &lt;= 0 Then 
			createbloodparticle(pc\x,pc\y)
			createbloodparticle(pc\x,pc\y)
			createbloodparticle(pc\x,pc\y)
		EndIf 
	EndIf 
	If pc\hp&gt;0 Then 
		If pc\cat &gt;= 100 Then 
			found = True
		EndIf
	Else
		Delete pc
	EndIf 
Next
If found = False Then 
	levelfinishtime = levelfinishtime + 1
EndIf 
foundp = False
For pc.creature = Each creature
	If pc\hp &gt; 0 And pc\cat &lt; 100 Then foundp = True:Exit 
Next
If foundp = False Then 
	levelfinishtime = levelfinishtime + 1
EndIf 
If levelfinishtime &gt; 250 Then 
	gamemode = MODE_MENU ;eventually change to mode_upgrade
	If foundp Then gamemode = MODE_UPGRADE
	gamelevel = gamelevel + 1
	ftrpicked = False
	clrpicked = False
	rngpicked = False
	wizpicked = False 
EndIf 

For pc.creature = Each creature
	If pc\hp &gt; 0 Then 
		If pc\healingtime &gt; 0 Then pc\healingtime = pc\healingtime - 1
	EndIf 
Next
updateparticle()
End Function

Function drawgame()
;draw background (fixed static 1280x720 image background)
;draw all creatures - don't worry about zordering them - it will be too fast to notice 
;draw all bullets
For img.images = Each images
	If img\cat = 2001 ;change this later
		DrawBlock img\img,0,0
	EndIf
Next
For pc.creature = Each creature
	If pc\hp &gt; 0 Then
		aa# = 0
		bb# = 0
		If pc\attacktime &gt; 0 Then 
			pc\attacktime = pc\attacktime - 1
			aa# = -25.0 * Sin(pc\attacktime * 6)
			If pc\cat&gt;=100 Then aa = aa * -1.0
		EndIf 
		If pc\strucktime &gt; 0 Then 
			bb = Rand(-pc\strucktime/2,pc\strucktime/2)
		EndIf 
		if pc\poison &gt; 0 and pc\cat &lt; 100 then 
			Color 32,255,32
			Oval pc\x - ImageWidth(pc\img)/2,pc\y-40,ImageWidth(pc\img),80,1
		endif 
		DrawImage pc\img,bb + pc\x - ImageWidth(pc\img)/2,pc\y - 40 + aa
		dhp = 10 * pc\hp / pc\fullhp
		If dhp &lt; 4 Then Color 255,32,32
		If dhp &gt;=4 And dhp&lt;8 Then Color 255,255,32
		If dhp &gt;=8 Then Color 32,255,32
		If dhp = 0 Then dhp = 1
		For hp = 1 To dhp
			Rect hp*4 + pc\x - ImageWidth(pc\img)/3,pc\y - 50,3,3,1
		Next
		If pc\healingtime &gt; 0 Then 
			createhealparticle(pc\x,pc\y)
		EndIf 
		If pc\lightningtime &gt; 0 Then 
			pc\lightningtime = pc\lightningtime - 1
			drawlightning(pc\x,pc\y)
		EndIf 
		If pc\waitcount &gt; 0 Then 
			Color 255,32,255
			For i = 1 To pc\waitcount
				Rect i * 4 + pc\x - ImageWidth(pc\img)/3,pc\y - 55,3,3,1
			Next
		EndIf 
		If pc\stunned &gt; 0 and pc\cat &lt; 100 Then 
			Color 255,255,32
			Oval pc\x - ImageWidth(pc\img)/2,pc\y-40,ImageWidth(pc\img),80,0
		EndIf 
	EndIf
Next
drawparticle()
Color 255,255,255
For img.images = Each images
	If img\cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img\img,mx,my
	EndIf
Next


End Function 

Function drawlightning(x,y)

iy = 0
ix = x + Rand(-20,20)
While iy &lt; y
oy = iy
ox = ix
ix = x + Rand(-20,20)
iy = iy + Rand(10,25)
Color 200,200,255
Line ox,oy,ix,iy
Color 150,150,200
Line ox+1,oy+1,ix+1,iy+1
Line ox-1,oy-1,ix-1,iy-1
Color 100,100,150
Line ox+2,oy+2,ix+2,iy+2
Line ox-2,oy-2,ix-2,iy-2
Color 32,32,90
Line ox+3,oy+3,ix+3,iy+3
Line ox-3,oy-3,ix-3,iy-3

Wend 

End Function 

Function handlecutscene()
;handle transitions,  handle skip button; 
;handle fading in and out text (bitmap fonts?)

If lmb&lt;&gt;0 And olmb = 0 Then 
	If mx&gt;1000 And mx&lt;1200 And my&gt;600 And my&lt;650 Then 
		initlevel()
		gamemode = MODE_COMBAT
	EndIf 
EndIf 

End Function 

Function drawcutscene()
;draw cut scene background, draw transition, draw skip button
For img.images = Each images
	If img\cat = 2003 Then 
		DrawBlock img\img,0,0
	EndIf 
Next

count = 0
If MilliSecs()&gt;mapdelay Then 
	mapdelay = MilliSecs()+400
	mapindex = mapindex + 1
	For m.mappos = Each mappos
		If m\index &gt; gamelevel Then Exit
		count = count + 1
		If m\index = gamelevel Then 
			If mapindex &gt; count Then mapindex = count
			Exit
		EndIf 	
	Next
EndIf 
count = 0
For m.mappos = Each mappos
	If m\index &gt; gamelevel Then Exit
	If m\index=0 Then 
		Color 32,12,12
	Else
		Color 192,32,32
	EndIf 
	count = count + 1
	If count &lt;= mapindex Then Oval m\x,m\y,16,16,1
Next


For img.images = Each images
	If img\cat = CAT_MENU_SKIP_CUTSCENE
		DrawImage img\img,1000,600
	EndIf
Next

For img.images = Each images
	If img\cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img\img,mx,my
	EndIf
Next

End Function 

Function handleupgrade()
;handle button press 'add stuff' to characters
;
;
;
If lmb&lt;&gt;0 And olmb = 0Then 
	If mx &gt; 1000 And mx&lt;1200 And my&gt;600 And my &lt;650
		gamemode = MODE_CUTSCENE
		FlushMouse()
	EndIf
	i = -1
	For pc.creature = Each creature
	If pc\cat &lt; 100 And pc\hp &gt; 0 Then 
		i = i + 1
		y = 100 * i + 200
		DrawImage pc\img,100,y
		If pc\cat = CAT_FIGHTER And (Not ftrpicked)
			If mx&gt;200 And mx &lt; 400 And my &gt; y And my &lt; y + 50 Then 
				;health picked
				ftrpicked = True
				pc\fullhp = pc\fullhp + 10
			EndIf 
			If mx&gt;450 And mx &lt; 650 And my &gt; y And my &lt; y + 50 Then 
				;damage picked
				ftrpicked = True
				pc\damage = pc\damage + 4
			EndIf 
			
			If mx&gt;700 And mx &lt; 900 And my &gt; y And my &lt; y + 50 Then 
				;skill picked
				ftrpicked = True
				ds# = (1000 - pc\skill) * 0.95
				pc\skill = 1000 - ds
			EndIf 
			
			If mx&gt;950 And mx &lt; 1150 And my &gt; y And my &lt; y + 50 Then 
				;def picked
				ftrpicked = True
				ds# = (1000 - pc\defenseskill) * 0.95
				pc\defenseskill = 1000 - ds
			EndIf 
		EndIf
		If pc\cat = CAT_RANGER And (Not rngpicked)
			If mx&gt;200 And mx &lt; 400 And my &gt; y And my &lt; y + 50 Then 
				;health picked
				rngpicked = True
				pc\fullhp = pc\fullhp + 10
			EndIf 
			If mx&gt;450 And mx &lt; 650 And my &gt; y And my &lt; y + 50 Then 
				;damage picked
				rngpicked = True
				pc\damage = pc\damage + 4
			EndIf 
			
			If mx&gt;700 And mx &lt; 900 And my &gt; y And my &lt; y + 50 Then 
				;skill picked
				rngpicked = True
				ds# = (1000 - pc\skill) * 0.95
				pc\skill = 1000 - ds
			EndIf 
			
			If mx&gt;950 And mx &lt; 1150 And my &gt; y And my &lt; y + 50 Then 
				;def picked
				rngpicked = True
				ds# = (1000 - pc\defenseskill) * 0.95
				pc\defenseskill = 1000 - ds
			EndIf 
		
		EndIf
		If pc\cat = CAT_WIZARD And (Not wizpicked)
			If mx&gt;200 And mx &lt; 400 And my &gt; y And my &lt; y + 50 Then 
				;health picked
				wizpicked = True
				pc\fullhp = pc\fullhp + 10
			EndIf 
			If mx&gt;450 And mx &lt; 650 And my &gt; y And my &lt; y + 50 Then 
				;damage picked
				wizpicked = True
				pc\damage = pc\damage + 4
			EndIf 
			
			If mx&gt;700 And mx &lt; 900 And my &gt; y And my &lt; y + 50 Then 
				;skill picked
				wizpicked = True
				ds# = (1000 - pc\skill) * 0.95
				pc\skill = 1000 - ds
			EndIf 
			
			If mx&gt;950 And mx &lt; 1150 And my &gt; y And my &lt; y + 50 Then 
				;def picked
				wizpicked = True
				ds# = (1000 - pc\defenseskill) * 0.95
				pc\defenseskill = 1000 - ds
			EndIf 

		EndIf
		If pc\cat = CAT_CLERIC And (Not clrpicked)
			If mx&gt;200 And mx &lt; 400 And my &gt; y And my &lt; y + 50 Then 
				;health picked
				clrpicked = True
				pc\fullhp = pc\fullhp + 10
			EndIf 
			If mx&gt;450 And mx &lt; 650 And my &gt; y And my &lt; y + 50 Then 
				;damage picked
				clrpicked = True
				pc\damage = pc\damage + 4
			EndIf 
			If mx&gt;700 And mx &lt; 900 And my &gt; y And my &lt; y + 50 Then 
				;skill picked
				clrpicked = True
				ds# = (1000 - pc\skill) * 0.95
				pc\skill = 1000 - ds
			EndIf 
			If mx&gt;950 And mx &lt; 1150 And my &gt; y And my &lt; y + 50 Then 
				;def picked
				clrpicked = True
				ds# = (1000 - pc\defenseskill) * 0.95
				pc\defenseskill = 1000 - ds
			EndIf 
		EndIf 
	EndIf 
Next


	
EndIf


End Function

Function drawupgrade()
;draw background
;draw buttons
;draw characters
;draw stats
;draw continue button
For img.images = Each images
	If img\cat = 2000 Then 
	;	DrawBlock img\img,0,0
	EndIf 
Next

i=-1
For pc.creature = Each creature
	If pc\cat &lt; 100 And pc\hp &gt; 0 Then 
		pc\hp = pc\fullhp
		i = i + 1
		y = 100 * i + 200
		DrawImage pc\img,100,y
	;	Text 150,i*100+200,"Skill:"+pc\skill+" Defense:"+pc\defenseskill + " Health:"+pc\fullhp + " Power:"+pc\damage
		If pc\cat = CAT_FIGHTER And (Not ftrpicked)
			For img.images = Each images
				If img\cat = CAT_MENU_ADD_HEALTH Then
					DrawImage img\img,200,y
					Text 300,y + 65,pc\fullhp,1,1
				EndIf
				If img\cat = CAT_MENU_ADD_DAMAGE Then
					DrawImage img\img,450,y
					Text 550,y + 65,pc\damage,1,1
				EndIf
				If img\cat = CAT_MENU_ADD_SKILL Then
					DrawImage img\img,700,y
					Text 800,y + 65,pc\skill,1,1
				EndIf
				If img\cat = CAT_MENU_ADD_DEF Then 
					DrawImage img\img,950,y
					Text 1050,y + 65,pc\defenseskill,1,1
				EndIf 
			Next
		EndIf
		If pc\cat = CAT_RANGER And (Not rngpicked)
			For img.images = Each images
				If img\cat = CAT_MENU_ADD_HEALTH Then
					DrawImage img\img,200,y
					Text 300,y + 65,pc\fullhp,1,1
				EndIf
				If img\cat = CAT_MENU_ADD_DAMAGE Then
					DrawImage img\img,450,y
					Text 550,y + 65,pc\damage,1,1
				EndIf
				If img\cat = CAT_MENU_ADD_SKILL Then
					DrawImage img\img,700,y
					Text 800,y + 65,pc\skill,1,1
				EndIf
				If img\cat = CAT_MENU_ADD_DEF Then 
					DrawImage img\img,950,y
					Text 1050,y + 65,pc\defenseskill,1,1
				EndIf 
			Next
		
		EndIf
		If pc\cat = CAT_WIZARD And (Not wizpicked)
			For img.images = Each images
				If img\cat = CAT_MENU_ADD_HEALTH Then
					DrawImage img\img,200,y
					Text 300,y + 65,pc\fullhp,1,1
				EndIf
				If img\cat = CAT_MENU_ADD_DAMAGE Then
					DrawImage img\img,450,y
					Text 550,y + 65,pc\damage,1,1
				EndIf
				If img\cat = CAT_MENU_ADD_SKILL Then
					DrawImage img\img,700,y
					Text 800,y + 65,pc\skill,1,1
				EndIf
				If img\cat = CAT_MENU_ADD_DEF Then 
					DrawImage img\img,950,y
					Text 1050,y + 65,pc\defenseskill,1,1
				EndIf 
			Next
		
		EndIf
		If pc\cat = CAT_CLERIC And (Not clrpicked)
			For img.images = Each images
				If img\cat = CAT_MENU_ADD_HEALTH Then
					DrawImage img\img,200,y
					Text 300,y + 65,pc\fullhp,1,1
				EndIf
				If img\cat = CAT_MENU_ADD_DAMAGE Then
					DrawImage img\img,450,y
					Text 550,y + 65,pc\damage,1,1
				EndIf
				If img\cat = CAT_MENU_ADD_SKILL Then
					DrawImage img\img,700,y
					Text 800,y + 65,pc\skill,1,1
				EndIf
				If img\cat = CAT_MENU_ADD_DEF Then 
					DrawImage img\img,950,y
					Text 1050,y + 65,pc\defenseskill,1,1
				EndIf 
			Next
		
		EndIf 
	EndIf 
Next


For img.images = Each images
	If img\cat = CAT_MENU_SKIP_CUTSCENE
		DrawImage img\img,1000,600
	EndIf
Next

Text 0,0,"On this screen you would upgrade some of your characters"

For img.images = Each images
	If img\cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img\img,mx,my
	EndIf
Next




End Function 

Function initstartgame()
gamelevel = 1
mapindex = 0
Delete Each creature
pc.creature = New creature
pc\fullhp = 90
pc\hp = 90
pc\cat = CAT_FIGHTER
pc\x = 600
pc\y = 300
pc\tx = pc\x
pc\ty = pc\y
pc\skill = 100
pc\defenseskill = 850
pc\damage = 10
pc\speed = 4.0
For img.images = Each images
	If img\cat = CAT_FIGHTER Then 
		pc\img = img\img
		Exit 
	EndIf 
Next
pc.creature = New creature
pc\fullhp = 75
pc\hp = 75
pc\cat = CAT_RANGER
pc\x = 640
pc\y = 300
pc\tx = pc\x
pc\ty = pc\y
pc\skill = 800
pc\defenseskill = 850
pc\damage = 50
pc\speed = 5.0
For img.images = Each images
	If img\cat = CAT_RANGER Then 
		pc\img = img\img
		Exit 
	EndIf 
Next
pc.creature = New creature
pc\fullhp = 45
pc\hp = 45
pc\cat = CAT_WIZARD
pc\x = 750
pc\y = 360
pc\tx = pc\x
pc\ty = pc\y
pc\skill = 650
pc\damage = 18
pc\speed = 5.0
pc\defenseskill = 500
For img.images = Each images
	If img\cat = CAT_WIZARD Then 
		pc\img = img\img
		Exit 
	EndIf 
Next
pc.creature = New creature
pc\fullhp = 60
pc\hp = 60
pc\cat = CAT_CLERIC
pc\x = 640
pc\defenseskill = 800
pc\y = 350
pc\tx = pc\x
pc\ty = pc\y
pc\skill = 100
pc\damage = 5
pc\speed = 4.0
For img.images = Each images
	If img\cat = CAT_CLERIC Then 
		pc\img = img\img
		Exit 
	EndIf 
Next
End Function 

Function initlevel()
Dim wallmap(SW,SH)
Dim blockmap(SW/20,SH/12)
For pc.creature = Each creature
	If pc\hp &gt; 0 And pc\hp &lt; pc\fullhp Then pc\hp = pc\fullhp
	If pc\cat = CAT_FIGHTER
		pc\x = 300
		pc\y = 400
	EndIf
	If pc\cat = CAT_RANGER
		pc\x = 375
		pc\y = 400
	EndIf
	If pc\cat = CAT_WIZARD
		pc\x = 450
		pc\y = 400
	EndIf
	If pc\cat = CAT_CLERIC
		pc\x = 500
		pc\y = 400
	EndIf
	pc\x = pc\x + 200
	pc\tx = pc\x
	pc\ty = pc\y
	If pc\cat &gt;=100 Then Delete pc
Next

For i = 1 To 8
	pc.creature = New creature
	pc\x = 300 + i * 80;Rand(0,SW)
	pc\y = 200 ;Rand(0,SH)
	pc\tx = pc\x
	pc\ty = pc\y
	
	If gamelevel = 1 Then 
	pc\cat = 100+Rand(0,1)
	pc\hp = 70
	pc\fullhp = 50
	pc\speed = 3
	pc\damage = 5
	pc\skill = 80
	EndIf
	If gamelevel = 2 Then 
		;trolls2
		If i = 1 Or i = 8 Then 
			pc\cat = 102
			pc\hp = 200
			pc\regenerate = true
			pc\fullhp = 200
			pc\speed = 3
			pc\damage = 10
			pc\skill = 150
		Else
			pc\cat = 100+Rand(0,1)
			pc\hp = 70
			pc\fullhp = 50
			pc\speed = 3
			pc\damage = 5
			pc\skill = 80
		EndIf 
	EndIf 
	If gamelevel = 3 Then 
		;wizard and troll
		If i = 1 Or i = 8 Then
			pc\cat = 102
			pc\hp = 200
			pc\regenerate = true
			pc\fullhp = 200
			pc\speed = 3
			pc\damage = 10
			pc\skill = 150
		ElseIf i = 4 Then
			pc\cat = 103
			pc\hp = 100
			pc\fullhp = 100
			pc\speed = 3
			pc\damage = 5
			pc\skill = 350
		Else
			pc\cat = 100+Rand(0,1)
			pc\hp = 70
			pc\fullhp = 50
			pc\speed = 3
			pc\damage = 5
			pc\skill = 80
		EndIf 
	EndIf
	If gamelevel = 4 Then
		;spiderbeasts and giant spiders
		If i = 1 Or i = 8 Then 
			pc\cat = 104
			pc\hp = 150
			pc\poison = 15
			pc\regenerate = true
			pc\fullhp = 150
			pc\speed = 3
			pc\damage = 15
			pc\skill = 100
		Else
			pc\cat = 105
			pc\hp = 100
			pc\fullhp = 100
			pc\speed = 3
			pc\damage = 8
			pc\skill = 150
		EndIf 

	EndIf
	If gamelevel = 5 Then 
		;spiderbeasts, giant spiders and spider wizards
		If i = 1 Or i = 8 Then 
			pc\cat = 104
			pc\hp = 150
			pc\poison = 15
			pc\regenerate = true
			pc\fullhp = 150
			pc\speed = 3
			pc\damage = 15
			pc\skill = 100
		ElseIf i = 2 Or i = 7
			pc\cat = 106
			pc\hp = 100
			pc\fullhp = 100
			pc\speed = 3
			pc\damage = 8
			pc\skill = 300
		Else
			pc\cat = 105
			pc\hp = 100
			pc\fullhp = 100
			pc\speed = 3
			pc\damage = 8
			pc\skill = 150
		EndIf 


	EndIf 
	If gamelevel = 6 Then 
		;spider queens and spiderbeasts
		If i = 1 Or i = 8 Then 
			pc\cat = 107
			pc\hp = 100
			pc\fullhp = 100
			pc\speed = 3
			pc\damage = 5
			pc\skill = 450
		Else
			pc\cat = 105
			pc\hp = 100
			pc\fullhp = 100
			pc\speed = 3
			pc\damage = 8
			pc\skill = 150
		EndIf 
	EndIf 
	If gamelevel = 7 Then 
		;spider queens and giant spiders and spider wizards
		If i = 4 Or i = 5 Then 
			pc\cat = 107
			pc\hp = 100
			pc\fullhp = 100
			pc\speed = 3
			pc\damage = 5
			pc\skill = 450
		ElseIf i = 2 Or i = 7
			pc\cat = 106
			pc\hp = 100
			pc\fullhp = 100
			pc\speed = 3
			pc\damage = 8
			pc\skill = 300
		Else
			pc\cat = 104
			pc\hp = 150
			pc\regenerate = true
			pc\poison = 15
			pc\fullhp = 150
			pc\speed = 3
			pc\damage = 15
			pc\skill = 100
		EndIf 
	EndIf 
	For img.images = Each images
		If img\cat = pc\cat Then 
			pc\img = img\img
			Exit 
		EndIf 
	Next
Next

lmb = 0
olmb = 0
FlushMouse()
levelfinishtime = 0
End Function 

Function createhealparticle(x,y)

For i = 1 To 36
	p.particle = New particle
	p\life = 20
	p\x = x + 25.0 * Cos(i*10)
	p\y = y + 20 + 25.0 * (Sin(i*5))
	p\vx = 0
	p\vy = Rand(-4,-2)
	p\ay = 0.1
	p\gy = p\y + 100
	p\r = 32
	p\g = 200
	p\b = 255
	p\sz = 4
	p\dsz = -0.1
	p\dr = 10
	p\dg = 2
	p\db = 0
Next

End Function 

Function createbloodparticle(x,y)

For i = 1 To 10
	p.particle = New particle
	p\life = 20
	p\x = x + Rand(-10,10)
	p\y = y + Rand(-10,10)
	p\vx = Rnd(-3,3)
	p\vy = Rnd(-3,3)
	p\ay = 0.05
	p\gy = y + 42
	p\r = 255
	p\g = 100
	p\b = 100
	p\dr = -2
	p\dg = -3
	p\db = -3
	p\sz = 4
	p\dsz = 0
Next

End Function 

Function updateparticle()
For p.particle = Each particle
	p\life = p\life - 1
	p\x = p\x + p\vx
	p\y = p\y + p\vy
	p\vy = p\vy + p\ay
	If p\y &gt; p\gy Then 
		p\vy = p\vy * -0.7
		If Abs(p\vy)&lt;0.01 Then p\life = 0
	EndIf 
	p\sz = p\sz + p\dsz
	p\r = p\r + p\dr
	p\g = p\g + p\dg
	p\b = p\b + p\db
	If p\sz &lt; 0 Then p\sz = 0
	If p\r &gt; 255 Then p\r = 255
	If p\g &gt; 255 Then p\g = 255
	If p\b &gt; 255 Then p\b = 255
	If p\r &lt; 0 Then p\r = 0
	If p\g &lt; 0 Then p\g = 0
	If p\b &lt; 0 Then p\b = 0
	If p\life &lt; 0 Then Delete p
Next
End Function 

Function drawparticle()
For p.particle = Each particle
	Color p\r,p\g,p\b
	Rect p\x,p\y,p\sz,p\sz,1
Next
Color 255,255,255
End Function 
</textarea><br><br>Going to change the map method but you get a bit of an idea.... <br><br></td></tr></table><br>
<a name="1341294"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#81">[#81]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks RemiD....<br><br>Rooster - I haven't implemented your changes in blitzplus/blitz3d yet (the image and stat loading techniques...) I will likely implement them further down the track...<br><br>Tonight when I get home from work I'm going to implement the beastmen stages and draw the undead and potentially the eye monsters/weird monsters as well....<br><br>I've added a few more 'modes' to the players/monsters including 'cursed' and 'berserk' with particle effects for each.  <br><br>It's coming along nicely....<br><br>I've added a regeneration and poison attribute to trolls and giant spiders respectively. <br><br></td></tr></table><br>
<a name="1341304"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rooster</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#82">[#82]</a></td></tr></table></td></tr><tr ><td class="posttext"> And ported.<br><br>Looking good, between the stun and poison its starting to get harder.<br>What are the plans for audio?<br><br>Will the player eventually be able to chose the level at the world map, or do you plan on keeping it the way it is?<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
'This is both a learning exercise And hopefully a collaborative project of sorts
'Or at least a project I can share with others on the blitz forum:
'It will be written initially in blitzplus/blitz3d And maybe someone will be keen on
'porting it To blitzmax:::even blitzmax-ng To Release on mobile perhaps?
'
'Interface:
'Left mouse button clicking only To make porting To 
'mobile interface much, much easier:
'Gameplay mechanic so far (15-May-2017)
'
'1: Arcade Action RPG Combat
'	Player controls 4 characters in a single screen dungeon:
'	Dungeon has a few walls And so on that prevent movement:
'	Monsters spawn from spawners And make their way around the map
'	Player taps the screen To move To location And characters fight things
'	in their path:
'	Powerups exist in the level such as:
'	Health pickups
'	Bombs - kill all monsters that have spawned Or at least damage them:
'	
'2: After the arcade sequence the player is presented with options To upgrade their
'	character's stats: Stats to upgrade include:
'	Combat skill ('to hit roll')
'	Damage output ('damage points')
'	Health points ('hp')
'	Movement speed ('move')
'3:	After this a Short cut scene is presented which may simply be a scrolling static
'	image with some fading in/fading out text To advance the story line
'0: Menu - toggle audio, play, credits
'
'Character types:
'1 Fighter - high hitpoint melee combat medium damage
'2 Ranger - medium hitpoint melee combat high damage
'3 Wizard - low hitpoint, ranged combat, medium damage
'4 Cleric - medium hitpoint, no combat, healer
'


'constants
Const SW=1280,SH=720,WIN=2
Const MODE_MENU = 0
Const MODE_COMBAT = 1
Const MODE_UPGRADE = 2
Const MODE_CUTSCENE = 3
Const PURE_2D = True 'If go To blitzmax can use 2d-in-3d commands such as alpha otherwise have To calculate manually:Change To False For blitzmax:

'categories For image types And Object types
Const CAT_MENU_PLAY = 0
Const CAT_MENU_AUDIO = 1
Const CAT_MENU_SKIP_CUTSCENE = 2 'cut scene mode
Const CAT_MENU_ADD_SKILL = 3 'upgrade mode
Const CAT_MENU_ADD_DAMAGE = 4'upgrade mode
Const CAT_MENU_ADD_HEALTH = 5'upgrade mode
'Const CAT_MENU_ADD_SPEED = 6'
Const CAT_MENU_ADD_DEF = 6
Const CAT_MENU_MOUSE_CURSOR = 7'
Const CAT_FIGHTER = 10
Const CAT_KNIGHT = 10 'synonym
Const CAT_RANGER = 11
Const CAT_WIZARD = 12
Const CAT_CLERIC = 13
Const CAT_HEALER = 13 'synonym
Const CAT_HEALTH_PICKUP = 20
Const CAT_BOMB_PICKUP = 21
'CAT_BACKGROUND = 2000-3000 ' all the different image backgrounds
'CAT_MONSTER = 100-1000 , all the different monster types

Const AI_WANDER = 0
Const AI_ATTACK = 1

Const TEAM_PLAYER = 0
Const TEAM_MONSTER = 1

'globals
Global mx,my,lmb,olmb 'mouse Input
Global audiostate 'on/off
Global gamemode 'references Const above
Global gamelevel 'For cutscenes
Global cutsceneframe 'For cutscenes ie trigger fades, text, motion etc on certain frames
Global levelfinishtime = 0
Global mapdelay 'timestamp
Global mapindex

Global ftrpicked,rngpicked,wizpicked,clrpicked 'boolean For upgrades

'for Bmax -Rooster
Global list_objects:TList=New TList

'arrays
Global wallmap[0,0] '0/1 value at each element indicates whether wall is there Or Not - redimension later
Global blockmap[0,0] '0/1 value - bigger version of wallmap Lower resolution
'types
Type images

Field img 'handle
Field midhandled 'boolean
Field cat 'category //hooks into creature template

End Type 

Type creaturetemplate

Field img 'img handle
Field cat 'category
Field fullhp 'n (values range from about 10 To 200 For high level characters And monsters)
Field combatskill '1-1000 (percentile out of a 1000 Not 100) (roll under To hit/roll under To cast)
Field speed# 'n:m (movement speed)
Field damage 'n (damage per hit, also equal To hitpoints To heal per successful cast)

End Type 

Type bullet

Field img 'handle of image
Field team 'players Or monsters - so no friendly fire
Field x#
Field y#
Field vx#
Field vy#
Field life
Field damage 'damage To inflict per hit Then disappear

End Type

Type spawner

Field img
Field cat 'category To spawn
Field x
Field y
Field hp
Field timetospawn 'frames To count down from when respawning
Field spawndelay 'Current frame count on spawner 0 To 'timetospawn':

End Type 

Type mappos
Field x,y,index
End Type 

Type creature

Field img
Field cat
Field x#
Field y#
Field tx#
Field ty#
Field hp
Field fullhp
Field speed#
Field damage
Field skill

Field defenseskill 'For players

Field aimode
Field aidelay
Field aitime

Field moving 'boolean

Field healingtime 'For healing effect/buff effect
Field lightningtime 'For lightning blasts on creature effect
Field strucktime 'For blood effects
Field attacktime 

Field activated 'boolean
Field waitcount 'Int

Field stunned 'Int 0-n counts down each time active::::
Field poison 'Int 0-n = damage inflicted
Field regenerate 'boolean

End Type 

Type menubutton

Field cat 'For menu buttons
Field img
Field x
Field y
Field w
Field h
Field state 'pressed/Not pressed

End Type 

Type cutscene

Field cat
Field img
Field x
Field y
Field levelnum 'For the specific level num
Field upperframe 'For the Upper limit on the frame number To show this image For
Field transitiontype 'define later For transitioning between frames:::do all this in code 

End Type 

'New emitters And particles
Type particle

Field r,g,b,a
Field x#,y#,vx#,vy#,ay#,gy#
Field life
Field dr,dg,db,da
Field sz,dsz

End Type



Main()

Function Main()
	quit = False
	gamemode = MODE_MENU
	init()
	Repeat
		frametime = MilliSecs()
		Cls
		'Input 
		mx = MouseX()
		my = MouseY()
		olmb = lmb
		lmb = MouseDown(1)
		Select gamemode
		
		Case MODE_MENU
			handlemenu()
			drawmenu()
		
		Case MODE_COMBAT
			handleinput()
			updategame()
			drawgame()
		Case MODE_CUTSCENE
			handlecutscene()
			drawcutscene()
		Case MODE_UPGRADE
			handleupgrade()
			drawupgrade()
		End Select
		
		Flip
		'very basic frame limiting
		endframetime = MilliSecs()
		dtime = endframetime - frametime
		If dtime &lt; 15 Then 
			Delay 15 - dtime
		EndIf 
		'End of frame limiting
		If(KeyHit(27)) Then quit = True		
	Until quit
	''''''
	End
End Function 

Function init()
Graphics SW,SH,0',WIN
'Load data files
'Load all images here
'Load all sounds here
'Load all music here
HideMouse ()

infile = ReadFile("data\map.dat")
count = ReadShort(infile)
For i = 1 To count
m:mappos = New mappos
m.x = ReadShort(infile)
m.y = ReadShort(infile)
m.index = ReadByte(infile)
If m.index &gt; 0 Then 
index = index + 1
m.index = index
list_objects.AddLast m
EndIf 
Next
CloseFile infile


img:images = New images
img.img = LoadImage("images\02003map.jpg")
img.cat = 2003
list_objects.AddLast img


img:images = New images
img.img = LoadImage("images\btndef.png")
img.cat = CAT_MENU_ADD_DEF
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\btnhp.png")
img.cat = CAT_MENU_ADD_HEALTH
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\btnpower.png")
img.cat = CAT_MENU_ADD_DAMAGE
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\btnskill.png")
img.cat = CAT_MENU_ADD_SKILL
list_objects.AddLast img


img:images = New images
img.img = LoadImage("images\knight1.png")
img.cat = CAT_FIGHTER
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\ranger1.png")
img.cat = CAT_RANGER
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\wizard1.png")
img.cat = CAT_WIZARD
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\cleric1.png")
img.cat = CAT_CLERIC
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\goblin1.png")
img.cat = 100 'goblin 1
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\goblin2.png")
img.cat = 101 'goblin 2
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\troll1.png")
img.cat = 102 'troll 1
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\goblinshaman1.png")
img.cat = 103 'goblin shaman
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\giantspider1.png")
img.cat = 104 'giant spider melee brute:::
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\spiderbeast1.png")
img.cat = 105 'spider beast
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\spiderwizard1.png")
img.cat = 106 'spider wizard - stuns enemy units (reduces skill)
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\spiderqueen1.png")
img.cat = 107 'spider queen - stuns spell casters (reduces waitcount) And melee unit And heals friendlies
list_objects.AddLast img


img:images = New images
img.img = LoadImage("images\btnplay.png")
img.cat = CAT_MENU_PLAY
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\btnaudio.png")
img.cat = CAT_MENU_AUDIO
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\cursor.png")
img.cat = CAT_MENU_MOUSE_CURSOR
list_objects.AddLast img

img:images = New images
img.img = LoadImage("images\btnskip.png")
img.cat = CAT_MENU_SKIP_CUTSCENE
list_objects.AddLast img

'we don't have backgrounds yet so create them on the fly for now
img:images = New images
img.img = CreateImage(SW,SH)
LockImage( img.img,0,0) 'more stuff needed for BMax to draw to image -Rooster

For i = 1 To 100
	SetColor 100,100,100
	DrawOval Rand(SW),Rand(SH),100,100',1
Next

GrabImage img.img,0,0 'more stuff needed for BMax to draw to image -Rooster
UnlockImage (img.img)

img.cat = 2000
list_objects.AddLast img

'img:images = New images
'img.img = LoadImage("images\bk1:jpg")
'img.cat = 2001 'dungeon
SetColor 255,255,255'reseting the draw color for BMax -Rooster
End Function 

Function handlemenu()
'''
''''
'''Check If 'PLAY' pressed::if so then initialise
'first cut scene And change gamemode
'''Check If 'TOGGLE AUDIO' pressed if so toggle music/audio flags

If lmb&lt;&gt;0 Then 
	If mx&gt;=1000 And mx&lt;=1200 Then 
		If my&gt;500 And my&lt;550 Then 
			'play hit
			initstartgame()
			gamemode = MODE_CUTSCENE
		EndIf 
		If my&gt;600 And my&lt;650 Then 
			audiostate = Not audiostate
			If Not audiostate
				'stop music
					
			EndIf 
		EndIf 
	EndIf 
EndIf 


End Function

Function drawmenu()
'draw backdrop
'draw buttons in relevant state
'draw mouse cursor

For img:images = EachIn list_objects
	If img.cat = 2000 Then 
		DrawImage img.img,0,0
	EndIf 
Next

For img:images = EachIn list_objects 
	If img.cat = CAT_MENU_PLAY
		DrawImage img.img,1000,500
	EndIf
	If img.cat = CAT_MENU_AUDIO
		DrawImage img.img,1000,600
	EndIf
Next

For img:images = EachIn list_objects 
	If img.cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img.img,mx,my
	EndIf
Next

End Function

Function handleinput()
'assign tx,ty of creatures To player units
'
acted = False
If lmb&lt;&gt;0 And olmb = 0 Then 
	For pc:creature = EachIn list_objects
		If pc.hp&gt;0 And pc.cat&gt;=10 And pc.cat&lt;=13 Then 
			If mx&gt;pc.x - ImageWidth(pc.img)/2 And mx&lt;pc.x + ImageWidth(pc.img)/2 And my&gt;pc.y-40 And my&lt;pc.y+40 Then 
				For a:creature = EachIn list_objects
					If a.hp&gt;0 And a.cat&lt;100 Then a.waitcount = a.waitcount + 1
					If a.waitcount &gt; 3 Then a.waitcount = 3
					If a.stunned &gt; 0 Then 
						a.stunned = a.stunned - 1
					EndIf 
				Next
				acted = True
				If pc.cat = CAT_FIGHTER And pc.stunned &lt;=0
					pc.attacktime = 30
					For a:creature = EachIn list_objects
						If a.cat &gt;= 100 And a.hp &gt; 0 Then 
							dieroll = Rand(1,1000)
							If dieroll &lt; pc.skill Then 
								a.hp = a.hp - pc.damage
								a.strucktime = 10
							EndIf 
						EndIf 
					Next
					pc.waitcount = 0
				EndIf
				If pc.cat = CAT_RANGER And pc.stunned &lt;=0
					maxhp = 0
					b:creature = Null'
					pc.attacktime = 30
					For a:creature = EachIn list_objects
						If a.cat &gt;= 100 And a.hp &gt; 0 Then 
							If a.hp &gt; maxhp Then 
								maxhp = a.hp
								b:creature = a:creature
							EndIf 
						EndIf 
					Next
					If b:creature&lt;&gt;Null Then 
						dieroll = Rand(1,1000)
						If dieroll &lt; pc.skill Then 
							b.hp = b.hp - pc.damage * (1 + pc.waitcount)
							b.strucktime = 15
						EndIf 
					EndIf 
					pc.waitcount = 0
				EndIf
				If pc.cat = CAT_WIZARD And pc.stunned&lt;=0
					pc.attacktime = 30
					damage = pc.damage * (pc.waitcount+1)
					For a:creature = EachIn list_objects
						If a.cat &gt;= 100 And a.hp &gt; 0 Then 
							dieroll = Rand(1,1000)
							If dieroll &lt; pc.skill Then 
								a.hp = a.hp - damage
								a.lightningtime = 30
								a.strucktime = 20
							Else
								pc.hp = pc.hp - 5 ' bad spell casting inflicts damage To caster
								pc.lightningtime = 30
								Exit
							EndIf 
						EndIf 
					Next
					pc.waitcount = 0
				EndIf
				If pc.cat = CAT_CLERIC And pc.stunned &lt;=0
					pc.attacktime = 30
					damage = pc.damage * (pc.waitcount + 1)
					For a:creature = EachIn list_objects
						If a.cat &lt; 100 And a.hp &lt; a.fullhp And a.hp &gt; 0 Then 
							a.hp = a.hp + damage
							a.healingtime = 60
							If a.hp &gt; a.fullhp Then a.hp = a.fullhp
						EndIf 
					Next
					pc.waitcount = 0
				EndIf	
			EndIf 
		EndIf 
	Next
EndIf 
If acted
	'perform poison
	For pc:creature = EachIn list_objects
		If pc.hp &gt; 0 And pc.poison &gt; 0 And pc.cat &lt; 100 Then 
			pc.hp = pc.hp - pc.poison
			pc.strucktime = 10
			dieroll = Rand(1,1000)
			If dieroll &lt; pc.defenseskill Then 
				pc.poison = 0
			EndIf 
		EndIf 
	Next
	For a:creature = EachIn list_objects
		If a.hp &gt; 0 And a.cat &gt;= 100 Then 
			count = 0
			If a.regenerate And a.hp &lt; a.fullhp Then 
				diff = (a.fullhp - a.hp) / 2
				a.hp = a.hp + diff
			EndIf 
			For pc:creature = EachIn list_objects
				If pc.cat &lt; 100 And pc.hp &gt; 0 Then count = count + 1
			Next
			If count &gt; 0 Then 
				count = Rand(1,count)
				For pc:creature = EachIn list_objects
					If pc.cat &lt; 100 And pc.hp &gt; 0 Then count = count - 1
					If count = 0 Then 
						dieroll = Rand(1,1000)
						If a.cat = 103 Then 'goblin shaman
							If dieroll &lt; a.skill Then 
								pc.hp = pc.hp - a.damage
								pc.strucktime = 10
								a.attacktime = 30
								pc.lightningtime = 30
							EndIf
						ElseIf a.cat = 106 Then 'spider wizard
							If dieroll &lt; a.skill Then 
								pc.stunned = Rand(1,2)
								dieroll2 = Rand(1,1000)
								If dieroll2 &gt; pc.defenseskill Then 
									pc.hp = pc.hp - a.damage
									pc.strucktime = 10
									a.attacktime = 30
								EndIf
								Exit
							EndIf 
						ElseIf a.cat = 107 Then 'spider queen
							If dieroll &lt; a.skill Then 
								For c:creature = EachIn list_objects
									If c.cat &gt;= 100 And c.hp &gt; 0 And c.hp &lt; c.fullhp
										c.healingtime = 60
										c.hp = c.hp + a.damage
										Exit 
									EndIf 
								Next
								dieroll2 = Rand(1,1000)
								If dieroll2 &gt; pc.defenseskill Then 
									pc.hp = pc.hp - a.damage
									pc.strucktime = 10
									a.attacktime = 30
								EndIf
								If pc.cat = CAT_WIZARD Or pc.cat = CAT_CLERIC
									pc.waitcount = 0
									Exit 
								EndIf
							EndIf 
							If dieroll &gt; pc.defenseskill Then 
								pc.hp = pc.hp - a.damage
								pc.strucktime = 10
								a.attacktime = 30
							EndIf
							Exit
						Else
							If dieroll &gt; pc.defenseskill Then 
								pc.hp = pc.hp - a.damage
								pc.strucktime = 10
								a.attacktime = 30
								If a.poison &gt; 0 Then 
									pc.poison = a.poison
								EndIf 
							EndIf
							Exit
						EndIf  
					EndIf 
				Next
				
			EndIf 
		EndIf 
	Next
EndIf
End Function

Function updategame()
'move all creatures
'move all bullets
'handle all collisions
'handle all pick ups
'handle all combat
'handle all spell casting (magic missiles And healing)

found = False

For pc:creature = EachIn list_objects
	If pc.strucktime &gt; 0 Then 
		pc.strucktime = pc.strucktime - 1
		createbloodparticle(pc.x,pc.y)
		If pc.hp &lt;= 0 Then 
			createbloodparticle(pc.x,pc.y)
			createbloodparticle(pc.x,pc.y)
			createbloodparticle(pc.x,pc.y)
		EndIf 
	EndIf 
	If pc.hp&gt;0 Then 
		If pc.cat &gt;= 100 Then 
			found = True
		EndIf
	Else
		ListRemove( list_objects, pc)
	EndIf 
Next
If found = False Then 
	levelfinishtime = levelfinishtime + 1
EndIf 
foundp = False
For pc:creature = EachIn list_objects
	If pc.hp &gt; 0 And pc.cat &lt; 100 Then 
	foundp = True
	Exit 
	EndIf
Next
If foundp = False Then 
	levelfinishtime = levelfinishtime + 1
EndIf 
If levelfinishtime &gt; 250 Then 
	gamemode = MODE_MENU 'eventually change To mode_upgrade
	If foundp Then gamemode = MODE_UPGRADE
	gamelevel = gamelevel + 1
	ftrpicked = False
	clrpicked = False
	rngpicked = False
	wizpicked = False 
EndIf 

For pc:creature = EachIn list_objects
	If pc.hp &gt; 0 Then 
		If pc.healingtime &gt; 0 Then pc.healingtime = pc.healingtime - 1
	EndIf 
Next
updateparticle()
End Function

Function drawgame()
'draw background (fixed static 1280x720 image background)
'draw all creatures - don't worry about zordering them - it will be too fast to notice 
'draw all bullets
For img:images = EachIn list_objects
	If img.cat = 2001 'change this later
		DrawImage img.img,0,0
	EndIf
Next
For pc:creature = EachIn list_objects
	If pc.hp &gt; 0 Then
		aa# = 0
		bb# = 0
		If pc.attacktime &gt; 0 Then 
			pc.attacktime = pc.attacktime - 1
			aa# = -25.0 * Sin(pc.attacktime * 6)
			If pc.cat&gt;=100 Then aa = aa * -1.0
		EndIf 
		If pc.strucktime &gt; 0 Then 
			bb = Rand(-pc.strucktime/2,pc.strucktime/2)
		EndIf 
		If pc.poison &gt; 0 And pc.cat &lt; 100 Then 
			SetColor 32,255,32
			DrawOval pc.x - ImageWidth(pc.img)/2,pc.y-40,ImageWidth(pc.img),80',1
			SetColor 255,255,255'reseting the draw color for BMax -Rooster
		EndIf 
		SetColor 255,255,255'reseting the draw color for BMax -Rooster
		DrawImage pc.img,bb + pc.x - ImageWidth(pc.img)/2,pc.y - 40 + aa
		dhp = 10 * pc.hp / pc.fullhp
		If dhp &lt; 4 Then SetColor 255,32,32
		If dhp &gt;=4 And dhp&lt;8 Then SetColor 255,255,32
		If dhp &gt;=8 Then SetColor 32,255,32
		If dhp = 0 Then dhp = 1
		For hp = 1 To dhp
			DrawRect hp*4 + pc.x - ImageWidth(pc.img)/3,pc.y - 50,3,3',1
		Next
		SetColor 255,255,255'reseting the draw color for BMax -Rooster
		If pc.healingtime &gt; 0 Then 
			createhealparticle(pc.x,pc.y)
		EndIf 
		SetColor 255,255,255'reseting the draw color for BMax -Rooster
		If pc.lightningtime &gt; 0 Then 
			pc.lightningtime = pc.lightningtime - 1
			drawlightning(pc.x,pc.y)
		EndIf 
		SetColor 255,255,255'reseting the draw color for BMax -Rooster
		If pc.waitcount &gt; 0 Then 
			SetColor 255,32,255
			For i = 1 To pc.waitcount
				DrawRect i * 4 + pc.x - ImageWidth(pc.img)/3,pc.y - 55,3,3',1
			Next
			SetColor 255,255,255'reseting the draw color for BMax -Rooster
		EndIf 
		If pc.stunned &gt; 0 And pc.cat &lt; 100 Then 
			SetColor 255,255,32
			drawOvate pc.x - ImageWidth(pc.img)/2,pc.y-40,ImageWidth(pc.img),80',0
		EndIf 
		SetColor 255,255,255'reseting the draw color for BMax -Rooster
	EndIf
Next
SetColor 255,255,255'reseting the draw color for BMax -Rooster
drawparticle()
SetColor 255,255,255
For img:images = EachIn list_objects
	If img.cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img.img,mx,my
	EndIf
Next

SetColor 255,255,255'reseting the draw color for BMax -Rooster
End Function 

Function drawlightning(x,y)

iy = 0
ix = x + Rand(-20,20)
While iy &lt; y
oy = iy
ox = ix
ix = x + Rand(-20,20)
iy = iy + Rand(10,25)
SetColor 200,200,255
DrawLine ox,oy,ix,iy
SetColor 150,150,200
DrawLine ox+1,oy+1,ix+1,iy+1
DrawLine ox-1,oy-1,ix-1,iy-1
SetColor 100,100,150
DrawLine ox+2,oy+2,ix+2,iy+2
DrawLine ox-2,oy-2,ix-2,iy-2
SetColor 32,32,90
DrawLine ox+3,oy+3,ix+3,iy+3
DrawLine ox-3,oy-3,ix-3,iy-3

Wend 

End Function 

Function handlecutscene()
'handle transitions,  handle skip button' 
'handle fading in And out text (bitmap fonts?)

If lmb&lt;&gt;0 And olmb = 0 Then 
	If mx&gt;1000 And mx&lt;1200 And my&gt;600 And my&lt;650 Then 
		initlevel()
		gamemode = MODE_COMBAT
	EndIf 
EndIf 

End Function 

Function drawcutscene()
'draw cut scene background, draw transition, draw skip button
For img:images = EachIn list_objects
	If img.cat = 2003 Then 
		DrawImage img.img,0,0
	EndIf 
Next

count = 0
If MilliSecs()&gt;mapdelay Then 
	mapdelay = MilliSecs()+400
	mapindex = mapindex + 1
	For m:mappos = EachIn list_objects
		If m.index &gt; gamelevel Then Exit
		count = count + 1
		If m.index = gamelevel Then 
			If mapindex &gt; count Then mapindex = count
			Exit
		EndIf 	
	Next
EndIf 
count = 0
For m:mappos = EachIn list_objects
	If m.index &gt; gamelevel Then Exit
	If m.index=0 Then 
		SetColor 32,12,12
	Else
		SetColor 192,32,32
	EndIf 
	count = count + 1
	If count &lt;= mapindex Then DrawOval m.x,m.y,16,16',1
Next
SetColor 255,255,255'reseting the draw color for BMax -Rooster

For img:images = EachIn list_objects
	If img.cat = CAT_MENU_SKIP_CUTSCENE
		DrawImage img.img,1000,600
	EndIf
Next

For img:images = EachIn list_objects
	If img.cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img.img,mx,my
	EndIf
Next

End Function 

Function handleupgrade()
'handle button press 'add stuff' to characters
'
'
'
If lmb&lt;&gt;0 And olmb = 0Then 
	If mx &gt; 1000 And mx&lt;1200 And my&gt;600 And my &lt;650
		gamemode = MODE_CUTSCENE
		FlushMouse()
	EndIf
	i = -1
	For pc:creature = EachIn list_objects
	If pc.cat &lt; 100 And pc.hp &gt; 0 Then 
		i = i + 1
		y = 100 * i + 200
		DrawImage pc.img,100,y
		If pc.cat = CAT_FIGHTER And (Not ftrpicked)
			If mx&gt;200 And mx &lt; 400 And my &gt; y And my &lt; y + 50 Then 
				'health picked
				ftrpicked = True
				pc.fullhp = pc.fullhp + 10
			EndIf 
			If mx&gt;450 And mx &lt; 650 And my &gt; y And my &lt; y + 50 Then 
				'damage picked
				ftrpicked = True
				pc.damage = pc.damage + 4
			EndIf 
			
			If mx&gt;700 And mx &lt; 900 And my &gt; y And my &lt; y + 50 Then 
				'skill picked
				ftrpicked = True
				ds# = (1000 - pc.skill) * 0.95
				pc.skill = 1000 - ds
			EndIf 
			
			If mx&gt;950 And mx &lt; 1150 And my &gt; y And my &lt; y + 50 Then 
				'def picked
				ftrpicked = True
				ds# = (1000 - pc.defenseskill) * 0.95
				pc.defenseskill = 1000 - ds
			EndIf 
		EndIf
		If pc.cat = CAT_RANGER And (Not rngpicked)
			If mx&gt;200 And mx &lt; 400 And my &gt; y And my &lt; y + 50 Then 
				'health picked
				rngpicked = True
				pc.fullhp = pc.fullhp + 10
			EndIf 
			If mx&gt;450 And mx &lt; 650 And my &gt; y And my &lt; y + 50 Then 
				'damage picked
				rngpicked = True
				pc.damage = pc.damage + 4
			EndIf 
			
			If mx&gt;700 And mx &lt; 900 And my &gt; y And my &lt; y + 50 Then 
				'skill picked
				rngpicked = True
				ds# = (1000 - pc.skill) * 0.95
				pc.skill = 1000 - ds
			EndIf 
			
			If mx&gt;950 And mx &lt; 1150 And my &gt; y And my &lt; y + 50 Then 
				'def picked
				rngpicked = True
				ds# = (1000 - pc.defenseskill) * 0.95
				pc.defenseskill = 1000 - ds
			EndIf 
		
		EndIf
		If pc.cat = CAT_WIZARD And (Not wizpicked)
			If mx&gt;200 And mx &lt; 400 And my &gt; y And my &lt; y + 50 Then 
				'health picked
				wizpicked = True
				pc.fullhp = pc.fullhp + 10
			EndIf 
			If mx&gt;450 And mx &lt; 650 And my &gt; y And my &lt; y + 50 Then 
				'damage picked
				wizpicked = True
				pc.damage = pc.damage + 4
			EndIf 
			
			If mx&gt;700 And mx &lt; 900 And my &gt; y And my &lt; y + 50 Then 
				'skill picked
				wizpicked = True
				ds# = (1000 - pc.skill) * 0.95
				pc.skill = 1000 - ds
			EndIf 
			
			If mx&gt;950 And mx &lt; 1150 And my &gt; y And my &lt; y + 50 Then 
				'def picked
				wizpicked = True
				ds# = (1000 - pc.defenseskill) * 0.95
				pc.defenseskill = 1000 - ds
			EndIf 

		EndIf
		If pc.cat = CAT_CLERIC And (Not clrpicked)
			If mx&gt;200 And mx &lt; 400 And my &gt; y And my &lt; y + 50 Then 
				'health picked
				clrpicked = True
				pc.fullhp = pc.fullhp + 10
			EndIf 
			If mx&gt;450 And mx &lt; 650 And my &gt; y And my &lt; y + 50 Then 
				'damage picked
				clrpicked = True
				pc.damage = pc.damage + 4
			EndIf 
			If mx&gt;700 And mx &lt; 900 And my &gt; y And my &lt; y + 50 Then 
				'skill picked
				clrpicked = True
				ds# = (1000 - pc.skill) * 0.95
				pc.skill = 1000 - ds
			EndIf 
			If mx&gt;950 And mx &lt; 1150 And my &gt; y And my &lt; y + 50 Then 
				'def picked
				clrpicked = True
				ds# = (1000 - pc.defenseskill) * 0.95
				pc.defenseskill = 1000 - ds
			EndIf 
		EndIf 
	EndIf 
Next


	
EndIf


End Function

Function drawupgrade()
'draw background
'draw buttons
'draw characters
'draw stats
'draw Continue button
For img:images = EachIn list_objects
	If img.cat = 2000 Then 
	'	DrawBlock img.img,0,0
	EndIf 
Next

i=-1
For pc:creature = EachIn list_objects
	If pc.cat &lt; 100 And pc.hp &gt; 0 Then 
		pc.hp = pc.fullhp
		i = i + 1
		y = 100 * i + 200
		DrawImage pc.img,100,y
	'	Text 150,i*100+200,"Skill:"+pc.skill+" Defense:"+pc.defenseskill + " Health:"+pc.fullhp + " Power:"+pc.damage
		If pc.cat = CAT_FIGHTER And (Not ftrpicked)
			For img:images = EachIn list_objects
				If img.cat = CAT_MENU_ADD_HEALTH Then
					DrawImage img.img,200,y
					DrawText pc.fullhp,300,y + 65
				EndIf
				If img.cat = CAT_MENU_ADD_DAMAGE Then
					DrawImage img.img,450,y
					DrawText pc.damage,550,y + 65
				EndIf
				If img.cat = CAT_MENU_ADD_SKILL Then
					DrawImage img.img,700,y
					DrawText pc.skill,800,y + 65
				EndIf
				If img.cat = CAT_MENU_ADD_DEF Then 
					DrawImage img.img,950,y
					DrawText pc.defenseskill,1050,y + 65
				EndIf 
			Next
		EndIf
		If pc.cat = CAT_RANGER And (Not rngpicked)
			For img:images = EachIn list_objects
				If img.cat = CAT_MENU_ADD_HEALTH Then
					DrawImage img.img,200,y
					DrawText pc.fullhp,300,y + 65
				EndIf
				If img.cat = CAT_MENU_ADD_DAMAGE Then
					DrawImage img.img,450,y
					DrawText pc.damage,550,y + 65
				EndIf
				If img.cat = CAT_MENU_ADD_SKILL Then
					DrawImage img.img,700,y
					DrawText pc.skill,800,y + 65
				EndIf
				If img.cat = CAT_MENU_ADD_DEF Then 
					DrawImage img.img,950,y
					DrawText pc.defenseskill,1050,y + 65
				EndIf 
			Next
		
		EndIf
		If pc.cat = CAT_WIZARD And (Not wizpicked)
			For img:images = EachIn list_objects
				If img.cat = CAT_MENU_ADD_HEALTH Then
					DrawImage img.img,200,y
					DrawText pc.fullhp,300,y + 65
				EndIf
				If img.cat = CAT_MENU_ADD_DAMAGE Then
					DrawImage img.img,450,y
					DrawText pc.damage,550,y + 65
				EndIf
				If img.cat = CAT_MENU_ADD_SKILL Then
					DrawImage img.img,700,y
					DrawText pc.skill,800,y + 65
				EndIf
				If img.cat = CAT_MENU_ADD_DEF Then 
					DrawImage img.img,950,y
					DrawText pc.defenseskill,1050,y + 65
				EndIf 
			Next
		
		EndIf
		If pc.cat = CAT_CLERIC And (Not clrpicked)
			For img:images = EachIn list_objects
				If img.cat = CAT_MENU_ADD_HEALTH Then
					DrawImage img.img,200,y
					DrawText pc.fullhp,300,y + 65
				EndIf
				If img.cat = CAT_MENU_ADD_DAMAGE Then
					DrawImage img.img,450,y
					DrawText pc.damage,550,y + 65
				EndIf
				If img.cat = CAT_MENU_ADD_SKILL Then
					DrawImage img.img,700,y
					DrawText pc.skill,800,y + 65
				EndIf
				If img.cat = CAT_MENU_ADD_DEF Then 
					DrawImage img.img,950,y
					DrawText pc.defenseskill,1050,y + 65
				EndIf 
			Next
		
		EndIf 
	EndIf 
Next


For img:images = EachIn list_objects
	If img.cat = CAT_MENU_SKIP_CUTSCENE
		DrawImage img.img,1000,600
	EndIf
Next

DrawText "On this screen you would upgrade some of your characters",0,0

For img:images = EachIn list_objects
	If img.cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img.img,mx,my
	EndIf
Next




End Function 

Function initstartgame()
gamelevel = 1
mapindex = 0

For pc:creature = EachIn list_objects
  ListRemove( list_objects,pc)
Next
pc:creature = New creature
pc.fullhp = 90
pc.hp = 90
pc.cat = CAT_FIGHTER
pc.x = 600
pc.y = 300
pc.tx = pc.x
pc.ty = pc.y
pc.skill = 100
pc.defenseskill = 850
pc.damage = 10
pc.speed = 4.0
For img:images = EachIn list_objects
	If img.cat = CAT_FIGHTER Then 
		pc.img = img.img
		Exit 
	EndIf 
Next
list_objects.AddLast pc

pc:creature = New creature
pc.fullhp = 75
pc.hp = 75
pc.cat = CAT_RANGER
pc.x = 640
pc.y = 300
pc.tx = pc.x
pc.ty = pc.y
pc.skill = 800
pc.defenseskill = 850
pc.damage = 50
pc.speed = 5.0
For img:images = EachIn list_objects
	If img.cat = CAT_RANGER Then 
		pc.img = img.img
		Exit 
	EndIf 
Next
list_objects.AddLast pc

pc:creature = New creature
pc.fullhp = 45
pc.hp = 45
pc.cat = CAT_WIZARD
pc.x = 750
pc.y = 360
pc.tx = pc.x
pc.ty = pc.y
pc.skill = 650
pc.damage = 18
pc.speed = 5.0
pc.defenseskill = 500
For img:images = EachIn list_objects
	If img.cat = CAT_WIZARD Then 
		pc.img = img.img
		Exit 
	EndIf 
Next
list_objects.AddLast pc

pc:creature = New creature
pc.fullhp = 60
pc.hp = 60
pc.cat = CAT_CLERIC
pc.x = 640
pc.defenseskill = 800
pc.y = 350
pc.tx = pc.x
pc.ty = pc.y
pc.skill = 100
pc.damage = 5
pc.speed = 4.0
For img:images = EachIn list_objects
	If img.cat = CAT_CLERIC Then 
		pc.img = img.img
		Exit 
	EndIf 
Next
list_objects.AddLast pc

End Function 

Function initlevel()
Local wallmap[SW,SH]
Local blockmap[SW/20,SH/12]
For pc:creature = EachIn list_objects
	If pc.hp &gt; 0 And pc.hp &lt; pc.fullhp Then pc.hp = pc.fullhp
	If pc.cat = CAT_FIGHTER
		pc.x = 300
		pc.y = 400
	EndIf
	If pc.cat = CAT_RANGER
		pc.x = 375
		pc.y = 400
	EndIf
	If pc.cat = CAT_WIZARD
		pc.x = 450
		pc.y = 400
	EndIf
	If pc.cat = CAT_CLERIC
		pc.x = 500
		pc.y = 400
	EndIf
	pc.x = pc.x + 200
	pc.tx = pc.x
	pc.ty = pc.y
	If pc.cat &gt;=100 Then ListRemove( list_objects, pc)
Next

For i = 1 To 8
	pc:creature = New creature
	pc.x = 300 + i * 80'Rand(0,SW)
	pc.y = 200 'Rand(0,SH)
	pc.tx = pc.x
	pc.ty = pc.y
	
	If gamelevel = 1 Then 
	pc.cat = 100+Rand(0,1)
	pc.hp = 70
	pc.fullhp = 50
	pc.speed = 3
	pc.damage = 5
	pc.skill = 80
	EndIf
	If gamelevel = 2 Then 
		'trolls2
		If i = 1 Or i = 8 Then 
			pc.cat = 102
			pc.hp = 200
			pc.regenerate = True
			pc.fullhp = 200
			pc.speed = 3
			pc.damage = 10
			pc.skill = 150
		Else
			pc.cat = 100+Rand(0,1)
			pc.hp = 70
			pc.fullhp = 50
			pc.speed = 3
			pc.damage = 5
			pc.skill = 80
		EndIf 
	EndIf 
	If gamelevel = 3 Then 
		'wizard And troll
		If i = 1 Or i = 8 Then
			pc.cat = 102
			pc.hp = 200
			pc.regenerate = True
			pc.fullhp = 200
			pc.speed = 3
			pc.damage = 10
			pc.skill = 150
		ElseIf i = 4 Then
			pc.cat = 103
			pc.hp = 100
			pc.fullhp = 100
			pc.speed = 3
			pc.damage = 5
			pc.skill = 350
		Else
			pc.cat = 100+Rand(0,1)
			pc.hp = 70
			pc.fullhp = 50
			pc.speed = 3
			pc.damage = 5
			pc.skill = 80
		EndIf 
	EndIf
	If gamelevel = 4 Then
		'spiderbeasts And giant spiders
		If i = 1 Or i = 8 Then 
			pc.cat = 104
			pc.hp = 150
			pc.poison = 15
			pc.regenerate = True
			pc.fullhp = 150
			pc.speed = 3
			pc.damage = 15
			pc.skill = 100
		Else
			pc.cat = 105
			pc.hp = 100
			pc.fullhp = 100
			pc.speed = 3
			pc.damage = 8
			pc.skill = 150
		EndIf 

	EndIf
	If gamelevel = 5 Then 
		'spiderbeasts, giant spiders And spider wizards
		If i = 1 Or i = 8 Then 
			pc.cat = 104
			pc.hp = 150
			pc.poison = 15
			pc.regenerate = True
			pc.fullhp = 150
			pc.speed = 3
			pc.damage = 15
			pc.skill = 100
		ElseIf i = 2 Or i = 7
			pc.cat = 106
			pc.hp = 100
			pc.fullhp = 100
			pc.speed = 3
			pc.damage = 8
			pc.skill = 300
		Else
			pc.cat = 105
			pc.hp = 100
			pc.fullhp = 100
			pc.speed = 3
			pc.damage = 8
			pc.skill = 150
		EndIf 


	EndIf 
	If gamelevel = 6 Then 
		'spider queens And spiderbeasts
		If i = 1 Or i = 8 Then 
			pc.cat = 107
			pc.hp = 100
			pc.fullhp = 100
			pc.speed = 3
			pc.damage = 5
			pc.skill = 450
		Else
			pc.cat = 105
			pc.hp = 100
			pc.fullhp = 100
			pc.speed = 3
			pc.damage = 8
			pc.skill = 150
		EndIf 
	EndIf 
	If gamelevel = 7 Then 
		'spider queens And giant spiders And spider wizards
		If i = 4 Or i = 5 Then 
			pc.cat = 107
			pc.hp = 100
			pc.fullhp = 100
			pc.speed = 3
			pc.damage = 5
			pc.skill = 450
		ElseIf i = 2 Or i = 7
			pc.cat = 106
			pc.hp = 100
			pc.fullhp = 100
			pc.speed = 3
			pc.damage = 8
			pc.skill = 300
		Else
			pc.cat = 104
			pc.hp = 150
			pc.regenerate = True
			pc.poison = 15
			pc.fullhp = 150
			pc.speed = 3
			pc.damage = 15
			pc.skill = 100
		EndIf 
	EndIf 
	For img:images = EachIn list_objects
		If img.cat = pc.cat Then 
			pc.img = img.img
			Exit 
		EndIf 
	Next
	list_objects.AddLast pc
Next

lmb = 0
olmb = 0
FlushMouse()
levelfinishtime = 0
End Function 

Function createhealparticle(x,y)

For i = 1 To 36
	p:particle = New particle
	p.life = 20
	p.x = x + 25.0 * Cos(i*10)
	p.y = y + 20 + 25.0 * (Sin(i*5))
	p.vx = 0
	p.vy = Rand(-4,-2)
	p.ay = 0.1
	p.gy = p.y + 100
	p.r = 32
	p.g = 200
	p.b = 255
	p.sz = 4
	p.dsz = -0.1
	p.dr = 10
	p.dg = 2
	p.db = 0
	list_objects.AddLast p
Next

End Function 

Function createbloodparticle(x,y)

For i = 1 To 10
	p:particle = New particle
	p.life = 20
	p.x = x + Rand(-10,10)
	p.y = y + Rand(-10,10)
	p.vx = Rnd(-3,3)
	p.vy = Rnd(-3,3)
	p.ay = 0.05
	p.gy = y + 42
	p.r = 255
	p.g = 100
	p.b = 100
	p.dr = -2
	p.dg = -3
	p.db = -3
	p.sz = 4
	p.dsz = 0
	list_objects.AddLast p
Next

End Function 

Function updateparticle()
For p:particle = EachIn list_objects
	p.life = p.life - 1
	p.x = p.x + p.vx
	p.y = p.y + p.vy
	p.vy = p.vy + p.ay
	If p.y &gt; p.gy Then 
		p.vy = p.vy * -0.7
		If Abs(p.vy)&lt;0.01 Then p.life = 0
	EndIf 
	p.sz = p.sz + p.dsz
	p.r = p.r + p.dr
	p.g = p.g + p.dg
	p.b = p.b + p.db
	If p.sz &lt; 0 Then p.sz = 0
	If p.r &gt; 255 Then p.r = 255
	If p.g &gt; 255 Then p.g = 255
	If p.b &gt; 255 Then p.b = 255
	If p.r &lt; 0 Then p.r = 0
	If p.g &lt; 0 Then p.g = 0
	If p.b &lt; 0 Then p.b = 0
	If p.life &lt; 0 Then ListRemove( list_objects, p)
Next
End Function 

Function drawparticle()
For p:particle = EachIn list_objects
	SetColor p.r,p.g,p.b
	DrawRect p.x,p.y,p.sz,p.sz',1
Next
SetColor 255,255,255
End Function 


Function drawOvate( x# , y# , w# , h#) 'found on blitzbasic.com -Rooster
For Local n% = 1 To 360
	Plot( x + w * Cos(n) , y + h * Sin(n) )
Next
End Function
</textarea> <br><br></td></tr></table><br>
<a name="1341305"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#83">[#83]</a></td></tr></table></td></tr><tr ><td class="posttext"> Audio - haven't decided.....still thinking of this....potentially a lot of sound effects could be required...unless make it music only? not sure though...audio hard to get right - the wrong choices can be quite annoying to listen to over and over. But this project is growing and I will likely use .ogg files for sound effects and put a huge number of small sound effects in.<br><br>Map - haven't decided...I'm thinking that I will stick with a linear story line and so I will still use a cutscene style feature with the map rather than a 'select a location' - I think it is in some ways like a puzzle game where the puzzles are the combat and are played one after the other...but I may go the other way and allow free choice...not sure yet..... <br><br></td></tr></table><br>
<a name="1341307"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#84">[#84]</a></td></tr></table></td></tr><tr ><td class="posttext"> Also - I'm still not sure how I'm going to do the backgrounds for the levels...they will be static with maybe a light animation of a flickering flame or something like that perhaps...<br><br>With my art skills not being all that great I'm not sure how I'm going to do it...<br><br>I *could* hand draw them on paper / tablet but I think they will really let the game down if I do it....<br><br>Also - I'm thinking the opening cut scene will be of a king or emperor or someone giving the party of adventurers their quest to rid the land of monsters, and after that will involve the party traveling across the map to do so - hence the map cinematic which is extremely simple.... <br><br></td></tr></table><br>
<a name="1341312"></a>

<a name="1341319"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#85">[#85]</a></td></tr></table></td></tr><tr ><td class="posttext"> Edit - additional:<br><br>change of mind:<br><br>Cinematic cut scene / level intro will not be a map.<br><br>Story will be linear as planned.<br><br>I will use a comic book /graphic novel style format as that allows me to hand paint the cells and have smaller than full screen cells (my art skills can do small images, much much harder to do full screen images)....<br><br>So tonight I will story board with pen and paper the first level's scene....<br><br>Also cut scenes/cinematics won't appear every level, just every change in theme....so about 4 or 5 of them.....<br><br>So furthermore tonight's tasks will be the following;<br><br>1. test beast code works fine with new particle effects (done)<br><br>2. draw undead (done)<br><br>3. draw eye monsters (cthulhu style beasts too) (done)<br><br>4. story board first comic book style page and potentially draw it...<br>(do on paper first then on wacom tablet...doing now)<br><br>I might not get it all done tonight but it is a start... <br><br></td></tr></table><br>
<a name="1341316"></a>

<a name="1341317"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#86">[#86]</a></td></tr></table></td></tr><tr ><td class="posttext"> Graphics (new)<br><br>00111skeleton.png<br><img src="http://www.mattiesgames.com/art/00111skeleton.png"><br><br>00112wraith.png<br><img src="http://www.mattiesgames.com/art/00112wraith.png"><br><br>00113necromancer.png<br><img src="http://www.mattiesgames.com/art/00113necromancer.png"><br><br>00114liche.png<br><img src="http://www.mattiesgames.com/art/00114liche.png"><br><br>00115slug.png<br><img src="http://www.mattiesgames.com/art/00115slug.png"><br><br>00116eye.png<br><img src="http://www.mattiesgames.com/art/00116eye.png"><br><br>00117octo.png<br><img src="http://www.mattiesgames.com/art/00117octo.png"> <br><br></td></tr></table><br>
<a name="1341328"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rooster</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#87">[#87]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey, you did the undead without using any zombies. Nice to see that for a change. <br><br></td></tr></table><br>
<a name="1341357"></a>

<a name="1341358"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#88">[#88]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay......a bit more done...I've put the code and images into a zip file for now.<br><br>I've renamed the image files to fit your convention.<br><br>I've done some drawings for the comic style story appearance - they are consistent in style but are definitely drawn a certain way.....hopefully consistency wins out over pixel perfect quality here!<br><br><a href="http://www.mattiesgames.com/bbgame/game.zip" target="_blank">zip file</a><br><br>I've gone with just 4 themes now...goblins, spiders, beasts and undead...might add more later but for now it is what I've got.<br><br>Here are the comic style panels:<br><br><img src="http://www.mattiesgames.com/bbgame/02004panel1.jpg"><br><br><img src="http://www.mattiesgames.com/bbgame/02005panel1.jpg"><br><br><img src="http://www.mattiesgames.com/bbgame/02006panel1.jpg"><br><br><img src="http://www.mattiesgames.com/bbgame/02008panel1.jpg"><br><br><img src="http://www.mattiesgames.com/bbgame/02009panel1.jpg"> <br><br></td></tr></table><br>
<a name="1341359"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rooster</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#89">[#89]</a></td></tr></table></td></tr><tr ><td class="posttext"> Looks good.<br>The king seems like he would be a fun person. <br><br></td></tr></table><br>
<a name="1341365"></a>

<a name="1341371"></a>

<a name="1341374"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#90">[#90]</a></td></tr></table></td></tr><tr ><td class="posttext"> Updated:<br><br><strike><a href="http://www.mattiesgames.com/bbgame/game2.zip" target="_blank">Link</a></strike><br><br>Fixed some bugs.<br>Fixed some balance issues.<br>Added 'drawnumbers' function to draw numbers (images 10000-10009 category)<br><br>So far I can't get up to the undead stage - I die at the beasts stage..it's getting tough.<br><br>New link:<br><br>Added some more comic style images<br><br><a href="http://www.mattiesgames.com/bbgame/game3.zip" target="_blank">Link Update</a><br><br><br>Edit - and I can now finish the game...just completed it on a single health point remaining on the final level...so that was close!!!<br><br><img src="http://www.mattiesgames.com/bbgame/victory.jpg"> <br><br></td></tr></table><br>
<a name="1341372"></a>

<a name="1341373"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rooster</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#91">[#91]</a></td></tr></table></td></tr><tr ><td class="posttext"> I wish I had know about the option under file called Import bb project, I could have saved myself so much trouble...<br><br>I don't know how to replace the masking code, so any body who uses this port will need to open 00101goblin2.png,<br>and set the background alpha to zero them selves.<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Global particle_list:TList=New TList
Global creature_list:TList=New TList
Global images_list:TList=New TList
'This is both a learning exercise and hopefully a collaborative project of sorts
'or at least a project I can share with others on the blitz forum.
'It will be written initially in blitzplus/blitz3d and maybe someone will be keen on
'porting it to blitzmax...even blitzmax-ng to release on mobile perhaps?
'
'Interface:
'Left mouse button clicking only to make porting to 
'mobile interface much, much easier.
'Gameplay Mechanic Has changed - turn based more detailed
'
'Gameplay mechanic so far (15-May-2017)
'
'1. Arcade Action RPG Combat
'	Player controls 4 characters in a single screen dungeon.
'	Dungeon has a few walls and so on that prevent movement.
'	Monsters spawn from spawners and make their way around the map
'	Player taps the screen to move to location and characters fight things
'	in their path.
'	Powerups exist in the level such as:
'	Health pickups
'	Bombs - kill all monsters that have spawned or at least damage them.
'	
'2. After the arcade sequence the player is presented with options to upgrade their
'	character's stats. Stats to upgrade include:
'	Combat skill ('to hit roll')
'	Damage output ('damage points')
'	Health points ('hp')
'	Movement speed ('move')
'3.	After this a short cut scene is presented which may simply be a scrolling static
'	image with some fading in/fading out text to advance the story line
'0. Menu - toggle audio, play, credits
'
'Character types:
'1 Fighter - high hitpoint melee combat medium damage
'2 Ranger - medium hitpoint melee combat high damage
'3 Wizard - low hitpoint, ranged combat, medium damage
'4 Cleric - medium hitpoint, no combat, healer
'

' virtual key support for legacy Blitz apps

Global VKEY[]=[..
0,KEY_ESCAPE,KEY_1,KEY_2,KEY_3,KEY_4,KEY_5,KEY_6,KEY_7,KEY_8,KEY_9,KEY_0,..
KEY_MINUS,KEY_EQUALS,KEY_BACKSPACE,KEY_TAB,KEY_Q,KEY_W,KEY_E,KEY_R,KEY_T,..
KEY_Y,KEY_U,KEY_I,KEY_O,KEY_P,KEY_OPENBRACKET,KEY_CLOSEBRACKET,KEY_RETURN,..
KEY_LCONTROL,KEY_A,KEY_S,KEY_D,KEY_F,KEY_G,KEY_H,KEY_J,KEY_K,KEY_L,..
KEY_SEMICOLON,KEY_QUOTES,KEY_TILDE,KEY_LSHIFT,KEY_BACKSLASH,..
KEY_Z,KEY_X,KEY_C,KEY_V,KEY_B,KEY_N,KEY_M,KEY_COMMA,KEY_PERIOD,KEY_SLASH,..
KEY_RSHIFT,KEY_NUMMULTIPLY,KEY_ALT,KEY_SPACE,KEY_CAPSLOCK,..
KEY_F1,KEY_F2,KEY_F3,KEY_F4,KEY_F5,KEY_F6,KEY_F7,KEY_F8,KEY_F9,KEY_F10,..
KEY_NUMLOCK,KEY_SCROLL,KEY_NUM7,KEY_NUM8,KEY_NUM9,KEY_NUMSUBTRACT,KEY_NUM4,..
KEY_NUM5,KEY_NUM6,KEY_NUMADD,KEY_NUM1,KEY_NUM2,KEY_NUM3,KEY_NUM0,..
KEY_NUMDECIMAL,KEY_NUMSLASH,KEY_F11,KEY_F12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,..
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,..
KEY_EQUALS,0,0,KEY_MEDIA_PREV_TRACK,0,0,0,0,0,0,0,0,KEY_MEDIA_NEXT_TRACK,0,0,..
KEY_ENTER,KEY_RCONTROL,0,0,KEY_VOLUME_MUTE,0,KEY_MEDIA_PLAY_PAUSE,0,..
KEY_MEDIA_STOP,0,0,0,0,0,0,0,0,0,KEY_VOLUME_DOWN,0,KEY_VOLUME_UP,0,..
KEY_BROWSER_HOME,KEY_DECIMAL,0,KEY_NUMDIVIDE,0,KEY_SCREEN,..
0,0,0,0,0,0,0,0,0,0,0,0,0,KEY_PAUSE,0,KEY_HOME,KEY_UP,KEY_PAGEUP,0,..
KEY_LEFT,0,KEY_RIGHT,0,KEY_END,KEY_DOWN,KEY_PAGEDOWN,KEY_INSERT,KEY_DELETE,..
0,0,0,0,0,0,0,KEY_LWIN,KEY_RWIN,0,0,0,0,0,0,0,0,KEY_BROWSER_SEARCH,..
KEY_BROWSER_FAVORITES,KEY_BROWSER_REFRESH,KEY_BROWSER_STOP,KEY_BROWSER_FORWARD,..
KEY_BROWSER_BACK,0,KEY_LAUNCH_MAIL,KEY_LAUNCH_MEDIA_SELECT]

Function VKeyDown(key);Return KeyDown(VKEY[key]);End Function
Function VKeyHit(key);Return KeyHit(VKEY[key]);End Function

'currently unsupported in BlitzMax

Function Locate( x,y );Return 0;End Function
Function MouseZSpeed();Return 0;End Function
Function FreeBank(bank);Return 0;End Function
Function LoopSound(sound);Return 0;End Function
Function ChannelPitch(channel,hz);Return 0;End Function
Function PlayCDTrack( track,mode=0 );Return 0;End Function
Function SoundVolume( sound,volume# );Return 0;End Function

'constants
Const SW=1280,SH=720,WIN=2
Const MODE_MENU = 0
Const MODE_COMBAT = 1
Const MODE_UPGRADE = 2
Const MODE_CUTSCENE = 3
Const PURE_2D = True 'if go to blitzmax can use 2d-in-3d commands such as alpha otherwise have to calculate manually.Change to false for blitzmax.

'categories for image types and object types
Const CAT_MENU_PLAY = 0
Const CAT_MENU_AUDIO = 1
Const CAT_MENU_SKIP_CUTSCENE = 2 'cut scene mode
Const CAT_MENU_ADD_SKILL = 3 'upgrade mode
Const CAT_MENU_ADD_DAMAGE = 4'upgrade mode
Const CAT_MENU_ADD_HEALTH = 5'upgrade mode
'Const CAT_MENU_ADD_SPEED = 6;
Const CAT_MENU_ADD_DEF = 6
Const CAT_MENU_MOUSE_CURSOR = 7'
Const CAT_FIGHTER = 10
Const CAT_KNIGHT = 10 'synonym
Const CAT_RANGER = 11
Const CAT_WIZARD = 12
Const CAT_CLERIC = 13
Const CAT_HEALER = 13 'synonym
Const CAT_HEALTH_PICKUP = 20
Const CAT_BOMB_PICKUP = 21
'CAT_BACKGROUND = 2000-3000 ; all the different image backgrounds
'CAT_MONSTER = 100-1000 , all the different monster types
'CAT_NUMBERS = 10000-10009


'globals
Global mx,my,lmb,olmb 'mouse input
Global audiostate 'on/off
Global gamemode 'references const above
Global gamelevel 'for cutscenes
Global cutsceneframe 'for cutscenes ie trigger fades, text, motion etc on certain frames
Global levelfinishtime = 0
Global mapdelay 'timestamp
Global mapindex

Global ftrpicked,rngpicked,wizpicked,clrpicked 'boolean for upgrades

' BBType adds legacy Type functionality to BlitzMax Type

Type TBBType

	Field _list:TList
	Field _link:TLink

	Method Add(t:TList)
		_list=t
		_link=_list.AddLast(Self)
	End Method

	Method InsertBefore(t:TBBType)
		_link.Remove
		_link=_list.InsertBeforeLink(Self,t._link)
	End Method

	Method InsertAfter(t:TBBType)
		_link.Remove
		_link=_list.InsertAfterLink(Self,t._link)
	End Method

	Method Remove()
		_list.remove Self
	End Method

End Type

Function DeleteLast(t:TBBType)
	If t TBBType(t._list.Last()).Remove()
End Function

Function DeleteFirst(t:TBBType)
	If t TBBType(t._list.First()).Remove()
End Function

Function DeleteEach(t:TBBType)
	If t t._list.Clear()
End Function

Function ReadString$(in:TStream)
	Local	length
	length=ReadInt(in)
	If length&gt;0 And length&lt;1024*1024 Return brl.stream.ReadString(in,length)
End Function

Function HandleToObject:Object(obj:Object)
	Return obj
End Function

Function HandleFromObject(obj:Object)
	Local h=HandleToObject(obj)
	Return h
End Function




'types
Type bbimages Extends TBBType

	Method New()
		Add(images_list)
	End Method

	Method After:bbimages()
		Local t:TLink
		t=_link.NextLink()
		If t Return bbimages(t.Value())
	End Method

	Method Before:bbimages()
		Local t:TLink
		t=_link.PrevLink()
		If t Return bbimages(t.Value())
	End Method


Field img 'handle
Field midhandled 'boolean
Field cat 'category //hooks into creature template

End Type 




Type bbcreature Extends TBBType

	Method New()
		Add(creature_list)
	End Method

	Method After:bbcreature()
		Local t:TLink
		t=_link.NextLink()
		If t Return bbcreature(t.Value())
	End Method

	Method Before:bbcreature()
		Local t:TLink
		t=_link.PrevLink()
		If t Return bbcreature(t.Value())
	End Method


Field img
Field cat
Field x#
Field y#
Field hp
Field fullhp
Field damage
Field skill

Field defenseskill 'for players

Field aimode
Field aidelay
Field aitime

Field moving 'boolean

Field healingtime 'for healing effect/buff effect
Field lightningtime 'for lightning blasts on creature effect
Field strucktime 'for blood effects
Field attacktime 

Field activated 'boolean
Field waitcount 'int

Field stunned 'int 0-n counts down each time active....
Field poison 'int 0-n = damage inflicted
Field regenerate 'boolean
Field cursed 'int 0-n //50% off defenseskill
Field berserk 'int
Field ethereal 'boolean
Field summonedtime 'int
End Type 


'new emitters and particles
Type bbparticle Extends TBBType

	Method New()
		Add(particle_list)
	End Method

	Method After:bbparticle()
		Local t:TLink
		t=_link.NextLink()
		If t Return bbparticle(t.Value())
	End Method

	Method Before:bbparticle()
		Local t:TLink
		t=_link.PrevLink()
		If t Return bbparticle(t.Value())
	End Method


Field r,g,b,a
Field x#,y#,vx#,vy#,ay#,gy#
Field life
Field dr,dg,db,da
Field sz,dsz

End Type



Main()

Function Main()
	quit = False
	gamemode = MODE_MENU
	init()
	Repeat
		frametime = MilliSecs()
		Cls
		'input 
		mx = MouseX()
		my = MouseY()
		olmb = lmb
		lmb = MouseDown(1)
		Select gamemode
		
		Case MODE_MENU
			handlemenu()
			drawmenu()
		
		Case MODE_COMBAT
			handleinput()
			updategame()
			drawgame()
		Case MODE_CUTSCENE
			handlecutscene()
			drawcutscene()
		Case MODE_UPGRADE
			handleupgrade()
			drawupgrade()
		End Select
		
		Flip
		'very basic frame limiting
		endframetime = MilliSecs()
		dtime = endframetime - frametime
		If dtime &lt; 15 Then 
			Delay 15 - dtime
		EndIf 
		'end of frame limiting
		If(VKeyHit(1)) Then quit = True		
	Until quit
	';;;;;
	End
End Function 

Function init()
Graphics SW,SH,0',WIN
'load data files
'load all images here
'load all sounds here
'load all music here
HideMouse 

img:bbimages = New bbimages
img.img = LoadImage("images\02004panel1.jpg")
img.cat = 2004

img:bbimages = New bbimages
img.img = LoadImage("images\02005panel1.jpg")
img.cat = 2005

img:bbimages = New bbimages
img.img = LoadImage("images\02006panel1.jpg")
img.cat = 2006

img:bbimages = New bbimages
img.img = LoadImage("images\02007bk.jpg")
img.cat = 2007

img:bbimages = New bbimages
img.img = LoadImage("images\02008panel1.jpg")
img.cat = 2008

img:bbimages = New bbimages
img.img = LoadImage("images\02009panel1.jpg")
img.cat = 2009

img:bbimages = New bbimages
img.img = LoadImage("images\00006btndef.png")
img.cat = CAT_MENU_ADD_DEF

img:bbimages = New bbimages
img.img = LoadImage("images\00005btnhp.png")
img.cat = CAT_MENU_ADD_HEALTH

img:bbimages = New bbimages
img.img = LoadImage("images\00004btnpower.png")
img.cat = CAT_MENU_ADD_DAMAGE

img:bbimages = New bbimages
img.img = LoadImage("images\00003btnskill.png")
img.cat = CAT_MENU_ADD_SKILL

img:bbimages = New bbimages
img.img = LoadImage("images\00010knight1.png")
img.cat = CAT_FIGHTER

img:bbimages = New bbimages
img.img = LoadImage("images\00011ranger1.png")
img.cat = CAT_RANGER

img:bbimages = New bbimages
img.img = LoadImage("images\00012wizard1.png")
img.cat = CAT_WIZARD

img:bbimages = New bbimages
img.img = LoadImage("images\00013cleric1.png")
img.cat = CAT_CLERIC

img:bbimages = New bbimages
img.img = LoadImage("images\00100goblin1.png")
img.cat = 100 'goblin 1

img:bbimages = New bbimages
img.img = LoadImage("images\00101goblin2.png")
img.cat = 101 'goblin 2

img:bbimages = New bbimages
img.img = LoadImage("images\00102troll1.png")
img.cat = 102 'troll 1

img:bbimages = New bbimages
img.img = LoadImage("images\00103goblinshaman1.png")
img.cat = 103 'goblin shaman

img:bbimages = New bbimages
img.img = LoadImage("images\00104giantspider1.png")
img.cat = 104 'giant spider melee brute...

img:bbimages = New bbimages
img.img = LoadImage("images\00105spiderbeast1.png")
img.cat = 105 'spider beast

img:bbimages = New bbimages
img.img = LoadImage("images\00106spiderwizard1.png")
img.cat = 106 'spider wizard - stuns enemy units (reduces skill)

img:bbimages = New bbimages
img.img = LoadImage("images\00107spiderqueen1.png")
img.cat = 107 'spider queen - stuns spell casters (reduces waitcount) and melee unit and heals friendlies

img:bbimages = New bbimages
img.img = LoadImage("images\00108beastcentaur.png")
img.cat = 108 'berseker low damage, multi attacks, high hitpoints

img:bbimages = New bbimages
img.img = LoadImage("images\00109beastwarrior.png")
img.cat = 109 'grunt - high damage, low hitpoints

img:bbimages = New bbimages
img.img = LoadImage("images\00110minotaurshaman.png")
img.cat = 110 'mage lightning, curse enemies defensive skill

img:bbimages = New bbimages
img.img = LoadImage("images\00111skeleton.png")
img.cat = 111

img:bbimages = New bbimages
img.img = LoadImage("images\00112wraith.png")
img.cat = 112

img:bbimages = New bbimages
img.img =  LoadImage("images\00113necromancer.png")
img.cat = 113

img:bbimages = New bbimages
img.img =  LoadImage("images\00114liche.png")
img.cat = 114

img:bbimages = New bbimages
img.img =  LoadImage("images\00115slug.png")
img.cat = 115

img:bbimages = New bbimages
img.img =  LoadImage("images\00116eye.png")
img.cat = 116

img:bbimages = New bbimages
img.img =  LoadImage("images\00117octo.png")
img.cat = 117

img:bbimages = New bbimages
img.img =  LoadImage("images\00118web.png")
img.cat = 118

img:bbimages = New bbimages
img.img =  LoadImage("images\00119poison.png")
img.cat = 119

img:bbimages = New bbimages
img.img = LoadImage("images\00000btnplay.png")
img.cat = CAT_MENU_PLAY

img:bbimages = New bbimages
img.img = LoadImage("images\00001btnaudio.png")
img.cat = CAT_MENU_AUDIO

img:bbimages = New bbimages
img.img = LoadImage("images\00007cursor.png")
img.cat = CAT_MENU_MOUSE_CURSOR

img:bbimages = New bbimages
img.img = LoadImage("images\00002btnskip.png")
img.cat = CAT_MENU_SKIP_CUTSCENE

For i = 10000 To 10009
	img:bbimages = New bbimages
	img.img = LoadImage("images\"+i+".png")
	img.cat = i
Next

'we don't have backgrounds yet so create them on the fly for now
img:bbimages = New bbimages
img.img = CreateImage(SW,SH)
LockImage( img.img,0,0) 'more stuff needed for BMax to draw to image -Rooster
For i = 1 To 100
	SetColor 100,100,100
	DrawOval Rand(SW),Rand(SH),100,100',1
Next

GrabImage img.img,0,0 'more stuff needed for BMax to draw to image -Rooster
UnlockImage (img.img)
img.cat = 2000
SetColor 255,255,255

'For img:bbimages = EachIn images_list
'	If img.img&lt;&gt;0 Then 
'		rgb = dev.blitz3d.ReadPixel(0,0,ImageBuffer(img.img))
'		r = (rgb Shr 16) &amp; 255
'		g = (rgb Shr 8) &amp; 255
'		b = rgb &amp; 255
'		MaskImage img.img,r,g,b
'	EndIf 
'Next

End Function 

Function handlemenu()
';;
';;;
';;Check if 'PLAY' pressed..if so then initialise
'first cut scene and change gamemode
';;Check if 'TOGGLE AUDIO' pressed if so toggle music/audio flags

If lmb&lt;&gt;0 Then 
	If mx&gt;=1000 And mx&lt;=1200 Then 
		If my&gt;500 And my&lt;550 Then 
			'play hit
			initstartgame()
			gamemode = MODE_CUTSCENE
		EndIf 
		If my&gt;600 And my&lt;650 Then 
			audiostate = Not audiostate
			If Not audiostate
				'stop music
					
			EndIf 
		EndIf 
	EndIf 
EndIf 


End Function

Function drawmenu()
'draw backdrop
'draw buttons in relevant state
'draw mouse cursor

For img:bbimages = EachIn images_list
	If img.cat = 2000 Then 
		DrawImage img.img,0,0
	EndIf 
Next

For img:bbimages = EachIn images_list
	If img.cat = CAT_MENU_PLAY
		DrawImage img.img,1000,500
	EndIf
	If img.cat = CAT_MENU_AUDIO
		DrawImage img.img,1000,600
	EndIf
Next

For img:bbimages = EachIn images_list
	If img.cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img.img,mx,my
	EndIf
Next

End Function

Function handleinput()
'assign tx,ty of creatures to player units
'
acted = False
If lmb&lt;&gt;0 And olmb = 0 Then 
	For pc:bbcreature = EachIn creature_list
		If pc.hp&gt;0 And pc.cat&gt;=10 And pc.cat&lt;=13 Then 
			If mx&gt;pc.x - ImageWidth(pc.img)/2 And mx&lt;pc.x + ImageWidth(pc.img)/2 And my&gt;pc.y-40 And my&lt;pc.y+40 Then 
				For a:bbcreature = EachIn creature_list
					If a.hp&gt;0 And a.cat&lt;100 Then a.waitcount = a.waitcount + 1
					If a.waitcount &gt; 3 Then a.waitcount = 3
					If a.stunned &gt; 0 Then 
						a.stunned = a.stunned - 1
					EndIf 
				Next
				acted = True
				If pc.cat = CAT_FIGHTER And pc.stunned &lt;=0
					pc.attacktime = 30
					For a:bbcreature = EachIn creature_list
						If a.cat &gt;= 100 And a.hp &gt; 0 Then 
							dieroll = Rand(1,1000)
							If dieroll &lt; pc.skill Then 
								If a.ethereal Then 'reduced damage to ethereals.
								a.hp = a.hp - pc.damage/3
								Else
									a.hp = a.hp - pc.damage
								EndIf
								a.strucktime = 10
								'centaur goes berserk
								If a.cat = 108 Then a.berserk = 3
							EndIf 
						EndIf 
					Next
					pc.waitcount = 0
				EndIf
				If pc.cat = CAT_RANGER And pc.stunned &lt;=0
					maxhp = 0
					b:bbcreature = Null'
					pc.attacktime = 30
					For a:bbcreature = EachIn creature_list
						If a.cat &gt;= 100 And a.hp &gt; 0 Then 
							If a.hp &gt; maxhp Then 
								maxhp = a.hp
								b:bbcreature = a:bbcreature
							EndIf 
						EndIf 
					Next
					If b:bbcreature&lt;&gt;Null Then 
						dieroll = Rand(1,1000)
						If dieroll &lt; pc.skill Then 
							If b.ethereal Then 'reduced damage to ethereals
								b.hp = b.hp - pc.damage * (1 + pc.waitcount)/3
							Else
								b.hp = b.hp - pc.damage * (1 + pc.waitcount)
							EndIf 
							b.strucktime = 15
							If b.cat = 108 Then b.berserk = 3
						EndIf 
					EndIf 
					pc.waitcount = 0
				EndIf
				If pc.cat = CAT_WIZARD And pc.stunned&lt;=0
					pc.attacktime = 30
					damage = pc.damage * (pc.waitcount+1)
					For a:bbcreature = EachIn creature_list
						If a.cat &gt;= 100 And a.hp &gt; 0 Then 
							dieroll = Rand(1,1000)
							If dieroll &lt; pc.skill Then 
								a.hp = a.hp - damage
								If a.ethereal Then 
									a.hp = a.hp - damage 'extra damage to ethereals
								EndIf 
								a.lightningtime = 30
								a.strucktime = 20
								If a.cat = 108 Then a.berserk = 3
							Else
								pc.hp = pc.hp - 5 ' bad spell casting inflicts damage to caster
								pc.lightningtime = 30
								Exit
							EndIf 
						EndIf 
					Next
					pc.waitcount = 0
				EndIf
				If pc.cat = CAT_CLERIC And pc.stunned &lt;=0
					pc.attacktime = 30
					damage = pc.damage * (pc.waitcount + 1)
					For a:bbcreature = EachIn creature_list
						If a.cat &lt; 100 And a.hp &lt; a.fullhp And a.hp &gt; 0 Then 
							a.hp = a.hp + damage
							a.healingtime = 60
							If a.hp &gt; a.fullhp Then a.hp = a.fullhp
						EndIf 
					Next
					pc.waitcount = 0
				EndIf	
			EndIf 
		EndIf 
	Next
EndIf 
If acted
	'perform poison
	For pc:bbcreature = EachIn creature_list
		If pc.hp &gt; 0 And pc.poison &gt; 0 And pc.cat &lt; 100 Then 
			pc.hp = pc.hp - pc.poison
			pc.strucktime = 10
			dieroll = Rand(1,1000)
			If dieroll &lt; pc.defenseskill Then 
				pc.poison = 0
			EndIf 
		EndIf 
		If pc.hp &gt; 0 And pc.cat &lt; 100 And pc.cursed &gt; 0 Then 
			pc.cursed = pc.cursed - 1
		EndIf 
	Next
	For a:bbcreature = EachIn creature_list
		If a.hp &gt; 0 And a.cat &gt;= 100 Then 
			If a.cat = 113 Or a.cat = 114 'necromancer summons skeletons and liche, liche and skeleton also make skeletons go berserk
				For b:bbcreature = EachIn creature_list
					If b.hp&gt;0 And b.cat = 111 Then 
						dieroll = Rand(1,1000)
						If dieroll &lt; a.skill Then 
							b.berserk = b.berserk + Rand(0,2)
						EndIf
					EndIf 
					If a.cat = 114 Then 
						If b.hp &gt; 0 And b.hp &lt; b.fullhp And b.cat = 111 Then 
							dieroll = Rand(1,1000)
							If dieroll &lt; a.skill Then 
								b.hp = b.hp + 5
								b.healingtime = 60
							EndIf 
						EndIf
						If b.cat &lt; 100 And b.hp &gt; 0 Then 
							dieroll = Rand(1,1000)
							If dieroll &lt; a.skill Then 
								b.cursed = b.cursed + Rand(0,2)
							EndIf 
						EndIf 
					EndIf  
					If b.hp&lt;=0 And b.cat &gt;= 100 Then 
						dieroll = Rand(1,1000)
						If dieroll &lt; a.skill Then 
							createskeleton(b:bbcreature)
						EndIf 
					EndIf
				Next
			EndIf 
			count = 0
			If a.regenerate And a.hp &lt; a.fullhp Then 
				diff = (a.fullhp - a.hp) / 2
				a.hp = a.hp + diff
			EndIf 
			For pc:bbcreature = EachIn creature_list
				If pc.cat &lt; 100 And pc.hp &gt; 0 Then count = count + 1
			Next
			If count &gt; 0 Then 
				count = Rand(1,count)
				For pc:bbcreature = EachIn creature_list
					If pc.cat &lt; 100 And pc.hp &gt; 0 Then count = count - 1
					If count = 0 Then 
						dieroll = Rand(1,1000)
						If a.cat = 103 Then 'goblin shaman
							If dieroll &lt; a.skill Then 
								pc.hp = pc.hp - a.damage
								pc.strucktime = 10
								a.attacktime = 30
								pc.lightningtime = 30
							EndIf
						ElseIf a.cat = 106 Then 'spider wizard
							If dieroll &lt; a.skill Then 
								pc.stunned = Rand(1,2)
								dieroll2 = Rand(1,1000)
								If dieroll2 &gt; pc.defenseskill Then 
									pc.hp = pc.hp - a.damage
									pc.strucktime = 10
									a.attacktime = 30
								EndIf
								Exit
							EndIf 
						ElseIf a.cat = 107 Then 'spider queen
							If dieroll &lt; a.skill Then 
								For c:bbcreature = EachIn creature_list
									If c.cat &gt;= 100 And c.hp &gt; 0 And c.hp &lt; c.fullhp
										c.healingtime = 60
										c.hp = c.hp + a.damage
										Exit 
									EndIf 
								Next
								dieroll2 = Rand(1,1000)
								If pc.cursed Then dieroll2 = dieroll2 * 1.5
								If dieroll2 &gt; pc.defenseskill Then 
									pc.hp = pc.hp - a.damage
									pc.strucktime = 10
									a.attacktime = 30
								EndIf
								If pc.cat = CAT_WIZARD Or pc.cat = CAT_CLERIC
									pc.waitcount = 0
									Exit 
								EndIf
							EndIf 
							If pc.cursed Then dieroll = dieroll * 1.5
							If dieroll &gt; pc.defenseskill Then 
								pc.hp = pc.hp - a.damage
								pc.strucktime = 10
								a.attacktime = 30
							EndIf
							Exit
						Else
							If pc.cursed Then dieroll = dieroll * 1.5
							If dieroll &gt; pc.defenseskill Then 
								pc.hp = pc.hp - a.damage
								pc.strucktime = 10
								a.attacktime = 30
								If a.poison &gt; 0 Then 
									pc.poison = a.poison
								EndIf 
							EndIf
							If a.berserk &gt; 0 Then 
								a.berserk = a.berserk - 1
								'second attack
								dieroll = Rand(1,1000)
								If pc.cursed Then dieroll = dieroll * 1.5
								If dieroll &gt; pc.defenseskill Then 
									pc.hp = pc.hp - a.damage
									pc.strucktime = 10
									a.attacktime = 30
									If a.poison &gt; 0 Then 
										pc.poison = a.poison
									EndIf 
								EndIf
							EndIf 
							If a.cat = 110 Then 
								dieroll = Rand(1,1000)
								If dieroll &lt; a.skill Then 
									pc.cursed = Rand(1,3)
								EndIf
							EndIf 
							Exit
						EndIf  
					EndIf 
				Next
				
			EndIf 
		EndIf 
	Next
EndIf
End Function

Function updategame()
'move all creatures
'move all bullets
'handle all collisions
'handle all pick ups
'handle all combat
'handle all spell casting (magic missiles and healing)

found = False

For pc:bbcreature = EachIn creature_list
	If pc.strucktime &gt; 0 Then 
		pc.strucktime = pc.strucktime - 1
		createbloodparticle(pc.x,pc.y)
		If pc.hp &lt;= 0 Then 
			createbloodparticle(pc.x,pc.y)
			createbloodparticle(pc.x,pc.y)
			createbloodparticle(pc.x,pc.y)
		EndIf 
	EndIf 
	If pc.hp&gt;0 Then 
		If pc.cursed &gt; 0 Then 
			createcurseparticle(pc.x,pc.y+40)
		EndIf 
		If pc.berserk &gt; 0 Then 
			createberserkparticle(pc.x,pc.y+40)
		EndIf 
		If pc.cat &gt;= 100 Then 
			found = True
		EndIf
	Else
		pc.Remove()
	EndIf 
Next
If found = False Then 
	levelfinishtime = levelfinishtime + 1
EndIf 
foundp = False
For pc:bbcreature = EachIn creature_list
	If pc.hp &gt; 0 And pc.cat &lt; 100 Then foundp = True;Exit 
Next
If foundp = False Then 
	levelfinishtime = levelfinishtime + 1
EndIf 
If levelfinishtime &gt; 250 Then 
	gamemode = MODE_MENU 'eventually change to mode_upgrade
	If foundp Then gamemode = MODE_UPGRADE
	gamelevel = gamelevel + 1
	ftrpicked = False
	clrpicked = False
	rngpicked = False
	wizpicked = False 
EndIf 

For pc:bbcreature = EachIn creature_list
	If pc.hp &gt; 0 Then 
		If pc.healingtime &gt; 0 Then pc.healingtime = pc.healingtime - 1
	EndIf 
Next
updateparticle()
End Function

Function drawgame()
'draw background (fixed static 1280x720 image background)
'draw all creatures - don't worry about zordering them - it will be too fast to notice 
'draw all bullets
For img:bbimages = EachIn images_list
	If img.cat = 2007 'change this later
		DrawImage img.img,0,0
	EndIf
Next
For pc:bbcreature = EachIn creature_list
	If pc.hp &gt; 0 Then
		aa# = 0
		bb# = 0
		If pc.attacktime &gt; 0 Then 
			pc.attacktime = pc.attacktime - 1
			aa# = -25.0 * Sin(pc.attacktime * 6)
			If pc.cat&gt;=100 Then aa = aa * -1.0
		EndIf 
		If pc.strucktime &gt; 0 Then 
			bb = Rand(-pc.strucktime/2,pc.strucktime/2)
		EndIf 
		If pc.poison &gt; 0 And pc.cat &lt; 100 Then 
			For img:bbimages = EachIn images_list
				If img.cat = 119 Then 
					DrawImage img.img,pc.x - ImageWidth(pc.img)/2,pc.y-40
					Exit
				EndIf 
			Next
			'Color 32,255,32
			'Oval pc\x - ImageWidth(pc\img)/2,pc\y-40,ImageWidth(pc\img),80,1
		EndIf 
		DrawImage pc.img,bb + pc.x - ImageWidth(pc.img)/2,pc.y - 40 + aa
		dhp = 10 * pc.hp / pc.fullhp
		If dhp &lt; 4 Then SetColor 255,32,32
		If dhp &gt;=4 And dhp&lt;8 Then SetColor 255,255,32
		If dhp &gt;=8 Then SetColor 32,255,32
		If dhp = 0 Then dhp = 1
		For hp = 1 To dhp
			DrawRect hp*4 + pc.x - ImageWidth(pc.img)/3,pc.y - 50,3,3',1
		Next
		SetColor 255,255,255
		If pc.healingtime &gt; 0 Then 
			createhealparticle(pc.x,pc.y)
		EndIf 
		SetColor 255,255,255
		If pc.summonedtime &gt; 0 Then 
			pc.summonedtime = pc.summonedtime - 1
			createsummonparticle(pc.x,pc.y)
		EndIf 
		SetColor 255,255,255
		If pc.lightningtime &gt; 0 Then 
			pc.lightningtime = pc.lightningtime - 1
			drawlightning(pc.x,pc.y)
		EndIf 
		SetColor 255,255,255
		If pc.waitcount &gt; 0 Then 
			SetColor 255,32,255
			For i = 1 To pc.waitcount
				DrawRect i * 4 + pc.x - ImageWidth(pc.img)/3,pc.y - 55,3,3',1
			Next
			SetColor 255,255,255
		EndIf 
		If pc.stunned &gt; 0 And pc.cat &lt; 100 Then 
			'Color 255,255,32
			'Oval pc\x - ImageWidth(pc\img)/2,pc\y-40,ImageWidth(pc\img),80,0
			For img:bbimages = EachIn images_list
				If img.cat = 118 Then 
					DrawImage img.img, pc.x - ImageWidth(pc.img)/2,pc.y-40
					Exit
				EndIf 
			Next
		EndIf 
	EndIf
Next
drawparticle()
SetColor 255,255,255
For img:bbimages = EachIn images_list
	If img.cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img.img,mx,my
	EndIf
Next
SetColor 255,255,255
End Function 

Function drawlightning(x,y)
iy = 0
ix = x + Rand(-20,20)
While iy &lt; y
	oy = iy
	ox = ix
	ix = x + Rand(-20,20)
	iy = iy + Rand(10,25)
	SetColor 200,200,255
	DrawLine ox,oy,ix,iy
	SetColor 150,150,200
	DrawLine ox+1,oy+1,ix+1,iy+1
	DrawLine ox-1,oy-1,ix-1,iy-1
	SetColor 100,100,150
	DrawLine ox+2,oy+2,ix+2,iy+2
	DrawLine ox-2,oy-2,ix-2,iy-2
	SetColor 32,32,90
	DrawLine ox+3,oy+3,ix+3,iy+3
	DrawLine ox-3,oy-3,ix-3,iy-3
Wend 

End Function 

Function handlecutscene()
'handle transitions,  handle skip button; 
'handle fading in and out text (bitmap fonts?)
If gamelevel = 1 Or gamelevel = 4 Or gamelevel = 8 Or gamelevel = 11 Or gamelevel = 14 Then
	
Else
	initlevel()
	gamemode = MODE_COMBAT
EndIf 
';
If lmb&lt;&gt;0 And olmb = 0 Then 
	If mx&gt;1000 And mx&lt;1200 And my&gt;600 And my&lt;650 Then 
		If gamelevel &lt; 14 Then 
			initlevel()
			gamemode = MODE_COMBAT
		Else
			gamemode = MODE_MENU
		EndIf
	EndIf 
EndIf 
';
End Function 

Function drawcutscene()
'draw cut scene background, draw transition, draw skip button
If gamelevel = 1 Or gamelevel = 4 Or gamelevel = 8 Or gamelevel = 11 Or gamelevel = 14 Then
Else
	Return
EndIf
For img:bbimages = EachIn images_list
	If (img.cat = 2004 And gamelevel = 1) Or (img.cat = 2005 And gamelevel = 4) Or (img.cat = 2006 And gamelevel = 8) Or (img.cat = 2008 And gamelevel = 11) Or (img.cat = 2009 And gamelevel = 14) Then 
		DrawImage img.img,0,0
	EndIf 
Next
';
For img:bbimages = EachIn images_list
	If img.cat = CAT_MENU_SKIP_CUTSCENE
		DrawImage img.img,1000,600
	EndIf
Next
';
For img:bbimages = EachIn images_list
	If img.cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img.img,mx,my
	EndIf
Next
';
End Function 

Function handleupgrade()
'handle button press 'add stuff' to characters
'
'
'
If lmb&lt;&gt;0 And olmb = 0Then 
	If mx &gt; 1000 And mx&lt;1200 And my&gt;600 And my &lt;650
		gamemode = MODE_CUTSCENE
		FlushMouse()
	EndIf
	i = -1
	For pc:bbcreature = EachIn creature_list
		If pc.cat &lt; 100 And pc.hp &gt; 0 Then 
			i = i + 1
			y = 100 * i + 200
			DrawImage pc.img,100,y
			If pc.cat = CAT_FIGHTER And (Not ftrpicked)
				If mx&gt;200 And mx &lt; 400 And my &gt; y And my &lt; y + 50 Then 
					'health picked
					ftrpicked = True
					pc.fullhp = pc.fullhp + 10
				EndIf 
				If mx&gt;450 And mx &lt; 650 And my &gt; y And my &lt; y + 50 Then 
					'damage picked
					ftrpicked = True
					pc.damage = pc.damage + 4
				EndIf 
				
				If mx&gt;700 And mx &lt; 900 And my &gt; y And my &lt; y + 50 Then 
					'skill picked
					ftrpicked = True
					ds# = (1000 - pc.skill) * 0.95
					pc.skill = 1000 - ds
				EndIf 
				
				If mx&gt;950 And mx &lt; 1150 And my &gt; y And my &lt; y + 50 Then 
					'def picked
					ftrpicked = True
					ds# = (1000 - pc.defenseskill) * 0.95
					pc.defenseskill = 1000 - ds
				EndIf 
			EndIf
			If pc.cat = CAT_RANGER And (Not rngpicked)
				If mx&gt;200 And mx &lt; 400 And my &gt; y And my &lt; y + 50 Then 
					'health picked
					rngpicked = True
					pc.fullhp = pc.fullhp + 10
				EndIf 
				If mx&gt;450 And mx &lt; 650 And my &gt; y And my &lt; y + 50 Then 
					'damage picked
					rngpicked = True
					pc.damage = pc.damage + 4
				EndIf 
				
				If mx&gt;700 And mx &lt; 900 And my &gt; y And my &lt; y + 50 Then 
					'skill picked
					rngpicked = True
					ds# = (1000 - pc.skill) * 0.95
					pc.skill = 1000 - ds
				EndIf 
				
				If mx&gt;950 And mx &lt; 1150 And my &gt; y And my &lt; y + 50 Then 
					'def picked
					rngpicked = True
					ds# = (1000 - pc.defenseskill) * 0.95
					pc.defenseskill = 1000 - ds
				EndIf 
			
			EndIf
			If pc.cat = CAT_WIZARD And (Not wizpicked)
				If mx&gt;200 And mx &lt; 400 And my &gt; y And my &lt; y + 50 Then 
					'health picked
					wizpicked = True
					pc.fullhp = pc.fullhp + 10
				EndIf 
				If mx&gt;450 And mx &lt; 650 And my &gt; y And my &lt; y + 50 Then 
					'damage picked
					wizpicked = True
					pc.damage = pc.damage + 4
				EndIf 
				
				If mx&gt;700 And mx &lt; 900 And my &gt; y And my &lt; y + 50 Then 
					'skill picked
					wizpicked = True
					ds# = (1000 - pc.skill) * 0.95
					pc.skill = 1000 - ds
				EndIf 
				
				If mx&gt;950 And mx &lt; 1150 And my &gt; y And my &lt; y + 50 Then 
					'def picked
					wizpicked = True
					ds# = (1000 - pc.defenseskill) * 0.95
					pc.defenseskill = 1000 - ds
				EndIf 

			EndIf
			If pc.cat = CAT_CLERIC And (Not clrpicked)
				If mx&gt;200 And mx &lt; 400 And my &gt; y And my &lt; y + 50 Then 
					'health picked
					clrpicked = True
					pc.fullhp = pc.fullhp + 10
				EndIf 
				If mx&gt;450 And mx &lt; 650 And my &gt; y And my &lt; y + 50 Then 
					'damage picked
					clrpicked = True
					pc.damage = pc.damage + 4
				EndIf 
				If mx&gt;700 And mx &lt; 900 And my &gt; y And my &lt; y + 50 Then 
					'skill picked
					clrpicked = True
					ds# = (1000 - pc.skill) * 0.95
					pc.skill = 1000 - ds
				EndIf 
				If mx&gt;950 And mx &lt; 1150 And my &gt; y And my &lt; y + 50 Then 
					'def picked
					clrpicked = True
					ds# = (1000 - pc.defenseskill) * 0.95
					pc.defenseskill = 1000 - ds
				EndIf 
			EndIf 
		EndIf 
	Next
EndIf
End Function

Function drawupgrade()
'draw background
'draw buttons
'draw characters
'draw stats
'draw continue button
For img:bbimages = EachIn images_list
	If img.cat = 2000 Then 
	'	DrawBlock img\img,0,0
	EndIf 
Next

i=-1
For pc:bbcreature = EachIn creature_list
	If pc.cat &lt; 100 And pc.hp &gt; 0 Then 
		pc.hp = pc.fullhp
		i = i + 1
		y = 100 * i + 200
		DrawImage pc.img,100,y
	'	Text 150,i*100+200,"Skill:"+pc\skill+" Defense:"+pc\defenseskill + " Health:"+pc\fullhp + " Power:"+pc\damage
		If pc.cat = CAT_FIGHTER 
			For img:bbimages = EachIn images_list
				If img.cat = CAT_MENU_ADD_HEALTH Then
					If (Not ftrpicked) DrawImage img.img,200,y
					'Text 300,y + 65,pc\fullhp,1,1
					drawnumber(300,y + 65,pc.fullhp)
				EndIf
				If img.cat = CAT_MENU_ADD_DAMAGE Then
					If (Not ftrpicked) 	DrawImage img.img,450,y
					'Text 550,y + 65,pc\damage,1,1
					drawnumber(550,y + 65,pc.damage)
				EndIf
				If img.cat = CAT_MENU_ADD_SKILL Then
					If (Not ftrpicked) 	DrawImage img.img,700,y
					'Text 800,y + 65,pc\skill,1,1
					drawnumber(800,y + 65,pc.skill * 100 / 1000)
				EndIf
				If img.cat = CAT_MENU_ADD_DEF Then 
					If (Not ftrpicked) 	DrawImage img.img,950,y
					'Text 1050,y + 65,pc\defenseskill,1,1
					drawnumber(1050,y + 65,pc.defenseskill * 100 / 1000)
				EndIf 
			Next
		EndIf
		If pc.cat = CAT_RANGER 
			For img:bbimages = EachIn images_list
				If img.cat = CAT_MENU_ADD_HEALTH Then
					If (Not rngpicked) DrawImage img.img,200,y
					'Text 300,y + 65,pc\fullhp,1,1
					drawnumber(300,y + 65,pc.fullhp)
				EndIf
				If img.cat = CAT_MENU_ADD_DAMAGE Then
					If (Not rngpicked) DrawImage img.img,450,y
					'Text 550,y + 65,pc\damage,1,1
					drawnumber(550,y + 65,pc.damage)
				EndIf
				If img.cat = CAT_MENU_ADD_SKILL Then
					If (Not rngpicked) DrawImage img.img,700,y
					'Text 800,y + 65,pc\skill,1,1
					drawnumber(800,y + 65,pc.skill * 100 / 1000)
				EndIf
				If img.cat = CAT_MENU_ADD_DEF Then 
					If (Not rngpicked) DrawImage img.img,950,y
					'Text 1050,y + 65,pc\defenseskill,1,1
					drawnumber(1050,y + 65,pc.defenseskill * 100 / 1000)
				EndIf 
			Next
		
		EndIf
		If pc.cat = CAT_WIZARD 
			For img:bbimages = EachIn images_list
				If img.cat = CAT_MENU_ADD_HEALTH Then
					If (Not wizpicked) DrawImage img.img,200,y
'					Text 300,y + 65,pc\fullhp,1,1
					drawnumber(300,y + 65,pc.fullhp)
				EndIf
				If img.cat = CAT_MENU_ADD_DAMAGE Then
					If (Not wizpicked)  DrawImage img.img,450,y
					'Text 550,y + 65,pc\damage,1,1
					drawnumber(550,y + 65,pc.damage)
				EndIf
				If img.cat = CAT_MENU_ADD_SKILL Then
					If (Not wizpicked) DrawImage  img.img,700,y
					'Text 800,y + 65,pc\skill,1,1
					drawnumber(800,y + 65,pc.skill * 100 / 1000)
				EndIf
				If img.cat = CAT_MENU_ADD_DEF Then 
					If (Not wizpicked) DrawImage  img.img,950,y
					'Text 1050,y + 65,pc\defenseskill,1,1
					drawnumber(1050,y + 65,pc.defenseskill * 100 / 1000)
				EndIf 
			Next
		
		EndIf
		If pc.cat = CAT_CLERIC 
			For img:bbimages = EachIn images_list
				If img.cat = CAT_MENU_ADD_HEALTH Then
					If (Not clrpicked) DrawImage  img.img,200,y
					'Text 300,y + 65,pc\fullhp,1,1
					drawnumber(300,y + 65,pc.fullhp)
				EndIf
				If img.cat = CAT_MENU_ADD_DAMAGE Then
					If (Not clrpicked) 					DrawImage img.img,450,y
					'Text 550,y + 65,pc\damage,1,1
					drawnumber(550,y + 65,pc.damage)
				EndIf
				If img.cat = CAT_MENU_ADD_SKILL Then
					If (Not clrpicked) 					DrawImage img.img,700,y
					'Text 800,y + 65,pc\skill,1,1
					drawnumber(800,y + 65,pc.skill * 100 / 1000)
				EndIf
				If img.cat = CAT_MENU_ADD_DEF Then 
					If (Not clrpicked) 					DrawImage img.img,950,y
					'Text 1050,y + 65,pc\defenseskill,1,1
					drawnumber(1050,y + 65,pc.defenseskill * 100 / 1000)
				EndIf 
			Next
		
		EndIf 
	EndIf 
Next

For img:bbimages = EachIn images_list
	If img.cat = CAT_MENU_SKIP_CUTSCENE
		DrawImage img.img,1000,600
	EndIf
Next

DrawText "On this screen you would upgrade some of your characters",0,0

For img:bbimages = EachIn images_list
	If img.cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img.img,mx,my
	EndIf
Next

End Function 

Function initstartgame()
gamelevel = 1
mapindex = 0
DeleteEach bb32
pc:bbcreature = New bbcreature
pc.fullhp = 90
pc.hp = 90
pc.cat = CAT_FIGHTER
pc.x = 600
pc.y = 300
pc.skill = 500
pc.defenseskill = 850
pc.damage = 15
For img:bbimages = EachIn images_list
	If img.cat = CAT_FIGHTER Then 
		pc.img = img.img
		Exit 
	EndIf 
Next
pc:bbcreature = New bbcreature
pc.fullhp = 75
pc.hp = 75
pc.cat = CAT_RANGER
pc.x = 640
pc.y = 300
pc.skill = 800
pc.defenseskill = 850
pc.damage = 50
For img:bbimages = EachIn images_list
	If img.cat = CAT_RANGER Then 
		pc.img = img.img
		Exit 
	EndIf 
Next
pc:bbcreature = New bbcreature
pc.fullhp = 45
pc.hp = 45
pc.cat = CAT_WIZARD
pc.x = 750
pc.y = 360
pc.skill = 650
pc.damage = 18
pc.defenseskill = 650
For img:bbimages = EachIn images_list
	If img.cat = CAT_WIZARD Then 
		pc.img = img.img
		Exit 
	EndIf 
Next
pc:bbcreature = New bbcreature
pc.fullhp = 60
pc.hp = 60
pc.cat = CAT_CLERIC
pc.x = 640
pc.defenseskill = 800
pc.y = 350
pc.skill = 100
pc.damage = 5
For img:bbimages = EachIn images_list
	If img.cat = CAT_CLERIC Then 
		pc.img = img.img
		Exit 
	EndIf 
Next
End Function 

Function initlevel()
For pc:bbcreature = EachIn creature_list
	If pc.hp &gt; 0 And pc.hp &lt; pc.fullhp Then pc.hp = pc.fullhp
	If pc.cat = CAT_FIGHTER
		pc.x = 540
		pc.y = 350
	EndIf
	If pc.cat = CAT_RANGER
		pc.x = 720
		pc.y = 350
	EndIf
	If pc.cat = CAT_WIZARD
		pc.x = 540
		pc.y = 440
	EndIf
	If pc.cat = CAT_CLERIC
		pc.x = 720
		pc.y = 440
	EndIf
	If pc.cat &gt;=100 Then pc.Remove()
Next

For i = 1 To 8
	pc:bbcreature = New bbcreature
	If i &lt; 5 Then 
		pc.x = 360 + (i-1) * 180'Rand(0,SW)
		pc.y = 180 'Rand(0,SH)
	Else
		pc.x = 450 + (i-5) * 180'Rand(0,SW)
		pc.y = 225 'Rand(0,SH)
	
	EndIf
	
	If gamelevel = 1 Then 
	pc.cat = 100+Rand(0,1)
	pc.hp = 70
	pc.fullhp = 50
	pc.damage = 5
	pc.skill = 80
	EndIf
	If gamelevel = 2 Then 
		'trolls2
		If i = 1 Or i = 8 Then 
			pc.cat = 102
			pc.hp = 200
			pc.regenerate = True
			pc.fullhp = 200
			pc.damage = 10
			pc.skill = 150
		Else
			pc.cat = 100+Rand(0,1)
			pc.hp = 70
			pc.fullhp = 50
			pc.damage = 5
			pc.skill = 80
		EndIf 
	EndIf 
	If gamelevel = 3 Then 
		'wizard and troll
		If i = 1 Or i = 8 Then
			pc.cat = 102
			pc.hp = 200
			pc.regenerate = True
			pc.fullhp = 200
			pc.damage = 10
			pc.skill = 150
		ElseIf i = 4 Then
			pc.cat = 103
			pc.hp = 100
			pc.fullhp = 100
			pc.damage = 5
			pc.skill = 350
		Else
			pc.cat = 100+Rand(0,1)
			pc.hp = 70
			pc.fullhp = 50
			pc.damage = 5
			pc.skill = 80
		EndIf 
	EndIf
	If gamelevel = 4 Then
		'spiderbeasts and giant spiders
		If i = 1 Or i = 8 Then 
			pc.cat = 104
			pc.hp = 150
			pc.poison = 15
			pc.regenerate = True
			pc.fullhp = 150
			pc.damage = 15
			pc.skill = 100
		Else
			pc.cat = 105
			pc.hp = 100
			pc.fullhp = 100
			pc.damage = 8
			pc.skill = 150
		EndIf 

	EndIf
	If gamelevel = 5 Then 
		'spiderbeasts, giant spiders and spider wizards
		If i = 1 Or i = 8 Then 
			pc.cat = 104
			pc.hp = 150
			pc.poison = 15
			pc.regenerate = True
			pc.fullhp = 150
			pc.damage = 15
			pc.skill = 100
		ElseIf i = 2 Or i = 7
			pc.cat = 106
			pc.hp = 100
			pc.fullhp = 100
			pc.damage = 8
			pc.skill = 300
		Else
			pc.cat = 105
			pc.hp = 100
			pc.fullhp = 100
			pc.damage = 8
			pc.skill = 150
		EndIf 


	EndIf 
	If gamelevel = 6 Then 
		'spider queens and spiderbeasts
		If i = 1 Or i = 8 Then 
			pc.cat = 107
			pc.hp = 100
			pc.fullhp = 100
			pc.damage = 5
			pc.skill = 450
		Else
			pc.cat = 105
			pc.hp = 100
			pc.fullhp = 100
			pc.damage = 8
			pc.skill = 150
		EndIf 
	EndIf 
	If gamelevel = 7 Then 
		'spider queens and giant spiders and spider wizards
		If i = 4 Or i = 5 Then 
			pc.cat = 107
			pc.hp = 100
			pc.fullhp = 100
			pc.damage = 5
			pc.skill = 450
		ElseIf i = 2 Or i = 7
			pc.cat = 106
			pc.hp = 100
			pc.fullhp = 100
			pc.damage = 8
			pc.skill = 300
		Else
			pc.cat = 104
			pc.hp = 150
			pc.regenerate = True
			pc.poison = 15
			pc.fullhp = 150
			pc.damage = 15
			pc.skill = 100
		EndIf 
	EndIf 
	'beasts
	If gamelevel = 8 Then 
		If i = 2 Or i = 6 Or i = 4
			'centaur
			pc.cat = 108
			pc.hp = 200
			pc.fullhp = 200
			pc.damage = 10
			pc.skill = 150
		Else
			'grunt
			pc.cat = 109
			pc.hp = 90
			pc.fullhp = 90
			pc.damage = 20
			pc.skill = 150
		EndIf
	EndIf
	If gamelevel = 9 Then
		If i = 3 Or i = 5 Then
			'shaman
			pc.cat = 110
			pc.hp = 180
			pc.fullhp = 180
			pc.damage = 15
			pc.skill = 250
		Else
			'grunt
			pc.cat = 109
			pc.hp = 90
			pc.fullhp = 90
			pc.damage = 20
			pc.skill = 150

		EndIf
	EndIf
	If gamelevel = 10 Then 
		If i = 1 Or i = 8 Then
			'shaman
			pc.cat = 110
			pc.hp = 180
			pc.fullhp = 180
			pc.damage = 15
			pc.skill = 250
		ElseIf i = 2 Or i = 7 Or i = 4 Then
			'centaur
			pc.cat = 108
			pc.hp = 200
			pc.fullhp = 200
			pc.damage = 10
			pc.skill = 150
		Else
			'grunt
			pc.cat = 109
			pc.hp = 90
			pc.fullhp = 90
			pc.damage = 20
			pc.skill = 150
		EndIf
	EndIf 
	If gamelevel = 11 Then
		If i = 4 Then
			'necromancer
			pc.cat = 113
			pc.hp = 200
			pc.fullhp = 200
			pc.damage = 20
			pc.skill = 250
		ElseIf i = 5 Then 
			'wraith
			pc.cat = 112
			pc.hp = 200
			pc.ethereal = True
			pc.fullhp = 200
			pc.damage = 15
			pc.skill = 300
		Else
			'skeleton
			pc.cat = 111
			pc.hp = 20
			pc.fullhp = 20
			pc.damage = 10
			pc.skill = 150
		EndIf
	EndIf
	If gamelevel = 12 Then 
		If i = 5 Or i = 7 Then 
			'necromancer
			pc.cat = 113
			pc.hp = 200
			pc.fullhp = 200
			pc.damage = 20
			pc.skill = 250

		ElseIf i = 4 Or i = 6
			'wraith
			pc.cat = 112
			pc.hp = 200
			pc.ethereal = True
			pc.fullhp = 200
			pc.damage = 15
			pc.skill = 300
		Else
			'skeleton
			pc.cat = 111
			pc.hp = 20
			pc.fullhp = 20
			pc.damage = 10
			pc.skill = 150
		EndIf
	EndIf
	If gamelevel = 13 Then 
		If i = 1 Then 
			'liche
			pc.cat = 114
			pc.hp = 300
			pc.fullhp = 300
			pc.damage = 20
			pc.skill = 350
		ElseIf i = 2 Or i = 3 Then 
			'necromancer
			pc.cat = 113
			pc.hp = 200
			pc.fullhp = 200
			pc.damage = 20
			pc.skill = 250
		ElseIf i = 4 Or i = 5 Then 
			'wraith
			pc.cat = 112
			pc.hp = 200
			pc.fullhp = 200
			pc.damage = 15
			pc.skill = 300
			pc.ethereal = True
		Else
			'skeletons
			pc.cat = 111
			pc.hp = 20
			pc.fullhp = 20
			pc.damage = 10
			pc.skill = 150
		EndIf
	EndIf 
	For img:bbimages = EachIn images_list
		If img.cat = pc.cat Then 
			pc.img = img.img
			Exit 
		EndIf 
	Next
Next

lmb = 0
olmb = 0
FlushMouse()
levelfinishtime = 0
End Function 

Function createskeleton:bbcreature(pc:bbcreature)
x = pc.x
y = pc.y
pc.Remove()
pc:bbcreature = New bbcreature
			pc.cat = 111
			pc.strucktime = 10
			For img:bbimages = EachIn images_list
				If img.cat = pc.cat Then pc.img = img.img;Exit 
			Next
			pc.hp = 20
			pc.x = x
			pc.y = y
			pc.fullhp = 20
			pc.damage = 10
			pc.skill = 150
			pc.regenerate = False
			pc.ethereal = False
			pc.summonedtime = 25
			pc.berserk = 0
Return pc
End Function 

Function createhealparticle(x,y)

For i = 1 To 36
	p:bbparticle = New bbparticle
	p.life = 20
	p.x = x + 25.0 * Cos(i*10)
	p.y = y + 20 + 25.0 * (Sin(i*5))
	p.vx = 0
	p.vy = Rand(-4,-2)
	p.ay = 0.1
	p.gy = p.y + 100
	p.r = 32
	p.g = 200
	p.b = 255
	p.sz = 4
	p.dsz = -0.1
	p.dr = 10
	p.dg = 2
	p.db = 0
Next

End Function 

Function createsummonparticle(x,y)

For i = 1 To 36
	p:bbparticle = New bbparticle
	p.life = 20
	p.x = x + 25.0 * Cos(i*10)
	p.y = y + 20 + 25.0 * (Sin(i*5))
	p.vx = 0
	p.vy = Rand(-4,-2)
	p.ay = 0.1
	p.gy = p.y + 100
	p.r = 32
	p.g = 255
	p.b = 50
	p.sz = 4
	p.dsz = -0.1
	p.dr = 8
	p.dg = 0
	p.db = 8
Next

End Function 


Function createbloodparticle(x,y)

For i = 1 To 10
	p:bbparticle = New bbparticle
	p.life = 20
	p.x = x + Rand(-10,10)
	p.y = y + Rand(-10,10)
	p.vx = Rnd(-3,3)
	p.vy = Rnd(-3,3)
	p.ay = 0.05
	p.gy = y + 42
	p.r = 255
	p.g = 100
	p.b = 100
	p.dr = -2
	p.dg = -3
	p.db = -3
	p.sz = 4
	p.dsz = 0
Next

End Function 

Function createcurseparticle(x,y)
For i = 1 To 36
	p:bbparticle = New bbparticle
	p.life = 10+Rand(5)
	p.x = x +25 * Cos(i*10)
	p.y = y + 15.0 * Abs(Sin(i*10))
	p.vx = 0
	p.vy = Rand(-4,-2)
	p.ay = 0.1
	p.gy = p.y + 100
	p.r = 255
	p.g = 50
	p.b = 255
	p.sz = 4
	p.dsz = 0.25
	p.dr = 0
	p.dg = 22
	p.db = 0
Next
End Function 
Function createberserkparticle(x,y)
For i = 1 To 36
	p:bbparticle = New bbparticle
	p.life = 10+Rand(5)
	p.x = x +25 * Cos(i*10)
	p.y = y + 15.0 * Abs(Sin(i*10))
	p.vx = 0
	p.vy = Rand(-4,-2)
	p.ay = 0.1
	p.gy = p.y + 100
	p.r = 255
	p.g = 50
	p.b = 255
	p.sz = 4
	p.dsz = 0.25
	p.dr = 0
	p.dg = 22
	p.db = 0
Next



End Function 

Function updateparticle()
For p:bbparticle = EachIn particle_list
	p.life = p.life - 1
	p.x = p.x + p.vx
	p.y = p.y + p.vy
	p.vy = p.vy + p.ay
	If p.y &gt; p.gy Then 
		p.vy = p.vy * -0.7
		If Abs(p.vy)&lt;0.01 Then p.life = 0
	EndIf 
	p.sz = p.sz + p.dsz
	p.r = p.r + p.dr
	p.g = p.g + p.dg
	p.b = p.b + p.db
	If p.sz &lt; 0 Then p.sz = 0
	If p.r &gt; 255 Then p.r = 255
	If p.g &gt; 255 Then p.g = 255
	If p.b &gt; 255 Then p.b = 255
	If p.r &lt; 0 Then p.r = 0
	If p.g &lt; 0 Then p.g = 0
	If p.b &lt; 0 Then p.b = 0
	If p.life &lt; 0 Then p.Remove()
Next
End Function 

Function drawparticle()
For p:bbparticle = EachIn particle_list
	SetColor p.r,p.g,p.b
	DrawRect p.x,p.y,p.sz,p.sz',1
Next
SetColor 255,255,255
End Function 

Function drawnumber(x,y,num)
txt$ = String(num)
For i = 1 To Len(txt)
	digit = Int(Mid(txt,i,1))
	For img:bbimages = EachIn images_list
		If img.cat = 10000 + digit Then 
			DrawImage img.img,x + (i-1) * 50 - Len(txt) * 25,y - 25
			Exit
		EndIf
	Next
Next 
End Function 
</textarea><br><br>@Matty<br>Yeah, the game would be a nightmare if it wasn't so fast. <br><br></td></tr></table><br>
<a name="1341375"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#92">[#92]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Rooster...I will fix the goblin image at some point....not sure why it is black...can do it in paint.net<br><br>The most recent code is here:<br><br><a href="http://www.mattiesgames.com/bbgame/game3.zip" target="_blank">Link</a><br><br>I'm thinking now it is probably at the stage where we can think about adding audio. <br><br></td></tr></table><br>
<a name="1341382"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#93">[#93]</a></td></tr></table></td></tr><tr ><td class="posttext"> Audio Added:<br><br><a href="http://www.mattiesgames.com/bbgame/game4.zip" target="_blank">Link with Audio</a><br><br>Some bug fixes.<br>New types added<br>"audio" and "audiofx"<br><br>I bought the music for this in 2011...long time ago...same with the sound effects- when I built another dungeon game I used these effects.<br><br>Side note:<br>I have some great music from a game I wrote in 2008 but I can't access it. I encrypted it and lost the source to my encryption/decryption routines so it is effectively gone for good....at least from my computer. <br><br></td></tr></table><br>
<a name="1341384"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#94">[#94]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm planning on porting this to Android soon.  I want to play it on my mobile because I rarely use my pc for games.  So I might develop in both blitz and java simultaneously soon. <br><br></td></tr></table><br>
<a name="1341397"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rooster</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#95">[#95]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's looking great!<br><br>(BlitzMax code)<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Global particle_list:TList=New TList
Global creature_list:TList=New TList
Global images_list:TList=New TList
'This is both a learning exercise and hopefully a collaborative project of sorts
'or at least a project I can share with others on the blitz forum.
'It will be written initially in blitzplus/blitz3d and maybe someone will be keen on
'porting it to blitzmax...even blitzmax-ng to release on mobile perhaps?
'
'Interface:
'Left mouse button clicking only to make porting to 
'mobile interface much, much easier.
'Gameplay Mechanic Has changed - turn based more detailed
'
'Gameplay mechanic so far (15-May-2017)
'
'1. Arcade Action RPG Combat
'	Player controls 4 characters in a single screen dungeon.
'	Dungeon has a few walls and so on that prevent movement.
'	Monsters spawn from spawners and make their way around the map
'	Player taps the screen to move to location and characters fight things
'	in their path.
'	Powerups exist in the level such as:
'	Health pickups
'	Bombs - kill all monsters that have spawned or at least damage them.
'	
'2. After the arcade sequence the player is presented with options to upgrade their
'	character's stats. Stats to upgrade include:
'	Combat skill ('to hit roll')
'	Damage output ('damage points')
'	Health points ('hp')
'	Movement speed ('move')
'3.	After this a short cut scene is presented which may simply be a scrolling static
'	image with some fading in/fading out text to advance the story line
'0. Menu - toggle audio, play, credits
'
'Character types:
'1 Fighter - high hitpoint melee combat medium damage
'2 Ranger - medium hitpoint melee combat high damage
'3 Wizard - low hitpoint, ranged combat, medium damage
'4 Cleric - medium hitpoint, no combat, healer
'


'constants
Const SW=1280,SH=720,WIN=2
Const MODE_MENU = 0
Const MODE_COMBAT = 1
Const MODE_UPGRADE = 2
Const MODE_CUTSCENE = 3
Const PURE_2D = True 'if go to blitzmax can use 2d-in-3d commands such as alpha otherwise have to calculate manually.Change to false for blitzmax.

'categories for image types and object types
Const CAT_MENU_PLAY = 0
Const CAT_MENU_AUDIO = 1
Const CAT_MENU_SKIP_CUTSCENE = 2 'cut scene mode
Const CAT_MENU_ADD_SKILL = 3 'upgrade mode
Const CAT_MENU_ADD_DAMAGE = 4'upgrade mode
Const CAT_MENU_ADD_HEALTH = 5'upgrade mode
'Const CAT_MENU_ADD_SPEED = 6;
Const CAT_MENU_ADD_DEF = 6
Const CAT_MENU_MOUSE_CURSOR = 7'
Const CAT_FIGHTER = 10
Const CAT_KNIGHT = 10 'synonym
Const CAT_RANGER = 11
Const CAT_WIZARD = 12
Const CAT_CLERIC = 13
Const CAT_HEALER = 13 'synonym
Const CAT_HEALTH_PICKUP = 20
Const CAT_BOMB_PICKUP = 21
'CAT_BACKGROUND = 2000-3000 ; all the different image backgrounds
'CAT_MONSTER = 100-1000 , all the different monster types
'CAT_NUMBERS = 10000-10009


'globals
Global mx,my,lmb,olmb 'mouse input
Global audiostate 'on/off
Global gamemode 'references const above
Global gamelevel 'for cutscenes
Global cutsceneframe 'for cutscenes ie trigger fades, text, motion etc on certain frames
Global levelfinishtime = 0
Global mapdelay 'timestamp
Global mapindex

Global ftrpicked,rngpicked,wizpicked,clrpicked 'boolean for upgrades

' virtual key support for legacy Blitz apps

Global VKEY[]=[..
0,KEY_ESCAPE,KEY_1,KEY_2,KEY_3,KEY_4,KEY_5,KEY_6,KEY_7,KEY_8,KEY_9,KEY_0,..
KEY_MINUS,KEY_EQUALS,KEY_BACKSPACE,KEY_TAB,KEY_Q,KEY_W,KEY_E,KEY_R,KEY_T,..
KEY_Y,KEY_U,KEY_I,KEY_O,KEY_P,KEY_OPENBRACKET,KEY_CLOSEBRACKET,KEY_RETURN,..
KEY_LCONTROL,KEY_A,KEY_S,KEY_D,KEY_F,KEY_G,KEY_H,KEY_J,KEY_K,KEY_L,..
KEY_SEMICOLON,KEY_QUOTES,KEY_TILDE,KEY_LSHIFT,KEY_BACKSLASH,..
KEY_Z,KEY_X,KEY_C,KEY_V,KEY_B,KEY_N,KEY_M,KEY_COMMA,KEY_PERIOD,KEY_SLASH,..
KEY_RSHIFT,KEY_NUMMULTIPLY,KEY_ALT,KEY_SPACE,KEY_CAPSLOCK,..
KEY_F1,KEY_F2,KEY_F3,KEY_F4,KEY_F5,KEY_F6,KEY_F7,KEY_F8,KEY_F9,KEY_F10,..
KEY_NUMLOCK,KEY_SCROLL,KEY_NUM7,KEY_NUM8,KEY_NUM9,KEY_NUMSUBTRACT,KEY_NUM4,..
KEY_NUM5,KEY_NUM6,KEY_NUMADD,KEY_NUM1,KEY_NUM2,KEY_NUM3,KEY_NUM0,..
KEY_NUMDECIMAL,KEY_NUMSLASH,KEY_F11,KEY_F12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,..
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,..
KEY_EQUALS,0,0,KEY_MEDIA_PREV_TRACK,0,0,0,0,0,0,0,0,KEY_MEDIA_NEXT_TRACK,0,0,..
KEY_ENTER,KEY_RCONTROL,0,0,KEY_VOLUME_MUTE,0,KEY_MEDIA_PLAY_PAUSE,0,..
KEY_MEDIA_STOP,0,0,0,0,0,0,0,0,0,KEY_VOLUME_DOWN,0,KEY_VOLUME_UP,0,..
KEY_BROWSER_HOME,KEY_DECIMAL,0,KEY_NUMDIVIDE,0,KEY_SCREEN,..
0,0,0,0,0,0,0,0,0,0,0,0,0,KEY_PAUSE,0,KEY_HOME,KEY_UP,KEY_PAGEUP,0,..
KEY_LEFT,0,KEY_RIGHT,0,KEY_END,KEY_DOWN,KEY_PAGEDOWN,KEY_INSERT,KEY_DELETE,..
0,0,0,0,0,0,0,KEY_LWIN,KEY_RWIN,0,0,0,0,0,0,0,0,KEY_BROWSER_SEARCH,..
KEY_BROWSER_FAVORITES,KEY_BROWSER_REFRESH,KEY_BROWSER_STOP,KEY_BROWSER_FORWARD,..
KEY_BROWSER_BACK,0,KEY_LAUNCH_MAIL,KEY_LAUNCH_MEDIA_SELECT]

Function VKeyDown(key);Return KeyDown(VKEY[key]);End Function
Function VKeyHit(key);Return KeyHit(VKEY[key]);End Function

'currently unsupported in BlitzMax

Function Locate( x,y );Return 0;End Function
Function MouseZSpeed();Return 0;End Function
Function FreeBank(bank);Return 0;End Function
Function LoopSound(sound);Return 0;End Function
Function ChannelPitch(channel,hz);Return 0;End Function
Function PlayCDTrack( track,mode=0 );Return 0;End Function
Function SoundVolume( sound,volume# );Return 0;End Function


' BBType adds legacy Type functionality to BlitzMax Type

Type TBBType

	Field _list:TList
	Field _link:TLink

	Method Add(t:TList)
		_list=t
		_link=_list.AddLast(Self)
	End Method

	Method InsertBefore(t:TBBType)
		_link.Remove
		_link=_list.InsertBeforeLink(Self,t._link)
	End Method

	Method InsertAfter(t:TBBType)
		_link.Remove
		_link=_list.InsertAfterLink(Self,t._link)
	End Method

	Method Remove()
		_list.remove Self
	End Method

End Type

Function DeleteLast(t:TBBType)
	If t TBBType(t._list.Last()).Remove()
End Function

Function DeleteFirst(t:TBBType)
	If t TBBType(t._list.First()).Remove()
End Function

Function DeleteEach(t:TBBType)
	If t t._list.Clear()
End Function

Function ReadString$(in:TStream)
	Local	length
	length=ReadInt(in)
	If length&gt;0 And length&lt;1024*1024 Return brl.stream.ReadString(in,length)
End Function

Function HandleToObject:Object(obj:Object)
	Return obj
End Function

Function HandleFromObject(obj:Object)
	Local h=HandleToObject(obj)
	Return h
End Function


'types
Type bbimages Extends TBBType

	Method New()
		Add(images_list)
	End Method

	Method After:bbimages()
		Local t:TLink
		t=_link.NextLink()
		If t Return bbimages(t.Value())
	End Method

	Method Before:bbimages()
		Local t:TLink
		t=_link.PrevLink()
		If t Return bbimages(t.Value())
	End Method


Field img 'handle
Field midhandled 'boolean
Field cat 'category //hooks into creature template

End Type 




Type bbcreature Extends TBBType

	Method New()
		Add(creature_list)
	End Method

	Method After:bbcreature()
		Local t:TLink
		t=_link.NextLink()
		If t Return bbcreature(t.Value())
	End Method

	Method Before:bbcreature()
		Local t:TLink
		t=_link.PrevLink()
		If t Return bbcreature(t.Value())
	End Method


Field img
Field cat
Field x#
Field y#
Field hp
Field fullhp
Field damage
Field skill

Field defenseskill 'for players

Field aimode
Field aidelay
Field aitime

Field moving 'boolean

Field healingtime 'for healing effect/buff effect
Field lightningtime 'for lightning blasts on creature effect
Field strucktime 'for blood effects
Field attacktime 

Field activated 'boolean
Field waitcount 'int

Field stunned 'int 0-n counts down each time active....
Field poison 'int 0-n = damage inflicted
Field regenerate 'boolean
Field cursed 'int 0-n //50% off defenseskill
Field berserk 'int
Field ethereal 'boolean
Field summonedtime 'int
End Type 


'new emitters and particles
Type bbparticle Extends TBBType

	Method New()
		Add(particle_list)
	End Method

	Method After:bbparticle()
		Local t:TLink
		t=_link.NextLink()
		If t Return bbparticle(t.Value())
	End Method

	Method Before:bbparticle()
		Local t:TLink
		t=_link.PrevLink()
		If t Return bbparticle(t.Value())
	End Method


Field r,g,b,a
Field x#,y#,vx#,vy#,ay#,gy#
Field life
Field dr,dg,db,da
Field sz,dsz

End Type



Main()

Function Main()
	quit = False
	gamemode = MODE_MENU
	init()
	Repeat
		frametime = MilliSecs()
		Cls
		'input 
		mx = MouseX()
		my = MouseY()
		olmb = lmb
		lmb = MouseDown(1)
		Select gamemode
		
		Case MODE_MENU
			handlemenu()
			drawmenu()
		
		Case MODE_COMBAT
			handleinput()
			updategame()
			drawgame()
		Case MODE_CUTSCENE
			handlecutscene()
			drawcutscene()
		Case MODE_UPGRADE
			handleupgrade()
			drawupgrade()
		End Select
		
		Flip
		'very basic frame limiting
		endframetime = MilliSecs()
		dtime = endframetime - frametime
		If dtime &lt; 15 Then 
			Delay 15 - dtime
		EndIf 
		'end of frame limiting
		If(VKeyHit(1)) Then quit = True		
	Until quit
	';;;;;
	End
End Function 

Function init()
Graphics SW,SH,0',WIN
'load data files
'load all images here
'load all sounds here
'load all music here
HideMouse 

img:bbimages = New bbimages
img.img = LoadImage("images\02004panel1.jpg")
img.cat = 2004

img:bbimages = New bbimages
img.img = LoadImage("images\02005panel1.jpg")
img.cat = 2005

img:bbimages = New bbimages
img.img = LoadImage("images\02006panel1.jpg")
img.cat = 2006

img:bbimages = New bbimages
img.img = LoadImage("images\02007bk.jpg")
img.cat = 2007

img:bbimages = New bbimages
img.img = LoadImage("images\02008panel1.jpg")
img.cat = 2008

img:bbimages = New bbimages
img.img = LoadImage("images\02009panel1.jpg")
img.cat = 2009

img:bbimages = New bbimages
img.img = LoadImage("images\02010panel1.jpg")
img.cat = 2010

img:bbimages = New bbimages
img.img = LoadImage("images\02011panel1.jpg")
img.cat = 2011

img:bbimages = New bbimages
img.img = LoadImage("images\02012panel1.jpg")
img.cat = 2012


img:bbimages = New bbimages
img.img = LoadImage("images\00006btndef.png")
img.cat = CAT_MENU_ADD_DEF

img:bbimages = New bbimages
img.img = LoadImage("images\00005btnhp.png")
img.cat = CAT_MENU_ADD_HEALTH

img:bbimages = New bbimages
img.img = LoadImage("images\00004btnpower.png")
img.cat = CAT_MENU_ADD_DAMAGE

img:bbimages = New bbimages
img.img = LoadImage("images\00003btnskill.png")
img.cat = CAT_MENU_ADD_SKILL

img:bbimages = New bbimages
img.img = LoadImage("images\00010knight1.png")
img.cat = CAT_FIGHTER

img:bbimages = New bbimages
img.img = LoadImage("images\00011ranger1.png")
img.cat = CAT_RANGER

img:bbimages = New bbimages
img.img = LoadImage("images\00012wizard1.png")
img.cat = CAT_WIZARD

img:bbimages = New bbimages
img.img = LoadImage("images\00013cleric1.png")
img.cat = CAT_CLERIC

img:bbimages = New bbimages
img.img = LoadImage("images\00100goblin1.png")
img.cat = 100 'goblin 1

img:bbimages = New bbimages
img.img = LoadImage("images\00101goblin2.png")
img.cat = 101 'goblin 2

img:bbimages = New bbimages
img.img = LoadImage("images\00102troll1.png")
img.cat = 102 'troll 1

img:bbimages = New bbimages
img.img = LoadImage("images\00103goblinshaman1.png")
img.cat = 103 'goblin shaman

img:bbimages = New bbimages
img.img = LoadImage("images\00104giantspider1.png")
img.cat = 104 'giant spider melee brute...

img:bbimages = New bbimages
img.img = LoadImage("images\00105spiderbeast1.png")
img.cat = 105 'spider beast

img:bbimages = New bbimages
img.img = LoadImage("images\00106spiderwizard1.png")
img.cat = 106 'spider wizard - stuns enemy units (reduces skill)

img:bbimages = New bbimages
img.img = LoadImage("images\00107spiderqueen1.png")
img.cat = 107 'spider queen - stuns spell casters (reduces waitcount) and melee unit and heals friendlies

img:bbimages = New bbimages
img.img = LoadImage("images\00108beastcentaur.png")
img.cat = 108 'berseker low damage, multi attacks, high hitpoints

img:bbimages = New bbimages
img.img = LoadImage("images\00109beastwarrior.png")
img.cat = 109 'grunt - high damage, low hitpoints

img:bbimages = New bbimages
img.img = LoadImage("images\00110minotaurshaman.png")
img.cat = 110 'mage lightning, curse enemies defensive skill

img:bbimages = New bbimages
img.img = LoadImage("images\00111skeleton.png")
img.cat = 111

img:bbimages = New bbimages
img.img = LoadImage("images\00112wraith.png")
img.cat = 112

img:bbimages = New bbimages
img.img =  LoadImage("images\00113necromancer.png")
img.cat = 113

img:bbimages = New bbimages
img.img =  LoadImage("images\00114liche.png")
img.cat = 114

img:bbimages = New bbimages
img.img =  LoadImage("images\00115slug.png")
img.cat = 115

img:bbimages = New bbimages
img.img =  LoadImage("images\00116eye.png")
img.cat = 116

img:bbimages = New bbimages
img.img =  LoadImage("images\00117octo.png")
img.cat = 117

img:bbimages = New bbimages
img.img =  LoadImage("images\00118web.png")
img.cat = 118

img:bbimages = New bbimages
img.img =  LoadImage("images\00119poison.png")
img.cat = 119

img:bbimages = New bbimages
img.img = LoadImage("images\00000btnplay.png")
img.cat = CAT_MENU_PLAY

img:bbimages = New bbimages
img.img = LoadImage("images\00001btnaudio.png")
img.cat = CAT_MENU_AUDIO

img:bbimages = New bbimages
img.img = LoadImage("images\00007cursor.png")
img.cat = CAT_MENU_MOUSE_CURSOR

img:bbimages = New bbimages
img.img = LoadImage("images\00002btnskip.png")
img.cat = CAT_MENU_SKIP_CUTSCENE

For i = 10000 To 10009
	img:bbimages = New bbimages
	img.img = LoadImage("images\"+i+".png")
	img.cat = i
Next


'For img:bbimages = EachIn images_list
'	If img.img&lt;&gt;0 Then 
''		rgb = dev.blitz3d.ReadPixel(0,0,ImageBuffer(img.img))
'		r = (rgb Shr 16) &amp; 255
'		g = (rgb Shr 8) &amp; 255
'		b = rgb &amp; 255
'		MaskImage img.img,r,g,b
'	EndIf 
'Next

End Function 

Function handlemenu()
';;
';;;
';;Check if 'PLAY' pressed..if so then initialise
'first cut scene and change gamemode
';;Check if 'TOGGLE AUDIO' pressed if so toggle music/audio flags

If lmb&lt;&gt;0 Then 
	If mx&gt;=1000 And mx&lt;=1200 Then 
		If my&gt;550 And my&lt;600 Then 
			'play hit
			initstartgame()
			gamemode = MODE_CUTSCENE
		EndIf 
		If my&gt;650 And my&lt;700 Then 
			audiostate = Not audiostate
			If Not audiostate
				'stop music
					
			EndIf 
		EndIf 
	EndIf 
EndIf 


End Function

Function drawmenu()
'draw backdrop
'draw buttons in relevant state
'draw mouse cursor

For img:bbimages = EachIn images_list
	If img.cat = 2011 Then 
		DrawImage img.img,0,0
	EndIf 
Next

For img:bbimages = EachIn images_list
	If img.cat = CAT_MENU_PLAY
		DrawImage img.img,1000,550
	EndIf
	If img.cat = CAT_MENU_AUDIO
		DrawImage img.img,1000,650
	EndIf
Next

For img:bbimages = EachIn images_list
	If img.cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img.img,mx,my
	EndIf
Next

End Function

Function handleinput()
'assign tx,ty of creatures to player units
'
acted = False
If lmb&lt;&gt;0 And olmb = 0 Then 
	For pc:bbcreature = EachIn creature_list
		If pc.hp&gt;0 And pc.cat&gt;=10 And pc.cat&lt;=13 Then 
			If mx&gt;pc.x - ImageWidth(pc.img)/2 And mx&lt;pc.x + ImageWidth(pc.img)/2 And my&gt;pc.y-40 And my&lt;pc.y+40 Then 
				For a:bbcreature = EachIn creature_list
					If a.hp&gt;0 And a.cat&lt;100 Then a.waitcount = a.waitcount + 1
					If a.waitcount &gt; 3 Then a.waitcount = 3
					If a.stunned &gt; 0 Then 
						a.stunned = a.stunned - 1
					EndIf 
				Next
				acted = True
				If pc.cat = CAT_FIGHTER And pc.stunned &lt;=0
					pc.attacktime = 30
					For a:bbcreature = EachIn creature_list
						If a.cat &gt;= 100 And a.hp &gt; 0 Then 
							dieroll = Rand(1,1000)
							If dieroll &lt; pc.skill Then 
								If a.ethereal Then 'reduced damage to ethereals.
								a.hp = a.hp - pc.damage/3
								Else
									a.hp = a.hp - pc.damage
								EndIf
								a.strucktime = 10
								'centaur goes berserk
								If a.cat = 108 Then a.berserk = 3
							EndIf 
						EndIf 
					Next
					pc.waitcount = 0
				EndIf
				If pc.cat = CAT_RANGER And pc.stunned &lt;=0
					maxhp = 0
					b:bbcreature = Null'
					pc.attacktime = 30
					For a:bbcreature = EachIn creature_list
						If a.cat &gt;= 100 And a.hp &gt; 0 Then 
							If a.hp &gt; maxhp Then 
								maxhp = a.hp
								b:bbcreature = a:bbcreature
							EndIf 
						EndIf 
					Next
					If b:bbcreature&lt;&gt;Null Then 
						dieroll = Rand(1,1000)
						If dieroll &lt; pc.skill Then 
							If b.ethereal Then 'reduced damage to ethereals
								b.hp = b.hp - pc.damage * (1 + pc.waitcount)/3
							Else
								b.hp = b.hp - pc.damage * (1 + pc.waitcount)
							EndIf 
							b.strucktime = 15
							If b.cat = 108 Then b.berserk = 3
						EndIf 
					EndIf 
					pc.waitcount = 0
				EndIf
				If pc.cat = CAT_WIZARD And pc.stunned&lt;=0
					pc.attacktime = 30
					damage = pc.damage * (pc.waitcount+1)
					For a:bbcreature = EachIn creature_list
						If a.cat &gt;= 100 And a.hp &gt; 0 Then 
							dieroll = Rand(1,1000)
							If dieroll &lt; pc.skill Then 
								a.hp = a.hp - damage
								If a.ethereal Then 
									a.hp = a.hp - damage 'extra damage to ethereals
								EndIf 
								a.lightningtime = 30
								a.strucktime = 20
								If a.cat = 108 Then a.berserk = 3
							Else
								pc.hp = pc.hp - 5 ' bad spell casting inflicts damage to caster
								pc.lightningtime = 30
								Exit
							EndIf 
						EndIf 
					Next
					pc.waitcount = 0
				EndIf
				If pc.cat = CAT_CLERIC And pc.stunned &lt;=0
					pc.attacktime = 30
					damage = pc.damage * (pc.waitcount + 1)
					For a:bbcreature = EachIn creature_list
						If a.cat &lt; 100 And a.hp &lt; a.fullhp And a.hp &gt; 0 Then 
							a.hp = a.hp + damage
							a.healingtime = 60
							If a.hp &gt; a.fullhp Then a.hp = a.fullhp
						EndIf 
					Next
					pc.waitcount = 0
				EndIf	
			EndIf 
		EndIf 
	Next
EndIf 
If acted
	'perform poison
	For pc:bbcreature = EachIn creature_list
		If pc.hp &gt; 0 And pc.poison &gt; 0 And pc.cat &lt; 100 Then 
			pc.hp = pc.hp - pc.poison
			pc.strucktime = 10
			dieroll = Rand(1,1000)
			If dieroll &lt; pc.defenseskill Then 
				pc.poison = 0
			EndIf 
		EndIf 
		If pc.hp &gt; 0 And pc.cat &lt; 100 And pc.cursed &gt; 0 Then 
			pc.cursed = pc.cursed - 1
		EndIf 
	Next
	For a:bbcreature = EachIn creature_list
		If a.hp &gt; 0 And a.cat &gt;= 100 Then 
			If a.cat = 113 Or a.cat = 114 'necromancer summons skeletons and liche, liche and skeleton also make skeletons go berserk
				For b:bbcreature = EachIn creature_list
					If b.hp&gt;0 And b.cat = 111 Then 
						dieroll = Rand(1,1000)
						If dieroll &lt; a.skill Then 
							b.berserk = b.berserk + Rand(0,2)
						EndIf
					EndIf 
					If a.cat = 114 Then 
						If b.hp &gt; 0 And b.hp &lt; b.fullhp And b.cat = 111 Then 
							dieroll = Rand(1,1000)
							If dieroll &lt; a.skill Then 
								b.hp = b.hp + 5
								b.healingtime = 60
							EndIf 
						EndIf
						If b.cat &lt; 100 And b.hp &gt; 0 Then 
							dieroll = Rand(1,1000)
							If dieroll &lt; a.skill Then 
								b.cursed = b.cursed + Rand(0,2)
							EndIf 
						EndIf 
					EndIf  
					If b.hp&lt;=0 And b.cat &gt;= 100 Then 
						dieroll = Rand(1,1000)
						If dieroll &lt; a.skill Then 
							createskeleton(b:bbcreature)
						EndIf 
					EndIf
				Next
			EndIf 
			count = 0
			If a.regenerate And a.hp &lt; a.fullhp Then 
				diff = (a.fullhp - a.hp) / 2
				a.hp = a.hp + diff
			EndIf 
			For pc:bbcreature = EachIn creature_list
				If pc.cat &lt; 100 And pc.hp &gt; 0 Then count = count + 1
			Next
			If count &gt; 0 Then 
				count = Rand(1,count)
				For pc:bbcreature = EachIn creature_list
					If pc.cat &lt; 100 And pc.hp &gt; 0 Then count = count - 1
					If count = 0 Then 
						dieroll = Rand(1,1000)
						If a.cat = 103 Then 'goblin shaman
							If dieroll &lt; a.skill Then 
								pc.hp = pc.hp - a.damage
								pc.strucktime = 10
								a.attacktime = 30
								pc.lightningtime = 30
							EndIf
						ElseIf a.cat = 106 Then 'spider wizard
							If dieroll &lt; a.skill Then 
								pc.stunned = Rand(1,2)
								dieroll2 = Rand(1,1000)
								If dieroll2 &gt; pc.defenseskill Then 
									pc.hp = pc.hp - a.damage
									pc.strucktime = 10
									a.attacktime = 30
								EndIf
								Exit
							EndIf 
						ElseIf a.cat = 107 Then 'spider queen
							If dieroll &lt; a.skill Then 
								For c:bbcreature = EachIn creature_list
									If c.cat &gt;= 100 And c.hp &gt; 0 And c.hp &lt; c.fullhp
										c.healingtime = 60
										c.hp = c.hp + a.damage
										Exit 
									EndIf 
								Next
								dieroll2 = Rand(1,1000)
								If pc.cursed Then dieroll2 = dieroll2 * 1.5
								If dieroll2 &gt; pc.defenseskill Then 
									pc.hp = pc.hp - a.damage
									pc.strucktime = 10
									a.attacktime = 30
								EndIf
								If pc.cat = CAT_WIZARD Or pc.cat = CAT_CLERIC
									pc.waitcount = 0
									Exit 
								EndIf
							EndIf 
							If pc.cursed Then dieroll = dieroll * 1.5
							If dieroll &gt; pc.defenseskill Then 
								pc.hp = pc.hp - a.damage
								pc.strucktime = 10
								a.attacktime = 30
							EndIf
							Exit
						Else
							If pc.cursed Then dieroll = dieroll * 1.5
							If dieroll &gt; pc.defenseskill Then 
								pc.hp = pc.hp - a.damage
								pc.strucktime = 10
								a.attacktime = 30
								If a.poison &gt; 0 Then 
									pc.poison = a.poison
								EndIf 
							EndIf
							If a.berserk &gt; 0 Then 
								a.berserk = a.berserk - 1
								'second attack
								dieroll = Rand(1,1000)
								If pc.cursed Then dieroll = dieroll * 1.5
								If dieroll &gt; pc.defenseskill Then 
									pc.hp = pc.hp - a.damage
									pc.strucktime = 10
									a.attacktime = 30
									If a.poison &gt; 0 Then 
										pc.poison = a.poison
									EndIf 
								EndIf
							EndIf 
							If a.cat = 110 Then 
								dieroll = Rand(1,1000)
								If dieroll &lt; a.skill Then 
									pc.cursed = Rand(1,3)
								EndIf
							EndIf 
							Exit
						EndIf  
					EndIf 
				Next
				
			EndIf 
		EndIf 
	Next
EndIf
End Function

Function updategame()
'move all creatures
'move all bullets
'handle all collisions
'handle all pick ups
'handle all combat
'handle all spell casting (magic missiles and healing)

found = False

For pc:bbcreature = EachIn creature_list
	If pc.strucktime &gt; 0 Then 
		pc.strucktime = pc.strucktime - 1
		createbloodparticle(pc.x,pc.y)
		If pc.hp &lt;= 0 Then 
			createbloodparticle(pc.x,pc.y)
			createbloodparticle(pc.x,pc.y)
			createbloodparticle(pc.x,pc.y)
		EndIf 
	EndIf 
	If pc.hp&gt;0 Then 
		If pc.cursed &gt; 0 Then 
			createcurseparticle(pc.x,pc.y+40)
		EndIf 
		If pc.berserk &gt; 0 Then 
			createberserkparticle(pc.x,pc.y+40)
		EndIf 
		If pc.cat &gt;= 100 Then 
			found = True
		EndIf
	Else
		pc.Remove()
	EndIf 
Next
If found = False Then 
	levelfinishtime = levelfinishtime + 1
EndIf 
foundp = False
For pc:bbcreature = EachIn creature_list
	If pc.hp &gt; 0 And pc.cat &lt; 100 Then foundp = True;Exit 
Next
If foundp = False Then 
	levelfinishtime = levelfinishtime + 1
EndIf 
If levelfinishtime &gt; 250 Then 
	gamemode = MODE_MENU 'eventually change to mode_upgrade
	If foundp Then gamemode = MODE_UPGRADE
	If Not(foundp) Then 
		gamelevel = 999
		gamemode = MODE_CUTSCENE
	Else
		gamelevel = gamelevel + 1
		ftrpicked = False
		clrpicked = False
		rngpicked = False
		wizpicked = False 
	EndIf 
EndIf 

For pc:bbcreature = EachIn creature_list
	If pc.hp &gt; 0 Then 
		If pc.healingtime &gt; 0 Then pc.healingtime = pc.healingtime - 1
	EndIf 
Next
updateparticle()
End Function

Function drawgame()
'draw background (fixed static 1280x720 image background)
'draw all creatures - don't worry about zordering them - it will be too fast to notice 
'draw all bullets
For img:bbimages = EachIn images_list
	If img.cat = 2007 'change this later
		DrawImage img.img,0,0
	EndIf
Next
For pc:bbcreature = EachIn creature_list
	If pc.hp &gt; 0 Then
		aa# = 0
		bb# = 0
		If pc.attacktime &gt; 0 Then 
			pc.attacktime = pc.attacktime - 1
			aa# = -25.0 * Sin(pc.attacktime * 6)
			If pc.cat&gt;=100 Then aa = aa * -1.0
		EndIf 
		If pc.strucktime &gt; 0 Then 
			bb = Rand(-pc.strucktime/2,pc.strucktime/2)
		EndIf 
		If pc.poison &gt; 0 And pc.cat &lt; 100 Then 
			For img:bbimages = EachIn images_list
				If img.cat = 119 Then 
					DrawImage img.img,pc.x - ImageWidth(pc.img)/2,pc.y-40
					Exit
				EndIf 
			Next
			'Color 32,255,32
			'Oval pc\x - ImageWidth(pc\img)/2,pc\y-40,ImageWidth(pc\img),80,1
		EndIf 
		DrawImage pc.img,bb + pc.x - ImageWidth(pc.img)/2,pc.y - 40 + aa
		dhp = 10 * pc.hp / pc.fullhp
		If dhp &lt; 4 Then SetColor 255,32,32
		If dhp &gt;=4 And dhp&lt;8 Then SetColor 255,255,32
		If dhp &gt;=8 Then SetColor 32,255,32
		If dhp = 0 Then dhp = 1
		For hp = 1 To dhp
			DrawRect hp*4 + pc.x - ImageWidth(pc.img)/3,pc.y - 50,3,3',1
		Next
		SetColor 255,255,255
		If pc.healingtime &gt; 0 Then 
			createhealparticle(pc.x,pc.y)
		EndIf 
		SetColor 255,255,255
		If pc.summonedtime &gt; 0 Then 
			pc.summonedtime = pc.summonedtime - 1
			createsummonparticle(pc.x,pc.y)
		EndIf 
		SetColor 255,255,255
		If pc.lightningtime &gt; 0 Then 
			pc.lightningtime = pc.lightningtime - 1
			drawlightning(pc.x,pc.y)
		EndIf 
		SetColor 255,255,255
		If pc.waitcount &gt; 0 Then 
			SetColor 255,32,255
			For i = 1 To pc.waitcount
				DrawRect i * 4 + pc.x - ImageWidth(pc.img)/3,pc.y - 55,3,3',1
			Next
		EndIf 
		SetColor 255,255,255
		If pc.stunned &gt; 0 And pc.cat &lt; 100 Then 
			'Color 255,255,32
			'Oval pc\x - ImageWidth(pc\img)/2,pc\y-40,ImageWidth(pc\img),80,0
			For img:bbimages = EachIn images_list
				If img.cat = 118 Then 
					DrawImage img.img, pc.x - ImageWidth(pc.img)/2,pc.y-40
					Exit
				EndIf 
			Next
		EndIf 
	EndIf
Next
drawparticle()
SetColor 255,255,255
For img:bbimages = EachIn images_list
	If img.cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img.img,mx,my
	EndIf
Next
SetColor 255,255,255
End Function 

Function drawlightning(x,y)
iy = 0
ix = x + Rand(-20,20)
While iy &lt; y
	oy = iy
	ox = ix
	ix = x + Rand(-20,20)
	iy = iy + Rand(10,25)
	SetColor 200,200,255
	DrawLine ox,oy,ix,iy
	SetColor 150,150,200
	DrawLine ox+1,oy+1,ix+1,iy+1
	DrawLine ox-1,oy-1,ix-1,iy-1
	SetColor 100,100,150
	DrawLine ox+2,oy+2,ix+2,iy+2
	DrawLine ox-2,oy-2,ix-2,iy-2
	SetColor 32,32,90
	DrawLine ox+3,oy+3,ix+3,iy+3
	DrawLine ox-3,oy-3,ix-3,iy-3
Wend 
SetColor 255,255,255
End Function 

Function handlecutscene()
'handle transitions,  handle skip button; 
'handle fading in and out text (bitmap fonts?)
If gamelevel = 1 Or gamelevel = 4 Or gamelevel = 8 Or gamelevel = 11 Or gamelevel = 14 Or gamelevel = 999 Then
	
Else
	initlevel()
	gamemode = MODE_COMBAT
EndIf 
';
If lmb&lt;&gt;0 And olmb = 0 Then 
	If mx&gt;1000 And mx&lt;1200 And my&gt;650 And my&lt;700 Then 
		If gamelevel &lt; 14 Then 
			initlevel()
			gamemode = MODE_COMBAT
		Else
			gamemode = MODE_MENU 'includes 999 (game over)
		EndIf
	EndIf 
EndIf 
';
End Function 

Function drawcutscene()
'draw cut scene background, draw transition, draw skip button
If gamelevel = 1 Or gamelevel = 4 Or gamelevel = 8 Or gamelevel = 11 Or gamelevel = 14 Or gamelevel = 999 Then
Else
	Return
EndIf
For img:bbimages = EachIn images_list
	If (img.cat = 2004 And gamelevel = 1) Or (img.cat = 2005 And gamelevel = 4) Or (img.cat = 2006 And gamelevel = 8) Or (img.cat = 2008 And gamelevel = 11) Or (img.cat = 2009 And gamelevel = 14) Or (img.cat = 2010 And gamelevel = 999) Then 
		DrawImage img.img,0,0
	EndIf 
Next
';
For img:bbimages = EachIn images_list
	If img.cat = CAT_MENU_SKIP_CUTSCENE
		DrawImage img.img,1000,650
	EndIf
Next
';
For img:bbimages = EachIn images_list
	If img.cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img.img,mx,my
	EndIf
Next
';
End Function 

Function handleupgrade()
'handle button press 'add stuff' to characters
'
'
'
If lmb&lt;&gt;0 And olmb = 0Then 
	If mx &gt; 1000 And mx&lt;1200 And my&gt;650 And my &lt;700
		gamemode = MODE_CUTSCENE
		FlushMouse()
	EndIf
	i = -1
	For pc:bbcreature = EachIn creature_list
		If pc.cat &lt; 100 And pc.hp &gt; 0 Then 
			i = i + 1
			y = 100 * i + 200
			DrawImage pc.img,100,y
			If pc.cat = CAT_FIGHTER And (Not ftrpicked)
				If mx&gt;200 And mx &lt; 400 And my &gt; y And my &lt; y + 50 Then 
					'health picked
					ftrpicked = True
					pc.fullhp = pc.fullhp + 10
				EndIf 
				If mx&gt;450 And mx &lt; 650 And my &gt; y And my &lt; y + 50 Then 
					'damage picked
					ftrpicked = True
					pc.damage = pc.damage + 4
				EndIf 
				
				If mx&gt;700 And mx &lt; 900 And my &gt; y And my &lt; y + 50 Then 
					'skill picked
					ftrpicked = True
					ds# = (1000 - pc.skill) * 0.95
					pc.skill = 1000 - ds
				EndIf 
				
				If mx&gt;950 And mx &lt; 1150 And my &gt; y And my &lt; y + 50 Then 
					'def picked
					ftrpicked = True
					ds# = (1000 - pc.defenseskill) * 0.95
					pc.defenseskill = 1000 - ds
				EndIf 
			EndIf
			If pc.cat = CAT_RANGER And (Not rngpicked)
				If mx&gt;200 And mx &lt; 400 And my &gt; y And my &lt; y + 50 Then 
					'health picked
					rngpicked = True
					pc.fullhp = pc.fullhp + 10
				EndIf 
				If mx&gt;450 And mx &lt; 650 And my &gt; y And my &lt; y + 50 Then 
					'damage picked
					rngpicked = True
					pc.damage = pc.damage + 4
				EndIf 
				
				If mx&gt;700 And mx &lt; 900 And my &gt; y And my &lt; y + 50 Then 
					'skill picked
					rngpicked = True
					ds# = (1000 - pc.skill) * 0.95
					pc.skill = 1000 - ds
				EndIf 
				
				If mx&gt;950 And mx &lt; 1150 And my &gt; y And my &lt; y + 50 Then 
					'def picked
					rngpicked = True
					ds# = (1000 - pc.defenseskill) * 0.95
					pc.defenseskill = 1000 - ds
				EndIf 
			
			EndIf
			If pc.cat = CAT_WIZARD And (Not wizpicked)
				If mx&gt;200 And mx &lt; 400 And my &gt; y And my &lt; y + 50 Then 
					'health picked
					wizpicked = True
					pc.fullhp = pc.fullhp + 10
				EndIf 
				If mx&gt;450 And mx &lt; 650 And my &gt; y And my &lt; y + 50 Then 
					'damage picked
					wizpicked = True
					pc.damage = pc.damage + 4
				EndIf 
				
				If mx&gt;700 And mx &lt; 900 And my &gt; y And my &lt; y + 50 Then 
					'skill picked
					wizpicked = True
					ds# = (1000 - pc.skill) * 0.95
					pc.skill = 1000 - ds
				EndIf 
				
				If mx&gt;950 And mx &lt; 1150 And my &gt; y And my &lt; y + 50 Then 
					'def picked
					wizpicked = True
					ds# = (1000 - pc.defenseskill) * 0.95
					pc.defenseskill = 1000 - ds
				EndIf 

			EndIf
			If pc.cat = CAT_CLERIC And (Not clrpicked)
				If mx&gt;200 And mx &lt; 400 And my &gt; y And my &lt; y + 50 Then 
					'health picked
					clrpicked = True
					pc.fullhp = pc.fullhp + 10
				EndIf 
				If mx&gt;450 And mx &lt; 650 And my &gt; y And my &lt; y + 50 Then 
					'damage picked
					clrpicked = True
					pc.damage = pc.damage + 4
				EndIf 
				If mx&gt;700 And mx &lt; 900 And my &gt; y And my &lt; y + 50 Then 
					'skill picked
					clrpicked = True
					ds# = (1000 - pc.skill) * 0.95
					pc.skill = 1000 - ds
				EndIf 
				If mx&gt;950 And mx &lt; 1150 And my &gt; y And my &lt; y + 50 Then 
					'def picked
					clrpicked = True
					ds# = (1000 - pc.defenseskill) * 0.95
					pc.defenseskill = 1000 - ds
				EndIf 
			EndIf 
		EndIf 
	Next
EndIf
End Function

Function drawupgrade()
'draw background
'draw buttons
'draw characters
'draw stats
'draw continue button
For img:bbimages = EachIn images_list
	If img.cat = 2012 Then 
		DrawImage img.img,0,0
	EndIf 
Next

i=-1
For pc:bbcreature = EachIn creature_list
	If pc.cat &lt; 100 And pc.hp &gt; 0 Then 
		pc.hp = pc.fullhp
		i = i + 1
		y = 100 * i + 200
		SetColor 96,96,80
		DrawRect 50,y - 5,1180,90',1
		DrawImage pc.img,100,y
	'	Text 150,i*100+200,"Skill:"+pc\skill+" Defense:"+pc\defenseskill + " Health:"+pc\fullhp + " Power:"+pc\damage
	    SetColor 255,255,255
		If pc.cat = CAT_FIGHTER
			For img:bbimages = EachIn images_list
				If img.cat = CAT_MENU_ADD_HEALTH Then
					If (Not ftrpicked) DrawImage img.img,200,y
					'Text 300,y + 65,pc\fullhp,1,1
					drawnumber(300,y + 65,pc.fullhp)
				EndIf
				If img.cat = CAT_MENU_ADD_DAMAGE Then
					If (Not ftrpicked) 	DrawImage img.img,450,y
					'Text 550,y + 65,pc\damage,1,1
					drawnumber(550,y + 65,pc.damage)
				EndIf
				If img.cat = CAT_MENU_ADD_SKILL Then
					If (Not ftrpicked) 	DrawImage img.img,700,y
					'Text 800,y + 65,pc\skill,1,1
					drawnumber(800,y + 65,pc.skill * 100 / 1000)
				EndIf
				If img.cat = CAT_MENU_ADD_DEF Then 
					If (Not ftrpicked) 	DrawImage img.img,950,y
					'Text 1050,y + 65,pc\defenseskill,1,1
					drawnumber(1050,y + 65,pc.defenseskill * 100 / 1000)
				EndIf 
			Next
		EndIf
		If pc.cat = CAT_RANGER 
			For img:bbimages = EachIn images_list
				If img.cat = CAT_MENU_ADD_HEALTH Then
					If (Not rngpicked) DrawImage img.img,200,y
					'Text 300,y + 65,pc\fullhp,1,1
					drawnumber(300,y + 65,pc.fullhp)
				EndIf
				If img.cat = CAT_MENU_ADD_DAMAGE Then
					If (Not rngpicked) DrawImage img.img,450,y
					'Text 550,y + 65,pc\damage,1,1
					drawnumber(550,y + 65,pc.damage)
				EndIf
				If img.cat = CAT_MENU_ADD_SKILL Then
					If (Not rngpicked) DrawImage img.img,700,y
					'Text 800,y + 65,pc\skill,1,1
					drawnumber(800,y + 65,pc.skill * 100 / 1000)
				EndIf
				If img.cat = CAT_MENU_ADD_DEF Then 
					If (Not rngpicked) DrawImage img.img,950,y
					'Text 1050,y + 65,pc\defenseskill,1,1
					drawnumber(1050,y + 65,pc.defenseskill * 100 / 1000)
				EndIf 
			Next
		
		EndIf
		If pc.cat = CAT_WIZARD 
			For img:bbimages = EachIn images_list
				If img.cat = CAT_MENU_ADD_HEALTH Then
					If (Not wizpicked) DrawImage img.img,200,y
'					Text 300,y + 65,pc\fullhp,1,1
					drawnumber(300,y + 65,pc.fullhp)
				EndIf
				If img.cat = CAT_MENU_ADD_DAMAGE Then
					If (Not wizpicked)  DrawImage img.img,450,y
					'Text 550,y + 65,pc\damage,1,1
					drawnumber(550,y + 65,pc.damage)
				EndIf
				If img.cat = CAT_MENU_ADD_SKILL Then
					If (Not wizpicked) DrawImage  img.img,700,y
					'Text 800,y + 65,pc\skill,1,1
					drawnumber(800,y + 65,pc.skill * 100 / 1000)
				EndIf
				If img.cat = CAT_MENU_ADD_DEF Then 
					If (Not wizpicked) DrawImage  img.img,950,y
					'Text 1050,y + 65,pc\defenseskill,1,1
					drawnumber(1050,y + 65,pc.defenseskill * 100 / 1000)
				EndIf 
			Next
		
		EndIf
		If pc.cat = CAT_CLERIC 
			For img:bbimages = EachIn images_list
				If img.cat = CAT_MENU_ADD_HEALTH Then
					If (Not clrpicked) DrawImage  img.img,200,y
					'Text 300,y + 65,pc\fullhp,1,1
					drawnumber(300,y + 65,pc.fullhp)
				EndIf
				If img.cat = CAT_MENU_ADD_DAMAGE Then
					If (Not clrpicked) 					DrawImage img.img,450,y
					'Text 550,y + 65,pc\damage,1,1
					drawnumber(550,y + 65,pc.damage)
				EndIf
				If img.cat = CAT_MENU_ADD_SKILL Then
					If (Not clrpicked) 					DrawImage img.img,700,y
					'Text 800,y + 65,pc\skill,1,1
					drawnumber(800,y + 65,pc.skill * 100 / 1000)
				EndIf
				If img.cat = CAT_MENU_ADD_DEF Then 
					If (Not clrpicked) 					DrawImage img.img,950,y
					'Text 1050,y + 65,pc\defenseskill,1,1
					drawnumber(1050,y + 65,pc.defenseskill * 100 / 1000)
				EndIf 
			Next
		
		EndIf 
	EndIf 
Next

For img:bbimages = EachIn images_list
	If img.cat = CAT_MENU_SKIP_CUTSCENE
		DrawImage img.img,1000,650
	EndIf
Next

For img:bbimages = EachIn images_list
	If img.cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img.img,mx,my
	EndIf
Next

End Function 

Function initstartgame()
gamelevel = 1
mapindex = 0
DeleteEach bb32
pc:bbcreature = New bbcreature
pc.fullhp = 90
pc.hp = 90
pc.cat = CAT_FIGHTER
pc.x = 600
pc.y = 300
pc.skill = 500
pc.defenseskill = 850
pc.damage = 15
For img:bbimages = EachIn images_list
	If img.cat = CAT_FIGHTER Then 
		pc.img = img.img
		Exit 
	EndIf 
Next
pc:bbcreature = New bbcreature
pc.fullhp = 75
pc.hp = 75
pc.cat = CAT_RANGER
pc.x = 640
pc.y = 300
pc.skill = 800
pc.defenseskill = 850
pc.damage = 50
For img:bbimages = EachIn images_list
	If img.cat = CAT_RANGER Then 
		pc.img = img.img
		Exit 
	EndIf 
Next
pc:bbcreature = New bbcreature
pc.fullhp = 45
pc.hp = 45
pc.cat = CAT_WIZARD
pc.x = 750
pc.y = 360
pc.skill = 650
pc.damage = 18
pc.defenseskill = 650
For img:bbimages = EachIn images_list
	If img.cat = CAT_WIZARD Then 
		pc.img = img.img
		Exit 
	EndIf 
Next
pc:bbcreature = New bbcreature
pc.fullhp = 60
pc.hp = 60
pc.cat = CAT_CLERIC
pc.x = 640
pc.defenseskill = 800
pc.y = 350
pc.skill = 100
pc.damage = 5
For img:bbimages = EachIn images_list
	If img.cat = CAT_CLERIC Then 
		pc.img = img.img
		Exit 
	EndIf 
Next
End Function 

Function initlevel()
For pc:bbcreature = EachIn creature_list
	If pc.hp &gt; 0 And pc.hp &lt; pc.fullhp Then pc.hp = pc.fullhp
	If pc.cat = CAT_FIGHTER
		pc.x = 540
		pc.y = 350
	EndIf
	If pc.cat = CAT_RANGER
		pc.x = 720
		pc.y = 350
	EndIf
	If pc.cat = CAT_WIZARD
		pc.x = 540
		pc.y = 440
	EndIf
	If pc.cat = CAT_CLERIC
		pc.x = 720
		pc.y = 440
	EndIf
	If pc.cat &gt;=100 Then pc.Remove()
Next

For i = 1 To 8
	pc:bbcreature = New bbcreature
	If i &lt; 5 Then 
		pc.x = 360 + (i-1) * 180'Rand(0,SW)
		pc.y = 180 'Rand(0,SH)
	Else
		pc.x = 450 + (i-5) * 180'Rand(0,SW)
		pc.y = 225 'Rand(0,SH)
	
	EndIf
	
	If gamelevel = 1 Then 
	pc.cat = 100+Rand(0,1)
	pc.hp = 70
	pc.fullhp = 50
	pc.damage = 5
	pc.skill = 80
	EndIf
	If gamelevel = 2 Then 
		'trolls2
		If i = 1 Or i = 8 Then 
			pc.cat = 102
			pc.hp = 200
			pc.regenerate = True
			pc.fullhp = 200
			pc.damage = 10
			pc.skill = 150
		Else
			pc.cat = 100+Rand(0,1)
			pc.hp = 70
			pc.fullhp = 50
			pc.damage = 5
			pc.skill = 80
		EndIf 
	EndIf 
	If gamelevel = 3 Then 
		'wizard and troll
		If i = 1 Or i = 8 Then
			pc.cat = 102
			pc.hp = 200
			pc.regenerate = True
			pc.fullhp = 200
			pc.damage = 10
			pc.skill = 150
		ElseIf i = 4 Then
			pc.cat = 103
			pc.hp = 100
			pc.fullhp = 100
			pc.damage = 5
			pc.skill = 350
		Else
			pc.cat = 100+Rand(0,1)
			pc.hp = 70
			pc.fullhp = 50
			pc.damage = 5
			pc.skill = 80
		EndIf 
	EndIf
	If gamelevel = 4 Then
		'spiderbeasts and giant spiders
		If i = 1 Or i = 8 Then 
			pc.cat = 104
			pc.hp = 150
			pc.poison = 15
			pc.regenerate = True
			pc.fullhp = 150
			pc.damage = 15
			pc.skill = 100
		Else
			pc.cat = 105
			pc.hp = 100
			pc.fullhp = 100
			pc.damage = 8
			pc.skill = 150
		EndIf 

	EndIf
	If gamelevel = 5 Then 
		'spiderbeasts, giant spiders and spider wizards
		If i = 1 Or i = 8 Then 
			pc.cat = 104
			pc.hp = 150
			pc.poison = 15
			pc.regenerate = True
			pc.fullhp = 150
			pc.damage = 15
			pc.skill = 100
		ElseIf i = 2 Or i = 7
			pc.cat = 106
			pc.hp = 100
			pc.fullhp = 100
			pc.damage = 8
			pc.skill = 300
		Else
			pc.cat = 105
			pc.hp = 100
			pc.fullhp = 100
			pc.damage = 8
			pc.skill = 150
		EndIf 


	EndIf 
	If gamelevel = 6 Then 
		'spider queens and spiderbeasts
		If i = 1 Or i = 8 Then 
			pc.cat = 107
			pc.hp = 100
			pc.fullhp = 100
			pc.damage = 5
			pc.skill = 450
		Else
			pc.cat = 105
			pc.hp = 100
			pc.fullhp = 100
			pc.damage = 8
			pc.skill = 150
		EndIf 
	EndIf 
	If gamelevel = 7 Then 
		'spider queens and giant spiders and spider wizards
		If i = 4 Or i = 5 Then 
			pc.cat = 107
			pc.hp = 100
			pc.fullhp = 100
			pc.damage = 5
			pc.skill = 450
		ElseIf i = 2 Or i = 7
			pc.cat = 106
			pc.hp = 100
			pc.fullhp = 100
			pc.damage = 8
			pc.skill = 300
		Else
			pc.cat = 104
			pc.hp = 150
			pc.regenerate = True
			pc.poison = 15
			pc.fullhp = 150
			pc.damage = 15
			pc.skill = 100
		EndIf 
	EndIf 
	'beasts
	If gamelevel = 8 Then 
		If i = 2 Or i = 6 Or i = 4
			'centaur
			pc.cat = 108
			pc.hp = 200
			pc.fullhp = 200
			pc.damage = 10
			pc.skill = 150
		Else
			'grunt
			pc.cat = 109
			pc.hp = 90
			pc.fullhp = 90
			pc.damage = 20
			pc.skill = 150
		EndIf
	EndIf
	If gamelevel = 9 Then
		If i = 3 Or i = 5 Then
			'shaman
			pc.cat = 110
			pc.hp = 180
			pc.fullhp = 180
			pc.damage = 15
			pc.skill = 250
		Else
			'grunt
			pc.cat = 109
			pc.hp = 90
			pc.fullhp = 90
			pc.damage = 20
			pc.skill = 150

		EndIf
	EndIf
	If gamelevel = 10 Then 
		If i = 1 Or i = 8 Then
			'shaman
			pc.cat = 110
			pc.hp = 180
			pc.fullhp = 180
			pc.damage = 15
			pc.skill = 250
		ElseIf i = 2 Or i = 7 Or i = 4 Then
			'centaur
			pc.cat = 108
			pc.hp = 200
			pc.fullhp = 200
			pc.damage = 10
			pc.skill = 150
		Else
			'grunt
			pc.cat = 109
			pc.hp = 90
			pc.fullhp = 90
			pc.damage = 20
			pc.skill = 150
		EndIf
	EndIf 
	If gamelevel = 11 Then
		If i = 4 Then
			'necromancer
			pc.cat = 113
			pc.hp = 200
			pc.fullhp = 200
			pc.damage = 20
			pc.skill = 250
		ElseIf i = 5 Then 
			'wraith
			pc.cat = 112
			pc.hp = 200
			pc.ethereal = True
			pc.fullhp = 200
			pc.damage = 15
			pc.skill = 300
		Else
			'skeleton
			pc.cat = 111
			pc.hp = 20
			pc.fullhp = 20
			pc.damage = 10
			pc.skill = 150
		EndIf
	EndIf
	If gamelevel = 12 Then 
		If i = 5 Or i = 7 Then 
			'necromancer
			pc.cat = 113
			pc.hp = 200
			pc.fullhp = 200
			pc.damage = 20
			pc.skill = 250

		ElseIf i = 4 Or i = 6
			'wraith
			pc.cat = 112
			pc.hp = 200
			pc.ethereal = True
			pc.fullhp = 200
			pc.damage = 15
			pc.skill = 300
		Else
			'skeleton
			pc.cat = 111
			pc.hp = 20
			pc.fullhp = 20
			pc.damage = 10
			pc.skill = 150
		EndIf
	EndIf
	If gamelevel = 13 Then 
		If i = 1 Then 
			'liche
			pc.cat = 114
			pc.hp = 300
			pc.fullhp = 300
			pc.damage = 20
			pc.skill = 350
		ElseIf i = 2 Or i = 3 Then 
			'necromancer
			pc.cat = 113
			pc.hp = 200
			pc.fullhp = 200
			pc.damage = 20
			pc.skill = 250
		ElseIf i = 4 Or i = 5 Then 
			'wraith
			pc.cat = 112
			pc.hp = 200
			pc.fullhp = 200
			pc.damage = 15
			pc.skill = 300
			pc.ethereal = True
		Else
			'skeletons
			pc.cat = 111
			pc.hp = 20
			pc.fullhp = 20
			pc.damage = 10
			pc.skill = 150
		EndIf
	EndIf 
	For img:bbimages = EachIn images_list
		If img.cat = pc.cat Then 
			pc.img = img.img
			Exit 
		EndIf 
	Next
Next

lmb = 0
olmb = 0
FlushMouse()
levelfinishtime = 0
End Function 

Function createskeleton:bbcreature(pc:bbcreature)
x = pc.x
y = pc.y
pc.Remove()
pc:bbcreature = New bbcreature
			pc.cat = 111
			pc.strucktime = 10
			For img:bbimages = EachIn images_list
				If img.cat = pc.cat Then pc.img = img.img;Exit 
			Next
			pc.hp = 20
			pc.x = x
			pc.y = y
			pc.fullhp = 20
			pc.damage = 10
			pc.skill = 150
			pc.regenerate = False
			pc.ethereal = False
			pc.summonedtime = 25
			pc.berserk = 0
Return pc
End Function 

Function createhealparticle(x,y)

For i = 1 To 36
	p:bbparticle = New bbparticle
	p.life = 20
	p.x = x + 25.0 * Cos(i*10)
	p.y = y + 20 + 25.0 * (Sin(i*5))
	p.vx = 0
	p.vy = Rand(-4,-2)
	p.ay = 0.1
	p.gy = p.y + 100
	p.r = 32
	p.g = 200
	p.b = 255
	p.sz = 4
	p.dsz = -0.1
	p.dr = 10
	p.dg = 2
	p.db = 0
Next

End Function 

Function createsummonparticle(x,y)

For i = 1 To 36
	p:bbparticle = New bbparticle
	p.life = 20
	p.x = x + 25.0 * Cos(i*10)
	p.y = y + 20 + 25.0 * (Sin(i*5))
	p.vx = 0
	p.vy = Rand(-4,-2)
	p.ay = 0.1
	p.gy = p.y + 100
	p.r = 32
	p.g = 255
	p.b = 50
	p.sz = 4
	p.dsz = -0.1
	p.dr = 8
	p.dg = 0
	p.db = 8
Next

End Function 


Function createbloodparticle(x,y)

For i = 1 To 10
	p:bbparticle = New bbparticle
	p.life = 20
	p.x = x + Rand(-10,10)
	p.y = y + Rand(-10,10)
	p.vx = Rnd(-3,3)
	p.vy = Rnd(-3,3)
	p.ay = 0.05
	p.gy = y + 42
	p.r = 255
	p.g = 100
	p.b = 100
	p.dr = -2
	p.dg = -3
	p.db = -3
	p.sz = 4
	p.dsz = 0
Next

End Function 

Function createcurseparticle(x,y)
For i = 1 To 36
	p:bbparticle = New bbparticle
	p.life = 10+Rand(5)
	p.x = x +25 * Cos(i*10)
	p.y = y + 15.0 * Abs(Sin(i*10))
	p.vx = 0
	p.vy = Rand(-4,-2)
	p.ay = 0.1
	p.gy = p.y + 100
	p.r = 255
	p.g = 50
	p.b = 255
	p.sz = 4
	p.dsz = 0.25
	p.dr = 0
	p.dg = 22
	p.db = 0
Next
End Function 
Function createberserkparticle(x,y)
For i = 1 To 36
	p:bbparticle = New bbparticle
	p.life = 10+Rand(5)
	p.x = x +25 * Cos(i*10)
	p.y = y + 15.0 * Abs(Sin(i*10))
	p.vx = 0
	p.vy = Rand(-4,-2)
	p.ay = 0.1
	p.gy = p.y + 100
	p.r = 255
	p.g = 50
	p.b = 255
	p.sz = 4
	p.dsz = 0.25
	p.dr = 0
	p.dg = 22
	p.db = 0
Next



End Function 

Function updateparticle()
For p:bbparticle = EachIn particle_list
	p.life = p.life - 1
	p.x = p.x + p.vx
	p.y = p.y + p.vy
	p.vy = p.vy + p.ay
	If p.y &gt; p.gy Then 
		p.vy = p.vy * -0.7
		If Abs(p.vy)&lt;0.01 Then p.life = 0
	EndIf 
	p.sz = p.sz + p.dsz
	p.r = p.r + p.dr
	p.g = p.g + p.dg
	p.b = p.b + p.db
	If p.sz &lt; 0 Then p.sz = 0
	If p.r &gt; 255 Then p.r = 255
	If p.g &gt; 255 Then p.g = 255
	If p.b &gt; 255 Then p.b = 255
	If p.r &lt; 0 Then p.r = 0
	If p.g &lt; 0 Then p.g = 0
	If p.b &lt; 0 Then p.b = 0
	If p.life &lt; 0 Then p.Remove()
Next
End Function 

Function drawparticle()
For p:bbparticle = EachIn particle_list
	SetColor p.r,p.g,p.b
	DrawRect p.x,p.y,p.sz,p.sz',1
Next
SetColor 255,255,255
End Function 

Function drawnumber(x,y,num)
txt$ = String(num)
For i = 1 To Len(txt)
	digit = Int(Mid(txt,i,1))
	For img:bbimages = EachIn images_list
		If img.cat = 10000 + digit Then 
			DrawImage img.img,x + (i-1) * 50 - Len(txt) * 25,y - 25
			Exit
		EndIf
	Next
Next 
End Function 
</textarea> <br><br></td></tr></table><br>
<a name="1341398"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#96">[#96]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Rooster.  I'm going to stick with a blitz version for now.  I toyed with an android version and it loses somethimg on the small screen with a touch interface. <br><br></td></tr></table><br>
<a name="1341406"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#97">[#97]</a></td></tr></table></td></tr><tr ><td class="posttext"> Note.  I'm now not sure what I will do next for this.  It could do with some polish.  It will remain desktop only because I can't see it really working on mobile.  When I get to my PC I might play it some more to get a feel for it. <br><br>? <br><br></td></tr></table><br>
<a name="1341408"></a>

<a name="1341409"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#98">[#98]</a></td></tr></table></td></tr><tr ><td class="posttext"> Blitzplus/Blitz3d code -<br><br>change from previous:<br>Uses Rooster's image loading routine and also uses a similar routine for loading audio.<br><br>Graphics and Audio files in zip file included earlier but here again:<br><br><a href="http://www.mattiesgames.com/bbgame/game4.zip" target="_blank">Link</a><br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
;This is both a learning exercise and hopefully a collaborative project of sorts
;or at least a project I can share with others on the blitz forum.
;It will be written initially in blitzplus/blitz3d And maybe someone will be keen on
;porting it to blitzmax...even blitzmax-ng to release on mobile perhaps?
;
;Interface:
;Left mouse button clicking only to make porting to 
;mobile interface much, much easier.
;Gameplay Mechanic Has changed - turn based more detailed
;
;Gameplay mechanic so far (15-May-2017)
;
;1. Arcade Action RPG Combat
;	Player controls 4 characters in a single screen dungeon.
;	Dungeon has a few walls and so on that prevent movement.
;	Monsters spawn from spawners and make their way around the map
;	Player taps the screen to move to location and characters fight things
;	in their path.
;	Powerups exist in the level such as:
;	Health pickups
;	Bombs - kill all monsters that have spawned or at least damage them.
;	
;2. After the arcade sequence the player is presented with options to upgrade their
;	character's stats. Stats to upgrade include:
;	Combat skill ('to hit roll')
;	Damage output ('damage points')
;	Health points ('hp')
;	Movement speed ('move')
;3.	After this a short cut scene is presented which may simply be a scrolling static
;	image with some fading in/fading out text to advance the story line
;0. Menu - toggle audio, play, credits
;
;Character types:
;1 Fighter - high hitpoint melee combat medium damage
;2 Ranger - medium hitpoint melee combat high damage
;3 Wizard - low hitpoint, ranged combat, medium damage
;4 Cleric - medium hitpoint, no combat, healer
;


;constants
Const SW=1280,SH=720,WIN=2
Const MODE_MENU = 0
Const MODE_COMBAT = 1
Const MODE_UPGRADE = 2
Const MODE_CUTSCENE = 3
Const PURE_2D = True ;if go to blitzmax can use 2d-in-3d commands such as alpha otherwise have to calculate manually.Change to false for blitzmax.

;categories for image types and object types
Const CAT_MENU_PLAY = 0
Const CAT_MENU_AUDIO = 1
Const CAT_MENU_SKIP_CUTSCENE = 2 ;cut scene mode
Const CAT_MENU_ADD_SKILL = 3 ;upgrade mode
Const CAT_MENU_ADD_DAMAGE = 4;upgrade mode
Const CAT_MENU_ADD_HEALTH = 5;upgrade mode
;Const CAT_MENU_ADD_SPEED = 6;
Const CAT_MENU_ADD_DEF = 6
Const CAT_MENU_MOUSE_CURSOR = 7;
Const CAT_FIGHTER = 10
Const CAT_KNIGHT = 10 ;synonym
Const CAT_RANGER = 11
Const CAT_WIZARD = 12
Const CAT_CLERIC = 13
Const CAT_HEALER = 13 ;synonym
Const CAT_HEALTH_PICKUP = 20
Const CAT_BOMB_PICKUP = 21
;CAT_BACKGROUND = 2000-3000 ; all the different image backgrounds
;CAT_MONSTER = 100-1000 , all the different monster types
;CAT_NUMBERS = 10000-10009
;AUDIO CATEGORIES
Const CAT_MUSIC = 999
Const CAT_BADBUFF = 1
Const CAT_CLICK = 0
Const CAT_GOODBUFF = 2
Const CAT_HIT1 = 3
Const CAT_HIT2 = 4
Const CAT_SWING1 = 5
Const CAT_SWING2 = 6
Const CAT_SWING3 = 7
Const CAT_SWING4 = 8

;globals
Global mx,my,lmb,olmb ;mouse input
Global audiostate ;on/off
Global gamemode ;references const above
Global gamelevel ;for cutscenes
Global cutsceneframe ;for cutscenes ie trigger fades, text, motion etc on certain frames
Global levelfinishtime = 0
Global mapdelay ;timestamp
Global mapindex

Global ftrpicked,rngpicked,wizpicked,clrpicked ;boolean for upgrades

;types
Type images

Field img ;handle
Field midhandled ;boolean
Field cat ;category //hooks into creature template

End Type 

Type audio

Field cat ;category 
Field hnd
Field channel

End Type

type audiofx
field hnd
field time
end type

Type creature

Field img
Field cat
Field x#
Field y#
Field hp
Field fullhp
Field damage
Field skill

Field defenseskill ;for players

Field aimode
Field aidelay
Field aitime

Field moving ;boolean

Field healingtime ;for healing effect/buff effect
Field lightningtime ;for lightning blasts on creature effect
Field strucktime ;for blood effects
Field attacktime 

Field activated ;boolean
Field waitcount ;int

Field stunned ;int 0-n counts down each time active....
Field poison ;int 0-n = damage inflicted
Field regenerate ;boolean
Field cursed ;int 0-n //50% off defenseskill
Field berserk ;int
Field ethereal ;boolean
Field summonedtime ;int
End Type 


;new emitters and particles
Type particle

Field r,g,b,a
Field x#,y#,vx#,vy#,ay#,gy#
Field life
Field dr,dg,db,da
Field sz,dsz

End Type



main()

Function main()
	quit = False
	gamemode = MODE_MENU
	init()
	Repeat
		frametime = MilliSecs()
		Cls
		;input 
		mx = MouseX()
		my = MouseY()
		olmb = lmb
		lmb = MouseDown(1)
		Select gamemode
		
		Case MODE_MENU
			handlemenu()
			drawmenu()
		
		Case MODE_COMBAT
			handleinput()
			updategame()
			drawgame()
		Case MODE_CUTSCENE
			handlecutscene()
			drawcutscene()
		Case MODE_UPGRADE
			handleupgrade()
			drawupgrade()
		End Select
		updatefx()
		Flip
		;very basic frame limiting
		endframetime = MilliSecs()
		dtime = endframetime - frametime
		If dtime &lt; 15 Then 
			Delay 15 - dtime
		EndIf 
		;end of frame limiting
		If(KeyHit(1)) Then quit = True		
	Until quit
	;;;;;;
	End
End Function 

Function init()
AppTitle "Heroes of Dungonia"
Graphics SW,SH,0,WIN
;load data files
;load all images here
;load all sounds here
;load all music here
HidePointer 
audiostate = True

dir = ReadDir(CurrentDir()+"\audio")
Repeat
	file$ = NextFile(dir)
	If file="" Then Exit
	If Right(file,3) = "ogg" Then 
		aud.audio = New audio
		aud\hnd = LoadSound("audio\"+file)
		aud\cat = Int(Mid(file,7,3))
		If(aud\cat=999) Then 
			LoopSound aud\hnd
			aud\channel =PlaySound (aud\hnd)
		EndIf 
	EndIf 
Forever
CloseDir dir 

dir = ReadDir(CurrentDir()+"\images")
Repeat
	file$ = NextFile(dir)
	If file="" Then Exit
	If Right(file,3) = "jpg" Or Right(file,3) = "png" Then 
		img.images = New images
		img\img = LoadImage("images\"+file)
		img\cat = Int(Left(file,5))
		If Right(file,3)="png" Then 
			rgb = ReadPixel(0,0,ImageBuffer(img\img))
			r0 = (rgb Shr 16) And 255
			g0 = (rgb Shr 8) And 255
			b0 = (rgb And 255)
			MaskImage img\img,r0,g0,b0
		EndIf 
	EndIf 
Forever
CloseDir dir

End Function 

Function handlemenu()
;;;
;;;;
;;;Check if 'PLAY' pressed..if so then initialise
;first cut scene and change gamemode
;;;Check if 'TOGGLE AUDIO' pressed if so toggle music/audio flags

If lmb&lt;&gt;0 And olmb=0 Then 
	If mx&gt;=1000 And mx&lt;=1200 Then 
		If my&gt;550 And my&lt;600 Then 
			;play hit
			initstartgame()
			gamemode = MODE_CUTSCENE
			playfx(CAT_CLICK)
		EndIf 
		If my&gt;650 And my&lt;700 Then 
			audiostate = Not audiostate
			If  audiostate
				;start music
				playfx(CAT_CLICK)
				For aud.audio = Each audio
					If aud\cat = CAT_MUSIC
						If ChannelPlaying(aud\channel) Then 
						Else
							aud\channel = PlaySound(aud\hnd)
						EndIf 
					EndIf
				Next
			Else
				;stop
				For aud.audio = Each audio
					If aud\cat = CAT_MUSIC
						If ChannelPlaying(aud\channel) Then 
							StopChannel aud\channel
						Else
						EndIf 
					EndIf
				Next

			EndIf 
		EndIf 
	EndIf 
EndIf 


End Function

Function drawmenu()
;draw backdrop
;draw buttons in relevant state
;draw mouse cursor

For img.images = Each images
	If img\cat = 2011 Then 
		DrawBlock img\img,0,0
	EndIf 
Next

For img.images = Each images
	If img\cat = CAT_MENU_PLAY
		DrawImage img\img,1000,550
	EndIf
	If img\cat = CAT_MENU_AUDIO
		DrawImage img\img,1000,650
	EndIf
Next

For img.images = Each images
	If img\cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img\img,mx,my
	EndIf
Next

End Function

Function handleinput()
;assign tx,ty of creatures to player units
;
acted = False
If lmb&lt;&gt;0 And olmb = 0 Then 
	For pc.creature = Each creature
		If pc\hp&gt;0 And pc\cat&gt;=10 And pc\cat&lt;=13 Then 
			If mx&gt;pc\x - ImageWidth(pc\img)/2 And mx&lt;pc\x + ImageWidth(pc\img)/2 And my&gt;pc\y-40 And my&lt;pc\y+40 Then 
				For a.creature = Each creature
					If a\hp&gt;0 And a\cat&lt;100 Then a\waitcount = a\waitcount + 1
					If a\waitcount &gt; 3 Then a\waitcount = 3
					If a\stunned &gt; 0 Then 
						a\stunned = a\stunned - 1
					EndIf 
				Next
				acted = True
				If pc\cat = CAT_FIGHTER And pc\stunned &lt;=0
					pc\attacktime = 30
					playfx(CAT_SWING1+rand(0,3))
					For a.creature = Each creature
						If a\cat &gt;= 100 And a\hp &gt; 0 Then 
							dieroll = Rand(1,1000)
							If dieroll &lt; pc\skill Then 
								If a\ethereal Then ;reduced damage to ethereals.
								a\hp = a\hp - pc\damage/3
								Else
									a\hp = a\hp - pc\damage
								EndIf
								playfxdelayed(CAT_HIT1+Rand(0,1),50)
								a\strucktime = 10
								;centaur goes berserk
								If a\cat = 108 Then a\berserk = 3
							EndIf 
						EndIf 
					Next
					pc\waitcount = 0
				EndIf
				If pc\cat = CAT_RANGER And pc\stunned &lt;=0
					maxhp = 0
					b.creature = Null;
					pc\attacktime = 30
					playfx(CAT_SWING1+rand(0,3))
					For a.creature = Each creature
						If a\cat &gt;= 100 And a\hp &gt; 0 Then 
							If a\hp &gt; maxhp Then 
								maxhp = a\hp
								b.creature = a.creature
							EndIf 
						EndIf 
					Next
					If b.creature&lt;&gt;Null Then 
						dieroll = Rand(1,1000)
						If dieroll &lt; pc\skill Then 
							If b\ethereal Then ;reduced damage to ethereals
								b\hp = b\hp - pc\damage * (1 + pc\waitcount)/3
							Else
								b\hp = b\hp - pc\damage * (1 + pc\waitcount)
							EndIf 
							b\strucktime = 15
							playfxdelayed(CAT_HIT1+Rand(0,1),50)
							If b\cat = 108 Then b\berserk = 3
						EndIf 
					EndIf 
					pc\waitcount = 0
				EndIf
				If pc\cat = CAT_WIZARD And pc\stunned&lt;=0
					pc\attacktime = 30
					damage = pc\damage * (pc\waitcount+1)
					kk = 0
					playfx(CAT_GOODBUFF)
					For a.creature = Each creature
						If a\cat &gt;= 100 And a\hp &gt; 0 Then 
							dieroll = Rand(1,1000)
							If dieroll &lt; pc\skill Then 
								a\hp = a\hp - damage
								If a\ethereal Then 
									a\hp = a\hp - damage ;extra damage to ethereals
								EndIf 
								a\lightningtime = 30
								a\strucktime = 20
								kk = kk + 1
								playfxdelayed(CAT_HIT1+rand(0,1),kk * 10)
								If a\cat = 108 Then a\berserk = 3
							Else
								pc\hp = pc\hp - 5 ; bad spell casting inflicts damage to caster
								pc\lightningtime = 30
								Exit
							EndIf 
						EndIf 
					Next
					pc\waitcount = 0
				EndIf
				If pc\cat = CAT_CLERIC And pc\stunned &lt;=0
					pc\attacktime = 30
					damage = pc\damage * (pc\waitcount + 1)
					playfx(CAT_GOODBUFF)
					For a.creature = Each creature
						If a\cat &lt; 100 And a\hp &lt; a\fullhp And a\hp &gt; 0 Then 
							a\hp = a\hp + damage
							a\healingtime = 60
							If a\hp &gt; a\fullhp Then a\hp = a\fullhp
						EndIf 
					Next
					pc\waitcount = 0
				EndIf	
			EndIf 
		EndIf 
	Next
EndIf 
If acted
	;perform poison
	For pc.creature = Each creature
		If pc\hp &gt; 0 And pc\poison &gt; 0 And pc\cat &lt; 100 Then 
			pc\hp = pc\hp - pc\poison
			pc\strucktime = 10
			dieroll = rand(1,1000)
			If dieroll &lt; pc\defenseskill Then 
				pc\poison = 0
			EndIf 
		EndIf 
		If pc\hp &gt; 0 And pc\cat &lt; 100 And pc\cursed &gt; 0 Then 
			pc\cursed = pc\cursed - 1
		EndIf 
	Next
	For a.creature = Each creature
		If a\hp &gt; 0 And a\cat &gt;= 100 Then 
			If a\cat = 113 Or a\cat = 114 ;necromancer summons skeletons and liche, liche and skeleton also make skeletons go berserk
				For b.creature = Each creature
					If b\hp&gt;0 And b\cat = 111 Then 
						dieroll = Rand(1,1000)
						If dieroll &lt; a\skill Then 
							b\berserk = b\berserk + Rand(0,2)
						EndIf
					EndIf 
					If a\cat = 114 Then 
						If b\hp &gt; 0 And b\hp &lt; b\fullhp And b\cat = 111 Then 
							dieroll = Rand(1,1000)
							If dieroll &lt; a\skill Then 
								b\hp = b\hp + 5
								b\healingtime = 60
							EndIf 
						EndIf
						If b\cat &lt; 100 And b\hp &gt; 0 Then 
							dieroll = Rand(1,1000)
							If dieroll &lt; a\skill Then 
								b\cursed = b\cursed + Rand(0,2)
							EndIf 
						EndIf 
					EndIf  
					If b\hp&lt;=0 And b\cat &gt;= 100 Then 
						dieroll = Rand(1,1000)
						If dieroll &lt; a\skill Then 
							createskeleton(b.creature)
						EndIf 
					EndIf
				Next
			EndIf 
			count = 0
			if a\regenerate and a\hp &lt; a\fullhp then 
				diff = (a\fullhp - a\hp) / 2
				a\hp = a\hp + diff
			endif 
			For pc.creature = Each creature
				If pc\cat &lt; 100 And pc\hp &gt; 0 Then count = count + 1
			Next
			If count &gt; 0 Then 
				count = Rand(1,count)
				For pc.creature = Each creature
					If pc\cat &lt; 100 And pc\hp &gt; 0 Then count = count - 1
					If count = 0 Then 
						dieroll = Rand(1,1000)
						If a\cat = 103 Then ;goblin shaman
							If dieroll &lt; a\skill Then 
								pc\hp = pc\hp - a\damage
								pc\strucktime = 10
								a\attacktime = 30
								pc\lightningtime = 30
								playfxdelayed(CAT_BADBUFF,100)
							EndIf
						ElseIf a\cat = 106 Then ;spider wizard
							If dieroll &lt; a\skill Then 
								pc\stunned = Rand(1,2)
								playfxdelayed(CAT_BADBUFF,100)
								dieroll2 = Rand(1,1000)
								If dieroll2 &gt; pc\defenseskill Then 
									pc\hp = pc\hp - a\damage
									pc\strucktime = 10
									a\attacktime = 30
								EndIf
								Exit
							EndIf 
						ElseIf a\cat = 107 Then ;spider queen
							If dieroll &lt; a\skill Then 
								For c.creature = Each creature
									If c\cat &gt;= 100 And c\hp &gt; 0 And c\hp &lt; c\fullhp
										c\healingtime = 60
										c\hp = c\hp + a\damage
										playfxdelayed(CAT_BADBUFF,100)								
										Exit 
									EndIf 
								Next
								dieroll2 = Rand(1,1000)
								If pc\cursed Then dieroll2 = dieroll2 * 1.5
								If dieroll2 &gt; pc\defenseskill Then 
									pc\hp = pc\hp - a\damage
									pc\strucktime = 10
									a\attacktime = 30
									playfxdelayed(CAT_HIT1+rand(0,1),100)
								EndIf
								If pc\cat = CAT_WIZARD Or pc\cat = CAT_CLERIC
									pc\waitcount = 0
									Exit 
								EndIf
							EndIf 
							If pc\cursed Then dieroll = dieroll * 1.5
							If dieroll &gt; pc\defenseskill Then 
								pc\hp = pc\hp - a\damage
								pc\strucktime = 10
								a\attacktime = 30
							EndIf
							Exit
						Else
							If pc\cursed Then dieroll = dieroll * 1.5
							If dieroll &gt; pc\defenseskill Then 
								pc\hp = pc\hp - a\damage
								pc\strucktime = 10
								a\attacktime = 30
								if a\poison &gt; 0 then 
									pc\poison = a\poison
									playfxdelayed(CAT_BADBUFF,100)
								endif 
							EndIf
							If a\berserk &gt; 0 Then 
								a\berserk = a\berserk - 1
								;second attack
								dieroll = Rand(1,1000)
								If pc\cursed Then dieroll = dieroll * 1.5
								If dieroll &gt; pc\defenseskill Then 
									pc\hp = pc\hp - a\damage
									pc\strucktime = 10
									a\attacktime = 30
									If a\poison &gt; 0 Then 
										pc\poison = a\poison
									EndIf 
								EndIf
							EndIf 
							If a\cat = 110 Then 
								dieroll = Rand(1,1000)
								If dieroll &lt; a\skill Then 
									pc\cursed = Rand(1,3)
									playfxdelayed(CAT_BADBUFF,100)
								EndIf
							EndIf 
							Exit
						EndIf  
					EndIf 
				Next
				
			EndIf 
		EndIf 
	Next
EndIf
End Function

Function updategame()
;move all creatures
;move all bullets
;handle all collisions
;handle all pick ups
;handle all combat
;handle all spell casting (magic missiles and healing)

found = False

For pc.creature = Each creature
	If pc\strucktime &gt; 0 Then 
		pc\strucktime = pc\strucktime - 1
		createbloodparticle(pc\x,pc\y)
		If pc\hp &lt;= 0 Then 
			createbloodparticle(pc\x,pc\y)
			createbloodparticle(pc\x,pc\y)
			createbloodparticle(pc\x,pc\y)
		EndIf 
	EndIf 
	If pc\hp&gt;0 Then 
		If pc\cursed &gt; 0 Then 
			createcurseparticle(pc\x,pc\y+40)
		EndIf 
		If pc\berserk &gt; 0 Then 
			createberserkparticle(pc\x,pc\y+40)
		EndIf 
		If pc\cat &gt;= 100 Then 
			found = True
		EndIf
	Else
		Delete pc
	EndIf 
Next
If found = False Then 
	levelfinishtime = levelfinishtime + 1
EndIf 
foundp = False
For pc.creature = Each creature
	If pc\hp &gt; 0 And pc\cat &lt; 100 Then foundp = True:Exit 
Next
If foundp = False Then 
	levelfinishtime = levelfinishtime + 1
EndIf 
If levelfinishtime &gt; 250 Then 
	gamemode = MODE_MENU ;eventually change to mode_upgrade
	If foundp Then gamemode = MODE_UPGRADE
	if not(foundp) then 
		gamelevel = 999
		gamemode = MODE_CUTSCENE
	else
		gamelevel = gamelevel + 1
		ftrpicked = False
		clrpicked = False
		rngpicked = False
		wizpicked = False 
	endif 
EndIf 

For pc.creature = Each creature
	If pc\hp &gt; 0 Then 
		If pc\healingtime &gt; 0 Then pc\healingtime = pc\healingtime - 1
	EndIf 
Next
updateparticle()
End Function

Function drawgame()
;draw background (fixed static 1280x720 image background)
;draw all creatures - don't worry about zordering them - it will be too fast to notice 
;draw all bullets
For img.images = Each images
	If img\cat = 2007 ;change this later
		DrawBlock img\img,0,0
	EndIf
Next
For pc.creature = Each creature
	If pc\hp &gt; 0 Then
		aa# = 0
		bb# = 0
		If pc\attacktime &gt; 0 Then 
			pc\attacktime = pc\attacktime - 1
			aa# = -25.0 * Sin(pc\attacktime * 6)
			If pc\cat&gt;=100 Then aa = aa * -1.0
		EndIf 
		If pc\strucktime &gt; 0 Then 
			bb = Rand(-pc\strucktime/2,pc\strucktime/2)
		EndIf 
		If pc\poison &gt; 0 And pc\cat &lt; 100 Then 
			For img.images = Each images
				If img\cat = 119 Then 
					DrawImage img\img,pc\x - ImageWidth(pc\img)/2,pc\y-40
					Exit
				EndIf 
			Next
			;Color 32,255,32
			;Oval pc\x - ImageWidth(pc\img)/2,pc\y-40,ImageWidth(pc\img),80,1
		EndIf 
		DrawImage pc\img,bb + pc\x - ImageWidth(pc\img)/2,pc\y - 40 + aa
		dhp = 10 * pc\hp / pc\fullhp
		If dhp &lt; 4 Then Color 255,32,32
		If dhp &gt;=4 And dhp&lt;8 Then Color 255,255,32
		If dhp &gt;=8 Then Color 32,255,32
		If dhp = 0 Then dhp = 1
		For hp = 1 To dhp
			Rect hp*4 + pc\x - ImageWidth(pc\img)/3,pc\y - 50,3,3,1
		Next
		If pc\healingtime &gt; 0 Then 
			createhealparticle(pc\x,pc\y)
		EndIf 
		If pc\summonedtime &gt; 0 Then 
			pc\summonedtime = pc\summonedtime - 1
			createsummonparticle(pc\x,pc\y)
		EndIf 
		If pc\lightningtime &gt; 0 Then 
			pc\lightningtime = pc\lightningtime - 1
			drawlightning(pc\x,pc\y)
		EndIf 
		If pc\waitcount &gt; 0 Then 
			Color 255,32,255
			For i = 1 To pc\waitcount
				Rect i * 4 + pc\x - ImageWidth(pc\img)/3,pc\y - 55,3,3,1
			Next
		EndIf 
		If pc\stunned &gt; 0 and pc\cat &lt; 100 Then 
			;Color 255,255,32
			;Oval pc\x - ImageWidth(pc\img)/2,pc\y-40,ImageWidth(pc\img),80,0
			For img.images = Each images
				If img\cat = 118 Then 
					DrawImage img\img, pc\x - ImageWidth(pc\img)/2,pc\y-40
					Exit
				EndIf 
			Next
		EndIf 
	EndIf
Next
drawparticle()
Color 255,255,255
For img.images = Each images
	If img\cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img\img,mx,my
	EndIf
Next
End Function 

Function drawlightning(x,y)
iy = 0
ix = x + Rand(-20,20)
While iy &lt; y
	oy = iy
	ox = ix
	ix = x + Rand(-20,20)
	iy = iy + Rand(10,25)
	Color 200,200,255
	Line ox,oy,ix,iy
	Color 150,150,200
	Line ox+1,oy+1,ix+1,iy+1
	Line ox-1,oy-1,ix-1,iy-1
	Color 100,100,150
	Line ox+2,oy+2,ix+2,iy+2
	Line ox-2,oy-2,ix-2,iy-2
	Color 32,32,90
	Line ox+3,oy+3,ix+3,iy+3
	Line ox-3,oy-3,ix-3,iy-3
Wend 

End Function 

Function handlecutscene()
;handle transitions,  handle skip button; 
;handle fading in and out text (bitmap fonts?)
If gamelevel = 1 Or gamelevel = 4 Or gamelevel = 8 Or gamelevel = 11 Or gamelevel = 14 or gamelevel = 999 Then
	
Else
	initlevel()
	gamemode = MODE_COMBAT
EndIf 
;;
If lmb&lt;&gt;0 And olmb = 0 Then 
	If mx&gt;1000 And mx&lt;1200 And my&gt;650 And my&lt;700 Then 
		playfx(CAT_CLICK)
		If gamelevel &lt; 14 Then 
			initlevel()
			gamemode = MODE_COMBAT
		Else
			gamemode = MODE_MENU ;includes 999 (game over)
		EndIf
	EndIf 
EndIf 
;;
End Function 

Function drawcutscene()
;draw cut scene background, draw transition, draw skip button
If gamelevel = 1 Or gamelevel = 4 Or gamelevel = 8 Or gamelevel = 11 Or gamelevel = 14 or gamelevel = 999 Then
Else
	Return
EndIf
For img.images = Each images
	If (img\cat = 2004 And gamelevel = 1) Or (img\cat = 2005 And gamelevel = 4) Or (img\cat = 2006 And gamelevel = 8) Or (img\cat = 2008 And gamelevel = 11) Or (img\cat = 2009 And gamelevel = 14) or (img\cat = 2010 And gamelevel = 999) Then 
		DrawBlock img\img,0,0
	EndIf 
Next
;;
For img.images = Each images
	If img\cat = CAT_MENU_SKIP_CUTSCENE
		DrawImage img\img,1000,650
	EndIf
Next
;;
For img.images = Each images
	If img\cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img\img,mx,my
	EndIf
Next
;;
End Function 

Function handleupgrade()
;handle button press 'add stuff' to characters
;
;
;
If lmb&lt;&gt;0 And olmb = 0Then 
	If mx &gt; 1000 And mx&lt;1200 And my&gt;650 And my &lt;700
		gamemode = MODE_CUTSCENE
		FlushMouse()
		playfx(CAT_CLICK)
	EndIf
	i = -1
	For pc.creature = Each creature
		If pc\cat &lt; 100 And pc\hp &gt; 0 Then 
			i = i + 1
			y = 100 * i + 200
			DrawImage pc\img,100,y
			If pc\cat = CAT_FIGHTER And (Not ftrpicked)
				If mx&gt;200 And mx &lt; 400 And my &gt; y And my &lt; y + 50 Then 
					;health picked
					ftrpicked = True
					pc\fullhp = pc\fullhp + 10
					playfx(CAT_CLICK)			
				EndIf 
				If mx&gt;450 And mx &lt; 650 And my &gt; y And my &lt; y + 50 Then 
					;damage picked
					ftrpicked = True
					pc\damage = pc\damage + 4
					playfx(CAT_CLICK)
				EndIf 
				
				If mx&gt;700 And mx &lt; 900 And my &gt; y And my &lt; y + 50 Then 
					;skill picked
					ftrpicked = True
					ds# = (1000 - pc\skill) * 0.95
					pc\skill = 1000 - ds
					playfx(CAT_CLICK)
				EndIf 
				
				If mx&gt;950 And mx &lt; 1150 And my &gt; y And my &lt; y + 50 Then 
					;def picked
					ftrpicked = True
					ds# = (1000 - pc\defenseskill) * 0.95
					pc\defenseskill = 1000 - ds
					playfx(CAT_CLICK)
				EndIf 
			EndIf
			If pc\cat = CAT_RANGER And (Not rngpicked)
				If mx&gt;200 And mx &lt; 400 And my &gt; y And my &lt; y + 50 Then 
					;health picked
					rngpicked = True
					pc\fullhp = pc\fullhp + 10
					playfx(CAT_CLICK)
				EndIf 
				If mx&gt;450 And mx &lt; 650 And my &gt; y And my &lt; y + 50 Then 
					;damage picked
					rngpicked = True
					pc\damage = pc\damage + 4
					playfx(CAT_CLICK)
				EndIf 
				
				If mx&gt;700 And mx &lt; 900 And my &gt; y And my &lt; y + 50 Then 
					;skill picked
					rngpicked = True
					ds# = (1000 - pc\skill) * 0.95
					pc\skill = 1000 - ds
					playfx(CAT_CLICK)
				EndIf 
				
				If mx&gt;950 And mx &lt; 1150 And my &gt; y And my &lt; y + 50 Then 
					;def picked
					rngpicked = True
					ds# = (1000 - pc\defenseskill) * 0.95
					pc\defenseskill = 1000 - ds
					playfx(CAT_CLICK)
				EndIf 
			
			EndIf
			If pc\cat = CAT_WIZARD And (Not wizpicked)
				If mx&gt;200 And mx &lt; 400 And my &gt; y And my &lt; y + 50 Then 
					;health picked
					wizpicked = True
					pc\fullhp = pc\fullhp + 10
					playfx(CAT_CLICK)
				EndIf 
				If mx&gt;450 And mx &lt; 650 And my &gt; y And my &lt; y + 50 Then 
					;damage picked
					wizpicked = True
					pc\damage = pc\damage + 4
					playfx(CAT_CLICK)
				EndIf 
				
				If mx&gt;700 And mx &lt; 900 And my &gt; y And my &lt; y + 50 Then 
					;skill picked
					wizpicked = True
					ds# = (1000 - pc\skill) * 0.95
					pc\skill = 1000 - ds
					playfx(CAT_CLICK)
				EndIf 
				
				If mx&gt;950 And mx &lt; 1150 And my &gt; y And my &lt; y + 50 Then 
					;def picked
					wizpicked = True
					ds# = (1000 - pc\defenseskill) * 0.95
					pc\defenseskill = 1000 - ds
					playfx(CAT_CLICK)
				EndIf 

			EndIf
			If pc\cat = CAT_CLERIC And (Not clrpicked)
				If mx&gt;200 And mx &lt; 400 And my &gt; y And my &lt; y + 50 Then 
					;health picked
					clrpicked = True
					pc\fullhp = pc\fullhp + 10
					playfx(CAT_CLICK)
				EndIf 
				If mx&gt;450 And mx &lt; 650 And my &gt; y And my &lt; y + 50 Then 
					;damage picked
					clrpicked = True
					pc\damage = pc\damage + 4
					playfx(CAT_CLICK)
				EndIf 
				If mx&gt;700 And mx &lt; 900 And my &gt; y And my &lt; y + 50 Then 
					;skill picked
					clrpicked = True
					ds# = (1000 - pc\skill) * 0.95
					pc\skill = 1000 - ds
					playfx(CAT_CLICK)
				EndIf 
				If mx&gt;950 And mx &lt; 1150 And my &gt; y And my &lt; y + 50 Then 
					;def picked
					clrpicked = True
					ds# = (1000 - pc\defenseskill) * 0.95
					pc\defenseskill = 1000 - ds
					playfx(CAT_CLICK)
				EndIf 
			EndIf 
		EndIf 
	Next
EndIf
End Function

Function drawupgrade()
;draw background
;draw buttons
;draw characters
;draw stats
;draw continue button
For img.images = Each images
	If img\cat = 2012 Then 
		DrawBlock img\img,0,0
	EndIf 
Next

i=-1
For pc.creature = Each creature
	If pc\cat &lt; 100 And pc\hp &gt; 0 Then 
		pc\hp = pc\fullhp
		i = i + 1
		y = 100 * i + 200
		Color 96,96,80
		Rect 50,y - 5,1180,90,1
		DrawImage pc\img,100,y
	;	Text 150,i*100+200,"Skill:"+pc\skill+" Defense:"+pc\defenseskill + " Health:"+pc\fullhp + " Power:"+pc\damage
		If pc\cat = CAT_FIGHTER 
			For img.images = Each images
				If img\cat = CAT_MENU_ADD_HEALTH Then
					If (Not ftrpicked) DrawImage img\img,200,y
					;Text 300,y + 65,pc\fullhp,1,1
					drawnumber(300,y + 65,pc\fullhp)
				EndIf
				If img\cat = CAT_MENU_ADD_DAMAGE Then
					If (Not ftrpicked) 	DrawImage img\img,450,y
					;Text 550,y + 65,pc\damage,1,1
					drawnumber(550,y + 65,pc\damage)
				EndIf
				If img\cat = CAT_MENU_ADD_SKILL Then
					If (Not ftrpicked) 	DrawImage img\img,700,y
					;Text 800,y + 65,pc\skill,1,1
					drawnumber(800,y + 65,pc\skill * 100 / 1000)
				EndIf
				If img\cat = CAT_MENU_ADD_DEF Then 
					If (Not ftrpicked) 	DrawImage img\img,950,y
					;Text 1050,y + 65,pc\defenseskill,1,1
					drawnumber(1050,y + 65,pc\defenseskill * 100 / 1000)
				EndIf 
			Next
		EndIf
		If pc\cat = CAT_RANGER 
			For img.images = Each images
				If img\cat = CAT_MENU_ADD_HEALTH Then
					If (Not rngpicked) DrawImage img\img,200,y
					;Text 300,y + 65,pc\fullhp,1,1
					drawnumber(300,y + 65,pc\fullhp)
				EndIf
				If img\cat = CAT_MENU_ADD_DAMAGE Then
					If (Not rngpicked) DrawImage img\img,450,y
					;Text 550,y + 65,pc\damage,1,1
					drawnumber(550,y + 65,pc\damage)
				EndIf
				If img\cat = CAT_MENU_ADD_SKILL Then
					If (Not rngpicked) DrawImage img\img,700,y
					;Text 800,y + 65,pc\skill,1,1
					drawnumber(800,y + 65,pc\skill * 100 / 1000)
				EndIf
				If img\cat = CAT_MENU_ADD_DEF Then 
					If (Not rngpicked) DrawImage img\img,950,y
					;Text 1050,y + 65,pc\defenseskill,1,1
					drawnumber(1050,y + 65,pc\defenseskill * 100 / 1000)
				EndIf 
			Next
		
		EndIf
		If pc\cat = CAT_WIZARD 
			For img.images = Each images
				If img\cat = CAT_MENU_ADD_HEALTH Then
					If (Not wizpicked) DrawImage img\img,200,y
;					Text 300,y + 65,pc\fullhp,1,1
					drawnumber(300,y + 65,pc\fullhp)
				EndIf
				If img\cat = CAT_MENU_ADD_DAMAGE Then
					If (Not wizpicked)  DrawImage img\img,450,y
					;Text 550,y + 65,pc\damage,1,1
					drawnumber(550,y + 65,pc\damage)
				EndIf
				If img\cat = CAT_MENU_ADD_SKILL Then
					If (Not wizpicked) DrawImage  img\img,700,y
					;Text 800,y + 65,pc\skill,1,1
					drawnumber(800,y + 65,pc\skill * 100 / 1000)
				EndIf
				If img\cat = CAT_MENU_ADD_DEF Then 
					If (Not wizpicked) DrawImage  img\img,950,y
					;Text 1050,y + 65,pc\defenseskill,1,1
					drawnumber(1050,y + 65,pc\defenseskill * 100 / 1000)
				EndIf 
			Next
		
		EndIf
		If pc\cat = CAT_CLERIC 
			For img.images = Each images
				If img\cat = CAT_MENU_ADD_HEALTH Then
					If (Not clrpicked) DrawImage  img\img,200,y
					;Text 300,y + 65,pc\fullhp,1,1
					drawnumber(300,y + 65,pc\fullhp)
				EndIf
				If img\cat = CAT_MENU_ADD_DAMAGE Then
					If (Not clrpicked) 					DrawImage img\img,450,y
					;Text 550,y + 65,pc\damage,1,1
					drawnumber(550,y + 65,pc\damage)
				EndIf
				If img\cat = CAT_MENU_ADD_SKILL Then
					If (Not clrpicked) 					DrawImage img\img,700,y
					;Text 800,y + 65,pc\skill,1,1
					drawnumber(800,y + 65,pc\skill * 100 / 1000)
				EndIf
				If img\cat = CAT_MENU_ADD_DEF Then 
					If (Not clrpicked) 					DrawImage img\img,950,y
					;Text 1050,y + 65,pc\defenseskill,1,1
					drawnumber(1050,y + 65,pc\defenseskill * 100 / 1000)
				EndIf 
			Next
		
		EndIf 
	EndIf 
Next

For img.images = Each images
	If img\cat = CAT_MENU_SKIP_CUTSCENE
		DrawImage img\img,1000,650
	EndIf
Next

For img.images = Each images
	If img\cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img\img,mx,my
	EndIf
Next

End Function 

Function initstartgame()
gamelevel = 1
mapindex = 0
Delete Each creature
pc.creature = New creature
pc\fullhp = 90
pc\hp = 90
pc\cat = CAT_FIGHTER
pc\x = 600
pc\y = 300
pc\skill = 500
pc\defenseskill = 850
pc\damage = 15
For img.images = Each images
	If img\cat = CAT_FIGHTER Then 
		pc\img = img\img
		Exit 
	EndIf 
Next
pc.creature = New creature
pc\fullhp = 75
pc\hp = 75
pc\cat = CAT_RANGER
pc\x = 640
pc\y = 300
pc\skill = 800
pc\defenseskill = 850
pc\damage = 50
For img.images = Each images
	If img\cat = CAT_RANGER Then 
		pc\img = img\img
		Exit 
	EndIf 
Next
pc.creature = New creature
pc\fullhp = 45
pc\hp = 45
pc\cat = CAT_WIZARD
pc\x = 750
pc\y = 360
pc\skill = 650
pc\damage = 18
pc\defenseskill = 650
For img.images = Each images
	If img\cat = CAT_WIZARD Then 
		pc\img = img\img
		Exit 
	EndIf 
Next
pc.creature = New creature
pc\fullhp = 60
pc\hp = 60
pc\cat = CAT_CLERIC
pc\x = 640
pc\defenseskill = 800
pc\y = 350
pc\skill = 100
pc\damage = 5
For img.images = Each images
	If img\cat = CAT_CLERIC Then 
		pc\img = img\img
		Exit 
	EndIf 
Next
End Function 

Function initlevel()
For pc.creature = Each creature
	If pc\hp &gt; 0 And pc\hp &lt; pc\fullhp Then pc\hp = pc\fullhp
	If pc\cat = CAT_FIGHTER
		pc\x = 540
		pc\y = 350
	EndIf
	If pc\cat = CAT_RANGER
		pc\x = 720
		pc\y = 350
	EndIf
	If pc\cat = CAT_WIZARD
		pc\x = 540
		pc\y = 440
	EndIf
	If pc\cat = CAT_CLERIC
		pc\x = 720
		pc\y = 440
	EndIf
	If pc\cat &gt;=100 Then Delete pc
Next

For i = 1 To 8
	pc.creature = New creature
	If i &lt; 5 Then 
		pc\x = 360 + (i-1) * 180;Rand(0,SW)
		pc\y = 180 ;Rand(0,SH)
	Else
		pc\x = 450 + (i-5) * 180;Rand(0,SW)
		pc\y = 225 ;Rand(0,SH)
	
	EndIf
	
	If gamelevel = 1 Then 
	pc\cat = 100+Rand(0,1)
	pc\hp = 70
	pc\fullhp = 50
	pc\damage = 5
	pc\skill = 80
	EndIf
	If gamelevel = 2 Then 
		;trolls2
		If i = 1 Or i = 8 Then 
			pc\cat = 102
			pc\hp = 200
			pc\regenerate = true
			pc\fullhp = 200
			pc\damage = 10
			pc\skill = 150
		Else
			pc\cat = 100+Rand(0,1)
			pc\hp = 70
			pc\fullhp = 50
			pc\damage = 5
			pc\skill = 80
		EndIf 
	EndIf 
	If gamelevel = 3 Then 
		;wizard and troll
		If i = 1 Or i = 8 Then
			pc\cat = 102
			pc\hp = 200
			pc\regenerate = true
			pc\fullhp = 200
			pc\damage = 10
			pc\skill = 150
		ElseIf i = 4 Then
			pc\cat = 103
			pc\hp = 100
			pc\fullhp = 100
			pc\damage = 5
			pc\skill = 350
		Else
			pc\cat = 100+Rand(0,1)
			pc\hp = 70
			pc\fullhp = 50
			pc\damage = 5
			pc\skill = 80
		EndIf 
	EndIf
	If gamelevel = 4 Then
		;spiderbeasts and giant spiders
		If i = 1 Or i = 8 Then 
			pc\cat = 104
			pc\hp = 150
			pc\poison = 15
			pc\regenerate = true
			pc\fullhp = 150
			pc\damage = 15
			pc\skill = 100
		Else
			pc\cat = 105
			pc\hp = 100
			pc\fullhp = 100
			pc\damage = 8
			pc\skill = 150
		EndIf 

	EndIf
	If gamelevel = 5 Then 
		;spiderbeasts, giant spiders and spider wizards
		If i = 1 Or i = 8 Then 
			pc\cat = 104
			pc\hp = 150
			pc\poison = 15
			pc\regenerate = true
			pc\fullhp = 150
			pc\damage = 15
			pc\skill = 100
		ElseIf i = 2 Or i = 7
			pc\cat = 106
			pc\hp = 100
			pc\fullhp = 100
			pc\damage = 8
			pc\skill = 300
		Else
			pc\cat = 105
			pc\hp = 100
			pc\fullhp = 100
			pc\damage = 8
			pc\skill = 150
		EndIf 


	EndIf 
	If gamelevel = 6 Then 
		;spider queens and spiderbeasts
		If i = 1 Or i = 8 Then 
			pc\cat = 107
			pc\hp = 100
			pc\fullhp = 100
			pc\damage = 5
			pc\skill = 450
		Else
			pc\cat = 105
			pc\hp = 100
			pc\fullhp = 100
			pc\damage = 8
			pc\skill = 150
		EndIf 
	EndIf 
	If gamelevel = 7 Then 
		;spider queens and giant spiders and spider wizards
		If i = 4 Or i = 5 Then 
			pc\cat = 107
			pc\hp = 100
			pc\fullhp = 100
			pc\damage = 5
			pc\skill = 450
		ElseIf i = 2 Or i = 7
			pc\cat = 106
			pc\hp = 100
			pc\fullhp = 100
			pc\damage = 8
			pc\skill = 300
		Else
			pc\cat = 104
			pc\hp = 150
			pc\regenerate = true
			pc\poison = 15
			pc\fullhp = 150
			pc\damage = 15
			pc\skill = 100
		EndIf 
	EndIf 
	;beasts
	If gamelevel = 8 Then 
		If i = 2 Or i = 6 Or i = 4
			;centaur
			pc\cat = 108
			pc\hp = 200
			pc\fullhp = 200
			pc\damage = 10
			pc\skill = 150
		Else
			;grunt
			pc\cat = 109
			pc\hp = 90
			pc\fullhp = 90
			pc\damage = 20
			pc\skill = 150
		EndIf
	EndIf
	If gamelevel = 9 Then
		If i = 3 Or i = 5 Then
			;shaman
			pc\cat = 110
			pc\hp = 180
			pc\fullhp = 180
			pc\damage = 15
			pc\skill = 250
		Else
			;grunt
			pc\cat = 109
			pc\hp = 90
			pc\fullhp = 90
			pc\damage = 20
			pc\skill = 150

		EndIf
	EndIf
	If gamelevel = 10 Then 
		If i = 1 Or i = 8 Then
			;shaman
			pc\cat = 110
			pc\hp = 180
			pc\fullhp = 180
			pc\damage = 15
			pc\skill = 250
		ElseIf i = 2 Or i = 7 Or i = 4 Then
			;centaur
			pc\cat = 108
			pc\hp = 200
			pc\fullhp = 200
			pc\damage = 10
			pc\skill = 150
		Else
			;grunt
			pc\cat = 109
			pc\hp = 90
			pc\fullhp = 90
			pc\damage = 20
			pc\skill = 150
		EndIf
	EndIf 
	If gamelevel = 11 Then
		If i = 4 Then
			;necromancer
			pc\cat = 113
			pc\hp = 200
			pc\fullhp = 200
			pc\damage = 20
			pc\skill = 250
		ElseIf i = 5 Then 
			;wraith
			pc\cat = 112
			pc\hp = 200
			pc\ethereal = True
			pc\fullhp = 200
			pc\damage = 15
			pc\skill = 300
		Else
			;skeleton
			pc\cat = 111
			pc\hp = 20
			pc\fullhp = 20
			pc\damage = 10
			pc\skill = 150
		EndIf
	EndIf
	If gamelevel = 12 Then 
		If i = 5 Or i = 7 Then 
			;necromancer
			pc\cat = 113
			pc\hp = 200
			pc\fullhp = 200
			pc\damage = 20
			pc\skill = 250

		ElseIf i = 4 Or i = 6
			;wraith
			pc\cat = 112
			pc\hp = 200
			pc\ethereal = True
			pc\fullhp = 200
			pc\damage = 15
			pc\skill = 300
		Else
			;skeleton
			pc\cat = 111
			pc\hp = 20
			pc\fullhp = 20
			pc\damage = 10
			pc\skill = 150
		EndIf
	EndIf
	If gamelevel = 13 Then 
		If i = 1 Then 
			;liche
			pc\cat = 114
			pc\hp = 300
			pc\fullhp = 300
			pc\damage = 20
			pc\skill = 350
		ElseIf i = 2 Or i = 3 Then 
			;necromancer
			pc\cat = 113
			pc\hp = 200
			pc\fullhp = 200
			pc\damage = 20
			pc\skill = 250
		ElseIf i = 4 Or i = 5 Then 
			;wraith
			pc\cat = 112
			pc\hp = 200
			pc\fullhp = 200
			pc\damage = 15
			pc\skill = 300
			pc\ethereal = True
		Else
			;skeletons
			pc\cat = 111
			pc\hp = 20
			pc\fullhp = 20
			pc\damage = 10
			pc\skill = 150
		EndIf
	EndIf 
	For img.images = Each images
		If img\cat = pc\cat Then 
			pc\img = img\img
			Exit 
		EndIf 
	Next
Next

lmb = 0
olmb = 0
FlushMouse()
levelfinishtime = 0
End Function 

Function createskeleton.creature(pc.creature)
x = pc\x
y = pc\y
Delete pc
pc.creature = New creature
			pc\cat = 111
			pc\strucktime = 10
			For img.images = Each images
				If img\cat = pc\cat Then pc\img = img\img:Exit 
			Next
			pc\hp = 20
			pc\x = x
			pc\y = y
			pc\fullhp = 20
			pc\damage = 10
			pc\skill = 150
			pc\regenerate = False
			pc\ethereal = False
			pc\summonedtime = 25
			pc\berserk = 0
Return pc
End Function 

Function createhealparticle(x,y)

For i = 1 To 36
	p.particle = New particle
	p\life = 20
	p\x = x + 25.0 * Cos(i*10)
	p\y = y + 20 + 25.0 * (Sin(i*5))
	p\vx = 0
	p\vy = Rand(-4,-2)
	p\ay = 0.1
	p\gy = p\y + 100
	p\r = 32
	p\g = 200
	p\b = 255
	p\sz = 4
	p\dsz = -0.1
	p\dr = 10
	p\dg = 2
	p\db = 0
Next

End Function 

Function createsummonparticle(x,y)

For i = 1 To 36
	p.particle = New particle
	p\life = 20
	p\x = x + 25.0 * Cos(i*10)
	p\y = y + 20 + 25.0 * (Sin(i*5))
	p\vx = 0
	p\vy = Rand(-4,-2)
	p\ay = 0.1
	p\gy = p\y + 100
	p\r = 32
	p\g = 255
	p\b = 50
	p\sz = 4
	p\dsz = -0.1
	p\dr = 8
	p\dg = 0
	p\db = 8
Next

End Function 


Function createbloodparticle(x,y)

For i = 1 To 10
	p.particle = New particle
	p\life = 20
	p\x = x + Rand(-10,10)
	p\y = y + Rand(-10,10)
	p\vx = Rnd(-3,3)
	p\vy = Rnd(-3,3)
	p\ay = 0.05
	p\gy = y + 42
	p\r = 255
	p\g = 100
	p\b = 100
	p\dr = -2
	p\dg = -3
	p\db = -3
	p\sz = 4
	p\dsz = 0
Next

End Function 

Function createcurseparticle(x,y)
For i = 1 To 36
	p.particle = New particle
	p\life = 10+Rand(5)
	p\x = x +25 * Cos(i*10)
	p\y = y + 15.0 * Abs(Sin(i*10))
	p\vx = 0
	p\vy = Rand(-4,-2)
	p\ay = 0.1
	p\gy = p\y + 100
	p\r = 255
	p\g = 50
	p\b = 255
	p\sz = 4
	p\dsz = 0.25
	p\dr = 0
	p\dg = 22
	p\db = 0
Next
End Function 
Function createberserkparticle(x,y)
For i = 1 To 36
	p.particle = New particle
	p\life = 10+Rand(5)
	p\x = x +25 * Cos(i*10)
	p\y = y + 15.0 * Abs(Sin(i*10))
	p\vx = 0
	p\vy = Rand(-4,-2)
	p\ay = 0.1
	p\gy = p\y + 100
	p\r = 255
	p\g = 50
	p\b = 255
	p\sz = 4
	p\dsz = 0.25
	p\dr = 0
	p\dg = 22
	p\db = 0
Next



End Function 

Function updateparticle()
For p.particle = Each particle
	p\life = p\life - 1
	p\x = p\x + p\vx
	p\y = p\y + p\vy
	p\vy = p\vy + p\ay
	If p\y &gt; p\gy Then 
		p\vy = p\vy * -0.7
		If Abs(p\vy)&lt;0.01 Then p\life = 0
	EndIf 
	p\sz = p\sz + p\dsz
	p\r = p\r + p\dr
	p\g = p\g + p\dg
	p\b = p\b + p\db
	If p\sz &lt; 0 Then p\sz = 0
	If p\r &gt; 255 Then p\r = 255
	If p\g &gt; 255 Then p\g = 255
	If p\b &gt; 255 Then p\b = 255
	If p\r &lt; 0 Then p\r = 0
	If p\g &lt; 0 Then p\g = 0
	If p\b &lt; 0 Then p\b = 0
	If p\life &lt; 0 Then Delete p
Next
End Function 

Function drawparticle()
For p.particle = Each particle
	Color p\r,p\g,p\b
	Rect p\x,p\y,p\sz,p\sz,1
Next
Color 255,255,255
End Function 

Function drawnumber(x,y,num)
txt$ = str(num)
for i = 1 to len(txt)
	digit = mid(txt,i,1)
	for img.images = each images
		if img\cat = 10000 + digit then 
			drawimage img\img,x + (i-1) * 50 - len(txt) * 25,y - 25
			exit
		endif
	next
next 
End Function 

function playfx(cat)
if audiostate
	for aud.audio = each audio
		if aud\cat = cat then 
			aud\channel = playsound(aud\hnd)
		endif 
	next
endif
end function 

function updatefx()
if audiostate = false then delete each audiofx
for fx.audiofx = each audiofx
	if millisecs()&gt;fx\time then 
		playsound(fx\hnd)
		delete fx
	endif 
next
end function 

function playfxdelayed(cat,time)
if audiostate
	for aud.audio = each audio
		if aud\cat = cat then 
			found = false
			for fx.audiofx = each audiofx
				if fx\hnd = aud\hnd and fx\time &lt; millisecs() + time * 2 then
					found = true
					exit
				endif
			next
			if found = false then 
				fx.audiofx = new audiofx
				fx\hnd = aud\hnd
				fx\time = millisecs() + time
			endif 
		endif 
	next
endif

end function 
</textarea><br><br>image from game level 2:<br><br><img src="http://www.mattiesgames.com/bbgame/videogame.jpg"> <br><br></td></tr></table><br>
<a name="1341410"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rooster</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#99">[#99]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've noticed a small exploit, after the level is cleared and before it switches to the level up screen, you can rapidly click one of the character to increase the purple bar to full for the rest of the party.<br><br>As for polish, maybe use a different sound effect for the lightning spell, one with more "bite" to it.<br><br>Music works really well I think.<br><br>Latest BMax port:<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Global particle_list:TList=New TList
Global creature_list:TList=New TList
Global audiofx_list:TList=New TList
Global audio_list:TList=New TList
Global images_list:TList=New TList
'This is both a learning exercise and hopefully a collaborative project of sorts
'or at least a project I can share with others on the blitz forum.
'It will be written initially in blitzplus/blitz3d And maybe someone will be keen on
'porting it to blitzmax...even blitzmax-ng to release on mobile perhaps?
'
'Interface:
'Left mouse button clicking only to make porting to 
'mobile interface much, much easier.
'Gameplay Mechanic Has changed - turn based more detailed
'
'Gameplay mechanic so far (15-May-2017)
'
'1. Arcade Action RPG Combat
'	Player controls 4 characters in a single screen dungeon.
'	Dungeon has a few walls and so on that prevent movement.
'	Monsters spawn from spawners and make their way around the map
'	Player taps the screen to move to location and characters fight things
'	in their path.
'	Powerups exist in the level such as:
'	Health pickups
'	Bombs - kill all monsters that have spawned or at least damage them.
'	
'2. After the arcade sequence the player is presented with options to upgrade their
'	character's stats. Stats to upgrade include:
'	Combat skill ('to hit roll')
'	Damage output ('damage points')
'	Health points ('hp')
'	Movement speed ('move')
'3.	After this a short cut scene is presented which may simply be a scrolling static
'	image with some fading in/fading out text to advance the story line
'0. Menu - toggle audio, play, credits
'
'Character types:
'1 Fighter - high hitpoint melee combat medium damage
'2 Ranger - medium hitpoint melee combat high damage
'3 Wizard - low hitpoint, ranged combat, medium damage
'4 Cleric - medium hitpoint, no combat, healer
'


'constants
Const SW=1280,SH=720,WIN=2
Const MODE_MENU = 0
Const MODE_COMBAT = 1
Const MODE_UPGRADE = 2
Const MODE_CUTSCENE = 3
Const PURE_2D = True 'if go to blitzmax can use 2d-in-3d commands such as alpha otherwise have to calculate manually.Change to false for blitzmax.

'categories for image types and object types
Const CAT_MENU_PLAY = 0
Const CAT_MENU_AUDIO = 1
Const CAT_MENU_SKIP_CUTSCENE = 2 'cut scene mode
Const CAT_MENU_ADD_SKILL = 3 'upgrade mode
Const CAT_MENU_ADD_DAMAGE = 4'upgrade mode
Const CAT_MENU_ADD_HEALTH = 5'upgrade mode
'Const CAT_MENU_ADD_SPEED = 6;
Const CAT_MENU_ADD_DEF = 6
Const CAT_MENU_MOUSE_CURSOR = 7'
Const CAT_FIGHTER = 10
Const CAT_KNIGHT = 10 'synonym
Const CAT_RANGER = 11
Const CAT_WIZARD = 12
Const CAT_CLERIC = 13
Const CAT_HEALER = 13 'synonym
Const CAT_HEALTH_PICKUP = 20
Const CAT_BOMB_PICKUP = 21
'CAT_BACKGROUND = 2000-3000 ; all the different image backgrounds
'CAT_MONSTER = 100-1000 , all the different monster types
'CAT_NUMBERS = 10000-10009
'AUDIO CATEGORIES
Const CAT_MUSIC = 999
Const CAT_BADBUFF = 1
Const CAT_CLICK = 0
Const CAT_GOODBUFF = 2
Const CAT_HIT1 = 3
Const CAT_HIT2 = 4
Const CAT_SWING1 = 5
Const CAT_SWING2 = 6
Const CAT_SWING3 = 7
Const CAT_SWING4 = 8

'globals
Global mx,my,lmb,olmb 'mouse input
Global audiostate 'on/off
Global gamemode 'references const above
Global gamelevel 'for cutscenes
Global cutsceneframe 'for cutscenes ie trigger fades, text, motion etc on certain frames
Global levelfinishtime = 0
Global mapdelay 'timestamp
Global mapindex

Global ftrpicked,rngpicked,wizpicked,clrpicked 'boolean for upgrades

' virtual key support for legacy Blitz apps

Global VKEY[]=[..
0,KEY_ESCAPE,KEY_1,KEY_2,KEY_3,KEY_4,KEY_5,KEY_6,KEY_7,KEY_8,KEY_9,KEY_0,..
KEY_MINUS,KEY_EQUALS,KEY_BACKSPACE,KEY_TAB,KEY_Q,KEY_W,KEY_E,KEY_R,KEY_T,..
KEY_Y,KEY_U,KEY_I,KEY_O,KEY_P,KEY_OPENBRACKET,KEY_CLOSEBRACKET,KEY_RETURN,..
KEY_LCONTROL,KEY_A,KEY_S,KEY_D,KEY_F,KEY_G,KEY_H,KEY_J,KEY_K,KEY_L,..
KEY_SEMICOLON,KEY_QUOTES,KEY_TILDE,KEY_LSHIFT,KEY_BACKSLASH,..
KEY_Z,KEY_X,KEY_C,KEY_V,KEY_B,KEY_N,KEY_M,KEY_COMMA,KEY_PERIOD,KEY_SLASH,..
KEY_RSHIFT,KEY_NUMMULTIPLY,KEY_ALT,KEY_SPACE,KEY_CAPSLOCK,..
KEY_F1,KEY_F2,KEY_F3,KEY_F4,KEY_F5,KEY_F6,KEY_F7,KEY_F8,KEY_F9,KEY_F10,..
KEY_NUMLOCK,KEY_SCROLL,KEY_NUM7,KEY_NUM8,KEY_NUM9,KEY_NUMSUBTRACT,KEY_NUM4,..
KEY_NUM5,KEY_NUM6,KEY_NUMADD,KEY_NUM1,KEY_NUM2,KEY_NUM3,KEY_NUM0,..
KEY_NUMDECIMAL,KEY_NUMSLASH,KEY_F11,KEY_F12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,..
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,..
KEY_EQUALS,0,0,KEY_MEDIA_PREV_TRACK,0,0,0,0,0,0,0,0,KEY_MEDIA_NEXT_TRACK,0,0,..
KEY_ENTER,KEY_RCONTROL,0,0,KEY_VOLUME_MUTE,0,KEY_MEDIA_PLAY_PAUSE,0,..
KEY_MEDIA_STOP,0,0,0,0,0,0,0,0,0,KEY_VOLUME_DOWN,0,KEY_VOLUME_UP,0,..
KEY_BROWSER_HOME,KEY_DECIMAL,0,KEY_NUMDIVIDE,0,KEY_SCREEN,..
0,0,0,0,0,0,0,0,0,0,0,0,0,KEY_PAUSE,0,KEY_HOME,KEY_UP,KEY_PAGEUP,0,..
KEY_LEFT,0,KEY_RIGHT,0,KEY_END,KEY_DOWN,KEY_PAGEDOWN,KEY_INSERT,KEY_DELETE,..
0,0,0,0,0,0,0,KEY_LWIN,KEY_RWIN,0,0,0,0,0,0,0,0,KEY_BROWSER_SEARCH,..
KEY_BROWSER_FAVORITES,KEY_BROWSER_REFRESH,KEY_BROWSER_STOP,KEY_BROWSER_FORWARD,..
KEY_BROWSER_BACK,0,KEY_LAUNCH_MAIL,KEY_LAUNCH_MEDIA_SELECT]

Function VKeyDown(key);Return KeyDown(VKEY[key]);End Function
Function VKeyHit(key);Return KeyHit(VKEY[key]);End Function

'currently unsupported in BlitzMax

Function Locate( x,y );Return 0;End Function
Function MouseZSpeed();Return 0;End Function
Function FreeBank(bank);Return 0;End Function
Function LoopSound(sound);Return 0;End Function
Function ChannelPitch(channel,hz);Return 0;End Function
Function PlayCDTrack( track,mode=0 );Return 0;End Function
Function SoundVolume( sound,volume# );Return 0;End Function

' BBType adds legacy Type functionality to BlitzMax Type

Type TBBType

	Field _list:TList
	Field _link:TLink

	Method Add(t:TList)
		_list=t
		_link=_list.AddLast(Self)
	End Method

	Method InsertBefore(t:TBBType)
		_link.Remove
		_link=_list.InsertBeforeLink(Self,t._link)
	End Method

	Method InsertAfter(t:TBBType)
		_link.Remove
		_link=_list.InsertAfterLink(Self,t._link)
	End Method

	Method Remove()
		_list.remove Self
	End Method

End Type

Function DeleteLast(t:TBBType)
	If t TBBType(t._list.Last()).Remove()
End Function

Function DeleteFirst(t:TBBType)
	If t TBBType(t._list.First()).Remove()
End Function

Function DeleteEach(t:TBBType)
	If t t._list.Clear()
End Function

Function ReadString$(in:TStream)
	Local	length
	length=ReadInt(in)
	If length&gt;0 And length&lt;1024*1024 Return brl.stream.ReadString(in,length)
End Function

Function HandleToObject:Object(obj:Object)
	Return obj
End Function

Function HandleFromObject(obj:Object)
	Local h=HandleToObject(obj)
	Return h
End Function



'types
Type bbimages Extends TBBType

	Method New()
		Add(images_list)
	End Method

	Method After:bbimages()
		Local t:TLink
		t=_link.NextLink()
		If t Return bbimages(t.Value())
	End Method

	Method Before:bbimages()
		Local t:TLink
		t=_link.PrevLink()
		If t Return bbimages(t.Value())
	End Method


Field img 'handle
Field midhandled 'boolean
Field cat 'category //hooks into creature template

End Type 

Type bbaudio Extends TBBType

	Method New()
		Add(audio_list)
	End Method

	Method After:bbaudio()
		Local t:TLink
		t=_link.NextLink()
		If t Return bbaudio(t.Value())
	End Method

	Method Before:bbaudio()
		Local t:TLink
		t=_link.PrevLink()
		If t Return bbaudio(t.Value())
	End Method


Field cat 'category 
Field hnd
Field channel

End Type

Type bbaudiofx Extends TBBType

	Method New()
		Add(audiofx_list)
	End Method

	Method After:bbaudiofx()
		Local t:TLink
		t=_link.NextLink()
		If t Return bbaudiofx(t.Value())
	End Method

	Method Before:bbaudiofx()
		Local t:TLink
		t=_link.PrevLink()
		If t Return bbaudiofx(t.Value())
	End Method

Field hnd
Field time
End Type

Type bbcreature Extends TBBType

	Method New()
		Add(creature_list)
	End Method

	Method After:bbcreature()
		Local t:TLink
		t=_link.NextLink()
		If t Return bbcreature(t.Value())
	End Method

	Method Before:bbcreature()
		Local t:TLink
		t=_link.PrevLink()
		If t Return bbcreature(t.Value())
	End Method


Field img
Field cat
Field x#
Field y#
Field hp
Field fullhp
Field damage
Field skill

Field defenseskill 'for players

Field aimode
Field aidelay
Field aitime

Field moving 'boolean

Field healingtime 'for healing effect/buff effect
Field lightningtime 'for lightning blasts on creature effect
Field strucktime 'for blood effects
Field attacktime 

Field activated 'boolean
Field waitcount 'int

Field stunned 'int 0-n counts down each time active....
Field poison 'int 0-n = damage inflicted
Field regenerate 'boolean
Field cursed 'int 0-n //50% off defenseskill
Field berserk 'int
Field ethereal 'boolean
Field summonedtime 'int
End Type 


'new emitters and particles
Type bbparticle Extends TBBType

	Method New()
		Add(particle_list)
	End Method

	Method After:bbparticle()
		Local t:TLink
		t=_link.NextLink()
		If t Return bbparticle(t.Value())
	End Method

	Method Before:bbparticle()
		Local t:TLink
		t=_link.PrevLink()
		If t Return bbparticle(t.Value())
	End Method


Field r,g,b,a
Field x#,y#,vx#,vy#,ay#,gy#
Field life
Field dr,dg,db,da
Field sz,dsz

End Type



Main()

Function Main()
	quit = False
	gamemode = MODE_MENU
	init()
	Repeat
		frametime = MilliSecs()
		Cls
		'input 
		mx = MouseX()
		my = MouseY()
		olmb = lmb
		lmb = MouseDown(1)
		
	   For aud:bbaudio = EachIn audio_list
		 If(aud.cat=999)
	       If ChannelPlaying(aud.channel) = False
             aud.channel = PlaySound (aud.hnd)
           EndIf
         EndIf
       Next 	
		
		Select gamemode
		
		Case MODE_MENU
			handlemenu()
			drawmenu()
		
		Case MODE_COMBAT
			handleinput()
			updategame()
			drawgame()
		Case MODE_CUTSCENE
			handlecutscene()
			drawcutscene()
		Case MODE_UPGRADE
			handleupgrade()
			drawupgrade()
		End Select
		updatefx()
		Flip
		'very basic frame limiting
		endframetime = MilliSecs()
		dtime = endframetime - frametime
		If dtime &lt; 15 Then 
			Delay 15 - dtime
		EndIf 
		'end of frame limiting
		If(VKeyHit(1)) Then quit = True		
	Until quit
	';;;;;
	End
End Function 

Function init()
AppTitle ="Heroes of Dungonia"
Graphics SW,SH,0',WIN
'load data files
'load all images here
'load all sounds here
'load all music here
HideMouse 
audiostate = True

dir = ReadDir(CurrentDir()+"\audio")
Repeat
	file$ = NextFile(dir)
	If file="" Then Exit
	If Right(file,3) = "ogg" Then 
		aud:bbaudio = New bbaudio
		aud.hnd = LoadSound("audio\"+file)
		aud.cat = Int(Mid(file,7,3))
		If(aud.cat=999) Then 
			'LoopSound aud.hnd
			aud.channel =PlaySound (aud.hnd)
		EndIf 
	EndIf 
Forever
CloseDir dir 

dir = ReadDir(CurrentDir()+"\images")
Repeat
	file$ = NextFile(dir)
	If file="" Then Exit
	If Right(file,3) = "jpg" Or Right(file,3) = "png" Then 
		img:bbimages = New bbimages
		img.img = LoadImage("images\"+file)
		img.cat = Int(Left(file,5))
		'If Right(file,3)="png" Then 
		'	rgb = dev.blitz3d.ReadPixel(0,0,ImageBuffer(img.img))
		'	r0 = (rgb Shr 16) &amp; 255
		'	g0 = (rgb Shr 8) &amp; 255
		'	b0 = (rgb &amp; 255)
		'	MaskImage img.img,r0,g0,b0
		'EndIf 
	EndIf 
Forever
CloseDir dir

End Function 

Function handlemenu()
';;
';;;
';;Check if 'PLAY' pressed..if so then initialise
'first cut scene and change gamemode
';;Check if 'TOGGLE AUDIO' pressed if so toggle music/audio flags

If lmb&lt;&gt;0 And olmb=0 Then 
	If mx&gt;=1000 And mx&lt;=1200 Then 
		If my&gt;550 And my&lt;600 Then 
			'play hit
			initstartgame()
			gamemode = MODE_CUTSCENE
			playfx(CAT_CLICK)
		EndIf 
		If my&gt;650 And my&lt;700 Then 
			audiostate = Not audiostate
			If  audiostate
				'start music
				playfx(CAT_CLICK)
				For aud:bbaudio = EachIn audio_list
					If aud.cat = CAT_MUSIC
						If ChannelPlaying(aud.channel) Then 
						Else
							aud.channel = PlaySound(aud.hnd)
						EndIf 
					EndIf
				Next
			Else
				'stop
				For aud:bbaudio = EachIn audio_list
					If aud.cat = CAT_MUSIC
						If ChannelPlaying(aud.channel) Then 
							StopChannel aud.channel
						Else
						EndIf 
					EndIf
				Next

			EndIf 
		EndIf 
	EndIf 
EndIf 


End Function

Function drawmenu()
'draw backdrop
'draw buttons in relevant state
'draw mouse cursor

For img:bbimages = EachIn images_list
	If img.cat = 2011 Then 
		DrawImage img.img,0,0
	EndIf 
Next

For img:bbimages = EachIn images_list
	If img.cat = CAT_MENU_PLAY
		DrawImage img.img,1000,550
	EndIf
	If img.cat = CAT_MENU_AUDIO
		DrawImage img.img,1000,650
	EndIf
Next

For img:bbimages = EachIn images_list
	If img.cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img.img,mx,my
	EndIf
Next

End Function

Function handleinput()
'assign tx,ty of creatures to player units
'
acted = False
If lmb&lt;&gt;0 And olmb = 0 Then 
	For pc:bbcreature = EachIn creature_list
		If pc.hp&gt;0 And pc.cat&gt;=10 And pc.cat&lt;=13 Then 
			If mx&gt;pc.x - ImageWidth(pc.img)/2 And mx&lt;pc.x + ImageWidth(pc.img)/2 And my&gt;pc.y-40 And my&lt;pc.y+40 Then 
				For a:bbcreature = EachIn creature_list
					If a.hp&gt;0 And a.cat&lt;100 Then a.waitcount = a.waitcount + 1
					If a.waitcount &gt; 3 Then a.waitcount = 3
					If a.stunned &gt; 0 Then 
						a.stunned = a.stunned - 1
					EndIf 
				Next
				acted = True
				If pc.cat = CAT_FIGHTER And pc.stunned &lt;=0
					pc.attacktime = 30
					playfx(CAT_SWING1+Rand(0,3))
					For a:bbcreature = EachIn creature_list
						If a.cat &gt;= 100 And a.hp &gt; 0 Then 
							dieroll = Rand(1,1000)
							If dieroll &lt; pc.skill Then 
								If a.ethereal Then 'reduced damage to ethereals.
								a.hp = a.hp - pc.damage/3
								Else
									a.hp = a.hp - pc.damage
								EndIf
								playfxdelayed(CAT_HIT1+Rand(0,1),50)
								a.strucktime = 10
								'centaur goes berserk
								If a.cat = 108 Then a.berserk = 3
							EndIf 
						EndIf 
					Next
					pc.waitcount = 0
				EndIf
				If pc.cat = CAT_RANGER And pc.stunned &lt;=0
					maxhp = 0
					b:bbcreature = Null'
					pc.attacktime = 30
					playfx(CAT_SWING1+Rand(0,3))
					For a:bbcreature = EachIn creature_list
						If a.cat &gt;= 100 And a.hp &gt; 0 Then 
							If a.hp &gt; maxhp Then 
								maxhp = a.hp
								b:bbcreature = a:bbcreature
							EndIf 
						EndIf 
					Next
					If b:bbcreature&lt;&gt;Null Then 
						dieroll = Rand(1,1000)
						If dieroll &lt; pc.skill Then 
							If b.ethereal Then 'reduced damage to ethereals
								b.hp = b.hp - pc.damage * (1 + pc.waitcount)/3
							Else
								b.hp = b.hp - pc.damage * (1 + pc.waitcount)
							EndIf 
							b.strucktime = 15
							playfxdelayed(CAT_HIT1+Rand(0,1),50)
							If b.cat = 108 Then b.berserk = 3
						EndIf 
					EndIf 
					pc.waitcount = 0
				EndIf
				If pc.cat = CAT_WIZARD And pc.stunned&lt;=0
					pc.attacktime = 30
					damage = pc.damage * (pc.waitcount+1)
					kk = 0
					playfx(CAT_GOODBUFF)
					For a:bbcreature = EachIn creature_list
						If a.cat &gt;= 100 And a.hp &gt; 0 Then 
							dieroll = Rand(1,1000)
							If dieroll &lt; pc.skill Then 
								a.hp = a.hp - damage
								If a.ethereal Then 
									a.hp = a.hp - damage 'extra damage to ethereals
								EndIf 
								a.lightningtime = 30
								a.strucktime = 20
								kk = kk + 1
								playfxdelayed(CAT_HIT1+Rand(0,1),kk * 10)
								If a.cat = 108 Then a.berserk = 3
							Else
								pc.hp = pc.hp - 5 ' bad spell casting inflicts damage to caster
								pc.lightningtime = 30
								Exit
							EndIf 
						EndIf 
					Next
					pc.waitcount = 0
				EndIf
				If pc.cat = CAT_CLERIC And pc.stunned &lt;=0
					pc.attacktime = 30
					damage = pc.damage * (pc.waitcount + 1)
					playfx(CAT_GOODBUFF)
					For a:bbcreature = EachIn creature_list
						If a.cat &lt; 100 And a.hp &lt; a.fullhp And a.hp &gt; 0 Then 
							a.hp = a.hp + damage
							a.healingtime = 60
							If a.hp &gt; a.fullhp Then a.hp = a.fullhp
						EndIf 
					Next
					pc.waitcount = 0
				EndIf	
			EndIf 
		EndIf 
	Next
EndIf 
If acted
	'perform poison
	For pc:bbcreature = EachIn creature_list
		If pc.hp &gt; 0 And pc.poison &gt; 0 And pc.cat &lt; 100 Then 
			pc.hp = pc.hp - pc.poison
			pc.strucktime = 10
			dieroll = Rand(1,1000)
			If dieroll &lt; pc.defenseskill Then 
				pc.poison = 0
			EndIf 
		EndIf 
		If pc.hp &gt; 0 And pc.cat &lt; 100 And pc.cursed &gt; 0 Then 
			pc.cursed = pc.cursed - 1
		EndIf 
	Next
	For a:bbcreature = EachIn creature_list
		If a.hp &gt; 0 And a.cat &gt;= 100 Then 
			If a.cat = 113 Or a.cat = 114 'necromancer summons skeletons and liche, liche and skeleton also make skeletons go berserk
				For b:bbcreature = EachIn creature_list
					If b.hp&gt;0 And b.cat = 111 Then 
						dieroll = Rand(1,1000)
						If dieroll &lt; a.skill Then 
							b.berserk = b.berserk + Rand(0,2)
						EndIf
					EndIf 
					If a.cat = 114 Then 
						If b.hp &gt; 0 And b.hp &lt; b.fullhp And b.cat = 111 Then 
							dieroll = Rand(1,1000)
							If dieroll &lt; a.skill Then 
								b.hp = b.hp + 5
								b.healingtime = 60
							EndIf 
						EndIf
						If b.cat &lt; 100 And b.hp &gt; 0 Then 
							dieroll = Rand(1,1000)
							If dieroll &lt; a.skill Then 
								b.cursed = b.cursed + Rand(0,2)
							EndIf 
						EndIf 
					EndIf  
					If b.hp&lt;=0 And b.cat &gt;= 100 Then 
						dieroll = Rand(1,1000)
						If dieroll &lt; a.skill Then 
							createskeleton(b:bbcreature)
						EndIf 
					EndIf
				Next
			EndIf 
			count = 0
			If a.regenerate And a.hp &lt; a.fullhp Then 
				diff = (a.fullhp - a.hp) / 2
				a.hp = a.hp + diff
			EndIf 
			For pc:bbcreature = EachIn creature_list
				If pc.cat &lt; 100 And pc.hp &gt; 0 Then count = count + 1
			Next
			If count &gt; 0 Then 
				count = Rand(1,count)
				For pc:bbcreature = EachIn creature_list
					If pc.cat &lt; 100 And pc.hp &gt; 0 Then count = count - 1
					If count = 0 Then 
						dieroll = Rand(1,1000)
						If a.cat = 103 Then 'goblin shaman
							If dieroll &lt; a.skill Then 
								pc.hp = pc.hp - a.damage
								pc.strucktime = 10
								a.attacktime = 30
								pc.lightningtime = 30
								playfxdelayed(CAT_BADBUFF,100)
							EndIf
						ElseIf a.cat = 106 Then 'spider wizard
							If dieroll &lt; a.skill Then 
								pc.stunned = Rand(1,2)
								playfxdelayed(CAT_BADBUFF,100)
								dieroll2 = Rand(1,1000)
								If dieroll2 &gt; pc.defenseskill Then 
									pc.hp = pc.hp - a.damage
									pc.strucktime = 10
									a.attacktime = 30
								EndIf
								Exit
							EndIf 
						ElseIf a.cat = 107 Then 'spider queen
							If dieroll &lt; a.skill Then 
								For c:bbcreature = EachIn creature_list
									If c.cat &gt;= 100 And c.hp &gt; 0 And c.hp &lt; c.fullhp
										c.healingtime = 60
										c.hp = c.hp + a.damage
										playfxdelayed(CAT_BADBUFF,100)								
										Exit 
									EndIf 
								Next
								dieroll2 = Rand(1,1000)
								If pc.cursed Then dieroll2 = dieroll2 * 1.5
								If dieroll2 &gt; pc.defenseskill Then 
									pc.hp = pc.hp - a.damage
									pc.strucktime = 10
									a.attacktime = 30
									playfxdelayed(CAT_HIT1+Rand(0,1),100)
								EndIf
								If pc.cat = CAT_WIZARD Or pc.cat = CAT_CLERIC
									pc.waitcount = 0
									Exit 
								EndIf
							EndIf 
							If pc.cursed Then dieroll = dieroll * 1.5
							If dieroll &gt; pc.defenseskill Then 
								pc.hp = pc.hp - a.damage
								pc.strucktime = 10
								a.attacktime = 30
							EndIf
							Exit
						Else
							If pc.cursed Then dieroll = dieroll * 1.5
							If dieroll &gt; pc.defenseskill Then 
								pc.hp = pc.hp - a.damage
								pc.strucktime = 10
								a.attacktime = 30
								If a.poison &gt; 0 Then 
									pc.poison = a.poison
									playfxdelayed(CAT_BADBUFF,100)
								EndIf 
							EndIf
							If a.berserk &gt; 0 Then 
								a.berserk = a.berserk - 1
								'second attack
								dieroll = Rand(1,1000)
								If pc.cursed Then dieroll = dieroll * 1.5
								If dieroll &gt; pc.defenseskill Then 
									pc.hp = pc.hp - a.damage
									pc.strucktime = 10
									a.attacktime = 30
									If a.poison &gt; 0 Then 
										pc.poison = a.poison
									EndIf 
								EndIf
							EndIf 
							If a.cat = 110 Then 
								dieroll = Rand(1,1000)
								If dieroll &lt; a.skill Then 
									pc.cursed = Rand(1,3)
									playfxdelayed(CAT_BADBUFF,100)
								EndIf
							EndIf 
							Exit
						EndIf  
					EndIf 
				Next
				
			EndIf 
		EndIf 
	Next
EndIf
End Function

Function updategame()
'move all creatures
'move all bullets
'handle all collisions
'handle all pick ups
'handle all combat
'handle all spell casting (magic missiles and healing)

found = False

For pc:bbcreature = EachIn creature_list
	If pc.strucktime &gt; 0 Then 
		pc.strucktime = pc.strucktime - 1
		createbloodparticle(pc.x,pc.y)
		If pc.hp &lt;= 0 Then 
			createbloodparticle(pc.x,pc.y)
			createbloodparticle(pc.x,pc.y)
			createbloodparticle(pc.x,pc.y)
		EndIf 
	EndIf 
	If pc.hp&gt;0 Then 
		If pc.cursed &gt; 0 Then 
			createcurseparticle(pc.x,pc.y+40)
		EndIf 
		If pc.berserk &gt; 0 Then 
			createberserkparticle(pc.x,pc.y+40)
		EndIf 
		If pc.cat &gt;= 100 Then 
			found = True
		EndIf
	Else
		pc.Remove()
	EndIf 
Next
If found = False Then 
	levelfinishtime = levelfinishtime + 1
EndIf 
foundp = False
For pc:bbcreature = EachIn creature_list
	If pc.hp &gt; 0 And pc.cat &lt; 100 Then foundp = True;Exit 
Next
If foundp = False Then 
	levelfinishtime = levelfinishtime + 1
EndIf 
If levelfinishtime &gt; 250 Then 
	gamemode = MODE_MENU 'eventually change to mode_upgrade
	If foundp Then gamemode = MODE_UPGRADE
	If Not(foundp) Then 
		gamelevel = 999
		gamemode = MODE_CUTSCENE
	Else
		gamelevel = gamelevel + 1
		ftrpicked = False
		clrpicked = False
		rngpicked = False
		wizpicked = False 
	EndIf 
EndIf 

For pc:bbcreature = EachIn creature_list
	If pc.hp &gt; 0 Then 
		If pc.healingtime &gt; 0 Then pc.healingtime = pc.healingtime - 1
	EndIf 
Next
updateparticle()
End Function

Function drawgame()
'draw background (fixed static 1280x720 image background)
'draw all creatures - don't worry about zordering them - it will be too fast to notice 
'draw all bullets
For img:bbimages = EachIn images_list
	If img.cat = 2007 'change this later
		DrawImage img.img,0,0
	EndIf
Next
For pc:bbcreature = EachIn creature_list
	If pc.hp &gt; 0 Then
		aa# = 0
		bb# = 0
		If pc.attacktime &gt; 0 Then 
			pc.attacktime = pc.attacktime - 1
			aa# = -25.0 * Sin(pc.attacktime * 6)
			If pc.cat&gt;=100 Then aa = aa * -1.0
		EndIf 
		If pc.strucktime &gt; 0 Then 
			bb = Rand(-pc.strucktime/2,pc.strucktime/2)
		EndIf 
		If pc.poison &gt; 0 And pc.cat &lt; 100 Then 
			For img:bbimages = EachIn images_list
				If img.cat = 119 Then 
					DrawImage img.img,pc.x - ImageWidth(pc.img)/2,pc.y-40
					Exit
				EndIf 
			Next
			'Color 32,255,32
			'Oval pc\x - ImageWidth(pc\img)/2,pc\y-40,ImageWidth(pc\img),80,1
		EndIf 
		DrawImage pc.img,bb + pc.x - ImageWidth(pc.img)/2,pc.y - 40 + aa
		dhp = 10 * pc.hp / pc.fullhp
		If dhp &lt; 4 Then SetColor 255,32,32
		If dhp &gt;=4 And dhp&lt;8 Then SetColor 255,255,32
		If dhp &gt;=8 Then SetColor 32,255,32
		If dhp = 0 Then dhp = 1
		For hp = 1 To dhp
			DrawRect hp*4 + pc.x - ImageWidth(pc.img)/3,pc.y - 50,3,3',1
		Next
		SetColor 255,255,255
		If pc.healingtime &gt; 0 Then 
			createhealparticle(pc.x,pc.y)
		EndIf 
		If pc.summonedtime &gt; 0 Then 
			pc.summonedtime = pc.summonedtime - 1
			createsummonparticle(pc.x,pc.y)
		EndIf 
		If pc.lightningtime &gt; 0 Then 
			pc.lightningtime = pc.lightningtime - 1
			drawlightning(pc.x,pc.y)
		EndIf 
		If pc.waitcount &gt; 0 Then 
			SetColor 255,32,255
			For i = 1 To pc.waitcount
				DrawRect i * 4 + pc.x - ImageWidth(pc.img)/3,pc.y - 55,3,3',1
			Next
			SetColor 255,255,255
		EndIf 
		If pc.stunned &gt; 0 And pc.cat &lt; 100 Then 
			'Color 255,255,32
			'Oval pc\x - ImageWidth(pc\img)/2,pc\y-40,ImageWidth(pc\img),80,0
			For img:bbimages = EachIn images_list
				If img.cat = 118 Then 
					DrawImage img.img, pc.x - ImageWidth(pc.img)/2,pc.y-40
					Exit
				EndIf 
			Next
		EndIf 
	EndIf
Next
drawparticle()
SetColor 255,255,255
For img:bbimages = EachIn images_list
	If img.cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img.img,mx,my
	EndIf
Next
SetColor 255,255,255
End Function 

Function drawlightning(x,y)
iy = 0
ix = x + Rand(-20,20)
While iy &lt; y
	oy = iy
	ox = ix
	ix = x + Rand(-20,20)
	iy = iy + Rand(10,25)
	SetColor 200,200,255
	DrawLine ox,oy,ix,iy
	SetColor 150,150,200
	DrawLine ox+1,oy+1,ix+1,iy+1
	DrawLine ox-1,oy-1,ix-1,iy-1
	SetColor 100,100,150
	DrawLine ox+2,oy+2,ix+2,iy+2
	DrawLine ox-2,oy-2,ix-2,iy-2
	SetColor 32,32,90
	DrawLine ox+3,oy+3,ix+3,iy+3
	DrawLine ox-3,oy-3,ix-3,iy-3
Wend 
SetColor 255,255,255
End Function 

Function handlecutscene()
'handle transitions,  handle skip button; 
'handle fading in and out text (bitmap fonts?)
If gamelevel = 1 Or gamelevel = 4 Or gamelevel = 8 Or gamelevel = 11 Or gamelevel = 14 Or gamelevel = 999 Then
	
Else
	initlevel()
	gamemode = MODE_COMBAT
EndIf 
';
If lmb&lt;&gt;0 And olmb = 0 Then 
	If mx&gt;1000 And mx&lt;1200 And my&gt;650 And my&lt;700 Then 
		playfx(CAT_CLICK)
		If gamelevel &lt; 14 Then 
			initlevel()
			gamemode = MODE_COMBAT
		Else
			gamemode = MODE_MENU 'includes 999 (game over)
		EndIf
	EndIf 
EndIf 
';
End Function 

Function drawcutscene()
'draw cut scene background, draw transition, draw skip button
If gamelevel = 1 Or gamelevel = 4 Or gamelevel = 8 Or gamelevel = 11 Or gamelevel = 14 Or gamelevel = 999 Then
Else
	Return
EndIf
For img:bbimages = EachIn images_list
	If (img.cat = 2004 And gamelevel = 1) Or (img.cat = 2005 And gamelevel = 4) Or (img.cat = 2006 And gamelevel = 8) Or (img.cat = 2008 And gamelevel = 11) Or (img.cat = 2009 And gamelevel = 14) Or (img.cat = 2010 And gamelevel = 999) Then 
		DrawImage img.img,0,0
	EndIf 
Next
';
For img:bbimages = EachIn images_list
	If img.cat = CAT_MENU_SKIP_CUTSCENE
		DrawImage img.img,1000,650
	EndIf
Next
';
For img:bbimages = EachIn images_list
	If img.cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img.img,mx,my
	EndIf
Next
';
End Function 

Function handleupgrade()
'handle button press 'add stuff' to characters
'
'
'
If lmb&lt;&gt;0 And olmb = 0Then 
	If mx &gt; 1000 And mx&lt;1200 And my&gt;650 And my &lt;700
		gamemode = MODE_CUTSCENE
		FlushMouse()
		playfx(CAT_CLICK)
	EndIf
	i = -1
	For pc:bbcreature = EachIn creature_list
		If pc.cat &lt; 100 And pc.hp &gt; 0 Then 
			i = i + 1
			y = 100 * i + 200
			DrawImage pc.img,100,y
			If pc.cat = CAT_FIGHTER And (Not ftrpicked)
				If mx&gt;200 And mx &lt; 400 And my &gt; y And my &lt; y + 50 Then 
					'health picked
					ftrpicked = True
					pc.fullhp = pc.fullhp + 10
					playfx(CAT_CLICK)			
				EndIf 
				If mx&gt;450 And mx &lt; 650 And my &gt; y And my &lt; y + 50 Then 
					'damage picked
					ftrpicked = True
					pc.damage = pc.damage + 4
					playfx(CAT_CLICK)
				EndIf 
				
				If mx&gt;700 And mx &lt; 900 And my &gt; y And my &lt; y + 50 Then 
					'skill picked
					ftrpicked = True
					ds# = (1000 - pc.skill) * 0.95
					pc.skill = 1000 - ds
					playfx(CAT_CLICK)
				EndIf 
				
				If mx&gt;950 And mx &lt; 1150 And my &gt; y And my &lt; y + 50 Then 
					'def picked
					ftrpicked = True
					ds# = (1000 - pc.defenseskill) * 0.95
					pc.defenseskill = 1000 - ds
					playfx(CAT_CLICK)
				EndIf 
			EndIf
			If pc.cat = CAT_RANGER And (Not rngpicked)
				If mx&gt;200 And mx &lt; 400 And my &gt; y And my &lt; y + 50 Then 
					'health picked
					rngpicked = True
					pc.fullhp = pc.fullhp + 10
					playfx(CAT_CLICK)
				EndIf 
				If mx&gt;450 And mx &lt; 650 And my &gt; y And my &lt; y + 50 Then 
					'damage picked
					rngpicked = True
					pc.damage = pc.damage + 4
					playfx(CAT_CLICK)
				EndIf 
				
				If mx&gt;700 And mx &lt; 900 And my &gt; y And my &lt; y + 50 Then 
					'skill picked
					rngpicked = True
					ds# = (1000 - pc.skill) * 0.95
					pc.skill = 1000 - ds
					playfx(CAT_CLICK)
				EndIf 
				
				If mx&gt;950 And mx &lt; 1150 And my &gt; y And my &lt; y + 50 Then 
					'def picked
					rngpicked = True
					ds# = (1000 - pc.defenseskill) * 0.95
					pc.defenseskill = 1000 - ds
					playfx(CAT_CLICK)
				EndIf 
			
			EndIf
			If pc.cat = CAT_WIZARD And (Not wizpicked)
				If mx&gt;200 And mx &lt; 400 And my &gt; y And my &lt; y + 50 Then 
					'health picked
					wizpicked = True
					pc.fullhp = pc.fullhp + 10
					playfx(CAT_CLICK)
				EndIf 
				If mx&gt;450 And mx &lt; 650 And my &gt; y And my &lt; y + 50 Then 
					'damage picked
					wizpicked = True
					pc.damage = pc.damage + 4
					playfx(CAT_CLICK)
				EndIf 
				
				If mx&gt;700 And mx &lt; 900 And my &gt; y And my &lt; y + 50 Then 
					'skill picked
					wizpicked = True
					ds# = (1000 - pc.skill) * 0.95
					pc.skill = 1000 - ds
					playfx(CAT_CLICK)
				EndIf 
				
				If mx&gt;950 And mx &lt; 1150 And my &gt; y And my &lt; y + 50 Then 
					'def picked
					wizpicked = True
					ds# = (1000 - pc.defenseskill) * 0.95
					pc.defenseskill = 1000 - ds
					playfx(CAT_CLICK)
				EndIf 

			EndIf
			If pc.cat = CAT_CLERIC And (Not clrpicked)
				If mx&gt;200 And mx &lt; 400 And my &gt; y And my &lt; y + 50 Then 
					'health picked
					clrpicked = True
					pc.fullhp = pc.fullhp + 10
					playfx(CAT_CLICK)
				EndIf 
				If mx&gt;450 And mx &lt; 650 And my &gt; y And my &lt; y + 50 Then 
					'damage picked
					clrpicked = True
					pc.damage = pc.damage + 4
					playfx(CAT_CLICK)
				EndIf 
				If mx&gt;700 And mx &lt; 900 And my &gt; y And my &lt; y + 50 Then 
					'skill picked
					clrpicked = True
					ds# = (1000 - pc.skill) * 0.95
					pc.skill = 1000 - ds
					playfx(CAT_CLICK)
				EndIf 
				If mx&gt;950 And mx &lt; 1150 And my &gt; y And my &lt; y + 50 Then 
					'def picked
					clrpicked = True
					ds# = (1000 - pc.defenseskill) * 0.95
					pc.defenseskill = 1000 - ds
					playfx(CAT_CLICK)
				EndIf 
			EndIf 
		EndIf 
	Next
EndIf
End Function

Function drawupgrade()
'draw background
'draw buttons
'draw characters
'draw stats
'draw continue button
For img:bbimages = EachIn images_list
	If img.cat = 2012 Then 
		DrawImage img.img,0,0
	EndIf 
Next

i=-1
For pc:bbcreature = EachIn creature_list
	If pc.cat &lt; 100 And pc.hp &gt; 0 Then 
		pc.hp = pc.fullhp
		i = i + 1
		y = 100 * i + 200
		SetColor 96,96,80
		DrawRect 50,y - 5,1180,90',1
		SetColor 255,255,255
		DrawImage pc.img,100,y
	'	Text 150,i*100+200,"Skill:"+pc\skill+" Defense:"+pc\defenseskill + " Health:"+pc\fullhp + " Power:"+pc\damage
		If pc.cat = CAT_FIGHTER 
			For img:bbimages = EachIn images_list
				If img.cat = CAT_MENU_ADD_HEALTH Then
					If (Not ftrpicked) DrawImage img.img,200,y
					'Text 300,y + 65,pc\fullhp,1,1
					drawnumber(300,y + 65,pc.fullhp)
				EndIf
				If img.cat = CAT_MENU_ADD_DAMAGE Then
					If (Not ftrpicked) 	DrawImage img.img,450,y
					'Text 550,y + 65,pc\damage,1,1
					drawnumber(550,y + 65,pc.damage)
				EndIf
				If img.cat = CAT_MENU_ADD_SKILL Then
					If (Not ftrpicked) 	DrawImage img.img,700,y
					'Text 800,y + 65,pc\skill,1,1
					drawnumber(800,y + 65,pc.skill * 100 / 1000)
				EndIf
				If img.cat = CAT_MENU_ADD_DEF Then 
					If (Not ftrpicked) 	DrawImage img.img,950,y
					'Text 1050,y + 65,pc\defenseskill,1,1
					drawnumber(1050,y + 65,pc.defenseskill * 100 / 1000)
				EndIf 
			Next
		EndIf
		If pc.cat = CAT_RANGER 
			For img:bbimages = EachIn images_list
				If img.cat = CAT_MENU_ADD_HEALTH Then
					If (Not rngpicked) DrawImage img.img,200,y
					'Text 300,y + 65,pc\fullhp,1,1
					drawnumber(300,y + 65,pc.fullhp)
				EndIf
				If img.cat = CAT_MENU_ADD_DAMAGE Then
					If (Not rngpicked) DrawImage img.img,450,y
					'Text 550,y + 65,pc\damage,1,1
					drawnumber(550,y + 65,pc.damage)
				EndIf
				If img.cat = CAT_MENU_ADD_SKILL Then
					If (Not rngpicked) DrawImage img.img,700,y
					'Text 800,y + 65,pc\skill,1,1
					drawnumber(800,y + 65,pc.skill * 100 / 1000)
				EndIf
				If img.cat = CAT_MENU_ADD_DEF Then 
					If (Not rngpicked) DrawImage img.img,950,y
					'Text 1050,y + 65,pc\defenseskill,1,1
					drawnumber(1050,y + 65,pc.defenseskill * 100 / 1000)
				EndIf 
			Next
		
		EndIf
		If pc.cat = CAT_WIZARD 
			For img:bbimages = EachIn images_list
				If img.cat = CAT_MENU_ADD_HEALTH Then
					If (Not wizpicked) DrawImage img.img,200,y
'					Text 300,y + 65,pc\fullhp,1,1
					drawnumber(300,y + 65,pc.fullhp)
				EndIf
				If img.cat = CAT_MENU_ADD_DAMAGE Then
					If (Not wizpicked)  DrawImage img.img,450,y
					'Text 550,y + 65,pc\damage,1,1
					drawnumber(550,y + 65,pc.damage)
				EndIf
				If img.cat = CAT_MENU_ADD_SKILL Then
					If (Not wizpicked) DrawImage  img.img,700,y
					'Text 800,y + 65,pc\skill,1,1
					drawnumber(800,y + 65,pc.skill * 100 / 1000)
				EndIf
				If img.cat = CAT_MENU_ADD_DEF Then 
					If (Not wizpicked) DrawImage  img.img,950,y
					'Text 1050,y + 65,pc\defenseskill,1,1
					drawnumber(1050,y + 65,pc.defenseskill * 100 / 1000)
				EndIf 
			Next
		
		EndIf
		If pc.cat = CAT_CLERIC 
			For img:bbimages = EachIn images_list
				If img.cat = CAT_MENU_ADD_HEALTH Then
					If (Not clrpicked) DrawImage  img.img,200,y
					'Text 300,y + 65,pc\fullhp,1,1
					drawnumber(300,y + 65,pc.fullhp)
				EndIf
				If img.cat = CAT_MENU_ADD_DAMAGE Then
					If (Not clrpicked) 					DrawImage img.img,450,y
					'Text 550,y + 65,pc\damage,1,1
					drawnumber(550,y + 65,pc.damage)
				EndIf
				If img.cat = CAT_MENU_ADD_SKILL Then
					If (Not clrpicked) 					DrawImage img.img,700,y
					'Text 800,y + 65,pc\skill,1,1
					drawnumber(800,y + 65,pc.skill * 100 / 1000)
				EndIf
				If img.cat = CAT_MENU_ADD_DEF Then 
					If (Not clrpicked) 					DrawImage img.img,950,y
					'Text 1050,y + 65,pc\defenseskill,1,1
					drawnumber(1050,y + 65,pc.defenseskill * 100 / 1000)
				EndIf 
			Next
		
		EndIf 
	EndIf 
Next

For img:bbimages = EachIn images_list
	If img.cat = CAT_MENU_SKIP_CUTSCENE
		DrawImage img.img,1000,650
	EndIf
Next

For img:bbimages = EachIn images_list
	If img.cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img.img,mx,my
	EndIf
Next

End Function 

Function initstartgame()
gamelevel = 1
mapindex = 0
DeleteEach bb32
pc:bbcreature = New bbcreature
pc.fullhp = 90
pc.hp = 90
pc.cat = CAT_FIGHTER
pc.x = 600
pc.y = 300
pc.skill = 500
pc.defenseskill = 850
pc.damage = 15
For img:bbimages = EachIn images_list
	If img.cat = CAT_FIGHTER Then 
		pc.img = img.img
		Exit 
	EndIf 
Next
pc:bbcreature = New bbcreature
pc.fullhp = 75
pc.hp = 75
pc.cat = CAT_RANGER
pc.x = 640
pc.y = 300
pc.skill = 800
pc.defenseskill = 850
pc.damage = 50
For img:bbimages = EachIn images_list
	If img.cat = CAT_RANGER Then 
		pc.img = img.img
		Exit 
	EndIf 
Next
pc:bbcreature = New bbcreature
pc.fullhp = 45
pc.hp = 45
pc.cat = CAT_WIZARD
pc.x = 750
pc.y = 360
pc.skill = 650
pc.damage = 18
pc.defenseskill = 650
For img:bbimages = EachIn images_list
	If img.cat = CAT_WIZARD Then 
		pc.img = img.img
		Exit 
	EndIf 
Next
pc:bbcreature = New bbcreature
pc.fullhp = 60
pc.hp = 60
pc.cat = CAT_CLERIC
pc.x = 640
pc.defenseskill = 800
pc.y = 350
pc.skill = 100
pc.damage = 5
For img:bbimages = EachIn images_list
	If img.cat = CAT_CLERIC Then 
		pc.img = img.img
		Exit 
	EndIf 
Next
End Function 

Function initlevel()
For pc:bbcreature = EachIn creature_list
	If pc.hp &gt; 0 And pc.hp &lt; pc.fullhp Then pc.hp = pc.fullhp
	If pc.cat = CAT_FIGHTER
		pc.x = 540
		pc.y = 350
	EndIf
	If pc.cat = CAT_RANGER
		pc.x = 720
		pc.y = 350
	EndIf
	If pc.cat = CAT_WIZARD
		pc.x = 540
		pc.y = 440
	EndIf
	If pc.cat = CAT_CLERIC
		pc.x = 720
		pc.y = 440
	EndIf
	If pc.cat &gt;=100 Then pc.Remove()
Next

For i = 1 To 8
	pc:bbcreature = New bbcreature
	If i &lt; 5 Then 
		pc.x = 360 + (i-1) * 180'Rand(0,SW)
		pc.y = 180 'Rand(0,SH)
	Else
		pc.x = 450 + (i-5) * 180'Rand(0,SW)
		pc.y = 225 'Rand(0,SH)
	
	EndIf
	
	If gamelevel = 1 Then 
	pc.cat = 100+Rand(0,1)
	pc.hp = 70
	pc.fullhp = 50
	pc.damage = 5
	pc.skill = 80
	EndIf
	If gamelevel = 2 Then 
		'trolls2
		If i = 1 Or i = 8 Then 
			pc.cat = 102
			pc.hp = 200
			pc.regenerate = True
			pc.fullhp = 200
			pc.damage = 10
			pc.skill = 150
		Else
			pc.cat = 100+Rand(0,1)
			pc.hp = 70
			pc.fullhp = 50
			pc.damage = 5
			pc.skill = 80
		EndIf 
	EndIf 
	If gamelevel = 3 Then 
		'wizard and troll
		If i = 1 Or i = 8 Then
			pc.cat = 102
			pc.hp = 200
			pc.regenerate = True
			pc.fullhp = 200
			pc.damage = 10
			pc.skill = 150
		ElseIf i = 4 Then
			pc.cat = 103
			pc.hp = 100
			pc.fullhp = 100
			pc.damage = 5
			pc.skill = 350
		Else
			pc.cat = 100+Rand(0,1)
			pc.hp = 70
			pc.fullhp = 50
			pc.damage = 5
			pc.skill = 80
		EndIf 
	EndIf
	If gamelevel = 4 Then
		'spiderbeasts and giant spiders
		If i = 1 Or i = 8 Then 
			pc.cat = 104
			pc.hp = 150
			pc.poison = 15
			pc.regenerate = True
			pc.fullhp = 150
			pc.damage = 15
			pc.skill = 100
		Else
			pc.cat = 105
			pc.hp = 100
			pc.fullhp = 100
			pc.damage = 8
			pc.skill = 150
		EndIf 

	EndIf
	If gamelevel = 5 Then 
		'spiderbeasts, giant spiders and spider wizards
		If i = 1 Or i = 8 Then 
			pc.cat = 104
			pc.hp = 150
			pc.poison = 15
			pc.regenerate = True
			pc.fullhp = 150
			pc.damage = 15
			pc.skill = 100
		ElseIf i = 2 Or i = 7
			pc.cat = 106
			pc.hp = 100
			pc.fullhp = 100
			pc.damage = 8
			pc.skill = 300
		Else
			pc.cat = 105
			pc.hp = 100
			pc.fullhp = 100
			pc.damage = 8
			pc.skill = 150
		EndIf 


	EndIf 
	If gamelevel = 6 Then 
		'spider queens and spiderbeasts
		If i = 1 Or i = 8 Then 
			pc.cat = 107
			pc.hp = 100
			pc.fullhp = 100
			pc.damage = 5
			pc.skill = 450
		Else
			pc.cat = 105
			pc.hp = 100
			pc.fullhp = 100
			pc.damage = 8
			pc.skill = 150
		EndIf 
	EndIf 
	If gamelevel = 7 Then 
		'spider queens and giant spiders and spider wizards
		If i = 4 Or i = 5 Then 
			pc.cat = 107
			pc.hp = 100
			pc.fullhp = 100
			pc.damage = 5
			pc.skill = 450
		ElseIf i = 2 Or i = 7
			pc.cat = 106
			pc.hp = 100
			pc.fullhp = 100
			pc.damage = 8
			pc.skill = 300
		Else
			pc.cat = 104
			pc.hp = 150
			pc.regenerate = True
			pc.poison = 15
			pc.fullhp = 150
			pc.damage = 15
			pc.skill = 100
		EndIf 
	EndIf 
	'beasts
	If gamelevel = 8 Then 
		If i = 2 Or i = 6 Or i = 4
			'centaur
			pc.cat = 108
			pc.hp = 200
			pc.fullhp = 200
			pc.damage = 10
			pc.skill = 150
		Else
			'grunt
			pc.cat = 109
			pc.hp = 90
			pc.fullhp = 90
			pc.damage = 20
			pc.skill = 150
		EndIf
	EndIf
	If gamelevel = 9 Then
		If i = 3 Or i = 5 Then
			'shaman
			pc.cat = 110
			pc.hp = 180
			pc.fullhp = 180
			pc.damage = 15
			pc.skill = 250
		Else
			'grunt
			pc.cat = 109
			pc.hp = 90
			pc.fullhp = 90
			pc.damage = 20
			pc.skill = 150

		EndIf
	EndIf
	If gamelevel = 10 Then 
		If i = 1 Or i = 8 Then
			'shaman
			pc.cat = 110
			pc.hp = 180
			pc.fullhp = 180
			pc.damage = 15
			pc.skill = 250
		ElseIf i = 2 Or i = 7 Or i = 4 Then
			'centaur
			pc.cat = 108
			pc.hp = 200
			pc.fullhp = 200
			pc.damage = 10
			pc.skill = 150
		Else
			'grunt
			pc.cat = 109
			pc.hp = 90
			pc.fullhp = 90
			pc.damage = 20
			pc.skill = 150
		EndIf
	EndIf 
	If gamelevel = 11 Then
		If i = 4 Then
			'necromancer
			pc.cat = 113
			pc.hp = 200
			pc.fullhp = 200
			pc.damage = 20
			pc.skill = 250
		ElseIf i = 5 Then 
			'wraith
			pc.cat = 112
			pc.hp = 200
			pc.ethereal = True
			pc.fullhp = 200
			pc.damage = 15
			pc.skill = 300
		Else
			'skeleton
			pc.cat = 111
			pc.hp = 20
			pc.fullhp = 20
			pc.damage = 10
			pc.skill = 150
		EndIf
	EndIf
	If gamelevel = 12 Then 
		If i = 5 Or i = 7 Then 
			'necromancer
			pc.cat = 113
			pc.hp = 200
			pc.fullhp = 200
			pc.damage = 20
			pc.skill = 250

		ElseIf i = 4 Or i = 6
			'wraith
			pc.cat = 112
			pc.hp = 200
			pc.ethereal = True
			pc.fullhp = 200
			pc.damage = 15
			pc.skill = 300
		Else
			'skeleton
			pc.cat = 111
			pc.hp = 20
			pc.fullhp = 20
			pc.damage = 10
			pc.skill = 150
		EndIf
	EndIf
	If gamelevel = 13 Then 
		If i = 1 Then 
			'liche
			pc.cat = 114
			pc.hp = 300
			pc.fullhp = 300
			pc.damage = 20
			pc.skill = 350
		ElseIf i = 2 Or i = 3 Then 
			'necromancer
			pc.cat = 113
			pc.hp = 200
			pc.fullhp = 200
			pc.damage = 20
			pc.skill = 250
		ElseIf i = 4 Or i = 5 Then 
			'wraith
			pc.cat = 112
			pc.hp = 200
			pc.fullhp = 200
			pc.damage = 15
			pc.skill = 300
			pc.ethereal = True
		Else
			'skeletons
			pc.cat = 111
			pc.hp = 20
			pc.fullhp = 20
			pc.damage = 10
			pc.skill = 150
		EndIf
	EndIf 
	For img:bbimages = EachIn images_list
		If img.cat = pc.cat Then 
			pc.img = img.img
			Exit 
		EndIf 
	Next
Next

lmb = 0
olmb = 0
FlushMouse()
levelfinishtime = 0
End Function 

Function createskeleton:bbcreature(pc:bbcreature)
x = pc.x
y = pc.y
pc.Remove()
pc:bbcreature = New bbcreature
			pc.cat = 111
			pc.strucktime = 10
			For img:bbimages = EachIn images_list
				If img.cat = pc.cat Then pc.img = img.img;Exit 
			Next
			pc.hp = 20
			pc.x = x
			pc.y = y
			pc.fullhp = 20
			pc.damage = 10
			pc.skill = 150
			pc.regenerate = False
			pc.ethereal = False
			pc.summonedtime = 25
			pc.berserk = 0
Return pc
End Function 

Function createhealparticle(x,y)

For i = 1 To 36
	p:bbparticle = New bbparticle
	p.life = 20
	p.x = x + 25.0 * Cos(i*10)
	p.y = y + 20 + 25.0 * (Sin(i*5))
	p.vx = 0
	p.vy = Rand(-4,-2)
	p.ay = 0.1
	p.gy = p.y + 100
	p.r = 32
	p.g = 200
	p.b = 255
	p.sz = 4
	p.dsz = -0.1
	p.dr = 10
	p.dg = 2
	p.db = 0
Next

End Function 

Function createsummonparticle(x,y)

For i = 1 To 36
	p:bbparticle = New bbparticle
	p.life = 20
	p.x = x + 25.0 * Cos(i*10)
	p.y = y + 20 + 25.0 * (Sin(i*5))
	p.vx = 0
	p.vy = Rand(-4,-2)
	p.ay = 0.1
	p.gy = p.y + 100
	p.r = 32
	p.g = 255
	p.b = 50
	p.sz = 4
	p.dsz = -0.1
	p.dr = 8
	p.dg = 0
	p.db = 8
Next

End Function 


Function createbloodparticle(x,y)

For i = 1 To 10
	p:bbparticle = New bbparticle
	p.life = 20
	p.x = x + Rand(-10,10)
	p.y = y + Rand(-10,10)
	p.vx = Rnd(-3,3)
	p.vy = Rnd(-3,3)
	p.ay = 0.05
	p.gy = y + 42
	p.r = 255
	p.g = 100
	p.b = 100
	p.dr = -2
	p.dg = -3
	p.db = -3
	p.sz = 4
	p.dsz = 0
Next

End Function 

Function createcurseparticle(x,y)
For i = 1 To 36
	p:bbparticle = New bbparticle
	p.life = 10+Rand(5)
	p.x = x +25 * Cos(i*10)
	p.y = y + 15.0 * Abs(Sin(i*10))
	p.vx = 0
	p.vy = Rand(-4,-2)
	p.ay = 0.1
	p.gy = p.y + 100
	p.r = 255
	p.g = 50
	p.b = 255
	p.sz = 4
	p.dsz = 0.25
	p.dr = 0
	p.dg = 22
	p.db = 0
Next
End Function 
Function createberserkparticle(x,y)
For i = 1 To 36
	p:bbparticle = New bbparticle
	p.life = 10+Rand(5)
	p.x = x +25 * Cos(i*10)
	p.y = y + 15.0 * Abs(Sin(i*10))
	p.vx = 0
	p.vy = Rand(-4,-2)
	p.ay = 0.1
	p.gy = p.y + 100
	p.r = 255
	p.g = 50
	p.b = 255
	p.sz = 4
	p.dsz = 0.25
	p.dr = 0
	p.dg = 22
	p.db = 0
Next



End Function 

Function updateparticle()
For p:bbparticle = EachIn particle_list
	p.life = p.life - 1
	p.x = p.x + p.vx
	p.y = p.y + p.vy
	p.vy = p.vy + p.ay
	If p.y &gt; p.gy Then 
		p.vy = p.vy * -0.7
		If Abs(p.vy)&lt;0.01 Then p.life = 0
	EndIf 
	p.sz = p.sz + p.dsz
	p.r = p.r + p.dr
	p.g = p.g + p.dg
	p.b = p.b + p.db
	If p.sz &lt; 0 Then p.sz = 0
	If p.r &gt; 255 Then p.r = 255
	If p.g &gt; 255 Then p.g = 255
	If p.b &gt; 255 Then p.b = 255
	If p.r &lt; 0 Then p.r = 0
	If p.g &lt; 0 Then p.g = 0
	If p.b &lt; 0 Then p.b = 0
	If p.life &lt; 0 Then p.Remove()
Next
End Function 

Function drawparticle()
For p:bbparticle = EachIn particle_list
	SetColor p.r,p.g,p.b
	DrawRect p.x,p.y,p.sz,p.sz',1
Next
SetColor 255,255,255
End Function 

Function drawnumber(x,y,num)
txt$ = String(num)
For i = 1 To Len(txt)
	digit = Int(Mid(txt,i,1))
	For img:bbimages = EachIn images_list
		If img.cat = 10000 + digit Then 
			DrawImage img.img,x + (i-1) * 50 - Len(txt) * 25,y - 25
			Exit
		EndIf
	Next
Next 
End Function 

Function playfx(cat)
If audiostate
	For aud:bbaudio = EachIn audio_list
		If aud.cat = cat Then 
			aud.channel = PlaySound(aud.hnd)
		EndIf 
	Next
EndIf
End Function 

Function updatefx()
If audiostate = False Then deleteEach bb32
For fx:bbaudiofx = EachIn audiofx_list
	If MilliSecs()&gt;fx.time Then 
		PlaySound(fx.hnd)
		fx.Remove()
	EndIf 
Next
End Function 

Function playfxdelayed(cat,time)
If audiostate
	For aud:bbaudio = EachIn audio_list
		If aud.cat = cat Then 
			found = False
			For fx:bbaudiofx = EachIn audiofx_list
				If fx.hnd = aud.hnd And fx.time &lt; MilliSecs() + time * 2 Then
					found = True
					Exit
				EndIf
			Next
			If found = False Then 
				fx:bbaudiofx = New bbaudiofx
				fx.hnd = aud.hnd
				fx.time = MilliSecs() + time
			EndIf 
		EndIf 
	Next
EndIf

End Function 

</textarea> <br><br></td></tr></table><br>
<a name="1341425"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gpete</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#100">[#100]</a></td></tr></table></td></tr><tr ><td class="posttext"> nice work! Matty I like your bitmap characters, but if the characters are not drawn facing in 8 directions then why have a isometric style floor tile? (ie Diablo 2).. <br><br></td></tr></table><br>
<a name="1341437"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#101">[#101]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi gpete...had i been able to draw a larger detailed image for the dungeon levels i would have and still might...as it was i simply used a tile i had available. ... <br><br></td></tr></table><br>
<a name="1341438"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#102">[#102]</a></td></tr></table></td></tr><tr ><td class="posttext"> So -1. I think the upgrade screen could do with some work.<br><br>2. The dungeon level could be drawn better.<br><br>3. The lightning sound could be shifted.<br><br>4. ???<br><br>What are we going to do with this? Rooster you have blitzmax so I suppose you could release a Mac version.<br><br>5. It needs a credits page for the two of us.  I'll do that next. <br><br></td></tr></table><br>
<a name="1341439"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rooster</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#103">[#103]</a></td></tr></table></td></tr><tr ><td class="posttext"> Can you cross compile Mac from Linux? I do have a windows laptop I can use if I need to. <br><br></td></tr></table><br>
<a name="1341440"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xlsior</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#104">[#104]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Can you cross compile Mac from Linux? I do have a windows laptop I can use if I need to.  <br></div><br><br>You can only compile for Mac from Mac, due to the apple-proprietary compile tools. <br><br></td></tr></table><br>
<a name="1341448"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#105">[#105]</a></td></tr></table></td></tr><tr ><td class="posttext"> Update with credits:<br><br><a href="http://www.mattiesgames.com/bbgame/game5.zip" target="_blank">Link</a><br><br>New snippet in 'main' that handles the credits on exit<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
;This is both a learning exercise and hopefully a collaborative project of sorts
;or at least a project I can share with others on the blitz forum.
;It will be written initially in blitzplus/blitz3d And maybe someone will be keen on
;porting it to blitzmax...even blitzmax-ng to release on mobile perhaps?
;
;Interface:
;Left mouse button clicking only to make porting to 
;mobile interface much, much easier.
;Gameplay Mechanic Has changed - turn based more detailed
;
;Gameplay mechanic so far (15-May-2017)
;
;1. Arcade Action RPG Combat
;	Player controls 4 characters in a single screen dungeon.
;	Dungeon has a few walls and so on that prevent movement.
;	Monsters spawn from spawners and make their way around the map
;	Player taps the screen to move to location and characters fight things
;	in their path.
;	Powerups exist in the level such as:
;	Health pickups
;	Bombs - kill all monsters that have spawned or at least damage them.
;	
;2. After the arcade sequence the player is presented with options to upgrade their
;	character's stats. Stats to upgrade include:
;	Combat skill ('to hit roll')
;	Damage output ('damage points')
;	Health points ('hp')
;	Movement speed ('move')
;3.	After this a short cut scene is presented which may simply be a scrolling static
;	image with some fading in/fading out text to advance the story line
;0. Menu - toggle audio, play, credits
;
;Character types:
;1 Fighter - high hitpoint melee combat medium damage
;2 Ranger - medium hitpoint melee combat high damage
;3 Wizard - low hitpoint, ranged combat, medium damage
;4 Cleric - medium hitpoint, no combat, healer
;


;constants
Const SW=1280,SH=720,WIN=2
Const MODE_MENU = 0
Const MODE_COMBAT = 1
Const MODE_UPGRADE = 2
Const MODE_CUTSCENE = 3
Const PURE_2D = True ;if go to blitzmax can use 2d-in-3d commands such as alpha otherwise have to calculate manually.Change to false for blitzmax.

;categories for image types and object types
Const CAT_MENU_PLAY = 0
Const CAT_MENU_AUDIO = 1
Const CAT_MENU_SKIP_CUTSCENE = 2 ;cut scene mode
Const CAT_MENU_ADD_SKILL = 3 ;upgrade mode
Const CAT_MENU_ADD_DAMAGE = 4;upgrade mode
Const CAT_MENU_ADD_HEALTH = 5;upgrade mode
;Const CAT_MENU_ADD_SPEED = 6;
Const CAT_MENU_ADD_DEF = 6
Const CAT_MENU_MOUSE_CURSOR = 7;
Const CAT_FIGHTER = 10
Const CAT_KNIGHT = 10 ;synonym
Const CAT_RANGER = 11
Const CAT_WIZARD = 12
Const CAT_CLERIC = 13
Const CAT_HEALER = 13 ;synonym
Const CAT_HEALTH_PICKUP = 20
Const CAT_BOMB_PICKUP = 21
;CAT_BACKGROUND = 2000-3000 ; all the different image backgrounds
;CAT_MONSTER = 100-1000 , all the different monster types
;CAT_NUMBERS = 10000-10009
;AUDIO CATEGORIES
Const CAT_MUSIC = 999
Const CAT_BADBUFF = 1
Const CAT_CLICK = 0
Const CAT_GOODBUFF = 2
Const CAT_HIT1 = 3
Const CAT_HIT2 = 4
Const CAT_SWING1 = 5
Const CAT_SWING2 = 6
Const CAT_SWING3 = 7
Const CAT_SWING4 = 8

;globals
Global mx,my,lmb,olmb ;mouse input
Global audiostate ;on/off
Global gamemode ;references const above
Global gamelevel ;for cutscenes
Global cutsceneframe ;for cutscenes ie trigger fades, text, motion etc on certain frames
Global levelfinishtime = 0
Global mapdelay ;timestamp
Global mapindex

Global ftrpicked,rngpicked,wizpicked,clrpicked ;boolean for upgrades

;types
Type images

Field img ;handle
Field midhandled ;boolean
Field cat ;category //hooks into creature template

End Type 

Type audio

Field cat ;category 
Field hnd
Field channel

End Type

type audiofx
field hnd
field time
end type

Type creature

Field img
Field cat
Field x#
Field y#
Field hp
Field fullhp
Field damage
Field skill

Field defenseskill ;for players

Field aimode
Field aidelay
Field aitime

Field moving ;boolean

Field healingtime ;for healing effect/buff effect
Field lightningtime ;for lightning blasts on creature effect
Field strucktime ;for blood effects
Field attacktime 

Field activated ;boolean
Field waitcount ;int

Field stunned ;int 0-n counts down each time active....
Field poison ;int 0-n = damage inflicted
Field regenerate ;boolean
Field cursed ;int 0-n //50% off defenseskill
Field berserk ;int
Field ethereal ;boolean
Field summonedtime ;int
End Type 


;new emitters and particles
Type particle

Field r,g,b,a
Field x#,y#,vx#,vy#,ay#,gy#
Field life
Field dr,dg,db,da
Field sz,dsz

End Type



main()

Function main()
	quit = False
	gamemode = MODE_MENU
	init()
	Repeat
		frametime = MilliSecs()
		Cls
		;input 
		mx = MouseX()
		my = MouseY()
		olmb = lmb
		lmb = MouseDown(1)
		Select gamemode
		
		Case MODE_MENU
			handlemenu()
			drawmenu()
		
		Case MODE_COMBAT
			handleinput()
			updategame()
			drawgame()
		Case MODE_CUTSCENE
			handlecutscene()
			drawcutscene()
		Case MODE_UPGRADE
			handleupgrade()
			drawupgrade()
		End Select
		updatefx()
		Flip
		;very basic frame limiting
		endframetime = MilliSecs()
		dtime = endframetime - frametime
		If dtime &lt; 15 Then 
			Delay 15 - dtime
		EndIf 
		;end of frame limiting
		If(KeyHit(1)) Then quit = True		
	Until quit
	;;;;;;
	Cls
	For img.images = Each images
		If img\cat = 2013
			DrawImage img\img,0,0
			Flip
			Delay 3500
			Exit
		EndIf
	Next
	End
End Function 

Function init()
AppTitle "Heroes of Dungonia"
Graphics SW,SH,0,WIN
;load data files
;load all images here
;load all sounds here
;load all music here
HidePointer 
audiostate = True

dir = ReadDir(CurrentDir()+"\audio")
Repeat
	file$ = NextFile(dir)
	If file="" Then Exit
	If Right(file,3) = "ogg" Then 
		aud.audio = New audio
		aud\hnd = LoadSound("audio\"+file)
		aud\cat = Int(Mid(file,7,3))
		If(aud\cat=999) Then 
			LoopSound aud\hnd
			aud\channel =PlaySound (aud\hnd)
		EndIf 
	EndIf 
Forever
CloseDir dir 

dir = ReadDir(CurrentDir()+"\images")
Repeat
	file$ = NextFile(dir)
	If file="" Then Exit
	If Right(file,3) = "jpg" Or Right(file,3) = "png" Then 
		img.images = New images
		img\img = LoadImage("images\"+file)
		img\cat = Int(Left(file,5))
		If Right(file,3)="png" Then 
			rgb = ReadPixel(0,0,ImageBuffer(img\img))
			r0 = (rgb Shr 16) And 255
			g0 = (rgb Shr 8) And 255
			b0 = (rgb And 255)
			MaskImage img\img,r0,g0,b0
		EndIf 
	EndIf 
Forever
CloseDir dir

End Function 

Function handlemenu()
;;;
;;;;
;;;Check if 'PLAY' pressed..if so then initialise
;first cut scene and change gamemode
;;;Check if 'TOGGLE AUDIO' pressed if so toggle music/audio flags

If lmb&lt;&gt;0 And olmb=0 Then 
	If mx&gt;=1000 And mx&lt;=1200 Then 
		If my&gt;550 And my&lt;600 Then 
			;play hit
			initstartgame()
			gamemode = MODE_CUTSCENE
			playfx(CAT_CLICK)
		EndIf 
		If my&gt;650 And my&lt;700 Then 
			audiostate = Not audiostate
			If  audiostate
				;start music
				playfx(CAT_CLICK)
				For aud.audio = Each audio
					If aud\cat = CAT_MUSIC
						If ChannelPlaying(aud\channel) Then 
						Else
							aud\channel = PlaySound(aud\hnd)
						EndIf 
					EndIf
				Next
			Else
				;stop
				For aud.audio = Each audio
					If aud\cat = CAT_MUSIC
						If ChannelPlaying(aud\channel) Then 
							StopChannel aud\channel
						Else
						EndIf 
					EndIf
				Next

			EndIf 
		EndIf 
	EndIf 
EndIf 


End Function

Function drawmenu()
;draw backdrop
;draw buttons in relevant state
;draw mouse cursor

For img.images = Each images
	If img\cat = 2011 Then 
		DrawBlock img\img,0,0
	EndIf 
Next

For img.images = Each images
	If img\cat = CAT_MENU_PLAY
		DrawImage img\img,1000,550
	EndIf
	If img\cat = CAT_MENU_AUDIO
		DrawImage img\img,1000,650
	EndIf
Next

For img.images = Each images
	If img\cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img\img,mx,my
	EndIf
Next

End Function

Function handleinput()
;assign tx,ty of creatures to player units
;
acted = False
If lmb&lt;&gt;0 And olmb = 0 Then 
	For pc.creature = Each creature
		If pc\hp&gt;0 And pc\cat&gt;=10 And pc\cat&lt;=13 Then 
			If mx&gt;pc\x - ImageWidth(pc\img)/2 And mx&lt;pc\x + ImageWidth(pc\img)/2 And my&gt;pc\y-40 And my&lt;pc\y+40 Then 
				For a.creature = Each creature
					If a\hp&gt;0 And a\cat&lt;100 Then a\waitcount = a\waitcount + 1
					If a\waitcount &gt; 3 Then a\waitcount = 3
					If a\stunned &gt; 0 Then 
						a\stunned = a\stunned - 1
					EndIf 
				Next
				acted = True
				If pc\cat = CAT_FIGHTER And pc\stunned &lt;=0
					pc\attacktime = 30
					playfx(CAT_SWING1+rand(0,3))
					For a.creature = Each creature
						If a\cat &gt;= 100 And a\hp &gt; 0 Then 
							dieroll = Rand(1,1000)
							If dieroll &lt; pc\skill Then 
								If a\ethereal Then ;reduced damage to ethereals.
								a\hp = a\hp - pc\damage/3
								Else
									a\hp = a\hp - pc\damage
								EndIf
								playfxdelayed(CAT_HIT1+Rand(0,1),50)
								a\strucktime = 10
								;centaur goes berserk
								If a\cat = 108 Then a\berserk = 3
							EndIf 
						EndIf 
					Next
					pc\waitcount = 0
				EndIf
				If pc\cat = CAT_RANGER And pc\stunned &lt;=0
					maxhp = 0
					b.creature = Null;
					pc\attacktime = 30
					playfx(CAT_SWING1+rand(0,3))
					For a.creature = Each creature
						If a\cat &gt;= 100 And a\hp &gt; 0 Then 
							If a\hp &gt; maxhp Then 
								maxhp = a\hp
								b.creature = a.creature
							EndIf 
						EndIf 
					Next
					If b.creature&lt;&gt;Null Then 
						dieroll = Rand(1,1000)
						If dieroll &lt; pc\skill Then 
							If b\ethereal Then ;reduced damage to ethereals
								b\hp = b\hp - pc\damage * (1 + pc\waitcount)/3
							Else
								b\hp = b\hp - pc\damage * (1 + pc\waitcount)
							EndIf 
							b\strucktime = 15
							playfxdelayed(CAT_HIT1+Rand(0,1),50)
							If b\cat = 108 Then b\berserk = 3
						EndIf 
					EndIf 
					pc\waitcount = 0
				EndIf
				If pc\cat = CAT_WIZARD And pc\stunned&lt;=0
					pc\attacktime = 30
					damage = pc\damage * (pc\waitcount+1)
					kk = 0
					playfx(CAT_GOODBUFF)
					For a.creature = Each creature
						If a\cat &gt;= 100 And a\hp &gt; 0 Then 
							dieroll = Rand(1,1000)
							If dieroll &lt; pc\skill Then 
								a\hp = a\hp - damage
								If a\ethereal Then 
									a\hp = a\hp - damage ;extra damage to ethereals
								EndIf 
								a\lightningtime = 30
								a\strucktime = 20
								kk = kk + 1
								playfxdelayed(CAT_HIT1+rand(0,1),kk * 10)
								If a\cat = 108 Then a\berserk = 3
							Else
								pc\hp = pc\hp - 5 ; bad spell casting inflicts damage to caster
								pc\lightningtime = 30
								Exit
							EndIf 
						EndIf 
					Next
					pc\waitcount = 0
				EndIf
				If pc\cat = CAT_CLERIC And pc\stunned &lt;=0
					pc\attacktime = 30
					damage = pc\damage * (pc\waitcount + 1)
					playfx(CAT_GOODBUFF)
					For a.creature = Each creature
						If a\cat &lt; 100 And a\hp &lt; a\fullhp And a\hp &gt; 0 Then 
							a\hp = a\hp + damage
							a\healingtime = 60
							If a\hp &gt; a\fullhp Then a\hp = a\fullhp
						EndIf 
					Next
					pc\waitcount = 0
				EndIf	
			EndIf 
		EndIf 
	Next
EndIf 
If acted
	;perform poison
	For pc.creature = Each creature
		If pc\hp &gt; 0 And pc\poison &gt; 0 And pc\cat &lt; 100 Then 
			pc\hp = pc\hp - pc\poison
			pc\strucktime = 10
			dieroll = rand(1,1000)
			If dieroll &lt; pc\defenseskill Then 
				pc\poison = 0
			EndIf 
		EndIf 
		If pc\hp &gt; 0 And pc\cat &lt; 100 And pc\cursed &gt; 0 Then 
			pc\cursed = pc\cursed - 1
		EndIf 
	Next
	For a.creature = Each creature
		If a\hp &gt; 0 And a\cat &gt;= 100 Then 
			If a\cat = 113 Or a\cat = 114 ;necromancer summons skeletons and liche, liche and skeleton also make skeletons go berserk
				For b.creature = Each creature
					If b\hp&gt;0 And b\cat = 111 Then 
						dieroll = Rand(1,1000)
						If dieroll &lt; a\skill Then 
							b\berserk = b\berserk + Rand(0,2)
						EndIf
					EndIf 
					If a\cat = 114 Then 
						If b\hp &gt; 0 And b\hp &lt; b\fullhp And b\cat = 111 Then 
							dieroll = Rand(1,1000)
							If dieroll &lt; a\skill Then 
								b\hp = b\hp + 5
								b\healingtime = 60
							EndIf 
						EndIf
						If b\cat &lt; 100 And b\hp &gt; 0 Then 
							dieroll = Rand(1,1000)
							If dieroll &lt; a\skill Then 
								b\cursed = b\cursed + Rand(0,2)
							EndIf 
						EndIf 
					EndIf  
					If b\hp&lt;=0 And b\cat &gt;= 100 Then 
						dieroll = Rand(1,1000)
						If dieroll &lt; a\skill Then 
							createskeleton(b.creature)
						EndIf 
					EndIf
				Next
			EndIf 
			count = 0
			if a\regenerate and a\hp &lt; a\fullhp then 
				diff = (a\fullhp - a\hp) / 2
				a\hp = a\hp + diff
			endif 
			For pc.creature = Each creature
				If pc\cat &lt; 100 And pc\hp &gt; 0 Then count = count + 1
			Next
			If count &gt; 0 Then 
				count = Rand(1,count)
				For pc.creature = Each creature
					If pc\cat &lt; 100 And pc\hp &gt; 0 Then count = count - 1
					If count = 0 Then 
						dieroll = Rand(1,1000)
						If a\cat = 103 Then ;goblin shaman
							If dieroll &lt; a\skill Then 
								pc\hp = pc\hp - a\damage
								pc\strucktime = 10
								a\attacktime = 30
								pc\lightningtime = 30
								playfxdelayed(CAT_BADBUFF,100)
							EndIf
						ElseIf a\cat = 106 Then ;spider wizard
							If dieroll &lt; a\skill Then 
								pc\stunned = Rand(1,2)
								playfxdelayed(CAT_BADBUFF,100)
								dieroll2 = Rand(1,1000)
								If dieroll2 &gt; pc\defenseskill Then 
									pc\hp = pc\hp - a\damage
									pc\strucktime = 10
									a\attacktime = 30
								EndIf
								Exit
							EndIf 
						ElseIf a\cat = 107 Then ;spider queen
							If dieroll &lt; a\skill Then 
								For c.creature = Each creature
									If c\cat &gt;= 100 And c\hp &gt; 0 And c\hp &lt; c\fullhp
										c\healingtime = 60
										c\hp = c\hp + a\damage
										playfxdelayed(CAT_BADBUFF,100)								
										Exit 
									EndIf 
								Next
								dieroll2 = Rand(1,1000)
								If pc\cursed Then dieroll2 = dieroll2 * 1.5
								If dieroll2 &gt; pc\defenseskill Then 
									pc\hp = pc\hp - a\damage
									pc\strucktime = 10
									a\attacktime = 30
									playfxdelayed(CAT_HIT1+rand(0,1),100)
								EndIf
								If pc\cat = CAT_WIZARD Or pc\cat = CAT_CLERIC
									pc\waitcount = 0
									Exit 
								EndIf
							EndIf 
							If pc\cursed Then dieroll = dieroll * 1.5
							If dieroll &gt; pc\defenseskill Then 
								pc\hp = pc\hp - a\damage
								pc\strucktime = 10
								a\attacktime = 30
							EndIf
							Exit
						Else
							If pc\cursed Then dieroll = dieroll * 1.5
							If dieroll &gt; pc\defenseskill Then 
								pc\hp = pc\hp - a\damage
								pc\strucktime = 10
								a\attacktime = 30
								if a\poison &gt; 0 then 
									pc\poison = a\poison
									playfxdelayed(CAT_BADBUFF,100)
								endif 
							EndIf
							If a\berserk &gt; 0 Then 
								a\berserk = a\berserk - 1
								;second attack
								dieroll = Rand(1,1000)
								If pc\cursed Then dieroll = dieroll * 1.5
								If dieroll &gt; pc\defenseskill Then 
									pc\hp = pc\hp - a\damage
									pc\strucktime = 10
									a\attacktime = 30
									If a\poison &gt; 0 Then 
										pc\poison = a\poison
									EndIf 
								EndIf
							EndIf 
							If a\cat = 110 Then 
								dieroll = Rand(1,1000)
								If dieroll &lt; a\skill Then 
									pc\cursed = Rand(1,3)
									playfxdelayed(CAT_BADBUFF,100)
								EndIf
							EndIf 
							Exit
						EndIf  
					EndIf 
				Next
				
			EndIf 
		EndIf 
	Next
EndIf
End Function

Function updategame()
;move all creatures
;move all bullets
;handle all collisions
;handle all pick ups
;handle all combat
;handle all spell casting (magic missiles and healing)

found = False

For pc.creature = Each creature
	If pc\strucktime &gt; 0 Then 
		pc\strucktime = pc\strucktime - 1
		createbloodparticle(pc\x,pc\y)
		If pc\hp &lt;= 0 Then 
			createbloodparticle(pc\x,pc\y)
			createbloodparticle(pc\x,pc\y)
			createbloodparticle(pc\x,pc\y)
		EndIf 
	EndIf 
	If pc\hp&gt;0 Then 
		If pc\cursed &gt; 0 Then 
			createcurseparticle(pc\x,pc\y+40)
		EndIf 
		If pc\berserk &gt; 0 Then 
			createberserkparticle(pc\x,pc\y+40)
		EndIf 
		If pc\cat &gt;= 100 Then 
			found = True
		EndIf
	Else
		Delete pc
	EndIf 
Next
If found = False Then 
	levelfinishtime = levelfinishtime + 1
EndIf 
foundp = False
For pc.creature = Each creature
	If pc\hp &gt; 0 And pc\cat &lt; 100 Then foundp = True:Exit 
Next
If foundp = False Then 
	levelfinishtime = levelfinishtime + 1
EndIf 
If levelfinishtime &gt; 250 Then 
	gamemode = MODE_MENU ;eventually change to mode_upgrade
	If foundp Then gamemode = MODE_UPGRADE
	if not(foundp) then 
		gamelevel = 999
		gamemode = MODE_CUTSCENE
	else
		gamelevel = gamelevel + 1
		ftrpicked = False
		clrpicked = False
		rngpicked = False
		wizpicked = False 
	endif 
EndIf 

For pc.creature = Each creature
	If pc\hp &gt; 0 Then 
		If pc\healingtime &gt; 0 Then pc\healingtime = pc\healingtime - 1
	EndIf 
Next
updateparticle()
End Function

Function drawgame()
;draw background (fixed static 1280x720 image background)
;draw all creatures - don't worry about zordering them - it will be too fast to notice 
;draw all bullets
For img.images = Each images
	If img\cat = 2007 ;change this later
		DrawBlock img\img,0,0
	EndIf
Next
For pc.creature = Each creature
	If pc\hp &gt; 0 Then
		aa# = 0
		bb# = 0
		If pc\attacktime &gt; 0 Then 
			pc\attacktime = pc\attacktime - 1
			aa# = -25.0 * Sin(pc\attacktime * 6)
			If pc\cat&gt;=100 Then aa = aa * -1.0
		EndIf 
		If pc\strucktime &gt; 0 Then 
			bb = Rand(-pc\strucktime/2,pc\strucktime/2)
		EndIf 
		If pc\poison &gt; 0 And pc\cat &lt; 100 Then 
			For img.images = Each images
				If img\cat = 119 Then 
					DrawImage img\img,pc\x - ImageWidth(pc\img)/2,pc\y-40
					Exit
				EndIf 
			Next
			;Color 32,255,32
			;Oval pc\x - ImageWidth(pc\img)/2,pc\y-40,ImageWidth(pc\img),80,1
		EndIf 
		DrawImage pc\img,bb + pc\x - ImageWidth(pc\img)/2,pc\y - 40 + aa
		dhp = 10 * pc\hp / pc\fullhp
		If dhp &lt; 4 Then Color 255,32,32
		If dhp &gt;=4 And dhp&lt;8 Then Color 255,255,32
		If dhp &gt;=8 Then Color 32,255,32
		If dhp = 0 Then dhp = 1
		For hp = 1 To dhp
			Rect hp*4 + pc\x - ImageWidth(pc\img)/3,pc\y - 50,3,3,1
		Next
		If pc\healingtime &gt; 0 Then 
			createhealparticle(pc\x,pc\y)
		EndIf 
		If pc\summonedtime &gt; 0 Then 
			pc\summonedtime = pc\summonedtime - 1
			createsummonparticle(pc\x,pc\y)
		EndIf 
		If pc\lightningtime &gt; 0 Then 
			pc\lightningtime = pc\lightningtime - 1
			drawlightning(pc\x,pc\y)
		EndIf 
		If pc\waitcount &gt; 0 Then 
			Color 255,32,255
			For i = 1 To pc\waitcount
				Rect i * 4 + pc\x - ImageWidth(pc\img)/3,pc\y - 55,3,3,1
			Next
		EndIf 
		If pc\stunned &gt; 0 and pc\cat &lt; 100 Then 
			;Color 255,255,32
			;Oval pc\x - ImageWidth(pc\img)/2,pc\y-40,ImageWidth(pc\img),80,0
			For img.images = Each images
				If img\cat = 118 Then 
					DrawImage img\img, pc\x - ImageWidth(pc\img)/2,pc\y-40
					Exit
				EndIf 
			Next
		EndIf 
	EndIf
Next
drawparticle()
Color 255,255,255
For img.images = Each images
	If img\cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img\img,mx,my
	EndIf
Next
End Function 

Function drawlightning(x,y)
iy = 0
ix = x + Rand(-20,20)
While iy &lt; y
	oy = iy
	ox = ix
	ix = x + Rand(-20,20)
	iy = iy + Rand(10,25)
	Color 200,200,255
	Line ox,oy,ix,iy
	Color 150,150,200
	Line ox+1,oy+1,ix+1,iy+1
	Line ox-1,oy-1,ix-1,iy-1
	Color 100,100,150
	Line ox+2,oy+2,ix+2,iy+2
	Line ox-2,oy-2,ix-2,iy-2
	Color 32,32,90
	Line ox+3,oy+3,ix+3,iy+3
	Line ox-3,oy-3,ix-3,iy-3
Wend 

End Function 

Function handlecutscene()
;handle transitions,  handle skip button; 
;handle fading in and out text (bitmap fonts?)
If gamelevel = 1 Or gamelevel = 4 Or gamelevel = 8 Or gamelevel = 11 Or gamelevel = 14 or gamelevel = 999 Then
	
Else
	initlevel()
	gamemode = MODE_COMBAT
EndIf 
;;
If lmb&lt;&gt;0 And olmb = 0 Then 
	If mx&gt;1000 And mx&lt;1200 And my&gt;650 And my&lt;700 Then 
		playfx(CAT_CLICK)
		If gamelevel &lt; 14 Then 
			initlevel()
			gamemode = MODE_COMBAT
		Else
			gamemode = MODE_MENU ;includes 999 (game over)
		EndIf
	EndIf 
EndIf 
;;
End Function 

Function drawcutscene()
;draw cut scene background, draw transition, draw skip button
If gamelevel = 1 Or gamelevel = 4 Or gamelevel = 8 Or gamelevel = 11 Or gamelevel = 14 or gamelevel = 999 Then
Else
	Return
EndIf
For img.images = Each images
	If (img\cat = 2004 And gamelevel = 1) Or (img\cat = 2005 And gamelevel = 4) Or (img\cat = 2006 And gamelevel = 8) Or (img\cat = 2008 And gamelevel = 11) Or (img\cat = 2009 And gamelevel = 14) or (img\cat = 2010 And gamelevel = 999) Then 
		DrawBlock img\img,0,0
	EndIf 
Next
;;
For img.images = Each images
	If img\cat = CAT_MENU_SKIP_CUTSCENE
		DrawImage img\img,1000,650
	EndIf
Next
;;
For img.images = Each images
	If img\cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img\img,mx,my
	EndIf
Next
;;
End Function 

Function handleupgrade()
;handle button press 'add stuff' to characters
;
;
;
If lmb&lt;&gt;0 And olmb = 0Then 
	If mx &gt; 1000 And mx&lt;1200 And my&gt;650 And my &lt;700
		gamemode = MODE_CUTSCENE
		FlushMouse()
		playfx(CAT_CLICK)
	EndIf
	i = -1
	For pc.creature = Each creature
		If pc\cat &lt; 100 And pc\hp &gt; 0 Then 
			i = i + 1
			y = 100 * i + 200
			DrawImage pc\img,100,y
			If pc\cat = CAT_FIGHTER And (Not ftrpicked)
				If mx&gt;200 And mx &lt; 400 And my &gt; y And my &lt; y + 50 Then 
					;health picked
					ftrpicked = True
					pc\fullhp = pc\fullhp + 10
					playfx(CAT_CLICK)			
				EndIf 
				If mx&gt;450 And mx &lt; 650 And my &gt; y And my &lt; y + 50 Then 
					;damage picked
					ftrpicked = True
					pc\damage = pc\damage + 4
					playfx(CAT_CLICK)
				EndIf 
				
				If mx&gt;700 And mx &lt; 900 And my &gt; y And my &lt; y + 50 Then 
					;skill picked
					ftrpicked = True
					ds# = (1000 - pc\skill) * 0.95
					pc\skill = 1000 - ds
					playfx(CAT_CLICK)
				EndIf 
				
				If mx&gt;950 And mx &lt; 1150 And my &gt; y And my &lt; y + 50 Then 
					;def picked
					ftrpicked = True
					ds# = (1000 - pc\defenseskill) * 0.95
					pc\defenseskill = 1000 - ds
					playfx(CAT_CLICK)
				EndIf 
			EndIf
			If pc\cat = CAT_RANGER And (Not rngpicked)
				If mx&gt;200 And mx &lt; 400 And my &gt; y And my &lt; y + 50 Then 
					;health picked
					rngpicked = True
					pc\fullhp = pc\fullhp + 10
					playfx(CAT_CLICK)
				EndIf 
				If mx&gt;450 And mx &lt; 650 And my &gt; y And my &lt; y + 50 Then 
					;damage picked
					rngpicked = True
					pc\damage = pc\damage + 4
					playfx(CAT_CLICK)
				EndIf 
				
				If mx&gt;700 And mx &lt; 900 And my &gt; y And my &lt; y + 50 Then 
					;skill picked
					rngpicked = True
					ds# = (1000 - pc\skill) * 0.95
					pc\skill = 1000 - ds
					playfx(CAT_CLICK)
				EndIf 
				
				If mx&gt;950 And mx &lt; 1150 And my &gt; y And my &lt; y + 50 Then 
					;def picked
					rngpicked = True
					ds# = (1000 - pc\defenseskill) * 0.95
					pc\defenseskill = 1000 - ds
					playfx(CAT_CLICK)
				EndIf 
			
			EndIf
			If pc\cat = CAT_WIZARD And (Not wizpicked)
				If mx&gt;200 And mx &lt; 400 And my &gt; y And my &lt; y + 50 Then 
					;health picked
					wizpicked = True
					pc\fullhp = pc\fullhp + 10
					playfx(CAT_CLICK)
				EndIf 
				If mx&gt;450 And mx &lt; 650 And my &gt; y And my &lt; y + 50 Then 
					;damage picked
					wizpicked = True
					pc\damage = pc\damage + 4
					playfx(CAT_CLICK)
				EndIf 
				
				If mx&gt;700 And mx &lt; 900 And my &gt; y And my &lt; y + 50 Then 
					;skill picked
					wizpicked = True
					ds# = (1000 - pc\skill) * 0.95
					pc\skill = 1000 - ds
					playfx(CAT_CLICK)
				EndIf 
				
				If mx&gt;950 And mx &lt; 1150 And my &gt; y And my &lt; y + 50 Then 
					;def picked
					wizpicked = True
					ds# = (1000 - pc\defenseskill) * 0.95
					pc\defenseskill = 1000 - ds
					playfx(CAT_CLICK)
				EndIf 

			EndIf
			If pc\cat = CAT_CLERIC And (Not clrpicked)
				If mx&gt;200 And mx &lt; 400 And my &gt; y And my &lt; y + 50 Then 
					;health picked
					clrpicked = True
					pc\fullhp = pc\fullhp + 10
					playfx(CAT_CLICK)
				EndIf 
				If mx&gt;450 And mx &lt; 650 And my &gt; y And my &lt; y + 50 Then 
					;damage picked
					clrpicked = True
					pc\damage = pc\damage + 4
					playfx(CAT_CLICK)
				EndIf 
				If mx&gt;700 And mx &lt; 900 And my &gt; y And my &lt; y + 50 Then 
					;skill picked
					clrpicked = True
					ds# = (1000 - pc\skill) * 0.95
					pc\skill = 1000 - ds
					playfx(CAT_CLICK)
				EndIf 
				If mx&gt;950 And mx &lt; 1150 And my &gt; y And my &lt; y + 50 Then 
					;def picked
					clrpicked = True
					ds# = (1000 - pc\defenseskill) * 0.95
					pc\defenseskill = 1000 - ds
					playfx(CAT_CLICK)
				EndIf 
			EndIf 
		EndIf 
	Next
EndIf
End Function

Function drawupgrade()
;draw background
;draw buttons
;draw characters
;draw stats
;draw continue button
For img.images = Each images
	If img\cat = 2012 Then 
		DrawBlock img\img,0,0
	EndIf 
Next

i=-1
For pc.creature = Each creature
	If pc\cat &lt; 100 And pc\hp &gt; 0 Then 
		pc\hp = pc\fullhp
		i = i + 1
		y = 100 * i + 200
		Color 96,96,80
		Rect 50,y - 5,1180,90,1
		DrawImage pc\img,100,y
	;	Text 150,i*100+200,"Skill:"+pc\skill+" Defense:"+pc\defenseskill + " Health:"+pc\fullhp + " Power:"+pc\damage
		If pc\cat = CAT_FIGHTER 
			For img.images = Each images
				If img\cat = CAT_MENU_ADD_HEALTH Then
					If (Not ftrpicked) DrawImage img\img,200,y
					;Text 300,y + 65,pc\fullhp,1,1
					drawnumber(300,y + 65,pc\fullhp)
				EndIf
				If img\cat = CAT_MENU_ADD_DAMAGE Then
					If (Not ftrpicked) 	DrawImage img\img,450,y
					;Text 550,y + 65,pc\damage,1,1
					drawnumber(550,y + 65,pc\damage)
				EndIf
				If img\cat = CAT_MENU_ADD_SKILL Then
					If (Not ftrpicked) 	DrawImage img\img,700,y
					;Text 800,y + 65,pc\skill,1,1
					drawnumber(800,y + 65,pc\skill * 100 / 1000)
				EndIf
				If img\cat = CAT_MENU_ADD_DEF Then 
					If (Not ftrpicked) 	DrawImage img\img,950,y
					;Text 1050,y + 65,pc\defenseskill,1,1
					drawnumber(1050,y + 65,pc\defenseskill * 100 / 1000)
				EndIf 
			Next
		EndIf
		If pc\cat = CAT_RANGER 
			For img.images = Each images
				If img\cat = CAT_MENU_ADD_HEALTH Then
					If (Not rngpicked) DrawImage img\img,200,y
					;Text 300,y + 65,pc\fullhp,1,1
					drawnumber(300,y + 65,pc\fullhp)
				EndIf
				If img\cat = CAT_MENU_ADD_DAMAGE Then
					If (Not rngpicked) DrawImage img\img,450,y
					;Text 550,y + 65,pc\damage,1,1
					drawnumber(550,y + 65,pc\damage)
				EndIf
				If img\cat = CAT_MENU_ADD_SKILL Then
					If (Not rngpicked) DrawImage img\img,700,y
					;Text 800,y + 65,pc\skill,1,1
					drawnumber(800,y + 65,pc\skill * 100 / 1000)
				EndIf
				If img\cat = CAT_MENU_ADD_DEF Then 
					If (Not rngpicked) DrawImage img\img,950,y
					;Text 1050,y + 65,pc\defenseskill,1,1
					drawnumber(1050,y + 65,pc\defenseskill * 100 / 1000)
				EndIf 
			Next
		
		EndIf
		If pc\cat = CAT_WIZARD 
			For img.images = Each images
				If img\cat = CAT_MENU_ADD_HEALTH Then
					If (Not wizpicked) DrawImage img\img,200,y
;					Text 300,y + 65,pc\fullhp,1,1
					drawnumber(300,y + 65,pc\fullhp)
				EndIf
				If img\cat = CAT_MENU_ADD_DAMAGE Then
					If (Not wizpicked)  DrawImage img\img,450,y
					;Text 550,y + 65,pc\damage,1,1
					drawnumber(550,y + 65,pc\damage)
				EndIf
				If img\cat = CAT_MENU_ADD_SKILL Then
					If (Not wizpicked) DrawImage  img\img,700,y
					;Text 800,y + 65,pc\skill,1,1
					drawnumber(800,y + 65,pc\skill * 100 / 1000)
				EndIf
				If img\cat = CAT_MENU_ADD_DEF Then 
					If (Not wizpicked) DrawImage  img\img,950,y
					;Text 1050,y + 65,pc\defenseskill,1,1
					drawnumber(1050,y + 65,pc\defenseskill * 100 / 1000)
				EndIf 
			Next
		
		EndIf
		If pc\cat = CAT_CLERIC 
			For img.images = Each images
				If img\cat = CAT_MENU_ADD_HEALTH Then
					If (Not clrpicked) DrawImage  img\img,200,y
					;Text 300,y + 65,pc\fullhp,1,1
					drawnumber(300,y + 65,pc\fullhp)
				EndIf
				If img\cat = CAT_MENU_ADD_DAMAGE Then
					If (Not clrpicked) 					DrawImage img\img,450,y
					;Text 550,y + 65,pc\damage,1,1
					drawnumber(550,y + 65,pc\damage)
				EndIf
				If img\cat = CAT_MENU_ADD_SKILL Then
					If (Not clrpicked) 					DrawImage img\img,700,y
					;Text 800,y + 65,pc\skill,1,1
					drawnumber(800,y + 65,pc\skill * 100 / 1000)
				EndIf
				If img\cat = CAT_MENU_ADD_DEF Then 
					If (Not clrpicked) 					DrawImage img\img,950,y
					;Text 1050,y + 65,pc\defenseskill,1,1
					drawnumber(1050,y + 65,pc\defenseskill * 100 / 1000)
				EndIf 
			Next
		
		EndIf 
	EndIf 
Next

For img.images = Each images
	If img\cat = CAT_MENU_SKIP_CUTSCENE
		DrawImage img\img,1000,650
	EndIf
Next

For img.images = Each images
	If img\cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img\img,mx,my
	EndIf
Next

End Function 

Function initstartgame()
gamelevel = 1
mapindex = 0
Delete Each creature
pc.creature = New creature
pc\fullhp = 90
pc\hp = 90
pc\cat = CAT_FIGHTER
pc\x = 600
pc\y = 300
pc\skill = 500
pc\defenseskill = 850
pc\damage = 15
For img.images = Each images
	If img\cat = CAT_FIGHTER Then 
		pc\img = img\img
		Exit 
	EndIf 
Next
pc.creature = New creature
pc\fullhp = 75
pc\hp = 75
pc\cat = CAT_RANGER
pc\x = 640
pc\y = 300
pc\skill = 800
pc\defenseskill = 850
pc\damage = 50
For img.images = Each images
	If img\cat = CAT_RANGER Then 
		pc\img = img\img
		Exit 
	EndIf 
Next
pc.creature = New creature
pc\fullhp = 45
pc\hp = 45
pc\cat = CAT_WIZARD
pc\x = 750
pc\y = 360
pc\skill = 650
pc\damage = 18
pc\defenseskill = 650
For img.images = Each images
	If img\cat = CAT_WIZARD Then 
		pc\img = img\img
		Exit 
	EndIf 
Next
pc.creature = New creature
pc\fullhp = 60
pc\hp = 60
pc\cat = CAT_CLERIC
pc\x = 640
pc\defenseskill = 800
pc\y = 350
pc\skill = 100
pc\damage = 5
For img.images = Each images
	If img\cat = CAT_CLERIC Then 
		pc\img = img\img
		Exit 
	EndIf 
Next
End Function 

Function initlevel()
For pc.creature = Each creature
	If pc\hp &gt; 0 And pc\hp &lt; pc\fullhp Then pc\hp = pc\fullhp
	If pc\cat = CAT_FIGHTER
		pc\x = 540
		pc\y = 350
	EndIf
	If pc\cat = CAT_RANGER
		pc\x = 720
		pc\y = 350
	EndIf
	If pc\cat = CAT_WIZARD
		pc\x = 540
		pc\y = 440
	EndIf
	If pc\cat = CAT_CLERIC
		pc\x = 720
		pc\y = 440
	EndIf
	If pc\cat &gt;=100 Then Delete pc
Next

For i = 1 To 8
	pc.creature = New creature
	If i &lt; 5 Then 
		pc\x = 360 + (i-1) * 180;Rand(0,SW)
		pc\y = 180 ;Rand(0,SH)
	Else
		pc\x = 450 + (i-5) * 180;Rand(0,SW)
		pc\y = 225 ;Rand(0,SH)
	
	EndIf
	
	If gamelevel = 1 Then 
	pc\cat = 100+Rand(0,1)
	pc\hp = 70
	pc\fullhp = 50
	pc\damage = 5
	pc\skill = 80
	EndIf
	If gamelevel = 2 Then 
		;trolls2
		If i = 1 Or i = 8 Then 
			pc\cat = 102
			pc\hp = 200
			pc\regenerate = true
			pc\fullhp = 200
			pc\damage = 10
			pc\skill = 150
		Else
			pc\cat = 100+Rand(0,1)
			pc\hp = 70
			pc\fullhp = 50
			pc\damage = 5
			pc\skill = 80
		EndIf 
	EndIf 
	If gamelevel = 3 Then 
		;wizard and troll
		If i = 1 Or i = 8 Then
			pc\cat = 102
			pc\hp = 200
			pc\regenerate = true
			pc\fullhp = 200
			pc\damage = 10
			pc\skill = 150
		ElseIf i = 4 Then
			pc\cat = 103
			pc\hp = 100
			pc\fullhp = 100
			pc\damage = 5
			pc\skill = 350
		Else
			pc\cat = 100+Rand(0,1)
			pc\hp = 70
			pc\fullhp = 50
			pc\damage = 5
			pc\skill = 80
		EndIf 
	EndIf
	If gamelevel = 4 Then
		;spiderbeasts and giant spiders
		If i = 1 Or i = 8 Then 
			pc\cat = 104
			pc\hp = 150
			pc\poison = 15
			pc\regenerate = true
			pc\fullhp = 150
			pc\damage = 15
			pc\skill = 100
		Else
			pc\cat = 105
			pc\hp = 100
			pc\fullhp = 100
			pc\damage = 8
			pc\skill = 150
		EndIf 

	EndIf
	If gamelevel = 5 Then 
		;spiderbeasts, giant spiders and spider wizards
		If i = 1 Or i = 8 Then 
			pc\cat = 104
			pc\hp = 150
			pc\poison = 15
			pc\regenerate = true
			pc\fullhp = 150
			pc\damage = 15
			pc\skill = 100
		ElseIf i = 2 Or i = 7
			pc\cat = 106
			pc\hp = 100
			pc\fullhp = 100
			pc\damage = 8
			pc\skill = 300
		Else
			pc\cat = 105
			pc\hp = 100
			pc\fullhp = 100
			pc\damage = 8
			pc\skill = 150
		EndIf 


	EndIf 
	If gamelevel = 6 Then 
		;spider queens and spiderbeasts
		If i = 1 Or i = 8 Then 
			pc\cat = 107
			pc\hp = 100
			pc\fullhp = 100
			pc\damage = 5
			pc\skill = 450
		Else
			pc\cat = 105
			pc\hp = 100
			pc\fullhp = 100
			pc\damage = 8
			pc\skill = 150
		EndIf 
	EndIf 
	If gamelevel = 7 Then 
		;spider queens and giant spiders and spider wizards
		If i = 4 Or i = 5 Then 
			pc\cat = 107
			pc\hp = 100
			pc\fullhp = 100
			pc\damage = 5
			pc\skill = 450
		ElseIf i = 2 Or i = 7
			pc\cat = 106
			pc\hp = 100
			pc\fullhp = 100
			pc\damage = 8
			pc\skill = 300
		Else
			pc\cat = 104
			pc\hp = 150
			pc\regenerate = true
			pc\poison = 15
			pc\fullhp = 150
			pc\damage = 15
			pc\skill = 100
		EndIf 
	EndIf 
	;beasts
	If gamelevel = 8 Then 
		If i = 2 Or i = 6 Or i = 4
			;centaur
			pc\cat = 108
			pc\hp = 200
			pc\fullhp = 200
			pc\damage = 10
			pc\skill = 150
		Else
			;grunt
			pc\cat = 109
			pc\hp = 90
			pc\fullhp = 90
			pc\damage = 20
			pc\skill = 150
		EndIf
	EndIf
	If gamelevel = 9 Then
		If i = 3 Or i = 5 Then
			;shaman
			pc\cat = 110
			pc\hp = 180
			pc\fullhp = 180
			pc\damage = 15
			pc\skill = 250
		Else
			;grunt
			pc\cat = 109
			pc\hp = 90
			pc\fullhp = 90
			pc\damage = 20
			pc\skill = 150

		EndIf
	EndIf
	If gamelevel = 10 Then 
		If i = 1 Or i = 8 Then
			;shaman
			pc\cat = 110
			pc\hp = 180
			pc\fullhp = 180
			pc\damage = 15
			pc\skill = 250
		ElseIf i = 2 Or i = 7 Or i = 4 Then
			;centaur
			pc\cat = 108
			pc\hp = 200
			pc\fullhp = 200
			pc\damage = 10
			pc\skill = 150
		Else
			;grunt
			pc\cat = 109
			pc\hp = 90
			pc\fullhp = 90
			pc\damage = 20
			pc\skill = 150
		EndIf
	EndIf 
	If gamelevel = 11 Then
		If i = 4 Then
			;necromancer
			pc\cat = 113
			pc\hp = 200
			pc\fullhp = 200
			pc\damage = 20
			pc\skill = 250
		ElseIf i = 5 Then 
			;wraith
			pc\cat = 112
			pc\hp = 200
			pc\ethereal = True
			pc\fullhp = 200
			pc\damage = 15
			pc\skill = 300
		Else
			;skeleton
			pc\cat = 111
			pc\hp = 20
			pc\fullhp = 20
			pc\damage = 10
			pc\skill = 150
		EndIf
	EndIf
	If gamelevel = 12 Then 
		If i = 5 Or i = 7 Then 
			;necromancer
			pc\cat = 113
			pc\hp = 200
			pc\fullhp = 200
			pc\damage = 20
			pc\skill = 250

		ElseIf i = 4 Or i = 6
			;wraith
			pc\cat = 112
			pc\hp = 200
			pc\ethereal = True
			pc\fullhp = 200
			pc\damage = 15
			pc\skill = 300
		Else
			;skeleton
			pc\cat = 111
			pc\hp = 20
			pc\fullhp = 20
			pc\damage = 10
			pc\skill = 150
		EndIf
	EndIf
	If gamelevel = 13 Then 
		If i = 1 Then 
			;liche
			pc\cat = 114
			pc\hp = 300
			pc\fullhp = 300
			pc\damage = 20
			pc\skill = 350
		ElseIf i = 2 Or i = 3 Then 
			;necromancer
			pc\cat = 113
			pc\hp = 200
			pc\fullhp = 200
			pc\damage = 20
			pc\skill = 250
		ElseIf i = 4 Or i = 5 Then 
			;wraith
			pc\cat = 112
			pc\hp = 200
			pc\fullhp = 200
			pc\damage = 15
			pc\skill = 300
			pc\ethereal = True
		Else
			;skeletons
			pc\cat = 111
			pc\hp = 20
			pc\fullhp = 20
			pc\damage = 10
			pc\skill = 150
		EndIf
	EndIf 
	For img.images = Each images
		If img\cat = pc\cat Then 
			pc\img = img\img
			Exit 
		EndIf 
	Next
Next

lmb = 0
olmb = 0
FlushMouse()
levelfinishtime = 0
End Function 

Function createskeleton.creature(pc.creature)
x = pc\x
y = pc\y
Delete pc
pc.creature = New creature
			pc\cat = 111
			pc\strucktime = 10
			For img.images = Each images
				If img\cat = pc\cat Then pc\img = img\img:Exit 
			Next
			pc\hp = 20
			pc\x = x
			pc\y = y
			pc\fullhp = 20
			pc\damage = 10
			pc\skill = 150
			pc\regenerate = False
			pc\ethereal = False
			pc\summonedtime = 25
			pc\berserk = 0
Return pc
End Function 

Function createhealparticle(x,y)

For i = 1 To 36
	p.particle = New particle
	p\life = 20
	p\x = x + 25.0 * Cos(i*10)
	p\y = y + 20 + 25.0 * (Sin(i*5))
	p\vx = 0
	p\vy = Rand(-4,-2)
	p\ay = 0.1
	p\gy = p\y + 100
	p\r = 32
	p\g = 200
	p\b = 255
	p\sz = 4
	p\dsz = -0.1
	p\dr = 10
	p\dg = 2
	p\db = 0
Next

End Function 

Function createsummonparticle(x,y)

For i = 1 To 36
	p.particle = New particle
	p\life = 20
	p\x = x + 25.0 * Cos(i*10)
	p\y = y + 20 + 25.0 * (Sin(i*5))
	p\vx = 0
	p\vy = Rand(-4,-2)
	p\ay = 0.1
	p\gy = p\y + 100
	p\r = 32
	p\g = 255
	p\b = 50
	p\sz = 4
	p\dsz = -0.1
	p\dr = 8
	p\dg = 0
	p\db = 8
Next

End Function 


Function createbloodparticle(x,y)

For i = 1 To 10
	p.particle = New particle
	p\life = 20
	p\x = x + Rand(-10,10)
	p\y = y + Rand(-10,10)
	p\vx = Rnd(-3,3)
	p\vy = Rnd(-3,3)
	p\ay = 0.05
	p\gy = y + 42
	p\r = 255
	p\g = 100
	p\b = 100
	p\dr = -2
	p\dg = -3
	p\db = -3
	p\sz = 4
	p\dsz = 0
Next

End Function 

Function createcurseparticle(x,y)
For i = 1 To 36
	p.particle = New particle
	p\life = 10+Rand(5)
	p\x = x +25 * Cos(i*10)
	p\y = y + 15.0 * Abs(Sin(i*10))
	p\vx = 0
	p\vy = Rand(-4,-2)
	p\ay = 0.1
	p\gy = p\y + 100
	p\r = 255
	p\g = 50
	p\b = 255
	p\sz = 4
	p\dsz = 0.25
	p\dr = 0
	p\dg = 22
	p\db = 0
Next
End Function 
Function createberserkparticle(x,y)
For i = 1 To 36
	p.particle = New particle
	p\life = 10+Rand(5)
	p\x = x +25 * Cos(i*10)
	p\y = y + 15.0 * Abs(Sin(i*10))
	p\vx = 0
	p\vy = Rand(-4,-2)
	p\ay = 0.1
	p\gy = p\y + 100
	p\r = 255
	p\g = 50
	p\b = 255
	p\sz = 4
	p\dsz = 0.25
	p\dr = 0
	p\dg = 22
	p\db = 0
Next



End Function 

Function updateparticle()
For p.particle = Each particle
	p\life = p\life - 1
	p\x = p\x + p\vx
	p\y = p\y + p\vy
	p\vy = p\vy + p\ay
	If p\y &gt; p\gy Then 
		p\vy = p\vy * -0.7
		If Abs(p\vy)&lt;0.01 Then p\life = 0
	EndIf 
	p\sz = p\sz + p\dsz
	p\r = p\r + p\dr
	p\g = p\g + p\dg
	p\b = p\b + p\db
	If p\sz &lt; 0 Then p\sz = 0
	If p\r &gt; 255 Then p\r = 255
	If p\g &gt; 255 Then p\g = 255
	If p\b &gt; 255 Then p\b = 255
	If p\r &lt; 0 Then p\r = 0
	If p\g &lt; 0 Then p\g = 0
	If p\b &lt; 0 Then p\b = 0
	If p\life &lt; 0 Then Delete p
Next
End Function 

Function drawparticle()
For p.particle = Each particle
	Color p\r,p\g,p\b
	Rect p\x,p\y,p\sz,p\sz,1
Next
Color 255,255,255
End Function 

Function drawnumber(x,y,num)
txt$ = str(num)
for i = 1 to len(txt)
	digit = mid(txt,i,1)
	for img.images = each images
		if img\cat = 10000 + digit then 
			drawimage img\img,x + (i-1) * 50 - len(txt) * 25,y - 25
			exit
		endif
	next
next 
End Function 

function playfx(cat)
if audiostate
	for aud.audio = each audio
		if aud\cat = cat then 
			aud\channel = playsound(aud\hnd)
		endif 
	next
endif
end function 

function updatefx()
if audiostate = false then delete each audiofx
for fx.audiofx = each audiofx
	if millisecs()&gt;fx\time then 
		playsound(fx\hnd)
		delete fx
	endif 
next
end function 

function playfxdelayed(cat,time)
if audiostate
	for aud.audio = each audio
		if aud\cat = cat then 
			found = false
			for fx.audiofx = each audiofx
				if fx\hnd = aud\hnd and fx\time &lt; millisecs() + time * 2 then
					found = true
					exit
				endif
			next
			if found = false then 
				fx.audiofx = new audiofx
				fx\hnd = aud\hnd
				fx\time = millisecs() + time
			endif 
		endif 
	next
endif

end function 
</textarea> <br><br></td></tr></table><br>
<a name="1341451"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rooster</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#106">[#106]</a></td></tr></table></td></tr><tr ><td class="posttext"> @xlsior<br>Aww man! :(<br><br>At least I can compile a Linux version for you Matty.<br>I have have to say it scared me a little seeing my actual name in the credits, I had forgotten it was on my profile.<br><br>Latest BMax port:<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Global particle_list:TList=New TList
Global creature_list:TList=New TList
Global audiofx_list:TList=New TList
Global audio_list:TList=New TList
Global images_list:TList=New TList
'This is both a learning exercise and hopefully a collaborative project of sorts
'or at least a project I can share with others on the blitz forum.
'It will be written initially in blitzplus/blitz3d And maybe someone will be keen on
'porting it to blitzmax...even blitzmax-ng to release on mobile perhaps?
'
'Interface:
'Left mouse button clicking only to make porting to 
'mobile interface much, much easier.
'Gameplay Mechanic Has changed - turn based more detailed
'
'Gameplay mechanic so far (15-May-2017)
'
'1. Arcade Action RPG Combat
'	Player controls 4 characters in a single screen dungeon.
'	Dungeon has a few walls and so on that prevent movement.
'	Monsters spawn from spawners and make their way around the map
'	Player taps the screen to move to location and characters fight things
'	in their path.
'	Powerups exist in the level such as:
'	Health pickups
'	Bombs - kill all monsters that have spawned or at least damage them.
'	
'2. After the arcade sequence the player is presented with options to upgrade their
'	character's stats. Stats to upgrade include:
'	Combat skill ('to hit roll')
'	Damage output ('damage points')
'	Health points ('hp')
'	Movement speed ('move')
'3.	After this a short cut scene is presented which may simply be a scrolling static
'	image with some fading in/fading out text to advance the story line
'0. Menu - toggle audio, play, credits
'
'Character types:
'1 Fighter - high hitpoint melee combat medium damage
'2 Ranger - medium hitpoint melee combat high damage
'3 Wizard - low hitpoint, ranged combat, medium damage
'4 Cleric - medium hitpoint, no combat, healer
'


'constants
Const SW=1280,SH=720,WIN=2
Const MODE_MENU = 0
Const MODE_COMBAT = 1
Const MODE_UPGRADE = 2
Const MODE_CUTSCENE = 3
Const PURE_2D = True 'if go to blitzmax can use 2d-in-3d commands such as alpha otherwise have to calculate manually.Change to false for blitzmax.

'categories for image types and object types
Const CAT_MENU_PLAY = 0
Const CAT_MENU_AUDIO = 1
Const CAT_MENU_SKIP_CUTSCENE = 2 'cut scene mode
Const CAT_MENU_ADD_SKILL = 3 'upgrade mode
Const CAT_MENU_ADD_DAMAGE = 4'upgrade mode
Const CAT_MENU_ADD_HEALTH = 5'upgrade mode
'Const CAT_MENU_ADD_SPEED = 6;
Const CAT_MENU_ADD_DEF = 6
Const CAT_MENU_MOUSE_CURSOR = 7'
Const CAT_FIGHTER = 10
Const CAT_KNIGHT = 10 'synonym
Const CAT_RANGER = 11
Const CAT_WIZARD = 12
Const CAT_CLERIC = 13
Const CAT_HEALER = 13 'synonym
Const CAT_HEALTH_PICKUP = 20
Const CAT_BOMB_PICKUP = 21
'CAT_BACKGROUND = 2000-3000 ; all the different image backgrounds
'CAT_MONSTER = 100-1000 , all the different monster types
'CAT_NUMBERS = 10000-10009
'AUDIO CATEGORIES
Const CAT_MUSIC = 999
Const CAT_BADBUFF = 1
Const CAT_CLICK = 0
Const CAT_GOODBUFF = 2
Const CAT_HIT1 = 3
Const CAT_HIT2 = 4
Const CAT_SWING1 = 5
Const CAT_SWING2 = 6
Const CAT_SWING3 = 7
Const CAT_SWING4 = 8

'globals
Global mx,my,lmb,olmb 'mouse input
Global audiostate 'on/off
Global gamemode 'references const above
Global gamelevel 'for cutscenes
Global cutsceneframe 'for cutscenes ie trigger fades, text, motion etc on certain frames
Global levelfinishtime = 0
Global mapdelay 'timestamp
Global mapindex

Global ftrpicked,rngpicked,wizpicked,clrpicked 'boolean for upgrades

' virtual key support for legacy Blitz apps

Global VKEY[]=[..
0,KEY_ESCAPE,KEY_1,KEY_2,KEY_3,KEY_4,KEY_5,KEY_6,KEY_7,KEY_8,KEY_9,KEY_0,..
KEY_MINUS,KEY_EQUALS,KEY_BACKSPACE,KEY_TAB,KEY_Q,KEY_W,KEY_E,KEY_R,KEY_T,..
KEY_Y,KEY_U,KEY_I,KEY_O,KEY_P,KEY_OPENBRACKET,KEY_CLOSEBRACKET,KEY_RETURN,..
KEY_LCONTROL,KEY_A,KEY_S,KEY_D,KEY_F,KEY_G,KEY_H,KEY_J,KEY_K,KEY_L,..
KEY_SEMICOLON,KEY_QUOTES,KEY_TILDE,KEY_LSHIFT,KEY_BACKSLASH,..
KEY_Z,KEY_X,KEY_C,KEY_V,KEY_B,KEY_N,KEY_M,KEY_COMMA,KEY_PERIOD,KEY_SLASH,..
KEY_RSHIFT,KEY_NUMMULTIPLY,KEY_ALT,KEY_SPACE,KEY_CAPSLOCK,..
KEY_F1,KEY_F2,KEY_F3,KEY_F4,KEY_F5,KEY_F6,KEY_F7,KEY_F8,KEY_F9,KEY_F10,..
KEY_NUMLOCK,KEY_SCROLL,KEY_NUM7,KEY_NUM8,KEY_NUM9,KEY_NUMSUBTRACT,KEY_NUM4,..
KEY_NUM5,KEY_NUM6,KEY_NUMADD,KEY_NUM1,KEY_NUM2,KEY_NUM3,KEY_NUM0,..
KEY_NUMDECIMAL,KEY_NUMSLASH,KEY_F11,KEY_F12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,..
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,..
KEY_EQUALS,0,0,KEY_MEDIA_PREV_TRACK,0,0,0,0,0,0,0,0,KEY_MEDIA_NEXT_TRACK,0,0,..
KEY_ENTER,KEY_RCONTROL,0,0,KEY_VOLUME_MUTE,0,KEY_MEDIA_PLAY_PAUSE,0,..
KEY_MEDIA_STOP,0,0,0,0,0,0,0,0,0,KEY_VOLUME_DOWN,0,KEY_VOLUME_UP,0,..
KEY_BROWSER_HOME,KEY_DECIMAL,0,KEY_NUMDIVIDE,0,KEY_SCREEN,..
0,0,0,0,0,0,0,0,0,0,0,0,0,KEY_PAUSE,0,KEY_HOME,KEY_UP,KEY_PAGEUP,0,..
KEY_LEFT,0,KEY_RIGHT,0,KEY_END,KEY_DOWN,KEY_PAGEDOWN,KEY_INSERT,KEY_DELETE,..
0,0,0,0,0,0,0,KEY_LWIN,KEY_RWIN,0,0,0,0,0,0,0,0,KEY_BROWSER_SEARCH,..
KEY_BROWSER_FAVORITES,KEY_BROWSER_REFRESH,KEY_BROWSER_STOP,KEY_BROWSER_FORWARD,..
KEY_BROWSER_BACK,0,KEY_LAUNCH_MAIL,KEY_LAUNCH_MEDIA_SELECT]

Function VKeyDown(key);Return KeyDown(VKEY[key]);End Function
Function VKeyHit(key);Return KeyHit(VKEY[key]);End Function

'currently unsupported in BlitzMax

Function Locate( x,y );Return 0;End Function
Function MouseZSpeed();Return 0;End Function
Function FreeBank(bank);Return 0;End Function
Function LoopSound(sound);Return 0;End Function
Function ChannelPitch(channel,hz);Return 0;End Function
Function PlayCDTrack( track,mode=0 );Return 0;End Function
Function SoundVolume( sound,volume# );Return 0;End Function


' BBType adds legacy Type functionality to BlitzMax Type

Type TBBType

	Field _list:TList
	Field _link:TLink

	Method Add(t:TList)
		_list=t
		_link=_list.AddLast(Self)
	End Method

	Method InsertBefore(t:TBBType)
		_link.Remove
		_link=_list.InsertBeforeLink(Self,t._link)
	End Method

	Method InsertAfter(t:TBBType)
		_link.Remove
		_link=_list.InsertAfterLink(Self,t._link)
	End Method

	Method Remove()
		_list.remove Self
	End Method

End Type

Function DeleteLast(t:TBBType)
	If t TBBType(t._list.Last()).Remove()
End Function

Function DeleteFirst(t:TBBType)
	If t TBBType(t._list.First()).Remove()
End Function

Function DeleteEach(t:TBBType)
	If t t._list.Clear()
End Function

Function ReadString$(in:TStream)
	Local	length
	length=ReadInt(in)
	If length&gt;0 And length&lt;1024*1024 Return brl.stream.ReadString(in,length)
End Function

Function HandleToObject:Object(obj:Object)
	Return obj
End Function

Function HandleFromObject(obj:Object)
	Local h=HandleToObject(obj)
	Return h
End Function


'types
Type bbimages Extends TBBType

	Method New()
		Add(images_list)
	End Method

	Method After:bbimages()
		Local t:TLink
		t=_link.NextLink()
		If t Return bbimages(t.Value())
	End Method

	Method Before:bbimages()
		Local t:TLink
		t=_link.PrevLink()
		If t Return bbimages(t.Value())
	End Method


Field img 'handle
Field midhandled 'boolean
Field cat 'category //hooks into creature template

End Type 

Type bbaudio Extends TBBType

	Method New()
		Add(audio_list)
	End Method

	Method After:bbaudio()
		Local t:TLink
		t=_link.NextLink()
		If t Return bbaudio(t.Value())
	End Method

	Method Before:bbaudio()
		Local t:TLink
		t=_link.PrevLink()
		If t Return bbaudio(t.Value())
	End Method


Field cat 'category 
Field hnd
Field channel

End Type

Type bbaudiofx Extends TBBType

	Method New()
		Add(audiofx_list)
	End Method

	Method After:bbaudiofx()
		Local t:TLink
		t=_link.NextLink()
		If t Return bbaudiofx(t.Value())
	End Method

	Method Before:bbaudiofx()
		Local t:TLink
		t=_link.PrevLink()
		If t Return bbaudiofx(t.Value())
	End Method

Field hnd
Field time
End Type

Type bbcreature Extends TBBType

	Method New()
		Add(creature_list)
	End Method

	Method After:bbcreature()
		Local t:TLink
		t=_link.NextLink()
		If t Return bbcreature(t.Value())
	End Method

	Method Before:bbcreature()
		Local t:TLink
		t=_link.PrevLink()
		If t Return bbcreature(t.Value())
	End Method


Field img
Field cat
Field x#
Field y#
Field hp
Field fullhp
Field damage
Field skill

Field defenseskill 'for players

Field aimode
Field aidelay
Field aitime

Field moving 'boolean

Field healingtime 'for healing effect/buff effect
Field lightningtime 'for lightning blasts on creature effect
Field strucktime 'for blood effects
Field attacktime 

Field activated 'boolean
Field waitcount 'int

Field stunned 'int 0-n counts down each time active....
Field poison 'int 0-n = damage inflicted
Field regenerate 'boolean
Field cursed 'int 0-n //50% off defenseskill
Field berserk 'int
Field ethereal 'boolean
Field summonedtime 'int
End Type 


'new emitters and particles
Type bbparticle Extends TBBType

	Method New()
		Add(particle_list)
	End Method

	Method After:bbparticle()
		Local t:TLink
		t=_link.NextLink()
		If t Return bbparticle(t.Value())
	End Method

	Method Before:bbparticle()
		Local t:TLink
		t=_link.PrevLink()
		If t Return bbparticle(t.Value())
	End Method


Field r,g,b,a
Field x#,y#,vx#,vy#,ay#,gy#
Field life
Field dr,dg,db,da
Field sz,dsz

End Type



Main()

Function Main()
	quit = False
	gamemode = MODE_MENU
	init()
	Repeat
		frametime = MilliSecs()
		Cls
		'input 
		mx = MouseX()
		my = MouseY()
		olmb = lmb
		lmb = MouseDown(1)
		
	   For aud:bbaudio = EachIn audio_list
	     If(aud.cat=999)
	       If ChannelPlaying(aud.channel) = False
             aud.channel = PlaySound (aud.hnd)
           EndIf
         EndIf
       Next	
		
		Select gamemode
		
		Case MODE_MENU
			handlemenu()
			drawmenu()
		
		Case MODE_COMBAT
			handleinput()
			updategame()
			drawgame()
		Case MODE_CUTSCENE
			handlecutscene()
			drawcutscene()
		Case MODE_UPGRADE
			handleupgrade()
			drawupgrade()
		End Select
		updatefx()
		Flip
		'very basic frame limiting
		endframetime = MilliSecs()
		dtime = endframetime - frametime
		If dtime &lt; 15 Then 
			Delay 15 - dtime
		EndIf 
		'end of frame limiting
		If(VKeyHit(1)) Then quit = True		
	Until quit
	';;;;;
	
	Cls
	FlushKeys
	time = MilliSecs()+3500
	For img:bbimages = EachIn images_list
		If img.cat = 2013
			DrawImage img.img,0,0
			Flip
			Repeat
			WaitEvent()
			Until MilliSecs()&gt;time Or VKeyHit(1)&lt;&gt;0
			Exit
		EndIf
	Next
	
	End
End Function 

Function init()
AppTitle ="Heroes of Dungonia"
Graphics SW,SH,0',WIN
'load data files
'load all images here
'load all sounds here
'load all music here
HideMouse 
audiostate = True

dir = ReadDir(CurrentDir()+"\audio")
Repeat
	file$ = NextFile(dir)
	If file="" Then Exit
	If Right(file,3) = "ogg" Then 
		aud:bbaudio = New bbaudio
		aud.hnd = LoadSound("audio\"+file)
		aud.cat = Int(Mid(file,7,3))
		If(aud.cat=999) Then 
			aud.channel =PlaySound (aud.hnd)
		EndIf 
	EndIf 
Forever
CloseDir dir 

dir = ReadDir(CurrentDir()+"\images")
Repeat
	file$ = NextFile(dir)
	If file="" Then Exit
	If Right(file,3) = "jpg" Or Right(file,3) = "png" Then 
		img:bbimages = New bbimages
		img.img = LoadImage("images\"+file)
		img.cat = Int(Left(file,5))
		'If Right(file,3)="png" Then 
		'	rgb = dev.blitz3d.ReadPixel(0,0,ImageBuffer(img.img))
		'	r0 = (rgb Shr 16) &amp; 255
		'	g0 = (rgb Shr 8) &amp; 255
		'	b0 = (rgb &amp; 255)
		'	MaskImage img.img,r0,g0,b0
		'EndIf 
	EndIf 
Forever
CloseDir dir

End Function 

Function handlemenu()
';;
';;;
';;Check if 'PLAY' pressed..if so then initialise
'first cut scene and change gamemode
';;Check if 'TOGGLE AUDIO' pressed if so toggle music/audio flags

If lmb&lt;&gt;0 And olmb=0 Then 
	If mx&gt;=1000 And mx&lt;=1200 Then 
		If my&gt;550 And my&lt;600 Then 
			'play hit
			initstartgame()
			gamemode = MODE_CUTSCENE
			playfx(CAT_CLICK)
		EndIf 
		If my&gt;650 And my&lt;700 Then 
			audiostate = Not audiostate
			If  audiostate
				'start music
				playfx(CAT_CLICK)
				For aud:bbaudio = EachIn audio_list
					If aud.cat = CAT_MUSIC
						If ChannelPlaying(aud.channel) Then 
						Else
							aud.channel = PlaySound(aud.hnd)
						EndIf 
					EndIf
				Next
			Else
				'stop
				For aud:bbaudio = EachIn audio_list
					If aud.cat = CAT_MUSIC
						If ChannelPlaying(aud.channel) Then 
							StopChannel aud.channel
						Else
						EndIf 
					EndIf
				Next

			EndIf 
		EndIf 
	EndIf 
EndIf 


End Function

Function drawmenu()
'draw backdrop
'draw buttons in relevant state
'draw mouse cursor

For img:bbimages = EachIn images_list
	If img.cat = 2011 Then 
		DrawImage img.img,0,0
	EndIf 
Next

For img:bbimages = EachIn images_list
	If img.cat = CAT_MENU_PLAY
		DrawImage img.img,1000,550
	EndIf
	If img.cat = CAT_MENU_AUDIO
		DrawImage img.img,1000,650
	EndIf
Next

For img:bbimages = EachIn images_list
	If img.cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img.img,mx,my
	EndIf
Next

End Function

Function handleinput()
'assign tx,ty of creatures to player units
'
acted = False
If lmb&lt;&gt;0 And olmb = 0 Then 
	For pc:bbcreature = EachIn creature_list
		If pc.hp&gt;0 And pc.cat&gt;=10 And pc.cat&lt;=13 Then 
			If mx&gt;pc.x - ImageWidth(pc.img)/2 And mx&lt;pc.x + ImageWidth(pc.img)/2 And my&gt;pc.y-40 And my&lt;pc.y+40 Then 
				For a:bbcreature = EachIn creature_list
					If a.hp&gt;0 And a.cat&lt;100 Then a.waitcount = a.waitcount + 1
					If a.waitcount &gt; 3 Then a.waitcount = 3
					If a.stunned &gt; 0 Then 
						a.stunned = a.stunned - 1
					EndIf 
				Next
				acted = True
				If pc.cat = CAT_FIGHTER And pc.stunned &lt;=0
					pc.attacktime = 30
					playfx(CAT_SWING1+Rand(0,3))
					For a:bbcreature = EachIn creature_list
						If a.cat &gt;= 100 And a.hp &gt; 0 Then 
							dieroll = Rand(1,1000)
							If dieroll &lt; pc.skill Then 
								If a.ethereal Then 'reduced damage to ethereals.
								a.hp = a.hp - pc.damage/3
								Else
									a.hp = a.hp - pc.damage
								EndIf
								playfxdelayed(CAT_HIT1+Rand(0,1),50)
								a.strucktime = 10
								'centaur goes berserk
								If a.cat = 108 Then a.berserk = 3
							EndIf 
						EndIf 
					Next
					pc.waitcount = 0
				EndIf
				If pc.cat = CAT_RANGER And pc.stunned &lt;=0
					maxhp = 0
					b:bbcreature = Null'
					pc.attacktime = 30
					playfx(CAT_SWING1+Rand(0,3))
					For a:bbcreature = EachIn creature_list
						If a.cat &gt;= 100 And a.hp &gt; 0 Then 
							If a.hp &gt; maxhp Then 
								maxhp = a.hp
								b:bbcreature = a:bbcreature
							EndIf 
						EndIf 
					Next
					If b:bbcreature&lt;&gt;Null Then 
						dieroll = Rand(1,1000)
						If dieroll &lt; pc.skill Then 
							If b.ethereal Then 'reduced damage to ethereals
								b.hp = b.hp - pc.damage * (1 + pc.waitcount)/3
							Else
								b.hp = b.hp - pc.damage * (1 + pc.waitcount)
							EndIf 
							b.strucktime = 15
							playfxdelayed(CAT_HIT1+Rand(0,1),50)
							If b.cat = 108 Then b.berserk = 3
						EndIf 
					EndIf 
					pc.waitcount = 0
				EndIf
				If pc.cat = CAT_WIZARD And pc.stunned&lt;=0
					pc.attacktime = 30
					damage = pc.damage * (pc.waitcount+1)
					kk = 0
					playfx(CAT_GOODBUFF)
					For a:bbcreature = EachIn creature_list
						If a.cat &gt;= 100 And a.hp &gt; 0 Then 
							dieroll = Rand(1,1000)
							If dieroll &lt; pc.skill Then 
								a.hp = a.hp - damage
								If a.ethereal Then 
									a.hp = a.hp - damage 'extra damage to ethereals
								EndIf 
								a.lightningtime = 30
								a.strucktime = 20
								kk = kk + 1
								playfxdelayed(CAT_HIT1+Rand(0,1),kk * 10)
								If a.cat = 108 Then a.berserk = 3
							Else
								pc.hp = pc.hp - 5 ' bad spell casting inflicts damage to caster
								pc.lightningtime = 30
								Exit
							EndIf 
						EndIf 
					Next
					pc.waitcount = 0
				EndIf
				If pc.cat = CAT_CLERIC And pc.stunned &lt;=0
					pc.attacktime = 30
					damage = pc.damage * (pc.waitcount + 1)
					playfx(CAT_GOODBUFF)
					For a:bbcreature = EachIn creature_list
						If a.cat &lt; 100 And a.hp &lt; a.fullhp And a.hp &gt; 0 Then 
							a.hp = a.hp + damage
							a.healingtime = 60
							If a.hp &gt; a.fullhp Then a.hp = a.fullhp
						EndIf 
					Next
					pc.waitcount = 0
				EndIf	
			EndIf 
		EndIf 
	Next
EndIf 
If acted
	'perform poison
	For pc:bbcreature = EachIn creature_list
		If pc.hp &gt; 0 And pc.poison &gt; 0 And pc.cat &lt; 100 Then 
			pc.hp = pc.hp - pc.poison
			pc.strucktime = 10
			dieroll = Rand(1,1000)
			If dieroll &lt; pc.defenseskill Then 
				pc.poison = 0
			EndIf 
		EndIf 
		If pc.hp &gt; 0 And pc.cat &lt; 100 And pc.cursed &gt; 0 Then 
			pc.cursed = pc.cursed - 1
		EndIf 
	Next
	For a:bbcreature = EachIn creature_list
		If a.hp &gt; 0 And a.cat &gt;= 100 Then 
			If a.cat = 113 Or a.cat = 114 'necromancer summons skeletons and liche, liche and skeleton also make skeletons go berserk
				For b:bbcreature = EachIn creature_list
					If b.hp&gt;0 And b.cat = 111 Then 
						dieroll = Rand(1,1000)
						If dieroll &lt; a.skill Then 
							b.berserk = b.berserk + Rand(0,2)
						EndIf
					EndIf 
					If a.cat = 114 Then 
						If b.hp &gt; 0 And b.hp &lt; b.fullhp And b.cat = 111 Then 
							dieroll = Rand(1,1000)
							If dieroll &lt; a.skill Then 
								b.hp = b.hp + 5
								b.healingtime = 60
							EndIf 
						EndIf
						If b.cat &lt; 100 And b.hp &gt; 0 Then 
							dieroll = Rand(1,1000)
							If dieroll &lt; a.skill Then 
								b.cursed = b.cursed + Rand(0,2)
							EndIf 
						EndIf 
					EndIf  
					If b.hp&lt;=0 And b.cat &gt;= 100 Then 
						dieroll = Rand(1,1000)
						If dieroll &lt; a.skill Then 
							createskeleton(b:bbcreature)
						EndIf 
					EndIf
				Next
			EndIf 
			count = 0
			If a.regenerate And a.hp &lt; a.fullhp Then 
				diff = (a.fullhp - a.hp) / 2
				a.hp = a.hp + diff
			EndIf 
			For pc:bbcreature = EachIn creature_list
				If pc.cat &lt; 100 And pc.hp &gt; 0 Then count = count + 1
			Next
			If count &gt; 0 Then 
				count = Rand(1,count)
				For pc:bbcreature = EachIn creature_list
					If pc.cat &lt; 100 And pc.hp &gt; 0 Then count = count - 1
					If count = 0 Then 
						dieroll = Rand(1,1000)
						If a.cat = 103 Then 'goblin shaman
							If dieroll &lt; a.skill Then 
								pc.hp = pc.hp - a.damage
								pc.strucktime = 10
								a.attacktime = 30
								pc.lightningtime = 30
								playfxdelayed(CAT_BADBUFF,100)
							EndIf
						ElseIf a.cat = 106 Then 'spider wizard
							If dieroll &lt; a.skill Then 
								pc.stunned = Rand(1,2)
								playfxdelayed(CAT_BADBUFF,100)
								dieroll2 = Rand(1,1000)
								If dieroll2 &gt; pc.defenseskill Then 
									pc.hp = pc.hp - a.damage
									pc.strucktime = 10
									a.attacktime = 30
								EndIf
								Exit
							EndIf 
						ElseIf a.cat = 107 Then 'spider queen
							If dieroll &lt; a.skill Then 
								For c:bbcreature = EachIn creature_list
									If c.cat &gt;= 100 And c.hp &gt; 0 And c.hp &lt; c.fullhp
										c.healingtime = 60
										c.hp = c.hp + a.damage
										playfxdelayed(CAT_BADBUFF,100)								
										Exit 
									EndIf 
								Next
								dieroll2 = Rand(1,1000)
								If pc.cursed Then dieroll2 = dieroll2 * 1.5
								If dieroll2 &gt; pc.defenseskill Then 
									pc.hp = pc.hp - a.damage
									pc.strucktime = 10
									a.attacktime = 30
									playfxdelayed(CAT_HIT1+Rand(0,1),100)
								EndIf
								If pc.cat = CAT_WIZARD Or pc.cat = CAT_CLERIC
									pc.waitcount = 0
									Exit 
								EndIf
							EndIf 
							If pc.cursed Then dieroll = dieroll * 1.5
							If dieroll &gt; pc.defenseskill Then 
								pc.hp = pc.hp - a.damage
								pc.strucktime = 10
								a.attacktime = 30
							EndIf
							Exit
						Else
							If pc.cursed Then dieroll = dieroll * 1.5
							If dieroll &gt; pc.defenseskill Then 
								pc.hp = pc.hp - a.damage
								pc.strucktime = 10
								a.attacktime = 30
								If a.poison &gt; 0 Then 
									pc.poison = a.poison
									playfxdelayed(CAT_BADBUFF,100)
								EndIf 
							EndIf
							If a.berserk &gt; 0 Then 
								a.berserk = a.berserk - 1
								'second attack
								dieroll = Rand(1,1000)
								If pc.cursed Then dieroll = dieroll * 1.5
								If dieroll &gt; pc.defenseskill Then 
									pc.hp = pc.hp - a.damage
									pc.strucktime = 10
									a.attacktime = 30
									If a.poison &gt; 0 Then 
										pc.poison = a.poison
									EndIf 
								EndIf
							EndIf 
							If a.cat = 110 Then 
								dieroll = Rand(1,1000)
								If dieroll &lt; a.skill Then 
									pc.cursed = Rand(1,3)
									playfxdelayed(CAT_BADBUFF,100)
								EndIf
							EndIf 
							Exit
						EndIf  
					EndIf 
				Next
				
			EndIf 
		EndIf 
	Next
EndIf
End Function

Function updategame()
'move all creatures
'move all bullets
'handle all collisions
'handle all pick ups
'handle all combat
'handle all spell casting (magic missiles and healing)

found = False

For pc:bbcreature = EachIn creature_list
	If pc.strucktime &gt; 0 Then 
		pc.strucktime = pc.strucktime - 1
		createbloodparticle(pc.x,pc.y)
		If pc.hp &lt;= 0 Then 
			createbloodparticle(pc.x,pc.y)
			createbloodparticle(pc.x,pc.y)
			createbloodparticle(pc.x,pc.y)
		EndIf 
	EndIf 
	If pc.hp&gt;0 Then 
		If pc.cursed &gt; 0 Then 
			createcurseparticle(pc.x,pc.y+40)
		EndIf 
		If pc.berserk &gt; 0 Then 
			createberserkparticle(pc.x,pc.y+40)
		EndIf 
		If pc.cat &gt;= 100 Then 
			found = True
		EndIf
	Else
		pc.Remove()
	EndIf 
Next
If found = False Then 
	levelfinishtime = levelfinishtime + 1
EndIf 
foundp = False
For pc:bbcreature = EachIn creature_list
	If pc.hp &gt; 0 And pc.cat &lt; 100 Then foundp = True;Exit 
Next
If foundp = False Then 
	levelfinishtime = levelfinishtime + 1
EndIf 
If levelfinishtime &gt; 250 Then 
	gamemode = MODE_MENU 'eventually change to mode_upgrade
	If foundp Then gamemode = MODE_UPGRADE
	If Not(foundp) Then 
		gamelevel = 999
		gamemode = MODE_CUTSCENE
	Else
		gamelevel = gamelevel + 1
		ftrpicked = False
		clrpicked = False
		rngpicked = False
		wizpicked = False 
	EndIf 
EndIf 

For pc:bbcreature = EachIn creature_list
	If pc.hp &gt; 0 Then 
		If pc.healingtime &gt; 0 Then pc.healingtime = pc.healingtime - 1
	EndIf 
Next
updateparticle()
End Function

Function drawgame()
'draw background (fixed static 1280x720 image background)
'draw all creatures - don't worry about zordering them - it will be too fast to notice 
'draw all bullets
For img:bbimages = EachIn images_list
	If img.cat = 2007 'change this later
		DrawImage img.img,0,0
	EndIf
Next
For pc:bbcreature = EachIn creature_list
	If pc.hp &gt; 0 Then
		aa# = 0
		bb# = 0
		If pc.attacktime &gt; 0 Then 
			pc.attacktime = pc.attacktime - 1
			aa# = -25.0 * Sin(pc.attacktime * 6)
			If pc.cat&gt;=100 Then aa = aa * -1.0
		EndIf 
		If pc.strucktime &gt; 0 Then 
			bb = Rand(-pc.strucktime/2,pc.strucktime/2)
		EndIf 
		If pc.poison &gt; 0 And pc.cat &lt; 100 Then 
			For img:bbimages = EachIn images_list
				If img.cat = 119 Then 
					DrawImage img.img,pc.x - ImageWidth(pc.img)/2,pc.y-40
					Exit
				EndIf 
			Next
			'Color 32,255,32
			'Oval pc\x - ImageWidth(pc\img)/2,pc\y-40,ImageWidth(pc\img),80,1
		EndIf 
		DrawImage pc.img,bb + pc.x - ImageWidth(pc.img)/2,pc.y - 40 + aa
		dhp = 10 * pc.hp / pc.fullhp
		If dhp &lt; 4 Then SetColor 255,32,32
		If dhp &gt;=4 And dhp&lt;8 Then SetColor 255,255,32
		If dhp &gt;=8 Then SetColor 32,255,32
		If dhp = 0 Then dhp = 1
		For hp = 1 To dhp
			DrawRect hp*4 + pc.x - ImageWidth(pc.img)/3,pc.y - 50,3,3',1
		Next
		SetColor 255,255,255
		If pc.healingtime &gt; 0 Then 
			createhealparticle(pc.x,pc.y)
		EndIf 
		If pc.summonedtime &gt; 0 Then 
			pc.summonedtime = pc.summonedtime - 1
			createsummonparticle(pc.x,pc.y)
		EndIf 
		If pc.lightningtime &gt; 0 Then 
			pc.lightningtime = pc.lightningtime - 1
			drawlightning(pc.x,pc.y)
		EndIf 
		If pc.waitcount &gt; 0 Then 
			SetColor 255,32,255
			For i = 1 To pc.waitcount
				DrawRect i * 4 + pc.x - ImageWidth(pc.img)/3,pc.y - 55,3,3',1
			Next
			SetColor 255,255,255
		EndIf 
		If pc.stunned &gt; 0 And pc.cat &lt; 100 Then 
			'Color 255,255,32
			'Oval pc\x - ImageWidth(pc\img)/2,pc\y-40,ImageWidth(pc\img),80,0
			For img:bbimages = EachIn images_list
				If img.cat = 118 Then 
					DrawImage img.img, pc.x - ImageWidth(pc.img)/2,pc.y-40
					Exit
				EndIf 
			Next
		EndIf 
	EndIf
Next
drawparticle()
SetColor 255,255,255
For img:bbimages = EachIn images_list
	If img.cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img.img,mx,my
	EndIf
Next
SetColor 255,255,255
End Function 

Function drawlightning(x,y)
iy = 0
ix = x + Rand(-20,20)
While iy &lt; y
	oy = iy
	ox = ix
	ix = x + Rand(-20,20)
	iy = iy + Rand(10,25)
	SetColor 200,200,255
	DrawLine ox,oy,ix,iy
	SetColor 150,150,200
	DrawLine ox+1,oy+1,ix+1,iy+1
	DrawLine ox-1,oy-1,ix-1,iy-1
	SetColor 100,100,150
	DrawLine ox+2,oy+2,ix+2,iy+2
	DrawLine ox-2,oy-2,ix-2,iy-2
	SetColor 32,32,90
	DrawLine ox+3,oy+3,ix+3,iy+3
	DrawLine ox-3,oy-3,ix-3,iy-3
Wend 
SetColor 255,255,255
End Function 

Function handlecutscene()
'handle transitions,  handle skip button; 
'handle fading in and out text (bitmap fonts?)
If gamelevel = 1 Or gamelevel = 4 Or gamelevel = 8 Or gamelevel = 11 Or gamelevel = 14 Or gamelevel = 999 Then
	
Else
	initlevel()
	gamemode = MODE_COMBAT
EndIf 
';
If lmb&lt;&gt;0 And olmb = 0 Then 
	If mx&gt;1000 And mx&lt;1200 And my&gt;650 And my&lt;700 Then 
		playfx(CAT_CLICK)
		If gamelevel &lt; 14 Then 
			initlevel()
			gamemode = MODE_COMBAT
		Else
			gamemode = MODE_MENU 'includes 999 (game over)
		EndIf
	EndIf 
EndIf 
';
End Function 

Function drawcutscene()
'draw cut scene background, draw transition, draw skip button
If gamelevel = 1 Or gamelevel = 4 Or gamelevel = 8 Or gamelevel = 11 Or gamelevel = 14 Or gamelevel = 999 Then
Else
	Return
EndIf
For img:bbimages = EachIn images_list
	If (img.cat = 2004 And gamelevel = 1) Or (img.cat = 2005 And gamelevel = 4) Or (img.cat = 2006 And gamelevel = 8) Or (img.cat = 2008 And gamelevel = 11) Or (img.cat = 2009 And gamelevel = 14) Or (img.cat = 2010 And gamelevel = 999) Then 
		DrawImage img.img,0,0
	EndIf 
Next
';
For img:bbimages = EachIn images_list
	If img.cat = CAT_MENU_SKIP_CUTSCENE
		DrawImage img.img,1000,650
	EndIf
Next
';
For img:bbimages = EachIn images_list
	If img.cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img.img,mx,my
	EndIf
Next
';
End Function 

Function handleupgrade()
'handle button press 'add stuff' to characters
'
'
'
If lmb&lt;&gt;0 And olmb = 0Then 
	If mx &gt; 1000 And mx&lt;1200 And my&gt;650 And my &lt;700
		gamemode = MODE_CUTSCENE
		FlushMouse()
		playfx(CAT_CLICK)
	EndIf
	i = -1
	For pc:bbcreature = EachIn creature_list
		If pc.cat &lt; 100 And pc.hp &gt; 0 Then 
			i = i + 1
			y = 100 * i + 200
			DrawImage pc.img,100,y
			If pc.cat = CAT_FIGHTER And (Not ftrpicked)
				If mx&gt;200 And mx &lt; 400 And my &gt; y And my &lt; y + 50 Then 
					'health picked
					ftrpicked = True
					pc.fullhp = pc.fullhp + 10
					playfx(CAT_CLICK)			
				EndIf 
				If mx&gt;450 And mx &lt; 650 And my &gt; y And my &lt; y + 50 Then 
					'damage picked
					ftrpicked = True
					pc.damage = pc.damage + 4
					playfx(CAT_CLICK)
				EndIf 
				
				If mx&gt;700 And mx &lt; 900 And my &gt; y And my &lt; y + 50 Then 
					'skill picked
					ftrpicked = True
					ds# = (1000 - pc.skill) * 0.95
					pc.skill = 1000 - ds
					playfx(CAT_CLICK)
				EndIf 
				
				If mx&gt;950 And mx &lt; 1150 And my &gt; y And my &lt; y + 50 Then 
					'def picked
					ftrpicked = True
					ds# = (1000 - pc.defenseskill) * 0.95
					pc.defenseskill = 1000 - ds
					playfx(CAT_CLICK)
				EndIf 
			EndIf
			If pc.cat = CAT_RANGER And (Not rngpicked)
				If mx&gt;200 And mx &lt; 400 And my &gt; y And my &lt; y + 50 Then 
					'health picked
					rngpicked = True
					pc.fullhp = pc.fullhp + 10
					playfx(CAT_CLICK)
				EndIf 
				If mx&gt;450 And mx &lt; 650 And my &gt; y And my &lt; y + 50 Then 
					'damage picked
					rngpicked = True
					pc.damage = pc.damage + 4
					playfx(CAT_CLICK)
				EndIf 
				
				If mx&gt;700 And mx &lt; 900 And my &gt; y And my &lt; y + 50 Then 
					'skill picked
					rngpicked = True
					ds# = (1000 - pc.skill) * 0.95
					pc.skill = 1000 - ds
					playfx(CAT_CLICK)
				EndIf 
				
				If mx&gt;950 And mx &lt; 1150 And my &gt; y And my &lt; y + 50 Then 
					'def picked
					rngpicked = True
					ds# = (1000 - pc.defenseskill) * 0.95
					pc.defenseskill = 1000 - ds
					playfx(CAT_CLICK)
				EndIf 
			
			EndIf
			If pc.cat = CAT_WIZARD And (Not wizpicked)
				If mx&gt;200 And mx &lt; 400 And my &gt; y And my &lt; y + 50 Then 
					'health picked
					wizpicked = True
					pc.fullhp = pc.fullhp + 10
					playfx(CAT_CLICK)
				EndIf 
				If mx&gt;450 And mx &lt; 650 And my &gt; y And my &lt; y + 50 Then 
					'damage picked
					wizpicked = True
					pc.damage = pc.damage + 4
					playfx(CAT_CLICK)
				EndIf 
				
				If mx&gt;700 And mx &lt; 900 And my &gt; y And my &lt; y + 50 Then 
					'skill picked
					wizpicked = True
					ds# = (1000 - pc.skill) * 0.95
					pc.skill = 1000 - ds
					playfx(CAT_CLICK)
				EndIf 
				
				If mx&gt;950 And mx &lt; 1150 And my &gt; y And my &lt; y + 50 Then 
					'def picked
					wizpicked = True
					ds# = (1000 - pc.defenseskill) * 0.95
					pc.defenseskill = 1000 - ds
					playfx(CAT_CLICK)
				EndIf 

			EndIf
			If pc.cat = CAT_CLERIC And (Not clrpicked)
				If mx&gt;200 And mx &lt; 400 And my &gt; y And my &lt; y + 50 Then 
					'health picked
					clrpicked = True
					pc.fullhp = pc.fullhp + 10
					playfx(CAT_CLICK)
				EndIf 
				If mx&gt;450 And mx &lt; 650 And my &gt; y And my &lt; y + 50 Then 
					'damage picked
					clrpicked = True
					pc.damage = pc.damage + 4
					playfx(CAT_CLICK)
				EndIf 
				If mx&gt;700 And mx &lt; 900 And my &gt; y And my &lt; y + 50 Then 
					'skill picked
					clrpicked = True
					ds# = (1000 - pc.skill) * 0.95
					pc.skill = 1000 - ds
					playfx(CAT_CLICK)
				EndIf 
				If mx&gt;950 And mx &lt; 1150 And my &gt; y And my &lt; y + 50 Then 
					'def picked
					clrpicked = True
					ds# = (1000 - pc.defenseskill) * 0.95
					pc.defenseskill = 1000 - ds
					playfx(CAT_CLICK)
				EndIf 
			EndIf 
		EndIf 
	Next
EndIf
End Function

Function drawupgrade()
'draw background
'draw buttons
'draw characters
'draw stats
'draw continue button
For img:bbimages = EachIn images_list
	If img.cat = 2012 Then 
		DrawImage img.img,0,0
	EndIf 
Next

i=-1
For pc:bbcreature = EachIn creature_list
	If pc.cat &lt; 100 And pc.hp &gt; 0 Then 
		pc.hp = pc.fullhp
		i = i + 1
		y = 100 * i + 200
		SetColor 96,96,80
	    DrawRect 50,y - 5,1180,90',1
    	SetColor 255,255,255
		DrawImage pc.img,100,y
	'	Text 150,i*100+200,"Skill:"+pc\skill+" Defense:"+pc\defenseskill + " Health:"+pc\fullhp + " Power:"+pc\damage
		If pc.cat = CAT_FIGHTER 
			For img:bbimages = EachIn images_list
				If img.cat = CAT_MENU_ADD_HEALTH Then
					If (Not ftrpicked) DrawImage img.img,200,y
					'Text 300,y + 65,pc\fullhp,1,1
					drawnumber(300,y + 65,pc.fullhp)
				EndIf
				If img.cat = CAT_MENU_ADD_DAMAGE Then
					If (Not ftrpicked) 	DrawImage img.img,450,y
					'Text 550,y + 65,pc\damage,1,1
					drawnumber(550,y + 65,pc.damage)
				EndIf
				If img.cat = CAT_MENU_ADD_SKILL Then
					If (Not ftrpicked) 	DrawImage img.img,700,y
					'Text 800,y + 65,pc\skill,1,1
					drawnumber(800,y + 65,pc.skill * 100 / 1000)
				EndIf
				If img.cat = CAT_MENU_ADD_DEF Then 
					If (Not ftrpicked) 	DrawImage img.img,950,y
					'Text 1050,y + 65,pc\defenseskill,1,1
					drawnumber(1050,y + 65,pc.defenseskill * 100 / 1000)
				EndIf 
			Next
		EndIf
		If pc.cat = CAT_RANGER 
			For img:bbimages = EachIn images_list
				If img.cat = CAT_MENU_ADD_HEALTH Then
					If (Not rngpicked) DrawImage img.img,200,y
					'Text 300,y + 65,pc\fullhp,1,1
					drawnumber(300,y + 65,pc.fullhp)
				EndIf
				If img.cat = CAT_MENU_ADD_DAMAGE Then
					If (Not rngpicked) DrawImage img.img,450,y
					'Text 550,y + 65,pc\damage,1,1
					drawnumber(550,y + 65,pc.damage)
				EndIf
				If img.cat = CAT_MENU_ADD_SKILL Then
					If (Not rngpicked) DrawImage img.img,700,y
					'Text 800,y + 65,pc\skill,1,1
					drawnumber(800,y + 65,pc.skill * 100 / 1000)
				EndIf
				If img.cat = CAT_MENU_ADD_DEF Then 
					If (Not rngpicked) DrawImage img.img,950,y
					'Text 1050,y + 65,pc\defenseskill,1,1
					drawnumber(1050,y + 65,pc.defenseskill * 100 / 1000)
				EndIf 
			Next
		
		EndIf
		If pc.cat = CAT_WIZARD 
			For img:bbimages = EachIn images_list
				If img.cat = CAT_MENU_ADD_HEALTH Then
					If (Not wizpicked) DrawImage img.img,200,y
'					Text 300,y + 65,pc\fullhp,1,1
					drawnumber(300,y + 65,pc.fullhp)
				EndIf
				If img.cat = CAT_MENU_ADD_DAMAGE Then
					If (Not wizpicked)  DrawImage img.img,450,y
					'Text 550,y + 65,pc\damage,1,1
					drawnumber(550,y + 65,pc.damage)
				EndIf
				If img.cat = CAT_MENU_ADD_SKILL Then
					If (Not wizpicked) DrawImage  img.img,700,y
					'Text 800,y + 65,pc\skill,1,1
					drawnumber(800,y + 65,pc.skill * 100 / 1000)
				EndIf
				If img.cat = CAT_MENU_ADD_DEF Then 
					If (Not wizpicked) DrawImage  img.img,950,y
					'Text 1050,y + 65,pc\defenseskill,1,1
					drawnumber(1050,y + 65,pc.defenseskill * 100 / 1000)
				EndIf 
			Next
		
		EndIf
		If pc.cat = CAT_CLERIC 
			For img:bbimages = EachIn images_list
				If img.cat = CAT_MENU_ADD_HEALTH Then
					If (Not clrpicked) DrawImage  img.img,200,y
					'Text 300,y + 65,pc\fullhp,1,1
					drawnumber(300,y + 65,pc.fullhp)
				EndIf
				If img.cat = CAT_MENU_ADD_DAMAGE Then
					If (Not clrpicked) 					DrawImage img.img,450,y
					'Text 550,y + 65,pc\damage,1,1
					drawnumber(550,y + 65,pc.damage)
				EndIf
				If img.cat = CAT_MENU_ADD_SKILL Then
					If (Not clrpicked) 					DrawImage img.img,700,y
					'Text 800,y + 65,pc\skill,1,1
					drawnumber(800,y + 65,pc.skill * 100 / 1000)
				EndIf
				If img.cat = CAT_MENU_ADD_DEF Then 
					If (Not clrpicked) 					DrawImage img.img,950,y
					'Text 1050,y + 65,pc\defenseskill,1,1
					drawnumber(1050,y + 65,pc.defenseskill * 100 / 1000)
				EndIf 
			Next
		
		EndIf 
	EndIf 
Next

For img:bbimages = EachIn images_list
	If img.cat = CAT_MENU_SKIP_CUTSCENE
		DrawImage img.img,1000,650
	EndIf
Next

For img:bbimages = EachIn images_list
	If img.cat = CAT_MENU_MOUSE_CURSOR
		DrawImage img.img,mx,my
	EndIf
Next

End Function 

Function initstartgame()
gamelevel = 1
mapindex = 0
DeleteEach bb32
pc:bbcreature = New bbcreature
pc.fullhp = 90
pc.hp = 90
pc.cat = CAT_FIGHTER
pc.x = 600
pc.y = 300
pc.skill = 500
pc.defenseskill = 850
pc.damage = 15
For img:bbimages = EachIn images_list
	If img.cat = CAT_FIGHTER Then 
		pc.img = img.img
		Exit 
	EndIf 
Next
pc:bbcreature = New bbcreature
pc.fullhp = 75
pc.hp = 75
pc.cat = CAT_RANGER
pc.x = 640
pc.y = 300
pc.skill = 800
pc.defenseskill = 850
pc.damage = 50
For img:bbimages = EachIn images_list
	If img.cat = CAT_RANGER Then 
		pc.img = img.img
		Exit 
	EndIf 
Next
pc:bbcreature = New bbcreature
pc.fullhp = 45
pc.hp = 45
pc.cat = CAT_WIZARD
pc.x = 750
pc.y = 360
pc.skill = 650
pc.damage = 18
pc.defenseskill = 650
For img:bbimages = EachIn images_list
	If img.cat = CAT_WIZARD Then 
		pc.img = img.img
		Exit 
	EndIf 
Next
pc:bbcreature = New bbcreature
pc.fullhp = 60
pc.hp = 60
pc.cat = CAT_CLERIC
pc.x = 640
pc.defenseskill = 800
pc.y = 350
pc.skill = 100
pc.damage = 5
For img:bbimages = EachIn images_list
	If img.cat = CAT_CLERIC Then 
		pc.img = img.img
		Exit 
	EndIf 
Next
End Function 

Function initlevel()
For pc:bbcreature = EachIn creature_list
	If pc.hp &gt; 0 And pc.hp &lt; pc.fullhp Then pc.hp = pc.fullhp
	If pc.cat = CAT_FIGHTER
		pc.x = 540
		pc.y = 350
	EndIf
	If pc.cat = CAT_RANGER
		pc.x = 720
		pc.y = 350
	EndIf
	If pc.cat = CAT_WIZARD
		pc.x = 540
		pc.y = 440
	EndIf
	If pc.cat = CAT_CLERIC
		pc.x = 720
		pc.y = 440
	EndIf
	pc.waitcount = 0
	If pc.cat &gt;=100 Then pc.Remove()
Next

For i = 1 To 8
	pc:bbcreature = New bbcreature
	If i &lt; 5 Then 
		pc.x = 360 + (i-1) * 180'Rand(0,SW)
		pc.y = 180 'Rand(0,SH)
	Else
		pc.x = 450 + (i-5) * 180'Rand(0,SW)
		pc.y = 225 'Rand(0,SH)
	
	EndIf
	
	If gamelevel = 1 Then 
	pc.cat = 100+Rand(0,1)
	pc.hp = 70
	pc.fullhp = 50
	pc.damage = 5
	pc.skill = 80
	EndIf
	If gamelevel = 2 Then 
		'trolls2
		If i = 1 Or i = 8 Then 
			pc.cat = 102
			pc.hp = 200
			pc.regenerate = True
			pc.fullhp = 200
			pc.damage = 10
			pc.skill = 150
		Else
			pc.cat = 100+Rand(0,1)
			pc.hp = 70
			pc.fullhp = 50
			pc.damage = 5
			pc.skill = 80
		EndIf 
	EndIf 
	If gamelevel = 3 Then 
		'wizard and troll
		If i = 1 Or i = 8 Then
			pc.cat = 102
			pc.hp = 200
			pc.regenerate = True
			pc.fullhp = 200
			pc.damage = 10
			pc.skill = 150
		ElseIf i = 4 Then
			pc.cat = 103
			pc.hp = 100
			pc.fullhp = 100
			pc.damage = 5
			pc.skill = 350
		Else
			pc.cat = 100+Rand(0,1)
			pc.hp = 70
			pc.fullhp = 50
			pc.damage = 5
			pc.skill = 80
		EndIf 
	EndIf
	If gamelevel = 4 Then
		'spiderbeasts and giant spiders
		If i = 1 Or i = 8 Then 
			pc.cat = 104
			pc.hp = 150
			pc.poison = 15
			pc.regenerate = True
			pc.fullhp = 150
			pc.damage = 15
			pc.skill = 100
		Else
			pc.cat = 105
			pc.hp = 100
			pc.fullhp = 100
			pc.damage = 8
			pc.skill = 150
		EndIf 

	EndIf
	If gamelevel = 5 Then 
		'spiderbeasts, giant spiders and spider wizards
		If i = 1 Or i = 8 Then 
			pc.cat = 104
			pc.hp = 150
			pc.poison = 15
			pc.regenerate = True
			pc.fullhp = 150
			pc.damage = 15
			pc.skill = 100
		ElseIf i = 2 Or i = 7
			pc.cat = 106
			pc.hp = 100
			pc.fullhp = 100
			pc.damage = 8
			pc.skill = 300
		Else
			pc.cat = 105
			pc.hp = 100
			pc.fullhp = 100
			pc.damage = 8
			pc.skill = 150
		EndIf 


	EndIf 
	If gamelevel = 6 Then 
		'spider queens and spiderbeasts
		If i = 1 Or i = 8 Then 
			pc.cat = 107
			pc.hp = 100
			pc.fullhp = 100
			pc.damage = 5
			pc.skill = 450
		Else
			pc.cat = 105
			pc.hp = 100
			pc.fullhp = 100
			pc.damage = 8
			pc.skill = 150
		EndIf 
	EndIf 
	If gamelevel = 7 Then 
		'spider queens and giant spiders and spider wizards
		If i = 4 Or i = 5 Then 
			pc.cat = 107
			pc.hp = 100
			pc.fullhp = 100
			pc.damage = 5
			pc.skill = 450
		ElseIf i = 2 Or i = 7
			pc.cat = 106
			pc.hp = 100
			pc.fullhp = 100
			pc.damage = 8
			pc.skill = 300
		Else
			pc.cat = 104
			pc.hp = 150
			pc.regenerate = True
			pc.poison = 15
			pc.fullhp = 150
			pc.damage = 15
			pc.skill = 100
		EndIf 
	EndIf 
	'beasts
	If gamelevel = 8 Then 
		If i = 2 Or i = 6 Or i = 4
			'centaur
			pc.cat = 108
			pc.hp = 200
			pc.fullhp = 200
			pc.damage = 10
			pc.skill = 150
		Else
			'grunt
			pc.cat = 109
			pc.hp = 90
			pc.fullhp = 90
			pc.damage = 20
			pc.skill = 150
		EndIf
	EndIf
	If gamelevel = 9 Then
		If i = 3 Or i = 5 Then
			'shaman
			pc.cat = 110
			pc.hp = 180
			pc.fullhp = 180
			pc.damage = 15
			pc.skill = 250
		Else
			'grunt
			pc.cat = 109
			pc.hp = 90
			pc.fullhp = 90
			pc.damage = 20
			pc.skill = 150

		EndIf
	EndIf
	If gamelevel = 10 Then 
		If i = 1 Or i = 8 Then
			'shaman
			pc.cat = 110
			pc.hp = 180
			pc.fullhp = 180
			pc.damage = 15
			pc.skill = 250
		ElseIf i = 2 Or i = 7 Or i = 4 Then
			'centaur
			pc.cat = 108
			pc.hp = 200
			pc.fullhp = 200
			pc.damage = 10
			pc.skill = 150
		Else
			'grunt
			pc.cat = 109
			pc.hp = 90
			pc.fullhp = 90
			pc.damage = 20
			pc.skill = 150
		EndIf
	EndIf 
	If gamelevel = 11 Then
		If i = 4 Then
			'necromancer
			pc.cat = 113
			pc.hp = 200
			pc.fullhp = 200
			pc.damage = 20
			pc.skill = 250
		ElseIf i = 5 Then 
			'wraith
			pc.cat = 112
			pc.hp = 200
			pc.ethereal = True
			pc.fullhp = 200
			pc.damage = 15
			pc.skill = 300
		Else
			'skeleton
			pc.cat = 111
			pc.hp = 20
			pc.fullhp = 20
			pc.damage = 10
			pc.skill = 150
		EndIf
	EndIf
	If gamelevel = 12 Then 
		If i = 5 Or i = 7 Then 
			'necromancer
			pc.cat = 113
			pc.hp = 200
			pc.fullhp = 200
			pc.damage = 20
			pc.skill = 250

		ElseIf i = 4 Or i = 6
			'wraith
			pc.cat = 112
			pc.hp = 200
			pc.ethereal = True
			pc.fullhp = 200
			pc.damage = 15
			pc.skill = 300
		Else
			'skeleton
			pc.cat = 111
			pc.hp = 20
			pc.fullhp = 20
			pc.damage = 10
			pc.skill = 150
		EndIf
	EndIf
	If gamelevel = 13 Then 
		If i = 1 Then 
			'liche
			pc.cat = 114
			pc.hp = 300
			pc.fullhp = 300
			pc.damage = 20
			pc.skill = 350
		ElseIf i = 2 Or i = 3 Then 
			'necromancer
			pc.cat = 113
			pc.hp = 200
			pc.fullhp = 200
			pc.damage = 20
			pc.skill = 250
		ElseIf i = 4 Or i = 5 Then 
			'wraith
			pc.cat = 112
			pc.hp = 200
			pc.fullhp = 200
			pc.damage = 15
			pc.skill = 300
			pc.ethereal = True
		Else
			'skeletons
			pc.cat = 111
			pc.hp = 20
			pc.fullhp = 20
			pc.damage = 10
			pc.skill = 150
		EndIf
	EndIf 
	For img:bbimages = EachIn images_list
		If img.cat = pc.cat Then 
			pc.img = img.img
			Exit 
		EndIf 
	Next
Next

lmb = 0
olmb = 0
FlushMouse()
levelfinishtime = 0
End Function 

Function createskeleton:bbcreature(pc:bbcreature)
x = pc.x
y = pc.y
pc.Remove()
pc:bbcreature = New bbcreature
			pc.cat = 111
			pc.strucktime = 10
			For img:bbimages = EachIn images_list
				If img.cat = pc.cat Then pc.img = img.img;Exit 
			Next
			pc.hp = 20
			pc.x = x
			pc.y = y
			pc.fullhp = 20
			pc.damage = 10
			pc.skill = 150
			pc.regenerate = False
			pc.ethereal = False
			pc.summonedtime = 25
			pc.berserk = 0
Return pc
End Function 

Function createhealparticle(x,y)

For i = 1 To 36
	p:bbparticle = New bbparticle
	p.life = 20
	p.x = x + 25.0 * Cos(i*10)
	p.y = y + 20 + 25.0 * (Sin(i*5))
	p.vx = 0
	p.vy = Rand(-4,-2)
	p.ay = 0.1
	p.gy = p.y + 100
	p.r = 32
	p.g = 200
	p.b = 255
	p.sz = 4
	p.dsz = -0.1
	p.dr = 10
	p.dg = 2
	p.db = 0
Next

End Function 

Function createsummonparticle(x,y)

For i = 1 To 36
	p:bbparticle = New bbparticle
	p.life = 20
	p.x = x + 25.0 * Cos(i*10)
	p.y = y + 20 + 25.0 * (Sin(i*5))
	p.vx = 0
	p.vy = Rand(-4,-2)
	p.ay = 0.1
	p.gy = p.y + 100
	p.r = 32
	p.g = 255
	p.b = 50
	p.sz = 4
	p.dsz = -0.1
	p.dr = 8
	p.dg = 0
	p.db = 8
Next

End Function 


Function createbloodparticle(x,y)

For i = 1 To 10
	p:bbparticle = New bbparticle
	p.life = 20
	p.x = x + Rand(-10,10)
	p.y = y + Rand(-10,10)
	p.vx = Rnd(-3,3)
	p.vy = Rnd(-3,3)
	p.ay = 0.05
	p.gy = y + 42
	p.r = 255
	p.g = 100
	p.b = 100
	p.dr = -2
	p.dg = -3
	p.db = -3
	p.sz = 4
	p.dsz = 0
Next

End Function 

Function createcurseparticle(x,y)
For i = 1 To 36
	p:bbparticle = New bbparticle
	p.life = 10+Rand(5)
	p.x = x +25 * Cos(i*10)
	p.y = y + 15.0 * Abs(Sin(i*10))
	p.vx = 0
	p.vy = Rand(-4,-2)
	p.ay = 0.1
	p.gy = p.y + 100
	p.r = 255
	p.g = 50
	p.b = 255
	p.sz = 4
	p.dsz = 0.25
	p.dr = 0
	p.dg = 22
	p.db = 0
Next
End Function 
Function createberserkparticle(x,y)
For i = 1 To 36
	p:bbparticle = New bbparticle
	p.life = 10+Rand(5)
	p.x = x +25 * Cos(i*10)
	p.y = y + 15.0 * Abs(Sin(i*10))
	p.vx = 0
	p.vy = Rand(-4,-2)
	p.ay = 0.1
	p.gy = p.y + 100
	p.r = 255
	p.g = 50
	p.b = 255
	p.sz = 4
	p.dsz = 0.25
	p.dr = 0
	p.dg = 22
	p.db = 0
Next



End Function 

Function updateparticle()
For p:bbparticle = EachIn particle_list
	p.life = p.life - 1
	p.x = p.x + p.vx
	p.y = p.y + p.vy
	p.vy = p.vy + p.ay
	If p.y &gt; p.gy Then 
		p.vy = p.vy * -0.7
		If Abs(p.vy)&lt;0.01 Then p.life = 0
	EndIf 
	p.sz = p.sz + p.dsz
	p.r = p.r + p.dr
	p.g = p.g + p.dg
	p.b = p.b + p.db
	If p.sz &lt; 0 Then p.sz = 0
	If p.r &gt; 255 Then p.r = 255
	If p.g &gt; 255 Then p.g = 255
	If p.b &gt; 255 Then p.b = 255
	If p.r &lt; 0 Then p.r = 0
	If p.g &lt; 0 Then p.g = 0
	If p.b &lt; 0 Then p.b = 0
	If p.life &lt; 0 Then p.Remove()
Next
End Function 

Function drawparticle()
For p:bbparticle = EachIn particle_list
	SetColor p.r,p.g,p.b
	DrawRect p.x,p.y,p.sz,p.sz',1
Next
SetColor 255,255,255
End Function 

Function drawnumber(x,y,num)
txt$ = String(num)
For i = 1 To Len(txt)
	digit = Int(Mid(txt,i,1))
	For img:bbimages = EachIn images_list
		If img.cat = 10000 + digit Then 
			DrawImage img.img,x + (i-1) * 50 - Len(txt) * 25,y - 25
			Exit
		EndIf
	Next
Next 
End Function 

Function playfx(cat)
If audiostate
	For aud:bbaudio = EachIn audio_list
		If aud.cat = cat Then 
			aud.channel = PlaySound(aud.hnd)
		EndIf 
	Next
EndIf
End Function 

Function updatefx()
If audiostate = False Then deleteEach bb32
For fx:bbaudiofx = EachIn audiofx_list
	If MilliSecs()&gt;fx.time Then 
		PlaySound(fx.hnd)
		fx.Remove()
	EndIf 
Next
End Function 

Function playfxdelayed(cat,time)
If audiostate
	For aud:bbaudio = EachIn audio_list
		If aud.cat = cat Then 
			found = False
			For fx:bbaudiofx = EachIn audiofx_list
				If fx.hnd = aud.hnd And fx.time &lt; MilliSecs() + time * 2 Then
					found = True
					Exit
				EndIf
			Next
			If found = False Then 
				fx:bbaudiofx = New bbaudiofx
				fx.hnd = aud.hnd
				fx.time = MilliSecs() + time
			EndIf 
		EndIf 
	Next
EndIf

End Function 
</textarea> <br><br></td></tr></table><br>
<a name="1341455"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#107">[#107]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oohh...tell me if you want it removed...don't want to publish anything you're not comfortable with having... <br><br></td></tr></table><br>
<a name="1341457"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rooster</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#108">[#108]</a></td></tr></table></td></tr><tr ><td class="posttext"> No it's fine, I just wasn't expecting it. <br><br></td></tr></table><br>
<a name="1341460"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rooster</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#109">[#109]</a></td></tr></table></td></tr><tr ><td class="posttext"> A little off topic, but thanks for telling about your method for creating sprites.<br>I just got around to seriously testing it, and it worked out great. Thanks. :) <br><br></td></tr></table><br>
<a name="1341526"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rooster</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#110">[#110]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay it's been a bit, what is the status? <br><br></td></tr></table><br>
<a name="1341528"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#111">[#111]</a></td></tr></table></td></tr><tr ><td class="posttext"> I want to thank both of you to share the code in bb and bmx, i don't like the gameplay of the game even if the characters drawings are nice, but i find interesting to see how others write code and to see how far you can convert a bb code in bmx (because some functions/possibilities are not available in bmx but in bb and vice versa)<br>anyway, good luck for the next steps... <br><br></td></tr></table><br>
<a name="1341539"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#112">[#112]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Rooster...status. ..busy at work yesterday...weekend is over...so havent touched it.  Will probably not have time until Thursday this week but we will see.  I might play it a bit to get a feel for any changes.<br><br>Thanks RemiD. <br><br></td></tr></table><br>
<a name="1341545"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rooster</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#113">[#113]</a></td></tr></table></td></tr><tr ><td class="posttext"> I should have thought of that, sorry for bothering you.<br><br>@RemiD<br>Glad you found this useful/interesting. <br><br></td></tr></table><br>
<a name="1341558"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#114">[#114]</a></td></tr></table></td></tr><tr ><td class="posttext"> No worries..no big deal...I'm on these forums most days so it is no bother... <br><br></td></tr></table><br>
<a name="1341571"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mainsworthy</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#115">[#115]</a></td></tr></table></td></tr><tr ><td class="posttext"> Matty, Ive been toying around with an RPG app I had not finished, and I was wondering if I could put your art into it, so it would be a second collab work, I don't know if I will ever get it finished, but your art would improve things? <br><br></td></tr></table><br>
<a name="1341575"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#116">[#116]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes - love you to use my art.  That's what it is there for.<br><br>Have a look here for the full content so far (and I am planning on adding to it and will take suggestions happily)<br><br><a href="http://www.mattiesgames.com/assets/" target="_blank">Art Assets</a> <br><br></td></tr></table><br>
<a name="1341576"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mainsworthy</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#117">[#117]</a></td></tr></table></td></tr><tr ><td class="posttext"> thanks Matty, they look good. <br><br></td></tr></table><br>
<a name="1341609"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >stayne</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#118">[#118]</a></td></tr></table></td></tr><tr ><td class="posttext"> This project screams for MIDI music. <br><br></td></tr></table><br>
<a name="1341787"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted May)</font>&nbsp;<a href="#119">[#119]</a></td></tr></table></td></tr><tr ><td class="posttext"> Another graphic (although probably not for this game..used it in my other one)<br><br><img src="http://www.mattiesgames.com/assets/00122king.png"> <br><br></td></tr></table><br>
<a name="1343361"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rooster</td><td align="right"><font class=tiny>(Posted June)</font>&nbsp;<a href="#120">[#120]</a></td></tr></table></td></tr><tr ><td class="posttext"> Matty, now that the site is closing, should I make a new thread for this at one of the new forums?<br><br>(The ones I know of so far.)<br><a href="http://blitzbasic.ga/" target="_blank">http://blitzbasic.ga/</a><br><a href="https://www.syntaxbomb.com/" target="_blank">https://www.syntaxbomb.com/</a> <br><br></td></tr></table><br>
<a name="1343371"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted June)</font>&nbsp;<a href="#121">[#121]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can if you want - I haven't decided what I'm going to do come closing time re other forums.<br><br>I'm not likely to spend a lot of time on this project going forward...I've done as much as I'm going to do for the moment. <br><br></td></tr></table><br>
<a name="1343383"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rooster</td><td align="right"><font class=tiny>(Posted June)</font>&nbsp;<a href="#122">[#122]</a></td></tr></table></td></tr><tr ><td class="posttext"> I was under the impression that you were going to post one more final version.<br>So I guess the last one is the final version then?<br><br>If so, then I think I will post it at the aforementioned forums. <br><br></td></tr></table><br>
<a name="1343398"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted June)</font>&nbsp;<a href="#123">[#123]</a></td></tr></table></td></tr><tr ><td class="posttext"> No...I've finished with this project...I'm happy for you to take it wherever you want though...and you can choose to use more of the graphics found here:<br><br><a href="http://www.mattiesgames.com/assets/" target="_blank">http://www.mattiesgames.com/assets/</a><br><br>if you wish to extend it. <br><br></td></tr></table><br>
<a name="1343430"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rooster</td><td align="right"><font class=tiny>(Posted June)</font>&nbsp;<a href="#124">[#124]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay, I will be putting them on the the forums.<br><br>I may add more to it there someday. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
