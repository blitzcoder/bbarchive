<!DOCTYPE html><html lang="en" ><head ><title >Release app segfault issues</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Release app segfault issues</h1><a href="forums.php" >Archives Forums</a>/<a href="topics.php?forum=109" >Linux Discussion</a>/<a href="#bottom" >Release app segfault issues</a><br><br>
<a name="1321632"></a>

<a name="1321650"></a>

<a name="1321651"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dawlane</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> As of late I have been seeing segfault issues with release builds using later distributions of Linux. I suspected that the problem was down to the way later GCC versions applied optimisations to generated code and the few test I've tried seem to confirm it.<br>But here's the weird part. A convoluted build process seems to fix it. It shouldn't if it was down to optimisations.<br><br>This was tested on Debian 8.6 as it has the problem with creating release builds with the github master and the construction scripts.<br>But making a custom script that works like this:<br>1) Make a bin directory and copy the supplied github binaries bmk and bcc for Linux over to it. <br>2) Build only the debug modules.<br>3) Build bmk and bcc as debug builds, but do not use the option to output the binaries back into the bin directory.<br>4) Delete the original bmk and bcc, before replacing them with the debug builds.<br>5) Flush out the old object (.o) and static (.a) library files, before rebuilding modules as release versions.<br>find . \( -name ".o" -name ".a" \) -type f -delete<br>6) Build bmk and bcc as release builds, but do not use the option to output the binaries back into the bin directory.<br>7) Delete the debug versions of bmk and bcc, before replacing them with the new release builds.<br>8) May not be necessary, but flush out the modules again and this time rebuild all the modules.<br><br>Any thoughts on this issue? <br><br></td></tr></table><br>
<a name="1321636"></a>

<a name="1321637"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Any reason for "4)" and "7)" needing that "delete ... before" ? Potential Cache invalidation ?<br>(just remembering the "demoapp"-segfault-issue which is only happening for 50% of the executions).<br><br><br>So in short your approach is:<br>- build a debug variant of the toolchain binaries<br>- use the debug versions to build the toolchain binaries in release mode (instead of the originally provided release-build of the toolchain binaries)<br>?<br><br>In that case it should not need steps "5)" and "8)" as an enforced module rebuild rebuilds regardless of the current module compilation state and existing "a's and o's". Or hmm, only if there is no "link to all existing .o-files in a directory" - which I doubt (avoid mixing release/debug/mt).<br><br><br>With Brucey's BMK (BMK-NG) shouldn't this gcc optimization can get deactivated via "custom.bmk"<br><br><i>default</i><br><pre class=code>
#compiler optimisation
setccopt optimization -O2 
</pre><br><br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1321642"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RustyKristi</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I was also getting seg fault issues with 64bit linux, that's why I put most of my projects on hold with bmx. same setup I would assume. <br><br></td></tr></table><br>
<a name="1321647"></a>

<a name="1321648"></a>

<a name="1321649"></a>

<a name="1321652"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dawlane</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Any reason for "4)" and "7)" needing that "delete ... before" ? Potential Cache invalidation ?" <br></div>More a feeling that somehow an an old build bcc is getting mixed with a new bmk build or visa-versa. So building both together first and then getting rid of the old out of the bin directory before moving the new to replace them.<br><div class="quote"> In that case it should not need steps "5) <br></div>A precautionary measure. As the old object files would still be there, so I though clean them out and start afresh.<br><br>So if it turns out that what I did with Debian 8.6 works on other distributions. Then it would look like that the supplied versions of bcc and bmk need rebuilding to work of any new version of GCC. If not; then its going to be a real problem in the future.<br><br><div class="quote"> With Brucey's BMK (BMK-NG) shouldn't this gcc optimization can get deactivated via "custom.bmk" <br></div>Brucey's bcc and bmk are not affcted, but you still need a working vanilla bcc and bmk to build Brucey's stuff from scratch. All you need is the debug build of vanilla bcc and bmk to get Brucey's basic tool chain started. <br><br>@RustyKristi: It's not just 64 bit that is affected. The 32 bit Debian seg faulted as well.<br>Ubuntu 16.04 uses GCC version 5.4.0<br>Debian 8.6 uses GCC 4.9.2<br>Ubuntu 14.04 uses GCC 4.8.4 and should work out of the box.<br><br>Think It may be an idea to go over it with sanitise. <br><br></td></tr></table><br>
<a name="1321653"></a>

<a name="1321654"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Re BMK-NG<br><br>You know you could use BMK-NG together with vanilla BCC (if not, you know it now :-))?<br>So I was talking about using "BCC" and "BMK-NG" to build the "new BCC release build" skipping the "debug-build-step".<br><br>Download a prebuild linux BMK-NG, a vanilla BCC, the vanilla sources (docmod, brl,pub ...) and you should be able to start compiling the new bcc from the sources (bmk-ng handles compiling the modules if needed).<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1321691"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RustyKristi</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Actually I have no problems running with 32bit and that's emulated. <br><br>yes I'm using Ubuntu btw 14.04 and 4.8.4 is the perfect version with vanilla.<br><br>Maybe try downgrading to 4.8.4? <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
