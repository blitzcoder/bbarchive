<!DOCTYPE html><html lang="en" ><head ><title >Audio</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Audio</h1><a href="forums.php" >Archives Forums</a>/<a href="topics.php?forum=109" >Linux Discussion</a>/<a href="#bottom" >Audio</a><br><br>
<a name="1214613"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is there a de facto audio library for Linux or does everyone/distros just pick and choose depending on the weather? <br><br></td></tr></table><br>
<a name="1214615"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dawlane</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> distros just pick and choose depending on the weather? <br></div>That's about the size of it. Each distribution goes it's own way. It just a popularity contest out there in the Linux world for what becomes the new de-facto. If you want audio across all distributions. Then it's best to go OpenAL, but even then you still get people that don't want to install extra libraries no matter what audio system you use. <br><br></td></tr></table><br>
<a name="1214665"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you want to use "default audio" with BlitzMax you should rely  on "freeaudio" or "rtAudio" - they are adding a layer to the  basic sound engines.<br><br>In the case of most linux distributions it is still: Alsa or PulseAudio (years ago it was OSS - Open Sound System - or how German ubuntuusers calls it: OSS-Soundsystem [sic!]). If you are in a "audio editor"-specific distro it could be JACK too (low latency audio system)<br><br>If you use "Alsa" in BlitzMax while your system uses PulseAudio, I recognized that other audio outputting programmes (internet radio, youtube or whatever) stops as soon as you start playing sound. So the "mixing" is borked then. This is why I reordered the engines in rtAudio so PulseAudio is checked first.<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1214782"></a>

<a name="1214783"></a>

<a name="1214784"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I would say the standard is null audio, with no connection to speakers or headphone line. I'm guessing 99.9% of linux runs in the server room where it belongs.<br><br>Audio drivers on Windows actively adapt to jacks being connected to speakers / headphones so a linux issue people have is if they plug their speakers into the blue jack instead of the green one, or fail to have attached their headphones to the green out on the front of the case etc. <br><br>In Linux philosophy that means that each app needs ux for both mixer and joystick configuration.<br><br>The alternative answer is the driver that runs on both steam and ubuntu which I'm guessing is pulse. <br><br></td></tr></table><br>
<a name="1214787"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> After reading wikipedia PulseAudio page Jack is talked of.<br><br><a href="http://en.wikipedia.org/wiki/PulseAudio" target="_blank">http://en.wikipedia.org/wiki/PulseAudio</a><br><br>I'm curious now what is recommended on SteamOS. <br><br></td></tr></table><br>
<a name="1214789"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is it worth applying your Pulse audio patch script to <a href="https://github.com/maxmods/pub.mod" target="_blank">https://github.com/maxmods/pub.mod</a> , if you think Pulse audio is more likely to be available (in general) ? <br><br></td></tr></table><br>
<a name="1214790"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>so a linux issue people have is if they plug their speakers into the blue jack instead of the green one, or fail to have attached their headphones to the green out on the front of the case etc. <br> <br></div><br><br>Jack-retasking is possible for some years now.<br><br>If you do not like to do it like people do it with linuxes "where it belongs" aka "command line". You are free to use a tool like: hda-jack-retask.<br><br>I personally do not prefer a audio driver selecting for me "automagically" every thing ... I remember myself using earphones as microphone etc.<br><br><br>The price of freedom (choice of software) is that you do not have a minimum common. I am on Linux for some years now -- no regrets that did not vanish over the months.<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1214801"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> If SteamOS has pulse support maybe freeaudio just needs to have some port configuration / mixer commands so user configuration is then possible. I would be up for adding them.<br><br>I think BlitzMax audio on Linux should possible have all drivers available for user selection, currently this isn't possible. The possible drivers being OpenAL, OSS, ALSA, Pulse and maybe jack. <br><br>There are updates to OSS/ALSA I think in another thread here which I need to track down also. <br><br></td></tr></table><br>
<a name="1214828"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dawlane</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I was thinking of having a go at implementing audio driver selection by adapting <a href="http://www.thirdmartini.com/index.php/Linux_Dynamic_Binding" target="_blank">this</a> method. But lately I have been having doubts if it is still worth the effort to carry on with a product that looks like it may be on it's last legs. As you have seen in a number of post, people are getting a little reluctant to start any new projects, especially as Mark hasn't post on this site for awhile.<br>As a side note the <a href="http://monkey-x.com/Community/posts.php?topic=7767" target="_blank">64 bit issue</a> cropped up over on the Monkey site when a problem iOS popped up. <br><br></td></tr></table><br>
<a name="1214833"></a>

<a name="1214837"></a>

<a name="1214838"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GaryV</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> But lately I have been having doubts if it is still worth the effort to carry on with a product that looks like it may be on it's last legs. <br></div>Although audio is a major issue with the Linux side of BlitzMax, so is the IDE and MaxGUI.  It is pointless to fix one, without fixing the others.<br><br>Josh has been putting a lot of work (and money) into getting MaxGUI functional on Linux.  He can get away without audio since he is making an app.<br><br>Seb did a wonderful job getting MaxGUI functional on Windows and OSX, but the Linux side didn't really benefit from his work.<br><br>Unless BRL is willing to put some effort into the Linux side of Max, I am not sure it is worth your effort. <br><br></td></tr></table><br>
<a name="1214845"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Then use wxMax if you want to use OS-GUI-functionality.<br><br>@dawlane and .so-files<br>This would remove the "all in one file"-aspect which is currently possible (with incbin::bla).<br><br>In general you are absolutely right about a "drivers available" thing containing the current engines without much trouble.<br>Afterwards "just" code a crossplatform-engine-independend-sound-streaming-functionality and most people (the handful left :D) in the forums will be more than glad to have you next to them.<br><br>@Mark<br>Albeit Mark did not wrote something in this forum for years (I know that behaviour by myself... people think "he is 'dead'" and if you start again to post, you have to answer everything, people stress your nerves etc. - done this 5 years so so and now have to rebuild my whole community). BUT: he answered to my support question, so the project itself isn't that dead - just on halt or so.<br>Maybe I should ask him directly why he does not kept being active in the forums here on the BlitzMax-side of BRL. <br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1214854"></a>

<a name="1214867"></a>

<a name="1214869"></a>

<a name="1214871"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dawlane</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Maybe I should ask him directly why he does not kept being active in the forums here on the BlitzMax-side of BRL. <br></div>I can answer this one myself by using one word, a hyphen and a letter..... Monkey-X.<br>I don't know who still has any thing to do directly with BRL or who has direct access to the primary compiler code base other than Mark. Maybe it could be put it to him to open up this code as a closed source project to a few talented BlitzMax users who can code C/C++ and Assembly. Of course there would have to be non-disclosure agreements, some in over-all control etc and someone who has time and is willing to commit them selves to such a project and of course a list of people posted on these forums who are involved wouldn't hurt either. <br><br>@Derron: The question of using incbin with dynamic/static libraries surely depend on the license of that library? To me that wouldn't be a good solution as the Free Software Foundation would crucify you if you dared to breach the terms of GPL/LGPL. The cross platform engine independend sound streaming functionality sounds like a good solution. But the audio side of Max would need a major rewrite though. <br><br></td></tr></table><br>
<a name="1214937"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GaryV</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Then use wxMax if you want to use OS-GUI-functionality. <br></div>The reason for buying MaxGUI was it was said to work on Linux.  That said, wxMax is not officially supported and not without its bugs and is bloated beyond belief. <br><br></td></tr></table><br>
<a name="1214973"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Pretty please can this discussion remain on topic. <br><br></td></tr></table><br>
<a name="1215603"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> SteamOS seems to have had some audio issues <a href="http://steamcommunity.com/groups/steamuniverse/discussions/1/648817377758375760/" target="_blank">pulse audio is failing to start up...</a> which have only recently been fixed. <br><br>It does seem like pulse is the driver best suited for app development on Linux but ideally the user needs to be able to switch between Pulse and OpenAL in the app's audio configurations options. <br><br></td></tr></table><br>
<a name="1215607"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Never had this problem on my machines.<br><br>PulseAudio was a mess some years ago (the time they first introduced it as "new default") and you still had ALSA installed as default.<br><br>Like said for me the most "problematic" thing with sound on Blitzmax+Linux is that dependency check. You cannot fall back that easily to ALSA if Pulse Audio is not working/not installed. This may be a non-issue but was problematic within my short tests concerncing the sound engines.<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1215610"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dawlane</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hold on people. PulseAudio is not a driver it is a sound server that relies on ALSA drivers. So no matter what, ALSA at some level has to be installed.<br><br>A BlitzMax application, should when executed, ideally hold an internal list of sound architectures available on a system, but always default to ALSA. It should then be the applications author to make these available to the end user. The easiest way to implement this would be to check which libraries are installed and load/unload them at run-time.  <br><br>On a side note you usually get problems if you have Jack or Jack2 installed along with PulseAudio, but Jack2 with D-Bus is written to coexist with PulseAudio. The ALSA documentation mentions writing interrupt driven routines where systems that rely on a callback-driven mechanism like JACK etc are installed. <br><br></td></tr></table><br>
<a name="1215654"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> So there's two current sets of updates I could be applying?  Some stuff for ALSA and some stuff which makes BlitzMax "prefer" PulseAudio ? <br><br></td></tr></table><br>
<a name="1215663"></a>

<a name="1215664"></a>

<a name="1215665"></a>

<a name="1215666"></a>

<a name="1215667"></a>

<a name="1215723"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dawlane</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> skid wrote a <a href="/posts.php?topic=93662" target="_blank">PulseAudio BlitzMax</a> driver which I incorporated into a patch script along with first fix of the <a href="/posts.php?topic=98049" target="_blank">ALSA driver</a> for a clean install of BlitzMax 1.48.<br><br>The script default is to use the PulseAudio. You can change this by editing brl.mod/freeaudioaudio/freeaudioaudio.bmx and pub.mod/freeaudio/freeaudio.bmx. You can edit it to include both the ALSA library API and PulseAudio, but the end user would have to have both on their system or the program will fall flat on it's face as function symbols are resolved at compile time. This is where checking, dynamic loading and function symbol resolving of the libraries at runtime would be a boon. As it stands at the moment the BlitzMax audio system doesn't do that.<br><br>PulseAudio is the default sound server for the main Linux distributions (Ubuntu, OpenSUSE, Fedora, Linux Mint, Mageia a Mandriva clone if I remember) as it can do a few things the the ALSA library API cannot, but PulseAudio may not be installed as the default sound server in any distribution that's based off of them. The ALSA library should really be used as a last resort as some people on these here pages said that they were having sound issue with using ALSA. <br><br></td></tr></table><br>
<a name="1215668"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> Cool, so I'll integrate those two patches, and then look to convert the code for runtime linking.<br><br>And then what? Will everything "just work" or should we include Jack(2) as another option too? <br><br></td></tr></table><br>
<a name="1215673"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dawlane</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> In theory it should work, but my internet searches have draw up a blank with dynamic loading of Linux sound systems. Looks like everyone just takes it for granted that you will install the requires library packages.<br><br>PulseAudio does have a jack module which needs a <a href="http://jackaudio.org/pulseaudio_and_jack" target="_blank">little bit of work</a> for it to do any thing. But I cannot see any harm of having other sound servers to the list. All it requires is the know how, time and commitment to write the code. <br><br></td></tr></table><br>
<a name="1215674"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> My first experiences were before pulse and then ALSA simply abstracted the lineout connection of the computer so if your window manager wanted to go bloop while you wanted to go blip you were shit out of luck. <br><br></td></tr></table><br>
<a name="1215677"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> Brucey there is ALSA patches <a href="/posts.php?topic=98049" target="_blank">here</a>. <br><br></td></tr></table><br>
<a name="1215680"></a>

<a name="1215681"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dawlane</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just found this <a href="http://0pointer.de/blog/projects/guide-to-sound-apis" target="_blank">A Guide Through The Linux Sound API Jungle</a> while I was trawling through the internet. The bit titled <b>You want to know more about the safe ALSA subset?</b> is worth a read. <br><br></td></tr></table><br>
<a name="1215711"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>You can edit it to include both the ALSA library API and PulseAudio, but the end user would have to have both on their system or the program will fall flat on it's face as function symbols are resolved at compile time. This is where checking, dynamic loading and function symbol resolving of the libraries at runtime would be a boon. As it stands at the moment the BlitzMax audio system doesn't do that.<br> <br></div><br>I knew that sometime someone will find better words for the problem I tried to explain.<br><br><br>I also did not know that PulseAudio relies on ALSA. When using "ALSA" pure while your system is using PulseAudio - I had stopped audio (other programs playing audio) while my app played sounds. As soon as I quit my app the sound playback of other apps continued. Happened on different computers. As I patched according to the patches in the forum my BlitzMax-mods primary use PulseAudio.<br><br><br>What is about using rtAudio as layer? Isn't it a layer like the freeaudio mod?<br><br><a href="http://www.music.mcgill.ca/~gary/rtaudio/" target="_blank">http://www.music.mcgill.ca/~gary/rtaudio/</a><br><br><br>@Resolving of functions<br>Isn't it an option to do some "checking" so checking for OS, enabled "sound servers" and only use the functions of that server on success?<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1215730"></a>

<a name="1215732"></a>

<a name="1215733"></a>

<a name="1215734"></a>

<a name="1215735"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dawlane</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I also did not know that PulseAudio relies on ALSA. <br></div>In fact the kernel has low level ALSA functionality as component. When you write normal ALSA application you go through the ALSA user space library.<br><br><div class="quote"> @Resolving of functions<br>Isn't it an option to do some "checking" so checking for OS, enabled "sound servers" and only use the functions of that server on success? <br></div>It should be possible to retrieve what sound server is running by searching the processes by using functions in <b>libprocps</b> or parsing <b>/proc</b> directly (I can't remember if parsing /proc can be done with a user program).<br><br>And as quick reminder of dynamic loading at run time.<br><br>1) In code you need to declare proto-types/defines as function pointers of the dynamic libraries exported functions and include <b>dlfcn.h</b><br>2) You need to declare a handle to hold the address of the dynamic library to load. And a pointer variable of type char for any error messages.<br>3) Use <b><a href="http://linux.die.net/man/3/dlopen" target="_blank">dlopen</a></b> (handle = dlopen( "lib to load", bining flag) to load the dynamic library to memory. If the library was not compiled with the fPIC flag, then link-loader will make a copy of that library in memory for each application that use it. If it has been compiled with fPIC, then the loader binds it to the one in memory if it has been already loaded.<br>If <b>dlopen</b> fails the returned value is NULL. That's where the checking comes in.<br>4) Upon the successful loading of the dynamic library. You will need to create an handle instance of those proto-types/define functions before you can then start to retrieve the exported dynamic library functions with <b>dlsym</b> e.g myfunctionhandle = (proto-types/defines)dlsym(handle of library,"function name");.<br><br><div class="quote"> What is about using rtAudio as layer? Isn't it a layer like the freeaudio mod? <br></div>Good question. But from what bits of information I have seen so far; It still needs to built against one of the audio API's. So if I would think that you are back to square one. Unless it has it's own method to load libraries for other API's. <br><br></td></tr></table><br>
<a name="1215740"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> It still needs to built against one of the audio API's. So if I would think that you are back to square one. <br></div><br><br>Hmm rtAudio supports JACK ... so this should be a dependency. I think my system does not have JACK installed (aka still installable). So this might just be a thing of compiling the code (with the -dev-libs). I just had to modify the code of rtaudio to use pulseaudio and checks for it at the first glance not after ALSA. ALSA first would lead to that already mentioned problematic (non)simultaneous playback of audio on my systems.<br><br>Sure, I mostly favor rtAudio (if that were a solution) just to make the step for "vanilla blitzmax"-streaming-audio less big than it is now.<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1215744"></a>

<a name="1215751"></a>

<a name="1215752"></a>

<a name="1215753"></a>

<a name="1215754"></a>

<a name="1215756"></a>

<a name="1215757"></a>

<a name="1215761"></a>

<a name="1215762"></a>

<a name="1215765"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dawlane</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, the license for rtAudio is very accommodating for direct inclusion of the source code as long as you include the license. But you come back to the library linking problem. You could go for dynamic linking at run time with the repository supplied package, but what other packages get installed with it and would the end user accept having to install additional packages just for one type of application?<br><br>Edit:<br><div class="quote"> Hmm rtAudio supports JACK ... so this should be a dependency. I think my system does not have JACK installed (aka still installable) <br></div>Just check with my system and in Debian under VM. libjack-jackd2-0 (this could be JACK2 with DBus) is installed as a default. And librtaudio.so.4 only support ALSA and JACK.<br><br>Edit: libjack-jackd2-0 is the multiprocessor version of jack. Whether D-Bus support in thrown in is any body's guess. <br><br></td></tr></table><br>
<a name="1215768"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ahh yes... libjack-jackd2-0 is installed here too ... just checked libjack (libjack0) which wasn't installed (same for libjack-dev).<br><br><br>@librtaudio.so.4<br>Isn't the maxmod2-module-rtAudio already PulseAudio-enabled?<br>Just had a look at some sources and most things I changed were there for making api-selection possible from blitzmax (RtAudioDriver::SetAPI(int) and others).<br>Should have to mention that maxmod+rtAudio does not work/compile-flawless with MinGW 4.8(.1). Ask Brucey for additional info... he made some "raw" changes to make it compile (wav only).<br><br><br>What I do not understand 100%: If I compile eg. rtAudio  - I have to have that *-dev-libs installed. If I now compile that module into a binary It does not need the *-nondev-libs at all - except I call specific functions from it.<br>So if my program knows (eg. using a config file) what functions to use and which to avoid - why should the binary need that library files.<br>Isn't there a way to make that work (or is that why "dynamic linking" would be needed)?<br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1215801"></a>

<a name="1215802"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay, here's my first attempt. Can someone look this over and see if there's anything broken?<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
// alsadevice.cpp

#ifdef __linux

#include "freeaudio.h"

#include &lt;sys/ioctl.h&gt;
#include &lt;unistd.h&gt;
#include &lt;fcntl.h&gt;
#include &lt;sys/soundcard.h&gt;
#include &lt;pthread.h&gt;

#include &lt;alsa/asoundlib.h&gt;

extern "C" audiodevice *OpenALSADevice();


#include &lt;dlfcn.h&gt;

extern "C" {

static void *_alsa;
static size_t(*alsa_snd_pcm_hw_params_sizeof)();
static int(*alsa_snd_pcm_open)(snd_pcm_t **pcm, const char *name, snd_pcm_stream_t stream, int mode);
static int(*alsa_snd_pcm_hw_params_any)(snd_pcm_t *pcm, snd_pcm_hw_params_t *params);
static int(*alsa_snd_pcm_hw_params_set_access)(snd_pcm_t *pcm, snd_pcm_hw_params_t *params, snd_pcm_access_t _access);
static int(*alsa_snd_pcm_hw_params_set_format)(snd_pcm_t *pcm, snd_pcm_hw_params_t *params, snd_pcm_format_t val);
static int(*alsa_snd_pcm_hw_params_set_rate_near)(snd_pcm_t *pcm, snd_pcm_hw_params_t *params, unsigned int *val, int *dir);
static int(*alsa_snd_pcm_hw_params_set_channels)(snd_pcm_t *pcm, snd_pcm_hw_params_t *params, unsigned int val);
static int(*alsa_snd_pcm_hw_params_set_period_size_near)(snd_pcm_t *pcm, snd_pcm_hw_params_t *params, snd_pcm_uframes_t *val, int *dir);
static int(*alsa_snd_pcm_hw_params_set_periods_near)(snd_pcm_t *pcm, snd_pcm_hw_params_t *params, unsigned int *val, int *dir);
static int(*alsa_snd_pcm_hw_params)(snd_pcm_t *pcm, snd_pcm_hw_params_t *params);
static snd_pcm_sframes_t(*alsa_snd_pcm_writei)(snd_pcm_t *pcm, const void *buffer, snd_pcm_uframes_t size);
static int(*alsa_snd_pcm_prepare)(snd_pcm_t *pcm);
static int(*alsa_snd_pcm_drop)(snd_pcm_t *pcm);
static int(*alsa_snd_pcm_close)(snd_pcm_t *pcm);

int LoadALSA(){
	_alsa = dlopen( "libasound.so",RTLD_NOW );
	if( !_alsa ) _alsa=dlopen( "libasound.so.2",RTLD_NOW );

	return _alsa!=0;
}

void InitALSA(){

	if( !_alsa ) return;

	alsa_snd_pcm_hw_params_sizeof = (size_t (*)())dlsym(_alsa, "snd_pcm_hw_params_sizeof");
	alsa_snd_pcm_open = (int (*)(snd_pcm_t **pcm, const char *name, snd_pcm_stream_t stream, int mode))dlsym(_alsa, "snd_pcm_open");
	alsa_snd_pcm_hw_params_any = (int (*)(snd_pcm_t *pcm, snd_pcm_hw_params_t *params))dlsym(_alsa, "snd_pcm_hw_params_any");
	alsa_snd_pcm_hw_params_set_access = (int (*)(snd_pcm_t *pcm, snd_pcm_hw_params_t *params, snd_pcm_access_t _access))dlsym(_alsa, "snd_pcm_hw_params_set_access");
	alsa_snd_pcm_hw_params_set_format = (int (*)(snd_pcm_t *pcm, snd_pcm_hw_params_t *params, snd_pcm_format_t val))dlsym(_alsa, "snd_pcm_hw_params_set_format");
	alsa_snd_pcm_hw_params_set_rate_near = (int (*)(snd_pcm_t *pcm, snd_pcm_hw_params_t *params, unsigned int *val, int *dir))dlsym(_alsa, "snd_pcm_hw_params_set_rate_near");
	alsa_snd_pcm_hw_params_set_channels = (int (*)(snd_pcm_t *pcm, snd_pcm_hw_params_t *params, unsigned int val))dlsym(_alsa, "snd_pcm_hw_params_set_channels");
	alsa_snd_pcm_hw_params_set_period_size_near = (int (*)(snd_pcm_t *pcm, snd_pcm_hw_params_t *params, snd_pcm_uframes_t *val, int *dir))dlsym(_alsa, "snd_pcm_hw_params_set_period_size_near");
	alsa_snd_pcm_hw_params_set_periods_near = (int (*)(snd_pcm_t *pcm, snd_pcm_hw_params_t *params, unsigned int *val, int *dir))dlsym(_alsa, "snd_pcm_hw_params_set_periods_near");
	alsa_snd_pcm_hw_params = (int (*)(snd_pcm_t *pcm, snd_pcm_hw_params_t *params))dlsym(_alsa, "snd_pcm_hw_params");
	alsa_snd_pcm_writei = (snd_pcm_sframes_t (*)(snd_pcm_t *pcm, const void *buffer, snd_pcm_uframes_t size))dlsym(_alsa, "snd_pcm_writei");
	alsa_snd_pcm_prepare = (int (*)(snd_pcm_t *pcm))dlsym(_alsa, "snd_pcm_prepare");
	alsa_snd_pcm_drop = (int (*)(snd_pcm_t *pcm))dlsym(_alsa, "snd_pcm_drop");
	alsa_snd_pcm_close = (int (*)(snd_pcm_t *pcm))dlsym(_alsa, "snd_pcm_close");
}



}

void *audiothread(void *dev);

#define LINUXFRAG 2048

struct alsaaudio:audiodevice{
	pthread_t	audiopthread;
	int			threadid;
	int			running,playing;
	short		*buffer;
	int			buffersize;	//in bytes
	
	int reset(){
		running=1;
		playing=0;
		mix=new mixer(LINUXFRAG);
		mix-&gt;freq=44100;
		mix-&gt;channels=2;
		buffer=new short[LINUXFRAG];
		buffersize=LINUXFRAG*2;
		pthread_attr_t	attr;
		pthread_attr_init(&amp;attr);
		threadid=pthread_create(&amp;audiopthread,&amp;attr,audiothread,(void*)this);	
		return 0;
	}
	
	int close(){	
		int		timeout;
		running=0;
		timeout=5;
		while (timeout-- &amp;&amp; playing) sleep(1);
		return 0;
	}
};


void *audiothread(void *v){
	int						policy;
	sched_param		sched;	
	int						err;
	alsaaudio 		*dev;
	
	pthread_getschedparam(pthread_self(),&amp;policy,&amp;sched);
	sched.sched_priority++;//policy=SCHED_RR;
	pthread_setschedparam(pthread_self(),policy,&amp;sched);	
	dev=(alsaaudio*)v;

	unsigned int val;
	
	snd_pcm_t *fd;
	snd_pcm_uframes_t periodsize;
	snd_pcm_hw_params_t *hwparams;
	/*snd_pcm_hw_params_alloca(&amp;hwparams);  expanded definition below... */
	do { hwparams = (snd_pcm_hw_params_t *) alloca(alsa_snd_pcm_hw_params_sizeof()); memset(hwparams, 0, alsa_snd_pcm_hw_params_sizeof()); } while (0);
	int output_rate;
	int channels;
	int fragment_size;
	int fragment_count;

	err=alsa_snd_pcm_open(&amp;fd, strdup("default"), SND_PCM_STREAM_PLAYBACK, 0);
	if (err&lt;0) return v;

	fragment_size=LINUXFRAG;  //overall buffer size
	fragment_count=2; //2 - 16 fragment count - 2 minimum, the lower it is potentially the lower the latency

//configure device
	if (alsa_snd_pcm_hw_params_any(fd, hwparams) &lt; 0) {
		//printf("linuxaudio failed at params any\n");
		return v;
	}	
	if (alsa_snd_pcm_hw_params_set_access(fd, hwparams,SND_PCM_ACCESS_RW_INTERLEAVED) &lt; 0) {
		//printf("linuxaudio failed at set access\n");
		return v;
	}	
	
	if (alsa_snd_pcm_hw_params_set_format(fd, hwparams,SND_PCM_FORMAT_S16_LE) &lt; 0) {
		//printf("linuxaudio failed at set format\n");
		return v;
	}
	val = 44100;
	if (alsa_snd_pcm_hw_params_set_rate_near(fd, hwparams,&amp;val, 0) &lt; 0) {
		// Try 48KHZ too 
		//printf("linuxaudio - %d HZ not available, trying 48000HZ\n", output_rate);
		val = 48000;
		if (alsa_snd_pcm_hw_params_set_rate_near(fd, hwparams,&amp;val, 0) &lt; 0) {
			//printf("linuxaudio failed at setting output rate (%d)\n", output_rate);
			return v;
		}
		dev-&gt;mix-&gt;freq=val;		
	}
	channels=2;
	if (alsa_snd_pcm_hw_params_set_channels(fd, hwparams, channels) &lt; 0) {
		//printf("linuxaudio failed at set channels (%d)\n", channels);
		return v;
	}
	periodsize = (fragment_size) / 4; // bytes -&gt; frames for 16-bit,stereo - should be a minimum of 512
	if (alsa_snd_pcm_hw_params_set_period_size_near(fd, hwparams,&amp;periodsize, 0) &lt; 0) {
		//printf("linuxaudio failed at set period size (%d)\n", (int)periodsize);			
		return v;
	}
	val = fragment_count;
	if (alsa_snd_pcm_hw_params_set_periods_near(fd, hwparams,&amp;val, 0) &lt; 0) {
		//printf("linuxaudio failed at set periods (%d)\n", val);			
		//should attempt a one by one period increase up to 16?
		return v;
	}
	if (alsa_snd_pcm_hw_params(fd, hwparams) &lt; 0) {
		//printf("linuxaudio failed at installing hw params\n");
		return v;
	}
	//loop while playing sound
	dev-&gt;playing=1;
	while (dev-&gt;playing)
	{
		dev-&gt;mix-&gt;mix16(dev-&gt;buffer);
		if ((alsa_snd_pcm_writei (fd, dev-&gt;buffer,LINUXFRAG/2)) &lt; 0) {	//Half buffer for two channels?
			//printf ("linuxaudio warning: buffer underrun occurred\n");
			if (alsa_snd_pcm_prepare(fd) &lt; 0) {
				//printf ("linuxaudio failed at preparing pcm\n");
				dev-&gt;playing=0; //die gracefully
			}
		}	
	}
	alsa_snd_pcm_drop(fd);
	alsa_snd_pcm_close (fd);
	return 0;
}

audiodevice *OpenALSADevice(){
	if (LoadALSA()) {
		InitALSA();
		return new alsaaudio();
	}
	
	return 0;
}

#endif
</textarea><br>At the bottom, the OpenALSADevice() function does the load too, returning 0 if it fails.<br><br>In freeaudio.bmx, comment out<br><pre class=code>
Import "-lasound"
</pre><br>and add<br><pre class=code>
Import "-ldl"
</pre><br>in the same section.<br><br>It seems to work fine for me here (Linux Mint 16, VM).<br>In theory, the Linux freeaudio could include *all* the drivers, enabling each one that is available. Then it's up to the app to decide which it wants to use? <br><br></td></tr></table><br>
<a name="1215806"></a>

<a name="1215807"></a>

<a name="1215809"></a>

<a name="1215810"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, I have a modded freeaudio (using dawlanes patch I think - or my manual adjustments)<br><br>so It contains (yours merged):<br><br><pre class=code>
?Linux
Import "-lpulse-simple"
Import "-ldl"
'Import "-lasound"

Import "alsadevice.cpp"
Import "ossdevice.cpp"
Import "pulseaudiodevice.cpp"
Extern "C"
Function OpenPulseAudioDevice()
Function OpenOSSDevice()
Function OpenALSADevice()
End Extern
?
</pre><br><br>And in fa_init()<br><pre class=code>
	Select deviceid
		Case 0
			device=OpenPulseAudioDevice()
		Case 1
			device=OpenALSADevice()
		Case 2
			device=OpenOSSDevice()
	EndSelect
</pre><br>So default is pulseaudio.<br><br><br>I now replaced the cpp file with yours: sound played without disturbing my internet radio.<br>I then commented out <br>- Import "-lpulse-simple"<br>- Import "pulseaudiodevice.cpp"<br>and replaced the "case 0" with the alsa-one.<br><br>Worked again (in both cases I run samples/hitoro/rockout.bmx).<br><br>Only marginal difference was that my PulseAudio-Mixer displayed it one time as "freeaudio : rockout" and the other time as "[ALSA plugin] freeaudio : rockout".<br><br><br>In both cases it seems that it is only visible during "audio playback". In this case when shooting. That is not your problem/fault - but that PulseAudio-Mixer allows to adjust volume of applications independend of "ingame adjustments".<br><br><br>So conclusion: my little test worked without the flaws I expected. Did not check rtAudio-without-pulseaudio. <br>If I use TMaxModRtAudioDriver.Init("LINUX_ALSA") instead of TMaxModRtAudioDriver.Init("LINUX_PULSE")<br>it crashes:<br><pre class=code>
RtApiAlsa::getDeviceInfo: snd_pcm_open error for device (hw:0,0), Device or resource busy.
terminate called after throwing an instance of 'RtError'
  what():  RtApiAlsa::probeDeviceOpen: pcm device (hw:0,0) won't open for output.
Aborted
</pre><br><br>But that has nothing to do with the freeaudio ...<br><br><br><br>@ libasound.so.2<br>you use a line: if( !_alsa ) _alsa=dlopen( "libasound.so.2",RTLD_NOW );<br><br>Should that really be needed?<br>In all cases there should be a "libasound.so" which symlinks to the most current file. directly accessing "so.2" means you want that certain version.<br><br>As my /usr/lib/i386-linux-gnu/ does only contain libasound.so.2 but l have /usr/lib32/libasound.so I assume that I just misunderstood some principles. <br><br>Or vice versa - you try to load libasound.so first - in my case this is a symlink to the actual /usr/lib/i386-linux-gnu/libasound.so.2.0.0 (which got symlinked to libasound.so.2). If you really need version "2" shouldn't you just access it? Feel free to teach me some things concerning my question.<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1215813"></a>

<a name="1215814"></a>

<a name="1215815"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#32">[#32]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  In all cases there should be a "libasound.so" which symlinks to the most current file <br></div><br>Not really. .so without a numbered suffix is *mostly* only available via dev packages, but sometimes, some builds have both.<br><br>For example, TAO (an open-source corba library) does runtime linking with some of its shared objects, and these particular ones it assumes will be named without the numbered suffix (because it's easier than to guess the correct number, I assume).<br>But in general, when you are using shared objects, you've compiled against one (compile-time link), rather than are trying to runtime-link to one - in which case the majority of libraries only have shared objects with their numbered suffixes.<br><br>Or something like that ;-)<br><br>&lt;edit&gt;<br>The .so.2 (numbered suffix) generally refers to a versioned API release. You'll also notice that these are usually also symlinks to another .so with even more numbered suffixes - which is the actual versioned build of the specific main version release.<br>You are generally safe, I think, to point to the specific number, as that is your fixed ABI. If they released a .so.3, then you may assume that the API has changed in some way - in which case you'd probably need to re-write some of your code to use it. <br><br></td></tr></table><br>
<a name="1215836"></a>

<a name="1215871"></a>

<a name="1215872"></a>

<a name="1215873"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dawlane</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#33">[#33]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Brucey: Haven't tried it yet. But I would suggest some error reporting if there is a problem with dlopen and dlsym. One more thing. It is possible to load a library like libpulse-simple without the pulseaudio server running. When that happens you tend to get a <b>Assertion 's' failed</b> error. This is where it maybe an idea to look into seeing if a sound server is running on a system before calling any code for audio. It should bbe possible to use libproc/<a href="http://procps.sourceforge.net/" target="_blank">procps</a> to do this.<br><br><div class="quote"> What I do not understand 100%: If I compile eg. rtAudio - I have to have that *-dev-libs installed. If I now compile that module into a binary It does not need the *-nondev-libs at all - except I call specific functions from it.<br>So if my program knows (eg. using a config file) what functions to use and which to avoid - why should the binary need that library files.<br>Isn't there a way to make that work (or is that why "dynamic linking" would be needed)? <br></div>Not entirely sure what you're asking here. But...<br><div class="quote"> If I compile eg. rtAudio - I have to have that *-dev-libs installed <br></div>If you are compiling a library that requires external dependencies (i.e other libraries), then you need those external libraries development packages installed.<br><br><div class="quote">  If I now compile that module into a binary It does not need the *-nondev-libs at all - except I call specific functions from it.<br>So if my program knows (eg. using a config file) what functions to use and which to avoid - why should the binary need that library files. <br></div>Now this is the bit I'm having trouble understanding what your trying to ask. But to give you some understanding of the process of what is involved in running an application you should have a look at <a href="http://www.linuxjournal.com/article/6463" target="_blank">Linkers and Loaders</a> (OK it's an old article, but I don't think that it has changed that much) and <a href="http://en.wikipedia.org/wiki/Executable_and_Linkable_Format" target="_blank">Executable and Linkable Format</a>. And if possible read a copy of <a href="http://books.google.co.uk/books/about/Linkers_and_Loaders.html?id=Id9cYsIdjIwC&amp;redir_esc=y" target="_blank">Linkers &amp; Loaders by Jonh R. Levine</a>. I've got a copy but haven't read it in ages, so without a re-read. I could give you duff information.<br><br>And as Brucey has already mentioned about .so without a number and what the number suffix is etc. I shall fill in you in on a few other things.<br><br>The default 64bit debian/ubuntu/mint file structure.<br>First thing to note is that there is no /usr/lib32 and /lib32 or /libx32 (I would have to check on this last one, but I'm sure this one is for binaries that are built to take <a href="http://en.wikipedia.org/wiki/X32_ABI" target="_blank">advantage of the extras on a 64bit CPU</a>). Most if not all of these gets created when you install the g++/gcc-multi-lib package.<br><br>To handle multiple architectures, the libraries now get their own directory in /lib and /usr/lib. Each are named CPU_ARCHITECTURE-OS-gnu e.g i386-linux-gnu.<br><br>So as not to screw up the system for 64bit development on debian/ubuntu/mint 64bit and maintain a way to build 32bit binaries. It was necessary to install just the normal development packages. These usually have header files, docs, libraries and an .so file that gets installed to the directory of which ever is the default architecture. On a 64bit debian/ubuntu/mint this is /usr/x86_64-linux-gnu.<br><br>Now if you wanted to build a 32bit application you would think just to install the 32bit version of the development library. That would be a mistake because installing the 32bit development package removes the 64bit version. So the work around is to add .so links that point to those 32bit libraries found in those i386-linux-gnu directories. Note you can place those links in the root i386-linux-gnu directories.<br><br>Now as bmk is hard coded to search a number of directories one being /usr/lib32 it make sense to add .so links there that point to the duplicate 32bit libraries that would get installed in /usr/lib/i386-linux-gnu. This way the compiler linker wont miss them during the link process.<br><br>When your application runs on someone else machine; All the have to do is make sure that they have those base i386 libraries as mentioned at the bottom of my posts where the install scripts are. This in general isn't a problem for a 32bit distribution as most are already in stalled, but it can be on a 64bit distribution as only a few if any 32bit libraries get installed by default.<br><br>Now if you was using OpenSUSE/Fedora/Mageia, it's a different story as you can have both the 32bit and 64bit development libraries side by side with maybe the odd link if there is no 32bit development package. I don't know off hand how they deal with non x86 architecture as I haven't looked into it. But I have hit a snag with a couple of compilers on other distributions that didn't like compiling png.mod due to having MMX assembly in the files. <br><br></td></tr></table><br>
<a name="1215878"></a>

<a name="1215879"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#34">[#34]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for that really long elaboration at that topic (next time - do not put that much time into a posting for a to-lazy-to-google-it-himself-guy :D).<br><br>@what I tried to ask:<br>I thought an application is using external functions in a way that during compilation references to external things are kept as this: references or empty values. When starting the binary and "load external .so/.dll" that references are filled - so calling an external function is "redirected" to that function in that .so/.dll.<br>If that would be the case you could reference functions in your binary which are not available on the clients system. The "references" then just keep empty and the load-external-.so/.dll-function returns false.<br>The binary could handle that "not filled/returned false" with using another route (in this case another sound engine).<br><br>Using this the binary would not need that .so/.dll to run, it would only need it as soon as the binary wants to use that functionality. So I assumed this would be a nice thing to get rid of forcing people to install certain libs albeit they wont use that route (sound engine) at all.<br><br>Maybe I should more likely call it "modules",  on-demand-loaded, instead of parts of the binary externalized to other files.<br><br><br>@libasound.so<br>If you target the libasound.so.2 directly - shouldn't you search for it in the first step instead of libasound.so (as this more easily could be a different version)? - According to your explanation libasound.so is the fallback not vice versa.<br><br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1215901"></a>

<a name="1215920"></a>

<a name="1215923"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dawlane</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#35">[#35]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Thanks for that really long elaboration at that topic (next time - do not put that much time into a posting for a to-lazy-to-google-it-himself-guy :D). <br></div>Well I was bored. And I was thinking of copy &amp; Pasting those external links pages in full on that post. But there's only so much you can fit into a reply box. ;-)<br><br><div class="quote"> I thought an application is using external functions in a way that during compilation references to external things are kept as this: references or empty values. When starting the binary and "load external .so/.dll" that references are filled - so calling an external function is "redirected" to that function in that .so/.dll.<br>If that would be the case you could reference functions in your binary which are not available on the clients system. The "references" then just keep empty and the load-external-.so/.dll-function returns false.<br>The binary could handle that "not filled/returned false" with using another route (in this case another sound engine). <br></div>That first link to <a href="http://www.linuxjournal.com/article/6463" target="_blank">Linkers &amp; Loader</a> explains the concepts and process of what happens. As there are three ways to to link a library. Here's the basic gist of it.<br><br><b>static linking</b>: All the library functions are built directly into the final executable and all symbols are resolved. Static (.a) libraries are just compressed object files (.o) files.<br><br><b>dynamic linking at load/runtime time</b>: Here the compiler has added symbols to the final executable by treating the shared library like an object file, but missing the function addresses. But the runtime-linker needs to resolve these function symbol address when it loads the dynamic library or if it's already in memory. And if there are symbols in there that it cannot resolve because of a missing shared (.so) library on another computer, then it has a coronary.<br>  <br><b>dynamic linking during runtime</b>: With this method we tell the compiler to reserve some space to the executable by declaring some pointers that we will fill in later with the address of a function in a shared library file we are going to load our selves through use of dlopen and dlsym. This gives you the option to pick and choose your poison.<br><br>All of these methods require the development libraries or to be more precise the header files for compilation. In the last case more for just the data structures. <br><br></td></tr></table><br>
<a name="1215916"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#36">[#36]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm I seem having problems to understand your response as answer to my question - or to ask the question in a way that it is understandable.<br><br>"I thought" ... that an binary can get executed without an "dynamically linked" external file having to exist on the system. But when trying to run external functions it could crash (avoidable with checking for successful loading of the external file). Using this the modules could support multiple audio engines without the final binary needing all libraries installed.<br>I still assume that this is possible (else "dynamic linking during runtime" seems not that useful to me).<br>This is just the originating thought to the problem that up to now a binary needs an installed libpulse to make it runnable albeit you might use ALSA as sound basement.<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1215917"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#37">[#37]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, of course. You could, in theory not have any of the audio libraries on your system, and as long as you handled that fact in your app, it would still work. <br><br></td></tr></table><br>
<a name="1215925"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#38">[#38]</a></td></tr></table></td></tr><tr ><td class="posttext"> So my memory must cheat on me ... I really thought I had to install the libs to get my app working - albeit I just checked if setting that certain engine was possible... Maybe it is originating in the rtAudio and my brains just mixed in something 3rd-party-style :D.<br><br><br>Sorry for the offtopic-getting-trouble I created here... just back to business now.<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1215982"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dawlane</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#39">[#39]</a></td></tr></table></td></tr><tr ><td class="posttext"> Derron: If your using an audio library/engine that handles it's own loading of different sound systems. Then you don't have to worry about installing the other libraries. It's the job of who ever wrote that library that has to worry about checking what's on some ones system. How they do this could be either using dlopen or creating a hooks to running code (have a look at the ALSA plugin source code).<br><br>If you are looking for a specific audio system then you use one of the functions within that library to see if it gives you a device back and if it draws a blank, try the next until you hit the jack-pot or run it with no sound.<br><br>And on another note the new BlitzMax 1.50 audio is still broken and you still have to import libld. <br><br></td></tr></table><br>
<a name="1215983"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#40">[#40]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  And on another note the new BlitzMax 1.50 audio is still broken and you still have to import libld. <br></div><br>Well the "release notes" didn't mention anything other than bcc and maxgui :-p <br><br></td></tr></table><br>
<a name="1215984"></a>

<a name="1215986"></a>

<a name="1215990"></a>

<a name="1215991"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dawlane</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#41">[#41]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Brucey: The the alsa linking code works. But as I'm using a 64bit distribution where the sound server is PulseAudio. It crashed with a seg fault. Then I remembered that I hadn't installed libasound2-plugins:i386 on the system. And now it works. I will run the test application on a few other distributions tomorrow. And see what gives. <br><br></td></tr></table><br>
<a name="1215988"></a>

<a name="1215993"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dawlane</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#42">[#42]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Well the "release notes" didn't mention anything other than bcc and maxgui :-p <br></div>It's no bloody good just updating half a system is it. I blame Derron for not nagging him enough.;-)<br><br>Edit: Oops; it should have be libdl. <br><br></td></tr></table><br>
<a name="1215998"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#43">[#43]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  The the alsa linking code works. But as I'm using a 64bit distribution where the sound server is PulseAudio. It crashed with a seg fault. <br></div><br>Well, I think we'll need some better wrapper code to handle fallbacks to other drivers - and then perhaps a very default one which doesn't actually do anything? (you know, an empty driver which lets you call functions but doesn't play any sounds) <br><br></td></tr></table><br>
<a name="1216002"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dawlane</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#44">[#44]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think the problem was a ALSA&lt;&gt;PULSE issue as I got the same thing with skids original fix for ALSA. It needs to be tested on a system where ALSA is the sole sound implementation.<br>The error was generated when the ALSA library tried to load the ALSA plugin for PulseAudio.<br>You could get the same error with JACK being the sound server.<br>Once I installed it the 32bit ALSA plugins library it played nicely. <br><br></td></tr></table><br>
<a name="1216038"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#45">[#45]</a></td></tr></table></td></tr><tr ><td class="posttext"> Explains why it run "flawless" on my system - had that *:386 installed some how (could not remember to have this done by myself -- Mint 16 64Bit upgraded from 14).<br><br><br>@Nagging<br>Maaaan, I just wanted to write something myself. Mark was surprised when I asked if that "upcoming" patch (asked some days before) also tackles that "======" problem in comments. I cannot check if that directly connects to the quote-bug or if this is a more general problem. Seems Mark did not know what I am talking about which means he did not read the thread I linked for further details.<br>Maybe you (dawlane) could be the next starting a bug report :D. Just write your bug to the support-email, you will get an answer from Simon that he is relaying it to Mark.<br>Feel free to enjoy it if Mark sends you an email containing the email Simon wrote to him :D.<br><br><br>@brucey and fallbacks<br>rtAudio does already handle this with "RtApiDummy" (a class doing nothing :D). So you are not the first person thinking about that problem.<br>While such a fallback-stub-device should be a big problem for me to code - it should be just a matter of a hour of boredom and cracking your knuckles.<br><br>That "probes" of rtAudio should not be needed if you just could do "bool = OpenEngine(registeredEngineNumber, params)" and loop until bool=true<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1216048"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dawlane</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#46">[#46]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Explains why it run "flawless" on my system - had that *:386 installed some how (could not remember to have this done by myself -- Mint 16 64Bit upgraded from 14). <br></div>I did a clean install. On a 32bit distribution the asound2 plugins are there.<br><br><div class="quote"> Maybe you (dawlane) could be the next starting a bug report :D <br></div>There is a post by me in the bug reports about the fasm 'Out of Memory Fix' that mark is aware of. But I haven't seen a real good solution to solve this 'once in a while' reoccurring issue. Ideally it should be passed as a user accessible parameter via bmk.<br><br>Back to topic.<br>So far I've test the dlopen version under VBox with<br>Ubuntu 12.04, Linux Mint 13,16, Fedora 19, OpenSUSE 13.1, Mageia 3, Lubuntu 13.10 which by default looks like it's ALSA/JACK combo.<br>Only fly in the ointment is Debian 7 as the test application binary is incompatible with GLIBC (different versions). I will have to rebuild it on Debian and try again. <br><br></td></tr></table><br>
<a name="1216558"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#47">[#47]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'll patch my stuff for Pulse next, and then modify it for runtime linking. <br><br></td></tr></table><br>
<a name="1216578"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#48">[#48]</a></td></tr></table></td></tr><tr ><td class="posttext"> look... magical dust all over my shoulders... there must have been a fairy while I closed my eyes.<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1216582"></a>

<a name="1216583"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#49">[#49]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay, here's pulse audio using runtime linking :<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
// pulseaudiodevice.cpp
// sudo apt-get install libpulse-dev

#ifdef __linux

#include "freeaudio.h"

#include &lt;unistd.h&gt;
#include &lt;pulse/simple.h&gt;
#include &lt;pthread.h&gt;

extern "C" audiodevice *OpenPulseAudioDevice();

#include &lt;dlfcn.h&gt;

extern "C" {

static void *_pulse;
static pa_simple*(*pulse_pa_simple_new)(const char *, const char *, pa_stream_direction_t , const char *, const char *, const pa_sample_spec *, const pa_channel_map *, const pa_buffer_attr *, int *);
static void(*pulse_pa_simple_free)(pa_simple *);
static int(*pulse_pa_simple_write)(pa_simple *, const void *, size_t, int *);

int LoadPulse(){
	_pulse = dlopen( "libpulse-simple.so.0",RTLD_NOW );

	return _pulse!=0;
}

void InitPulse(){

	if( !_pulse ) return;
	
	pulse_pa_simple_new = (pa_simple* (*)(const char *, const char *, pa_stream_direction_t , const char *, const char *, const pa_sample_spec *, const pa_channel_map *, const pa_buffer_attr *, int *))dlsym(_pulse, "pa_simple_new");
	pulse_pa_simple_free = (void (*)(pa_simple *))dlsym(_pulse, "pa_simple_free");
	pulse_pa_simple_write = (int (*)(pa_simple *, const void *, size_t , int *))dlsym(_pulse, "pa_simple_write");
}

}

void *pulseaudiothread(void*dev);

#define LINUXFRAG 2048

struct pulseaudiodevice:audiodevice{
	pthread_t audiothread;
	int threadid;

	int running;
	int playing;
	int error;

	short *buffer;
	int buffersize;	//in bytes
		
	pa_simple *simple;
	
	static void *pulseaudiothread(void *arg){
		pulseaudiodevice* audio;
		audio=(pulseaudiodevice*)arg;
		audio-&gt;run();
		return 0;
	}
		
	int reset(){
	
		pa_sample_spec stereo16;
	
		running=0;
		playing=0;
		
		stereo16.format=PA_SAMPLE_S16LE;
		stereo16.rate=44100;
		stereo16.channels=2;

		simple=pulse_pa_simple_new(NULL,"freeaudio",PA_STREAM_PLAYBACK,NULL,"playback",&amp;stereo16,NULL,NULL,&amp;error);
		if (simple==NULL) return -1;

		mix=new mixer(LINUXFRAG);
		mix-&gt;freq=44100;
		mix-&gt;channels=2;

		buffer=new short[LINUXFRAG];
		buffersize=LINUXFRAG*2;

		pthread_attr_t	attr;
		pthread_attr_init(&amp;attr);

		running=1;
		threadid=pthread_create(&amp;audiothread,&amp;attr,pulseaudiothread,(void*)this);	
		return 0;
	}
	
	int close(){	
		int timeout;
		running=0;
		timeout=500;
		while (timeout-- &amp;&amp; playing){
			usleep( 10*1000 );
		}
		pulse_pa_simple_free(simple);
		return 0;
	}

	void run(){
		int data;
		int res;
		
		playing=1;
		while (playing &amp;&amp; running){
			mix-&gt;mix16(buffer);
			int err=pulse_pa_simple_write(simple, buffer, buffersize, &amp;error);
			if (err&lt;0) break;			
		}
		playing=0;
	}

};

audiodevice *OpenPulseAudioDevice(){
	if (LoadPulse()) {
		InitPulse();
		return new pulseaudiodevice();
	}
	return 0;
}

#endif

</textarea><br><br>in freeaudio.bmx, comment out the line :<br><pre class=code>
Import "-lpulse-simple"
</pre><br>and again, add this line :<br><pre class=code>
Import "-ldl"
</pre><br><br>The rest should be the same for the patched files. <br><br></td></tr></table><br>
<a name="1228706"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jur</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#50">[#50]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nice! I am now using the updated version of freeaudio.mod from  <a href="https://github.com/maxmods/pub.mod" target="_blank">https://github.com/maxmods/pub.mod</a> . I updated brl.freeaudioaudio.mod to have two drivers of TFreeAudioAudioDriver type for both supported devices (id= 0 for "pulse" and 1 for "ALSA"), so I can use the one i want with SetAudioDriver(). Both are working fine in Ubuntu.<br><br>I am planning to set the used sound driver for my application in this way:<br><br>if SetAudioDriver("pulse")=true --&gt; use that<br>elseif SetAudioDriver("ALSA")=true --&gt; use that<br>elseif SetAudioDriver("OpenAL")=true --&gt; use that<br>else --&gt; sorry, no sound for you<br><br>Am I too optimistic if I suppose this will work without crashes if pulse system or ALSA or something else is missing on a random distribution of Linux? <br><br></td></tr></table><br>
<a name="1228715"></a>

<a name="1228716"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#51">[#51]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think as soon as you try to set "pulse", the libs are tried to get loaded.<br><br>So this means: you have to change the order to "ALSA" -&gt; "Pulse" -&gt; "OpenAL" (think alsa is installed on more distros than pulse, and if pulse is installed most of the times alsa is there too :p).<br><br>Problem could arise from the fact, that your app might benefit from pulse (custom volume control for this specific application, network audio support ...). So you will end up configuring an user-customizable file stating which engine to try first (this is how I do it with maxmod2 and rtaudio) - if nothing is stated, try the one first you think the most use (I think it is PulseAudio).<br><br><br>PS: I also asked skidracer by email if he could add a data buffer fill-function to freeaudio so we could add streamed audio... but got no reply yet.<br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1228796"></a>

<a name="1228828"></a>

<a name="1228829"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#52">[#52]</a></td></tr></table></td></tr><tr ><td class="posttext"> Derron, I got your email. Was going to have a look at a solution this weekend. <br><br>First, I have located thread with previous experiments in freeaudio streaming. <a href="/posts.php?topic=81190" target="_blank">here</a> <br><br></td></tr></table><br>
<a name="1229085"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#53">[#53]</a></td></tr></table></td></tr><tr ><td class="posttext"> Derron, finally got a <a href="/codearcs.php?code=3129" target="_blank">freeaudio streaming example</a> working here. <br><br></td></tr></table><br>
<a name="1229105"></a>

<a name="1229107"></a>

<a name="1229108"></a>

<a name="1229109"></a>

<a name="1229112"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#54">[#54]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for reading my email - and coding something :D<br><br>Of course I tested your code - and listened to the finest music.<br>Now to the "problem" I still have:<br><br>Your code does the following:<br>- create buffer reference<br>- init sound with referenced buffer<br>- loop<br>--- fill that buffer<br>--- adjust positions<br><br>What "I" (and others) need and want - if I did not misunderstand the approaches:<br>- sound objects with "GetData:byte[](position:int)" functions<br>- sound drivers (freeaudio?) calling "GetData" if they need new "bytes" to play<br><br>This would then allow to plugin multiple GetData-Types - so to play an OGG file we rely on pub.OggVorbis to provide the byte[] we want. If we want an artificial sound (like your osci wave) we use another GetData.<br><br>So the main difference is: you push your data to freeaudio - but "I" need "pull data from audio".<br><br><br>Your approach will "work" too: if you create some kind of "soundmanager", running "Update" for each attached streamedAudio-object. You then of course have to run an update for the soundmanager on each loop in your app.<br>Yours is of course less "intrusive" (less changes to original source code) but of course adds another wrapper around the sound playback implementation in BlitzMax.<br><br>My approach/idea allows for "extending" TSound etc - so a beginner just needs to import a module/.bmx file and use the specific LoadXYZformatFile(path)-command (or even use the automatic dispatching service like redi did in maxmod) without that coder having to fiddle around with "soundmanager.Update()" or similar things.<br><br>edit:<br><br>within freeaudio.cpp there is <br><pre class=code>int sound::mix(int *b,int size)</pre><br>which is the function reading from the buffer. Maybe this direct buffer access should be wrapped in a "GetBuffer" - which then could be used to include the desired functionality (a call to the TSound's implementation of GetData(position, length) ).<br><br>As there are differing casts to the datablock - (short *) and (u8 *) there should be 2 Getters (I am not sure on this as my knowledge is limited a bit :P). <br><br>Maybe we could also use that "sound:peek"-Function which is not used in any module/code within brl.mod or pub.mod. I mean: peek tries to move to a specific position in a memory block - but it could also be extended to move to a specific position in a stream -&gt; make that "extendable" so the implementation in BlitzMax could take override behaviour.<br><br>Another option would be to have a function which is called as soon as a "buffer block" reaches its end. So instead of "GetBuffer" we just inform some object that the cursor in the block reached the end. So this "call" could then reset the cursor to the start of the block (loop mode) and/or refill the block with new data (stream).<br>This would mean modifying the calls in freeaudio.cpp:<br><pre class=code>if (status&amp;LOOPING) pos64-=len64;else return 1;</pre><br>to add the "inform others call".<br><br>Just made me seeing the "STREAMING" flag in the code again ... still don't know if this is actually doing somehting already.<br><br>/edit<br><br>Ideas/Meanings/rants ?<br><br><br>PS: don't feel attacked by my post, I am glad you paved _one_ way to do it for me (but as stated, not that "general" that it eases use for everyone).<br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1229111"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#55">[#55]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> So the main difference is: you push your data to freeaudio - but "I" need "pull data from audio". <br></div><br>I knew you were going to say that :-p<br><br>But I think coding it in 'Max is not the answer (re GetData).<br>All this low-level stuff wants to be wrapped up into some C/C++ somewhere, so that, for example, your PlaySound can be either playing something from memory, or via a stream thru an Ogg stream loader.<br><br>At the end of the day, you don't (want to?) care about *how* the sound is playing (streamed or otherwise), you just want to Play it. <br><br></td></tr></table><br>
<a name="1229113"></a>

<a name="1229114"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#56">[#56]</a></td></tr></table></td></tr><tr ><td class="posttext"> I just edited my posting to reflect some additional thoughts.<br><br>@brucey<br>You know me well... too well :D<br><br>@wrapping<br>That is why I suggested to have only a simple function in TSound getting called as soon as the buffers current position reaches the end of the buffer. The "stub" TSound just does nothing does nothing - because freeaudio already moves the "current buffer pointer" back to 0 if the LOOPING-bool is true and without loop mode, the sound is "finished" and ready to get released.<br><br>The extended TSound (created with streaming background) then just uses this function to refill the buffer with "new data".<br><br>BUT ... if extending freeaudio to do something, you also could rewrite TSound to allow "streaming" per se (independend from the implementation for ogg, mp3 or whatever).<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1229119"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#57">[#57]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't agree that the call back needs to be done by FreeAudio. It does not make sense for the mixer which itself is called typically from a high priority realtime scheduled thread at a high frequency to be "pulling data".<br><br>Processor intensive codecs with disk access delays should fill larger buffers in a less repetitive manner on their own threads or via a polled interface. <br><br></td></tr></table><br>
<a name="1229120"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#58">[#58]</a></td></tr></table></td></tr><tr ><td class="posttext"> So in other words you would prefer some kind of "SoundManager" managing the "streamed audio objects" (and checking positions, buffers etc) instead of calling an extendable stub each update cycle.<br><br>I am just asking to see if I got it "right".<br><br>My concerns were only directed to beginners just want to have "streamed audio" while I "of course" am able to write a manager taking care of its children (...or maybe I tend to think I am able to do it :D). Especially as BlitzMax targets Game Developers with providing wrappers for many things to easy usage.<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1229144"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#59">[#59]</a></td></tr></table></td></tr><tr ><td class="posttext"> @skidracer<br><br>this afternoon I tried to generalize your approach (making a basic sound type and so on) ... It seemed to work, but randomly crashed (segfaults) or gave an malloc error about linked list duplicates or so (do not remember).<br><br>I thought it is because of wrong types (int, pointers) when making it superstrict but I cut it down to use a "buffer inside a type instance".<br>It does not segfault everytime ... eg. I tested it now while posting here ... no problems (all of my test codes, the simple and the more complex ones).<br>To increase chances of segfaulting to 100% I would have to add "flip" right before that "delay 50". It then segfaults somewhere at the end of the buffer (+- 1k)<br><br>I of course added an graphics call to initialize a window (and an abortion key) so it is easier to code from an IDE (not compiling from my terminal).<br><br><br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
' freestream.bmx
' mono 8 bit streaming example for 

Strict
Import pub.freeaudio

Const FRAG=1024

Print "freestream is free streaming..."

fa_Init(0)	' brl.freefreeaudio usually does this

Type TTestAudio
	Field buffer:Byte Ptr

	Method New()
		buffer = New Byte[FRAG*8]
	End Method
End Type
local audio:TTestAudio = new TTestAudio

Local writepos

Local sound
Local channel

sound=fa_CreateSound( FRAG*8,8,1,44100,audio.buffer,$80000000)
Print "Sound:"+sound

channel=fa_PlaySound( sound, FA_CHANNELSTATUS_STREAMING ,0)
Print "PlaySound:"+channel

Local streaming
Local lfo#
Local osc1#

Graphics 800,600

While not Keyhit(KEY_ESCAPE)
'	Print "Status:"+fa_ChannelStatus( channel )	
	Local readpos=fa_ChannelPosition( channel )
	Local write=readpos+FRAG*4-writepos
	Local frags=write/FRAG	
	While frags&gt;0	
		Local pos=writepos Mod (FRAG*8)
		Print "Write to "+writepos + " pos:"+pos
		For Local f=0 Until frag				
			Local t=writepos+f	
			lfo=Sin(0.001*t)
			osc1=Sin(t*(lfo+2))
			audio.buffer[pos+f]=128+10*lfo*osc1
		Next
		writepos:+FRAG
		frags:-1
	Wend
	
	If Not streaming And writepos&gt;=FRAG*4
		fa_SetChannelPaused( channel, False )
		streaming=True
	EndIf
	
	Print "."	

	Delay 50
Wend
</textarea><br><br><br>If adding graphics + flip straight on your code (so no type-property) it works without trouble. May it be some kind of Garbage Collection?<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1229172"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#60">[#60]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ron, what platform are you on? <br><br></td></tr></table><br>
<a name="1229174"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#61">[#61]</a></td></tr></table></td></tr><tr ><td class="posttext"> Linux ;-) <br><br></td></tr></table><br>
<a name="1229175"></a>

<a name="1229391"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#62">[#62]</a></td></tr></table></td></tr><tr ><td class="posttext"> Eeek, I'm not sure I'm ready to go back there :)<br><br>Here is some code tested on MacOS that will make your ears bleed on various MouseY values.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
' freestream.bmx

Strict

Framework brl.blitz
Import brl.glmax2d
Import pub.freeaudio
Import brl.standardio

Type TFreeStream

	Const FRAG=1024

'fa_Init(0)

	Field buffer:Byte[FRAG*8]
	Field sound
	Field channel
	Field writepos
	Field streaming
	
	Method New()
		fa_Init(0)
		sound=fa_CreateSound( FRAG*8,8,1,44100,buffer,$80000000)
		Print "Sound:"+sound
		channel=fa_PlaySound( sound, FA_CHANNELSTATUS_STREAMING ,0)
		Print "PlaySound:"+channel
	End Method
	
	Method Poll()
		Local t
		Local lfo#
		Local osc1#
	
	'	Print "Status:"+fa_ChannelStatus( channel )	
		Local readpos=fa_ChannelPosition( channel )
		Local write=readpos+FRAG*4-writepos
		Local frags=write/FRAG	
		While frags&gt;0	
			Print "Write to "+writepos
			Local pos=writepos Mod (FRAG*8)
			For Local f=0 Until frag				
				t=writepos+f	
				lfo=0.0001*MouseY()*Sin(t*2)
				osc1=Sin(t*(lfo+2))
				buffer[pos+f]=128+10*osc1
			Next
			writepos:+FRAG
			frags:-1
		Wend
		
		If Not streaming And writepos&gt;=FRAG*4
			fa_SetChannelPaused( channel, False )
			streaming=True
		EndIf
	End Method	
End Type

SetGraphicsDriver GLMax2DDriver()

Print "HELLO"

Graphics 640,480

Local FreeStream:TFreeStream

FreeStream=New TFreeStream

While Not KeyHit(1)
	FreeStream.Poll
	Cls
	Flip
Wend

End

Rem

Const FA_CHANNELSTATUS_FREE=0
Const FA_CHANNELSTATUS_STOPPED=1
Const FA_CHANNELSTATUS_SINGLESHOT=2
Const FA_CHANNELSTATUS_LOOPING=4
Const FA_CHANNELSTATUS_STREAMING=8
Const FA_CHANNELSTATUS_PAUSED=16

Function fa_Reset( audiodevice )
Function fa_Close()
Function fa_CreateSound( length,bits,channels,hertz,samples:Byte Ptr=Null,looping=False )
Function fa_WriteSound( sound,samples:Byte Ptr,length )
Function fa_FreeSound( sound )
Function fa_AllocChannel()
Function fa_FreeChannel( channel )
Function fa_PlaySound( sound,paused_flag,channel )

Function fa_StopChannel( channel )
Function fa_ChannelStatus( channel )
Function fa_ChannelPosition( channel )

Function fa_SetChannelPaused( channel,paused )
Function fa_SetChannelVolume( channel,volume# )
Function fa_SetChannelRate( channel,pitch# )
Function fa_SetChannelPan( channel,pan# )
Function fa_SetChannelDepth( channel,depth# )

EndRem
</textarea> <br><br></td></tr></table><br>
<a name="1229184"></a>

<a name="1229185"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#63">[#63]</a></td></tr></table></td></tr><tr ><td class="posttext"> First of all I have to confess: yes... I played some time with your mouse-sound :D.<br><br>I guess the change from "buffer:Byte Ptr" to "buffer:Byte[]" did the trick ... I just changed line by line until I saw what you changed there....<br><br>This explains why my segfaults happened randomly ... and once my linux stopped responding :D. And Mac...hmm I just use it for compiling the binary for the &lt;= 2 players of our current users using this OS, compared to minimum of 4 playing with linux ... so windows is still 98+%.<br><br><br>Like I said before... I am not the wisest man on earth concerning pointers and other thingies ... to avoid such trouble I like SuperStrict (or other modes not allowing to pass variables with the wrong/not exact - type).<br><br>Thanks for clarifying the problematic part - and feel free to update your entry in the code archives (byte ptr -&gt; byte[]).<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1229193"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#64">[#64]</a></td></tr></table></td></tr><tr ><td class="posttext"> New question:<br><br>In your example you create a "mono sound" - how to align the bytes for a strereo output?<br><br>I tried the most simple way and assumed two channels are just done this way:<br>buffer[i] = valueA_Channel1<br>buffer[i+1] = valueA_Channel2<br><br>The sound stuttered...<br><br><br>For playing streamed ogg (ignore the missing filestream-offset-reset)<br>- created a Byte Ptr for the ogg file (ogg = Decode_Ogg(...)), information was read correctly<br>- filled the buffer (aka replaced your for loop) with  Read_Ogg(ogg, buffer, frags)<br><br>The only thing I was able to listen then, was again a stuttering and seemingly "repeated"  sound. The buffer contained varying data, so the "reading" was done too.<br><br><br><br>So in short: how to generate stereo sound?<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1229211"></a>

<a name="1229226"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#65">[#65]</a></td></tr></table></td></tr><tr ><td class="posttext"> Good, glad that is fixed. Sorry about casting the byte array to a pointer and not retaining a reference to the array, my bad. GC 101...<br><br>I have added a 16 bit stereo example to the <a href="/codearcs.php?code=3129#comments" target="_blank">code archive</a>, please feel free to post feedback there. <br><br></td></tr></table><br>
<a name="1229232"></a>

<a name="1229233"></a>

<a name="1229236"></a>

<a name="1229276"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#66">[#66]</a></td></tr></table></td></tr><tr ><td class="posttext"> Your new code works.<br>But this isn't compatible with the TAudio and TAudiosample-approach isn't it ?<br><br>They (TAudio...) use a "memory blob" ( MemAlloc() ) to store their data. Also your sound output has a low volume - compared to my loud cracks/noise I get when trying to wire it with the ogg_decode-data. May the data be misinterpreted or is missing some information (like you only give frequency/tone but not volume).<br><br><br>EDIT: <br>Ok, I got some ogg sound playing... but stuttering (sound silence sound silence - each only some milliseconds). Also the sound seems "slower" (think the silence is the reason).<br><br>EDIT2:<br><br>Another Ok, fiddled together an example - to play that ogg file, I needed to switch back to buffer:Byte Ptr, allocated by MemAlloc().<br>This then does not work nicely with the sine-wave-code of you (@skidracer).<br><br>Also I recognized that a "fa_SetChannelVolume(faChannel, 255)" is needed to get a playback at "normal volume".<br><br>To run the following code, you need to adjust "uri" to point to a local OGG file.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
SuperStrict
Import pub.freeaudio
Import Pub.OggVorbis



'base class just playing some simple tone
Type TDigAudio
	Field buffer:Byte Ptr
	Field bufferSize:int = 0
	Field faSound:int
	Field faChannel:int
	Field writepos:int
	Field streaming:int
	Field bits:int = 16
	Field freq:int = 44100
	Field channels:int = 2
	Field format:int = 0

	Field bufferFragmentsCount:int = 1024


	Method Create:TDigAudio()
?PPC
		format = SF_STEREO16BE
?X86
		format = SF_STEREO16LE
?

		bufferSize = GetBufferLength() * 8 * BytesPerSample[format]
		buffer = MemAlloc(bufferSize)

		'$80000000 = "dynamic"
		'dynamic sounds stay in app memory
		local loop:int = $80000000

		channels = ChannelsPerSample[format]
		bits = 8 * BytesPerSample[format] / channels

		faSound = fa_CreateSound(bufferFragmentsCount * 8, bits, channels, freq, buffer, loop)

		Print "DigAudio created : bufferSize="+bufferSize + " bits="+bits + " bufferLength="+GetBufferLength()
		return Self
	End Method



	Method Play:int()
		faChannel = fa_PlaySound(faSound, FA_CHANNELSTATUS_STREAMING, 0)
		fa_SetChannelVolume(faChannel, 255)
		Print "DigAudio play"
	End Method


	Method GetBufferLength:int()
		return bufferFragmentsCount * 8
	End Method


	Method GetPosition:int()
		return fa_ChannelPosition(faChannel)
	End Method


	Method GetBufferPosition:int()
		return GetPosition() + GetBufferLength()/2 - writepos	
	End Method


	Method Delete()
		fa_FreeSound(faSound)
		if bufferSize &gt; 0 then MemFree buffer
	End Method
	

	Method Eof:int()
		return Not streaming And writepos &gt;= GetBufferLength()/2
	End Method


	Method FillBuffer:int(offset:int, length:int = -1)
		if length &lt; 0 then return False
		
		Print "StreamPos="+writepos + " BufferPos="+offset

rem
		'THE FOLLOWING CODE DOES _NOT_ WORK WITH BUFFER = BYTE PTR 
		'fill with sine
		For Local f:int = 0 Until length
			Local t:int = offset + f	
			local lfo# = Sin(0.001*t)
			local osc1# = Sin(t*(lfo+2))

			Local l16:int = $ffff &amp; Int(1000*lfo*osc1)
			Local r16:int = $ffff &amp; Int(2000*Sin(t))
	
			buffer[offset + f] = L16|(R16 Shl 16)
		Next
endrem

		'fill with some simple loud noise
		local startBuf:Byte Ptr = buffer + offset
		for local f:int = 0 until length
			startBuf[0] = 0
			startBuf[1] = 255  * sin(0.01 * f)
			startBuf[2] = 0
			startBuf[3] = 100
			startBuf :+ 4
		Next

	End Method


	Method Update()
		Local bufferFragmentsToLoad:int = GetBufferPosition() / bufferFragmentsCount	
		Local pos:int = 0

		'looping this way (in blocks of 1024) means that no "wrap over"
		'can occour (start at 7168 and add 2048 - which wraps over 8192)
		While bufferFragmentsToLoad &gt; 0
			' *8 means 8*1024 is maximum, then starts with 0 again
			pos = writepos Mod GetBufferLength()
			FillBuffer(pos, bufferFragmentsCount)

			writepos :+ bufferFragmentsCount
			bufferFragmentsToLoad :- 1
		Wend


		if Eof()
			fa_SetChannelPaused( faChannel, False )
			streaming = True
		endif
	End Method
End Type


'from brl.mod/oggloader.mod/oggloader.bmx
'they are "private" there... so this is needed to expose them
Type TOggStreamLoader
	Function readfunc:int( buf:Byte Ptr, size:int, nmemb:int, src:Object )
		Local bytes:int = TStream(src).Read(buf,size*nmemb)
		Return bytes/size
	End Function

	Function seekfunc:int(src_obj:Object, off0:int, off1:int, whence:int)
		Local off:int
		Local src:TStream=TStream(src_obj)
	?X86
		off=off0
	?PPC
		off=off1
	?
		Local res:int = -1
		Select whence
			Case 0
				res=src.Seek(off)			'SEEK_SET
			Case 1
				res=src.Seek(src.Pos()+off)	'SEEK_CUR
			Case 2
				res=src.Seek(src.Size()+off)	'SEEK_END
		End Select
		If res&gt;=0 Return 0
		Return -1
	End Function

	Function closefunc(src:Object)
	End Function

	Function tellfunc:int(src:Object)
		Return TStream(src).Pos()
	End Function
End Type



Type TDigAudioOgg extends TDigAudio
	Field stream:TStream
	Field ogg:Byte Ptr

	Method Create:TDigAudioOgg()
		Super.Create()

		return Self
	End Method


	Method CreateWithFile:TDigAudioOgg(uri:object)
		local fileChannels:int = 2
		stream = OpenStream(uri)

		Local samples:int,channels:int,freq:int
		ogg = Decode_Ogg(stream, ..
				TOggStreamLoader.readfunc, ..
				TOggStreamLoader.seekfunc, ..
				TOggStreamLoader.closefunc, ..
				TOggStreamLoader.tellfunc, ..
				samples, channels, freq ..
			)
		If Not ogg Return Null

		print "Loaded Ogg. Samples="+samples+" channels="+channels+" freq="+freq
			
		Create()
		return self
	End Method


	Method FillBuffer:int(offset:int, length:int = -1)
		if length = -1 then return False
		Print "StreamPos="+writepos + " BufferPos="+offset

		'another pointer pointing at the buffer adjusted by our offset
		'so the decoded ogg data is read into the memory starting at
		'this position 
		local bufAppend:Byte Ptr = buffer + offset
		'try to read the oggfile at the current position
		Local err:int = Read_Ogg(ogg, bufAppend, length)
		if err then Throw "Error streaming from OGG"

		'close: - or reset ogg file stream position
		'Read_Ogg( ogg,Null,0 )
	End Method
End Type



fa_Init(0)

Local uri:string = "/home/ronny/Arbeit/Programmieren/Projekte/Apps/TVTower.WorkingCopy/TVTower.git/res/music/Light banjo.ogg"
'local myAudio:TDigAudio = new TDigAudio.Create()
local myAudio:TDigAudioOgg = new TDigAudioOgg.CreateWithFile(uri)
myAudio.Play()

Graphics 800, 600

SetColor 255,255,255
While not KeyHit(KEY_ESCAPE)
	myAudio.Update()

	'commenting this out, gets rid of the segfault
	Flip
	Delay(50) 
Wend
</textarea><br><br><br>So in its current state I have trouble of playing back random noise or ogg files ... both have those gaps in it ... the more "caching" I do (the bigger the "read blocks") the longer the sound gets - but the silent gaps increase in length too.<br>Somehow I think that the "fa_***" things are borked - or expecting something I do not provide to them.<br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1229390"></a>

<a name="1229393"></a>

<a name="1229394"></a>

<a name="1229395"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#67">[#67]</a></td></tr></table></td></tr><tr ><td class="posttext"> I posted  a working ogg stream in the code archive. On my first attempt the TStream was being collected as I forgot to retain a reference leading to some very odd crashes. <br><br>It sure is fun getting back into BlitzMax, I forgot how snappy it is.<br><br>I was just reading about webm spec, OGG is used for audio and VP8 for video. I am curious how complex a task to have VP8 on BlitzMax. <br><br></td></tr></table><br>
<a name="1229425"></a>

<a name="1229432"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#68">[#68]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks skidracer,<br><br>Now I will have to check what the difference to my code is (I was on my way to write it to load "chunks" instead of fragments, so I have more control about cache states) ... but yet I have to make it work.<br><br>Was already sad not to see a posting this morning (6hrs ago)... thought I have to wait like a child before christmas :p.<br><br>Thanks again.<br><br>Edit:<br>Problematic part was the length of the offset + length of the to-read-block<br><br>so from<br><pre class=code>
local bufAppend:Byte Ptr = buffer + offset
'try to read the oggfile at the current position
Local err:int = Read_Ogg(ogg, bufAppend, length)
</pre><br><br>to<br><pre class=code>
local bufAppend:Byte Ptr = buffer + offset*4
'try to read the oggfile at the current position
Local err:int = Read_Ogg(ogg, bufAppend, length*4)
</pre><br><br><br>So you can use int[] or "Byte Ptr = MemAlloc()"... think yours saves to get rid of the memory on delete - or is it just missing?<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1229572"></a>

<a name="1229573"></a>

<a name="1229574"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#69">[#69]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok ... rewrote my code so it tries to utilize as much of existing code as possible (so adjustments to existing code in projects can be minified) so I use TAudioSample/TChannel and TSound.<br><br>When exiting the loop (to exit the app) the sound is played for 2-3 secs (seems to be some kind of a freeAudio-buffer).<br><br>This does not happen if you use your code -  because your code does not close free audio.<br><br>Put an "fa_Close" after your loop (and make the loop exitable) to see what I mean.<br><br>If you use "SetAudioDriver("FreeAudio")" instead of "fa_init(x)" you will have the same effect, as the freeaudiodriver runs "fa_close" when exiting.<br><br><br>To avoid the "repeating sound" (the small buffer is repeated over and over) you have to manually stop the channel after the loop:<br><br><pre class=code>
fa_StopChannel(TFreeAudioChannel(myAudio.currentChannel).fa_channel)
fa_FreeChannel(TFreeAudioChannel(myAudio.currentChannel).fa_channel)
fa_FreeSound(TFreeAudioSound(myAudio.sound).fa_sound)
myAudio = null
</pre><br>Other lines (freechannel, freesound) do not help and do not change the output if the channel isn't stopped.<br>If you stop the channel with the above code - you still have to wait some seconds until the app really exits (you just do not hear sound output any longer).<br><br>-&gt; Using "SetAudioDriver" (which is the common approach) makes it hang on exit, because "fa_close" is called when an app exit is triggered.<br> <br><br><br>Another mind binder is the following thing: If I use "CreateAudioSample" and then utilize that samples "samples pointer" as buffer ... it plays the sound fine -  except for the very first milliseconds, so you can hear a light cracks/random noise at the begin. Therefore I had to keep the "buffer" (int array) and use "CreateStaticAudioSample" to refer to that buffer - cracking is gone.<br><br>All in all I tried to get rid of "fa_***"-functionality/dependencies but "LoadSound(audiosample, flags)" does not route that flags to the fa_CreateSound()-command. So there seems no "anonymous way" to tell fa_CreateSound() to use that dynamic flag value of $80000000. To add that functionality would add the need to modify the module and this is what I wanted to minify too (should work on "vanilla" blitzmax - except maybe that freeaudio-patches).<br><br>Another problem: a basic TChannel does not provide "Position()", which is needed to see how far the channel has played already (I already changed calculation because a channel can still "play" while streaming is "paused")). The only other thing I can think of is: check each update, how much time is gone - and if the channel is "playing", add that time to a counter. BUT ... if you pause the channel between two update/poll-cycles, you will skip things. So this adds another dependency I cannot get rid of (to make the whole implementation free of dependencies like FreeAudio).<br><br><br>I will test and adjust some things the next days (so it might replace the rtAudio-code in my project) and then post a github link to the complete code (zlib/libpng).<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1229588"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#70">[#70]</a></td></tr></table></td></tr><tr ><td class="posttext"> Why would you want to use BRL TAudio types? <br><br></td></tr></table><br>
<a name="1229596"></a>

<a name="1229597"></a>

<a name="1229600"></a>

<a name="1229601"></a>

<a name="1229602"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#71">[#71]</a></td></tr></table></td></tr><tr ><td class="posttext"> To make them interchangeable.<br><br><br>I think people have codes containing "TSound" and "TChannel" (eg. for crossfading or mixing of streamed and nonstreamed sounds - or other possibilities) - to make the underlaying code independend from being able to stream things, I wanted to reuse that types. Keeping functionality intact (SetChannelVolume(channel), ...) is also a nice benefit.<br>This also enables to more easily exchange it for another underlaying sound engine (if there is one).<br><br><br>Nonetheless that sound bug is a bit annoying:<br>open your oggstream-sample file and append "<br>fa_Close" to the end. Execute it, and try to exit the app.<br><br><pre class=code>
Print "freestream is free streaming..."
Graphics 800, 600
While not KeyHit(KEY_ESCAPE)
	Cls
	ogg.Poll
	Print "."	
	Flip
Wend

fa_Close
</pre><br><br>You will recognize some kind of "waiting" until the app really exits. <br><br><br>edit:<br><pre class=code>
int BBCALL fa_Close(){
	if (io) delete io;
	if (audio) audio-&gt;close();
	audio=0;
	io=0;
	return 0;
}
</pre><br>commenting out that "if (audio) audio-&gt;close();" makes exiting snappy again. So there must be some  action in that close() function.<br>"audio" is "audiodevice" ... so it should call "audiodevice-&gt;close()". Audiodevice has this defined:<br><br><pre class=code>
// virtual OS dependent interface
	virtual int reset()=0;
	virtual int close()=0;
</pre><br><br>So this means, close() is defined somewhere else -&gt; in the alsa/pulseaudio/files .. voila, there is a close function in each of them.<br><br>alsadevice.cpp<br><pre class=code>
	int close(){
		int		timeout;
		running=0;
		timeout=5;
		while (timeout-- &amp;&amp; playing) sleep(1);
		return 0;
	}
</pre><br><br>This means: it waits up to 5 seconds for channels to finish playing... ahem ... why should it do that? I want to exit an app - and this piece of code says "no, first wait until all channels finished playing". Is there a reason to do that this way?<br><br><br>PS: in dsounddevice.cpp there is another comment:<br><pre class=code>
timeout=20;	//100ms timeout
while (timeout-- &amp;&amp; playing) {
	Sleep(5);
}
</pre><br>Means: using DirectX "S"leep is used (param is milliseconds) so you wait up to 100 ms (which is acceptable).<br><br><br>pulseaudio.cpp waits 5 seconds too (10000microseconds * 500 = 5.000.000 microseconds = 5 seconds)<br><br><pre class=code>
timeout=500;
while (timeout-- &amp;&amp; playing){
	usleep( 10*1000 );
}
</pre><br><br>Somehow I think there was one mixing up timeout times...<br><br><br>EDIT 2:<br>to patch things up (to make them similar to dx on windows and coreaudio on mac):<br><br>alsadevice.cpp:<br><pre class=code>
	int close(){
		int	timeout;
		running=0;
		timeout=20;
		while (timeout-- &amp;&amp; playing) {
			//sleep(1);
			//1 ms = 1000 microseconds  -&gt; 5000 microseconds = 5 ms
			usleep(5*1000);
		}
		return 0;
	}
</pre><br><br><br>pulseaudio.cpp<br><pre class=code>
	int close(){
		int timeout;
		running=0;
		timeout=20;
		while (timeout-- &amp;&amp; playing){
			usleep(5*1000);
		}
		pa_simple_free(simple);
		return 0;
	}
</pre><br><br>ossdevice.cpp<br><pre class=code>
	int close(){	
		int	timeout;
		running=0;
		timeout=20;
		while (timeout-- &amp;&amp; playing) usleep( 5*1000 );
		::close(fd);
		return 0;
	}
</pre><br><br><br>But question keeps the same: why do we wait at all ? (in the coreaudio file there is no while-waiting-loop at all).<br><br>PS: that waiting is independend from our streaming experiments, just have a look how samples/digesteroids exits in linux (disable full screen mode to make it more clearly recognizeable).<br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1229678"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#72">[#72]</a></td></tr></table></td></tr><tr ><td class="posttext"> The code you are listing is using the running variable to communicate with the mixer thread. <br><br></td></tr></table><br>
<a name="1229698"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#73">[#73]</a></td></tr></table></td></tr><tr ><td class="posttext"> While all wait for "not playing" this does not explain why "win32" waits up to 100ms, OSX no time at all, and Linuxes 5 seconds.<br><br>In my case - and like said WITHOUT the streaming portion (eg. compile samples - Digesteroids) this leads to a waiting time of 5 seconds after I quit an app.<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1229702"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#74">[#74]</a></td></tr></table></td></tr><tr ><td class="posttext"> Reviewing pinned ALSA and Pulse, pulse looks ok, ALSA looks bugged as it should mix until running goes 0 then set playing to 0 which it doesn't. <br><br></td></tr></table><br>
<a name="1229711"></a>

<a name="1229712"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#75">[#75]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm, maybe my postings got too long so you did not read what I wanted to express:<br><br>- Direct Sound: waits <b>100ms</b> or until nothing is played anylonger<br>- OpenSound: does not wait, just calls a function<br><br>- ALSA/PulseAudio/OSS: wait <b>5 seconds</b> or until nothing is played anylonger<br><br><br>In my environment (Linux Mint, PulseAudio) that 5 seconds have to be gone until the app exits - so "playing" is not reset correctly.<br>I assume this is what you saw as bug (does not set playing 0).<br><br>Even if you fix that mistake, I cannot imagine why a "5 seconds" waiting time (in the case of something failing - like it does now) is needed while DirectSound is happy with 100ms.<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1229743"></a>

<a name="1229800"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#76">[#76]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmmm I cannot read your response (do you have deleted it and the board did not trigger correctly?)<br><br>Thread overview<br><img src="http://abload.de/img/borkedboard1tfjvb.png"><br><br>Current Thread<br><img src="http://abload.de/img/borkedboard2j4kmn.png"><br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1229801"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#77">[#77]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Hmmm I cannot read your response.. <br></div><br>It appears to have disappeared - perhaps deleted by skid himself?<br>It was there earlier, because I read it! :-)<br>(no, I can't remember all that it said) <br><br></td></tr></table><br>
<a name="1229806"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#78">[#78]</a></td></tr></table></td></tr><tr ><td class="posttext"> Maybe I get a response this time ... last time I mentioned this odd behaviour (overview lists a post, thread view does not) was too a missing post of skidracer. Maybe "content deleted"-posts are better in this case (except the forum gets rid of that bug of exposing the former existence of a post).<br><br>Just hope it was a kind post not containing swears about my stubbornness regarding some timeout values :D<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1229814"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >degac</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#79">[#79]</a></td></tr></table></td></tr><tr ><td class="posttext"> Skid's comment was something about the fact that is not a mistake but a bug (or something about). <br><br></td></tr></table><br>
<a name="1229850"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#80">[#80]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, sorry, I won't do that again. I will look at what is needed to fix the shutdown issues this weekend. <br><br></td></tr></table><br>
<a name="1229892"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#81">[#81]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks in advance.<br><br>This is the current code of my AudioStream-code:<br><br>(Link is to the explicit commit of that file, so a specific revision of the file)<br><a href="https://github.com/GWRon/Dig/blob/3ea47f1e85680dc4403c490751fdd069a2d28047/base.sfx.soundstream.bmx" target="_blank">Github:Dig:base.sfx.soundstream.bmx</a><br><br><br>Problematic part is: the Update of the streams has to take place "threaded". To make it threaded without enforcing the users to "build threaded" the code should use some "c" which automates creation of a phtread etc. . So something like:<br><br>- add sound: add sound ref to a manager/collection<br>- threaded update of manager/collection<br>- remove sound - delete() : remove ref from manager/collection<br><br>PS: I know my code surely has some issues contained. A "crossfading mixer" could be found in the file "base.sfx.soundmanager.bmx" (utilizing 2 channels and adjusting volume according to given commands). As you cannot crossfade the same stream using the same buffer the crossfader automatically "clones" a stream if both to-play-streams are the "same". Ideas how to circumvent this? I think things like "multiple buffers" per stream object could do it but add overhead.<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1230960"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#82">[#82]</a></td></tr></table></td></tr><tr ><td class="posttext"> Back on topic. I think Mark has a point in that other thread, backing OpenAL seems the best solution for Linux. <br><br>Brucey, I'm interested how you rate it. <br><br></td></tr></table><br>
<a name="1233227"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#83">[#83]</a></td></tr></table></td></tr><tr ><td class="posttext"> Unfortunately I don't have much experience with it, although I gather a good amount of games (on Steam, for example), like to use it. Which makes me think it is a fairly stable platform for Linux audio.<br><br>irrklang has recently gone 64-bit across platforms which is interesting.<br>And BASS supports ARM Linux, which is quite exciting :-)<br><br>I need to try to find some time to play around with the latest OpenAL-Soft, and see how it goes.<br><br>I was playing around with my "ng" brl and pub mods the other day, and have it working so that it "falls back" to ALSA if PulseAudio isn't available.<br>I wonder if OpenAL-Soft handles that better though. I see it can be built with support for many different backends. <br><br></td></tr></table><br>
<a name="1233245"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dawlane</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#84">[#84]</a></td></tr></table></td></tr><tr ><td class="posttext"> Some distributions have problems with OpenAl and PulseAudio installed with certain hardware configurations. But some say that OpenAL-Soft is faster than the Creative Labs offering on Windows. Rumour has it that Creative dropped OAL as they could not successfully use hardware acceleration. <br><br></td></tr></table><br>
<a name="1233255"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#85">[#85]</a></td></tr></table></td></tr><tr ><td class="posttext"> BTW: Brucey, some posts above yours you see why the experiments on linux had a 5 seconds delay when closing the programme afterwards.<br><br>@skidracer<br>Did you have a chance to fix that delay?<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1241089"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#86">[#86]</a></td></tr></table></td></tr><tr ><td class="posttext"> Any news on the audio driver (delay)?<br><br>And still of interest: a streamed audio-type which can get used with TChannel. So the audio stream should contain some "c-code" so it fills the buffer in a thread without enforcing the blitzmax-project to get compiled in threaded mode too.<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
