<!DOCTYPE html><html lang="en" ><head ><title >Dynamical Lib-Linking (PulseAudio only when used)</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Dynamical Lib-Linking (PulseAudio only when used)</h1><a href="forums.php" >Archives Forums</a>/<a href="topics.php?forum=109" >Linux Discussion</a>/<a href="#bottom" >Dynamical Lib-Linking (PulseAudio only when used)</a><br><br>
<a name="1226747"></a>

<a name="1226748"></a>

<a name="1226770"></a>

<a name="1226771"></a>

<a name="1226774"></a>

<a name="1226775"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi.<br><br>the last days I communicated a lot with a user because he had trouble getting PulseAudio to work in his slackware installation.<br><br>He never needed PulseAudio - except my game uses it because it relies on rtAudio.<br><br>rtAudio itself can use multiple engines. So you init the audiodriver for "PulseAudio" to use PulseAudio, you use "Alsa" for Alsa and so on.<br><br>Now this principle includes the requirement of installing "pulseaudio" - which is a no go for some users (or they do not have the privileges to do so).<br><br>So what I seem to need is this: checking for an installed pulseaudio, if not installed, do not use it at all and use Alsa for it. Sounds like something in the likes of "dynamical library linking/loading". <br><br>If not possible it all ends in creating a bunch of binaries for each "exceptional case" ... a "gameNoPulseAudio", a "gameNoAL", a "game", ...<br>For "opengl" it works with "try catch" and then falling back to directx (of course on Windows).<br><br>It is similar to this <a href="/posts.php?topic=97518" target="_blank">Post without an answer</a>.<br><br><br>Is there anybody out there with a "practical" solution to this problem?<br><br><br><br>EDIT: I tried to set "LINUX_ALSA" as "to use audio driver" on a Knoppix live (no pulseaudio installed but "pulse-simple") but it throws an rtError that the output cannot be started because of "Device or resource busy". This is the same error I get when using Alsa on my local computer while playing an internet radio stream. As rtAudio writes to "std:cerr" Blitzmax thinks it is a real error (even if only a warning) and ends the program... hmpf.<br><br><br>EDIT 2: ok I have redone some parts of rtAudio so it does not spit out errors if an engine is not initiateable - means, I can now traverse through all potential engines and if none of them inititialized successful, I can switch my sound engine to "do nothing".<br><br>For this:<br>- open up maxmod2.mod/rtaudio.mod/rtaudiodriver.cpp<br>- search for <b>RtAudioDriver::Startup(){</b><br>- replace<br><pre class=code>
		audio-&gt;openStream( &amp;parameters, NULL, RTAUDIO_FLOAT32, 44100, &amp;bufferFrames, &amp;RtCallback, this, &amp;options );
		audio-&gt;startStream();
</pre><br><br>with<br><pre class=code>
	//Ron: wrap try-catch around so "false" can get returned
	try {
		audio-&gt;openStream( &amp;parameters, NULL, RTAUDIO_FLOAT32, 44100, &amp;bufferFrames, &amp;RtCallback, this, &amp;options );
		audio-&gt;startStream();
	}
	catch( RtError&amp; e ) {
		//e.printMessage();
		return 0;
	}
</pre><br><br>If you still want the error message to get displayed each time: uncomment <b>e.printMessage();</b><br><br>Now <b>TMaxModRtAudioDriver.Init(engineName)</b> returns False or True. Prior it never returned on initialization errors (rtAudio with its rtError writes to std::cerr - even for warnings, but BlitzMax is recognizing it as something to stop the application).<br><br><br>But the original problem - of the binaries needing "libpulse-simple.so.0" is still existent.<br>Ideas?<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1228436"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Armitage 1982</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Ron<br><br>Guess what!<br>I'm the author of "this Post without an answer." and, just like you, I'm back because a Linux user refuse to install PulseAudio on his system.<br><br>Unfortunately, I'm here to find answers too and I don't have any solutions :(<br>The worst is I remember hacking freeaudio.mod in order to switch from PulseAudio to the default broken BlitzMax Audio driver and eventually turning off the Audio support if no solution is to be found.<br>My whole project is on my old computer with BlitzMax 1.48 and a Mint distro (probably 2012). I don't think upgrading anything is currently possible for me. I remember customizing some others modules for my own needs so it's a tricky situation. Plus no official patch was made since then and I completely dropped BlitzMax...<br><br>I don't remember if I tried the fix from skidracer (from OSS to ALSA), maybe I will try before anything else.<br><br>So with each new version of Linux this problem will reappear again and again?<br><br>I can't believe Mark didn't fix that problem since all this time.<br>Linux users are far more difficult to manage. <br><br></td></tr></table><br>
<a name="1228437"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> For me I solved this currently in a cumbersome way:<br><br>I have "rtAudio.mod" and a "rtAudioNoPulse.mod". The NoPulse one just links everything from rtAudio.mod ("../rtAudio.mod") but leaves out the definition of PulseAudio, so it wont get linked during module building.<br><br>Now I have in my source this line<br><br>Import maxmod2.rtaudio<br>'Import maxmod2.rtaudionopulse<br><br>If I need a binary without pulseAudio, I comment the first out and uncomment the second one.<br><br>Tedious, but works at least.<br><br><br>Think similar can be done with freeaudio.<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1228506"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Armitage 1982</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry for what I'm gonna say but...<br>It's a non sense :s<br><br>I also have a similar switch system with a freeaudio mod hacked to bones but it won't work in this case.<br><br>I may eventually build a separate ALSA version of the executable and pack it along the default one but geez ! What the heck with that "Linux" !?<br><br>Plus this solution is not compatible with all the Store that require a single executable like Desura or Steam...<br><br>Is there anything I can plug to quickly switch my old 1.48 BlitzMax system in ALSA build and forget about it ?<br>I don't have a single idea of what is rtAudio. Will it work better than the ALSA Skidracer fix ?<br><br>Thanks <br><br></td></tr></table><br>
<a name="1228512"></a>

<a name="1228513"></a>

<a name="1228514"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Armitage 1982</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Look like I've been able to build a separate ALSA version of my game thanks to the Skidracer Patch.<br><br>Once again, it gives various results. Both works correctly for me but some users report weird music play rates. <br>At least no more crash for this version and good SFX output :) <br><br></td></tr></table><br>
<a name="1228518"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> it is similar to freeaudio but maxmod2 (with its rtaudio backend) allow streaming audio - which is a must for me as I allow custom playlists (my game has some modding options).<br><br>As it is opensource/freeware I do not care if it contains 1,2,3... binaries  - albeit I do not like the hassle of building all of them each time I release a "monthly zip".<br><br>The only way I know to work: let the user define what he wants before _he_ compiles the binary himself.<br>Another option is something like "dynamic linking", so as long as nothing requests pulseAudio/alsa, its libs wont get loaded (or tried to load).<br>But such a thing is way out of my skill/time (more skill than time problems :D).<br><br>PS: rtAudio is using Alsa differently to freeaudio (I have problems with simultaneous audio from "rtaudio-alsa" and other apps playing audio while this works with freeaudio. So on my machine I have to use the pulseAudio-driver).<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1228569"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I just asked skidracer by email ... if he sees a possibility to move the dependency from "start" to "request" (so only if you request to init with pulseaudio, it is tried to load the dependency).<br><br>I also asked if he could add some "data loader"-callback-function (you call it with offset etc - and it returns a datablock for playback) as this would allow to code streamed playback.<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
