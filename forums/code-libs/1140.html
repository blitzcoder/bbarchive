<!DOCTYPE html><html lang="en" ><head ><title >ggTray system tray DLL</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='a tray DLL that relies on the app peeking for events instead of the app responding to event generated by the icon, language=bb, category=User Libs'><meta name='author' content='gman'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 ><a href=codearcs.php>Code archives</a>/<a href=codearcs.php?cat=14>User Libs</a>/ggTray system tray DLL</h1><div class="quote">This code has been declared by its author to be Public Domain code.</div><br><a href="1140.bb">Download source code</a><br><br><table width="100%" cellspacing="0" cellpadding="0"><tr ><td width="100%"><table width=100% cellspacing=0 cellpadding=0><tr ><td class=headleft></td><td class=head><table width=100% cellspacing=0 cellpadding=0><tr ><td >ggTray system tray DLL by gman</td><td align="right">2004 </td></tr></table></td><td class=headright></td></tr></table></td></tr><tr ><td class="cell"> a ZIP download for the DLL, decls, and example code is <a href="http://www.gprogs.com/ggTray/2005_05_13_ggTray.zip" target="_blank">here.</a><br><br>this is a DLL that puts an icon in they system tray and catches some mouse events performed over it.  it is up to the application to "peek" for any generated events each time through a loop instead of responding to a generated event when one happens.  this allows your application to keep chugging instead of waiting for an event.  for a GUI app, WaitEvent will need a timeout.  also, it does not do anything with popup menus.  for that i would recommend <a href="/codearcs/codearcs.php?code=697" >Advance PopupMenu</a> and <a href="/codearcs/codearcs.php?code=1132" >Advance Popup Menu extras</a>.  there are 2 examples, one for B+ and one for B3D.  ggTray.dll is provided for free...  use it at your own risk.<br><br>the ggTray.decls file:<br><pre class=code>
;Declarations file for ggTray.dll
;
; an individual event is in the following format:
;	EVENT_TYPE|MOUSEX|MOUSEY
;
; a list of events is a series of the individual event format seperated by newlines
;
; EVENT_TYPE can be the following:
;	1 - left click
;	2 - left double click
;	3 - right click
;	4 - right double click
;	5 - middle click
;	6 - middle double click
;
;

.lib "ggTray.dll"

; attaches the passed window handle to the tray icon and initializes the icon info
ggTrayCreate%(hWnd%):"_ggTrayCreate@4"

; shows the icon in the task tray
ggTrayShowIcon%():"_ggTrayShowIcon@0"

; hides the icon in the task tray
ggTrayHideIcon%():"_ggTrayHideIcon@0"

; sets the tooltip for the icon
ggTraySetToolTip%(cToolTip$):"_ggTraySetToolTip@4"

; gets the tooltip of the icon
ggTrayGetToolTip$():"_ggTrayGetToolTip@0"

; return 1 if visible, 0 if not
ggTrayIsVisible%():"_ggTrayIsvisible@0"

; sets the icon used based on the file passed.  1 if successful, 0 if not.
ggTraySetIconFromFile%(cIcoFile$):"_ggTraySetIconFromFile@4"

; sets the icon used based on an icon handle.  1 if successful, 0 if not.
ggTraySetIconFromHandle%(hIcon%):"_ggTraySetIconFromHandle@4"

; destroys everything setup with ggTrayCreate and removes the icon
ggTrayDestroy%():"_ggTrayDestroy@0"

; clears all events from the queue
ggTrayClearEvents():"_ggTrayClearEvents@0"

; clears the passed event from the queue (one-based)
ggTrayClearEvent(nEvent%):"_ggTrayClearEvent@4"

; returns a CRLF delimited list of events and clears the queue
ggTrayReadEvents$():"_ggTrayReadEvents@0"

; returns the passed event and removes it from the queue
ggTrayReadEvent$(nEvent%):"_ggTrayReadEvent@4"

; returns a CRLF delimited list of events but does not clear the queue
ggTrayPeekEvents$():"_ggTrayPeekEvents@0"

; returns the passed event but does not remove it from the queue
ggTrayPeekEvent$(nEvent%):"_ggTrayPeekEvent@4"

; returns the event # of the first left click encountered
ggTrayPeekLeftClick%():"_ggTrayPeekLeftClick@0"

; returns the event # of the first left double click encountered
ggTrayPeekLeftDblClick%():"_ggTrayPeekLeftDblClick@0"

; returns the event # of the first right click encountered
ggTrayPeekRightClick%():"_ggTrayPeekRightClick@0"

; returns the event # of the first right double click encountered
ggTrayPeekRightDblClick%():"_ggTrayPeekRightDblClick@0"

; returns the mouse X of the event passed
ggTrayEventMouseX%(nEvent%):"_ggTrayEventMouseX@4"

; returns the mouse Y of the event passed
ggTrayEventMouseY%(nEvent%):"_ggTrayEventMouseY@4"
</pre> </td></tr><tr ><td class="cell"><pre class="code">; !*! this demo is for BlitzPlus only.  please use trayexamp_b3d.bb for Blitz3D

; TODO: you will need to place the ggTray.dll and ggTray.decls files in a folder called userlibs under your B+ directory
; TODO: ggTray.dll will need to be in the same directory that your EXE resides in if you compile
;

; TODO: either compile and run the EXE or change cAppDir$ to the hard location of the ICOs.  if you choose to compile, be
; sure to put the ggTray.dll in the same directory as your EXE
;Local cAppDir$=SystemProperty("appdir")
Local cAppDir$="c:\develop\trayexamp\"

Global cIconStop$=cAppDir$+"stop.ico"
Global cIconStart$=cAppDir$+"usergrp.ico"

; create a window that never shows... 
Global trayWnd=CreateWindow("Tray Example",-100,-100,1,17)
HideGadget trayWnd

If FileType(cIconStop$)&lt;&gt;1
	Notify("you must set the icon path",True)
Else
	
	; show the initial icon
	ggTrayCreate(QueryObject(trayWnd,1))
	
	; set the icon
	ggTraySetIconFromFile(cIconStop$)
	
	; set the tooltip
	ggTraySetToolTip("Tray Example Stopped")
	
	; show the icon with the updated text
	ggTrayShowIcon()
	
	; main loop to handle events 
	Repeat 
		WaitEvent(100)
	
		; check for a right click
		If ggTrayPeekRightClick()&gt;0
			; check the tooltip to see what status we are currently at
			If Instr(ggTrayGetToolTip(),"Stopped")&gt;0
				; set the icon and a new tip
				ggTraySetIconFromFile(cIconStart$)
				ggTraySetToolTip("Tray Example Started")
			Else
				; set the icon and a new tip
				ggTraySetIconFromFile(cIconStop$)
				ggTraySetToolTip("Tray Example Stopped")
			EndIf
			
			; TODO: show your menu here at the event mousex,mousey
			Notify("click occurred at: "+ggTrayEventMouseX(ggTrayPeekRightClick())+","+ggTrayEventMouseY(ggTrayPeekRightClick()))

			; clear out the events
			ggTrayClearEvents()
		EndIf
	
		; check for a left doubleclick
		If  ggTrayPeekLeftDblClick()&gt;0
			Exit
		EndIf
	
	Forever
	
	; clean up the tray
	ggTrayDestroy()	
EndIf

; free the invisible tray window
FreeGadget trayWnd</pre></td></tr></table><br><a name="comments">Comments</a><br><br><table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Regular K</td><td align="right"><font class=tiny>2004</font></td></tr></table></td></tr><tr ><td class="posttext"> where can i find the dll? <br><br></td></tr></table><br><table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gman</td><td align="right"><font class=tiny>2004</font></td></tr></table></td></tr><tr ><td class="posttext"> there is a link in the original post on the line:<br><br>"a ZIP download for the DLL, decls,..."<br><br>click on the word "here" for the download. <br><br></td></tr></table><br><table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jay Mattis</td><td align="right"><font class=tiny>2004</font></td></tr></table></td></tr><tr ><td class="posttext"> The link seems to be down. Does anybody have a copy of this library they could email me? My email address is jay(at)jaymattis.com. Thanks! <br><br></td></tr></table><br><table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gman</td><td align="right"><font class=tiny>2004</font></td></tr></table></td></tr><tr ><td class="posttext"> sent...  link should be up.  think my web server was having some issues last nite.  i had reports from a couple of other websites as well. <br><br></td></tr></table><br><table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jay Mattis</td><td align="right"><font class=tiny>2004</font></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the email! <br><br></td></tr></table><br><table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bad-Rat</td><td align="right"><font class=tiny>2004</font></td></tr></table></td></tr><tr ><td class="posttext"> what is a QueryObject??<br>When I start the bb,then direkt stop it because of an error<br>"Function QueryObject not Found"<br><br>Can somebody help me?? <br><br></td></tr></table><br><table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gman</td><td align="right"><font class=tiny>2004</font></td></tr></table></td></tr><tr ><td class="posttext"> the example was written for blitzplus and queryobject is a function that will return a platform handle to a window.  my guess is that you are trying to run it in Blitz3d.  i dont have blitz3d so i didnt do an example for it or know if it will work with it :(  maybe someone out there has tried it in blitz3d? <br><br></td></tr></table><br><table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bad-Rat</td><td align="right"><font class=tiny>2004</font></td></tr></table></td></tr><tr ><td class="posttext"> ok.thx gman^^<br>thenI must look,how does it work! <br><br></td></tr></table><br><table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gman</td><td align="right"><font class=tiny>2004</font></td></tr></table></td></tr><tr ><td class="posttext"> some searching found <a href="http://www.blitzbasic.com/Community/posts.php?topic=18287" target="_blank">this</a> bit of code from Peter Scheutz.  i will see if i can install the demo of blitz3d and get a blitz3d sample going in the morning. <br><br></td></tr></table><br><table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gman</td><td align="right"><font class=tiny>2004</font></td></tr></table></td></tr><tr ><td class="posttext"> here is the example (now included in the ZIP file) for B3D.  please note that it does make use of the FindWindowUltimate() function by Peter Scheutz.  it can be found <a href="http://www.blitzbasic.com/Community/posts.php?topic=18287" target="_blank">here</a><br><br><pre class=code>

; !*! this demo is for Blitz3D only.  please use trayexamp.bb for BlitzPlus

; TODO: you will need to place the ggTray.dll and ggTray.decls files in a folder called userlibs under your B3D directory
; TODO: ggTray.dll will need to be in the same directory that your EXE resides in if you compile
; TODO: you need to include the FindWindowUltimate() function or something similar.  it requires some entries in user32.decls and 
; is located at <a href="http://www.blitzbasic.com/Community/posts.php?topic=18287" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=18287</a>
;

; TODO: either compile and run the EXE or change cAppDir$ to the hard location of the ICOs.  if you choose to compile, be
; sure to put the ggTray.dll in the same directory as your EXE
;Local cAppDir$=SystemProperty("appdir")
Local cAppDir$="c:\develop\trayexamp\"

Global cIconStop$=cAppDir$+"stop.ico"
Global cIconStart$=cAppDir$+"usergrp.ico"

; set the graphics
Graphics 400,100,16,2

If FileType(cIconStop$)&lt;&gt;1
	Cls
	Text 110,10,"you must set the icon path",True
Else
	
	; TODO: you will need to include the FindWindowUltimate() function and its requirements 
	; or something similar To get the main window handle
	
	; show the initial icon
	ggTrayCreate(FindWindowUltimate())
	
	; set the icon
	ggTraySetIconFromFile(cIconStop$)
	
	; set the tooltip
	ggTraySetToolTip("Tray Example Stopped")
	
	; show the icon with the updated text
	ggTrayShowIcon()
	
	; main loop to handle events 
	Repeat 
	
		; check for a right click
		If ggTrayPeekRightClick()&gt;0
			; check the tooltip to see what status we are currently at
			If Instr(ggTrayGetToolTip(),"Stopped")&gt;0
				; set the icon and a new tip
				ggTraySetIconFromFile(cIconStart$)
				ggTraySetToolTip("Tray Example Started")
			Else
				; set the icon and a new tip
				ggTraySetIconFromFile(cIconStop$)
				ggTraySetToolTip("Tray Example Stopped")
			EndIf
			
			; TODO: show your menu here at the event mousex,mousey
			Cls
			Text 110,10,"click occurred at: "+ggTrayEventMouseX(ggTrayPeekRightClick())+","+ggTrayEventMouseY(ggTrayPeekRightClick()),True
			
			; clear out the events
			ggTrayClearEvents()
		EndIf
	
		; check for a left doubleclick
		If  ggTrayPeekLeftDblClick()&gt;0
			Exit
		EndIf	
	Forever
	
	; clean up the tray
	ggTrayDestroy()	
EndIf

</pre> <br><br></td></tr></table><br><table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bad-Rat</td><td align="right"><font class=tiny>2004</font></td></tr></table></td></tr><tr ><td class="posttext"> thx gman,now its work.<br>maybe you can include the FindWindowUltimate().bb in your zip file.<br><br>Nice work^^  cya <br><br></td></tr></table><br><table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >CASO</td><td align="right"><font class=tiny>2006</font></td></tr></table></td></tr><tr ><td class="posttext"> Wow your dll for the system tray icons actually works. I congradulate you. <br><br></td></tr></table><br><table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gman</td><td align="right"><font class=tiny>2006</font></td></tr></table></td></tr><tr ><td class="posttext"> thx :)  glad it could be of use. <br><br></td></tr></table><br><table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Pineapple</td><td align="right"><font class=tiny>2006</font></td></tr></table></td></tr><tr ><td class="posttext"> Nice work gman... Really useful! :)<br><br>Dabz <br><br></td></tr></table><br><table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ked</td><td align="right"><font class=tiny>2007</font></td></tr></table></td></tr><tr ><td class="posttext"> I don't see the link anymore. <br><br></td></tr></table><br><table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gman</td><td align="right"><font class=tiny>2007</font></td></tr></table></td></tr><tr ><td class="posttext"> sorry about that.  i updated it last year to fix a memory problem and didnt update the link.  it is still available:<br><br><a href="http://www.gprogs.com/forum/viewtopic.php?id=30" target="_blank">http://www.gprogs.com/forum/viewtopic.php?id=30</a> <br><br></td></tr></table><br><a href="codearcs.php" >Code Archives Forum</a><table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
