<!DOCTYPE html><html lang="en" ><head ><title >B3D Texture Format?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >B3D Texture Format?</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=94" >Blitz3D Userlibs</a>/<a href="#bottom" >B3D Texture Format?</a><br><br>
<a name="1026569"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Doktor Zeus</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm having a crack at DLL writing. Can anyone point me to a resource that outlines the format for Blitz's textures? I basically want to write DLLs that can be passed or return Blitz textures, but I can't find any information on how to structure and decode the data. <br><br></td></tr></table><br>
<a name="1026574"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="http://translate.google.co.uk/translate?prev=hp&amp;hl=en&amp;js=n&amp;u=http%3A%2F%2Fblitz.pp.ru%2Fforum%2Fshowthread.php%3Fs%3Dbf60b1c29ecce245be45aa7d33b183f3%26threadid%3D203&amp;sl=ru&amp;tl=en" target="_blank">http://translate.google.co.uk/translate?prev=hp&amp;hl=en&amp;js=n&amp;u=http%3A%2F%2Fblitz.pp.ru%2Fforum%2Fshowthread.php%3Fs%3Dbf60b1c29ecce245be45aa7d33b183f3%26threadid%3D203&amp;sl=ru&amp;tl=en</a><br><br>MikhailV is a very useful chap. <br><br></td></tr></table><br>
<a name="1026578"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Doktor Zeus</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Awesome. Actually, I think I own some of his DLLs...<br>Thanks for the link!<br><br>[EDIT] Heh, and now I have to work out how to use these diagrams... curse my inability to read Russian! <br><br></td></tr></table><br>
<a name="1026602"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Doktor Zeus</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh would you credit it! There's a note at the end of that thread to the effect that the tables were compiled for Blitz 1.96, and have since changed. I have Blitz 1.98.<br><br>Now, I'll admit that this is the first time I've had to work with pointers and I'm still shaky on how to use them, but I can't seem to extract even the simplest information. So I reckon I need a new reference. <br><br></td></tr></table><br>
<a name="1026603"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> ....depends what you want the DLL to do (did you check the other thread?).<br><br>The "Buffer" table is still up-to-date - I know this much because I have used all those pieces of info recently. Couldn't say for the "texture" one, but bear in mind the texture object doesn't contain the image data - the buffer does.<br><br>A pointer is an address within a process' local memory. Within B3D there is no distinction between pointers and integers, which is why handles for entities, images, etc. are all stored in integer variables. There is no built-in way to use pointers for anything in B3D, but you can pass the integer to a C function expecting a pointer and it will work correctly. <br><br></td></tr></table><br>
<a name="1026606"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Doktor Zeus</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah, don't think I'm going to get very much further with this project. I could stick to just editing the buffer I guess, it'd just mean that I had to setup most of the data within Blitz and then edit it externally, since objects and buffers can't be passed from DLLs. It's all a heck of a lot of work and a steep learning curve, and I've no guarantee that the end result will be any faster than the Blitz coded version.<br><br>If the app I'm programming didn't require access to a LOT of very large textures, I'd do it another way. Unless I can figure a way of packing and maybe encrypting user-provided image files though, there is pretty much no point continuing. <br><br></td></tr></table><br>
<a name="1026616"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> <textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">

; Image from bank using RTLMoveMemory

;Decls:

;.lib "Kernel32.dll"
;API_RtlMoveMemory(Destination,Source*,Length):"RtlMoveMemory"

; Also need FastPointer, by MikhailV (free)


Graphics3D 1024,768,32,6
Local start,i,tex,tBuffer,tData,bank,x,y,tx,ty,file


;Test loading time wth native function
Print "Builtin LoadTexture:"
start=MilliSecs()
tex=LoadTexture("test2.jpg")
Print MilliSecs()-start


;Put the pixels in a bank (where they would be had we loaded them from a file)
tBuffer=TextureBuffer(tex)
tx=TextureWidth(tex):ty=TextureHeight(tex)
file = WriteFile("testfile.txt")

LockBuffer tBuffer
For x=0 To tx-1
	For y=0 To ty-1
		WriteInt file,ReadPixelFast(x,y,tBuffer)
		WritePixelFast x,y,0,tBuffer	;Blank it for show
	Next
Next
UnlockBuffer tBuffer
CloseFile file


;Test copy time from bank to (same) texture
Print "Bank to texture with WritePixelFast:"
start=MilliSecs()
bank=CreateBank(tx*ty*4)
file=ReadFile("testfile.txt")
ReadBytes bank,file,0,BankSize(bank)
CloseFile file

LockBuffer tBuffer
For x=0 To tx-1
	For y=0 To ty-1
		WritePixelFast x,y,PeekInt(bank,(ty*x+y)*4),tBuffer
	Next
Next
UnlockBuffer tBuffer
FreeBank bank
Print MilliSecs()-start


;Proof it worked
CopyRect 0,0,tx,ty,200,100,tBuffer,BackBuffer()


LockBuffer tBuffer
For x=0 To tx-1
	For y=0 To ty-1
		WritePixelFast x,y,0,tBuffer	;Blank it again
	Next
Next
UnlockBuffer tBuffer


;Test copy time using RtlMoveMemory
Print "Bank to texture using RtlMoveMemory:"
start=MilliSecs()
bank=CreateBank(tx*ty*4)
file=ReadFile("testfile.txt")
ReadBytes bank,file,0,BankSize(bank)
CloseFile file

LockBuffer tBuffer
API_RtlMoveMemory MemoryFastPeekInt(tBuffer+72),bank,tx*ty*4
UnlockBuffer tBuffer
FreeBank bank
Print MilliSecs()-start


;Proof it worked again
CopyRect 0,0,tx,ty,200,100+ty,tBuffer,BackBuffer()


WaitKey
End
</textarea><br><br>Hmmm... looks like the bottleneck is in the ReadBytes. OK, I have no further suggestions at this point. <br><br></td></tr></table><br>
<a name="1027217"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Doktor Zeus</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for trying anyway, man. I think I'm stumped on this one, which is a damn shame because it's an application I just know a lot of other programmers would have found useful. I may have to switch to another codebase altogether. Wonder if the Blitz SDK works with Borland Delphi... <br><br></td></tr></table><br>
<a name="1027474"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Serpent</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Although it may sound like a stupid idea, depending on what you need to do, you could try passing and receiving strings to communicate with your DLLs.  Testing on my computer, it takes Blitz3D &lt;2ms to send a 1.3 million character string and print a received string from a PowerBASIC DLL I wrote.<br><br>As far as I know, strings would be stored simply in memory, making it easy to use RTLMoveMemory to get the data in them, they support very large sizes, and, as my test shows, are extremely fast as a data transfer method. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
