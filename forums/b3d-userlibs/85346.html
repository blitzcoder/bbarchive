<!DOCTYPE html><html lang="en" ><head ><title >JV-ODE Physics Thread 12</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >JV-ODE Physics Thread 12</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=94" >Blitz3D Userlibs</a>/<a href="#bottom" >JV-ODE Physics Thread 12</a><br><br>
<a name="965285"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Now available for <b>Blitz3D</b> &amp; <b>BlitzMax (Win32)</b><br><br>The JV-ODE Physics Wrapper is an advanced user library supporting almost all of the Open Dynamics Engine functions wrapped inside a DLL (Dynamic Link Library).<br><br>The library can be used with any programming language that supports DLL's, including Blitz3D and BlitzMax (Win32). The Euler rotation system in JV-ODE has been adapted to match the left-handed Euler rotation used in Blitz3D, however functions for accessing Quaternion and Axis Angle rotation systems are also included. The full versions contain all of the necessary files to get you started, including over 40 demos showing the various features found in ODE and a complete Function Reference document.<br><br>The BlitzMax (Win32) version also features a built-in 'bare-bones' OpenGL 3D engine module and B3D mesh loader module for demo purposes.<br><br>To view more information and screenshots <a href="http://jv-ode.devcode.co.uk/" target="_blank">click here</a>.<br><br>Options are now available to purchase the wrapper using either PayPal or Share*it.<br><br>The <b>Blitz3D</b> restricted demo version is now available for download <a href="http://jv-ode.devcode.co.uk/dload/JV-ODE-Demo-Blitz3D.zip" target="_blank">here</a> (207KB)<br><br>The <b>BlitzMax (Win32)</b> restricted demo version is now available for download <a href="http://jv-ode.devcode.co.uk/dload/JV-ODE-Demo-BlitzMax.zip" target="_blank">here</a> (376KB)<br><br>The <b>JV-ODE Leadwerks Engine Demo Pack</b> is now available for download <a href="http://jv-ode.devcode.co.uk/dload/JV-ODE-LeadwerksEngine.zip" target="_blank">here</a> (60KB)<br><br>Have Fun :)<br><br>Previous JV-ODE Blitz3D Threads: <a href="/posts.php?topic=43653" target="_blank">1</a> <a href="/posts.php?topic=45048" target="_blank">2</a> <a href="/posts.php?topic=48743" target="_blank">3</a> <a href="/posts.php?topic=52572" target="_blank">4</a> <a href="/posts.php?topic=53490" target="_blank">5</a> <a href="/posts.php?topic=56209" target="_blank">6</a> <a href="/posts.php?topic=59001" target="_blank">7</a> <a href="/posts.php?topic=63898" target="_blank">8</a> <a href="/posts.php?topic=68198" target="_blank">9</a> <a href="/posts.php?topic=72220" target="_blank">10</a> <a href="/posts.php?topic=79489" target="_blank">11</a><br><br>Useful Links: <a href="http://www.ode.org/" target="_blank">ODE.org Website</a> - <a href="http://opende.sourceforge.net/wiki/" target="_blank">ODE Wiki</a> - <a href="http://www.ode.org/ode-latest-userguide.pdf" target="_blank">ODE User Guide (PDF)</a> - <a href="http://www.ode.org/ode-latest-userguide.html" target="_blank">ODE User Guide (HTML)</a> <br><br></td></tr></table><br>
<a name="965304"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Santiworld</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> hi vip, thanks for see the game...<br><br>im very happy with the ode physics.. <br><br>the bounce is a big bounce, all cars bounce when touch something, like if the value of collision force is to high...<br>if that bounce happen, on the menu, the car is desapiers, in the race, the cars jump to the sky...<br><br>if i use more cars, 10, 20 30, the posibility of this bounce, increase...<br><br><br>the smmal bounce on the side of the track, is becouse the mesh of the track, that is ok...<br><br>i can send you by mail something so you can see in wireframe...<br><br>thanks vip3r <br><br></td></tr></table><br>
<a name="965400"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> hi VIP3R,<br><br>I have tried adding a hinged door to the back of my trailer with the following code, however my door is elevating in the vertical sense about 1/6th of the height of the trailer - it does not seem to be hinged along the 'bottom' of the door -  it is more like the whole door is solidly fixed at being perpendicular to the back of the trailer - like all four corners of the door are on invisible springs of the same strength causing the door to 'bounce' up and down as the trailer drives along. I suspect I am having problems idebtifying the anchor point on the 'bottom' of the door.I appear to be struggling to hinge the edge of the door to a fixed point on the back of the trailer.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ### Create barred trailer

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
Trailer=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,0,TruckStartY+2,-10.5)
mass=dMassCreate()
;dMassSetBoxTotal(mass,TMass,3,3,18)
dMassSetBoxTotal(mass,TMass,4,5,12)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
;ode\geom=dCreateBox(Space,3,3,18)
ode\geom=dCreateBox(Space,4,5,12)
TGeom=ode\geom
dGeomSetBody(ode\geom,ode\body)
;ode\mesh=CreateCube()
ode\mesh=Trailer_mesh
TMesh=ode\mesh
EntityTexture ode\mesh, cab_txt
;EntityTexture ode\mesh, duck_txt
ScaleMesh ode\mesh,1.2,1.7,1.2      ;not necessary, potential problem -
                                    ;in all examples thewse figures are half the
                                    ;box that was created params ?
RotateMesh ode\mesh,0,180,0
PositionMesh ode\mesh,0,0,0
;EntityColor ode\mesh,20,40,128
;EntityColor ode\mesh,250,250,250
EntityAlpha ode\mesh,0.7

;-------------- made trailer, now try attaching door/ramp
; ### Ramp (Red)

rampwidth=5
rampheight=1
ramplength=10
halfw=rampwidth/2    ;rule of thumb
halfh=rampheight/2   ;SacleMesh is half
halfl=ramplength/2   ;figures quoted earlier

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RampBody=ode\body
dBodySetRotation(ode\body,0,0,0)
;dBodySetPosition(ode\body,-20,5,40)
;dBodySetPosition(ode\body,0,TruckStartY+2,-10.5)
dBodySetPosition(ode\body,0,TruckStartY+2,-22.5)
mass=dMassCreate()
dMassSetBoxTotal(mass,RampMass,rampwidth,rampheight,ramplength)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
ode\geom=dCreateBox(Space,rampwidth,rampheight,ramplength)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,halfw,halfh,halfl
RotateMesh ode\mesh,0,0,0
PositionMesh ode\mesh,0,0,0

EntityColor ode\mesh,200,0,100
EntityAlpha ode\mesh,1

; ### Ramp Joints

;DoorStaticJoint=dJointCreateFixed(Trailer,0)	; ### Fix ramp to the trailer
;dJointAttach(DoorStaticJoint,0,Trailer)
;dJointSetFixed(DoorStaticJoint)

HJoint=dJointCreateHinge(World,0)
dJointAttach(HJoint,RampBody,Trailer)
;dJointSetHingeAxis(HJoint,1,0,0)         ;door is attached with jelly to back of trailer
;dJointSetHingeAxis(HJoint,0,1,0)         ;door separates from rear of trailer
dJointSetHingeAxis(HJoint,0,0,1)         ;ramp now lists to the left....? with mod'd Anchor

;dJointSetHingeAnchor(HJoint,-20,5,40)
dJointSetHingeAnchor(HJoint,halfw,height,halfl)  ;is this from the centre of the cuboid/mesh?
;dJointSetHingeAnchor(HJoint,-20,5,40)
dJointSetHingeParam(HJoint,dParamLoStop,0)
dJointSetHingeParam(HJoint,dParamHiStop,2)
;dJointSetHingeParam(HJoint,dParamLoStop,-0.4)
;dJointSetHingeParam(HJoint,dParamHiStop,0.4)

;---------------   end try attaching door

dJointSetHingeParam(HJoint,dParamVel,DoorForce#)
dJointSetHingeParam(HJoint,dParamFMax,DoorTorque#)

; ### Create trailer wheels



</textarea> <br><br></td></tr></table><br>
<a name="965440"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Latatoy: If the cars jump into the sky, it means your simulation has exploded. Try removing the track mesh and replacing it with a plane to see if the TriMesh collisions are causing it. Are you using sphere geoms for the wheels?<br><br>@Blitzplotter: Here's a modified version of the TruckTrailer demo with a door...<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #                                       JV-ODE Truck Demo                                         #
; #                                  Code by Jim Williams (VIP3R)                                   #
; #                              Devious Codeworks - Copyright © 2008                               #
; ###################################################################################################

Include "JV-ODE.bb"

AppTitle "JV-ODE Car Demo - Truck &amp; Trailer"

Graphics3D 800,600,0,2

Global CMass#=400.0				; ### Cab Mass
Global WMass#=14.0				; ### Wheel Mass
Global TMass#=800.0				; ### Trailer Mass

Global WorldERP#=1.0			; ### World Error Correction
Global WorldFriction#=80.0		; ### World Friction

Global Torque#=48.0				; ### Joint Torque
Global SuspensionHS#=0.01		; ### Suspension Hardness/Softness (Higher=Softer - Lower=Harder)

Global Force#=0.0
Global Steer#=0.0

Global Cab
Global CGeom
Global CMesh

Global Trailer
Global TGeom
Global TMesh

Global TDJoint
Global DoorControl=0

Global TruckStartY=4

Dim Wheel(6)
Dim WGeom(6)
Dim Joint(6)

Dim TWheel(6)
Dim TWGeom(6)
Dim TJoint(6)

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

; ###################################################################################################

; ### Setup ODE

dInitODE()

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,-0.98,0)
dWorldSetERP(World,WorldERP)

dContactSetMode(dContactSlip1)
dContactSetMu(WorldFriction)

; ### Create Cab

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
Cab=ode\body
dBodySetPosition(ode\body,0,TruckStartY,0)
dBodySetRotation(ode\body,0,0,0)
mass=dMassCreate()
dMassSetBoxTotal(mass,CMass,3,1,8)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
ode\geom=dCreateBox(Space,3,1,8)
CGeom=ode\geom
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
CMesh=ode\mesh
ScaleMesh ode\mesh,1.5,0.5,4
EntityColor ode\mesh,40,80,255

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,3,2,4)
dGeomSetBody(ode\geom,Cab)
dGeomSetOffsetPosition(ode\geom,0,1.5,2)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,1.5,1,2
EntityColor ode\mesh,40,80,255
EntityAlpha ode\mesh,0.7

; ### Create Wheels

For count=1 To 6
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	Wheel(count)=ode\body
	dBodySetPosition(ode\body,0,0,0)
	dBodySetRotation(ode\body,0,0,90)
	mass=dMassCreate()
	dMassSetSphereTotal(mass,WMass,0.7)
	dBodySetMass(ode\body,mass)
	dMassDestroy(mass)
	ode\geom=dCreateSphere(Space,0.7)
	WGeom(count)=ode\geom
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder()
	ScaleMesh ode\mesh,0.7,0.25,0.7
	EntityColor ode\mesh,255,255,255
Next

dBodySetPosition(Wheel(1),-2,TruckStartY-0.5,+3)
dBodySetPosition(Wheel(2),+2,TruckStartY-0.5,+3)
dBodySetPosition(Wheel(3),-2,TruckStartY-0.5,-1.5)
dBodySetPosition(Wheel(4),+2,TruckStartY-0.5,-1.5)
dBodySetPosition(Wheel(5),-2,TruckStartY-0.5,-3)
dBodySetPosition(Wheel(6),+2,TruckStartY-0.5,-3)

; ### Create Trailer

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
Trailer=ode\body
dBodySetPosition(ode\body,0,TruckStartY+2,-10.5)
dBodySetRotation(ode\body,0,0,0)
mass=dMassCreate()
dMassSetBoxTotal(mass,TMass,3,3,18)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
ode\geom=dCreateBox(Space,3,3,18)
TGeom=ode\geom
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
TMesh=ode\mesh
ScaleMesh ode\mesh,1.5,1.5,9
EntityColor ode\mesh,20,40,128
EntityAlpha ode\mesh,0.7

; ### Create Trailer Door

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
dBodySetPosition(ode\body,0,TruckStartY+2,-19.5)
dBodySetRotation(ode\body,0,0,0)
mass=dMassCreate()
dMassSetBoxTotal(mass,2,3,3,0.2)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
ode\geom=dCreateBox(Space,3,3,0.2)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,1.5,1.5,0.1
EntityColor ode\mesh,0,140,100
EntityAlpha ode\mesh,0.9

TDJoint=dJointCreateHinge(World,0)
dJointAttach(TDJoint,Trailer,ode\body)
dJointSetHingeAnchor(TDJoint,0,TruckStartY+0.5,-19.5)
dJointSetHingeAxis(TDJoint,1,0,0)
dJointSetHingeParam(TDJoint,dParamLoStop,0)
dJointSetHingeParam(TDJoint,dParamHiStop,2)

; ### Create Trailer Wheels

For count=1 To 6
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	TWheel(count)=ode\body
	dBodySetPosition(ode\body,0,0,0)
	dBodySetRotation(ode\body,0,0,90)
	mass=dMassCreate()
	dMassSetSphereTotal(mass,WMass,0.7)
	dBodySetMass(ode\body,mass)
	dMassDestroy(mass)
	ode\geom=dCreateSphere(Space,0.7)
	TWGeom(count)=ode\geom
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder()
	ScaleMesh ode\mesh,0.7,0.25,0.7
	EntityColor ode\mesh,255,255,255
Next

dBodySetPosition(TWheel(1),-2,TruckStartY-0.5,-18)
dBodySetPosition(TWheel(2),+2,TruckStartY-0.5,-18)
dBodySetPosition(TWheel(3),-2,TruckStartY-0.5,-16.5)
dBodySetPosition(TWheel(4),+2,TruckStartY-0.5,-16.5)
dBodySetPosition(TWheel(5),-2,TruckStartY-0.5,-15)
dBodySetPosition(TWheel(6),+2,TruckStartY-0.5,-15)

; ### Create Objects

SeedRnd MilliSecs()

For spheres=1 To 20
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	dBodySetPosition(ode\body,Rand(-100,100),30,Rand(-100,100))
	dBodySetRotation(ode\body,0,0,0)
	ode\geom=dCreateSphere(Space,4)
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateSphere()
	ScaleMesh ode\mesh,4,4,4
	EntityColor ode\mesh,Rand(0,255),Rand(0,255),Rand(0,255)
	EntityShininess ode\mesh,0.7
Next

For capsules=1 To 20
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	dBodySetPosition(ode\body,Rand(-100,100),30,Rand(-100,100))
	dBodySetRotation(ode\body,90,0,0)
	ode\geom=dCreateCapsule(Space,1,8)
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder()
	ScaleMesh ode\mesh,1,5,1
	RotateMesh ode\mesh,90,0,0	; ### Align Blitz3D Cylinder To ODE Capsule
	EntityColor ode\mesh,Rand(0,255),Rand(0,255),Rand(0,255)
	EntityShininess ode\mesh,0.7
Next

; ### Create Light

Global Light=CreateLight()
RotateEntity Light,50,-50,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create Camera

Global CameraPivot=CreatePivot()

Global Camera=CreateCamera(CameraPivot)
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000

; ### Create Plane

dCreatePlane(Space,0,1,0,0)

Global Plane=CreatePlane()
EntityAlpha Plane,0.8

EntityTexture Plane,PlaneTexture()

CreateMirror()

; ###################################################################################################

; ### Blitz3D Static Object (White)

Global Blitz3DObject=CreateCube()
ScaleMesh Blitz3DObject,1,4,20
PositionEntity Blitz3DObject,10,5,40
RotateEntity Blitz3DObject,-10,8,4
EntityColor Blitz3DObject,255,255,255

; ### ODE Static Object (Blue)

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,2,8,40)
dGeomSetPosition(ode\geom,20,5,40)
dGeomSetRotation(ode\geom,-10,8,4)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,1,4,20
EntityColor ode\mesh,0,100,200

; ### ODE Static Object (Red)

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,18,0.2,40)
dGeomSetPosition(ode\geom,-20,4.9,40)
dGeomSetRotation(ode\geom,-14,0,0)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,9,0.1,20
EntityColor ode\mesh,200,0,100

; ###################################################################################################

SetupTruck()

While Not KeyHit(1)

	UpdateKeys()

	UpdateTruck()

	UpdateGeoms()

	PTime=MilliSecs()

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)

	PhysicsTime#=MilliSecs()-PTime

	UpdateCam()

	RenderWorld

	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime
	Text 0,50,"Force:"+Force
	Text 0,65,"Torque:"+Torque
	Text 640,0,"A - Accelerate"
	Text 640,15,"Z - Brake/Reverse"
	Text 640,30,"Arrows - Steering"
	Text 640,45,"Space - Reset Truck"
	Text 0,100,"F1 - Raise Door"
	Text 0,120,"F2 - Lower Door"
	Text 0,140,"F3 - Free Door"

	Flip 1

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function SetupTruck()

For count=1 To 6
	Joint(count)=dJointCreateHinge2(World,0)
	dJointAttach(Joint(count),Cab,Wheel(count))
	dJointSetHinge2Anchor(Joint(count),dBodyGetPositionX(Wheel(count)),dBodyGetPositionY(Wheel(count)),dBodyGetPositionZ(Wheel(count)))
	dJointSetHinge2Axis1(Joint(count),0,1,0)
	dJointSetHinge2Axis2(Joint(count),-1,0,0)
	dJointSetHinge2Param(Joint(count),dParamSuspensionERP,0.8)
	dJointSetHinge2Param(Joint(count),dParamSuspensionCFM,SuspensionHS)
	If count&gt;2
		dJointSetHinge2Param(Joint(count),dParamLoStop,0)
		dJointSetHinge2Param(Joint(count),dParamHiStop,0)
		End If
Next

For count=1 To 6
	TJoint(count)=dJointCreateHinge2(World,0)
	dJointAttach(TJoint(count),Trailer,TWheel(count))
	dJointSetHinge2Anchor(TJoint(count),dBodyGetPositionX(TWheel(count)),dBodyGetPositionY(TWheel(count)),dBodyGetPositionZ(TWheel(count)))
	dJointSetHinge2Axis1(TJoint(count),0,1,0)
	dJointSetHinge2Axis2(TJoint(count),-1,0,0)
	dJointSetHinge2Param(TJoint(count),dParamSuspensionERP,0.8)
	dJointSetHinge2Param(TJoint(count),dParamSuspensionCFM,SuspensionHS)
	dJointSetHinge2Param(TJoint(count),dParamLoStop,0)
	dJointSetHinge2Param(TJoint(count),dParamHiStop,0)
Next

AJoint=dJointCreateHinge(World,0)
dJointAttach(AJoint,Trailer,Cab)
dJointSetHingeAnchor(AJoint,dBodyGetPositionX(Cab),dBodyGetPositionY(Cab),dBodyGetPositionZ(Cab)-2)
dJointSetHingeAxis(AJoint,0,1,0)
dJointSetHingeParam(AJoint,dParamSuspensionERP,0.8)
dJointSetHingeParam(AJoint,dParamSuspensionCFM,SuspensionHS)
dJointSetHingeParam(AJoint,dParamLoStop,-2)
dJointSetHingeParam(AJoint,dParamHiStop,2)

End Function

; ###################################################################################################

Function UpdateKeys()

If KeyDown(30)=1
	Force=Force+0.08
	If Force&gt;30 Then Force=30
	End If

If KeyDown(44)=1
	Force=Force-0.1
	If Force&lt;-10 Then Force=-10
	If Force&gt;0 Then Force=Force*0.97
	End If

If KeyDown(30)=0 And KeyDown(44)=0 Then Force=Force*0.99

If KeyDown(203)=1 Or KeyDown(205)=1
	If KeyDown(203)=1
		Steer=0.5
		Else
		Steer=-0.5
		End If
	Else
	Steer=0.0
	End If

If KeyHit(57)=1
	Force=0.0
	dBodySetRotation(Cab,dGeomGetPitch(CGeom),dGeomGetYaw(CGeom),0)
	dBodySetRotation(Trailer,dGeomGetPitch(TGeom),dGeomGetYaw(TGeom),0)
	End If

If KeyHit(59)
	DoorControl=1
	End If

If KeyHit(60)
	DoorControl=2
	End If

If KeyHit(61)
	DoorControl=0
	End If

If DoorControl=1 ; ### Raise
	dJointSetHingeParam(TDJoint,dParamVel,-0.1)
	dJointSetHingeParam(TDJoint,dParamFMax,10)
	End If

If DoorControl=2 ; ### Lower
	dJointSetHingeParam(TDJoint,dParamVel,0.1)
	dJointSetHingeParam(TDJoint,dParamFMax,10)
	End If

If DoorControl=0 ; ### Free
	dJointSetHingeParam(TDJoint,dParamVel,0)
	dJointSetHingeParam(TDJoint,dParamFMax,0)
	End If

End Function

; ###################################################################################################

Function UpdateTruck()

For count=1 To 6
	dBodyEnable(Wheel(count))
	dBodyEnable(TWheel(count))
Next

dBodyEnable(Cab)
dBodyEnable(Trailer)

For count=1 To 6
	dJointSetHinge2Param(Joint(count),dParamVel2,Force)
	dJointSetHinge2Param(Joint(count),dParamFMax2,Torque)
Next

For count=1 To 2
	angle#=Steer-dJointGetHinge2Angle1(Joint(count))
	dJointSetHinge2Param(Joint(count),dParamVel,angle)
	dJointSetHinge2Param(Joint(count),dParamFMax,400)
Next

End Function

; ###################################################################################################

Function UpdateCam()

PositionEntity Camera,0,10,-28
RotateEntity Camera,30,0,0

PivotX#=Cos(EntityYaw(CMesh)-90)+EntityX(CMesh)
PivotY#=EntityY(CMesh)
PivotZ#=Sin(EntityYaw(CMesh)-90)+EntityZ(CMesh)

PositionEntity CameraPivot,PivotX,PivotY,PivotZ

PointEntity CameraPivot,CMesh

End Function

; ###################################################################################################

Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
	PositionEntity ode\mesh,dGeomGetPositionX(ode\geom),dGeomGetPositionY(ode\geom),dGeomGetPositionZ(ode\geom)
	RotateEntity ode\mesh,dGeomGetPitch(ode\geom),dGeomGetYaw(ode\geom),dGeomGetRoll(ode\geom)
Next

End Function

; ###################################################################################################
</textarea><br><br>The door starts in the 'free' state, use the F1, F2 and F3 keys to raise, lower or free the door. <br><br></td></tr></table><br>
<a name="965459"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Santiworld</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> in the main menu, i have a dplane and one ode car...<br>and the car jump crazy too, sometimes..<br><br>is like the system is overflow.<br><br>i use the same concept car of the ode samples...<br>a cube with spheres for wheels.<br><br>this is part of the code i use to create the cars..<br>is cut in some part,<br><br><pre class=code>

ode\body=dBodyCreate(World)
	Car\body=ode\body
	dBodySetPosition(ode\body,t_CarStartx,t_CarStartY,t_CarStartz)
	dBodySetRotation(ode\body,0,0,0)
	mass=dMassCreate()
	dMassSetBoxTotal(mass,CMass,c_ancho#,c_alto#,c_largo#)
	dBodySetMass(ode\body,mass)
	dMassDestroy(mass)
	ode\geom=dCreateBox(Space,c_ancho#,c_alto#,c_largo#)
	CGeom=ode\geom
	car\geom = ode\geom
	dGeomSetBody(ode\geom,ode\body)
	dGeomContactSetMu(ode\geom,100)
	dGeomContactSetBounce(ode\geom,0)
	
	ode\mesh=CreateCube()


For count=1 To 4
			
		ode.ODEGeom=New ODEGeom
		ode\id = i
		ode\body=dBodyCreate(World)
		car\Wheel[count]=ode\body
		dBodySetPosition(ode\body,0,0,0)
		dBodySetRotation(ode\body,0,0,90)
		mass=dMassCreate()
		dMassSetSphereTotal(mass,WMass,diametro_rueda#)
		dBodySetMass(ode\body,mass)
		dMassDestroy(mass)
		ode\geom=dCreateSphere(Space,diametro_rueda#)
		car\WGeom[count]=ode\geom
		dGeomSetBody(ode\geom,ode\body)
		ode\mesh=  CreateCylinder()

next...

For count=1 To 4
		
		car\joint[count]=dJointCreateHinge2(World,0)
		
		dJointAttach(car\joint[count],Car\body,car\Wheel[count])
		
		dJointSetHinge2Anchor(car\joint[count],dBodyGetPositionX(car\Wheel[count]),dBodyGetPositionY(car\Wheel[count]),dBodyGetPositionZ(car\Wheel[count]))
		dJointSetHinge2Axis1(car\joint[count],0,1,0)
		dJointSetHinge2Axis2(car\joint[count],-1,0,0)
		dJointSetHinge2Param(car\joint[count],dParamSuspensionERP,0.8)
		dJointSetHinge2Param(car\joint[count],dParamSuspensionCFM,SuspensionHS)
		
		If count&gt;2
			dJointSetHinge2Param(car\joint[count],dParamLoStop,0)
			dJointSetHinge2Param(car\joint[count],dParamHiStop,0)
		End If
	Next



</pre><br><br>you have that jumps vip3r?<br><br>sometimes happend when i go to race, menu race menu, many times.<br><br>thanks!...<br><br>i think is a fail in my code... the problem is find where? <br><br></td></tr></table><br>
<a name="965466"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> The code you've posted looks ok, but there's many more possible causes, for example the mass/gravity values used etc.<br><br>The only sure way to debug this issue is by re-creating it, try to modify one of the demos with the same simulation setup until the problem appears.<br><br>I haven't seen it happen yet, but from your description it's clear that the simulation is exploding. <br><br></td></tr></table><br>
<a name="965482"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Thankyou very much VIP3R, I will compare your code with mine to try and see where I was going wrong - I had thought about playing with the Radio controlled car (a car with an antenna demo) to fathom the anchor point co-ords, I am loading up protean now to excercise your code, I like the free door example you've incorporated, once the trailer gets so much damage I can invoke the free door and the contents of my trailer will spill out (;-)<br><br>Your support and demos never cease to amaze, have a good weekend! <br><br></td></tr></table><br>
<a name="965933"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GIB3D</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I just bought JV-ODE and I'm excited knowing I can now do some physics stuff in blitz3D... I just have to figure out what it is that I want to do. There's so many possibilities now. <br><br></td></tr></table><br>
<a name="967107"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi VIP3R, I have been trying to create a prototype flatbed which will 'tip-upwards' and will lie along the top of the trailer.  However it keeps falling through the trailer....<br><br>I've applied forces to the new 'lid ontop of the trailer which is going to be a ramp for the contents to slip down.... it appears I've hinged it at slightly the wrong place.  This wasn't evident until I started applying forces to the lidded section.  I,m tweaking it now, and have got it so the lid is hinged, just got to try and make the trailer solid.<br><br><br>I have tried turning off the entityalpha for the trailer to no avail - please help ?<br><br><pre class=code>

[EDIT - removed - see code further down thread]
######################################################################################################################################################################################################################################################################
</pre> <br><br></td></tr></table><br>
<a name="967145"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Any objects that are 'directly' jointed will not collide with each other, that's why it falls through the trailer. You need to attach a small block at the front end of the trailer to act as a stop.<br><br>The trailer is completely opaque here, I've noticed the alpha behave strangely in Blitz3D before. Might be something to do with the flatbed section being slightly transparent and located inside the trailer body. Also depends on your graphics card / drivers. <br><br></td></tr></table><br>
<a name="967146"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh, okay will attempt to attach a small block to the front end, cheers.  Well, have had limited success with that so far.  Initially tried to create a separate box and join it to the front of the trailer in the same vein as the Cab top, I believe the fundamental problem with this was the physics lib still perceived the new front end (for all I put it in a different colour) as still for all purposes the trailer.<br><br>Okay, so I got around to referencing the commands avaialable for connecting two separate cubes, after much battling with syntax problems I refewrred to the Wiki for ODE where I found the following quote:<br><br>Fixed<br><br>The fixed joint maintains a fixed relative position and orientation between two bodies, or between a body and the static environment. Using this joint is almost never a good idea in practice, except when debugging. If you need two bodies to be glued together it is better to represent that as a single body.<br><br>void dJointSetFixed (dJointID);<br><br>Call this on the fixed joint after it has been attached to remember the current desired relative offset and desired relative rotation between the bodies.<br><br>The contact joint prevents body 1 and body 2 from inter-penetrating at the contact point. It does this by only allowing the bodies to have an "outgoing" velocity in the direction of the contact normal. Contact joints typically have a lifetime of one time step. They are created and deleted in response to collision detection. <br><br>Which has led me to believe I am attacking this from the wrong angle.  My last attempt for the time being is to add a vertical block to the back of the cab - this will not interfere with the trailer as that is hinged (directly) to the cab - however it is not hinged to the 'lid' so I hope the vertical block I add to the back of the cab will at least stop the lid from falling through - it is crude however it works although I'd have liked to have known how to glue a remote cube onto another. <br><br></td></tr></table><br>
<a name="967185"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've experienced some problems with the way I have implemented the work around - as you can see in the image below the tipping part of the flatbed has fell through the block on the cab, this does not happen all the time, only on occasion will it 'blast' through the block on the cab which is supposed to prevent it from falling below the trailer's floor - when this happens it fails to 'raise' again, it is stuck beneath the block that was supposed to prevent it from going through the trailer floor, I've a breif suspicion it may be happening because the block on the cab is slighlty 'merged' with the trailer floor.  Will try making the cab block thinner and higher so that JV-ODE is able discerning the two all the time, well it works 6 out of 7 times, but on the odd occasion the internal tipping floor gets stuck beneath the block that is meant to stop it from falling beneath trailer floor.<br><br>I've attached the code that has brought it this far - hopefully something will jump out to you as being an 'easy fix'.  Thanks in advance - BP.<br><br>[edit]<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #                                       JV-ODE Truck Demo                                         #
; #                                  Code by Jim Williams (VIP3R)                                   #
; #                              Devious Codeworks - Copyright © 2008                               #
; ###################################################################################################

Include "JV-ODE.bb"

AppTitle "JV-ODE Car Demo - Truck &amp; Trailer"

;v2:  messing with hinges
;v3:  adding a block to the front
;v4:  squishing down trailer
;v5:  sticking walls on the trailer

Graphics3D 800,600,0,2

Global CMass#=500.0				; ### Cab Mass
Global WMass#=14.0				; ### Wheel Mass
Global TMass#=800.0				; ### Trailer Mass

Global WorldERP#=1.0			; ### World Error Correction
Global WorldFriction#=80.0		; ### World Friction

Global Torque#=48.0				; ### Joint Torque
Global SuspensionHS#=0.01		; ### Suspension Hardness/Softness (Higher=Softer - Lower=Harder)

Global Force#=0.0
Global Steer#=0.0

Global Cab
Global CGeom
Global CMesh

Global TrailerFront
Global Trailer
Global TGeom
Global TMesh

Global TLJoint

Global TDJoint
Global DoorControl=0

Global TruckStartY=4

Dim Wheel(6)
Dim WGeom(6)
Dim Joint(6)
Dim Fixedjoint(2)

Dim TWheel(6)
Dim TWGeom(6)
Dim TJoint(6)

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

; ###################################################################################################

; ### Setup ODE

dInitODE()

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,-0.98,0)
dWorldSetERP(World,WorldERP)

;dContactSetMode(dContactBounce)
;dContactSetBounce(0.1)
;dContactSetMu(48)

dContactSetMode(dContactSlip1)
dContactSetMu(WorldFriction)

; ### Create Cab

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
Cab=ode\body
dBodySetPosition(ode\body,0,TruckStartY,0)
dBodySetRotation(ode\body,0,0,0)
mass=dMassCreate()
dMassSetBoxTotal(mass,CMass,3,1,8)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
ode\geom=dCreateBox(Space,3,1,8)
CGeom=ode\geom
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
CMesh=ode\mesh
ScaleMesh ode\mesh,1.5,0.5,4
EntityColor ode\mesh,40,80,255

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,3,2,4)
dGeomSetBody(ode\geom,Cab)
dGeomSetOffsetPosition(ode\geom,0,1.5,2)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,1.5,1,2
EntityColor ode\mesh,40,80,255
EntityAlpha ode\mesh,0.7

;create vertical pillar at back of cab for 'lid' to rest on:

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,3,0.1,8)
dGeomSetBody(ode\geom,Cab)
dGeomSetOffsetPosition(ode\geom,0,1.9,-3)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,1.5,0.05,4
EntityColor ode\mesh,10,30,123

;end of fudge to keep lid from falling through trailer

;create vertical pillar at back of cab For 'lid' To Stop going up on:

;ode.ODEGeom=New ODEGeom
;ode\geom=dCreateBox(Space,3,0.3,7)
;dGeomSetBody(ode\geom,Cab)
;dGeomSetOffsetPosition(ode\geom,0,12.5,-2.5)
;ode\mesh=CreateCube()
;ScaleMesh ode\mesh,1.5,0.15,3.5
;EntityColor ode\mesh,10,30,123
;
;EntityAlpha ode\mesh,0.7

;end of fudge to keep lid from falling through trailer

; ### Create Wheels

For count=1 To 6
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	Wheel(count)=ode\body
	dBodySetPosition(ode\body,0,0,0)
	dBodySetRotation(ode\body,0,0,90)
	mass=dMassCreate()
	dMassSetSphereTotal(mass,WMass,0.7)
	dBodySetMass(ode\body,mass)
	dMassDestroy(mass)
	ode\geom=dCreateSphere(Space,0.7)
	WGeom(count)=ode\geom
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder()
	ScaleMesh ode\mesh,0.7,0.25,0.7
	EntityColor ode\mesh,255,255,255
Next

dBodySetPosition(Wheel(1),-2,TruckStartY-0.5,+3)
dBodySetPosition(Wheel(2),+2,TruckStartY-0.5,+3)
dBodySetPosition(Wheel(3),-2,TruckStartY-0.5,-1.5)
dBodySetPosition(Wheel(4),+2,TruckStartY-0.5,-1.5)
dBodySetPosition(Wheel(5),-2,TruckStartY-0.5,-3)
dBodySetPosition(Wheel(6),+2,TruckStartY-0.5,-3)

; ### Create Trailer

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
Trailer=ode\body
dBodySetPosition(ode\body,0,TruckStartY+.5,-10.5)
dBodySetRotation(ode\body,0,0,0)
mass=dMassCreate()
dMassSetBoxTotal(mass,TMass,5,0.4,18)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)

ode\geom=dCreateBox(Space,5,0.4,18)
TGeom=ode\geom
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
TMesh=ode\mesh
ScaleMesh ode\mesh,2.5,0.2,9
;EntityColor ode\mesh,20,40,128
EntityColor ode\mesh,40,80,255

;;add left wall of trailer
ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,0.2,4,16.5)
dGeomSetBody(ode\geom,Trailer)
dGeomSetOffsetPosition(ode\geom,2.3,1.9,-.6)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,0.1,2,8
EntityColor ode\mesh,40,80,255
EntityAlpha ode\mesh,0.7

;;add right wall of trailer
ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,0.2,4,16.5)
dGeomSetBody(ode\geom,Trailer)
dGeomSetOffsetPosition(ode\geom,-2.3,1.9,-.7)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,0.1,2,8
EntityColor ode\mesh,40,80,255
EntityAlpha ode\mesh,0.7
;

;adding a block to the front of the trailer
ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,5,3.4,0.5)
dGeomSetBody(ode\geom,Trailer)
dGeomSetOffsetPosition(ode\geom,0,2,7.5)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,2.5,1.7,0.25
EntityColor ode\mesh,40,80,255
EntityAlpha ode\mesh,0.7


;futile attempt at joining the new block to the front of the trailer

;Fixedjoint(1)=dJointCreateFixed(World,Trailer)
;Fixedjoint(2)=dJointCreateFixed(World,TrailerFront)
;dJointAttach(Fixedjoint(1),0,Fixedjoint(2))
;djointtypefixed
;fixedjointx=djointcreatefixed(
;fixedjoint=dConnectingJoint(Trailer,TrailerFront)
;joint2=dJointAttach(fixedjoint,Trailer,TrailerFront)

;end futile attempt

;adding a block to the front of the trailer
;ode.ODEGeom=New ODEGeom
;ode\body=dBodyCreate(World)
;TrailerFront=ode\body
;ode\geom=dCreateBox(Space,3,3,1)
;dGeomSetBody(ode\geom,TrailerFront)
;dGeomSetOffsetPosition(ode\geom,0,0,9.5)
;ode\mesh=CreateCube()
;ScaleMesh ode\mesh,1.5,1.5,0.5
;EntityColor ode\mesh,20,60,122
;EntityAlpha ode\mesh,0.7


; ### Create Tippy ramp, note needs the trailers dimensions, but with the
; ### door physics associated with it -----------------------------------
; ### simply try to add a large door to the back of the trailer which will
; ### fall forwards and lie on top of the trailer, not fall through it.



ysz=16.6
ymsz=ysz/2

;yposadjust=10.5
yposadjust=4.65
zadjust=-17.6

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
dBodySetPosition(ode\body,0,TruckStartY+3.7+yposadjust,zadjust)
dBodySetRotation(ode\body,0,0,0)
mass=dMassCreate()
dMassSetBoxTotal(mass,10,4,ysz,0.2)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
ode\geom=dCreateBox(Space,4,ysz,0.2)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,2,ymsz,0.1
EntityColor ode\mesh,0,140,100
EntityAlpha ode\mesh,0.9

TLJoint=dJointCreateHinge(World,0)
dJointAttach(TLJoint,Trailer,ode\body)
;dJointSetHingeAnchor(TDJoint,0,TruckStartY+0.5,-19.5)
;dJointSetHingeAnchor(TLJoint,0,TruckStartY+4.5,-18)
dJointSetHingeAnchor(TLJoint,0,TruckStartY+1.2,zadjust)
dJointSetHingeAxis(TLJoint,-1,0,0)
dJointSetHingeParam(TLJoint,dParamLoStop,0)     ;suspect I may need to work out what the horizontal is in radians ?
dJointSetHingeParam(TLJoint,dParamHiStop,2)


;---------------------------end create tippy ramp

; ### Create Trailer Door

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
dBodySetPosition(ode\body,0,TruckStartY+2,-19.5)
dBodySetRotation(ode\body,0,0,0)
mass=dMassCreate()
dMassSetBoxTotal(mass,2,4,3,0.2)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
ode\geom=dCreateBox(Space,4,3,0.2)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,2,1.5,0.1
EntityColor ode\mesh,0,140,100
EntityAlpha ode\mesh,0.9

TDJoint=dJointCreateHinge(World,0)
dJointAttach(TDJoint,Trailer,ode\body)
dJointSetHingeAnchor(TDJoint,0,TruckStartY+0.5,-19.5)
dJointSetHingeAxis(TDJoint,1,0,0)
dJointSetHingeParam(TDJoint,dParamLoStop,0)
dJointSetHingeParam(TDJoint,dParamHiStop,2)

; ### Create Trailer Wheels

For count=1 To 6
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	TWheel(count)=ode\body
	dBodySetPosition(ode\body,0,0,0)
	dBodySetRotation(ode\body,0,0,90)
	mass=dMassCreate()
	dMassSetSphereTotal(mass,WMass,0.7)
	dBodySetMass(ode\body,mass)
	dMassDestroy(mass)
	ode\geom=dCreateSphere(Space,0.7)
	TWGeom(count)=ode\geom
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder()
	ScaleMesh ode\mesh,0.7,0.25,0.7
	EntityColor ode\mesh,255,255,255
Next

dBodySetPosition(TWheel(1),-2,TruckStartY-0.5,-18)
dBodySetPosition(TWheel(2),+2,TruckStartY-0.5,-18)
dBodySetPosition(TWheel(3),-2,TruckStartY-0.5,-16.5)
dBodySetPosition(TWheel(4),+2,TruckStartY-0.5,-16.5)
dBodySetPosition(TWheel(5),-2,TruckStartY-0.5,-15)
dBodySetPosition(TWheel(6),+2,TruckStartY-0.5,-15)

; ### Create Objects

SeedRnd MilliSecs()

For spheres=1 To 20
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	dBodySetPosition(ode\body,Rand(-100,100),30,Rand(-100,100))
	dBodySetRotation(ode\body,0,0,0)
	ode\geom=dCreateSphere(Space,4)
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateSphere()
	ScaleMesh ode\mesh,4,4,4
	EntityColor ode\mesh,Rand(0,255),Rand(0,255),Rand(0,255)
	EntityShininess ode\mesh,0.7
Next

For capsules=1 To 20
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	dBodySetPosition(ode\body,Rand(-100,100),30,Rand(-100,100))
	dBodySetRotation(ode\body,90,0,0)
	ode\geom=dCreateCapsule(Space,1,8)
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder()
	ScaleMesh ode\mesh,1,5,1
	RotateMesh ode\mesh,90,0,0	; ### Align Blitz3D Cylinder To ODE Capsule
	EntityColor ode\mesh,Rand(0,255),Rand(0,255),Rand(0,255)
	EntityShininess ode\mesh,0.7
Next

; ### Create Light

Global Light=CreateLight()
RotateEntity Light,50,-50,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create Camera

Global CameraPivot=CreatePivot()

Global Camera=CreateCamera(CameraPivot)
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000

; ### Create Plane

dCreatePlane(Space,0,1,0,0)

Global Plane=CreatePlane()
EntityAlpha Plane,0.8

EntityTexture Plane,PlaneTexture() 

CreateMirror()

; ###################################################################################################

; ### Blitz3D Static Object (White)

Global Blitz3DObject=CreateCube()
ScaleMesh Blitz3DObject,1,4,20
PositionEntity Blitz3DObject,10,5,40
RotateEntity Blitz3DObject,-10,8,4
EntityColor Blitz3DObject,255,255,255

; ### ODE Static Object (Blue)

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,2,8,40)
dGeomSetPosition(ode\geom,20,5,40)
dGeomSetRotation(ode\geom,-10,8,4)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,1,4,20
EntityColor ode\mesh,0,100,200

; ### ODE Static Object (Red)

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,18,0.2,40)
dGeomSetPosition(ode\geom,-20,4.9,40)
dGeomSetRotation(ode\geom,-14,0,0)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,9,0.1,20
EntityColor ode\mesh,200,0,100

; ###################################################################################################

SetupTruck()

While Not KeyHit(1)

	UpdateKeys()

	UpdateTruck()

	UpdateGeoms()

	PTime=MilliSecs()

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)

	PhysicsTime#=MilliSecs()-PTime

	UpdateCam()

	RenderWorld

	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime
	Text 0,50,"Force:"+Force
	Text 0,65,"Torque:"+Torque
	Text 640,0,"A - Accelerate"
	Text 640,15,"Z - Brake/Reverse"
	Text 640,30,"Arrows - Steering"
	Text 640,45,"Space - Reset Truck"
	Text 0,100,"F1 - Raise Door, Lower trailer internal platform"
	Text 0,120,"F2 - Lower Door, Raise trailer internal platform"
	Text 0,140,"F3 - Free Door"

	Flip 1

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function SetupTruck()

For count=1 To 6
	Joint(count)=dJointCreateHinge2(World,0)
	dJointAttach(Joint(count),Cab,Wheel(count))
	dJointSetHinge2Anchor(Joint(count),dBodyGetPositionX(Wheel(count)),dBodyGetPositionY(Wheel(count)),dBodyGetPositionZ(Wheel(count)))
	dJointSetHinge2Axis1(Joint(count),0,1,0)
	dJointSetHinge2Axis2(Joint(count),-1,0,0)
	dJointSetHinge2Param(Joint(count),dParamSuspensionERP,0.8)
	dJointSetHinge2Param(Joint(count),dParamSuspensionCFM,SuspensionHS)
	If count&gt;2
		dJointSetHinge2Param(Joint(count),dParamLoStop,0)
		dJointSetHinge2Param(Joint(count),dParamHiStop,0)
		End If
Next

For count=1 To 6
	TJoint(count)=dJointCreateHinge2(World,0)
	dJointAttach(TJoint(count),Trailer,TWheel(count))
	dJointSetHinge2Anchor(TJoint(count),dBodyGetPositionX(TWheel(count)),dBodyGetPositionY(TWheel(count)),dBodyGetPositionZ(TWheel(count)))
	dJointSetHinge2Axis1(TJoint(count),0,1,0)
	dJointSetHinge2Axis2(TJoint(count),-1,0,0)
	dJointSetHinge2Param(TJoint(count),dParamSuspensionERP,0.8)
	dJointSetHinge2Param(TJoint(count),dParamSuspensionCFM,SuspensionHS)
	dJointSetHinge2Param(TJoint(count),dParamLoStop,0)
	dJointSetHinge2Param(TJoint(count),dParamHiStop,0)
Next

AJoint=dJointCreateHinge(World,0)
dJointAttach(AJoint,Trailer,Cab)
dJointSetHingeAnchor(AJoint,dBodyGetPositionX(Cab),dBodyGetPositionY(Cab),dBodyGetPositionZ(Cab)-2)
dJointSetHingeAxis(AJoint,0,1,0)
dJointSetHingeParam(AJoint,dParamSuspensionERP,0.8)
dJointSetHingeParam(AJoint,dParamSuspensionCFM,SuspensionHS)
dJointSetHingeParam(AJoint,dParamLoStop,-2)
dJointSetHingeParam(AJoint,dParamHiStop,2)

End Function

; ###################################################################################################

Function UpdateKeys()

If KeyDown(30)=1
	Force=Force+0.08
	If Force&gt;30 Then Force=30
	End If

If KeyDown(44)=1
	Force=Force-0.1
	If Force&lt;-10 Then Force=-10
	If Force&gt;0 Then Force=Force*0.97
	End If

If KeyDown(30)=0 And KeyDown(44)=0 Then Force=Force*0.99

If KeyDown(203)=1 Or KeyDown(205)=1
	If KeyDown(203)=1
		Steer=0.5
		Else
		Steer=-0.5
		End If
	Else
	Steer=0.0
	End If

If KeyHit(57)=1
	Force=0.0
	dBodySetRotation(Cab,dGeomGetPitch(CGeom),dGeomGetYaw(CGeom),0)
	dBodySetRotation(Trailer,dGeomGetPitch(TGeom),dGeomGetYaw(TGeom),0)
	End If

If KeyHit(59)
	DoorControl=1
	End If

If KeyHit(60)
	DoorControl=2
	End If

If KeyHit(61)
	DoorControl=0
	End If

If DoorControl=1 ; ### Raise
	dJointSetHingeParam(TDJoint,dParamVel,-0.1)
	dJointSetHingeParam(TDJoint,dParamFMax,10)
	
	dJointSetHingeParam(TLJoint,dParamVel,5)
	dJointSetHingeParam(TLJoint,dParamFMax,40)
	
	;dJointSetHingeParam(TLJoint,dParamVel,-45)
	;dJointSetHingeParam(TLJoint,dParamFMax,95)
	
	End If

If DoorControl=2 ; ### Lower
	dJointSetHingeParam(TDJoint,dParamVel,0.1)
	dJointSetHingeParam(TDJoint,dParamFMax,10)
	
	dJointSetHingeParam(TLJoint,dParamVel,-45)
	dJointSetHingeParam(TLJoint,dParamFMax,95)
	
	;dJointSetHingeParam(TLJoint,dParamVel,5)
	;dJointSetHingeParam(TLJoint,dParamFMax,40)
	
	End If

If DoorControl=0 ; ### Free
	dJointSetHingeParam(TDJoint,dParamVel,0)
	dJointSetHingeParam(TDJoint,dParamFMax,0)
	
	dJointSetHingeParam(TLJoint,dParamVel,0)
	dJointSetHingeParam(TLJoint,dParamFMax,0)
	
	End If

End Function

; ###################################################################################################

Function UpdateTruck()

For count=1 To 6
	dBodyEnable(Wheel(count))
	dBodyEnable(TWheel(count))
Next

dBodyEnable(Cab)
dBodyEnable(Trailer)

For count=1 To 6
	dJointSetHinge2Param(Joint(count),dParamVel2,Force)
	dJointSetHinge2Param(Joint(count),dParamFMax2,Torque)
Next

For count=1 To 2
	angle#=Steer-dJointGetHinge2Angle1(Joint(count))
	dJointSetHinge2Param(Joint(count),dParamVel,angle)
	dJointSetHinge2Param(Joint(count),dParamFMax,400)
Next

End Function

; ###################################################################################################

Function UpdateCam()

PositionEntity Camera,0,10,-28
RotateEntity Camera,30,0,0

PivotX#=Cos(EntityYaw(CMesh)-90)+EntityX(CMesh)
PivotY#=EntityY(CMesh)
PivotZ#=Sin(EntityYaw(CMesh)-90)+EntityZ(CMesh)

PositionEntity CameraPivot,PivotX,PivotY,PivotZ

PointEntity CameraPivot,CMesh

End Function

; ###################################################################################################

Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
	PositionEntity ode\mesh,dGeomGetPositionX(ode\geom),dGeomGetPositionY(ode\geom),dGeomGetPositionZ(ode\geom)
	RotateEntity ode\mesh,dGeomGetPitch(ode\geom),dGeomGetYaw(ode\geom),dGeomGetRoll(ode\geom)
Next

End Function

; ###################################################################################################
</textarea> <br><br></td></tr></table><br>
<a name="967262"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm, where do I begin? :)<br><br>When adding additional geometry to a body, use Geom Offsets like you are doing now, not fixed joints.<br><br>Don't add stops to the cab to limit the trailer ramp, they need to be on the trailer only.<br><br>You won't need to work out the horizontal plane in radians, it's in relation to its starting position. 0.0 radians is its starting position, the hi/lo stops define the limit of movement in radians from the starting position.<br><br>Your anchor wasn't aligned properly, it was pivoting inside the ramp section instead of the edge of the ramp.<br><br>Now you've changed the geometry of the trailer, there's nothing stopping the cab geometry from colliding with the ramp section when turning. This is likely the cause of the ramp getting unstable/jammed.<br><br>Tips:<br><br>Get your alignment correct before anything else. You can pause the ODE simulation by commenting out the stepping functions in the main loop. It can help when setting up the geometry initially.<br><br>Work out the anchor point from the dimensions of the geometry. If you want the joint anchor at the edge of a box, it's the start position (box center) + half an ODE box width (don't confuse it with the Blitz cube dimensions which are 2x ODE).<br><br>Work out the maximum rotation in radians you want the joint to be limited to and set the hi/lo stops accordingly. 0.0 is the starting point, for example if you set both stops to 0.0 it won't rotate in either direction.<br><br>Here's a working version of your code...<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #                                       JV-ODE Truck Demo                                         #
; #                                  Code by Jim Williams (VIP3R)                                   #
; #                              Devious Codeworks - Copyright © 2008                               #
; ###################################################################################################

Include "JV-ODE.bb"

AppTitle "JV-ODE Car Demo - Truck &amp; Trailer"

;v2:  messing with hinges
;v3:  adding a block to the front
;v4:  squishing down trailer
;v5:  sticking walls on the trailer

Graphics3D 800,600,0,2

Global CMass#=500.0				; ### Cab Mass
Global WMass#=14.0				; ### Wheel Mass
Global TMass#=800.0				; ### Trailer Mass

Global WorldERP#=1.0			; ### World Error Correction
Global WorldFriction#=80.0		; ### World Friction

Global Torque#=48.0				; ### Joint Torque
Global SuspensionHS#=0.01		; ### Suspension Hardness/Softness (Higher=Softer - Lower=Harder)

Global Force#=0.0
Global Steer#=0.0

Global Cab
Global CGeom
Global CMesh

Global TrailerFront
Global Trailer
Global TGeom
Global TMesh

Global TLJoint

Global TDJoint
Global DoorControl=0

Global TruckStartY=4

Dim Wheel(6)
Dim WGeom(6)
Dim Joint(6)
Dim Fixedjoint(2)

Dim TWheel(6)
Dim TWGeom(6)
Dim TJoint(6)

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

; ###################################################################################################

; ### Setup ODE

dInitODE()

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,-0.98,0)
dWorldSetERP(World,WorldERP)

;dContactSetMode(dContactBounce)
;dContactSetBounce(0.1)
;dContactSetMu(48)

dContactSetMode(dContactSlip1)
dContactSetMu(WorldFriction)

; ### Create Cab

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
Cab=ode\body
dBodySetPosition(ode\body,0,TruckStartY,0)
dBodySetRotation(ode\body,0,0,0)
mass=dMassCreate()
dMassSetBoxTotal(mass,CMass,3,1,8)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
ode\geom=dCreateBox(Space,3,1,8)
CGeom=ode\geom
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
CMesh=ode\mesh
ScaleMesh ode\mesh,1.5,0.5,4
EntityColor ode\mesh,40,80,255

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,3,2,4)
dGeomSetBody(ode\geom,Cab)
dGeomSetOffsetPosition(ode\geom,0,1.5,2)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,1.5,1,2
EntityColor ode\mesh,40,80,255
EntityAlpha ode\mesh,0.7

;create vertical pillar at back of cab for 'lid' to rest on:

;ode.ODEGeom=New ODEGeom
;ode\geom=dCreateBox(Space,3,0.1,8)
;dGeomSetBody(ode\geom,Cab)
;dGeomSetOffsetPosition(ode\geom,0,1.9,-3)
;ode\mesh=CreateCube()
;ScaleMesh ode\mesh,1.5,0.05,4
;EntityColor ode\mesh,10,30,123

;end of fudge to keep lid from falling through trailer

;create vertical pillar at back of cab For 'lid' To Stop going up on:

;ode.ODEGeom=New ODEGeom
;ode\geom=dCreateBox(Space,3,0.3,7)
;dGeomSetBody(ode\geom,Cab)
;dGeomSetOffsetPosition(ode\geom,0,12.5,-2.5)
;ode\mesh=CreateCube()
;ScaleMesh ode\mesh,1.5,0.15,3.5
;EntityColor ode\mesh,10,30,123
;
;EntityAlpha ode\mesh,0.7

;end of fudge to keep lid from falling through trailer

; ### Create Wheels

For count=1 To 6
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	Wheel(count)=ode\body
	dBodySetPosition(ode\body,0,0,0)
	dBodySetRotation(ode\body,0,0,90)
	mass=dMassCreate()
	dMassSetSphereTotal(mass,WMass,0.7)
	dBodySetMass(ode\body,mass)
	dMassDestroy(mass)
	ode\geom=dCreateSphere(Space,0.7)
	WGeom(count)=ode\geom
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder()
	ScaleMesh ode\mesh,0.7,0.25,0.7
	EntityColor ode\mesh,255,255,255
Next

dBodySetPosition(Wheel(1),-2,TruckStartY-0.5,+3)
dBodySetPosition(Wheel(2),+2,TruckStartY-0.5,+3)
dBodySetPosition(Wheel(3),-2,TruckStartY-0.5,-1.5)
dBodySetPosition(Wheel(4),+2,TruckStartY-0.5,-1.5)
dBodySetPosition(Wheel(5),-2,TruckStartY-0.5,-3)
dBodySetPosition(Wheel(6),+2,TruckStartY-0.5,-3)

; ### Create Trailer

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
Trailer=ode\body
dBodySetPosition(ode\body,0,TruckStartY+.5,-10.5)
dBodySetRotation(ode\body,0,0,0)
mass=dMassCreate()
dMassSetBoxTotal(mass,TMass,5,0.4,18)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)

ode\geom=dCreateBox(Space,5,0.4,18)
TGeom=ode\geom
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
TMesh=ode\mesh
ScaleMesh ode\mesh,2.5,0.2,9
;EntityColor ode\mesh,20,40,128
EntityColor ode\mesh,40,80,255

;;add left wall of trailer
ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,0.2,4,16.5)
dGeomSetBody(ode\geom,Trailer)
dGeomSetOffsetPosition(ode\geom,2.3,1.9,-.6)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,0.1,2,8
EntityColor ode\mesh,40,80,255
EntityAlpha ode\mesh,0.7

;;add right wall of trailer
ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,0.2,4,16.5)
dGeomSetBody(ode\geom,Trailer)
dGeomSetOffsetPosition(ode\geom,-2.3,1.9,-.7)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,0.1,2,8
EntityColor ode\mesh,40,80,255
EntityAlpha ode\mesh,0.7
;

;adding a block to the front of the trailer
;ode.ODEGeom=New ODEGeom
;ode\geom=dCreateBox(Space,5,3.4,1)
;dGeomSetBody(ode\geom,Trailer)
;dGeomSetOffsetPosition(ode\geom,0,2,7)
;ode\mesh=CreateCube()
;ScaleMesh ode\mesh,2.5,1.7,0.5
;EntityColor ode\mesh,255,80,40
;EntityAlpha ode\mesh,0.7


;futile attempt at joining the new block to the front of the trailer

;Fixedjoint(1)=dJointCreateFixed(World,Trailer)
;Fixedjoint(2)=dJointCreateFixed(World,TrailerFront)
;dJointAttach(Fixedjoint(1),0,Fixedjoint(2))
;djointtypefixed
;fixedjointx=djointcreatefixed(
;fixedjoint=dConnectingJoint(Trailer,TrailerFront)
;joint2=dJointAttach(fixedjoint,Trailer,TrailerFront)

;end futile attempt

;adding a block to the front of the trailer
;ode.ODEGeom=New ODEGeom
;ode\body=dBodyCreate(World)
;TrailerFront=ode\body
;ode\geom=dCreateBox(Space,3,3,1)
;dGeomSetBody(ode\geom,TrailerFront)
;dGeomSetOffsetPosition(ode\geom,0,0,9.5)
;ode\mesh=CreateCube()
;ScaleMesh ode\mesh,1.5,1.5,0.5
;EntityColor ode\mesh,20,60,122
;EntityAlpha ode\mesh,0.7


; ### Create Tippy ramp, note needs the trailers dimensions, but with the
; ### door physics associated with it -----------------------------------
; ### simply try to add a large door to the back of the trailer which will
; ### fall forwards and lie on top of the trailer, not fall through it.


ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
dBodySetPosition(ode\body,0,TruckStartY+1,-11)
dBodySetRotation(ode\body,0,0,0)
mass=dMassCreate()
dMassSetBoxTotal(mass,10,4,0.2,16)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
ode\geom=dCreateBox(Space,4,0.2,16)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,2,0.1,8
EntityColor ode\mesh,200,40,0
EntityAlpha ode\mesh,0.9

TLJoint=dJointCreateHinge(World,0)
dJointAttach(TLJoint,Trailer,ode\body)
dJointSetHingeAnchor(TLJoint,0,TruckStartY+1,-19)
dJointSetHingeAxis(TLJoint,1,0,0)
dJointSetHingeParam(TLJoint,dParamLoStop,0)     ;suspect I may need to work out what the horizontal is in radians ?
dJointSetHingeParam(TLJoint,dParamHiStop,0.2) ; &lt;&lt;&lt;&lt; HERE



;---------------------------end create tippy ramp

; ### Create Trailer Door

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
dBodySetPosition(ode\body,0,TruckStartY+2,-19.5)
dBodySetRotation(ode\body,0,0,0)
mass=dMassCreate()
dMassSetBoxTotal(mass,2,4,3,0.2)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
ode\geom=dCreateBox(Space,4,3,0.2)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,2,1.5,0.1
EntityColor ode\mesh,0,140,100
EntityAlpha ode\mesh,0.9

TDJoint=dJointCreateHinge(World,0)
dJointAttach(TDJoint,Trailer,ode\body)
dJointSetHingeAnchor(TDJoint,0,TruckStartY+0.5,-19.5)
dJointSetHingeAxis(TDJoint,1,0,0)
dJointSetHingeParam(TDJoint,dParamLoStop,0)
dJointSetHingeParam(TDJoint,dParamHiStop,2)

; ### Create Trailer Wheels

For count=1 To 6
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	TWheel(count)=ode\body
	dBodySetPosition(ode\body,0,0,0)
	dBodySetRotation(ode\body,0,0,90)
	mass=dMassCreate()
	dMassSetSphereTotal(mass,WMass,0.7)
	dBodySetMass(ode\body,mass)
	dMassDestroy(mass)
	ode\geom=dCreateSphere(Space,0.7)
	TWGeom(count)=ode\geom
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder()
	ScaleMesh ode\mesh,0.7,0.25,0.7
	EntityColor ode\mesh,255,255,255
Next

dBodySetPosition(TWheel(1),-2,TruckStartY-0.5,-18)
dBodySetPosition(TWheel(2),+2,TruckStartY-0.5,-18)
dBodySetPosition(TWheel(3),-2,TruckStartY-0.5,-16.5)
dBodySetPosition(TWheel(4),+2,TruckStartY-0.5,-16.5)
dBodySetPosition(TWheel(5),-2,TruckStartY-0.5,-15)
dBodySetPosition(TWheel(6),+2,TruckStartY-0.5,-15)

; ### Create Objects

SeedRnd MilliSecs()

For spheres=1 To 20
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	dBodySetPosition(ode\body,Rand(-100,100),30,Rand(-100,100))
	dBodySetRotation(ode\body,0,0,0)
	ode\geom=dCreateSphere(Space,4)
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateSphere()
	ScaleMesh ode\mesh,4,4,4
	EntityColor ode\mesh,Rand(0,255),Rand(0,255),Rand(0,255)
	EntityShininess ode\mesh,0.7
Next

For capsules=1 To 20
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	dBodySetPosition(ode\body,Rand(-100,100),30,Rand(-100,100))
	dBodySetRotation(ode\body,90,0,0)
	ode\geom=dCreateCapsule(Space,1,8)
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder()
	ScaleMesh ode\mesh,1,5,1
	RotateMesh ode\mesh,90,0,0	; ### Align Blitz3D Cylinder To ODE Capsule
	EntityColor ode\mesh,Rand(0,255),Rand(0,255),Rand(0,255)
	EntityShininess ode\mesh,0.7
Next

; ### Create Light

Global Light=CreateLight()
RotateEntity Light,50,-50,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create Camera

Global CameraPivot=CreatePivot()

Global Camera=CreateCamera(CameraPivot)
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000

; ### Create Plane

dCreatePlane(Space,0,1,0,0)

Global Plane=CreatePlane()
EntityAlpha Plane,0.8

EntityTexture Plane,PlaneTexture() 

CreateMirror()

; ###################################################################################################

; ### Blitz3D Static Object (White)

Global Blitz3DObject=CreateCube()
ScaleMesh Blitz3DObject,1,4,20
PositionEntity Blitz3DObject,10,5,40
RotateEntity Blitz3DObject,-10,8,4
EntityColor Blitz3DObject,255,255,255

; ### ODE Static Object (Blue)

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,2,8,40)
dGeomSetPosition(ode\geom,20,5,40)
dGeomSetRotation(ode\geom,-10,8,4)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,1,4,20
EntityColor ode\mesh,0,100,200

; ### ODE Static Object (Red)

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,18,0.2,40)
dGeomSetPosition(ode\geom,-20,4.9,40)
dGeomSetRotation(ode\geom,-14,0,0)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,9,0.1,20
EntityColor ode\mesh,200,0,100

; ###################################################################################################

SetupTruck()

While Not KeyHit(1)

	UpdateKeys()

	UpdateTruck()

	UpdateGeoms()

	PTime=MilliSecs()

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)

	PhysicsTime#=MilliSecs()-PTime

	UpdateCam()

	RenderWorld

	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime
	Text 0,50,"Force:"+Force
	Text 0,65,"Torque:"+Torque
	Text 640,0,"A - Accelerate"
	Text 640,15,"Z - Brake/Reverse"
	Text 640,30,"Arrows - Steering"
	Text 640,45,"Space - Reset Truck"
	Text 0,100,"F1 - Raise Door, Lower trailer internal platform"
	Text 0,120,"F2 - Lower Door, Raise trailer internal platform"
	Text 0,140,"F3 - Free Door"

	Flip 1

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function SetupTruck()

For count=1 To 6
	Joint(count)=dJointCreateHinge2(World,0)
	dJointAttach(Joint(count),Cab,Wheel(count))
	dJointSetHinge2Anchor(Joint(count),dBodyGetPositionX(Wheel(count)),dBodyGetPositionY(Wheel(count)),dBodyGetPositionZ(Wheel(count)))
	dJointSetHinge2Axis1(Joint(count),0,1,0)
	dJointSetHinge2Axis2(Joint(count),-1,0,0)
	dJointSetHinge2Param(Joint(count),dParamSuspensionERP,0.8)
	dJointSetHinge2Param(Joint(count),dParamSuspensionCFM,SuspensionHS)
	If count&gt;2
		dJointSetHinge2Param(Joint(count),dParamLoStop,0)
		dJointSetHinge2Param(Joint(count),dParamHiStop,0)
		End If
Next

For count=1 To 6
	TJoint(count)=dJointCreateHinge2(World,0)
	dJointAttach(TJoint(count),Trailer,TWheel(count))
	dJointSetHinge2Anchor(TJoint(count),dBodyGetPositionX(TWheel(count)),dBodyGetPositionY(TWheel(count)),dBodyGetPositionZ(TWheel(count)))
	dJointSetHinge2Axis1(TJoint(count),0,1,0)
	dJointSetHinge2Axis2(TJoint(count),-1,0,0)
	dJointSetHinge2Param(TJoint(count),dParamSuspensionERP,0.8)
	dJointSetHinge2Param(TJoint(count),dParamSuspensionCFM,SuspensionHS)
	dJointSetHinge2Param(TJoint(count),dParamLoStop,0)
	dJointSetHinge2Param(TJoint(count),dParamHiStop,0)
Next

AJoint=dJointCreateHinge(World,0)
dJointAttach(AJoint,Trailer,Cab)
dJointSetHingeAnchor(AJoint,dBodyGetPositionX(Cab),dBodyGetPositionY(Cab),dBodyGetPositionZ(Cab)-2)
dJointSetHingeAxis(AJoint,0,1,0)
dJointSetHingeParam(AJoint,dParamSuspensionERP,0.8)
dJointSetHingeParam(AJoint,dParamSuspensionCFM,SuspensionHS)
dJointSetHingeParam(AJoint,dParamLoStop,-1.4) ; &lt;&lt;&lt;&lt; HERE - Limit cab rotation
dJointSetHingeParam(AJoint,dParamHiStop,1.4) ; &lt;&lt;&lt;&lt; HERE

End Function

; ###################################################################################################

Function UpdateKeys()

If KeyDown(30)=1
	Force=Force+0.08
	If Force&gt;30 Then Force=30
	End If

If KeyDown(44)=1
	Force=Force-0.1
	If Force&lt;-10 Then Force=-10
	If Force&gt;0 Then Force=Force*0.97
	End If

If KeyDown(30)=0 And KeyDown(44)=0 Then Force=Force*0.99

If KeyDown(203)=1 Or KeyDown(205)=1
	If KeyDown(203)=1
		Steer=0.5
		Else
		Steer=-0.5
		End If
	Else
	Steer=0.0
	End If

If KeyHit(57)=1
	Force=0.0
	dBodySetRotation(Cab,dGeomGetPitch(CGeom),dGeomGetYaw(CGeom),0)
	dBodySetRotation(Trailer,dGeomGetPitch(TGeom),dGeomGetYaw(TGeom),0)
	End If

If KeyHit(59)
	DoorControl=1
	End If

If KeyHit(60)
	DoorControl=2
	End If

If KeyHit(61)
	DoorControl=0
	End If

If DoorControl=1 ; ### Raise
	dJointSetHingeParam(TDJoint,dParamVel,-0.1)
	dJointSetHingeParam(TDJoint,dParamFMax,10)
	
	dJointSetHingeParam(TLJoint,dParamVel,-5)
	dJointSetHingeParam(TLJoint,dParamFMax,40)
	
	;dJointSetHingeParam(TLJoint,dParamVel,-45)
	;dJointSetHingeParam(TLJoint,dParamFMax,95)
	
	End If

If DoorControl=2 ; ### Lower
	dJointSetHingeParam(TDJoint,dParamVel,0.1)
	dJointSetHingeParam(TDJoint,dParamFMax,10)
	
	dJointSetHingeParam(TLJoint,dParamVel,45)
	dJointSetHingeParam(TLJoint,dParamFMax,95)
	
	;dJointSetHingeParam(TLJoint,dParamVel,5)
	;dJointSetHingeParam(TLJoint,dParamFMax,40)
	
	End If

If DoorControl=0 ; ### Free
	dJointSetHingeParam(TDJoint,dParamVel,0)
	dJointSetHingeParam(TDJoint,dParamFMax,0)
	
	dJointSetHingeParam(TLJoint,dParamVel,0)
	dJointSetHingeParam(TLJoint,dParamFMax,0)
	
	End If

End Function

; ###################################################################################################

Function UpdateTruck()

For count=1 To 6
	dBodyEnable(Wheel(count))
	dBodyEnable(TWheel(count))
Next

dBodyEnable(Cab)
dBodyEnable(Trailer)

For count=1 To 6
	dJointSetHinge2Param(Joint(count),dParamVel2,Force)
	dJointSetHinge2Param(Joint(count),dParamFMax2,Torque)
Next

For count=1 To 2
	angle#=Steer-dJointGetHinge2Angle1(Joint(count))
	dJointSetHinge2Param(Joint(count),dParamVel,angle)
	dJointSetHinge2Param(Joint(count),dParamFMax,400)
Next

End Function

; ###################################################################################################

Function UpdateCam()

PositionEntity Camera,0,10,-28
RotateEntity Camera,30,0,0

PivotX#=Cos(EntityYaw(CMesh)-90)+EntityX(CMesh)
PivotY#=EntityY(CMesh)
PivotZ#=Sin(EntityYaw(CMesh)-90)+EntityZ(CMesh)

PositionEntity CameraPivot,PivotX,PivotY,PivotZ

PointEntity CameraPivot,CMesh

End Function

; ###################################################################################################

Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
	PositionEntity ode\mesh,dGeomGetPositionX(ode\geom),dGeomGetPositionY(ode\geom),dGeomGetPositionZ(ode\geom)
	RotateEntity ode\mesh,dGeomGetPitch(ode\geom),dGeomGetYaw(ode\geom),dGeomGetRoll(ode\geom)
Next

End Function

; ###################################################################################################
</textarea><br><br>I've used the joint hi/lo stops to limit the cab and the long trailer ramp (see '&lt;&lt;&lt;&lt; HERE' in code). The trailer ramp may still need a stop block attaching to the front end of the trailer if the ramp gets unstable under heavy loads. Or even better two slider joints to simulate hydraulic pistons. So you have a 'free' hinge at the rear of the ramp and two sliders at the front, then apply force to the sliders to raise/lower the ramp.<br><br>Keep referring to the joints section on the ODE wiki until you understand how they work a little better. Your main problem is diving in without understanding the basics, which you will need when fixing problems like these. <br><br></td></tr></table><br>
<a name="967308"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thankyou VIP3R, I will keep referring to the ODE WIKI to help develop my understanding as well as your very helpful guidance.  Thanks again (;-)<br><br>The hydraulic pistons do sound intriguing..... of to try the modified code - thanks for this also just tried it its so great! <br><br></td></tr></table><br>
<a name="967568"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Santiworld</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> hi, i have a problem in a new code i wrote...<br><br>i have 1 car, and loadmesh scenary.<br><br>if i add this, the program say error on end:<br><br>piso = LoadMesh("scenary\hills.b3d")<br>track_ode = CreateTriMesh(Space,piso)<br><br>edit : now i try with this code to replace the loadmesh and createtrimesh<br>dCreatePlane(Space,0,1,0,0)<br>Global Plane=CreatePlane()<br>EntityAlpha Plane,0.5<br>CreateMirror()<br>the same problem..., i going to check the globals, etc..<br><br><br>the program run perfectly<br>but allways, when i exit, end, say error,  abnormal program termination<br>MAV, if i run without debug..<br><br>maibe i forget something in ode code... any tip?<br><br>this error on the end, only exist if i have the scenary.<br><br>thanks.. <br><br></td></tr></table><br>
<a name="967614"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Are you closing ODE properly before ending the program with <i>dCloseODE()</i>?<br><br>Other than that I have no idea, that error can occur in Blitz3D without using ODE. Like <a href="/posts.php?topic=79407" target="_blank">here</a> for example. <br><br></td></tr></table><br>
<a name="967619"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Santiworld</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> vip3r, thanks, you are a genius...!!<br>my problem is solved...<br>i need to practice more :p<br>thanks!!<br><br>ups, i don't know why, the problem persist...<br>sometimes have MAV, sometimes no, i going to work and find the error..<br><br>anyway, thanks...<br><br>this is the game, the physics works perfectly like the video shows, but sometimes have the mavs in the start, or in the end. specialy if i compile the game to a .exe file<br><br><a href="http://www.youtube.com/latatoy#play/all/uploads-all/1/tY_-Jr85dsU" target="_blank">http://www.youtube.com/latatoy#play/all/uploads-all/1/tY_-Jr85dsU</a> <br><br></td></tr></table><br>
<a name="968864"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Santiworld</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> hi,<br>i use this game loop to have 60 fps of game update, and renderworld fps depending of each computer...<br><br>sometimes have 10 fps of renderworld and allways 60 of calculations..<br> can be this code be a problem for ode?<br>regars!<br><pre class=code>
	While Not KeyHit(1)
		
		Repeat
			frameElapsed = MilliSecs () - frameTime
		Until frameElapsed
		
		frameTicks = frameElapsed / framePeriod
		frameTween# = Float (frameElapsed Mod framePeriod) / Float (framePeriod)
		
		For frameLimit = 1 To frameTicks
			
			If frameLimit = frameTicks Then CaptureWorld
			frameTime = frameTime + framePeriod
			
			tTemp = MilliSecs()		
			
			
			key_check()
			game_keys()
			car_keys()
			updategame()
			game_update_rules()
			UpdateCar()
			UpdateGeoms()
			car_velocity()
			smoke_car()
			car_collision()
			rutina_helicoptero()
			
			PTime=MilliSecs()
			dSpaceCollide(Space,World,ContactGroup)
			dWorldQuickStep(World,0.1)
			dJointGroupEmpty(ContactGroup)
			PhysicsTime#=MilliSecs()-PTime
			
			vistas()
			UpdateWorld
			
			tug_ = tug_ + MilliSecs() - tTemp		
			ups_ = ups_ + 1							
			tTemp = MilliSecs()						
			
		Next
		
		tTemp = MilliSecs()
		tuw_ = tuw_ + MilliSecs() - tTemp	
		
		RenderWorld frameTween
		
		car.car = First car
		
		Text gancho-80,galto-67,Int(car\vel*100),0,0
		
		trw_ = trw_ + MilliSecs() - tTemp			
		fps_=fps_+1		
		BarGraph()	
		msg_point()
		game_2d()
		Flip True
		
	Wend
	
	dJointGroupDestroy(ContactGroup)
	dSpaceDestroy(Space)
	dWorldDestroy(World)
	dCloseODE()
	
	End
</pre> <br><br></td></tr></table><br>
<a name="968990"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> It should be ok, if you notice any stutters you can separate the physics timing from the render timing completely. What you should aim for with ODE is a constant timing rate (60 fps) and a fixed step time (0.1 steps), regardless of the render timing.<br><br>Make sure you test it at different refresh rates to be sure it's ok. <br><br></td></tr></table><br>
<a name="970390"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> VIP3R, please help, I am trying to incorporate a car into my truck demo, I believe I have original vars for my car, however I am getting the error a joint must be connected to more than one object, as far as I can see in my setupcar I am attaching it to 2 bodies.  I Invoked a CarMesh in the belief that the code cannot have 2 CMesh vars - this did not resolve my compile error.<br><br>[EDIT] following code modified to encapsulate Global Car<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Include "JV-ODE.bb"

AppTitle "JV-ODE Car Demo - Truck &amp; Trailer"


Graphics3D 800,600,0,2

Global CMass#=500.0				; ### Cab Mass
Global WMass#=14.0				; ### Wheel Mass
Global TMass#=800.0				; ### Trailer Mass

Global WorldERP#=1.0			; ### World Error Correction
Global WorldFriction#=80.0		; ### World Friction

Global Torque#=48.0				; ### Joint Torque
Global SuspensionHS#=0.01		; ### Suspension Hardness/Softness (Higher=Softer - Lower=Harder)

Global Force#=0.0
Global Steer#=0.0

Global Cab
Global CGeom
Global CMesh

Global Car

Global CarMesh

Global TrailerFront
Global Trailer
Global TGeom
Global TMesh

Global TLJoint

Global TDJoint
Global DoorControl=0

Global TruckStartY=4
Global CarStartY=36

Dim Wheel(6)
Dim WGeom(6)
Dim Joint(6)
Dim Fixedjoint(2)

;Dim CarWheels(4)

Dim TWheel(6)
Dim TWGeom(6)
Dim TJoint(6)

Dim CWheel(4)
Dim CWGeom(4)
Dim CJoint(4)



Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

; ###################################################################################################

; ### Setup ODE

dInitODE()

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,-0.98,0)
dWorldSetERP(World,WorldERP)

;dContactSetMode(dContactBounce)
;dContactSetBounce(0.1)
;dContactSetMu(48)

dContactSetMode(dContactSlip1)
dContactSetMu(WorldFriction)

;add car

; ### Create Car Body

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
Car=ode\body
dBodySetPosition(ode\body,0,CarStartY,0)
dBodySetRotation(ode\body,0,0,0)
mass=dMassCreate()
dMassSetBoxTotal(mass,CMass,3,1,4)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
ode\geom=dCreateBox(Space,3,1,4)
CGeom=ode\geom
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
CarMesh=ode\mesh
ScaleMesh ode\mesh,1.5,0.5,2
EntityColor ode\mesh,40,80,255

; ### Create Wheels

For count=1 To 4
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	CWheel(count)=ode\body
	dBodySetPosition(ode\body,0,0,0)
	dBodySetRotation(ode\body,0,0,90)
	mass=dMassCreate()
	dMassSetSphereTotal(mass,WMass,0.7)
	dBodySetMass(ode\body,mass)
	dMassDestroy(mass)
	ode\geom=dCreateSphere(Space,0.7)
	CWGeom(count)=ode\geom
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder()
	ScaleMesh ode\mesh,0.7,0.25,0.7
	EntityColor ode\mesh,255,255,255
Next

dBodySetPosition(CWheel(1),-2,CarStartY-0.5,+2)
dBodySetPosition(CWheel(2),+2,CarStartY-0.5,+2)
dBodySetPosition(CWheel(3),-2,CarStartY-0.5,-2)
dBodySetPosition(CWheel(4),+2,CarStartY-0.5,-2)
;end add car

; ### Create Cab

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
Cab=ode\body
dBodySetPosition(ode\body,0,TruckStartY,0)
dBodySetRotation(ode\body,0,0,0)
mass=dMassCreate()
dMassSetBoxTotal(mass,CMass,3,1,8)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
ode\geom=dCreateBox(Space,3,1,8)
CGeom=ode\geom
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
CMesh=ode\mesh
ScaleMesh ode\mesh,1.5,0.5,4
EntityColor ode\mesh,40,80,255

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,3,2,4)
dGeomSetBody(ode\geom,Cab)
dGeomSetOffsetPosition(ode\geom,0,1.5,2)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,1.5,1,2
EntityColor ode\mesh,40,80,255
EntityAlpha ode\mesh,0.7

;create vertical pillar at back of cab for 'lid' to rest on:

;ode.ODEGeom=New ODEGeom
;ode\geom=dCreateBox(Space,3,0.1,8)
;dGeomSetBody(ode\geom,Cab)
;dGeomSetOffsetPosition(ode\geom,0,1.9,-3)
;ode\mesh=CreateCube()
;ScaleMesh ode\mesh,1.5,0.05,4
;EntityColor ode\mesh,10,30,123

;end of fudge to keep lid from falling through trailer

;create vertical pillar at back of cab For 'lid' To Stop going up on:

;ode.ODEGeom=New ODEGeom
;ode\geom=dCreateBox(Space,3,0.3,7)
;dGeomSetBody(ode\geom,Cab)
;dGeomSetOffsetPosition(ode\geom,0,12.5,-2.5)
;ode\mesh=CreateCube()
;ScaleMesh ode\mesh,1.5,0.15,3.5
;EntityColor ode\mesh,10,30,123
;
;EntityAlpha ode\mesh,0.7

;end of fudge to keep lid from falling through trailer

; ### Create Wheels

For count=1 To 6
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	Wheel(count)=ode\body
	dBodySetPosition(ode\body,0,0,0)
	dBodySetRotation(ode\body,0,0,90)
	mass=dMassCreate()
	dMassSetSphereTotal(mass,WMass,0.7)
	dBodySetMass(ode\body,mass)
	dMassDestroy(mass)
	ode\geom=dCreateSphere(Space,0.7)
	WGeom(count)=ode\geom
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder()
	ScaleMesh ode\mesh,0.7,0.25,0.7
	EntityColor ode\mesh,255,255,255
Next

dBodySetPosition(Wheel(1),-2,TruckStartY-0.5,+3)
dBodySetPosition(Wheel(2),+2,TruckStartY-0.5,+3)
dBodySetPosition(Wheel(3),-2,TruckStartY-0.5,-1.5)
dBodySetPosition(Wheel(4),+2,TruckStartY-0.5,-1.5)
dBodySetPosition(Wheel(5),-2,TruckStartY-0.5,-3)
dBodySetPosition(Wheel(6),+2,TruckStartY-0.5,-3)

; ### Create Trailer

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
Trailer=ode\body
dBodySetPosition(ode\body,0,TruckStartY+.5,-10.5)
dBodySetRotation(ode\body,0,0,0)
mass=dMassCreate()
dMassSetBoxTotal(mass,TMass,5,0.4,18)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)

ode\geom=dCreateBox(Space,5,0.4,18)
TGeom=ode\geom
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
TMesh=ode\mesh
ScaleMesh ode\mesh,2.5,0.2,9
;EntityColor ode\mesh,20,40,128
EntityColor ode\mesh,40,80,255

;;add left wall of trailer
ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,0.2,4,16.5)
dGeomSetBody(ode\geom,Trailer)
dGeomSetOffsetPosition(ode\geom,2.3,1.9,-.6)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,0.1,2,8
EntityColor ode\mesh,40,80,255
EntityAlpha ode\mesh,0.7

;;add right wall of trailer
ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,0.2,4,16.5)
dGeomSetBody(ode\geom,Trailer)
dGeomSetOffsetPosition(ode\geom,-2.3,1.9,-.7)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,0.1,2,8
EntityColor ode\mesh,40,80,255
EntityAlpha ode\mesh,0.7
;

;adding a block to the front of the trailer
;ode.ODEGeom=New ODEGeom
;ode\geom=dCreateBox(Space,5,3.4,1)
;dGeomSetBody(ode\geom,Trailer)
;dGeomSetOffsetPosition(ode\geom,0,2,7)
;ode\mesh=CreateCube()
;ScaleMesh ode\mesh,2.5,1.7,0.5
;EntityColor ode\mesh,255,80,40
;EntityAlpha ode\mesh,0.7


;futile attempt at joining the new block to the front of the trailer

;Fixedjoint(1)=dJointCreateFixed(World,Trailer)
;Fixedjoint(2)=dJointCreateFixed(World,TrailerFront)
;dJointAttach(Fixedjoint(1),0,Fixedjoint(2))
;djointtypefixed
;fixedjointx=djointcreatefixed(
;fixedjoint=dConnectingJoint(Trailer,TrailerFront)
;joint2=dJointAttach(fixedjoint,Trailer,TrailerFront)

;end futile attempt

;adding a block to the front of the trailer
;ode.ODEGeom=New ODEGeom
;ode\body=dBodyCreate(World)
;TrailerFront=ode\body
;ode\geom=dCreateBox(Space,3,3,1)
;dGeomSetBody(ode\geom,TrailerFront)
;dGeomSetOffsetPosition(ode\geom,0,0,9.5)
;ode\mesh=CreateCube()
;ScaleMesh ode\mesh,1.5,1.5,0.5
;EntityColor ode\mesh,20,60,122
;EntityAlpha ode\mesh,0.7


; ### Create Tippy ramp, note needs the trailers dimensions, but with the
; ### door physics associated with it -----------------------------------
; ### simply try to add a large door to the back of the trailer which will
; ### fall forwards and lie on top of the trailer, not fall through it.


ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
dBodySetPosition(ode\body,0,TruckStartY+1,-11)
dBodySetRotation(ode\body,0,0,0)
mass=dMassCreate()
dMassSetBoxTotal(mass,10,4,0.2,16)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
ode\geom=dCreateBox(Space,4,0.2,16)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,2,0.1,8
EntityColor ode\mesh,200,40,0
EntityAlpha ode\mesh,0.9

TLJoint=dJointCreateHinge(World,0)
dJointAttach(TLJoint,Trailer,ode\body)
dJointSetHingeAnchor(TLJoint,0,TruckStartY+1,-19)
dJointSetHingeAxis(TLJoint,1,0,0)
dJointSetHingeParam(TLJoint,dParamLoStop,0)     ;suspect I may need to work out what the horizontal is in radians ?
dJointSetHingeParam(TLJoint,dParamHiStop,0.2) ; &lt;&lt;&lt;&lt; HERE



;---------------------------end create tippy ramp

; ### Create Trailer Door

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
dBodySetPosition(ode\body,0,TruckStartY+2,-19.5)
dBodySetRotation(ode\body,0,0,0)
mass=dMassCreate()
dMassSetBoxTotal(mass,2,4,3,0.2)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
ode\geom=dCreateBox(Space,4,3,0.2)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,2,1.5,0.1
EntityColor ode\mesh,0,140,100
EntityAlpha ode\mesh,0.9

TDJoint=dJointCreateHinge(World,0)
dJointAttach(TDJoint,Trailer,ode\body)
dJointSetHingeAnchor(TDJoint,0,TruckStartY+0.5,-19.5)
dJointSetHingeAxis(TDJoint,1,0,0)
dJointSetHingeParam(TDJoint,dParamLoStop,0)
dJointSetHingeParam(TDJoint,dParamHiStop,2)

; ### Create Trailer Wheels

For count=1 To 6
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	TWheel(count)=ode\body
	dBodySetPosition(ode\body,0,0,0)
	dBodySetRotation(ode\body,0,0,90)
	mass=dMassCreate()
	dMassSetSphereTotal(mass,WMass,0.7)
	dBodySetMass(ode\body,mass)
	dMassDestroy(mass)
	ode\geom=dCreateSphere(Space,0.7)
	TWGeom(count)=ode\geom
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder()
	ScaleMesh ode\mesh,0.7,0.25,0.7
	EntityColor ode\mesh,255,255,255
Next

dBodySetPosition(TWheel(1),-2,TruckStartY-0.5,-18)
dBodySetPosition(TWheel(2),+2,TruckStartY-0.5,-18)
dBodySetPosition(TWheel(3),-2,TruckStartY-0.5,-16.5)
dBodySetPosition(TWheel(4),+2,TruckStartY-0.5,-16.5)
dBodySetPosition(TWheel(5),-2,TruckStartY-0.5,-15)
dBodySetPosition(TWheel(6),+2,TruckStartY-0.5,-15)

; ### Create Objects

SeedRnd MilliSecs()

For spheres=1 To 20
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	dBodySetPosition(ode\body,Rand(-100,100),30,Rand(-100,100))
	dBodySetRotation(ode\body,0,0,0)
	ode\geom=dCreateSphere(Space,4)
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateSphere()
	ScaleMesh ode\mesh,4,4,4
	EntityColor ode\mesh,Rand(0,255),Rand(0,255),Rand(0,255)
	EntityShininess ode\mesh,0.7
Next

For capsules=1 To 20
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	dBodySetPosition(ode\body,Rand(-100,100),30,Rand(-100,100))
	dBodySetRotation(ode\body,90,0,0)
	ode\geom=dCreateCapsule(Space,1,8)
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder()
	ScaleMesh ode\mesh,1,5,1
	RotateMesh ode\mesh,90,0,0	; ### Align Blitz3D Cylinder To ODE Capsule
	EntityColor ode\mesh,Rand(0,255),Rand(0,255),Rand(0,255)
	EntityShininess ode\mesh,0.7
Next

; ### Create Light

Global Light=CreateLight()
RotateEntity Light,50,-50,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create Camera

Global CameraPivot=CreatePivot()

Global Camera=CreateCamera(CameraPivot)
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000

; ### Create Plane

dCreatePlane(Space,0,1,0,0)

Global Plane=CreatePlane()
EntityAlpha Plane,0.8

EntityTexture Plane,PlaneTexture() 

CreateMirror()

; ###################################################################################################

; ### Blitz3D Static Object (White)

Global Blitz3DObject=CreateCube()
ScaleMesh Blitz3DObject,1,4,20
PositionEntity Blitz3DObject,10,5,40
RotateEntity Blitz3DObject,-10,8,4
EntityColor Blitz3DObject,255,255,255

; ### ODE Static Object (Blue)

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,2,8,40)
dGeomSetPosition(ode\geom,20,5,40)
dGeomSetRotation(ode\geom,-10,8,4)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,1,4,20
EntityColor ode\mesh,0,100,200

; ### ODE Static Object (Red)

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,18,0.2,40)
dGeomSetPosition(ode\geom,-20,4.9,40)
dGeomSetRotation(ode\geom,-14,0,0)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,9,0.1,20
EntityColor ode\mesh,200,0,100

; ###################################################################################################

SetupCar()

SetupTruck()

;SetupCar()

While Not KeyHit(1)

	UpdateKeys()

	UpdateTruck()
	
	UpdateCar()

	UpdateGeoms()

	PTime=MilliSecs()

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)

	PhysicsTime#=MilliSecs()-PTime

	UpdateCam()

	RenderWorld

	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime
	Text 0,50,"Force:"+Force
	Text 0,65,"Torque:"+Torque
	Text 640,0,"A - Accelerate"
	Text 640,15,"Z - Brake/Reverse"
	Text 640,30,"Arrows - Steering"
	Text 640,45,"Space - Reset Truck"
	Text 0,100,"F1 - Raise Door, Lower trailer internal platform"
	Text 0,120,"F2 - Lower Door, Raise trailer internal platform"
	Text 0,140,"F3 - Free Door"

	Flip 1

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function SetupTruck()

For count=1 To 6
	Joint(count)=dJointCreateHinge2(World,0)
	dJointAttach(Joint(count),Cab,Wheel(count))
	dJointSetHinge2Anchor(Joint(count),dBodyGetPositionX(Wheel(count)),dBodyGetPositionY(Wheel(count)),dBodyGetPositionZ(Wheel(count)))
	dJointSetHinge2Axis1(Joint(count),0,1,0)
	dJointSetHinge2Axis2(Joint(count),-1,0,0)
	dJointSetHinge2Param(Joint(count),dParamSuspensionERP,0.8)
	dJointSetHinge2Param(Joint(count),dParamSuspensionCFM,SuspensionHS)
	If count&gt;2
		dJointSetHinge2Param(Joint(count),dParamLoStop,0)
		dJointSetHinge2Param(Joint(count),dParamHiStop,0)
		End If
Next

For count=1 To 6
	TJoint(count)=dJointCreateHinge2(World,0)
	dJointAttach(TJoint(count),Trailer,TWheel(count))
	dJointSetHinge2Anchor(TJoint(count),dBodyGetPositionX(TWheel(count)),dBodyGetPositionY(TWheel(count)),dBodyGetPositionZ(TWheel(count)))
	dJointSetHinge2Axis1(TJoint(count),0,1,0)
	dJointSetHinge2Axis2(TJoint(count),-1,0,0)
	dJointSetHinge2Param(TJoint(count),dParamSuspensionERP,0.8)
	dJointSetHinge2Param(TJoint(count),dParamSuspensionCFM,SuspensionHS)
	dJointSetHinge2Param(TJoint(count),dParamLoStop,0)
	dJointSetHinge2Param(TJoint(count),dParamHiStop,0)
Next

AJoint=dJointCreateHinge(World,0)
dJointAttach(AJoint,Trailer,Cab)
dJointSetHingeAnchor(AJoint,dBodyGetPositionX(Cab),dBodyGetPositionY(Cab),dBodyGetPositionZ(Cab)-2)
dJointSetHingeAxis(AJoint,0,1,0)
dJointSetHingeParam(AJoint,dParamSuspensionERP,0.8)
dJointSetHingeParam(AJoint,dParamSuspensionCFM,SuspensionHS)
dJointSetHingeParam(AJoint,dParamLoStop,-1.4) ; &lt;&lt;&lt;&lt; HERE - Limit cab rotation
dJointSetHingeParam(AJoint,dParamHiStop,1.4) ; &lt;&lt;&lt;&lt; HERE

End Function

Function SetupCar()

For count=1 To 4
	CJoint(count)=dJointCreateHinge2(World,0)
	dJointAttach(CJoint(count),Car,CWheel(count))
	dJointSetHinge2Anchor(CJoint(count),dBodyGetPositionX(CWheel(count)),dBodyGetPositionY(CWheel(count)),dBodyGetPositionZ(CWheel(count)))
	dJointSetHinge2Axis1(CJoint(count),0,1,0)
	dJointSetHinge2Axis2(CJoint(count),-1,0,0)
	dJointSetHinge2Param(CJoint(count),dParamSuspensionERP,0.8)
	dJointSetHinge2Param(CJoint(count),dParamSuspensionCFM,SuspensionHS)
	If count&gt;2
		dJointSetHinge2Param(CJoint(count),dParamLoStop,0)
		dJointSetHinge2Param(CJoint(count),dParamHiStop,0)
		End If
Next

End Function

; ###################################################################################################

Function UpdateKeys()

If KeyDown(30)=1
	Force=Force+0.08
	If Force&gt;30 Then Force=30
	End If

If KeyDown(44)=1
	Force=Force-0.1
	If Force&lt;-10 Then Force=-10
	If Force&gt;0 Then Force=Force*0.97
	End If

If KeyDown(30)=0 And KeyDown(44)=0 Then Force=Force*0.99

If KeyDown(203)=1 Or KeyDown(205)=1
	If KeyDown(203)=1
		Steer=0.5
		Else
		Steer=-0.5
		End If
	Else
	Steer=0.0
	End If

If KeyHit(57)=1
	Force=0.0
	dBodySetRotation(Cab,dGeomGetPitch(CGeom),dGeomGetYaw(CGeom),0)
	dBodySetRotation(Trailer,dGeomGetPitch(TGeom),dGeomGetYaw(TGeom),0)
	End If

If KeyHit(59)
	DoorControl=1
	End If

If KeyHit(60)
	DoorControl=2
	End If

If KeyHit(61)
	DoorControl=0
	End If

If DoorControl=1 ; ### Raise
	dJointSetHingeParam(TDJoint,dParamVel,-0.1)
	dJointSetHingeParam(TDJoint,dParamFMax,10)
	
	dJointSetHingeParam(TLJoint,dParamVel,-5)
	dJointSetHingeParam(TLJoint,dParamFMax,40)
	
	;dJointSetHingeParam(TLJoint,dParamVel,-45)
	;dJointSetHingeParam(TLJoint,dParamFMax,95)
	
	End If

If DoorControl=2 ; ### Lower
	dJointSetHingeParam(TDJoint,dParamVel,0.1)
	dJointSetHingeParam(TDJoint,dParamFMax,10)
	
	dJointSetHingeParam(TLJoint,dParamVel,45)
	dJointSetHingeParam(TLJoint,dParamFMax,95)
	
	;dJointSetHingeParam(TLJoint,dParamVel,5)
	;dJointSetHingeParam(TLJoint,dParamFMax,40)
	
	End If

If DoorControl=0 ; ### Free
	dJointSetHingeParam(TDJoint,dParamVel,0)
	dJointSetHingeParam(TDJoint,dParamFMax,0)
	
	dJointSetHingeParam(TLJoint,dParamVel,0)
	dJointSetHingeParam(TLJoint,dParamFMax,0)
	
	End If

End Function

; ###################################################################################################

Function UpdateTruck()

For count=1 To 6
	dBodyEnable(Wheel(count))
	dBodyEnable(TWheel(count))
Next

dBodyEnable(Cab)
dBodyEnable(Trailer)

For count=1 To 6
	dJointSetHinge2Param(Joint(count),dParamVel2,Force)
	dJointSetHinge2Param(Joint(count),dParamFMax2,Torque)
Next

For count=1 To 2
	angle#=Steer-dJointGetHinge2Angle1(Joint(count))
	dJointSetHinge2Param(Joint(count),dParamVel,angle)
	dJointSetHinge2Param(Joint(count),dParamFMax,400)
Next

End Function

Function UpdateCar()

For count=1 To 4
	dBodyEnable(CWheel(count))
Next

dBodyEnable(Car)

For count=1 To 4
	dJointSetHinge2Param(CJoint(count),dParamVel2,Force)
	dJointSetHinge2Param(CJoint(count),dParamFMax2,Torque)
Next

For count=1 To 2
	angle#=Steer-dJointGetHinge2Angle1(CJoint(count))
	dJointSetHinge2Param(CJoint(count),dParamVel,angle)
	dJointSetHinge2Param(CJoint(count),dParamFMax,400)
Next
;
End Function

; ###################################################################################################

Function UpdateCam()

PositionEntity Camera,0,10,-28
RotateEntity Camera,30,0,0

PivotX#=Cos(EntityYaw(CMesh)-90)+EntityX(CMesh)
PivotY#=EntityY(CMesh)
PivotZ#=Sin(EntityYaw(CMesh)-90)+EntityZ(CMesh)

PositionEntity CameraPivot,PivotX,PivotY,PivotZ

PointEntity CameraPivot,CMesh

End Function

; ###################################################################################################

Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
	PositionEntity ode\mesh,dGeomGetPositionX(ode\geom),dGeomGetPositionY(ode\geom),dGeomGetPositionZ(ode\geom)
	RotateEntity ode\mesh,dGeomGetPitch(ode\geom),dGeomGetYaw(ode\geom),dGeomGetRoll(ode\geom)
Next

End Function

; ###################################################################################################


</textarea> <br><br></td></tr></table><br>
<a name="970436"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> You haven't declared the 'Car' variable as global, so it doesn't exist when you try to attach the joint to it.<br><br>Add 'Global Car' to the list of globals. <br><br></td></tr></table><br>
<a name="970510"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> thanks VIP3R, going to try it now.  That solved it - thankyou. <br><br></td></tr></table><br>
<a name="974462"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> VIP3R, I am attempting to add a height map to a version of the car demo. I've read in some previous posts that it maybe necessary to add trimeshes the same shape as the 'terrain' you are adding in order for vehicles etc to be able to drive 'on' the imported heightmap.<br><br>Is there simply one or two lines of code that I am missing or do I have to use a 3d scenery trimesh creation utility from the heightmap I want to use to create land to drive on? I am quite excited about developing the method to incorporate Digital Elevation Files - I created some in a paint application on an older computer some years ago, and fancied a drive around them. <br><br>I've included my current version of my demo, which uses a 64x64 bitmap made in paint for a texture to paint the heightmap.  The heightmap I am using is a 1024x1024 jpeg which is as close to black as possible giving 1 pixel of height - hence the wheels 'sinking' into the terrain slightly.<br><br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #                                        JV-ODE Car Demo                                          #
; #                                  Code by Jim Williams (VIP3R)                                   #
; #                              Devious Codeworks - Copyright © 2008                               #
; ###################################################################################################

; Blitzplotter Versioning note: Attempting to add a height map
; files called within this are simply a 64x64 bitmap made with Paint for a floor texture
; And a 1024x1024 jpeg edited with gimp which is as close to  pure black
; as possibly without actually being black giving the 1 pixel or so
; of height.
;
; "height4.jpg"   :   64 by 64 pixels texture for the colour of the ground
; "ground_bmp_64.bmp"  :  1024 x 1024 height map, all at a very low level

Include "JV-ODE.bb"

AppTitle "JV-ODE Car Demo"

Graphics3D 800,600,0,2

Global CMass#=200.0				; ### Car Mass
Global WMass#=14.0				; ### Wheel Mass

Global WorldERP#=1.0			; ### World Error Correction
Global WorldFriction#=70.0		; ### World Friction

Global Torque#=24.0				; ### Joint Torque
Global SuspensionHS#=0.01		; ### Suspension Hardness/Softness (Higher=Softer - Lower=Harder)

Global Force#=0.0
Global Steer#=0.0

Global Car
Global CGeom
Global CMesh

Global CarStartY=20

Dim Wheel(4)
Dim WGeom(4)
Dim Joint(4)

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

; ###################################################################################################

; ### Setup ODE

dInitODE()

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,-0.98,0)
dWorldSetERP(World,WorldERP)

dContactSetMode(dContactSlip1)
dContactSetMu(WorldFriction)

; ### add a terrain height map
;TERRAIN
Global terrain = LoadTerrain("height4.jpg")
TerrainDetail terrain,2500,True
ScaleEntity terrain, 3,15,3
PositionEntity terrain,-1000,0,-530
;ter_tex = LoadTexture("mossyground.bmp")
ter_tex = LoadTexture("ground_bmp_64.bmp")
EntityTexture terrain,ter_tex
EntityRadius terrain,0.2
EntityType terrain,SCENERY

dContactSetMode(dContactBounce)
dContactSetBounce(0.1)
dContactSetMu(48)

dContactSetMode(dContactSlip1)
dContactSetMu(WorldFriction)

; ### end of add a terrain height map

; ### Create Car Body

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
Car=ode\body
dBodySetPosition(ode\body,0,CarStartY,0)
dBodySetRotation(ode\body,0,0,0)
mass=dMassCreate()
dMassSetBoxTotal(mass,CMass,3,1,4)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
ode\geom=dCreateBox(Space,3,1,4)
CGeom=ode\geom
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
CMesh=ode\mesh
ScaleMesh ode\mesh,1.5,0.5,2
EntityColor ode\mesh,40,80,255

; ### Create Wheels

For count=1 To 4
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	Wheel(count)=ode\body
	dBodySetPosition(ode\body,0,0,0)
	dBodySetRotation(ode\body,0,0,90)
	mass=dMassCreate()
	dMassSetSphereTotal(mass,WMass,0.7)
	dBodySetMass(ode\body,mass)
	dMassDestroy(mass)
	ode\geom=dCreateSphere(Space,0.7)
	WGeom(count)=ode\geom
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder()
	ScaleMesh ode\mesh,0.7,0.25,0.7
	EntityColor ode\mesh,255,255,255
Next

dBodySetPosition(Wheel(1),-2,CarStartY-0.5,+2)
dBodySetPosition(Wheel(2),+2,CarStartY-0.5,+2)
dBodySetPosition(Wheel(3),-2,CarStartY-0.5,-2)
dBodySetPosition(Wheel(4),+2,CarStartY-0.5,-2)

; ### Create Objects

SeedRnd MilliSecs()

For spheres=1 To 20
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	dBodySetPosition(ode\body,Rand(-100,100),30,Rand(-100,100))
	dBodySetRotation(ode\body,0,0,0)
	ode\geom=dCreateSphere(Space,4)
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateSphere()
	ScaleMesh ode\mesh,4,4,4
	EntityColor ode\mesh,Rand(0,255),Rand(0,255),Rand(0,255)
	EntityShininess ode\mesh,0.7
Next

For capsules=1 To 20
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	dBodySetPosition(ode\body,Rand(-100,100),30,Rand(-100,100))
	dBodySetRotation(ode\body,90,0,0)
	ode\geom=dCreateCapsule(Space,1,8)
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder()
	ScaleMesh ode\mesh,1,5,1
	RotateMesh ode\mesh,90,0,0	; ### Align Blitz3D Cylinder To ODE Capsule
	EntityColor ode\mesh,Rand(0,255),Rand(0,255),Rand(0,255)
	EntityShininess ode\mesh,0.7
Next

; ### Create Light

Global Light=CreateLight()
RotateEntity Light,50,-50,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create Camera

Global CameraPivot=CreatePivot()

Global Camera=CreateCamera(CameraPivot)
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000

; ### Create Plane

dCreatePlane(Space,0,1,0,0)

Global Plane=CreatePlane()
EntityAlpha Plane,0.8

EntityTexture Plane,PlaneTexture()

CreateMirror()

; ###################################################################################################

; ### Blitz3D Static Object (White)

Global Blitz3DObject=CreateCube()
ScaleMesh Blitz3DObject,1,4,20
PositionEntity Blitz3DObject,10,5,40
RotateEntity Blitz3DObject,-10,8,4
EntityColor Blitz3DObject,255,255,255

; ### ODE Static Object (Blue)

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,2,8,40)
dGeomSetPosition(ode\geom,20,5,40)
dGeomSetRotation(ode\geom,-10,8,4)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,1,4,20
EntityColor ode\mesh,0,100,200

; ### ODE Static Object (Red)

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,18,0.2,40)
dGeomSetPosition(ode\geom,-20,4.9,40)
dGeomSetRotation(ode\geom,-14,0,0)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,9,0.1,20
EntityColor ode\mesh,200,0,100

; ###################################################################################################

SetupCar()

While Not KeyHit(1)

	UpdateKeys()

	UpdateCar()

	UpdateGeoms()

	PTime=MilliSecs()

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)

	PhysicsTime#=MilliSecs()-PTime

	UpdateCam()

	RenderWorld

	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime
	Text 0,50,"Force:"+Force
	Text 0,65,"Torque:"+Torque
	Text 640,0,"A - Accelerate"
	Text 640,15,"Z - Brake/Reverse"
	Text 640,30,"Arrows - Steering"
	Text 640,45,"Space - Reset Car"

	Flip 1

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function SetupCar()

For count=1 To 4
	Joint(count)=dJointCreateHinge2(World,0)
	dJointAttach(Joint(count),Car,Wheel(count))
	dJointSetHinge2Anchor(Joint(count),dBodyGetPositionX(Wheel(count)),dBodyGetPositionY(Wheel(count)),dBodyGetPositionZ(Wheel(count)))
	dJointSetHinge2Axis1(Joint(count),0,1,0)
	dJointSetHinge2Axis2(Joint(count),-1,0,0)
	dJointSetHinge2Param(Joint(count),dParamSuspensionERP,0.8)
	dJointSetHinge2Param(Joint(count),dParamSuspensionCFM,SuspensionHS)
	If count&gt;2
		dJointSetHinge2Param(Joint(count),dParamLoStop,0)
		dJointSetHinge2Param(Joint(count),dParamHiStop,0)
		End If
Next

End Function

; ###################################################################################################

Function UpdateKeys()

If KeyDown(30)=1
	Force=Force+0.08
	If Force&gt;30 Then Force=30
	End If

If KeyDown(44)=1
	Force=Force-0.1
	If Force&lt;-10 Then Force=-10
	If Force&gt;0 Then Force=Force*0.97
	End If

If KeyDown(30)=0 And KeyDown(44)=0 Then Force=Force*0.99

If KeyDown(203)=1 Or KeyDown(205)=1
	If KeyDown(203)=1
		Steer=0.5
		Else
		Steer=-0.5
		End If
	Else
	Steer=0.0
	End If

If KeyHit(57)=1
	Force=0.0
	dBodySetRotation(Car,dGeomGetPitch(CGeom),dGeomGetYaw(CGeom),0)
	End If

End Function

; ###################################################################################################

Function UpdateCar()

For count=1 To 4
	dBodyEnable(Wheel(count))
Next

dBodyEnable(Car)

For count=1 To 4
	dJointSetHinge2Param(Joint(count),dParamVel2,Force)
	dJointSetHinge2Param(Joint(count),dParamFMax2,Torque)
Next

For count=1 To 2
	angle#=Steer-dJointGetHinge2Angle1(Joint(count))
	dJointSetHinge2Param(Joint(count),dParamVel,angle)
	dJointSetHinge2Param(Joint(count),dParamFMax,400)
Next

End Function

; ###################################################################################################

Function UpdateCam()

PositionEntity Camera,0,3,-12

PivotX#=Cos(EntityYaw(CMesh)-90)+EntityX(CMesh)
PivotY#=EntityY(CMesh)
PivotZ#=Sin(EntityYaw(CMesh)-90)+EntityZ(CMesh)

PositionEntity CameraPivot,PivotX,PivotY,PivotZ

PointEntity CameraPivot,CMesh

End Function

; ###################################################################################################

Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
	PositionEntity ode\mesh,dGeomGetPositionX(ode\geom),dGeomGetPositionY(ode\geom),dGeomGetPositionZ(ode\geom)
	RotateEntity ode\mesh,dGeomGetPitch(ode\geom),dGeomGetYaw(ode\geom),dGeomGetRoll(ode\geom)
Next

End Function

; ###################################################################################################





</textarea> <br><br></td></tr></table><br>
<a name="974649"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi BP,<br><br>You need to convert the heightmap into a mesh (.B3D) for the ODE collision geometry. There might be some code or small app that can convert heightmaps to meshes if I recall correctly. Check the code archives and toolbox sections.<br><br>Once converted, use your heightmap terrain for rendering and the mesh for the ODE geometry. <br><br></td></tr></table><br>
<a name="974722"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks VIP3R, of to do some digging - I've found the following function, I've just to figure out how to call it &amp; how it becomes associated with a heightmap, or will I need to use the F.L.E editor to create a static mesh from the heightmap &amp; create the trimesh from the static mesh. A quick look at the tools available makes EG Heightmap companion look pretty appealing.<br><br>Apologies if there is an obvious answer to my next query, however I am attempting to attach a cars wheels to a body, the following two mages display the problem I am experiencing:<br><br>[EDIT]<br><br>I am offsetting the wheels so that they appear under the car, when I tried this the mesh of the car was lopsided.  In order to try and establish the problem I reverted to the cube and unsurprisingly the cube was off to the right. but it would appear the car mesh appears offset to the left of where B3D thinks it is.  The carmesh itself was converted from a 3ds format with Ultimate Unwrap 3D - I am suspecting there 'maybe' something I need to tweak within that with regards to the car mesh. If you have a simple solution in code that can manipulate the mesh to behave I'd apprecaite it. I know this may be more of a modelling issue than a JV-ODE issue, but if you've encountered this before I'd appreciate your feedback, thanks.<br><br>[EDIT]<br><br>I tried modifying the code as follows, but I beleive I'm on the worng track with this:<br><br>[EDIT]<br><br><br>I'm also attempting to incorporate RifRaf's recent particle engine into my game, the lightning effect is working well. <br><br></td></tr></table><br>
<a name="976645"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Chroma</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> VIP3R, where do I download the latest version of JV-ODE? <br><br></td></tr></table><br>
<a name="976666"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> @BP: You haven't posted the important bit so I'm guessing you missed it. The code that positions the wheels in the demos is as follows...<br><pre class=code>
dBodySetPosition(Wheel(1),-2,CarStartY-0.5,+2)
dBodySetPosition(Wheel(2),+2,CarStartY-0.5,+2)
dBodySetPosition(Wheel(3),-2,CarStartY-0.5,-2)
dBodySetPosition(Wheel(4),+2,CarStartY-0.5,-2)
</pre>You'll need to add the <i>CarStartX/Z</i> vars if you haven't done so already. If you're finding the initial positioning difficult, comment out the stepping function in the main loop to pause the physics.<br><br><br>@Chroma: I'm still waiting for you to confirm your registered details as I don't have your name/email from your Blitz profile as a registered user.<br><br>See <a href="/posts.php?topic=63207#970245" target="_blank">here</a><br><br>Let me know and I'll update your info and send a new download link for you. <br><br></td></tr></table><br>
<a name="976696"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Santiworld</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> hi.. i have a new doubt about ode.<br><br>if i create a ode-cube, in a space without gravity, and i won to control that cube like it was a spaceship...<br><br>how can i rotate the ode-cube using your own axis?<br><br>there is a function to aplly dBodySetAngularVel or something like that? using own axis?<br><br>this using one objetct, without joins... <br><br>i can aplly forces correctly, but not rotate..<br><br>i aplly some forces in this way<br><br>fx# =   afx# +  Sin(yaw) * -pitch * obj\pot * vh   <br>afy# =  afy# +  Sin(pitch+90) * obj\pot * 600<br>afz# =  afz# +  -Sin(yaw+90) * -pitch * obj\pot * vh <br>		<br>dbodyaddforce obj\body, afx,afy,afz<br><br>regards...<br><br><br>santiago - latatoy programmer <br><br></td></tr></table><br>
<a name="976719"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Santiworld</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> i`m going to answer my self..<br><br>dBodyAddForce <br>dBodyAddrelForce<br><br>i found that function to rotate and move in relative axis, excelent function's <br><br></td></tr></table><br>
<a name="976774"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> There are also functions for applying forces at a specific point on a body too, like a spaceship thruster...<br><br><i>dBodyAddForceAtPos(body,fx#,fy#,fz#,px#,py#,pz#)<br>dBodyAddForceAtRelPos(body,fx#,fy#,fz#,px#,py#,pz#)<br>dBodyAddRelForceAtPos(body,fx#,fy#,fz#,px#,py#,pz#)<br>dBodyAddRelForceAtRelPos(body,fx#,fy#,fz#,px#,py#,pz#)</i> <br><br></td></tr></table><br>
<a name="976791"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> @VIP3R, I've edited out the codebox above and re-posted my current code here - omitting the x,y &amp; z co-ords of the wheels wasn't very useful from a code diagnosis perspective - sorry.  I've been playing with the wheels position in relation to the car mesh to see what co-ordinates allows the car mesh to balance on top of the wheels without the car body lilting to the left or right. The following is the code that makes the car physics stop tilting to the left or right for all the mesh is off centre.  I can't quite see the point of stopping the physics from updating, don't the physics need to be working in order to see if the car body will tilt left or right ?  I've also uploaded my potentially problematic car mesh to the following link:<br><br>[edit]<br><br>The car is somewhat of a gargantuan 0.82MBytes - not very low poly!<br>note you cannot see the left two wheels of the car (they are under the middle of the car) however the right two are offset to the right of the car mesh.<br><br>[edit]<br><br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ### Create Car Body

;use_block_car=0 ;0 for use car mesh

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
Car=ode\body
dBodySetPosition(ode\body,CarStartX-1.8,CarStartY,CarStartZ)
dBodySetRotation(ode\body,0,0,0)
mass=dMassCreate()
dMassSetBoxTotal(mass,CMass,2,1.2,3.6) ; x of 2 too big for car mesh, changed
                                        ; to 1 but now when revert to cube problem is worse
;dMassSetBoxTotal(mass,CMass,1,1.2,3.6)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
ode\geom=dCreateBox(Space,2,1.2,3.6)  ; x of 2 to big for car mesh,changed to 1
                                       ; but now when revert to cube problem is worse
;ode\geom=dCreateBox(Space,1,1.2,3.6)
CGeom=ode\geom
dGeomSetBody(ode\geom,ode\body)
If use_block_car=1
	ode\mesh=CreateCube()
Else
	ode\mesh=car1_body
EndIf
CarMesh=ode\mesh
ScaleMesh ode\mesh,1,0.6,1.8
RotateMesh(ode\mesh,0,180,0)
EntityColor ode\mesh,40,80,255

; Create cars textured wheels

For count=1 To 4

    sphere_fact_const=1.3;
	scale_fact_const=1.0;		Note necessary to display wheel
	                    ;       Had to increment to stop wheels
	                    ;       sinking through floor
	wheel_scale=1.32     ;      
	wheel_scale_width=7.0     ;      
	

    RotateEntity car1_wheel(count),90,0,0

ScaleMesh car1_wheel(count),wheel_scale,wheel_scale_width,wheel_scale

	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	CWheel(count)=ode\body
	dBodySetRotation(ode\body,0,0,0)
	dBodySetPosition(ode\body,0,0,0)
	mass=dMassCreate()
	dMassSetSphereTotal(mass,WMass,0.7)
	dBodySetMass(ode\body,mass)
	dMassDestroy(mass)
	ode\geom=dCreateSphere(Space,0.7)
	CWGeom(count)=ode\geom
	dGeomSetBody(ode\geom,ode\body)
	;ode\mesh=CreateCylinder(8)
	ode\mesh=car1_wheel(count) 
	;EntityTexture ode\mesh, txt
	ScaleMesh ode\mesh,0.7,0.25,0.7
	RotateMesh ode\mesh,0,0,90
	PositionMesh ode\mesh,0,0,0
	EntityColor ode\mesh,255,255,255
Next

If use_block_car=1
	;note following good for cube not car body
	dBodySetPosition(CWheel(1),-1.25+CarStartX,CarStartY-1.1,CarStartZ+2)
	dBodySetPosition(CWheel(2),+1.25+CarStartX,CarStartY-1.1,CarStartZ+2)
	dBodySetPosition(CWheel(3),-1.25+CarStartX,CarStartY-1.1,CarStartZ-2)
	dBodySetPosition(CWheel(4),+1.25+CarStartX,CarStartY-1.1,CarStartZ-2)
Else
	;note these co-ordinates make the car mesh balance evenly on the wheels,
	;despite the fact the car mesh appears to be off set to the left during execution
	;am now beginning to suspect that the car mesh is wider than the model appears on
	;the screen
	dBodySetPosition(CWheel(1),-3.25+CarStartX,CarStartY-1.1,CarStartZ+3)
	dBodySetPosition(CWheel(2),-0.75+CarStartX,CarStartY-1.1,CarStartZ+3)
	dBodySetPosition(CWheel(3),-3.25+CarStartX,CarStartY-1.1,CarStartZ-2)
	dBodySetPosition(CWheel(4),-0.75+CarStartX,CarStartY-1.1,CarStartZ-2)
EndIf





</textarea><br><br>I thought I'd try moving the wheels to the left by modifying the codebox above to read:<br><br><pre class=code>

If use_block_car=1
	;note following good for cube not car body
	dBodySetPosition(CWheel(1),-1.25+CarStartX,CarStartY-1.1,CarStartZ+2)
	dBodySetPosition(CWheel(2),+1.25+CarStartX,CarStartY-1.1,CarStartZ+2)
	dBodySetPosition(CWheel(3),-1.25+CarStartX,CarStartY-1.1,CarStartZ-2)
	dBodySetPosition(CWheel(4),+1.25+CarStartX,CarStartY-1.1,CarStartZ-2)
Else
	;note these co-ordinates make the car mesh balance evenly on the wheels,
	;despite the fact the car mesh appears to be off set to the left during execution
	;am now beginning to suspect that the car mesh is wider than the model appears on
	;the screen
;	dBodySetPosition(CWheel(1),-3.25+CarStartX,CarStartY-1.1,CarStartZ+3)
;	dBodySetPosition(CWheel(2),-0.75+CarStartX,CarStartY-1.1,CarStartZ+3)
;	dBodySetPosition(CWheel(3),-3.25+CarStartX,CarStartY-1.1,CarStartZ-2)
;	dBodySetPosition(CWheel(4),-0.75+CarStartX,CarStartY-1.1,CarStartZ-2)
	
	dBodySetPosition(CWheel(1),-5.25+CarStartX,CarStartY-1.1,CarStartZ+3)
	dBodySetPosition(CWheel(2),-1.75+CarStartX,CarStartY-1.1,CarStartZ+3)
	dBodySetPosition(CWheel(3),-5.25+CarStartX,CarStartY-1.1,CarStartZ-2)
	dBodySetPosition(CWheel(4),-1.75+CarStartX,CarStartY-1.1,CarStartZ-2)
EndIf


</pre><br><br>However this resulted in the car tipping over to one side straight away, despite the wheels looking like they are directly beneath the 'visible' car, makes me suspect I may need to analyse the mesh of the car:<br> [edit] <br><br></td></tr></table><br>
<a name="976836"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Santiworld</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#32">[#32]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Vip3r. :) <br><br></td></tr></table><br>
<a name="976870"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#33">[#33]</a></td></tr></table></td></tr><tr ><td class="posttext"> No problem ;)<br><br>@BP: Ok, I think it would be best if you revert back to the cube before doing the following, as the changes you've already made could make things even more confusing.<br><br>The car is tipping because the body is still in the center, but the geometry is offset to one side. This indicates that the car mesh isn't centered, the origin (center) should be in the center of the mesh. You can fix this in an editor or in code.<br><br>First, replace the cube in your reverted code with the mesh. If you've centered it in the editor it will be more or less in line with the wheels. If you want to adjust the position of the mesh in code, just use <b>PositionMesh()</b>. ( Note: Not PositionEntity()! )<br><br>Next, to line the wheels up, pause the physics by commenting out the stepping function. It makes it easier when <b>initially positioning</b> objects like the wheels, re-read my post above. Now you can adjust the coords of the wheels until they're in the correct place.<br><br>Once everything is lined up, allow the physics to step again. Now you just need to tweak it ;) <br><br></td></tr></table><br>
<a name="976880"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#34">[#34]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the quick feedback VIP3R, I've just made an astounding breakthrough (as far as I'm concerned anyway) with threading in one of the most excellent particle systems available on the forums - The Devil Particle System. I've threaded it into one of the simple car demos.  This is a significant step towards smoke emanating from the exhaust on my artic rig within JV-ODE, I did spend some time threading RifRaf particle system into my somewhat more complex Artic Rig Code &amp; had the lighnting working, however the smoke compatibility between RifRaf's &amp; JV-ODE eluded me. Not so with Devilish - to be fair I have not tried threading RifRaf's excellent particle generator into a simpler version of the JV-ODE code. <br><br>PositionMesh - you little beauty! I do not want to 'litter' the thread with too many images, so I've removed a few images from above.<br><br><img src="http://www.wishingwellsoftware.co.uk/smoke99.jpg"> <br><br></td></tr></table><br>
<a name="976910"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#35">[#35]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm, any particle system should work fine with JV-ODE. I haven't used either one that you've mentioned but there isn't anything that would cause incompatibility between them.<br><br>Just make sure you're referencing the Blitz3D entities with the particle system and not the ODE objects. <br><br></td></tr></table><br>
<a name="976919"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#36">[#36]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm sure that with a little more perseverance RifRaf's will work, in fact the lightning effect is already working in tandem with my JV-ODE code. I did not mean to suggest that it would not - it is just that I found the Devil Particle system so much easier to thread into code containing JV-ODE.  It may simply be the case that the Devil Particle system needs less fathoming in how to use it with other engines due to the simple code examples you have the option to use.<br><br>Not to take anything at all away from RifRafs particle system, I'm still very impressed with it and it has plus points in other areas compared to the Devil Particle system.  RifRaf's code is well commented however the Devil Particle system breaks down the different elements of his particle system into separate code listings which makes it easier to marry up to other code.<br><br>The positionmesh command is working great, thanks again. <br><br></td></tr></table><br>
<a name="976966"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Santiworld</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#37">[#37]</a></td></tr></table></td></tr><tr ><td class="posttext"> i have some questions, conceptual questions..<br><br>how can i create a infinite ode ocean water ?..<br><br>i saw the water demo, and iceberg demo of ode, the two samples, the water is a cube. i need a very big ocean, something like 100x100 km, maibe 1000x1000km., only water...<br><br>i want to put some naval ship, on the water, and other shings, like icebergs, plataforms, etc.. <br><br>i think to made one function like this.<br><br>if entityY(ode\mesh) &lt; 0 then (the mesh is under the water)?<br><br>maibe i can put some big cube, but 1000x1000 km, is very large for a ode obj.<br><br><br>have you some advice to how can i do that?... <br><br></td></tr></table><br>
<a name="977120"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#38">[#38]</a></td></tr></table></td></tr><tr ><td class="posttext"> @BP: You're welcome :)<br><br>@Latatoy: You could try a very large cube or a plane for the water, but I've no idea how well it would work. If you don't want a flat water surface then it's going to be very difficult as ODE is designed for rigid body physics only, water is best simulated with soft body physics engines.<br><br>There's also this article on simulating buoyancy in ODE which might help...<br><a href="http://opende.sourceforge.net/wiki/index.php/HOWTO_simulate_buoyant_objects" target="_blank">http://opende.sourceforge.net/wiki/index.php/HOWTO_simulate_buoyant_objects</a> <br><br></td></tr></table><br>
<a name="977275"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Santiworld</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#39">[#39]</a></td></tr></table></td></tr><tr ><td class="posttext"> i create a realy big cube, to use like ocean water.<br><br>the cube dimmension are : 100000x1000x100000    (bliz units)<br><br>100000 = 100km in my game...<br><br>ode work perfectly :)... <br><br></td></tr></table><br>
<a name="977952"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Santiworld</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#40">[#40]</a></td></tr></table></td></tr><tr ><td class="posttext"> hi. i have a ROPE question...<br><br>i use the demo sample rope to make a rope..<br><br>but if i attach to the end of the rope a heavy object, the rope don't maintain the large, is like elastic rope if i load it.<br><br>how can i config the joints to get a rope without elasticity?<br><br>i try with thhis parameters, but nothing..<br><br><br><pre class=code>
dJointSetuniversalParam(obj\joint,dParamSuspensionERP,0.0)
				dJointSetuniversalParam(obj\joint,dParamSuspensionCFM,0.0)
				dJointSetuniversalParam(obj\joint,dParamBounce,0.0)
				dJointSetuniversalParam(obj\joint,dParamStopERP,0.1)
				dJointSetuniversalParam(obj\joint,dParamStopCFM,0.0)
				dJointSetuniversalParam(obj\joint,dParamFMax,0.01)
				dJointSetuniversalParam(obj\joint,dParamFudgeFactor,0.1)
						dJointSetuniversalParam(obj\joint,dParamHiStop,0.1)

</pre><br><br>regads!.. <br><br></td></tr></table><br>
<a name="978299"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#41">[#41]</a></td></tr></table></td></tr><tr ><td class="posttext"> The two parameters needed would be...<br><br><i>dParamSuspensionERP<br>dParamSuspensionCFM</i><br><br>But, these are only implemented on the Hinge2 joint.<br><br>You could try using a maximum ERP and very low CFM with <i>dWorldSetERP/CFM()</i>, this will affect everything in the simulation though.<br><br>If the joints are coming apart (or elastic) then the weight is probably much too heavy, I'm not sure if there's a solution to this other than using a lower weight. <br><br></td></tr></table><br>
<a name="981773"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Happy Sammy</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#42">[#42]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi VIP3R,<br><br>I sent an email requesting changed email and a discount code. <br>Could you receive it? (using "@wtt-mail.com")<br><br>Thanks in advance <br><br></td></tr></table><br>
<a name="981858"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#43">[#43]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Sammy,<br><br>I haven't received your email, can you resend it?<br><br>I've sent a discount code to your registered email address anyway (to the @wtt-mail.com address). <br><br></td></tr></table><br>
<a name="981884"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Happy Sammy</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#44">[#44]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks a lot, VIP3R. <br><br></td></tr></table><br>
<a name="981983"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#45">[#45]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi VIP3R,<br><br>Is it possible to add a variable to a capsule/sphere, increment the variable when the object is static (i.e. stops moving) then remove that object after the variable reaches a certain amount - for example 30 seconds ?<br><br>Regards,<br><br>BP <br><br></td></tr></table><br>
<a name="982027"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#46">[#46]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, make sure the capsule/sphere has auto-disable mode activated with <i>dBodySetAutoDisableFlag(body,1)</i>, then check the status of the object with <i>dBodyIsEnabled(body)</i> and increment the variable when it's disabled (returns zero). Now remove the object when the variable reaches whatever amount you choose. <br><br></td></tr></table><br>
<a name="982185"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#47">[#47]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks VIP3R, will implement it tonight.  I presume the dBodyIsEnabled function will be executed<br> within the UpdateGeoms function ?  I'm thinking of using<br> a single dimension array to track each 3D item in the <br> world.  Coding with beer goggle makes for slow progress... progress nonetheless. <br><br></td></tr></table><br>
<a name="982397"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#48">[#48]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can use dBodyIsEnabled(body) anywhere, it doesn't need to be in the UpdateGeoms() function. <br><br></td></tr></table><br>
<a name="982728"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#49">[#49]</a></td></tr></table></td></tr><tr ><td class="posttext"> Morning VIP3R, I have successfully idenitifed spheres or cylinders that are up for deletion using the following code:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">

; check all cylinders that are moving:
	For amt_cyls=1 To cyls_count
		If dBodyIsEnabled(cyls_body_array(amt_cyls,1))				cyls_body_array(amt_cyls,2)=0
					
		Else
		cyls_body_array(amt_cyls,2)=cyls_body_array(amt_cyls,2)+1
			If cyls_body_array(amt_cyls,2)&gt;=100
				Text 40,cy_plot,"cyl_body: "+amt_cyls+" NOT moved 250 times"
				;debug now:
				amount_cyl_stopped=amount_cyl_stopped+1
						
				If cyls_body_array(amt_cyls,2)&gt;=140 
					Text 400,400,"Attempting Destroy"+amt_cyls
					dGeomDestroy(cyls_body_array(amt_cyls,1))
				EndIf
						
				;Text 40,cy_plot+22,"amount_cyl_stopped: "+amount_cyl_stopped
				cy_plot=cy_plot+22
			EndIf
			cyls_moving_count=cyls_moving
		EndIf
	Next
	cy_plot=90
	amount_cyl_stopped=0

</textarea><br><br>I've inserted the following piece of code to attempt to delete an item once it has been detected as not moving, however I receive a memory access violation - I've refered to the function instructions to source the following command however I believe I need to perform the object deletion in some other manner.  I was hoping that the memory reference to each cylinder that'd been created would be in some kind of linked list allowing for deletion of an item from that list without affecting the position in memory of the items before and after it. Maybe not though?<br><br><pre class=code>

If cyls_body_array(amt_cyls,2)&gt;=140 
	Text 400,400,"Attempting Destroy"+amt_cyls
	dGeomDestroy(cyls_body_array(amt_cyls,1))
EndIf


;the array is defined at the top of the code with the following:

Dim cyls_body_array(500,2)   ;max of 500 cyls with 2nd element being
                             ;a count of how long since last moved


</pre><br><br>I (attempt to) identify the cylinder's place in memeory by populating an array within the following code:<br><br><pre class=code>
Function AddObjectcapsule(xpos,zed)

xp#=Rand(-10,10)
zp#=Rand(-10,10)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
dBodySetPosition(ode\body,(xp+120+(xpos*10)),90,(70+zp)+zed)
dBodySetRotation(ode\body,90,0,0)
dBodySetAutoDisableFlag(ode\body,1)
ode\geom=dCreateCapsule(Space,1,8)
dGeomSetBody(ode\geom,ode\body)
cyls_count=cyls_count+1
cyls_body_array(cyls_count,1)=ode\body ;use this array to contain the position in memory
                                       ;of each of the cylinders in the world


ode\mesh=CreateCylinder()
ScaleMesh ode\mesh,1,5,1
RotateMesh ode\mesh,90,0,0	; ### Align Blitz3D Cylinder To ODE Capsule
EntityColor ode\mesh,Rand(0,255),Rand(0,255),Rand(0,255)
EntityShininess ode\mesh,0.7

End Function

</pre> <br><br></td></tr></table><br>
<a name="982909"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#50">[#50]</a></td></tr></table></td></tr><tr ><td class="posttext"> The error is due to the wrong type of object being deleted, you're calling dGeomDestroy() to delete a body...<br><br><i>dGeomDestroy(cyls_body_array(amt_cyls,1))</i><br><br>You need to destroy objects in the reverse order that they were created, first destroy the geom of the object, then the body...<br><br><i>dGeomDestroy(cyls_GEOM_array(amt_cyls,1))<br>dBodyDestroy(cyls_BODY_array(amt_cyls,1))</i> <br><br></td></tr></table><br>
<a name="982942"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#51">[#51]</a></td></tr></table></td></tr><tr ><td class="posttext"> thanks, I modified my function to incorporate storage of the memory position of the GEOM first [EDIT](just mod'd the code slightly, executing now to see if resolved):-<br><br>[EDIT] I was trying to remove the object twice, so I needed a flag to set when an object has been removed to stop it from being removed twice, which was causing the MAV, my logic error - I should have consulted my design (;-) <br><br></td></tr></table><br>
<a name="983136"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Al Meyer</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#52">[#52]</a></td></tr></table></td></tr><tr ><td class="posttext"> VIP3R, can you send me the email for version 1.32? Thank you <br><br></td></tr></table><br>
<a name="983276"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#53">[#53]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sure, email sent :) <br><br></td></tr></table><br>
<a name="983306"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Al Meyer</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#54">[#54]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thank you. This is the best lib for Blitz3D :) <br><br></td></tr></table><br>
<a name="984239"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#55">[#55]</a></td></tr></table></td></tr><tr ><td class="posttext"> VIP3R, is it possible to load an animated model created with Pacemaker without any conflicts with JV-ODE? <br><br></td></tr></table><br>
<a name="984645"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#56">[#56]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sure, as long as you don't try to animate the model and apply physics to it simultaneously ;) <br><br></td></tr></table><br>
<a name="985266"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#57">[#57]</a></td></tr></table></td></tr><tr ><td class="posttext"> I am trying to animate the model without applying physics to it - I think.   The following is the 'virgin code' that successfully animates the zombie (i.e. no JV-ODE within it)<br><br>[EDIT]  Its okay I've sussed it. <br><br></td></tr></table><br>
<a name="986614"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#58">[#58]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi VIP3R, I've created a cylinder, got it to appear above the cab of my truck within my game.  My ultimate goal is to have it point at a specific entity (i.e. the car in the image below).  The code I am using is detailed below, the variable carnum is a global which is assigned to CarMesh higher up the code:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Function UpdateCam()

PositionEntity Camera,0,12,-28
RotateEntity Camera,30,0,0

If lookat=0
	PivotX#=Cos(EntityYaw(CMesh)-90)+EntityX(CMesh)
	PivotY#=EntityY(CMesh)
	PivotZ#=Sin(EntityYaw(CMesh)-90)+EntityZ(CMesh)
Else
	PivotX#=Cos(EntityYaw(CarMesh)-90)+EntityX(CarMesh)
	PivotY#=EntityY(CarMesh)
	PivotZ#=Sin(EntityYaw(CarMesh)-90)+EntityZ(CarMesh)
EndIf

PositionEntity CameraPivot,PivotX,PivotY,PivotZ

If lookat=0
	PointEntity CameraPivot,CMesh
Else
	PointEntity CameraPivot,CarMesh	
EndIf

End Function

; ###################################################################################################
Function UpdateGeoms(); tie smoke to truck

For ode.ODEGeom=Each ODEGeom
	PositionEntity ode\mesh,dGeomGetPositionX(ode\geom),dGeomGetPositionY(ode\geom),dGeomGetPositionZ(ode\geom)
	RotateEntity ode\mesh,dGeomGetPitch(ode\geom),dGeomGetYaw(ode\geom),dGeomGetRoll(ode\geom)
	If funnelnum=ode\geom
		PositionEntity emitter,dGeomGetPositionX(ode\geom),dGeomGetPositionY(ode\geom)+2.5,dGeomGetPositionZ(ode\geom)
	EndIf
	
	;now attempt to stick a pointer higher than the truck
	If pointnum=ode\geom
		PositionEntity emitter,dGeomGetPositionX(ode\geom),dGeomGetPositionY(ode\geom)+4.5,dGeomGetPositionZ(ode\geom)
		
		;I have declared a Global PointerPivot at the top of the code, I suspect I need to parent the
		;pointnum entity to the PointerPivot then manipulate the pointer around the pointer specific
		;pivot somehow to point at the car, have tried to extrapolate how I should implement this
		;along the lines of the UpdateCam function above but it is eluding me.
		
		; PointEntity PointerPivot,CarMesh
		
		PointEntity emitter,CarMesh
	EndIf

Next
</textarea> <br><br>For now I am attampting to point it towards the car in the image below, however the cylinder stays in alignment with the cab of the truck - is there anything obvious I am doing wrong ?<br><br>[EDIT] <br><br></td></tr></table><br>
<a name="986683"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#59">[#59]</a></td></tr></table></td></tr><tr ><td class="posttext"> The problem there is you're using the physics to control the pointer object and at the same time move it manually with the PointEntity function. One is overriding the other.<br><br>If the pointer doesn't need any physics response (I can't see why it would), you should just use a Blitz3D entity without the physics, then you will be able to point it at the car with PointEntity. <br><br></td></tr></table><br>
<a name="986753"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#60">[#60]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks VIP3R, I suspected this might have been the case, and I've just managed to detect which side of my dice/cubes are 'up' by attaching pivots to each side of a cube, happy days indeed.  Thankyou again for providing such an excellent physics lib for the community. <br><br></td></tr></table><br>
<a name="992863"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >EmerGki</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#61">[#61]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Vip3r,<br><br>Are some "limitation" in the whell radius?  I'm trying to use a wheel with the radius minor than 0.7 (default value of your demos) but, my car always stops... <br><br></td></tr></table><br>
<a name="992887"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Play</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#62">[#62]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello!<br>How can I easily check whether the car from the demo is moving or standing still? Check this by differences in function entityX(), entityZ(), or is there any faster way ? <br><br></td></tr></table><br>
<a name="992930"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#63">[#63]</a></td></tr></table></td></tr><tr ><td class="posttext"> @EmerGki: No limitation, are you sure the chassis isn't touching the ground and causing the 'stop'?<br><br>@Play: You can check the EntityX/Z() differences, that will be fast, I'm not sure there's a faster way. <br><br></td></tr></table><br>
<a name="992967"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >EmerGki</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#64">[#64]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes Vip3r, I have tested it, and, one time, I have created the chassis body a bit far from the ground to test... <br><br></td></tr></table><br>
<a name="993017"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#65">[#65]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've tested it too and it works fine for me :)<br><br>Here's the car demo with a wheel radius of 0.1 instead of 0.7 ...<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #                                        JV-ODE Car Demo                                          #
; #                                  Code by Jim Williams (VIP3R)                                   #
; #                              Devious Codeworks - Copyright © 2008                               #
; ###################################################################################################

Include "JV-ODE.bb"

AppTitle "JV-ODE Car Demo"

Graphics3D 800,600,0,2

Global CMass#=200.0				; ### Car Mass
Global WMass#=14.0				; ### Wheel Mass

Global WorldERP#=1.0			; ### World Error Correction
Global WorldFriction#=70.0		; ### World Friction

Global Torque#=24.0				; ### Joint Torque
Global SuspensionHS#=0.01		; ### Suspension Hardness/Softness (Higher=Softer - Lower=Harder)

Global Force#=0.0
Global Steer#=0.0

Global Car
Global CGeom
Global CMesh

Global CarStartY=20

Dim Wheel(4)
Dim WGeom(4)
Dim Joint(4)

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

; ###################################################################################################

; ### Setup ODE

dInitODE()

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,-0.98,0)
dWorldSetERP(World,WorldERP)

dContactSetMode(dContactSlip1)
dContactSetMu(WorldFriction)

; ### Create Car Body

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
Car=ode\body
dBodySetPosition(ode\body,0,CarStartY,0)
dBodySetRotation(ode\body,0,0,0)
mass=dMassCreate()
dMassSetBoxTotal(mass,CMass,3,1,4)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
ode\geom=dCreateBox(Space,3,1,4)
CGeom=ode\geom
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
CMesh=ode\mesh
ScaleMesh ode\mesh,1.5,0.5,2
EntityColor ode\mesh,40,80,255

; ### Create Wheels

For count=1 To 4
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	Wheel(count)=ode\body
	dBodySetPosition(ode\body,0,0,0)
	dBodySetRotation(ode\body,0,0,90)
	mass=dMassCreate()
	dMassSetSphereTotal(mass,WMass,0.1)
	dBodySetMass(ode\body,mass)
	dMassDestroy(mass)
	ode\geom=dCreateSphere(Space,0.1)
	WGeom(count)=ode\geom
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder()
	ScaleMesh ode\mesh,0.1,0.1,0.1
	EntityColor ode\mesh,255,255,255
Next

dBodySetPosition(Wheel(1),-2,CarStartY-1.5,+2)
dBodySetPosition(Wheel(2),+2,CarStartY-1.5,+2)
dBodySetPosition(Wheel(3),-2,CarStartY-1.5,-2)
dBodySetPosition(Wheel(4),+2,CarStartY-1.5,-2)

; ### Create Objects

SeedRnd MilliSecs()

For spheres=1 To 20
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	dBodySetPosition(ode\body,Rand(-100,100),30,Rand(-100,100))
	dBodySetRotation(ode\body,0,0,0)
	ode\geom=dCreateSphere(Space,4)
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateSphere()
	ScaleMesh ode\mesh,4,4,4
	EntityColor ode\mesh,Rand(0,255),Rand(0,255),Rand(0,255)
	EntityShininess ode\mesh,0.7
Next

For capsules=1 To 20
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	dBodySetPosition(ode\body,Rand(-100,100),30,Rand(-100,100))
	dBodySetRotation(ode\body,90,0,0)
	ode\geom=dCreateCapsule(Space,1,8)
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder()
	ScaleMesh ode\mesh,1,5,1
	RotateMesh ode\mesh,90,0,0	; ### Align Blitz3D Cylinder To ODE Capsule
	EntityColor ode\mesh,Rand(0,255),Rand(0,255),Rand(0,255)
	EntityShininess ode\mesh,0.7
Next

; ### Create Light

Global Light=CreateLight()
RotateEntity Light,50,-50,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create Camera

Global CameraPivot=CreatePivot()

Global Camera=CreateCamera(CameraPivot)
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000

; ### Create Plane

dCreatePlane(Space,0,1,0,0)

Global Plane=CreatePlane()
EntityAlpha Plane,0.8

EntityTexture Plane,PlaneTexture()

CreateMirror()

; ###################################################################################################

; ### Blitz3D Static Object (White)

Global Blitz3DObject=CreateCube()
ScaleMesh Blitz3DObject,1,4,20
PositionEntity Blitz3DObject,10,5,40
RotateEntity Blitz3DObject,-10,8,4
EntityColor Blitz3DObject,255,255,255

; ### ODE Static Object (Blue)

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,2,8,40)
dGeomSetPosition(ode\geom,20,5,40)
dGeomSetRotation(ode\geom,-10,8,4)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,1,4,20
EntityColor ode\mesh,0,100,200

; ### ODE Static Object (Red)

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,18,0.2,40)
dGeomSetPosition(ode\geom,-20,4.9,40)
dGeomSetRotation(ode\geom,-14,0,0)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,9,0.1,20
EntityColor ode\mesh,200,0,100

; ###################################################################################################

SetupCar()

While Not KeyHit(1)

	UpdateKeys()

	UpdateCar()

	UpdateGeoms()

	PTime=MilliSecs()

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)

	PhysicsTime#=MilliSecs()-PTime

	UpdateCam()

	RenderWorld

	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime
	Text 0,50,"Force:"+Force
	Text 0,65,"Torque:"+Torque
	Text 640,0,"A - Accelerate"
	Text 640,15,"Z - Brake/Reverse"
	Text 640,30,"Arrows - Steering"
	Text 640,45,"Space - Reset Car"

	Flip 1

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function SetupCar()

For count=1 To 4
	Joint(count)=dJointCreateHinge2(World,0)
	dJointAttach(Joint(count),Car,Wheel(count))
	dJointSetHinge2Anchor(Joint(count),dBodyGetPositionX(Wheel(count)),dBodyGetPositionY(Wheel(count)),dBodyGetPositionZ(Wheel(count)))
	dJointSetHinge2Axis1(Joint(count),0,1,0)
	dJointSetHinge2Axis2(Joint(count),-1,0,0)
	dJointSetHinge2Param(Joint(count),dParamSuspensionERP,0.8)
	dJointSetHinge2Param(Joint(count),dParamSuspensionCFM,SuspensionHS)
	If count&gt;2
		dJointSetHinge2Param(Joint(count),dParamLoStop,0)
		dJointSetHinge2Param(Joint(count),dParamHiStop,0)
		End If
Next

End Function

; ###################################################################################################

Function UpdateKeys()

If KeyDown(30)=1
	Force=Force+0.08
	If Force&gt;30 Then Force=30
	End If

If KeyDown(44)=1
	Force=Force-0.1
	If Force&lt;-10 Then Force=-10
	If Force&gt;0 Then Force=Force*0.97
	End If

If KeyDown(30)=0 And KeyDown(44)=0 Then Force=Force*0.99

If KeyDown(203)=1 Or KeyDown(205)=1
	If KeyDown(203)=1
		Steer=0.5
		Else
		Steer=-0.5
		End If
	Else
	Steer=0.0
	End If

If KeyHit(57)=1
	Force=0.0
	dBodySetRotation(Car,dGeomGetPitch(CGeom),dGeomGetYaw(CGeom),0)
	End If

End Function

; ###################################################################################################

Function UpdateCar()

For count=1 To 4
	dBodyEnable(Wheel(count))
Next

dBodyEnable(Car)

For count=1 To 4
	dJointSetHinge2Param(Joint(count),dParamVel2,Force)
	dJointSetHinge2Param(Joint(count),dParamFMax2,Torque)
Next

For count=1 To 2
	angle#=Steer-dJointGetHinge2Angle1(Joint(count))
	dJointSetHinge2Param(Joint(count),dParamVel,angle)
	dJointSetHinge2Param(Joint(count),dParamFMax,400)
Next

End Function

; ###################################################################################################

Function UpdateCam()

PositionEntity Camera,0,3,-12

PivotX#=Cos(EntityYaw(CMesh)-90)+EntityX(CMesh)
PivotY#=EntityY(CMesh)
PivotZ#=Sin(EntityYaw(CMesh)-90)+EntityZ(CMesh)

PositionEntity CameraPivot,PivotX,PivotY,PivotZ

PointEntity CameraPivot,CMesh

End Function

; ###################################################################################################

Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
	PositionEntity ode\mesh,dGeomGetPositionX(ode\geom),dGeomGetPositionY(ode\geom),dGeomGetPositionZ(ode\geom)
	RotateEntity ode\mesh,dGeomGetPitch(ode\geom),dGeomGetYaw(ode\geom),dGeomGetRoll(ode\geom)
Next

End Function

; ###################################################################################################
</textarea> <br><br></td></tr></table><br>
<a name="993365"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Chroma</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#66">[#66]</a></td></tr></table></td></tr><tr ><td class="posttext"> VIP3R,  I bought your ODE awhile back.  How do I get the latest updates? <br><br></td></tr></table><br>
<a name="993373"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#67">[#67]</a></td></tr></table></td></tr><tr ><td class="posttext"> Chroma, do you ever read my responses?<br><br>I've already answered this question 3 times, once via email, once <a href="/posts.php?topic=85346#976666" target="_blank">above</a> and once <a href="/posts.php?topic=63207#970245" target="_blank">here</a>.<br><br>Like I said in the previous post above...<br><br><div class="quote"> I'm still waiting for you to confirm your registered details as I don't have your name/email from your Blitz profile as a registered user.<br><br>See <a href="/posts.php?topic=63207#970245" target="_blank">here</a><br><br>Let me know and I'll update your info and send a new download link for you. <br></div> <br><br></td></tr></table><br>
<a name="993420"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#68">[#68]</a></td></tr></table></td></tr><tr ><td class="posttext"> The see here link returns: ERROR:Internal error<br><br>8) <br><br></td></tr></table><br>
<a name="993541"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#69">[#69]</a></td></tr></table></td></tr><tr ><td class="posttext"> [edit] Wayne, the BlitzMax Module Tweaks forum is hidden, do you have access to it?<br><br>[edit] Removed domain from link above (thanks Hotcakes) <br><br></td></tr></table><br>
<a name="994270"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Play</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#70">[#70]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br>I have another question:<br>I have a car from Cardemo example and suppose that it moves. I would like to move a car in another place after some key hit. Something like this:<br><pre class=code>
If KeyHit(57)
	Steer=0
	Force=0.0
	dBodySetRotation(car,0,0,0)
	dBodySetPosition(Car,0,5,0)
End If
</pre><br>Unfortunately, when I use this command abd push a spacebar button, car starts to rotate, and generally behave in unexpected way..<br>What do I do that, car simply moved to another place, without rotation and no other things are not needed ?<br><br>#edit<br>ok after searching I found something like this:<br><pre class=code>
If KeyHit(57)=1
	Force=0
	Torque=1000

	dBodySetAngularVel(Car,0,0,0)
	dBodySetLinearVel(Car,0,0,0)
	For count=1 To 4
		dBodySetAngularVel(Wheel(count),0,0,0)
		dBodySetLinearVel(Wheel(count),0,0,0)
	Next
	dBodySetPosition(Car,dBodyGetPositionX(car),5,dBodyGetPositionZ(car))
	dBodySetRotation(Car,0,0,0)
Else
	torque=24
End If
</pre><br><br>This works ok, but only when I use:dBodyGetPositionx/y/z<br><br>but I depend on me to be able to provide a parameter value:Entityx/y/z<br>but unfortunately when I do it, again begins to rotate etc..<br><br>2#edit<br>dammit it's even worst- 	<br>I thought that I can use dBodySetPosition() with any dbodyGetPosition, but this only works when i'm using the same body to set and get pos..<br>I'm Waiting for any help..<br>thanks<br><br>3#edit<br>	<br>I found a topic about this that in order to move the car, I have to reset the torque, force and velo. But despite the fact that I'm doing it for both cars and the wheels, after calling the command dbodysetposition car flies off somewhere far far away .. <br><br></td></tr></table><br>
<a name="994354"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#71">[#71]</a></td></tr></table></td></tr><tr ><td class="posttext"> You're almost there, in your example code the force and torque still get re-applied once the body is moved, causing it to catapult off into the distance.<br><br>You need to zero the force, torque <i>and</i> velocity on each body before moving them...<br><br><i>dBodySetForce(body,0,0,0)<br>dBodySetTorque(body,0,0,0)<br>dBodySetAngularVel(body,0,0,0)<br>dBodySetLinearVel(body,0,0,0)</i> <br><br></td></tr></table><br>
<a name="994626"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Chroma</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#72">[#72]</a></td></tr></table></td></tr><tr ><td class="posttext"> Can you send an email to the email in my profile again.  No idea what happened to the first one.<br><br>OMG it shouldn't be this hard...<br><br>Update or refund...your choice. <br><br></td></tr></table><br>
<a name="994639"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#73">[#73]</a></td></tr></table></td></tr><tr ><td class="posttext"> .. <br><br></td></tr></table><br>
<a name="994647"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#74">[#74]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Chroma, I agree, JV-ODE rocks.<br><br><br><br>VIP3R,I've been trying to opt for manipulating my dice shaker so that it is at an angle of say 45 degrees, with the opended end (note there is not one at the moment but this is easy to resolve) and rotating it along it along its 'long' axis.<br><br>My goal is for when the player is ready to throw the dice, the shaker will tip through say 50 to 80 degress allowing the dice which are bouncing about inside the shaker to be 'thrown' from the shaker.<br><br>My feeble attempts at connecting an anchor to the shaker have only resulted in compile errors.  I even contemplated simply adding to large wheels, the diameter of which would be bigger than the ends of the shaker - rolling the shaker along its long axis (basically like an axle) then removing a wheel to let the dice spill out - maybe.<br><br>I even briefly toyed with the rope demo with the goal of tying a chain to the shaker, allowing the user to grab the chain to tip the shaker over.<br><br>Any suggestions you have greatfully appreciated - BP. <br><br><br>The code is listed below for a little throw a couple of dice program I've been developing:<br><br>Note the dice model used in the code is available from here:<br><br><a href="http://www.wishingwellsoftware.co.uk/nicedice1.b3d" target="_blank">http://www.wishingwellsoftware.co.uk/nicedice1.b3d</a><br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #                                        JV-ODE Dice Demo                                         #
; #                                  Code by J Williams &amp; M Gormley                                 #
; #               JV-ODE bits courtesy of Devious Codeworks - Copyright © 2008                      #
; ###################################################################################################

;;v18 tidy code a little



Include "JV-ODE.bb"

AppTitle "Chuck 2 dice"

Graphics3D 800,600,0,2

Global CMass#=50.0				; ### Car Mass
Global WMass#=14.0				; ### Wheel Mass
Global DMass#=50.0               ; ### Dice Mass

Global WorldERP#=1.0			; ### World Error Correction
Global WorldFriction#=70.0		; ### World Friction

Global Torque#=24.0				; ### Joint Torque
Global SuspensionHS#=0.01		; ### Suspension Hardness/Softness (Higher=Softer - Lower=Harder)

Global Force#=0.0
Global Steer#=0.0

Global Car
Global CGeom
Global CMesh
Global TMesh					; Note:  necessary to make these global so that

Global DMesh					; you can choose multiple cameras
Global EMesh

Global lookat=2					; look at the traier first
Global lookrange=2



Global SKYSIZE=4800

Dim Wheel(4)
Dim WGeom(4)
Dim Joint(5)

Dim TWheel(6)
Dim TWGeom(6)
Dim TJoint(6)

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

Dim dicestring$(5)
dicestring$(0)="1"
dicestring$(1)="3"
dicestring$(2)="2"   
dicestring$(3)="5"
dicestring$(4)="6"
dicestring$(5)="4"

Dim DJoint(2)

; #############
;
; setup dice vars

;  Note modify the path(s) to whereever you put the nicedice1.b3d model
;  The model is available from <a href="http://www.wishingwellsoftware.co.uk/nicedice1.b3d" target="_blank">http://www.wishingwellsoftware.co.uk/nicedice1.b3d</a>

your_path$=("H:\TORTOISE\top_level_tort_check_ootski\UltimateUnwrapProjects")

filepathdice$=(your_path$+"/Dice/nicedice1.b3d") 

;filepathcity$=(yourpath$+"blender gimp images\city1.b3d")
filepathcity$=(yourpath$+"/Dice/nicedice1.b3d")

Global loadcereal=0  ;0 loads dice for texturing

Dim top_side(7)
Dim bottom_side(7)
Dim front_side(7)
Dim left_side(7)
Dim right_side(7)
Dim back_side(7)

Dim mesh_with_children(7)


Global DiceStartz=1

Dim store_dice_sides_mem(10,10)

count=1		
mesh_with_children(count) = LoadAnimMesh( filepathdice$ )

mesh_with_children(2) = LoadAnimMesh( filepathdice$ )

;citymesh = Loadentity(filepathcity$)


;--------------------------------
; end setup dice vars
;-----------------------------------

; ###################################################################################################

; ### Setup ODE

dInitODE()

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,-0.98,0)
dWorldSetERP(World,WorldERP)

dContactSetMode(dContactSlip1)
dContactSetMu(WorldFriction)

;; ### add a terrain height map
;;TERRAIN
;Global terrain = LoadTerrain("height4.jpg")
;TerrainDetail terrain,2500,True
;ScaleEntity terrain, 3,15,3
;PositionEntity terrain,-1000,0,-530
;;ter_tex = LoadTexture("mossyground.bmp")
;ter_tex = LoadTexture("ground_bmp_64.bmp")
;EntityTexture terrain,ter_tex
;EntityRadius terrain,0.2
;EntityType terrain,SCENERY


;SKY
Global sky = CreateSphere(16,camera_pivot)
FlipMesh sky
ScaleEntity sky,SKYSIZE,SKYSIZE,SKYSIZE
PositionEntity sky, 0,50,0
sky_tex = LoadTexture("C:/Program Files/GetFit/sky.bmp")
EntityTexture sky,sky_tex





;make the dice, car &amp; dice shaker fall from a variable altitude


; Set the randomizer seed for more true random numbers 
SeedRnd (MilliSecs()) 

; Generate random numbers between 1 and 100 

howhigh= Rand(1,100) 
	
highfactor=3

Global CarStartY=highfactor*howhigh

Global DiceStarty=highfactor*howhigh

TruckStartY=(highfactor*howhigh)-12
truckZ=10
TMass=200

; end altitude settings




scale = 37  ; how big to make the shaker

; ### Create Dice Shaker

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
Trailer=ode\body
dBodySetPosition(ode\body,0,TruckStartY+.5,truckZ)
dBodySetRotation(ode\body,0,0,0)
mass=dMassCreate()
dMassSetBoxTotal(mass,TMass,5*scale,0.4*scale,18*scale)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)

ode\geom=dCreateBox(Space,5*scale,0.4*scale,18*scale)
TGeom=ode\geom
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
TMesh=ode\mesh
ScaleMesh ode\mesh,2.5*scale,0.2*scale,9*scale
;EntityColor ode\mesh,20,40,128
EntityColor ode\mesh,40,80,255
;RotateMesh ode\mesh,90,0,0


;dJointAttach(Joint(5),0,Trailer)

;;add left wall of shaker
ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,0.2*scale,4*scale,18*scale)
dGeomSetBody(ode\geom,Trailer)
dGeomSetOffsetPosition(ode\geom,2.3*scale,1.9*scale,0)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,0.1*scale,2*scale,9*scale
EntityColor ode\mesh,40,80,255
EntityAlpha ode\mesh,0.7
;RotateMesh ode\mesh,90,0,0

;;add right wall of shaker
ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,0.2*scale,4*scale,18*scale)
dGeomSetBody(ode\geom,Trailer)
dGeomSetOffsetPosition(ode\geom,-2.3*scale,1.9*scale,0)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,0.1*scale,2*scale,9*scale
EntityColor ode\mesh,40,80,255
EntityAlpha ode\mesh,0.7
;RotateMesh ode\mesh,90,0,0
;

;; add front wall of shaker
ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,4.8*scale,4*scale,0.4*scale)
dGeomSetBody(ode\geom,Trailer)
dGeomSetOffsetPosition(ode\geom,0,1.9*scale,9.1*scale)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,2.4*scale,2*scale,0.2*scale
EntityColor ode\mesh,40,80,255
EntityAlpha ode\mesh,0.7
;RotateMesh ode\mesh,90,0,0

;; now a challenge -  add a roof to the shaker!
ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,5*scale,0.4*scale,18*scale)
dGeomSetBody(ode\geom,Trailer)
dGeomSetOffsetPosition(ode\geom,0,4.0*scale,0*scale)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,2.5*scale,0.2*scale,9*scale
EntityColor ode\mesh,40,80,255
EntityAlpha ode\mesh,0.7


;add an End To the shaker

;; add front wall of shaker
ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,4.8*scale,4*scale,0.4*scale)
dGeomSetBody(ode\geom,Trailer)
dGeomSetOffsetPosition(ode\geom,0,1.9*scale,-9.1*scale)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,2.4*scale,2*scale,0.2*scale
EntityColor ode\mesh,40,80,255
EntityAlpha ode\mesh,0.7

;end shaker creation
;-------------------------------------------------------------











dContactSetMode(dContactBounce)
dContactSetBounce(0.1)
dContactSetMu(48)

dContactSetMode(dContactSlip1)
dContactSetMu(WorldFriction)

; ### end of add a terrain height map

DMass=1000

dice_x=1
	
	cube_size=4.5

	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	DICEA=ode\body
	;dBodySetPosition(ode\body,dice_x*20,DiceStarty*(dice_x*3),DiceStartz)
	dBodySetPosition(ode\body,1,DiceStarty,DiceStartz)
	dBodySetRotation(ode\body,0,0,0)
	mass=dMassCreate()
	;dMassSetBoxTotal(mass,CMass,3,1,4)
	dMassSetBoxTotal(mass,DMass,cube_size,cube_size,cube_size)
	dBodySetMass(ode\body,mass)
	dMassDestroy(mass)
	;ode\geom=dCreateBox(Space,3,1,4)
	ode\geom=dCreateBox(Space,cube_size,cube_size,cube_size)
	dMassSetBoxTotal(mass,DMass,cube_size,cube_size,cube_size)
	CGeom=ode\geom
	dGeomSetBody(ode\geom,ode\body)
	;ode\mesh=CreateCube()
	ode\mesh=mesh_with_children(dice_x)
	DMesh=ode\mesh
	
	Scale_Mesh=(cube_size/2)
	
	;ScaleMesh ode\mesh,1.5,0.5,2
	ScaleMesh ode\mesh,Scale_Mesh,Scale_Mesh,Scale_Mesh
	;ScaleMesh ode\mesh,3,3,3
	EntityColor ode\mesh,40,80,255
	
;attach a joint to cubeA ONCE it is static?
	;DJoint(1)=dJointCreateBall(World,0)
	;dJointAttach(DJoint(1),0,DICEA)           ;could not fathom this....
	
	
	
	dice_x=2
	
	cube_size=4.5
	
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	DICEB=ode\body
	;dBodySetPosition(ode\body,dice_x*20,DiceStarty*(dice_x*3),DiceStartz)
	dBodySetPosition(ode\body,1+(dice_x*3),DiceStarty,DiceStartz)
	dBodySetRotation(ode\body,0,0,0)
	mass=dMassCreate()
	;dMassSetBoxTotal(mass,CMass,3,1,4)
	dMassSetBoxTotal(mass,DMass,cube_size,cube_size,cube_size)
	dBodySetMass(ode\body,mass)
	dMassDestroy(mass)
	;ode\geom=dCreateBox(Space,3,1,4)
	ode\geom=dCreateBox(Space,cube_size,cube_size,cube_size)
	dMassSetBoxTotal(mass,DMass,cube_size,cube_size,cube_size)
	CGeom=ode\geom
	dGeomSetBody(ode\geom,ode\body)
	;ode\mesh=CreateCube()
	ode\mesh=mesh_with_children(dice_x)
	EMesh=ode\mesh
	
	Scale_Mesh=(cube_size/2)
	
	;ScaleMesh ode\mesh,1.5,0.5,2
	ScaleMesh ode\mesh,Scale_Mesh,Scale_Mesh,Scale_Mesh
	;ScaleMesh ode\mesh,3,3,3
	EntityColor ode\mesh,40,80,255
	
	

;initialise ODE dice for a numbered cube

	Dim piva(5)
	For i=0 To 5
		piva(i)=CreateCube()
		ScaleEntity piva(i),0.1,0.1,0.1
		EntityParent piva(i),mesh_with_children(1)
	Next
	
	TranslateEntity piva(0), 1, 0, 0
	TranslateEntity piva(1),-1, 0, 0
	TranslateEntity piva(2), 0, 1, 0
	TranslateEntity piva(3), 0,-1, 0
	TranslateEntity piva(4), 0, 0, 1
	TranslateEntity piva(5), 0, 0,-1
	
	
	Global thisita=-1
	Global top_ya#=-5
	
	
;initialise ODE dice for a second die
	
	Dim pivb(5)
	For i=0 To 5
		pivb(i)=CreateCube()
		ScaleEntity pivb(i),0.1,0.1,0.1
		EntityParent pivb(i),mesh_with_children(2)
	Next
	
	TranslateEntity pivb(0), 1, 0, 0
	TranslateEntity pivb(1),-1, 0, 0
	TranslateEntity pivb(2), 0, 1, 0
	TranslateEntity pivb(3), 0,-1, 0
	TranslateEntity pivb(4), 0, 0, 1
	TranslateEntity pivb(5), 0, 0,-1
	
	
	Global thisitb=-1
	Global top_yb#=-5

	
	
	; ### Create Car Body
	
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	Car=ode\body
	dBodySetPosition(ode\body,0,CarStartY,0)
	dBodySetRotation(ode\body,0,0,0)
	mass=dMassCreate()
	dMassSetBoxTotal(mass,CMass,3,1,4)
	dBodySetMass(ode\body,mass)
	dMassDestroy(mass)
	ode\geom=dCreateBox(Space,3,1,4)
	CGeom=ode\geom
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCube()
	CMesh=ode\mesh
	ScaleMesh ode\mesh,1.5,0.5,2
	EntityColor ode\mesh,40,80,255
	
; ### Create Wheels
	
	For count=1 To 4
		ode.ODEGeom=New ODEGeom
		ode\body=dBodyCreate(World)
		Wheel(count)=ode\body
		dBodySetPosition(ode\body,0,0,0)
		dBodySetRotation(ode\body,0,0,90)
		mass=dMassCreate()
		dMassSetSphereTotal(mass,WMass,0.7)
		dBodySetMass(ode\body,mass)
		dMassDestroy(mass)
		ode\geom=dCreateSphere(Space,0.7)
		WGeom(count)=ode\geom
		dGeomSetBody(ode\geom,ode\body)
		ode\mesh=CreateCylinder()
		ScaleMesh ode\mesh,0.7,0.25,0.7
		EntityColor ode\mesh,255,255,255
	Next
	
	dBodySetPosition(Wheel(1),-2,CarStartY-0.5,+2)
	dBodySetPosition(Wheel(2),+2,CarStartY-0.5,+2)
	dBodySetPosition(Wheel(3),-2,CarStartY-0.5,-2)
	dBodySetPosition(Wheel(4),+2,CarStartY-0.5,-2)
	



	
; ### Create Objects

SeedRnd MilliSecs()

;For spheres=1 To 20
;	ode.ODEGeom=New ODEGeom
;	ode\body=dBodyCreate(World)
;	dBodySetPosition(ode\body,Rand(-100,100),30,Rand(-100,100))
;	dBodySetRotation(ode\body,0,0,0)
;	ode\geom=dCreateSphere(Space,4)
;	dGeomSetBody(ode\geom,ode\body)
;	ode\mesh=CreateSphere()
;	ScaleMesh ode\mesh,4,4,4
;	EntityColor ode\mesh,Rand(0,255),Rand(0,255),Rand(0,255)
;	EntityShininess ode\mesh,0.7
;Next
;
;For capsules=1 To 20
;	ode.ODEGeom=New ODEGeom
;	ode\body=dBodyCreate(World)
;	dBodySetPosition(ode\body,Rand(-100,100),30,Rand(-100,100))
;	dBodySetRotation(ode\body,90,0,0)
;	ode\geom=dCreateCapsule(Space,1,8)
;	dGeomSetBody(ode\geom,ode\body)
;	ode\mesh=CreateCylinder()
;	ScaleMesh ode\mesh,1,5,1
;	RotateMesh ode\mesh,90,0,0	; ### Align Blitz3D Cylinder To ODE Capsule
;	EntityColor ode\mesh,Rand(0,255),Rand(0,255),Rand(0,255)
;	EntityShininess ode\mesh,0.7
;Next

; ### Create Light

Global Light=CreateLight()
RotateEntity Light,50,-50,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create Camera

Global CameraPivot=CreatePivot()

Global Camera=CreateCamera(CameraPivot)
CameraClsColor Camera,0,0,0
CameraRange Camera,1,SKYSIZE+1000

; ### Create Plane

dCreatePlane(Space,0,1,0,0)

Global Plane=CreatePlane()
EntityAlpha Plane,0.8

EntityTexture Plane,PlaneTexture()

CreateMirror()

; ###################################################################################################

;; ### Blitz3D Static Object (White)
;
;;; ### ODE Static Object (Blue)
;
;ode.ODEGeom=New ODEGeom
;ode\geom=dCreateBox(Space,2,8,40)
;dGeomSetPosition(ode\geom,20,5,40)
;dGeomSetRotation(ode\geom,-10,8,4)
;ode\mesh=CreateCube()
;ScaleMesh ode\mesh,1,4,20
;EntityColor ode\mesh,0,100,200
;
;; ### ODE Static Object (Red)
;
;ode.ODEGeom=New ODEGeom
;ode\geom=dCreateBox(Space,18,0.2,40)
;dGeomSetPosition(ode\geom,-20,4.9,40)
;dGeomSetRotation(ode\geom,-14,0,0)
;ode\mesh=CreateCube()
;ScaleMesh ode\mesh,9,0.1,20
;EntityColor ode\mesh,200,0,100
;
;
;Dim dice_contact(10)
;
; ###################################################################################################

SetupCar()

While Not KeyHit(1)
	
	;add a little force to the cubes, or just stick them inside a big tumbler which will rotate &amp; then spin up
	;magically spitting the dice out
	
	
	;UpdateKeyst()
	

	UpdateKeys()

	UpdateCar()

	UpdateGeoms()
	
	
;	For ODE dice
	
	;For i=0 To 5
			
			thisita=-1
			top_ya#=-1000
			
			For i = 0 To 5
				y# = EntityY( piva(i) , 1 )
				If y &gt; top_ya# Then
					top_ya# = y       
					thisita = i
				EndIf
			Next
			
			For i = 0 To 5
				If thisita = i
					EntityColor piva(i), 255,0,0
				Else
					EntityColor piva(i), 255,255,255
				EndIf
			Next
			
		;Next
			
			thisitb=-1
			top_yb#=-1000
			
			For i = 0 To 5
				y# = EntityY( pivb(i) , 1 )
				If y &gt; top_yb# Then
					top_yb# = y       
					thisitb = i
				EndIf
			Next
			
			For i = 0 To 5
				If thisitb = i
					EntityColor pivb(i), 255,0,0
				Else
					EntityColor pivb(i), 255,255,255
				EndIf
			Next
	
		

	PTime=MilliSecs()

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)

	PhysicsTime#=MilliSecs()-PTime

	UpdateCam()

	RenderWorld

	;Text 0,0,"JV-ODE Version "+dGetVersion()
	;Text 0,15,"Physics Time:"+PhysicsTime
	;Text 0,50,"Force:"+Force
	;Text 0,65,"Torque:"+Torque
	Text 640,0,"A - Dice 1"
	Text 640,15,"Z - Dice 2"
	Text 640,30,"T - Shaker"
	;Text 640,30,"Arrows - Steering"
	;Text 640,45,"Space - Reset Car"
	;Text 640,60,"T - Throw Dice"
	
	
	For dice_hit=1 To 2
		
	
		If dice_hit=1
			Color 1,15,10
		;Text 150,10, "The Coloured Dice Value is : " +thisit
		Text 2,25, "The 1st Numbered Dice Value is : " +dicestring$(thisita)
;		Color 255,0,0 : Text 500,30,  "Top:    1"
;		Color 0,0,255 : Text 500,40,  "Bottom: 6"
;		Color 0,255,255 : Text 500,50,"Right:  2"
;		Color 255,255,0 : Text 500,60,"Left:   5"
;		Color 0,255,0 : Text 500,70,  "Front:  3"
;		Color 128,0,128 : Text 500,80,"Rear:   4"
		
	EndIf
	
	If dice_hit=2
		Color 1,10,10
		;Text 150,10, "The Coloured Dice Value is : " +thisit
		Text 2,47, "The 2nd Numbered Dice Value is : " +dicestring$(thisitb)
;		Color 255,0,0 : Text 500,30,  "Top:    1"
;		Color 0,0,255 : Text 500,40,  "Bottom: 6"
;		Color 0,255,255 : Text 500,50,"Right:  2"
;		Color 255,255,0 : Text 500,60,"Left:   5"
;		Color 0,255,0 : Text 500,70,  "Front:  3"
;		Color 128,0,128 : Text 500,80,"Rear:   4"
		
	EndIf
		
	Next

	Flip 1

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function SetupCar()

For count=1 To 4
	Joint(count)=dJointCreateHinge2(World,0)
	dJointAttach(Joint(count),Car,Wheel(count))
	dJointSetHinge2Anchor(Joint(count),dBodyGetPositionX(Wheel(count)),dBodyGetPositionY(Wheel(count)),dBodyGetPositionZ(Wheel(count)))
	dJointSetHinge2Axis1(Joint(count),0,1,0)
	dJointSetHinge2Axis2(Joint(count),-1,0,0)
	dJointSetHinge2Param(Joint(count),dParamSuspensionERP,0.8)
	dJointSetHinge2Param(Joint(count),dParamSuspensionCFM,SuspensionHS)
	If count&gt;2
		dJointSetHinge2Param(Joint(count),dParamLoStop,0)
		dJointSetHinge2Param(Joint(count),dParamHiStop,0)
		End If
Next

End Function

; ###################################################################################################

Function UpdateKeys()
	
	If KeyDown(30)=1
		lookat=0
		lookrange=1
	EndIf
	
	
	If KeyDown(44)=1
		lookat=1
		lookrange=1
	EndIf
	
	If KeyDown(20)=1
		lookat=2			;lookat the shaker
		lookrange=5
	EndIf
	
	
	
; code to drive the car

;If KeyDown(30)=1
;	;Force=Force+0.08
;	Force=Force+0.48
;	
;	If Force&gt;90 Then Force=90
;	End If
;
;If KeyDown(44)=1
;	Force=Force-0.1
;	If Force&lt;-10 Then Force=-10
;	If Force&gt;0 Then Force=Force*0.97
;	End If
;
;If KeyDown(30)=0 And KeyDown(44)=0 Then Force=Force*0.99
;
;If KeyDown(203)=1 Or KeyDown(205)=1
;	If KeyDown(203)=1
;		Steer=0.5
;		Else
;		Steer=-0.5
;		End If
;	Else
;	Steer=0.0
;	End If
;
;If KeyHit(57)=1
;	Force=0.0
;	dBodySetRotation(Car,dGeomGetPitch(CGeom),dGeomGetYaw(CGeom),0)
;End If
;
;If KeyHit(20)=1
;	;For men=1 To max_men
;		;dJointAttach(RDJoint(men,0),0,0)    ; detach bodies
;		;dBodyAddForce RDBody(men,0),0,16,0  ; fly guys during rest
;		;dJointAttach(RDJoint(DICEA),0,0)    ; detach bodies
;	;dBodyAddForce DICEB,0,16,0  ; fly guys during rest
;	;Next
;	;dJointDetach(DJoint(1),0,DICEA)
;	If KeyDown(200) Then dBodyAddForce(DICEA,0,0,1000) ; no dice
;	;MoveEntity DICEA,0,50,0
;End If

End Function

; ###################################################################################################

Function UpdateCar()

For count=1 To 4
	dBodyEnable(Wheel(count))
Next

dBodyEnable(Car)

For count=1 To 4
	dJointSetHinge2Param(Joint(count),dParamVel2,Force)
	dJointSetHinge2Param(Joint(count),dParamFMax2,Torque)
Next

For count=1 To 2
	angle#=Steer-dJointGetHinge2Angle1(Joint(count))
	dJointSetHinge2Param(Joint(count),dParamVel,angle)
	dJointSetHinge2Param(Joint(count),dParamFMax,400)
Next

End Function

; ###################################################################################################

Function UpdateCam()
	
	PositionEntity Camera,0,60*lookrange,-84*lookrange
	RotateEntity Camera,30,0,0
	
	If lookat=0
		PivotX#=Cos(EntityYaw(EMesh)-90)+EntityX(EMesh)
		PivotY#=EntityY(EMesh)
		PivotZ#=Sin(EntityYaw(EMesh)-90)+EntityZ(EMesh)
	EndIf
	If lookat=1
		PivotX#=Cos(EntityYaw(DMesh)-90)+EntityX(DMesh)
		PivotY#=EntityY(DMesh)
		PivotZ#=Sin(EntityYaw(DMesh)-90)+EntityZ(DMesh)
	EndIf
	If lookat=2
		PivotX#=Cos(EntityYaw(TMesh)-90)+EntityX(TMesh)
		PivotY#=EntityY(TMesh)
		PivotZ#=Sin(EntityYaw(TMesh)-90)+EntityZ(TMesh)
	EndIf
	
	PositionEntity CameraPivot,PivotX,PivotY,PivotZ
	
	If lookat=0
		PointEntity CameraPivot,EMesh
	EndIf
	If lookat=1
		PointEntity CameraPivot,DMesh	
	EndIf
	If lookat=2
		PointEntity CameraPivot,TMesh
	EndIf
	
End Function




; ###################################################################################################

Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
	PositionEntity ode\mesh,dGeomGetPositionX(ode\geom),dGeomGetPositionY(ode\geom),dGeomGetPositionZ(ode\geom)
	RotateEntity ode\mesh,dGeomGetPitch(ode\geom),dGeomGetYaw(ode\geom),dGeomGetRoll(ode\geom)
Next

End Function

; ###################################################################################################

;====================================================================

Function DICEvalue( mesh )
	
	BestVert = - 1
	BestHeight# = 0
	
	s = GetSurface( mesh, 1 )
	For t = 0 To CountTriangles( s ) - 1 Step 2
		v0 = TriangleVertex( s, t, 0 )
		TFormNormal VertexNX( s, v0 ) , VertexNY( s, v0 ), VertexNZ( s, v0 ), mesh, 0
		If TFormedY() &gt; BestHeight
			BestHeight = TFormedY()
			BestVert = v0
		EndIf
	Next
	
	If VertexNY( s, BestVert ) = 1 Value = 1	;Top
		If VertexNY( s, BestVert ) = - 1 Value = 6 	;Bottom
			If VertexNX( s, BestVert ) = 1 Value = 2	;Right
				If VertexNX( s, BestVert ) = - 1 Value = 5	;Left
					If VertexNZ( s, BestVert ) = 1 Value = 3	;Front
						If VertexNZ( s, BestVert ) = - 1 Value = 4	;Rear
							
							Return Value
							
End Function

;====================================================================
;====================================================================
;====================================================================

Function DICEcreate()
	
	mesh = CreateCube()
	EntityFX mesh, 2+4
	
	s = GetSurface( mesh, 1 )
	For v = 0 To CountVertices(s)-1
		If VertexNY( s, v ) = 1 VertexColor s, v, 255,0,0
			If VertexNY( s, v ) = - 1 VertexColor s, v, 0,0,255
				If VertexNX( s, v ) = 1 VertexColor s, v, 0,255,255
					If VertexNX( s, v ) = - 1 VertexColor s, v, 255,255,0	
						If VertexNZ( s, v ) = 1 VertexColor s, v, 0,255,0
							If VertexNZ( s, v ) = - 1 VertexColor s, v, 128,0,128
							Next
							
							Return mesh
							
End Function



;Function UpdateKeyst()   ;failed attempt at adding force to the dice shaker:-
;	
;	If KeyDown(200) Then dBodyAddForce(Trailer,0,0,10)
;	If KeyDown(208) Then dBodyAddForce(Trailer,0,0,-10)
;	If KeyDown(203) Then dBodyAddForce(Trailer,-10,0,0)
;	If KeyDown(205) Then dBodyAddForce(Trailer,10,0,0)
;	
;End Function
;
</textarea><br><br><br><br>[/codebox] <br><br></td></tr></table><br>
<a name="994668"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#75">[#75]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>OMG it shouldn't be this hard...<br> <br></div><br>My sentiments exactly. I've responded every single time you've asked for the JV-ODE update, to tell you I DO NOT have your Blitz profile details listed as a registered user. Yet you have not acknowledged it ONCE.<br><br>The email address in your Blitz profile is not registered and 'noel' isn't much help, hence the CONSTANT requests for you to confirm who you are.<br><br>So, as you couldn't be bothered to tell me who you are, I decided to find out for you.<br><br>After going through the 'noel' users, I found an entry that had been delisted due to several email errors (Error: 451 - Temporary local problem - please try later), then I searched for the email address domain on the Blitz website and I find this...<br><br><a href="/_search.php?bbs=Miscellaneous&amp;forum=&amp;terms=zamagames&amp;method=simple&amp;case=no&amp;results=topic&amp;user=&amp;submit=Search" target="_blank">Search Results</a><br><br>And there you are.<br><br>Your JV-ODE update email has been sent to the address in your Blitz profile and I've updated your records.<br><br>Thanks for telling me you had changed your email address and for the assistance confirming your purchase details :/<br><br><br><b>@Blitzplotter:</b> I'll look into it and get back to you.<br><br>Thanks both for the kind words. <br><br></td></tr></table><br>
<a name="994682"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#76">[#76]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Blitzplotter: Ok, I've tried the dice code. There were a few problems, setting the mass with dMassSetBoxTotal() twice for each dice causing an ODE error and adding a ball joint to the dice instead of the container(?).<br><br>Here's a version of your code with a ball joint attached between the shaker container and ODE world (modifications marked with '&lt;&lt;&lt;&lt;')...<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #                                        JV-ODE Dice Demo                                         #
; #                                  Code by J Williams &amp; M Gormley                                 #
; #               JV-ODE bits courtesy of Devious Codeworks - Copyright © 2008                      #
; ###################################################################################################

;;v18 tidy code a little



Include "JV-ODE.bb"

AppTitle "Chuck 2 dice"

Graphics3D 800,600,0,2

Global CMass#=50.0				; ### Car Mass
Global WMass#=14.0				; ### Wheel Mass
Global DMass#=50.0               ; ### Dice Mass

Global WorldERP#=1.0			; ### World Error Correction
Global WorldFriction#=70.0		; ### World Friction

Global Torque#=24.0				; ### Joint Torque
Global SuspensionHS#=0.01		; ### Suspension Hardness/Softness (Higher=Softer - Lower=Harder)

Global Force#=0.0
Global Steer#=0.0

Global Car
Global CGeom
Global CMesh
Global TMesh					; Note:  necessary to make these global so that

Global DMesh					; you can choose multiple cameras
Global EMesh

Global lookat=2					; look at the traier first
Global lookrange=2

Global Trailer  ;  &lt;&lt;&lt;&lt;

Global SKYSIZE=4800

Dim Wheel(4)
Dim WGeom(4)
Dim Joint(5)

Dim TWheel(6)
Dim TWGeom(6)
Dim TJoint(6)

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

Dim dicestring$(5)
dicestring$(0)="1"
dicestring$(1)="3"
dicestring$(2)="2"   
dicestring$(3)="5"
dicestring$(4)="6"
dicestring$(5)="4"

Dim DJoint(2)

; #############
;
; setup dice vars

;  Note modify the path(s) to whereever you put the nicedice1.b3d model
;  The model is available from &lt;a href="http://www.wishingwellsoftware.co.uk/nicedice1.b3d" target="_blank"&gt;http://www.wishingwellsoftware.co.uk/nicedice1.b3d&lt;/a&gt;

your_path$=("H:\TORTOISE\top_level_tort_check_ootski\UltimateUnwrapProjects")

filepathdice$=("media/nicedice1.b3d");  &lt;&lt;&lt;&lt;

;filepathcity$=(yourpath$+"blender gimp images\city1.b3d")
filepathcity$=("media/nicedice1.b3d");  &lt;&lt;&lt;&lt;

Global loadcereal=0  ;0 loads dice for texturing

Dim top_side(7)
Dim bottom_side(7)
Dim front_side(7)
Dim left_side(7)
Dim right_side(7)
Dim back_side(7)

Dim mesh_with_children(7)


Global DiceStartz=1

Dim store_dice_sides_mem(10,10)

count=1		
mesh_with_children(count) = LoadAnimMesh( filepathdice$ )

mesh_with_children(2) = LoadAnimMesh( filepathdice$ )

;citymesh = Loadentity(filepathcity$)


;--------------------------------
; end setup dice vars
;-----------------------------------

; ###################################################################################################

; ### Setup ODE

dInitODE()

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,-0.98,0)
dWorldSetERP(World,WorldERP)

dContactSetMode(dContactSlip1)
dContactSetMu(WorldFriction)

;; ### add a terrain height map
;;TERRAIN
;Global terrain = LoadTerrain("height4.jpg")
;TerrainDetail terrain,2500,True
;ScaleEntity terrain, 3,15,3
;PositionEntity terrain,-1000,0,-530
;;ter_tex = LoadTexture("mossyground.bmp")
;ter_tex = LoadTexture("ground_bmp_64.bmp")
;EntityTexture terrain,ter_tex
;EntityRadius terrain,0.2
;EntityType terrain,SCENERY


;SKY
Global sky = CreateSphere(16,camera_pivot)
FlipMesh sky
ScaleEntity sky,SKYSIZE,SKYSIZE,SKYSIZE
PositionEntity sky, 0,50,0
;sky_tex = LoadTexture("C:/Program Files/GetFit/sky.bmp")
;EntityTexture sky,sky_tex





;make the dice, car &amp; dice shaker fall from a variable altitude


; Set the randomizer seed for more true random numbers 
SeedRnd (MilliSecs()) 

; Generate random numbers between 1 and 100 

howhigh= Rand(1,100) 
	
highfactor=3

Global CarStartY=highfactor*howhigh

Global DiceStarty=highfactor*howhigh

TruckStartY=(highfactor*howhigh)-12
truckZ=10
TMass=200

; end altitude settings


scale = 37  ; how big to make the shaker

; ### Create Dice Shaker

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
Trailer=ode\body
dBodySetPosition(ode\body,0,TruckStartY+.5,truckZ)
dBodySetRotation(ode\body,0,0,0)
mass=dMassCreate()
dMassSetBoxTotal(mass,TMass,5*scale,0.4*scale,18*scale)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)

ode\geom=dCreateBox(Space,5*scale,0.4*scale,18*scale)
TGeom=ode\geom
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
TMesh=ode\mesh
ScaleMesh ode\mesh,2.5*scale,0.2*scale,9*scale
;EntityColor ode\mesh,20,40,128
EntityColor ode\mesh,40,80,255
;RotateMesh ode\mesh,90,0,0


;dJointAttach(Joint(5),0,Trailer)

;;add left wall of shaker
ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,0.2*scale,4*scale,18*scale)
dGeomSetBody(ode\geom,Trailer)
dGeomSetOffsetPosition(ode\geom,2.3*scale,1.9*scale,0)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,0.1*scale,2*scale,9*scale
EntityColor ode\mesh,40,80,255
EntityAlpha ode\mesh,0.7
;RotateMesh ode\mesh,90,0,0

;;add right wall of shaker
ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,0.2*scale,4*scale,18*scale)
dGeomSetBody(ode\geom,Trailer)
dGeomSetOffsetPosition(ode\geom,-2.3*scale,1.9*scale,0)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,0.1*scale,2*scale,9*scale
EntityColor ode\mesh,40,80,255
EntityAlpha ode\mesh,0.7
;RotateMesh ode\mesh,90,0,0
;

;; add front wall of shaker
ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,4.8*scale,4*scale,0.4*scale)
dGeomSetBody(ode\geom,Trailer)
dGeomSetOffsetPosition(ode\geom,0,1.9*scale,9.1*scale)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,2.4*scale,2*scale,0.2*scale
EntityColor ode\mesh,40,80,255
EntityAlpha ode\mesh,0.7
;RotateMesh ode\mesh,90,0,0

;; now a challenge -  add a roof to the shaker!
ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,5*scale,0.4*scale,18*scale)
dGeomSetBody(ode\geom,Trailer)
dGeomSetOffsetPosition(ode\geom,0,4.0*scale,0*scale)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,2.5*scale,0.2*scale,9*scale
EntityColor ode\mesh,40,80,255
EntityAlpha ode\mesh,0.7


;add an End To the shaker

;; add front wall of shaker
ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,4.8*scale,4*scale,0.4*scale)
dGeomSetBody(ode\geom,Trailer)
dGeomSetOffsetPosition(ode\geom,0,1.9*scale,-9.1*scale)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,2.4*scale,2*scale,0.2*scale
EntityColor ode\mesh,40,80,255
EntityAlpha ode\mesh,0.7

;end shaker creation
;-------------------------------------------------------------



; &gt;&gt;&gt;&gt;

	Joint(1)=dJointCreateBall(World,0)
	dJointAttach(Joint(1),0,Trailer)
	dJointSetBallAnchor(Joint(1),10,TruckStartY+.5,truckZ)





dContactSetMode(dContactBounce)
dContactSetBounce(0.1)
dContactSetMu(48)

dContactSetMode(dContactSlip1)
dContactSetMu(WorldFriction)

; ### end of add a terrain height map

DMass=1000

dice_x=1
	
	cube_size=4.5

	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	DICEA=ode\body
	;dBodySetPosition(ode\body,dice_x*20,DiceStarty*(dice_x*3),DiceStartz)
	dBodySetPosition(ode\body,1,DiceStarty,DiceStartz)
	dBodySetRotation(ode\body,0,0,0)
	mass=dMassCreate()
	;dMassSetBoxTotal(mass,CMass,3,1,4)
	dMassSetBoxTotal(mass,DMass,cube_size,cube_size,cube_size)
	dBodySetMass(ode\body,mass)
	dMassDestroy(mass)
	;ode\geom=dCreateBox(Space,3,1,4)
	ode\geom=dCreateBox(Space,cube_size,cube_size,cube_size)
;	dMassSetBoxTotal(mass,DMass,cube_size,cube_size,cube_size)  &lt;&lt;&lt;&lt;
;	CGeom=ode\geom  &lt;&lt;&lt;&lt;
	dGeomSetBody(ode\geom,ode\body)
	;ode\mesh=CreateCube()
	ode\mesh=mesh_with_children(dice_x)
	DMesh=ode\mesh
	
	Scale_Mesh=(cube_size/2)
	
	;ScaleMesh ode\mesh,1.5,0.5,2
	ScaleMesh ode\mesh,Scale_Mesh,Scale_Mesh,Scale_Mesh
	;ScaleMesh ode\mesh,3,3,3
	EntityColor ode\mesh,40,80,255
	
;attach a joint to cubeA ONCE it is static?
	;DJoint(1)=dJointCreateBall(World,0)
	;dJointAttach(DJoint(1),0,DICEA)           ;could not fathom this....
	
	
	
	dice_x=2
	
	cube_size=4.5
	
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	DICEB=ode\body
	;dBodySetPosition(ode\body,dice_x*20,DiceStarty*(dice_x*3),DiceStartz)
	dBodySetPosition(ode\body,1+(dice_x*3),DiceStarty,DiceStartz)
	dBodySetRotation(ode\body,0,0,0)
	mass=dMassCreate()
	;dMassSetBoxTotal(mass,CMass,3,1,4)
	dMassSetBoxTotal(mass,DMass,cube_size,cube_size,cube_size)
	dBodySetMass(ode\body,mass)
	dMassDestroy(mass)
	;ode\geom=dCreateBox(Space,3,1,4)
	ode\geom=dCreateBox(Space,cube_size,cube_size,cube_size)
;	dMassSetBoxTotal(mass,DMass,cube_size,cube_size,cube_size)  &lt;&lt;&lt;&lt;
;	CGeom=ode\geom  &lt;&lt;&lt;&lt;
	dGeomSetBody(ode\geom,ode\body)
	;ode\mesh=CreateCube()
	ode\mesh=mesh_with_children(dice_x)
	EMesh=ode\mesh
	
	Scale_Mesh=(cube_size/2)
	
	;ScaleMesh ode\mesh,1.5,0.5,2
	ScaleMesh ode\mesh,Scale_Mesh,Scale_Mesh,Scale_Mesh
	;ScaleMesh ode\mesh,3,3,3
	EntityColor ode\mesh,40,80,255
	

	
	

;initialise ODE dice for a numbered cube

	Dim piva(5)
	For i=0 To 5
		piva(i)=CreateCube()
		ScaleEntity piva(i),0.1,0.1,0.1
		EntityParent piva(i),mesh_with_children(1)
	Next
	
	TranslateEntity piva(0), 1, 0, 0
	TranslateEntity piva(1),-1, 0, 0
	TranslateEntity piva(2), 0, 1, 0
	TranslateEntity piva(3), 0,-1, 0
	TranslateEntity piva(4), 0, 0, 1
	TranslateEntity piva(5), 0, 0,-1
	
	
	Global thisita=-1
	Global top_ya#=-5
	
	
;initialise ODE dice for a second die
	
	Dim pivb(5)
	For i=0 To 5
		pivb(i)=CreateCube()
		ScaleEntity pivb(i),0.1,0.1,0.1
		EntityParent pivb(i),mesh_with_children(2)
	Next
	
	TranslateEntity pivb(0), 1, 0, 0
	TranslateEntity pivb(1),-1, 0, 0
	TranslateEntity pivb(2), 0, 1, 0
	TranslateEntity pivb(3), 0,-1, 0
	TranslateEntity pivb(4), 0, 0, 1
	TranslateEntity pivb(5), 0, 0,-1
	
	
	Global thisitb=-1
	Global top_yb#=-5

	
	
	; ### Create Car Body
	
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	Car=ode\body
	dBodySetPosition(ode\body,0,CarStartY,0)
	dBodySetRotation(ode\body,0,0,0)
	mass=dMassCreate()
	dMassSetBoxTotal(mass,CMass,3,1,4)
	dBodySetMass(ode\body,mass)
	dMassDestroy(mass)
	ode\geom=dCreateBox(Space,3,1,4)
	CGeom=ode\geom
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCube()
	CMesh=ode\mesh
	ScaleMesh ode\mesh,1.5,0.5,2
	EntityColor ode\mesh,40,80,255
	
; ### Create Wheels
	
	For count=1 To 4
		ode.ODEGeom=New ODEGeom
		ode\body=dBodyCreate(World)
		Wheel(count)=ode\body
		dBodySetPosition(ode\body,0,0,0)
		dBodySetRotation(ode\body,0,0,90)
		mass=dMassCreate()
		dMassSetSphereTotal(mass,WMass,0.7)
		dBodySetMass(ode\body,mass)
		dMassDestroy(mass)
		ode\geom=dCreateSphere(Space,0.7)
		WGeom(count)=ode\geom
		dGeomSetBody(ode\geom,ode\body)
		ode\mesh=CreateCylinder()
		ScaleMesh ode\mesh,0.7,0.25,0.7
		EntityColor ode\mesh,255,255,255
	Next
	
	dBodySetPosition(Wheel(1),-2,CarStartY-0.5,+2)
	dBodySetPosition(Wheel(2),+2,CarStartY-0.5,+2)
	dBodySetPosition(Wheel(3),-2,CarStartY-0.5,-2)
	dBodySetPosition(Wheel(4),+2,CarStartY-0.5,-2)
	



	
; ### Create Objects

SeedRnd MilliSecs()

;For spheres=1 To 20
;	ode.ODEGeom=New ODEGeom
;	ode\body=dBodyCreate(World)
;	dBodySetPosition(ode\body,Rand(-100,100),30,Rand(-100,100))
;	dBodySetRotation(ode\body,0,0,0)
;	ode\geom=dCreateSphere(Space,4)
;	dGeomSetBody(ode\geom,ode\body)
;	ode\mesh=CreateSphere()
;	ScaleMesh ode\mesh,4,4,4
;	EntityColor ode\mesh,Rand(0,255),Rand(0,255),Rand(0,255)
;	EntityShininess ode\mesh,0.7
;Next
;
;For capsules=1 To 20
;	ode.ODEGeom=New ODEGeom
;	ode\body=dBodyCreate(World)
;	dBodySetPosition(ode\body,Rand(-100,100),30,Rand(-100,100))
;	dBodySetRotation(ode\body,90,0,0)
;	ode\geom=dCreateCapsule(Space,1,8)
;	dGeomSetBody(ode\geom,ode\body)
;	ode\mesh=CreateCylinder()
;	ScaleMesh ode\mesh,1,5,1
;	RotateMesh ode\mesh,90,0,0	; ### Align Blitz3D Cylinder To ODE Capsule
;	EntityColor ode\mesh,Rand(0,255),Rand(0,255),Rand(0,255)
;	EntityShininess ode\mesh,0.7
;Next

; ### Create Light

Global Light=CreateLight()
RotateEntity Light,50,-50,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create Camera

Global CameraPivot=CreatePivot()

Global Camera=CreateCamera(CameraPivot)
CameraClsColor Camera,0,0,0
CameraRange Camera,1,SKYSIZE+1000

; ### Create Plane

dCreatePlane(Space,0,1,0,0)

Global Plane=CreatePlane()
EntityAlpha Plane,0.8

EntityTexture Plane,PlaneTexture()

CreateMirror()

; ###################################################################################################

;; ### Blitz3D Static Object (White)
;
;;; ### ODE Static Object (Blue)
;
;ode.ODEGeom=New ODEGeom
;ode\geom=dCreateBox(Space,2,8,40)
;dGeomSetPosition(ode\geom,20,5,40)
;dGeomSetRotation(ode\geom,-10,8,4)
;ode\mesh=CreateCube()
;ScaleMesh ode\mesh,1,4,20
;EntityColor ode\mesh,0,100,200
;
;; ### ODE Static Object (Red)
;
;ode.ODEGeom=New ODEGeom
;ode\geom=dCreateBox(Space,18,0.2,40)
;dGeomSetPosition(ode\geom,-20,4.9,40)
;dGeomSetRotation(ode\geom,-14,0,0)
;ode\mesh=CreateCube()
;ScaleMesh ode\mesh,9,0.1,20
;EntityColor ode\mesh,200,0,100
;
;
;Dim dice_contact(10)
;
; ###################################################################################################

SetupCar()

While Not KeyHit(1)
	
	;add a little force to the cubes, or just stick them inside a big tumbler which will rotate &amp; then spin up
	;magically spitting the dice out
	
	
	;UpdateKeyst()
	

	UpdateKeys()

	UpdateCar()

	UpdateGeoms()
	
	
;	For ODE dice
	
	;For i=0 To 5
			
			thisita=-1
			top_ya#=-1000
			
			For i = 0 To 5
				y# = EntityY( piva(i) , 1 )
				If y &gt; top_ya# Then
					top_ya# = y       
					thisita = i
				EndIf
			Next
			
			For i = 0 To 5
				If thisita = i
					EntityColor piva(i), 255,0,0
				Else
					EntityColor piva(i), 255,255,255
				EndIf
			Next
			
		;Next
			
			thisitb=-1
			top_yb#=-1000
			
			For i = 0 To 5
				y# = EntityY( pivb(i) , 1 )
				If y &gt; top_yb# Then
					top_yb# = y       
					thisitb = i
				EndIf
			Next
			
			For i = 0 To 5
				If thisitb = i
					EntityColor pivb(i), 255,0,0
				Else
					EntityColor pivb(i), 255,255,255
				EndIf
			Next
	
		

	PTime=MilliSecs()

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)

	PhysicsTime#=MilliSecs()-PTime

	UpdateCam()

	RenderWorld

	;Text 0,0,"JV-ODE Version "+dGetVersion()
	;Text 0,15,"Physics Time:"+PhysicsTime
	;Text 0,50,"Force:"+Force
	;Text 0,65,"Torque:"+Torque
	Text 640,0,"A - Dice 1"
	Text 640,15,"Z - Dice 2"
	Text 640,30,"T - Shaker"
	;Text 640,30,"Arrows - Steering"
	;Text 640,45,"Space - Reset Car"
	;Text 640,60,"T - Throw Dice"
	
	
	For dice_hit=1 To 2
		
	
		If dice_hit=1
			Color 1,15,10
		;Text 150,10, "The Coloured Dice Value is : " +thisit
		Text 2,25, "The 1st Numbered Dice Value is : " +dicestring$(thisita)
;		Color 255,0,0 : Text 500,30,  "Top:    1"
;		Color 0,0,255 : Text 500,40,  "Bottom: 6"
;		Color 0,255,255 : Text 500,50,"Right:  2"
;		Color 255,255,0 : Text 500,60,"Left:   5"
;		Color 0,255,0 : Text 500,70,  "Front:  3"
;		Color 128,0,128 : Text 500,80,"Rear:   4"
		
	EndIf
	
	If dice_hit=2
		Color 1,10,10
		;Text 150,10, "The Coloured Dice Value is : " +thisit
		Text 2,47, "The 2nd Numbered Dice Value is : " +dicestring$(thisitb)
;		Color 255,0,0 : Text 500,30,  "Top:    1"
;		Color 0,0,255 : Text 500,40,  "Bottom: 6"
;		Color 0,255,255 : Text 500,50,"Right:  2"
;		Color 255,255,0 : Text 500,60,"Left:   5"
;		Color 0,255,0 : Text 500,70,  "Front:  3"
;		Color 128,0,128 : Text 500,80,"Rear:   4"
		
	EndIf
		
	Next

	Flip 1

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function SetupCar()

For count=1 To 4
	Joint(count)=dJointCreateHinge2(World,0)
	dJointAttach(Joint(count),Car,Wheel(count))
	dJointSetHinge2Anchor(Joint(count),dBodyGetPositionX(Wheel(count)),dBodyGetPositionY(Wheel(count)),dBodyGetPositionZ(Wheel(count)))
	dJointSetHinge2Axis1(Joint(count),0,1,0)
	dJointSetHinge2Axis2(Joint(count),-1,0,0)
	dJointSetHinge2Param(Joint(count),dParamSuspensionERP,0.8)
	dJointSetHinge2Param(Joint(count),dParamSuspensionCFM,SuspensionHS)
	If count&gt;2
		dJointSetHinge2Param(Joint(count),dParamLoStop,0)
		dJointSetHinge2Param(Joint(count),dParamHiStop,0)
		End If
Next

End Function

; ###################################################################################################

Function UpdateKeys()
	
	If KeyDown(30)=1
		lookat=0
		lookrange=1
	EndIf
	
	
	If KeyDown(44)=1
		lookat=1
		lookrange=1
	EndIf
	
	If KeyDown(20)=1
		lookat=2			;lookat the shaker
		lookrange=5
	EndIf
	
	
	
; code to drive the car

;If KeyDown(30)=1
;	;Force=Force+0.08
;	Force=Force+0.48
;	
;	If Force&gt;90 Then Force=90
;	End If
;
;If KeyDown(44)=1
;	Force=Force-0.1
;	If Force&lt;-10 Then Force=-10
;	If Force&gt;0 Then Force=Force*0.97
;	End If
;
;If KeyDown(30)=0 And KeyDown(44)=0 Then Force=Force*0.99
;
;If KeyDown(203)=1 Or KeyDown(205)=1
;	If KeyDown(203)=1
;		Steer=0.5
;		Else
;		Steer=-0.5
;		End If
;	Else
;	Steer=0.0
;	End If
;
;If KeyHit(57)=1
;	Force=0.0
;	dBodySetRotation(Car,dGeomGetPitch(CGeom),dGeomGetYaw(CGeom),0)
;End If
;
;If KeyHit(20)=1
;	;For men=1 To max_men
;		;dJointAttach(RDJoint(men,0),0,0)    ; detach bodies
;		;dBodyAddForce RDBody(men,0),0,16,0  ; fly guys during rest
;		;dJointAttach(RDJoint(DICEA),0,0)    ; detach bodies
;	;dBodyAddForce DICEB,0,16,0  ; fly guys during rest
;	;Next
;	;dJointDetach(DJoint(1),0,DICEA)
;	If KeyDown(200) Then dBodyAddForce(DICEA,0,0,1000) ; no dice
;	;MoveEntity DICEA,0,50,0
;End If

End Function

; ###################################################################################################

Function UpdateCar()

For count=1 To 4
	dBodyEnable(Wheel(count))
Next

dBodyEnable(Car)

For count=1 To 4
	dJointSetHinge2Param(Joint(count),dParamVel2,Force)
	dJointSetHinge2Param(Joint(count),dParamFMax2,Torque)
Next

For count=1 To 2
	angle#=Steer-dJointGetHinge2Angle1(Joint(count))
	dJointSetHinge2Param(Joint(count),dParamVel,angle)
	dJointSetHinge2Param(Joint(count),dParamFMax,400)
Next

End Function

; ###################################################################################################

Function UpdateCam()
	
	PositionEntity Camera,0,60*lookrange,-84*lookrange
	RotateEntity Camera,30,0,0
	
	If lookat=0
		PivotX#=Cos(EntityYaw(EMesh)-90)+EntityX(EMesh)
		PivotY#=EntityY(EMesh)
		PivotZ#=Sin(EntityYaw(EMesh)-90)+EntityZ(EMesh)
	EndIf
	If lookat=1
		PivotX#=Cos(EntityYaw(DMesh)-90)+EntityX(DMesh)
		PivotY#=EntityY(DMesh)
		PivotZ#=Sin(EntityYaw(DMesh)-90)+EntityZ(DMesh)
	EndIf
	If lookat=2
		PivotX#=Cos(EntityYaw(TMesh)-90)+EntityX(TMesh)
		PivotY#=EntityY(TMesh)
		PivotZ#=Sin(EntityYaw(TMesh)-90)+EntityZ(TMesh)
	EndIf
	
	PositionEntity CameraPivot,PivotX,PivotY,PivotZ
	
	If lookat=0
		PointEntity CameraPivot,EMesh
	EndIf
	If lookat=1
		PointEntity CameraPivot,DMesh	
	EndIf
	If lookat=2
		PointEntity CameraPivot,TMesh
	EndIf
	
End Function




; ###################################################################################################

Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
	PositionEntity ode\mesh,dGeomGetPositionX(ode\geom),dGeomGetPositionY(ode\geom),dGeomGetPositionZ(ode\geom)
	RotateEntity ode\mesh,dGeomGetPitch(ode\geom),dGeomGetYaw(ode\geom),dGeomGetRoll(ode\geom)
Next

End Function

; ###################################################################################################

;====================================================================

Function DICEvalue( mesh )
	
	BestVert = - 1
	BestHeight# = 0
	
	s = GetSurface( mesh, 1 )
	For t = 0 To CountTriangles( s ) - 1 Step 2
		v0 = TriangleVertex( s, t, 0 )
		TFormNormal VertexNX( s, v0 ) , VertexNY( s, v0 ), VertexNZ( s, v0 ), mesh, 0
		If TFormedY() &gt; BestHeight
			BestHeight = TFormedY()
			BestVert = v0
		EndIf
	Next
	
	If VertexNY( s, BestVert ) = 1 Value = 1	;Top
		If VertexNY( s, BestVert ) = - 1 Value = 6 	;Bottom
			If VertexNX( s, BestVert ) = 1 Value = 2	;Right
				If VertexNX( s, BestVert ) = - 1 Value = 5	;Left
					If VertexNZ( s, BestVert ) = 1 Value = 3	;Front
						If VertexNZ( s, BestVert ) = - 1 Value = 4	;Rear
							
							Return Value
							
End Function

;====================================================================
;====================================================================
;====================================================================

Function DICEcreate()
	
	mesh = CreateCube()
	EntityFX mesh, 2+4
	
	s = GetSurface( mesh, 1 )
	For v = 0 To CountVertices(s)-1
		If VertexNY( s, v ) = 1 VertexColor s, v, 255,0,0
			If VertexNY( s, v ) = - 1 VertexColor s, v, 0,0,255
				If VertexNX( s, v ) = 1 VertexColor s, v, 0,255,255
					If VertexNX( s, v ) = - 1 VertexColor s, v, 255,255,0	
						If VertexNZ( s, v ) = 1 VertexColor s, v, 0,255,0
							If VertexNZ( s, v ) = - 1 VertexColor s, v, 128,0,128
							Next
							
							Return mesh
							
End Function



;Function UpdateKeyst()   ;failed attempt at adding force to the dice shaker:-
;	
;	If KeyDown(200) Then dBodyAddForce(Trailer,0,0,10)
;	If KeyDown(208) Then dBodyAddForce(Trailer,0,0,-10)
;	If KeyDown(203) Then dBodyAddForce(Trailer,-10,0,0)
;	If KeyDown(205) Then dBodyAddForce(Trailer,10,0,0)
;	
;End Function
;
</textarea><br><br>I would suggest making a much smaller container/dice and give them a much lighter mass. You're going to need a good understanding of how the ODE joints and forces work to get this working well. The reason you're having problems adding force to the shaker is because at the moment the shaker, dice and car probably weigh several tons. Raising the force to about 100000 might move it, but it will behave like an extremely heavy shaker with two huge heavy dice and a car(!) inside it ;)<br><br>Scale it down, then experiment with the joints and forces a bit more. <br><br></td></tr></table><br>
<a name="994732"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#77">[#77]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I would suggest making a much smaller container/dice and give them a much lighter mass. You're going to need a good understanding of how the ODE joints and forces work to get this working well. The reason you're having problems adding force to the shaker is because at the moment the shaker, dice and car probably weigh several tons. Raising the force to about 100000 might move it, but it will behave like an extremely heavy shaker with two huge heavy dice and a car(!) inside it ;)<br><br>Scale it down, then experiment with the joints and forces a bit more. <br></div><br><br>thanks very much for the prompt feedback, I agree I need to invest more time in absorbing the fundamentals of ODE, the reason for the anchor on one of the dice was some dev I was attempting a while back where I was attempting to manipulate the dice with forces - it raised a smile when you mentioned the weight of my shaker and dice! <br><br></td></tr></table><br>
<a name="994748"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#78">[#78]</a></td></tr></table></td></tr><tr ><td class="posttext"> @VIP3R,  just tried it, the tilt angle that it rests at will help me a lot with analysing my way forwards, thanks again.<br><br>Should you use primitives for dynamic objects and trimeshes for static objects?  I'm only asking because I created a cup in UU3D, brought it in successfully into the world, assigned some trimeshes to it successfully and the dice would fall into the cup made up of trimeshes.<br><br>I can rotate my the mesh associated with the cup(which you can just see the top of below, keeps the image small though!), but the trimesh associated with the cup stays in the same place.  I used the following code to rotate the trimesh:<br><br>I have added a couple of more anchor points to my cuboid and I can see a way forward with the cuboid shaker.  <br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Function UpdateGeoms()
	
	rotatesum=rotatesum+1
	
	For ode.ODEGeom=Each ODEGeom
		PositionEntity ode\mesh,dGeomGetPositionX(ode\geom),dGeomGetPositionY(ode\geom),dGeomGetPositionZ(ode\geom)
		RotateEntity ode\mesh,dGeomGetPitch(ode\geom),dGeomGetYaw(ode\geom),dGeomGetRoll(ode\geom)
		
		
		;the following rotates the cup but not the trimesh associated with the cup?
		
		If ode\mesh=refcupmesh
			RotateEntity ode\mesh,dGeomGetPitch(ode\geom),rotatesum,dGeomGetRoll(ode\geom)
		EndIf
	Next
	
End Function


</textarea><br><br><br><img src="http://www.wishingwellsoftware.co.uk/shaker2.jpg"> <br><br></td></tr></table><br>
<a name="995532"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#79">[#79]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi BP,<br><br>Don't edit your older posts with new questions, I might miss them (nearly missed this one). It's fine to just create a new post :)<br><br>TriMeshes are best used as static meshes, they can be used dynamically but they're slow/unreliable compared to primitives. The cup rotation issue is due to the fact you're only rotating the visible Blitz Entity (ode\mesh) and not the actual TriMesh (ode\geom).<br><br>Remember, the ode\geom is the invisible ODE collision geometry and ode\mesh is the actual visible representation of the geom (Blitz Entity).<br><br>To move an ODE object you need to apply force to the body (or joint) only, not move/rotate the collision geometry (geom) or visible geometry (mesh). The geom and mesh will automatically move/rotate with the body. <br><br></td></tr></table><br>
<a name="995825"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Charrua</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#80">[#80]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi<br>I'm working on some "utility cars" on blitz3d and ode, having fun an learning some (and having headaches too). Plus I'm workin on a World Creator that will have some ode support in the near future (hope so), i plan to create this and other machines with the editor and include some general purpose code to handle the machines in the way i do in the .exe in the nex line. Basically a state machine for the joints with 3 stops and a pair of key to move (aply forces to the joint) from one stop to the next. <br><br>Link:<br><a href="http://odriozola.juanignacio.googlepages.com/utility_cars.zip" target="_blank">Click here!</a><br><br>screenshot:<br><img src="http://odriozola.juanignacio.googlepages.com/screen4.jpg"><br><br>try it and givme some feedback<br><br>best regards<br><br>Juan <br><br></td></tr></table><br>
<a name="995833"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ZJP</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#81">[#81]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nice and fun. ;)<br>Thx<br><br><br>JP <br><br></td></tr></table><br>
<a name="995952"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >EmerGki</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#82">[#82]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Jim,<br><br>I'm with a problem (I talked about it in the past), but, unfortunatelly, I can't get it working correctly. <br><br>I need to reposition a truck and trailer, but, I can't, the vehicles always go "flying", I tried to make what you said in the previous JV-Ode topic, but, without success... <br><br>Can you help me again? (making a demo version of your truck and trailer with reposition and rotation?)<br><br>Thank you. <br><br></td></tr></table><br>
<a name="995981"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#83">[#83]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Charrua, you have a lot of potential with this, great fun.<br><br>@Vip3R, thanks for the advice. <br><br></td></tr></table><br>
<a name="996057"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#84">[#84]</a></td></tr></table></td></tr><tr ><td class="posttext"> You're welcome BP :)<br><br>@Charrua: Excellent work so far. The two middle wheels are snagging on the ground a bit when steering full lock, maybe the turning circle is too tight? Not a major issue, so don't worry about it too much. It's worth posting it in the Showcase forum, you might get some good feedback there too.<br><br>@EmerGki: I don't know why you're struggling with this, you must be overlooking something in your code somewhere. Anyway, here's the Truck &amp; Trailer demo with a reset option (F1). The reset code is all contained within the UpdateKeys() function...<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #                                       JV-ODE Truck Demo                                         #
; #                                  Code by Jim Williams (VIP3R)                                   #
; #                              Devious Codeworks - Copyright © 2008                               #
; ###################################################################################################

Include "JV-ODE.bb"

AppTitle "JV-ODE Car Demo - Truck &amp; Trailer"

Graphics3D 800,600,0,2

Global CMass#=400.0				; ### Cab Mass
Global WMass#=14.0				; ### Wheel Mass
Global TMass#=800.0				; ### Trailer Mass

Global WorldERP#=1.0			; ### World Error Correction
Global WorldFriction#=80.0		; ### World Friction

Global Torque#=48.0				; ### Joint Torque
Global SuspensionHS#=0.01		; ### Suspension Hardness/Softness (Higher=Softer - Lower=Harder)

Global Force#=0.0
Global Steer#=0.0

Global Cab
Global CGeom
Global CMesh

Global Trailer
Global TGeom
Global TMesh

Global TruckStartY=4

Dim Wheel(6)
Dim WGeom(6)
Dim Joint(6)

Dim TWheel(6)
Dim TWGeom(6)
Dim TJoint(6)

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

; ###################################################################################################

; ### Setup ODE

dInitODE()

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,-0.98,0)
dWorldSetERP(World,WorldERP)

dContactSetMode(dContactSlip1)
dContactSetMu(WorldFriction)

; ### Create Cab

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
Cab=ode\body
dBodySetPosition(ode\body,0,TruckStartY,0)
dBodySetRotation(ode\body,0,0,0)
mass=dMassCreate()
dMassSetBoxTotal(mass,CMass,3,1,8)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
ode\geom=dCreateBox(Space,3,1,8)
CGeom=ode\geom
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
CMesh=ode\mesh
ScaleMesh ode\mesh,1.5,0.5,4
EntityColor ode\mesh,40,80,255

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,3,2,4)
dGeomSetBody(ode\geom,Cab)
dGeomSetOffsetPosition(ode\geom,0,1.5,2)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,1.5,1,2
EntityColor ode\mesh,40,80,255
EntityAlpha ode\mesh,0.7

; ### Create Wheels

For count=1 To 6
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	Wheel(count)=ode\body
	dBodySetPosition(ode\body,0,0,0)
	dBodySetRotation(ode\body,0,0,90)
	mass=dMassCreate()
	dMassSetSphereTotal(mass,WMass,0.7)
	dBodySetMass(ode\body,mass)
	dMassDestroy(mass)
	ode\geom=dCreateSphere(Space,0.7)
	WGeom(count)=ode\geom
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder()
	ScaleMesh ode\mesh,0.7,0.25,0.7
	EntityColor ode\mesh,255,255,255
Next

dBodySetPosition(Wheel(1),-2,TruckStartY-0.5,+3)
dBodySetPosition(Wheel(2),+2,TruckStartY-0.5,+3)
dBodySetPosition(Wheel(3),-2,TruckStartY-0.5,-1.5)
dBodySetPosition(Wheel(4),+2,TruckStartY-0.5,-1.5)
dBodySetPosition(Wheel(5),-2,TruckStartY-0.5,-3)
dBodySetPosition(Wheel(6),+2,TruckStartY-0.5,-3)

; ### Create Trailer

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
Trailer=ode\body
dBodySetPosition(ode\body,0,TruckStartY+2,-10.5)
dBodySetRotation(ode\body,0,0,0)
mass=dMassCreate()
dMassSetBoxTotal(mass,TMass,3,3,18)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
ode\geom=dCreateBox(Space,3,3,18)
TGeom=ode\geom
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
TMesh=ode\mesh
ScaleMesh ode\mesh,1.5,1.5,9
EntityColor ode\mesh,20,40,128
EntityAlpha ode\mesh,0.7

; ### Create Trailer Wheels

For count=1 To 6
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	TWheel(count)=ode\body
	dBodySetPosition(ode\body,0,0,0)
	dBodySetRotation(ode\body,0,0,90)
	mass=dMassCreate()
	dMassSetSphereTotal(mass,WMass,0.7)
	dBodySetMass(ode\body,mass)
	dMassDestroy(mass)
	ode\geom=dCreateSphere(Space,0.7)
	TWGeom(count)=ode\geom
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder()
	ScaleMesh ode\mesh,0.7,0.25,0.7
	EntityColor ode\mesh,255,255,255
Next

dBodySetPosition(TWheel(1),-2,TruckStartY-0.5,-18)
dBodySetPosition(TWheel(2),+2,TruckStartY-0.5,-18)
dBodySetPosition(TWheel(3),-2,TruckStartY-0.5,-16.5)
dBodySetPosition(TWheel(4),+2,TruckStartY-0.5,-16.5)
dBodySetPosition(TWheel(5),-2,TruckStartY-0.5,-15)
dBodySetPosition(TWheel(6),+2,TruckStartY-0.5,-15)

; ### Create Objects

SeedRnd MilliSecs()

For spheres=1 To 20
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	dBodySetPosition(ode\body,Rand(-100,100),30,Rand(-100,100))
	dBodySetRotation(ode\body,0,0,0)
	ode\geom=dCreateSphere(Space,4)
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateSphere()
	ScaleMesh ode\mesh,4,4,4
	EntityColor ode\mesh,Rand(0,255),Rand(0,255),Rand(0,255)
	EntityShininess ode\mesh,0.7
Next

For capsules=1 To 20
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	dBodySetPosition(ode\body,Rand(-100,100),30,Rand(-100,100))
	dBodySetRotation(ode\body,90,0,0)
	ode\geom=dCreateCapsule(Space,1,8)
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder()
	ScaleMesh ode\mesh,1,5,1
	RotateMesh ode\mesh,90,0,0	; ### Align Blitz3D Cylinder To ODE Capsule
	EntityColor ode\mesh,Rand(0,255),Rand(0,255),Rand(0,255)
	EntityShininess ode\mesh,0.7
Next

; ### Create Light

Global Light=CreateLight()
RotateEntity Light,50,-50,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create Camera

Global CameraPivot=CreatePivot()

Global Camera=CreateCamera(CameraPivot)
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000

; ### Create Plane

dCreatePlane(Space,0,1,0,0)

Global Plane=CreatePlane()
EntityAlpha Plane,0.8

EntityTexture Plane,PlaneTexture()

CreateMirror()

; ###################################################################################################

; ### Blitz3D Static Object (White)

Global Blitz3DObject=CreateCube()
ScaleMesh Blitz3DObject,1,4,20
PositionEntity Blitz3DObject,10,5,40
RotateEntity Blitz3DObject,-10,8,4
EntityColor Blitz3DObject,255,255,255

; ### ODE Static Object (Blue)

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,2,8,40)
dGeomSetPosition(ode\geom,20,5,40)
dGeomSetRotation(ode\geom,-10,8,4)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,1,4,20
EntityColor ode\mesh,0,100,200

; ### ODE Static Object (Red)

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,18,0.2,40)
dGeomSetPosition(ode\geom,-20,4.9,40)
dGeomSetRotation(ode\geom,-14,0,0)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,9,0.1,20
EntityColor ode\mesh,200,0,100

; ###################################################################################################

SetupTruck()

While Not KeyHit(1)

	UpdateKeys()

	UpdateTruck()

	UpdateGeoms()

	PTime=MilliSecs()

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)

	PhysicsTime#=MilliSecs()-PTime

	UpdateCam()

	RenderWorld

	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime
	Text 0,50,"Force:"+Force
	Text 0,65,"Torque:"+Torque
	Text 290,0,"F1 - Reset Truck &amp; Trailer"
	Text 640,0,"A - Accelerate"
	Text 640,15,"Z - Brake/Reverse"
	Text 640,30,"Arrows - Steering"
	Text 640,45,"Space - Reset Truck"

	Flip 1

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function SetupTruck()

For count=1 To 6
	Joint(count)=dJointCreateHinge2(World,0)
	dJointAttach(Joint(count),Cab,Wheel(count))
	dJointSetHinge2Anchor(Joint(count),dBodyGetPositionX(Wheel(count)),dBodyGetPositionY(Wheel(count)),dBodyGetPositionZ(Wheel(count)))
	dJointSetHinge2Axis1(Joint(count),0,1,0)
	dJointSetHinge2Axis2(Joint(count),-1,0,0)
	dJointSetHinge2Param(Joint(count),dParamSuspensionERP,0.8)
	dJointSetHinge2Param(Joint(count),dParamSuspensionCFM,SuspensionHS)
	If count&gt;2
		dJointSetHinge2Param(Joint(count),dParamLoStop,0)
		dJointSetHinge2Param(Joint(count),dParamHiStop,0)
		End If
Next

For count=1 To 6
	TJoint(count)=dJointCreateHinge2(World,0)
	dJointAttach(TJoint(count),Trailer,TWheel(count))
	dJointSetHinge2Anchor(TJoint(count),dBodyGetPositionX(TWheel(count)),dBodyGetPositionY(TWheel(count)),dBodyGetPositionZ(TWheel(count)))
	dJointSetHinge2Axis1(TJoint(count),0,1,0)
	dJointSetHinge2Axis2(TJoint(count),-1,0,0)
	dJointSetHinge2Param(TJoint(count),dParamSuspensionERP,0.8)
	dJointSetHinge2Param(TJoint(count),dParamSuspensionCFM,SuspensionHS)
	dJointSetHinge2Param(TJoint(count),dParamLoStop,0)
	dJointSetHinge2Param(TJoint(count),dParamHiStop,0)
Next

AJoint=dJointCreateHinge(World,0)
dJointAttach(AJoint,Trailer,Cab)
dJointSetHingeAnchor(AJoint,dBodyGetPositionX(Cab),dBodyGetPositionY(Cab),dBodyGetPositionZ(Cab)-2)
dJointSetHingeAxis(AJoint,0,1,0)
dJointSetHingeParam(AJoint,dParamSuspensionERP,0.8)
dJointSetHingeParam(AJoint,dParamSuspensionCFM,SuspensionHS)
dJointSetHingeParam(AJoint,dParamLoStop,-2)
dJointSetHingeParam(AJoint,dParamHiStop,2)

End Function

; ###################################################################################################

Function UpdateKeys()

If KeyDown(30)=1
	Force=Force+0.08
	If Force&gt;30 Then Force=30
	End If

If KeyDown(44)=1
	Force=Force-0.1
	If Force&lt;-10 Then Force=-10
	If Force&gt;0 Then Force=Force*0.97
	End If

If KeyDown(30)=0 And KeyDown(44)=0 Then Force=Force*0.99

If KeyDown(203)=1 Or KeyDown(205)=1
	If KeyDown(203)=1
		Steer=0.5
		Else
		Steer=-0.5
		End If
	Else
	Steer=0.0
	End If

If KeyHit(57)=1
	Force=0.0
	dBodySetRotation(Cab,dGeomGetPitch(CGeom),dGeomGetYaw(CGeom),0)
	dBodySetRotation(Trailer,dGeomGetPitch(TGeom),dGeomGetYaw(TGeom),0)
	End If

If KeyHit(59)=1
	Steer=0.0
	Force=0.0

	; ### Cab
	dBodySetForce(Cab,0,0,0)
	dBodySetTorque(Cab,0,0,0)
	dBodySetAngularVel(Cab,0,0,0)
	dBodySetLinearVel(Cab,0,0,0)

	dBodySetPosition(Cab,0,TruckStartY,0)
	dBodySetRotation(Cab,0,0,0)

	; ### Wheel(count) 1-6
	For count=1 To 6
		dBodySetForce(Wheel(count),0,0,0)
		dBodySetTorque(Wheel(count),0,0,0)
		dBodySetAngularVel(Wheel(count),0,0,0)
		dBodySetLinearVel(Wheel(count),0,0,0)
	Next

	dBodySetPosition(Wheel(1),-2,TruckStartY-0.5,+3)
	dBodySetPosition(Wheel(2),+2,TruckStartY-0.5,+3)
	dBodySetPosition(Wheel(3),-2,TruckStartY-0.5,-1.5)
	dBodySetPosition(Wheel(4),+2,TruckStartY-0.5,-1.5)
	dBodySetPosition(Wheel(5),-2,TruckStartY-0.5,-3)
	dBodySetPosition(Wheel(6),+2,TruckStartY-0.5,-3)

	For count=1 To 6
		dBodySetRotation(Wheel(count),0,0,90)
	Next

	; ### Trailer
	dBodySetForce(Trailer,0,0,0)
	dBodySetTorque(Trailer,0,0,0)
	dBodySetAngularVel(Trailer,0,0,0)
	dBodySetLinearVel(Trailer,0,0,0)

	dBodySetPosition(Trailer,0,TruckStartY+2,-10.5)
	dBodySetRotation(Trailer,0,0,0)

	; ### TWheel(count) 1-6
	For count=1 To 6
		dBodySetForce(TWheel(count),0,0,0)
		dBodySetTorque(TWheel(count),0,0,0)
		dBodySetAngularVel(TWheel(count),0,0,0)
		dBodySetLinearVel(TWheel(count),0,0,0)
	Next

	dBodySetPosition(TWheel(1),-2,TruckStartY-0.5,-18)
	dBodySetPosition(TWheel(2),+2,TruckStartY-0.5,-18)
	dBodySetPosition(TWheel(3),-2,TruckStartY-0.5,-16.5)
	dBodySetPosition(TWheel(4),+2,TruckStartY-0.5,-16.5)
	dBodySetPosition(TWheel(5),-2,TruckStartY-0.5,-15)
	dBodySetPosition(TWheel(6),+2,TruckStartY-0.5,-15)

	For count=1 To 6
		dBodySetRotation(TWheel(count),0,0,90)
	Next
	End If

End Function

; ###################################################################################################

Function UpdateTruck()

For count=1 To 6
	dBodyEnable(Wheel(count))
	dBodyEnable(TWheel(count))
Next

dBodyEnable(Cab)
dBodyEnable(Trailer)

For count=1 To 6
	dJointSetHinge2Param(Joint(count),dParamVel2,Force)
	dJointSetHinge2Param(Joint(count),dParamFMax2,Torque)
Next

For count=1 To 2
	angle#=Steer-dJointGetHinge2Angle1(Joint(count))
	dJointSetHinge2Param(Joint(count),dParamVel,angle)
	dJointSetHinge2Param(Joint(count),dParamFMax,400)
Next

End Function

; ###################################################################################################

Function UpdateCam()

PositionEntity Camera,0,15,-25
RotateEntity Camera,30,0,0

PivotX#=Cos(EntityYaw(CMesh)-90)+EntityX(CMesh)
PivotY#=EntityY(CMesh)
PivotZ#=Sin(EntityYaw(CMesh)-90)+EntityZ(CMesh)

PositionEntity CameraPivot,PivotX,PivotY,PivotZ

PointEntity CameraPivot,CMesh

End Function

; ###################################################################################################

Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
	PositionEntity ode\mesh,dGeomGetPositionX(ode\geom),dGeomGetPositionY(ode\geom),dGeomGetPositionZ(ode\geom)
	RotateEntity ode\mesh,dGeomGetPitch(ode\geom),dGeomGetYaw(ode\geom),dGeomGetRoll(ode\geom)
Next

End Function

; ###################################################################################################
</textarea> <br><br></td></tr></table><br>
<a name="996092"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >EmerGki</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#85">[#85]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thank you Viper, I'll try... <br><br></td></tr></table><br>
<a name="996227"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Charrua</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#86">[#86]</a></td></tr></table></td></tr><tr ><td class="posttext"> thank's for your comment's and suggestions!<br><br>i worked on it some month's ago and for many reasosns i have to stop and go in another direction (and other not programming thing's). I have to work on it some more and probably i'll continue wiht it very soon.<br><br>That's my idea of learn something..., try to do one thing with it.<br><br>thank's again<br><br>Juan <br><br></td></tr></table><br>
<a name="996261"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#87">[#87]</a></td></tr></table></td></tr><tr ><td class="posttext"> Eyup Vip3r.<br><br>Sorry about this! I've changed my email again (I fell out with my old ISP :/)<br>(It's in my profile.. :-) )<br>Any chance you could change your records and drop me a line? I know i've downloaded this but where on earth I saved it I will never now! X-D<br><br>Cheers bud! <br><br></td></tr></table><br>
<a name="996311"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#88">[#88]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey Cygnus, good to hear from you  :)<br><br>Your email records are up-to-date and I've sent the latest download links for you. <br><br></td></tr></table><br>
<a name="996455"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#89">[#89]</a></td></tr></table></td></tr><tr ><td class="posttext"> Lol, cheers Vip3r! However, I just found out that the site details did not update correctly (as in, 2 minutes ago they were back at their old settings, but I changed them this morning before posting! I think I did something daft.<br><br>My current Gmail account is now in there. Damiensturdy@... X-)<br><br>Sorry to keep messing you around, I feel like a pillock! <br><br></td></tr></table><br>
<a name="996597"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#90">[#90]</a></td></tr></table></td></tr><tr ><td class="posttext"> ...No worries, I found my old download. Woop!<br><br>Can anyone help with regard to "injecting" collisions? trimesh collisions seem a little flakey but the blitz collisions work well, i'd like to pass blitz collisions to ODE instead of getting ODE to do that work, if possible. <br><br></td></tr></table><br>
<a name="996644"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#91">[#91]</a></td></tr></table></td></tr><tr ><td class="posttext"> No problem, I've updated your email addresses  :)<br><br>It's not possible to pass the Blitz collision data to JV-ODE, if it were possible it would be slower and have an increased chance of penetration issues.<br><br>However, ODE has changed a lot with the more recent builds and this has directly affected the old <i>dGeomTriMeshDataBuildSimple()</i> method of creating TriMeshes which were previously used in JV-ODE. Using the old build simple function is now not recommended in JV-ODE as the TriMesh collisions are not working very well at all (this might be what you're experiencing).<br><br>The new functions for building TriMeshes are <i>dGeomTriMeshDataBuildSingle()</i> or <i>dGeomTriMeshDataBuildSingle1()</i> (if you want to define the normals). These have much more reliable collisions than the older builds. The JV-ODE demos use the <i>dGeomTriMeshDataBuildSingle()</i> function now.<br><br>If you're already using the new functions, it may be an issue with the mesh itself. Note that TriMesh&gt;TriMesh collisions although better, are still slow and unreliable in comparison to TriMesh&gt;primitive collisions. <br><br></td></tr></table><br>
<a name="996652"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#92">[#92]</a></td></tr></table></td></tr><tr ><td class="posttext"> AH! I didn't see the new functions, i just saw my old code and figured that was still in use. (In fact, they are buggy if the mesh is offset. that was part of the issue)<br><br>I'll try the new funcs now! 8-D<br><br>[edit]<br><br>Actually, i was using the new functions. The old ODE wrapper for B3D required injecting collisions, not sure how it did it behind the scenes but I think it was simple. I've worked around it now and got my old desired behavior.<br><br>The mesh issue is ongoing however, one mesh is generated at runtime but the second third of the track just doesnt appear to be used by ODE. the cars fall off. Is there a limit to the size of mesh/vertex count? <br><br></td></tr></table><br>
<a name="996683"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#93">[#93]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you mean Vordermans ODE wrapper then the collision detection would have only been accessible in Blitz IIRC. In JV-ODE the collision detection is enclosed within the DLL using a callback, so you don't have direct access to the geom structs, contact joints/functions externally. Doing that in Blitz and passing it to and from the DLL would be much slower.<br><br>There's no limit to the vert/indice counts, whenever there has been problems like this it's always due to either the mesh construction itself (wrong vert/indice ordering) so the TriMesh isn't created correctly, or in the case of multiple meshes, incorrect positioning of the TriMeshes.<br><br>If you're generating the mesh at runtime, make sure you create the verts/indices in the same order as a standard .B3D mesh. Even some .B3D meshes have been known to display normally in Blitz but don't convert to a TriMesh correctly, because they were saved using the wrong .B3D format specs. The only one that worked for me was <a href="/codearcs.php?code=866" target="_blank">this one (2007a version)</a> and it required some hacking. Why Blitz3D doesn't have a native SaveB3D function is beyond me. <br><br></td></tr></table><br>
<a name="996838"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#94">[#94]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hm, i guess I could try spitting out then reloading it. I'll toy with it a bit.<br><br>YEah, the old vorderman wrapper! I could never be arsed to move the racer code over to a new ODE wrapper, i've started rewriting it several times. For the sake of the original and how it felt, I decided to try to bring that one up to speed so people could play it. Seemed like less work, and indeed I was right.<br><br>I simply removed the calls to the old ODE wrapper dll, and replaced them with JVODE calls. Works a treat, much much MUCH faster. :-) and no more crashes when 12 cars crash.<br><br>though, JV-ode has introduced another problem, after 5 mins of playing around the camera starts to zoom out and eventually crashes. there's no code in my racer to zoom the camera though (well there is, in some camera handling code, but that code is not touched at all in normal view.) so it's odd, like somethings corrupting. Hmph.<br><br><br>[edit]<br><br>Screw it.<br><br>Copymesh, flipmesh, addmesh. Job done. Not so efficient, but its low enough poly not to matter these days!<br>Anyhoo, cheers for your help, this is going nicely! <br><br></td></tr></table><br>
<a name="996856"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KronosUK</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#95">[#95]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>Is there anyway to duplicate trimeshes other than reading them in from a mesh everytime you want to create one. Something like a copymesh command except for trimeshes is what Im thinking of.<br><br>I want to make a terrain made up of tiles but loading the same tile from scratch everytime seems like it might be slow. <br><br></td></tr></table><br>
<a name="996911"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#96">[#96]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Cygnus: The camera issue sounds like the simulation has exploded and the camera is focused on an object that has shot off into the distance. If that's the case, it might be a collision penetration or dodgy collision contact somewhere. JV-ODE won't directly affect the camera.<br><br>@KronosUK: Good question, ODE doesn't provide a copy TriMesh function as such but there is a way to do it. If you examine the CreateTriMesh() function located inside the 'JV-ODE.bb' file, you will see two banks of data are created for the TriMesh (VertBank and TriBank), then the TriMesh is created with those banks using the last three lines...<br><pre class=code>
TriMeshData=dGeomTriMeshDataCreate()

dGeomTriMeshDataBuildSingle(TriMeshData,VertBank,4,VertCount,TriBank,TriCount*3,4)

Return dCreateTriMesh(trispace,TriMeshData)
</pre>What you need to do is create those two banks of data for each tile you want to make duplicates of, then whenever you want to make a copy, create a new TriMesh using the last three lines (above) with the banks you have previously created and stored. This will eliminate the need to iterate through the meshes to build the bank data every time you create the duplicate TriMesh tile. <br><br></td></tr></table><br>
<a name="997050"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#97">[#97]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm, I initially thought so Vip3r, but it actually happens over a slow period of time, and appears to be from repeatedly adding torque to an object. the camera will very very slowly start zooming out (only along one axis- so the image stretches) until it eventually crashes hard.<br><br>It's very very odd and doesn't happen with ye olde ODE wrapper. I'd have thought an incorrect memory access would show itself in a bit of a better way- like DEP?<br><br>Anyway it appears that it doesnt happen when the cars stay stable, so i think getting a good sim will resolve it :-) <br><br></td></tr></table><br>
<a name="997884"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Chroma</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#98">[#98]</a></td></tr></table></td></tr><tr ><td class="posttext"> Jim, I checked my email and also the spam folder.  Didn't see it.  Can you resend or tell me another way we can do this?<br><br>@Wayne:  You have a great attitude and I hope you never have to go through something like this...or it might change. <br><br></td></tr></table><br>
<a name="998054"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#99">[#99]</a></td></tr></table></td></tr><tr ><td class="posttext"> VIP3R, I've stuck a little function in the code archives that will allow the generation of a 'game board' , or steps if you like, purely with static cubes.  The function is here &amp; can be pasted into any of the demos.<br><br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=2615" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=2615</a><br><br>A little snapshot of calling the function with 3,3 being passed with 25 madsteps being set within the function:-<br><br><img src="http://www.wishingwellsoftware.co.uk/coolsteps.jpg"><br><br>As someone said recently your lib is the dogs danglies, well thats my interpretation.  I've just updated the function so that if people wanna mess with the width &amp; depth of the cubes it'll auto re-position the cubes to accomodate that.<br><br><img src="http://www.wishingwellsoftware.co.uk/coolsteps2.jpg"> <br><br></td></tr></table><br>
<a name="998080"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#100">[#100]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here is a slope to drive down, jim, let me know if you want me to remove the code.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #                                        JV-ODE Car Demo                                          #
; #                                  Code by Jim Williams (VIP3R)                                   #
; #                Make_game_board / Slope function by Mark Gormley (Blitzplotter)                  #
; #                              Devious Codeworks - Copyright © 2008                               #
; ###################################################################################################



Include "JV-ODE.bb"

AppTitle "JV-ODE Car Demo - watch out you are the top of the ramp."

Graphics3D 800,600,0,2

Global CMass#=200.0				; ### Car Mass
Global WMass#=14.0				; ### Wheel Mass

Global WorldERP#=1.0			; ### World Error Correction
Global WorldFriction#=70.0		; ### World Friction

Global Torque#=24.0				; ### Joint Torque
Global SuspensionHS#=0.01		; ### Suspension Hardness/Softness (Higher=Softer - Lower=Harder)

Global Force#=0.0
Global Steer#=0.0

Global Car
Global CGeom
Global CMesh

Global CarStartX=25
Global CarStartY=55
Global CarStartZ=250

Dim Wheel(4)
Dim WGeom(4)
Dim Joint(4)

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

; ###################################################################################################

; ### Setup ODE

dInitODE()

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,-0.98,0)
dWorldSetERP(World,WorldERP)

dContactSetMode(dContactSlip1)
dContactSetMu(WorldFriction)

; ### add a terrain height map
;;TERRAIN
;Global terrain = LoadTerrain("height4.jpg")
;TerrainDetail terrain,2500,True
;ScaleEntity terrain, 3,15,3
;PositionEntity terrain,-1000,0,-530
;;ter_tex = LoadTexture("mossyground.bmp")
;;ter_tex = LoadTexture("ground_bmp_64.bmp")
;EntityTexture terrain,ter_tex
;EntityRadius terrain,0.2
;EntityType terrain,SCENERY

dContactSetMode(dContactBounce)
dContactSetBounce(0.1)
dContactSetMu(48)

dContactSetMode(dContactSlip1)
dContactSetMu(WorldFriction)

; ### end of add a terrain height map

; ### Create Car Body

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
Car=ode\body
dBodySetPosition(ode\body,CarStartX,CarStartY,CarStartZ)
dBodySetRotation(ode\body,0,0,0)
mass=dMassCreate()
dMassSetBoxTotal(mass,CMass,3,1,4)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
ode\geom=dCreateBox(Space,3,1,4)
CGeom=ode\geom
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
CMesh=ode\mesh
ScaleMesh ode\mesh,1.5,0.5,2
EntityColor ode\mesh,40,80,255

; ### Create Wheels

For count=1 To 4
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	Wheel(count)=ode\body
	dBodySetPosition(ode\body,0,0,0)
	dBodySetRotation(ode\body,0,0,90)
	mass=dMassCreate()
	dMassSetSphereTotal(mass,WMass,0.7)
	dBodySetMass(ode\body,mass)
	dMassDestroy(mass)
	ode\geom=dCreateSphere(Space,0.7)
	WGeom(count)=ode\geom
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder()
	ScaleMesh ode\mesh,0.7,0.25,0.7
	EntityColor ode\mesh,255,255,255
Next

dBodySetPosition(Wheel(1),CarStartX-2,CarStartY-0.5,CarStartZ+2)
dBodySetPosition(Wheel(2),CarStartX+2,CarStartY-0.5,CarStartZ+2)
dBodySetPosition(Wheel(3),CarStartX-2,CarStartY-0.5,CarStartZ-2)
dBodySetPosition(Wheel(4),CarStartX+2,CarStartY-0.5,CarStartZ-2)


RotateEntity Car,0,180,0

; ### Create Objects

SeedRnd MilliSecs()

For spheres=1 To 10
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	dBodySetPosition(ode\body,Rand(10,40),130,Rand(30,160))
	dBodySetRotation(ode\body,0,0,0)
	ode\geom=dCreateSphere(Space,4)
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateSphere()
	ScaleMesh ode\mesh,4,4,4
	EntityColor ode\mesh,Rand(0,255),Rand(0,255),Rand(0,255)
	EntityShininess ode\mesh,0.7
Next

For capsules=1 To 10
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	dBodySetPosition(ode\body,Rand(10,40),130,Rand(30,160))
	dBodySetRotation(ode\body,90,0,0)
	ode\geom=dCreateCapsule(Space,1,8)
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder()
	ScaleMesh ode\mesh,1,5,1
	RotateMesh ode\mesh,90,0,0	; ### Align Blitz3D Cylinder To ODE Capsule
	EntityColor ode\mesh,Rand(0,255),Rand(0,255),Rand(0,255)
	EntityShininess ode\mesh,0.7
Next




; ### function call for game board, or stairs

make_game_board(1,1)  ;this will make a nice slope/ramp
; NOTE:  you need to reduce the size of the cubes within the function before
;        increasing the arguments to the function to prevent stack overflows.


; ### Create Light

Global Light=CreateLight()
RotateEntity Light,50,-50,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create Camera

Global CameraPivot=CreatePivot()

Global Camera=CreateCamera(CameraPivot)
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000

; ### Create Plane

dCreatePlane(Space,0,1,0,0)

Global Plane=CreatePlane()
EntityAlpha Plane,0.8

EntityTexture Plane,PlaneTexture()

CreateMirror()

; ###################################################################################################

; ### Blitz3D Static Object (White)

Global Blitz3DObject=CreateCube()
ScaleMesh Blitz3DObject,1,4,20
PositionEntity Blitz3DObject,10,5,40
RotateEntity Blitz3DObject,-10,8,4
EntityColor Blitz3DObject,255,255,255

; ### ODE Static Object (Blue)

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,2,8,40)
dGeomSetPosition(ode\geom,20,5,40)
dGeomSetRotation(ode\geom,-10,8,4)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,1,4,20
EntityColor ode\mesh,0,100,200

; ### ODE Static Object (Red)

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,18,0.2,40)
dGeomSetPosition(ode\geom,30,4.9,-230)
dGeomSetRotation(ode\geom,-14,0,0)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,9,0.1,20
EntityColor ode\mesh,200,0,100

; ###################################################################################################

SetupCar()

While Not KeyHit(1)

	UpdateKeys()

	UpdateCar()

	UpdateGeoms()

	PTime=MilliSecs()

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)

	PhysicsTime#=MilliSecs()-PTime

	UpdateCam()

	RenderWorld

	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime
	Text 0,50,"Force:"+Force
	Text 0,65,"Torque:"+Torque
	Text 640,0,"A - Accelerate"
	Text 640,15,"Z - Brake/Reverse"
	Text 640,30,"Arrows - Steering"
	Text 640,45,"Space - Reset Car"

	Flip 1

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function SetupCar()

For count=1 To 4
	Joint(count)=dJointCreateHinge2(World,0)
	dJointAttach(Joint(count),Car,Wheel(count))
	dJointSetHinge2Anchor(Joint(count),dBodyGetPositionX(Wheel(count)),dBodyGetPositionY(Wheel(count)),dBodyGetPositionZ(Wheel(count)))
	dJointSetHinge2Axis1(Joint(count),0,1,0)
	dJointSetHinge2Axis2(Joint(count),-1,0,0)
	dJointSetHinge2Param(Joint(count),dParamSuspensionERP,0.8)
	dJointSetHinge2Param(Joint(count),dParamSuspensionCFM,SuspensionHS)
	If count&gt;2
		dJointSetHinge2Param(Joint(count),dParamLoStop,0)
		dJointSetHinge2Param(Joint(count),dParamHiStop,0)
		End If
Next

End Function

; ###################################################################################################

Function UpdateKeys()

If KeyDown(30)=1
	Force=Force+0.08
	If Force&gt;30 Then Force=30
	End If

If KeyDown(44)=1
	Force=Force-0.1
	If Force&lt;-10 Then Force=-10
	If Force&gt;0 Then Force=Force*0.97
	End If

If KeyDown(30)=0 And KeyDown(44)=0 Then Force=Force*0.99

If KeyDown(203)=1 Or KeyDown(205)=1
	If KeyDown(203)=1
		Steer=0.5
		Else
		Steer=-0.5
		End If
	Else
	Steer=0.0
	End If

If KeyHit(57)=1
	Force=0.0
	dBodySetRotation(Car,dGeomGetPitch(CGeom),dGeomGetYaw(CGeom),0)
	End If

End Function

; ###################################################################################################

Function UpdateCar()

For count=1 To 4
	dBodyEnable(Wheel(count))
Next

dBodyEnable(Car)

For count=1 To 4
	dJointSetHinge2Param(Joint(count),dParamVel2,Force)
	dJointSetHinge2Param(Joint(count),dParamFMax2,Torque)
Next

For count=1 To 2
	angle#=Steer-dJointGetHinge2Angle1(Joint(count))
	dJointSetHinge2Param(Joint(count),dParamVel,angle)
	dJointSetHinge2Param(Joint(count),dParamFMax,400)
Next

End Function

; ###################################################################################################

Function UpdateCam()

	PositionEntity Camera,0,30,-50

PivotX#=Cos(EntityYaw(CMesh)-90)+EntityX(CMesh)
PivotY#=EntityY(CMesh)
PivotZ#=Sin(EntityYaw(CMesh)-90)+EntityZ(CMesh)

PositionEntity CameraPivot,PivotX,PivotY,PivotZ

PointEntity CameraPivot,CMesh

End Function

; ###################################################################################################

Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
	PositionEntity ode\mesh,dGeomGetPositionX(ode\geom),dGeomGetPositionY(ode\geom),dGeomGetPositionZ(ode\geom)
	RotateEntity ode\mesh,dGeomGetPitch(ode\geom),dGeomGetYaw(ode\geom),dGeomGetRoll(ode\geom)
Next

End Function

; ###################################################################################################

Function make_game_board(x,y)
	
	;make some stairs - bit of an evolution of the static objects with the demo code with ODE
	
	cubex = 60;  the width of a cube
	cubey = 1.7;  the height of a cube
	cubez = 20;  the zed of a cube
	
	rotate_degrees = -5; rotate the cubes by {x} degrees
	
	SeedRnd (MilliSecs()) 
	
	For madsteps=1 To 25  ;note to generate a flat gameboard of 10 by 10 set this to 1 to 1
                          ;and pass 10,10 to the function	
		For cubeswide=1 To x
			
			For cubeszed=1 To y
				
			;SeedRnd (MilliSecs()) 
				cred= Rand(1,250) 
				cgreen = Rand(1,250) 
				cblue = Rand(1,250)  
				
				
			;add a cube
				ode.ODEGeom=New ODEGeom
				ode\geom=dCreateBox(Space,cubex,cubey,cubez)
				;dGeomSetPosition(ode\geom,(cubeswide*10)-15,(10*madsteps),(cubeszed*(10)+((x*10)*madsteps))-260)
				dGeomSetPosition(ode\geom,(cubeswide*cubex)-15,(cubey*madsteps),(cubeszed*(cubez)+((x*cubez)*madsteps))-260)
				dGeomSetRotation(ode\geom,rotate_degrees,0,0)
				ode\mesh=CreateCube()
				ScaleMesh ode\mesh,cubex/2,cubey/2,cubez/2
				EntityColor ode\mesh,cred,cgreen,cblue
				
			Next
			
		Next
		
	Next
	
End Function
</textarea> <br><br></td></tr></table><br>
<a name="998114"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#101">[#101]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Chroma: Sure, I've resent the email to the address in your Blitz profile (...@yahoo.com). If you don't receive it again, can you email me and I'll reply with the download link. If that fails, do you have another email address we can try? Please also let me know if you do receive it.<br><br>@Blitzplotter: Nice snippet. No need to remove the code, it's helpful and fun :) <br><br></td></tr></table><br>
<a name="1000416"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Oiduts Studios</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#102">[#102]</a></td></tr></table></td></tr><tr ><td class="posttext"> I am having a problem, I put a ramp in the spheres demo (without the car) and it is .b3d. But when the spheres roll down the ramp they only go for a certain distance and then they fall through. Is this because of the mesh, or is there a certain variable i need to put in the tell jv-ode how big the object is? <br><br></td></tr></table><br>
<a name="1000441"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#103">[#103]</a></td></tr></table></td></tr><tr ><td class="posttext"> You need to set the ODE geom size (ode\geom) as well as the visible Blitz3D entity size (ode\mesh), for example...<br><pre class=code>
ode\geom=dCreateBox(Space,3,1,4) ; ### 2x Blitz cube dimensions for ODE box
...
ScaleMesh ode\mesh,1.5,0.5,2
</pre>The dimensions for ODE boxes are 2x the size of the Blitz cubes.<br><br>ODE spheres are the same size as the Blitz sphere.<br><br>ODE cylinders have the same radius but need 2x the length of a Blitz cylinder. <br><br></td></tr></table><br>
<a name="1000580"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Oiduts Studios</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#104">[#104]</a></td></tr></table></td></tr><tr ><td class="posttext"> Opps i stated that incorrectly, i am using CreateTriMesh...<br><br>Global track1=LoadMesh("ramp.b3d")<br>Global track=CreateTriMesh(Space,track1)<br>RotateEntity track1,0,90,0<br>PositionEntity track1,-85,30,0<br>dGeomSetPosition(track,-85,30,0)<br>dGeomSetRotation(track,0,90,0) <br><br></td></tr></table><br>
<a name="1000666"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#105">[#105]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can scale a mesh before creating a TriMesh from it if needed, then to scale the visible geometry you would scale the entity...<br><pre class=code>
Global track1=LoadMesh("ramp.b3d")

ScaleMesh track1,1,1,1 ; ### Scale MESH before creating TriMesh from it

Global track=CreateTriMesh(Space,track1)

ScaleEntity track1,2,2,2 ; ### Scale ENTITY to resize visible geometry only

RotateEntity track1,0,90,0
PositionEntity track1,-85,30,0
dGeomSetPosition(track,-85,30,0)
dGeomSetRotation(track,0,90,0)
</pre> <br><br></td></tr></table><br>
<a name="1000725"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Oiduts Studios</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#106">[#106]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well I didnt think it mattered but i guess it does so... my B3D is just two rectangular prisms that are curved in a smooth downward slope and then a upward slope. So would this mean that i can not make this kind of mesh to work in jv-ODE, or is this corrupted?<br><br><img src="http://i1007.photobucket.com/albums/af195/bucketlamp/Blitz/ramp.jpg"><br>The red circle marks the place where the ball falls through at. <br><br></td></tr></table><br>
<a name="1000776"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Oiduts Studios</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#107">[#107]</a></td></tr></table></td></tr><tr ><td class="posttext"> Also how do you emit a sound from multiple falling objects when they hit the ground. As in rock hitting earth (clunk) <br><br></td></tr></table><br>
<a name="1000823"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#108">[#108]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's difficult to say without access to the mesh or code, it doesn't look right, the left sphere is sinking into the ramp. You can email me the mesh for testing if you wish.<br><br>For the second question you need to detect a collision has occurred, see the collision example (CarDemo-CCount), then play the sound and emit it from the associated entity (ode\mesh). <br><br></td></tr></table><br>
<a name="1000829"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Oiduts Studios</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#109">[#109]</a></td></tr></table></td></tr><tr ><td class="posttext"> That would be great and also i think i know of something that could be affecting it... i am using pacemaker to convert 3ds to b3d, could this be why? <br><br></td></tr></table><br>
<a name="1000836"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#110">[#110]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, it's possible the vertice and indice ordering of the mesh has been exported incorrectly. It will still display normally in Blitz3D, but the TriMesh will be corrupted. <br><br></td></tr></table><br>
<a name="1000843"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Oiduts Studios</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#111">[#111]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well then thats helpful, but what can i use to export my 3ds files? I use anim8or <br><br></td></tr></table><br>
<a name="1000885"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#112">[#112]</a></td></tr></table></td></tr><tr ><td class="posttext"> Don't assume the mesh is at fault, like I said it's a possibility but without seeing the mesh/code it's difficult to determine the exact cause.<br><br>It should be possible to load the 3DS meshes and use those to create a TriMesh from instead of the B3D meshes. <br><br></td></tr></table><br>
<a name="1000890"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Oiduts Studios</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#113">[#113]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wow, i thought that i read somewhere that B3ds were the only mesh types you could use in jv-ode. Well i put in the 3ds version and it did the same thing. I think i will email you the mesh.<br><br>Edit: I'm sorry but i am having trouble emailing you... Your email in your sig will not go through aol, i tried taking out the [no spam] thing but it didn't work... :D Can i have a new email please?<br><br>Edit #2:I have tried different techniques and still, half of the mesh seems to work find and the other doesn't... i need to make a working "roller coaster" by Monday. Here is the code, it is basically the sphere demo but just tweaked a little. *note that i also had FastExt processes in the code too but took them out to make it cleaner.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">Include "JV-ODE.bb"

AppTitle "ROLLER COASTER!!!"

Graphics3D 1280,1024,32,2


Global Toggle=0

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type


HidePointer()


dInitODE()

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,-0.98,0)
dContactSetMode(dContactBounce)
dContactSetBounce(0.2)
dContactSetMu(48)



Global track1=LoadMesh("media\coaster.3ds")

ScaleMesh track1,.5,.5,.5; ### Scale MESH before creating TriMesh from it

Global track=CreateTriMesh(Space,track1)

ScaleEntity track1,1,1,1 ; ### Scale ENTITY to resize visible geometry only

RotateEntity track1,0,0,0
PositionEntity track1,-85,40,0
dGeomSetPosition(track,-85,40,0)
dGeomSetRotation(track,0,0,0)

; ### Create Camera

Global Camera=CreateCamera()
CameraClsColor Camera,0,0,0
CameraRange Camera,1,2000
PositionEntity Camera,0,20,-50
RotateEntity Camera,30,0,0

; ### Create Plane

dCreatePlane(Space,0,1,0,0)

Global Plane=CreatePlane()

; ###################################################################################################
MoveMouse GraphicsWidth()/2, GraphicsHeight()/2

While Not KeyHit(1)
	
	
	
	
	If KeyHit(57) AddObject()
				
				UpdateGeoms()
				MouseLook Camera
				
				
				dSpaceCollide(Space,World,ContactGroup)
				dWorldQuickStep(World,0.1)
				dJointGroupEmpty(ContactGroup)
				
				RenderWorld
				
				curTime = MilliSecs()
				If curTime &gt; checkTime Then
					checkTime = curTime + 1000
					curFPS = fpscounter
					fpscounter = 0
				Else
					fpscounter = fpscounter + 1
				End If
				
				Text 20,40,curFPS
				
				If KeyHit(22)
					flipnum=Not flipnum
				EndIf
				
				Flip flipnum
				
			Wend
			
			dJointGroupDestroy(ContactGroup)
			dSpaceDestroy(Space)
			dWorldDestroy(World)
			dCloseODE()
			
			End
			
; ###################################################################################################
			
Function MouseLook(cam)
	Local t=MilliSecs()
	Local dt = t - DeltaTimeOld
	DeltaTimeOld = t
	Local dk# = Float(dt)/16.666
	DeltaTimeK = dk
	s#=0.2*dk
	dx#=(GraphicsWidth()/2-MouseX())*0.2
	dy#=(GraphicsHeight()/2-MouseY())*0.2
	TurnEntity cam,-dy,dx,0
	RotateEntity cam,EntityPitch(cam,1),EntityYaw(cam,1),0,1
	If KeyDown(42) 
		move=3
	Else
		move=1
	EndIf
	If KeyDown(17) MoveEntity cam,0,0,move
		If KeyDown(31) MoveEntity cam,0,0,-move
			If KeyDown(32) MoveEntity cam,1,0,0 
				If KeyDown(30) MoveEntity cam,-1,0,0
					y# = EntityY(cam,1)
					PositionEntity cam, EntityX(cam,1),y,EntityZ(cam,1)
					MoveMouse GraphicsWidth()/2, GraphicsHeight()/2
End Function

Function AddObject()
	
	xp#=EntityX(Camera)
	zp#=EntityZ(Camera)
	
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	dBodySetPosition(ode\body,xp,180,zp)
	dBodySetRotation(ode\body,0,0,0)
	dBodySetAutoDisableFlag(ode\body,1)
	ode\geom=dCreateSphere(Space,3)
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateSphere()
	ScaleMesh ode\mesh,3,3,3
	EntityColor ode\mesh,Rand(0,255),Rand(0,255),Rand(0,255)
	EntityShininess ode\mesh,0.7
	
	objnum=objnum+1
	
End Function


; ###################################################################################################

Function UpdateGeoms()
	
	For ode.ODEGeom=Each ODEGeom
			PositionEntity ode\mesh,dGeomGetPositionX(ode\geom),dGeomGetPositionY(ode\geom),dGeomGetPositionZ(ode\geom)
			RotateEntity ode\mesh,dGeomGetPitch(ode\geom),dGeomGetYaw(ode\geom),dGeomGetRoll(ode\geom)
		EndIf
	Next
	
End Function


End Function</textarea> <br><br></td></tr></table><br>
<a name="1000922"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#114">[#114]</a></td></tr></table></td></tr><tr ><td class="posttext"> Send the mesh to the email address in my profile, but change <i>[no-spam]</i> to <i>@</i><br><br>When I've received the mesh I'll take a look for you. <br><br></td></tr></table><br>
<a name="1000923"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Oiduts Studios</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#115">[#115]</a></td></tr></table></td></tr><tr ><td class="posttext"> lol, that was the only thing i had left to try... <br><br></td></tr></table><br>
<a name="1000924"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#116">[#116]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well it looks like the meshes are the problem, I've got no idea why though, maybe an export setting incorrect? or the mesh construction is incomplete/bad? It's almost like the mesh is inside-out.<br><br>I don't know what to suggest, other than try a different mesh editor or experiment with the mesh and export settings. <br><br></td></tr></table><br>
<a name="1000977"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Oiduts Studios</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#117">[#117]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have no other editor sadly so could someone please do me a big favor and export this C4D from turbosquid to 3ds or b3d format and send it to the email in my sig. I would be a very happy person!<br><a href="http://www.turbosquid.com/FullPreview/Index.cfm/ID/345239" target="_blank">http://www.turbosquid.com/FullPreview/Index.cfm/ID/345239</a> <br><br></td></tr></table><br>
<a name="1000987"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#118">[#118]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Blitzmonkey, i tried man but UU3D does not open C4d files.  You might wanna look here:-<br><br><a href="http://www.blitzbasic.com/Community/posts.php?topic=71084" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=71084</a><br><br>I do not have C4d therefore cannot export it as a .obj file which uu3d can use.<br><br><br>VIP3R, been having some fun with textures and stuff, came to the realisation that if you use a texture &amp; then modify it after applying it to a cube(or anything for that matter) it is dynamically updated no matter where you have applied it before.  I've supplied the code below that demonstrates how to apply text to them:-<br><br><img src="http://www.wishingwellsoftware.co.uk/cubes92.jpg"><br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #                                        JV-ODE Car Demo                                          #
; #                                  Code by Jim Williams (VIP3R)                                   #
; #                Make_game_board / Steps function by Mark Gormley (Blitzplotter)                  #
; #                              Devious Codeworks - Copyright © 2008                               #
; ###################################################################################################

;v2 adding the numbers



Include "JV-ODE.bb"

AppTitle "Watch out you are on the steps....."

Graphics3D 800,600,0,2

Global CMass#=200.0				; ### Car Mass
Global WMass#=14.0				; ### Wheel Mass

Global WorldERP#=1.0			; ### World Error Correction
Global WorldFriction#=70.0		; ### World Friction

Global Torque#=24.0				; ### Joint Torque
Global SuspensionHS#=0.01		; ### Suspension Hardness/Softness (Higher=Softer - Lower=Harder)

Global Force#=0.0
Global Steer#=0.0

Global Car
Global CGeom
Global CMesh

Global CarStartX=25
Global CarStartY=155
Global CarStartZ=-200

Dim Wheel(4)
Dim WGeom(4)
Dim Joint(4)

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

;just some local blah......

;your_path$=("H:\TORTOISE\top_level_tort_check_ootski\B3D_Projects\snakes and ladders\")

;file_path$=("imagery.bmp")

;Global cube_image=LoadMesh(file_path$)

Global countcubes

Dim colorthis(1000)  ; needed to store the memory location of each ODE cube when it is created



;ground_txt=mgloadtext("ground.bmp","bmp")

; ###################################################################################################

; ### Setup ODE

dInitODE()

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,-0.98,0)
dWorldSetERP(World,WorldERP)

dContactSetMode(dContactSlip1)
dContactSetMu(WorldFriction)

; ### add a terrain height map
;;TERRAIN
;Global terrain = LoadTerrain("height4.jpg")
;TerrainDetail terrain,2500,True
;ScaleEntity terrain, 3,15,3
;PositionEntity terrain,-1000,0,-530
;;ter_tex = LoadTexture("mossyground.bmp")
;;ter_tex = LoadTexture("ground_bmp_64.bmp")
;EntityTexture terrain,ter_tex
;EntityRadius terrain,0.2
;EntityType terrain,SCENERY

dContactSetMode(dContactBounce)
dContactSetBounce(0.1)
dContactSetMu(48)

dContactSetMode(dContactSlip1)
dContactSetMu(WorldFriction)

; ### end of add a terrain height map

; ### Create Car Body

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
Car=ode\body
dBodySetPosition(ode\body,CarStartX,CarStartY,CarStartZ)
dBodySetRotation(ode\body,0,0,0)
mass=dMassCreate()
dMassSetBoxTotal(mass,CMass,3,1,4)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
ode\geom=dCreateBox(Space,3,1,4)
CGeom=ode\geom
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
CMesh=ode\mesh
ScaleMesh ode\mesh,1.5,0.5,2
EntityColor ode\mesh,40,80,255

; ### Create Wheels

For count=1 To 4
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	Wheel(count)=ode\body
	dBodySetPosition(ode\body,0,0,0)
	dBodySetRotation(ode\body,0,0,90)
	mass=dMassCreate()
	dMassSetSphereTotal(mass,WMass,0.7)
	dBodySetMass(ode\body,mass)
	dMassDestroy(mass)
	ode\geom=dCreateSphere(Space,0.7)
	WGeom(count)=ode\geom
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder()
	ScaleMesh ode\mesh,0.7,0.25,0.7
	EntityColor ode\mesh,255,255,255
Next

dBodySetPosition(Wheel(1),CarStartX-2,CarStartY-0.5,CarStartZ+2)
dBodySetPosition(Wheel(2),CarStartX+2,CarStartY-0.5,CarStartZ+2)
dBodySetPosition(Wheel(3),CarStartX-2,CarStartY-0.5,CarStartZ-2)
dBodySetPosition(Wheel(4),CarStartX+2,CarStartY-0.5,CarStartZ-2)


RotateEntity Car,0,180,0

; ### Create Objects

SeedRnd MilliSecs()

;For spheres=1 To 10
;	ode.ODEGeom=New ODEGeom
;	ode\body=dBodyCreate(World)
;	dBodySetPosition(ode\body,Rand(10,40),130,Rand(30,160))
;	dBodySetRotation(ode\body,0,0,0)
;	ode\geom=dCreateSphere(Space,4)
;	dGeomSetBody(ode\geom,ode\body)
;	ode\mesh=CreateSphere()
;	ScaleMesh ode\mesh,4,4,4
;	EntityColor ode\mesh,Rand(0,255),Rand(0,255),Rand(0,255)
;	EntityShininess ode\mesh,0.7
;Next
;
;For capsules=1 To 10
;	ode.ODEGeom=New ODEGeom
;	ode\body=dBodyCreate(World)
;	dBodySetPosition(ode\body,Rand(10,40),130,Rand(30,160))
;	dBodySetRotation(ode\body,90,0,0)
;	ode\geom=dCreateCapsule(Space,1,8)
;	dGeomSetBody(ode\geom,ode\body)
;	ode\mesh=CreateCylinder()
;	ScaleMesh ode\mesh,1,5,1
;	RotateMesh ode\mesh,90,0,0	; ### Align Blitz3D Cylinder To ODE Capsule
;	EntityColor ode\mesh,Rand(0,255),Rand(0,255),Rand(0,255)
;	EntityShininess ode\mesh,0.7
;Next

; ### function call for game board, or stairs

make_game_board(10,10)  ;this will make steps 10 by 10 at the mo......
; NOTE:  you need to reduce the size of the cubes within the function before
;        increasing the arguments to the function to prevent stack overflows.


; ### Create Light

Global Light=CreateLight()
RotateEntity Light,50,-50,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create Camera

Global CameraPivot=CreatePivot()

Global Camera=CreateCamera(CameraPivot)
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000

; ### Create Plane

dCreatePlane(Space,0,1,0,0)

Global Plane=CreatePlane()
EntityAlpha Plane,0.8

EntityTexture Plane,PlaneTexture()

CreateMirror()

; ###################################################################################################

; ### Blitz3D Static Object (White)

Global Blitz3DObject=CreateCube()
ScaleMesh Blitz3DObject,1,4,20
PositionEntity Blitz3DObject,10,5,40
RotateEntity Blitz3DObject,-10,8,4
EntityColor Blitz3DObject,255,255,255

; ### ODE Static Object (Blue)

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,2,8,40)
dGeomSetPosition(ode\geom,20,5,40)
dGeomSetRotation(ode\geom,-10,8,4)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,1,4,20
EntityColor ode\mesh,0,100,200

; ### ODE Static Object (Red)

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,18,0.2,40)
dGeomSetPosition(ode\geom,30,4.9,-230)
dGeomSetRotation(ode\geom,-14,0,0)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,9,0.1,20
EntityColor ode\mesh,200,0,100

; ###################################################################################################

;EntityTexture colorthis,ground_txt   ; Hazar, this does appear to work  - so bonza I can apply 
                                     ;  textures of 1 to 100 to the cubes now.  Cool
; Create texture of size 256x256 
tex=CreateTexture(256,256) 

; Set buffer - texture buffer 
SetBuffer TextureBuffer(tex) 

; Clear texture buffer with background white color 
ClsColor 255,255,255 
Cls 


font=LoadFont("arial",96,1,0,0) 
SetFont font 
Color 0,0,0 


; Hmm, suspecting that for all the texture is being updated
; all the time within the loop there is something wacky happening

; Nothing wacky - just where the texture has been applied previously 
; is dynamically updated...


; due to the fact I am colouring the 91st cube with 91 OUTSIDE
; of the loop - but cubes 1 to 75 are getting plastered with 91 also?

For countmore=1 To 75

	; Draw text on texture 
	; Set buffer - texture buffer 
	SetBuffer TextureBuffer(tex) 
	
	;clear the buffer
	; Clear texture buffer with background white color 
	ClsColor 255,255,255 
	Cls 
	
	;Text 0,80,"  "+colorahundred : Color 255,125,255
	Text 0,80,"  "+(countmore) : Color 255,125,255

	EntityTexture colorthis(countmore),tex
	
	; Texture cube(s) with texture 
	SetBuffer BackBuffer()

Next

;#####################################################################################
;attempt at setting the outside of the 91st cube to 91:-
;the reason for this I presume is that if you apply a modify a texture when it has been
;applied elsewhere, every where else it was applied is dynamically updated.

;need at least an extra texture, or three or four......
tex92=CreateTexture(256,256) 

	; Draw text on texture 
	; Set buffer - texture buffer 
SetBuffer TextureBuffer(tex92) 

	;clear the buffer
	;Clear texture buffer with background white color 
ClsColor 255,255,255 
Cls 

;add the number 91 to the 91st cube:
Text 0,80,"  "+(91) : Color 255,125,255
	;Flip

If countmore = 99
	Text 0,80,"  "+99 : Color 255,125,255
EndIf


EntityTexture colorthis(91),tex92

; Texture cube(s) with texture 
SetBuffer BackBuffer()

;reset the font

font=LoadFont("arial",12) 
SetFont font 
Color 255,255,255

;  End texturing of cubes
;##################################################################################################

SetupCar()

While Not KeyHit(1)
	
	UpdateKeys()
	
	UpdateCar()
	
	UpdateGeoms()
	
	PTime=MilliSecs()
	
	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)
	
	PhysicsTime#=MilliSecs()-PTime
	
	UpdateCam()
	
	RenderWorld
	
	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime
	Text 0,50,"Force:"+Force
	Text 0,65,"Torque:"+Torque
	Text 640,0,"A - Accelerate"
	Text 640,15,"Z - Brake/Reverse"
	Text 640,30,"Arrows - Steering"
	Text 640,45,"Space - Reset Car"
	
	Flip 1
	
Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function SetupCar()
	
	For count=1 To 4
		Joint(count)=dJointCreateHinge2(World,0)
		dJointAttach(Joint(count),Car,Wheel(count))
		dJointSetHinge2Anchor(Joint(count),dBodyGetPositionX(Wheel(count)),dBodyGetPositionY(Wheel(count)),dBodyGetPositionZ(Wheel(count)))
		dJointSetHinge2Axis1(Joint(count),0,1,0)
		dJointSetHinge2Axis2(Joint(count),-1,0,0)
		dJointSetHinge2Param(Joint(count),dParamSuspensionERP,0.8)
		dJointSetHinge2Param(Joint(count),dParamSuspensionCFM,SuspensionHS)
		If count&gt;2
			dJointSetHinge2Param(Joint(count),dParamLoStop,0)
			dJointSetHinge2Param(Joint(count),dParamHiStop,0)
		End If
	Next
	
End Function

; ###################################################################################################

Function UpdateKeys()
	
	If KeyDown(30)=1
		Force=Force+0.08
		If Force&gt;30 Then Force=30
	End If
	
	If KeyDown(44)=1
		Force=Force-0.1
		If Force&lt;-10 Then Force=-10
		If Force&gt;0 Then Force=Force*0.97
	End If
	
	If KeyDown(30)=0 And KeyDown(44)=0 Then Force=Force*0.99
	
	If KeyDown(203)=1 Or KeyDown(205)=1
		If KeyDown(203)=1
			Steer=0.5
		Else
			Steer=-0.5
		End If
	Else
		Steer=0.0
	End If
	
	If KeyHit(57)=1
		Force=0.0
		dBodySetRotation(Car,dGeomGetPitch(CGeom),dGeomGetYaw(CGeom),0)
	End If
	
End Function

; ###################################################################################################

Function UpdateCar()
	
	For count=1 To 4
		dBodyEnable(Wheel(count))
	Next
	
	dBodyEnable(Car)
	
	For count=1 To 4
		dJointSetHinge2Param(Joint(count),dParamVel2,Force)
		dJointSetHinge2Param(Joint(count),dParamFMax2,Torque)
	Next
	
	For count=1 To 2
		angle#=Steer-dJointGetHinge2Angle1(Joint(count))
		dJointSetHinge2Param(Joint(count),dParamVel,angle)
		dJointSetHinge2Param(Joint(count),dParamFMax,400)
	Next
	
End Function

; ###################################################################################################

Function UpdateCam()
	
	PositionEntity Camera,0,30,-50
	
	PivotX#=Cos(EntityYaw(CMesh)-90)+EntityX(CMesh)
	PivotY#=EntityY(CMesh)
	PivotZ#=Sin(EntityYaw(CMesh)-90)+EntityZ(CMesh)
	
	PositionEntity CameraPivot,PivotX,PivotY,PivotZ
	
	PointEntity CameraPivot,CMesh
	
End Function

; ###################################################################################################

Function UpdateGeoms()
	
	For ode.ODEGeom=Each ODEGeom
		PositionEntity ode\mesh,dGeomGetPositionX(ode\geom),dGeomGetPositionY(ode\geom),dGeomGetPositionZ(ode\geom)
		RotateEntity ode\mesh,dGeomGetPitch(ode\geom),dGeomGetYaw(ode\geom),dGeomGetRoll(ode\geom)
	Next
	
End Function

; ###################################################################################################

Function make_game_board(x,y)
	
	;make some stairs - bit of an evolution of the static objects with the demo code with ODE
	;cubex = 60;  the width of a cube
	;cubey = 1.7;  the height of a cube
	;cubez = 20;  the zed of a cube
	
	cubex = 10; cubes 10  by 10
	cubey = 10
	cubez = 10
	
	rotate_degrees = 0; rotate the cubes by {x} degrees
	
	SeedRnd (MilliSecs()) 
	
	For madsteps=1 To 10  ;note to generate a flat gameboard of 10 by 10 set this to 1 to 1
                          ;and pass 10,10 to the function	
		For cubeswide=1 To x
			
			;For cubeszed=1 To y
			For cubeszed=1 To 1
				
			;SeedRnd (MilliSecs()) 
				cred= Rand(1,250) 
				cgreen = Rand(1,250) 
				cblue = Rand(1,250) 
				
			;apply a snakes and ladders image to that cube
			;Hmm, severe work to do here
				
				countcubes=countcubes+1
				
			;add a cube
				ode.ODEGeom=New ODEGeom
				ode\geom=dCreateBox(Space,cubex,cubey,cubez)
				;dGeomSetPosition(ode\geom,(cubeswide*10)-15,(10*madsteps),(cubeszed*(10)+((x*10)*madsteps))-260)
				dGeomSetPosition(ode\geom,(cubeswide*cubex)-15,(cubey*madsteps),((cubeszed*(cubez)+((x*cubez)*madsteps))/10)-260)
				;dGeomSetPosition(ode\geom,(cubeswide*cubex)-15,(cubey*madsteps),(cubeszed*(cubez)-260))
				dGeomSetRotation(ode\geom,rotate_degrees,0,0)
				ode\mesh=CreateCube()
				;EntityTexture ode\mesh,ground_txt
				ScaleMesh ode\mesh,cubex/2,cubey/2,cubez/2
				EntityColor ode\mesh,cred,cgreen,cblue
				
				;store the mem location of each cube
				colorthis(countcubes)=ode\mesh
				
			Next
			
		Next
		
	Next
	
End Function 

;############################################################################

Function mgloadtext(filename$, ident$)

; function can load file dependent on ident: bmp | b3d	

If ident$="bmp"
	filehandle = ReadFile (filename$)
	If filehandle &lt;&gt; 0
		this=LoadTexture(filename$)
	Else
		Print "cannot locate " + filename$
		Print "Press any key"
		WaitKey()
		End
	EndIf
Else If ident$="b3d"
	filehandle = ReadFile (filename$)
	If filehandle &lt;&gt; 0	
		this=LoadMesh(filename$)
	Else
		Print "cannot locate " + filename$
		Print "Press Any Key"
		WaitKey()	
		End
	EndIf
Else 
	Print "unrecognised file type press any key."
	WaitKey()			
EndIf
Print filename$ + "Loaded"

Return this

End Function





</textarea> <br><br></td></tr></table><br>
<a name="1000991"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Oiduts Studios</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#119">[#119]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks but before I do all that does anyone own c4d? <br><br></td></tr></table><br>
<a name="1001021"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#120">[#120]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Blitzplotter: Dynamically updated indeed :)<br><br>@Blitz Monkey: The <a href="/topics.php?forum=83" target="_blank">Content Creation Tools</a> forum would probably be the best place to find help on those mesh issues. <br><br></td></tr></table><br>
<a name="1001462"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >semar</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#121">[#121]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi all, I'm completely new about JV-ODE, and I'm using the Blitz3D demo version right now.<br><br>I have some questions:<br>1) I have an animated 3D character which should throw a grenade. At a particular frame of the models throw animation, the grenade - which is on the hand of the model - should get an impulse and travel through the 3D level. Of course, the walls and the ground of the 3D level should act as an obstacle for the grenade, which should bounce on the ground and eventually on all the walls of the level. How can I accomplish this task ?<br><br>2) Also, when a bomb explodes near a 3D animated character, he should behave as a ragdoll - or, at least, behave as a phisyc object - and be 'throwed' away by the explosion. How can I do it ?<br><br>3) Last but not least, are there some B3D + JV-ODE tutorials to read ?<br><br>Thanks in advance,<br>Sergio. <br><br></td></tr></table><br>
<a name="1001469"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#122">[#122]</a></td></tr></table></td></tr><tr ><td class="posttext"> The grenade can be simulated using an ODE object like a sphere for example, you would need to work out the correct throwing angle and then apply a force to the object to throw it. The ground and walls would also need to be represented in the form of collision geometry, the ground could use a plane geom if it were completely flat. Once the grenade is thrown, you don't need to do anything else, it will fly/roll/bounce around by itself until you remove it.<br><br>The ragdoll is quite tough for someone new to ODE. There are two stages involved, the JV-ODE ragdoll demo only shows the second stage which is where the character would switch to a ragdoll. The first stage would involve animating the character and updating the ODE position and rotation of every component of the body, this is to ensure the ODE ragdoll is in the same position as the animated model at the point you switch from animated to physics controlled.<br><br>There's an old tutorial made by Shifty Geezer available <a href="http://www.devcode.co.uk/misc/ODE-Tutorial.pdf" target="_blank">here</a>, to run the example the code will need to be modified. For instance the example uses the old include file name 'ode.bb' in places, it needs to be 'JV-ODE.bb'.<br><br>I would strongly recommend reading the older JV-ODE threads to get an idea on how to implement the above and have some fun experimenting with the ragdoll demo. All of the above can be simulated using the demo version of JV-ODE, so no need to buy it until you've got to grips with it. <br><br></td></tr></table><br>
<a name="1001485"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Vorderman</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#123">[#123]</a></td></tr></table></td></tr><tr ><td class="posttext"> When I made a ragdoll program (using Tokamak but the principle is the same) I made sure my 3d human mesh had the right number of bones in it that would represent the ragdoll's physics objects, then I named each bone so it could be identified.<br><br>At runtime the mesh moves and animates as normal, once I needed to change it to a ragdoll I cycled through all the bones, transformed their position and rotation into world coords, then setup the physics objects at those positions and orientations, then create and orient the joints between the objects. This saves having a whole load of physics objects being hauled around when they're not needed.<br><br>I think I used extra markers in the 3d mesh to represent the joints, so I could correctly orient them to the world.<br><br>Once in ragdoll mode the process would occur in reverse every frame so the 3d mesh's bones would be positioned and oriented to their relevant physics objects so they would tumble around.<br><br>Once the ragdoll objects had come to rest (or exceeded a life timer I had set for each ragdoll) they were all deleted leaving the 3d mesh behind in its crumpled state. <br><br></td></tr></table><br>
<a name="1001598"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mike0101</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#124">[#124]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm using newton engine but I'm fucking envious for the support of VIP3R.<br>This is one of the best support in Blitz community. Sadly I'm lazy to rewrite my project for JV-ODE. I see right now this is the best physics solution for blitz3d. <br><br></td></tr></table><br>
<a name="1001642"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#125">[#125]</a></td></tr></table></td></tr><tr ><td class="posttext"> @VIP3R, I've added a little functionality to your Duo code &amp; incorporated a bit of a two player game - admittedly it is quite hard, but hey nothing ever worth doing is easy. Think I managed to get to the fifth row of cubes, in the fifties before I fell of!<br><br>Covers some concepts like texturing different cubes with different numbers....  Please note you need JV-ODE to compile this - I think it'll work with the demo version.<br><br>Code is below the image<br><br><img src="http://www.wishingwellsoftware.co.uk/greensmall.jpg"><br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #                                        JV-ODE Duo Demo, slightly mod'd                          # 
; #                Make_game_board with ramps function by Mark Gormley (Blitzplotter)               #
; #                            Original Code by Jim Williams (VIP3R)                                #
; #                              Devious Codeworks - Copyright © 2009                               #
; ###################################################################################################

;v5 prototype gameplay in place, next implement a velocity indication.
;   A speed indication would help you to suss if a tail slide is coming...

;v4 separating the 10 rows with a gap that'll need bridges to drive up....
;   and add a second car.  Change control and cameras between 1st and second car
;   every 10 seconds, give or take 

;v3 adding the numbers with Malice's new code

Include "JV-ODE.bb"

AppTitle "Race to cube 100, it is a long way back to cube 1."

Graphics3D 800,600,0,2

Global CMass#=200.0				; ### Car Mass
Global WMass#=14.0				; ### Wheel Mass

Global WorldERP#=1.0			; ### World Error Correction
Global WorldFriction#=70.0		; ### World Friction

Global Torque#=24.0				; ### Joint Torque
Global SuspensionHS#=0.01		; ### Suspension Hardness/Softness (Higher=Softer - Lower=Harder)



Global lookat=1

Dim Force#(2)
Dim Steer#(2)

Dim Car(2)
Dim CGeom(2)
Dim CMesh(2)


Global LOWFUEL = 400
Global MAXCONTROLTIME=1500

Global ControlTimer=800
Global SteeringTimer=0

Global CarStartX=125
Global CarStartY=155
Global CarStartZ=300


Dim Wheel(2,4)
Dim WGeom(2,4)
Dim Joint(2,4)

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type



Global countcubes

Dim colorthis(1000)  ; needed to store the memory location of each ODE cube when it is created


; ###################################################################################################

; ### Setup ODE

dInitODE()

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,-0.98,0)
dWorldSetERP(World,WorldERP)

dContactSetMode(dContactSlip1)
dContactSetMu(WorldFriction)



dContactSetMode(dContactBounce)
dContactSetBounce(0.1)
dContactSetMu(48)

dContactSetMode(dContactSlip1)
dContactSetMu(WorldFriction)



;################################################################################
;create 2 cars

For carID=1 To 2
	; ### Create Car Body
	
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	Car(carID)=ode\body
	;dBodySetPosition(ode\body,-10+(carID*10),CarStartY,0)
	dBodySetPosition(ode\body,CarStartX-10+(carID*10),CarStartY,CarStartZ)
	dBodySetRotation(ode\body,0,0,0)
	mass=dMassCreate()
	dMassSetBoxTotal(mass,CMass,3,1,4)
	dBodySetMass(ode\body,mass)
	dMassDestroy(mass)
	ode\geom=dCreateBox(Space,3,1,4)
	CGeom(carID)=ode\geom
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCube()
	CMesh(carID)=ode\mesh
	ScaleMesh ode\mesh,1.5,0.5,2
	If carID=1
		EntityColor ode\mesh,40,80,255
	Else
		EntityColor ode\mesh,40,255,80
	End If
	
	; ### Create Wheels
	
	For count=1 To 4
		ode.ODEGeom=New ODEGeom
		ode\body=dBodyCreate(World)
		Wheel(carID,count)=ode\body
		dBodySetPosition(ode\body,0,0,0)
		dBodySetRotation(ode\body,0,0,90)
		mass=dMassCreate()
		dMassSetSphereTotal(mass,WMass,0.7)
		dBodySetMass(ode\body,mass)
		dMassDestroy(mass)
		ode\geom=dCreateSphere(Space,0.7)
		WGeom(carID,count)=ode\geom
		dGeomSetBody(ode\geom,ode\body)
		ode\mesh=CreateCylinder()
		ScaleMesh ode\mesh,0.7,0.25,0.7
		EntityColor ode\mesh,255,255,255
	Next
	
	
	dBodySetPosition(Wheel(carID,1),CarStartX-12+(carID*10),CarStartY-0.5,CarStartZ+2)
	dBodySetPosition(Wheel(carID,2),CarStartX-8+(carID*10),CarStartY-0.5,CarStartZ+2)
	dBodySetPosition(Wheel(carID,3),CarStartX-12+(carID*10),CarStartY-0.5,CarStartZ-2)
	dBodySetPosition(Wheel(carID,4),CarStartX-8+(carID*10),CarStartY-0.5,CarStartZ-2)
	
	;RotateEntity Car(CarID),0,180,0
	
	
	
Next

;end create 2 cars
;###############################################################################





; ### Create Objects

SeedRnd MilliSecs()

For spheres=1 To 10
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	dBodySetPosition(ode\body,Rand(10,1000),500,Rand(30,1000))
	dBodySetRotation(ode\body,0,0,0)
	ode\geom=dCreateSphere(Space,4)
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateSphere()
	ScaleMesh ode\mesh,4,4,4
	EntityColor ode\mesh,Rand(0,255),255,Rand(0,200)
	EntityShininess ode\mesh,0.7
Next

For capsules=1 To 10
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	dBodySetPosition(ode\body,Rand(10,1000),130,Rand(30,1000))
	dBodySetRotation(ode\body,90,0,0)
	ode\geom=dCreateCapsule(Space,1,8)
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder()
	ScaleMesh ode\mesh,1,5,1
	RotateMesh ode\mesh,90,0,0	; ### Align Blitz3D Cylinder To ODE Capsule
	EntityColor ode\mesh,Rand(0,255),Rand(0,255),Rand(0,255)
	EntityShininess ode\mesh,0.7
Next

; ### function call for game board, or stairs

make_game_board(10,10)  ;this will make steps 10 by 10 at the mo......
; NOTE:  you need to reduce the size of the cubes within the function before
;        increasing the arguments to the function to prevent stack overflows.


; ### Create Light

Global Light=CreateLight()
RotateEntity Light,50,-50,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create Camera

Global CameraPivot=CreatePivot()

Global Camera=CreateCamera(CameraPivot)
CameraClsColor Camera,0,0,0
CameraRange Camera,1,3000

; ### Create Plane

dCreatePlane(Space,0,1,0,0)

Global Plane=CreatePlane()
EntityAlpha Plane,0.8

EntityTexture Plane,PlaneTexture()

CreateMirror()

; ###################################################################################################

; ### Blitz3D Static Object (White)

Global Blitz3DObject=CreateCube()
ScaleMesh Blitz3DObject,1,4,20
PositionEntity Blitz3DObject,10,5,40
RotateEntity Blitz3DObject,-10,8,4
EntityColor Blitz3DObject,255,255,255

; ### ODE Static Object (Blue)

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,2,8,40)
dGeomSetPosition(ode\geom,20,5,40)
dGeomSetRotation(ode\geom,-10,8,4)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,1,4,20
EntityColor ode\mesh,0,100,200

; ### ODE Static Object (Red)

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,18,0.2,40)
dGeomSetPosition(ode\geom,30,4.9,-230)
dGeomSetRotation(ode\geom,-14,0,0)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,9,0.1,20
EntityColor ode\mesh,200,0,100

; ### Static get on again:

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,80,0.2,480)
dGeomSetPosition(ode\geom,130,58,50)
dGeomSetRotation(ode\geom,-14,0,0)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,40,0.1,240
EntityColor ode\mesh,200,0,100




;####################################################################################################
; ;set up the 100 textures for use

; Create texture of size 256x256

Global FLAGS=1	;Malice				 			Added this because you need to specify the texture 
												;flags value Before how many frames. 1=colour And is the Default
tex=CreateTexture(256,256,FLAGS,100) ;Malice	This now gives the texture 100 frames

font=LoadFont("arial",96,1,0,0) 
SetFont font 
Color 0,0,0 

For countcubes=1 To 100
	
	;Malice										Moved the setbuffer and cls inside loop and removed duplicate for efficiency.
	; Draw text on texture 
	; Set buffer - texture buffer 
	;-Malice:									Added Second Parameter for frame reference (frames are counted from 0-99)
	SetBuffer TextureBuffer(tex,countcubes-1) 
	
	; Clear texture buffer with background white color 
	ClsColor 255,255,255 
	Cls 
	
	Text 0,80,"  "+countcubes : Color 255,125,255
	;Flip	-Malice								We don't need flip as we are only drawing to the texture buffer.
	
	;Malice										Again, added a second parameter for texture frame
	EntityTexture colorthis(countcubes),tex,countcubes-1		
Next

;	Malice										Setbuffer back to backbuffer OUTSIDE of loop for efficiency.
SetBuffer BackBuffer()

;end set up 100 frames of 1 texture
;#############################################################################################################


;reset the font

font=LoadFont("arial",12) 
SetFont font 
Color 255,255,255




SetupCars()

While Not KeyHit(1)
	
	UpdateKeys()
	
	UpdateCars()
	
	UpdateGeoms()
	
	PTime=MilliSecs()
	
	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)
	
	PhysicsTime#=MilliSecs()-PTime
	
	UpdateCam()
	
	RenderWorld
	
	Text 640,0,"A - Accelerate"
	Text 640,15,"Z - Brake/Reverse"
	Text 640,30,"Arrows - Steering"
	Text 640,45,"Space - Reset Car"
	
	If lookat=0
		Text 640,60,"Player: "+1
	Else
		Text 640,60,"Player: "+2
	EndIf
	
	
	If ControlTimer &gt; LOWFUEL
		Text 640,90,"Fuel Left:"+ControlTimer
	Else
		Text 300,100," LOW TIME LEFT, Control Transferring Soon"
	End If
	
		
		
	Flip 1
	
Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End



Function UpdateCam()
	
	PositionEntity Camera,0,3,-12
	
	If lookat=1
		PivotX#=Cos(EntityYaw(CMesh(1))-90)+EntityX(CMesh(1))
		PivotY#=EntityY(CMesh(1))
		PivotZ#=Sin(EntityYaw(CMesh(1))-90)+EntityZ(CMesh(1))
	EndIf
	
	If lookat=0
	;logic to look at second car
	
		PivotX#=Cos(EntityYaw(CMesh(2))-90)+EntityX(CMesh(2))
		PivotY#=EntityY(CMesh(2))
		PivotZ#=Sin(EntityYaw(CMesh(2))-90)+EntityZ(CMesh(2))
	EndIf
	
	If lookat=3
	;use no Pivot setup	
		
	EndIf
	
	PositionEntity CameraPivot,PivotX,PivotY,PivotZ
	
	If lookat=1
		PointEntity CameraPivot,CMesh(1)
	EndIf
	
	If lookat=0
		PointEntity CameraPivot,CMesh(2)
	EndIf
	
	If lookat=3
		PointEntity CameraPivot,CMesh(1)
	EndIf
	
End Function

; #########################

; ###################################################################################################

Function UpdateGeoms()
	
	For ode.ODEGeom=Each ODEGeom
		PositionEntity ode\mesh,dGeomGetPositionX(ode\geom),dGeomGetPositionY(ode\geom),dGeomGetPositionZ(ode\geom)
		RotateEntity ode\mesh,dGeomGetPitch(ode\geom),dGeomGetYaw(ode\geom),dGeomGetRoll(ode\geom)
	Next
	
End Function

; ###################################################################################################

Function make_game_board(x,y)
	
	;make some stairs - bit of an evolution of the static objects with the demo code with ODE
	;cubex = 60;  the width of a cube
	;cubey = 1.7;  the height of a cube
	;cubez = 20;  the zed of a cube
	
	cubex = 210; cubes 10  by 10
	cubey = 70
	cubez = 70
	
	Z_ROW_GAP = 500
	
	rotate_degrees = 0; rotate the cubes by {x} degrees
	
	SeedRnd (MilliSecs()) 
	
	For madsteps=1 To 10  ;note to generate a flat gameboard of 10 by 10 set this to 1 to 1
                          ;and pass 10,10 to the function	
		For cubeswide=1 To x
			
			;For cubeszed=1 To y
			For cubeszed=1 To 1
				
			;SeedRnd (MilliSecs()) 
				cred= Rand(1,250) 
				cgreen = Rand(1,250) 
				cblue = Rand(1,250) 
				
				countcubes=countcubes+1
				
			;add a cube
				ode.ODEGeom=New ODEGeom
				ode\geom=dCreateBox(Space,cubex,cubey,cubez)
				dGeomSetPosition(ode\geom,(cubeswide*cubex)-15,(cubey*madsteps),(((cubeszed*(cubez)+((x*cubez)*madsteps))/10)-260)+(Z_ROW_GAP*madsteps))
				dGeomSetRotation(ode\geom,rotate_degrees,0,0)
				ode\mesh=CreateCube()
				ScaleMesh ode\mesh,cubex/2,cubey/2,cubez/2
				EntityColor ode\mesh,cred,cgreen,cblue
				
				;store the mem location of each cube
				colorthis(countcubes)=ode\mesh
				
			Next
			
		Next
		
		;Add the ramps between rows - not the most efficient but it works....
		
		If madsteps &gt; 2
			
			If  madsteps Mod 2 = 1
				ode.ODEGeom=New ODEGeom
				ode\geom=dCreateBox(Space,cubex,2,cubez*8)
				dGeomSetPosition(ode\geom,((2*cubex)-cubex),(cubey*madsteps)+(cubey-60),(((cubeszed*(cubez)+(((x*cubez)*madsteps))/10)-260)+(Z_ROW_GAP*madsteps))-(Z_ROW_GAP-70))
				dGeomSetRotation(ode\geom,-10,0,0)
				ode\mesh=CreateCube()
				ScaleMesh ode\mesh,cubex/2,1,(cubez*8)/2
			EndIf
			
		EndIf
				
		
		If Not madsteps Mod 2 = 1
			ode.ODEGeom=New ODEGeom
			ode\geom=dCreateBox(Space,cubex,2,cubez*8)
			dGeomSetPosition(ode\geom,((cubeswide*cubex)-cubex),(cubey*madsteps)+(cubey-60),(((cubeszed*(cubez)+(((x*cubez)*madsteps))/10)-260)+(Z_ROW_GAP*madsteps))-(Z_ROW_GAP-70))
			dGeomSetRotation(ode\geom,-10,0,0)
			ode\mesh=CreateCube()
			ScaleMesh ode\mesh,cubex/2,1,(cubez*8)/2
			
			
		EndIf 
		
		;end add ramps
		
		
	Next
	
End Function 

;############################################################################

Function mgloadtext(filename$, ident$)

; function can load file dependent on ident: bmp | b3d	

If ident$="bmp"
	filehandle = ReadFile (filename$)
	If filehandle &lt;&gt; 0
		this=LoadTexture(filename$)
	Else
		Print "cannot locate " + filename$
		Print "Press any key"
		WaitKey()
		End
	EndIf
Else If ident$="b3d"
	filehandle = ReadFile (filename$)
	If filehandle &lt;&gt; 0	
		this=LoadMesh(filename$)
	Else
		Print "cannot locate " + filename$
		Print "Press Any Key"
		WaitKey()	
		End
	EndIf
Else 
	Print "unrecognised file type press any key."
	WaitKey()			
EndIf
Print filename$ + "Loaded"

Return this

End Function




;#############################################################################
;2 Car functions:

Function SetupCars()
	
	For carID=1 To 2
		For count=1 To 4
			Joint(carID,count)=dJointCreateHinge2(World,0)
			dJointAttach(Joint(carID,count),Car(carID),Wheel(carID,count))
			dJointSetHinge2Anchor(Joint(carID,count),dBodyGetPositionX(Wheel(carID,count)),dBodyGetPositionY(Wheel(carID,count)),dBodyGetPositionZ(Wheel(carID,count)))
			dJointSetHinge2Axis1(Joint(carID,count),0,1,0)
			dJointSetHinge2Axis2(Joint(carID,count),-1,0,0)
			dJointSetHinge2Param(Joint(carID,count),dParamSuspensionERP,0.8)
			dJointSetHinge2Param(Joint(carID,count),dParamSuspensionCFM,SuspensionHS)
			If count&gt;2
				dJointSetHinge2Param(Joint(carID,count),dParamLoStop,0)
				dJointSetHinge2Param(Joint(carID,count),dParamHiStop,0)
			End If
		Next
	Next
	
End Function

; ###################################################################################################

Function UpdateKeys()
	
	
	If lookat=1
; ### Player Control - Car 1
		
		If KeyDown(30)=1
			Force(1)=Force(1)+0.08
			If Force(1)&gt;30 Then Force(1)=30
		End If
		
		If KeyDown(44)=1
			Force(1)=Force(1)-0.1
			If Force(1)&lt;-10 Then Force(1)=-10
			If Force(1)&gt;0 Then Force(1)=Force(1)*0.97
		End If
		
		If KeyDown(30)=0 And KeyDown(44)=0 Then Force(1)=Force(1)*0.99
		
		If KeyDown(203)=1 Or KeyDown(205)=1
			If KeyDown(203)=1
				Steer(1)=0.5
			Else
				Steer(1)=-0.5
			End If
		Else
			Steer(1)=0.0
		End If
		
		If KeyHit(57)=1
			Force(1)=0.0
			dBodySetRotation(Car(1),dGeomGetPitch(CGeom(1)),dGeomGetYaw(CGeom(1)),0)
		End If
		
	Else
		
		If KeyDown(30)=1
			Force(2)=Force(2)+0.08
			If Force(2)&gt;30 Then Force(2)=30
		End If
		
		If KeyDown(44)=1
			Force(2)=Force(2)-0.1
			If Force(2)&lt;-10 Then Force(2)=-10
			If Force(2)&gt;0 Then Force(2)=Force(2)*0.97
		End If
		
		If KeyDown(30)=0 And KeyDown(44)=0 Then Force(2)=Force(2)*0.99
		
		If KeyDown(203)=1 Or KeyDown(205)=1
			If KeyDown(203)=1
				Steer(2)=0.5
			Else
				Steer(2)=-0.5
			End If
		Else
			Steer(2)=0.0
		End If
		
		If KeyHit(57)=1
			Force(2)=0.0
			dBodySetRotation(Car(2),dGeomGetPitch(CGeom(2)),dGeomGetYaw(CGeom(2)),0)
		End If
		
	EndIf
	
	
	
	ControlTimer=ControlTimer-1
	
	If ControlTimer&lt;=1
		ControlTimer=MAXCONTROLTIME
		If lookat=1
			lookat=0
		Else
			lookat=1
		EndIf
		
	EndIf
	
	
;; ### Simple AI - Car 2
;
;If ControlTimer&gt;100
;	SeedRnd MilliSecs()
;	AIKey=Rand(0,100)
;
;	If AIKey&lt;40
;		Force(2)=Force(2)+0.8
;		If Force(2)&gt;10 Then Force(2)=10
;		End If
;
;	If AIKey=&gt;40 Then Force(2)=Force(2)*0.99
;
;	ControlTimer=0
;	End If
;
;If SteeringTimer&gt;100
;	SeedRnd MilliSecs()
;	AIKey=Rand(0,100)
;
;	Steer(2)=0.0
;	If AIKey&lt;30 Then Steer(2)=0.5
;	If AIKey&gt;70 Then Steer(2)=-0.5
;
;	SteeringTimer=0
;	End If
;
;ControlTimer=ControlTimer+1
;SteeringTimer=SteeringTimer+1
	
End Function

; ###########################################################################



Function UpdateCars()
	
	For carID=1 To 2
		For count=1 To 4
			dBodyEnable(Wheel(carID,count))
		Next
		
		dBodyEnable(Car(carID))
		
		For count=1 To 4
			dJointSetHinge2Param(Joint(carID,count),dParamVel2,Force(carID))
			dJointSetHinge2Param(Joint(carID,count),dParamFMax2,Torque)
		Next
		
		For count=1 To 2
			angle#=Steer(carID)-dJointGetHinge2Angle1(Joint(carID,count))
			dJointSetHinge2Param(Joint(carID,count),dParamVel,angle)
			dJointSetHinge2Param(Joint(carID,count),dParamFMax,400)
		Next
	Next
	
End Function





</textarea> <br><br></td></tr></table><br>
<a name="1001671"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#126">[#126]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Mike0101: Thank you, might be best to censor the f-bomb though ;)<br><br>@BP: How about braking the car automatically before the transfer? I found it continues moving once the switch occurs leading to the car driving off the ledge, maybe I was driving it too fast :) <br><br></td></tr></table><br>
<a name="1001681"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#127">[#127]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Mike0101, yeah I agree with VIP3R on the f-bomb note, there are some young posters here no need mate (;-)  But your point on VIP3R's support is bang on with regards to the level of support he provides.<br><br>@VIP3R, good point, I was considering making this one of the more 'difficult' levels within the game -  was considering adding 'bumpers' to the edges of the rows to compensate for the (only textual warning at the moment) that control is switching soon.  <br><br>Auto retardation would be good, just one thing though if someone is flying and you attempt to apply the brakes  manually, you can get a right tail slide on - which if you are still in control you may be lucky enough not to drop of the edge - but the limited AI control that I'd implement could not compensate for a tail slide on reverse thrust/brake application.  So I might opt for bumpers first. Gonna implement joypad support next - its easier to pass a controller backwards and forwards than swapping seats at the keyboard. I like the idea of implementin my array of cars, so each player has a choice of 1 to 5 cars to race to the top with.<br><br>Still the best Physics Lib and by FAR the best supported lib.  I know someone was along way towards a Stunt Car Racer remake a while back, kinda fancy a stab at it myself. A while off yet though! Seasons Greets Everyone - happy holidays! <br><br></td></tr></table><br>
<a name="1001688"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Charrua</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#128">[#128]</a></td></tr></table></td></tr><tr ><td class="posttext"> i don´t read all the thread, why you don't split the screen and keep 2 players on all the time?<br><br>Juan <br><br></td></tr></table><br>
<a name="1001711"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#129">[#129]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Charrua, that is an aspiration, if you know how to do it please feel free to modify my code provided above for all to benefit from, it may be a simple modification and if you know how to do it I would appreciate the benefit of your knowledge. I admit my current skills in B3D/JV-<br>ODE do not come up to:<br><br><a href="http://www.blitzbasic.com/Community/posts.php?topic=88220#1001649" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=88220#1001649</a><br><br>However, Charrua, if you can implement the serial comms you are referring to in the thread I have slapped here, I'm sure the JV-ODE users would be very appreciative(me included!), regards, BP.<br><br>However, I do have some concerns regarding your speed issues:<br><br><div class="quote"> but for testing i implement all 3 in the same computer.<br>not very fast, <br></div><br><br>I do confess that the code I have posted above does not run  super smooth on my system @ 1920 x 1200, and if you as you are suggesting, running three separate instances doing comms over and above the processing for one app, I fear most processors would understandably sweat. <br><br></td></tr></table><br>
<a name="1001716"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Charrua</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#130">[#130]</a></td></tr></table></td></tr><tr ><td class="posttext"> for the serial comms i use a lib posted by Niegel (i think) on this forums some time ago<br><br>serialio.bb <br><br>that other thread speaks about other thing: 2 windows at the same time.<br><br>to split the screen basically to split the screen you have to create 2 cameras and define the viewport of each to a half screen (horizontally or vertically) say:<br>x,y,with,height<br>0,0,512,768 for the first and 512,0,512,768 for the second (if you use<br>1024x768)<br>then one camera follow one car, the secon the second<br><br>of course you have to define a new set of keys to hadle the second car<br><br>let me try to do that, givme some time<br><br>juan <br><br></td></tr></table><br>
<a name="1001729"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Charrua</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#131">[#131]</a></td></tr></table></td></tr><tr ><td class="posttext"> just 2 cameras, the rest is up to you!<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #                                        JV-ODE Duo Demo, slightly mod'd                          # 
; #                Make_game_board with ramps function by Mark Gormley (Blitzplotter)               #
; #                            Original Code by Jim Williams (VIP3R)                                #
; #                              Devious Codeworks - Copyright © 2009                               #
; ###################################################################################################

;v5 prototype gameplay in place, next implement a velocity indication.
;   A speed indication would help you to suss if a tail slide is coming...

;v4 separating the 10 rows with a gap that'll need bridges to drive up....
;   and add a second car.  Change control and cameras between 1st and second car
;   every 10 seconds, give or take 

;v3 adding the numbers with Malice's new code

Include "JV-ODE.bb"

AppTitle "Race to cube 100, it is a long way back to cube 1."

Graphics3D 800,600,0,2

Global CMass#=200.0				; ### Car Mass
Global WMass#=14.0				; ### Wheel Mass

Global WorldERP#=1.0			; ### World Error Correction
Global WorldFriction#=70.0		; ### World Friction

Global Torque#=24.0				; ### Joint Torque
Global SuspensionHS#=0.01		; ### Suspension Hardness/Softness (Higher=Softer - Lower=Harder)



Global lookat=1

Dim Force#(2)
Dim Steer#(2)

Dim Car(2)
Dim CGeom(2)
Dim CMesh(2)


Global LOWFUEL = 400
Global MAXCONTROLTIME=1500

Global ControlTimer=800
Global SteeringTimer=0

Global CarStartX=125
Global CarStartY=155
Global CarStartZ=300


Dim Wheel(2,4)
Dim WGeom(2,4)
Dim Joint(2,4)

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type



Global countcubes

Dim colorthis(1000)  ; needed to store the memory location of each ODE cube when it is created


; ###################################################################################################

; ### Setup ODE

dInitODE()

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,-0.98,0)
dWorldSetERP(World,WorldERP)

dContactSetMode(dContactSlip1)
dContactSetMu(WorldFriction)



dContactSetMode(dContactBounce)
dContactSetBounce(0.1)
dContactSetMu(48)

dContactSetMode(dContactSlip1)
dContactSetMu(WorldFriction)



;################################################################################
;create 2 cars

For carID=1 To 2
	; ### Create Car Body
	
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	Car(carID)=ode\body
	;dBodySetPosition(ode\body,-10+(carID*10),CarStartY,0)
	dBodySetPosition(ode\body,CarStartX-10+(carID*10),CarStartY,CarStartZ)
	dBodySetRotation(ode\body,0,0,0)
	mass=dMassCreate()
	dMassSetBoxTotal(mass,CMass,3,1,4)
	dBodySetMass(ode\body,mass)
	dMassDestroy(mass)
	ode\geom=dCreateBox(Space,3,1,4)
	CGeom(carID)=ode\geom
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCube()
	CMesh(carID)=ode\mesh
	ScaleMesh ode\mesh,1.5,0.5,2
	If carID=1
		EntityColor ode\mesh,40,80,255
	Else
		EntityColor ode\mesh,40,255,80
	End If
	
	; ### Create Wheels
	
	For count=1 To 4
		ode.ODEGeom=New ODEGeom
		ode\body=dBodyCreate(World)
		Wheel(carID,count)=ode\body
		dBodySetPosition(ode\body,0,0,0)
		dBodySetRotation(ode\body,0,0,90)
		mass=dMassCreate()
		dMassSetSphereTotal(mass,WMass,0.7)
		dBodySetMass(ode\body,mass)
		dMassDestroy(mass)
		ode\geom=dCreateSphere(Space,0.7)
		WGeom(carID,count)=ode\geom
		dGeomSetBody(ode\geom,ode\body)
		ode\mesh=CreateCylinder()
		ScaleMesh ode\mesh,0.7,0.25,0.7
		EntityColor ode\mesh,255,255,255
	Next
	
	
	dBodySetPosition(Wheel(carID,1),CarStartX-12+(carID*10),CarStartY-0.5,CarStartZ+2)
	dBodySetPosition(Wheel(carID,2),CarStartX-8+(carID*10),CarStartY-0.5,CarStartZ+2)
	dBodySetPosition(Wheel(carID,3),CarStartX-12+(carID*10),CarStartY-0.5,CarStartZ-2)
	dBodySetPosition(Wheel(carID,4),CarStartX-8+(carID*10),CarStartY-0.5,CarStartZ-2)
	
	;RotateEntity Car(CarID),0,180,0
	
	
	
Next

;end create 2 cars
;###############################################################################





; ### Create Objects

SeedRnd MilliSecs()

For spheres=1 To 10
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	dBodySetPosition(ode\body,Rand(10,1000),500,Rand(30,1000))
	dBodySetRotation(ode\body,0,0,0)
	ode\geom=dCreateSphere(Space,4)
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateSphere()
	ScaleMesh ode\mesh,4,4,4
	EntityColor ode\mesh,Rand(0,255),255,Rand(0,200)
	EntityShininess ode\mesh,0.7
Next

For capsules=1 To 10
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	dBodySetPosition(ode\body,Rand(10,1000),130,Rand(30,1000))
	dBodySetRotation(ode\body,90,0,0)
	ode\geom=dCreateCapsule(Space,1,8)
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder()
	ScaleMesh ode\mesh,1,5,1
	RotateMesh ode\mesh,90,0,0	; ### Align Blitz3D Cylinder To ODE Capsule
	EntityColor ode\mesh,Rand(0,255),Rand(0,255),Rand(0,255)
	EntityShininess ode\mesh,0.7
Next

; ### function call for game board, or stairs

make_game_board(10,10)  ;this will make steps 10 by 10 at the mo......
; NOTE:  you need to reduce the size of the cubes within the function before
;        increasing the arguments to the function to prevent stack overflows.


; ### Create Light

Global Light=CreateLight()
RotateEntity Light,50,-50,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create Camera

Global CameraPivot=CreatePivot()
Global Camera=CreateCamera(CameraPivot)
CameraClsColor Camera,0,0,0
CameraRange Camera,1,3000


Global SecondCameraPivot=CreatePivot()
Global SecondCamera=CreateCamera(SecondCameraPivot)
CameraClsColor SecondCamera,0,0,0
CameraRange SecondCamera,1,3000

SplitScreen(Camera,SecondCamera,False)


; ### Create Plane

dCreatePlane(Space,0,1,0,0)

Global Plane=CreatePlane()
EntityAlpha Plane,0.8

EntityTexture Plane,PlaneTexture()

CreateMirror()

; ###################################################################################################

; ### Blitz3D Static Object (White)

Global Blitz3DObject=CreateCube()
ScaleMesh Blitz3DObject,1,4,20
PositionEntity Blitz3DObject,10,5,40
RotateEntity Blitz3DObject,-10,8,4
EntityColor Blitz3DObject,255,255,255

; ### ODE Static Object (Blue)

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,2,8,40)
dGeomSetPosition(ode\geom,20,5,40)
dGeomSetRotation(ode\geom,-10,8,4)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,1,4,20
EntityColor ode\mesh,0,100,200

; ### ODE Static Object (Red)

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,18,0.2,40)
dGeomSetPosition(ode\geom,30,4.9,-230)
dGeomSetRotation(ode\geom,-14,0,0)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,9,0.1,20
EntityColor ode\mesh,200,0,100

; ### Static get on again:

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,80,0.2,480)
dGeomSetPosition(ode\geom,130,58,50)
dGeomSetRotation(ode\geom,-14,0,0)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,40,0.1,240
EntityColor ode\mesh,200,0,100




;####################################################################################################
; ;set up the 100 textures for use

; Create texture of size 256x256

Global FLAGS=1	;Malice				 			Added this because you need to specify the texture 
												;flags value Before how many frames. 1=colour And is the Default
tex=CreateTexture(256,256,FLAGS,100) ;Malice	This now gives the texture 100 frames

font=LoadFont("arial",96,1,0,0) 
SetFont font 
Color 0,0,0 

For countcubes=1 To 100
	
	;Malice										Moved the setbuffer and cls inside loop and removed duplicate for efficiency.
	; Draw text on texture 
	; Set buffer - texture buffer 
	;-Malice:									Added Second Parameter for frame reference (frames are counted from 0-99)
	SetBuffer TextureBuffer(tex,countcubes-1) 
	
	; Clear texture buffer with background white color 
	ClsColor 255,255,255 
	Cls 
	
	Text 0,80,"  "+countcubes : Color 255,125,255
	;Flip	-Malice								We don't need flip as we are only drawing to the texture buffer.
	
	;Malice										Again, added a second parameter for texture frame
	EntityTexture colorthis(countcubes),tex,countcubes-1		
Next

;	Malice										Setbuffer back to backbuffer OUTSIDE of loop for efficiency.
SetBuffer BackBuffer()

;end set up 100 frames of 1 texture
;#############################################################################################################


;reset the font

font=LoadFont("arial",12) 
SetFont font 
Color 255,255,255




SetupCars()

While Not KeyHit(1)
	
	UpdateKeys()
	
	UpdateCars()
	
	UpdateGeoms()
	
	PTime=MilliSecs()
	
	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)
	
	PhysicsTime#=MilliSecs()-PTime
	
	UpdateCam()
	
	RenderWorld
	
	Text 640,0,"A - Accelerate"
	Text 640,15,"Z - Brake/Reverse"
	Text 640,30,"Arrows - Steering"
	Text 640,45,"Space - Reset Car"
	
	If lookat=0
		Text 640,60,"Player: "+1
	Else
		Text 640,60,"Player: "+2
	EndIf
	
	
	If ControlTimer &gt; LOWFUEL
		Text 640,90,"Fuel Left:"+ControlTimer
	Else
		Text 300,100," LOW TIME LEFT, Control Transferring Soon"
	End If
	
		
		
	Flip 1
	
Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End



Function UpdateCam()
	
	PositionEntity Camera,0,3,-12
	PivotX#=Cos(EntityYaw(CMesh(1))-90)+EntityX(CMesh(1))
	PivotY#=EntityY(CMesh(1))
	PivotZ#=Sin(EntityYaw(CMesh(1))-90)+EntityZ(CMesh(1))
	PositionEntity CameraPivot,PivotX,PivotY,PivotZ
	PointEntity CameraPivot,CMesh(1)

	PositionEntity SecondCamera,0,3,-12
	PivotX#=Cos(EntityYaw(CMesh(2))-90)+EntityX(CMesh(2))
	PivotY#=EntityY(CMesh(2))
	PivotZ#=Sin(EntityYaw(CMesh(2))-90)+EntityZ(CMesh(2))
	PositionEntity SecondCameraPivot,PivotX,PivotY,PivotZ
	PointEntity SecondCameraPivot,CMesh(2)
	
End Function

; #########################

; ###################################################################################################

Function UpdateGeoms()
	
	For ode.ODEGeom=Each ODEGeom
		PositionEntity ode\mesh,dGeomGetPositionX(ode\geom),dGeomGetPositionY(ode\geom),dGeomGetPositionZ(ode\geom)
		RotateEntity ode\mesh,dGeomGetPitch(ode\geom),dGeomGetYaw(ode\geom),dGeomGetRoll(ode\geom)
	Next
	
End Function

; ###################################################################################################

Function make_game_board(x,y)
	
	;make some stairs - bit of an evolution of the static objects with the demo code with ODE
	;cubex = 60;  the width of a cube
	;cubey = 1.7;  the height of a cube
	;cubez = 20;  the zed of a cube
	
	cubex = 210; cubes 10  by 10
	cubey = 70
	cubez = 70
	
	Z_ROW_GAP = 500
	
	rotate_degrees = 0; rotate the cubes by {x} degrees
	
	SeedRnd (MilliSecs()) 
	
	For madsteps=1 To 10  ;note to generate a flat gameboard of 10 by 10 set this to 1 to 1
                          ;and pass 10,10 to the function	
		For cubeswide=1 To x
			
			;For cubeszed=1 To y
			For cubeszed=1 To 1
				
			;SeedRnd (MilliSecs()) 
				cred= Rand(1,250) 
				cgreen = Rand(1,250) 
				cblue = Rand(1,250) 
				
				countcubes=countcubes+1
				
			;add a cube
				ode.ODEGeom=New ODEGeom
				ode\geom=dCreateBox(Space,cubex,cubey,cubez)
				dGeomSetPosition(ode\geom,(cubeswide*cubex)-15,(cubey*madsteps),(((cubeszed*(cubez)+((x*cubez)*madsteps))/10)-260)+(Z_ROW_GAP*madsteps))
				dGeomSetRotation(ode\geom,rotate_degrees,0,0)
				ode\mesh=CreateCube()
				ScaleMesh ode\mesh,cubex/2,cubey/2,cubez/2
				EntityColor ode\mesh,cred,cgreen,cblue
				
				;store the mem location of each cube
				colorthis(countcubes)=ode\mesh
				
			Next
			
		Next
		
		;Add the ramps between rows - not the most efficient but it works....
		
		If madsteps &gt; 2
			
			If  madsteps Mod 2 = 1
				ode.ODEGeom=New ODEGeom
				ode\geom=dCreateBox(Space,cubex,2,cubez*8)
				dGeomSetPosition(ode\geom,((2*cubex)-cubex),(cubey*madsteps)+(cubey-60),(((cubeszed*(cubez)+(((x*cubez)*madsteps))/10)-260)+(Z_ROW_GAP*madsteps))-(Z_ROW_GAP-70))
				dGeomSetRotation(ode\geom,-10,0,0)
				ode\mesh=CreateCube()
				ScaleMesh ode\mesh,cubex/2,1,(cubez*8)/2
			EndIf
			
		EndIf
				
		
		If Not madsteps Mod 2 = 1
			ode.ODEGeom=New ODEGeom
			ode\geom=dCreateBox(Space,cubex,2,cubez*8)
			dGeomSetPosition(ode\geom,((cubeswide*cubex)-cubex),(cubey*madsteps)+(cubey-60),(((cubeszed*(cubez)+(((x*cubez)*madsteps))/10)-260)+(Z_ROW_GAP*madsteps))-(Z_ROW_GAP-70))
			dGeomSetRotation(ode\geom,-10,0,0)
			ode\mesh=CreateCube()
			ScaleMesh ode\mesh,cubex/2,1,(cubez*8)/2
			
			
		EndIf 
		
		;end add ramps
		
		
	Next
	
End Function 

;############################################################################

Function mgloadtext(filename$, ident$)

; function can load file dependent on ident: bmp | b3d	

If ident$="bmp"
	filehandle = ReadFile (filename$)
	If filehandle &lt;&gt; 0
		this=LoadTexture(filename$)
	Else
		Print "cannot locate " + filename$
		Print "Press any key"
		WaitKey()
		End
	EndIf
Else If ident$="b3d"
	filehandle = ReadFile (filename$)
	If filehandle &lt;&gt; 0	
		this=LoadMesh(filename$)
	Else
		Print "cannot locate " + filename$
		Print "Press Any Key"
		WaitKey()	
		End
	EndIf
Else 
	Print "unrecognised file type press any key."
	WaitKey()			
EndIf
Print filename$ + "Loaded"

Return this

End Function




;#############################################################################
;2 Car functions:

Function SetupCars()
	
	For carID=1 To 2
		For count=1 To 4
			Joint(carID,count)=dJointCreateHinge2(World,0)
			dJointAttach(Joint(carID,count),Car(carID),Wheel(carID,count))
			dJointSetHinge2Anchor(Joint(carID,count),dBodyGetPositionX(Wheel(carID,count)),dBodyGetPositionY(Wheel(carID,count)),dBodyGetPositionZ(Wheel(carID,count)))
			dJointSetHinge2Axis1(Joint(carID,count),0,1,0)
			dJointSetHinge2Axis2(Joint(carID,count),-1,0,0)
			dJointSetHinge2Param(Joint(carID,count),dParamSuspensionERP,0.8)
			dJointSetHinge2Param(Joint(carID,count),dParamSuspensionCFM,SuspensionHS)
			If count&gt;2
				dJointSetHinge2Param(Joint(carID,count),dParamLoStop,0)
				dJointSetHinge2Param(Joint(carID,count),dParamHiStop,0)
			End If
		Next
	Next
	
End Function

; ###################################################################################################

Function UpdateKeys()
	
	
	If lookat=1
; ### Player Control - Car 1
		
		If KeyDown(30)=1
			Force(1)=Force(1)+0.08
			If Force(1)&gt;30 Then Force(1)=30
		End If
		
		If KeyDown(44)=1
			Force(1)=Force(1)-0.1
			If Force(1)&lt;-10 Then Force(1)=-10
			If Force(1)&gt;0 Then Force(1)=Force(1)*0.97
		End If
		
		If KeyDown(30)=0 And KeyDown(44)=0 Then Force(1)=Force(1)*0.99
		
		If KeyDown(203)=1 Or KeyDown(205)=1
			If KeyDown(203)=1
				Steer(1)=0.5
			Else
				Steer(1)=-0.5
			End If
		Else
			Steer(1)=0.0
		End If
		
		If KeyHit(57)=1
			Force(1)=0.0
			dBodySetRotation(Car(1),dGeomGetPitch(CGeom(1)),dGeomGetYaw(CGeom(1)),0)
		End If
		
	Else
		
		If KeyDown(30)=1
			Force(2)=Force(2)+0.08
			If Force(2)&gt;30 Then Force(2)=30
		End If
		
		If KeyDown(44)=1
			Force(2)=Force(2)-0.1
			If Force(2)&lt;-10 Then Force(2)=-10
			If Force(2)&gt;0 Then Force(2)=Force(2)*0.97
		End If
		
		If KeyDown(30)=0 And KeyDown(44)=0 Then Force(2)=Force(2)*0.99
		
		If KeyDown(203)=1 Or KeyDown(205)=1
			If KeyDown(203)=1
				Steer(2)=0.5
			Else
				Steer(2)=-0.5
			End If
		Else
			Steer(2)=0.0
		End If
		
		If KeyHit(57)=1
			Force(2)=0.0
			dBodySetRotation(Car(2),dGeomGetPitch(CGeom(2)),dGeomGetYaw(CGeom(2)),0)
		End If
		
	EndIf
	
	
	
	ControlTimer=ControlTimer-1
	
	If ControlTimer&lt;=1
		ControlTimer=MAXCONTROLTIME
		If lookat=1
			lookat=0
		Else
			lookat=1
		EndIf
		
	EndIf
	
	
;; ### Simple AI - Car 2
;
;If ControlTimer&gt;100
;	SeedRnd MilliSecs()
;	AIKey=Rand(0,100)
;
;	If AIKey&lt;40
;		Force(2)=Force(2)+0.8
;		If Force(2)&gt;10 Then Force(2)=10
;		End If
;
;	If AIKey=&gt;40 Then Force(2)=Force(2)*0.99
;
;	ControlTimer=0
;	End If
;
;If SteeringTimer&gt;100
;	SeedRnd MilliSecs()
;	AIKey=Rand(0,100)
;
;	Steer(2)=0.0
;	If AIKey&lt;30 Then Steer(2)=0.5
;	If AIKey&gt;70 Then Steer(2)=-0.5
;
;	SteeringTimer=0
;	End If
;
;ControlTimer=ControlTimer+1
;SteeringTimer=SteeringTimer+1
	
End Function

; ###########################################################################



Function UpdateCars()
	
	For carID=1 To 2
		For count=1 To 4
			dBodyEnable(Wheel(carID,count))
		Next
		
		dBodyEnable(Car(carID))
		
		For count=1 To 4
			dJointSetHinge2Param(Joint(carID,count),dParamVel2,Force(carID))
			dJointSetHinge2Param(Joint(carID,count),dParamFMax2,Torque)
		Next
		
		For count=1 To 2
			angle#=Steer(carID)-dJointGetHinge2Angle1(Joint(carID,count))
			dJointSetHinge2Param(Joint(carID,count),dParamVel,angle)
			dJointSetHinge2Param(Joint(carID,count),dParamFMax,400)
		Next
	Next
	
End Function

Function SplitScreen(Camera1,Camera2,VerticalSplit)
	If VerticalSplit Then
		CameraViewport Camera1,0,0,GraphicsWidth()/2,GraphicsHeight()
		CameraViewport Camera2,GraphicsWidth()/2,0,GraphicsWidth()/2,GraphicsHeight()
	Else
		CameraViewport Camera1,0,0,GraphicsWidth(),GraphicsHeight()/2
		CameraViewport Camera2,0,GraphicsHeight()/2,GraphicsWidth(),GraphicsHeight()/2
	End If
End Function
</textarea><br><br>you have to add a new set of controls for the second car<br><br>the new function SplitScreen should split vertically or horizontally, and that should be changed by a key press if you call it again toggling the third parameter.<br><br>juan <br><br></td></tr></table><br>
<a name="1001733"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#132">[#132]</a></td></tr></table></td></tr><tr ><td class="posttext"> Charrua, thank you for the feedback, my I'm gonna have some fun now.  The codebox below allows one player to use the keyboard and the other to use a USB joypad. Please note you will need a joypad.cfg file, details of where to source this within the code. Incorporated some barriers now as well so it is not so easy to fall off the rows.<br><br>Interestingly, my desktop displays the numbers applied to the cubes, however, when the executable is transferred to the laptop, the numbers do not appear on the textures. Must be something to do with the lack of a dedicated graphics card on the laptop.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #                                 JV-ODE Duo Demo, slightly mod'd                                 # 
; #                Make_game_board with ramps function by Mark Gormley (Blitzplotter)               #
; #           Split Screen function with Charrua's help &amp; Texturing with Malice's help              #
; #                            Original Code by Jim Williams (VIP3R)                                #
; #                            Devious Codeworks - Copyright © 2009                                 #
; ###################################################################################################




;SplitScreen_v3:  invoking joypad For player 2 and adding borders, please note you need a joypad.cfg
;file within the same directory as this file in order for this to compile.  joypad.cfg available from
;this link:  &lt;a href="http://www.wishingwellsoftware.co.uk/joypad.cfg" target="_blank"&gt;http://www.wishingwellsoftware.co.uk/joypad.cfg&lt;/a&gt;


Include "JV-ODE.bb"

AppTitle "Race to cube 100, it is a long way back to cube 1."

Graphics3D 800,600,0,1

Global CMass#=200.0				; ### Car Mass
Global WMass#=14.0				; ### Wheel Mass

Global WorldERP#=1.0			; ### World Error Correction
Global WorldFriction#=70.0		; ### World Friction

Global Torque#=24.0				; ### Joint Torque
Global SuspensionHS#=0.01		; ### Suspension Hardness/Softness (Higher=Softer - Lower=Harder)



Global lookat=1

Dim Force#(2)
Dim Steer#(2)

Dim Car(2)
Dim CGeom(2)
Dim CMesh(2)


Global LOWFUEL = 400
Global MAXCONTROLTIME=1500

Global ControlTimer=800
Global SteeringTimer=0

Global CarStartX=1825
Global CarStartY=155
Global CarStartZ=300


Dim Wheel(2,4)
Dim WGeom(2,4)
Dim Joint(2,4)

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type



Global countcubes

Dim colorthis(1000)  ; needed to store the memory location of each ODE cube when it is created

;JOYPAD GLOBALS
Type joypad
	Field x1id
	Field y1id
	Field x2id
	Field y2id
	Field x1invert
	Field y1invert
	Field x2invert
	Field y2invert
End Type 

Dim j.joypad(3)

For port = 0 To 3
	j(port) = New joypad
	j(port)\x1id = 0
	j(port)\y1id = 0
	j(port)\x2id = 0
	j(port)\y2id = 0
	j(port)\x1invert = 1 ;toggles between 1 and -1 
	j(port)\y1invert = 1
	j(port)\x2invert = 1
	j(port)\y2invert = 1
Next 

readconfig()

; END JOYPAD GLOBALS


; ###################################################################################################

; ### Setup ODE

dInitODE()

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,-0.98,0)
dWorldSetERP(World,WorldERP)

dContactSetMode(dContactSlip1)
dContactSetMu(WorldFriction)



dContactSetMode(dContactBounce)
dContactSetBounce(0.1)
dContactSetMu(48)

dContactSetMode(dContactSlip1)
dContactSetMu(WorldFriction)



;################################################################################
;create 2 cars

For carID=1 To 2
	; ### Create Car Body
	
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	Car(carID)=ode\body
	;dBodySetPosition(ode\body,-10+(carID*10),CarStartY,0)
	dBodySetPosition(ode\body,CarStartX-10+(carID*10),CarStartY,CarStartZ)
	dBodySetRotation(ode\body,0,0,0)
	mass=dMassCreate()
	dMassSetBoxTotal(mass,CMass,3,1,4)
	dBodySetMass(ode\body,mass)
	dMassDestroy(mass)
	ode\geom=dCreateBox(Space,3,1,4)
	CGeom(carID)=ode\geom
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCube()
	CMesh(carID)=ode\mesh
	ScaleMesh ode\mesh,1.5,0.5,2
	If carID=1
		EntityColor ode\mesh,40,80,255
	Else
		EntityColor ode\mesh,40,255,80
	End If
	
	; ### Create Wheels
	
	For count=1 To 4
		ode.ODEGeom=New ODEGeom
		ode\body=dBodyCreate(World)
		Wheel(carID,count)=ode\body
		dBodySetPosition(ode\body,0,0,0)
		dBodySetRotation(ode\body,0,0,90)
		mass=dMassCreate()
		dMassSetSphereTotal(mass,WMass,0.7)
		dBodySetMass(ode\body,mass)
		dMassDestroy(mass)
		ode\geom=dCreateSphere(Space,0.7)
		WGeom(carID,count)=ode\geom
		dGeomSetBody(ode\geom,ode\body)
		ode\mesh=CreateCylinder()
		ScaleMesh ode\mesh,0.7,0.25,0.7
		EntityColor ode\mesh,255,255,255
	Next
	
	
	dBodySetPosition(Wheel(carID,1),CarStartX-12+(carID*10),CarStartY-0.5,CarStartZ+2)
	dBodySetPosition(Wheel(carID,2),CarStartX-8+(carID*10),CarStartY-0.5,CarStartZ+2)
	dBodySetPosition(Wheel(carID,3),CarStartX-12+(carID*10),CarStartY-0.5,CarStartZ-2)
	dBodySetPosition(Wheel(carID,4),CarStartX-8+(carID*10),CarStartY-0.5,CarStartZ-2)
	
	;RotateEntity Car(CarID),0,180,0
	
	
	
Next

;end create 2 cars
;###############################################################################





; ### Create Objects

SeedRnd MilliSecs()

For spheres=1 To 10
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	dBodySetPosition(ode\body,Rand(10,1000),500,Rand(30,1000))
	dBodySetRotation(ode\body,0,0,0)
	ode\geom=dCreateSphere(Space,4)
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateSphere()
	ScaleMesh ode\mesh,4,4,4
	EntityColor ode\mesh,Rand(0,255),255,Rand(0,200)
	EntityShininess ode\mesh,0.7
Next

For capsules=1 To 10
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	dBodySetPosition(ode\body,Rand(10,1000),130,Rand(30,1000))
	dBodySetRotation(ode\body,90,0,0)
	ode\geom=dCreateCapsule(Space,1,8)
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder()
	ScaleMesh ode\mesh,1,5,1
	RotateMesh ode\mesh,90,0,0	; ### Align Blitz3D Cylinder To ODE Capsule
	EntityColor ode\mesh,Rand(0,255),Rand(0,255),Rand(0,255)
	EntityShininess ode\mesh,0.7
Next

; ### function call for game board, or stairs

make_game_board(10,10)  ;this will make steps 10 by 10 at the mo......
; NOTE:  you need to reduce the size of the cubes within the function before
;        increasing the arguments to the function to prevent stack overflows.


; ### Create Light

Global Light=CreateLight()
RotateEntity Light,50,-50,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create Camera

Global CameraPivot=CreatePivot()
Global Camera=CreateCamera(CameraPivot)
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1500


Global SecondCameraPivot=CreatePivot()
Global SecondCamera=CreateCamera(SecondCameraPivot)
CameraClsColor SecondCamera,0,0,0
CameraRange SecondCamera,1,3000

SplitScreen(Camera,SecondCamera,False)


; ### Create Plane

dCreatePlane(Space,0,1,0,0)

Global Plane=CreatePlane()
EntityAlpha Plane,0.8

EntityTexture Plane,PlaneTexture()

CreateMirror()

; ###################################################################################################

; ### Blitz3D Static Object (White)

Global Blitz3DObject=CreateCube()
ScaleMesh Blitz3DObject,1,4,20
PositionEntity Blitz3DObject,10,5,40
RotateEntity Blitz3DObject,-10,8,4
EntityColor Blitz3DObject,255,255,255

; ### ODE Static Object (Blue)

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,2,8,40)
dGeomSetPosition(ode\geom,20,5,40)
dGeomSetRotation(ode\geom,-10,8,4)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,1,4,20
EntityColor ode\mesh,0,100,200

; ### ODE Static Object (Red)

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,18,0.2,40)
dGeomSetPosition(ode\geom,30,4.9,-230)
dGeomSetRotation(ode\geom,-14,0,0)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,9,0.1,20
EntityColor ode\mesh,200,0,100

; ### Static get on cube 1 again:

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,80,0.2,480)
dGeomSetPosition(ode\geom,130,58,50)
dGeomSetRotation(ode\geom,-14,0,0)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,40,0.1,240
EntityColor ode\mesh,100,0,100




;####################################################################################################
; ;set up the 100 textures for use

; Create texture of size 256x256

Global FLAGS=1	;Malice				 			Added this because you need to specify the texture 
												;flags value Before how many frames. 1=colour And is the Default
tex=CreateTexture(256,256,FLAGS,100) ;Malice	This now gives the texture 100 frames

font=LoadFont("arial",96,1,0,0) 
SetFont font 
Color 0,0,0 

For countcubes=1 To 100
	
	;Malice										Moved the setbuffer and cls inside loop and removed duplicate for efficiency.
	; Draw text on texture 
	; Set buffer - texture buffer 
	;-Malice:									Added Second Parameter for frame reference (frames are counted from 0-99)
	SetBuffer TextureBuffer(tex,countcubes-1) 
	
	; Clear texture buffer with background white color 
	ClsColor 255,255,255 
	Cls 
	
	Text 0,80,"  "+countcubes : Color 255,125,255
	;Flip	-Malice								We don't need flip as we are only drawing to the texture buffer.
	
	;Malice										Again, added a second parameter for texture frame
	EntityTexture colorthis(countcubes),tex,countcubes-1		
Next

;	Malice										Setbuffer back to backbuffer OUTSIDE of loop for efficiency.
SetBuffer BackBuffer()

;end set up 100 frames of 1 texture
;#############################################################################################################


;reset the font

font=LoadFont("arial",12) 
SetFont font 
Color 255,255,255




SetupCars()

While Not KeyHit(1)
	
	
	UpdateKeysCar1()
	
	UpdateJoypadCar2()
	
	UpdateCars()
	
	UpdateGeoms()
	
	PTime=MilliSecs()
	
	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)
	
	PhysicsTime#=MilliSecs()-PTime
	
	UpdateCam()
	
	RenderWorld
	
	Text 40,0,"You might want to slow down before you reach the top of each ramp......."
	
	Text 640,0,"Player 1:  A - Accelerate"
	Text 640,15,"Z - Brake/Reverse"
	Text 640,30,"Arrows - Steering"
	Text 640,45,"Space - Reset Blue Car"
	Text 640,60,"USB Joypad - Player 2"
	Text 640,75,"Enter - Reset Green Car"
	
	
;	If ControlTimer &gt; LOWFUEL
;		Text 640,90,"Fuel Left:"+ControlTimer
;	Else
;		Text 300,100," LOW TIME LEFT, Control Transferring Soon"
;	End If
	
	Flip 1
	
Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End



Function UpdateCam()
	
	PositionEntity Camera,0,3,-12
	PivotX#=Cos(EntityYaw(CMesh(1))-90)+EntityX(CMesh(1))
	PivotY#=EntityY(CMesh(1))
	PivotZ#=Sin(EntityYaw(CMesh(1))-90)+EntityZ(CMesh(1))
	PositionEntity CameraPivot,PivotX,PivotY,PivotZ
	PointEntity CameraPivot,CMesh(1)
	
	PositionEntity SecondCamera,0,3,-12
	PivotX#=Cos(EntityYaw(CMesh(2))-90)+EntityX(CMesh(2))
	PivotY#=EntityY(CMesh(2))
	PivotZ#=Sin(EntityYaw(CMesh(2))-90)+EntityZ(CMesh(2))
	PositionEntity SecondCameraPivot,PivotX,PivotY,PivotZ
	PointEntity SecondCameraPivot,CMesh(2)
	
End Function

; #########################

; ###################################################################################################

Function UpdateGeoms()
	
	For ode.ODEGeom=Each ODEGeom
		PositionEntity ode\mesh,dGeomGetPositionX(ode\geom),dGeomGetPositionY(ode\geom),dGeomGetPositionZ(ode\geom)
		RotateEntity ode\mesh,dGeomGetPitch(ode\geom),dGeomGetYaw(ode\geom),dGeomGetRoll(ode\geom)
	Next
	
End Function

; ###################################################################################################

Function make_game_board(x,y)
	
	;make some stairs - bit of an evolution of the static objects with the demo code with ODE
	;cubex = 60;  the width of a cube
	;cubey = 1.7;  the height of a cube
	;cubez = 20;  the zed of a cube
	
	cubex = 210; cubes 10  by 10
	cubey = 70
	cubez = 70
	
	Z_ROW_GAP = 500
	
	rotate_degrees = 0; rotate the cubes by {x} degrees
	
	SeedRnd (MilliSecs()) 
	
	For madsteps=1 To 10  ;note to generate a flat gameboard of 10 by 10 set this to 1 to 1
                          ;and pass 10,10 to the function	
		For cubeswide=1 To x
			
			;For cubeszed=1 To y
			For cubeszed=1 To 1
				
			;SeedRnd (MilliSecs()) 
				cred= Rand(1,250) 
				cgreen = Rand(1,250) 
				cblue = Rand(1,250) 
				
				countcubes=countcubes+1
				
			;add a cube
				ode.ODEGeom=New ODEGeom
				ode\geom=dCreateBox(Space,cubex,cubey,cubez)
				dGeomSetPosition(ode\geom,(cubeswide*cubex)-15,(cubey*madsteps),(((cubeszed*(cubez)+((x*cubez)*madsteps))/10)-260)+(Z_ROW_GAP*madsteps))
				dGeomSetRotation(ode\geom,rotate_degrees,0,0)
				ode\mesh=CreateCube()
				ScaleMesh ode\mesh,cubex/2,cubey/2,cubez/2
				EntityColor ode\mesh,cred,cgreen,cblue
				
				;store the mem location of each cube
				colorthis(countcubes)=ode\mesh
				
			Next
			
		Next
		
		;Add the ramps between rows - not the most efficient but it works....
		wred=100
		wgreen=100
		wblue=100
		
		If madsteps &gt; 2
			
			If  madsteps Mod 2 = 1
				ode.ODEGeom=New ODEGeom
				ode\geom=dCreateBox(Space,cubex,2,cubez*8)
				dGeomSetPosition(ode\geom,((2*cubex)-cubex),(cubey*madsteps)-3,(((cubeszed*(cubez)+(((x*cubez)*madsteps))/10)-260)+(Z_ROW_GAP*madsteps))-(Z_ROW_GAP-70))
				dGeomSetRotation(ode\geom,-8,0,0)
				ode\mesh=CreateCube()
				ScaleMesh ode\mesh,cubex/2,1,(cubez*8)/2
				EntityColor ode\mesh,cred,cgreen,cblue
			EndIf
			
		EndIf
		
		
		If Not madsteps Mod 2 = 1
			ode.ODEGeom=New ODEGeom
			ode\geom=dCreateBox(Space,cubex,2,cubez*8)
			dGeomSetPosition(ode\geom,((cubeswide*cubex)-cubex),(cubey*madsteps)-3,(((cubeszed*(cubez)+(((x*cubez)*madsteps))/10)-260)+(Z_ROW_GAP*madsteps))-(Z_ROW_GAP-70))
			dGeomSetRotation(ode\geom,-8,0,0)
			ode\mesh=CreateCube()
			ScaleMesh ode\mesh,cubex/2,1,(cubez*8)/2
			EntityColor ode\mesh,cred,cgreen,cblue
		EndIf 
		
		;end add ramps
		
		;-----------------------------------------
		
		;Add the borders to each row:
		
		ode.ODEGeom=New ODEGeom
		ode\geom=dCreateBox(Space,cubex*7,4,2)
		dGeomSetPosition(ode\geom,((2*cubex)+cubex*3),(cubey*madsteps)+(cubey-33),(((cubeszed*(cubez)+(((x*cubez)*madsteps))/10)-105)+(Z_ROW_GAP*madsteps))-260)
		;dGeomSetRotation(ode\geom,-10,0,0)
		ode\mesh=CreateCube()
		ScaleMesh ode\mesh,cubex*3.5,2,1
		EntityColor ode\mesh,cred,cgreen,cblue
		
		ode.ODEGeom=New ODEGeom
		ode\geom=dCreateBox(Space,cubex*7,4,2)
		dGeomSetPosition(ode\geom,((2*cubex)+cubex*3),(cubey*madsteps)+(cubey-33),(((cubeszed*(cubez)+(((x*cubez)*madsteps))/10)-165)+(Z_ROW_GAP*madsteps))-260)
		;dGeomSetRotation(ode\geom,-10,0,0)
		ode\mesh=CreateCube()
		ScaleMesh ode\mesh,cubex*3.5,2,1
		EntityColor ode\mesh,cred,cgreen,cblue
		
		;------------------------------------------
		
	Next
	
End Function 

;############################################################################

Function mgloadtext(filename$, ident$)
	
; function can load file dependent on ident: bmp | b3d	
	
	If ident$="bmp"
		filehandle = ReadFile (filename$)
		If filehandle &lt;&gt; 0
			this=LoadTexture(filename$)
		Else
			Print "cannot locate " + filename$
			Print "Press any key"
			WaitKey()
			End
		EndIf
	Else If ident$="b3d"
		filehandle = ReadFile (filename$)
		If filehandle &lt;&gt; 0	
			this=LoadMesh(filename$)
		Else
			Print "cannot locate " + filename$
			Print "Press Any Key"
			WaitKey()	
			End
		EndIf
	Else 
		Print "unrecognised file type press any key."
		WaitKey()			
	EndIf
	Print filename$ + "Loaded"
	
	Return this
	
End Function




;#############################################################################
;2 Car functions:

Function SetupCars()
	
	For carID=1 To 2
		For count=1 To 4
			Joint(carID,count)=dJointCreateHinge2(World,0)
			dJointAttach(Joint(carID,count),Car(carID),Wheel(carID,count))
			dJointSetHinge2Anchor(Joint(carID,count),dBodyGetPositionX(Wheel(carID,count)),dBodyGetPositionY(Wheel(carID,count)),dBodyGetPositionZ(Wheel(carID,count)))
			dJointSetHinge2Axis1(Joint(carID,count),0,1,0)
			dJointSetHinge2Axis2(Joint(carID,count),-1,0,0)
			dJointSetHinge2Param(Joint(carID,count),dParamSuspensionERP,0.8)
			dJointSetHinge2Param(Joint(carID,count),dParamSuspensionCFM,SuspensionHS)
			If count&gt;2
				dJointSetHinge2Param(Joint(carID,count),dParamLoStop,0)
				dJointSetHinge2Param(Joint(carID,count),dParamHiStop,0)
			End If
		Next
	Next
	
End Function


;#############################################
;SplitScreen update keys &amp; joypad for 2nd car
;#############################################


Function UpdateKeysCar1()
	
	
	;If lookat=1
; ### Player Control - Car 1
	
	If KeyDown(30)=1
		Force(1)=Force(1)+0.08
		If Force(1)&gt;30 Then Force(1)=30
	End If
	
	If KeyDown(44)=1
		Force(1)=Force(1)-0.1
		If Force(1)&lt;-10 Then Force(1)=-10
		If Force(1)&gt;0 Then Force(1)=Force(1)*0.97
	End If
	
	If KeyDown(30)=0 And KeyDown(44)=0 Then Force(1)=Force(1)*0.99
	
	If KeyDown(203)=1 Or KeyDown(205)=1
		If KeyDown(203)=1
			Steer(1)=0.5
		Else
			Steer(1)=-0.5
		End If
	Else
		Steer(1)=0.0
	End If
	
	If KeyHit(57)=1
		Force(1)=0.0
		dBodySetRotation(Car(1),dGeomGetPitch(CGeom(1)),dGeomGetYaw(CGeom(1)),0)
	End If
	
End Function
; ###################################################################################################
Function UpdateJoypadCar2()
	
	;read in joypad status	
	X1_axis=MapAxis(j(Controller_port)\x1id,j(Controller_port)\x1invert)
	Y1_axis=MapAxis(j(Controller_port)\y1id,j(Controller_port)\y1invert)
	X2_axis=MapAxis(j(Controller_port)\x2id,j(Controller_port)\x2invert)
	Y2_axis=MapAxis(j(Controller_port)\y2id,j(Controller_port)\y2invert)
	
;If KeyDown(30)=1
	If Y1_Axis = -1
		Force(2)=Force(2)+0.08
		If Force(2)&gt;30 Then Force(2)=30
	End If
	
;If KeyDown(44)=1
	If Y1_Axis = 1
		Force(2)=Force(2)-0.1
		If Force(2)&lt;-10 Then Force(2)=-10
		If Force(2)&gt;0 Then Force(2)=Force(2)*0.97
	End If
	
;If KeyDown(30)=0 And KeyDown(44)=0 Then Force=Force*0.99
	If Y1_Axis = 0
		Force(2)=Force(2)*0.99
	EndIf
	
	;Force2=Force  ; truck2 debug
	
;If KeyDown(203)=1 Or KeyDown(205)=1
	If X2_Axis  = -1 Or X2_Axis = 1
		If X2_Axis=-1
			Steer(2)=0.5
		Else
			Steer(2)=-0.5
		End If
	Else
		Steer(2)=0
	End If
	
	If KeyHit(28)=1  ; enter to reset car 2
		Force(2)=0.0
		dBodySetRotation(Car(2),dGeomGetPitch(CGeom(2)),dGeomGetYaw(CGeom(2)),0)
	End If	
	
End Function
; ###################################################################################################

Function UpdateKeys(); invoke this function if you want to have alternate control via keyboard
	
	
	If lookat=1
; ### Player Control - Car 1
		
		If KeyDown(30)=1
			Force(1)=Force(1)+0.08
			If Force(1)&gt;30 Then Force(1)=30
		End If
		
		If KeyDown(44)=1
			Force(1)=Force(1)-0.1
			If Force(1)&lt;-10 Then Force(1)=-10
			If Force(1)&gt;0 Then Force(1)=Force(1)*0.97
		End If
		
		If KeyDown(30)=0 And KeyDown(44)=0 Then Force(1)=Force(1)*0.99
		
		If KeyDown(203)=1 Or KeyDown(205)=1
			If KeyDown(203)=1
				Steer(1)=0.5
			Else
				Steer(1)=-0.5
			End If
		Else
			Steer(1)=0.0
		End If
		
		If KeyHit(57)=1
			Force(1)=0.0
			dBodySetRotation(Car(1),dGeomGetPitch(CGeom(1)),dGeomGetYaw(CGeom(1)),0)
		End If
		
	Else
		
		If KeyDown(30)=1
			Force(2)=Force(2)+0.08
			If Force(2)&gt;30 Then Force(2)=30
		End If
		
		If KeyDown(44)=1
			Force(2)=Force(2)-0.1
			If Force(2)&lt;-10 Then Force(2)=-10
			If Force(2)&gt;0 Then Force(2)=Force(2)*0.97
		End If
		
		If KeyDown(30)=0 And KeyDown(44)=0 Then Force(2)=Force(2)*0.99
		
		If KeyDown(203)=1 Or KeyDown(205)=1
			If KeyDown(203)=1
				Steer(2)=0.5
			Else
				Steer(2)=-0.5
			End If
		Else
			Steer(2)=0.0
		End If
		
		If KeyHit(57)=1
			Force(2)=0.0
			dBodySetRotation(Car(2),dGeomGetPitch(CGeom(2)),dGeomGetYaw(CGeom(2)),0)
		End If
		
	EndIf
	
	
	
	ControlTimer=ControlTimer-1
	
	If ControlTimer&lt;=1
		ControlTimer=MAXCONTROLTIME
		If lookat=1
			lookat=0
		Else
			lookat=1
		EndIf
		
	EndIf
	
	
End Function

;=========================================================================


Function UpdateCars()
	
	For carID=1 To 2
		For count=1 To 4
			dBodyEnable(Wheel(carID,count))
		Next
		
		dBodyEnable(Car(carID))
		
		For count=1 To 4
			dJointSetHinge2Param(Joint(carID,count),dParamVel2,Force(carID))
			dJointSetHinge2Param(Joint(carID,count),dParamFMax2,Torque)
		Next
		
		For count=1 To 2
			angle#=Steer(carID)-dJointGetHinge2Angle1(Joint(carID,count))
			dJointSetHinge2Param(Joint(carID,count),dParamVel,angle)
			dJointSetHinge2Param(Joint(carID,count),dParamFMax,400)
		Next
	Next
	
End Function

;#########################################################################


Function SplitScreen(Camera1,Camera2,VerticalSplit)
	If VerticalSplit Then
		CameraViewport Camera1,0,0,GraphicsWidth()/2,GraphicsHeight()
		CameraViewport Camera2,GraphicsWidth()/2,0,GraphicsWidth()/2,GraphicsHeight()
	Else
		CameraViewport Camera1,0,0,GraphicsWidth(),GraphicsHeight()/2
		CameraViewport Camera2,0,GraphicsHeight()/2,GraphicsWidth(),GraphicsHeight()/2
	End If
End Function

; ###################################################################################################
; ###################################################################################################

;FUNCTIONS TO READ JOYPAD

Function readconfig()
	filename = ReadFile ("joypad.cfg")
	If filename &lt;&gt; 0
		For port = 0 To 3
			tmp = ReadLine (filename) ; skip this line in the file
			j(port)\x1id = ReadLine (filename)
			j(port)\y1id = ReadLine (filename)
			j(port)\x2id  = ReadLine (filename)
			j(port)\y2id = ReadLine (filename)
			j(port)\x1invert = ReadLine (filename)
			j(port)\y1invert = ReadLine (filename)
			j(port)\x2invert = ReadLine (filename)
			j(port)\y2invert = ReadLine (filename)
		Next 
		CloseFile (filename)
		info$ = "config file opened"
	Else
		info$ = "load failed, or no .cfg file present"
	EndIf 
End Function

Function readgraphicsmode()
	filename = ReadFile ("graphics.cfg")
	If filename &lt;&gt; 0
		
		tmp = ReadLine (filename) ; skip this line in the file
		x = ReadLine (filename) ;
		tmp = ReadLine (filename) ; skip this line in the file
		y = ReadLine (filename) ;
		tmp = ReadLine (filename) ; skip this line in the file
		depth = ReadLine (filename) ;
		tmp = ReadLine (filename) ; skip this line in the file
		modea = ReadLine (filename) ;
		
		CloseFile (filename)
		info$ = "graphics config file opened"+x +" "+y+" "+mode+" "+thisj
		Graphics3D x,y,depth,modea
		Print info$
	;WaitKey()
	Else
		info$ = "config load failed, or no .cfg file present, press any key"
		Print info$
		Graphics3D 800,600,32,0
		Print info$
		WaitKey()
	EndIf 	
End Function

;======================
; detect input
;======================
Function MapAxis#( axis, invert )
	Select axis
		Case 1
			joy#=JoyX(Controller_port)
		Case 2
			joy#=JoyY(Controller_port)
		Case 3
			joy#=JoyZ(Controller_port)
		Case 4
			joy#=JoyPitch(Controller_port)/180
		Case 5
			joy#=JoyRoll(Controller_port)/180
		Case 6
			joy#=JoyYaw(Controller_port)/180
		Case 7
			joy#=JoyU(Controller_port)
		Case 8
			joy#=JoyV(Controller_port)
	End Select
	Return (joy# * invert)
End Function

;END FUNCTIONS TO READ JOYPAD

; ###################################################################################################
;####################################################################################

</textarea> <br><br></td></tr></table><br>
<a name="1002247"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ian Caio</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#133">[#133]</a></td></tr></table></td></tr><tr ><td class="posttext"> Bought JV ODE recently, Im really liking it, still learning though. if someone can indicate some nice tutorials :).<br>Just a question to VIP3R, I bought the JV ODE without the cd option. If I lose it, is there a way to download again? (just asking because if not, Im gonna record it in CD as soon as possible, even if not anyways)<br><br>cya <br><br></td></tr></table><br>
<a name="1002260"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#134">[#134]</a></td></tr></table></td></tr><tr ><td class="posttext"> There's a link to the only tutorial available in post #122 above ^ (read the paragraph too)<br><br>Sure, if you need to download it again just contact me via email and I'll send you a new download link, you will need to provide proof of purchase. JV-ODE has a small filesize so you could backup to a USB memory stick if preferred. <br><br></td></tr></table><br>
<a name="1002598"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#135">[#135]</a></td></tr></table></td></tr><tr ><td class="posttext"> @VIP3R, just gotta say I've added a van type mesh (of the postman pat variety) to the car instead of the basic cube - and I am amazed at how the physics engine seems to intuitively compensate for the physics of a higher centre of gravity. Merry Christmas VIP3R. <br><br></td></tr></table><br>
<a name="1002619"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#136">[#136]</a></td></tr></table></td></tr><tr ><td class="posttext"> Merry Christmas :) <br><br></td></tr></table><br>
<a name="1003335"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ian Caio</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#137">[#137]</a></td></tr></table></td></tr><tr ><td class="posttext"> Merry Christmas for all,<br><br>Thanks for the feedback VIP3R, I checked this tutorial :)<br>Now Im gonna check some Examples to try to learn more about Joints.<br>Btw, I saw a C Include file in the misc directory, it means I can use it for programs with C/C++ also? Sorry if its a stupid question, I just saw some stuff related to the DLL in the include and for making sure I wanted to ask you.<br><br>Cya <br><br></td></tr></table><br>
<a name="1003433"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#138">[#138]</a></td></tr></table></td></tr><tr ><td class="posttext"> You're welcome :)<br><br>Yes, the C include can be used to access JV-ODE from C/C++. <br><br></td></tr></table><br>
<a name="1003616"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#139">[#139]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmmm<br><br>How can I disable collisions for one body/geom?<br><br>DGeomDisable and DBodyDisable both seem to fail. I call them but immediately the relevant Get functions return true, and the objects continue to collide!? <br><br></td></tr></table><br>
<a name="1003662"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ian Caio</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#140">[#140]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey Cygnus,<br>I have tryied to do some Code with DBodyDisable and DGeomDisable, and what I get is the following:<br>The problem happens when AutoDisable is True. For example, Cube1 falls on Cube2, then you Disable Cube2. If AutoDisable is true it looks like it puts Cube1 on Idle mode, and it just falls in the place of Cube2 when some other force acts over it. If AutoDisable is False, it works ok, because the Body is not set to the Idle mode. I dont know if you get what Im saying, but the code is down here:<br><pre class=code>Graphics3D 1024,768,32,1
SetBuffer BackBuffer()

Include "JV-ODE.bb"

Type Obj
	Field Geom
	Field Body
	Field Mesh
End Type

cam=CreateCamera()
PositionEntity cam,0,20,-20
RotateEntity cam,45,0,0

light=CreateLight()
PositionEntity light,0,10,0

dInitODE()
Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

;dWorldSetAutoDisableFlag(World,1)	;&lt;&lt;&lt; CHANGE FOR TRUE/FALSE TO CHECK WHAT HAPPENS
dWorldSetGravity(World,0,-0.98,0)
dContactSetMu(2)
dContactSetBounce(0.1)

dCreatePlane(Space,0,1,0,0)

Plane=CreatePlane()
EntityTexture Plane,PlaneTexture()

CreateBoxes()

DelayTime=MilliSecs()

While Not KeyHit(1)
	If KeyHit(57) Then
		A.Obj=First Obj
			dGeomDisable(A\Geom)
			dBodyDisable(A\Body)
	EndIf
	
	If KeyHit(28) Then
		CreateBoxes()
	EndIf
	
	UpdateGeoms()
	
	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)
	UpdateWorld()
	RenderWorld()
	Text 0,0,"Press ENTER to add Boxes"
	Text 0,30,"Press SPACE to Disable the Bottom Box"
	Flip
Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()
End

Function CreateBoxes()
	A.Obj=New Obj
		A\Mesh=CreateCube()
			EntityColor A\Mesh,Rnd(255),Rnd(255),Rnd(255)
		A\Body=dBodyCreate(World)
			dBodySetPosition(A\Body,0,10,0)
			dBodySetRotation(A\Body,0,0,0)
;			dBodySetAutoDisableFlag(A\Body,1)  ;&lt;&lt;&lt; CHANGE FOR TRUE/FALSE TO CHECK WHAT HAPPENS
		A\Geom=dCreateBox(Space,2,2,2)
			dGeomSetBody(A\Geom,A\Body)
End Function

Function UpdateGeoms()
	For A.Obj=Each Obj
		PositionEntity A\Mesh,dGeomGetPositionX(A\Geom),dGeomGetPositionY(A\Geom),dGeomGetPositionZ(A\Geom)
		RotateEntity A\Mesh,dGeomGetPitch(A\Geom),dGeomGetYaw(A\Geom),dGeomGetRoll(A\Geom)
	Next
End Function</pre><br><br>But I gotta say Im really new to JV-ODE, so I cant say much. Thats what I think over what I saw. But maybe you can configure something, to make AutoDisable "works" with this.<br><br>Cya<br><br>EDIT:<br>Edited the code, its better to use now. The commands are now also printed on the screen. Note that in this code the AutoDisableFlag is false, but you can (and should) change it to true to check what happens. <br><br></td></tr></table><br>
<a name="1003708"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#141">[#141]</a></td></tr></table></td></tr><tr ><td class="posttext"> Interesting test there, however I don't use autodisable. For me the objects simply do not disable at all.<br><br>I've worked around it by moving the objects into a non colliding space for the period of the disability. :-) Cheers though! <br><br></td></tr></table><br>
<a name="1003726"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#142">[#142]</a></td></tr></table></td></tr><tr ><td class="posttext"> <i>dBodyEnable(body)</i> and <i>dBodyDisable(body)</i> are used to effectively 'play or pause' the forces acting on a body and will have no effect on collisions, not to be confused with the geom equivalent. A new collision with any disabled body will re-enable it. The auto-disable feature in ODE is used exclusively on a body.<br><br><i>dGeomEnable(geom)</i> and <i>dGeomDisable(geom)</i> will enable or disable collisions on a geom and will have no effect on the associated body. I'm not sure what you mean by 'relevant Get functions', you should be using <i>dGeomIsEnabled(geom)</i> to return its state.<br><br>Here's a quick demo showing the dGeomEnable()/dGeomDisable() functions working...<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #                                        JV-ODE Car Demo                                          #
; #                                  Code by Jim Williams (VIP3R)                                   #
; #                              Devious Codeworks - Copyright © 2008                               #
; ###################################################################################################

Include "JV-ODE.bb"

AppTitle "JV-ODE Car Demo"

Graphics3D 800,600,0,2

Global CMass#=200.0				; ### Car Mass
Global WMass#=14.0				; ### Wheel Mass

Global WorldERP#=1.0			; ### World Error Correction
Global WorldFriction#=70.0		; ### World Friction

Global Torque#=24.0				; ### Joint Torque
Global SuspensionHS#=0.01		; ### Suspension Hardness/Softness (Higher=Softer - Lower=Harder)

Global Force#=0.0
Global Steer#=0.0

Global Car
Global CGeom
Global CMesh

Global BlueBlock

Global CarStartY=20

Dim Wheel(4)
Dim WGeom(4)
Dim Joint(4)

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

; ###################################################################################################

; ### Setup ODE

dInitODE()

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,-0.98,0)
dWorldSetERP(World,WorldERP)

dContactSetMode(dContactSlip1)
dContactSetMu(WorldFriction)

; ### Create Car Body

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
Car=ode\body
dBodySetPosition(ode\body,0,CarStartY,0)
dBodySetRotation(ode\body,0,0,0)
mass=dMassCreate()
dMassSetBoxTotal(mass,CMass,3,1,4)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
ode\geom=dCreateBox(Space,3,1,4)
CGeom=ode\geom
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
CMesh=ode\mesh
ScaleMesh ode\mesh,1.5,0.5,2
EntityColor ode\mesh,40,80,255

; ### Create Wheels

For count=1 To 4
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	Wheel(count)=ode\body
	dBodySetPosition(ode\body,0,0,0)
	dBodySetRotation(ode\body,0,0,90)
	mass=dMassCreate()
	dMassSetSphereTotal(mass,WMass,0.7)
	dBodySetMass(ode\body,mass)
	dMassDestroy(mass)
	ode\geom=dCreateSphere(Space,0.7)
	WGeom(count)=ode\geom
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder()
	ScaleMesh ode\mesh,0.7,0.25,0.7
	EntityColor ode\mesh,255,255,255
Next

dBodySetPosition(Wheel(1),-2,CarStartY-0.5,+2)
dBodySetPosition(Wheel(2),+2,CarStartY-0.5,+2)
dBodySetPosition(Wheel(3),-2,CarStartY-0.5,-2)
dBodySetPosition(Wheel(4),+2,CarStartY-0.5,-2)

; ### Create Light

Global Light=CreateLight()
RotateEntity Light,50,-50,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create Camera

Global CameraPivot=CreatePivot()

Global Camera=CreateCamera(CameraPivot)
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000

; ### Create Plane

dCreatePlane(Space,0,1,0,0)

Global Plane=CreatePlane()
EntityAlpha Plane,0.8

EntityTexture Plane,PlaneTexture()

CreateMirror()

; ###################################################################################################

; ### Blitz3D Static Object (White)

Global Blitz3DObject=CreateCube()
ScaleMesh Blitz3DObject,1,4,20
PositionEntity Blitz3DObject,10,5,40
RotateEntity Blitz3DObject,-10,8,4
EntityColor Blitz3DObject,255,255,255

; ### ODE Static Object (Blue)

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,2,8,40)
BlueBlock=ode\geom
dGeomSetPosition(ode\geom,20,5,40)
dGeomSetRotation(ode\geom,-10,8,4)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,1,4,20
EntityColor ode\mesh,0,100,200

; ### ODE Static Object (Red)

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,18,0.2,40)
dGeomSetPosition(ode\geom,-20,4.9,40)
dGeomSetRotation(ode\geom,-14,0,0)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,9,0.1,20
EntityColor ode\mesh,200,0,100

; ###################################################################################################

SetupCar()

While Not KeyHit(1)

	UpdateKeys()

	UpdateCar()

	UpdateGeoms()

	PTime=MilliSecs()

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)

	PhysicsTime#=MilliSecs()-PTime

	UpdateCam()

	RenderWorld

	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime
	Text 0,50,"Force:"+Force
	Text 0,65,"Torque:"+Torque
	Text 0,100,"F1 - Enable Blue Block Geom"
	Text 0,120,"F2 - Disable Blue Block Geom"

	If dGeomIsEnabled(BlueBlock)=1
		Text 0,160,"Blue Block Collisions: ENABLED"
		Else
		Text 0,160,"Blue Block Collisions: DISABLED"
		End If

	Text 640,0,"A - Accelerate"
	Text 640,15,"Z - Brake/Reverse"
	Text 640,30,"Arrows - Steering"
	Text 640,45,"Space - Reset Car"

	Flip 1

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function SetupCar()

For count=1 To 4
	Joint(count)=dJointCreateHinge2(World,0)
	dJointAttach(Joint(count),Car,Wheel(count))
	dJointSetHinge2Anchor(Joint(count),dBodyGetPositionX(Wheel(count)),dBodyGetPositionY(Wheel(count)),dBodyGetPositionZ(Wheel(count)))
	dJointSetHinge2Axis1(Joint(count),0,1,0)
	dJointSetHinge2Axis2(Joint(count),-1,0,0)
	dJointSetHinge2Param(Joint(count),dParamSuspensionERP,0.8)
	dJointSetHinge2Param(Joint(count),dParamSuspensionCFM,SuspensionHS)
	If count&gt;2
		dJointSetHinge2Param(Joint(count),dParamLoStop,0)
		dJointSetHinge2Param(Joint(count),dParamHiStop,0)
		End If
Next

End Function

; ###################################################################################################

Function UpdateKeys()

If KeyDown(30)=1
	Force=Force+0.08
	If Force&gt;30 Then Force=30
	End If

If KeyDown(44)=1
	Force=Force-0.1
	If Force&lt;-10 Then Force=-10
	If Force&gt;0 Then Force=Force*0.97
	End If

If KeyDown(30)=0 And KeyDown(44)=0 Then Force=Force*0.99

If KeyDown(203)=1 Or KeyDown(205)=1
	If KeyDown(203)=1
		Steer=0.5
		Else
		Steer=-0.5
		End If
	Else
	Steer=0.0
	End If

If KeyHit(57)=1
	Force=0.0
	dBodySetRotation(Car,dGeomGetPitch(CGeom),dGeomGetYaw(CGeom),0)
	End If

If KeyHit(59)=1 Then dGeomEnable(BlueBlock)
If KeyHit(60)=1 Then dGeomDisable(BlueBlock)

End Function

; ###################################################################################################

Function UpdateCar()

For count=1 To 4
	dBodyEnable(Wheel(count))
Next

dBodyEnable(Car)

For count=1 To 4
	dJointSetHinge2Param(Joint(count),dParamVel2,Force)
	dJointSetHinge2Param(Joint(count),dParamFMax2,Torque)
Next

For count=1 To 2
	angle#=Steer-dJointGetHinge2Angle1(Joint(count))
	dJointSetHinge2Param(Joint(count),dParamVel,angle)
	dJointSetHinge2Param(Joint(count),dParamFMax,400)
Next

End Function

; ###################################################################################################

Function UpdateCam()

PositionEntity Camera,0,3,-12

PivotX#=Cos(EntityYaw(CMesh)-90)+EntityX(CMesh)
PivotY#=EntityY(CMesh)
PivotZ#=Sin(EntityYaw(CMesh)-90)+EntityZ(CMesh)

PositionEntity CameraPivot,PivotX,PivotY,PivotZ

PointEntity CameraPivot,CMesh

End Function

; ###################################################################################################

Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
	PositionEntity ode\mesh,dGeomGetPositionX(ode\geom),dGeomGetPositionY(ode\geom),dGeomGetPositionZ(ode\geom)
	RotateEntity ode\mesh,dGeomGetPitch(ode\geom),dGeomGetYaw(ode\geom),dGeomGetRoll(ode\geom)
Next

End Function

; ###################################################################################################
</textarea><br><br>@ian caio: The reason your boxes don't fall when disabling collisions on the lowest box with the auto-disable feature active is because the bodies of all boxes have come to a rest and have auto-disabled, thus are not affected by forces like gravity etc, so that's normal behaviour. <br><br></td></tr></table><br>
<a name="1003740"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Santiworld</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#143">[#143]</a></td></tr></table></td></tr><tr ><td class="posttext"> i only wanted to let you know that I'm the former Latatoy user, I'm no longer working for Latatoy SRL, so, i changed my username in blitz because I'm going to program games on my own.<br><br>how can i change my email adreess to recive the future ode updates?<br><br>regards, Santiago. <br><br></td></tr></table><br>
<a name="1003755"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ian Caio</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#144">[#144]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Cygnus<br><br>Yeah, that works too, but I guess using dGeomDisable() is better because if you have a function that updates the mesh to the geometry it would be more complicated to make it work with this method (you would have to check if its unabled, to then put the mesh in position)<br><br>@VIP3R<br><br>Thats was what I though. But is there a way to make it stop resting manually? (is it using dbodyenable, dgeomenable?)<br><br>EDIT:<br>Forgot to tell you about it. I dont know if its my documentation only, but the internal links inside it doesnt look to work (except for external ones). <br><br></td></tr></table><br>
<a name="1003822"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#145">[#145]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Santiworld: You can email me to update your address, if you're emailing from a different email account to the one you have registered for JV-ODE, you will need to provide some proof of purchase.<br><br>@ian caio: If a body is disabled you can call <i>dBodyEnable()</i> to re-enable it. It will re-disable though if auto-disable is active and no further collisions have occurred. To make it stay enabled, either disable the auto-disable on the body with <i>dBodySetAutoDisableFlag(body,0)</i>, or call <i>dBodyEnable()</i> on the body every iteration.<br><br>The doc links work fine here and it passes W3C validation, what browser are you using? <br><br></td></tr></table><br>
<a name="1003863"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#146">[#146]</a></td></tr></table></td></tr><tr ><td class="posttext"> ~Vip3r, yeah, but for me even using geomdisable fails to disable collisions. The way i've written the code though, simply changing the space of the object works fine. I won't worry about how i've managed to break the above function for now ;-)<br><br>Racer demo here- uses JVODE now. I finally, FINALLY moved it over. <a href="http://damiensturdy.servegame.org/downloads/RACER_29_12_09.rar" target="_blank">http://damiensturdy.servegame.org/downloads/RACER_29_12_09.rar</a><br><br>See how there are WAY more than 8 cars now ;-) <br><br></td></tr></table><br>
<a name="1003951"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ian Caio</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#147">[#147]</a></td></tr></table></td></tr><tr ><td class="posttext"> VIP3R,<br>I use Mozilla Firefox 3.0.16.<br>Wierd is that now that I readed your answer, I tried it on Internet Explorer, it worked.<br>Maybe I will update Firefox and test again (because I had a few troubles with the latest Firefox update, so I came back to a older version), but its still wierd ^^. At least I found out it was not any problems with the file.<br><br>Cygnus,<br>Have tested your game, it looks good, just lags a little bit here (maybe because Im testing in a notebook). <br><br></td></tr></table><br>
<a name="1004000"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#148">[#148]</a></td></tr></table></td></tr><tr ><td class="posttext"> ian-<br><br>Yep, I've pushed my laptop to its limits running the game. Eventually I'll be porting it to the iPhone but I just want my algos down first. It's the rendering that does it, turn off rendering and I get upwards of 200fps where I was getting 30 when rendering. Shame that B3D has some bottlenecks at the rendering side of things!<br><br>Cheers for testing. If you have any thoughts on it let me know :-) <br><br></td></tr></table><br>
<a name="1004041"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kev</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#149">[#149]</a></td></tr></table></td></tr><tr ><td class="posttext"> im thinking of buying but before i do is there any tutorials on how to use it as the demo version is very basic<br><br>kev <br><br></td></tr></table><br>
<a name="1004244"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#150">[#150]</a></td></tr></table></td></tr><tr ><td class="posttext"> The ODE Wiki and official user guide are good sources of information, but not quite tutorials, you can find links in the top post of this thread.<br><br>There's an old tutorial made by Shifty Geezer available <a href="http://www.devcode.co.uk/misc/ODE-Tutorial.pdf" target="_blank">here</a>, to run the example the code will need to be modified. For instance the example uses the old include file name 'ode.bb' in places, it needs to be 'JV-ODE.bb'.<br><br>Lots of useful info is contained within the JV-ODE threads here too, so a quick search of those can help with anything specific. <br><br></td></tr></table><br>
<a name="1004264"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kev</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#151">[#151]</a></td></tr></table></td></tr><tr ><td class="posttext"> thanks VIP3R, Shifty Geezer tutorial is just what i was looking for now time to do some reading and seaching the JV-ODE threads.<br><br>thanks<br>kev <br><br></td></tr></table><br>
<a name="1004631"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Chroma</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#152">[#152]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah I bought this over a year ago I believe and still haven't used it.  I didn't know about that Shifty Geezer tutorial.  That's really what this was lacking.  Thanks Kev for the link. <br><br></td></tr></table><br>
<a name="1004960"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#153">[#153]</a></td></tr></table></td></tr><tr ><td class="posttext"> OK, it's really winding me up now.<br><br>Any clues on how best to manually generate meshes suited to trimesh use?<br><br>I've got an awesome dirt track gen but the meshes just won't work with ODE at all, i've tried flipping tris etc, but even if I clone the mesh, flip it and re-add the clone to the original (thus duplicating triangles to remove non colliding sides) the objects will still pass through.<br><br>I'm scratching my head bigtime, My bald patch is coming back ;-) <br><br></td></tr></table><br>
<a name="1005014"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#154">[#154]</a></td></tr></table></td></tr><tr ><td class="posttext"> Would you post a link to your mesh so we may see it? <br><br></td></tr></table><br>
<a name="1005038"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#155">[#155]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yep, post a link or send the mesh via email and I'll take a look too.<br><br>It's most likely incorrect vert/indice ordering. Can you post/send the mesh generation code too? <br><br></td></tr></table><br>
<a name="1005086"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#156">[#156]</a></td></tr></table></td></tr><tr ><td class="posttext"> OK- I will portablise the generation code. It's a BIG mess mind. i was getting wound up last night as the Monster Truck mode relies on this mesh generation and it's a bug big enough to cause problems in porting.<br><br>I've tried re-ordering the indices (ensuring every poly is clockwise) to no avail whatsoever, so i'm scratching my head as to what the rules are.<br><br>Hell, for the sake of trying to remove the issue I overrid the blitz addtri function and made it add the same tri every which way possible. Obviously that introduced a few other glitches and slowdowns but at the same point in the track it still causes the sim to explode.<br><br>Anyway, cheers- I'll get the code over. As I say it's old and untidy, so I'm not sure if it'll be clear how it's working anymore. <br><br></td></tr></table><br>
<a name="1005107"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#157">[#157]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm, strange. Something else you can try, create a bank containing the normals and add it to the CreateTriMesh() function with...<br><br><i>dGeomTriMeshDataBuildSingle1(trimeshdata,vertices*,vtxstride,vtxcount,indices*,idxcount,tristride,normals*)</i><br><br>It's identical to the existing function except for the normals parameter. <br><br></td></tr></table><br>
<a name="1005269"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#158">[#158]</a></td></tr></table></td></tr><tr ><td class="posttext"> Tried that :-)<br><br>I've taken a break from that bug for now, there were more pressing issues, however I will try to get the code up for you to take a look at so I can get it resolved quickly. i hope i don't have to rewrite the gen function! ;-) <br><br></td></tr></table><br>
<a name="1005560"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kev</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#159">[#159]</a></td></tr></table></td></tr><tr ><td class="posttext"> got this now and just started playing with it just checking the latest version is V132 can anyone confirm. <br><br></td></tr></table><br>
<a name="1005664"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#160">[#160]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yep, V1.32 is the latest version. <br><br></td></tr></table><br>
<a name="1005695"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kev</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#161">[#161]</a></td></tr></table></td></tr><tr ><td class="posttext"> thanks VIP3R<br><br>quick question as im here, ive created some very small example to learn how everything is setup. right now i have 2 boxes falling onto a ledge and then of the legde onto the floor.<br><br>this works great so i added bounce to the legde using its geom like so<br><br>dGeomContactSetBounce shelf\geom,3<br><br>now this does not work on its own i needed to add the following <br><br>dContactSetMode dContactBounce<br>dContactSetMu(WorldFriction)<br><br>now the question is why? say for example i wanted to have multi geom affects like bounce and slide but dContactSetMode  is set to bounce<br><br>anyway it realy is a great library and im only just beging with it, im looking forward to the coming week with this<br><br>kev <br><br></td></tr></table><br>
<a name="1005767"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#162">[#162]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the kind compliments Kev :)<br><br>Here's some info about the contact settings...<br><br>The standard contact functions (<i>dContactSetMode(mode)</i> etc) are global so they will affect all geoms in the simulation (unless they have geom contacts applied). You need to apply the standard contact settings regardless of whether you use the geom contact functions.<br><br>The geom contact functions (<i>dGeomContactSetMode(geom,mode)</i> etc) are for use on individual geoms. If the geom contact settings are not used, JV-ODE will apply the standard contact settings to the geom.<br><br>When using geom contacts, you need to specify the contact mode with <i>dGeomContactSetMode(geom,mode)</i> rather than <i>dContactSetMode(mode)</i>. This will allow you to apply any mode to any geom.<br><br>The contact values behave like a bit flag. You need to add the contact modes together like so...<br><br><i>dGeomContactSetMode(geom,dContactBounce+dContactSlip1+dContactSoftERP)</i><br><br>To see geom contacts in action, have a look at the 'Demo-GeomBounce' and 'Demo-GeomFriction' demos, they show geom contacts being used to apply different bounce and friction values to individual objects. <br><br></td></tr></table><br>
<a name="1005774"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kev</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#163">[#163]</a></td></tr></table></td></tr><tr ><td class="posttext"> thanks for that VIP3R, its all becoming clearer. i just missed that command from the docs after more playing i decoverd just what you said and that then lead me to look at the dbody functions and now i can fire a projectile.<br><br>it realy is starting to fit together much more now, one thing im un-sure about would be the best method to create JV-ODE objects either before hand and have them disabled or on the fly to be used and then destroyed, this is somthing i shall look at soon. <br><br>kev <br><br></td></tr></table><br>
<a name="1006841"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Aussie</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#164">[#164]</a></td></tr></table></td></tr><tr ><td class="posttext"> Gday all  i have been playing around with JV-ODE &amp; have set up a world where the level moves &amp; a ball rolls around the level.<br><br>I have run into problems with the ball falling through a trimesh (the level) when the level is moved quickly. I am not sure if i have set the trimesh up properly. If someone could take a look at the code &amp; see whats happening it would be much apreciated.<br><br>Cheers. :)<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Include "JV-ODE.bb"

Graphics3D 800,600,0,2

HidePointer

Global ODE_World = dWorldCreate()
Global ODE_Space = dHashSpaceCreate(0)
Global ODE_ContactGroup = dJointGroupCreate(0)

dInitODE()

dWorldSetAutoDisableFlag(ODE_World,1)					;turn on auto disable
dWorldSetGravity(ODE_World,0,-.98,0)						;gravity in m/s/s
dWorldSetERP(ODE_World,.1)								;global error corection
dContactSetMode(dContactBounce)
dContactSetBounce(0.0)
dContactSetMu(40)

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Global texture

texture=CreateTexture(16,16)

	SetBuffer TextureBuffer(texture)

	Color 255,255,255
	Rect 0,0,16,16,1
	
	Color 255,0,0
	Rect 0,0,8,8,1
	Rect 8,8,8,8,1

	ScaleTexture texture,0.1,0.1
SetBuffer BackBuffer()
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

light1 = CreateLight()
	RotateEntity light1,90,0,0
AmbientLight 100,100,100

camera = CreateCamera()
	PositionEntity camera,0,20,0
	

Global lev = LoadMesh("tilttrih2.b3d"): HideEntity(lev)
	

obj.ODEGeom = New ODEGeom
	obj\body = dBodyCreate(ODE_World)
		dBodySetRotation(obj\body,0,0,0)
		dBodySetPosition(obj\body,0,5,0)
		mass=dMassCreate()
		dMassSetSphereTotal(mass,200,0.8)
		dBodySetMass(obj\body,mass)
		dMassDestroy(mass)
		dBodySetAutoDisableFlag(obj\body,0)
	obj\geom = dCreateSphere(ODE_Space,.45)
		dGeomSetBody(obj\geom,obj\body)
		
	obj\mesh = CreateSphere(50)
		ScaleEntity obj\mesh,.49,.49,.49
		
		EntityTexture obj\mesh,texture
	
level.ODEGeom = New ODEGeom
	level\geom = createtrimesh(ODE_Space,lev)
	
	level\mesh = CopyEntity(lev)
	
			
PointEntity camera,level\mesh


;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;Main Loop;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
While Not KeyHit(1)

update_geoms()

	mxspd#=MouseXSpeed()*.01
	myspd#=MouseYSpeed()*.01
		
	MoveMouse 400, 300
	
	mpitch# = mpitch#-myspd#
	If mpitch&lt;-2.5 Then mpitch=-2.5
	If mpitch&gt;2.5 Then mpitch=2.5
	mroll# = mroll#-mxspd#
	If mroll &lt;-2.5 Then mroll=-2.5
	If mroll &gt;2.5 Then mroll=2.5
	RotateEntity level\mesh,mpitch,0,mroll
	dGeomSetRotation(level\geom,EntityPitch#(level\mesh),0,EntityRoll#(level\mesh))
	
	; Perform collisions, supplyiong the world, space &amp; collision data
	dSpaceCollide(ODE_Space,ODE_World,ODE_ContactGroup)
	
	; Advance the simulation
	dWorldQuickStep(ODE_World,0.07)
	
	; Clear collision data
	dJointGroupEmpty(ODE_Contactgroup)
	
UpdateWorld()
RenderWorld()

Flip

Wend

dJointGroupDestroy(ODE_ContactGroup)
dSpaceDestroy(ODE_Space)
dWorldDestroy(ODE_World)
dCloseODE()

End

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

Function update_geoms()
For ode.ODEGeom = Each ODEGeom
		If ode\body
			If dBodyIsEnabled(ode\body)
			RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
			PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
		End If
	End If
Next
End Function
</textarea> <br><br></td></tr></table><br>
<a name="1006873"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#165">[#165]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm, the problem there is you're manually rotating the TriMesh geom. As you've discovered, the result is collision penetration. In ODE you can't position or rotate an object manually once the simulation has started, you can only apply forces to the object.<br><br>The correct method would be to add a body to the TriMesh object, disable gravity on the body, attach a static ball joint between the body and the ODE world, then apply a force at the edges of the TriMesh body to move it up/down. Using a composite object made up from several primitives (cubes etc) instead of a TriMesh would be best if possible.<br><br>Adding a body and disabling the gravity (<i>dBodySetGravityMode(body,0)</i>) is easy enough. The rope and iceberg demos show how to attach a ball joint between a body and the world. Then you just need to decide how you want to add force to the platform, there are various force functions available...<br><i><br>dBodyAddForce(body,fx#,fy#,fz#)<br>dBodyAddTorque(body,fx#,fy#,fz#)<br>dBodyAddRelForce(body,fx#,fy#,fz#)<br>dBodyAddRelTorque(body,fx#,fy#,fz#)<br>dBodyAddForceAtPos(body,fx#,fy#,fz#,px#,py#,pz#)<br>dBodyAddForceAtRelPos(body,fx#,fy#,fz#,px#,py#,pz#)<br>dBodyAddRelForceAtPos(body,fx#,fy#,fz#,px#,py#,pz#)<br>dBodyAddRelForceAtRelPos(body,fx#,fy#,fz#,px#,py#,pz#)<br></i><br>If you get stuck let me know. <br><br></td></tr></table><br>
<a name="1006980"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Aussie</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#166">[#166]</a></td></tr></table></td></tr><tr ><td class="posttext"> Cheers VIP3R<br><br>I think i have set up the level &amp; joint correctly.<br><pre class=code>
level.ODEGeom = New ODEGeom
	level\body = dBodyCreate(ODE_World)
		dBodySetRotation(level\body,0,0,0)
		dBodySetPosition(level\body,0,0,0)
		dBodySetGravityMode(level\body,0)
	level\geom = createtrimesh(ODE_Space,lev)
		dGeomSetBody(level\geom,level\body)
	level\mesh = CopyEntity(lev)
	
	joint = dJointCreateBall(ODE_World,0)
		dJointAttach(joint,0,level\body)
		dJointSetBallAnchor(joint),0,0,0 
</pre><br>However now if i position the ball on the level, the level reacts to where the ball is &amp; i am trying to make it so the ball reacts to the rotation of the level.<br><br>I am having a bit of trouble with applying force to the level &amp; i end up with the level spinning around. Is there a way to limit the rotation of a joint? <br><br></td></tr></table><br>
<a name="1007064"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#167">[#167]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>However now if i position the ball on the level, the level reacts to where the ball is &amp; i am trying to make it so the ball reacts to the rotation of the level.<br> <br></div><br>The mass of the platform is too small compared to the mass of the ball, adding plenty of mass to the platform will correct it.<br><br><div class="quote"> <br>I am having a bit of trouble with applying force to the level &amp; i end up with the level spinning around. Is there a way to limit the rotation of a joint?<br> <br></div><br>It's odd but there isn't a way to lock an axis on the ball joint. In most of the other joints you can lock an axis. However, in this case we can cheat and do something I just told you not to do  ;)<br><br>You can force the platform Y-Axis to stay at zero rotation. It won't matter here because we're still keeping the axis at its starting position, rather than moving it.<br><br>Here's some code showing a tilting platform with spheres using the above methods...<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #                                  JV-ODE - Platform Tilt Demo                                    #
; #                                  Code by Jim Williams (VIP3R)                                   #
; #                              Devious Codeworks - Copyright © 2008                               #
; ###################################################################################################

Include "JV-ODE.bb"

AppTitle "JV-ODE - Platform Tilt Demo"

Graphics3D 800,600,0,2

Global PlatformBody

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

; ###################################################################################################

; ### Setup ODE

dInitODE()

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,-0.98,0)
dContactSetMode(dContactBounce)
dContactSetBounce(0.0)
dContactSetMu(48)

; ### Create Light

Global Light=CreateLight()
RotateEntity Light,50,-50,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create Camera

Global Camera=CreateCamera()
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000
PositionEntity Camera,0,20,-30
RotateEntity Camera,30,0,0

; ### Create Plane

dCreatePlane(Space,0,1,0,0)

Global Plane=CreatePlane()
EntityAlpha Plane,0.8

EntityTexture Plane,PlaneTexture()

CreateMirror()

; ### Platform

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
PlatformBody=ode\body
dBodySetPosition(ode\body,0,10,0)
dBodySetRotation(ode\body,0,0,0)
dBodySetAutoDisableFlag(ode\body,0)

mass=dMassCreate()
dMassSetBoxTotal(mass,3000,40,1,40)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)

ode\geom=dCreateBox(Space,40,1,40)
dGeomSetBody(ode\geom,ode\body)

ode\mesh=CreateCube()
ScaleMesh ode\mesh,20,0.5,20
EntityColor ode\mesh,0,100,200

; ### Ball Joint

BJoint=dJointCreateBall(World,0)
dJointAttach(BJoint,0,PlatformBody)
dJointSetBallAnchor(BJoint,0,10,0)

; ###################################################################################################

While Not KeyHit(1)

	If MilliSecs()-Timer&gt;700
		AddObject()
		Timer=MilliSecs()
		End If

	UpdateKeys()

	UpdateGeoms()

	PTime=MilliSecs()

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)

	PhysicsTime#=MilliSecs()-PTime

	RenderWorld

	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime
	Text 620,0,"Add Force To Platform"
	Text 620,15,"Using Arrow Keys"

	Flip 1

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function AddObject()

xp#=Rand(-8,8)
zp#=Rand(-8,8)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
dBodySetPosition(ode\body,xp,30,zp)
dBodySetRotation(ode\body,0,0,0)
dBodySetAutoDisableFlag(ode\body,1)
ode\geom=dCreateSphere(Space,1)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateSphere()
ScaleMesh ode\mesh,1,1,1
EntityColor ode\mesh,Rand(0,255),Rand(0,255),Rand(0,255)
EntityShininess ode\mesh,0.7

End Function

; ###################################################################################################

Function UpdateKeys()

If KeyDown(200) Then dBodyAddForceAtRelPos(PlatformBody,0,100,0,0,0,-20)
If KeyDown(208) Then dBodyAddForceAtRelPos(PlatformBody,0,100,0,0,0,20)
If KeyDown(203) Then dBodyAddForceAtRelPos(PlatformBody,0,100,0,20,0,0)
If KeyDown(205) Then dBodyAddForceAtRelPos(PlatformBody,0,100,0,-20,0,0)

; ### Zero Y-Axis To Prevent Spinning

dBodySetRotation(PlatformBody,dBodyGetPitch(PlatformBody),0,dBodyGetRoll(PlatformBody))

End Function

; ###################################################################################################

Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
	PositionEntity ode\mesh,dGeomGetPositionX(ode\geom),dGeomGetPositionY(ode\geom),dGeomGetPositionZ(ode\geom)
	RotateEntity ode\mesh,dGeomGetPitch(ode\geom),dGeomGetYaw(ode\geom),dGeomGetRoll(ode\geom)
Next

End Function

; ###################################################################################################
</textarea> <br><br></td></tr></table><br>
<a name="1007229"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Aussie</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#168">[#168]</a></td></tr></table></td></tr><tr ><td class="posttext"> Cool!!!!<br><br>That was exactly what i was trying to achive.<br><br>Thanks heaps. The help is much apreciated. :)<br><br>P.S cheers for the email to let me know. <br><br></td></tr></table><br>
<a name="1007339"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#169">[#169]</a></td></tr></table></td></tr><tr ><td class="posttext"> So, when we jumping to thread 14 then VIP3R?<br><br>lovely platform tilt demo by the way! <br><br></td></tr></table><br>
<a name="1007353"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#170">[#170]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks BP :)<br><br>Maybe when the post count is 180+ I'll create the next thread (unless a mod requests it early). It'll be thread 13 though, this one is 12.<br><br>@Aussie: You're welcome :) <br><br></td></tr></table><br>
<a name="1007358"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#171">[#171]</a></td></tr></table></td></tr><tr ><td class="posttext"> Dang, don't have latest version. I'd better go double check. <br><br></td></tr></table><br>
<a name="1007556"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#172">[#172]</a></td></tr></table></td></tr><tr ><td class="posttext"> Large timer value causes balls not to drop !! <br><br>Worked at home after reboot, but failed at work with machine that runs 24x7.<br><br>Timer value when it fails is like: -1309763702<br><br>The following corrected it:<br><br>	If Abs(Abs(MilliSecs())-Abs(Timer))&gt;700<br>	<br>		AddObject()<br>		Timer=MilliSecs()<br><br>	End If <br><br></td></tr></table><br>
<a name="1007572"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#173">[#173]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's not a bug it's a feature, to intentionally confuse those who waste precious energy resources by leaving their computers on 24/7 :P<br><br>It is interesting though, thanks for providing a fix Wayne. <br><br></td></tr></table><br>
<a name="1009853"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#174">[#174]</a></td></tr></table></td></tr><tr ><td class="posttext"> Textured the wheels on my Postman Plat (a bit like the original but he has plats) racer.  I want to invoke an analogue style gauge reflecting the speed on a HUD kind of principle next with respect to each of the postman plat vans. I don't think postman plat had missile launchers though... <br><br></td></tr></table><br>
<a name="1009856"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >OJay</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#175">[#175]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> It's not a bug it's a feature, to intentionally confuse those who waste precious energy resources by leaving their computers on 24/7 :P <br></div><br>OT: just as a side note: if you use hibernate, the system up timer also never resets... ;) <br><br></td></tr></table><br>
<a name="1012727"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ian Caio</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#176">[#176]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey all,<br><br>These days I have tryied to do a little demo, that basic one, that builds a tower with cubes. It has a input that asks for the height of the Tower (higher &gt; more cubes), and the problem was that when the number was too high there was a StackOverflow on the dWorldQuickStep command. I have tested it more now, and the number of cubes for that happen is not really a constant. Right now I could make a 200 height tower. But before I had overflows with only 70. I have searched a little bit on google but the only thing I found was that if I was having stack overflow problems with dWorldStep I should use dWorldQuickStep (which Im already using). Is there a way to solve this problem?<br><br>Here is the code:<br><br><pre class=code>
Include "JV-ODE.bb"

Graphics3D 1024,768,32,1
SetBuffer BackBuffer()

dInitODE()

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,True)

dWorldSetGravity(World,0,-1,0)
dContactSetMu(80)

Cam=CreateCamera()
PositionEntity Cam,0,5,-20

light=CreateLight()
PositionEntity light,0,10,0

Global Height

Height=Input("Tower Height:")

Dim Cubo(Height*4)
Dim CuboGeom(Height*4)
Dim CuboBody(Height*4)

Plane=CreatePlane()

dCreatePlane(Space,0,1,0,0)
EntityTexture Plane,PlaneTexture()

Counter=0	

For x=1 To Height*4 Step 4
	Cubo(x)=CreateCube()
		ScaleEntity Cubo(x),0.5,0.5,5	
	CuboBody(x)=dBodyCreate(World)	
	CuboGeom(x)=dCreateBox(Space,1,1,10)	
	dGeomSetBody(CuboGeom(x),CuboBody(x))
		dBodySetPosition(CuboBody(x),-3,0.5+(Counter*2),0)
	dGeomContactSetMu(CuboGeom(x),100)
	
	Cubo(x+1)=CreateCube()
		ScaleEntity Cubo(x+1),0.5,0.5,5	
	CuboBody(x+1)=dBodyCreate(World)	
	CuboGeom(x+1)=dCreateBox(Space,1,1,10)	
	dGeomSetBody(CuboGeom(x+1),CuboBody(x+1))
		dBodySetPosition(CuboBody(x+1),3,0.5+(Counter*2),0)
	dGeomContactSetMu(CuboGeom(x+1),100)
	
	Cubo(x+2)=CreateCube()
		ScaleEntity Cubo(x+2),5,0.5,0.5	
	CuboBody(x+2)=dBodyCreate(World)	
	CuboGeom(x+2)=dCreateBox(Space,10,1,1)	
	dGeomSetBody(CuboGeom(x+2),CuboBody(x+2))
		dBodySetPosition(CuboBody(x+2),0,2+(Counter*2),-3)
	dGeomContactSetMu(CuboGeom(x+2),100)

	Cubo(x+3)=CreateCube()
		ScaleEntity Cubo(x+3),5,0.5,0.5	
	CuboBody(x+3)=dBodyCreate(World)	
	CuboGeom(x+3)=dCreateBox(Space,10,1,1)	
	dGeomSetBody(CuboGeom(x+3),CuboBody(x+3))
		dBodySetPosition(CuboBody(x+3),0,2+(Counter*2),3)
	dGeomContactSetMu(CuboGeom(x+3),100)
	
	Counter=Counter+1
Next

	UpdateCubes()
	
While Not KeyHit(1)
	
	If KeyHit(57) Then
		For x=1 To Height*4
			dBodyAddForce(CuboBody(x),Rnd(-50,50),Rnd(-50,50),Rnd(-50,50))
		Next
	EndIf
	
	If KeyDown(200) Then
	MoveEntity cam,0,0,1
	EndIf
	If KeyDown(208) Then
	MoveEntity cam,0,0,-1
	EndIf
	If KeyDown(203) Then
	MoveEntity cam,-1,0,0
	EndIf
	If KeyDown(205) Then
	MoveEntity cam,1,0,0
	EndIf
	If KeyDown(30) Then
	MoveEntity cam,0,1,0
	EndIf
	If KeyDown(44) Then
	MoveEntity cam,0,-1,0
	EndIf
	
	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)
	
	UpdateCubes()
	
	UpdateWorld()
	RenderWorld()
	Flip
Wend

dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()
End

Function UpdateCubes()
	For x=1 To Height*4
		PositionEntity Cubo(x),dGeomGetPositionX(CuboGeom(x)),dGeomGetPositionY(CuboGeom(x)),dGeomGetPositionZ(CuboGeom(x))
		RotateEntity Cubo(x),dGeomGetPitch(CuboGeom(x)),dGeomGetYaw(CuboGeom(x)),dGeomGetRoll(CuboGeom(x))
	Next
End Function
</pre><br><br>Seens like the problem happens when there are many collisions.<br><br>Cya <br><br></td></tr></table><br>
<a name="1012745"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#177">[#177]</a></td></tr></table></td></tr><tr ><td class="posttext"> .. <br><br></td></tr></table><br>
<a name="1012746"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#178">[#178]</a></td></tr></table></td></tr><tr ><td class="posttext"> The stack overflow is usually caused by too many objects overlapping when they are created or added, resulting in too many collision contacts being generated. You can recreate the error in many of the JV-ODE demos by increasing frequency of the AddObject() calls.<br><br>The solution is too make sure the objects don't overlap any other objects when creating or adding them. For stacked objects, make sure to leave a very tiny gap between them. <br><br></td></tr></table><br>
<a name="1012858"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ian Caio</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#179">[#179]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the answers (:<br><br>Wayne,<br>Have tryied your code, with 130 it seens to work fine, over it the stack overflow happens again. What exactly did you do to make it work with higher values? I have seen the AutoDisable configuration you did there, but I didnt really understood why it all worked.<br><br>VIP3R,<br>I have tryied to make a gap between the cubes, I can do until 500 Height towers (about 600/700 the program closes before it starts ^^), the problem is that when they start falling, they start overlapping each other and then the Stack Overflow happens again. Is there a way to avoid this? I have thought about ERP, but I dont really know how to use it well.<br><br>Heres the code with the little gap between the objects:<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Include "JV-ODE.bb"

Graphics3D 1024,768,32,1
SetBuffer BackBuffer()

dInitODE()

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,True)

dWorldSetGravity(World,0,-1,0)
dContactSetMu(80)

Cam=CreateCamera()
PositionEntity Cam,0,5,-20

light=CreateLight()
PositionEntity light,0,10,0

Global Height

Height=Input("Tower Height:")

Dim Cubo(Height*4)
Dim CuboGeom(Height*4)
Dim CuboBody(Height*4)

Plane=CreatePlane()

dCreatePlane(Space,0,1,0,0)
EntityTexture Plane,PlaneTexture()

Counter=0	

For x=1 To Height*4 Step 4
	Cubo(x)=CreateCube()
		ScaleEntity Cubo(x),0.5,0.5,5	
	CuboBody(x)=dBodyCreate(World)	
	CuboGeom(x)=dCreateBox(Space,1,1,10)	
	dGeomSetBody(CuboGeom(x),CuboBody(x))
		dBodySetPosition(CuboBody(x),-3,0.5+(Counter*3),0)
	dGeomContactSetMu(CuboGeom(x),100)
	
	Cubo(x+1)=CreateCube()
		ScaleEntity Cubo(x+1),0.5,0.5,5	
	CuboBody(x+1)=dBodyCreate(World)	
	CuboGeom(x+1)=dCreateBox(Space,1,1,10)	
	dGeomSetBody(CuboGeom(x+1),CuboBody(x+1))
		dBodySetPosition(CuboBody(x+1),3,0.5+(Counter*3),0)
	dGeomContactSetMu(CuboGeom(x+1),100)
	
	Cubo(x+2)=CreateCube()
		ScaleEntity Cubo(x+2),5,0.5,0.5	
	CuboBody(x+2)=dBodyCreate(World)	
	CuboGeom(x+2)=dCreateBox(Space,10,1,1)	
	dGeomSetBody(CuboGeom(x+2),CuboBody(x+2))
		dBodySetPosition(CuboBody(x+2),0,3+(Counter*3),-3)
	dGeomContactSetMu(CuboGeom(x+2),100)

	Cubo(x+3)=CreateCube()
		ScaleEntity Cubo(x+3),5,0.5,0.5	
	CuboBody(x+3)=dBodyCreate(World)	
	CuboGeom(x+3)=dCreateBox(Space,10,1,1)	
	dGeomSetBody(CuboGeom(x+3),CuboBody(x+3))
		dBodySetPosition(CuboBody(x+3),0,3+(Counter*3),3)
	dGeomContactSetMu(CuboGeom(x+3),100)
	
	Counter=Counter+1
Next

	UpdateCubes()
	
While Not KeyHit(1)
	
	If KeyHit(57) Then
		For x=1 To Height*4
			dBodyAddForce(CuboBody(x),Rnd(-50,50),Rnd(-50,50),Rnd(-50,50))
		Next
	EndIf
	
	If KeyDown(200) Then
	MoveEntity cam,0,0,1
	EndIf
	If KeyDown(208) Then
	MoveEntity cam,0,0,-1
	EndIf
	If KeyDown(203) Then
	MoveEntity cam,-1,0,0
	EndIf
	If KeyDown(205) Then
	MoveEntity cam,1,0,0
	EndIf
	If KeyDown(30) Then
	MoveEntity cam,0,1,0
	EndIf
	If KeyDown(44) Then
	MoveEntity cam,0,-1,0
	EndIf
	
	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)
	
	UpdateCubes()
	
	UpdateWorld()
	RenderWorld()
	Flip
Wend

dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()
End

Function UpdateCubes()
	For x=1 To Height*4
		PositionEntity Cubo(x),dGeomGetPositionX(CuboGeom(x)),dGeomGetPositionY(CuboGeom(x)),dGeomGetPositionZ(CuboGeom(x))
		RotateEntity Cubo(x),dGeomGetPitch(CuboGeom(x)),dGeomGetYaw(CuboGeom(x)),dGeomGetRoll(CuboGeom(x))
	Next
End Function
</textarea> <br><br></td></tr></table><br>
<a name="1012886"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Oiduts Studios</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#180">[#180]</a></td></tr></table></td></tr><tr ><td class="posttext"> The reason JV-Ode doesn't support 600 to 700 objects touching each other is because there are no games that should have 600 to 700 physic objects in them. I guess you would need more for fluid dynamics but thats a different story. :) <br><br></td></tr></table><br>
<a name="1012887"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#181">[#181]</a></td></tr></table></td></tr><tr ><td class="posttext"> This does 150, that better ?<br><br><pre class=code>
Include "JV-ODE.bb"

Graphics3D 1024,768,32,1

SetBuffer BackBuffer()

dInitODE()

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,True)

dWorldSetGravity(World,0,-1,0)
dContactSetMu(5)

; Causes objects to settle down and sleep faster
dWorldSetAutoDisableLinearThreshold (World, .1)
dWorldSetAutoDisableAngularThreshold (World, .1)
dWorldSetAutoDisableSteps (World,32)
dContactSetMaxContacts(16)
dWorldSetQuickStepNumIterations (World,16) ; default 20


Cam=CreateCamera()
PositionEntity Cam,0,5,-20

light=CreateLight()
PositionEntity light,0,10,0

Global Height

Height=Input("Tower Height:")

Dim Cubo(Height*4)
Dim CuboGeom(Height*4)
Dim CuboBody(Height*4)

Plane=CreatePlane()

dCreatePlane(Space,0,1,0,0)
EntityTexture Plane,PlaneTexture()

Counter=0	

For x=1 To Height*4 Step 4
	Cubo(x)=CreateCube()
		ScaleEntity Cubo(x),0.5,0.5,5	
	CuboBody(x)=dBodyCreate(World)	
	CuboGeom(x)=dCreateBox(Space,1,1,10)	
	dGeomSetBody(CuboGeom(x),CuboBody(x))
		dBodySetPosition(CuboBody(x),-3,0.5+(Counter*3),0)
	dGeomContactSetMu(CuboGeom(x),5)
	
	Cubo(x+1)=CreateCube()
		ScaleEntity Cubo(x+1),0.5,0.5,5	
	CuboBody(x+1)=dBodyCreate(World)	
	CuboGeom(x+1)=dCreateBox(Space,1,1,5)	
	dGeomSetBody(CuboGeom(x+1),CuboBody(x+1))
		dBodySetPosition(CuboBody(x+1),3,0.5+(Counter*3),0)
	dGeomContactSetMu(CuboGeom(x+1),5)
	
	Cubo(x+2)=CreateCube()
		ScaleEntity Cubo(x+2),5,0.5,0.5	
	CuboBody(x+2)=dBodyCreate(World)	
	CuboGeom(x+2)=dCreateBox(Space,10,1,1)	
	dGeomSetBody(CuboGeom(x+2),CuboBody(x+2))
		dBodySetPosition(CuboBody(x+2),0,3+(Counter*3),-3)
	dGeomContactSetMu(CuboGeom(x+2),5)

	Cubo(x+3)=CreateCube()
		ScaleEntity Cubo(x+3),5,0.5,0.5	
	CuboBody(x+3)=dBodyCreate(World)	
	CuboGeom(x+3)=dCreateBox(Space,10,1,1)	
	dGeomSetBody(CuboGeom(x+3),CuboBody(x+3))
		dBodySetPosition(CuboBody(x+3),0,3+(Counter*3),3)
	dGeomContactSetMu(CuboGeom(x+3),5)
	
	Counter=Counter+1
Next

	UpdateCubes()
	
While Not KeyHit(1)
	
	If KeyHit(57) Then
		For x=1 To Height*4
			dBodyAddForce(CuboBody(x),Rnd(-50,50),Rnd(-50,50),Rnd(-50,50))
		Next
	EndIf
	
	If KeyDown(200) Then
	MoveEntity cam,0,0,1
	EndIf
	If KeyDown(208) Then
	MoveEntity cam,0,0,-1
	EndIf
	If KeyDown(203) Then
	MoveEntity cam,-1,0,0
	EndIf
	If KeyDown(205) Then
	MoveEntity cam,1,0,0
	EndIf
	If KeyDown(30) Then
	MoveEntity cam,0,1,0
	EndIf
	If KeyDown(44) Then
	MoveEntity cam,0,-1,0
	EndIf
	
	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.05)
	dWorldQuickStep(World,0.05)

	dJointGroupEmpty(ContactGroup)
	
	UpdateCubes()
	
	UpdateWorld()
	RenderWorld()
	Flip
Wend

dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()
End

Function UpdateCubes()
	For x=1 To Height*4
		PositionEntity Cubo(x),dGeomGetPositionX(CuboGeom(x)),dGeomGetPositionY(CuboGeom(x)),dGeomGetPositionZ(CuboGeom(x))
		RotateEntity Cubo(x),dGeomGetPitch(CuboGeom(x)),dGeomGetYaw(CuboGeom(x)),dGeomGetRoll(CuboGeom(x))
	Next
End Function
</pre> <br><br></td></tr></table><br>
<a name="1012891"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#182">[#182]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here is 500 objects !!<br>Had to tweek the settings some to make it interesting and run.<br>8)<br><br><pre class=code>
Include "JV-ODE.bb"

;Graphics3D 1024,768,32,1
Graphics3D 640,480,32,3

SetBuffer BackBuffer()

dInitODE()

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,True)

dWorldSetGravity(World,0,-2,0)
dContactSetMu(5)

; Causes objects to settle down and sleep faster
dWorldSetAutoDisableLinearThreshold (World, .04)
dWorldSetAutoDisableAngularThreshold (World, .04)
dWorldSetAutoDisableSteps (World,16)
dContactSetMaxContacts(4)
dWorldSetQuickStepNumIterations (World,16) ; default 20


Cam=CreateCamera()
PositionEntity Cam,0,5,-20

light=CreateLight()
PositionEntity light,0,10,0

Global Height

Height=Input("Tower Height:")

Dim Cubo(Height*4)
Dim CuboGeom(Height*4)
Dim CuboBody(Height*4)

Plane=CreatePlane()

dCreatePlane(Space,0,1,0,0)
EntityTexture Plane,PlaneTexture()

Counter=0	

For x=1 To Height*4 Step 4
	Cubo(x)=CreateCube()
		ScaleEntity Cubo(x),0.5,0.5,5	
	CuboBody(x)=dBodyCreate(World)	
	CuboGeom(x)=dCreateBox(Space,1,1,10)	
	dGeomSetBody(CuboGeom(x),CuboBody(x))
		dBodySetPosition(CuboBody(x),-3,0.5+(Counter*3),0)
	dGeomContactSetMu(CuboGeom(x),5)
	
	Cubo(x+1)=CreateCube()
		ScaleEntity Cubo(x+1),0.5,0.5,5	
	CuboBody(x+1)=dBodyCreate(World)	
	CuboGeom(x+1)=dCreateBox(Space,1,1,5)	
	dGeomSetBody(CuboGeom(x+1),CuboBody(x+1))
		dBodySetPosition(CuboBody(x+1),3,0.5+(Counter*3),0)
	dGeomContactSetMu(CuboGeom(x+1),5)
	
	Cubo(x+2)=CreateCube()
		ScaleEntity Cubo(x+2),5,0.5,0.5	
	CuboBody(x+2)=dBodyCreate(World)	
	CuboGeom(x+2)=dCreateBox(Space,10,1,1)	
	dGeomSetBody(CuboGeom(x+2),CuboBody(x+2))
		dBodySetPosition(CuboBody(x+2),0,3+(Counter*3),-3)
	dGeomContactSetMu(CuboGeom(x+2),5)

	Cubo(x+3)=CreateCube()
		ScaleEntity Cubo(x+3),5,0.5,0.5	
	CuboBody(x+3)=dBodyCreate(World)	
	CuboGeom(x+3)=dCreateBox(Space,10,1,1)	
	dGeomSetBody(CuboGeom(x+3),CuboBody(x+3))
		dBodySetPosition(CuboBody(x+3),0,3+(Counter*3),3)
	dGeomContactSetMu(CuboGeom(x+3),5)
	
	Counter=Counter+1
Next

	UpdateCubes()
	
While Not KeyHit(1)
	
	If KeyHit(57) Then
		For x=1 To Height*4
			dBodyAddForce(CuboBody(x),Rnd(-50,50),Rnd(-50,50),Rnd(-50,50))
		Next
	EndIf
	
	If KeyDown(200) Then
	MoveEntity cam,0,0,1
	EndIf
	If KeyDown(208) Then
	MoveEntity cam,0,0,-1
	EndIf
	If KeyDown(203) Then
	MoveEntity cam,-1,0,0
	EndIf
	If KeyDown(205) Then
	MoveEntity cam,1,0,0
	EndIf
	If KeyDown(30) Then
	MoveEntity cam,0,1,0
	EndIf
	If KeyDown(44) Then
	MoveEntity cam,0,-1,0
	EndIf
	
	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.02)
	dWorldQuickStep(World,0.02)
	
	dJointGroupEmpty(ContactGroup)
	
	UpdateCubes()
	
	UpdateWorld()
	RenderWorld()
	Flip
Wend

dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()
End

Function UpdateCubes()
	For x=1 To Height*4
		PositionEntity Cubo(x),dGeomGetPositionX(CuboGeom(x)),dGeomGetPositionY(CuboGeom(x)),dGeomGetPositionZ(CuboGeom(x))
		RotateEntity Cubo(x),dGeomGetPitch(CuboGeom(x)),dGeomGetYaw(CuboGeom(x)),dGeomGetRoll(CuboGeom(x))
	Next
End Function
</pre> <br><br></td></tr></table><br>
<a name="1012895"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ian Caio</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#183">[#183]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the answers,<br><br>BlitzMonkey,<br>I agree with you, no game would need such quantity of objects, and it supported even more boxes if you think. Because for example, with a tower height of 130 there would actually be 520 cubes, because for each unit of height there are 4 boxes. But Im not actually aiming to use all of this, I was making some tests, and that happened so I was just wondering why and if there was a way to solve it.<br><br>Wayne,<br>Thanks a lot for the codes Wayne, and nice work, it seens to be working pretty well (:<br>How did you made it? I mean, I saw changes in the code, but I didnt really understand how they solved the problem.<br><br>Cya <br><br></td></tr></table><br>
<a name="1012906"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#184">[#184]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm, I did a little testing and it appears to be related to the type of space you use. For example, with <i>d<b>Hash</b>SpaceCreate(0)</i> the tower can't be much more than a height of 500 (with Wayne's last code). However, using <i>d<b>Simple</b>SpaceCreate(0)</i> instead will allow a tower height of 3000. Although with that many objects it's so slow it's like a slideshow. Go too far over 3000 and it crashes, I'm not sure whether it's Blitz3D or ODE crashing as there's probably a limit on Blitz entities too. It doesn't give a stack overflow though.<br><br>BTW, this code is wrong in the example above...<br><pre class=code>
	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.02)
	dWorldQuickStep(World,0.02)

	dJointGroupEmpty(ContactGroup)
</pre><br>You're missing potential collision responses between quicksteps, even though you gain accuracy by splitting them.<br><br>You have to call <i>dSpaceCollide()</i> and <i>dJointGroupEmpty()</i> for every quickstep call, like this...<br><pre class=code>
	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.02)
	dJointGroupEmpty(ContactGroup)

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.02)
	dJointGroupEmpty(ContactGroup)
</pre> <br><br></td></tr></table><br>
<a name="1012920"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#185">[#185]</a></td></tr></table></td></tr><tr ><td class="posttext"> oh yeah, I knew I was forgetting something. 8)<br><br>3000! gads that be near earth orbit wouldn't it ?<br><br>Have to try that as I like watching the tower fall.<br>Thanks for building the tower caio.<br><br>I just looked, the tower build is defective, dad gum it!!<br>comment out the quick step and you can see it. <br><br></td></tr></table><br>
<a name="1012928"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#186">[#186]</a></td></tr></table></td></tr><tr ><td class="posttext"> Try this with 50<br>Added damping, and disabled bodies at set up.<br><pre class=code>
Include "JV-ODE.bb"

Graphics3D 1024,768,32,1
;Graphics3D 640,480,32,3

SetBuffer BackBuffer()

dInitODE()

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,True)

dWorldSetGravity(World,0,-2,0)
dContactSetMu(5)

; damping this some
dWorldSetDamping(world,.05,.05)

; Causes objects to settle down and sleep faster
dWorldSetAutoDisableLinearThreshold (World, .5)
dWorldSetAutoDisableAngularThreshold (World, .5)
dWorldSetAutoDisableSteps (World,6)
dContactSetMaxContacts(10)
dWorldSetQuickStepNumIterations (World,16) ; default 20


Cam=CreateCamera()
PositionEntity Cam,0,5,-20

light=CreateLight()
PositionEntity light,0,10,0

Global Height

Height=Input("Tower Height:")

Dim Cubo(Height*4)
Dim CuboGeom(Height*4)
Dim CuboBody(Height*4)

Plane=CreatePlane()

dCreatePlane(Space,0,1,0,0)
EntityTexture Plane,PlaneTexture()

Counter=1	

For x=1 To Height*4 Step 4
	Cubo(x)=CreateCube()
	ScaleEntity Cubo(x),0.5,0.5,5	
	CuboBody(x)=dBodyCreate(World)	
	CuboGeom(x)=dCreateBox(Space,1,1,10)	;
	dGeomSetBody(CuboGeom(x),CuboBody(x))
	dBodySetPosition(CuboBody(x),-3,counter,0)
	dGeomContactSetMu(CuboGeom(x),5)
	dBodyDisable(CuboBody(x))
	
	Cubo(x+1)=CreateCube()
	ScaleEntity Cubo(x+1),0.5,0.5,5	
	CuboBody(x+1)=dBodyCreate(World)	
	CuboGeom(x+1)=dCreateBox(Space,1,1,10)	
	dGeomSetBody(CuboGeom(x+1),CuboBody(x+1))
	dBodySetPosition(CuboBody(x+1),3,counter,0)
	dGeomContactSetMu(CuboGeom(x+1),5)
	dBodyDisable(CuboBody(x+1))
	
	Cubo(x+2)=CreateCube()
	ScaleEntity Cubo(x+2),5,0.5,0.5	
	CuboBody(x+2)=dBodyCreate(World)	
	CuboGeom(x+2)=dCreateBox(Space,10,1,1)	
	dGeomSetBody(CuboGeom(x+2),CuboBody(x+2))
	dBodySetPosition(CuboBody(x+2),0,counter+1,-3)
	dGeomContactSetMu(CuboGeom(x+2),5)
	dBodyDisable(CuboBody(x+2))
	
	Cubo(x+3)=CreateCube()
	ScaleEntity Cubo(x+3),5,0.5,0.5	
	CuboBody(x+3)=dBodyCreate(World)	
	CuboGeom(x+3)=dCreateBox(Space,10,1,1)	
	dGeomSetBody(CuboGeom(x+3),CuboBody(x+3))
	dBodySetPosition(CuboBody(x+3),0,counter+1,3)
	dGeomContactSetMu(CuboGeom(x+3),5)
	dBodyDisable(CuboBody(x+3))
	
	Counter=Counter+2
Next

	UpdateCubes()
	
While Not KeyHit(1)
	
	If KeyHit(57) Then
		For x=1 To Height*4
			dBodyEnable(CuboBody(x)); Enable body so we can push it
			dBodyAddForce(CuboBody(x),Rnd(-50,50),Rnd(-50,50),Rnd(-50,50))
		Next
	EndIf
	
	If KeyDown(200) Then
	MoveEntity cam,0,0,1
	EndIf
	If KeyDown(208) Then
	MoveEntity cam,0,0,-1
	EndIf
	If KeyDown(203) Then
	MoveEntity cam,-1,0,0
	EndIf
	If KeyDown(205) Then
	MoveEntity cam,1,0,0
	EndIf
	If KeyDown(30) Then
	MoveEntity cam,0,1,0
	EndIf
	If KeyDown(44) Then
	MoveEntity cam,0,-1,0
	EndIf
	
	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)


	dJointGroupEmpty(ContactGroup)
	
	UpdateCubes()
	
	UpdateWorld()
	RenderWorld()
	Flip
Wend

dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()
End

Function UpdateCubes()
	For x=1 To Height*4
		PositionEntity Cubo(x),dGeomGetPositionX(CuboGeom(x)),dGeomGetPositionY(CuboGeom(x)),dGeomGetPositionZ(CuboGeom(x))
		RotateEntity Cubo(x),dGeomGetPitch(CuboGeom(x)),dGeomGetYaw(CuboGeom(x)),dGeomGetRoll(CuboGeom(x))
	Next
End Function
</pre> <br><br></td></tr></table><br>
<a name="1012930"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#187">[#187]</a></td></tr></table></td></tr><tr ><td class="posttext"> Try this at height 60<br><br><pre class=code>
Include "JV-ODE.bb"

Graphics3D 1024,768,32,1
;Graphics3D 640,480,32,3

SetBuffer BackBuffer()

dInitODE()

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,True)

dWorldSetGravity(World,0,-1,0)
dContactSetMu(2)

; damping this some
dWorldSetDamping(world,.01,.01)

; Causes objects to settle down and sleep faster
dWorldSetAutoDisableLinearThreshold (World, .2)
dWorldSetAutoDisableAngularThreshold (World, .2)
dWorldSetAutoDisableSteps (World,8)
dContactSetMaxContacts(12)
dWorldSetQuickStepNumIterations (World,10) ; default 20


Cam=CreateCamera()
PositionEntity Cam,0,5,-20

light=CreateLight()
PositionEntity light,0,10,0

Global Height

Height=Input("Tower Height:")

Dim Cubo(Height*4)
Dim CuboGeom(Height*4)
Dim CuboBody(Height*4)

Plane=CreatePlane()

dCreatePlane(Space,0,1,0,0)
EntityTexture Plane,PlaneTexture()

Counter=1	

For x=1 To Height*4 Step 4
	Cubo(x)=CreateCube()
	ScaleEntity Cubo(x),0.5,0.5,5	
	CuboBody(x)=dBodyCreate(World)	
	CuboGeom(x)=dCreateBox(Space,1,1,10)	;
	dGeomSetBody(CuboGeom(x),CuboBody(x))
	dBodySetPosition(CuboBody(x),-3,counter,0)
	dGeomContactSetMu(CuboGeom(x),2)
	dBodyDisable(CuboBody(x))
	
	Cubo(x+1)=CreateCube()
	ScaleEntity Cubo(x+1),0.5,0.5,5	
	CuboBody(x+1)=dBodyCreate(World)	
	CuboGeom(x+1)=dCreateBox(Space,1,1,10)	
	dGeomSetBody(CuboGeom(x+1),CuboBody(x+1))
	dBodySetPosition(CuboBody(x+1),3,counter,0)
	dGeomContactSetMu(CuboGeom(x+1),2)
	dBodyDisable(CuboBody(x+1))
	
	Cubo(x+2)=CreateCube()
	ScaleEntity Cubo(x+2),5,0.5,0.5	
	CuboBody(x+2)=dBodyCreate(World)	
	CuboGeom(x+2)=dCreateBox(Space,10,1,1)	
	dGeomSetBody(CuboGeom(x+2),CuboBody(x+2))
	dBodySetPosition(CuboBody(x+2),0,counter+1,-3)
	dGeomContactSetMu(CuboGeom(x+2),2)
	dBodyDisable(CuboBody(x+2))
	
	Cubo(x+3)=CreateCube()
	ScaleEntity Cubo(x+3),5,0.5,0.5	
	CuboBody(x+3)=dBodyCreate(World)	
	CuboGeom(x+3)=dCreateBox(Space,10,1,1)	
	dGeomSetBody(CuboGeom(x+3),CuboBody(x+3))
	dBodySetPosition(CuboBody(x+3),0,counter+1,3)
	dGeomContactSetMu(CuboGeom(x+3),2)
	dBodyDisable(CuboBody(x+3))
	
	Counter=Counter+2
Next

	UpdateCubes()
	
While Not KeyHit(1)
	
	If KeyHit(57) Then
		For x=1 To Height*4
			dBodyEnable(CuboBody(x)); Enable body so we can push it
			dBodyAddForce(CuboBody(x),Rnd(-50,50),Rnd(-50,50),Rnd(-50,50))
		Next
	EndIf
	
	If KeyDown(200) Then
	MoveEntity cam,0,0,1
	EndIf
	If KeyDown(208) Then
	MoveEntity cam,0,0,-1
	EndIf
	If KeyDown(203) Then
	MoveEntity cam,-1,0,0
	EndIf
	If KeyDown(205) Then
	MoveEntity cam,1,0,0
	EndIf
	If KeyDown(30) Then
	MoveEntity cam,0,1,0
	EndIf
	If KeyDown(44) Then
	MoveEntity cam,0,-1,0
	EndIf
	
	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.04)
	dWorldQuickStep(World,0.04)
;	dWorldQuickStep(World,0.03)

	dJointGroupEmpty(ContactGroup)
	
	UpdateCubes()
	
	UpdateWorld()
	RenderWorld()
	Flip
Wend

dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()
End

Function UpdateCubes()
	For x=1 To Height*4
		PositionEntity Cubo(x),dGeomGetPositionX(CuboGeom(x)),dGeomGetPositionY(CuboGeom(x)),dGeomGetPositionZ(CuboGeom(x))
		RotateEntity Cubo(x),dGeomGetPitch(CuboGeom(x)),dGeomGetYaw(CuboGeom(x)),dGeomGetRoll(CuboGeom(x))
	Next
End Function
</pre> <br><br></td></tr></table><br>
<a name="1013117"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ian Caio</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#188">[#188]</a></td></tr></table></td></tr><tr ><td class="posttext"> VIP3R,<br>I have changed the Hash space with the Simple space, looks like the hash space is faster but have this limitation, with Simple space I could create until 3000 cubes as you said (didnt tryied more than that ^^). I had a stack overflow after running for a while (with 500 cubes I guess), but I guess it was because of too much overlapping between the boxes when they were falling. I will still learn to configure the physics like you and Wayne! (:<br><br>Wayne,<br>My bad in the tower construction code, I knew there was something wrong ^^<br>Im testing and studying all the codes you are showing here, you made that little demo grows a lot. With the body disable, the damping, and the improvements in the code, its just looking great (: <br><br></td></tr></table><br>
<a name="1013142"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#189">[#189]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi, wanted to try the demo but my compiler cannot find the dWorldSetDamping function - is this in a recent release of JV-ODE ?  I looked at the decls and bb file and the date stamp was oct 08 despite the readme suggesting I'd v1.32 in - so I downloaded v1.32 again however the date stamps were Oct 08. <br><br></td></tr></table><br>
<a name="1013145"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#190">[#190]</a></td></tr></table></td></tr><tr ><td class="posttext"> It was added in V1.32 (Oct 08) which is the latest version. You can view the decls using notepad, double check whether the function is listed under World Functions.<br><br>Note: The current version number of JV-ODE is always displayed at the top of the active JV-ODE thread ^ and in my sig. <br><br></td></tr></table><br>
<a name="1013185"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#191">[#191]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the tip, I'd the latest .decls file within the same directory as my .bb files Instead of within the Blitz3D userlibs directory. Fixed!  Just crashed into the tower with my car...carnage!<br><br><img src="http://www.wishingwellsoftware.co.uk/blockfall.jpg"> <br><br></td></tr></table><br>
<a name="1013308"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Charrua</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#192">[#192]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi<br><br>i added ode support to my AWC (a small and free world creator)<br>it's in an experimental phase, say: wiht bug's as always<br><br>There are 2 ode demos, will be more (hope some one send me one)<br>and a little lib to create the ode objects (box, sphere and cylinder at this time) and joints (hinge, hinge2, slider and Socket&amp;Ball) from the data defined from the editor.<br><br>probably in a near future the editor has some dialog box to set/modify the joints/bodies parameters, at this stage all is very experimental and the variables are predefined to some default values, edit the awc_ode_lib.bb to meet your needs.<br><br>this is the thread for AWC<br><a href="http://blitzbasic.com/Community/posts.php?topic=88756" target="_blank">http://blitzbasic.com/Community/posts.php?topic=88756</a><br><br>enjoy<br><br>Juan <br><br></td></tr></table><br>
<a name="1013327"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#193">[#193]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Charrua, excellent world creator, Great work - movement of the lights alone is very intuitive. <br><br></td></tr></table><br>
<a name="1013381"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Charrua</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#194">[#194]</a></td></tr></table></td></tr><tr ><td class="posttext"> i have to confess that iim surprised whit some effects i readed but never intended to use. <br>In one of the demos i use a negative range for Light_Point_001 ("2 Dos.awc"), i readed about negative ranges for light but, with the editor i have the chance to see it changing dinamically. The same you can move wiht the mouse, you can Scale, in the case of a light it modifies the range.<br><br>As awc is made with blitz3d, you have a chance to see what really will happen.<br><br>I updated the awc1.zip with some bug fixed and with a new demo that has 2 doors implemented with Hinge joints.<br><br>best regards<br><br>Juan <br><br></td></tr></table><br>
<a name="1013394"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#195">[#195]</a></td></tr></table></td></tr><tr ><td class="posttext"> I like the carnage BP :)<br><br>Thanks for posting the world creator info Juan, it's great to see it now includes ODE support. <br><br></td></tr></table><br>
<a name="1013395"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Charrua</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#196">[#196]</a></td></tr></table></td></tr><tr ><td class="posttext"> sorry but my english isn't good enough to understand some terms<br><br>carnage BP ?<br><br>Juan <br><br></td></tr></table><br>
<a name="1013401"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#197">[#197]</a></td></tr></table></td></tr><tr ><td class="posttext"> Carnage = In the context of the above image it means total destruction <i>"Just crashed into the tower with my car...carnage!"</i><br><br>BP = Blitzplotter<br><br>I was responding to both of you, sorry for the confusion ;) <br><br></td></tr></table><br>
<a name="1013411"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Charrua</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#198">[#198]</a></td></tr></table></td></tr><tr ><td class="posttext"> i didn'r read the previous post, i'm sorry!<br>my bad<br><br>Juan <br><br></td></tr></table><br>
<a name="1013486"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blitzplotter</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#199">[#199]</a></td></tr></table></td></tr><tr ><td class="posttext"> I was looking for some code to see how fast the car was going, my kids wanted to see an indication of their speed on the 2 player postmanplat I've been working on. Found exactly what I needed in thread 11, there is some fantastic resources within the JV-ODE threads. <br><br></td></tr></table><br>
<a name="1013516"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#200">[#200]</a></td></tr></table></td></tr><tr ><td class="posttext"> They are indeed ;)<br><br><b>THREAD 12 IS ABOUT TO CLOSE</b><br><br>Please continue on the new thread located <a href="/posts.php?topic=89252" target="_blank">here</a><br><br>Thanks :) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
