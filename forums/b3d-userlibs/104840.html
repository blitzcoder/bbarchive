<!DOCTYPE html><html lang="en" ><head ><title >LAN multiplayer(UDP)..</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >LAN multiplayer(UDP)..</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=94" >Blitz3D Userlibs</a>/<a href="#bottom" >LAN multiplayer(UDP)..</a><br><br>
<a name="1272639"></a>

<a name="1272640"></a>

<a name="1272641"></a>

<a name="1272642"></a>

<a name="1272643"></a>

<a name="1272644"></a>

<a name="1272645"></a>

<a name="1272646"></a>

<a name="1272647"></a>

<a name="1272648"></a>

<a name="1272649"></a>

<a name="1272650"></a>

<a name="1272651"></a>

<a name="1272657"></a>

<a name="1272741"></a>

<a name="1272742"></a>

<a name="1272743"></a>

<a name="1272744"></a>

<a name="1272746"></a>

<a name="1272747"></a>

<a name="1280600"></a>

<a name="1280602"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi All,<br><br>I am trying to create a LAN/Internet multiplayer game, but I'm having trouble to make it answer to my needs(switching hosts on the fly). <br><br><b>Sofar I've tried these 2 UDP libraries:</b><br><br><a href="http://www.blitzforum.de/worklogs/334/" target="_blank">1) LlamaNet 1.06</a><br><img src="http://i57.tinypic.com/wtjgxs.png"><br><br><i>From this I really love example "LAmaNet_Example09_3D-Environment.bb"<br>Which is great but apparently a bit buggy, working less good than SimpleUDP, so I abandonedd it, just added it for anyone interested, for it really is a nice example of a 3d multiplayer over network:</i><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
SeedRnd MilliSecs()
Graphics3D 640,480,0,2
SetBuffer BackBuffer()

Local i%,MHit%,M.Message,P.Player
Local Direction%,File$

Global MaxPlayers%=5

Local Font=LoadFont("Verdana",12,0,0,0):SetFont Font

Include "LAmaNet.bb"


;3D-Umgebung
Local Textur=CreateTexture(128,128)
SetBuffer TextureBuffer(Textur)
Color 32,32,32
Rect 1,1,64,64
Rect 64,64,64,64
ScaleTexture Textur,4,4
SetBuffer BackBuffer()
Color 255,255,255

Local Plane=CreatePlane()
PositionEntity Plane,0,-1,0
EntityTexture Plane,Textur



Local C#=Rnd(0,1)
Local R=CColor(C#,1)
Local G=CColor(C#,2)
Local B=CColor(C#,3)
Local RTemp,GTemp,BTemp

Local Radius#=5.0
Local CameraFlow#=0.1,DX#,DY#,DZ#
Local Camera=CreateCamera()
PositionEntity Camera,0,4,-5
RotateEntity Camera,35,0,0
;Nebel
CameraFogMode Camera,1
CameraFogColor Camera,0,0,0
CameraFogRange Camera,5,50
;Licht
Local Light=CreateLight()
RotateEntity Light,50,70,0

;Spielersystem
Dim Player(MaxPlayers%);erster Type bleibt EInfachheitshalber frei (für Fortgeschrittene einfach MaxPlayers%-1)
For i=1 To MaxPlayers%
	P.Player=New Player
	P\ID%=i
	P\Mesh%=CreateCube()
	P\CameraPivot%=CreatePivot(P\Mesh%):PositionEntity P\CameraPivot,0,4,-8
	P\AlignPivot%=CreatePivot(P\Mesh%):PositionEntity P\AlignPivot%,0,0,+6
	RotateEntity P\Mesh%,0,i*75,0
	PositionEntity P\Mesh%,Radius#*Cos(i*75),0,Radius#*Sin(i*75)
	EntityAlpha P\Mesh,0.5
	
	
	Player(i)=Handle(P.Player)
Next

Local ServerOrClient=Input("Server erstellen(1) - Server suchen(2)")
Select ServerOrClient
	Case 1
		If LAMA_HostServer("LAmaNet - Testserver",MaxPlayers%,"Lama")=0 Then End
	Case 2
		If LAMA_StartCountServers()=0 Then End
	Default
		End
End Select

Local Tact%,InputText$,Sign$
Local Timer=CreateTimer(60)


FlushKeys
While Not KeyHit(1)
	Cls
	
	MHit=MouseHit(1)
	LAMA_Update()
	
	While LAMA_Event()
		Select LAMA_EventID
			Case LAMA_Connected
				;Spieler-einstellungen
				P.Player=Object.Player(Player(LAMA_MasterID))
				EntityColor P\Mesh,R,G,B
				EntityAlpha P\Mesh,1
				;eigene-daten-senden
				LAMA_Send(0,20,R)
				LAMA_Send(0,20,G)
				LAMA_Send(0,20,B)
			Case LAMA_Joined;neuer-spieler-schickt-eigene-daten
				M.Message=New Message
				M\Message$="Spiel beigetreten"
			Case LAMA_NewPlayer;server-schickt-daten-der-spieler-an-neuen-spieler
				M.Message=New Message
				M\Message$=LAMA_Name(LAMA_EventPlayerID)+" beigetreten"
				;eigene-daten-senden
				LAMA_Send(LAMA_EventPlayerID,20,R)
				LAMA_Send(LAMA_EventPlayerID,20,G)
				LAMA_Send(LAMA_EventPlayerID,20,B)
			Case LAMA_CountRequest;server-erhält-counter-server-request
				M.Message=New Message
				M\Message$="Clientanfrage erhalten"
			Case LAMA_ServerFull;pc-erhält-server-full-information
				M.Message=New Message
				M\Message$="Server voll"
			Case LAMA_PlayerLeft%
				M.Message=New Message
				M\Message$="Spieler "+LAMA_Name(LAMA_EventPlayerID)+" hat das Spiel verlassen."
				;daten-des-spielers-zurücksetzen
				P.Player=Object.Player(Player(LAMA_EventPlayerID))
				EntityColor P\Mesh,255,255,255
				EntityAlpha P\Mesh,0.5
				RotateEntity P\Mesh%,0,P\ID%*75,0
				PositionEntity P\Mesh%,Radius#*Cos(P\ID%*75),0,Radius#*Sin(P\ID%*75)
			Case LAMA_ServerLeft%
				M.Message=New Message
				M\Message$="Server hat das spiel verlassen - Verbindung getrennt!"
		End Select
	Wend
	
	If LAMA_Connection Then;wenn-verbindung-noch-nicht-hergestellt
		P.Player=Object.Player(Player(LAMA_MasterID))
		
		;Camera-und-Objekt-bewegen
		DX#=(EntityX(P\CameraPivot,1)-EntityX(Camera,1))*CameraFlow#
		DY#=(EntityY(P\CameraPivot,1)-EntityY(Camera,1))*CameraFlow#
		DZ#=(EntityZ(P\CameraPivot,1)-EntityZ(Camera,1))*CameraFlow#
		TranslateEntity Camera,DX#,DY#,DZ#
		DX#=EntityX(P\AlignPivot,1)-EntityX(Camera,1)
		DY#=EntityY(P\AlignPivot,1)-EntityY(Camera,1)
		DZ#=EntityZ(P\AlignPivot,1)-EntityZ(Camera,1)
		AlignToVector Camera,DX#,DY#,DZ#,3,CameraFlow#
		If KeyDown(200) Then P\Speed#=P\Speed#+0.01
		If KeyDown(208) Then P\Speed#=P\Speed#-0.01
		If KeyDown(203) Then P\RSpeed#=P\RSpeed#+0.1
		If KeyDown(205) Then P\RSpeed#=P\RSpeed#-0.1
		P\Speed#=P\Speed#*0.95
		P\RSpeed#=P\RSpeed#*0.95
		MoveEntity P\Mesh,0,0,P\Speed#
		TurnEntity P\Mesh,0,P\RSpeed#,0
		TurnEntity Camera,0,0,-EntityRoll(Camera)*CameraFlow#
		;daten-senden
		LAMA_Send(0,1,EntityX(P\Mesh))
		LAMA_Send(0,1,EntityY(P\Mesh))
		LAMA_Send(0,1,EntityZ(P\Mesh))
		LAMA_Send(0,1,EntityYaw(P\Mesh))
		
		;empfangsschleife
		While LAMA_Recv()
			P.Player=Object.Player(LAMA_From)
			Select LAMA_MsgID
				Case 1
					P\X=LAMA_Read()
					P\Y=LAMA_Read()
					P\Z=LAMA_Read()
					PositionEntity P\Mesh,P\X,P\Y,P\Z
					RotateEntity P\Mesh,0,LAMA_Read(),0
				Case 20
					RTemp=LAMA_Read()
					GTemp=LAMA_Read()
					BTemp=LAMA_Read()
					EntityColor P\Mesh,RTemp,GTemp,BTemp
					EntityAlpha P\Mesh,1
			End Select
		Wend
		
		RenderWorld()
		
		;Spieler-anzeige
		For P.Player=Each Player
			If LAMA_Online(P\ID%) Then
				CameraProject Camera,EntityX(P\Mesh),EntityY(P\Mesh)+2.5,EntityZ(P\Mesh)
				If ProjectedZ()&gt;0 Then
					Text ProjectedX(),ProjectedY(),LAMA_Name(P\ID),1
					Text ProjectedX(),ProjectedY()+12,"Ping: "+LAMA_Ping(P\ID),1
				EndIf
			Else
				CameraProject Camera,EntityX(P\Mesh),EntityY(P\Mesh)+2.5,EntityZ(P\Mesh)
				If ProjectedZ()&gt;0 Then
					Text ProjectedX(),ProjectedY(),"Offline",1
				EndIf
			EndIf
		Next
		Text GraphicsWidth()-10,0,LAMA_MasterID
		
		Color 255,255,255
		Select LAMA_Mode
			Case 1;Server-schleife
				Text 0,0,"Server geöffnet"
			Case 2;Client-schleife
				If RectsOverlap(GraphicsWidth()-9,0,9,9,MouseX(),MouseY(),1,1) Then
					Color 0,255,0
					If MHit Then
						LAMA_CloseServer()
					EndIf
				Else
					Color 255,255,255
				EndIf
				Rect GraphicsWidth()-9,0,9,9,0
				Line GraphicsWidth()-9,0,GraphicsWidth(),10
				Line GraphicsWidth(),0,GraphicsWidth()-9,8
		End Select
		
	Else;verbindung-nicht-hergestellt
		Color 255,255,255
		Text 0,0,"erstelle Serverlist..."
		Text GraphicsWidth()/2,50,"Serverlist:",1
		For i=1 To LAMA_CountServers
			Text GraphicsWidth()/2,50+i*12,LAMA_ServerName$(i)+"("+LAMA_ServerPlayers(i)+"/"+LAMA_ServerMaxPlayers(i)+")"
			;Button
			If RectsOverlap(GraphicsWidth()/2-200,50+i*12,150,12,MouseX(),MouseY(),1,1) Then
				Color 0,255,0
				If MHit Then
					LAMA_JoinServer(i,"JoinLama")
				EndIf
			Else
				Color 255,255,255
			EndIf
			Text GraphicsWidth()/2-125,50+i*12,"Login",1,0
			Rect GraphicsWidth()/2-200,50+i*12,150,12,0
			Color 255,255,255
			;EndButton
		Next
		;Reloadbutton
		If RectsOverlap(0,GraphicsHeight()-12,150,12,MouseX(),MouseY(),1,1) Then
			Color 0,255,0
			If MHit Then LAMA_SendCountRequest()
		Else
			Color 255,255,255
		EndIf
		Text 75,GraphicsHeight()-12,"Reload",1,0
		Rect 0,GraphicsHeight()-12,150,15,0
		Color 255,255,255
	EndIf
	
	;Nachrichtenanzeige
	i=0
	For M.Message=Each Message
		Text 0,12+i*12,M\Message$
		i=i+1
		M\Count=M\Count+1
		If M\Count=1800 Then Delete M.Message
	Next
	
	WaitTimer Timer
	Flip 0
Wend
LAMA_CloseServer()
End

Type Message
	Field Message$,Count%
End Type
Type Player
	Field ID%
	Field Mesh%,CameraPivot%,AlignPivot%,X#,Y#,Z#,Speed#,RSpeed#
	Field MDown,Klicks
End Type
Function CColor(C#,ReturnColor,Br#=1.0)
	Local R,G,B
	C#=C#*360 Mod 360
	Local CP#=(C# Mod 60)/60.0
	If C#=&gt;000 And C#&lt;060 Then
		R=255
		G=255*CP#
	ElseIf C#=&gt;060 And C#&lt;120
		R=255*(1-CP#)
		G=255
	ElseIf C#=&gt;120 And C#&lt;180
		G=255
		B=255*CP#
	ElseIf C#=&gt;180 And C#&lt;240
		G=255*(1-CP#)
		B=255
	ElseIf C#=&gt;240 And C#&lt;300
		R=255*CP#
		B=255
	ElseIf C#=&gt;300 And C#&lt;360
		R=255
		B=255*(1-CP#)
	EndIf
	If ReturnColor=1 Then Return R*Br#
	If ReturnColor=2 Then Return G*Br#
	If ReturnColor=3 Then Return B*Br#
End Function
;~IDEal Editor Parameters:
;~F#10A
;~C#Blitz3D
</textarea><br><br><br><br><br><a href="http://www.blitzforum.de/forum/viewtopic.php?p=410348#410348" target="_blank">2) SimpleUDP 3.1</a> Which I'm wrestling with now.<br><img src="http://i60.tinypic.com/2rgi7io.jpg"><br><br>From analyzing the examples I know how to set it up so that the 1st player also becomes the host and every other player who joins will be a client, so that they can join and leave at will.<br> <br><b>* However I want to make it so that in let's a say a LAN group of 5 players of which Player1 is the host, that when he decides to leave, the other 4 players can continue playing unnoticed by making Player2 the new host. <i>Does any body know if this is possible at all?</i></b><br><br><br>I like to think this should be fairly easy, but due to lack of documentation, experience and knowledge I'm struggling to make it work. <br><br>Under the mainloop I've added the bit below ";End Session"<br><pre class=code>
...
	WaitTimer(timer)
	
Until(KeyHit(1))

;End Session
; If player that is leaving is also HOST Then make next client host..

If clientCount &gt; 0 Then 
	If UDP_SessionHostID = UDP_ClientID Then
		UDP_SessionChangeHost%( UDP_ClientID+1 )
		Text 0, 0, "changing host.. " 
		Delay 2000
		
	EndIf		
EndIf 

UDP_SessionDisconnect()
End 
</pre><br><br>Full code and adaption of "Sample #11 - Verbinden.bb" below:<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">

Include "Include\SimpleUDP3.bb"

SeedRnd MilliSecs()

Graphics 400, 300, 16, 2
;Graphics3D 800, 600, 16, 2
AppTitle "Game Host/Client"
SetBuffer BackBuffer( )


;Set Message Const for own Message-Header
Const MYHEADER_SendPosition 	= 1
Const MYHEADER_SendFill			= 2

Global MaxRateFactor# = 100.0




;Simple Player Type for save some Player Data for each client
Type TPlayer
	Field clientID
	Field xPos
	Field yPos
	Field zPos
	Field fill
End Type

;Array of TPlayer -&gt; direct access with the clientID
Dim PlayerList.TPlayer(0)


Local sessionMaxClients 	= 3;16
Local sessionNetMode 		= NETSESSION  ;Net mode (LANSESSION / NETSESSION -&gt; LAN-Session, Internet-Session)
Local sessionPort 			= 5000 ;Should be different than 0, otherwise the Session would get an random port 
Local sessionConnectTimeOut	= 2000 ;ms

;=========== Selecting Host / Client ============


Print "1 - LAN 'Local Area Network' (Via your local network)"
Print "2 - WAN 'Wide  Area Network' (Via the internet)"

Local networktype = Input( "&gt; " )
If networktype = 1 Then 
	sessionNetMode = LANSESSION
	Print "Selected: 1 - LAN":Print sessionNetMode  :Delay 1000
	NetWorkmode$= "Local   (LAN)"
Else
	sessionNetMode = NETSESSION 
	Print "Selected: 2 - WAN":Print sessionNetMode  :Delay 1000
	NetWorkmode$= "Internet(WAN)"
EndIf 



Print "(1) - Host Session"
Print "(2) - Join Session"
Local hostInput = Input("&gt; ")

If(hostInput=1)Then ; so if host..
	
	;Create a new Session
	UDP_SessionCreate( sessionMaxClients, sessionNetMode, sessionPort )
	
Else ; so if join..
	Local connectIP$ = "127.0.0.1"+":"+sessionPort
	
	;Search for LAN Sessions
	;Last Parameter (TimeOut):
	;value &gt;= 0 -&gt; Timeout [ms]
	;value &lt;  0 -&gt; Wait for the number of servers (Example: -2 -&gt; Wait for 2 Servers)
	
	Local sessionList = UDP_MasterGetServerList( sessionNetMode, sessionPort, -1 )
	
	If(sessionList=0)Then ; no servers found..
		Print "Found no Sessions. Please write the IP-Adress"
		Print "of the session you want to connect."
		Print "Form: XXX.XXX.XXX.XXX:PORT"
		connectIP = Input("&gt; ")
		
	Else ; if sessionlist&gt;1
		;Count all found server
		Local sessionCount = UDP_MasterCountServer( sessionList )
		Print "Sessions found: "+sessionCount
		
		;Print all found IP adresses
		Print "Select session from list:
		For i=1 To sessionCount
			;Get a String with this Format : XXX.XXX.XXX.XXX:PORT of all found sessions
			Print "("+i+") IP: "+UDP_MasterGetServerData( sessionList, i )
		Next 
		Local sessionID = Input("Session ID: ")
		If(sessionID&lt;1)Then sessionID=1
		If(sessionID&gt;sessionCount) Then sessionID=sessionCount
		
		;Get the data of the selected session  
		connectIP = UDP_MasterGetServerData( sessionList, sessionID )
	EndIf 
	
	;Connect with Session
	;connectIP with format: XXX.XXX.XXX.XXX:PORT
	;if connectIP looks like this: XXX.XXX.XXX.XXX then the SessionConnect function take the sessionPort value
	UDP_SessionConnect( connectIP, sessionPort )
	
	;Wait for connection
	;Set timer:
	Local waitConnectTimer = MilliSecs() + sessionConnectTimeOut
	Repeat
		;Update Session to connect with host
		UDP_SessionUpdate()
		
		;Get all Events 
		While UDP_GetEvent( )
			Select UDP_GetEventData
				Case EVENT_CantConnect ;Could't connect to Host
					;Get Reason why you could't connect
					Select UDP_GetEventInfo
						Case FullSession
							RuntimeError( "Too many clients in this session!" ): Delay 1000					Delay 1000
						Case ClientBanned
							RuntimeError( "You were banned from this session!" ): Delay 1000
						Default
							RuntimeError( "Connection Failed !" ):Delay 1000
					End Select
				Case EVENT_Connected ;Could connect to Host
					Exit 
			End Select 
		Wend 
	Until waitConnectTimer &lt; MilliSecs() Or UDP_SessionConnected
	
	;If timout (Host didn't response)
	If(UDP_SessionConnected=0)Then
		RuntimeError( "Connection Timeout" )
	EndIf 
EndIf


;Resize the Array to save all players
Dim PlayerList.TPlayer( UDP_MaxClients-1 )

;Get all connected player in this Session and create players 
Local clientCount = UDP_SessionCountClients()
For i=1 To clientCount
	;Get ID from client
	Local clientID = UDP_SessionGetClientID( i )
	
	;Create player and save it to its ID
	PlayerList( clientID ) = CreatePlayer( clientID )
Next 


;Create Timer
Local timer = CreateTimer(60)

;Create Stats array
Dim Stats#( 99, 1 )


;Select Session Type and set Apptitle
Select UDP_SessionHost
	Case CLIENT
		AppTitle("CLIENT")
	Case HOST
		AppTitle("HOST")
End Select 	

;---------- MAINLOOP -----------

Repeat
	
	;Updates Session 
	;Receives messages, sends messages and manages the clients
	;ATTENTION: MUST BE CALLED IN THE MAIN-LOOP otherwise u can't create a connection between to applications
	UDP_SessionUpdate()
	
	;Check if the Session is still online
	If(UDP_SessionConnected=False)Then 
		RuntimeError("Connection lost!")
		;reconnect 
		;check
		clientCount = UDP_SessionCountClients()
		
		
	EndIf 
	
	
	;Gets all new events of the session 
	;TIP: Call the UDP_GetEvent() function with a While-Wend-Loop, so all events which occurs in this 
	;frame will be handled
	While UDP_GetEvent( )
		Select UDP_GetEventData
			Case EVENT_NewClient		;Occurs if a new client joined the session
				;Get ID of the connected client
				clientID = UDP_GetEventSource
				;Check if the new playerID is available
				If(PlayerList(clientID)=Null)Then	
					;Create new Player
					PlayerList(clientID) = CreatePlayer(clientID)
				EndIf
				;Update Client Count
				clientCount = UDP_SessionCountClients()
			Case EVENT_ClientLeft, EVENT_ClientKicked			;Occurs if a client left the session (or get kicked -&gt; EVENT_ClientKicked)
				;Get ID of the connected client
				clientID = UDP_GetEventSource
				
				;Check if the player exists
				If(PlayerList(clientID)&lt;&gt;Null)Then	
					Delete PlayerList(clientID)
				EndIf 
				;Update Client Count
				clientCount = UDP_SessionCountClients()
			Case EVENT_ChangeHost 		;Occurs if the host want to change
				
			Case Event_ChangedHost 	;Occurs if the host IS changed
				If UDP_SessionHostID = UDP_ClientID Then
					AppTitle("HOST"):Delay  2000
				EndIf
		End Select 
	Wend 
	
	
	;Receive all messages
	;TIP: Call the UDP_RecvMsg() function with a While-Wend-Loop, otherwise it can produce
	;some big lags
	While UDP_RecvMsg()
		;Get the Header of the Message
		Select UDP_MsgHeader()
			Case MYHEADER_SendPosition
				;Read client ID
				clientID = UDP_MsgFromID()
				
				;Read message content (Same order which you send)
				Local xPos = UDP_rInt()
				Local yPos = UDP_rInt()
				Local zPos = UDP_rInt()
				If(PlayerList(clientID)&lt;&gt;Null)Then 
					PlayerList(clientID)\xPos = xPos
					PlayerList(clientID)\yPos = yPos
					PlayerList(clientID)\zPos = zPos
					
				EndIf 
			Case MYHEADER_SendFill
				;Read client ID
				clientID = UDP_MsgFromID()
				
				;Read message content (Same order which you send)
				Local fill = UDP_rByte()
				If(PlayerList(clientID)&lt;&gt;Null)Then 
					PlayerList(clientID)\fill = fill
				EndIf 
		End Select
	Wend 	
	
	;Update my Position (UDP_ClientID-&gt; Own ID)
	PlayerList(UDP_ClientID)\xPos = MouseX()
	PlayerList(UDP_ClientID)\yPos = MouseY()
	PlayerList(UDP_ClientID)\zPos = MouseZ()
	
	If(MouseHit(1))Then 
		PlayerList(UDP_ClientID)\fill = Not PlayerList(UDP_ClientID)\fill
		
		;Send changed fill-status
		;Write status
		UDP_wByte( PlayerList(UDP_ClientID)\fill )
		
		;Send the Message
		;Parameter: 
		;- Header (Byte, value between 0 and 255)
		;- clientID (default: SENTO_All-&gt;Send Message to all clients, SENDTO_Host-&gt;Send Message only to host,
		;		     a ClientID-&gt;Send Message to a specified client)
		;- SendMode (SEND_Normal: Fastest sendmode, but u can't be sure the message will be received,
		;            SEND_Extend: Slower sendmode, but u can be sure the message will be received)
		UDP_SendMsg( MYHEADER_SendFill, SENDTO_All, SEND_Extend )
	EndIf 
	
	
	;Send my own Player Position(UDP_ClientID-&gt; Own ID)
	;Write all data into the Message
	UDP_wInt( PlayerList(UDP_ClientID)\xPos )
	UDP_wInt( PlayerList(UDP_ClientID)\yPos )
	UDP_wInt( PlayerList(UDP_ClientID)\zPos )
	
	;Send the Message
	UDP_SendMsg( MYHEADER_SendPosition, SENDTO_All, SEND_Normal )
	
	;Update Stats
	AddStats()
	
	DrawAllPlayers()
	
	;~~~~~~~~~~~~~~~~~~~~~~~~	
	;Display Client-Infos
	If clientCount &gt; 0 Then 
		Color 255, 255, 255
		For i = 1 To clientCount
			tmpID = UDP_SessionGetClientID( i )
			tmpHostMsg = ""
			If UDP_SessionHostID = tmpID Then tmpHostMsg = tmpHostMsg + " [Host]" 
			If UDP_ClientID = tmpID Then tmpHostMsg = tmpHostMsg + " [Me]"
			Text 0, (i-1)*13,i+")" + ", ID: " + tmpID + ", IP+Port: "+DottedIP( UDP_SessionGetClientIP( tmpID ) )+":"+UDP_SessionGetClientPort( tmpID ) +" ("+UDP_SessionGetClientPing( tmpID )+"ms)"+tmpHostMsg 
		Next 
	EndIf 
	
	;~~~~~~~~~~~~~~~~~~~~~~~~	
	;Display stats
	For i = 0 To 99
		Color 255, 0 ,0 : Rect 301+i, 200, 1, Stats( i, 0 )/MaxRateFactor*50.0, 1 
		Color 0, 255, 0 : Rect 301+i, 300-Stats( i, 1 )/MaxRateFactor*50.0, 1, Stats( i, 1 )/MaxRateFactor*50.0, 1
		
	Next 
	Color 255, 255, 255
	Text 0, 200, "Network  : "+NetWorkmode$ 
	Text 0, 213, "Download : "+UDP_DownloadRate+" Bytes"
	Text 0, 226, "Upload   : "+UDP_UploadRate  +" Bytes"
	;~~~~~~~~~~~~~~~~~~~~~~~~	
	
	Flip(0)
	Cls
	
	WaitTimer(timer)
	
Until(KeyHit(1))

;End Session
; If player that is leaving is also HOST Then make next client host..

If clientCount &gt; 0 Then 
	If UDP_SessionHostID = UDP_ClientID Then
		UDP_SessionChangeHost%( UDP_ClientID+1 )
		Text 0, 0, "changing host.. " 
		Delay 2000
		
	EndIf		
EndIf 



UDP_SessionDisconnect()
End 


Function CreatePlayer.TPlayer( clientID )
	Local tmp.TPlayer = New TPlayer
	tmp\clientID = clientID
	tmp\xPos = 0
	tmp\yPos = 0
	tmp\zPos = 0
	tmp\fill = False
	Return tmp
End Function 

Function DrawAllPlayers()
	Local tmp.TPlayer
	Color 255, 255, 255
	For tmp = Each TPlayer
		Oval( tmp\xPos-5, tmp\yPos-5, 10, 10, tmp\fill )
	Next 
End Function 

Function AddStats( )
	Local i
	;UploadRate / DownloadRate sind von der SimpleUDP3.0 bereitgestellte Globale, 
	;die den Traffic (Vekehr) der Daten in Byte pro "UpdateSession"-Aufruf speichern.
	;DownloadRate -&gt; Wie viele Bytes empfangen wurden
	;UploadRate   -&gt; Wie viele Bytes gesendet wurden
	Local maxRate# = 0
	
	For i = 0 To 98
		If UDP_DownloadRate &gt; 0 Then Stats( i, 0 ) = Stats( i+1, 0 )
		If UDP_UploadRate &gt; 0 Then Stats( i, 1 ) = Stats( i+1, 1 )
		If Stats( i, 0 ) &gt; maxRate Then maxRate = Stats( i, 0 )
		If Stats( i, 1 ) &gt; maxRate Then maxRate = Stats( i, 1 )
	Next 
	If UDP_DownloadRate &gt; 0 Then Stats( 99, 0 ) = UDP_DownloadRate 
	If UDP_UploadRate &gt; 0 Then Stats( 99, 1 ) = UDP_UploadRate
	If UDP_DownloadRate &gt; maxRate Then maxRate = UDP_DownloadRate
	If UDP_UploadRate &gt; maxRate Then maxRate = UDP_UploadRate
	MaxRateFactor = maxRate
End Function 
</textarea><br><br>If anybody knows the answer to this, I'dd be happy to hear it. Thanks. <br><br></td></tr></table><br>
<a name="1272662"></a>

<a name="1272676"></a>

<a name="1272677"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>the other 4 players can continue playing unnoticed by making Player2 the new host. Does any body know if this is possible at all<br> <br></div><br>I have never used any of these libs, but i suppose that the idea would be to keep a list of the "active' players (those who have sent a packet recently), and to choose which one will host the game.<br><br>But personally, i would separate the clients and the server so that the number of active players does not matter, the game is updated the same way on all computers, and the players can't cheat. <br><br></td></tr></table><br>
<a name="1272745"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Indeed not many people came across these libraries/used them in this fashion I guess. Hmm, guess I'll need to dig deeper and experiment some more for documentation is sparse. <br><br></td></tr></table><br>
<a name="1276380"></a>

<a name="1276381"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm, stumbled upon another library: NetBlitz<br><img src="http://dawp.tripod.com/netblitz3d.PNG"><br>Download here: <a href="http://dawp.tripod.com/netblitz.htm" target="_blank">http://dawp.tripod.com/netblitz.htm</a><br>Seems to work rather well, but appears only 2 player, or at least in the 3d example above. Nevertheless, a nice piece of code. <br><br></td></tr></table><br>
<a name="1276384"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >stayne</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Going down the confusing rabbit hole of trying to decipher someone else's network code is a dark one.  Gooooooooooood luck. <br><br></td></tr></table><br>
<a name="1276456"></a>

<a name="1276457"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hehehe, so true man. But.. Networking stuff is a pretty complex beast, I do not intend to re-invent the wheel, plus it's way beyond my current skillset, so I'm kinda depended on a library like this.<br>Also it gives good indication of what's possible and how by studying the examples. <br><br></td></tr></table><br>
<a name="1276461"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >vektorDex</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> You could also look into BPLite. I've been working off this for Sirius Online and it works marvellous. Can't find the thread here though. Afair it supports switching hosts on the fly, but I deleted that part as its unneeded ;)<br>The Demo of it is 2D, but its fairly easy to adapt it to support 3D in all kinds. <br><br></td></tr></table><br>
<a name="1276464"></a>

<a name="1276481"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the advice vektorDex, that sounds really promising. I'll look into it.<br>Do you know of an example of the <i>host-switching-on-the-fly</i> feature that I can study to know which commands to use in order to make it work?<br>Documentation of BPLite is fairly limited. <br><br></td></tr></table><br>
<a name="1276573"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Or: does anyone have a more extensive documentation? <br><br></td></tr></table><br>
<a name="1279843"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RustyKristi</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey Rick,<br><br>I'm curious on how did you get the LamaNet example above running?<br><br>Using 1.6, I'm getting 'parameter must be positive value' error<br><br>When using 2.0, it runs but I don't see any servers on the list while I already started a server before in a new window. <br><br></td></tr></table><br>
<a name="1279910"></a>

<a name="1279912"></a>

<a name="1279913"></a>

<a name="1279914"></a>

<a name="1279915"></a>

<a name="1279917"></a>

<a name="1279918"></a>

<a name="1279919"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Rusty,<br><br>I remember at first I had some issues with it too, but can't really recall what exactly. I believe it had something to do with upgrading the 1.6 to 2.0. <br><br>For as far as I can remember all I did is:<br>1)copy the file LamaNet2.decls from the 2.0 into the Blitz decls folder, for me under windows10 x64 in: "C:\Program Files (x86)\Blitz3D\userlibs\"<br>2)copy LamaNet2.bb from the "LamaNet 2\include\" folder to the 1.6 include folder and reference to it in the code as such(see code below also):<br><i>Include "include\LamaNet2.bb"</i> (Otherwise it will just take the old file in the same directory)<br>BTW: The slight name change "A" to "a" between 1.6's "LAmaNet.bb"  and 2.0's "LamaNet2.bb" might be the cause. It's kinda easy to mis.<br><br><b>LAmaNet_Example09_3D-Environment.bb</b><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
SeedRnd MilliSecs()
Graphics3D 640,480,0,2
SetBuffer BackBuffer()

Local i%,MHit%,M.Message,P.Player
Local Direction%,File$

Global MaxPlayers%=5

Local Font=LoadFont("Verdana",12,0,0,0):SetFont Font

;Include "LAmaNet2.bb"
Include "include\LamaNet2.bb"

;3D-Umgebung
Local Textur=CreateTexture(128,128)
SetBuffer TextureBuffer(Textur)
Color 32,32,32
Rect 1,1,64,64
Rect 64,64,64,64
ScaleTexture Textur,4,4
SetBuffer BackBuffer()
Color 255,255,255

Local Plane=CreatePlane()
PositionEntity Plane,0,-1,0
EntityTexture Plane,Textur



Local C#=Rnd(0,1)
Local R=CColor(C#,1)
Local G=CColor(C#,2)
Local B=CColor(C#,3)
Local RTemp,GTemp,BTemp

Local Radius#=5.0
Local CameraFlow#=0.1,DX#,DY#,DZ#
Local Camera=CreateCamera()
PositionEntity Camera,0,4,-5
RotateEntity Camera,35,0,0
;Nebel
CameraFogMode Camera,1
CameraFogColor Camera,0,0,0
CameraFogRange Camera,5,50
;Licht
Local Light=CreateLight()
RotateEntity Light,50,70,0

;Spielersystem
Dim Player(MaxPlayers%);erster Type bleibt EInfachheitshalber frei (für Fortgeschrittene einfach MaxPlayers%-1)
For i=1 To MaxPlayers%
	P.Player=New Player
	P\ID%=i
	P\Mesh%=CreateCube()
	P\CameraPivot%=CreatePivot(P\Mesh%):PositionEntity P\CameraPivot,0,4,-8
	P\AlignPivot%=CreatePivot(P\Mesh%):PositionEntity P\AlignPivot%,0,0,+6
	RotateEntity P\Mesh%,0,i*75,0
	PositionEntity P\Mesh%,Radius#*Cos(i*75),0,Radius#*Sin(i*75)
	EntityAlpha P\Mesh,0.5
	
	
	Player(i)=Handle(P.Player)
Next

Local ServerOrClient=Input("Server erstellen(1) - Server suchen(2)")
Select ServerOrClient
	Case 1
		If LAMA_HostServer("LAmaNet - Testserver",MaxPlayers%,"Lama")=0 Then End
	Case 2
		If LAMA_StartCountServers()=0 Then End
	Default
		End
End Select

Local Tact%,InputText$,Sign$
Local Timer=CreateTimer(60)


FlushKeys
While Not KeyHit(1)
	Cls
	
	MHit=MouseHit(1)
	LAMA_Update()
	
	While LAMA_Event()
		Select LAMA_EventID
			Case LAMA_Connected
				;Spieler-einstellungen
				P.Player=Object.Player(Player(LAMA_MasterID))
				EntityColor P\Mesh,R,G,B
				EntityAlpha P\Mesh,1
				;eigene-daten-senden
				LAMA_Send(0,20,R)
				LAMA_Send(0,20,G)
				LAMA_Send(0,20,B)
			Case LAMA_Joined;neuer-spieler-schickt-eigene-daten
				M.Message=New Message
				M\Message$="Spiel beigetreten"
			Case LAMA_NewPlayer;server-schickt-daten-der-spieler-an-neuen-spieler
				M.Message=New Message
				M\Message$=LAMA_Name(LAMA_EventPlayerID)+" beigetreten"
				;eigene-daten-senden
				LAMA_Send(LAMA_EventPlayerID,20,R)
				LAMA_Send(LAMA_EventPlayerID,20,G)
				LAMA_Send(LAMA_EventPlayerID,20,B)
			Case LAMA_CountRequest;server-erhält-counter-server-request
				M.Message=New Message
				M\Message$="Clientanfrage erhalten"
			Case LAMA_ServerFull;pc-erhält-server-full-information
				M.Message=New Message
				M\Message$="Server voll"
			Case LAMA_PlayerLeft%
				M.Message=New Message
				M\Message$="Spieler "+LAMA_Name(LAMA_EventPlayerID)+" hat das Spiel verlassen."
				;daten-des-spielers-zurücksetzen
				P.Player=Object.Player(Player(LAMA_EventPlayerID))
				EntityColor P\Mesh,255,255,255
				EntityAlpha P\Mesh,0.5
				RotateEntity P\Mesh%,0,P\ID%*75,0
				PositionEntity P\Mesh%,Radius#*Cos(P\ID%*75),0,Radius#*Sin(P\ID%*75)
			Case LAMA_ServerLeft%
				M.Message=New Message
				M\Message$="Server hat das spiel verlassen - Verbindung getrennt!"
		End Select
	Wend
	
	If LAMA_Connection Then;wenn-verbindung-noch-nicht-hergestellt
		P.Player=Object.Player(Player(LAMA_MasterID))
		
		;Camera-und-Objekt-bewegen
		DX#=(EntityX(P\CameraPivot,1)-EntityX(Camera,1))*CameraFlow#
		DY#=(EntityY(P\CameraPivot,1)-EntityY(Camera,1))*CameraFlow#
		DZ#=(EntityZ(P\CameraPivot,1)-EntityZ(Camera,1))*CameraFlow#
		TranslateEntity Camera,DX#,DY#,DZ#
		DX#=EntityX(P\AlignPivot,1)-EntityX(Camera,1)
		DY#=EntityY(P\AlignPivot,1)-EntityY(Camera,1)
		DZ#=EntityZ(P\AlignPivot,1)-EntityZ(Camera,1)
		AlignToVector Camera,DX#,DY#,DZ#,3,CameraFlow#
		If KeyDown(200) Then P\Speed#=P\Speed#+0.01
		If KeyDown(208) Then P\Speed#=P\Speed#-0.01
		If KeyDown(203) Then P\RSpeed#=P\RSpeed#+0.1
		If KeyDown(205) Then P\RSpeed#=P\RSpeed#-0.1
		P\Speed#=P\Speed#*0.95
		P\RSpeed#=P\RSpeed#*0.95
		MoveEntity P\Mesh,0,0,P\Speed#
		TurnEntity P\Mesh,0,P\RSpeed#,0
		TurnEntity Camera,0,0,-EntityRoll(Camera)*CameraFlow#
		;daten-senden
		LAMA_Send(0,1,EntityX(P\Mesh))
		LAMA_Send(0,1,EntityY(P\Mesh))
		LAMA_Send(0,1,EntityZ(P\Mesh))
		LAMA_Send(0,1,EntityYaw(P\Mesh))
		
		;empfangsschleife
		While LAMA_Recv()
			P.Player=Object.Player(LAMA_From)
			Select LAMA_MsgID
				Case 1
					P\X=LAMA_Read()
					P\Y=LAMA_Read()
					P\Z=LAMA_Read()
					PositionEntity P\Mesh,P\X,P\Y,P\Z
					RotateEntity P\Mesh,0,LAMA_Read(),0
				Case 20
					RTemp=LAMA_Read()
					GTemp=LAMA_Read()
					BTemp=LAMA_Read()
					EntityColor P\Mesh,RTemp,GTemp,BTemp
					EntityAlpha P\Mesh,1
			End Select
		Wend
		
		RenderWorld()
		
		;Spieler-anzeige
		For P.Player=Each Player
			If LAMA_Online(P\ID%) Then
				CameraProject Camera,EntityX(P\Mesh),EntityY(P\Mesh)+2.5,EntityZ(P\Mesh)
				If ProjectedZ()&gt;0 Then
					Text ProjectedX(),ProjectedY(),LAMA_Name(P\ID),1
					Text ProjectedX(),ProjectedY()+12,"Ping: "+LAMA_Ping(P\ID),1
				EndIf
			Else
				CameraProject Camera,EntityX(P\Mesh),EntityY(P\Mesh)+2.5,EntityZ(P\Mesh)
				If ProjectedZ()&gt;0 Then
					Text ProjectedX(),ProjectedY(),"Offline",1
				EndIf
			EndIf
		Next
		Text GraphicsWidth()-10,0,LAMA_MasterID
		
		Color 255,255,255
		Select LAMA_Mode
			Case 1;Server-schleife
				Text 0,0,"Server geöffnet"
			Case 2;Client-schleife
				If RectsOverlap(GraphicsWidth()-9,0,9,9,MouseX(),MouseY(),1,1) Then
					Color 0,255,0
					If MHit Then
						LAMA_CloseServer()
					EndIf
				Else
					Color 255,255,255
				EndIf
				Rect GraphicsWidth()-9,0,9,9,0
				Line GraphicsWidth()-9,0,GraphicsWidth(),10
				Line GraphicsWidth(),0,GraphicsWidth()-9,8
		End Select
		
	Else;verbindung-nicht-hergestellt
		Color 255,255,255
		Text 0,0,"erstelle Serverlist..."
		Text GraphicsWidth()/2,50,"Serverlist:",1
		For i=1 To LAMA_CountServers
			Text GraphicsWidth()/2,50+i*12,LAMA_ServerName$(i)+"("+LAMA_ServerPlayers(i)+"/"+LAMA_ServerMaxPlayers(i)+")"
			;Button
			If RectsOverlap(GraphicsWidth()/2-200,50+i*12,150,12,MouseX(),MouseY(),1,1) Then
				Color 0,255,0
				If MHit Then
					LAMA_JoinServer(i,"JoinLama")
				EndIf
			Else
				Color 255,255,255
			EndIf
			Text GraphicsWidth()/2-125,50+i*12,"Login",1,0
			Rect GraphicsWidth()/2-200,50+i*12,150,12,0
			Color 255,255,255
			;EndButton
		Next
		;Reloadbutton
		If RectsOverlap(0,GraphicsHeight()-12,150,12,MouseX(),MouseY(),1,1) Then
			Color 0,255,0
			If MHit Then LAMA_SendCountRequest()
		Else
			Color 255,255,255
		EndIf
		Text 75,GraphicsHeight()-12,"Reload",1,0
		Rect 0,GraphicsHeight()-12,150,15,0
		Color 255,255,255
	EndIf
	
	;Nachrichtenanzeige
	i=0
	For M.Message=Each Message
		Text 0,12+i*12,M\Message$
		i=i+1
		M\Count=M\Count+1
		If M\Count=1800 Then Delete M.Message
	Next
	
	WaitTimer Timer
	Flip 0
Wend
LAMA_CloseServer()
End

Type Message
	Field Message$,Count%
End Type
Type Player
	Field ID%
	Field Mesh%,CameraPivot%,AlignPivot%,X#,Y#,Z#,Speed#,RSpeed#
	Field MDown,Klicks
End Type
Function CColor(C#,ReturnColor,Br#=1.0)
	Local R,G,B
	C#=C#*360 Mod 360
	Local CP#=(C# Mod 60)/60.0
	If C#=&gt;000 And C#&lt;060 Then
		R=255
		G=255*CP#
	ElseIf C#=&gt;060 And C#&lt;120
		R=255*(1-CP#)
		G=255
	ElseIf C#=&gt;120 And C#&lt;180
		G=255
		B=255*CP#
	ElseIf C#=&gt;180 And C#&lt;240
		G=255*(1-CP#)
		B=255
	ElseIf C#=&gt;240 And C#&lt;300
		R=255*CP#
		B=255
	ElseIf C#=&gt;300 And C#&lt;360
		R=255
		B=255*(1-CP#)
	EndIf
	If ReturnColor=1 Then Return R*Br#
	If ReturnColor=2 Then Return G*Br#
	If ReturnColor=3 Then Return B*Br#
End Function
;~IDEal Editor Parameters:
;~F#10A
;~C#Blitz3D
</textarea><br><br>That all works fine at my system. <br>(I must point out though that I'm using Blitz3d updated to Version 1.106 to maintain compatibility with Fastlibs FastExt.dll. Above this it kinda breaks compatibility with this great dll, which is fixable using some workaround Yue got from the author MichaelV, but as this is working fine for me sofar I haven't bothered yet).<br><br>Firewalls/antivirus packages can be blocking things though, which can be annoying at times. I'm using Comodo Firewall in combo with Avast which can play up at times.<br><br>Also there's a little bug in this example: All players start out transparent. Joined players should become opaque instead of transparant and assigned a random color, which sometimes fails. As you can see in the screenshot below(left screen is host/1st player, right player2 and midscreen player3 that both joined, all running on my system at once, but also the same via wifi on 2 other systems):<br><img src="http://i59.tinypic.com/f5d2xl.jpg"><br>Right now the Host appears to be the only player who has all the cubes in colored opaque view(as should be to all). Also the colors are chosen randomly by the example program, which data in my opinion should have been transferred to all the players(just a matter of sending them the correct transparant/color values similar as x,y,z positions and playerID's), so that when player1 was assigned the color red it would always appear red to all players also, not another color to every player. But all this can be fixed imho using a different approach in the example code. This is pretty standard across all different network libs. <br><br>I have made a slightly modified version of the code below which contains a bit more English comments :-) and other things such as AppTitle so the player window is more easier to identify when running multiple instances on the same machine(which I btw can't do from IDEal, only the bog old standard Blitz3d IDE allows multiple executions apparently)<br><br><b>LAmaNet_Example09_3D-Environment2.bb</b><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
SeedRnd MilliSecs()
Graphics3D 640,480,0,2
SetBuffer BackBuffer()

Local i%,MHit%,M.Message,P.Player
Local Direction%,File$

Global MaxPlayers%=5
Global joinedid
Local Font=LoadFont("Verdana",12,0,0,0):SetFont Font

Include "include\LamaNet2.bb"


;3D-Environment
Local Textur=CreateTexture(128,128)
SetBuffer TextureBuffer(Textur)
Color 32,32,32
Rect 1,1,64,64
Rect 64,64,64,64
ScaleTexture Textur,4,4
SetBuffer BackBuffer()
Color 255,255,255

Local Plane=CreatePlane()
PositionEntity Plane,0,-1,0
EntityTexture Plane,Textur


;Initialize colors for the player
Local C#=Rnd(0,1)
Local R=CColor(C#,1)
Local G=CColor(C#,2)
Local B=CColor(C#,3)
Local RTemp,GTemp,BTemp

Local Radius#=5.0
Local CameraFlow#=0.1,DX#,DY#,DZ#
Local Camera=CreateCamera()
PositionEntity Camera,0,4,-5
RotateEntity Camera,35,0,0
;Fog
CameraFogMode Camera,1
CameraFogColor Camera,0,0,0
CameraFogRange Camera,5,50
;Light
Local Light=CreateLight()
RotateEntity Light,50,70,0

;Playersystem
Dim Player(MaxPlayers%);First Type remains free for ease of use (for experienced simply MaxPlayers%-1)
For i=1 To MaxPlayers%
	P.Player=New Player
	P\ID%=i
	P\Mesh%=CreateCube()
	P\CameraPivot%=CreatePivot(P\Mesh%):PositionEntity P\CameraPivot,0,4,-8
	P\AlignPivot%=CreatePivot(P\Mesh%):PositionEntity P\AlignPivot%,0,0,+6
	RotateEntity P\Mesh%,0,i*75,0
	PositionEntity P\Mesh%,Radius#*Cos(i*75),0,Radius#*Sin(i*75) ; position randomly
	EntityAlpha P\Mesh,0.5 
	
	Player(i)=Handle(P.Player)
Next

Local ServerOrClient=Input("Create server(will be host &amp; 1st player) - press [1]    Or   Find a server to Join(if available) - press [2]")
Select ServerOrClient
	Case 1
		If LAMA_HostServer("LAmaNet - Testserver",MaxPlayers%,"LamaHost")=0 Then End
	Case 2
		If LAMA_StartCountServers()=0 Then End
	Default
		End
End Select

Local Tact%,InputText$,Sign$
Local Timer=CreateTimer(60)
FlushKeys

;======================================MAIN===========================================================================

.mainloop
While Not KeyHit(1)
	Cls
	
	MHit=MouseHit(1)
	LAMA_Update()
	
	While LAMA_Event()
		Select LAMA_EventID ; check when net events happened
				
			Case LAMA_Connected ;check if still online/offline
				;Player-settings
				P.Player=Object.Player(Player(LAMA_MasterID))
				EntityColor P\Mesh,R,G,B
				EntityAlpha P\Mesh,1
;				;sending own data
				LAMA_Send(0,20,R)
				LAMA_Send(0,20,G)
				LAMA_Send(0,20,B)
				
			Case LAMA_Joined;new-player-sends it's own data
				M.Message=New Message
				M\Message$="Joined game"
				
			Case LAMA_NewPlayer;server-sends-data-of-player-to-new-player
				M.Message=New Message
				M\Message$=LAMA_Name(LAMA_EventPlayerID)+" Joined"
				joinedid=LAMA_EventPlayerID
				;eigene-daten-senden
				LAMA_Send(LAMA_EventPlayerID,20,R)
				LAMA_Send(LAMA_EventPlayerID,20,G)
				LAMA_Send(LAMA_EventPlayerID,20,B)
				
			Case LAMA_CountRequest;Server-receives-counter-server-request
				M.Message=New Message
				M\Message$="Receive client request"
			Case LAMA_ServerFull;PC-receives-server-full-information
				M.Message=New Message
				M\Message$="Server full"
			Case LAMA_PlayerLeft%
				M.Message=New Message
				M\Message$="Player "+LAMA_Name(LAMA_EventPlayerID)+" has left the game."
				;Return-data-of-players
				P.Player=Object.Player(Player(LAMA_EventPlayerID))
				EntityColor P\Mesh,255,255,255
				EntityAlpha P\Mesh,0.5
				RotateEntity P\Mesh%,0,P\ID%*75,0
				PositionEntity P\Mesh%,Radius#*Cos(P\ID%*75),0,Radius#*Sin(P\ID%*75)
			Case LAMA_ServerLeft%
				M.Message=New Message
				M\Message$="Server has left the game - Disconnected!"
		End Select
	Wend
	
	If LAMA_Connection Then;if connection-not-yet-made
		P.Player=Object.Player(Player(LAMA_MasterID))
		
		;move Camera-And-Objekt
		DX#=(EntityX(P\CameraPivot,1)-EntityX(Camera,1))*CameraFlow#
		DY#=(EntityY(P\CameraPivot,1)-EntityY(Camera,1))*CameraFlow#
		DZ#=(EntityZ(P\CameraPivot,1)-EntityZ(Camera,1))*CameraFlow#
		TranslateEntity Camera,DX#,DY#,DZ#
		DX#=EntityX(P\AlignPivot,1)-EntityX(Camera,1)
		DY#=EntityY(P\AlignPivot,1)-EntityY(Camera,1)
		DZ#=EntityZ(P\AlignPivot,1)-EntityZ(Camera,1)
		AlignToVector Camera,DX#,DY#,DZ#,3,CameraFlow#
		If KeyDown(200) Then P\Speed#=P\Speed#+0.01
		If KeyDown(208) Then P\Speed#=P\Speed#-0.01
		If KeyDown(203) Then P\RSpeed#=P\RSpeed#+0.1
		If KeyDown(205) Then P\RSpeed#=P\RSpeed#-0.1
		P\Speed#=P\Speed#*0.95
		P\RSpeed#=P\RSpeed#*0.95
		MoveEntity P\Mesh,0,0,P\Speed#
		TurnEntity P\Mesh,0,P\RSpeed#,0
		TurnEntity Camera,0,0,-EntityRoll(Camera)*CameraFlow#
		;send data
		LAMA_Send(0,1,EntityX(P\Mesh))
		LAMA_Send(0,1,EntityY(P\Mesh))
		LAMA_Send(0,1,EntityZ(P\Mesh))
		LAMA_Send(0,1,EntityYaw(P\Mesh))
		
		;receiving loop
		While LAMA_Recv()
			P.Player=Object.Player(LAMA_From)
			Select LAMA_MsgID
				Case 1
					P\X=LAMA_Read()
					P\Y=LAMA_Read()
					P\Z=LAMA_Read()
					PositionEntity P\Mesh,P\X,P\Y,P\Z
					RotateEntity P\Mesh,0,LAMA_Read(),0
				Case 20
					RTemp=LAMA_Read()
					GTemp=LAMA_Read()
					BTemp=LAMA_Read()
					EntityColor P\Mesh,RTemp,GTemp,BTemp
					EntityAlpha P\Mesh,1
			End Select
		Wend
		
		RenderWorld()
		
		
		;Show-players
		For P.Player=Each Player
			If LAMA_Online(P\ID%) Then
				CameraProject Camera,EntityX(P\Mesh),EntityY(P\Mesh)+2.5,EntityZ(P\Mesh)
				If ProjectedZ()&gt;0 Then
					Text ProjectedX(),ProjectedY(),LAMA_Name(P\ID),1
					Text ProjectedX(),ProjectedY()+12,"ID: "+P\ID%+", Ping: "+LAMA_Ping(P\ID),1 ;&lt;&lt;&lt;&lt;
				EndIf
			Else
				CameraProject Camera,EntityX(P\Mesh),EntityY(P\Mesh)+2.5,EntityZ(P\Mesh)
				If ProjectedZ()&gt;0 Then
					Text ProjectedX(),ProjectedY(),"Offline",1
				EndIf
			EndIf
		Next
		Text GraphicsWidth()-10,0,LAMA_MasterID
		
		Color 255,255,255
		Select LAMA_Mode
			Case 1;Server-loop
				Text 0,0,"Server opened"
				AppTitle "LamaHost "+ LAMA_MasterID ;&lt;&lt;&lt;&lt;
			Case 2;Client-schleife
				If RectsOverlap(GraphicsWidth()-9,0,9,9,MouseX(),MouseY(),1,1) Then
					Color 0,255,0
					If MHit Then
						LAMA_CloseServer()
					EndIf
				Else
					Color 255,255,255
					
				EndIf
				Rect GraphicsWidth()-9,0,9,9,0
				Line GraphicsWidth()-9,0,GraphicsWidth(),10
				Line GraphicsWidth(),0,GraphicsWidth()-9,8
		End Select
		
	Else;connection-not-made
		Color 255,255,255
		Text 0,0,"Creating Server List ..."
		Text GraphicsWidth()/2,50,"Serverlist:",1
		For i=1 To LAMA_CountServers
			Text GraphicsWidth()/2,50+i*12,LAMA_ServerName$(i)+"("+LAMA_ServerPlayers(i)+"/"+LAMA_ServerMaxPlayers(i)+")"
			;Button
			If RectsOverlap(GraphicsWidth()/2-200,50+i*12,150,12,MouseX(),MouseY(),1,1) Then
				Color 0,255,0
				If MHit Then
					LAMA_JoinServer(i,"JoinLama") 
					AppTitle "JoinLama(Client) " + LAMA_MasterID ;&lt;&lt;&lt;&lt;
				EndIf
			Else
				Color 255,255,255
			EndIf
			Text GraphicsWidth()/2-125,50+i*12,"Login",1,0
			Rect GraphicsWidth()/2-200,50+i*12,150,12,0
			Color 255,255,255
			;EndButton
		Next
		;Reloadbutton
		If RectsOverlap(0,GraphicsHeight()-12,150,12,MouseX(),MouseY(),1,1) Then
			Color 0,255,0
			If MHit Then LAMA_SendCountRequest()
		Else
			Color 255,255,255
		EndIf
		Text 75,GraphicsHeight()-12,"Reload",1,0
		Rect 0,GraphicsHeight()-12,150,15,0
		Color 255,255,255
	EndIf
	
	;Message display
	i=0
	For M.Message=Each Message
		Text 0,12+i*12,M\Message$
		i=i+1
		M\Count=M\Count+1
		If M\Count=1800 Then Delete M.Message
	Next
	
	WaitTimer Timer
	Flip 0
Wend

; &gt;&gt;&gt; HOSTSWITCHING PSEUDOCODE &lt;&lt;&lt;
; if this is the host then
; 	countplayers
; 	ping each player, using something like:
; 		For P.Player=Each Player 
;		pingspeed.player=LAMA_Ping(P\ID)
;       ...
; 	player with fastest ping will be new host
; 	broadcast new hostid
; 	switch this host to be player (client)
; end if


LAMA_CloseServer()
End


;==============================================================================================================================

Type Message
	Field Message$,Count%
End Type
Type Player
	Field ID%
	Field Mesh%
	Field CameraPivot%
	Field AlignPivot%
	Field X#,Y#,Z#
	Field Speed#,RSpeed#
    Field colorr,colorg,colorb
	Field MDown,Klicks
End Type
Function CColor(C#,ReturnColor,Br#=1.0)
	Local R,G,B
	C#=C#*360 Mod 360
	Local CP#=(C# Mod 60)/60.0
	If C#=&gt;000 And C#&lt;060 Then
		R=255
		G=255*CP#
	ElseIf C#=&gt;060 And C#&lt;120
		R=255*(1-CP#)
		G=255
	ElseIf C#=&gt;120 And C#&lt;180
		G=255
		B=255*CP#
	ElseIf C#=&gt;180 And C#&lt;240
		G=255*(1-CP#)
		B=255
	ElseIf C#=&gt;240 And C#&lt;300
		R=255*CP#
		B=255
	ElseIf C#=&gt;300 And C#&lt;360
		R=255
		B=255*(1-CP#)
	EndIf
	If ReturnColor=1 Then Return R*Br#
	If ReturnColor=2 Then Return G*Br#
	If ReturnColor=3 Then Return B*Br#
End Function
;~IDEal Editor Parameters:
;~C#Blitz3D
</textarea><br><br>Hope this helps.<br><br><b><i><u>Also below the results of my Multiplayer Option Investigation sofar tested on home network(LAN/WLAN):</u></i></b><br><br><b>1) DirectPlay</b> ; Tried 2d dots example, russian comments(unreadible).<br><u>Pros:</u> <br>-Build into Blitz.<br><u>Cons:</u> <br>-Undesirable as is using DXplay, which is being phased out by MS(and slow).<br><u>Conclussion:</u> Too slow( lagging, more slow than BPLite and obsolete)<br><br><br><b>2) BPLite</b> ; Mostly talked about on BlitzBasic.com, however more in depth info not avail. <br><u>Pros:</u> <br>-Has some docs, simple commandset and fairly easy to understand. <br>-With Multiple players continues to work even when host left. <br>Testresults BPDEMO:<br>-When host leaves, players can still continue to play, however no new players can join(as there's no host)<br>-There appears to be a jurk in movement here and there(timing issues?)<br>-colors where not correctly displayed: random on every new window.<br>-Entering the computername instead of IP also works.<br><u>Cons:</u> <br>-Appears fast at first, but noticed a lag in the 2d example.(too much).<br>-Lacks commands, can't switch hosts(well, according to someone it can and appears feasible after some studying).<br>-Was able to connect to other syst on LAN only by manually entering IP. <br>-For more than 2 players(host/client) had to manually enter another portnr also when trying the included examples.<br><u>Conclusion:</u> Lagging, lacking more advanced commands so would need to build myself, which would probably require delving deep into UDP /networking tech.<br><br><b>3) SimpleUDP V2.0/3.0/3.01</b> ; German made solution, with lot's of commands.<br><u>Pros:</u> <br>-Has a very extensive commandset.<br><u>Cons:</u> <br>-Requires running a precompiled MasterServer for it to work over internet?(not for older versions I believe).<br>-Not free for commercial usage.<br>-No docs, only couple of examples. No 3d example to test performance immediately.<br><u>Conclusion:</u> Need to recheck with older version and a 3d converted example.<br><br>		<br><b>4) LAmaNet V1.6/2.0</b> ; 3d car like example is pretty smooth(server is also player). Appears most suitable for LAN party. Have to check transparancy/color bug and Pong example in docs: <br>on WLAN worked fine, not when ran on another system that was on LAN(can't connect) but this has an additional router in between so could be explained. <br><u>Pros:</u> <br>-Very quick, didn't notice any lag. Nice command set.<br><u>Cons:</u> <br>-Appears to not always being able to find the server automatically, unclear why, possibly firewall issues for at moment no longer failing.<br>-Lacking more detailed docs and is in German(version 3.0 was never finished by the author due to other work he was doing, so docs are bit limited).<br>-Not sure how to switch Host/servers when the host leaves(yet).<br><u>Conclusion:</u> Appears for now this is the most suitable candidate.<br><br>TODO:<br>1) check if can connect to another system OK over the LAN/internet using   an manually provided IP/Port and what's required for that.<br>2) Try Pong example(from the manual pdf, appears bit outdated when compared to newer 3d example though).<br>3) See if can switch hosts(should be possible according to creator and a German user I briefly had contact with).<br><br>Grtz, <br><br>Rick <br><br></td></tr></table><br>
<a name="1279922"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RustyKristi</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Rick! will try this out and let you know my results asap :-) <br><br></td></tr></table><br>
<a name="1279923"></a>

<a name="1279924"></a>

<a name="1279925"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RustyKristi</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm still getting the same results, I already followed your instructions and copied the last code set above with the translation. Here's the client screen without any listed servers.. :/<br><br><img src="http://i.imgur.com/ONGIGrG.jpg"><br><br><br><br>Server part:<br><br><img src="http://i.imgur.com/Bp68afj.png"> <br><br></td></tr></table><br>
<a name="1279927"></a>

<a name="1279928"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RustyKristi</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm using a router btw and running both on the same computer, do you think this has something to do with the problem?<br><br>Using 1.106 as well for future use with Fastext :-) <br><br></td></tr></table><br>
<a name="1279929"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RustyKristi</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Having read this post that you guys have discussed, I'm assuming that it does not work with Internet (WAN)?<br><br><a href="http://www.blitzforum.de/forum/viewtopic.php?t=40330&amp;highlight=lamanet" target="_blank">http://www.blitzforum.de/forum/viewtopic.php?t=40330&amp;highlight=lamanet</a><br><br><div class="quote"> <br>Hello, I had a lot of contact with chrise. Just now there were many problems with the master and client. In the lan everything still works great but once it went into the WAN (Internet) there were several errors.<br> <br></div> <br><br></td></tr></table><br>
<a name="1279984"></a>

<a name="1279986"></a>

<a name="1279987"></a>

<a name="1279989"></a>

<a name="1279990"></a>

<a name="1279991"></a>

<a name="1279992"></a>

<a name="1279993"></a>

<a name="1279995"></a>

<a name="1279996"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ah, missed that reply, was about the time I got my burnout.<br><br>Hmm, that gives a lot of stuff to think about. Debugging this would be a pain. However it does work on my WLAN. Perhaps your firewall(s) do not allow it? Did you try creating an executable, run that as admin on your LAN without firewalls((disconnected the internet cable first)?<br><br>When I run it I'm getting messages from Avast(deepscan), Comodo(allow access? x3) and oddly enough the Windows 10 firewall too, which should be off as I already have Comodo on(weird behavier).<br><br>Also did some little experiments(which do not make a lot of sense) with this one:<br><b>LAmaNet_Example09_3D-Environment3.bb</b><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; This version appears to find server more easily, but more coloring/transparency issues. Communication for x,y,z all perfect though.

SeedRnd MilliSecs()
Graphics3D 640,480,0,2
SetBuffer BackBuffer()

Local i%,MHit%,M.Message,P.Player
Local Direction%,File$

Global MaxPlayers%=5
Global joinedid
Local Font=LoadFont("Verdana",12,0,0,0):SetFont Font

Include "include\LamaNet2.bb" ;Include "LAmaNet.bb" ;&lt;&lt;&lt;


;3D-Environment
Local Textur=CreateTexture(128,128)
SetBuffer TextureBuffer(Textur)
Color 32,32,32
Rect 1,1,64,64
Rect 64,64,64,64
ScaleTexture Textur,4,4
SetBuffer BackBuffer()
Color 255,255,255

Local Plane=CreatePlane()
PositionEntity Plane,0,-1,0
EntityTexture Plane,Textur


;Initialize colors for the player
Local C#=Rnd(0,1)
Local R=CColor(C#,1)
Local G=CColor(C#,2)
Local B=CColor(C#,3)
Local RTemp,GTemp,BTemp
Local Alp=01

Local Radius#=5.0
Local CameraFlow#=0.1,DX#,DY#,DZ#
Local Camera=CreateCamera()
PositionEntity Camera,0,4,-5
RotateEntity Camera,35,0,0
;Fog
CameraFogMode Camera,1
CameraFogColor Camera,0,0,0
CameraFogRange Camera,5,50
;Light
Local Light=CreateLight()
RotateEntity Light,50,70,0

;Playersystem
Dim Player(MaxPlayers%);First Type remains free for ease of use (for experienced simply MaxPlayers%-1)
For i=1 To MaxPlayers%
	P.Player=New Player
	P\ID%=i
	P\Mesh%=CreateCube()
	P\CameraPivot%=CreatePivot(P\Mesh%):PositionEntity P\CameraPivot,0,4,-8
	P\AlignPivot%=CreatePivot(P\Mesh%):PositionEntity P\AlignPivot%,0,0,+6
	RotateEntity P\Mesh%,0,i*75,0
	PositionEntity P\Mesh%,Radius#*Cos(i*75),0,Radius#*Sin(i*75) ; position randomly
	P\Alp=0.5
	EntityAlpha P\Mesh,P\Alp 
	
	Player(i)=Handle(P.Player)
Next

Local ServerOrClient=Input("Create server(will be host &amp; 1st player) - press [1]    Or   Find a server to Join(if available) - press [2]")
Select ServerOrClient
	Case 1
		If LAMA_HostServer("LAmaNet - Testserver",MaxPlayers%,"LamaHost")=0 Then End
	Case 2
		If LAMA_StartCountServers()=0 Then End
	Default
		End
End Select

Local Tact%,InputText$,Sign$
Local Timer=CreateTimer(60)
FlushKeys

;======================================MAIN===========================================================================

.mainloop
While Not KeyHit(1)
	Cls
	
	MHit=MouseHit(1)
	LAMA_Update()
	
	While LAMA_Event()
		Select LAMA_EventID ; check when net events happened
				
			Case LAMA_Connected ;check if still online/offline
				;Player-settings
				P.Player=Object.Player(Player(LAMA_MasterID))
				EntityColor P\Mesh,R,G,B
				P\Alp=1
				EntityAlpha P\Mesh,P\Alp
;				;sending own data
				LAMA_Send(0,20,R)
				LAMA_Send(0,20,G)
				LAMA_Send(0,20,B)
				
			Case LAMA_Joined;new-player-sends it's own data
				M.Message=New Message
				M\Message$="Joined game"
				
			Case LAMA_NewPlayer;server-sends-data-of-player-to-new-player
				M.Message=New Message
				M\Message$=LAMA_Name(LAMA_EventPlayerID)+" Joined"
				joinedid=LAMA_EventPlayerID
				;eigene-daten-senden
				LAMA_Send(LAMA_EventPlayerID,20,R)
				LAMA_Send(LAMA_EventPlayerID,20,G)
				LAMA_Send(LAMA_EventPlyerID,20,B)
				LAMA_Send(LAMA_EventPlayerID,20,Alp)
				
			Case LAMA_CountRequest;Server-receives-counter-server-request
				M.Message=New Message
				M\Message$="Receive client request"
			Case LAMA_ServerFull;PC-receives-server-full-information
				M.Message=New Message
				M\Message$="Server full"
			Case LAMA_PlayerLeft%
				M.Message=New Message
				M\Message$="Player "+LAMA_Name(LAMA_EventPlayerID)+" has left the game."
				;Return-data-of-players
				P.Player=Object.Player(Player(LAMA_EventPlayerID))
				EntityColor P\Mesh,255,255,255
				EntityAlpha P\Mesh,0.5
				RotateEntity P\Mesh%,0,P\ID%*75,0
				PositionEntity P\Mesh%,Radius#*Cos(P\ID%*75),0,Radius#*Sin(P\ID%*75)
			Case LAMA_ServerLeft%
				M.Message=New Message
				M\Message$="Server has left the game - Disconnected!"
		End Select
	Wend
	
	If LAMA_Connection Then;if connection-not-yet-made
		P.Player=Object.Player(Player(LAMA_MasterID))
		
		;move Camera-And-Objekt
		DX#=(EntityX(P\CameraPivot,1)-EntityX(Camera,1))*CameraFlow#
		DY#=(EntityY(P\CameraPivot,1)-EntityY(Camera,1))*CameraFlow#
		DZ#=(EntityZ(P\CameraPivot,1)-EntityZ(Camera,1))*CameraFlow#
		TranslateEntity Camera,DX#,DY#,DZ#
		DX#=EntityX(P\AlignPivot,1)-EntityX(Camera,1)
		DY#=EntityY(P\AlignPivot,1)-EntityY(Camera,1)
		DZ#=EntityZ(P\AlignPivot,1)-EntityZ(Camera,1)
		AlignToVector Camera,DX#,DY#,DZ#,3,CameraFlow#
		If KeyDown(200) Then P\Speed#=P\Speed#+0.01
		If KeyDown(208) Then P\Speed#=P\Speed#-0.01
		If KeyDown(203) Then P\RSpeed#=P\RSpeed#+0.1
		If KeyDown(205) Then P\RSpeed#=P\RSpeed#-0.1
		P\Speed#=P\Speed#*0.95
		P\RSpeed#=P\RSpeed#*0.95
		MoveEntity P\Mesh,0,0,P\Speed#
		TurnEntity P\Mesh,0,P\RSpeed#,0
		TurnEntity Camera,0,0,-EntityRoll(Camera)*CameraFlow#
		;send data
		LAMA_Send(0,1,EntityX(P\Mesh))
		LAMA_Send(0,1,EntityY(P\Mesh))
		LAMA_Send(0,1,EntityZ(P\Mesh))
		LAMA_Send(0,1,EntityYaw(P\Mesh))
		
		;receiving loop
		While LAMA_Recv()
			P.Player=Object.Player(LAMA_From)
			Select LAMA_MsgID
				Case 1
					P\X=LAMA_Read()
					P\Y=LAMA_Read()
					P\Z=LAMA_Read()
					PositionEntity P\Mesh,P\X,P\Y,P\Z
					RotateEntity P\Mesh,0,LAMA_Read(),0
				Case 20
					RTemp=LAMA_Read()
					GTemp=LAMA_Read()
					BTemp=LAMA_Read()
					EntityColor P\Mesh,RTemp,GTemp,BTemp
					EntityAlpha P\Mesh,1
			End Select
		Wend
		
		RenderWorld()
		
		
		;Show-players
		For P.Player=Each Player
			If LAMA_Online(P\ID%) Then
				CameraProject Camera,EntityX(P\Mesh),EntityY(P\Mesh)+2.5,EntityZ(P\Mesh)
				If ProjectedZ()&gt;0 Then
					Text ProjectedX(),ProjectedY(),LAMA_Name(P\ID),1
					Text ProjectedX(),ProjectedY()+12,"ID: "+P\ID%+", Ping: "+LAMA_Ping(P\ID),1 ;&lt;&lt;&lt;&lt;
				EndIf
			Else
				CameraProject Camera,EntityX(P\Mesh),EntityY(P\Mesh)+2.5,EntityZ(P\Mesh)
				If ProjectedZ()&gt;0 Then
					Text ProjectedX(),ProjectedY(),"Offline",1
				EndIf
			EndIf
		Next
		Text GraphicsWidth()-10,0,LAMA_MasterID
		
		Color 255,255,255
		Select LAMA_Mode
			Case 1;Server-loop
				Text 0,0,"Server opened"
				AppTitle "LamaHost "+ LAMA_MasterID ;&lt;&lt;&lt;&lt;
			Case 2;Client-schleife
				If RectsOverlap(GraphicsWidth()-9,0,9,9,MouseX(),MouseY(),1,1) Then
					Color 0,255,0
					If MHit Then
						LAMA_CloseServer()
					EndIf
				Else
					Color 255,255,255
					
				EndIf
				Rect GraphicsWidth()-9,0,9,9,0
				Line GraphicsWidth()-9,0,GraphicsWidth(),10
				Line GraphicsWidth(),0,GraphicsWidth()-9,8
		End Select
		
	Else;connection-not-made
		Color 255,255,255
		Text 0,0,"Creating Server List ..."
		Text GraphicsWidth()/2,50,"Serverlist:",1
		For i=1 To LAMA_CountServers
			Text GraphicsWidth()/2,50+i*12,LAMA_ServerName$(i)+"("+LAMA_ServerPlayers(i)+"/"+LAMA_ServerMaxPlayers(i)+")"
			;Button
			If RectsOverlap(GraphicsWidth()/2-200,50+i*12,150,12,MouseX(),MouseY(),1,1) Then
				Color 0,255,0
				If MHit Then
					LAMA_JoinServer(i,"JoinLama") 
					AppTitle "JoinLama(Client) " + LAMA_MasterID ;&lt;&lt;&lt;&lt;
				EndIf
			Else
				Color 255,255,255
			EndIf
			Text GraphicsWidth()/2-125,50+i*12,"Login",1,0
			Rect GraphicsWidth()/2-200,50+i*12,150,12,0
			Color 255,255,255
			;EndButton
		Next
		;Reloadbutton
		If RectsOverlap(0,GraphicsHeight()-12,150,12,MouseX(),MouseY(),1,1) Then
			Color 0,255,0
			If MHit Then LAMA_SendCountRequest()
		Else
			Color 255,255,255
		EndIf
		Text 75,GraphicsHeight()-12,"Reload",1,0
		Rect 0,GraphicsHeight()-12,150,15,0
		Color 255,255,255
	EndIf
	
	;Message display
	i=0
	For M.Message=Each Message
		Text 0,12+i*12,M\Message$
		i=i+1
		M\Count=M\Count+1
		If M\Count=1800 Then Delete M.Message
	Next
	
	WaitTimer Timer
	Flip 0
Wend

; &gt;&gt;&gt; HOSTSWITCHING PSEUDOCODE &lt;&lt;&lt;
; if this is the host then
; 	countplayers
; 	ping each player, using something like:
; 		For P.Player=Each Player 
;		pingspeed.player=LAMA_Ping(P\ID)
;       ...
; 	player with fastest ping will be new host
; 	broadcast new hostid
; 	switch this host to be player (client)
; end if


LAMA_CloseServer()
End


;==============================================================================================================================

Type Message
	Field Message$,Count%
End Type
Type Player
	Field ID%
	Field Mesh%
	Field CameraPivot%
	Field AlignPivot%
	Field X#,Y#,Z#
	Field Speed#,RSpeed#
    Field colorr,colorg,colorb
Field Alp ;&lt;&lt;&lt;
	Field MDown,Klicks
End Type

Function CColor(C#,ReturnColor,Br#=1.0)
	Local R,G,B
	C#=C#*360 Mod 360
	Local CP#=(C# Mod 60)/60.0
	If C#=&gt;000 And C#&lt;060 Then
		R=255
		G=255*CP#
	ElseIf C#=&gt;060 And C#&lt;120
		R=255*(1-CP#)
		G=255
	ElseIf C#=&gt;120 And C#&lt;180
		G=255
		B=255*CP#
	ElseIf C#=&gt;180 And C#&lt;240
		G=255*(1-CP#)
		B=255
	ElseIf C#=&gt;240 And C#&lt;300
		R=255*CP#
		B=255
	ElseIf C#=&gt;300 And C#&lt;360
		R=255
		B=255*(1-CP#)
	EndIf
	If ReturnColor=1 Then Return R*Br#
	If ReturnColor=2 Then Return G*Br#
	If ReturnColor=3 Then Return B*Br#
End Function
;~IDEal Editor Parameters:
;~C#Blitz3D
</textarea><br>Was also thinking about reworking the 3d-example to SimpleUDP(which apparently is stable) to see how it would perform, but docs were sparse on that one and I just love the Blitz-like simplicity of the LamaNet commands.<br><br>Can't believe there's not a complete, stable and perfect library around. That really does suck imho. Multiplayer is a must in this day and age. <br><br></td></tr></table><br>
<a name="1280009"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RustyKristi</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> I definitely agree and thanks for the info Rick. In that case, I'm now considering to moving to another library although not sure what else is out there or might check other options above that you have listed. <br><br></td></tr></table><br>
<a name="1280040"></a>

<a name="1280041"></a>

<a name="1280042"></a>

<a name="1280043"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well guess there's not that much else. Before people were using the in-build <b>DirectPlay</b> routines of Blitz3d, see commands below:<br>StartNetGame<br>HostNetGame<br>JoinNetGame<br>StopNetGame<br>CreateNetPlayer<br>DeleteNetPlayer<br>NetPlayerName<br>NetPlayerLocal<br>RecvNetMsg<br>NetMsgType<br>NetMsgFrom<br>NetMsgTo<br>NetMsgData<br>SendNetMsg<br><br>This in combination with a Host server on this site and/or using <a href="/posts.php?topic=43639" target="_blank">GNET</a> I believe. <br><br>DirectPlay however is obsolete as MS is phasing it out as part of the DirectX package. So I've come to understand everyone now is using UDP, but as this is meticulous to handle every one appears to have jumped onto/talking mostly about <b>BlitzPlay Lite/Pro</b> on the forums. This is also no longer supported by the creator. The BPLite version appeared slow &amp; lagging in my tests, has a limited command set(or at least poorly documented) and apparently doesn't have the ability to sync, which makes it rather useless for realtime games?. So nogo for me I guess.<br><br>Sofar I haven't seen anything else that was good enough/similar to the inbuilt commands, besides <b>LamaNet</b> and <a href="http://www.blitzforum.de/forum/viewtopic.php?p=410348#410348" target="_blank">SimpleUDP 3.1</a>(but the latter is not free for commercial applications). We could of course be bold and create our own looking at structures of both libraries and combine these into something new, however this will take ages and requires more in depth knowledge of the inner workings(I probably lack the skill too).<br><br>So I'm getting a bit discouraged here and starting to wonder if really possible to build good multiplayer games in Blitz3d(at the moment), which is a requirement for what I have in mind. If not, I'll may have to abandon ship here<i>(which I would really hate for I can basically build round all other restrictions)</i>. :-(<br><br><br>If anybody has some better views on this I'd be happy to hear it, but I fear for the worst.. <br><br></td></tr></table><br>
<a name="1280104"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RustyKristi</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> DirectPlay is nice when it is still being used and happening but yes it seems as much as it is technically possible, but the phasing out thing is really not something you can hope and seriously invest in.<br><br>What got me weirded out is the divide and many variations of blitz3d networking method over the years and not one stands out to be a"Go-To" solution unlike other libs out there paid or free. I guess multiplayer was not that demanding during those times? <br><br></td></tr></table><br>
<a name="1280165"></a>

<a name="1280166"></a>

<a name="1280167"></a>

<a name="1280168"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> Indeed. However I haven't given up on it just yet. <br><br>SimpleUDP of which I have a nice piece of version 2.0 techdemo example code, shows some potential. I was able to have it working flawless on 2 laptops; 1 host, 1 client, both connected via a wifi router(WLAN) that also has a wired router(LAN) connected to it, which in turn connects to a desktop PC that also worked fine as a client when I manually entered the IP of the host laptop that is residing on the WLAN. This should do fine for a Quake3 like experience.<br><br>However, it didn't work the other round: making the desktop on the LAN acting as host, for then it wasn't found. Now I must say I'm using some odd IP's on the LAN just for making a break in a little less easy and also have different firewall brands on the LAN/WLAN so that could be a reason for it to be working as a client only.<br><br>I'll still have to test this with the improved 3.0 version(has some holepunching ability bug fixes) don't know for sure, but I believe 3.01 by default requires a MasterServer contrary to previous versions, but I'll have to double check(could be misconception). <br><br></td></tr></table><br>
<a name="1280494"></a>

<a name="1280495"></a>

<a name="1280590"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> Couldn't resist checking out the LamaNet 4-Player Pong Example in the manual and added a bit to it. It's quite simple, but nevertheless interesting. <br><img src="http://i59.tinypic.com/1sdw9e.jpg"><br><img src="http://i60.tinypic.com/24dnejl.jpg"><br><br>So for people who are interested and do not like to type here's the code with English comments.<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Graphics 640,480,0,2 
SetBuffer BackBuffer() 

Global LamaLogo  = LoadImage( "media\LamaLogo.png" )
Global LamaTitle = LoadImage( "media\LamaTitle.png" )

ClsColor 255, 255, 255 : Cls
DrawImage( LamaLogo , 15 , 50, 0 )
DrawImage( LamaTitle ,190 , 40, 0 )


Color 172,189,237 ; Lama blue
Text(325, 130, "LamaNet By Chrise 2010 - 2015", 1 )

Color 172-100,189-100,237-100 ; Lama dark blue
Include "include\LamaNet2.bb" 


Locate GraphicsWidth()/3,190
Local ServerOrClient=Input("Create Server(1) - Search Server(2)") 

Select ServerOrClient 
	Case 1 ; host..
		;servnam$=Input$("Please enter servername: ")
		;servplr$=Input$("Please enter playername: ")
		;LAMA_HostServer(servnam$,4,servplr$) 
		;AppTitle servnam$
		ClsColor 0, 0, 0 : Cls
		LAMA_HostServer("Pongserver",4,"Lama") 
		LAMA_Update()
		AppTitle "Pongserver"+LAMA_MasterID
		
	Case 2 ; client so need to select a server..
		;clntplr$=Input$("Please enter playername: ")
		;AppTitle servplr$;clntplr$
		LAMA_StartCountServers() 
		
	Default 
		End 
End Select 


;Create player system.
Dim Player(4); Design max 4 player that can be referenced by nr/handle?
;This will generate actually 5 variables Player(0) to Player(4), 
;but we'll skip "0" as it's simplifies things.

;Define Player variable type structure..
Type Player 
	Field ID%    ; player ID
	Field X%,Y%  ; player coords
	Field Score% ; player score
End Type

;Next create an instance of the type, 
;an instance is a pointer or reference to a type object.
;AFter this we can set and get type fields using the "pointer\field" syntax.

Local P.Player 

For i=1 To 4 ; define 4 players up front.
	P.Player=New Player ; do 4x.
	P\ID=i  ;field P\ID= 1 to 4.
	Player(i)=Handle(P.Player) 
	; Array variable Player, which has bee/n DIMmed 
	; To hold 4 Data's is filled with the 
	; 'Handle' or 'pointer' to the specified 
	; 'instance' or 'object' of 
	; variable type structure Player.
	; This also makes it easier to approach
	; the Player(i) 1-4 directly.
Next 

;Define ball variables..
Global BallX=GraphicsWidth()/2 
Global BallY=GraphicsHeight()/2 
SeedRnd MilliSecs() 
Global BallXSpeed=Rand(-5,+5) 
Global BallYSpeed=Rand(-5,+5)


Local Timer=CreateTimer(60) 
.mainloop

While Not KeyHit(1) 
	
	LAMA_Update() ; needed to update all that's lama networkstuff.
	Cls ; clear screen every loop so can redraw gfx in new positions.
	MHit=MouseHit(1) ;check if leftmsebtn clicked
	
	If LAMA_Connection Then ; *** is apparently only the case when is not a server. ***
		;ALL gamestuff here.
		P.Player=Object.Player(Player(LAMA_MasterID)) ;if connected then ID of then current player is 
													  ;equal to the id of the current program(MasterID).
		Select P\ID ; select which player is the current..
			Case 1 
				P\X=10 ; put that player(bat) into appropriate location according to 
				       ; mousecontrols(so movent) and restrictions.
				P\Y=MouseY() 
			Case 2 
				P\X=GraphicsWidth()-10 
				P\Y=MouseY() 
			Case 3 
				P\X=MouseX() 
				P\Y=10 
			Case 4 
				P\X=MouseX() 
				P\Y=GraphicsHeight()-10 
		End Select
		
		;Send updated positions..
		;LAMA_Send(PlayerID%,MsgID%,Value$,[Secure%])
		;          PlayerID=0 so selects all players
		LAMA_Send(0,1,P\X) ;MsgID=1 
		LAMA_Send(0,1,P\Y) ;Value= can be Byte,Short,Int,Float or String.
		;secure not needed.
		
		
		While LAMA_Recv() ;Receiver loop. check if received msg by clients/server..
			P.Player=Object.Player(Player(LAMA_From)) ; check which player sended.
			Select LAMA_MsgID ; select the correct player(sender)from msg.
				Case 1 ; run on server
					P\X=LAMA_Read() ; read x and y from above player$.
					P\Y=LAMA_Read() ; 
				Case 2 ; run not ran ond server??
					BallX=LAMA_Read() ; read ball x,y.
					BallY=LAMA_Read() ;	
			End Select
		Wend
		
		;Drawing players(bat)..
		Color 255,255,255 
		For P.Player=Each Player 
			If LAMA_Online(P\ID) Then ;only if the player in list are connected(online)..
				Select P\ID 
					Case 1 
						Rect P\X-1,P\Y-50,3,101 
					Case 2 
						Rect P\X-1,P\Y-50,3,101 
					Case 3 
						Rect P\X-50,P\Y-1,101,3 
					Case 4 
						Rect P\X-50,P\Y-1,101,3 
				End Select 
			EndIf
		Next

		;Ball bouncings/limitations..
		If BallX&gt;GraphicsWidth() Then
			If LAMA_Online(2)=0 Then 
				BallXSpeed=-BallXSpeed 
				BallX=GraphicsWidth() 
			Else 
				BallX=GraphicsWidth()/2 
				BallY=GraphicsHeight()/2 
				BallXSpeed=Rand(-5,+5) 
				BallYSpeed=Rand(-5,+5) 
			EndIf 
		EndIf 
		If BallX&lt;0 Then 
			BallX=GraphicsWidth()/2 
			BallY=GraphicsHeight()/2
			BallXSpeed=Rand(-5,+5) 
			BallYSpeed=Rand(-5,+5)
		EndIf 
		If BallY&gt;GraphicsHeight() Then 
			If LAMA_Online(4)=0 Then 
				BallYSpeed=-BallYSpeed 
				BallY=GraphicsHeight() 
			Else BallX=GraphicsWidth()/2 
				BallY=GraphicsHeight()/2 
				BallXSpeed=Rand(-5,+5) 
				BallYSpeed=Rand(-5,+5) 
			EndIf 
		EndIf 
		If BallY&lt;0 Then 
			If LAMA_Online(3)=0 Then 
				BallYSpeed=-BallYSpeed 
				BallY=0 
			Else 
				BallX=GraphicsWidth()/2 
				BallY=GraphicsHeight()/2 
				BallXSpeed=Rand(-5,+5) 
				BallYSpeed=Rand(-5,+5) 
			EndIf 
		EndIf
		
		;Checking batt bouncing..
		For P.Player=Each Player 
			If LAMA_Online(P\ID) Then 
				Select P\ID 
					Case 1 
						If RectsOverlap(P\X-1,P\Y-50,3,101,BallX-1,BallY-1,3,3) Then 
							BallXSpeed=-BallXSpeed 
						EndIf 
					Case 2 
						If RectsOverlap(P\X-1,P\Y-50,3,101,BallX-1,BallY-1,3,3) Then 
							BallXSpeed=-BallXSpeed 
						EndIf 
					Case 3 
						If RectsOverlap(P\X-50,P\Y-1,101,3,BallX-1,BallY-1,3,3) Then 
							BallYSpeed=-BallYSpeed
						EndIf 
					Case 4 
						If RectsOverlap(P\X-50,P\Y-1,101,3,BallX-1,BallY-1,3,3) Then
							BallYSpeed=-BallYSpeed
						EndIf
					End Select
			EndIf
		Next
		
		;Drawing ball..
		Rect BallX-1,BallY-1,3,3,1
		
		;Sending ball coords..		
		If LAMA_Mode=1 Then 
			BallX=BallX+BallXSpeed 
			BallY=BallY+BallYSpeed
			LAMA_Send(0,2,BallX) 
			LAMA_Send(0,2,BallY)
		EndIf


	Else  ; *** so when not connected.. ***
		Color 172,189,237 ; Lama blue	
		For i=1 To LAMA_CountServers ; build list of available servers.
		    
			If RectsOverlap(0,(i*15)-15,GraphicsWidth()/2,15,MouseX(),MouseY(),1,1) Then ; check selection box.
				Color 172,189,237 ; color blue
				If MHit Then 
					;LAMA_JoinServer(i,servplr$) 
					LAMA_JoinServer(i,"JoinLama") ;This changes status variable LAMA_Connection 
					                              ;from "0" to "1" and thus the programm is connected to the server.
											      ;NOTE: the Serverlist is no longer being created for this is checke in our if..then!					
					AppTitle "JoinLama"+LAMA_MasterID ;&lt;&lt;&lt;&lt; added for showing which is which..
					ClsColor 0,0,0 :Cls 
				EndIf
			Else
				;Color 255,255,255 ; color white, e.a.w nothing selected.
				Color 0,0,0 ; color black, e.a.w nothing selected.

		
			EndIf

			; put selection box around server(s?) found.		
			Rect 0,(i*15)-15,GraphicsWidth()/2,15,0 : Text 0,(i*15)-15,LAMA_ServerName(i)+" - ("+LAMA_ServerPlayers(i)+"/"+LAMA_ServerMaxPlayers(i)+")" 
	
			;Text 0,(i*15)-15+100  ,"Servername           : "+LAMA_ServerName(i)
			;Text 0,(i*15) +100    ,"Number of Players    : "+LAMA_ServerPlayers(i)
			;Text 0,(i*15)+15+100  ,"Maximum allow Players: "+LAMA_ServerMaxPlayers(i)
			;Text 0,(i*15)+15*2+100,"Server ping time     : "+LAMA_IPing()
		Next 
	EndIf 
	
	WaitTimer Timer 
	
	Flip 0 
Wend 
End

;~IDEal Editor Parameters:
;~C#Blitz3D
</textarea><br><br>Media:<br><a href="http://www.mediafire.com/download/dod9fjdmq1vpqmg/LamaTitle.png" target="_blank">Title</a><br><a href="http://www.mediafire.com/download/h0q2dsdihoc7r0k/LamaLogo.png" target="_blank">Logo</a><br>LamaNet media PNG's are opyright by Chrise and derived from the PDF manual that comes with it, but free to use and distribute with it I guess. <br><br></td></tr></table><br>
<a name="1280502"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RustyKristi</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> Interesting demo Rick, too bad I've given up on Lama. It should work right out of the box like other demos out there. :/ <br><br></td></tr></table><br>
<a name="1280586"></a>

<a name="1280587"></a>

<a name="1280588"></a>

<a name="1280589"></a>

<a name="1280598"></a>

<a name="1280599"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> True Rusty. Still was fun to toy with. A little while ago I've seen you checking at the Max threads to see what they're using. Did that give you anything interesting?<br>I did a quick search and found a few things for BMX:<br><br>TNet <a href="http://www.truplo.com/TNet/versions.html" target="_blank">http://www.truplo.com/TNet/versions.html</a><br>ENet wrapper for guaranteed UDP works very well. ENet comes with Blitzmax (at least that's what was mentioned somewhere).  <br>BNET <a href="http://www.eiksoft.com/multi/multi.htm" target="_blank">http://www.eiksoft.com/multi/multi.htm</a> <br><br></td></tr></table><br>
<a name="1280601"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> Really wondering if there's actually something like this full fledged out there working flawless for Blitz3D.. Please correct me if not. <br><br></td></tr></table><br>
<a name="1280607"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RustyKristi</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> ENet looks great and the commandset is almost ready for actual usage, too bad the examples are limited to chat and hi and hello stuff. It looks like it needs some work from data packing and message handling.<br><br>I'm curious with TNet as it says it's complete but it looks like it's not completely free to use. I'm not into BMax yet but do you think this can be easily to port to B3D with userlibs, etc? <br><br></td></tr></table><br>
<a name="1280610"></a>

<a name="1280611"></a>

<a name="1280612"></a>

<a name="1280613"></a>

<a name="1280614"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've been wondering that myself, but I fear it's too easy for it's a bit of another beast. Other way round is probably more do-able, seen people using DLL's and put them to use in BMax, but the format of TNet downloaded isn't a DLL, but in Max's module fashion. Perhaps from BMax it's possible to generate a DLL in turn and then it's 'simply' a matter of creating a decls file. All with big perhapses and maybe's.. <br><br>Any BMXers with experience in the field probably won't read this thread, so perhaps a question in one of their threads? <br><br>Meanwhile, I keep on digging to see if I can get something useable working.<br>Currently back at checking BPLite, to see if can work around timing/lagging issues I experienced with a 2d example. <br><br></td></tr></table><br>
<a name="1284603"></a>

<a name="1284604"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> yea no. SCREW ALL those suggestions no offense. Use NetBlitz 1.3! :D<br><br><a href="http://dawp.tripod.com/netblitz.htm" target="_blank">http://dawp.tripod.com/netblitz.htm</a><br><br>ENJOY! :)<br><br>~GF <br><br></td></tr></table><br>
<a name="1284690"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Guy Fawkes:<br><br>Indeed I've considered that one too(see <a href="/post.php?topic=104840&amp;post=1276381" target="_blank">post #4</a>).<br><br>However I was under the impression it's only working well with 2 players. <br>Can you confirm or supply an example showing it works with more than 2? (that would be great actually..) <br><br></td></tr></table><br>
<a name="1284706"></a>

<a name="1284707"></a>

<a name="1284708"></a>

<a name="1284709"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> OK GF, I did some new tests on that NetBlitz 1.3 lib. Actually it *does* work with multiple players, which appeared to fail before, but I didn't test well enough. Interesting results:<br><br>1. Host(Player1) started on laptop1, over wireless network as 'non local'.<br>2. Player2 connects/joins over 'non local' network from laptop2, (actually on same wireless network) specifying IP# and port#.<br>3. Player3 connects/joins same way over 'non local' network from Deskttop PC#1, on LAN connected to my LAN Router1, which in turn is connected to LAN/WLAN Router2 (which is als my connection to internet).<br><br>So I guess local for this one means really local 127.0.0.1 loopback address or so, so on same machine? Or perhaps it's because of the firewalls..<br>All systems are equipped with different firewalls so I guess that's hindering connection, but not making it impossible (have to permit when asked by firewalls of course).<br><br><br>Thanks for pointing me into this direction. I thought it was an ancient, old and superseded lib.<br><br><u>I'll now need see:</u><br>1) How can make one of the players act as the new host when the player that is the original host, decides to leave the game, for I've noticed that then not all players get updated anymore. I'll check the online commands list for that to see what can be achieved. <br><br>2) Check if it works over internet(WAN) too, so basically if any IP can be used. I suspect it does, just need to test.<br><br><br>Again, thanks. <br><br></td></tr></table><br>
<a name="1284796"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> Any Luck, Rick? If so, I'd like to see your examples.<br><br>~GF <br><br></td></tr></table><br>
<a name="1284839"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> Not yet, x-mas shopping and unfortunately I have to dose my computer time for I'm suffering from a burnout, on top of my visual issues(eyestrain when watching LED/LCD's for a prolonged period of time). <br><br>But I'm hopeful, after the previous tests. <br><br></td></tr></table><br>
<a name="1285178"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >funkmaster5000</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#32">[#32]</a></td></tr></table></td></tr><tr ><td class="posttext"> Actually, I'd like to point out <a href="/posts.php?topic=49076" target="_blank">this thread</a>. It is working great, except the issue I am having with the player ID atm. <br><br></td></tr></table><br>
<a name="1285756"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#33">[#33]</a></td></tr></table></td></tr><tr ><td class="posttext"> No clue on that, currently still checking out NetBlitz1.3, but very limited time. <br><br></td></tr></table><br>
<a name="1285850"></a>

<a name="1285851"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flanker</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#34">[#34]</a></td></tr></table></td></tr><tr ><td class="posttext"> If your goal is to switch the host on the fly, I see two solutions :<br><br>1) One player is the server and sends informations about players (IP, port, ID) to other players. If the server leaves, all players wait for a timeout, then the lowest ID player starts a server and other try to connect. If it fails, after a timeout, the second lowest ID player tries too and so on. Not easy but not impossible. But it will be noticeable for everyone.<br><br>2) All players are server and clients. Any of them can accept an incoming player to gather informations about all other players to "connect" to the network. Then, each player sends and receives informations with all of the other players. This could work for a low players count even if it's not efficient, any deconection would be unoticeable and you wouldn't even have to worry about that.<br><br>It could be a great challenge, I'll see if I have some time to try something about this. A while back I wrote a very simple server/client test with Blitz3D, with both UDP and TCP, it worked quite well tested with two friends. <br><br></td></tr></table><br>
<a name="1286016"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#35">[#35]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Flanker:<br>Thanks, yeah indeed above 2 options came to mind. With option 1(switching hosts) being the easiest(but unpretty) solution I think due to the mentioned pause. And option 2(all players are both server and clients) probably being the most preferable, slick, but perhaps more complex option?<br><br>I'm thinking about a limited number of players, tops 5 or so if feasible(I'd settle for less if required) LAN/WAN party death match kinda game. <br>However even though I've got most of the single player game aspects covered and running pretty good, implementing the network side of this in the above mentioned fashion is a bit more of an headache to me so far. <br><br>The NetBlitz lib 3D example code was easy enough to incorporate into my code, but it just can't be that when the host player leaves, the game ends for all players, hence the need for a solution to this. Dunno if the 2nd option is even at all possible using NetBlitz or any other existing lib.<br><br>Anyway, if you'd have a working example I'd be very grateful(for I'm ready to pull my hair out ;-) <br><br></td></tr></table><br>
<a name="1286028"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flanker</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#36">[#36]</a></td></tr></table></td></tr><tr ><td class="posttext"> The option 2 can be easy for some kind of game. For example a "free for all" FPS where each player would just send his position/rotation/inputs to all other player, and eventually something like "Player 12 killed me". In this example you don't need a main player to act as a server. But another example would be a soccer game. In this case you need a player to act as a server to handle the ball and goals.<br><br>The option 1 is preferable I think, even if switching hosts is noticeable. I'll have a look at NetBlitz. <br><br></td></tr></table><br>
<a name="1286118"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#37">[#37]</a></td></tr></table></td></tr><tr ><td class="posttext"> That would be great. You might be right that option 1(host switching) is preferable as it's less wasteful and I've got some moving platforms, doors, particle stuff and other events that need to be controlled also. All these things perhaps may generate too much network traffic to make it run smoothly if all players would have to send and synch that info.<br> <br>A brief pause to switch hosts might be acceptable, if it's done notification style wise. As like: "NOTE: Player A(the host), has left the game. Player B is now the new host. Continue in 3 secs. 3..2..1". <br><br></td></tr></table><br>
<a name="1286242"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flanker</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#38">[#38]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've takeen a look at NetBlitz. In the examples it acts like the "option 2" we discussed earlier, each players sends directly to each other player so when the first player leaves the other can still play, but noone can join. The code is messy and doesn't work well, and it would be simpler to rewrite a library than modifying this... <br><br></td></tr></table><br>
<a name="1286245"></a>

<a name="1286246"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#39">[#39]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm, thanks for looking into it, but that's a real pity. For I can get round using a library, but further more my UDP coding skills are pretty limited. <br><br>Almost can't believe there's no one who wrote a decent lib to replace Blitz's DirectPlay routines. To summarize, so far I've looked at:<br><br>1) LlamaNet 1.06  - unfinished, buggy.<br>2) SimpleUDP 3.1  - not free, requires a masterserver.<br>3) BlitzPlay Lite - lacking features to synch, causing lag.<br>4) NetBlitz 1.3   - works on my network, but not as described by the author(only the 3D example works fine, when taking into account certain steps, see post <a href="/post.php?topic=104840&amp;post=1284709" target="_blank">#29</a>).<br><br>So I guess it's a nogo then.. :-( <br><br></td></tr></table><br>
<a name="1286255"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flanker</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#40">[#40]</a></td></tr></table></td></tr><tr ><td class="posttext"> The hardest part of a network library I guess is to make it easy to include in any project. If you find that DirectPlay commands are ok I can try to write a blitz DirectPlay-like with blitz UDP commands, and host switching. The only thing I don't guarantee is packet reliability, even if it is possible, it will probably be a pain.<br><br>The network routine test I wrote several years ago used both UDP and TCP, UDP for fast but non crucial data and TCP for important data like chat messages, new player connected etc... But today after some tests, TCP works well on the local network but not over internet. Do you have the same thing ?<br><br>UDP works well, so I guess it would be 100% UDP, wich is easier for host switching. <br><br></td></tr></table><br>
<a name="1286258"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#41">[#41]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm, so far haven't tried NetBlitz over the internet, only noticed it passed different firewalls and routers on LAN/WLAN and timing in the 3d example worked fine, this unlike the other libraries I tried(they all failed). It should in theory work fine over the internet. I'll try from a remote machine and let you know. Perhaps some of the routines he used are useable, dunno if he's using hole-punching techniques?<br><br>BTW: Got a reply from the author of NetBlitz 1.3(had dropped him a line couple of days ago), quoting part the message below:<br><div class="quote"> <br>Thank you for your regards. As you may have guessed, NetBlitz is not supported anymore. It has been a while since I have worked with the library. However, there are a few solutions to your problem. Essentially, you want your program to have 'Host Migration' in that when the host leaves the program, it finds another host. Some computer programs and games avoid this altogether by booting all the players off the game when the host leaves. Another solution involves having a non-player host that monitors all the connections and players that would be controlled by your systems.<br><br>NetBlitz unfortunately does not have host migration as you already noticed, however I looked at the internal code and found a few hacks that would give it this feature that you are requesting.<br>1) NetBlitz internally uses globals serverip and serverport to identify which ip belongs to the host. Every user when logged on stores this ip and port obtained from the host. The default port is 80 and NetBlitz expects the host person to have port 80 setup as the UDP stream.<br><br>2) I suggest that when the host logs off, you should send a message to all of the other players telling them that the host has logged off. You can use your own custom message type. In addition, the current host should find a new host and send the details of the new host to all the remaining players before leaving the game.<br><br>3) When the remaining players receive this message (Let's call it host change message), they all change their respective serverip to the new host ip. This new host would also need to close the current udp stream and re-open it at port 80 if it wasn't already at port 80. In addition, make sure to update the nbplayer type field of host to the correct host.<br><br>I hope the above information gives you guidance and good luck with your project! <br></div><br>This is sort what I was thinking about already, execution is another matter of course. Not impossible, however after your check on the code I'm a bit weary if worth the try. <br><br></td></tr></table><br>
<a name="1286259"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flanker</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#42">[#42]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes that would be the solution, when the server quits, it should sends a "switch host" packet with ip and port of the new host to everyone.<br><br>IMO it doesn't worth trying to modify NetBlitz. I won't, I prefer to write a fresh library, as stayne said :p<br><div class="quote">  Going down the confusing rabbit hole of trying to decipher someone else's network code is a dark one. Gooooooooooood luck. <br></div> <br><br></td></tr></table><br>
<a name="1286268"></a>

<a name="1286275"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#43">[#43]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you can write such a fresh library, I'd for starters would be very grateful and I'm pretty sure a lot more Blitzers would, for this is now a very missed out, but essential feature. However it's perhaps a bit much to ask.<br>I personally don't think I'm skilled enough in this area, would probably set me back a year and a half or so to do it right(if ever). <br><br></td></tr></table><br>
<a name="1286439"></a>

<a name="1286440"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flanker</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#44">[#44]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi, I've a working UDP example of host switching on the fly. It works quite well, barely unnoticeable. Some polishing and I'll post it in the code archives.<br><br><a href="http://i.imgbox.com/P39HyJDy.png" target="_blank"><img src="http://1.t.imgbox.com/P39HyJDy.jpg"></a><br><br>The drawback for the moment is I can't get it working over my NAT, it's only local, even NetBlitz don't work anymore through it (with same parameters), it seems random to me... <br><br></td></tr></table><br>
<a name="1286458"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#45">[#45]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Flanker :: Can you do a 3D version?<br><br>Ty! :)<br><br>~GF <br><br></td></tr></table><br>
<a name="1286483"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flanker</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#46">[#46]</a></td></tr></table></td></tr><tr ><td class="posttext"> It would need some smooth position interpolation but here is a 3d example i'm testing.<br><br><a href="http://i.imgbox.com/f8JFKhWn.png" target="_blank"><img src="http://6.t.imgbox.com/f8JFKhWn.jpg"></a> <br><br></td></tr></table><br>
<a name="1286494"></a>

<a name="1286501"></a>

<a name="1286507"></a>

<a name="1286508"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#47">[#47]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wauw-oh-wauw-oh-wauw! (need I say more?) This is looking like it's going to be a very merry X-mas. Thanks so far Santa(Flanker), this is really cool! Merry X-mass and enjoy, <br><br></td></tr></table><br>
<a name="1286509"></a>

<a name="1286542"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#48">[#48]</a></td></tr></table></td></tr><tr ><td class="posttext"> [double entry] <br><br></td></tr></table><br>
<a name="1286524"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#49">[#49]</a></td></tr></table></td></tr><tr ><td class="posttext"> I agree! :) Can you release the 3D demo when it's done? (When WILL it be done anyway) ? <br><br></td></tr></table><br>
<a name="1286547"></a>

<a name="1286548"></a>

<a name="1286549"></a>

<a name="1286551"></a>

<a name="1286552"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#50">[#50]</a></td></tr></table></td></tr><tr ><td class="posttext"> Not so impatient GF. ;-) It's the holidays, people interacting with other (real life) people, eating, getting boozed up etc. I myself just enjoyed a good glass of wine, which is *not* a good combo for coding and that's probably not at all that different for a whole lot of people round the world, hehehe. I like you am hoping Flanker will be 'the one' (Matrix-ref-style lol) that will free us and allow us to reach Zion, the multiplayer game coding walhala. (see the booze already kicking in?). Now I only have to decide if next I wanna take the red or the blue pill, uh red or white wine.. The red probably takes me out of this world as it contains more alcohol. ;-D <br><br></td></tr></table><br>
<a name="1286555"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flanker</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#51">[#51]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'll post the first version of the library tomorrow. Everything works fine, but there's a lot of latency when running 6 players on the same computer so tonight I'll try to connect from other computers on my network to see what happens. <br><br></td></tr></table><br>
<a name="1286559"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#52">[#52]</a></td></tr></table></td></tr><tr ><td class="posttext"> HA! @Rick Nasher! Are you Rick Smashered? :D XD<br><br>Sounds good, Flanker! Thanks alot! :) <br><br></td></tr></table><br>
<a name="1286560"></a>

<a name="1286561"></a>

<a name="1286562"></a>

<a name="1286563"></a>

<a name="1286564"></a>

<a name="1286569"></a>

<a name="1286570"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#53">[#53]</a></td></tr></table></td></tr><tr ><td class="posttext"> @ Flanker: <br>Cool. You are gathering some interest here as you can see. I think that latency is actually quite common when running multiple clients on the same computer. At least it's what I experienced before too.<br>Apparently it's less on a LAN/WLAN. Perhaps cos everything has to be addressed by the same NIC. Looking forward to try it.<br><br>@GF: <br>Well, no I kinda left the red pill/wine and went for a Coca-Cola, as my girlfriend already fell a sleep on the couch and I'm watching "The Shining" on TV. Amazed by the haunting atmosphere, straight from the start of the movie. <br><br></td></tr></table><br>
<a name="1286568"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#54">[#54]</a></td></tr></table></td></tr><tr ><td class="posttext"> Haha, nice @RickNasher!<br><br>AWESOME, @Flanker! Can't wait to try it! :)<br><br>~GF <br><br></td></tr></table><br>
<a name="1286571"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flanker</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#55">[#55]</a></td></tr></table></td></tr><tr ><td class="posttext"> Tested with 15 players, 9 on one computer, 6 on another, worked pretty well, the host switching works perfectly and the latency comes from a brute "full update" done by the server every X seconds in the 3D example. It's not directly linked with the library but with a "crappy" example ^^<br><br> <a href="http://i.imgbox.com/pDsvcGXv.png" target="_blank"><img src="http://1.t.imgbox.com/pDsvcGXv.jpg"></a><br><br>I'll post it in the code archives now, as I'd like others to test it and tell if it works fine. A lot more things could be added but for the first version it will be fine like that. <br><br></td></tr></table><br>
<a name="1286573"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flanker</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#56">[#56]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've created a worklog for it as it may change : <a href="http://www.blitzbasic.com/logs/userlog.php?log=1916&amp;user=15074" target="_blank">http://www.blitzbasic.com/logs/userlog.php?log=1916&amp;user=15074</a><br><br>Hope it works for you guys, and tell me if you need help with it. <br><br></td></tr></table><br>
<a name="1286594"></a>

<a name="1286596"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#57">[#57]</a></td></tr></table></td></tr><tr ><td class="posttext"> O it's changed alright! I've fixed QUITE a few things in here INCLUDING the terrible collision. You now have MULTIPLE collision types affecting what the players can &amp; cannot hit. Or can slide off of / on &amp; / or NOT slide off of / on.<br><br>I DID notice TWO glitches I cannot fix. 1) (The most important) :: The camera thinks that every new player that comes in if the camera is up close &amp; personal on the other player, it automatically assumes that it should be looking through THAT player's eyes which is a real pain in the ass. The 2nd thing I noticed is that players spawn in the exact same area instead of WITHIN the exact same area. Which is a real pain because after so many players, that starts to cause lag for the other players.<br><br>Other than that, this is starting to become something BEAUTIFUL! =D<br><br>I now share my code with the rest of you as KNOWLEDGE IS FREEDOM! :)<br><br>3DFix.bb :: <br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">SeedRnd MilliSecs()

Include "UDPNetwork_lib.bb"

Global localID
Global localName$ = "player" + Rand(100,999)

Global localPlayerMesh

Type player
	Field id
	Field name$
	Field mesh
	Field x#,y#,z#
	Field yaw#
	Field velocityY#
	Field r,g,b
End Type

Global player_col     =         1
Global obj_col        =         2
Global flr_col        =         3
Global platform_col   =         4

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Camera code from jfk EO-11110, thanks
Global bounce_cam=1 ;  smooth camera motion? (0/1)
Global bounce_div#=10.0 ; the higher, the more sluggish the camera will follow. Recc: 3.0 to 20.0
; some globals used by ChaseCam
Global old_x#,old_y#,old_z#
; desired distance between camera and player mesh
Global x_dis#=7.0,y_dis#=3,z_dis#=7.0,y_dis_or#=y_dis#
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

; network init ----------------------------------------;
Global localMode = Net_StartInput() ; bring the library "console" to connect

If localMode = 1 Or localMode = 2 ; 1 means we are client, 2 means we are server

	If localMode = 1 Then AppTitle("Client")
	If localMode = 2 Then AppTitle("Server")
	
	localId = Net_CreatePlayer(localName) ; this command inits the server or local client
	
	If localId = 0 ; error
		Net_StopNetwork() ; close the network properly
		RuntimeError("Failed to create player.")
	EndIf
	
Else ; error
	Net_StopNetwork()
	RuntimeError("Failed to start game.")
EndIf
;------------------------------------------------------;

Graphics3D 800,600,32,2
SetBuffer BackBuffer()

CreateScene()

Global camera = CreateCamera()
CameraRange camera,0.1,1000

; create our own local player
localPlayerMesh = CreatePlayer(localID,localName)
old_x = EntityX(localPlayerMesh):old_y = EntityY(localPlayerMesh):old_z = EntityZ(localPlayerMesh) ; update camera position

; we send our color to server
p.player = Object.player(GetPlayer(localID))
Net_SendMessage(3,p\r + "/" + p\g + "/" + p\b)

; variable used by server player for full position update
Global updatePositions = MilliSecs()

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
While Not KeyHit(1)

	; update our inputs
	inputFORWARD$ = 0:inputBACKWARD$ = 0:inputLEFT$ = 0:inputRIGHT$ = 0
	If KeyDown(200) Then inputFORWARD = 1:MoveEntity localPlayerMesh,0,0,0.3
	If KeyDown(208) Then inputBACKWARD = 1:MoveEntity localPlayerMesh,0,0,-0.3
	If KeyDown(203) Then inputLEFT = 1:TurnEntity localPlayerMesh,0,3,0
	If KeyDown(205) Then inputRIGHT = 1:TurnEntity localPlayerMesh,0,-3,0
	; we create a message type "1" for player inputs, and we send our inputs
	If inputFORWARD Or inputBACKWARD Or inputLEFT Or inputRIGHT Then Net_SendMessage(1,inputFORWARD + inputBACKWARD + inputLEFT + inputRIGHT)
	
	UpdateChaseCam(camera,localPlayerMesh)

	; see the function, it is up to you to create it, it's not linked with the library, just the local example
	UpdateNetwork()

	UpdateWorld()
	RenderWorld()

	UpdatePlayers()
	
	Flip

Wend
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

Net_StopNetwork()

End

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function UpdateNetwork()

	; update incoming packets
	If Net_CheckMessage() ; will check for a new message and fill Net_MsgType, Net_MsgData$, Net_MsgFrom and Net_MsgTo variables so we can read it
		
		Select Net_MsgType ; check the type of message
						
			Case 1 ; player movement we set above, so we know a player is moving
							
				; unpack the message string
				playerFORWARD$ = Left(Net_MsgData,1)
				playerBACKWARD$ = Mid(Net_MsgData,2,1)
				playerLEFT$ = Mid(Net_MsgData,3,1)
				playerRIGHT$ = Right(Net_MsgData,1)
				
				p.player = Object.player(GetPlayer(Net_MsgFrom))
				
				; update the player
				If playerFORWARD Then MoveEntity p\mesh,0,0,0.3
				If playerBACKWARD Then MoveEntity p\mesh,0,0,-0.3
				If playerLEFT Then TurnEntity p\mesh,0,3,0
				If playerRIGHT Then TurnEntity p\mesh,0,-3,0
				
			Case 2 ; player position and angle, example of packing data into string
				
				offset1 = Instr(Net_MsgData,"/",1)
				offset2 = Instr(Net_MsgData,"/",offset1+1)
				offset3 = Instr(Net_MsgData,"/",offset2+1)
				
				p.player = Object.player(GetPlayer(Net_MsgFrom))
				
				p\x = Left(Net_MsgData,offset1-1)
				p\y = Mid(Net_MsgData,offset1+1,offset2-offset1-1)
				p\z = Mid(Net_MsgData,offset2+1,offset3-offset2-1)
				p\yaw = Right(Net_MsgData,Len(Net_MsgData)-offset3)
				
				PositionEntity p\mesh,p\x,p\y,p\z
				RotateEntity p\mesh,0,p\yaw,0
				ResetEntity p\mesh
			
			Case 3 ; update player colors
						
				offset1 = Instr(Net_MsgData,"/",1)
				offset2 = Instr(Net_MsgData,"/",offset1+1)
			
				p.player = Object.player(GetPlayer(Net_MsgFrom))
				
				p\r = Left(Net_MsgData,offset1-1)
				p\g = Mid(Net_MsgData,offset1+1,offset2-offset1-1)
				p\b = Right(Net_MsgData,Len(Net_MsgData)-offset2)
				
				If Net_MsgFrom = localID Then DebugLog "color received : " + p\r + " / " + p\g + " / " + p\b
				
				EntityColor p\mesh,p\r,p\g,p\b

															
			Case 100 ; new player connected, OR the server tells us who is already connected so we can create players when joining the game
							
				If localMode = 2
					For p.player = Each player
						Net_SendMessage(2,p\x + "/" + p\y + "/" + p\z + "/" + p\yaw,p\id,Net_MsgFrom)
						Net_SendMessage(3,p\r + "/" + p\g + "/" + p\b,p\id,Net_MsgFrom)
						If p\id = Net_MsgFrom Then DebugLog "color sent : " + p\r + " / " + p\g + " / " + p\b
					Next
				EndIf
				
				CreatePlayer(Net_MsgFrom,Net_MsgData)
			
			Case 101 ; a player has quit
						
				For p.player = Each player
					If Net_MsgFrom = p\id
						FreeEntity p\mesh
						Delete p
					EndIf
				Next
			
			Case 102 ; host has changed
			
				If Net_MsgFrom = localID Then localMode = 2:AppTitle("Server") ; we are the new host


		End Select

	EndIf
	
	;;;;;;;;;;;;;;;;;;;
	If localMode = 2
		If MilliSecs()-updatePositions &gt; 10000
			For p.player = Each player
				Net_SendMessage(2,p\x + "/" + p\y + "/" + p\z + "/" + p\yaw,p\id)
				Net_SendMessage(2,p\x + "/" + p\y + "/" + p\z + "/" + p\yaw,p\id,p\id)
			Next
			updatePositions = MilliSecs()
		EndIf
	EndIf

End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function GetPlayer(id)

	For p.player = Each player
		If p\id = id
			Return Handle(p)					
		EndIf
	Next

End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function UpdatePlayers()

	For p.player = Each player
				
		If EntityY(p\mesh) - p\y &lt; 0
			p\velocityY = p\velocityY - 0.03
		Else
			p\velocityY = -0.01
		EndIf
				
		p\x = EntityX(p\mesh)
		p\y = EntityY(p\mesh)
		p\z = EntityZ(p\mesh)
		
		p\yaw = EntityYaw(p\mesh)
		
		TranslateEntity p\mesh,0,p\velocityY,0
		
		CameraProject(camera,EntityX(p\mesh),EntityY(p\mesh),EntityZ(p\mesh)) 
		
		Color 255,255,255
		If p\id &lt;&gt; localID Then Text ProjectedX(),ProjectedY()-50,p\name,1,1
		
	Next

End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function CreatePlayer(id,name$)

	p.player = New player
	p\id = id
	p\name = name
	
	p\mesh = CreateSphere(32)
	EntityType p\mesh,player_col
	EntityRadius p\mesh,1
	EntityPickMode p\mesh,1
	
	nose = CreateSphere(8,p\mesh)
	EntityColor nose,102,102,255
	PositionEntity nose,0,0,1
	ScaleEntity nose,0.3,0.3,0.3
	
	p\x = -20
	p\y = 1.001
	p\z = -25
	p\yaw = -45
	
	p\r = Rand(68, 108)
	p\g = Rand(207, 227)
	p\b = Rand(252, 255)
	EntityColor p\mesh,p\r,p\g,p\b
	
	PositionEntity p\mesh,p\x,p\y,p\z
	RotateEntity p\mesh,0,p\yaw,0
	ResetEntity p\mesh
		
	Return p\mesh

End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function UpdateChaseCam(camera,player) ; thanks to jfk EO-11110 on bb forums for this function !
	PositionEntity camera,EntityX(player,1),EntityY(player,1),EntityZ(player,1)
	ResetEntity camera
	x#=EntityX(player)+Sin(-EntityYaw(player)+180)*x_dis#
	y#=EntityY(player)+y_dis#
	z#=EntityZ(player)+Cos(-EntityYaw(player)+180)*z_dis#
	obstacle=LinePick(EntityX(player),EntityY(player),EntityZ(player),(x-EntityX(player)),y_dis#,(z-EntityZ(player)),0.1)
	If obstacle=0
		new_x#=x
		new_y#=y
		new_z#=z
	Else
		new_x#=PickedX()
		new_y#=PickedY()
		new_z#=PickedZ()
	EndIf
	If bounce_cam=0
		PositionEntity camera,new_x,new_y,new_z
	Else
		x=old_x+((New_x-old_x)/bounce_div#)
		y=old_y+((New_y-old_y)/bounce_div#)
		z=old_z+((New_z-old_z)/bounce_div#)
		PositionEntity camera,x,y,z
	EndIf
	PointEntity camera,player
	TurnEntity camera,-20,0,0     ; if you want the player mesh more on the bottom of the screen
	old_x#=EntityX(camera)
	old_y#=EntityY(camera)
	old_z#=EntityZ(camera)
End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function CreateScene()

	texture = TextureCreate(128)
	
	ground = CreatePlane()
	EntityColor ground,150,150,150
	EntityTexture ground,texture
	
	cube = CreateCube():EntityColor cube,150,200,150
	ScaleEntity cube,5,5,5:PositionEntity cube,0,5,0
	EntityTexture cube,texture
	
	sphere = CreateSphere(32):EntityColor sphere,200,150,150
	ScaleEntity sphere,3,1,3:PositionEntity sphere,0,9.7,0
	
	platform = CreateCube():EntityColor platform,150,150,200
	ScaleEntity platform,3,1,10:PositionEntity platform,0,4.13,-13.15
	TurnEntity platform,-30,0,0
	EntityTexture platform,texture
	FreeTexture texture

	EntityType ground, flr_col
	EntityPickMode ground, 2

	EntityType cube, obj_col
	EntityPickMode cube,2

	EntityType sphere, obj_col
	EntityPickMode sphere, 2

	EntityType platform, platform_col
	EntityPickMode platform, 2

	light = CreateLight()
	TurnEntity light,30,70,0
	
	;Collisions 2,2,1,2
	;Collisions 2,1,2,3
	
	Collisions player_col, flr_col, 2, 2
	Collisions player_col, obj_col, 2, 3
    Collisions player_col, platform_col, 2, 2

End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function TextureCreate(size)
	texture = CreateTexture(size,size,9)
	SetBuffer TextureBuffer(texture)
	Color 255,255,255
	Rect 0,0,size,size,1
	Color 0,0,0
	Rect 0,0,size,size,0
	Line 0,0,size,size
	Line 0,size,size,0
	SetBuffer BackBuffer()
	Return texture
End Function</textarea><br><br>Enjoy, and I hope you can fix at LEAST the MAIN issue with the camera! :)<br><br>Sincerely, <br><br>~GF <br><br></td></tr></table><br>
<a name="1286598"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flanker</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#58">[#58]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't really understand the problems you mentioned.<br><br>The example already has 2 collision type, "1" for the scene and "2" for the players. Players to Scene is ellipsoid to polygon with prevent to slide on slopes. Players to players is ellipsoid to ellipsoid with full slide. It didn't work well for you ?<br><br>The camera always follow the local player, it can never switch to another one unless you modified it ^^<br><br>And for the spawn yes everyone spawn at the same location, it's in the CreatePlayer() function :<br><br><pre class=code>	p\x = -20
	p\y = 1
	p\z = -20
	p\yaw = -45</pre><br><br>You can change that and the server player will have to send it to everyone.<br><br>The example is just an example, the library just handles connections, proper messages routing and host switching. All the rest is up to you. <br><br></td></tr></table><br>
<a name="1286653"></a>

<a name="1286654"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#59">[#59]</a></td></tr></table></td></tr><tr ><td class="posttext"> @GF: I haven't run into what you mentioned(or not noticed). And don't forget this is example code only, the main thing is that the UDP multiplayer networking host switching thing should work(for me then). <br>Cams and all that are things like that should be easily fixable, if needed that is(not yet for me).<br><br>@Flanker: Just did a quick first test running the 3dexample.bb, on local machine, 1 server/player, with 2 joined players: Success!!! Runs like a charm. Thank you very much for this so far.<br><br><br>What I did was:<br>1. start server at 127.0.0.1, port 80. When started moved player around from origin.<br>2. joined player at port 1 and moved round; no issues with cam found.<br>3. added another player and mover round; all the same to me, all fine so far.<br><br>Next I tested adding a player on the LAN(on different router) to see if caught on: OK, after the required firewall allow messages(time out was bit quick I must say, had to do several start attempts as firewall kicked in/obstructed and before I could allow it through it already said that couldn't start game).<br>As server port I used 80, as client port 81.<br><br>Next to test is:<br>- The 2d example(went for the greatest pleasure, 3d, first ;-)<br>- Adding another player on 2nd laptop connected to the WLAN(wifi).<br>- Adding a player on a remote PC over WAN(internet) and see how goes.<br>- Try host switching.<br><br>Again, thanks very much for your effort so far. <br><br></td></tr></table><br>
<a name="1286658"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flanker512</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#60">[#60]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Guy Fawkes : I guess the problem you mentioned with the camera is when another player comes between the camera and the player, so it can be fixed by removing "EntityPickMode p\mesh,1" in the CreatePlayer() function.<br><br>@Rick Nasher : you're welcome, it's nice to hear it works quite well for you two. For the  moment, the host switching works only if the server quits properly as I didn't implement a constant ping-pong to check if server didn't crash, this will be in v1.1 probably.<br><br>Also, in the examples, It reads only one message per frame, after some testing it's better to read all available messages (for a lot of players connected we would read only X messages), so you can change it with something like "While Net_CheckMessage()... Wend". But don't forget to send a message only when it is necessary.<br><br>I've tested an example based on this article : <a href="https://developer.valvesoftware.com/wiki/Source_Multiplayer_Networking" target="_blank">https://developer.valvesoftware.com/wiki/Source_Multiplayer_Networking</a><br>It works quite well, but still have some work on it. <br><br></td></tr></table><br>
<a name="1286663"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#61">[#61]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>I've fixed QUITE a few things in here<br> <br></div><br><div class="quote"> <br>and I hope you can fix at LEAST the MAIN issue<br> <br></div><br>Déjà vu... <br><br></td></tr></table><br>
<a name="1286666"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#62">[#62]</a></td></tr></table></td></tr><tr ><td class="posttext"> @RemiD: pls no.. not that road again. It's thread pollution and not making things better. :-)<br><br>@Flanker:<br>Test#2. <br>- Adding another player on 2nd laptop connected to the WLAN(wifi): works same as on LAN, test passed. (But same issues with connecting; times out too quickly, so need to restart the application several times, otherwise not enough time to allow through to firewall. But I found the:<br>"Global net_timeOut = 5000" so that can be changed easily(will test).<br>- Host switching appears to go pretty smooth indeed, at least the local network. Some data display is needed for new player to join so can see who's avail as server(will test). And indeed ping is needed for determining who's is the best candidate for being the new server(not implemented yet I believe to have seen, but I glanced only briefly, family weekend, otherwise I get punished :-).<br><br><br>To test still(tomorrow):<br>- The 2d example.<br>- Adding a player on a remote PC over WAN(internet) and see how goes. <br><br></td></tr></table><br>
<a name="1286704"></a>

<a name="1286705"></a>

<a name="1286706"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#63">[#63]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>It's thread pollution and not making things better<br> <br></div><br>but GF posts are useful and making things better...<br><br>@Flanker&gt;&gt;Good work, sorry for the useless comments <br><br></td></tr></table><br>
<a name="1286758"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flanker</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#64">[#64]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Rick Nasher : yes net_timeOut is the time in milliseconds a client will wait for an answer from the server when connecting. The ping-pong will be there only to check if a player or the server is still up. The best candidate for being the new host must be the most ancient player, or the most recent so everybody will know where to connect if the server crashes, it has to be a rule I think.<br><br>@RemiD : thanks, did you try the library ? <br><br></td></tr></table><br>
<a name="1286765"></a>

<a name="1286766"></a>

<a name="1286767"></a>

<a name="1286769"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#65">[#65]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Flanker&gt;&gt;<br>No, i have just taken a look at the code and created a server just to see what you have made. The code seems structured and clear. Not sure if it is reliable. Rick will probably help you to test, he seems to be into multiplayer games on a network these days...<br><br><br>@Rick&gt;&gt;Not sure if you are aware of this or not, but there was a discussion on the forum some time ago where the idea was to use a php page to read/write txt files on a web space in order to know if there are players online, if there are existing game servers online, what are the ip addresses of the game servers online and of the players of each game server so that you don't have to type the ip address and the port number manually. Do a search you will probably find it. <br><br></td></tr></table><br>
<a name="1286819"></a>

<a name="1286823"></a>

<a name="1286835"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#66">[#66]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Flanker: Sorry haven't been able to test over the internet last night due to other obligations demanding my attention and became too late to take over the other system as the person is asleep now. Wasn't exactly what I had in mind for tonight, would much rather have tested out this stuff as I'm burning up with curiosity to see if works alright. <br><br>Regarding the switching rules: You might be right; I was thinking only in terms of the player with the lowest ping value, should become the new server as it's the fastest connection, but this may not always be the best choice perhaps.<br><br><i>I'll keep you posted on my testing progress. Tomorrow night nothing should come in between. Btw: I agree with RemiD; the code is looking really nice and clean I must say. -No spaghetti whatsoever.</i><br><br>P.S. Tested the 2D example, which of course also works very well and is a little more verbal. Very nice as it shows what can be done, with chat and reporting events onscreen.<br><br><br><br>@RemiD: certain things are better left as is, can't change what you can't change if you know what I mean.. ;-)<br><br>And sure, the PHP approach is way of doing it, but I'm not in a need for that just yet(first things first), but indeed would be nice to have as an option, especially when playing over the internet.<br><br>For a LAN-party it's less necessary I think, for should be possible to scan the network for special packages or pressent &amp; exchange a list of all servers/clients available between the players on the LAN. Also if all comes down to it(if all else fails), in a LAN-party people can just manually exchange the IP's &amp; ports, but of course automated is much more player friendly and more neat, so I'd try to establish something like that also.<br><br><i>And indeed multiplayer is what I'm after(shouldn't every modern game??), but is not a new thing, was the end goal all along and I'm trying to incorporate this feature in my existing game. It should have some AI players also of course, but I don't foresee issues with that. Have that working partially already and will extend/build on this.</i> <br><br></td></tr></table><br>
<a name="1286876"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#67">[#67]</a></td></tr></table></td></tr><tr ><td class="posttext"> The approach to read/write .txt files on a predefined web space is to facilitate the process to know what are the available game servers and available players. (and also not have to manually type the ip address and port number)<br><br>But you could use the same approach in a local network by reading/writing .txt files on a predefined computer (with a fixed ip address) and make each client machine scan these .txt files to know which game servers / players are available in the local network.<br>Of course this requires one more computer. But the advantage is that it will prevent cheating if all the important calculations are done on this separate computer. <br><br></td></tr></table><br>
<a name="1286975"></a>

<a name="1286976"></a>

<a name="1286977"></a>

<a name="1286979"></a>

<a name="1286980"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#68">[#68]</a></td></tr></table></td></tr><tr ><td class="posttext"> @RemiD: Sounds like a good approach indeed. I basically want to offer 4 game modes:<br><br>1) Single player with AI bots.<br>2) Multiplayer LAN party(with bots when no other players are available). No central server required, just host switching to keep it flexible and simple to run. A list of servers/players on the LAN could be presented using broadcasting on the LAN.<br>3) Multiplayer over the internet(WAN) in the same way.<br><br>4) In above multiplayer modes people need to know each other in order to provide IP &amp; ports, but if the game is more successful and more people want to play, I would need to provide a way to get that data across, so that complete strangers can join. Perhaps by what you describe. As in that case I would probably need to run/hire a server, then I could also setup a central server to run(part of) the game world. And in such a scenario a second server as backup to switch to if #1 crashes is not a bad idea too. <br><br></td></tr></table><br>
<a name="1286987"></a>

<a name="1286988"></a>

<a name="1286989"></a>

<a name="1286990"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#69">[#69]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Flanker:<br>Update, tested:<br>- Adding a player on a remote PC over WAN(internet):<br><br>1. Raised IP timeout to 50000 to give more time to connect.<br>2. Used <a href="http://www.whatsmyip.org/" target="_blank">http://www.whatsmyip.org/</a> to find out my own and my friends 'real world' IP's.<br>3. Created server on my system using WAN IP 87.210.xx.xxx on port# 80.<br>4. Tried to join from my friend's PC to the server on my system, using port 81 for his PC, but couldn't join game.<br>5. Put Firewalls into gamemode to allow passing through: no change.<br>6. Tried other way round: server on his system, me trying to join: still no go.<br><br>Perhaps I have to manually open ports on the firewalls/routers(port forwarding?) to allow this to go through? However when tried on LAN it did work and firewall nicely asked permission, now nothing showed up. This could be because it has a different, more strict ruleset for connections to outside the LAN, but I doubt this a bit. Or need to raise timeout even more? Other possible cause could be I was using TeamViewer to control his PCand dunno which ports that is using or that causing more delay in making the connecting.<br><br>Any other ideas? <br><br></td></tr></table><br>
<a name="1286991"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#70">[#70]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes. I'm LOVING this network library! I was wondering if we could add a function that will automatically (and safely), allow the server host to AUTOMATICALLY be added to the firewall, as it's a pain in the ass everytime I keep trying to test it on different ports &gt;.&lt; As for the camera thing, I tested it, and I must say... WOW! THANK you for finding the fix! I appreciate it! :)<br><br>Sincerely, <br><br>~GF <br><br></td></tr></table><br>
<a name="1287008"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flanker</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#71">[#71]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Rick Nasher :<br>I have quite the same problem here, and the cause is the NAT/router. You will have to set your ports correctly in the router (port forwarding). Port 80 shouldn't be used I think, it's usually reserved for network things, you should use from 1024 to 65535.<br><br>The timeout shouldn't be an issue, maybe set it to 10000, but the connection should be instantaneous or so (depending on ping). For me it works one time, then I have to wait several minutes(it seems random...) to make another connection but my NAT is crappy, it's probably a security issue... You can test it on the same computer, entering your public IP for the server, it will go through the router and try to come back on the port of the server. I'll try others things and let you know.<br><br>Guy Fawkes : I'm afraid I don't know how to access to the rules of a firewall. But you can probably set the blitz3d application to be ignored by the firewall. <br><br></td></tr></table><br>
<a name="1287018"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#72">[#72]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yea, Flanker's right guys. I tested up to 7+ simultaneous connections using my INTERNAL IP (or my IPV4 IP address) and it worked VERY smoothly. (Minus that damn camera glitch, lol )<br><br>~GF <br><br></td></tr></table><br>
<a name="1287019"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#73">[#73]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Rick Nasher :: In your recent test, you mention NOWHERE about FIRST "Port Forwarding" your "server" on your "router" ;) <br><br></td></tr></table><br>
<a name="1287192"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#74">[#74]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hope that helps, @Rick Nasher! :)<br><br>~GF <br><br></td></tr></table><br>
<a name="1287207"></a>

<a name="1287209"></a>

<a name="1287210"></a>

<a name="1287211"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#75">[#75]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Flanker: <br>Hmm, new stuff to try &amp; check, nice.. :-)<br><br>- Before I used port 80 as was used by NetBlitz and some other libs. Normally 80 I believe is reserved for HTTP traffic, so thought would allow smooth access as it's open anyway, but not sure- ah well checked it: many people say it is, but just in case here's <a href="https://en.wikipedia.org/wiki/List_of_TCP_and_UDP_port_numbers" target="_blank">Wikipedia:List of TCP and UDP port numbers</a>.<br>- I raised the timeout for the antivirus and firewalls I'm using (Avast, Comodo and ZoneAlarm) on different PC's usually take some time to kick in and present the allow/deny access requesters. So before I could answer 'Allow Access', the application would say something like: "Couldn't start game" and exit, resulting in several attempts to get one PC connected to another.<br><br><div class="quote"> You can test it on the same computer, entering your public IP for the server, it will go through the router and try to come back on the port of the server. <br></div>- Will try the other range 1024 to 65535 and entering public IP for the server: Seems like a good idea to see if works. It was actually gonna be my next question, if there's a way to force the router to use a certain IP address over the internet instead it looks for it on the LAN. So I guess you answered my thought(who needs internet if there's ESP). ;-)<br>Then again.. long time since I dealt with this stuff, but isn't the router smart enough and has an IP look up table that will detect that the public IP is actually local, so it(the packet) never leaves the LAN and never reaches the next internet router that holds the complete table for this IP address, so translates directly into local IP's? See: <a href="https://en.wikipedia.org/wiki/Routing_table" target="_blank">look up tables</a> and <a href="https://en.wikipedia.org/wiki/Address_Resolution_Protocol" target="_blank">ARP</a>(I need to dive into my books to know for sure).<br><br><br>@GF:<br><div class="quote">  In your recent test, you mention NOWHERE about FIRST "Port Forwarding" your "server" on your "router" ;) <br></div>True, for I haven't actually tried that yet, for locally it worked fine over 2 connected local routers; I have two routers and both use a different IP range.<br>I use router#1 for internet(WAN)access, LAN and WLAN(wifi) and router#2 for I need some ports at my desk too, when checking/repairing systems and downloading stuff from the desktop PC. <br><br></td></tr></table><br>
<a name="1287219"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#76">[#76]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yea, I noticed if "I" don't connect to MY External IP (WAN IP), it won't let ME through, but it lets everyone else through for port forwarding, so it's good. It should work! :) <br><br></td></tr></table><br>
<a name="1287506"></a>

<a name="1287507"></a>

<a name="1287509"></a>

<a name="1287519"></a>

<a name="1287587"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#77">[#77]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm..<br>Tested:<br>1. Created server on port range 1024 to 65535: 10xx<br>2. Tried to join using my public IP: 87.210.xx.xxx, serverport mentioned above, clientport 10xx+1.<br><br>After a minute or so got msg:<br><br>Error!<br>Failed to start game. [OK]<br><br>Then it exits.<br>When I use 127.0.0.1 it instantly connects, so I guess the router isn't able to check that this is actually the IP I'm using and so not replacing it with the local IP 127.0.0.1(as assumed). This could mean it's not that smart or that it can't communicate as the ports are closed.<br><br>&gt;&gt; In my next test I will delve into my router and open up some ports.<br>BTW: From the ports wiki I get that range 4915265535 is non-registered, does this mean this is the preferred range to pick from with a new application such as our online gaming? Any ideas? <br><br></td></tr></table><br>
<a name="1287589"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#78">[#78]</a></td></tr></table></td></tr><tr ><td class="posttext"> as I said. YOU can't use YOUR WAN IP because YOU own it. Other players can, but you can't. How YOU connect is through YOUR INTERNAL IP (IE: 192.168.0.100).<br><br>~GF <br><br></td></tr></table><br>
<a name="1287648"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flanker</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#79">[#79]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Rick Nasher : you could use any port in fact, but it is assumed that from 1024 to 65535, ports won't be in conflict with the most common used ports. Companies can register ports but if you don't use their software you can use their ports, but not for commercial purpose I think.<br><br>@Guy Fawkes : you may be right now, but several years ago I was able to do so, using my own public IP with a server-client session in blitz3d through my internet box. Today through my router I can create a server, join it and receive packets from the server, but if I send something to the server the udp stream fails. <br><br></td></tr></table><br>
<a name="1287807"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flanker</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#80">[#80]</a></td></tr></table></td></tr><tr ><td class="posttext"> Guy Fawkes is right about our own public IP. I tried to send a packet to my public IP through the NAT, and I received it, but the command UDPMsgIP() returns my own local IP, so the NAT detects his own IP and converts it to the local IP from where it comes from. So we can't test anymore with our own public IP.<br><br>Anyway, some better news, I've been able to test the 3D example over internet with my phone as a 3g modem, so it gives my other computer a unique public IP. It works well, except the high ping and the high packets loss, but I assume it's because of the crappy 3g connection. <br><br></td></tr></table><br>
<a name="1287839"></a>

<a name="1287922"></a>

<a name="1287923"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#81">[#81]</a></td></tr></table></td></tr><tr ><td class="posttext"> Cool! Tonight I'll try with a remote PC to see if goes through after opening ports in the NAT.<br>[EDIT: well, tomorrow that will be then(couldn't reach the remote PC)] <br><br></td></tr></table><br>
<a name="1288017"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#82">[#82]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok here goes.. Connecting to a remote PC over the internet after opening some ports on the router: It works perfectly! <br>Of course was some lag as I was using TeamViewer to control the remote PC and it's not a super fast internet connection, but still very do-able. <br><br><b>Thanks very much Flanker, you've done a great job! I owe you one big time. (well.. actually the whole Blitz3d/BlitzPlus community!) :-D</b><br><br>Next I'll do some performance/code tests and get back to this. <br><br></td></tr></table><br>
<a name="1288023"></a>

<a name="1288024"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#83">[#83]</a></td></tr></table></td></tr><tr ><td class="posttext"> It'd be beneficial to use interpolation on the packets to maintain a smooth &amp; non-dropping packet stream, free of lag.<br><br>Alls I can do is give you guys ideas. :)<br><br>~GF<br><br>P.S. You're QUITE welcome, mr. Nasher! ^_^<br><br>~GF <br><br></td></tr></table><br>
<a name="1288031"></a>

<a name="1288033"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#84">[#84]</a></td></tr></table></td></tr><tr ><td class="posttext"> Of course I thank you for your input too GF. ;-) I do value your thinking along and support in this. <br><br></td></tr></table><br>
<a name="1288059"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flanker</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#85">[#85]</a></td></tr></table></td></tr><tr ><td class="posttext"> You're welcome Rick Nasher :)<br><br>@Guy Fawkes, the interpolation has to be done by the user, not the library as you can send whatever you want in the packets.<br><br>I'm writing an example with interpolation for the version 1.1 of the library. <br><br></td></tr></table><br>
<a name="1288060"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#86">[#86]</a></td></tr></table></td></tr><tr ><td class="posttext"> Even more to come. Wauw, I'm very, very curious.. <br><br></td></tr></table><br>
<a name="1288066"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#87">[#87]</a></td></tr></table></td></tr><tr ><td class="posttext"> O this is gonna RULE! How long before 1.1?! =D <br><br></td></tr></table><br>
<a name="1288069"></a>

<a name="1288070"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#88">[#88]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>It'd be beneficial to use interpolation on the packets to maintain a smooth &amp; non-dropping packet stream, free of lag<br> <br></div><br>You seem to have no idea what you are talking about, it's funny to read :) <br><br></td></tr></table><br>
<a name="1288074"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#89">[#89]</a></td></tr></table></td></tr><tr ><td class="posttext"> With interpolation is meant the difference between the current and the position moved to, or in some cases the guessed/estimated position, based upon previous input and speed, and then tweening the next frame to get smooth movement, right? <br><br></td></tr></table><br>
<a name="1288078"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#90">[#90]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ignoring RemiD because he'd rather be a self-centered jack*** along with a few unnamed others in here which I am also ignoring, what I mean, Rick, is the interpolation between packets. <br><br></td></tr></table><br>
<a name="1288085"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flanker</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#91">[#91]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, basically it's a linear interpolation beetween previous position and next position. For the moment I use something like this :<br><pre class=code>rate# = (MilliSecs()-nextTime) / (nextTime-previousTime)
PositionEntity mesh,previousX+(nextX-previousX)*rate,previousY+(nextY-previousY)*rate,previousZ+(nextZ-previousZ)*rate</pre><br>previousTime is the time (Millisecs()) when the previousX,Y,Z has arrived, same for nextTime, so it will interpolate on a delay of nextTime-previousTime, this works quite well for now and automatically does extrapolation in the case of packet loss.<br><br>This great article describes the techniques of the Source engine about networking : <a href="http://developer.valvesoftware.com/wiki/Source_Multiplayer_Networking" target="_blank">http://developer.valvesoftware.com/wiki/Source_Multiplayer_Networking</a> <br><br></td></tr></table><br>
<a name="1288113"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#92">[#92]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sweet! <br><br></td></tr></table><br>
<a name="1288114"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#93">[#93]</a></td></tr></table></td></tr><tr ><td class="posttext"> what would the value of "rate" be? <br><br></td></tr></table><br>
<a name="1288149"></a>

<a name="1288150"></a>

<a name="1288152"></a>

<a name="1288165"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#94">[#94]</a></td></tr></table></td></tr><tr ><td class="posttext"> If i were you i would not focus on interpolation for the moment. This is something which is an improvement of an already functional game. If you manage to have a good enough online multiplayers game at 20fps this would already be a great achievement. Then focus on improving the details...<br><br>Also if each client sends the orientation and actionstate of the player to the server and the server calculates the turns moves, detects the collisions, reorientes repositions, updates the action states, send back the results to the clients, and if at the same time each client does the same calculations but you give a priority to the datas sent by the server, then you won't need interpolation. The players will simply be reoriented repositionned sometimes but if the connection is good enough (low ping) this will probably not be noticeable... <br><br></td></tr></table><br>
<a name="1288151"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flanker</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#95">[#95]</a></td></tr></table></td></tr><tr ><td class="posttext"> The "rate" is calculated each frame, I should call it "currentTime" instead. It tells you the time beetween previousTime and nextTime where your entity should be, so the interpolation is easy. This also means that you will always have a delay beetween a player true position, and the position where you draw it, but it can't be avoided. <br><br></td></tr></table><br>
<a name="1288176"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#96">[#96]</a></td></tr></table></td></tr><tr ><td class="posttext"> Remi, you've done nothing but try to batter ME AND this project. GTFO. I am NOT gonna let a GOOD project get screwed up or cancelled because you're an ignorant jerk. Now LEAVE. Or so help me I will make so many new threads about this project, you won't be able to stop us. <br><br></td></tr></table><br>
<a name="1288182"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flanker</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#97">[#97]</a></td></tr></table></td></tr><tr ><td class="posttext"> @RemiD, the library is already steady, and the v1.1 update naturally needs an advanced example with interpolation and ticks, to really see if the library is reliable.<br><br>The major change in v1.1 is that the server won't automatically route messages to client like it does in v1.0 (it can still be done, just a boolean variable), so the server can receive inputs from players, and send back positions for example. That's why i'm writing an interpolation example with ticks to save bandwidth, and it works pretty well.<br><br>The other change will be the possibility to send packets instead of messages string, by writing to a bank, it will probably improve performances and simplicity to send complex packets. <br><br></td></tr></table><br>
<a name="1288186"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#98">[#98]</a></td></tr></table></td></tr><tr ><td class="posttext"> &lt;3 I love you guys! :D <br><br></td></tr></table><br>
<a name="1288187"></a>

<a name="1288217"></a>

<a name="1288218"></a>

<a name="1288219"></a>

<a name="1288220"></a>

<a name="1288221"></a>

<a name="1288224"></a>

<a name="1288227"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#99">[#99]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sounds pretty good to me. Can't wait to see it in action.<br><br>BTW: did a small(quick &amp; dirty) mod to the Server/Client selection. Saves typing the localhost IP &amp; ports every time when testing out stuff.<br><br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; Set a default host port.
Global DefaultHostPort= 30000; this goes near the line "Global net_switchHost = True"

Function Net_StartInput()

	;;; basic start input
	.net_reset
		
		Cls:Locate 0,0
		Print "1. Join server"
		Print "2. Create server"
		net_mode = Input("? ")

		If net_mode = 1 ;Join
			Cls:Locate 0,0
			
			ip$ = Input("Server IP (x.x.x.x) ? [ENTER]=on same machine(local) ")
			If ip$="" Then
				ip$="127.0.0.1"
			EndIf
			
			net_serverPort = Input("Server port (0-65535) ? [ENTER]= "+DefaultHostPort+" ") ; server port
			If net_serverPort=0 Then
				net_serverPort=DefaultHostPort
			EndIf
			
			While net_port=0
				net_port = Input("Local port (0-65535) ? Suggesting "+DefaultHostPort+"+n ") ; client port
			Wend
			
			
			Cls:Locate 0,0
			Return Net_JoinServer(ip,net_serverPort)
			
			
		ElseIf net_mode = 2 ;Server
			Cls:Locate 0,0
			net_port = Input("Local port (0-65535) ? [ENTER]=default "+DefaultHostPort+" ") ; server port
			If net_port=0 Then
				net_port=DefaultHostPort
			EndIf
			
			Cls:Locate 0,0
			Return Net_HostServer(net_port)
		Else
			Goto net_reset
		EndIf

End Function
</textarea> <br><br></td></tr></table><br>
<a name="1288228"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >funkmaster5000</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#100">[#100]</a></td></tr></table></td></tr><tr ><td class="posttext"> First of all thanks for pointing out this thread, Rick Nasher.<br><br>I ran the 2D example on my webserver, without making ANY adjustments to/examining the code whatsoever and connected three clients. It ran pretty well considering, that the server itself is displaying the game state simultaneously (without having a fitting GPU etc.) so I will try to get a dedicated example (possible?) running over the weekend or so.<br><br>Keep up the good work and don't let your motivation get drained by some unthankful people. Thanks for sharing your fruits of labor with us! <br><br></td></tr></table><br>
<a name="1288230"></a>

<a name="1288233"></a>

<a name="1288234"></a>

<a name="1288235"></a>

<a name="1288236"></a>

<a name="1288237"></a>

<a name="1288239"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#101">[#101]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks and your welcome. True I'm on a 'relentless' ;-) hunt for a good UDP gaming solution for Blitz3d/Plus to replace the original routines for some time now, but you should be thanking Flanker as he the one that does all the hard UDP coding and I must say he's done a marvelous job sofar and he isn't even finished yet, but it's already pretty usable. <br>If I could, I would do it myself, but I lack the skill, even though I'm learning a lot from this these days. Flanker's code is written in a very clear &amp; clean fashion, so that helps a lot to understand what's going on. I'm currently combining his 2d example code with the 3d example to show some more info on the screen and make use of the chat routines. <br><br></td></tr></table><br>
<a name="1288249"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#102">[#102]</a></td></tr></table></td></tr><tr ><td class="posttext"> OMG! We should totally make like a 3D hangout room! You know! Kinda' like Phantasy Star Online! Where we can talk all we want on Encrypted chat! :D <br><br></td></tr></table><br>
<a name="1288272"></a>

<a name="1288273"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#103">[#103]</a></td></tr></table></td></tr><tr ><td class="posttext"> My last post was a suggestion to not have to use interpolation, not a critic... Whatever !<br><br><br><div class="quote"> <br>Phantasy Star Online<br> <br></div><br>I use to play this on dreamcast, simple but addicting gameplay. :) <br><br></td></tr></table><br>
<a name="1288283"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#104">[#104]</a></td></tr></table></td></tr><tr ><td class="posttext"> O god yes. I LOVE PSO. <br><br></td></tr></table><br>
<a name="1288533"></a>

<a name="1288534"></a>

<a name="1288535"></a>

<a name="1288536"></a>

<a name="1288537"></a>

<a name="1288538"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#105">[#105]</a></td></tr></table></td></tr><tr ><td class="posttext"> Added chat from the 2Dexample to the 3D example(basically Flanker's 2 examples merged into 1). We can now chat and have bit more info on screen.<br><br>Also included the little mod to the UDP library mentioned above to make testing easier on the local computer(saves on typing info).<br><br><i>Hope you don't mind Flanker(it's not the prettiest of mods(yet). ;-)</i><br><br><u>Things on my to do list:</u> <br>-Show list of available server(s) and port info.<br>-Set up selection: Local machine/LAN/WAN, so can partially pre-fill input's(same as for local machine mod).<br>-Create a GUI for above selections and input.<br>-Add jumping &amp; shooting, etc.<br>-Add ThirdPerson/FirstPerson switching.<br>-Incorporate a ping check for checking if next player in line is capable of being the next server.<br>These I'm not sure of how to implement just yet:<br>-Interpolation.<br>-Dedicated server selection option.<br><br>"UDPNetwork_lib V1.001.bb"<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
;-----------------------------------------------------------------------------------------------------------------------------------;
; Blitz3D UDP Network library 1.0													Author : Flanker (&lt;a href=\"mailto:geadupr@gmail.com\"&gt;geadupr@...;), dec 2015	;
;-----------------------------------------------------------------------------------------------------------------------------------;

;--------------------------------------------------;
; All network functions start with "Net_" prefix ! ;
; All network variables start with "net_" prefix ! ;
; Be aware with you own functions and variables !  ;
;--------------------------------------------------;


; This library is a clone of Blitz3D DirectPlay commands, so look at the DirectPlay documentation and eventually play with it to understand the mechanics.
; The library uses only UDP protocol for fast packet delivery, but it doesn't guarantee packets arrival and order like TCP (maybe implemented in a future version).


; Available functions :			DirectPlay equivalents :		Description :
; ---------------------			------------------------		-------------
; 	Net_StartInput()			StartNetGame()					A basic prompt input to host a server or join an existing one (returns same as below).
; 	Net_HostServer()			HostNetGame()					Like DirectPlay you can override the prompt and directly create a server (returns 2 if server created, 0 if not).
; 	Net_JoinServer()			JoinNetGame()					Like DirectPlay you can override the prompt and directly join a server (returns 1 if server is reachable, 0 if not).
; 	Net_StopNetwork()			StopNetGame()					Just stop the current server or client session, and reset it to default state.
; 	Net_CreatePlayer()			CreateNetPlayer()				Create the LOCAL player. This must be called after you create or joined a session, to init the LOCAL player.
; 	Net_KickPlayer()			DeleteNetPlayer()				Kick a player when you are the server.
; 	Net_CheckMessage()			RecvNetMsg()					You must call this function to check if a new message has arrived. It returns 1 if a message if available in the Net_Msg* variables.
; 	Net_SendMessage()			SendNetMsg()					Sends a message [MsgTyp]-[MsgData$]-[MsgFrom]-[MsgTo], like DirectPlay.


; Available variables :			DirectPlay equivalents :		Description :
; ---------------------			------------------------		-------------
; 	Net_MsgType (integer)		NetMsgType()					| These four are not functions like DirectPlay, but variables.
; 	Net_MsgData$ (string)		NetMsgData()					| They store the last VALID message received by the Net_CheckMessage() function.
; 	Net_MsgFrom (integer)		NetMsgFrom()					| So if Net_CheckMessage() returns 0, they will still have the last valid message stored.
; 	Net_MsgTo	(integer)		NetMsgTo()						| This maybe changed easily, but I don't think it is necessary.


; Removed functions :			Description :
; ---------------------			-------------
; NetPlayerName()				Useless because the player name can be read with Net_MsgData when the new player is created (Net_MsgType 100)
; NetPlayerLocal()				Useless because you should already know your local ID, that's a base...


; You may write message type from 1 to 99 for you needs.
; ------------------------------------------------------

; Also, you can read certain message types :
; ------------------------------------------
; 	100 - tells that a new player has joined (use Net_MsgData to get the name, and Net_MsgFrom to get the ID)
; 	101 - tells a player has quit (use Net_MsgData to get the name, and Net_MsgFrom to get the ID)
; 	102 - the host has changed, the new host id can be read with Net_MsgFrom
; 	200 - fatal exception, if you receive that something is wrong

; Messages types used ONLY by the library :
; -----------------------------------------
; 	0 - used for ping (not yet implemented)
; 	201 - used by client to ask library version check (this is also a first connection test with the server)
; 	202 - used by server to approve library version of client
; 	203 - used by client to ask for connection
; 	204 - used by server to approve connection of client
; 	205 - used by client to inform the server that he is leaving
;	206 - used by server to designate a new host when he is leaving (auto switch host enabled)

; Here you can eventually change the timeout variable (milliseconds) :
Global net_timeOut = 5000

; And here enable or disable auto switch host
Global net_switchHost = True

; Set a default host port.
Global DefaultHostPort= 30000; 80

; From here I can't say better than Stayne on BB forums :
; "Going down the confusing rabbit hole of trying to decipher someone else's network code is a dark one. Gooooooooooood luck." :)
; Feel free to contact me by e-mail if you need help.

;-----------------------------------------------------------------------------------------------------------------------------------;
; Oh, and BTW, this library is licensed under the NoLicenseRequired agreement, meaning that you can do whatever you want with it... ;
;-----------------------------------------------------------------------------------------------------------------------------------;

Type net_client
	Field ID
	Field name$
	Field IP
	Field port
End Type

Global net_version$ = "v1.0"
Global net_mode
Global net_stream
Global net_backupStream
Global net_port
Global net_serverIP
Global net_serverPort
Global net_ID

Dim net_data$(255)

; these are not functions but they have a "Net_" prefix as they will be used by library user
Global Net_MsgType
Global Net_MsgData$
Global Net_MsgFrom
Global Net_MsgTo

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function Net_StartInput()

	;;; basic start input
	.net_reset
		
		Cls:Locate 0,0
		Print "1. Join server"
		Print "2. Create server"
		net_mode = Input("? ")

		If net_mode = 1 ;Join
			Cls:Locate 0,0
			ip$ = Input("Server IP (x.x.x.x) ? ")
			net_serverPort = Input("Server port (0-65535) ? ") ; server port
			net_port = Input("Local port (0-65535) ? ")        ; client port
			Cls:Locate 0,0
			Return Net_JoinServer(ip,net_serverPort)
		ElseIf net_mode = 2
			Cls:Locate 0,0
			net_port = Input("Local port (0-65535) ? ")        ; server port
			Cls:Locate 0,0
			Return Net_HostServer(net_port)
		Else
			Goto net_reset
		EndIf

End Function


Function Net_StartInput2()

	;;; basic start input
	.net_reset
		
		Cls:Locate 0,0
		Print "1. Join server"
		Print "2. Create server"
		net_mode = Input("? ")

		If net_mode = 1 ;Join
			Cls:Locate 0,0
			Print "Server IP(x.x.x.x)? "
			ip$ = Input("[ENTER]=on same machine(local) ")
			If ip$="" Then
				ip$="127.0.0.1"
			EndIf
			
			net_serverPort = Input("Server port (0-65535) ? [ENTER]= "+DefaultHostPort+" ") ; server port
			If net_serverPort=0 Then
				net_serverPort=DefaultHostPort
			EndIf
			
			While net_port=0
				net_port = Input("Local port (0-65535) ? Suggesting "+DefaultHostPort+"+n ") ; client port
			Wend
			
			
			Cls:Locate 0,0
			Return Net_JoinServer(ip,net_serverPort)
			
			
		ElseIf net_mode = 2 ;Server
			Cls:Locate 0,0
			net_port = Input("Local port (0-65535) ? [ENTER]=default "+DefaultHostPort+" ") ; server port
			If net_port=0 Then
				net_port=DefaultHostPort
			EndIf
			
			Cls:Locate 0,0
			Return Net_HostServer(net_port)
		Else
			Goto net_reset
		EndIf

End Function
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function Net_HostServer(port)

	net_port = port

	net_stream = CreateUDPStream(net_port)

	If net_stream And Net_StreamBackup()
		net_mode = 2
		Return 2
	EndIf
	
End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function Net_JoinServer(ip$,port)

	net_serverIP = Net_DotToInt(ip)
	net_serverPort = port

	net_stream = CreateUDPStream(net_port)
	If net_stream
		
		WriteByte net_stream,201 ; I want to check the library version
		WriteString net_stream,net_version
		SendUDPMsg(net_stream,net_serverIP,net_serverPort)
		
		net_temp = MilliSecs()
		While MilliSecs()-net_temp &lt; net_timeOut
			If RecvUDPMsg(net_stream)
				If ReadByte(net_stream) = 202 ; library version approved by server
					Return 1
				Else
					CloseUDPStream(net_stream):net_stream = 0
					Return
				EndIf
			EndIf
			Delay 1
		Wend
		CloseUDPStream(net_stream):net_stream = 0
	EndIf	

End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function Net_StopNetwork()

	If net_stream
		If net_mode = 2
			
			n.net_client = First net_client
			Net_SendMessage(101,n\name,n\ID)
			Delete n
			
			If net_switchHost
						
				; count players
				For n.net_client = Each net_client
					net_temp = net_temp + 1				
				Next
				
				If net_temp &gt; 0
			
					; choose the new host, it will be the most ancient client
					n.net_client = First net_client
					
					net_newHostID = n\ID
					net_newHostName$ = n\name
					net_newHostIP = n\IP
					net_newHostPort = n\port
									
					; then send new informations to players
					For n.net_client = Each net_client
						
						WriteByte net_stream,206
						WriteInt net_stream,net_newHostID
						
						If n\ID = net_newHostID ; send that only to the new host
							
							WriteInt net_stream,net_temp ; players count
							
							For c.net_client = Each net_client
								WriteInt net_stream,c\ID
								WriteString net_stream,c\name
								WriteInt net_stream,c\IP
								WriteInt net_stream,c\port	
							Next
												
						Else ; send new host infos to other players
						
							WriteInt net_stream,net_newHostIP
							WriteInt net_stream,net_newHostPort
						
						EndIf
						
						SendUDPMsg(net_stream,n\IP,n\port)
				
					Next
				
				EndIf

			EndIf
			
			If net_backupStream Then CloseUDPStream(net_backupStream):net_backupStream = 0
		Else
			WriteByte net_stream,205
			SendUDPMsg(net_stream,net_serverIP,net_serverPort)
		EndIf
		CloseUDPStream(net_stream):net_stream = 0
	EndIf

	For n.net_client = Each net_client
		Delete n
	Next
	
	net_mode = 0

	net_stream = 0
	net_port = 0
	
	net_serverIP = 0
	net_serverPort = 0
	
	net_ID = 0
		
	Net_MsgType = 0
	Net_MsgData = ""
	Net_MsgFrom = 0
	Net_MsgTo = 0

End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function Net_CreatePlayer(name$)

	If net_stream
		If net_mode = 2
			n.net_client = New net_client
			net_ID = MilliSecs()
			n\ID = net_ID
			n\name = name
			Return n\ID
		Else
			WriteByte net_stream,203 ; I want to connect
			WriteString net_stream,name ; my name is "name"
			SendUDPMsg(net_stream,net_serverIP,net_serverPort)
			net_temp = MilliSecs()
			While MilliSecs()-net_temp &lt; net_timeOut
				If RecvUDPMsg(net_stream)
					If ReadByte(net_stream) = 204 ; connection approved by server
						net_ID = ReadInt(net_stream)
						Return net_ID
					Else
						CloseUDPStream(net_stream):net_stream = 0
						Return
					EndIf
				EndIf
				Delay 1
			Wend
			CloseUDPStream(net_stream):net_stream = 0
		EndIf
	EndIf

End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function Net_KickPlayer(name$)

	If net_mode = 2
	
		For n.net_client = Each net_client
		
			If n\name = name
				Net_SendMessage(101,n\name,n\ID)
				Delete n
			EndIf		
		
		Next
	
	EndIf
	
End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function Net_CheckMessage()

	If net_stream
		If RecvUDPMsg(net_stream)
						
			net_temp = ReadByte(net_stream)
			If net_temp &gt; 0 And net_temp &lt; 103
				Net_MsgType = net_temp
				Net_MsgData = ReadString(net_stream)
				Net_MsgFrom = ReadInt(net_stream)
				Net_MsgTo = ReadInt(net_stream)
				
				;If net_mode = 2 And Net_MsgType &lt; 100 Then Net_RouteMessage(Net_MsgType,Net_MsgData,Net_MsgFrom,Net_MsgTo)
				If net_mode = 2 And Net_MsgFrom &lt;&gt; net_ID And Net_MsgTo &lt;&gt; net_ID And Net_MsgType &lt; 100 Then Net_RouteMessage(Net_MsgType,Net_MsgData,Net_MsgFrom,Net_MsgTo)
				
				Return 1
			Else
						
				Select net_temp
				
					Case 201 ; a client wants to check his library version
												
						If net_mode = 2
							If ReadString(net_stream) = net_version
								WriteByte net_stream,202 ; client library version approved
							Else
								WriteByte net_stream,200 ; fatal exception
							EndIf
							SendUDPMsg(net_stream,UDPMsgIP(net_stream),UDPMsgPort(net_stream))
						EndIf
					
					Case 203 ; a client wants to connect
										
						If net_mode = 2
						
							; verify if the pair ip/port doesn't already exists
							For n.net_client = Each net_client
								If UDPMsgIP(net_stream) = n\IP And UDPMsgPort(net_stream) = n\port
									WriteByte net_stream,200 ; fatal exception
									SendUDPMsg(net_stream,UDPMsgIP(net_stream),UDPMsgPort(net_stream))
									Return
								EndIf
							Next
							
							; everything is fine
							net_temp = MilliSecs() ; that's the new ID of the player
							net_temp2$ = ReadString(net_stream)
							
							; inform the player that we approved
							WriteByte net_stream,204 ; connection approved
							WriteInt net_stream,net_temp
							SendUDPMsg(net_stream,UDPMsgIP(net_stream),UDPMsgPort(net_stream))
							
							; inform all players that a New player has joined
							Net_SendMessage(100,net_temp2,net_temp)
							
							; now we create the player
							n.net_client = New net_client
							n\ID = net_temp
							n\name = net_temp2
							n\IP = UDPMsgIP(net_stream)
							n\port = UDPMsgPort(net_stream)
							
							; and we tell him who is already connected
							For n.net_client = Each net_client
								If n\ID &lt;&gt; net_temp Then Net_SendMessage(100,n\name,n\ID,net_temp)
							Next
														
						EndIf
						
					Case 205 ; a client is leaving
												
						If net_mode = 2
						
							; check wich client is leaving
							For n.net_client = Each net_client
								If UDPMsgIP(net_stream) = n\IP And UDPMsgPort(net_stream) = n\port
									Net_SendMessage(101,n\name,n\ID) ; tell other clients who leaved
									Delete n
								EndIf
							Next
						
						EndIf
					
					Case 206 ; the host is leaving, new host informations
										
						If net_mode = 1
							net_temp = ReadInt(net_stream) ; new host ID
							
							If net_temp = net_ID ; we are the new host
								If Net_StreamBackup()
									net_mode = 2
									net_temp = ReadInt(net_stream) ; number of players to create
																								
									For i = 1 To net_temp
										n.net_client = New net_client
										n\ID = ReadInt(net_stream)
										n\name = ReadString(net_stream)
										n\IP = ReadInt(net_stream)
										n\port = ReadInt(net_stream)
									Next
									
									Net_SendMessage(102,"",net_ID)
									
								Else
									Net_StopNetwork()
									RuntimeError("Failed to become the new host.")
								EndIf
							Else
								net_serverIP = ReadInt(net_stream)
								net_serverPort = ReadInt(net_stream)
							EndIf
						EndIf					
						
				End Select
					
			
			EndIf
								
		EndIf
		
	EndIf
	
End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function Net_SendMessage(typ,message$,sender=0,recipient=0)

	If sender = 0 Then sender = net_ID

	If net_mode = 2
		
		For n.net_client = Each net_client
		
			If recipient = n\ID Or recipient = 0
					
				If n\ID &lt;&gt; net_ID
					
					If n\ID &lt;&gt; sender Or n\ID = recipient
						WriteByte net_stream,typ
						WriteString net_stream,message
						WriteInt net_stream,sender
						WriteInt net_stream,recipient
						SendUDPMsg(net_stream,n\IP,n\port)
					EndIf
						
				ElseIf typ = 0 Or typ &gt; 99
					
					WriteByte net_backupStream,typ
					WriteString net_backupStream,message
					WriteInt net_backupStream,sender
					WriteInt net_backupStream,recipient
					SendUDPMsg(net_backupStream,2130706433,net_port) ; integer IP "127.0.0.1"
					
				EndIf
				
			EndIf
		Next

	Else
		
		WriteByte net_stream,typ
		WriteString net_stream,message
		WriteInt net_stream,sender
		WriteInt net_stream,recipient
		SendUDPMsg(net_stream,net_serverIP,net_serverPort)
		
	EndIf

End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function Net_RouteMessage(typ,message$,sender,recipient)

	For n.net_client = Each net_client
	
		If recipient = n\ID Or recipient = 0
				
			If n\ID &lt;&gt; net_ID
				
				If n\ID &lt;&gt; sender
					WriteByte net_stream,typ
					WriteString net_stream,message
					WriteInt net_stream,sender
					WriteInt net_stream,recipient
					SendUDPMsg(net_stream,n\IP,n\port)
				EndIf
		
			EndIf
				
		EndIf
	Next

End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function Net_StreamBackup()

	net_backupStream = CreateUDPStream()
	Return net_backupStream

End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function Net_DotToInt%(ip$)

	; thanks to Chroma on b3d forums for the code !

	off1=Instr(ip$,".")	  :ip1=Left$(ip$,off1-1)
	off2=Instr(ip$,".",off1+1):ip2=Mid$(ip$,off1+1,off2-off1-1)
	off3=Instr(ip$,".",off2+1):ip3=Mid$(ip$,off2+1,off3-off2-1)
	off4=Instr(ip$," ",off3+1):ip4=Mid$(ip$,off3+1,off4-off3-1)
	Return ip1 Shl 24 + ip2 Shl 16 + ip3 Shl 8 + ip4
	
End Function
</textarea><br>"3Dexample with chat - V1.001.bb"<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
;*************************************
;*** Flanker's 3Dexample with chat ***
;*************************************
; Basically Flankers 2 examples merged into 1:
; - We can now chat and have bit more info on screen.
; 
; Prerequists: 
; Slightly modded version of Flanker's marvelous 
; "UDPNetwork_lib.bb", which saves typing IP/port
; when doing quick testing on the local machine.
; (beats typing in over and over :-)
; 
; To do next: 
; - Show list of available server(s) and port info.
; - Set up selection: Local machine/LAN/WAN, so can partially
;   pre-fill input's(same as for local machine.
; - Create a GUI for above selections.
; - Add jumping &amp; shooting,
; - Add ThirdPerson/FirstPerson switching. 

SeedRnd MilliSecs()

;Include "UDPNetwork_lib.bb"
Include "UDPNetwork_lib V1.001.bb" ;&lt;&lt;&lt;&lt;
 
Global localID
Global localName$ = "player" + Rand(100,999)

Global localPlayerMesh

Type player
	Field id
	Field name$
	Field mesh
	Field x#,y#,z#
	Field yaw#
	Field velocityY#
	Field r,g,b
End Type

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Camera code from jfk EO-11110, thanks
Global bounce_cam=1 ;  smooth camera motion? (0/1)
Global bounce_div#=10.0 ; the higher, the more sluggish the camera will follow. Recc: 3.0 to 20.0
; some globals used by ChaseCam
Global old_x#,old_y#,old_z#
; desired distance between camera and player mesh
Global x_dis#=7.0,y_dis#=3,z_dis#=7.0,y_dis_or#=y_dis#
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

; network init ----------------------------------------;
Global localMode = Net_StartInput2() ; &lt;&lt;&lt;&lt; bring the library "console" to connect

If localMode = 1 Or localMode = 2 ; 1 means we are client, 2 means we are server

	If localMode = 1 Then AppTitle("Client")
	If localMode = 2 Then AppTitle("Server")
	
	localId = Net_CreatePlayer(localName) ; this command inits the server or local client
	
	If localId = 0 ; error
		Net_StopNetwork() ; close the network properly
		RuntimeError("Failed to create player.")
	EndIf
	
Else ; error
	Net_StopNetwork()
	RuntimeError("Failed to start game.")
EndIf
;------------------------------------------------------;

;Graphics3D 640,480,32,2
Graphics3D 640*.75,480*.66,32,2

SetBuffer BackBuffer()

CreateScene()

Global camera = CreateCamera()
CameraRange camera,0.1,1000

; create our own local player
localPlayerMesh = CreatePlayer(localID,localName)
old_x = EntityX(localPlayerMesh):old_y = EntityY(localPlayerMesh):old_z = EntityZ(localPlayerMesh) ; update camera position

; we send our color to server
p.player = Object.player(GetPlayer(localID))
Net_SendMessage(3,p\r + "/" + p\g + "/" + p\b)


;&lt;&lt;&lt;&lt; ADDED
Global messageDisplayNumber = 10
Global messageOffset
Dim message$(messageDisplayNumber)

Global chatMessage$ = localName + "&gt; "
Global chatMillisecs = MilliSecs()
Global chatCursor

NewMessage("Game started")
;&lt;&lt;&lt;&lt;&lt; ADDED END



; variable used by server player for full position update
Global updatePositions = MilliSecs()
timer = CreateTimer(60)

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
While Not KeyHit(1)

	WaitTimer(timer)

	; update our inputs
	inputFORWARD$ = 0:inputBACKWARD$ = 0:inputLEFT$ = 0:inputRIGHT$ = 0
	If KeyDown(200) Then inputFORWARD = 1:MoveEntity localPlayerMesh,0,0,0.3
	If KeyDown(208) Then inputBACKWARD = 1:MoveEntity localPlayerMesh,0,0,-0.3
	If KeyDown(203) Then inputLEFT = 1:TurnEntity localPlayerMesh,0,3,0
	If KeyDown(205) Then inputRIGHT = 1:TurnEntity localPlayerMesh,0,-3,0
	; we create a message type "1" for player inputs, and we send our inputs
	If inputFORWARD Or inputBACKWARD Or inputLEFT Or inputRIGHT Then Net_SendMessage(1,inputFORWARD + inputBACKWARD + inputLEFT + inputRIGHT)
	
	UpdateChaseCam(camera,localPlayerMesh)

	; see the function, it is up to you to create it, it's not linked with the library, just the local example
	UpdateNetwork()

	UpdateWorld()
	RenderWorld()

	UpdatePlayers()
	
	;&lt;&lt;&lt;&lt;ADDED
	UpdateChat()
	DrawMessages()
	;&lt;&lt;&lt;&lt;ADDED END
	
	Flip 0

Wend
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

Net_StopNetwork()

End

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function UpdateNetwork()

	; update incoming packets
	If Net_CheckMessage() ; will check for a new message and fill Net_MsgType, Net_MsgData$, Net_MsgFrom and Net_MsgTo variables so we can read it
		
		Select Net_MsgType ; check the type of message
						
			Case 1 ; player movement we set above, so we know a player is moving
							
				; unpack the message string
				playerFORWARD$ = Left(Net_MsgData,1)
				playerBACKWARD$ = Mid(Net_MsgData,2,1)
				playerLEFT$ = Mid(Net_MsgData,3,1)
				playerRIGHT$ = Right(Net_MsgData,1)
				
				p.player = Object.player(GetPlayer(Net_MsgFrom))
				
				; update the player
				If playerFORWARD Then MoveEntity p\mesh,0,0,0.3
				If playerBACKWARD Then MoveEntity p\mesh,0,0,-0.3
				If playerLEFT Then TurnEntity p\mesh,0,3,0
				If playerRIGHT Then TurnEntity p\mesh,0,-3,0
				
			Case 2 ; player position and angle, example of packing data into string
				
				offset1 = Instr(Net_MsgData,"/",1)
				offset2 = Instr(Net_MsgData,"/",offset1+1)
				offset3 = Instr(Net_MsgData,"/",offset2+1)
				
				p.player = Object.player(GetPlayer(Net_MsgFrom))
				
				p\x = Left(Net_MsgData,offset1-1)
				p\y = Mid(Net_MsgData,offset1+1,offset2-offset1-1)
				p\z = Mid(Net_MsgData,offset2+1,offset3-offset2-1)
				p\yaw = Right(Net_MsgData,Len(Net_MsgData)-offset3)
				
				PositionEntity p\mesh,p\x,p\y,p\z
				RotateEntity p\mesh,0,p\yaw,0
				ResetEntity p\mesh
			
			Case 3 ; update player colors
						
				offset1 = Instr(Net_MsgData,"/",1)
				offset2 = Instr(Net_MsgData,"/",offset1+1)
			
				p.player = Object.player(GetPlayer(Net_MsgFrom))
				
				p\r = Left(Net_MsgData,offset1-1)
				p\g = Mid(Net_MsgData,offset1+1,offset2-offset1-1)
				p\b = Right(Net_MsgData,Len(Net_MsgData)-offset2)
				
				If Net_MsgFrom = localID Then DebugLog "color received : " + p\r + " / " + p\g + " / " + p\b
				
				EntityColor p\mesh,p\r,p\g,p\b


			Case 4 ; chat message
			
				NewMessage(Net_MsgData)


															
			Case 100 ; new player connected, OR the server tells us who is already connected so we can create players when joining the game
							
				If localMode = 2
					For p.player = Each player
						Net_SendMessage(2,p\x + "/" + p\y + "/" + p\z + "/" + p\yaw,p\id,Net_MsgFrom)
						Net_SendMessage(3,p\r + "/" + p\g + "/" + p\b,p\id,Net_MsgFrom)
						If p\id = Net_MsgFrom Then DebugLog "color sent : " + p\r + " / " + p\g + " / " + p\b
					Next
				EndIf
				
				CreatePlayer(Net_MsgFrom,Net_MsgData)
			
			Case 101 ; a player has quit
						
				For p.player = Each player
					If Net_MsgFrom = p\id
						FreeEntity p\mesh
						Delete p
					EndIf
				Next
			
			Case 102 ; host has changed &lt;&lt;&lt;
			
				If Net_MsgFrom = localID Then 
					localMode = 2:
					AppTitle("Server") ; we are the new host
	
				EndIf
				
				;&lt;&lt;&lt;&lt;&lt; ADDED
				For p.player = Each player
					If Net_MsgFrom = p\id
						If p\id = localID
							NewMessage("You are the new host")
							localMode = 2
						Else
							NewMessage(p\name + " is the new host")
						EndIf					
					EndIf
				Next
				;&lt;&lt;&lt;&lt;&lt;
				

		End Select

	EndIf
	
	;;;;;;;;;;;;;;;;;;;
	If localMode = 2
		If MilliSecs()-updatePositions &gt; 10000
			For p.player = Each player
				Net_SendMessage(2,p\x + "/" + p\y + "/" + p\z + "/" + p\yaw,p\id)
				Net_SendMessage(2,p\x + "/" + p\y + "/" + p\z + "/" + p\yaw,p\id,p\id)
			Next
			updatePositions = MilliSecs()
		EndIf
	EndIf

End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function GetPlayer(id)

	For p.player = Each player
		If p\id = id
			Return Handle(p)					
		EndIf
	Next

End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function UpdatePlayers()

	For p.player = Each player
				
		If EntityY(p\mesh) - p\y &lt; 0
			p\velocityY = p\velocityY - 0.03
		Else
			p\velocityY = -0.01
		EndIf
				
		p\x = EntityX(p\mesh)
		p\y = EntityY(p\mesh)
		p\z = EntityZ(p\mesh)
		
		p\yaw = EntityYaw(p\mesh)
		
		TranslateEntity p\mesh,0,p\velocityY,0
		
		CameraProject(camera,EntityX(p\mesh),EntityY(p\mesh),EntityZ(p\mesh)) 
		
		Color 255,255,255
		If p\id &lt;&gt; localID Then ;&lt;&lt;&lt;&lt; so that will always show players name,except when being the player you control..
			Text ProjectedX(),ProjectedY()-50,p\name,1,1
		EndIf
	Next

End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function CreatePlayer(id,name$)

	p.player = New player
	p\id = id
	p\name = name
	
	p\mesh = CreateSphere()
	EntityType p\mesh,2
	EntityRadius p\mesh,1
	EntityPickMode p\mesh,1
	
	nose = CreateSphere(8,p\mesh):EntityColor nose,255,0,0
	PositionEntity nose,0,0,1
	ScaleEntity nose,0.3,0.3,0.3
	
	p\x = -20
	p\y = 1
	p\z = -20
	p\yaw = -45
	
	p\r = Rand(255)
	p\g = Rand(255)
	p\b = Rand(255)
	EntityColor p\mesh,p\r,p\g,p\b
	
	PositionEntity p\mesh,p\x,p\y,p\z
	RotateEntity p\mesh,0,p\yaw,0
	ResetEntity p\mesh
		
	Return p\mesh

End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function UpdateChaseCam(camera,player) ; thanks to jfk EO-11110 on bb forums for this function !
	PositionEntity camera,EntityX(player,1),EntityY(player,1),EntityZ(player,1)
	ResetEntity camera
	x#=EntityX(player)+Sin(-EntityYaw(player)+180)*x_dis#
	y#=EntityY(player)+y_dis#
	z#=EntityZ(player)+Cos(-EntityYaw(player)+180)*z_dis#
	obstacle=LinePick(EntityX(player),EntityY(player),EntityZ(player),(x-EntityX(player)),y_dis#,(z-EntityZ(player)),0.1)
	If obstacle=0
		new_x#=x
		new_y#=y
		new_z#=z
	Else
		new_x#=PickedX()
		new_y#=PickedY()
		new_z#=PickedZ()
	EndIf
	If bounce_cam=0
		PositionEntity camera,new_x,new_y,new_z
	Else
		x=old_x+((New_x-old_x)/bounce_div#)
		y=old_y+((New_y-old_y)/bounce_div#)
		z=old_z+((New_z-old_z)/bounce_div#)
		PositionEntity camera,x,y,z
	EndIf
	PointEntity camera,player
	TurnEntity camera,-20,0,0     ; if you want the player mesh more on the bottom of the screen
	old_x#=EntityX(camera)
	old_y#=EntityY(camera)
	old_z#=EntityZ(camera)
End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function CreateScene()

	texture = TextureCreate(128)
	
	ground = CreatePlane()
	EntityColor ground,150,150,150
	EntityTexture ground,texture
	
	cube = CreateCube():EntityColor cube,150,200,150
	ScaleEntity cube,5,5,5:PositionEntity cube,0,5,0
	EntityTexture cube,texture
	
	sphere = CreateSphere(16):EntityColor sphere,200,150,150
	ScaleEntity sphere,3,1,3:PositionEntity sphere,0,9.7,0
	
	platform = CreateCube():EntityColor platform,150,150,200
	ScaleEntity platform,3,1,10:PositionEntity platform,0,4.13,-13.15
	TurnEntity platform,-30,0,0
	EntityTexture platform,texture
	
	FreeTexture texture
	
	EntityType ground,1:EntityPickMode ground,2
	EntityType cube,1:EntityPickMode cube,2
	EntityType sphere,1:EntityPickMode sphere,2
	EntityType platform,1:EntityPickMode platform,2

	light = CreateLight()
	TurnEntity light,30,70,0
	
	Collisions 2,2,1,2
	Collisions 2,1,2,3

End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function TextureCreate(size)
	texture = CreateTexture(size,size,9)
	SetBuffer TextureBuffer(texture)
	Color 255,255,255
	Rect 0,0,size,size,1
	Color 0,0,0
	Rect 0,0,size,size,0
	Line 0,0,size,size
	Line 0,size,size,0
	SetBuffer BackBuffer()
	Return texture
End Function
;;;;;;;;;;;ADDED;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function NewMessage(msg$)

	messageOffset = messageOffset + 1
	
	If messageOffset &gt; messageDisplayNumber
	
		messageOffset = messageOffset - 1
		
		For i = 2 To messageDisplayNumber
			message(i-1) = message(i)		
		Next
		
		message(messageDisplayNumber) = msg
	
	Else
	
		message(messageOffset) = msg
	
	EndIf

End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function DrawMessages()

	Color 255,255,255

	For i = 1 To messageOffset
	
		Text 0,(i-1)*15,message(i)	
	
	Next

End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function UpdateChat()

	key = GetKey()

	If key
		If key = 13
			Net_SendMessage(4,chatMessage)
			NewMessage(chatMessage)
			chatMessage = localName + "&gt; "
		ElseIf key = 8 And Len(chatMessage) &gt; 0
			chatMessage = Left(chatMessage,Len(chatMessage)-1)
		ElseIf key &gt; 31 And key &lt; 127
			chatMessage = chatMessage + Chr(key)
		EndIf
	EndIf
	
	Color 255,255,255
	Rect 0,GraphicsHeight()-20,GraphicsWidth(),20,1
	
	Color 0,0,0
	Rect 0,GraphicsHeight()-20,GraphicsWidth(),20,0
	
	
	If MilliSecs()-chatMillisecs &gt; 500
		chatCursor = Not chatCursor
		chatMillisecs = MilliSecs()
	EndIf
	
	If chatCursor
		Text 5,GraphicsHeight()-17,chatMessage + "|"
	Else
		Text 5,GraphicsHeight()-17,chatMessage
	EndIf

End Function




</textarea><br>[EDIT: slight display correction copy/paste error] <br><br></td></tr></table><br>
<a name="1288546"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flanker</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#106">[#106]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nice one :)<br>I don't mind at all, it's written in the library : "Oh, and BTW, this library is licensed under the NoLicenseRequired agreement, meaning that you can do whatever you want with it..." ^^<br><br>You can't show the list of servers/port, this would need an external server to store each running server infos then each client would connect to that server.<br><br>The ping check will maybe be in the v1.1, to check for timeouts. For now if you close a client or server session with the window cross, the other player are not aware of the disconnection. It's an important thing to implement.<br><br>If you want to add interpolation you must send positions instead of inputs, and this should be done at a constant interval, for example 50 millisecs.<br><br>A dedicated server can be done, but you'll need to rewrite the whole example.<br><br>I'll work on the library this week end, maybe v1.1 soon with the interpolation example. <br><br></td></tr></table><br>
<a name="1288553"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#107">[#107]</a></td></tr></table></td></tr><tr ><td class="posttext"> HAHA! AWESOME, @Rick Nasher! &lt;3 ONE STEP CLOSER TO A PSO-LIKE LOBBY! =D<br><br>I cannot WAIT!<br><br>AWESOME, @Flanker! Can't WAIT! <br><br></td></tr></table><br>
<a name="1288554"></a>

<a name="1288555"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#108">[#108]</a></td></tr></table></td></tr><tr ><td class="posttext"> Slight fix if you don't want to delete your username in the chat :: <br><br>Replace : <br><br><pre class=code>ElseIf key = 8 And Len(chatMessage) &gt; 0 )</pre><br><br>With : <br><br><pre class=code>ElseIf key = 8 And Len(chatMessage) &gt; Len ( localName + "&gt; " )</pre> <br><br></td></tr></table><br>
<a name="1288557"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#109">[#109]</a></td></tr></table></td></tr><tr ><td class="posttext"> Also found 2 other glitches. 1 ) Pressing enter the FIRST time should OPEN the chat without sending any text. 2 ) Pressing enter the second time should NOT result in sending an empty message, which it does. I don't have a workaround for any of these. Please help. Thank You!<br><br>~GF <br><br></td></tr></table><br>
<a name="1288578"></a>

<a name="1288585"></a>

<a name="1288586"></a>

<a name="1288587"></a>

<a name="1288588"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#110">[#110]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Flanker:<br><br>Thanks. :-)<br><br><div class="quote"> <br>You can't show the list of servers/port, this would need an external server to store each running server infos then each client would connect to that server.<br> <br></div><br>I was thinking about storing the IP and server port in a type and sending a broadcast msg to show that a server is 'alive' and on which port, but this would probably only be viable on a (W)LAN if I'm correct. <br>For the internet a central place(site/server) would be needed to store/show which is available. Such as mentioned by RemiD in post<a href="/post.php?topic=104840&amp;post=1286769" target="_blank">#65 </a><br><div class="quote"> <br>@Rick&gt;&gt;Not sure if you are aware of this or not, but there was a discussion on the forum some time ago where the idea was to use a php page to read/write txt files on a web space in order to know if there are players online, if there are existing game servers online, what are the ip addresses of the game servers online and of the players of each game server so that you don't have to type the ip address and the port number manually. Do a search you will probably find it. <br> <br></div><br>And post <a href="/post.php?topic=104840&amp;post=1286876" target="_blank">#67</a>:<br><div class="quote"> <br>The approach to read/write .txt files on a predefined web space is to facilitate the process to know what are the available game servers and available players. (and also not have to manually type the ip address and port number)<br><br>But you could use the same approach in a local network by reading/writing .txt files on a predefined computer (with a fixed ip address) and make each client machine scan these .txt files to know which game servers / players are available in the local network.<br>Of course this requires one more computer. But the advantage is that it will prevent cheating if all the important calculations are done on this separate computer. <br> <br></div> Like Guy Fawkes said: Can't wait to see what rabbit you're gonna pull out of the magic hat in v1.1<br><br>@Guy Fawkes:<br>Thanks for the fix. Wasn't aware of the backspace-erasing-the-name issue.<br>For the Enter without input(if that's what you mean): I thought would be enough to check for 0 or "" input, but that apparently doesn't catch it right away. Strange. I'll check. <br><br></td></tr></table><br>
<a name="1288589"></a>

<a name="1288590"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#111">[#111]</a></td></tr></table></td></tr><tr ><td class="posttext"> [Deleted double post] <br><br></td></tr></table><br>
<a name="1288596"></a>

<a name="1288597"></a>

<a name="1288598"></a>

<a name="1288599"></a>

<a name="1288601"></a>

<a name="1288602"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#112">[#112]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Rick Nasher :: It's either returning NULL or an extra space that it shouldn't, because the cursor is way out there in Timbuktu &amp; the text is all the way to the left of it.<br><br>Press enter WITHOUT any text should turn on &amp; off the chat. (on meaning totally opaque, off meaning almost translucent ).<br><br>Also, PRESSING ANY key as opposed to HOLDING DOWN that key for a few seconds before it starts to add or delete each character of text is VERY slow &amp; inefficient. The text should ALWAYS be on a small, 2-second timer. Without this timer, lag &amp; all other sorts of DDOS tricks can be used. Hold down a key for 2 seconds and stop the cursor from being seen while doing so, then let the text continue to scroll to the right ( or in backspace' case, the "left" ), like any other textbox or input message box for ANY key. Also, use of the space key results in the ability to continuously post invisible "space" messages. Spaces should ONLY be sent inbetween characters IF a space is present BEFORE OR AFTER the character(s).<br><br>I do not point out these flaws to be mean, I point out these flaws in hopes of seeing it fixed.<br><br>Let me know when you have a fix for most if not all of this. Together, we are going to build the best damn online chatbox this forum has ever SEEN! I am SO excited! :)<br><br>~GF <br><br></td></tr></table><br>
<a name="1288632"></a>

<a name="1288633"></a>

<a name="1288634"></a>

<a name="1288635"></a>

<a name="1288636"></a>

<a name="1288640"></a>

<a name="1288641"></a>

<a name="1288643"></a>

<a name="1288658"></a>

<a name="1288664"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flanker</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#113">[#113]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have a working example of positions interpolation + jumping + fireing bullets + chat. It works even with v1.0 because I had some trouble to interpolate a player based on his inputs, so finally all players send their positions instead of inputs, that means that it is not cheat protected, but it shouldn't be an issue lol I don't see someone writing the next worldwide MMORPG with Blitz3D and this library ^^<br><br>The chat is "fixed" according to Guy Fawkes ideas, but you can still send multiple spaces as long as you have at least one character in the message.<br><br>The mod from Rick Nasher is added in v1.1 so we can save time when testing. Unfortunately it's not yet ready, i've been working on the example instead.<br><br><strike>Still a little issue interpolating players yaw angle, because EntityYaw returns a value beetween +180 and -180, so when you go from 179 to -179, it makes a turn backward. I'll see that later.</strike> FIXED<br><br>Here it is the example "3Dexample_interpolation.bb", I hope it works well for you, it starts to be a huge example, maybe not easy to go in for others :<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">SeedRnd MilliSecs()

Include "UDPNetwork_lib.bb"

Global localID
Global localName$ = "player" + Rand(100,999)

Global localPlayerMesh

Type player
	Field id
	Field name$
	
	Field life
	
	Field mesh
	
	Field nextX#,nextY#,nextZ#
	Field previousX#,previousY#,previousZ#
	Field nextYaw#
	Field previousYaw#
	Field nextTime#
	Field previousTime#
	
	Field currentY#
	Field velocityY#
	
	Field r,g,b
End Type

Type bullet
	Field mesh
	Field angle#
	Field time
	Field id ; id of player who fired
End Type

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Camera code from jfk EO-11110, thanks
Global bounce_cam=1 ;  smooth camera motion? (0/1)
Global bounce_div#=10.0 ; the higher, the more sluggish the camera will follow. Recc: 3.0 to 20.0
; some globals used by ChaseCam
Global old_x#,old_y#,old_z#
; desired distance between camera and player mesh
Global x_dis#=7.0,y_dis#=3,z_dis#=7.0,y_dis_or#=y_dis#
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

; network init ----------------------------------------;
Global localMode = Net_StartInput() ; bring the library "console" to connect

If localMode = 1 Or localMode = 2 ; 1 means we are client, 2 means we are server

	If localMode = 1 Then AppTitle("Client : " + localName + " (port:" + net_port + ")")
	If localMode = 2 Then AppTitle("Server : " + localName + " (port:" + net_port + ")")
	
	localId = Net_CreatePlayer(localName) ; this command inits the server or local client
	
	If localId = 0 ; error
		Net_StopNetwork() ; close the network properly
		RuntimeError("Failed to create player.")
	EndIf
	
Else ; error
	Net_StopNetwork()
	RuntimeError("Failed to start game.")
EndIf
;------------------------------------------------------;

Graphics3D 640,480,32,2
SetBuffer BackBuffer()

CreateScene()

Global camera = CreateCamera()
CameraRange camera,0.1,1000

; create our own local player
localPlayerMesh = CreatePlayer(localID,localName)
old_x = EntityX(localPlayerMesh):old_y = EntityY(localPlayerMesh):old_z = EntityZ(localPlayerMesh) ; update camera position

; we send our color to the server
p.player = Object.player(GetPlayer(localID))
Net_SendMessage(3,p\r + "/" + p\g + "/" + p\b)

; variables used to send our positions at a constant delay (saves bandwidth but makes a constant ping)
Global updatePosition = MilliSecs()
Global updateTick = 50

; chat
Global messageDisplayNumber = 10
Global messageOffset
Dim message$(messageDisplayNumber)

Global chatMode
Global chatMessage$ = localName + "&gt; "
Global chatMillisecs = MilliSecs()
Global chatCursor

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
While Not KeyHit(1)

	; update our player
	UpdateLocalPlayer()

	; see the function, the interpolation variables are set properly here
	UpdateNetwork()
	
	; the interpolation is made in this function
	UpdatePlayers()
	
	; update the bullets... only the server check for player kill
	UpdateBullets()

	UpdateWorld()
	RenderWorld()

	DrawPlayersNames()
	
	If KeyHit(28) And chatMode = 0 Then chatMode = 1:FlushKeys()
	If chatMode = 1 Then UpdateChat()
	
	DrawMessages()
	
	Flip

Wend
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

Net_StopNetwork()

End

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function UpdateNetwork()

	; update incoming packets (better check ALL incoming messages so use While Wend)
	While Net_CheckMessage() ; will check for a new message and fill Net_MsgType, Net_MsgData$, Net_MsgFrom and Net_MsgTo variables so we can read it
		
		p.player = Object.player(GetPlayer(Net_MsgFrom)) ; get the player handle
		
		Select Net_MsgType ; check the type of message
						
			Case 1 ; chat message
			
				NewMessage(Net_MsgData)
									
			Case 2 ; player position and angle, example of packing data into string
				
				offset1 = Instr(Net_MsgData,"/",1)
				offset2 = Instr(Net_MsgData,"/",offset1+1)
				offset3 = Instr(Net_MsgData,"/",offset2+1)
								
				p\previousX = p\nextX
				p\previousY = p\nextY
				p\previousZ = p\nextZ
				p\previousYaw = p\nextYaw
				
				p\nextX = Left(Net_MsgData,offset1-1)
				p\nextY = Mid(Net_MsgData,offset1+1,offset2-offset1-1)
				p\nextZ = Mid(Net_MsgData,offset2+1,offset3-offset2-1)
				p\nextYaw = Right(Net_MsgData,Len(Net_MsgData)-offset3)
								
				p\previousTime = p\nextTime
				p\nextTime = MilliSecs()
							
			Case 3 ; update player colors
						
				offset1 = Instr(Net_MsgData,"/",1)
				offset2 = Instr(Net_MsgData,"/",offset1+1)
							
				p\r = Left(Net_MsgData,offset1-1)
				p\g = Mid(Net_MsgData,offset1+1,offset2-offset1-1)
				p\b = Right(Net_MsgData,Len(Net_MsgData)-offset2)
								
				EntityColor p\mesh,p\r,p\g,p\b
				
			Case 4 ; a player fired
			
				CreateBullet(Net_MsgFrom)
			
			Case 5 ; a player lost some life
			
				p\life = Net_MsgData
			
			Case 6 ; a player killed another one
			
				k.player = Object.player(GetPlayer(Net_MsgData)) ; killed player ID in MsgData
				NewMessage(p\name + " killed " + k\name)
				ResetPlayer(k\id)
						
			Case 100 ; new player connected, OR the server tells us who is already connected so we can create players when joining the game
							
				If localMode = 2
					For p.player = Each player
						Net_SendMessage(2,p\nextX + "/" + p\nextY + "/" + p\nextZ + "/" + p\nextYaw,p\id,Net_MsgFrom)
						Net_SendMessage(3,p\r + "/" + p\g + "/" + p\b,p\id,Net_MsgFrom)
						
						Net_SendMessage(5,p\life,p\id,Net_MsgFrom)
					Next
				EndIf
				
				NewMessage(Net_MsgData + " connected")
				CreatePlayer(Net_MsgFrom,Net_MsgData)
				
			Case 101 ; a player has quit
						
				For p.player = Each player
					If Net_MsgFrom = p\id
						NewMessage(p\name + " disconnected")
						FreeEntity p\mesh
						Delete p
					EndIf
				Next
							
			Case 102 ; host has changed
			
				For p.player = Each player
					If Net_MsgFrom = p\id
						If p\id = localID
							AppTitle("Server : " + localName + " (port:" + net_port + ")")
							NewMessage("You are the new host")
							localMode = 2
						Else
							NewMessage(p\name + " is the new host")
						EndIf					
					EndIf
				Next

		End Select

	Wend

End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function UpdateLocalPlayer()

	; update our player
	p.player = Object.player(GetPlayer(localID)) ; get our player

	; inputs
	If KeyDown(200) Then MoveEntity p\mesh,0,0,0.3
	If KeyDown(208) Then MoveEntity p\mesh,0,0,-0.3
	If KeyDown(203) Then TurnEntity p\mesh,0,3,0
	If KeyDown(205) Then TurnEntity p\mesh,0,-3,0
	
	; fire
	If MouseHit(1)
		Net_SendMessage(4,"")
		CreateBullet(localID)
	EndIf
	
	; jump
	If MouseHit(2)
		; check if player is one the ground
		LinePick(EntityX(p\mesh),EntityY(p\mesh),EntityZ(p\mesh),0,-1.2,0)
		If PickedEntity()
			p\velocityY = 0.5 ; set "inverse" of gravity velocity
		EndIf	
	EndIf
	
	; we create a message type "2" for player position
	If MilliSecs()-updatePosition &gt; updateTick	
		Net_SendMessage(2,EntityX(p\mesh) + "/" + EntityY(p\mesh) + "/" + EntityZ(p\mesh) + "/" + EntityYaw(p\mesh))
		updatePosition = MilliSecs()
	EndIf
	
	UpdateChaseCam(camera,p\mesh)

End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function UpdatePlayers()

	For p.player = Each player
				
		If p\id &lt;&gt; localID ; update other players
		
			ResetEntity p\mesh ; reset entity is useful here because of collisions
		
			;; LINEAR INTERPOLATION ;;;;;;;;;;
			curTime# = (MilliSecs()-p\nextTime) / (p\nextTime-p\previousTime) ; curTime will be ideally 0.0-1.0, if it's &gt; 1.0 then it performs extrapolation
			PositionEntity p\mesh,p\previousX+(p\nextX-p\previousX)*curTime,p\previousY+(p\nextY-p\previousY)*curTime,p\previousZ+(p\nextZ-p\previousZ)*curTime
			
			; special fix for yaw as EntityYaw returns a value beetween +180 ans -180, the interpolation can go backward
			If p\previousYaw &lt; 0 Then p\previousYaw = p\previousYaw + 360
			If p\nextYaw &lt; 0 Then p\nextYaw = p\nextYaw + 360
			If Abs(p\nextYaw-p\previousYaw) &gt; 180
				If p\nextYaw &gt; p\previousYaw
					p\previousYaw = p\previousYaw + 360
				Else
					p\previousYaw = p\previousYaw - 360
				EndIf
			EndIf
			
			RotateEntity p\mesh,0,p\previousYaw+(p\nextYaw-p\previousYaw)*curTime,0
			;;;;;;;;;;;;;;;;;;;;;;;;;;;
		
		Else ; update our player, basically it just compute gravity
		
			p\velocityY = p\velocityY - 0.03 ; fake gravity
			If EntityY(p\mesh) - p\currentY &gt;= 0 ; if player is not falling we limit the gravity
				If p\velocityY &lt; -0.03 Then p\velocityY = -0.03
			EndIf
		
			p\currentY = EntityY(p\mesh)
			TranslateEntity p\mesh,0,p\velocityY,0
						
		EndIf
	Next

End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function CreatePlayer(id,name$)

	p.player = New player
	p\id = id
	p\name = name
	
	p\life = 100
	
	p\mesh = CreateSphere()
	EntityType p\mesh,2
	EntityRadius p\mesh,1
	
	NameEntity p\mesh,Handle(p)
	
	nose = CreateSphere(8,p\mesh):EntityColor nose,255,0,0
	PositionEntity nose,0,0,1
	ScaleEntity nose,0.3,0.3,0.3
	
	p\nextX = -20
	p\nextY = 1
	p\nextZ = -20
	p\nextYaw = -45
	
	p\previousX = p\nextX
	p\previousY = p\nextY
	p\previousZ = p\nextZ
	p\previousYaw = p\nextYaw
	
	p\r = Rand(255)
	p\g = Rand(255)
	p\b = Rand(255)
	EntityColor p\mesh,p\r,p\g,p\b
	
	PositionEntity p\mesh,p\nextX,p\nextY,p\nextZ
	RotateEntity p\mesh,0,p\nextYaw,0
	ResetEntity p\mesh
	
	p\currentY = p\nextY
	
	p\previousTime = MilliSecs()
	p\nextTime = MilliSecs()+1
	
	Return p\mesh

End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function ResetPlayer(id)

	p.player = Object.player(GetPlayer(id))

	p\life = 100

	p\nextX = -20
	p\nextY = 1
	p\nextZ = -20
	p\nextYaw = -45

	p\previousX = p\nextX
	p\previousY = p\nextY
	p\previousZ = p\nextZ
	p\previousYaw = p\nextYaw

	PositionEntity p\mesh,p\nextX,p\nextY,p\nextZ
	RotateEntity p\mesh,0,p\nextYaw,0
	ResetEntity p\mesh
	
	p\currentY = p\nextY
	
	p\previousTime = MilliSecs()
	p\nextTime = MilliSecs()+1

End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function GetPlayer(id)

	For p.player = Each player
		If p\id = id
			Return Handle(p)					
		EndIf
	Next

End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function DrawPlayersNames()

	For p.player = Each player
	
		Color 255,255,255
		CameraProject(camera,EntityX(p\mesh),EntityY(p\mesh),EntityZ(p\mesh)) 			
		If p\id &lt;&gt; localID Then Text ProjectedX(),ProjectedY()-60,p\name,1,1
		
		Color 255,(255./100.)*p\life,(255./100.)*p\life
		Text ProjectedX(),ProjectedY()-40,p\life,1,1

	Next
	
End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function CreateBullet(id)

	p.player = Object.player(GetPlayer(id))

	b.bullet = New bullet
	
	b\id = p\id
	
	b\mesh = CreateSphere(2)
	ScaleEntity b\mesh,0.2,0.2,0.2
	EntityColor b\mesh,255,0,0
		
	PositionEntity b\mesh,EntityX(p\mesh),EntityY(p\mesh),EntityZ(p\mesh)
	RotateEntity b\mesh,0,EntityYaw(p\mesh),0
	
	EntityType b\mesh,3
	EntityRadius b\mesh,0.2
		
	b\time = MilliSecs()

End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function UpdateBullets()

	For b.bullet = Each bullet
	
		MoveEntity b\mesh,0,0,1
		
		If CountCollisions(b\mesh)
		
			If localMode = 2 ; only the server compute bullets collision with player
				If GetEntityType(CollisionEntity(b\mesh,1)) = 2 ; a player is hit
				
					touchedPlayer.player = Object.player(EntityName(CollisionEntity(b\mesh,1)))
					touchedPlayer\life = touchedPlayer\life - 10
					
					If touchedPlayer\life &gt; 0 ; touched
						Net_SendMessage(5,touchedPlayer\life,touchedPlayer\id)
						Net_SendMessage(5,touchedPlayer\life,touchedPlayer\id,touchedPlayer\id)
					Else ; killed
						killerPlayer.player = Object.player(GetPlayer(b\id))
						Net_SendMessage(6,touchedPlayer\id,killerPlayer\id)
						Net_SendMessage(6,touchedPlayer\id,killerPlayer\id,killerPlayer\id)
						NewMessage(killerPlayer\name + " killed " + touchedPlayer\name)
						ResetPlayer(touchedPlayer\id)
					EndIf
				
				EndIf
			EndIf
			
			FreeEntity b\mesh
			Delete b
			
		ElseIf MilliSecs()-b\time &gt; 2000
		
			FreeEntity b\mesh
			Delete b
			
		EndIf
	
	Next

End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function NewMessage(msg$)

	messageOffset = messageOffset + 1
	
	If messageOffset &gt; messageDisplayNumber
	
		messageOffset = messageOffset - 1
		
		For i = 2 To messageDisplayNumber
			message(i-1) = message(i)		
		Next
		
		message(messageDisplayNumber) = msg
	
	Else
	
		message(messageOffset) = msg
	
	EndIf

End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function DrawMessages()

	Color 255,255,255

	For i = 1 To messageOffset
	
		Text 0,(i-1)*15,message(i)	
	
	Next

End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function UpdateChat()

	key = GetKey()

	If key
		If key = 13
			If chatMessage &lt;&gt; localName + "&gt; "
				For i = Len(localName + "&gt; ") To Len(chatMessage)
					If Mid(chatMessage,i,1) &lt;&gt; " "
						Net_SendMessage(1,chatMessage)
						NewMessage(chatMessage)
						Exit
					EndIf
				Next
			EndIf
			chatMessage = localName + "&gt; "
			chatMode = 0
		ElseIf key = 8 And Len(chatMessage) &gt; Len ( localName + "&gt; " )
			chatMessage = Left(chatMessage,Len(chatMessage)-1)
		ElseIf key &gt; 31 And key &lt; 127
			chatMessage = chatMessage + Chr(key)
		EndIf
	EndIf
	
	Color 255,255,255
	Rect 0,GraphicsHeight()-20,GraphicsWidth(),20,1
	
	Color 0,0,0
	Rect 0,GraphicsHeight()-20,GraphicsWidth(),20,0
	
	
	If MilliSecs()-chatMillisecs &gt; 500
		chatCursor = Not chatCursor
		chatMillisecs = MilliSecs()
	EndIf
	
	If chatCursor
		Text 5,GraphicsHeight()-17,chatMessage + "|"
	Else
		Text 5,GraphicsHeight()-17,chatMessage
	EndIf

End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function UpdateChaseCam(camera,player) ; thanks to jfk EO-11110 on bb forums for this function !
	PositionEntity camera,EntityX(player,1),EntityY(player,1),EntityZ(player,1)
	ResetEntity camera
	x#=EntityX(player)+Sin(-EntityYaw(player)+180)*x_dis#
	y#=EntityY(player)+y_dis#
	z#=EntityZ(player)+Cos(-EntityYaw(player)+180)*z_dis#
	obstacle=LinePick(EntityX(player),EntityY(player),EntityZ(player),(x-EntityX(player)),y_dis#,(z-EntityZ(player)),0.1)
	If obstacle=0
		new_x#=x
		new_y#=y
		new_z#=z
	Else
		new_x#=PickedX()
		new_y#=PickedY()
		new_z#=PickedZ()
	EndIf
	If bounce_cam=0
		PositionEntity camera,new_x,new_y,new_z
	Else
		x=old_x+((New_x-old_x)/bounce_div#)
		y=old_y+((New_y-old_y)/bounce_div#)
		z=old_z+((New_z-old_z)/bounce_div#)
		PositionEntity camera,x,y,z
	EndIf
	PointEntity camera,player
	TurnEntity camera,-20,0,0     ; if you want the player mesh more on the bottom of the screen
	old_x#=EntityX(camera)
	old_y#=EntityY(camera)
	old_z#=EntityZ(camera)
End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function CreateScene()

	texture = TextureCreate(128)
	
	ground = CreatePlane()
	EntityColor ground,150,150,150
	EntityTexture ground,texture
	
	cube = CreateCube():EntityColor cube,150,200,150
	ScaleEntity cube,5,5,5:PositionEntity cube,0,5,0
	EntityTexture cube,texture
	
	sphere = CreateSphere(16):EntityColor sphere,200,150,150
	ScaleEntity sphere,3,1,3:PositionEntity sphere,0,9.7,0
	
	platform = CreateCube():EntityColor platform,150,150,200
	ScaleEntity platform,3,1,10:PositionEntity platform,0,4.13,-13.15
	TurnEntity platform,-30,0,0
	EntityTexture platform,texture
	
	FreeTexture texture
	
	EntityType ground,1:EntityPickMode ground,2
	EntityType cube,1:EntityPickMode cube,2
	EntityType sphere,1:EntityPickMode sphere,2
	EntityType platform,1:EntityPickMode platform,2

	light = CreateLight()
	TurnEntity light,30,70,0
	
	;; COLLISIONS
	Collisions 2,1,2,3 ; player to scene
	Collisions 2,2,1,3 ; player to player
	
	Collisions 3,1,2,1 ; bullet to scene
	Collisions 3,2,1,1 ; bullet to player
	
End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function TextureCreate(size)
	texture = CreateTexture(size,size,9)
	SetBuffer TextureBuffer(texture)
	Color 255,255,255
	Rect 0,0,size,size,1
	Color 0,0,0
	Rect 0,0,size,size,0
	Line 0,0,size,size
	Line 0,size,size,0
	SetBuffer BackBuffer()
	Return texture
End Function</textarea><br>Fire with left mouse, jump with right mouse.<br><br>EDIT : you can change the variable Global updateTick = 50, just before the main loop. It represents the rate at wich a player send his position, so here every 50 milliseconds. You can set it to 1000 (1 second) for example to see the interpolation at work (but jumping is weird with a too high delay).<br><br>EDIT2 : it would be nice to test this example together over internet one day, if anyone is interested I could start a test server. <br><br></td></tr></table><br>
<a name="1288677"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#114">[#114]</a></td></tr></table></td></tr><tr ><td class="posttext"> DIBS FLANKER! :D<br><br>SETUP T3H SERV0RZ! :3<br><br>I will beta test ANYTHING you throw at me! :D<br><br>~GF <br><br></td></tr></table><br>
<a name="1288679"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flanker</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#115">[#115]</a></td></tr></table></td></tr><tr ><td class="posttext"> join me at channel #UDPNetwork_lib here if you want : <a href="http://webchat.quakenet.org/" target="_blank">http://webchat.quakenet.org/</a> <br><br></td></tr></table><br>
<a name="1288702"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flanker</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#116">[#116]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for testing guys, I'll try to fix few things and we test that again. <br><br></td></tr></table><br>
<a name="1288759"></a>

<a name="1288760"></a>

<a name="1288761"></a>

<a name="1288762"></a>

<a name="1288766"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#117">[#117]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here is another idea to manage an online multiplayer game :<br><br>Depending on input and its previousactionstate, each client determines the nowactionstate of the player.<br>Each client regularly sends a packet with its noworientation nowposition nowlife nowactionstate (before updating the logic) to the server.<br>Each client and the server use the same logic to update the game (depending on the noworientation nowposition nowlife nowactionstate, turn move the player/bullets, detect collisions/hits, reoriente reposition the player/bullets, update life, update actionstate)<br>Each client does not need to wait for a packet from the server to continue to update the game, it uses the previousorientation previousposition previouslife previousactionstate of each player (except the player of this computer) to continue to update the game until a new packet from the server is received.<br>The server does not need to wait for a packet from a client to continue to update the game, it uses the previousorientation previousposition previouslife previousactionstate of each player to continue to update the game.<br>When the server receives a packet from a client, it checks if the noworientation nowposition nowlife nowactionstate of the player seems possible ((near enough from oldposition, not too much life, alive/dead) with a tolerance), and if yes it continues to update the game with these infos, and if no it sends back an error message and a correction of the orientation position life actionstate to the client. The server also sends regularly the correctedorientation correctedposition correctedlife correctedactionstate of each player to each client.<br>When a client receives a packet from the server, it corrects the orientation position life actionstate of each player before continuing to update the game.<br>Since the server is tolerant about small differences, the corrections of orientation position life ationstate should not happen too often.<br>Since the clients do not need to wait for the server to update the game, the game can update at more than 10fps (around 50ms to send a packet from client to server and around 50ms to send a packet from server to client).<br>For bullets it would be better to use turningmoving ellipsoid colliders instead of linepicks because of the possibly corrected orientation/position/actionstate done by the server (not instantaneous like a linepick)<br><br>What do you think ? <br><br></td></tr></table><br>
<a name="1288770"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flanker</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#118">[#118]</a></td></tr></table></td></tr><tr ><td class="posttext"> Kind of what I've been trying to do.<br><br>- each client were sending list of last inputs every 30ms to the server (local player was updated client side)<br>- the server were moving players according to received inputs, then he sends positions/rotation of each player to every player, every 50ms.<br>- beetween each update, clients used interpolation, and eventually extrapolation.<br><br>It works. The problem is server side. You receive inputs every 30ms. But I can't figure how to interpolate inputs. The players were "laggy" on the server, but client side they were smooth. That's why I did an example where clients send positions, as I think cheat protection is useless for our use. But it can probably be done, it's up to you to make an example ^^ the library (v1.1) will be able to work this way.<br><br>Another problem is how do you correct a player's position ? If you send him the position were it should be like in the first 3D example, it's really weird. If you use interpolation on it, the player will be forced to reach that location and won't be able to move until it's done. Weird too.<br><br>Packets loss seems quite important in UDP over internet, and correction are continous. For now, sending positions and use interpolation is the simplest way to ensure everyone see the same game.<br><br>The bullets already are colliding spheres, it's much faster than linepicks. Collisions are updated both server and client side, but only the server can decide if someone is hit/killed.<br><br>Also, Guy Fawkes is officially the first cheater on this library :D He replaced MouseHit fire by MouseDown, so he got a minigun instead of a pistol ^^ This didn't affect the multiplayer much as with Flip screen, a packet can only be sent every 17ms~.<br><br>Thanks for the suggestions. <br><br></td></tr></table><br>
<a name="1288795"></a>

<a name="1288796"></a>

<a name="1288798"></a>

<a name="1288799"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#119">[#119]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>But I can't figure how to interpolate inputs.<br> <br></div><br>With what i propose, you don't, if the server has not received a packet from a client, you simply use the previous orientation, position, life, action to update the new game. <br><br><div class="quote"> <br> how do you correct a player's position <br> <br></div><br>The server knows the previousorientation, previousposition, previouslife, previousaction.<br>When a packet from a client is received, it can evaluates if the noworientation, nowposition, nowlife, nowaction, of this player is possible (approximately, with some tolerance) or if he is trying to cheat (teleport, move too fast, add too much life when there is no medpack nearby)<br>If the noworientation, nowposition, nowlife, nowaction, is within what is tolerated/possible, then no correction is done. If the noworientation, nowposition, nowlife, nowaction, is too different from what it is tolerated/possible, the server calculates what it should be and sends back the correctedorientation, correctedposition, correctedlife, correctedaction.<br>The client updates the game, for the player and for the new created bullets depending on the previousorientation, previousposition, previouslife, previousaction and depending on the player input, and for the others players and bullets depending on the datas which were last received from the server, but a priority is given to what is received from the server, so sometimes there can be some corrections of the players/bullets orientation/position/life/action.<br>However since there is some tolerance on the server, this should not be too often or too noticeable.<br>That's the idea.<br><br><div class="quote"> <br>Collisions are updated both server and client side, but only the server can decide if someone is hit/killed<br> <br></div><br>With what i propose, the client could detects a collision/pick, but the server would evaluate if it is possible depending on what is known and depending on the tolerance.<br><br><div class="quote"> <br>Guy Fawkes is officially the first cheater on this library :D He replaced MouseHit fire by MouseDown, so he got a minigun instead of a pistol<br> <br></div><br>:D <br><br></td></tr></table><br>
<a name="1288802"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#120">[#120]</a></td></tr></table></td></tr><tr ><td class="posttext"> TROLOLOLOLOL! =D <br><br></td></tr></table><br>
<a name="1288804"></a>

<a name="1288805"></a>

<a name="1288806"></a>

<a name="1288807"></a>

<a name="1288808"></a>

<a name="1288809"></a>

<a name="1288810"></a>

<a name="1288811"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#121">[#121]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Flanker:<br>I think some occasional lag and weird effects are virtually impossible to avoid over the internet. Kinda comes with the territory I guess? But as long as it doesn't interfere with the gameplay too much I think it's acceptable. What was a bit weird was the endless spinning mode I got into when I was accidentally clicking outside the window while moving with the cursors. Only seemed to recover when shot. :-) <br>I'll see what exactly was triggering it and if able to replicate. Was great fun never the less.. <br><br>Also what's great about this lib is that this would also work under Ploppy's Harwired/Hybrid(Blitz3d/Plus V2.0) as it has the same foundations as original Blitz and he can then take out the fazed out DirectPlay code under Hybrid, ensuring this multiplayer will work under new Window/DirectX's versions until virtually the end of times.. ;-)<br><br><br>Another little mod to input a player name or just press enter and autoselect a randomized one.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Include "UDPNetwork_lib V1.001.bb" ;&lt;&lt; modded to auto select ports/local IP on enter press.(included in post #105)

Global localID
Global localName$ = "player" + Rand(100,999)

Print "Please enter your name"
MyName$=Input$ ("(ENTER=random default name)") 
If MyName$&lt;&gt;"" Then
	localName$= MyName$
EndIf
</textarea><br><br>Question: <br>Given the code below, shouldn't that normally stop the bullets from passing through buildings/scenery?<br><pre class=code>
;; COLLISIONS
Collisions 2,1,2,3 ; player to scene
Collisions 2,2,1,3 ; player to player
	
Collisions 3,1,2,1 ; bullet to scene
Collisions 3,2,1,1 ; bullet to player
</pre><br>EDIT: I guess it does, did you correct anything for yesterday I was under the impression it could shoot through buildings.<br><br>P.S.: GF, where is your health upgrade code? I expected to see a PowerPill random distribution by now. ;-) <br><br></td></tr></table><br>
<a name="1288819"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flanker</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#122">[#122]</a></td></tr></table></td></tr><tr ><td class="posttext"> @RemiD I see what you mean. Comparing a new incoming packet with the previous received one and check if it is possible with elapsed time and a tolerance. It's ok for correction/anti cheat.<br><br>But you would still need interpolation as the server won't receive a packet at each frame. For example, let's say a player goes forward, he sends "forward" every 50ms to the server. Let's say a packet was just sent at the previous frame. But this frame, the player decides to go backward. He will send "backward" only in 50ms as a packet has just been sent. During these 50ms, the server continued to move the player forward. So there will be a difference of 100ms beetween server and player position. In this case, interpolation will be needed server side or the players will always jump from one position to another, and that's the main problem of delayed packets.<br><br>@Rick Nasher yes, the first code I posted for collision was "Collisions 3,1,3,1 ; bullet to scene" and that didn't work well, I corrected it later with "Collisions 3,1,2,1 ; bullet to scene". For the endless spin we should have to known if the game is in focus or not, wich is impossible with native blitz3d, but possible with some libraries probably. <br><br></td></tr></table><br>
<a name="1288822"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#123">[#123]</a></td></tr></table></td></tr><tr ><td class="posttext"> Still working out a few minor bugs. Sorry for the delay, guys.<br><br>Just trying to get the item count so that the healthpacks only spin until there are no more healthpacks &gt;&lt;<br><br>And NO bullets don't go through walls or objects. I tested that last night.<br><br>~GF <br><br></td></tr></table><br>
<a name="1288823"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#124">[#124]</a></td></tr></table></td></tr><tr ><td class="posttext"> Haven't been able to replicate on the local machine, will try on the LAN later. <br><br></td></tr></table><br>
<a name="1288824"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >stayne</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#125">[#125]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think the old BlitzPlay lib dealt with laggy players with spine interpolation. <br><br></td></tr></table><br>
<a name="1288825"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#126">[#126]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hehehe. <br><br>@ GF: <br>Perhaps this is suitable to represent a healthpack, or do you have something else in mind?<br><img src="http://i68.tinypic.com/zmijqd.jpg"><br><pre class=code>
healthpowerup = CreateCylinder():EntityColor healthpowerup ,255,0,0	
healthpowerup1= CopyEntity (healthpowerup)
ScaleEntity healthpowerup ,.25,.5,.25:PositionEntity healthpowerup ,-30,.5,-20
ScaleEntity healthpowerup1,.25,.5,.25:PositionEntity healthpowerup1,-30,.5,-20
RotateEntity healthpowerup1,90,0,0
EntityParent healthpowerup1, healthpowerup
</pre><br>See I'm the one getting impatient now.. ;-)<br>BTW I've changed the bullet color to yellow for I think it looks more like fire:<pre class=code>
EntityColor b\mesh,255,255,0
</pre> <br><br></td></tr></table><br>
<a name="1288826"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#127">[#127]</a></td></tr></table></td></tr><tr ><td class="posttext"> @stayne:<br>True, I read about that, but only was available in the BlitPlayPro(non-free) version fafaik. <br><br></td></tr></table><br>
<a name="1288827"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#128">[#128]</a></td></tr></table></td></tr><tr ><td class="posttext"> Mine's better, @Rick Nasher! :P It may use cubes for the items, but it totally detects WITH OR WITHOUT Collision if a player is either A) Within a VERY SHORT vicinity of, or if the Player actually DID detect a collision between the Player &amp; the touched object accordingly, and adds a random value to your health, then deletes the touched Item. So I win! :D<br><br>~GF <br><br></td></tr></table><br>
<a name="1288828"></a>

<a name="1288829"></a>

<a name="1288830"></a>

<a name="1288833"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#129">[#129]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br> For example, let's say a player goes forward, he sends "forward" every 50ms to the server. Let's say a packet was just sent at the previous frame. But this frame, the player decides to go backward. He will send "backward" only in 50ms as a packet has just been sent. During these 50ms, the server continued to move the player forward. So there will be a difference of 100ms beetween server and player position.<br> <br></div><br>Yes i understand that but there is no way to avoid it totally... A way to reduce this difference would be to lock the fps on the client computer. For example, let's say that a packet can travel at 50ms maximum, the sending from the client to the server + the checks on the server + the sending from the server to the client would be approximately 100ms. So around 10fps, so if you can lock the fps at 20fps or maybe 30fps on the client machine, this would reduce the difference between what is seen on the player machine and what is calculated on the server... And 20fps is more than enough to play an action game (if the movement are not too fast).<br><br>(the idea is not to wait for the server response to update the game on the client machine but rather to reduce the difference there can be so that it is not noticeable) <br><br></td></tr></table><br>
<a name="1288832"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#130">[#130]</a></td></tr></table></td></tr><tr ><td class="posttext"> I say screw it and make it 30 FPS so that we CAN make MMORPGs. No matter how small they may be.<br><br>Besides. We can easily switch this over to Ploppy's Hardwired Blitz3D and make it SHIT TONS faster, AND 64-bit as well! :D<br><br>BUT. I digress. We test it on old Blitz3D FIRST to ENSURE all the BAD bugs are beaten.<br><br>~GF <br><br></td></tr></table><br>
<a name="1288834"></a>

<a name="1288835"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#131">[#131]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>I say screw it and make it 30 FPS<br> <br></div><br>30fps would probably be ok for a gameplay where the movement are not too fast... <br><br></td></tr></table><br>
<a name="1288838"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flanker512</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#132">[#132]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> (the idea is not to wait for the server response to update the game on the client machine but rather to reduce the difference there can be so that it is not noticeable) <br></div><br><br>The last example already does that with interpolation. A player is updated client side, then he sends his position every 50ms to the server. The server just transmit the packet to other players. Interpolation is done beetween packets for other players. In the next library version the server can decide if the packets are auto transmitted to every clients (fast and simple), or not. So it will be possible to verify a position packet for example, and see if the player tried to cheat.<br><br>From the Source engine article above :<br><div class="quote"> But instead of sending a new packet to the server for each user command, the client sends command packets at a certain rate of packets per second (usually 30).<br>...<br>By default, the client receives about 20 snapshot per second. If the objects (entities) in the world were only rendered at the positions received by the server, moving objects and animation would look choppy and jittery. Dropped packets would also cause noticeable glitches. The trick to solve this problem is to go back in time for rendering, so positions and animations can be continuously interpolated between two recently received snapshot. <br></div><br>But that's just the way i'm doing it because I trust Valve for multiplayer games ;)<br>You can make the library work as you want. The only thing I didn't implement in the example is the fixed interpolation time. So the interpolation is done on the elapsed time beetween two packets, but Source engine for example interpolates entities on a fixed 100ms time by default, maybe I should do that too. <br><br></td></tr></table><br>
<a name="1288843"></a>

<a name="1288845"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#133">[#133]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hehehe, lot's of activity in this thread all of a sudden.<br><br>I thought our spherical nosy players could do with a little more personality :-). How about a little angry bird style gfx?<br><img src="http://i66.tinypic.com/2aj9ij4.jpg"><br><br>If enjoyable just add to "Function CreatePlayer(id,name$)" underneath the nose bit.<br><pre class=code>
	eyeLeft = CreateSphere(8,p\mesh):EntityColor eyeLeft,255,255,255
	PositionEntity eyeLeft ,.29,.4,.7;1
	ScaleEntity eyeLeft ,0.2,0.2,0.2
	
	pupilLeft = CreateSphere(8,p\mesh):EntityColor pupilLeft ,0,0,0
	PositionEntity pupilLeft ,.3,.52,.9;1
	ScaleEntity pupilLeft ,0.05,0.05,0.02
	
	eyeRight = CreateSphere(8,p\mesh):EntityColor eyeRight ,255,255,255
	PositionEntity eyeRight ,-.29,.4,.7;1
	ScaleEntity eyeRight ,0.2,0.2,0.2
		
	pupilRight = CreateSphere(8,p\mesh):EntityColor pupilRight ,0,0,0
	PositionEntity pupilRight ,-.3,.52,.9;1
	ScaleEntity pupilRight ,0.05,0.05,0.02

	unaBrow = CreateCone(8,1,p\mesh):EntityColor unaBrow ,0,0,0
	PositionEntity unaBrow ,0,.45,.7
	RotateEntity unaBrow ,-180,0,0
	ScaleEntity unaBrow ,.7,.2,.3
</pre><br><br>@GF: That's cool but show me the moneymaker as they say in the hood ;-) <br><br></td></tr></table><br>
<a name="1288865"></a>

<a name="1288867"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flanker</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#134">[#134]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just a little picture, the library now performs a constant background ping-pong server side :<br><br><a href="http://i.imgbox.com/7BPbCkv0.png" target="_blank"><img src="http://8.t.imgbox.com/7BPbCkv0.jpg"></a><br><br>The pings are quite weird as both server and clients examples are locked to 60fps with Flip.<br><br>I included your code in the example @Rick Nasher, that's funny ^^ <br><br></td></tr></table><br>
<a name="1288869"></a>

<a name="1288884"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >stayne</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#135">[#135]</a></td></tr></table></td></tr><tr ><td class="posttext"> why don't you replace the natives with free animated md2's or b3d's?  If you want I will build you a lightmapped level with 3dws.  no prob.<br><br>or just grab a level from <a href="http://lvlworld.com/." target="_blank">http://lvlworld.com/.</a>  make sure you put textures and .bsp in the same folder. <br><br></td></tr></table><br>
<a name="1288883"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flanker</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#136">[#136]</a></td></tr></table></td></tr><tr ><td class="posttext"> So far this is just an example for the library so it can be put in a codebox on the forum. But yes if you can build a more complex level I'll had it for sure, it will be better for testing. <br><br></td></tr></table><br>
<a name="1288885"></a>

<a name="1288888"></a>

<a name="1288892"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >stayne</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#137">[#137]</a></td></tr></table></td></tr><tr ><td class="posttext"> ok i'll build you a level. you have the 3dws map code for importing entites? if not here it is.  it's a coded example, I can explain how to strip out what you need if need be.  Easy stuff.  Entity placement is good for health, powerups, ammo, etc.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
mapfile$=CommandLine()
mapfile$=Replace(mapfile,Chr(34),"")
mapfile$=Trim(mapfile$)
;If mapfile$="" End

Global cam

AppTitle "Blitz3D"
HidePointer()

Const COLLISIONTYPE_PLAYER=1
Const COLLISIONTYPE_BULLET=2
Const COLLISIONTYPE_BRUSH=3
Const COLLISIONTYPE_MESH=4

Graphics3D 800,600,0,2
SetBuffer BackBuffer()

Collisions COLLISIONTYPE_PLAYER,COLLISIONTYPE_BRUSH,2,2

cam=CreateCamera()
CameraRange cam,1,10000
CameraZoom cam,1.4
RotateEntity cam,45,0,0
MoveEntity cam,0,0,-1000
EntityType cam,COLLISIONTYPE_PLAYER
EntityRadius cam,32

mapfile$="test.b3d"
map=LoadWorld(mapfile$)

If Not map RuntimeError "Failed to load map "+Chr(34)+mapfile+Chr(34)+"."

MoveMouse GraphicsWidth()/2,GraphicsHeight()/2

mousespeed#=0.4
cameraspeed#=10
camerasmoothness#=4

While Not KeyHit(1)

	;Camera controls
	mx#=CurveValue(MouseXSpeed()*mousespeed,mx,camerasmoothness)
	my#=CurveValue(MouseYSpeed()*mousespeed,my,camerasmoothness)
	MoveMouse GraphicsWidth()/2,GraphicsHeight()/2
	pitch#=EntityPitch(cam)
	yaw#=EntityYaw(cam)
	pitch=pitch+my
	yaw=yaw-mx
	If pitch&gt;89 pitch=89
	If pitch&lt;-89 pitch=-89
	RotateEntity cam,0,yaw,0
	TurnEntity cam,pitch,0,0
	
	cx#=(KeyDown(205)-KeyDown(203))*cameraspeed
	cz#=(KeyDown(200)-KeyDown(208))*cameraspeed
	MoveEntity cam,cx,0,cz

	UpdateWorld()
	RenderWorld()
	Flip
	Wend
	
Function CurveValue#(newvalue#,oldvalue#,increments )
If increments&gt;1 oldvalue#=oldvalue#-(oldvalue#-newvalue#)/increments
If increments&lt;=1 oldvalue=newvalue
Return oldvalue#
End Function

Function LoadWorld(file$)
map=LoadAnimMesh(file)
If Not map Return
world=CreatePivot()
meshes=CreatePivot(world)
renderbrushes=CreateMesh(world)
collisionbrushes=CreatePivot(world)
pointentities=CreatePivot(world)
solidentities=CreatePivot(world)
EntityType collisionbrushes,COLLISIONTYPE_BRUSH

For c=1 To CountChildren(map)

	node=GetChild(map,c)	
	classname$=Lower(KeyValue(node,"classname"))
	DebugLog "Loading "+Chr(34)+classname+Chr(34)+"..."
	Select classname
		
		;===============================================================================
		;Map Geometry
		;===============================================================================
		
		Case "mesh"
			EntityParent node,meshes
			c=c-1
			EntityType node,COLLISIONTYPE_MESH

		Case "brush"
			RotateMesh node,EntityPitch(node),EntityYaw(node),EntityRoll(node)
			PositionMesh node,EntityX(node),EntityY(node),EntityZ(node)
			AddMesh node,renderbrushes
			EntityAlpha node,0
			EntityType node,COLLISIONTYPE_BRUSH
			EntityAlpha node,0
			EntityParent node,collisionbrushes
			c=c-1
		
		;===============================================================================
		;Solid Entities
		;===============================================================================
		
		;Invisible collision brush
		Case "field_hit"
			EntityParent node,collisionbrushes
			EntityType node,COLLISIONTYPE_BRUSH
			EntityAlpha node,0
			c=c-1
		
		;===============================================================================
		;Point Entities
		;===============================================================================
		
		;Camera start position point entity
		Case "playerstart"
			angles$=keyvalue(node,"angles","0 0 0")
			pitch#=piece(angles,1," ")
			yaw#=piece(angles,2," ")
			roll#=piece(angles,3," ")
			If cam
				PositionEntity cam,EntityX(node),EntityY(node),EntityZ(node)
				RotateEntity cam,pitch,yaw,roll
				EndIf
		
		End Select
	Next

FreeEntity map
Return world
End Function

Function Piece$(s$,entry,char$=" ")
While Instr(s,char+char)
	s=Replace(s,char+char,char)
	Wend
For n=1 To entry-1
	p=Instr(s,char)
	s=Right(s,Len(s)-p)
	Next
p=Instr(s,char)
If p&lt;1
	a$=s
	Else
	a=Left(s,p-1)
	EndIf
Return a
End Function

Function KeyValue$(entity,key$,defaultvalue$="")
properties$=EntityName(entity)
properties$=Replace(properties$,Chr(13),"")
key$=Lower(key)
Repeat
	p=Instr(properties,Chr(10))
	If p test$=(Left(properties,p-1)) Else test=properties
	testkey$=Piece(test,1,"=")
	testkey=Trim(testkey)
	testkey=Replace(testkey,Chr(34),"")
	testkey=Lower(testkey)
	If testkey=key
		value$=Piece(test,2,"=")
		value$=Trim(value$)
		value$=Replace(value$,Chr(34),"")
		Return value
		EndIf
	If Not p Return defaultvalue$
	properties=Right(properties,Len(properties)-p)
	Forever
End Function
</textarea> <br><br></td></tr></table><br>
<a name="1288897"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flanker</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#138">[#138]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok I see, it should be easy to implement as a separated file. <br><br></td></tr></table><br>
<a name="1289046"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#139">[#139]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry about the late reply, guys. The parser on here is a bit of a pain.<br><br>Anyways, without further adieu, here's my medipack code so far :: <br><br>EDIT :: UGH... I'm just gonna post it on Pastebin.. SCREW the parser!<br><br><a href="http://pastebin.com/vAaQbUDJ" target="_blank">http://pastebin.com/vAaQbUDJ</a><br><br>~GF <br><br></td></tr></table><br>
<a name="1289052"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flanker</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#140">[#140]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Guy Fawkes<br>Your health code won't work in multiplayer. Only the local player will create health when you press spacebar, and only the local player will be able to pick it. Also, when the player picks health, only the local player knows it.<br><br>You need to use the network library with the SendMessage() command. You should try to write a very simple example for the library on your own to see how it works. SendMessage() is the only function needed to update the network once it is set, that's quite simple, but you have to use it wisely.<br><br>The v1.1 is near to be complete, major changes and new functionalities. I'll update the worklog and add a better documentation when everything is ready. <br><br></td></tr></table><br>
<a name="1289068"></a>

<a name="1289070"></a>

<a name="1289072"></a>

<a name="1289073"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#141">[#141]</a></td></tr></table></td></tr><tr ><td class="posttext"> Fixed! :D The only problem now is with respawning health packs on the fly with Ctrl+Space &amp; being able to grab them. For some reason, the collision has a little bug in THAT part of the code.<br><br>Also, shooting has been changed to the "V" key so that Mousedown may be used for an Orbit Camera set of functions! =)<br><br>Other than that, we're all clear so far! :)<br><br>I also added Fog for a much more difficult challenge! :D<br><br>I also added the ability to turn on all Collisions at the same time, or turn separate ones on or off.<br><br>And the last thing I added was camera collision with type_scene.<br><br>ENJOY!<br><br><a href="http://pastebin.com/nQuf6V83" target="_blank">http://pastebin.com/nQuf6V83</a><br><br>~GF <br><br></td></tr></table><br>
<a name="1289082"></a>

<a name="1289084"></a>

<a name="1289085"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flanker</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#142">[#142]</a></td></tr></table></td></tr><tr ><td class="posttext"> Not fixed yet ;)<br>When you create health you want to say it to other players. Also, in the UpdateItems() function, "Net_SendMessage(5,p\life,p\id,Net_MsgFrom)" means that you try to send a message to the last received message's player... and you can't use the sender data when you are a client, it's like stealing his identity and the server will just ignore your message.<br><br>Trust me, you should write a little network example, a pong with 2 players for example, and everything will be clear after that. I started to update the worklog for documentation. <br><br></td></tr></table><br>
<a name="1289086"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flanker</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#143">[#143]</a></td></tr></table></td></tr><tr ><td class="posttext"> [double post] <br><br></td></tr></table><br>
<a name="1289091"></a>

<a name="1289093"></a>

<a name="1289094"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#144">[#144]</a></td></tr></table></td></tr><tr ><td class="posttext"> @GF:<br>More tricky than you thought at first hey? But perseverance and endurance will get you there. ;-)<br><br>Nevertheless want to see what you came up with, but 2 questions..<br>-What's wrong with putting it in here using the codebox commands? See: <a href="http://www.blitzbasic.com/faq/faq_entry.php?id=2" target="_blank">http://www.blitzbasic.com/faq/faq_entry.php?id=2</a><br>-You are using dependencies: <pre class=code>api_ShowWindow ( SystemProperty$ ( "apphWnd" ), 1 )</pre><br>What decls go with that again?<br><br>Also if you want everyone to be able to enter their own name then replace the top of the example with:<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
SeedRnd MilliSecs()

Include "UDPNetwork_lib.bb"

Global localID
Global localName$ = "player" + Rand(100,999)
Print "Please enter your name"
MyName$=Input$ ("(ENTER=random default name)") 
If MyName$&lt;&gt;"" Then
	localName$= MyName$
EndIf

</textarea><br><br><br>@Flanker:<br>Nice bit of docs there, but you pulled down the library and example code of v1.0 without putting a new entry. Is this by accident or deliberate?<br>I found the code pretty enjoyable so far.. <br><br></td></tr></table><br>
<a name="1289099"></a>

<a name="1289101"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flanker</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#145">[#145]</a></td></tr></table></td></tr><tr ><td class="posttext"> It is deliberate, I will erase obsolete versions each time to make the worklog clear.<br><br>The worklog is near to be fully updated : <a href="http://www.blitzbasic.com/logs/userlog.php?user=15074&amp;log=1916" target="_blank">http://www.blitzbasic.com/logs/userlog.php?user=15074&amp;log=1916</a><br><br>The v1.1 is also uploaded, with a newer 3D example. I'll write simpler examples to explain the library.<br><br>New thread for discussion for the library, if you don't mind : <a href="http://www.blitzbasic.com/Community/posts.php?topic=105608" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=105608</a> <br><br></td></tr></table><br>
<a name="1289108"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#146">[#146]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yep, I totally agree for this was a general investigation and your lib deserves it's own thread as it really outgrew this thread. :-) <br><br></td></tr></table><br>
<a name="1290262"></a>

<a name="1290264"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#147">[#147]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, I'm certainly not going to be claiming to be the one who coded the lib Flankers making(I'm not worthy :-). We brought in ideas, tested, bug hunted? -Yes, absolutely, but 'making'(coding) is too much credit. The follow up Blitz3D Multiplayer FPS/TPS is something we can do together of course, yes.<br><br>Let's call it: <br><b>BUMP</b> -<i> (Blitz3D's Ultimate Multi Player) as a working title.</i><br><br>The conversion/extension to Hybrid can then be called:<br><b>HUMP</b> -<i> (Hybrid's Ultimate Multi Player) </i><br><br>:-D <br><br></td></tr></table><br>
<a name="1293580"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#148">[#148]</a></td></tr></table></td></tr><tr ><td class="posttext"> Chat/testing/playground for Flanker's UDPlib:<br><br>Site: <a href="http://webchat.quakenet.org/" target="_blank">http://webchat.quakenet.org/</a><br>Channel: #UDPNetwork_lib <br><br></td></tr></table><br>
<a name="1294486"></a>

<a name="1294488"></a>

<a name="1294549"></a>

<a name="1294557"></a>

<a name="1294560"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#149">[#149]</a></td></tr></table></td></tr><tr ><td class="posttext"> Added some new audio fx and other fixes. Will provide download link tonight..<br><br>[EDIT]<br><img src="http://i64.tinypic.com/219s7kj.jpg"><br><br>Source+media download <a href="https://www.mediafire.com/?m412elhdkimlg7f" target="_blank"><b>&lt;here&gt;</b></a><br>Executable download <a href="https://www.mediafire.com/?rnrautdi31w5i9n" target="_blank"><b>&lt;here&gt;</b></a> <br><br></td></tr></table><br>
<a name="1294555"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#150">[#150]</a></td></tr></table></td></tr><tr ><td class="posttext"> SICK, RICK! :)<br><br>~GF <br><br></td></tr></table><br>
<a name="1294556"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#151">[#151]</a></td></tr></table></td></tr><tr ><td class="posttext"> :-) <br><br></td></tr></table><br>
<a name="1294696"></a>

<a name="1294697"></a>

<a name="1294698"></a>

<a name="1294699"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#152">[#152]</a></td></tr></table></td></tr><tr ><td class="posttext"> @GF:<br><br>Just a quick idea of how to implement, already partialy functional(host can kick), requires finetuning, but proof of concept.<br>At the chat variables initialization, in beginning of code add:<br><pre class=code>
; chat
Global maxlinelength% =79
</pre><br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Function UpdateChat()
	; this routine does the input check..
	key = GetKey()
	
	If key
		If key = 13 ;carriage return, so entered, msgline finished.
			If chatMessage &lt;&gt; localName + "&gt; " ; so msg is larger than the prompt.
				
				If Len(chatMessage) &gt; maxlinelength-(Len(localName)+2)  ; so exceeds max line length
					chatMessage = Left$(chatMessage,maxlinelength) ; so ignoring all surpassing max chars.
				EndIf	
				
				
				For i = Len(localName + "&gt; ") To Len(chatMessage) ;check all characters from afte name+promtsign to end of msg..
					If Mid(chatMessage,i,1) &lt;&gt; " " ; trap all spaces input, so no empty jibberish..
						
						
						; '/' commands..
						If localMode = 2 ; only the host/server can kick/ban players..(ban not requires keeping a dbase).
							
							If Mid(chatMessage,i,1) = "/" ; check for the command trigger '/'
								
								;check 2nd part(command) &lt;&lt; later to be done from data statements holding all commands..
								If Mid(chatMessage,i+1,5) = "kick " ; if at $location name+promptsign+/+5 chars= "kick "
									playerToBeKickedName$ = Mid(chatMessage,i+6, Len(chatMessage) )    ;
									Net_KickPlayer(playerToBeKickedName$) 
									;NewMessage(playerToBeKickedName$ + " has been kicked! ") ; display msg.
									Net_SendMessage(1,playerToBeKickedName$ + " has been kicked! ") ; send msg to all.
								EndIf
							EndIf	
							
						;ElseIf localMode = 3 ; moderator &lt;&lt; to be introduced into code stil..	
							;moderator commands go here.
						ElseIf localMode &lt;&gt; 2 ;Or localmode &lt;&gt; 3 ;so no server/host or moderator..
							Net_SendMessage(1,"") ; send msg to all.
							NewMessage( " kicking not allowed.. ") ; display msg.
							
						EndIf
						
						
						
						;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
						; &lt;&lt;&lt; colored txt mod by Raster Ron
						chatColor$ = RGB_To_TriHex(cR,cG,cB)
						chatMessage = chatMessage + "¿" + chatColor$
						;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
						
						
						Net_SendMessage(1,chatMessage) ; send msg to all.
						NewMessage(chatMessage)        ; put in the msg buffer for display on screen.
						Exit
					EndIf
				Next
			EndIf
			chatMessage = localName + "&gt; "
			chatMode = 0
		ElseIf key = 8 And Len(chatMessage) &gt; Len ( localName + "&gt; " ) ; backspace and msg length longer then..
			chatMessage = Left(chatMessage,Len(chatMessage)-1) ; reduce lenght of msg with 1.
			
		ElseIf key &gt; 31 And key &lt; 127 ; if msg is valid range between 'US'(unit separator) and 'DEL' , so from 'SPACE' to '~'
			chatMessage = chatMessage + Chr(key)
		EndIf
	EndIf
	
	Color 255,255,255
	Rect 0,GraphicsHeight()-20,GraphicsWidth(),20,1
	
	Color 0,0,0
	Rect 0,GraphicsHeight()-20,GraphicsWidth(),20,0
	
	
	If MilliSecs()-chatMillisecs &gt; 500
		chatCursor = Not chatCursor
		chatMillisecs = MilliSecs()
	EndIf
	
	If chatCursor
		Text 5,GraphicsHeight()-17,chatMessage + "|"
	Else
		Text 5,GraphicsHeight()-17,chatMessage
	EndIf
	
End Function
</textarea><br><br>Going to sleep now(yawn), hope you like it so far. <br><br></td></tr></table><br>
<a name="1294820"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#153">[#153]</a></td></tr></table></td></tr><tr ><td class="posttext"> Woops, fixed some bugs/logic errors. (It was late..)<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Function UpdateChat()
	; this routine does the input check..
	key = GetKey()
	
	If key
		If key = 13 ;carriage return, so entered, msgline finished.
			If chatMessage &lt;&gt; localName + "&gt; " ; so msg is larger than the prompt.
				
				If Len(chatMessage) &gt; maxlinelength-(Len(localName)+2)  ; so exceeds max line length
					chatMessage = Left$(chatMessage,maxlinelength) ; so ignoring all surpassing max chars.
				EndIf	
				
				
				For i = Len(localName + "&gt; ") To Len(chatMessage) ;check all characters from afte name+promtsign to end of msg..
					If Mid(chatMessage,i,1) &lt;&gt; " " ; trap all spaces input, so no empty jibberish..
						
						
						; '/' commands..
						
							
							If Mid(chatMessage,i,1) = "/" ; check for the command trigger '/'
								
								;check 2nd part(command) &lt;&lt; later to be done from data statements holding all commands..
								If Mid(chatMessage,i+1,5) = "kick " ; if at $location name+promptsign+/+5 chars= "kick "
									playerToBeKickedName$ = Mid(chatMessage,i+6, Len(chatMessage) )    ;
									
									If localMode = 2 ; only the host/server can kick/ban players..(ban not requires keeping a dbase).
										If playerToBeKickedName$ &lt;&gt; localName$ ; so host is not kicking himself.
											Net_KickPlayer(playerToBeKickedName$) 
											
											;NewMessage(playerToBeKickedName$ + " has been kicked! ") ; display msg.
											Net_SendMessage(1,playerToBeKickedName$ + " has been kicked! ") ; send msg to all.
										Else 
											NewMessage( "-Selfkicking not allowed.. ") ; display msg.
										EndIf
										
									ElseIf localMode = 3 ; moderator &lt;&lt; to be introduced into code stil..	
										;moderator commands go here.	
										
									Else ; so  localMode &lt;&gt; 2 or 3 ;so no server/host or moderator..
										;Net_SendMessage(1,"") ; send msg to all.
										NewMessage( "- kicking not allowed.. ") ; display msg.
										
									EndIf
								EndIf
								
								
							Else ; so not in command mode.
								
								
								;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
								; &lt;&lt;&lt; colored txt mod by Raster Ron
								chatColor$ = RGB_To_TriHex(cR,cG,cB)
								chatMessage = chatMessage + "¿" + chatColor$
								;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
								
								
								Net_SendMessage(1,chatMessage) ; send msg to all.
								NewMessage(chatMessage)        ; put in the msg buffer for display on screen.
								
								
								
								
							EndIf	
							
							
							Exit
							
					EndIf
				Next
			EndIf
			chatMessage = localName + "&gt; "
			chatMode = 0
		ElseIf key = 8 And Len(chatMessage) &gt; Len ( localName + "&gt; " ) ; backspace and msg length longer then..
			chatMessage = Left(chatMessage,Len(chatMessage)-1) ; reduce lenght of msg with 1.
			
		ElseIf key &gt; 31 And key &lt; 127 ; if msg is valid range between 'US'(unit separator) and 'DEL' , so from 'SPACE' to '~'
			chatMessage = chatMessage + Chr(key)
		EndIf
	EndIf
	
	Color 255,255,255
	Rect 0,GraphicsHeight()-20,GraphicsWidth(),20,1
	
	Color 0,0,0
	Rect 0,GraphicsHeight()-20,GraphicsWidth(),20,0
	
	
	If MilliSecs()-chatMillisecs &gt; 500
		chatCursor = Not chatCursor
		chatMillisecs = MilliSecs()
	EndIf
	
	If chatCursor
		Text 5,GraphicsHeight()-17,chatMessage + "|"
	Else
		Text 5,GraphicsHeight()-17,chatMessage
	EndIf
	
End Function
</textarea><br>Fixes:<br>-Msg display is little better.<br>-Host can't kick oneself.<br>-Bit more fool proof. <br><br></td></tr></table><br>
<a name="1294831"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#154">[#154]</a></td></tr></table></td></tr><tr ><td class="posttext"> Meet me in da chat, @Rick Nasher! =D<br><br>~GF <br><br></td></tr></table><br>
<a name="1294886"></a>

<a name="1294887"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#155">[#155]</a></td></tr></table></td></tr><tr ><td class="posttext"> Rick, having a BIT of trouble with the player's type (ie: Player, Server, Administrator, Moderator, etc...). I did manage to at least get it to show under the player's name and have the values of 3 &amp; 4 be recognized by the server as actual Administrator / Moderator statuses.<br><br>I just can't grab the player's local Mode. ( the mode in which player x connects to the server ).<br><br>For instance, if the admin is already connected &amp; has a localMode of "3", and the player that just connected has a localMode of "1", the player that connected's type should be Player, &amp; the Admin's should be "ADMINISTRATOR", and each player / admin, etc, should be able to see the different status types under their names, but I either see Player for ALL Players in this example INCLUDING the Administrator being Player instead of Administrator as well.<br><br>ADVANCED_3D_EXAMPLE_V.1.6.1.bb: <br><br><a href="http://pastebin.com/QEE6ybYc" target="_blank">http://pastebin.com/QEE6ybYc</a><br><br>UDPNetwork_lib.bb ( Modified as well ): <br><br><a href="http://pastebin.com/RhuD4QdE" target="_blank">http://pastebin.com/RhuD4QdE</a><br><br>Thanks alot, Rick!<br><br>~GF <br><br></td></tr></table><br>
<a name="1294897"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#156">[#156]</a></td></tr></table></td></tr><tr ><td class="posttext"> Heyy.. you've been busy.<br>Sorry, no time to check your stuff yet, have to work soon and woke up just now to do a slight improvement on my own code(not there yet). Will check your code as soon as permits.<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Function UpdateChat()
	; this routine does the input check..
	key = GetKey()
	If key
		If key = 13 ;carriage return, so entered, msgline finished.
			If chatMessage &lt;&gt; localName + "&gt; " ; so msg is larger than the prompt.
				
				If Len(chatMessage) &gt; maxlinelength-(Len(localName)+2)  ; so exceeds max line length
					chatMessage = Left$(chatMessage,maxlinelength) ; so ignoring all surpassing max chars.
				EndIf	
				
				
				For i = Len(localName + "&gt; ") To Len(chatMessage) ;check all characters from afte name+promtsign to end of msg..
					If Mid(chatMessage,i,1) &lt;&gt; " " ; trap all spaces input, so no empty jibberish..
						
						
						; '/' commands..
						
						
						If Mid(chatMessage,i,1) = "/"  ; check for the command trigger '/' if so, go into command mode..
							
							;check 2nd part(command) &lt;&lt; later to be done from data statements holding all commands..
							If Mid(chatMessage,i+1,5) = "kick " ; if at $location name+promptsign+/+5 chars= "kick "
								playerToBeKickedName$ = Mid(chatMessage,i+6, Len(chatMessage) )    ;
						
								For p.player = Each player ; check each player
									If p\name = playerToBeKickedName$  ;so only if playername exists..
									
										If localMode = 2 ; only the host/server can kick/ban players..(ban not requires keeping a dbase).
											If playerToBeKickedName$ &lt;&gt; localName$ ; so host is not kicking himself.
												
												chatMessage=playerToBeKickedName$ + " has been kicked by host! "
												;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
												; &lt;&lt;&lt; colored txt mod by Raster Ron
												chatColor$ = RGB_To_TriHex(cR,cG,cB)
												chatMessage = chatMessage + "¿" + chatColor$
												;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
																						
												
												Net_SendMessage(1,chatMessage) ; send msg to all.
												Net_KickPlayer(playerToBeKickedName$) 
									
											Else 
												NewMessage( "-Selfkicking not allowed.. ") ; display msg.
											EndIf
											
										;ElseIf localMode = 3 ; moderator &lt;&lt; to be introduced into code stil..	
											;moderator commands go here.
												
										Else ; so  localMode &lt;&gt; 2 or 3 ;so no server/host or moderator..
											;Net_SendMessage(1,"") ; send msg to all.
											NewMessage( "-Kicking not allowed for non-admins.. ") ; display msg.
										EndIf
										;Exit
									EndIf
								Next
								
							EndIf
						Else ; so if not in command mode.
							;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
							; &lt;&lt;&lt; colored txt mod by Raster Ron
							chatColor$ = RGB_To_TriHex(cR,cG,cB)
							chatMessage = chatMessage + "¿" + chatColor$
							;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
					
							Net_SendMessage(1,chatMessage) ; send msg to all.
							NewMessage(chatMessage)        ; put in the msg buffer for display on screen.
					
							
							
							
						EndIf	; check for the command trigger '/' if so, go into command mode..
						
						
						Exit	
							
					EndIf ; trap all spaces input, so no empty jibberish..
				Next ;check all characters from afte name+promtsign to end of msg..
			EndIf ;chatMessage &lt;&gt; localName + "&gt; " 
			
			chatMessage = localName + "&gt; "
			chatMode = 0
			
			
		ElseIf key = 8 And Len(chatMessage) &gt; Len ( localName + "&gt; " ) ; backspace and msg length longer then..
			chatMessage = Left(chatMessage,Len(chatMessage)-1) ; reduce lenght of msg with 1.
			
		ElseIf key &gt; 31 And key &lt; 127 ; if msg is valid range between 'US'(unit separator) and 'DEL' , so from 'SPACE' to '~'
			chatMessage = chatMessage + Chr(key)
			
		EndIf ;key = 
	EndIf ;key
	
	Color 255,255,255
	Rect 0,GraphicsHeight()-20,GraphicsWidth(),20,1
	Color 0,0,0
	Rect 0,GraphicsHeight()-20,GraphicsWidth(),20,0
	
	
	If MilliSecs()-chatMillisecs &gt; 500
		chatCursor = Not chatCursor
		chatMillisecs = MilliSecs()
	EndIf
	
	If chatCursor
		Text 5,GraphicsHeight()-17,chatMessage + "|"
	Else
		Text 5,GraphicsHeight()-17,chatMessage
	EndIf
	
End Function
</textarea> <br><br></td></tr></table><br>
<a name="1294935"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#157">[#157]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi, Rick! Any luck? Meet me in the chat! :) <br><br>~GF <br><br></td></tr></table><br>
<a name="1294947"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Canana</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#158">[#158]</a></td></tr></table></td></tr><tr ><td class="posttext"> Could I try this out?<br>I have never been able to get multiplayer working, it always crashes lol <br><br></td></tr></table><br>
<a name="1294948"></a>

<a name="1294949"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#159">[#159]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sure! :)<br><br>Come chat with me, &amp; / or Rick Nasher &amp; / or Flanker. We are the creators of the demo &amp; the library!<br><br><a href="http://webchat.quakenet.org" target="_blank">http://webchat.quakenet.org</a><br><br>the room is: <br><br>UDPNetwork_lib<br><br>Type it EXACTLY the way you see it.<br><br>I'll see you in the chat! :) <br><br>~GF <br><br></td></tr></table><br>
<a name="1295435"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#160">[#160]</a></td></tr></table></td></tr><tr ><td class="posttext"> Anyone wanna come test with me? =)<br><br>~GF <br><br></td></tr></table><br>
<a name="1295916"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#161">[#161]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello? Rick, Flanker? Wanna do some beta testing? <br><br>~GF <br><br></td></tr></table><br>
<a name="1296353"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#162">[#162]</a></td></tr></table></td></tr><tr ><td class="posttext"> Anyone wanna have a test run today? =)<br><br>~GF <br><br></td></tr></table><br>
<a name="1296362"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#163">[#163]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey-hey. Sorry haven't been able to test/code past few weeks. Anything in particular you've coded and want to test? <br><br></td></tr></table><br>
<a name="1296363"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#164">[#164]</a></td></tr></table></td></tr><tr ><td class="posttext"> No. I just wanna run some beta tests.<br><br>Meet me in the chatroom! :D<br><br>~GF <br><br></td></tr></table><br>
<a name="1306151"></a>

<a name="1306154"></a>

<a name="1306155"></a>

<a name="1306157"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#165">[#165]</a></td></tr></table></td></tr><tr ><td class="posttext"> @RustiKristi<br>I'm not sure what you mean:<br>1. If the player falls through the floor in the multiplayer example I'm having a real issue(bug).<br>2. If meant in general:<br><br>Syntax is..<br>EntityRadius entity, x_radius#[,y_radius#]<br><br>Parameters<br>entity - entity handle <br>x_radius# - x radius of entity's collision ellipsoid <br>y_radius# (optional) - y radius of entity's collision ellipsoid. If omitted the x_radius# will be used for the y_radius#.  <br><br>So you if set x-radius only, you'll have a sphere.<br>If set y-radius also, you can create an ellipse (sphere with diff height than width).<br><br>e.g:<br>EntityRadius mesh,2.0        ;sphere size 2 in diameter.<br>EntityRadius mesh, 1.2, 1.0  ;ellipse width 1.2 , height 1.0.<br><br><br><br>@RemiD<br>I know it seems easy like that, but nevertheless isn't somehow:<br>for instance how do you determine the difference between character running down a ramp or falling of a cube of same height?<br><br>I've tried 2 approaches(in both examples the actual code is in the 'Else' section(if you're interested at least):<br><br>example1:<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Function UpdatePlayers()


		
	For p.player = Each player ; check all players..
	
		If p\id &lt;&gt; localID ; ; UPDATE NON LOCAL PLAYERS..
			;; LINEAR INTERPOLATION ;;;;;;;;;;
			If p\nextTime &lt;&gt; p\previousTime ; if both packets arrived at the same time, we can't interpolate
				curTime# = Float(MilliSecs()-p\nextTime) / Float(p\nextTime-p\previousTime) ; curTime will be ideally 0.0-1.0, if it's &gt; 1.0 then it performs extrapolation
				If curTime &gt; 1 Then curTime = 1 ; extrapolation gives anoying jittering effects
				; special fix for yaw as EntityYaw returns a value beetween +180 ans -180, the interpolation can go backward
				If p\previousYaw &lt; 0 Then p\previousYaw = p\previousYaw + 360
				If p\nextYaw &lt; 0 Then p\nextYaw = p\nextYaw + 360
				If Abs(p\nextYaw-p\previousYaw) &gt; 180
					If p\nextYaw &gt; p\previousYaw
						p\previousYaw = p\previousYaw + 360
					Else
						p\previousYaw = p\previousYaw - 360
					EndIf
				EndIf
				PositionEntity p\mesh,p\previousX+(p\nextX-p\previousX)*curTime,p\previousY+(p\nextY-p\previousY)*curTime,p\previousZ+(p\nextZ-p\previousZ)*curTime
				RotateEntity p\mesh,0,p\previousYaw+(p\nextYaw-p\previousYaw)*curTime,0
			Else
				PositionEntity p\mesh,p\nextX,p\nextY,p\nextZ
				RotateEntity p\mesh,0,p\nextYaw,0
			EndIf
			;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
			
		Else ; So if p\id = localID  thus update (local) player stuff. 
			 ; (Can't be combined with other local player stuff
			 ; for will somehow make jumping bit more laggy??)
			
			
			; basically below just computes gravity for local player. Actual positions will be updated across other player next loop. 
            ;[if done outside this loop(so at update local player) then jumping is more jurkey??]
			
			p\velocityY = p\velocityY - 0.03 ; increase fake gravity (wherever we are)by substracting every time when passing by in this loop.
			falling=True ;, gravity is always on.
			
			
			If EntityY(p\mesh) - p\currentY &gt;= 0 Then; but if player is not falling(or not anymore) for entity's Ypos-currentY do not differ.. 
				
				If p\velocityY &lt; -0.03 Then p\velocityY = -0.03 ; we limit the gravity to normal values.
				falling=False
				
				
				If highFall= True ; so previously fell from high object..
					; reduce lifestrength
					NewMessage(" Ouch!  Y= "+EntityY(p\mesh) )
					highFall=False ;reset
					SoundVolume hitsnd, .8
					hitchannel = PlaySound (hitsnd)
					Net_SendMessage(5,p\id) ; notify non local players too, so they can adjust healthdisplay and play sound.
				EndIf	
				If tooHighFall= True ; so previously fell from too high object..
					; reduce life to 0(our player didn't make it :-( 
					SoundVolume deathsnd, .8
					hitchannel = PlaySound (deathsnd)
					NewMessage(" Aargh dead!  Y= "+EntityY(p\mesh) )
					NewMessage(p\name + " Jumped of a too high cliff..  p\life: " + p\life );debug 
					tooHighFall=False ;reset
					RandomSpawn(p\id)
				EndIf	
			EndIf
			
			p\currentY = EntityY(p\mesh)
			TranslateEntity p\mesh,0,p\velocityY,0
			
			If falling = True
				NewMessage(" Fallling!  Y= "+EntityY(p\mesh) )
				If EntityY(p\mesh)&gt;15 And EntityY(p\mesh)&lt;26  Then highFall=True ; reduce life
				If EntityY(p\mesh)&gt;20 Then tooHighFall=True ; fatal
			EndIf
			
		EndIf
	Next
	
End Function

</textarea><br><br>example2:<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Function UpdatePlayers()


		
	For p.player = Each player ; check all players..
	
		If p\id &lt;&gt; localID ; ; UPDATE NON LOCAL PLAYERS..
			;; LINEAR INTERPOLATION ;;;;;;;;;;
			If p\nextTime &lt;&gt; p\previousTime ; if both packets arrived at the same time, we can't interpolate
				curTime# = Float(MilliSecs()-p\nextTime) / Float(p\nextTime-p\previousTime) ; curTime will be ideally 0.0-1.0, if it's &gt; 1.0 then it performs extrapolation
				If curTime &gt; 1 Then curTime = 1 ; extrapolation gives anoying jittering effects
				; special fix for yaw as EntityYaw returns a value beetween +180 ans -180, the interpolation can go backward
				If p\previousYaw &lt; 0 Then p\previousYaw = p\previousYaw + 360
				If p\nextYaw &lt; 0 Then p\nextYaw = p\nextYaw + 360
				If Abs(p\nextYaw-p\previousYaw) &gt; 180
					If p\nextYaw &gt; p\previousYaw
						p\previousYaw = p\previousYaw + 360
					Else
						p\previousYaw = p\previousYaw - 360
					EndIf
				EndIf
				PositionEntity p\mesh,p\previousX+(p\nextX-p\previousX)*curTime,p\previousY+(p\nextY-p\previousY)*curTime,p\previousZ+(p\nextZ-p\previousZ)*curTime
				RotateEntity p\mesh,0,p\previousYaw+(p\nextYaw-p\previousYaw)*curTime,0
			Else
				PositionEntity p\mesh,p\nextX,p\nextY,p\nextZ
				RotateEntity p\mesh,0,p\nextYaw,0
			EndIf
			;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
			
		Else ; So if p\id = localID  thus update (local) player stuff. 
			 ; (Can't be combined with other local player stuff
			 ; for will somehow make jumping bit more laggy??)
			
			
			; basically below just computes gravity for local player. Actual positions will be updated across other player next loop. 
            ;[if done outside this loop(so at update local player) then jumping is more jurkey??]
			
			p\velocityY = p\velocityY - 0.03 ; increase fake gravity (wherever we are)by substracting every time when passing by in this loop.
			;falling=True, gravity is always on.
			
			
			If EntityY(p\mesh) - p\currentY &gt;= 0 Then; but if player is not falling(or not anymore) for entity's Ypos-currentY do not differ.. 
				maxReachedVelocityY=p\velocityY ; we store maximumreached falling speed.
				
				If p\velocityY &lt; -0.03 Then p\velocityY = -0.03 ; we limit the gravity to normal values.
				;falling=False
				
				If maxReachedVelocityY#&lt; -0.03 ; so when falling speed was higher then normal gravity.. 
					
					If maxReachedVelocityY# &lt;= (-0.66) And maxReachedVelocityY# &gt;= (-0.95) Then ;so if velocity between low to medium thresholds reduce life..
						p\life=p\life-Int((Abs(maxReachedVelocityY#))) ; reduce health/life with fallingspeed
						
						If p\life&gt;0 Then ;so when has life to spare..
							NewMessage(" Ouch! "+maxReachedVelocityY# +" , " + Int(Abs(maxReachedVelocityY#) )+ " , p\life: " + p\life );debug
							SoundVolume hitsnd, .8
							hitchannel = PlaySound (hitsnd)
							Net_SendMessage(5,p\id) ; notify non local players too, so they can adjust healthdisplay and play sound.
							
						ElseIf p\life&lt;= 0 ; so if no life to spare.. 
							NewMessage(" Aargh! "+maxReachedVelocityY# )
							SoundVolume deathsnd, .8
							hitchannel = PlaySound (deathsnd)
							RandomSpawn(p\id)
						EndIf	
						
						
					ElseIf maxReachedVelocityY# &lt;= (-0.96) Then ;die
						NewMessage(" Aargh! "+maxReachedVelocityY# )
						SoundVolume deathsnd, .8
						hitchannel = PlaySound (deathsnd)
						NewMessage(p\name + " Jumped of a too high cliff.. MaxvelocityY: "+maxReachedVelocityY# +" , int: " + Int(Abs(maxReachedVelocityY#) )+ " , p\life: " + p\life );debug 
						
						RandomSpawn(p\id)
						
						
					EndIf
					
					maxReachedVelocityY=p\velocityY
				EndIf	
				
	

			
			p\currentY = EntityY(p\mesh)
			TranslateEntity p\mesh,0,p\velocityY,0
			

		EndIf
	Next
	
End Function
</textarea> <br><br></td></tr></table><br>
<a name="1306210"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RustyKristi</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#166">[#166]</a></td></tr></table></td></tr><tr ><td class="posttext"> thanks. I forgot about the Y param in EntityRadius and I'll give it another go. <br><br></td></tr></table><br>
<a name="1306518"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#167">[#167]</a></td></tr></table></td></tr><tr ><td class="posttext"> Above issue solved Post#203<br> <a href="http://www.blitzbasic.com/Community/posts.php?topic=105608#1306517." target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=105608#1306517.</a> <br>Now I'm trying to add the ability for players with more strength(more healthpower actually) to push players with lesser strength(of a cliff for instance ;-)<br>I thought I could achieve this by checking if players collided and then use translate entity to push the player: <br><img src="http://i68.tinypic.com/2vru788.jpg"><br>Which is working, except for that then shooting system fails for the server. Will need to rethink. <br><br></td></tr></table><br>
<a name="1306519"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#168">[#168]</a></td></tr></table></td></tr><tr ><td class="posttext"> WOW, NASHER! You REALLY ARE making some KICK-ASS head way! =D<br><br>Keep up the EXCELLENT work!<br><br>~GF <br><br></td></tr></table><br>
<a name="1306545"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#169">[#169]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, I try. But right now the good old burnout headache cane back to haunt me and have to go to work, so that kinda sucks.  <br>I really want to have this fixed before I bring in stuff from the moving platform demo and a freecam sort of routine (for the not  being able to look round is starting to annoy me :-), so don't lose oversight. <br><br>Other than with regular code it's kinda tricky at times to know where and how to introduce new functionality due to the network thinghy. Lots of stuff to keep track on at same time: Server/client/local player and code is rather spaghetti-ish in that sense. <br><br></td></tr></table><br>
<a name="1306551"></a>

<a name="1306552"></a>

<a name="1306553"></a>

<a name="1306554"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#170">[#170]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>for instance how do you determine the difference between character running down a ramp or falling of a cube of same height?<br> <br></div><br>i have already answered before...<br>consider the human behavior when crossing obstacles, when the obstacle is small (below the knee level) you can consider that the character is not falling but rather automatically crossing the obstacle.<br>So how does this translate into code :<br>each loop, check where is the ground related to the x,z position of the character<br>if the ground is below the character feet but the distance between the character feet and the ground is at a distance at less than 0.475units (corresponds to the distance between the feet and the knee of my humanoids), or if the ground is above the character feet and the ground is at a distance at less than 0.475units, position the character directly at the picked ground position, else the character is falling.<br>This allows the character to cross small obstacles and to move up or down on not too steep slopes.<br>After that i turn move the character (at front,back,left,right). <br><br></td></tr></table><br>
<a name="1306586"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#171">[#171]</a></td></tr></table></td></tr><tr ><td class="posttext"> @RemiD.<br><br>Already solved the falling issue(as can be read above, you haven't read the news? ;o) It's working fine, see code below in the UpdatePlayers() function.<br><b>V1.71.1</b><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; *** ROADMAP/HISTORY ***
;
; ADDED SO FAR: 
; -chattext colors matched to playercolors.
; -different health strengths and spawn times.
; -hide entities names when one player cannot see each other(so can play hide&amp;seek)..
; -different health item strengths, which are also displayed above the 
;  item and take time to become available again depending on strenght.
; -fixes to keybd input and window focus.
; -sound fx(quicky, needs more work).
;
; UPDATE 29-04-2016:
; -lock/unlock mse + hud.focus to window switch 'f'.
; -F1=help.
; -F2=change player color on the fly.
; -rapidfire toggle command.
; 
; UPDATE 12-05-2016:
; V1.66 fixed friendly fire bug.(no more shooting yourself in the foot, stommach or whatever :-)
; V1.66.2 correctly displaying msg+snd.
; V1.69.2:
; -Added 2nd (and higher) ramp to fall and die from.
; -F3=display current player coords.
;
; V1.69.3:
; -fixed bug where chat held onto keys that would turn into player controls after submit.e.g. space=jump.
; -Temporary disabled health loss when falling ability.
; -Changed death sound, fixed all sounds to play local and on networked players, 
;  added typwrittersounds for chat(only Local) and submit snd on network to attract attention.
;  only 1 audio bug remaining: producing hit sound while actually collecting an item or when player(client)
;  gets introduced into game (unclear why).
;
; V1.69.5(14-05-2016): 
; -fixed fall bug aka (when enabled 'health loss when falling ability' it works, but also kills the player when running down a ramp)
;
; V1.70.0(14-05-2016):
; -Fixed bugs: health inacuracies. color at start always displaying ok on players.
; 
; V1.71.0(16-05-2016):
; -Falling = reduced health feature working properly.
;
; V1.71.1(16-05-2016):
; -Fixed bugs: health inacuracies. color at start always displaying ok on players.
;
;
; TODO UPTO VERSION 2.0 (not nesacerrily in this order, all using procedural gfx, without ext libs/media, except sound):
; -delay timer for after death..reintroducing player into game.
; -test w gf, flanker or others. ;-) 
; -scorch marks on hit objects.
; -fps /tps switch.
; -weapon upgrades.
; -push each other ability.
; -'/' cheatmodes and additional commands.
; -flashlight  + day nightcycle.
; -add moving platforms demo code.
; -game music. playing more exited when near an enemy.
; -robo players with simple ai.
; -gui with saveable prefs.
; -simple animated chars.
; -ladder climbing/crouching.
; -walking, running and sounds to match.
; -superjump powerup.
; -schields.
; -teleportation.
; -weather conditions. 
;
; TODO FOR VERSION 3.0 (more advanced, incorporating media and ext libs):
; -move to stayne's level.
; -3d animated chars.
; -AlienBreed 3d characters?
; -Special effects, doors, etc.
; -Vehicals/terrian.
; -PhysX.
; -Shadows.

; KNOWN BUGS:
; -producing hit sound while actually collecting or when player(client) gets introduced into game /health reduction when introduced into game.
; 
SeedRnd MilliSecs()

Const gameLogicFPS = 60

Global enableFocus=True  ; lock mouse to screen and hide pointer 'f' key toggles locked/unlocked mode.
Global enableRapidFire=False  ; 'r' key toggles normal/rapidfire mode.

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; first we include the KeyFix library
Include "KeyFix_Constants.bb"
; we now include the network library
Include "UDPNetwork_lib.bb"
; for converting RGB values to "Tri-Hex" stringc inlude hex8.
Include "Hex8.bb" ;&lt;&lt;&lt; Colored txt mod by Raster Ron 

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Global localID ; the id of the current local player. (figures..)

;original code..
;Global localName$ = Input("Enter your name : ")
;If localName = "" Then localName = "player" + Rand(100,999)

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;&lt;&lt; Enter through mod..(for ease of use)
Global localName$ = "", defaultName$ = "RCX" ; My own pre-defined username, so just need to press enter to save typing ;-) 
;change above username to your own liking.

Print "Change default name: '"+ defaultName$ +"' ?"
Choic$ = Input$("[Press [Y]es or [ENTER] for No: ")
If Choic$="y" Then ; so want to change..
	Cls:Locate 0,0
	Print "Type name &amp; press [ENTER] or"
	ChangeName$=Input$("just [ENTER] to autogenerate: ")
	If ChangeName$="" ; so pressed enter to autogen..
		localName = "player" + Rand(100,999)
	Else ; so entered a new name..
		localName$=ChangeName$
	EndIf
Else ; so entered without input.
	localName$ = defaultName$
EndIf
;&lt;&lt;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Global localPlayerMesh , ground

Type player
	Field id
	Field name$
	Field ping
	Field ip
	
	Field life
	Field kills
	Field deaths
	
	Field mesh
	Field r,g,b
	
	Field nextX#,nextY#,nextZ#
	Field previousX#,previousY#,previousZ#
	Field nextYaw#
	Field previousYaw#
	Field nextTime
	Field previousTime
	
	Field lastPacket
	
	Field currentY#
	Field velocityY#
	
	Field jumped
	
End Type

Type bullet
	Field mesh
	Field angle#
	Field time
	Field id ; id of player who fired
End Type

Type health
	Field mesh
	Field pickupTime ; to store when was pickedup and can hide for a certain time set in 
	Field respawnDelay ; &lt; see above
	Field visible
	Field power ; to hold strength of upgrade
	;Field id ; id of player who collected
End Type

Type spawn
	Field spawnId
	Field x#,y#,z#
	Field yaw#
End Type

Global spawns ; number of spawn points
Global firsttimehealth=True
Global firsttime=True
Global falling=False, highFall=False, tooHighFall=False,maxReachedVelocityY#=0.0, fall=0



;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Camera code from jfk EO-11110, thanks
Global bounce_cam=1 ;  smooth camera motion? (0/1)
Global bounce_div#=10.0 ; the higher, the more sluggish the camera will follow. Recc: 3.0 to 20.0
; some globals used by ChaseCam
Global old_x#,old_y#,old_z#
; desired distance between camera and player mesh
Global x_dis#=7.0,y_dis#=3,z_dis#=7.0,y_dis_or#=y_dis#


;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

; network init ----------------------------------------;
Global localMode = Net_StartInput() ; bring the library "console" to connect

If localMode = 1 Or localMode = 2 ; 1 means we are client, 2 means we are server
	
	localID = Net_CreatePlayer(localName) ; this command inits the server or local client
	
	If localID = 0 ; error
		Net_StopNetwork() ; close the network properly
		RuntimeError("Failed to create player.")
	EndIf
	
	If localMode = 1 Then AppTitle("Client : " + localName + " (port:" + net_port + "/ ID=" + localID +" / IP= "+ net_ip+ ")                   [F1] = Help!    [F] = Mouse (un)lock ")
	If localMode = 2 Then AppTitle("Server : " + localName + " (port:" + net_port + "/ ID=" + localID +" / IP= "+ net_ip+ ")                   [F1] = Help!    [F] = Mouse (un)lock ")
	 
Else ; error
	Net_StopNetwork()
	RuntimeError("Failed to start game.")
EndIf
;------------------------------------------------------;
grphicsWidth = 640
grphicsHeight= 480
Graphics3D grphicsWidth ,grphicsHeight,32,2
SetBuffer BackBuffer()

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; audio
Global musicOn=False, musiclevel#=.5, danger=False												 ;music 
Global bgmusic_vol#=.5, bgmusicChannel, bgmusic 
Global dangermusic_vol#=0, dangermusicChannel, dangermusic     		     			             ;music

Global wade_vol#, run_vol#, wadechannel, runchannel , shootchannel, boomchannel, pwrchannel	     ;player sfx
Global shoot, boom, uh, pwr, pwrappear, fullhealth, pickupnogo , pickupchannel ,jumpchannel, jumpsound , hitsnd, hitchannel   
Global deathsnd, appearsnd, typesnd,newlinesnd

;Game music
;If gamelevel=1 Then LoadMusic("spacepanic.mp3") ; load gamemusic
;If gamelevel=2 Then LoadMusic("Shadow Of The Beast - To The Castle.mp3") 
;(If entitydistance &lt; theshold then play "battle music").
;If musicOn=False     ; if music is off then turn off volume
;	musiclevel#=0
;EndIf

LoadSFX()


;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Global n_c=50
Dim cubes(n_c)

CreateScene()

;create spawn locations to randomly pick from, currently 3.
CreateSpawn(0,12,0,0) ;top of cube
;CreateSpawn(0.07,17,17,0) ;top of cube2
CreateSpawn( 20,10, 20, 45) ; hill1
CreateSpawn(-20,10,-20,-45) ; hill2


Global camera = CreateCamera()
CameraRange camera,0.1,1000

; create our own local player
localPlayerMesh = CreatePlayer(localID,localName)
old_x = EntityX(localPlayerMesh):old_y = EntityY(localPlayerMesh):old_z = EntityZ(localPlayerMesh) ; update camera position

; we send our color to the server
p.player = Object.player(GetPlayer(localID))
;Net_SendMessage(3,p\r + "/" + p\g + "/" + p\b) ;&lt;&lt; doesn't guarantee all players see it properly.
Net_SendMessage(3,p\r + "/" + p\g + "/" + p\b,p\id) ; first to others,
Net_SendMessage(3,p\r + "/" + p\g + "/" + p\b,p\id,pid) ; then to ourselves.

; &lt;&lt;&lt; colored txt mod by Raster Ron..
;store colors for chattxt.
Global cR = p\r 
Global cG = p\g 
Global cB = p\b 
; &lt;&lt;&lt; end colored txt mod by Raster Ron..


; variables used to send our positions at a constant delay (saves bandwidth but makes a constant ping)
Global updatePosition = MilliSecs()
Global updateTick = 50

; chat
Global maxlinelength% = 79
Global messageDisplayNumber = 10
Global messageOffset
Dim message$(messageDisplayNumber)

Global chatMode
Global chatMessage$ = localName + "&gt; "
Global chatMillisecs = MilliSecs()
Global chatCursor

.mainLoop
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
tweeningPeriod = 1000 / gameLogicFPS
tweeningTime = MilliSecs() - tweeningPeriod
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
While Not KeyHit(1)
	
	;; I use tweening from castle demo here :
	;;
	;; 		- this allows to have very fast execution outside the tweening loop,
	;; 		  so the network is updated as fast as possible (needs Flip False)
	;;
	;; 		- this makes the game logic updated at a constant rate (Const FPS=)
	;;		  so no need to set deltatime (and it saves CPU time for other things)
	
	
	;; -------------------------------------------------------------------------------------------------; FAST EXECUTION (outside of tweening)
	;; -------------------------------------------------------------------------------------------------;
	
	; see the function, the interpolation variables are set properly here
	UpdateNetwork()
	
	;; -------------------------------------------------------------------------------------------------;
	
	Repeat
		tweeningElapsed = MilliSecs() - tweeningTime
	Until tweeningElapsed
	tweeningTicks = tweeningElapsed / tweeningPeriod
	tweeningRate# = Float(tweeningElapsed Mod tweeningPeriod)/Float(tweeningPeriod)
	For k = 1 To tweeningTicks
		tweeningTime = tweeningTime + tweeningPeriod
		If k = tweeningTicks Then CaptureWorld
		
		;; ---------------------------------------------------------------------------------------------; MAIN UPDATE
		;; ---------------------------------------------------------------------------------------------;
		
		; update our player
		UpdateLocalPlayer() 
		
		; the interpolation is made in this function
		UpdatePlayers() ;network players and gravity
		
		UpdateWorld()
		
		; update the bullets... only the server checks for player kills
		UpdateBullets()
		
		UpdateHealthItems()
		UpdateChaseCam(camera,localPlayerMesh)
		;; ---------------------------------------------------------------------------------------------;
	Next
	
	RenderWorld tweeningRate
	
	;; -------------------------------------------------------------------------------------------------; 2D UPDATE
	
	DrawPlayersNames()
	DrawHealthItemStrengths()
	
	;; -------------------------------------------------------------------------------------------------;
	; Gereral input checks..
	If ( KeyHit ( 28 ) ) And chatMode = 0 Then chatMode = 1 : FlushKeys() ; Enter key for chat on/off
	If ( KeyHit ( 53 ) ) And chatMode = 0 Then chatMode = 1 ; / comnands &lt;&lt; will result in remembering prev input so not very good!
	If chatMode Then UpdateChat() 
	DrawMessages()
	
	If KeyDown(15) Then DrawScoreTable() ; Tab for scores
	
	If KeyDown(33) Then enableFocus=1-enableFocus : Delay 300 ; F key toggle focus locally.
	If enableFocus=False Then 
		ShowPointer 
	Else
		HidePointer
		MoveMouse(grphicsWidth/2, grphicsHeight/2)
	EndIf
	
	If KeyDown (59) Then ; F1 key for help locally .
		DisplayKeyHelpTxt()
	EndIf
	
	If KeyHit (60)  Then ; F2 change color of local player.
		;Give a random color to our player.
		p\r = Rand(255)
		p\g = Rand(255)
		p\b = Rand(255)
		EntityColor p\mesh,p\r,p\g,p\b
		;p.player = Object.player(GetPlayer(localID))
		Net_SendMessage(3,p\r + "/" + p\g + "/" + p\b) ; send new color to all players..(apparently works ok when in the game)
	EndIf
	
	
	If KeyHit(61) Then ; display player x,y,z (debug)
		NewMessage(" X= "+EntityX(p\mesh)+", Y= "+EntityY(p\mesh)+" ,Z= "+EntityZ(p\mesh))
	EndIf	
	;; -------------------------------------------------------------------------------------------------;
	
	Flip
	
Wend
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

Net_StopNetwork()
End

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function UpdateNetwork()
	
	; update incoming packets (better check ALL incoming messages so use While Wend)
	While Net_CheckMessage() ; will check for a new message and fill Net_MsgType, Net_MsgString$, Net_MsgFrom and Net_MsgTo variables so we can read it
		
		p.player = Object.player(GetPlayer(Net_MsgFrom)) ; get the player handle
		
		If Handle(p) = 0 And Net_MsgType &lt; 100 ; we received an update packet from a player we don't know
			; so we ask the server who he is and return because we can't update him for now
			; the server will resend us the info in a new player "100" message
			Net_RequestPlayer(Net_MsgFrom)
			Return
		EndIf
		
		Select Net_MsgType ; check the type of message
				
			Case 1 ; chat message
				NewMessage(Net_MsgString)
				SoundVolume newlinesnd,.2
				PlaySound(newlinesnd)
				
				
			Case 2 ; player position and angle, example of packing data into string
				;unravel packed string data..
				offset1 = Instr(Net_MsgString,"/",1)
				offset2 = Instr(Net_MsgString,"/",offset1+1)
				offset3 = Instr(Net_MsgString,"/",offset2+1)
				offset4 = Instr(Net_MsgString,"/",offset3+1)
				;offset5 = Instr(Net_MsgString,"/",offset4+1)
				
				p\previousX = p\nextX
				p\previousY = p\nextY
				p\previousZ = p\nextZ
				p\previousYaw = p\nextYaw
				
				p\nextX =  Left(Net_MsgString,offset1-1)
				p\nextY =   Mid(Net_MsgString,offset1+1,offset2-offset1-1)
				p\nextZ =   Mid(Net_MsgString,offset2+1,offset3-offset2-1)
				p\nextYaw = Mid(Net_MsgString,offset3+1,offset4-offset3-1)
				
				;p\nextYaw = Right(Net_MsgString,Len(Net_MsgString)-offset3)
 
				
				p\previousTime = p\nextTime
				p\nextTime = MilliSecs()
				
			Case 21 ; so jump msg has been sent to notify other players so they too can play sound.
				SoundVolume jympsound, .2 ; lower volume as is further away(usually).
				PlaySound (jumpsound) 	
				
				
			Case 3 ; update player colors 
				offset1 = Instr(Net_MsgString,"/",1)
				offset2 = Instr(Net_MsgString,"/",offset1+1)
				
				p\r = Left(Net_MsgString,offset1-1)
				p\g = Mid(Net_MsgString,offset1+1,offset2-offset1-1)
				p\b = Right(Net_MsgString,Len(Net_MsgString)-offset2)
				
				EntityColor p\mesh,p\r,p\g,p\b
				;add bodyparts update here..
				
			Case 4 ; a player fired
				CreateBullet(Net_MsgFrom)
				
			Case 5 ; a player lost some life/health
				p\life = Net_MsgString ; update this players health
				SoundVolume hitsnd, .2
				PlaySound (hitsnd) ;currently disabled for creates unwanted hitsounds..dunno why yet, need to check..
				
			Case 6 ; a player killed another one ( and is out of life)
				k.player = Object.player(GetPlayer(Net_MsgString)) ; killed player ID in MsgData
				NewMessage(p\name + " killed " + k\name)
				SoundVolume deathsnd, .2 
				PlaySound (deathsnd) ;die sound is started. 
				Delay 100
				;ResetPlayer(k\id)
				
			Case 61 ; player died due to another reason
				;SoundVolume deathsnd, .2 
				;PlaySound (deathsnd) ;die sound is started. 
				;Delay 100
				
				
			Case 7 ; the server sends us score update for a player
				offset = Instr(Net_MsgString,"/",1)
				p\kills = Left(Net_MsgString,offset-1)
				p\deaths = Right(Net_MsgString,Len(Net_MsgString)-offset)
				
			Case 8 ; health pickup
				h.health = Object.health(Net_MsgString)
				HideEntity h\mesh
				h\pickupTime = MilliSecs()
				h\visible=False
				
			Case 81	
				SoundVolume pwr, .2 
				PlaySound (pwr) ; pwrup sound is started when collected.
				
			Case 82 ; fully restored health
				i.player = Object.player(GetPlayer(Net_MsgString)) ; killed player ID in MsgData
				NewMessage(i\name + " fully restored health!" ) ;&lt;&lt;&lt;
				SoundVolume fullhealth, .2 
				PlaySound (fullhealth)	
				
			Case 83 ; pickup health nogo(full already)	
				SoundVolume pickupnogo, .2 
				PlaySound (pickupnogo)
				
			Case 9 ; player spawn 
				SpawnPlayer(p\id,Net_MsgString)	
				; play reborn sound here?
				
				
				
				
				
				
				
					
				
			;Net managing stuff here..	
			Case 100 ; new player connected, OR the server tells us who is already connected so we can create players when joining the game..
				If localMode = 2 ; if = server..
					For p.player = Each player ;
						Net_SendMessage(2,p\nextX + "/" + p\nextY + "/" + p\nextZ + "/" + p\nextYaw,p\id,Net_MsgFrom)
						Net_SendMessage(3,p\r + "/" + p\g + "/" + p\b,p\id,Net_MsgFrom)
						
						Net_SendMessage(5,p\life,p\id,Net_MsgFrom)
						Net_SendMessage(7,p\kills+"/"+p\deaths,p\id,Net_MsgFrom)
					Next
				EndIf
				
				NewMessage(Net_MsgString + " connected")
				CreatePlayer(Net_MsgFrom,Net_MsgString)
				
			Case 101 ; a player has quit..
				For p.player = Each player
					If Net_MsgFrom = p\id
						NewMessage(p\name + " disconnected")
						FreeEntity p\mesh
						Delete p
					EndIf
				Next
				
			Case 102 ; host has changed..
				For p.player = Each player
					If Net_MsgFrom = p\id
						If p\id = localID
							AppTitle("Server : " + localName + " (port:" + net_port + ")")
							NewMessage("You are the new host")
							localMode = 2
						Else
							NewMessage(p\name + " is the new host")
						EndIf					
					EndIf
				Next
				
			Case 103 ; ping update..
				For p.player = Each player
					If Net_MsgFrom = p\id
						p\ping = Net_MsgString
					EndIf
				Next
				
		End Select
		
	Wend
	
End Function

Function CollisionCheck()
	For p.player = Each player 
		
		If CountCollisions(p\mesh)
			
			If localMode = 2
				If GetEntityType(CollisionEntity(p\mesh,1)) = 2  ; so if collided with another player
					touchedPlayer.player = Object.player(EntityName(CollisionEntity(p\mesh,1))) ; find out who it was that collided with player.
					
					If touchedPlayer\life &lt; p\life Then; compare who's the stronger of the 2.
						
						;push the other player.
						
					EndIf
					
				EndIf	
			EndIf
			
		EndIf
	Next	
	
End Function


;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function UpdateLocalPlayer()  
	
	
	; UPDATE LOCAL PLAYER..
	p.player = Object.player(GetPlayer(localID)) ; get our local player id..
	
	; check inputs.. 	(note: needs to be replaced by circular algorithm..)
	
	If Not chatMode
		; movements
		If WK_DOWN ( ) Or UP_KDOWN    ( ) Then ; up key
			MoveEntity p\mesh,0,0,0.3  
		EndIf
		
		If SK_DOWN ( ) Or DOWN_KDOWN  ( ) Then ; down key
			MoveEntity p\mesh,0,0,-0.3 
		EndIf
		
		If AK_DOWN ( ) Or LEFT_KDOWN  ( ) Then ; left key
			TurnEntity p\mesh,0,3,0    
		EndIf
		
		If DK_DOWN ( ) Or RIGHT_KDOWN ( ) Then ; right
			TurnEntity p\mesh,0,-3,0   
		EndIf
		
		
		; jump
		If  ( KeyHit ( 57 ) ) Or ( MouseHit ( 2 ) )  ; right mse or Spacebar
			
			; check if player is on the ground
			LinePick(EntityX(p\mesh),EntityY(p\mesh),EntityZ(p\mesh),0,-1.2,0)
			;If PickedEntity() ;so if picked an entiry underneath so on some sort of ground/object..
			targetentity= PickedEntity()
			If targetentity&lt;&gt;0 ;so if picked an entiry underneath so on some sort of ground/object..
				p\velocityY = 0.5 ; set "inverse" of gravity velocity, so can jump.
				
				; play jump sound locally..
				SoundVolume jympsound, .5
				PlaySound (jumpsound) ;jump sound is started, but only for local player. (sound volume should be set here to medium)
				Net_SendMessage(21,"") ; notify other players a jump has taken place

				
			EndIf	
		EndIf
		
		
		; fire
		;If LM_DOWN ( )  ; left mouse down
		If enableRapidFire=True ; use keydown for keyscan..
			If ( KeyDown( 157 ) ) Or ( KeyDown( 29 ) )  Or ( MouseDown ( 1 ) ); left mouse down
				Net_SendMessage(4,"") ; notify other players a shot has been fired.
				CreateBullet(localID)
			EndIf
		Else ; use keyhit for keyscan..
			If ( KeyHit( 157 ) ) Or ( KeyHit( 29 ) )  Or ( MouseHit ( 1 ) ) ; left mouse hit
				Net_SendMessage(4,"") ; notify other players a shot has been fired.
				CreateBullet(localID)
			EndIf
		EndIf
		
		If KeyHit(19) Then enableRapidFire=1-enableRapidFire: Delay 300 ; R key, for debug purposes(beats typing), needs to be disabled and exist as chat cheat command only.
	
		If KeyHit(35)Then ;H=health
			p\life = 100 
			NewMessage(p\name + " fully restored health! " ); &lt;&lt; on server only(so local)
			SoundVolume fullhealth,.2
			PlaySound (fullhealth)
			Net_SendMessage(82,p\id) ; notify non local players too, so they can play sound.
			Net_SendMessage(5,p\life,p\id)
			Net_SendMessage(5,p\life,p\id,p\id)
		EndIf	
	
	EndIf
	
	
	
	; we create a message Type "2" For player position..
	If MilliSecs()-updatePosition &gt; updateTick ; 
		; sent the position and jumpstatus over the network so other players can adjust/act accordingly..
		Net_SendMessage(2,EntityX(p\mesh) + "/" + EntityY(p\mesh) + "/" + EntityZ(p\mesh) + "/" + EntityYaw(p\mesh)+ "/" ) 
		updatePosition = MilliSecs()
	EndIf	
	
	
		
End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function UpdatePlayers()
	
	For p.player = Each player ; check all players..
	
		If p\id &lt;&gt; localID ; ; UPDATE ALL *NON-LOCAL* PLAYERS(server &amp; clients)..
			
			;; LINEAR INTERPOLATION ;;;;;;;;;;
			If p\nextTime &lt;&gt; p\previousTime ; if both packets arrived at the same time, we can't interpolate
				curTime# = Float(MilliSecs()-p\nextTime) / Float(p\nextTime-p\previousTime) ; curTime will be ideally 0.0-1.0, if it's &gt; 1.0 then it performs extrapolation
				If curTime &gt; 1 Then curTime = 1 ; extrapolation gives anoying jittering effects
				; special fix for yaw as EntityYaw returns a value beetween +180 ans -180, the interpolation can go backward
				If p\previousYaw &lt; 0 Then p\previousYaw = p\previousYaw + 360
				If p\nextYaw &lt; 0 Then p\nextYaw = p\nextYaw + 360
				If Abs(p\nextYaw-p\previousYaw) &gt; 180
					If p\nextYaw &gt; p\previousYaw
						p\previousYaw = p\previousYaw + 360
					Else
						p\previousYaw = p\previousYaw - 360
					EndIf
				EndIf
				
				
				
				;******* new! move entity when we have more health..*******
				;If localMode = 2 ; &lt;&lt; so when is server..
					
	;				If CountCollisions(p\mesh) Then ; so if collided
				
	;					If GetEntityType ( CollisionEntity(p\mesh,1) ) = 2  ; so if collided with another player(type2)
	;						touchedPlayer.player = Object.player(EntityName(CollisionEntity(p\mesh,1))) ; find out who it was that collided with player.
	;						If touchedPlayer\life &lt; p\life Then ; see if the  other player is weaker..
	;							NewMessage( "my healthpower= " + p\life + " is more than " + touchedPlayer\name +"'s healthpower= " + touchedPlayer\life )
	;							;push the other player aside.
	;							TranslateEntity touchedPlayer\mesh,EntityX(touchedPlayer\mesh)-EntityX(p\mesh),0,EntityZ(touchedPlayer\mesh)-EntityZ(p\mesh)
	;							Net_SendMessage(2,EntityX(touchedPlayer\mesh) + "/" + EntityY(touchedPlayer\mesh) + "/" + (EntityZ(touchedPlayer\mesh)) + "/" + EntityYaw(touchedPlayer\mesh)+ "/" ) 
	;						EndIf
	;						
	;					EndIf
	;					;ResetEntity p\mesh						
	;				EndIf	
				;EndIf
				;**********************************************************
				
				
				;update player position..
				PositionEntity p\mesh,p\previousX+(p\nextX-p\previousX)*curTime,p\previousY+(p\nextY-p\previousY)*curTime,p\previousZ+(p\nextZ-p\previousZ)*curTime
				RotateEntity p\mesh,0,p\previousYaw+(p\nextYaw-p\previousYaw)*curTime,0
			Else ; so if p\nextTime = p\previousTime then no interpolation possible.
				
				;update player position..
				PositionEntity p\mesh,p\nextX,p\nextY,p\nextZ
				RotateEntity p\mesh,0,p\nextYaw,0
			EndIf
			
			
			;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
			
		Else ; So if p\id = localID  thus update (local) player (it being servers or client) stuff. 
			 ; (Can't be combined with other local player stuff, for will somehow make jumping bit more laggy??)
			
			
			
			; basically below just computes gravity for the local player. Actual positions will be updated across other player next loop. 
            ;[if done outside this loop(so at update local player) then jumping is more jurkey??]
			
			p\velocityY = p\velocityY - 0.03 ; increase gravity (wherever we are)by substracting every time when passing by in this loop.
			
			pick=LinePick(EntityX(p\mesh),EntityY(p\mesh),EntityZ(p\mesh),0,-2,0)
			If pick=0 Then ; so no surface underneath
				fall=fall+1 ;falling is true, start measuring distance.
				;NewMessage( "fall= " + fall ) ;debug
			EndIf
			
			If EntityY(p\mesh) - p\currentY &gt;= 0 Then; but if player is not falling(or not anymore, for entity's Ypos-currentY do not differ).. 
				If p\velocityY &lt; -0.03 Then p\velocityY = -0.03 ; we limit the gravity to normal values.
				
				;check fall height..
				If fall&gt;15 And fall&lt;130 Then ; if heigh but not too high to be fatal..
					p\life=p\life-(Int(fall/3.65*9.8)) ; reduce healthlife with falling height
					If p\life&gt;0 Then ;so when still has life to spare..
						;NewMessage(" Ouch! | fall= " +fall + "| p\life= "+ p\life)  ; debug
						SoundVolume hitsnd, .8
						hitchannel = PlaySound (hitsnd)
						; notify non local players too, so they can adjust healthdisplay and play sound.
						;Net_SendMessage(type,message$="",sender=0,recipient=0)
						Net_SendMessage(5,p\life,p\id) ; first send to others,
						Net_SendMessage(5,p\life,p\id,p\id) ; then also notify ourself to make sure all's updated.
					ElseIf p\life&lt;= 0 ; so if no life to spare.. 
						NewMessage(" Aargh! ") ; +fall)
						SoundVolume deathsnd, .8
						hitchannel = PlaySound (deathsnd)
						RandomSpawn(p\id)
					EndIf	
					
				ElseIf	fall&gt;500 Then ;in case of gfx error and endles fall occurs
					;NewMessage(" Aargh! "+fall)
					SoundVolume deathsnd, .8
					hitchannel = PlaySound (deathsnd)
					NewMessage(p\name + " killed himself for some reason.. " )
					RandomSpawn(p\id)
					
				EndIf	
				fall=0 ;reset fall counter.
			EndIf
			
			p\currentY = EntityY(p\mesh)
			TranslateEntity p\mesh,0,p\velocityY,0
			
		EndIf
		
		
		
		
		
	Next
	
End Function



Function playerCollisionTest()
	
	;******* new! move entity when we have more health..*******
	
	p.player = Object.player(GetPlayer(localID)) ; get our local player id..
	
	If CountCollisions(p\mesh) Then ; so if collided with anything
		
		If GetEntityType ( CollisionEntity(p\mesh,1) ) = 2  ; so if collided with another player(type2)
			touchedPlayer.player = Object.player(EntityName(CollisionEntity(p\mesh,1))) ; find out who it was that collided with player.
			If touchedPlayer\life &lt; p\life Then ; see if the  other player is weaker..
				NewMessage( "my healthpower= " + p\life + " is more than " + touchedPlayer\name +"'s healthpower= " + touchedPlayer\life )
				;push the other player aside.
				TranslateEntity touchedPlayer\mesh,EntityX(touchedPlayer\mesh)-EntityX(p\mesh),0,EntityZ(touchedPlayer\mesh)-EntityZ(p\mesh)
				Net_SendMessage(2,EntityX(touchedPlayer\mesh) + "/" + EntityY(touchedPlayer\mesh) + "/" + (EntityZ(touchedPlayer\mesh)) + "/" + EntityYaw(touchedPlayer\mesh)+ "/" ) 
			EndIf
			
			;update player position..
			;PositionEntity p\mesh,p\previousX+(p\nextX-p\previousX)*curTime,p\previousY+(p\nextY-p\previousY)*curTime,p\previousZ+(p\nextZ-p\previousZ)*curTime
			;RotateEntity p\mesh,0,p\previousYaw+(p\nextYaw-p\previousYaw)*curTime,0
			
		EndIf
		;ResetEntity p\mesh						
	EndIf	
	;**********************************************************
	
	
End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function CreatePlayer(id,name$)
	
	For p.player = Each player
		If p\id = id Then Return ; player already connected
	Next
	
	p.player = New player
	p\id = id
	p\name = name
	
	
	;build player entity
	p\mesh = CreateSphere()
	
	NameEntity p\mesh,Handle(p)
	
	nose = CreateSphere(8,p\mesh):EntityColor nose,255,0,0
	PositionEntity nose,0,0,1
	ScaleEntity nose,0.3,0.3,0.3
	
	eyeLeft = CreateSphere(8,p\mesh):EntityColor eyeLeft,255,255,255
	PositionEntity eyeLeft ,.29,.4,.7;1
	ScaleEntity eyeLeft ,0.2,0.2,0.2
	
	pupilLeft = CreateSphere(8,p\mesh):EntityColor pupilLeft ,0,0,0
	PositionEntity pupilLeft ,.3,.4,.9;1
	ScaleEntity pupilLeft ,0.05,0.05,0.02
	
	eyeRight = CreateSphere(8,p\mesh):EntityColor eyeRight ,255,255,255
	PositionEntity eyeRight ,-.29,.4,.7;1
	ScaleEntity eyeRight ,0.2,0.2,0.2
	
	pupilRight = CreateSphere(8,p\mesh):EntityColor pupilRight ,0,0,0
	PositionEntity pupilRight ,-.3,.4,.9;1
	ScaleEntity pupilRight ,0.05,0.05,0.02
	
	unaBrow = CreateCone(8,1,p\mesh):EntityColor unaBrow ,0,0,0
	PositionEntity unaBrow ,0,.45,.7
	RotateEntity unaBrow ,-180,0,0
	ScaleEntity unaBrow ,.7,.2,.3
	
	
	
	;Give a random color to our player.
	p\r = Rand(255)
	p\g = Rand(255)
	p\b = Rand(255)
	EntityColor p\mesh,p\r,p\g,p\b
	
	r=p\r
	g=p\g
	b=p\b
	;create arms &amp; hands.,
	upperArmLeft = CreateSphere(8,p\mesh):EntityColor upperArmLeft,150,150,150 ; ,r,g,b
	PositionEntity upperArmLeft ,0.9,0.2,.2
	RotateEntity upperArmLeft ,0,0,20
	ScaleEntity upperArmLeft ,0.2,0.4,0.2
	
	lowerArmLeft = CreateSphere(8,p\mesh):EntityColor lowerArmLeft,150,150,150 ; ,r,g,b
	PositionEntity lowerArmLeft ,0.9,-.1,.45
	RotateEntity lowerArmLeft ,0,15,20
	ScaleEntity lowerArmLeft ,0.2,0.2,0.4
	
	handLeft = CreateSphere(8,p\mesh):EntityColor handLeft,255,255,255
	PositionEntity handLeft ,.7,-.1,.7
	RotateEntity handLeft ,0,15,20
	ScaleEntity handLeft ,0.22,0.22,0.22



	upperArmRight = CreateSphere(8,p\mesh):EntityColor upperArmRight ,150,150,150
	PositionEntity upperArmRight ,-0.9,0.2,.2
	RotateEntity upperArmRight ,0,0,-20
	ScaleEntity upperArmRight ,0.2,0.4,0.2
	
	lowerArmRight = CreateSphere(8,p\mesh):EntityColor lowerArmRight ,150,150,150
	PositionEntity lowerArmRight ,-0.9,-.1,.45
	RotateEntity lowerArmRight ,0,-15,-20
	ScaleEntity lowerArmRight ,0.2,0.2,0.4
	
	handRight = CreateSphere(8,p\mesh):EntityColor handRight ,255,255,255
	PositionEntity handRight ,-.7,-.1,.7
	RotateEntity handRight ,0,15,-20
	ScaleEntity handRight ,0.22,0.22,0.22

	
	
	; create a simple gun..
	gunHandle = CreateCube(p\mesh):EntityColor gunHandle ,70,70,70
	PositionEntity gunHandle ,.6,-.2,1
	ScaleEntity gunHandle ,0.07,0.3,0.1
	RotateEntity gunHandle ,0,20,20
	
	gun = CreateCube(p\mesh):EntityColor gun,70,70,70
	PositionEntity gun,.5,.2,1
	ScaleEntity gun ,0.07,.12,0.7
	RotateEntity gun ,0,20,20
	
	
	
	EntityType p\mesh,2
	;EntityRadius p\mesh,1.2,1.0
	EntityRadius p\mesh,1.0

	
	;start at one of our random spawn positions.
	RandomSpawn(p\id)	
	
	
	Return p\mesh
	
End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function SpawnPlayer(id,spawnId)
	
	p.player = Object.player(GetPlayer(id))
	
	For s.spawn = Each spawn
		If s\spawnId = spawnId Then Exit
	Next
	
	p\life = 80 ;start off slightly unhealthy..
	
	p\nextX = s\x
	p\nextY = s\y
	p\nextZ = s\z
	p\nextYaw = s\yaw
	
	p\previousX = p\nextX
	p\previousY = p\nextY
	p\previousZ = p\nextZ
	p\previousYaw = p\nextYaw
	
	PositionEntity p\mesh,p\nextX,p\nextY,p\nextZ
	RotateEntity p\mesh,0,p\nextYaw,0
	ResetEntity p\mesh
	
	p\currentY = p\nextY
	
	p\previousTime = MilliSecs()
	p\nextTime = MilliSecs()+1
	;is this heard on local and networked playerside?
	SoundVolume appearsnd, .5
	PlaySound (appearsnd)
	
End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function RandomSpawn(id)
	
	p.player = Object.player(GetPlayer(id))
	
	; if we are the server, spawn player at random location
	If localMode = 2
		randSpawn = Rand(1,spawns)
		SpawnPlayer(p\id,randSpawn)
		Net_SendMessage(9,randSpawn,p\id)
		Net_SendMessage(9,randSpawn,p\id,p\id)
	Else ; else default spawn 
		SpawnPlayer(p\id,1)

	EndIf
	
End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function CreateSpawn(x#,y#,z#,yaw#)
	
	spawns = spawns + 1
	
	s.spawn = New spawn
	s\spawnId = spawns
	s\x = x
	s\y = y
	s\z = z
	s\yaw = yaw
	
End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function GetPlayer(id)
	; return the handle of the player stored in the field item\id
	
	For p.player = Each player
		If p\id = id
			Return Handle(p)					
		EndIf
	Next
	
End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function DrawPlayersNames()
	
	For p.player = Each player
		If EntityVisible (p\mesh,camera)
			
			Color 255,255,255
			CameraProject(camera,EntityX(p\mesh),EntityY(p\mesh),EntityZ(p\mesh)) 	
			
			
			If p\id &lt;&gt; localID Then Text ProjectedX(),ProjectedY()-60,p\name,1,1 ; only draw players name when not the localplayer
            ; the more health, the brighter the txt color..
			Color 255,(255./100.)*p\life,(255./100.)*p\life ;
			Text ProjectedX(),ProjectedY()-40,p\life,1,1
		EndIf
	Next
	
End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function DrawHealthItemStrengths()
	
	For h.health = Each health
		If EntityVisible (h\mesh,camera)
			Color 255,0,0
			CameraProject(camera,EntityX(h\mesh),EntityY(h\mesh),EntityZ(h\mesh)) 
			
			Color 255,(255./100.)*h\power,(255./100.)*h\power
			If MilliSecs() - h\pickupTime &gt; h\respawnDelay Then ;ShowEntity h\mesh only when it's spawn time has passed..
				Text ProjectedX(),ProjectedY()-35,h\power,1,1
			EndIf
		EndIf
	Next
	
End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function CreateBullet(id)
	; this will create a bullet
	
	p.player = Object.player(GetPlayer(id)) ; tie the shooter's id to the bullit..
	b.bullet = New bullet
	b\id = p\id
	
	b\mesh = CreateSphere(2)
	ScaleEntity b\mesh,0.2,0.2,0.2
	EntityColor b\mesh,255,255,0
	
	PositionEntity b\mesh,EntityX(p\mesh),EntityY(p\mesh),EntityZ(p\mesh)
	RotateEntity b\mesh,0,EntityYaw(p\mesh),0
	
	MoveEntity b\mesh,0,0,2 ; so can't hit own player or little less easy..(no sure fix)
	EntityType b\mesh,3
	EntityRadius b\mesh,0.2
	
	SoundVolume shoot, .5
	shootchannel = PlaySound (shoot) ;shooting sound is started.
	
	b\time = MilliSecs()
	
End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function UpdateBullets() 
	
	For b.bullet = Each bullet
		
		MoveEntity b\mesh,0,0,1.5 ; increase speed so player can't outrun bullets and hit himself easily(unless someth weird happens..)
		
		If CountCollisions(b\mesh)
			
			If localMode = 2 ; so when is server. only the server compute bullets collision with player
				
				If GetEntityType(CollisionEntity(b\mesh,1)) = 2 
					
					touchedPlayer.player = Object.player(EntityName(CollisionEntity(b\mesh,1)))
					
					;selfhit detection..
					killerPlayer.player = Object.player(GetPlayer(b\id)) ; whodunnit? get id of player tied to bullit..
					If touchedPlayer.player &lt;&gt; killerPlayer.player
						touchedPlayer\life = touchedPlayer\life - 10 ; reduce health when hit.
					;Else
						;NewMessage( "Debugmsg: Player only hit himself, no loss though. ;-)" ) ; 
					EndIf
				
				
					If touchedPlayer\life &gt; 0 ; touched and still has health to spare..
						Net_SendMessage(5,touchedPlayer\life,touchedPlayer\id) ; notify about life reduction
						Net_SendMessage(5,touchedPlayer\life,touchedPlayer\id,touchedPlayer\id) 
						SoundVolume hitsnd, .8
						hitchannel = PlaySound (hitsnd)
											
					Else ; killed (all out of health)
						;boomchannel = PlaySound (boom) ;boom sound is started.
						SoundVolume deathsnd,.8
						PlaySound (deathsnd) ;die sound is started(local)
						Delay 100
						;killerPlayer.player = Object.player(GetPlayer(b\id)) ; redundant now..
						
						killerPlayer\kills = killerPlayer\kills + 1
						touchedPlayer\deaths = touchedPlayer\deaths + 1						
						
												
						Net_SendMessage(6,touchedPlayer\id,killerPlayer\id)  ;notify others that a player killed another one.
						Net_SendMessage(6,touchedPlayer\id,killerPlayer\id,killerPlayer\id)
						
						;send score update for a player
						Net_SendMessage(7,killerPlayer\kills+"/"+killerPlayer\deaths,killerPlayer\id) 
						Net_SendMessage(7,killerPlayer\kills+"/"+killerPlayer\deaths,killerPlayer\id,killerPlayer\Id)
						
						Net_SendMessage(7,touchedPlayer\kills+"/"+touchedPlayer\deaths,touchedPlayer\id)
						Net_SendMessage(7,touchedPlayer\kills+"/"+touchedPlayer\deaths,touchedPlayer\id,touchedPlayer\id)
						
						NewMessage(killerPlayer\name + " killed " + touchedPlayer\name)
						RandomSpawn(touchedPlayer\id)
											
 					
						;ResetPlayer(touchedPlayer\id) ;&lt;&lt;
					EndIf
						
					
				EndIf
				
			EndIf
			
			FreeEntity b\mesh
			Delete b
			
		ElseIf MilliSecs()-b\time &gt; 2000
			
			FreeEntity b\mesh
			Delete b
			
		EndIf
		
	Next
	
End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function CreateHealthItem(x#,y#,z#,power#,respawnDelay#)
	
	h.health = New health
	
	h\mesh = CreateMesh()
	
	h\power = power ; set item strength
	
	;h\respawnDelay = 10000
	h\respawnDelay = respawnDelay ; set according to valuableness(strength actually)..
	
	; create the object..
	mesh1 = CreateCube()
	mesh2 = CreateCube()
	
	ScaleMesh mesh1,.20,.5,.20
	ScaleMesh mesh2,.20,.5,.20:RotateMesh mesh2,90,0,0
	
	AddMesh(mesh1,h\mesh)
	AddMesh(mesh2,h\mesh)
	
	EntityColor h\mesh,255,0,0
	
	
	If localMode = 2 Then EntityType h\mesh,4 ; if we are the host then set entitytype to 4..
	EntityRadius h\mesh,0.5
	
	PositionEntity h\mesh,x,y,z
	
	NameEntity h\mesh,Handle(h) ; store the handle(h) in name of the entity.

End Function




;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function UpdateHealthItems()
	
	For h.health = Each health ; check all health items..
		
		TurnEntity h\mesh,0,-2,0 ; spin around and around and around.
		
		If localMode = 2 And GetEntityType(h\mesh) &lt;&gt; 4 ;If we are the HOST and entitytype is not 4..
			EntityType h\mesh,4 ; set to 4 
			EntityRadius h\mesh,0.5
		EndIf
		
		If CountCollisions(h\mesh)
			
			If localMode = 2 ; only the server computes collision with player
				If GetEntityType(CollisionEntity(h\mesh,1)) = 2 ; a player collided
					
					touchedPlayer.player = Object.player(EntityName(CollisionEntity(h\mesh,1)))
					
					h\pickupTime = MilliSecs()
					HideEntity h\mesh
					h\visible = False
					ResetEntity h\mesh
					
					Net_SendMessage(8,Handle(h))  ; update health item?
					
					If touchedPlayer\life &lt; 100 ; touched healthpowerup and not fully charged..
						touchedPlayer\life = touchedPlayer\life + h\power ;add healthpowerup strenght of the healthitem to touched players life.
						Net_SendMessage(81,touchedPlayer\id) ; notify non local players too, so they can play sound.
						
						If touchedPlayer\life &gt;100 Or touchedPlayer\life=100
							touchedPlayer\life = 100;  so can't exceed 100%
							;
							NewMessage(touchedPlayer\name + " fully restored health! " ); &lt;&lt; on server only(so local)
							SoundVolume fullhealth,.2
							PlaySound (fullhealth)
							
							Net_SendMessage(82,touchedPlayer\id) ; notify non local players too, so they can adjust healthdisplay and play sound.
							
							
						EndIf
						
						Net_SendMessage(5,touchedPlayer\life,touchedPlayer\id)
						Net_SendMessage(5,touchedPlayer\life,touchedPlayer\id,touchedPlayer\id)
						pwrchannel = PlaySound (pwr) ; pwrup sound is started locally when collected. 
						
						;
					Else	
						pickupchannel = PlaySound (pickupnogo) ; pickup sound is started when collected and already full.
						; notify other players here so can play sound too?. - not interesting
						Net_SendMessage(83,touchedPlayer\id) ; notify non local players too, so they can adjust healthdisplay and play sound.
						
					EndIf
					
				EndIf
				
				; sound for non-localmode(so clients) here..
				
			EndIf
			
		EndIf
		
		If MilliSecs() - h\pickupTime &gt; h\respawnDelay And h\visible = False
			ShowEntity h\mesh ; show entity when spawn time passed,,
			If firsttimehealth=False
				pwrchannel = PlaySound (pwrappear) ; appear sound is started when h\mesh appears
			EndIf
			h\visible= True
		EndIf
	Next
	
End Function


;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;


;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function NewMessage(msg$)
	
	; this routine checks and updates the message buffer.
	messageOffset = messageOffset + 1
	
	If messageOffset &gt; messageDisplayNumber
		
		messageOffset = messageOffset - 1
		
		For i = 2 To messageDisplayNumber
			message(i-1) = message(i)		
		Next
		
		message(messageDisplayNumber) = msg
		
	Else
		
		message(messageOffset) = msg
		
	EndIf
	
End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function DrawMessages()
	
	; this routine does the actual on screen drawing of the chat..
	
	Color 255,255,255
	
	For i = 1 To messageOffset
		
		;Text 0,(i-1)*15,message(i)	
		
		; &lt;&lt;&lt; colored txt mod by Raster Ron
		loc = Instr (message(i), "¿",1)
		If loc &gt; 1 Then 
			colorMessage$ = Mid$(message(i), 1, Len(message(i)) - 7 ) 
			Hex$ = Right$(message(i),6)		 
			Set_Color_Hex(Hex$) 
			Text 0,(i-1)*15,colorMessage$ 
		Else  
			Color 255,255,255 
			Text 0,(i-1)*15,message(i) 
		End If	
		; &lt;&lt;&lt; End colored txt mod by Raster Ron
		
	Next
	
End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function UpdateChat()
	
	; this routine does the input check..
	key = GetKey()
	If key
		
		PlaySound(typesnd)
		If key = 13 ;carriage return, so entered, msgline finished.
			PlaySound(newlinesnd)
			; &lt;todo:  Also let other players here the ping snd to attract their attention.
			
			If chatMessage &lt;&gt; localName + "&gt; " ; so msg is larger than the prompt.
				
				If Len(chatMessage) &gt; maxlinelength-(Len(localName)+2)  ; so exceeds max line length
					chatMessage = Left$(chatMessage,maxlinelength) ; so ignoring all surpassing max chars.
				EndIf	
				
				
				For i = Len(localName + "&gt; ") To Len(chatMessage) ;check all characters from afte name+promtsign to end of msg..
					If Mid(chatMessage,i,1) &lt;&gt; " " ; trap all spaces input, so no empty jibberish..
						
						
						; '/' commands..
						
						
						If Mid(chatMessage,i,1) = "/"  ; check for the command trigger '/' if so, go into command mode..
							
							;check 2nd part(command) &lt;&lt; later to be done from data statements holding all commands..
							If Mid(chatMessage,i+1,5) = "kick " ; if at $location name+promptsign+/+5 chars= "kick "
								playerToBeKickedName$ = Mid(chatMessage,i+6, Len(chatMessage) )    ;
						
								For p.player = Each player ; check each player
									If p\name = playerToBeKickedName$  ;so only if playername exists..
									
										If localMode = 2 ; only the host/server can kick/ban players..(ban not requires keeping a dbase).
											If playerToBeKickedName$ &lt;&gt; localName$ ; so host is not kicking himself.
												
												chatMessage=playerToBeKickedName$ + " has been kicked by host! "
												;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
												; &lt;&lt;&lt; colored txt mod by Raster Ron
												chatColor$ = RGB_To_TriHex(cR,cG,cB)
												chatMessage = chatMessage + "¿" + chatColor$
												;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
																					
												
												Net_SendMessage(1,chatMessage) ; send msg to all.
												Net_KickPlayer(playerToBeKickedName$) 
									
											Else 
												NewMessage( "-Selfkicking not allowed.. ") ; display msg.
											EndIf
											
										;ElseIf localMode = 3 ; moderator &lt;&lt; to be introduced into code stil..	
											;moderator commands go here.
												
										Else ; so  localMode &lt;&gt; 2 or 3 ;so no server/host or moderator..
											;Net_SendMessage(1,"") ; send msg to all.
											NewMessage( "-Kicking not allowed for non-admins.. ") ; display msg.
										EndIf
										;Exit
									EndIf
								Next
								
							; other commands..	list, changetype(only allowed by host, can create moderator), wizz(unlimited ammo/health etc).	
							ElseIf Mid(chatMessage,i+1,5) = "list" ; if at $location name+promptsign+/+5 chars= "list"
								
								NewMessage( "Players:" ) ; display msg.
								NewMessage( "--------" ) ; display msg.
								For p.player = Each player ; check each player
									lst=lst+1
									playerList$=lst + ". Name: " + p\name + " | ID: " +  p\id + " | Ping: " + p\ping 
									NewMessage( playerList$ ) ; display msg.
									
									;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
									; &lt;&lt;&lt; colored txt mod by Raster Ron
									;chatColor$ = RGB_To_TriHex(cR,cG,cB)
									;chatMessage = chatMessage + "¿" + chatColor$
									;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
									
								Next
								Lst=0
								; count players
								For n.net_client = Each net_client
									Lst = Lst + 1	
									CID = n\ID
									CName = n\name
									CIP=DottedIP$(n\IP)
									CPort= n\port			
									clientList$=Lst + ". Name: " + CName + " | ID: " +  CID+ " | Port: " + CPort + " | IP:   " + CIP  
									
									NewMessage( clientList$ ) ; display msg.
								Next
								
								
							ElseIf Mid(chatMessage,i+1,10) = "rapidfire" ; 
								enableRapidFire=1-enableRapidFire
								If enableRapidFire=True
									statusMsg$="Rapid Fire Enabled!" 
								Else
									statusMsg$="Rapid Fire Disabled!" 
								EndIf
								NewMessage( statusMsg$ ) ; display msg.
							EndIf
							
							
							
							
						Else ; so if not in command mode.
							;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
							; &lt;&lt;&lt; colored txt mod by Raster Ron
							chatColor$ = RGB_To_TriHex(cR,cG,cB)
							chatMessage = chatMessage + "¿" + chatColor$
							;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
					
							Net_SendMessage(1,chatMessage) ; send msg to all.
							NewMessage(chatMessage)        ; put in the msg buffer for display on screen.
											
						EndIf	; 
						
						Exit	
							
					EndIf ; trap all spaces input, so no empty jibberish..
				Next ;check all characters from afte name+promtsign to end of msg..
			EndIf ;chatMessage &lt;&gt; localName + "&gt; " 
			
			chatMessage = localName + "&gt; "
			chatMode = 0
			
			
		ElseIf key = 8 And Len(chatMessage) &gt; Len ( localName + "&gt; " ) ; backspace and msg length longer then..
			chatMessage = Left(chatMessage,Len(chatMessage)-1) ; reduce lenght of msg with 1.
			
		ElseIf key &gt; 31 And key &lt; 127 ; if msg is valid range between 'US'(unit separator) and 'DEL' , so from 'SPACE' to '~'
			chatMessage = chatMessage + Chr(key)
			
		EndIf ;key = 
	EndIf ;key
	
	Color 255,255,255
	Rect 0,GraphicsHeight()-20,GraphicsWidth(),20,1
	Color 0,0,0
	Rect 0,GraphicsHeight()-20,GraphicsWidth(),20,0
	
	
	If MilliSecs()-chatMillisecs &gt; 500
		chatCursor = Not chatCursor
		chatMillisecs = MilliSecs()
	EndIf
	
	If chatCursor
		Text 5,GraphicsHeight()-17,chatMessage + "|"
	Else
		Text 5,GraphicsHeight()-17,chatMessage
	EndIf
	FlushKeys ; prevent space etc to be tranfered to the game, makingh player jump etc.
End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function DrawScoreTable()
	
	For p.player = Each player
		count = count + 1
	Next
	
	baseX = (GraphicsWidth()-350)/2
	baseY = (GraphicsHeight()-(35+20*count))/2
	
	Color 0,0,0
	Rect baseX,baseY,350,35+20*count,1
	
	Color 255,192,0
	Rect baseX,baseY,350,35+20*count,0
	
	Text baseX+10,baseY+10,"Player          Kills     Deaths     Ping"
	Line baseX,baseY+25,baseX+349,baseY+25
	
	For p.player = Each player
		
		Color 255,255,255
		If p\id = localID Then Color 255,100,100
		
		i = i + 1
		Text baseX+10,baseY+10+20*i,p\name
		Text baseX+157,baseY+10+20*i,p\kills,1,0
		Text baseX+240,baseY+10+20*i,p\deaths,1,0
		Text baseX+322,baseY+10+20*i,p\ping,1,0
	Next
	
End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function UpdateChaseCam(camera,player) ; thanks to jfk EO-11110 on bb forums for this function !
	PositionEntity camera,EntityX(player,1),EntityY(player,1),EntityZ(player,1)
	ResetEntity camera
	x#=EntityX(player)+Sin(-EntityYaw(player)+180)*x_dis#
	y#=EntityY(player)+y_dis#
	z#=EntityZ(player)+Cos(-EntityYaw(player)+180)*z_dis#
	obstacle=LinePick(EntityX(player),EntityY(player),EntityZ(player),(x-EntityX(player)),y_dis#,(z-EntityZ(player)),0.1)
	If obstacle=0
		new_x#=x
		new_y#=y
		new_z#=z
	Else
		new_x#=PickedX()
		new_y#=PickedY()
		new_z#=PickedZ()
	EndIf
	If bounce_cam=0
		PositionEntity camera,new_x,new_y,new_z
	Else
		x=old_x+((New_x-old_x)/bounce_div#)
		y=old_y+((New_y-old_y)/bounce_div#)
		z=old_z+((New_z-old_z)/bounce_div#)
		PositionEntity camera,x,y,z
	EndIf
	PointEntity camera,player
	TurnEntity camera,-20,0,0     ; if you want the player mesh more on the bottom of the screen
	old_x#=EntityX(camera)
	old_y#=EntityY(camera)
	old_z#=EntityZ(camera)
End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function CreateScene()
	
	texture = TextureCreate(128)
	
	ground = CreatePlane()
	EntityColor ground,150,150,150
	EntityTexture ground,texture
	NameEntity ground, "ground"
	
	;cube with ramp and rounded top.
	cube = CreateCube():EntityColor cube,150,200,150
	ScaleEntity cube,5,5,5:PositionEntity cube,0,5,0
	EntityTexture cube,texture
	
	sphere = CreateSphere(16):EntityColor sphere,200,150,150
	ScaleEntity sphere,3,1,3:PositionEntity sphere,0,9.7,0
	
	platform = CreateCube():EntityColor platform,150,150,200
	ScaleEntity platform,3,1,10:PositionEntity platform,0,4.13,-13.15
	TurnEntity platform,-30,0,0
	EntityTexture platform,texture
	
	
	
	;cube2 with ramp and rounded top.
	cube2 = CreateCube():EntityColor cube2,150,150,200
	ScaleEntity cube2,5,8,5:PositionEntity cube2,0,8,17
	EntityTexture cube2,texture
	
	sphere2 = CreateSphere(16):EntityColor sphere2,150,200,200
	ScaleEntity sphere2,3,1,3:PositionEntity sphere2,0,15.5,17
	
	platform2 = CreateCube():EntityColor platform2,150,200,150
	ScaleEntity platform2,3,1,16:PositionEntity platform2,0,7.15,-19.55+54.9
	TurnEntity platform2,-30,180,0
	EntityTexture platform2,texture
	
	
	
	
	;cube3 with ramp and rounded top.
	cube3 = CreateCube():EntityColor cube3,150,150,200
	ScaleEntity cube3,5,1,5:PositionEntity cube3,6.5,25,6.5
	EntityTexture cube3,texture
	
	sphere3 = CreateSphere(16):EntityColor sphere3,150,200,200
	ScaleEntity sphere3,3,1,3:PositionEntity sphere3,6.5,25.5,6.5
	
	platform3 = CreateCube():EntityColor platform3, 200,100,100            
	ScaleEntity platform3,3,1,19:PositionEntity platform3,24.3,12,6.5
	TurnEntity platform3,-45,90,0
	EntityTexture platform3,texture
	
	
	;cube4 with ramp and rounded top.
	cube4 = CreateCube():EntityColor cube4, 250,250,150
	ScaleEntity cube4,5,1,5:PositionEntity cube4,-6.5,20,6.5
	EntityTexture cube4,texture
	
	sphere4 = CreateSphere(16):EntityColor sphere4,150,200,200
	ScaleEntity sphere4,3,1,3:PositionEntity sphere4,-6.5,20.5,6.5
	
	platform4 = CreateCube():EntityColor platform4,100,100,200
	ScaleEntity platform4,3,1,15:PositionEntity platform4,-21.3,10,6.5
	TurnEntity platform4,45,90,0
	EntityTexture platform4,texture
	
	
	
	
	; spawn locations
	spawner1 = CreateSphere() :EntityColor spawner1 ,150,150,150;  &lt;&lt;&lt;&lt;
	ScaleEntity spawner1 ,2,3,2:PositionEntity spawner1 ,-20,.1,-20 ;&lt;&lt;&lt;&lt;
	EntityTexture spawner1 ,texture
	
	column= CreateCylinder()
	ScaleEntity column,2,3,2:PositionEntity column,20,.1,20 ;&lt;&lt;&lt;&lt;
	EntityTexture column,texture
	
	FreeTexture texture
	
	
	; some test walls. ;
	; PLEASE NOTE: extreme low poly objects like big cubes don't work well with
	; directX point lights: the light simply doesn't get enough vertices to obtain a good "grip" on the
	; normals. To illustrate this you may use the CreateCube command instead (see a few lines below).
	;Global n_c=10
	;Dim cubes(n_c)
	;polys=10
	;For i=0 To n_c
	;	cubes(i)=CreateSphere(polys)
	;	PositionEntity cubes(i), Rnd(-100,100),0,Rnd(-100,200)
	;	ScaleEntity cubes(i),1,10,Rand(4,10)
	;	RotateEntity cubes(i),0,Rand(360),0
	;	EntityColor cubes(i),Rand(255),Rand(255),Rand(255)
	;	EntityPickMode cubes(i),2
	;	UpdateNormals cubes(i)
	;	EntityType cubes(i),type_world
	;Next
	
	
	;polys=10
    ;length = 50;
    ;angle = 0.0;
    ;angle_stepsize = 360/n_c;
	;For i= 0 To n_c/2 
	;	
	;    x = length * Cos (angle);
    ;    z = length * Sin (angle);
	;	cubes(i)=CreateSphere(polys)
	;	PositionEntity cubes(i), x+Rnd(-100,100),0,z+Rnd(-100,100)
	;	
	;   ScaleEntity cubes(i),1,10,Rand(4,10)
	;	RotateEntity cubes(i),0,Rand(360),0
	;	EntityColor cubes(i),Rand(255),Rand(255),Rand(255)
	;	EntityPickMode cubes(i),2
	;	UpdateNormals cubes(i)
	;	EntityType cubes(i),1
	;
	;angle = angle+ angle_stepsize;
	;Next
	
	
		
	
	; Collision types &amp; pick mode definitions..
	EntityType ground,1:EntityPickMode ground,2
	EntityType cube,1:EntityPickMode cube,2
	EntityType sphere,1:EntityPickMode sphere,2
	EntityType platform,1:EntityPickMode platform,2
	
	EntityType cube2,1:EntityPickMode cube2,2
	EntityType sphere2,1:EntityPickMode sphere2,2
	EntityType platform2,1:EntityPickMode platform2,2
	
	EntityType cube3,1:EntityPickMode cube3,2
	EntityType sphere3,1:EntityPickMode sphere3,2
	EntityType platform3,1:EntityPickMode platform3,2
	
	EntityType cube4,1:EntityPickMode cube4,2
	EntityType sphere4,1:EntityPickMode sphere4,2
	EntityType platform4,1:EntityPickMode platform4,2
	
	
	
	EntityType spawner1,1:EntityPickMode spawner1,2
	EntityType column,1:EntityPickMode column,2
	
	
	
	; setup light..
	light = CreateLight()
	TurnEntity light,30,70,0
	
	; create health upgrade items.
	
	CreateHealthItem(0     ,1  ,-10  ,10 , 10000) ; undenneath the ramp
	CreateHealthItem(0     ,3  ,-20  ,30 , 30000) ; on the ramp
   ;CreateHealthItem(0     ,12 ,0    ,100, 50000) ; the one on top
	CreateHealthItem(0.07  ,17 ,17   ,100, 50000) ; top of cube2
	firsttimehealth=True
	
	;; COLLISIONS
	Collisions 2,1,2,3 ; player to scene , 3= slide2 - prevent entities from sliding down slopes  
	
	;Collisions 2,2,1,3 ; player to player
	Collisions 2,2,1,1 ; player to player , 1= stop 

	
	Collisions 3,1,2,1 ; bullet to scene
	Collisions 3,2,1,1 ; bullet to player
	
	Collisions 2,4,1,2 ; player to health , 2= slide1 - full sliding collision 
	
End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function TextureCreate(size)
	texture = CreateTexture(size,size,9)
	SetBuffer TextureBuffer(texture)
	Color 255,255,255
	Rect 0,0,size,size,1
	Color 0,0,0
	Rect 0,0,size,size,0
	Line 0,0,size,size
	Line 0,size,size,0
	SetBuffer BackBuffer()
	Return texture
End Function


;======================================================================================
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function LoadSFX()
	
	
	
	; movements
	;------------------------------
	;run = LoadSound ("sounds\gravel.wav")
	;wade = LoadSound ("sounds\water.wav")
	;SoundVolume run, 0
	;SoundVolume wade, 0
	;LoopSound run
	;LoopSound wade
	;runchannel = PlaySound (run)
	;wadechannel = PlaySound (wade)
	
	;divesnd=LoadSound( "sounds\Asthma_Sound.wav_10720.wav" ) ; diving (uh) sound
	;SoundVolume uh, .9
	
	
	jumpsound=LoadSound( "sounds\boing.wav" ) ; jumping (oink)sound
	SoundVolume jumpsound, .9	
	
	
	; health
	;------------------------------	
	hitsnd=LoadSound( "sounds\bump1.wav" )     ; hit (ugh) sound
	SoundVolume hitsnd, .8
	
	;deathsnd=LoadSound("sounds\CUICA1.WAV" )   ; die (woehh) sound
	deathsnd=LoadSound("sounds\deathmod.wav" )  ; die sound
	
	appearsnd=LoadSound("sounds\XCMAKERS.WAV") ; player(haoooh) reappears sound
	
	
	; items
	;------------------------------	
	
	pickupnogo=LoadSound( "sounds\click1.wav" ) ; pick up nogo health(doorclank) sound
	SoundVolume pickupnogo, .9  
	
	
	; health
	;------------------------------	
	pwrappear =  LoadSound( "sounds\mtruc.wav" ) ; healing item appear(ploc) sound
	SoundVolume pwrappear , .8  
	
	pwr=LoadSound( "sounds\belltree.wav" )       ; healing (triiing) sound
	SoundVolume pwr, .8  
	
	fullhealth=LoadSound ( "sounds\happy.wav" )  ; fullhealthrestored sound
	SoundVolume pwr, .8 
	
	
	
	
	; weaponary
	;------------------------------
	
	shoot=LoadSound( "sounds\shoot.wav" ) ; shooting(laser) sound
	SoundVolume shoot, .5
	
	boom=LoadSound( "sounds\boom.wav" ) ; explosion sound
	SoundVolume boom, .8
	
	; enemies 
	;------------------------------	
	;bark = LoadSound("sounds\bark.wav")
	;SoundVolume bark, .5
	;barkChannel = PlaySound (bark) ;barking sound is started.
	
	
	typesnd= LoadSound("sounds\gui_type.wav")
	SoundVolume typesnd, .8 
	newlinesnd=LoadSound("sounds\typewriterbell.wav")
	SoundVolume newlinesnd, .8 
	
End Function

Function LoadMusic(files$)
	
;	bgmusic = LoadSound (files$)
;	SoundVolume bgmusic,.5 
;	LoopSound bgmusic
;	bgmusicChannel= PlaySound (bgmusic)
	
;	dangermusic = LoadSound ("Shadow Of The Beast - Aarbronsrevenge.mp3")
;   SoundVolume dangermusic,0
;   LoopSound dangermusic
;	dangermusicChannel= PlaySound(dangermusic)
	
End Function

Function DisplayKeyHelpTxt()
	xcor=30	
	Text GraphicsWidth/2+xcor*2, 10+ycor,"                *** Multiplayer Example Help ***               "
	Text GraphicsWidth/2+xcor*2, 20+ycor," ------------------------------------------------------------- " 
	Text GraphicsWidth/2+xcor*2, 35+ycor," Game Controls                          | In Chat mode         " 	
	Text GraphicsWidth/2+xcor*2, 50+ycor," ------------------------------------------------------------- " 	
	Text GraphicsWidth/2+xcor*2, 65+ycor," Move            : Cursor / WASD        | Command prefix :'/'  " 
	Text GraphicsWidth/2+xcor*2, 80+ycor," Jump            : Space  / Right mouse | e.g:                 "
	Text GraphicsWidth/2+xcor*2, 95+ycor," Shoot           : Ctrl   / Left  mouse | /kick &lt;playername&gt;   "  
	Text GraphicsWidth/2+xcor*2,110+ycor," ---------------------------------------| /list                "  
	Text GraphicsWidth/2+xcor*2,125+ycor," Score           : Tab                  |                      "
    Text GraphicsWidth/2+xcor*2,140+ycor," Focus (toggle)  : F                    | (Also to be used for "
	Text GraphicsWidth/2+xcor*2,155+ycor," Chat            : Enter                | cheats such as       "
	Text GraphicsWidth/2+xcor*2,170+ycor," Help(this text) : F1                   | 'rapidfire')         " 
	Text GraphicsWidth/2+xcor*2,185+ycor," Player color    : F2                   |                      " 
	Text GraphicsWidth/2+xcor*2,200+ycor," Player x,y,z    : F3                   |                      " 	
	Text GraphicsWidth/2+xcor*2,215+ycor," Exit            : Esc                  |                      " 
	Text GraphicsWidth/2+xcor*2,230+ycor," ------------------------------------------------------------- " 
	
End Function
</textarea><br><br>But I'm now onto adding a <b>new ability</b> for the players in <b>V1.72.0</b>; <br><br><i>- The ability to push another player around by contact(so mainly over the x,z axis)when the player's health value is higher(stronger) than that of the other health value(weaker) player. -</i><br><br>I managed to have it working already, so could push weaker players off a ramp/platform etc, but it somehow influenced an entirely different function of the game: for suddenly when the player launched a bullet, it returned an error from the push collision check function, saying: "Entity does not exists".<br><br>So all is working fine(running, pushing, falling) for as long as the player doesn't try to shoot anyone, while this used to work fine, until I introduced the pushing code into the UpdatePlayers() function.<br><br><br>New archive with above mentioned source and executables, library and media included: <a href="http://www.mediafire.com/download/sluzhnxid1i11zz/V1.12_-_Share_17-05-2016.rar" target="_blank"><b>&lt;download here&gt;</b></a> <br><br></td></tr></table><br>
<a name="1307078"></a>

<a name="1307141"></a>

<a name="1307142"></a>

<a name="1307143"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#172">[#172]</a></td></tr></table></td></tr><tr ><td class="posttext"> Update:<br>Added <b>stronger player pushing weaker player</b> function. Caution: pushing someone along requires energy. :-)<br>Slightly changed: made p/life into a float, easier calculating, saves an additional variable.<br><br><b>V1.72.4</b><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; *** ROADMAP/HISTORY ***
;
; ADDED SO FAR: 
; -chattext colors matched to playercolors.
; -different health strengths and spawn times.
; -hide entities names when one player cannot see each other(so can play hide&amp;seek)..
; -different health item strengths, which are also displayed above the 
;  item and take time to become available again depending on strenght.
; -fixes to keybd input and window focus.
; -sound fx(quicky, needs more work).
;
; UPDATE 29-04-2016:
; -lock/unlock mse + hud.focus to window switch 'f'.
; -F1=help.
; -F2=change player color on the fly.
; -rapidfire toggle command.
; 
; UPDATE 12-05-2016:
; V1.66 fixed friendly fire bug.(no more shooting yourself in the foot, stommach or whatever :-)
; V1.66.2 correctly displaying msg+snd.
; V1.69.2:
; -Added 2nd (and higher) ramp to fall and die from.
; -F3=display current player coords.
;
; V1.69.3:
; -fixed bug where chat held onto keys that would turn into player controls after submit.e.g. space=jump.
; -Temporary disabled health loss when falling ability.
; -Changed death sound, fixed all sounds to play local and on networked players, 
;  added typwrittersounds for chat(only Local) and submit snd on network to attract attention.
;  only 1 audio bug remaining: producing hit sound while actually collecting an item or when player(client)
;  gets introduced into game (unclear why).
;
; V1.69.5(14-05-2016): 
; -fixed fall bug aka (when enabled 'health loss when falling ability' it works, but also kills the player when running down a ramp)
;
; V1.70.0(14-05-2016):
; -Fixed bugs: health inacuracies. color at start always displaying ok on players.
; 
; V1.72.4(21-05-2016):
; -Added push player function. Caution: pushing someone requires energy. :-)
;
;
; TODO UPTO VERSION 2.0 (not nesacerrily in this order, all using procedural gfx, without ext libs/media, except sound):
; -delay timer for after death..reintroducing player into game+anim stars rotating above head, if dead squased char.
; -bullit hit impact response
; -test w gf, flanker or others. ;-) 
; -scorch marks on hit objects.
; -fps /tps switch.
; -weapon upgrades.
; -collectable coins&lt; take/kill all=winner.  
; -push each other ability.
; -'/' cheatmodes and additional commands.
; -flashlight,freelook + day nightcycle.
; -add moving platforms demo code.
; -game music. playing more exited when near an enemy.
; -robo players with simple ai.
; -gui with saveable prefs.
; -simple animated chars.
; -ladder climbing/crouching.
; -walking, running and sounds to match.
; -superjump powerup.
; -shields.
; -jumping pads.
; -teleportation.
; -weather conditions. 
; 
;
; TODO FOR VERSION 3.0 (more advanced, incorporating media and ext libs):
; -move to stayne's level.
; -3d animated chars.
; -AlienBreed 3d characters?
; -Special effects, doors, etc.
; -Vehicals/terrian.
; -PhysX.
; -Shadows.

; KNOWN BUGS:
; -producing hit sound while actually collecting or when player(client) gets introduced into game /health reduction when introduced into game.
; 
SeedRnd MilliSecs()

Const gameLogicFPS = 60

Global enableFocus=True  ; lock mouse to screen and hide pointer 'f' key toggles locked/unlocked mode.
Global enableRapidFire=False  ; 'r' key toggles normal/rapidfire mode.

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; first we include the KeyFix library
Include "KeyFix_Constants.bb"
; we now include the network library
Include "UDPNetwork_lib.bb"
; for converting RGB values to "Tri-Hex" stringc inlude hex8.
Include "Hex8.bb" ;&lt;&lt;&lt; Colored txt mod by Raster Ron 

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Global localID ; the id of the current local player. (figures..)

;original code..
;Global localName$ = Input("Enter your name : ")
;If localName = "" Then localName = "player" + Rand(100,999)

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;&lt;&lt; Enter through mod..(for ease of use)
Global localName$ = "", defaultName$ = "RCX" ; My own pre-defined username, so just need to press enter to save typing ;-) 
;change above username to your own liking.

Print "Change default name: '"+ defaultName$ +"' ?"
Choic$ = Input$("[Press [Y]es or [ENTER] for No: ")
If Choic$="y" Then ; so want to change..
	Cls:Locate 0,0
	Print "Type name &amp; press [ENTER] or"
	ChangeName$=Input$("just [ENTER] to autogenerate: ")
	If ChangeName$="" ; so pressed enter to autogen..
		localName = "player" + Rand(100,999)
	Else ; so entered a new name..
		localName$=ChangeName$
	EndIf
Else ; so entered without input.
	localName$ = defaultName$
EndIf
;&lt;&lt;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Global localPlayerMesh , ground

Type player
	Field id
	Field name$
	Field ping
	Field ip
	
	Field life#  ;float
	Field kills  ;integer
	Field deaths ;integer
	
	Field mesh
	Field r,g,b
	
	Field nextX#,nextY#,nextZ#
	Field previousX#,previousY#,previousZ#
	Field nextYaw#
	Field previousYaw#
	Field nextTime
	Field previousTime
	
	Field lastPacket
	
	Field currentY#
	Field velocityY#
	
	Field jumped
	
End Type

Type bullet
	Field mesh
	Field angle#
	Field time
	Field id ; id of player who fired
End Type

Type health
	Field mesh
	Field pickupTime ; to store when was pickedup and can hide for a certain time set in 
	Field respawnDelay ; &lt; see above
	Field visible
	Field power ; to hold strength of upgrade
	;Field id ; id of player who collected
End Type

Type spawn
	Field spawnId
	Field x#,y#,z#
	Field yaw#
End Type

Global spawns ; number of spawn points
Global firsttimehealth=True
Global firsttime=True
Global falling=False, highFall=False, tooHighFall=False,maxReachedVelocityY#=0.0, fall=0



;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Camera code from jfk EO-11110, thanks
Global bounce_cam=1 ;  smooth camera motion? (0/1)
Global bounce_div#=10.0 ; the higher, the more sluggish the camera will follow. Recc: 3.0 to 20.0
; some globals used by ChaseCam
Global old_x#,old_y#,old_z#
; desired distance between camera and player mesh
Global x_dis#=7.0,y_dis#=3,z_dis#=7.0,y_dis_or#=y_dis#


;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

; network init ----------------------------------------;
Global localMode = Net_StartInput() ; bring the library "console" to connect

If localMode = 1 Or localMode = 2 ; 1 means we are client, 2 means we are server
	
	localID = Net_CreatePlayer(localName) ; this command inits the server or local client
	
	If localID = 0 ; error
		Net_StopNetwork() ; close the network properly
		RuntimeError("Failed to create player.")
	EndIf
	
	If localMode = 1 Then AppTitle("Client : " + localName + " (port:" + net_port + "/ ID=" + localID +" / IP= "+ net_ip+ ")                   [F1] = Help!    [F] = Mouse (un)lock ")
	If localMode = 2 Then AppTitle("Server : " + localName + " (port:" + net_port + "/ ID=" + localID +" / IP= "+ net_ip+ ")                   [F1] = Help!    [F] = Mouse (un)lock ")
	 
Else ; error
	Net_StopNetwork()
	RuntimeError("Failed to start game.")
EndIf
;------------------------------------------------------;
grphicsWidth = 640
grphicsHeight= 480
Graphics3D grphicsWidth ,grphicsHeight,32,2
SetBuffer BackBuffer()

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; audio
Global musicOn=False, musiclevel#=.5, danger=False												 ;music 
Global bgmusic_vol#=.5, bgmusicChannel, bgmusic 
Global dangermusic_vol#=0, dangermusicChannel, dangermusic     		     			             ;music

Global wade_vol#, run_vol#, wadechannel, runchannel , shootchannel, boomchannel, pwrchannel	     ;player sfx
Global shoot, boom, uh, pwr, pwrappear, fullhealth, pickupnogo , pickupchannel ,jumpchannel, jumpsound , hitsnd, hitchannel   
Global deathsnd, appearsnd, typesnd,newlinesnd

;Game music
;If gamelevel=1 Then LoadMusic("spacepanic.mp3") ; load gamemusic
;If gamelevel=2 Then LoadMusic("Shadow Of The Beast - To The Castle.mp3") 
;(If entitydistance &lt; theshold then play "battle music").
;If musicOn=False     ; if music is off then turn off volume
;	musiclevel#=0
;EndIf

LoadSFX()


;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Global n_c=50
Dim cubes(n_c)

CreateScene()

;create spawn locations to randomly pick from, currently 3.
CreateSpawn(0,12,0,0) ;top of cube
;CreateSpawn(0.07,17,17,0) ;top of cube2
CreateSpawn( 20,10, 20, 45) ; hill1
CreateSpawn(-20,10,-20,-45) ; hill2


Global camera = CreateCamera()
CameraRange camera,0.1,1000

; create our own local player
localPlayerMesh = CreatePlayer(localID,localName)
old_x = EntityX(localPlayerMesh):old_y = EntityY(localPlayerMesh):old_z = EntityZ(localPlayerMesh) ; update camera position

; we send our color to the server
p.player = Object.player(GetPlayer(localID))
;Net_SendMessage(3,p\r + "/" + p\g + "/" + p\b) ;&lt;&lt; doesn't guarantee all players see it properly.
Net_SendMessage(3,p\r + "/" + p\g + "/" + p\b,p\id) ; first to others,
Net_SendMessage(3,p\r + "/" + p\g + "/" + p\b,p\id,pid) ; then to ourselves.

; &lt;&lt;&lt; colored txt mod by Raster Ron..
;store colors for chattxt.
Global cR = p\r 
Global cG = p\g 
Global cB = p\b 
; &lt;&lt;&lt; end colored txt mod by Raster Ron..


; variables used to send our positions at a constant delay (saves bandwidth but makes a constant ping)
Global updatePosition = MilliSecs()
Global updateTick = 50
Global interpol=True

; chat
Global maxlinelength% = 79
Global messageDisplayNumber = 10
Global messageOffset
Dim message$(messageDisplayNumber)

Global chatMode
Global chatMessage$ = localName + "&gt; "
Global chatMillisecs = MilliSecs()
Global chatCursor

.mainLoop
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
tweeningPeriod = 1000 / gameLogicFPS
tweeningTime = MilliSecs() - tweeningPeriod
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
While Not KeyHit(1)
	
	;; I use tweening from castle demo here :
	;;
	;; 		- this allows to have very fast execution outside the tweening loop,
	;; 		  so the network is updated as fast as possible (needs Flip False)
	;;
	;; 		- this makes the game logic updated at a constant rate (Const FPS=)
	;;		  so no need to set deltatime (and it saves CPU time for other things)
	
	
	;; -------------------------------------------------------------------------------------------------; FAST EXECUTION (outside of tweening)
	;; -------------------------------------------------------------------------------------------------;
	
	; see the function, the interpolation variables are set properly here
	UpdateNetwork()
	
	;; -------------------------------------------------------------------------------------------------;
	
	Repeat
		tweeningElapsed = MilliSecs() - tweeningTime ; delay/synch..
	Until tweeningElapsed
	tweeningTicks = tweeningElapsed / tweeningPeriod
	tweeningRate# = Float(tweeningElapsed Mod tweeningPeriod)/Float(tweeningPeriod)
	For k = 1 To tweeningTicks
		tweeningTime = tweeningTime + tweeningPeriod
		If k = tweeningTicks Then CaptureWorld  ;'captures' properties (position, rotation, scale, alpha etc) of each entity in the 3D world. 
		
		
		;; ---------------------------------------------------------------------------------------------; MAIN UPDATE
		;; ---------------------------------------------------------------------------------------------;
		
		; update our player
		UpdateLocalPlayer() 
				 
		; the interpolation is made in this function
		UpdatePlayers() ;network players and gravity
		
		UpdateWorld() ;Animates all entities in the world, and performs collision checking. 

		PlayerToPlayerCollisionUpdate(); player to player
		

		UpdateBullets()	; update the bullets... only the server checks for player kills
		
		UpdateHealthItems()
		UpdateChaseCam(camera,localPlayerMesh)
		
		;; ---------------------------------------------------------------------------------------------;
	Next
	
	RenderWorld tweeningRate	;Renders the current scene to the BackBuffer onto the rectangle defined by each cameras CameraViewport( ). 
								;Every camera not hidden by HideEntity( ) or with a CameraProjMode( ) of 0 is rendered.
								;The optional tween parameter should only be specified when RenderWorld is used in conjunction with 
								;CaptureWorld which is used to store the 'old' position, rotation and scale, alpha and colour of each entity 
								;in the game world. A tween value of &lt; 1 will interpolate between these 'old' values and the 'current' ones. 
								;A tween value of 0 will render all entities at their state when CaptureWorld was last called, 
								;and a tween value of 1 will render all entities at their current state. 
								;
								;The use of tweening allows you To render more than one frame per game logic update, 
								;While still keeping the display smooth. This allows you To cut down on the CPU time that would be required 
								;to update your game logic every render.  
	
	
	;; -------------------------------------------------------------------------------------------------; 2D UPDATE
	
	DrawPlayersNames()
	DrawHealthItemStrengths()
	
	;; -------------------------------------------------------------------------------------------------;
	; Gereral input checks..
	
	;chat related..
	If ( KeyHit ( 28 ) ) And chatMode = 0 Then chatMode = 1 : FlushKeys() ; Enter key for chat on/off
	If ( KeyHit ( 53 ) ) And chatMode = 0 Then chatMode = 1 ; / comnands &lt;&lt; will result in remembering prev input so not very good!
	If chatMode Then UpdateChat() 
	DrawMessages() 
	
	If KeyDown(15) Then DrawScoreTable() ; Tab for scores
	
	If KeyDown(33) Then enableFocus=1-enableFocus : Delay 300 ; F key toggle focus locally.
	If enableFocus=False Then 
		ShowPointer 
	Else
		HidePointer
		MoveMouse(grphicsWidth/2, grphicsHeight/2)
	EndIf
	
	If KeyDown (59) Then ; F1 key displays help locally.
		DisplayKeyHelpTxt()
	EndIf
	
	If KeyHit (60)  Then ; F2 changes color of local player and send netmsg to other players to update too.
		;Give a random color to our player.
		p\r = Rand(255)
		p\g = Rand(255)
		p\b = Rand(255)
		EntityColor p\mesh,p\r,p\g,p\b
		;p.player = Object.player(GetPlayer(localID))
		Net_SendMessage(3,p\r + "/" + p\g + "/" + p\b) ; send new color to all players..(apparently works ok when in the game).
	EndIf
	
	
	If KeyHit(61) Then ; F3 displays player x,y,z (debug).
		NewMessage(" X= "+EntityX(p\mesh)+", Y= "+EntityY(p\mesh)+" ,Z= "+EntityZ(p\mesh))
	EndIf	
	;; -------------------------------------------------------------------------------------------------;
	
	Flip
	
Wend
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

Net_StopNetwork()
End

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function UpdateNetwork() ; Handle network messages(events)..
	
	; Basically goes through msg's and performs requested action. 
	
	; update incoming packets (better check ALL incoming messages so use While Wend)
	While Net_CheckMessage() ; will check for a new message and fill Net_MsgType, Net_MsgString$, Net_MsgFrom and Net_MsgTo variables so we can read it
		
		p.player = Object.player(GetPlayer(Net_MsgFrom)) ; get the player handle
		
		If Handle(p) = 0 And Net_MsgType &lt; 100 ; we received an update packet from a player we don't know
			; so we ask the server who he is and return because we can't update him for now
			; the server will resend us the info in a new player "100" message
			Net_RequestPlayer(Net_MsgFrom)
			Return
		EndIf
		
		Select Net_MsgType ; check the type of message
				
			Case 1 ; chat message
				NewMessage(Net_MsgString)
				SoundPlay(newlinesnd,.2)
				
			Case 2 ; player position and angle, example of packing data into string
				;unravel packed string data..
				offset1 = Instr(Net_MsgString,"/",1)
				offset2 = Instr(Net_MsgString,"/",offset1+1)
				offset3 = Instr(Net_MsgString,"/",offset2+1)
				offset4 = Instr(Net_MsgString,"/",offset3+1)
				;offset5 = Instr(Net_MsgString,"/",offset4+1)
				
				p\previousX = p\nextX
				p\previousY = p\nextY
				p\previousZ = p\nextZ
				p\previousYaw = p\nextYaw
				
				p\nextX =  Left(Net_MsgString,offset1-1)
				p\nextY =   Mid(Net_MsgString,offset1+1,offset2-offset1-1)
				p\nextZ =   Mid(Net_MsgString,offset2+1,offset3-offset2-1)
				p\nextYaw = Mid(Net_MsgString,offset3+1,offset4-offset3-1)
				
				;p\nextYaw = Right(Net_MsgString,Len(Net_MsgString)-offset3)
 
				
				p\previousTime = p\nextTime
				p\nextTime = MilliSecs()
				
			Case 21 ; so jump msg has been sent to notify other players so they too can play sound.
				SoundPlay(jympsound,.2) ; lower volume as is further away(usually).
				
			Case 3 ; update player colors 
				offset1 = Instr(Net_MsgString,"/",1)
				offset2 = Instr(Net_MsgString,"/",offset1+1)
				
				p\r = Left(Net_MsgString,offset1-1)
				p\g = Mid(Net_MsgString,offset1+1,offset2-offset1-1)
				p\b = Right(Net_MsgString,Len(Net_MsgString)-offset2)
				
				EntityColor p\mesh,p\r,p\g,p\b
				;add bodyparts update here..
				
			Case 4 ; a player fired
				CreateBullet(Net_MsgFrom)
				
			Case 5 ; a player lost some life/health
				p\life = Net_MsgString ; update this players health
				SoundPlay(hitsnd,.2)
				
				
			Case 6 ; a player killed another one ( and is out of life)
				k.player = Object.player(GetPlayer(Net_MsgString)) ; killed player ID in MsgData
				NewMessage(p\name + " killed " + k\name)
				SoundPlay(deathsnd,.2) ;die sound is started.
				Delay 100
				;ResetPlayer(k\id)
				
			Case 61 ; player died due to another reason(not used yet)
				;SoundPlay(deathsnd,.2) ;die sound is started
				;Delay 100
				
				
			Case 7 ; the server sends us score update for a player
				offset = Instr(Net_MsgString,"/",1)
				p\kills = Left(Net_MsgString,offset-1)
				p\deaths = Right(Net_MsgString,Len(Net_MsgString)-offset)
				
				
			Case 8 ; health pickup
				h.health = Object.health(Net_MsgString)
				HideEntity h\mesh
				h\pickupTime = MilliSecs()
				h\visible=False
				
			Case 81	
				SoundPlay(pwr,.2) ; pwrup sound is started when collected.
				
			Case 82 ; fully restored health
				i.player = Object.player(GetPlayer(Net_MsgString)) ; killed player ID in MsgData
				NewMessage(i\name + " fully restored health!" ) ;&lt;&lt;&lt;
				SoundPlay(fullhealth,.2)
				
			Case 83 ; pickup health nogo(full already)	
				SoundPlay(pickupnogo,.2)
				
			Case 9 ; player spawn 
				SpawnPlayer(p\id,Net_MsgString)	
				; play reborn sound here?
				
				
				
				
			;Net managing stuff here..	
			Case 100 ; new player connected, OR the server tells us who is already connected so we can create players when joining the game..
				If localMode = 2 ; if = server..
					For p.player = Each player ;
						Net_SendMessage(2,p\nextX + "/" + p\nextY + "/" + p\nextZ + "/" + p\nextYaw,p\id,Net_MsgFrom)
						Net_SendMessage(3,p\r + "/" + p\g + "/" + p\b,p\id,Net_MsgFrom)
						
						Net_SendMessage(5,p\life,p\id,Net_MsgFrom)
						Net_SendMessage(7,p\kills+"/"+p\deaths,p\id,Net_MsgFrom)
					Next
				EndIf
				
				NewMessage(Net_MsgString + " connected")
				CreatePlayer(Net_MsgFrom,Net_MsgString)
				
			Case 101 ; a player has quit..
				For p.player = Each player
					If Net_MsgFrom = p\id
						NewMessage(p\name + " disconnected")
						FreeEntity p\mesh
						Delete p
					EndIf
				Next
				
			Case 102 ; host has changed..
				For p.player = Each player
					If Net_MsgFrom = p\id
						If p\id = localID
							AppTitle("Server : " + localName + " (port:" + net_port + ")")
							NewMessage("You are the new host")
							localMode = 2
						Else
							NewMessage(p\name + " is the new host")
						EndIf					
					EndIf
				Next
				
			Case 103 ; ping update..
				For p.player = Each player
					If Net_MsgFrom = p\id
						p\ping = Net_MsgString
					EndIf
				Next
				
		End Select
		
	Wend
	
End Function

Function PlayerToPlayerCollisionUpdate() ; 
	
	For p.player = Each player 
		
		If CountCollisions(p\mesh)
			
				If GetEntityType(CollisionEntity(p\mesh,1)) = 2  ; so if collided with another player
					touchedPlayer.player = Object.player(EntityName(CollisionEntity(p\mesh,1))) ; find out who it was that collided with player.
					
					If touchedPlayer\life &lt; p\life Then; compare who's the stronger of the 2.
						
						;push the other player(move difference between 2 players devided by speedfactor*10, so will slow down while pushing as it requires strenght to push.
						TranslateEntity touchedPlayer\mesh,(EntityX(touchedPlayer\mesh)-EntityX(p\mesh))/30,0,(EntityZ(touchedPlayer\mesh)-EntityZ(p\mesh))/30
						Net_SendMessage(2,EntityX(touchedPlayer\mesh) + "/" + EntityY(touchedPlayer\mesh) + "/" + (EntityZ(touchedPlayer\mesh)) + "/" + EntityYaw(touchedPlayer\mesh)+ "/" ) 
						;if p\life &gt;0
						p\life=p\life-.1 ; pushing requires strength.
						Net_SendMessage(5,p\life,p\id) ; first send to others,
						Net_SendMessage(5,p\life,p\id,p\id) ; then also notify ourself to make sure all's updated.	
					EndIf
					
				EndIf	
			
		EndIf
	Next	
	

	
End Function


;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function UpdateLocalPlayer()  
	
	
	; UPDATE LOCAL PLAYER..
	p.player = Object.player(GetPlayer(localID)) ; get our local player id..
	
	; check inputs.. 	(note: needs to be replaced by circular algorithm..)
	
	If Not chatMode
		; movements
		If WK_DOWN ( ) Or UP_KDOWN    ( ) Then ; w/up key
			MoveEntity p\mesh,0,0,0.3  
		EndIf
		
		If SK_DOWN ( ) Or DOWN_KDOWN  ( ) Then ; s/down key
			MoveEntity p\mesh,0,0,-0.3 
		EndIf
		
		If AK_DOWN ( ) Or LEFT_KDOWN  ( ) Then ; a/left key
			TurnEntity p\mesh,0,3,0    
		EndIf
		
		If DK_DOWN ( ) Or RIGHT_KDOWN ( ) Then ; d/right
			TurnEntity p\mesh,0,-3,0   
		EndIf
		
		
		; jump
		If  ( KeyHit ( 57 ) ) Or ( MouseHit ( 2 ) )  ; Right MouseButton /Spacebar
			
			; check if player is on the ground
			LinePick(EntityX(p\mesh),EntityY(p\mesh),EntityZ(p\mesh),0,-1.2,0)
			;If PickedEntity() ;so if picked an entiry underneath so on some sort of ground/object..
			targetentity= PickedEntity()
			If targetentity&lt;&gt;0 ;so if picked an entiry underneath so on some sort of ground/object..
				p\velocityY = 0.5 ; set "inverse" of gravity velocity, so can jump.
				
				; play jump sound locally..
				SoundPlay(jympsound,.5) ; play sound with volume set to medium
				Net_SendMessage(21,"") ; notify other players a jump has taken place
			EndIf	
		EndIf
		
		
		; fire
		;If LM_DOWN ( )  ; left mouse down
		
		If enableRapidFire=True ; use keydown for keyscan..
			If ( KeyDown( 157 ) ) Or ( KeyDown( 29 ) )  Or ( MouseDown ( 1 ) ); Left Mousebutton down/LeftCtrl/RightCtrl
				Net_SendMessage(4,"") ; notify other players a shot has been fired.
				CreateBullet(localID)
			EndIf
		Else ; use keyhit for keyscan..
			If ( KeyHit( 157 ) ) Or ( KeyHit( 29 ) )  Or ( MouseHit ( 1 ) )   ; Left Mousebutton hit /LeftCtrl/RightCtrl
				Net_SendMessage(4,"") ; notify other players a shot has been fired.
				CreateBullet(localID)
			EndIf
		EndIf
		
		; cheats(need to be disabled later, is for debug ease only)
		If KeyHit(19) Then enableRapidFire=1-enableRapidFire: Delay 300 ; R key, for debug purposes(beats typing), needs to be disabled and exist as chat cheat command only.
	
		If KeyHit(35)Then ;H=health
			p\life = 100 
			NewMessage(p\name + " fully restored health! " ) ;
			SoundVolume fullhealth,.2
			PlaySound (fullhealth)
			Net_SendMessage(82,p\id) ; notify non local players too, so they can play sound.
			Net_SendMessage(5,p\life,p\id)
			Net_SendMessage(5,p\life,p\id,p\id)
		EndIf	
	
	EndIf
	
	
	
	; To send asjusted Local player position to network players
    ; we create a message Type "2" for player position..
	If MilliSecs()-updatePosition &gt; updateTick ; 
		; sent the position and jumpstatus over the network so other players can adjust/act accordingly..
		Net_SendMessage(2,EntityX(p\mesh) + "/" + EntityY(p\mesh) + "/" + EntityZ(p\mesh) + "/" + EntityYaw(p\mesh)+ "/" ) 
		updatePosition = MilliSecs()
	EndIf	
	
End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function UpdatePlayers()
	
	For p.player = Each player ; update and check all players..
	
		If p\id &lt;&gt; localID   ; FIRST UPDATE POSITIONS FOR ALL *NON-LOCAL* PLAYERS(server &amp; clients alike)..
			
			;; LINEAR INTERPOLATION ;;;;;;;;;;
			If p\nextTime &lt;&gt; p\previousTime ;And interpol=True; if both packets arrived at the same time, we can't interpolate
				curTime# = Float(MilliSecs()-p\nextTime) / Float(p\nextTime-p\previousTime) ; curTime will be ideally 0.0-1.0, if it's &gt; 1.0 then it performs extrapolation
				If curTime &gt; 1 Then curTime = 1 ; extrapolation gives anoying jittering effects
				; special fix for yaw as EntityYaw returns a value beetween +180 ans -180, the interpolation can go backward
				If p\previousYaw &lt; 0 Then p\previousYaw = p\previousYaw + 360
				If p\nextYaw &lt; 0 Then p\nextYaw = p\nextYaw + 360
				If Abs(p\nextYaw-p\previousYaw) &gt; 180
					If p\nextYaw &gt; p\previousYaw
						p\previousYaw = p\previousYaw + 360
					Else
						p\previousYaw = p\previousYaw - 360
					EndIf
				EndIf
				
				
				;******* new! move entity when we have more health..*******
				;If localMode = 2 ; &lt;&lt; so when is server..
	;				If CountCollisions(p\mesh) Then ; so if collided
	;					If GetEntityType ( CollisionEntity(p\mesh,1) ) = 2  ; so if collided with another player(type2)
	;						touchedPlayer.player = Object.player(EntityName(CollisionEntity(p\mesh,1))) ; find out who it was that collided with player.
	;						If touchedPlayer\life &lt; p\life Then ; see if the  other player is weaker..
	;							NewMessage( "my healthpower= " + p\life + " is more than " + touchedPlayer\name +"'s healthpower= " + touchedPlayer\life )
	;							;push the other player aside.
	;							TranslateEntity touchedPlayer\mesh,EntityX(touchedPlayer\mesh)-EntityX(p\mesh),0,EntityZ(touchedPlayer\mesh)-EntityZ(p\mesh)
	;							Net_SendMessage(2,EntityX(touchedPlayer\mesh) + "/" + EntityY(touchedPlayer\mesh) + "/" + (EntityZ(touchedPlayer\mesh)) + "/" + EntityYaw(touchedPlayer\mesh)+ "/" ) 
	;						EndIf
	;						
	;					EndIf
	;					;ResetEntity p\mesh						
	;				EndIf	
				;EndIf
				;**********************************************************
				
				
				;update that interpolated player's position..
				PositionEntity p\mesh,p\previousX+(p\nextX-p\previousX)*curTime,p\previousY+(p\nextY-p\previousY)*curTime,p\previousZ+(p\nextZ-p\previousZ)*curTime
				RotateEntity p\mesh,0,p\previousYaw+(p\nextYaw-p\previousYaw)*curTime,0
			Else ; so if p\nextTime = p\previousTime then no interpolation possible.
				
				;update that layer's position..
				PositionEntity p\mesh,p\nextX,p\nextY,p\nextZ
				RotateEntity p\mesh,0,p\nextYaw,0
			EndIf
			
			
			;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
			
		Else ; SECOND UPDATE POSITIONS FOR OUR OWN (LOCAL)PLAYER. 
             ;So if p\id = localID  thus update (local) player (it being servers or client) stuff. 
			 ; (Can't be combined with other local player stuff, for will somehow make jumping bit more laggy??)
			
			
			; GRAVITY ON LOCAL PLAYER
			; basically below just computes gravity for the local player. Actual positions will be updated across other player next loop. 
            ;[if done outside this loop(so at update local player) then jumping is more jurkey??]
			
			p\velocityY = p\velocityY - 0.03 ; increase gravity (wherever we are)by substracting every time when passing by in this loop.
			
			pick=LinePick(EntityX(p\mesh),EntityY(p\mesh),EntityZ(p\mesh),0,-2,0)
			If pick=0 Then ; so no surface underneath
				fall=fall+1 ;falling is true, start measuring distance.
				;NewMessage( "fall= " + fall ) ;debug
			EndIf
			
			If EntityY(p\mesh) - p\currentY &gt;= 0 Then; but if player is not falling(or not anymore, for entity's Ypos-currentY do not differ).. 
				If p\velocityY &lt; -0.03 Then p\velocityY = -0.03 ; we limit the gravity to normal values.
				
				;check fall height..
				If fall&gt;15 And fall&lt;130 Then ; if heigh but not too high to be fatal..
					p\life=p\life-(Int(fall/3.65*9.8)) ; reduce healthlife with falling height
					If p\life&gt;0 Then ;so when still has life to spare..
						;NewMessage(" Ouch! | fall= " +fall + "| p\life= "+ p\life)  ; debug
						SoundVolume hitsnd, .8
						hitchannel = PlaySound (hitsnd)
						; notify non local players too, so they can adjust healthdisplay and play sound.
						;Net_SendMessage(type,message$="",sender=0,recipient=0)
						Net_SendMessage(5,p\life,p\id) ; first send to others,
						Net_SendMessage(5,p\life,p\id,p\id) ; then also notify ourself to make sure all's updated.
					ElseIf p\life&lt;= 0 ; so if no life to spare.. 
						NewMessage(" Aargh! ") ; +fall)
						SoundVolume deathsnd, .8
						hitchannel = PlaySound (deathsnd)
						RandomSpawn(p\id)
					EndIf	
					
				ElseIf	fall&gt;=200 Then ;in case of gfx error and endles fall occurs
					NewMessage(" Aargh! Epic fall! "+fall)
					SoundVolume deathsnd, .8
					hitchannel = PlaySound (deathsnd)
					NewMessage(p\name + " killed himself for some reason.. " )
					RandomSpawn(p\id)
					
				EndIf	
				fall=0 ;reset fall counter.
			EndIf
			
			p\currentY = EntityY(p\mesh)
			TranslateEntity p\mesh,0,p\velocityY,0
			
		EndIf
		
		
		
		
		
	Next
	
End Function




;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function CreatePlayer(id,name$)
	
	For p.player = Each player
		If p\id = id Then Return ; player already connected
	Next
	
	p.player = New player
	p\id = id
	p\name = name
	
	
	;build player entity
	p\mesh = CreateSphere()
	
	NameEntity p\mesh,Handle(p)
	
	nose = CreateSphere(8,p\mesh):EntityColor nose,255,0,0
	PositionEntity nose,0,0,1
	ScaleEntity nose,0.3,0.3,0.3
	
	eyeLeft = CreateSphere(8,p\mesh):EntityColor eyeLeft,255,255,255
	PositionEntity eyeLeft ,.29,.4,.7;1
	ScaleEntity eyeLeft ,0.2,0.2,0.2
	
	pupilLeft = CreateSphere(8,p\mesh):EntityColor pupilLeft ,0,0,0
	PositionEntity pupilLeft ,.3,.4,.9;1
	ScaleEntity pupilLeft ,0.05,0.05,0.02
	
	eyeRight = CreateSphere(8,p\mesh):EntityColor eyeRight ,255,255,255
	PositionEntity eyeRight ,-.29,.4,.7;1
	ScaleEntity eyeRight ,0.2,0.2,0.2
	
	pupilRight = CreateSphere(8,p\mesh):EntityColor pupilRight ,0,0,0
	PositionEntity pupilRight ,-.3,.4,.9;1
	ScaleEntity pupilRight ,0.05,0.05,0.02
	
	unaBrow = CreateCone(8,1,p\mesh):EntityColor unaBrow ,0,0,0
	PositionEntity unaBrow ,0,.45,.7
	RotateEntity unaBrow ,-180,0,0
	ScaleEntity unaBrow ,.7,.2,.3
	
	
	
	;Give a random color to our player.
	p\r = Rand(255)
	p\g = Rand(255)
	p\b = Rand(255)
	EntityColor p\mesh,p\r,p\g,p\b
	
	r=p\r
	g=p\g
	b=p\b
	;create arms &amp; hands.,
	upperArmLeft = CreateSphere(8,p\mesh):EntityColor upperArmLeft,150,150,150 ; ,r,g,b
	PositionEntity upperArmLeft ,0.9,0.2,.2
	RotateEntity upperArmLeft ,0,0,20
	ScaleEntity upperArmLeft ,0.2,0.4,0.2
	
	lowerArmLeft = CreateSphere(8,p\mesh):EntityColor lowerArmLeft,150,150,150 ; ,r,g,b
	PositionEntity lowerArmLeft ,0.9,-.1,.45
	RotateEntity lowerArmLeft ,0,15,20
	ScaleEntity lowerArmLeft ,0.2,0.2,0.4
	
	handLeft = CreateSphere(8,p\mesh):EntityColor handLeft,255,255,255
	PositionEntity handLeft ,.7,-.1,.7
	RotateEntity handLeft ,0,15,20
	ScaleEntity handLeft ,0.22,0.22,0.22



	upperArmRight = CreateSphere(8,p\mesh):EntityColor upperArmRight ,150,150,150
	PositionEntity upperArmRight ,-0.9,0.2,.2
	RotateEntity upperArmRight ,0,0,-20
	ScaleEntity upperArmRight ,0.2,0.4,0.2
	
	lowerArmRight = CreateSphere(8,p\mesh):EntityColor lowerArmRight ,150,150,150
	PositionEntity lowerArmRight ,-0.9,-.1,.45
	RotateEntity lowerArmRight ,0,-15,-20
	ScaleEntity lowerArmRight ,0.2,0.2,0.4
	
	handRight = CreateSphere(8,p\mesh):EntityColor handRight ,255,255,255
	PositionEntity handRight ,-.7,-.1,.7
	RotateEntity handRight ,0,15,-20
	ScaleEntity handRight ,0.22,0.22,0.22

	
	
	; create a simple gun..
	gunHandle = CreateCube(p\mesh):EntityColor gunHandle ,70,70,70
	PositionEntity gunHandle ,.6,-.2,1
	ScaleEntity gunHandle ,0.07,0.3,0.1
	RotateEntity gunHandle ,0,20,20
	
	gun = CreateCube(p\mesh):EntityColor gun,70,70,70
	PositionEntity gun,.5,.2,1
	ScaleEntity gun ,0.07,.12,0.7
	RotateEntity gun ,0,20,20
	
	
	
	EntityType p\mesh,2
	;EntityRadius p\mesh,1.2,1.0
	EntityRadius p\mesh,1.0

	
	;start at one of our random spawn positions.
	RandomSpawn(p\id)	
	
	
	Return p\mesh
	
End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function SpawnPlayer(id,spawnId)
	
	p.player = Object.player(GetPlayer(id))
	
	For s.spawn = Each spawn
		If s\spawnId = spawnId Then Exit
	Next
	
	p\life = 80 ;start off slightly unhealthy..
	
	p\nextX = s\x
	p\nextY = s\y
	p\nextZ = s\z
	p\nextYaw = s\yaw
	
	p\previousX = p\nextX
	p\previousY = p\nextY
	p\previousZ = p\nextZ
	p\previousYaw = p\nextYaw
	
	PositionEntity p\mesh,p\nextX,p\nextY,p\nextZ
	RotateEntity p\mesh,0,p\nextYaw,0
	ResetEntity p\mesh
	
	p\currentY = p\nextY
	
	p\previousTime = MilliSecs()
	p\nextTime = MilliSecs()+1
	;is this heard on local and networked playerside?
	SoundVolume appearsnd, .5
	PlaySound (appearsnd)
	
End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function RandomSpawn(id)
	
	p.player = Object.player(GetPlayer(id))
	
	; if we are the server, spawn player at random location
	If localMode = 2
		randSpawn = Rand(1,spawns)
		SpawnPlayer(p\id,randSpawn)
		Net_SendMessage(9,randSpawn,p\id)
		Net_SendMessage(9,randSpawn,p\id,p\id)
	Else ; else default spawn 
		SpawnPlayer(p\id,1)

	EndIf
	
End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function CreateSpawn(x#,y#,z#,yaw#)
	
	spawns = spawns + 1
	
	s.spawn = New spawn
	s\spawnId = spawns
	s\x = x
	s\y = y
	s\z = z
	s\yaw = yaw
	
End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function GetPlayer(id)
	; return the handle of the player stored in the field item\id
	
	For p.player = Each player
		If p\id = id
			Return Handle(p)					
		EndIf
	Next
	
End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function DrawPlayersNames()
	
	For p.player = Each player
		If EntityVisible (p\mesh,camera)
			
			Color 255,255,255
			CameraProject(camera,EntityX(p\mesh),EntityY(p\mesh),EntityZ(p\mesh)) 	
			
			
			If p\id &lt;&gt; localID Then Text ProjectedX(),ProjectedY()-60,p\name,1,1 ; only draw players name when not the localplayer
            ; the more health, the brighter the txt color..
			Color 255,(255./100.)*p\life,(255./100.)*p\life ;
			Text ProjectedX(),ProjectedY()-40,Int(p\life),1,1
		EndIf
	Next
	
End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function DrawHealthItemStrengths()
	
	For h.health = Each health
		If EntityVisible (h\mesh,camera)
			Color 255,0,0
			CameraProject(camera,EntityX(h\mesh),EntityY(h\mesh),EntityZ(h\mesh)) 
			
			Color 255,(255./100.)*h\power,(255./100.)*h\power
			If MilliSecs() - h\pickupTime &gt; h\respawnDelay Then ;ShowEntity h\mesh only when it's spawn time has passed..
				Text ProjectedX(),ProjectedY()-35,h\power,1,1
			EndIf
		EndIf
	Next
	
End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function CreateBullet(id)
	; this will create a bullet
	
	p.player = Object.player(GetPlayer(id)) ; tie the shooter's id to the bullit..
	b.bullet = New bullet
	b\id = p\id
	
	b\mesh = CreateSphere(2)
	ScaleEntity b\mesh,0.2,0.2,0.2
	EntityColor b\mesh,255,255,0
	
	PositionEntity b\mesh,EntityX(p\mesh),EntityY(p\mesh),EntityZ(p\mesh)
	RotateEntity b\mesh,0,EntityYaw(p\mesh),0
	
	MoveEntity b\mesh,0,0,2 ; so can't hit own player or little less easy..(no sure fix)
	EntityType b\mesh,3
	EntityRadius b\mesh,0.2
	
	SoundVolume shoot, .5
	shootchannel = PlaySound (shoot) ;shooting sound is started.
	
	b\time = MilliSecs()
	
End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function UpdateBullets() 
	
	For b.bullet = Each bullet
		
		MoveEntity b\mesh,0,0,1.5 ; increase speed so player can't outrun bullets and hit himself easily(unless someth weird happens..)
		
		If CountCollisions(b\mesh)
			
			If localMode = 2 ; so when is server. only the server compute bullets collision with player
				
				If GetEntityType(CollisionEntity(b\mesh,1)) = 2 
					
					touchedPlayer.player = Object.player(EntityName(CollisionEntity(b\mesh,1)))
					
					;selfhit detection..
					killerPlayer.player = Object.player(GetPlayer(b\id)) ; whodunnit? get id of player tied to bullit..
					If touchedPlayer.player &lt;&gt; killerPlayer.player
						touchedPlayer\life = touchedPlayer\life - 10 ; reduce health when hit.
					;Else
						;NewMessage( "Debugmsg: Player only hit himself, no loss though. ;-)" ) ; 
					EndIf
				
				
					If touchedPlayer\life &gt; 0 ; touched and still has health to spare..
						Net_SendMessage(5,touchedPlayer\life,touchedPlayer\id) ; notify about life reduction
						Net_SendMessage(5,touchedPlayer\life,touchedPlayer\id,touchedPlayer\id) 
						SoundVolume hitsnd, .8
						hitchannel = PlaySound (hitsnd)
											
					Else ; killed (all out of health)
						;boomchannel = PlaySound (boom) ;boom sound is started.
						SoundVolume deathsnd,.8
						PlaySound (deathsnd) ;die sound is started(local)
						Delay 100
						;killerPlayer.player = Object.player(GetPlayer(b\id)) ; redundant now..
						
						killerPlayer\kills = killerPlayer\kills + 1
						touchedPlayer\deaths = touchedPlayer\deaths + 1						
						
												
						Net_SendMessage(6,touchedPlayer\id,killerPlayer\id)  ;notify others that a player killed another one.
						Net_SendMessage(6,touchedPlayer\id,killerPlayer\id,killerPlayer\id)
						
						;send score update for a player
						Net_SendMessage(7,killerPlayer\kills+"/"+killerPlayer\deaths,killerPlayer\id) 
						Net_SendMessage(7,killerPlayer\kills+"/"+killerPlayer\deaths,killerPlayer\id,killerPlayer\Id)
						
						Net_SendMessage(7,touchedPlayer\kills+"/"+touchedPlayer\deaths,touchedPlayer\id)
						Net_SendMessage(7,touchedPlayer\kills+"/"+touchedPlayer\deaths,touchedPlayer\id,touchedPlayer\id)
						
						NewMessage(killerPlayer\name + " killed " + touchedPlayer\name)
						RandomSpawn(touchedPlayer\id)
											
 					
						;ResetPlayer(touchedPlayer\id) ;&lt;&lt;
					EndIf
						
					
				EndIf
				
			EndIf
			
			FreeEntity b\mesh
			Delete b
			
		ElseIf MilliSecs()-b\time &gt; 2000
			
			FreeEntity b\mesh
			Delete b
			
		EndIf
		
	Next
	
End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function CreateHealthItem(x#,y#,z#,power#,respawnDelay#)
	
	h.health = New health
	
	h\mesh = CreateMesh()
	
	h\power = power ; set item strength
	
	;h\respawnDelay = 10000
	h\respawnDelay = respawnDelay ; set according to valuableness(strength actually)..
	
	; create the object..
	mesh1 = CreateCube()
	mesh2 = CreateCube()
	
	ScaleMesh mesh1,.20,.5,.20
	ScaleMesh mesh2,.20,.5,.20:RotateMesh mesh2,90,0,0
	
	AddMesh(mesh1,h\mesh)
	AddMesh(mesh2,h\mesh)
	
	EntityColor h\mesh,255,0,0
	
	
	If localMode = 2 Then EntityType h\mesh,4 ; if we are the host then set entitytype to 4..
	EntityRadius h\mesh,0.5
	
	PositionEntity h\mesh,x,y,z
	
	NameEntity h\mesh,Handle(h) ; store the handle(h) in name of the entity.

End Function




;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function UpdateHealthItems()
	
	For h.health = Each health ; check all health items..
		
		TurnEntity h\mesh,0,-2,0 ; spin around and around and around.
		
		If localMode = 2 And GetEntityType(h\mesh) &lt;&gt; 4 ;If we are the HOST and entitytype is not 4..
			EntityType h\mesh,4 ; set to 4 
			EntityRadius h\mesh,0.5
		EndIf
		
		If CountCollisions(h\mesh)
			
			If localMode = 2 ; only the server computes collision with player
				If GetEntityType(CollisionEntity(h\mesh,1)) = 2 ; a player collided
					
					touchedPlayer.player = Object.player(EntityName(CollisionEntity(h\mesh,1)))
					
					h\pickupTime = MilliSecs()
					HideEntity h\mesh
					h\visible = False
					ResetEntity h\mesh
					
					Net_SendMessage(8,Handle(h))  ; update health item?
					
					If touchedPlayer\life &lt; 100 ; touched healthpowerup and not fully charged..
						touchedPlayer\life = touchedPlayer\life + h\power ;add healthpowerup strenght of the healthitem to touched players life.
						Net_SendMessage(81,touchedPlayer\id) ; notify non local players too, so they can play sound.
						
						If touchedPlayer\life &gt;100 Or touchedPlayer\life=100
							touchedPlayer\life = 100;  so can't exceed 100%
							;
							NewMessage(touchedPlayer\name + " fully restored health! " ); &lt;&lt; on server only(so local)
							SoundVolume fullhealth,.2
							PlaySound (fullhealth)
							
							Net_SendMessage(82,touchedPlayer\id) ; notify non local players too, so they can adjust healthdisplay and play sound.
							
							
						EndIf
						
						Net_SendMessage(5,touchedPlayer\life,touchedPlayer\id)
						Net_SendMessage(5,touchedPlayer\life,touchedPlayer\id,touchedPlayer\id)
						pwrchannel = PlaySound (pwr) ; pwrup sound is started locally when collected. 
						
						;
					Else	
						pickupchannel = PlaySound (pickupnogo) ; pickup sound is started when collected and already full.
						; notify other players here so can play sound too?. - not interesting
						Net_SendMessage(83,touchedPlayer\id) ; notify non local players too, so they can adjust healthdisplay and play sound.
						
					EndIf
					
				EndIf
				
				; sound for non-localmode(so clients) here..
				
			EndIf
			
		EndIf
		
		If MilliSecs() - h\pickupTime &gt; h\respawnDelay And h\visible = False
			ShowEntity h\mesh ; show entity when spawn time passed,,
			If firsttimehealth=False
				pwrchannel = PlaySound (pwrappear) ; appear sound is started when h\mesh appears
			EndIf
			h\visible= True
		EndIf
	Next
	
End Function


;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;


;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function NewMessage(msg$)
	
	; this routine checks and updates the message buffer.
	messageOffset = messageOffset + 1
	
	If messageOffset &gt; messageDisplayNumber
		
		messageOffset = messageOffset - 1
		
		For i = 2 To messageDisplayNumber
			message(i-1) = message(i)		
		Next
		
		message(messageDisplayNumber) = msg
		
	Else
		
		message(messageOffset) = msg
		
	EndIf
	
End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function DrawMessages()
	
	; this routine does the actual on screen drawing of the chat..
	
	Color 255,255,255
	
	For i = 1 To messageOffset
		
		;Text 0,(i-1)*15,message(i)	
		
		; &lt;&lt;&lt; colored txt mod by Raster Ron
		loc = Instr (message(i), "¿",1)
		If loc &gt; 1 Then 
			colorMessage$ = Mid$(message(i), 1, Len(message(i)) - 7 ) 
			Hex$ = Right$(message(i),6)		 
			Set_Color_Hex(Hex$) 
			Text 0,(i-1)*15,colorMessage$ 
		Else  
			Color 255,255,255 
			Text 0,(i-1)*15,message(i) 
		End If	
		; &lt;&lt;&lt; End colored txt mod by Raster Ron
		
	Next
	
End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function UpdateChat()
	
	; this routine does the input check..
	key = GetKey()
	If key
		
		PlaySound(typesnd)
		If key = 13 ;carriage return, so entered, msgline finished.
			PlaySound(newlinesnd)
			; &lt;todo:  Also let other players here the ping snd to attract their attention.
			
			If chatMessage &lt;&gt; localName + "&gt; " ; so msg is larger than the prompt.
				
				If Len(chatMessage) &gt; maxlinelength-(Len(localName)+2)  ; so exceeds max line length
					chatMessage = Left$(chatMessage,maxlinelength) ; so ignoring all surpassing max chars.
				EndIf	
				
				
				For i = Len(localName + "&gt; ") To Len(chatMessage) ;check all characters from afte name+promtsign to end of msg..
					If Mid(chatMessage,i,1) &lt;&gt; " " ; trap all spaces input, so no empty jibberish..
						
						
						; '/' commands..
						
						
						If Mid(chatMessage,i,1) = "/"  ; check for the command trigger '/' if so, go into command mode..
							
							;check 2nd part(command) &lt;&lt; later to be done from data statements holding all commands..
							If Mid(chatMessage,i+1,5) = "kick " ; if at $location name+promptsign+/+5 chars= "kick "
								playerToBeKickedName$ = Mid(chatMessage,i+6, Len(chatMessage) )    ;
						
								For p.player = Each player ; check each player
									If p\name = playerToBeKickedName$  ;so only if playername exists..
									
										If localMode = 2 ; only the host/server can kick/ban players..(ban not requires keeping a dbase).
											If playerToBeKickedName$ &lt;&gt; localName$ ; so host is not kicking himself.
												
												chatMessage=playerToBeKickedName$ + " has been kicked by host! "
												;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
												; &lt;&lt;&lt; colored txt mod by Raster Ron
												chatColor$ = RGB_To_TriHex(cR,cG,cB)
												chatMessage = chatMessage + "¿" + chatColor$
												;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
																					
												
												Net_SendMessage(1,chatMessage) ; send msg to all.
												Net_KickPlayer(playerToBeKickedName$) 
									
											Else 
												NewMessage( "-Selfkicking not allowed.. ") ; display msg.
											EndIf
											
										;ElseIf localMode = 3 ; moderator &lt;&lt; to be introduced into code stil..	
											;moderator commands go here.
												
										Else ; so  localMode &lt;&gt; 2 or 3 ;so no server/host or moderator..
											;Net_SendMessage(1,"") ; send msg to all.
											NewMessage( "-Kicking not allowed for non-admins.. ") ; display msg.
										EndIf
										;Exit
									EndIf
								Next
								
							; other commands..	list, changetype(only allowed by host, can create moderator), wizz(unlimited ammo/health etc).	
							ElseIf Mid(chatMessage,i+1,5) = "list" ; if at $location name+promptsign+/+5 chars= "list"
								
								NewMessage( "Players:" ) ; display msg.
								NewMessage( "--------" ) ; display msg.
								For p.player = Each player ; check each player
									lst=lst+1
									playerList$=lst + ". Name: " + p\name + " | ID: " +  p\id + " | Ping: " + p\ping 
									NewMessage( playerList$ ) ; display msg.
									
									;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
									; &lt;&lt;&lt; colored txt mod by Raster Ron
									;chatColor$ = RGB_To_TriHex(cR,cG,cB)
									;chatMessage = chatMessage + "¿" + chatColor$
									;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
									
								Next
								Lst=0
								; count players
								For n.net_client = Each net_client
									Lst = Lst + 1	
									CID = n\ID
									CName = n\name
									CIP=DottedIP$(n\IP)
									CPort= n\port			
									clientList$=Lst + ". Name: " + CName + " | ID: " +  CID+ " | Port: " + CPort + " | IP:   " + CIP  
									
									NewMessage( clientList$ ) ; display msg.
								Next
								
								
							ElseIf Mid(chatMessage,i+1,10) = "rapidfire" ; 
								enableRapidFire=1-enableRapidFire
								If enableRapidFire=True
									statusMsg$="Rapid Fire Enabled!" 
								Else
									statusMsg$="Rapid Fire Disabled!" 
								EndIf
								NewMessage( statusMsg$ ) ; display msg.
							EndIf
							
							
							
							
						Else ; so if not in command mode.
							;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
							; &lt;&lt;&lt; colored txt mod by Raster Ron
							chatColor$ = RGB_To_TriHex(cR,cG,cB)
							chatMessage = chatMessage + "¿" + chatColor$
							;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
					
							Net_SendMessage(1,chatMessage) ; send msg to all.
							NewMessage(chatMessage)        ; put in the msg buffer for display on screen.
											
						EndIf	; 
						
						Exit	
							
					EndIf ; trap all spaces input, so no empty jibberish..
				Next ;check all characters from afte name+promtsign to end of msg..
			EndIf ;chatMessage &lt;&gt; localName + "&gt; " 
			
			chatMessage = localName + "&gt; "
			chatMode = 0
			
			
		ElseIf key = 8 And Len(chatMessage) &gt; Len ( localName + "&gt; " ) ; backspace and msg length longer then..
			chatMessage = Left(chatMessage,Len(chatMessage)-1) ; reduce lenght of msg with 1.
			
		ElseIf key &gt; 31 And key &lt; 127 ; if msg is valid range between 'US'(unit separator) and 'DEL' , so from 'SPACE' to '~'
			chatMessage = chatMessage + Chr(key)
			
		EndIf ;key = 
	EndIf ;key
	
	Color 255,255,255
	Rect 0,GraphicsHeight()-20,GraphicsWidth(),20,1
	Color 0,0,0
	Rect 0,GraphicsHeight()-20,GraphicsWidth(),20,0
	
	
	If MilliSecs()-chatMillisecs &gt; 500
		chatCursor = Not chatCursor
		chatMillisecs = MilliSecs()
	EndIf
	
	If chatCursor
		Text 5,GraphicsHeight()-17,chatMessage + "|"
	Else
		Text 5,GraphicsHeight()-17,chatMessage
	EndIf
	FlushKeys ; prevent space etc to be tranfered to the game, makingh player jump etc.
End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function DrawScoreTable()
	
	For p.player = Each player
		count = count + 1
	Next
	
	baseX = (GraphicsWidth()-350)/2
	baseY = (GraphicsHeight()-(35+20*count))/2
	
	Color 0,0,0
	Rect baseX,baseY,350,35+20*count,1
	
	Color 255,192,0
	Rect baseX,baseY,350,35+20*count,0
	
	Text baseX+10,baseY+10,"Player          Kills     Deaths     Ping"
	Line baseX,baseY+25,baseX+349,baseY+25
	
	For p.player = Each player
		
		Color 255,255,255
		If p\id = localID Then Color 255,100,100
		
		i = i + 1
		Text baseX+10,baseY+10+20*i,p\name
		Text baseX+157,baseY+10+20*i,p\kills,1,0
		Text baseX+240,baseY+10+20*i,p\deaths,1,0
		Text baseX+322,baseY+10+20*i,p\ping,1,0
	Next
	
End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function UpdateChaseCam(camera,player) ; thanks to jfk EO-11110 on bb forums for this function !
	PositionEntity camera,EntityX(player,1),EntityY(player,1),EntityZ(player,1)
	ResetEntity camera
	x#=EntityX(player)+Sin(-EntityYaw(player)+180)*x_dis#
	y#=EntityY(player)+y_dis#
	z#=EntityZ(player)+Cos(-EntityYaw(player)+180)*z_dis#
	obstacle=LinePick(EntityX(player),EntityY(player),EntityZ(player),(x-EntityX(player)),y_dis#,(z-EntityZ(player)),0.1)
	If obstacle=0
		new_x#=x
		new_y#=y
		new_z#=z
	Else
		new_x#=PickedX()
		new_y#=PickedY()
		new_z#=PickedZ()
	EndIf
	If bounce_cam=0
		PositionEntity camera,new_x,new_y,new_z
	Else
		x=old_x+((New_x-old_x)/bounce_div#)
		y=old_y+((New_y-old_y)/bounce_div#)
		z=old_z+((New_z-old_z)/bounce_div#)
		PositionEntity camera,x,y,z
	EndIf
	PointEntity camera,player
	TurnEntity camera,-20,0,0     ; if you want the player mesh more on the bottom of the screen
	old_x#=EntityX(camera)
	old_y#=EntityY(camera)
	old_z#=EntityZ(camera)
End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function CreateScene()
	
	texture = TextureCreate(128)
	
	ground = CreatePlane()
	EntityColor ground,150,150,150
	EntityTexture ground,texture
	NameEntity ground, "ground"
	
	;cube with ramp and rounded top.
	cube = CreateCube():EntityColor cube,150,200,150
	ScaleEntity cube,5,5,5:PositionEntity cube,0,5,0
	EntityTexture cube,texture
	
	sphere = CreateSphere(16):EntityColor sphere,200,150,150
	ScaleEntity sphere,3,1,3:PositionEntity sphere,0,9.7,0
	
	platform = CreateCube():EntityColor platform,150,150,200
	ScaleEntity platform,3,1,10:PositionEntity platform,0,4.13,-13.15
	TurnEntity platform,-30,0,0
	EntityTexture platform,texture
	
	
	
	;cube2 with ramp and rounded top.
	cube2 = CreateCube():EntityColor cube2,150,150,200
	ScaleEntity cube2,5,8,5:PositionEntity cube2,0,8,17
	EntityTexture cube2,texture
	
	sphere2 = CreateSphere(16):EntityColor sphere2,150,200,200
	ScaleEntity sphere2,3,1,3:PositionEntity sphere2,0,15.5,17
	
	platform2 = CreateCube():EntityColor platform2,150,200,150
	ScaleEntity platform2,3,1,16:PositionEntity platform2,0,7.15,-19.55+54.9
	TurnEntity platform2,-30,180,0
	EntityTexture platform2,texture
	
	
	
	
	;cube3 with ramp and rounded top.
	cube3 = CreateCube():EntityColor cube3,150,150,200
	ScaleEntity cube3,5,1,5:PositionEntity cube3,6.5,25,6.5
	EntityTexture cube3,texture
	
	sphere3 = CreateSphere(16):EntityColor sphere3,150,200,200
	ScaleEntity sphere3,3,1,3:PositionEntity sphere3,6.5,25.5,6.5
	
	platform3 = CreateCube():EntityColor platform3, 200,100,100            
	ScaleEntity platform3,3,1,19:PositionEntity platform3,24.3,12,6.5
	TurnEntity platform3,-45,90,0
	EntityTexture platform3,texture
	
	
	;cube4 with ramp and rounded top.
	cube4 = CreateCube():EntityColor cube4, 250,250,150
	ScaleEntity cube4,5,1,5:PositionEntity cube4,-6.5,20,6.5
	EntityTexture cube4,texture
	
	sphere4 = CreateSphere(16):EntityColor sphere4,150,200,200
	ScaleEntity sphere4,3,1,3:PositionEntity sphere4,-6.5,20.5,6.5
	
	platform4 = CreateCube():EntityColor platform4,100,100,200
	ScaleEntity platform4,3,1,15:PositionEntity platform4,-21.3,10,6.5
	TurnEntity platform4,45,90,0
	EntityTexture platform4,texture
	
	
	
	
	; spawn locations
	spawner1 = CreateSphere() :EntityColor spawner1 ,150,150,150;  &lt;&lt;&lt;&lt;
	ScaleEntity spawner1 ,2,3,2:PositionEntity spawner1 ,-20,.1,-20 ;&lt;&lt;&lt;&lt;
	EntityTexture spawner1 ,texture
	
	column= CreateCylinder()
	ScaleEntity column,2,3,2:PositionEntity column,20,.1,20 ;&lt;&lt;&lt;&lt;
	EntityTexture column,texture
	
	FreeTexture texture
	
	
	; some test walls. ;
	; PLEASE NOTE: extreme low poly objects like big cubes don't work well with
	; directX point lights: the light simply doesn't get enough vertices to obtain a good "grip" on the
	; normals. To illustrate this you may use the CreateCube command instead (see a few lines below).
	;Global n_c=10
	;Dim cubes(n_c)
	;polys=10
	;For i=0 To n_c
	;	cubes(i)=CreateSphere(polys)
	;	PositionEntity cubes(i), Rnd(-100,100),0,Rnd(-100,200)
	;	ScaleEntity cubes(i),1,10,Rand(4,10)
	;	RotateEntity cubes(i),0,Rand(360),0
	;	EntityColor cubes(i),Rand(255),Rand(255),Rand(255)
	;	EntityPickMode cubes(i),2
	;	UpdateNormals cubes(i)
	;	EntityType cubes(i),type_world
	;Next
	
	
	;polys=10
    ;length = 50;
    ;angle = 0.0;
    ;angle_stepsize = 360/n_c;
	;For i= 0 To n_c/2 
	;	
	;    x = length * Cos (angle);
    ;    z = length * Sin (angle);
	;	cubes(i)=CreateSphere(polys)
	;	PositionEntity cubes(i), x+Rnd(-100,100),0,z+Rnd(-100,100)
	;	
	;   ScaleEntity cubes(i),1,10,Rand(4,10)
	;	RotateEntity cubes(i),0,Rand(360),0
	;	EntityColor cubes(i),Rand(255),Rand(255),Rand(255)
	;	EntityPickMode cubes(i),2
	;	UpdateNormals cubes(i)
	;	EntityType cubes(i),1
	;
	;angle = angle+ angle_stepsize;
	;Next
	
	
		
	
	; Collision types &amp; pick mode definitions..
	EntityType ground,1:EntityPickMode ground,2
	EntityType cube,1:EntityPickMode cube,2
	EntityType sphere,1:EntityPickMode sphere,2
	EntityType platform,1:EntityPickMode platform,2
	
	EntityType cube2,1:EntityPickMode cube2,2
	EntityType sphere2,1:EntityPickMode sphere2,2
	EntityType platform2,1:EntityPickMode platform2,2
	
	EntityType cube3,1:EntityPickMode cube3,2
	EntityType sphere3,1:EntityPickMode sphere3,2
	EntityType platform3,1:EntityPickMode platform3,2
	
	EntityType cube4,1:EntityPickMode cube4,2
	EntityType sphere4,1:EntityPickMode sphere4,2
	EntityType platform4,1:EntityPickMode platform4,2
	
	
	
	EntityType spawner1,1:EntityPickMode spawner1,2
	EntityType column,1:EntityPickMode column,2
	
	
	
	; setup light..
	light = CreateLight()
	TurnEntity light,30,70,0
	
	; create health upgrade items.
	
	CreateHealthItem(0     ,1  ,-10  ,10 , 10000) ; undenneath the ramp
	CreateHealthItem(0     ,3  ,-20  ,30 , 30000) ; on the ramp
   ;CreateHealthItem(0     ,12 ,0    ,100, 50000) ; the one on top
	CreateHealthItem(0.07  ,17 ,17   ,100, 50000) ; top of cube2
	firsttimehealth=True
	
	;; COLLISIONS
	Collisions 2,1,2,3 ; player to scene , 3= slide2 - prevent entities from sliding down slopes  
	
	;Collisions 2,2,1,3 ; player to player
	Collisions 2,2,1,1 ; player to player , 1= stop 

	
	Collisions 3,1,2,1 ; bullet to scene
	Collisions 3,2,1,1 ; bullet to player
	
	Collisions 2,4,1,2 ; player to health , 2= slide1 - full sliding collision 
	
End Function

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function TextureCreate(size)
	texture = CreateTexture(size,size,9)
	SetBuffer TextureBuffer(texture)
	Color 255,255,255
	Rect 0,0,size,size,1
	Color 0,0,0
	Rect 0,0,size,size,0
	Line 0,0,size,size
	Line 0,size,size,0
	SetBuffer BackBuffer()
	Return texture
End Function


;======================================================================================
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Function LoadSFX()
	
	
	
	; movements
	;------------------------------
	;run = LoadSound ("sounds\gravel.wav")
	;wade = LoadSound ("sounds\water.wav")
	;SoundVolume run, 0
	;SoundVolume wade, 0
	;LoopSound run
	;LoopSound wade
	;runchannel = PlaySound (run)
	;wadechannel = PlaySound (wade)
	
	;divesnd=LoadSound( "sounds\Asthma_Sound.wav_10720.wav" ) ; diving (uh) sound
	;SoundVolume uh, .9
	
	
	jumpsound=LoadSound( "sounds\boing.wav" ) ; jumping (oink)sound
	SoundVolume jumpsound, .9	
	
	
	; health
	;------------------------------	
	hitsnd=LoadSound( "sounds\bump1.wav" )     ; hit (ugh) sound
	SoundVolume hitsnd, .8
	
	;deathsnd=LoadSound("sounds\CUICA1.WAV" )   ; die (woehh) sound
	deathsnd=LoadSound("sounds\deathmod.wav" )  ; die sound
	
	appearsnd=LoadSound("sounds\XCMAKERS.WAV") ; player(haoooh) reappears sound
	
	
	; items
	;------------------------------	
	
	pickupnogo=LoadSound( "sounds\click1.wav" ) ; pick up nogo health(doorclank) sound
	SoundVolume pickupnogo, .9  
	
	
	; health
	;------------------------------	
	pwrappear =  LoadSound( "sounds\mtruc.wav" ) ; healing item appear(ploc) sound
	SoundVolume pwrappear , .8  
	
	pwr=LoadSound( "sounds\belltree.wav" )       ; healing (triiing) sound
	SoundVolume pwr, .8  
	
	fullhealth=LoadSound ( "sounds\happy.wav" )  ; fullhealthrestored sound
	SoundVolume pwr, .8 
	
	
	
	
	; weaponary
	;------------------------------
	
	shoot=LoadSound( "sounds\shoot.wav" ) ; shooting(laser) sound
	SoundVolume shoot, .5
	
	boom=LoadSound( "sounds\boom.wav" ) ; explosion sound
	SoundVolume boom, .8
	
	; enemies 
	;------------------------------	
	;bark = LoadSound("sounds\bark.wav")
	;SoundVolume bark, .5
	;barkChannel = PlaySound (bark) ;barking sound is started.
	
	
	typesnd= LoadSound("sounds\gui_type.wav")
	SoundVolume typesnd, .8 
	newlinesnd=LoadSound("sounds\typewriterbell.wav")
	SoundVolume newlinesnd, .8 
	
End Function


Function SoundPlay(sound_variable,volume#=.5) 
	
	SoundVolume sound_variable , volume#
	PlaySound sound_variable
	
End Function


Function LoadMusic(files$)
	
;	bgmusic = LoadSound (files$)
;	SoundVolume bgmusic,.5 
;	LoopSound bgmusic
;	bgmusicChannel= PlaySound (bgmusic)
	
;	dangermusic = LoadSound ("Shadow Of The Beast - Aarbronsrevenge.mp3")
;   SoundVolume dangermusic,0
;   LoopSound dangermusic
;	dangermusicChannel= PlaySound(dangermusic)
	
End Function

Function DisplayKeyHelpTxt()
	xcor=30	
	Text GraphicsWidth/2+xcor*2, 10+ycor,"                *** Multiplayer Example Help ***               "
	Text GraphicsWidth/2+xcor*2, 20+ycor," ------------------------------------------------------------- " 
	Text GraphicsWidth/2+xcor*2, 35+ycor," Game Controls                          | In Chat mode         " 	
	Text GraphicsWidth/2+xcor*2, 50+ycor," ------------------------------------------------------------- " 	
	Text GraphicsWidth/2+xcor*2, 65+ycor," Move            : Cursor / WASD        | Command prefix :'/'  " 
	Text GraphicsWidth/2+xcor*2, 80+ycor," Jump            : Space  / Right mouse | e.g:                 "
	Text GraphicsWidth/2+xcor*2, 95+ycor," Shoot           : Ctrl   / Left  mouse | /kick &lt;playername&gt;   "  
	Text GraphicsWidth/2+xcor*2,110+ycor," ---------------------------------------| /list                "  
	Text GraphicsWidth/2+xcor*2,125+ycor," Score           : Tab                  |                      "
    Text GraphicsWidth/2+xcor*2,140+ycor," Focus (toggle)  : F                    | (Also to be used for "
	Text GraphicsWidth/2+xcor*2,155+ycor," Chat            : Enter                | cheats such as       "
	Text GraphicsWidth/2+xcor*2,170+ycor," Help(this text) : F1                   | 'rapidfire')         " 
	Text GraphicsWidth/2+xcor*2,185+ycor," Player color    : F2                   |                      " 
	Text GraphicsWidth/2+xcor*2,200+ycor," Player x,y,z    : F3                   |                      " 	
	Text GraphicsWidth/2+xcor*2,215+ycor," Exit            : Esc                  |                      " 
	Text GraphicsWidth/2+xcor*2,230+ycor," ------------------------------------------------------------- " 
	
End Function
;~IDEal Editor Parameters:
;~C#Blitz3D
</textarea> <br><br></td></tr></table><br>
<a name="1307427"></a>

<a name="1307428"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#173">[#173]</a></td></tr></table></td></tr><tr ><td class="posttext"> [Deleted double post] <br><br></td></tr></table><br>
<a name="1307152"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#174">[#174]</a></td></tr></table></td></tr><tr ><td class="posttext"> WOW Nasher! I must say! You are kicking @#$, &amp; taking names! =D<br><br>Keep up the INCREDIBLE work!<br><br>And hell YEA I'll test it with ya! :D You deserve it!<br><br>Regards, <br><br>~GF <br><br></td></tr></table><br>
<a name="1307258"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#175">[#175]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks, but wayyy not there yet. Still in phase 1. :-D <br><br></td></tr></table><br>
<a name="1308501"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >eng_harvey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#176">[#176]</a></td></tr></table></td></tr><tr ><td class="posttext"> Great to see LAN multiplayer(UDP).. still being worked on :) I am looking forward to downloading and taking for another test run :) Awesome Rick!!!<br><br>How is the shooting function? Did you get it happening without affecting the function you mentioned?<br><br>Best wishes Rick!<br><br>I will take a look in the next week or two and see how it is functioning!<br><br>:) <br><br></td></tr></table><br>
<a name="1308534"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#177">[#177]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yep that's working all fine now. <br>Working on some other functionalities now, as soon as I've got that working I'll upload again. <br><br></td></tr></table><br>
<a name="1308742"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#178">[#178]</a></td></tr></table></td></tr><tr ><td class="posttext"> Update: <br><img src="http://i65.tinypic.com/2eb4byh.jpg"><br><br>Media(.wav files), sources and exe(for the lazy people ;-) here: <br><a href="http://www.mediafire.com/download/4z4w4b482sbybrg/UDPlibV1.12__BUMPV1.72.5t.rar" target="_blank"><b>UDPlibV1.12-BUMPV1.72.5t.rar</b></a> <br><br>-Fixed bugs: health inaccuracies. color at start always displaying ok on players.<br>-Added push player function. Caution: pushing someone requires energy. :-)<br>-Death/change color/revive delay working. <br>-bug: wrong player getting color(mixed up, for not properly net-sent)fixed: Color working ok now.<br>-Immobility when dead also working.<br>-Now storing previous color and revives when.. well, revived of course.<br>-Added another chat cheat '/' command.<br>-Several bugfixes/optimizations.<br>-Added teleportation locations.<br>-Preventing players having same color. <br><br></td></tr></table><br>
<a name="1308743"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#179">[#179]</a></td></tr></table></td></tr><tr ><td class="posttext"> KICK ASS, NASHER! Keep up the GREAT damn work! I can't WAIT to get in &amp; test it with you!<br><br>Regards, <br><br>~GF <br><br></td></tr></table><br>
<a name="1308748"></a>

<a name="1308754"></a>

<a name="1308757"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#180">[#180]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks, been tinkering too long today so got a terrible headache but I can give it a quick test spin. I'm in the usual place:<br><a href="http://webchat.quakenet.org/" target="_blank">http://webchat.quakenet.org/</a><br>channel #UDPNetwork_lib<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Function CreateBullet(id)
	; this will create a bullet
	
	p.player = Object.player(GetPlayer(id)) ; tie the shooter's id to the bullit..
	b.bullet = New bullet
	b\id = p\id
	
	b\mesh = CreateSphere(2)
	ScaleEntity b\mesh,0.2,0.2,0.2
	EntityColor b\mesh,255,255,0
	
	PositionEntity b\mesh,EntityX(p\mesh),EntityY(p\mesh),EntityZ(p\mesh)
	RotateEntity b\mesh,0,EntityYaw(p\mesh),0
	
	;MoveEntity b\mesh,0,0,2 ; so can't hit own player or little less easy..(no sure fix)
	EntityType b\mesh,3
	EntityRadius b\mesh,0.2
	
	SoundPlay (shoot, .5) ;shooting sound is started.
	
	b\time = MilliSecs()
	
End Function
</textarea> <br><br></td></tr></table><br>
<a name="1308796"></a>

<a name="1308797"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >eng_harvey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#181">[#181]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Rick Regarding the shooting thing; I might have a piece of code that does what you want - it works by releasing itself from the parent after a short distance and then it is able to kill anything in its path but does not damage its parent upon the traversal from shoot to the release distance.<br><br>Regarding the headache - do you get up often enough and stretch your legs and all that other jive as well as keep enough fluids up - I cant talk; I will sit there for hours anyway :)<br><br>I am not sure if that is what you are after but it is slightly different to what you have so it may even be interesting to look at for ideas.<br><br>There are three short functions involved - the first releases the bullet as a part of the parent until x distance - the second updates all bullet positions and the last one culls the bullet or takes action including sound upon a hit.<br><br>I think that is how it works - I wrote the code 4 months ago so it has been a while since I have seen it myself - However the code is easily accessible so if you want I am more than happy to share. Happy to help out with what I can - time pending!<br><br>I like the teleport functionality!<br><br>Anyhow great work - we will have to get together when we have some time and have a play!<br><br>:)<br><br>All the best to you Rick!<br><br>:) <br><br></td></tr></table><br>
<a name="1308825"></a>

<a name="1308836"></a>

<a name="1308837"></a>

<a name="1308838"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#182">[#182]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks. Shooting is working fine now, afaik, also close range. But never hurts to look at other code/ ways. <br>Ltrz. <br>&gt;&gt;edit: you'll just need to put a ';' before the line <br><pre class=code>
MoveEntity b\mesh,0,0,2 ; so can't hit own player or little less easy..(no sure fix)
</pre>in the Function CreateBullet() to allow close range shooting. <br><br></td></tr></table><br>
<a name="1308833"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >eng_harvey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#183">[#183]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Rick - that is great - I will give it a test run then - Thanks :) <br><br></td></tr></table><br>
<a name="1310212"></a>

<a name="1310213"></a>

<a name="1310214"></a>

<a name="1310216"></a>

<a name="1310217"></a>

<a name="1310218"></a>

<a name="1310219"></a>

<a name="1310222"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#184">[#184]</a></td></tr></table></td></tr><tr ><td class="posttext"> Update<br><br>V1.72.5u<br>-bugfix: wrong location after push / teleport resolved (most of the time).<br>-added jump pads.<br>-fixed negative fall value display.<br>-added close range/far range mode(only can shoot each other close range with pistol, not machinegun&lt;&lt; diff weapons not implemented yet:-)<br>-fixed jumping health deduction.<br><br>V1.72.5z<br>-Added bullets through teleports feature..<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">

</textarea><br>Currently can't add code into codebox above for getting an error, so download here: <a href="http://www.mediafire.com/download/n147k5ovuhvyrng/BUMP_V1.72.5z.bb" target="_blank">http://www.mediafire.com/download/n147k5ovuhvyrng/BUMP_V1.72.5z.bb</a><br><br>As this one's getting a bit lengthy, continuing here: <a href="/posts.php?topic=106466" target="_blank"><b>UDP LAN multiplayer(continued) Pt2</b></a> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
