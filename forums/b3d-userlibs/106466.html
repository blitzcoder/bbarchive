<!DOCTYPE html><html lang="en" ><head ><title >UDP LAN multiplayer (continued) Pt2</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >UDP LAN multiplayer (continued) Pt2</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=94" >Blitz3D Userlibs</a>/<a href="#bottom" >UDP LAN multiplayer (continued) Pt2</a><br><br>
<a name="1310220"></a>

<a name="1310221"></a>

<a name="1310223"></a>

<a name="1310224"></a>

<a name="1310225"></a>

<a name="1310226"></a>

<a name="1310227"></a>

<a name="1310228"></a>

<a name="1313529"></a>

<a name="1313530"></a>

<a name="1313531"></a>

<a name="1313534"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> (continuation of <a href="/posts.php?topic=104840#1310222" target="_blank"><b>LAN multiplayer(UDP)..</b></a> <br>NOTE: Flanker's UDP Library and media I'm using(audio) can also be found in for mentioned thread. <br><br><br>*** ROADMAP/HISTORY ***<br> This started off from Flanker's initial example code "ADVANCED 3D EXAMPLE.bb" for usage with his marvelous UDP lib V1.12.<br><br> Goal is to learn &amp; create a Blitz3D MultiPlayer example for the community.<br><br> I've decided to call it: <br><b> B.U.M.P. - Blitz3D's Ultimate Multi Player</b>, as a working title.<br><br> The conversion/extension to Hybrid could then be called(once on the road):<br><strike> H.U.M.P. - Hybrid's Ultimate Multi Player (DX9/11)</strike> &lt;&lt; nogo due to Ploppy's   unfortunate passing away..<br><br> Next best other possibilities are:<br><b> I.U.M.P. - Irrlicht's Ultimate Multi Player(DX9/OpenGL)</b><br><br> Or(less likely):<br> X.U.M.P. - Xors3D'a Ultimate Multi Player(DX9)<br>  <br><br><br> ---------------------------------------------------------------------------------------------------------------------------------------------<br><br> ADDED SO FAR: <br> -chattext colors matched to playercolors.<br> -different health strengths and spawn times.<br> -hide entities names when one player cannot see each other(so can play hide&amp;seek)..<br> -different health item strengths, which are also displayed above the <br>  item and take time to become available again depending on strenght.<br> -fixes to keybd input and window focus.<br> -sound fx(quicky, needs more work).<br><br> UPDATE 29-04-2016:<br> -lock/unlock mse + hud.focus to window switch 'f'.<br> -F1=help.<br> -F2=change player color on the fly.<br> -rapidfire toggle command.<br> <br> UPDATE 12-05-2016:<br> V1.66 fixed friendly fire bug.(no more shooting yourself in the foot, stommach or whatever :-)<br> V1.66.2 correctly displaying msg+snd.<br> V1.69.2:<br> -Added 2nd (and higher) ramp to fall and die from.<br> -F3=display current player coords.<br><br> V1.69.3:<br> -fixed bug where chat held onto keys that would turn into player controls after submit.e.g. space=jump.<br> -Temporary disabled health loss when falling ability.<br> -Changed death sound, fixed all sounds to play local and on networked players, <br>  added typwrittersounds for chat(only Local) and submit snd on network to attract attention.<br>  only 1 audio bug remaining: producing hit sound while actually collecting an item or when player(client)<br>  gets introduced into game (unclear why).<br><br> V1.69.5(14-05-2016): <br> -fixed fall bug aka (when enabled 'health loss when falling ability' it works, but also kills the player when running down a ramp)<br><br> V1.70.0(14-05-2016):<br> -Fixed bugs: health inacuracies. color at start always displaying ok on players.<br> <br> V1.72.4(21-05-2016):<br> -Added push player function. Caution: pushing someone requires energy. :-)<br><br> V1.72.5d(29-05-2016):<br> -Delay working. <br> -bug: wrong player getting color(mixed up, for not properly netsent)<br><br> V1.72.5t(02-06-2016):<br> -bugfix: Color working ok now.<br> -Immobility when dead also working.<br> -Now storing previous color and revives when.. well, revived of course.<br> -Added another chat cheat '/' command.<br> -Several bugfixes/optimizations.<br> -Added teleportation locations.<br> -Preventing players having same color.<br> -adjusted title bar.<br><br> V1.72.5u(13-06-2016):<br> -bugfix: wrong location after push / teleport resolved (most of the time).<br> -added jump pads.<br> -fixed negative fall value display.<br> -added close range/far range mode(only can shoot each other close range with pistol, not machinegun&lt;&lt; diff weapons not implemented yet:-)<br> -fixed jumping health deduction.<br><br> V1.72.5z(16-06-2016):<br> -Added bullets through teleports feature..<br><br><br> TODO UPTO VERSION 2.0 (not nesacerrily in this order, all using procedural gfx, without ext libs/media, except sound):<br> -ammo boxes.<br> -change click true defaults.<br> -default full screen when not locally testing.<br> -anim stars rotating above head, if dead squased char.<br> -bullit hit impact response<br> -test w gf, flanker or others. ;-) <br> -scorch marks on hit objects.<br> -fps /tps switch.<br> -weapon upgrades.<br> -collectable coins&lt; take/kill all=winner.  <br> -'/' cheatmodes and additional commands.<br> -flashlight,freelook + day nightcycle.<br> -add moving platforms demo code.<br> -game music. playing more exited when near an enemy.<br> -robo players with simple ai.<br> -gui with saveable prefs.<br> -simple animated chars.<br> -ladder climbing/crouching.<br> -walking, running and sounds to match.<br> -superjump powerup.<br> -shields.<br> -jumping pads.<br> -weather conditions. <br> -inventory/hud.<br><br> TODO FOR VERSION 3.0 (more advanced, incorporating media and ext libs):<br> -move to stayne's level.<br> -3d animated chars.<br> -AlienBreed 3d characters?<br> -Special effects, doors, etc.<br> -Vehicals/terrian.<br> -PhysX.<br> -Shadows.<br><br> IDEA'S:<br> -electrocution pads..<br> -colorpicker.<br><br><br> KNOWN BUGS:<br> -player dislocated after spawned(again?), mostly happens after pushing when player is dead..<br> -health not showing properly 0 but negative value after fatal fall.<br> -when too many players pushing each other system getting 'carried away'.<br> -when pushing another player into teleport or when the other player is dead then will return at old spot instead of new location.<br><br>Latest version of code here:<br><a href="http://www.mediafire.com/download/n147k5ovuhvyrng/BUMP_V1.72.5z.bb" target="_blank">http://www.mediafire.com/download/n147k5ovuhvyrng/BUMP_V1.72.5z.bb</a> <br><br></td></tr></table><br>
<a name="1310230"></a>

<a name="1310231"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RustyKristi</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> hey Rick. This is an awesome update! I have a question, do you still have copies of your previous versions? <br><br>It would be nice to have a history of the changes that you have made since Flanker's build.<br><br>EDIT: It looks like the links are still there, awesome! thanks :D <br><br></td></tr></table><br>
<a name="1310232"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> yeah in previous archives, not all of them but it's easy to compare with the original from Flanker using <a href="https://www.diffchecker.com/" target="_blank">https://www.diffchecker.com/</a><br>It highlights all changes. <br><br></td></tr></table><br>
<a name="1310233"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RustyKristi</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> thanks! <br><br></td></tr></table><br>
<a name="1310234"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> You're welcome. It's nappy time for me, so nighty night. ;-) <br><br></td></tr></table><br>
<a name="1310341"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just added player color flash on hit by bullet.  Works pretty good. Now adding flattened player after fatal fall ;-) <br>No code update yet, perhaps later today.<br>Next: adding Moving Platforms Demo into this..(hope it won't be too much of a hassle) <br><br></td></tr></table><br>
<a name="1310800"></a>

<a name="1310801"></a>

<a name="1310802"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Things are getting progressively more unreliable: wrong positions, colors &amp; life values after a pushed player died, which in part is explainable by my crappy coding(should have left server do all collision checking/updating).<br><br>So I went back to basics and found that even then whenever there's been a collision prior to re-spawn (it being a player or bullit) then the locations, life and colors are not properly updated and sometimes it just randomly happens. It apparently is unfixable by hiding, moving and showing the entities as well as by resetting them. <br><br>So my best guess is that this can happen due to UDP being an unreliable protocol. Now positions can be interpolated, but other stuff nogo, so is too sloppy for usage in a real game as intended. <br><br>Also it gets worse the more messaging is going on so.. Guess I'll have to throw the towel in the ring and pull the plug on this(which is a pity, for had plenty ideas if would have worked)..<br>:-( <br><br></td></tr></table><br>
<a name="1310805"></a>

<a name="1310808"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>So my best guess is that this can happen due to UDP being an unreliable protocol.<br> <br></div><br>Or due to a bad approach or to bad coding. <br><br></td></tr></table><br>
<a name="1310806"></a>

<a name="1310807"></a>

<a name="1310809"></a>

<a name="1310810"></a>

<a name="1310811"></a>

<a name="1310812"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> And to be more constructive, here is a hint of a better, more reliable approach (than sending positions) :<br><br>... i don't find the post, basically the idea is to have one separate server and several separate clients. Each client sends his player orientation and his input (actionstate), then the server manages the collisions detection and repositionning, then it sends back the new orientation, new position, new state of all players/projectiles, to all clients.<br>It is compatible with UDP, since if there is a missing packet for a client, the server does not wait for the new packet of a client, instead it uses the orientation and input/state of the previous packet.<br><br>This is most likely the approach they used for old games like unreal tournament or quake 3... <br><br></td></tr></table><br>
<a name="1310817"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm, well, bad coding is very well possible from my side for I'm not the world's greatest(and messy too lol). But from what I remember/afaik Quake3 used it like that and also the technique of peer2peer/host swapping is also available in other packages such as Unity, so would be great if Blitz3d has it.<br>It has the advantage(if working correctly) that one doesn't require hosting a server and will go on if the server is down. So independent of just about anything. Again: if everything is working correctly.<br>Drawback is of course that it might overcomplicate things.. <br><br></td></tr></table><br>
<a name="1310821"></a>

<a name="1310822"></a>

<a name="1310823"></a>

<a name="1310824"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> from the tests that i have done, UDP works well, some packets may take more time to travel and some may reach the destination in the wrong order (and some may never reach the destination)<br>In any case this should not provoke any error on your server or on the datas sent to the clients.<br>The worse that should happen (if it is coded with the right approach and without major bug) is that a client is expeled if no packet from him has been received after xs.<br><br>I don't see how you expect to have no problem with collisions detection and repositionning if you position an entity at a position instead of turning/moving it... It is like teleporting it. <br><br></td></tr></table><br>
<a name="1310838"></a>

<a name="1310839"></a>

<a name="1310844"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> @RemiD - True. You have a point there. Admitting, half the time I didn't know what I was doing and what the right approach regarding this networking stuff would be, therefore I've run into all sorts of unforeseen, unimagined things, so is a bit of a learning curve. <br><br>For instance how do you make sure that an entity color change occurs when hit on all players screen and health are update 100% accurate all of the time? If it loses a packet or something then it fails to do so. The only solution would be a constant pol I guess or do error checking, requesting resend(like TCP) but I don't think that would be a good idea or feasible with my limited skillset.<br><br>BTW: if you have any ideas on how to fix the player pushing player problem for instance (as this is using PositionEntity) feel free to adjust, that is if you have the time, energy and interest for that of course. ;-)<br><br><img src="http://i67.tinypic.com/28phl0.jpg"><br><br>Anyway, latest and greatest below for anyone interested, bit more bugfixed and cleaned(a little ;-) <br><i>Doesn't fit a code box(need to split), so download link for source, media(.wav files) and compiled version here</i> <a href="http://www.mediafire.com/download/61iyg4nx3d788el/UDPlibV1.12__BUMPV1.74.rar" target="_blank"><b>BUMP V1.74.bb</b></a> (3.62MB)<br><br>Changes/Fixes/Additions:<br> -added player squashed when fell to death.<br> -when get reintroduced to game players face to center of scene. <br> -added brief change of player color when hit feature.<br> -added squashed player when fallen and out of health.<br> -fixed teleport stuck in between 2 ports issue and adjusted ramp.(in future version put collision entity inside liquid mirror or something)<br> -changed detail on player sphere and spawn hill objects(more smooth)<br> -added two more chat commands<br> -fixed re-spawn fall costing life bug.<br> -reordered some code.<br> -fixed/updated color changes upon impact.<br><br>Pushing feature requires an overhaul/rethink for causing undesired fx, especially when more than 2 players pressent. <br><br></td></tr></table><br>
<a name="1310850"></a>

<a name="1310851"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> There is an old post by "Banshee" about a good approach to manage a multi clients + one server game, but i don't find it. Maybe try to find it...<br><br><div class="quote"> <br>For instance how do you make sure that an entity color change occurs when hit on all players screen and health are update 100% accurate all of the time? If it loses a packet or something then it fails to do so. <br> <br></div><br>It should be accurate only on the server, (where the important logic should be). The world will be slightly different on each client depending on if they have received a recent packet or not, but it does not matter because it is the server which decides if a new orientation new state is valid according to a previous state (with a tolerance)<br><br>With the approach that i suggest to use, those with a faster connection (lower ping) will be able to play more accurately than the others, because they can send more updates and receive more updates than those with a slowest connection (higher ping).<br>That's how i remember it was with unreal tournament or quake 3 or rune, sometimes, with my slow 56k it was difficult and confusing to play (because my state on the server was sometimes not updated fast enough, because probably not received)... <br><br></td></tr></table><br>
<a name="1310873"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> I thought about that ping approach too: when switching hosts the one with best (lowest)ping should become host /server. <br>Btw you can try running 2 instances of the game on your local machine (1 server, 1 client). Did you try this? That appears to work reasonably well? <br><br></td></tr></table><br>
<a name="1310882"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> No i have not tried anything, i am just sharing some concepts that may help you. I may try to code a multi players udp system in october just to see if i encounter the same problem than you, but it will depend on my mood and motivation at this time, so don't wait for it :P<br><br><br>Anyway, at least you have tried ! Some kudos for this ! <br><br></td></tr></table><br>
<a name="1310886"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> -A pity you haven't tried. If you're afraid of executables, like I am, it comes with full source so no need to run that(only included for the lazy people) :-) and the library itself is also a .bb file.<br><br>-October is still in a galaxy far far away, so lot's of things can happen, so indeed I won't hold my breath or wait up for it. ;-)<br><br>-Thanks, but I can't take full credits for Flanker's work: the UDP library, his example code and stuff other people dragged in. I merely came up with idea's and build upon it. Ok code grew form 24KB to 105KB, but that might just be poor coding. LOL <br><br></td></tr></table><br>
<a name="1310953"></a>

<a name="1310954"></a>

<a name="1310955"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> One thing that you could try, is to code a functional multi players system with one server + several clients by writing/reading binary files on the same computer, each binary file being like a packet.<br>You could simulate the loss of some packets or some packets reaching the destination in the wrong order. (an old packet reaching the destination after a new packet)<br>I thought to do that before continuing my experiments with UDP, because maybe your problem is not UDP but rather your multi players system (how it handles the loss of some packets and the wrong order of some packets and no packet at all after xs)... <br><br></td></tr></table><br>
<a name="1313528"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Tinkering around. Still not giving up.. :-) <br><br></td></tr></table><br>
<a name="1318685"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >eng_harvey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Rick Nasher<br><br>How is everything going with the UDP LAN multiplayer?<br><br>:) <br><br></td></tr></table><br>
<a name="1318688"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flanker</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> The initial goal of this library was to be able to switch server on the fly if the initial server disconnects. If you go with UDP you must keep track of packets order and lost packets, but this library doesn't do it.<br><br>It would be simpler to manage without the server switch functionnality. <br><br></td></tr></table><br>
<a name="1318692"></a>

<a name="1318693"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >eng_harvey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Flanker - I really like this library and the work you did on it! I am using ordered packets in my project! I really like the idea of server switching; the way I am going to tackle it is by having more than one server operational at a time that synchronizes data between them - I mainly want this to avoid DDOS attacks. I agree that this library would be simpler to manage without the switching. The concepts you used and coded are workable concepts in other areas of game networking.<br><br>I am just interested to see how Rick is doing with it all as I still find this project interesting.<br><br>:) <br><br></td></tr></table><br>
<a name="1318700"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flanker512</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> @eng_harvey<br>Thanks, I was hoping better results but it would need a complete rewrite at this point to integrate UDP checks. I hope my network code is not too crappy lol, after several months I don't even have the will to dig back into it ! I'm looking forward for infinitude, it seems you know what you are talking about so maybe we will finally have a good network library for B3D. <br><br></td></tr></table><br>
<a name="1318710"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> @eng_harvey<br>Hi, sorry haven't actually done much coding at all during summer holiday. Had to (and still do) take it easy sometimes due to a burnout I've suffered from since last year. :-( Taking it easy at the moment, first time I check here in weeks(and what do I find?? :-) <br><br>Was a bit demotivated too as I felt things were a bit hopeless, without the ordered packages feature and lacking the knowledge to incorporate this myself. <br>Still in love with the library and the host switching feature though. I demonstrated this to my friends and <i>they were very, very impressed with it's flexibility as we were able to play a multiplayer game without  hardly any effort and in no time at all</i>.<br><br>Pity Flanker is not too eager to put his teeth into it and perfect it to give the world the best multiplayer library Blitz3d deserves.. [hint-hint] ;-) <br><br></td></tr></table><br>
<a name="1318711"></a>

<a name="1318712"></a>

<a name="1318713"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>I felt things were a bit hopeless, without the ordered packages feature and lacking the knowledge to incorporate this myself<br> <br></div><br>ordered packets, or rather considering a newly received packet or not, is simply adding an id in each packet and if the now received packed has an id inferior to the last considered packet, discard it (because it is a too ancient packet), else if the now received packed has an id superior to the last considered packet, consider it (because it is a recent enough packet).<br><br>And of course the server can also keep a stack of received packets and each loop decide which ones it will consider and which ones it will discard.<br><br>That's how i understand it... <br><br></td></tr></table><br>
<a name="1318844"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >eng_harvey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> @RemiD - you understand it perfectly - that is exactly what it is. Even TCP uses it as a part of its reliability mechanism.<br><br>The server must keep track of each clients packets separately and the order in which its receives them discarding older more useless packets; and for those that are discarded another mechanism is embedded to make up for loss of resolution that would otherwise be taken care of by "perfect packets" - generally called interpolation. <br><br></td></tr></table><br>
<a name="1318849"></a>

<a name="1318850"></a>

<a name="1318851"></a>

<a name="1318866"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> @eng_harvey&gt;&gt;so in order to be able to identify the emitter of the packet and the packet number, you add 2 ids in each packet ? one id for the emitter and one id for the packet number ?<br><br>In my past tests, the id of the packet was a string corresponding to hour-minute-second-millisecond for example 12-21-20-100 and the id of the emitter was a byte... <br><br></td></tr></table><br>
<a name="1318858"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >eng_harvey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> @RemiD - Would you mind elaborating on what you mean by emitter? <br><br></td></tr></table><br>
<a name="1318859"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Flanker</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> @RemiD<br>you don't need the emitter ID, at least in blitz3d, because you can check a message IP and port (UDPMsgIP &amp; UDPMsgPort). The ID of the packet must be an incremental count, if you use millisecs you may send 2 packets with the same ID.<br><br>About discarding packets, yes you can discard older packets but not all. Some packets must be taken into account (for example a new player joins, a player dies...). It's not hard to check for them if they come in disorder, but what if they are lost ? I guess these packets need an acknoledgment. <br><br></td></tr></table><br>
<a name="1318861"></a>

<a name="1318862"></a>

<a name="1318863"></a>

<a name="1318864"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >eng_harvey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> Acknowledgments are a good idea. I am using the IP and I also setup a Map List (like a hash table) for players. I only acknowledge every third packet at the moment - this is to help speed things up - by the sounds of it you could use this emitter to search the hash table.<br><br>Regarding the time stamp I think using a cycling counter is more efficient - give the packets an order between 0 -&gt; 255 and when the last number is reached the counter returns to zero. That way the counter is always expecting a number bigger than zero and when the number goes over 254 then the counter is reset to zero. So 255 is 11111111 in binary and is a good use of packet size.<br><br>I hope I am making some sense here!<br><br>You could indeed identify a player by using 16 bits and this gives you 65536 ids to work with per server instance starting at zero and finishing at 65535 that way you are only using 3 bytes for user information and packet id combined!<br><br>Also by keeping packets a uniform size it makes it easier to encrypt them. <br><br></td></tr></table><br>
<a name="1318865"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> Or use an integer instead of a string : 122120100 <br><br></td></tr></table><br>
<a name="1318867"></a>

<a name="1318868"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Flanker&gt;&gt;If you don't add an emitter id in the packet, how do you know which client sent the packet ? <br><br></td></tr></table><br>
<a name="1318869"></a>

<a name="1318870"></a>

<a name="1318876"></a>

<a name="1318877"></a>

<a name="1318878"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >eng_harvey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#32">[#32]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think using bits instead of strings or integers is much faster - you would still have to convert from the integer to bits.<br><br>Your ids could then be easily hashed and the packet size is minimized.<br><br>So player 3 would be 0000-0000-0000-0011(16bit) and her/his packet number could be 234 or 1110-1010(8bit) equaling 3 bytes or 24 bits.<br><br>I like using strings and integers for testing the packets but would switch to bits for a production server.<br><br>I am assuming in Blitz3D you could use banks by peeking and poking at bytes to process this information(split the 3 bytes up by offset)! <br><br></td></tr></table><br>
<a name="1318879"></a>

<a name="1318880"></a>

<a name="1318881"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bobysait</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#33">[#33]</a></td></tr></table></td></tr><tr ><td class="posttext"> @RemiD:<br><div class="quote"> <br>@Flanker&gt;&gt;If you don't add an emitter id in the packet, how do you know which client sent the packet ? <br> <br></div><br>The standard blitz3d UDP commands can retrive the IP of the packet sent.<br>So, all you need is to maintain a list (or a hash map - which should be faster for this knid of stuff) with ip/player pairs.<br>Or ... you just loop the players and check if IP match with the UDP packet's IP.<br><br><br>@All : Interesting stuff here.<br>I won't help 'cause of lots of work, and from what I see, you don't really need anyone else to finish this community project, but I keep a look on this topic.<br><br>Some things you could (or not) consider :<br>- Don't create meshes for each objects, recycle ! (even for a simple sphere) -&gt; your bullets has no control for fire rate, so this can lead to an excessive memory management (and memory pointers will grow up very fast until you reach the 2 Go ram limit [blitz3d's exes are 32 bit applications, they can't use more than 2 with or without a 64bit computer/OS]. So be carefull with that, it may crash after a long period whithout let you know the reason)<br>Solution : Preload all models, hide them, then use CopyEntity (really really really faster)<br><br>- For the bullet part, blitz collisions is too slow and bullets are supposed to be fast (and while you're already averaging the player's positions, it's not very accurate, so, yuo can use this fact to improve the performance)<br>solution : anticipate the impact when the player shoots.<br>-&gt; use EntityPickMode instead of EntityType (also set the pickmode for the players and levels so that a linepick can pick everything relevant)<br>At the very moment the player shoots, a simple linepick from the bullet emitter along the emitter Z axis will  tell you if you'll pick something.<br>You can also use the distance divided by the bullet velocity to compute the real collision time.<br><br>- I'm sure of that, but I think I saw you used collisions for the power ups<br>(I might be wrong, I 've not been very concentrated while reading to the code)<br>Use a simple Distance test to check if a player is within a range from the item. (it will drastically speed up the collision process with less entity pairs to check)<br><br>(Then, the big part : interpolation between frames is generally the biggest part for a multiplayer game and the one that can lead to the worst behaviors)<br>- you're using the previous frame to interpolate with an old position, so your code will always show a wrong position (until the player is in standye)<br>solution : For modern stuff, they frequently anticipate the next position (not the previous ... or why not, to create a catmul rom interpolation).<br>By knowing the current position and the player's velocity, you can easily know where a player will be at the next frame (and actually after few frames, as players' inputs doesn't change that much)<br>So, anticipating the next position can give a better average position for other players (just keep in mind there will be times the position is wrong because the player suddently jumped or reverse the direction etc ... and that's the part that you'll have to deal with -&gt; what to do when the anticipated position leads to a wrong position. Commonly, bad engines just replace the player to a new position -&gt; it makes the player teleports, but ... in some way, it works, and players are used to that and arguably accept it as a cost to pay).<br><br>Finally, some tricks regarding security/collisions :<br>- A small trick to prevent some cheating : the server should generate a random key for each player, and they should always use it on top of each message.<br>- The server should always compute the collisions, moves etc ...<br>-&gt; if you want clients to do it to, they'll have to update from times to times to be synchronized with the server. And, to be true, blitz collision system is maybe a bit too heavy for a server. most of the collisions can be averaged in 2D before being really computed in 3D<br>(but it would mean to replace all collisions with a new collision library which is not the easiest thing on earth ... but maybe it could be a goal for a v3 or v4 or v...1000 ?)<br>Instead, you can use an hybrid system using blitz collisions only for the client-player Versus the level (no other collisions)<br>The rest can be acheived with sphere/sphere tests<br><br>- a project like this could maybe be more accessible on a github-like platform ? (just a suggestion)<br>Else, every one is waiting for the update from the last one who said he was working on it. (generally, it leads to the end of the project when the last guy just doesn't respond anymore) <br><br></td></tr></table><br>
<a name="1318882"></a>

<a name="1318886"></a>

<a name="1318888"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >eng_harvey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#34">[#34]</a></td></tr></table></td></tr><tr ><td class="posttext"> I am also wondering whether to start another thread so as not to pollute Ricks thread with too much information. There are three projects involved - the UDP LAN Multiplayer, The Infinitude Project and a C++ version of Infinitude I am working on called G2 Network.<br><br>I think I will download a copy of the UDP Lib and have a look at ordered packets - processing them via banks etc.<br><br>Adapting hermite interpolation via a polynomial function or maybe a newton polynomial should yield a derivative for a predicted position for players. I was thinking of something very simple for bullets - like some sort of set and forget function - the client could be used to help detect the collision along with the server.<br><br>I don't know; there is so many potential ways to build up game networks and game physics is getting better all the time.<br><br>I do think it is better to start with a solid basic framework and build it up to incorporate more complex issues as time goes by; it could yield many different applications for many different gameplay types.<br><br>With networking in Blitz3D I do think working within its bounds is the best idea so you can adapt the mathematics that is the best fit for it and I think with a little more work that this library could be acceptable for a number of game types. I am pretty certain the examples based upon it can be worked to provide a satisfying experience for each player.<br><br>It is late and I have been up for many hours - GitHub could be an awesome idea for all the projects.<br><br>:)<br><br>@Bobysait - Lots of interesting things to think about there - thanks! <br><br></td></tr></table><br>
<a name="1318889"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#35">[#35]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>The standard blitz3d UDP commands can retrive the IP of the packet sent.<br> <br></div><br>Oh ! I see, thanks for the info. <br><br></td></tr></table><br>
<a name="1318973"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#36">[#36]</a></td></tr></table></td></tr><tr ><td class="posttext"> How are you doing on this project, Rick Nasher?<br><br>~GF <br><br></td></tr></table><br>
<a name="1319123"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RustyKristi</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#37">[#37]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey Rick Nasher, I just tested the latest version you posted and for some reason you lose 1-3 health when you just do a normal jump from the ground? <br><br></td></tr></table><br>
<a name="1319241"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Guy Fawkes</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#38">[#38]</a></td></tr></table></td></tr><tr ><td class="posttext"> @RustiKristi : Yea, I know about that bug. It's not really a bug more than it is a calculation error. Try hiring the value of the variable that tells it "hey, lookk. You can only jump THIS high without damaging yourself" :)<br><br>Hope that helps! :)<br><br>~GF <br><br></td></tr></table><br>
<a name="1319263"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RustyKristi</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#39">[#39]</a></td></tr></table></td></tr><tr ><td class="posttext"> thanks, will check that out. maybe this will be corrected on next update <br><br></td></tr></table><br>
<a name="1319279"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >eng_harvey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#40">[#40]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Rick Nasher - I hope you are doing well - stay positive - I will be back in December to see how you are doing - don't worry about things - we have much time left to achieve results!<br><br>I know exactly what you mean by demotivation - I sometimes play a bit of Sim City 4(deluxe edition) or Need for Speed(Most Wanted)to take my mind off things. Even a bit of YouTube or just chilling with friends!<br><br>Maybe playing your favorite game and relaxing is the way to go!<br><br>The best thing is you have friends to chill out with!<br><br>Take it easy and see you soon!<br><br>:) <br><br></td></tr></table><br>
<a name="1319406"></a>

<a name="1319407"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rick Nasher</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#41">[#41]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi guys, <br>Thanks for all the input, ideas, kind words. <br><br>Burn-out symptoms come, go and back again. Doc told me it takes time, perhaps a lot of time, which is very annoying. Not really allowed to do anything that addresses thinking or performance, only dumb entertainment, but that's A)not very feasible at work and B}just so incredibly boring, bweehk! (can't take it really..) So I'm sort of sinning just being here already. lol<br><br><br>Anyway the 'bug' of loosing life while just jumping is actually intentional; I eventually want the player to loose a little energy/health just doing nothing and increasingly more when walking, running, swimming, jumping, falling, getting hit, pushing etc just as in real life, which has to be leveled by eating, drinking and health powerups/medicine. I feel this could add to the gameplay(if done well).<br><br>Meanwhile collecting coins/money to extend on wealth in order to not just pick up free weapons, food etc, but also have the option to buy better versions from merchants/shops/other players(you get the idea)and some capture the opponents flag thingies.<br><br>Some might like that, some don't. Always free to adjust to own likings of course. But for now I have to take it easy. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
