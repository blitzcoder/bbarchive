<!DOCTYPE html><html lang="en" ><head ><title >Loading PCX Images?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Loading PCX Images?</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=94" >Blitz3D Userlibs</a>/<a href="#bottom" >Loading PCX Images?</a><br><br>
<a name="505146"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blaine</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> (This is really for a BlitzPlus project, but it goes for Blitz3D just as much and there isn't any BlitzPlus userlib forum)<br><br>Hello, all!  I was wondering if a userlib to read image formats such as psd, tif, pcx, etc. exists and if so where I can find it?  I'm pretty sure that one exists, but I can't find it anywhere.  Here's what I need:<br>- The ability to load PCX images (8-bit ones)<br>- The ability to read palette entries in 8-bit PCX images*<br>- The ability to display the PCX images<br><br>* = Not mission-critical, but still wanted<br><br>Or, if no such userlib exists, could anyone code something that could do these things for me, or at least help me do so (I don't even know where to start if I have to do that)?  I'm hoping to have this project done soon, so any help on the matter would be appreciated.  Thanks for your time!<br><br>-Blaine <br><br></td></tr></table><br>
<a name="505174"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I guess not PSD since it's a complex format. TIF may be easy, (maybe there is already one in the code archives?) and I remember PCX already worls for textures, if I remember right. (Wasn't the runner demo using a PCX Texture?). In BLitz3D you could load it as a texture and then copyrect to a imagebuffer. Tho not sure how to do it in Blitz+. But I think PCX is a simple format too. Just get the format description, must be somewhere in the web. <br><br></td></tr></table><br>
<a name="505217"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Snarkbait</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Blitz3d does loads and displays .pcx images (not listed in the docs but I just tested it), not sure why b+ doesn't seem to. <br><br></td></tr></table><br>
<a name="505333"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blaine</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Blitz3D does it?  Wow, I never knew that.  I do have Blitz3D as well as BlitzPlus, so I suppose I could work something out with that if I need to...<br><br>-Blaine <br><br></td></tr></table><br>
<a name="505351"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Snarkbait</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> it wouldn't be too hard to do a blitz+ loader, I was looking in to the specs last night but it got too late, fairly simple file spec though. <br><br></td></tr></table><br>
<a name="505380"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blaine</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah, it doesn't look incredibly complex.  I found a site where they have the specs for it, so I'll try my hand at programming a PCX loading function in BlitzPlus...<br><br>-Blaine <br><br></td></tr></table><br>
<a name="505558"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Snarkbait</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here you go: this only will work on 256-color 8-bit pcx images, and only needed for blitz plus as shown above..<br><br>include file:<br><pre class=code>
;loadpcxfile.bb include
;blitz plus only, not needed for b3d
; only for 8-bit color pcx images

Dim pallette256(255,2)

Function loadPCXimage(image$)
	pcxfile = ReadFile(image$)
	If Not pcxfile RuntimeError "file not found"
	size = FileSize(image$)
	ident = ReadByte(pcxfile) ;should be 10
	version = ReadByte(pcxfile);should be 5
	encoding = ReadByte(pcxfile) ; should be 1
	bits_per_pixel = ReadByte(pcxfile)
	xmin = ReadShort(pcxfile)
	ymin = ReadShort(pcxfile)
	xmax = ReadShort(pcxfile)
	ymax = ReadShort(pcxfile)
	xsize = xmax - xmin + 1
	ysize = ymax - ymin + 1
	SeekFile(pcxfile,65)
	Nplanes = ReadByte(pcxfile)
	bytes_per_line = ReadShort(pcxfile)
	totalbytes = Nplanes * bytes_per_line
	; go to pallette header
	SeekFile(pcxfile,size - 769)
	a = ReadByte(pcxfile)
	If a = 12
		;read pallette
		For color_value = 0 To 255
			For RGB = 0 To 2
				readval = ReadByte(pcxfile)
				pallette256(color_value,RGB) = readval ;Shr 2
				;DebugLog pallette256(color_value,RGB)
			Next
		Next 
	EndIf
	SeekFile(pcxfile,128)
	newimage = CreateImage(xsize,ysize)
	SetBuffer ImageBuffer(newimage)
	xcount = 1:ycount = 1
	While Not Eof(pcxfile)
		readval = ReadByte(pcxfile)
		If (readval And $C0) = $C0

			pcnt = readval And $3F
			readval = ReadByte(pcxfile)
			For a = 1 To pcnt
				WritePixel xcount-1,ycount-1,argb(pallette256(readval,0),pallette256(readval,1),pallette256(readval,2))
				xcount = xcount + 1
				If xcount &gt; totalbytes xcount = 1:ycount = ycount + 1
				If ycount &gt; ysize Exit 
			Next
		Else
			WritePixel xcount-1,ycount-1,argb(pallette256(readval,0),pallette256(readval,1),pallette256(readval,2))
		 	xcount = xcount + 1
			If xcount &gt; totalbytes xcount = 1:ycount = ycount + 1
			If ycount &gt; ysize Exit
		EndIf
	Wend 
	CloseFile pcxfile
	Return newimage
End Function

Function argb(red,green,blue)
	Return (blue Or (green Shl 8) Or (red Shl 16) Or (255 Shl 24))
End Function 

</pre><br><br>Test file:<br><br><pre class=code>
Include "loadpcxfile.bb"

Global main = CreateWindow("PCX Loader",0,0,800,600,0,1)
canvas = CreateCanvas(0,0,800,600,main)


this$ = RequestFile$("Open PCX Image","pcx")

convertedimage = loadpcximage(this$)

SetBuffer CanvasBuffer(canvas)
DrawImage convertedimage,0,0
FlipCanvas canvas
WaitKey()
End 

</pre><br><br>put in the code archives, optimized with writepixelfast here:<br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=1342" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=1342</a> <br><br></td></tr></table><br>
<a name="505873"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blaine</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Great, it works!  Thanks a million (I don't know if I could've done that even if I worked on it for days)!  I'm hoping I can have this project done soon... it'll be the first Blitz Basic program that I've ever released, so thanks again for helping me out!  (I'll be sure to give credit!)<br><br>-Blaine <br><br></td></tr></table><br>
<a name="505912"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Snarkbait</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Cool.. glad I could help you out. Note that the pallette of the image is there in an array if you want to access it, in array 'Pallette256(255,2)' the first number is the color index number 0 - 255 and the second number is for RGB values, R = 0, 1 = G, 2 = B. <br><br></td></tr></table><br>
<a name="506190"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >EddieRay</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wouldn't the palette array need to be declared as:<br><br>Dim Palette(256,3)<br><br>in order to have index values from 0..255 and 0..2?  I'm a C programmer, and I thought Blitz arrays worked the same way as C... <br><br></td></tr></table><br>
<a name="506325"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Snarkbait</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nope. You can dimension them that way if you want, but there will be an unused element. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
