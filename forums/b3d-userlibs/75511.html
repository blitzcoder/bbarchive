<!DOCTYPE html><html lang="en" ><head ><title >Working on new dll to extend Blitz3d</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Working on new dll to extend Blitz3d</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=94" >Blitz3D Userlibs</a>/<a href="#bottom" >Working on new dll to extend Blitz3d</a><br><br>
<a name="843739"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Billp</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Now that blitz3d is "finalized", I am writing a dll to extend blitz3d and have added the following commands<br><br>;Distance<br><br>BP_Distance2d#(x1#,y1#,x2#,y2#) : "Distance2D@16"<br>BP_Distance3d#(x1#,y1#,z1#,x2#,y2#,z2#) : "Distance3D@24"<br>BP_PointInRect#(x1#,y1#,rx#,ry#,rw#,rh#) : "PointInRect@24"<br><br>;Camera<br><br>BP_GetCamClsMode%(camera,index$) : "GetCamClsMode@8" ; index$ = "Color" Or "Zbuffer"<br>BP_GetCamClsColorR%(camera) : "GetCamClsColorR@4"<br>BP_GetCamClsColorG%(camera) : "GetCamClsColorG@4"<br>BP_GetCamClsColorB%(camera) : "GetCamClsColorB@4"<br>BP_GetCamProjMode%(camera) : "GetCamProjMode@4"<br>BP_GetCamRangeNear#(camera) : "GetCamRangeNear@4"<br>BP_GetCamRangeFar#(camera) : "GetCamRangeFar@4"<br>BP_GetCamZoom#(camera) : "GetCamZoom@4"<br>BP_GetCamViewPortX%(camera) : "GetCamViewPortX@4"<br>BP_GetCamViewPortY%(camera) : "GetCamViewPortY@4"<br>BP_GetCamViewPortW%(camera) : "GetCamViewPortW@4"<br>BP_GetCamViewPortH%(camera) : "GetCamViewPortH@4"<br>BP_GetCamFogMode%(camera) : "GetCamFogMode@4"<br>BP_GetCamFogNear#(camera) : "GetCamFogNear@4"<br>BP_GetCamFogFar#(camera) : "GetCamFogFar@4"<br>BP_GetCamFogColorR%(camera) : "GetCamFogColorR@4"<br>BP_GetCamFogColorG%(camera) : "GetCamFogColorG@4"<br>BP_GetCamFogColorB%(camera) : "GetCamFogColorB@4"<br><br>;Light<br><br>BP_SetLightType%(light,style) : "SetLightType@8"<br>BP_SetLightDiffuse%(light,red,green,blue,alpha#) : "SetLightDiffuse@20"<br>BP_SetLightSpecular%(light,red,green,blue,alpha#) : "SetLightSpecular@20"<br>BP_SetLightAmbient%(light,red,green,blue,alpha#) : "SetLightAmbient@20"<br>BP_SetLightMaxRange%(light,range#) : "SetLightMaxRange@8"<br>BP_GetLightType%(light) : "GetLightType@4"<br>BP_GetLightMaxRange#(light) : "GetLightMaxRange@4"<br>BP_GetLightRange#(light) : "GetLightRange@4"<br>BP_GetLightInner#(light) : "GetLightInner@4"<br>BP_GetLightOuter#(light) : "GetLightOuter@4"<br>BP_GetLightDiffuseR%(light) : "GetLightDiffuseR@4"<br>BP_GetLightDiffuseG%(light) : "GetLightDiffuseG@4"<br>BP_GetLightDiffuseB%(light) : "GetLightDiffuseB@4"<br>BP_GetLightDiffuseA#(light) : "GetLightDiffuseA@4"<br>BP_GetLightSpecularR%(light) : "GetLightSpecularR@4"<br>BP_GetLightSpecularG%(light) : "GetLightSpecularG@4"<br>BP_GetLightSpecularB%(light) : "GetLightSpecularB@4"<br>BP_GetLightSpecularA#(light) : "GetLightSpecularA@4"<br>BP_GetLightAmbientR%(light) : "GetLightAmbientR@4"<br>BP_GetLightAmbientG%(light) : "GetLightAmbientG@4"<br>BP_GetLightAmbientB%(light) : "GetLightAmbientB@4"<br>BP_GetLightAmbientA#(light) : "GetLightAmbientA@4"<br><br>;Entity<br><br>BP_GetEntityAlpha#(entity) : "GetEntityAlpha@4"<br>BP_GetEntityScaleX#(entity) : "GetEntityScaleX@4"<br>BP_GetEntityScaleY#(entity) : "GetEntityScaleY@4"<br>BP_GetEntityScaleZ#(entity) : "GetEntityScaleZ@4"<br>BP_GetEntityAutoNear#(entity) : "GetEntityAutoNear@4"<br>BP_GetEntityAutoFar#(entity) : "GetEntityAutoFar@4"<br>BP_GetEntityOrder%(entity) : "GetEntityOrder@4"<br>BP_GetNextEntity%(entity) : "GetNextEntity@4"<br>BP_GetLastEntity%(entity) : "GetLastEntity@4"<br>BP_GetEntityHidden%(entity) : "GetEntityHidden@4"<br>BP_GetEntityRadiusX#(entity) : "GetEntityRadiusX@4"<br>BP_GetEntityRadiusY#(entity) : "GetEntityRadiusY@4"<br>BP_GetEntityBoxX#(entity) : "GetEntityBoxX@4"<br>BP_GetEntityBoxY#(entity) : "GetEntityBoxY@4"<br>BP_GetEntityBoxZ#(entity) : "GetEntityBoxZ@4"<br>BP_GetEntityBoxW#(entity) : "GetEntityBoxW@4"<br>BP_GetEntityBoxH#(entity) : "GetEntityBoxH@4"<br>BP_GetEntityBoxD#(entity) : "GetEntityBoxD@4"<br>BP_GetEntityPickmode%(entity) : "GetEntityPickmode@4"<br>BP_GetEntityObscurer%(entity) : "GetEntityObscurer@4"<br>BP_GetEntityColorR%(entity) : "GetEntityColorR@4"<br>BP_GetEntityColorG%(entity) : "GetEntityColorG@4"<br>BP_GetEntityColorB%(entity) : "GetEntityColorB@4"<br>BP_GetEntityShine#(entity) : "GetEntityShine@4"<br>BP_GetEntityBlend%(entity) : "GetEntityBlend@4"<br>BP_GetEntityFX%(entity) : "GetEntityFX@4"<br><br>;Texture<br><br>BP_GetTextureBlend%(texture) : "GetTextureBlend@4"<br>BP_GetTextureCoords%(texture) : "GetTextureCoords@4"<br>BP_GetTextureScaleU#(texture) : "GetTextureScaleU@4"<br>BP_GetTextureScaleV#(texture) : "GetTextureScaleV@4"<br>BP_GetTexturePositionU#(texture) : "GetTexturePositionU@4"<br>BP_GetTexturePositionV#(texture) : "GetTexturePositionV@4"<br>BP_GetTextureRotation#(texture) : "GetTextureRotation@4"<br>BP_GetTextureFlags%(texbuffer) : "GetTextureFlags@4"<br>BP_GetBufferDepth%(texbuffer) : "GetBufferDepth@4"<br> <br><br>;Brush<br><br>BP_GetBrushBlend%(brush) : "GetBrushBlend@4"<br>BP_GetBrushColorRGB%(brush) : "GetBrushColorRGB@4"<br>BP_GetBrushColorR%(brush) : "GetBrushColorR@4"<br>BP_GetBrushColorG%(brush) : "GetBrushColorG@4"<br>BP_GetBrushColorB%(brush) : "GetBrushColorB@4"<br>BP_GetBrushFX%(brush) : "GetBrushFX@4"<br>BP_GetBrushShininess#(brush) : "GetBrushShininess@4"<br>BP_GetBrushAlpha#(brush) : "GetBrushAlpha@4"<br><br>;Color Conversion<br><br>BP_GetIntRed%(IntColor) : "GetIntRed@4"<br>BP_GetIntGreen%(IntColor) : "GetIntGreen@4"<br>BP_GetIntBlue%(IntColor) : "GetIntBlue@4"<br>BP_GetIntAlpha%(IntColor) : "GetIntAlpha@4"<br>BP_GetRGBInt%(r,g,b) : "GetRGBInt@12"<br>BP_GetRGBAInt%(r,g,b,a) : "GetRGBAInt@16"<br><br>;Math<br><br>BP_CurveValue#(newvalue#,oldvalue#,increments#) : "CurveValue@12"<br>BP_WrapValue#(value#,lo#,hi#) : "WrapValue@12"<br>BP_ClampValue#(value#,lo#,hi#) : "ClampValue@12"<br>BP_Min#(value1#,value2#) : "Min@8"<br>BP_Max#(value1#,value2#) : "Max@8"<br><br>;Memory<br><br>BP_PeekByte%(adress) : "PeekByte@4"<br>BP_PeekShort%(adress) : "PeekShort@4"<br>BP_PeekInt%(adress) : "PeekInt@4"<br>BP_PeekFloat#(address) : "PeekFloat@4"<br><br>BP_PokeByte(adress,value%) : "PokeByte@8"<br>BP_PokeShort(address,value%) : "PokeShort@8"<br>BP_PokeInt(adress,value%) : "PokeInt@8"<br>BP_PokeFloat(address,value#) : "PokeFloat@8"<br><br>many of these were available with previous dll's created by other members of the community but have broken with subsequent updates etc. I would like to add a few functions to manipulate images/textures and specifically am trying to determine the offset to the actual pixel data (imagebuffer + 72 no longer is correct) and would appreciate any info I can get on this or any other internals.<br><br>I will make this dll available to the community at large upon completion.<br><br>thanks, Bill <br><br></td></tr></table><br>
<a name="843894"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nice. Always welcome. <br><br></td></tr></table><br>
<a name="843942"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SabataRH</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nice looking lib. <br><br></td></tr></table><br>
<a name="844130"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MadJack</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Should be useful. Much appreciated. <br><br></td></tr></table><br>
<a name="844875"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >puki</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Any time scale on this? <br><br></td></tr></table><br>
<a name="845066"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Billp</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> What you see listed here is already complete, have contacted a few members who have done similiar work in the past re:offsets I am having trouble resolving and am awaiting their replies, next coupla days. <br><br></td></tr></table><br>
<a name="845130"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Bill, will you be adding the source??? <br><br></td></tr></table><br>
<a name="845217"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Billp</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> If not the source itself, I will include a list of all viable offesets I have been able to find so others can build upon them <br><br></td></tr></table><br>
<a name="845586"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> specifically am trying to determine the offset to the actual pixel data (imagebuffer + 72 no longer is correct) <br></div><br><br>I don't understand. I have b3d 1.99 and the pixel data offset is still imagebuffer+72. This code works.<br><br>Edit: you need to include <a href="/codearcs.php?code=1751" target="_blank">MemoryAccess.bb</a><br><pre class=code>
;Image pixel data offset

Include "MemoryAccess.bb"

Graphics 640,480,0,2
SetBuffer BackBuffer()

image=LoadImage("test.bmp") ;8x8
bufferimage=ImageBuffer(image)

WritePixel 0,0,33,bufferimage
WritePixel 1,0,44,bufferimage
WritePixel 2,0,55,bufferimage

width=PeekI(bufferimage+92) ;bufferimage+28 for Blitz+ not tested !!
height=PeekI(bufferimage+96) ;bufferimage+32
videoaddress=PeekI(bufferimage+72) ;bufferimage+76

Dim pixel(8,8)

pixel(0,0)=PeekB(videoaddress)
pixel(1,0)=PeekB(videoaddress+4)
pixel(2,0)=PeekB(videoaddress+8)

Print "bufferimage="+bufferimage
Print "width="+width
Print "height="+height
Print "videoaddress="+videoaddress
Print "pixel(0,0)="+pixel(0,0)
Print "pixel(1,0)="+pixel(1,0)
Print "pixel(2,0)="+pixel(2,0)
Print ""

For offset=0 To 12-1
 byte=PeekB(videoaddress+offset)
 Print "address="+(videoaddress+offset)+" byte="+byte
Next
Print ""

For offset=0 To 12-1 Step 4
 rgba=PeekI(videoaddress+offset)
 PokeI(videoaddress+offset,$FF0000) ;Red
 Print "address="+(videoaddress+offset)+" rgba="+rgba
Next
Print ""

Print "Let's see what we poked in"
For offset=0 To 12-1 Step 4
 rgba=PeekI(videoaddress+offset)
 Print "address="+(videoaddress+offset)+" rgba="+Hex(rgba)
Next

DrawImage image,256,16

WaitKey()
End
</pre> <br><br></td></tr></table><br>
<a name="845659"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Billp</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> I was working with a loaded texture ( not an image ) at the time and +72 is 0 until the buffer has been locked/unlocked (possibly updated with other actions, I don't know) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
