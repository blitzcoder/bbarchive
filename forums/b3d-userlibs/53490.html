<!DOCTYPE html><html lang="en" ><head ><title >JV-ODE Physics Thread 5</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >JV-ODE Physics Thread 5</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=94" >Blitz3D Userlibs</a>/<a href="#bottom" >JV-ODE Physics Thread 5</a><br><br>
<a name="597562"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> The JV-ODE user library contains almost all of the ODE functions wrapped inside a DLL.<br><br>The library can be used in any programming language that supports DLL's, including Blitz3D and BlitzPlus. The functions have been adapted to use euler angles (the same coordinate system as Blitz3D), however functions for accessing quaternion angles are also included. The download contains all of the necessary files to get you started, including some simple demos showing various ODE objects and TriMesh collisions.<br><br>To view more information and screenshots <a href="http://www.devcode.co.uk/jv-ode.html" target="_blank">click here</a>.<br><br>Options are now available to purchase the wrapper using either PayPal or Share*it.<br><br>The <b>restricted demo version</b> is now available for download <a href="http://www.devcode.co.uk/dload/JV-ODE-Physics-Demo.zip" target="_blank">here</a> (185KB)<br><br>Have Fun :)<br><br>Previous JV-ODE Threads: <a href="/posts.php?topic=43653" target="_blank">1</a> <a href="/posts.php?topic=45048" target="_blank">2</a> <a href="/posts.php?topic=48743" target="_blank">3</a> <a href="/posts.php?topic=52572" target="_blank">4</a><br>JV-ODE <a href="http://playerfactory.proboards25.com/" target="_blank">Player Factory</a> Forum<br><br>Useful Links: <a href="http://www.ode.org/" target="_blank">ODE.org Website</a> - <a href="http://www.ode.org/ode-latest-userguide.pdf" target="_blank">ODE User Guide (PDF)</a> - <a href="http://www.ode.org/ode-latest-userguide.html" target="_blank">ODE User Guide (HTML)</a> - <a href="http://q12.org/pipermail/ode/" target="_blank">ODE Archives</a> <br><br></td></tr></table><br>
<a name="597978"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here's a Car &amp; Trailer Demo as requested by EmerGki...<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #										  JV-ODE Car Demo											#
; #									Code by Jim Williams (VIP3R)									#		#
; #						Feel free to use this code, any credit appreciated							#
; ###################################################################################################

AppTitle "JV-ODE Car &amp; Trailer Demo"

Include "JV-ODE.bb"

Graphics3D 800,600,0,2

Global CMass#=200			; ### Car Mass
Global WMass#=14			; ### Wheel Mass
Global TMass#=80			; ### Trailer Mass

Global WorldERP#=1			; ### World Error Correction
Global WorldFriction#=70	; ### World Friction
Global HingeTorque#=24		; ### Hinge Torque
Global SuspensionHS#=0.01	; ### Hinge Suspension Hardness/Softness (Higher=Softer - Lower=Harder)

Global Speed#=0
Global Steer#=0

Global Car
Global CGeom
Global CMesh

Global Trailer
Global TGeom
Global TMesh

Global CarStartY=4

Dim Wheel(4)
Dim WGeom(4)
Dim Joint(4)

Dim TWheel(2)
Dim TWGeom(2)
Dim TJoint(2)

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

; ###################################################################################################

; ### Setup ODE

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,-0.98,0)
dWorldSetERP(World,WorldERP)

dContactSetMode(dContactSlip1)
dContactSetMu(WorldFriction)

; ### Create car body

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
Car=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,0,CarStartY,0)
mass=dMassCreate()
dMassSetBoxTotal(mass,CMass,3,1,5)
dMassTranslate(mass,0,-1,0)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
ode\geom=dCreateBox(Space,3,1,5)
CGeom=ode\geom
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
CMesh=ode\mesh
ScaleMesh ode\mesh,1.5,0.5,2.5
RotateMesh ode\mesh,0,0,0
PositionMesh ode\mesh,0,0,0
EntityColor ode\mesh,40,80,255
EntityAlpha ode\mesh,1

; ### Create wheels

For count=1 To 4
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	Wheel(count)=ode\body
	dBodySetRotation(ode\body,0,0,0)
	dBodySetPosition(ode\body,0,0,0)
	mass=dMassCreate()
	dMassSetSphereTotal(mass,WMass,0.7)
	dBodySetMass(ode\body,mass)
	dMassDestroy(mass)
	ode\geom=dCreateSphere(Space,0.7)
	WGeom(count)=ode\geom
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder(8)
	ScaleMesh ode\mesh,0.7,0.25,0.7
	RotateMesh ode\mesh,0,0,90
	PositionMesh ode\mesh,0,0,0
	EntityColor ode\mesh,255,255,255
Next

dBodySetPosition(Wheel(1),-2,CarStartY-0.5,+2)
dBodySetPosition(Wheel(2),+2,CarStartY-0.5,+2)
dBodySetPosition(Wheel(3),-2,CarStartY-0.5,-2)
dBodySetPosition(Wheel(4),+2,CarStartY-0.5,-2)

; ### Create trailer

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
Trailer=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,0,CarStartY+2,-9.5)
mass=dMassCreate()
dMassSetBoxTotal(mass,TMass,3,3,18)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
ode\geom=dCreateBox(Space,3,3,18)
TGeom=ode\geom
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
TMesh=ode\mesh
ScaleMesh ode\mesh,1.5,1.5,9
RotateMesh ode\mesh,0,0,0
PositionMesh ode\mesh,0,0,0
EntityColor ode\mesh,20,40,128
EntityAlpha ode\mesh,1

; ### Create trailer wheels

For count=1 To 2
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	TWheel(count)=ode\body
	dBodySetRotation(ode\body,0,0,0)
	dBodySetPosition(ode\body,0,0,0)
	mass=dMassCreate()
	dMassSetSphereTotal(mass,WMass,0.7)
	dBodySetMass(ode\body,mass)
	dMassDestroy(mass)
	ode\geom=dCreateSphere(Space,0.7)
	TWGeom(count)=ode\geom
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder(8)
	ScaleMesh ode\mesh,0.7,0.25,0.7
	RotateMesh ode\mesh,0,0,90
	PositionMesh ode\mesh,0,0,0
	EntityColor ode\mesh,255,255,255
Next

dBodySetPosition(TWheel(1),-2,CarStartY-0.5,-17)
dBodySetPosition(TWheel(2),+2,CarStartY-0.5,-17)

; ### Create some objects

SeedRnd MilliSecs()

For spheres=1 To 20
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	dBodySetRotation(ode\body,0,0,0)
	dBodySetPosition(ode\body,Rnd(-100,100),30,Rnd(-100,100))
	ode\geom=dCreateSphere(Space,4)
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateSphere()
	ScaleMesh ode\mesh,4,4,4
	RotateMesh ode\mesh,0,0,0
	PositionMesh ode\mesh,0,0,0
	EntityColor ode\mesh,Rnd(255),Rnd(255),Rnd(255)
	EntityAlpha ode\mesh,1
	EntityShininess ode\mesh,0.7
Next

For cylinders=1 To 20
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	dBodySetRotation(ode\body,90,0,0)
	dBodySetPosition(ode\body,Rnd(-100,100),30,Rnd(-100,100))
	ode\geom=dCreateCCylinder(Space,1,8)
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder(8)
	ScaleMesh ode\mesh,1,5,1
	RotateMesh ode\mesh,90,0,0	; &lt;&lt;&lt; Mesh X-Axis must be rotated 90 degrees to fix cylinder alignment
	PositionMesh ode\mesh,0,0,0
	EntityColor ode\mesh,Rnd(255),Rnd(255),Rnd(255)
	EntityAlpha ode\mesh,1
	EntityShininess ode\mesh,0.7
Next

; ### Create light

Global Light=CreateLight()

RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera

Global CameraPivot=CreatePivot(CMesh)
PositionEntity CameraPivot,0,2,-7

Global Camera=CreateCamera()
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000

; ### Create plane

dCreatePlane(Space,0,1,0,0)

Plane=CreatePlane()

EntityAlpha Plane,0.8

PlaneTexture=CreateTexture(128,128,9)

ClsColor 0,200,80
Cls

Color 255,255,255

Rect 0,0,64,64,1
Rect 64,64,64,64,1

CopyRect 0,0,128,128,0,0,BackBuffer(),TextureBuffer(PlaneTexture)
ScaleTexture PlaneTexture,20,20
EntityTexture Plane,PlaneTexture,0,0

Mirror=CreateMirror()

; ###################################################################################################

; ### BLITZ STATIC OBJECT (White)

blitzobject=CreateCube()
ScaleMesh blitzobject,1,4,20
RotateMesh blitzobject,-10,8,4
PositionMesh blitzobject,10,5,40

EntityColor blitzobject,255,255,255
EntityAlpha blitzobject,1

; ### ODE STATIC OBJECT (Blue)

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,2,8,40)
dGeomSetRotation(ode\geom,-10,8,4)
dGeomSetPosition(ode\geom,20,5,40)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,1,4,20
RotateMesh ode\mesh,0,0,0
PositionMesh ode\mesh,0,0,0

EntityColor ode\mesh,0,100,200
EntityAlpha ode\mesh,1

; ### ODE STATIC OBJECT (Red)

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,18,0.2,40)
dGeomSetRotation(ode\geom,-14,0,0)
dGeomSetPosition(ode\geom,-20,4.9,40)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,9,0.1,20
RotateMesh ode\mesh,0,0,0
PositionMesh ode\mesh,0,0,0

EntityColor ode\mesh,200,0,100
EntityAlpha ode\mesh,1

; ###################################################################################################

SetupCar()

While Not KeyHit(1)

	UpdateKeys()

	PTime=MilliSecs()

	UpdateCar()

	UpdateGeoms()

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)

	PhysicsTime#=MilliSecs()-PTime

	UpdateCam()

	UpdateWorld

	RenderWorld

	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime
	Text 0,30,"Car Speed:"+Speed
	Text 640,0,"A - Accelerate"
	Text 640,15,"Z - Brake/Reverse"
	Text 640,30,"Arrows - Steering"
	Text 640,45,"Space - Reset Car"

	Flip

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function SetupCar()

For count=1 To 4
	Joint(count)=dJointCreateHinge2(World,0)
	dJointAttach(Joint(count),Car,Wheel(count))
	dJointSetHinge2Anchor(Joint(count),dBodyGetPositionX(Wheel(count)),dBodyGetPositionY(Wheel(count)),dBodyGetPositionZ(Wheel(count)))
	dJointSetHinge2Axis1(Joint(count),0,1,0)
	dJointSetHinge2Axis2(Joint(count),-1,0,0)
	dJointSetHinge2Param(Joint(count),dParamSuspensionERP,0.8)
	dJointSetHinge2Param(Joint(count),dParamSuspensionCFM,SuspensionHS)
	If count&gt;2
		dJointSetHinge2Param(Joint(count),dParamLoStop,0)
		dJointSetHinge2Param(Joint(count),dParamHiStop,0)
		End If
Next

For count=1 To 2
	TJoint(count)=dJointCreateHinge2(World,0)
	dJointAttach(TJoint(count),Trailer,TWheel(count))
	dJointSetHinge2Anchor(TJoint(count),dBodyGetPositionX(TWheel(count)),dBodyGetPositionY(TWheel(count)),dBodyGetPositionZ(TWheel(count)))
	dJointSetHinge2Axis1(TJoint(count),0,1,0)
	dJointSetHinge2Axis2(TJoint(count),-1,0,0)
	dJointSetHinge2Param(TJoint(count),dParamSuspensionERP,0.8)
	dJointSetHinge2Param(TJoint(count),dParamSuspensionCFM,SuspensionHS)
	dJointSetHinge2Param(TJoint(count),dParamLoStop,0)
	dJointSetHinge2Param(TJoint(count),dParamHiStop,0)
Next

AJoint=dJointCreateHinge(World,0)
dJointAttach(AJoint,Trailer,Car)
dJointSetHingeAnchor(AJoint,dBodyGetPositionX(Car),dBodyGetPositionY(Car),dBodyGetPositionZ(Car))
dJointSetHingeAxis(AJoint,0,1,0)
dJointSetHingeParam(AJoint,dParamSuspensionERP,0.8)
dJointSetHingeParam(AJoint,dParamSuspensionCFM,SuspensionHS)
dJointSetHingeParam(AJoint,dParamLoStop,-1)
dJointSetHingeParam(AJoint,dParamHiStop,1)

Speed=0

End Function

; ###################################################################################################

Function UpdateKeys()

If KeyDown(30)=1
	Speed=Speed+0.08
	If Speed&gt;30 Then Speed=30
	End If

If KeyDown(44)=1
	Speed=Speed-0.1
	If Speed&lt;-10 Then Speed=-10
	If Speed&gt;0 Then Speed=Speed*0.97
	End If

If KeyDown(30)=0 And KeyDown(44)=0 Then Speed=Speed*0.99

If KeyDown(203)=1 Or KeyDown(205)=1
	If KeyDown(203)=1
		Steer=0.5
		Else
		Steer=-0.5
		End If
	Else
	Steer=0
	End If

If KeyHit(57)=1
	Speed=0
	dBodySetRotation(Car,0,0,0)
	dBodySetRotation(Trailer,0,0,0)
	End If

End Function

; ###################################################################################################

Function UpdateCar()

For count=1 To 4
	dBodyEnable(Wheel(count))
Next

dBodyEnable(Car)

For count=1 To 4
	dJointSetHinge2Param(Joint(count),dParamVel2,Speed)
	dJointSetHinge2Param(Joint(count),dParamFMax2,HingeTorque)
Next

For count=1 To 2
	angle#=Steer-dJointGetHinge2Angle1(Joint(count))
	dJointSetHinge2Param(Joint(count),dParamVel,angle)
	dJointSetHinge2Param(Joint(count),dParamFMax,400)
Next

End Function

; ###################################################################################################

Function UpdateCam()

PositionEntity CameraPivot,0,18,-28

camx#=EntityX(CameraPivot,1)-EntityX(Camera)
camy#=EntityY(CameraPivot,1)-EntityY(Camera)
camz#=EntityZ(CameraPivot,1)-EntityZ(Camera)

TranslateEntity Camera,camx*0.5,camy*0.5,camz*0.5

PointEntity Camera,CMesh

End Function

; ###################################################################################################

Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
	RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
	PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
Next

End Function

; ###################################################################################################
</textarea> <br><br></td></tr></table><br>
<a name="598058"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >OJay</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> hm. you know what? why always make standalone demos of different features of ode? shouldn't we try to do a library, which would simplify the creation of complex simulations?<br><br>i'm thinking about something like:<br><br><pre class=code>
myRagdoll = dCreateRagDoll(2,2,1,0) ; creates a ragdoll with 2 arms, 2 legs, 1 head and 0 trails
myCar = dCreateCar(2,true) ; creates a car with 2 axes and frontwheel-steering

etc for all a lot of other types of physics
</pre><br><br>wouldn't that be something? <br><br></td></tr></table><br>
<a name="598063"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KuRiX</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, this is difficult, a car is something more than 2 parameters. You must decide masses, sizes of geom, suspension, etc...<br><br>Perhaps if you make a 20 parameters function... <br><br></td></tr></table><br>
<a name="598069"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> The standalone demos are better for showing new ODE users how to access individual parts of the ODE library.<br><br>If anyone wants to make some prebuilt functions for creating different complex objects that's fine with me :) <br><br></td></tr></table><br>
<a name="598148"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >EmerGki</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Very Thanks Vip3r, I'm Very Happy with this =).<br><br>Thank's Again! A Great Embrace! <br><br></td></tr></table><br>
<a name="598222"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dripht</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is it just me or do regular cylinders ignore collision with trimeshes??<br><br>Edit: sorry, didn't entirely read the past threads. <br><br></td></tr></table><br>
<a name="598223"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> @EmerGki: You're welcome :)<br><br>@Dripht: You're correct, only capped cylinders are currently supported for TriMesh collisions in ODE. There is a demo included in JV-ODE that provides a workaround for this problem. Take a look at the 'CarDemo-SphereWrapCylinder.bb' demo, in this demo spheres are used to provide collision geometry to collide correctly with a TriMesh. Or alternatively you can use capped cylinders instead ;) <br><br></td></tr></table><br>
<a name="598368"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Topknot</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I like OJay's idea but in that you get blocks of information that would help people understand what parameters are available and in what way they work best for a certain simulation.<br><br>Like in the field of automotive projects, knowing which ODE functions can be incorporated into for use or not use based on the extent of the proggy.  I've yet to find a descent doc or online source that would break down a car type object and help assist what can be incorporated into it.<br><br>@VIP3R, thanks for the updates, no problems with it so far ;)<br><br>Topknot ;) <br><br></td></tr></table><br>
<a name="599179"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> hm. you know what? why always make standalone demos of different features of ode? shouldn't we try to do a library, which would simplify the creation of complex simulations?<br><br>myRagdoll = dCreateRagDoll(2,2,1,0) ; creates a ragdoll with 2 arms, 2 legs, 1 head and 0 trails<br>myCar = dCreateCar(2,true) ; creates a car with 2 axes and frontwheel-steering<br><br><br>wouldn't that be something?  <br></div>I created a basic 'library' in my tute. I don't have a link but I posted it on a forum at VIP3R's request, so maybe he can link to it? It uses an object system where you load a set of properties into an object type and then an ODE object+mesh is created. The simple version I provided is only good for spheres and cubes, but can be extended. My current version has a ragdoll object where you supply some properties like size and a ragdoll is created, for example, ising the box creation functions from the library and some joints. I rejigged the whole system to use a linked list instead of an array, and added a joint object to my ODE object so an object can be joined to another. This system is limited to one joint per object (though you can link multiple objects to one other, so say add four limbs to one body). I'm about to add a seesaw (teeter-totter) object and hopefully my structures are suitably designed that this won't be too difficult.<br><br>I can't really provide it as a useful library though because it's the mainstay of my program and hence somewhat 'jury-rigged' to work for me without being particularly lean and well structured. Still, the idea works and it isn't *too* much trouble to adapt my starter library to add more features.<br><br>Edit : Okay, I followed VIP3R's links and found it here...<br><a href="http://www.davidcoombes.f2s.com/ode_for_newbies.pdf" target="_blank">http://www.davidcoombes.f2s.com/ode_for_newbies.pdf</a><br><br>Annoyingly .PDFs have lousy copy and paste options, but you can still use the code straight out of that as a starter for your own library. <br><br></td></tr></table><br>
<a name="599249"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >OJay</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> yeah your lib is pretty usefull to setup some simple simulations fast, but it gets complicated when moving to more complex ones...<br><br>so, at the moment i'm thinking towards XML, hence Collada. since it's an industry-standard for defining 3D worlds it would be really cool to just extend the existing b3d-format with xml-data. also, there's already an b3d&lt;-&gt;xml converter in the code-archives, so this could come in handy as well...<br><br>but as stated above, im still thinking about a concept best suited. so expect no solution before holidays or something ^_^ (have some other projects to complete before the end of this year, too. so my timetable is pretty much at full capacity at the moment...)<br><br>would like to hear your opinions about that plan, of course :) <br><br></td></tr></table><br>
<a name="599275"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> I mentioned Collada to Kurix too. Great minds... ;)<br><br>Actually from the sounds of it Kurix's editor is halfway there. It has XML output, so a parser could create objects. Like my current system you could have a list of primitves and a list of joints, load an XML file, say for a ragdoll, and for each object you'd call primitive functions to create a block or joint.<br><br>Ideally a Collada parser would allow those with 3D apps that support Collada to use those to create scenes, which would be getting pretty advanced. <br><br></td></tr></table><br>
<a name="599483"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm finding a host of new error messages, all from VB and I guess in theory they could be useful. I see some things are more particular, such as now I can't set a box to a negative size without a VB error.<br><br>However these don't provide any use for tracking where they occur. Just now I had a 'bad joint argument' when I referenced a non-existent joint, whereas before Blitz would flag the error and show me where in my code it occured.<br><br>Can the ODE error trapping be integrated more closely with Blitz? <br><br></td></tr></table><br>
<a name="599498"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KuRiX</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi. My support for xml was based on the XML-ODE format from the java community. Powerful but not complete.<br><br>Other idea would be to extend the b3d format with custom properties. I don't know if this can be done, but i think it can be.<br><br>So you can have a b3d format with full physics. Some people suggested me to include such exporter in kode, but then we should need to do a special b3d importer in blitz.<br><br>Good ideas anyway... <br><br></td></tr></table><br>
<a name="599499"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Shifty: You mean VC?<br><br>I'm not getting anything other than 'Memory Access Violation' when referencing a non-existent joint. Setting a box to a negative size doesn't produce an error here.<br><br>Are you using the latest build (480KB)? <br><br></td></tr></table><br>
<a name="599530"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> I need some feedback from JV-ODE users if possible  :)<br><br>KuRiX and I have been talking about the creation of a JV-ODE add-on, a plugin/importer system for use with 3D modelling software (for example 3DS Max etc). You would be able to create JV-ODE objects from within the 3D modelling editor, then using the importer, load them directly into Blitz3D for use with JV-ODE. The plugin/importer add-on would be made available as a separate optional system, it wouldn't be included with JV-ODE.<br><br>We would like to know if this would be useful for JV-ODE users?<br><br>Also, what would you expect to pay for the plugin/importer add-on?<br><br>Any suggestions and comments welcome. <br><br></td></tr></table><br>
<a name="599534"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Barton</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nice Idea,<br><br>But I have for my 3D Engine programmed a Level Editor with ODE Support. I can import, create and adjust ode-objects in the Level Eitor and then load in B3D. so I can build even houses and stack the ode-objects. Work fine. :)<br><br>Because of this I cannot use the Plugin. but others will be very pleased about it. <br><br></td></tr></table><br>
<a name="599567"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RGR</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Plugin ... not for me for nearly the same reasons as Barton mentioned: Own Level Editor, Model Editor, etc.<br><br>See my eMail I sent to you some days ago<br><br>There are many other things much more important, in my view...<br>For instance make the system more realistic - materials that have the abilities they should have, realistic gravity, and most of all, make it computer speed resistent - faster computer, higher framerate means bigger trouble!!! This should be fixed ... (delta timing that works between 60 and 300 FPS ruins everything above 500, because the steprate has to be changed - what on the other hand causes trouble on lower rates) <br><br></td></tr></table><br>
<a name="599572"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mustang</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> &gt; We would like to know if this would be useful for JV-ODE users?<br><br>YES!<br> <br>&gt; Also, what would you expect to pay for the plugin/importer add-on?<br><br>~$25? Maybe even more if it rocks (creates easy rag-doll/car setups) and of course supports the right modeling software (XSI5). Dot xsi would be good:<br><br><a href="http://www.softimage.com/Connect/xsi/dotXSI-FTK.htm#dotxsi" target="_blank">http://www.softimage.com/Connect/xsi/dotXSI-FTK.htm#dotxsi</a> <br><br></td></tr></table><br>
<a name="599609"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >OJay</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> didn't you read my posts over all? <br><br></td></tr></table><br>
<a name="599614"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KuRiX</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> @About the Importer/Loader: Well, the idea is to make some standard for physics world creation, using simple objects, not specific plugins. So in fact you could use ANY modeller to add jv-ode support, and create ragdolls, cars, and full worlds just using standard meshes and/or pivots.<br><br>@RagR: I have solved the step problem using the frame control from the castle demo, where you force the computer to run a number of frames per second. Then you split the control frames and the render frames. The control frames are always the same (for example 50 per second) then the rest of the time in a second is for the render frames. So you will have the same speed in any computer you run it, and only the fps (display) is affected. <br><br></td></tr></table><br>
<a name="599615"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well I've already voiced my ideas on this. I think any long-term JV-ODE user has created their own editor of sorts by now that fits in with their structures, but I know mine is far from full-featured and would look to get a much better alternative if available for future projects. You'd need a very solid engine and well worked structures for collating object property information. In my case I've got materials that define friction, density, restitution, magnetism, texture/colour, alongside customizable per-object material properties. There's plenty of scope for more complex objects too, beyond the old TYPE ode has Body, Geom and Mesh fields, such as including directionable forces for blowers. But of course the more features you add, the slower it gets, so these need to be optional and yet full featured. Actually in my engine it's easy to code out the magnetism or blower forces so it might be not too hard to have optional properties for more complex simulations. <br><br></td></tr></table><br>
<a name="599619"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KuRiX</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> I am still not sure how to do it, but one possible solution would be:<br><br>- You create your world, then create pivots (or helpers) that contains physics properties that you can attach to your objects, so then exporting just .b3d or .3ds and loading with the "new importer" the scene is loaded with all the assigned values.<br><br>For example you create a box, then a pivot named "friction 30" that you attach to the box. Or you create an object called "joint ball" that you attach to two objects.<br><br>So any exporter would work...<br><br>Then the importer will parse all the scene to types so you can manage it perfectly, change properties, etc... and the loading of the scene will be just one line.<br><br>What do you think? <br><br></td></tr></table><br>
<a name="599622"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> Not a bad idea Kurix- Kind of extending the B3D extensions.<br><br><br>Either way, This is something i'd find terribly useful if i was to stay with blitz. <br><br></td></tr></table><br>
<a name="599629"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> @Shifty: You mean VC?<br><br>I'm not getting anything other than 'Memory Access Violation' when referencing a non-existent joint. Setting a box to a negative size doesn't produce an error here.<br><br>Are you using the latest build (480KB)?  <br></div>Yep, latest build creted 20th November. If I call<br><br>dJointGetHingeAnchor(UI_object\joint\joint_object)<br><br>and the object doesn't exist, Blitz complains. But if I set UI_object an object that hasn't a valid Hinge joint, I'm told<br><br>-----<br>ODE INTERNAL ERROR 2<br><br>bad joint argument (..\ode\src\joint.cpp:883)<br>-----<br><br>Followed by<br><br>-----<br>Microsoft Visual C++ Runtime Library<br><br>Runtime Error!<br><br>Program ...blah blah...\bin\blitcc.exe<br>-----<br><br>If I create a box with a negative length, on calling dCreateBox() I get<br><br>-----<br>ODE INTERNAL ERROR 2<br><br>bad joint argument (..\ode\src\collision_std.cpp:142)<br>-----<br><br>I only find this by stepping through my code. It doesn't nicely tell me the offending command, nor break into the Debug window to show me the wrong line, nor open the library and set me to the offending line.<br><br>Could this perhaps be an issue with ProteanIDE which is .NET based? At the moment I'm getting 'can't have body1==body2' when I reload my data. The problem must be to do with my new joint operations, but finding the problem is a good deal harder with such unhelpful error messages! <br><br></td></tr></table><br>
<a name="599781"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> @RaGR: Eh, what needs fixing? The physics time stepping should be controlled by the programmer of the simulation. Restrict the time steps to 60 fps as KuRiX mentions and not every render frame.<br><br>@OJay: Not sure if you meant me? I read all user posts. Your idea is good and I've already looked into doing something similar (read the previous threads). I found it would be easier for users to set up their own functions based on their particular needs, instead of a global creation function that will probably be unsuitable for most people without heavy modification.<br><br>@Shifty: The latest build is 23rd November (not 20th), there is an easy way to check. The old build of 'JV-ODE.dll' was 524KB, the new one is 480KB. The new build shouldn't give any of those error messages, leaving Blitz to point to the errors. Make sure you have the latest build.<br><br><br><b>Please note:</b><br>The development, sales and support of the plugin/importer system will all be done by KuRiX as a third party add-on for JV-ODE. If he decides it's worthwhile creating of course ;) <br><br></td></tr></table><br>
<a name="599850"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah that's it. Good-oh! <br><br></td></tr></table><br>
<a name="599917"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RGR</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Vip3r Ahh, that's the way you handle it ... good to know ... first ask people to write what they think and then answer some rubbish ... but I am used to it... I invested in at least 25 "Blitz Addons" and at most 5 were useful in the end ...<br>... maybe its time to switch to Filax Easy-TOK ? ... stuff I bought from him I must say was always useful ... and I never got a lousy answer from him<br>I don't want to restrict timesteps to 60 fps !!! And if you would have read what I wrote you would have at least thought a second for a solution or at least had a question back... but if you are not interested and have no time ... your decision. <br><br></td></tr></table><br>
<a name="599924"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>@Vip3r Ahh, that's the way you handle it ... good to know ... first ask people to write what they think and then answer some rubbish<br> <br></div><br>What part of <i>"Restrict the time steps to 60 fps as KuRiX mentions and not every render frame."</i> is rubbish exactly? KuRiX has ALREADY answered your question, do you want me to echo the exact same answer? The very same answer I gave you via email a while back?<br><br>If you're not happy and want to try another physics product, that's fine with me... your decision. <br><br></td></tr></table><br>
<a name="599932"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KuRiX</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> Setting the Physics Evolution to a constant rate per second is ALWAYS the best solution. Seconds are seconds in pentium1, pentium2, pentium3, amd, china, russia, australia, eeuu, gameboy, psp, ps2, xbox, etc...<br><br>so the physics will run exactly the same in every computer, which i think is great! Graphics are other words... What's the problem about doing this? What do you want to do exactly? <br><br></td></tr></table><br>
<a name="599998"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DH</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think your doing a great job guys.  I got this a month ago, haven't touched it yet (am not at that point in my project yet), but know it will be very handy.  Glad I could help out the effort with my purchase! <br><br></td></tr></table><br>
<a name="600011"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DH</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#32">[#32]</a></td></tr></table></td></tr><tr ><td class="posttext"> Any thoughts on porting this for Blitzmax? <br><br></td></tr></table><br>
<a name="600022"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#33">[#33]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the support Dark Half :)<br><br>I will look at getting the DLL working with BlitzMax (Win32 only) but I'm not sure how successful this will be yet. I'm waiting for the BMax updates to settle down and stabilize a bit first, I don't want to get into the situation where I have to release a fix for every BMax update. Then there's the problem of deciding which 3rd party 3D engines are complete enough to use for demos etc.<br><br>It might not be worth making an ODE module if Mark is already creating one (there's a beta ODE module available for download).<br><br>As soon as I've looked at this more closely, I'll let everyone know. <br><br></td></tr></table><br>
<a name="600467"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Topknot</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#34">[#34]</a></td></tr></table></td></tr><tr ><td class="posttext"> Does anyone have any links or information on the parameters that can be effective to give an auto better handeling.???<br><br>Seems that with current abilitiy's the auto's are limited greatly to very low top speeds, and anything higher than say 30 gives wobbly wheels, and such.  So looking if anyone's got better information on improving a car's handling and aspects.<br><br>Thanks<br><br>Topknot ;) <br><br></td></tr></table><br>
<a name="600567"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KuRiX</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#35">[#35]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, i have been working on ode's cars for more than one year. You need to make lot of tuning to get  what you want. Now i have a very good model, but you need to choose between arcade cars or simulation cars.<br><br>Some aspects are:<br><br>- Low the center of mass of the chassis<br>- Give the chassis a big mass<br>- Decrease the value of CFM to avoid wheel problems at high speeds<br>- Use very low time step<br>- Use spheres for the wheels<br>- Etc...<br><br>Good Luck. KuRi. <br><br></td></tr></table><br>
<a name="600588"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#36">[#36]</a></td></tr></table></td></tr><tr ><td class="posttext"> Topknot: 30 what? ;)<br><br>Ive not had these issues, in JVOde though they do exist. You want to see wobbly wheels? use the orignal ode wrapper. THEY were wobbly ;) <br><br>There are functions in ODE to fix the problem with the wheels going a bit lop-sided- I dont remember which ones to mind. <br><br></td></tr></table><br>
<a name="600623"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#37">[#37]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Topknot: The wobbly wheels issue is a common symptom in ODE. It usually only affects the rear wheels at high rotation speeds. In the car demos, the speed of 30 is quite high if it were converted to real world speed.<br><br>The cause of the problem is the joint that holds the wheels. When the wheel rotates at very high speeds, the joint starts to break away. I've not seen any info available that gives guidelines for a solution to the problem. But there are many gotchas to watch out for:<br><br>Too much friction<br>Not enough ERP<br>Too much CFM<br>Too much mass pressure on the joint<br>Not enough wheel mass<br>Time steps are set too high<br><br>I've had varying degrees of success with other methods, but I'm still looking for the perfect solution. I do have a new idea which I'm going to experiment with, but it's more complicated than using single joints for the wheels. It involves changing the Hinge2 joint for a Hinge joint and a separate suspension unit. <br><br></td></tr></table><br>
<a name="600639"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mark Judd</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#38">[#38]</a></td></tr></table></td></tr><tr ><td class="posttext"> TopKnot,<br><br>What they said above, and you might try the following method which I've had some success with.<br><br>In essence (if i understand correctly) you are finding the wheels axle orientation and then forcing the wheel to match it. So when the wheel is tempted to wander off because of errors introduced by the high rotation speed this little function 'snaps' it back into the right place.<br>Please note, this seems to help, but not solve the issue.<br>You need to mess with the other settings as well to get a result satisfactory for what you are trying to achieve.<br><br>Assuming you are looking at the car demo from VIP3R,<br><br>When you create the wheels add this :-<br><br>dBodySetFiniteRotationMode(ode\body,1)<br><br>for each wheel and then when you update the car (i.e. in the UpdateCar() function :-<br><br>For count=1 To 4<br>; get wheel hinge axis<br>dJointGetHingeAxis(joint(count))<br>wxa#=dVectorX()<br>wya#=dVectorY()<br>wza#=dVectorZ()<br>; apply To wheel<br>dBodySetFiniteRotationAxis(wheel(count),wxa#,wya#,wza#)<br>Next<br><br>Hope this helps,<br><br>Mark <br><br></td></tr></table><br>
<a name="600836"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Topknot</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#39">[#39]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well some things I notice when trying to find a half way descent setting is:<br><br>- The Faster you go the less turning ability you get back no matter what your turn variable is set to.<br>- Trying to discover additional functions to generate things like "rear wheel sliding" "different friction based on surface"<br><br>@kurix,<br><br>I've had problem making the mass too heavy, and is there a formula to figure out mass, gravity, and the rest of the variables ?.  At the moment it's been wild ass hair guesses and tons of frustration at not fully understanding the effects or interloping these variables has to eachother.<br><br>By time step I assume you're refering to the CFM &amp; ERP values?!<br><br>The "ETC..." is what I'm interested in ;)<br><br>@Mark Judd,<br><br>Thanks will give is a go and see, tried weeks ago to understand that but will ingage it again.<br><br><br>Thanks all<br>Topknot ;) <br><br></td></tr></table><br>
<a name="600941"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#40">[#40]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>By time step I assume you're refering to the CFM &amp; ERP values?!<br> <br></div><br>No, he means the dWorldQuickStep() function in the main loop. Lowering the step value improves the accuracy of the simulation (like wheel joints), but it also slows it down. So you have to balance the other settings to compensate (gravity/forces/torque/mass etc).<br><br>Patience, it takes time to develop a good car setup. Keep using the ODE manual as a reference for info on ERP, CFM and the other functions. Learn as much as you can about them, experiment with them.<br><br>:) <br><br></td></tr></table><br>
<a name="600957"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Topknot</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#41">[#41]</a></td></tr></table></td></tr><tr ><td class="posttext"> @VIP3R,  I totally agree, lots of testing, but here's the stickler.  To be handed a ODE doc that give 3-4 line brief descriptions without any pratical examples, makes defining functions very slow and annoying.  For example in the Blitz3D forums you can find a ton of examples, refinements, and posted bits of functions to demonstrat using Blitz3D.<br><br>Something I was refering to was like a Doc, or Tut that builds a solid car, then helps the user to "Understand" what's going on.  very much like the ODE PDF tutorial that was posted ages ago.  That was formatted to explan thing to a person diving into ODE quite well.<br><br>As an example I set <br><pre class=code>
dBodySetFiniteRotationMode(ode\body,<b>0</b>)
</pre><br><br>Set it to 0 and now I can increase the limiter on Speed# to things like 125 and the rear wheels hold fast.  Why..I got no idea lol.  Like you said there more function to think about but "Knowing" which and how they work is the kicker with the limited ODE doc's available and very few examples.<br><br>This isn't a complaint, just a desire for more indepth details instead of short spurted answer quoting to "read" the almighty ODE docs.<br><br>@Mark Judd,<br><br>Tried your bit of code, and oddly it produced even greater problems in that even at lower speed the wheels would start to flatten out and turn into a "hover" "Back to the Future style" car lol.  But setting to 0 seems to stop it totally for much higher speed?!  Odd.<br><br>I'm trying to make something stable enuff to post and let you tinker with it, it's just the frustrations that keep it on testing format.<br><br>Topknot ;) <br><br></td></tr></table><br>
<a name="600967"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#42">[#42]</a></td></tr></table></td></tr><tr ><td class="posttext"> I understand Topknot believe me :)<br><br>What do you think I learned ODE from, Yoda? :P<br><br>In fact it was the very same vague 3-4 line description manual we all use. I've not found any other worthwhile ODE docs, I'd be the first to post them if I did. <br><br></td></tr></table><br>
<a name="600990"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Topknot</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#43">[#43]</a></td></tr></table></td></tr><tr ><td class="posttext"> Maybe as a force to increase usage and desire for ODE and mainly JV ODE usage, everyone could contribute small bits that could be compiled and exchanged for the better of this community.<br><br>I'd be happy to spend the time compiling and writting up a doc pack if information is posted.  Then this could be packaged with the JV-ODE suit and make it more attractive for new and old users ;)<br><br><br>My biggest puzzlement is that in all the searching thru the ODE's main sight I find so little information on these things.<br><br>Topknot ;) <br><br></td></tr></table><br>
<a name="600996"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KuRiX</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#44">[#44]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi friends. As i promised here it is a small video of my racing engine. Although FRAPS is limiting the capture to 60fps the game runs at 120fps without problem on geforce fx 5200 128MB.<br><br>www.lcuriel.arrakis.es/kracing1.avi<br><br>It is using my wrapper, but this can be done with jv-ode perfectly the same.<br><br>If you want more videos let me know! <br><br></td></tr></table><br>
<a name="600999"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#45">[#45]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Topknot: The ideal thing would be some kind of beginners guide. I'm the WORST person to create something like that though. I understand the complex stuff quite well, but I'd have serious problems translating it into something beginners would understand clearly.<br><br>Btw, if I refer somebody to the ODE docs, it's because some questions ARE well explained in the ODE docs and sometimes it becomes obvious that very little effort has been made to research the problem beforehand. Take ERP and CFM for example, there are two entire sections devoted to these parameters in Chapter 3. Why should I need to explain the details of these, when the docs already do this? I help people a lot with JV-ODE, not just on these threads but also directly via email. It takes a LOT of time and effort, I do the best I can with the limited amount of time I have available. <br><br></td></tr></table><br>
<a name="601102"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#46">[#46]</a></td></tr></table></td></tr><tr ><td class="posttext"> Docs take time. There's no getting round that. IF you are to do a seriously useful piece of tutorial you're going to need to invest several hours at least. I for one just don't have that time, and can only post snippets up here as I discover them. <br><br></td></tr></table><br>
<a name="601289"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Topknot</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#47">[#47]</a></td></tr></table></td></tr><tr ><td class="posttext"> @<b>VIP3R</b>,  Now let me state before statements are misread, First off I'm not attacking your's or anyone elses skills or knowledge, I understand many good things are "printed" in the ODE Doc's but it's like asking someone to read a book on Quantium Physic's and state that's it's easy to understand lol....By your own statement you understand the higher functions better than most, hell you wrote the DLL wrapper, so again I'm posting from a newbie's understanding of the ODE.  From being an instructor at a Tech College I am quite familiar with how simple basics that I see as child's play are hard for new students to grasp right off the bat without tutorials and explainations.<br><br>@<b>KuRiX</b> Very interesting vid, I take is that the models and such are in testing stages hense the lack of textures and details..?  I'd be willing to do some resources in exchange for some tips on getting ODE under controll ..;)<br><br>@<b>Geezer</b>  I agree, Doc's do take time to compile, refine, and make understandable for new peeps, but at the same time I'm also willing to take peoples input and samples and start building Doc's that could be included and eventually incorporated into the Blitz3D's Help section in similar fashion as the standard commands.<br><br>Btw all, I do read over and over and hunt and compare both the ODE Doc's and the JV-ODE manual html for hours before just splating questions here, usually I come here as a last hope to figure out problems.  Maybe others here can read once and totally understand the functionings of ODE, but my skills lie on other avenues.  I have worked professionally in generating contractable resources and such for other company's in the gaming industry, but now in working with the exciting avenue of ODE with Blitz3D, I end up doing all sections of a program.  Hell I've rebuilt 6 different styles of tracks, worlds, and environments just to find a nice mix with what little bits of ODE I understand ;)<br><br>Topknot ;) <br><br></td></tr></table><br>
<a name="601307"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KuRiX</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#48">[#48]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Topknot: We are developing a full 3d map of our real city, building by building. That map was only to show you some ode in action, hehe. <br><br>What kind of resources can you offer? Because we plan to use 1000 poly's vehicles to support 20 or 30 players at a time...<br><br>Thanks for the comments anyway!<br><br>PD: Take a look at my ode editor, the demo can tell you lot about ode and its parameters! <br><br></td></tr></table><br>
<a name="601312"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#49">[#49]</a></td></tr></table></td></tr><tr ><td class="posttext"> I forgot to mention, you may find some VERY useful info in the ODE archives. There's a link to them in the top post of this thread. You can read it online or download the entire archive and search it offline, you can also google stuff like 'ode car setup' and it'll return results from the archive. It isn't easy to understand some of the posts, but there's a lot of useful info available which could help you. <br><br></td></tr></table><br>
<a name="601408"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Topknot</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#50">[#50]</a></td></tr></table></td></tr><tr ><td class="posttext"> @<b>KuRiX</b>, Name it and I can model it.  Althou the one spot I am a bit slower with is real life organics.  Most of my contract work has been for military and civilian vehicles, buildings, and environments.  I have the ability to model, UVmap correctly lol, animate, and texture per look or feel.  My true speciality is in low poly reduction to fit most major game labels were 100's of units or such were needed.  Best I could say for you is to toss me a few project items you want and let me return resources for review.<br><br>Just a really cheap cap of two of the cars I built to tinker with in my proggy, each measures in around 2200 polys including wheels.  Still plenty of room for trimming but more focused at this stage on ODE coding ;)<br><br><img src="http://www.atomicyoda.com/wip/VWFORD.jpg"> <br><br><br>@<b>VIP3R</b>, Will do, didn't realize I could download the entire past postings as such for offline research.  I've been collection almost anything and everything I find into a collection to try and learn. <br><br></td></tr></table><br>
<a name="601414"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KuRiX</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#51">[#51]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the info Topknot. 2200 polys are too much for me. I have cars with wheels, glasses, driver, and interior with just 1500 total.<br><br>See if you can beat it, it would be great! ;) <br><br></td></tr></table><br>
<a name="601448"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#52">[#52]</a></td></tr></table></td></tr><tr ><td class="posttext"> Damn, I couldn't watch the video Kuri, I don't have the right codecs installed. I heard it though, sounds nice :)<br><br>Those cars look great, nice work Topknot ;) <br><br></td></tr></table><br>
<a name="601450"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KuRiX</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#53">[#53]</a></td></tr></table></td></tr><tr ><td class="posttext"> you can download them from www.divx.com although i suggest you to search for codecs divx 5.1 (they include no adware)...<br><br>Cheers! <br><br></td></tr></table><br>
<a name="601454"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Topknot</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#54">[#54]</a></td></tr></table></td></tr><tr ><td class="posttext"> Better yet nab XP-Codec Pack:<br><br><a href="http://www.xpcodecpack.com" target="_blank">http://www.xpcodecpack.com</a><br><br>Ace Codeac Pack:<br><br><a href="http://www.softpedia.com/progDownload/ACE-Mega-CoDecS-Pack-Download-6778.html" target="_blank">http://www.softpedia.com/progDownload/ACE-Mega-CoDecS-Pack-Download-6778.html</a><br><br> and never have to worry about finding codeacs for anything ;)<br><br>Thanks on the cars, sadly you can't see the details due to overlighting for the fast snap lol...<br><br>Oh an KuRiX, trust me I wasn't shooting for low poly in those two cars that I use for testing purposes.  But if HAD to I could easly meet a 1500 total poly count with your stated objects ;) <br><br></td></tr></table><br>
<a name="601459"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >OJay</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#55">[#55]</a></td></tr></table></td></tr><tr ><td class="posttext"> nice video kurix! any chance to get infos about, how you did the friction- and collision-sounds? <br><br></td></tr></table><br>
<a name="601463"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KuRiX</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#56">[#56]</a></td></tr></table></td></tr><tr ><td class="posttext"> About the sounds? they are the easy part of the engine!. <br><br>For the friction sound i got a looped friction sound from the web, then i calculate the perpendicular linear vel of the wheel, so if greater than a value a loop the sound, and if lower, i stop the sound.<br><br>For the collision, i just check for collision between bodies (chassis) every frame, and if i get a collision with enough speed, i play the sound ( i got it from some web too, hehe), and i don't play it again until i get a new no-collision -&gt; collision.<br><br>Good Night for me now. Cheers, KuRi! <br><br></td></tr></table><br>
<a name="601480"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Topknot</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#57">[#57]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey <b>OJay</b>,<br><br>Not sure if this helps you with the collisions, but here a Function I came up with to both play a "Crash" sound file and Slow the car down and also put Particles at the point of collision:<br><br><pre class=code>
Function ShowCarBodyCollisions()

;### Check if a Collision has happened between Car and World Objects ###
	If dGeom1CountCollisions(CGeom) &gt; 1


; ### IF YES a collision grab the X,Y,Z of the point of impact ###
		XPos# = dGeom1CollisionX(CGeom,1)
		YPos# = dGeom1CollisionY(CGeom,1)		
		ZPos# = dGeom1CollisionZ(CGeom,1)
		
; ### If The collision happens at speeds Greater than 6 then play Sound and Cut Current Speed in Half ###

		If Speed# &gt; 6
			PlaySample(Hit01,0)
			Speed# = Speed# / 2
		EndIf

; ### If the Velocity of the Car (float) is fast enuff then create a random (1 of 3) particle at point of collision ###

		If Velocity# &gt; 0.5
			I = Rnd(1,3)
		CrashParticle(0, HitSpark(I), 4, XPos#, YPos#, ZPos#, 1, 5, 1, 2, 1, 4, 0.1, 1.0)
		EndIf
	EndIf
</pre><br><br>So basically you have to be moving fast enough to play the sound and generate a sparking particle, otherwise if your just puttering along slow and nudge a wall or rail you just bump it.<br><br>Oh BTW, here's the Function that the crew here, I believe VIP3R posted to help me figure out the car's velocity:<br><pre class=code>
Function CalcVelocity()

	PositionEntity PrevPosPivot,PrevX,PrevY,PrevZ

	Velocity#      = EntityDistance(CMesh,PrevPosPivot)

	        PrevX# = EntityX(CMesh)
		PrevY# = EntityY(CMesh)
		PrevZ# = EntityZ(CMesh)

End Function
</pre><br><br>As for the Friction, that's something I'd also be interested in knowing how to preform or suggestions for it, it's my next step to try to generate for drifting corners...:)<br><br>Topknot ;) <br><br></td></tr></table><br>
<a name="601675"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#58">[#58]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the codec links, got it working now :)<br><br>Nice video Kuri ;) <br><br></td></tr></table><br>
<a name="602201"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >EmerGki</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#59">[#59]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Vip3r, now I have other trouble, how I make one car Sepparated in 3 pieces?<br><br>like this image:<br>www.dynamicgames.com.br/images/carro.bmp <br><br></td></tr></table><br>
<a name="602212"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KuRiX</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#60">[#60]</a></td></tr></table></td></tr><tr ><td class="posttext"> The best is to use just one body for all, then you make 3 separate geoms, and attach two of them using geomtransform geoms... <br><br></td></tr></table><br>
<a name="602801"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#61">[#61]</a></td></tr></table></td></tr><tr ><td class="posttext"> @EmerGki: You can use geom transform which as Kuri suggests is probably best, or you can attach each object using fixed joints.<br><br>It might be a good idea to make a demo of Geom Transforms, I'll see what I can come up with ;) <br><br></td></tr></table><br>
<a name="602829"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#62">[#62]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here's a demo showing the use of Geom Transforms.<br><br>Each object in the demo contains 1 main sphere geom (White) and 3 sphere geom transforms (Coloured).<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #										  JV-ODE Car Demo											#
; #									Code by Jim Williams (VIP3R)									#		#
; #						Feel free to use this code, any credit appreciated							#
; ###################################################################################################

AppTitle "JV-ODE Car Demo - Geom Transform - Sphere"

Include "JV-ODE.bb"

Graphics3D 800,600,0,2

Global CMass#=200			; ### Car Mass
Global WMass#=14			; ### Wheel Mass

Global WorldERP#=1			; ### World Error Correction
Global WorldFriction#=70	; ### World Friction

Global Torque#=24			; ### Joint Torque
Global SuspensionHS#=0.01	; ### Suspension Hardness/Softness (Higher=Softer - Lower=Harder)

Global Force#=0
Global Steer#=0

Global Car
Global CGeom
Global CMesh

Global CarStartY=10

Dim Wheel(4)
Dim WGeom(4)
Dim Joint(4)

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

; ###################################################################################################

; ### Setup ODE

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,-0.98,0)
dWorldSetERP(World,WorldERP)

dContactSetMode(dContactSlip1)
dContactSetMu(WorldFriction)

; ### Create car body

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
Car=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,0,CarStartY,0)
mass=dMassCreate()
dMassSetBoxTotal(mass,CMass,3,1,4)
dMassTranslate(mass,0,-1,0)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
ode\geom=dCreateBox(Space,3,1,4)
CGeom=ode\geom
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
CMesh=ode\mesh
ScaleMesh ode\mesh,1.5,0.5,2
RotateMesh ode\mesh,0,0,0
PositionMesh ode\mesh,0,0,0
EntityColor ode\mesh,40,80,255
EntityAlpha ode\mesh,1

; ### Create wheels

For count=1 To 4
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	Wheel(count)=ode\body
	dBodySetRotation(ode\body,0,0,0)
	dBodySetPosition(ode\body,0,0,0)
	mass=dMassCreate()
	dMassSetSphereTotal(mass,WMass,0.7)
	dBodySetMass(ode\body,mass)
	dMassDestroy(mass)
	ode\geom=dCreateSphere(Space,0.7)
	WGeom(count)=ode\geom
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder(8)
	ScaleMesh ode\mesh,0.7,0.25,0.7
	RotateMesh ode\mesh,0,0,90
	PositionMesh ode\mesh,0,0,0
	EntityColor ode\mesh,255,255,255
Next

dBodySetPosition(Wheel(1),-2,CarStartY-0.5,+2)
dBodySetPosition(Wheel(2),+2,CarStartY-0.5,+2)
dBodySetPosition(Wheel(3),-2,CarStartY-0.5,-2)
dBodySetPosition(Wheel(4),+2,CarStartY-0.5,-2)

; ### Create light

Global Light=CreateLight()

RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera

Global CameraPivot=CreatePivot(CMesh)
PositionEntity CameraPivot,0,2,-7

Global Camera=CreateCamera()
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000

; ### Create plane

dCreatePlane(Space,0,1,0,0)

Plane=CreatePlane()

EntityAlpha Plane,0.8

PlaneTexture=CreateTexture(128,128,9)

ClsColor 0,200,80
Cls

Color 255,255,255

Rect 0,0,64,64,1
Rect 64,64,64,64,1

CopyRect 0,0,128,128,0,0,BackBuffer(),TextureBuffer(PlaneTexture)
ScaleTexture PlaneTexture,20,20
EntityTexture Plane,PlaneTexture,0,0

Mirror=CreateMirror()

; ###################################################################################################

SetupCar()

SetupObjects()

While Not KeyHit(1)

	UpdateKeys()

	PTime=MilliSecs()

	UpdateCar()

	UpdateGeoms()

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)

	PhysicsTime#=MilliSecs()-PTime

	UpdateCam()

	UpdateWorld

	RenderWorld

	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime
	Text 0,50,"Force:"+Force
	Text 0,65,"Torque:"+Torque
	Text 640,0,"A - Accelerate"
	Text 640,15,"Z - Brake/Reverse"
	Text 640,30,"Arrows - Steering"
	Text 640,45,"Space - Reset Car"

	Flip

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function SetupCar()

For count=1 To 4
	Joint(count)=dJointCreateHinge2(World,0)
	dJointAttach(Joint(count),Car,Wheel(count))
	dJointSetHinge2Anchor(Joint(count),dBodyGetPositionX(Wheel(count)),dBodyGetPositionY(Wheel(count)),dBodyGetPositionZ(Wheel(count)))
	dJointSetHinge2Axis1(Joint(count),0,1,0)
	dJointSetHinge2Axis2(Joint(count),-1,0,0)
	dJointSetHinge2Param(Joint(count),dParamSuspensionERP,0.8)
	dJointSetHinge2Param(Joint(count),dParamSuspensionCFM,SuspensionHS)
	If count&gt;2
		dJointSetHinge2Param(Joint(count),dParamLoStop,0)
		dJointSetHinge2Param(Joint(count),dParamHiStop,0)
		End If
Next

Force=0

End Function

; ###################################################################################################

Function SetupObjects()

For count=1 To 30
	AddObjects((xp*34)-120,17,(zp*34)+100)

	xp=xp+1
	If xp&gt;7
		xp=0
		zp=zp+1
		End If
Next

End Function

; ###################################################################################################

Function AddObjects(objectxp,objectyp,objectzp)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,objectxp,objectyp,objectzp)
ode\geom=dCreateSphere(Space,8)
dGeomSetBody(ode\geom,ode\body)

ode\mesh=CreateSphere()
ScaleMesh ode\mesh,8,8,8
RotateMesh ode\mesh,0,0,0
PositionMesh ode\mesh,0,0,0
EntityColor ode\mesh,255,255,255
EntityAlpha ode\mesh,0.8
EntityShininess ode\mesh,0.7

transxp=-7
transyp=0

For count=1 To 3
	TransformGeom=dCreateGeomTransform(Space)
	GeomObject=dCreateSphere(0,4)
	dGeomSetPosition(GeomObject,transxp,transyp,0)
	dGeomTransformSetGeom(TransformGeom,GeomObject)
	dGeomTransformSetCleanup(TransformGeom,1)
	dGeomSetBody(TransformGeom,ode\body)

	GeomMesh=CreateSphere(8,ode\mesh)
	ScaleMesh GeomMesh,4,4,4
	RotateMesh GeomMesh,0,0,0
	PositionMesh GeomMesh,transxp,transyp,0
	EntityColor GeomMesh,count*10,count*70,255
	EntityAlpha GeomMesh,1
	EntityShininess GeomMesh,0.7

	If count=2
		transxp=0
		transyp=-7
		Else
		transxp=transxp+14
		End If
Next

End Function

; ###################################################################################################

Function UpdateKeys()

If KeyDown(30)=1
	Force=Force+0.08
	If Force&gt;30 Then Force=30
	End If

If KeyDown(44)=1
	Force=Force-0.1
	If Force&lt;-10 Then Force=-10
	If Force&gt;0 Then Force=Force*0.97
	End If

If KeyDown(30)=0 And KeyDown(44)=0 Then Force=Force*0.99

If KeyDown(203)=1 Or KeyDown(205)=1
	If KeyDown(203)=1
		Steer=0.5
		Else
		Steer=-0.5
		End If
	Else
	Steer=0
	End If

If KeyHit(57)=1
	Force=0
	dBodySetRotation(Car,dGeomGetPitch#(CGeom),dGeomGetYaw#(CGeom),0)
	End If

End Function

; ###################################################################################################

Function UpdateCar()

For count=1 To 4
	dBodyEnable(Wheel(count))
Next

dBodyEnable(Car)

For count=1 To 4
	dJointSetHinge2Param(Joint(count),dParamVel2,Force)
	dJointSetHinge2Param(Joint(count),dParamFMax2,Torque)
Next

For count=1 To 2
	angle#=Steer-dJointGetHinge2Angle1(Joint(count))
	dJointSetHinge2Param(Joint(count),dParamVel,angle)
	dJointSetHinge2Param(Joint(count),dParamFMax,400)
Next

End Function

; ###################################################################################################

Function UpdateCam()

PositionEntity CameraPivot,0,3,-10

camx#=EntityX(CameraPivot,1)-EntityX(Camera)
camy#=EntityY(CameraPivot,1)-EntityY(Camera)
camz#=EntityZ(CameraPivot,1)-EntityZ(Camera)

TranslateEntity Camera,camx*0.5,camy*0.5,camz*0.5

PointEntity Camera,CMesh

End Function

; ###################################################################################################

Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
	RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
	PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
Next

End Function

; ###################################################################################################
</textarea> <br><br></td></tr></table><br>
<a name="602864"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#63">[#63]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here's another Geom Transform demo using sphere &amp; box geoms (White) and 3 to 5 sphere &amp; box geom transforms(Coloured).<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #										  JV-ODE Car Demo											#
; #									Code by Jim Williams (VIP3R)									#		#
; #						Feel free to use this code, any credit appreciated							#
; ###################################################################################################

AppTitle "JV-ODE Car Demo - Geom Transform - Mixed"

Include "JV-ODE.bb"

Graphics3D 800,600,0,2

Global CMass#=200			; ### Car Mass
Global WMass#=14			; ### Wheel Mass

Global WorldERP#=1			; ### World Error Correction
Global WorldFriction#=70	; ### World Friction

Global Torque#=24			; ### Joint Torque
Global SuspensionHS#=0.01	; ### Suspension Hardness/Softness (Higher=Softer - Lower=Harder)

Global Force#=0
Global Steer#=0

Global Car
Global CGeom
Global CMesh

Global CarStartY=10

Dim Wheel(4)
Dim WGeom(4)
Dim Joint(4)

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

; ###################################################################################################

; ### Setup ODE

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,-0.98,0)
dWorldSetERP(World,WorldERP)

dContactSetMode(dContactSlip1)
dContactSetMu(WorldFriction)

; ### Create car body

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
Car=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,0,CarStartY,0)
mass=dMassCreate()
dMassSetBoxTotal(mass,CMass,3,1,4)
dMassTranslate(mass,0,-1,0)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
ode\geom=dCreateBox(Space,3,1,4)
CGeom=ode\geom
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
CMesh=ode\mesh
ScaleMesh ode\mesh,1.5,0.5,2
RotateMesh ode\mesh,0,0,0
PositionMesh ode\mesh,0,0,0
EntityColor ode\mesh,40,80,255
EntityAlpha ode\mesh,1

; ### Create wheels

For count=1 To 4
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	Wheel(count)=ode\body
	dBodySetRotation(ode\body,0,0,0)
	dBodySetPosition(ode\body,0,0,0)
	mass=dMassCreate()
	dMassSetSphereTotal(mass,WMass,0.7)
	dBodySetMass(ode\body,mass)
	dMassDestroy(mass)
	ode\geom=dCreateSphere(Space,0.7)
	WGeom(count)=ode\geom
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder(8)
	ScaleMesh ode\mesh,0.7,0.25,0.7
	RotateMesh ode\mesh,0,0,90
	PositionMesh ode\mesh,0,0,0
	EntityColor ode\mesh,255,255,255
Next

dBodySetPosition(Wheel(1),-2,CarStartY-0.5,+2)
dBodySetPosition(Wheel(2),+2,CarStartY-0.5,+2)
dBodySetPosition(Wheel(3),-2,CarStartY-0.5,-2)
dBodySetPosition(Wheel(4),+2,CarStartY-0.5,-2)

; ### Create light

Global Light=CreateLight()

RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera

Global CameraPivot=CreatePivot(CMesh)
PositionEntity CameraPivot,0,2,-7

Global Camera=CreateCamera()
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000

; ### Create plane

dCreatePlane(Space,0,1,0,0)

Plane=CreatePlane()

EntityAlpha Plane,0.8

PlaneTexture=CreateTexture(128,128,9)

ClsColor 0,200,80
Cls

Color 255,255,255

Rect 0,0,64,64,1
Rect 64,64,64,64,1

CopyRect 0,0,128,128,0,0,BackBuffer(),TextureBuffer(PlaneTexture)
ScaleTexture PlaneTexture,20,20
EntityTexture Plane,PlaneTexture,0,0

Mirror=CreateMirror()

; ###################################################################################################

SetupCar()

SetupObjects()

While Not KeyHit(1)

	UpdateKeys()

	PTime=MilliSecs()

	UpdateCar()

	UpdateGeoms()

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)

	PhysicsTime#=MilliSecs()-PTime

	UpdateCam()

	UpdateWorld

	RenderWorld

	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime
	Text 0,50,"Force:"+Force
	Text 0,65,"Torque:"+Torque
	Text 640,0,"A - Accelerate"
	Text 640,15,"Z - Brake/Reverse"
	Text 640,30,"Arrows - Steering"
	Text 640,45,"Space - Reset Car"

	Flip

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function SetupCar()

For count=1 To 4
	Joint(count)=dJointCreateHinge2(World,0)
	dJointAttach(Joint(count),Car,Wheel(count))
	dJointSetHinge2Anchor(Joint(count),dBodyGetPositionX(Wheel(count)),dBodyGetPositionY(Wheel(count)),dBodyGetPositionZ(Wheel(count)))
	dJointSetHinge2Axis1(Joint(count),0,1,0)
	dJointSetHinge2Axis2(Joint(count),-1,0,0)
	dJointSetHinge2Param(Joint(count),dParamSuspensionERP,0.8)
	dJointSetHinge2Param(Joint(count),dParamSuspensionCFM,SuspensionHS)
	If count&gt;2
		dJointSetHinge2Param(Joint(count),dParamLoStop,0)
		dJointSetHinge2Param(Joint(count),dParamHiStop,0)
		End If
Next

Force=0

End Function

; ###################################################################################################

Function SetupObjects()

For count=1 To 30
	SeedRnd MilliSecs()

	AddObjects(Rnd(0,1),Rnd(0,1),Rnd(3,5),(xp*34)-120,17,(zp*34)+100)

	xp=xp+1
	If xp&gt;7
		xp=0
		zp=zp+1
		End If
Next

End Function

; ###################################################################################################

Function AddObjects(objecttype,transformtype,transamount,objectxp,objectyp,objectzp)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,objectxp,objectyp,objectzp)

If objecttype=0
	ode\geom=dCreateSphere(Space,8)
	Else
	ode\geom=dCreateBox(Space,14,14,14)
	End If

dGeomSetBody(ode\geom,ode\body)

If objecttype=0
	ode\mesh=CreateSphere()
	ScaleMesh ode\mesh,8,8,8
	Else
	ode\mesh=CreateCube()
	ScaleMesh ode\mesh,7,7,7
	End If

RotateMesh ode\mesh,0,0,0
PositionMesh ode\mesh,0,0,0
EntityColor ode\mesh,255,255,255
EntityAlpha ode\mesh,0.8
EntityShininess ode\mesh,0.7

For count=1 To transamount
	If count=1 Then transxp=-7 : transyp=0 : transzp=0
	If count=2 Then transxp=7 : transyp=0 : transzp=0
	If count=3 Then transxp=0 : transyp=-7 : transzp=0
	If count=4 Then transxp=0 : transyp=0 : transzp=-7
	If count=5 Then transxp=0 : transyp=0 : transzp=7

	TransformGeom=dCreateGeomTransform(Space)

	If transformtype=0
		GeomObject=dCreateSphere(0,4)
		Else
		GeomObject=dCreateBox(0,7,7,7)
		End If

	dGeomSetPosition(GeomObject,transxp,transyp,transzp)
	dGeomTransformSetGeom(TransformGeom,GeomObject)
	dGeomTransformSetCleanup(TransformGeom,1)
	dGeomSetBody(TransformGeom,ode\body)

	If transformtype=0
		GeomMesh=CreateSphere(8,ode\mesh)
		ScaleMesh GeomMesh,4,4,4
		Else
		GeomMesh=CreateCube(ode\mesh)
		ScaleMesh GeomMesh,3.5,3.5,3.5
		End If

	RotateMesh GeomMesh,0,0,0
	PositionMesh GeomMesh,transxp,transyp,transzp
	EntityColor GeomMesh,count*10,count*70,255
	EntityAlpha GeomMesh,1
	EntityShininess GeomMesh,0.7
Next

End Function

; ###################################################################################################

Function UpdateKeys()

If KeyDown(30)=1
	Force=Force+0.08
	If Force&gt;30 Then Force=30
	End If

If KeyDown(44)=1
	Force=Force-0.1
	If Force&lt;-10 Then Force=-10
	If Force&gt;0 Then Force=Force*0.97
	End If

If KeyDown(30)=0 And KeyDown(44)=0 Then Force=Force*0.99

If KeyDown(203)=1 Or KeyDown(205)=1
	If KeyDown(203)=1
		Steer=0.5
		Else
		Steer=-0.5
		End If
	Else
	Steer=0
	End If

If KeyHit(57)=1
	Force=0
	dBodySetRotation(Car,dGeomGetPitch#(CGeom),dGeomGetYaw#(CGeom),0)
	End If

End Function

; ###################################################################################################

Function UpdateCar()

For count=1 To 4
	dBodyEnable(Wheel(count))
Next

dBodyEnable(Car)

For count=1 To 4
	dJointSetHinge2Param(Joint(count),dParamVel2,Force)
	dJointSetHinge2Param(Joint(count),dParamFMax2,Torque)
Next

For count=1 To 2
	angle#=Steer-dJointGetHinge2Angle1(Joint(count))
	dJointSetHinge2Param(Joint(count),dParamVel,angle)
	dJointSetHinge2Param(Joint(count),dParamFMax,400)
Next

End Function

; ###################################################################################################

Function UpdateCam()

PositionEntity CameraPivot,0,3,-10

camx#=EntityX(CameraPivot,1)-EntityX(Camera)
camy#=EntityY(CameraPivot,1)-EntityY(Camera)
camz#=EntityZ(CameraPivot,1)-EntityZ(Camera)

TranslateEntity Camera,camx*0.5,camy*0.5,camz*0.5

PointEntity Camera,CMesh

End Function

; ###################################################################################################

Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
	RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
	PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
Next

End Function

; ###################################################################################################
</textarea> <br><br></td></tr></table><br>
<a name="603094"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Topknot</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#64">[#64]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey VIP3R,<br><br>Sorry if this is an old question, but I noticed in your two new demo's that you use a slightly different car values in the setting up of it, and was wondering if there is a layman's formula to knowing how to match up the values to make them exist nicely with eachother?<br><br>Meaning is ther a Golden Rule to what the values should be based on eachother?<br><br>Thanks <br>Topknot ;) <br><br></td></tr></table><br>
<a name="603151"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#65">[#65]</a></td></tr></table></td></tr><tr ><td class="posttext"> No formula really, it's just a process of 'test driving' the car and tweaking the settings where necessary. If it's flipping over or gripping too much (over steering) on a sharp bend, lower the friction settings slightly. Changing the suspension hardness/softness settings will also affect the over/under steering making it handle better (or worse). Testing and tweaking is your key to getting the car handling how you want it to. All of the settings mentioned in previous posts (ERP,CFM etc) should be tweaked and tested until you're happy with the setup.<br><br>The easiest method is to tweak only one setting at a time and see if you feel a difference in the handling, then make a note of the changes. Once you've experimented and listed the results from each setting change, you will have all the info needed to tweak it to perfection.<br><br>Each kind of car simulation would require totally different setups, for example F1, Touring Car, Rally etc...<br><br>It also depends on whether you're making a realistic simulation or an arcade style racing game.<br><br>A set of 'perfect' values doesn't exist, until you discover it through the above process, there's no shortcut.<br><br>After all, only you know how you want your car to handle ;) <br><br></td></tr></table><br>
<a name="603423"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#66">[#66]</a></td></tr></table></td></tr><tr ><td class="posttext"> To add to what Vip3r said.<br><br><br>while developing Cygnus Car Engine, (3 years or so now?)- 75% of the time was spent fine tuning values.<br><br>Even a difference of 0.0001 can make a difference to the handling. <br><br></td></tr></table><br>
<a name="604854"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >stayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#67">[#67]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey all, just wanted to show a couple of quick videos (divx) of the project I've recently started since I got back into Blitz3D.  The car is a work in progress Audi TT, no texture (hence the funny looking chrome HDRI).  City is something I threw together in 3DWS.<br><br>I have to say that JV-ODE was well worth the purchase.  I'm having a blast...<br><br><a href="http://www.strafed.net/stuff/dr1ve-2005-12-10-divx.avi" target="_blank">http://www.strafed.net/stuff/dr1ve-2005-12-10-divx.avi</a><br> <br><a href="http://www.strafed.net/stuff/dr1ve-2005-12-10-2-divx.avi" target="_blank">http://www.strafed.net/stuff/dr1ve-2005-12-10-2-divx.avi</a> <br><br></td></tr></table><br>
<a name="604864"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >stayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#68">[#68]</a></td></tr></table></td></tr><tr ><td class="posttext"> Honda Civic this time... slammed into the wall especially for you all :)<br><br>www.strafed.net/stuff/dr1ve-2005-12-11-3-divx.avi <br><br></td></tr></table><br>
<a name="604872"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KuRiX</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#69">[#69]</a></td></tr></table></td></tr><tr ><td class="posttext"> looks good! congratulations markd.<br><br>Too much drag... but good! <br><br></td></tr></table><br>
<a name="604884"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >OJay</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#70">[#70]</a></td></tr></table></td></tr><tr ><td class="posttext"> nice one. reminds me in the old midtown madness :)<br><br>any demo plans? (you know that i had to ask ;)) <br><br></td></tr></table><br>
<a name="604887"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#71">[#71]</a></td></tr></table></td></tr><tr ><td class="posttext"> Those car physics are looking great so far ;)<br><br>I've been lucky enough to see an early WIP of this one and it's fast and smooth during play, could it be the video render speed that gives the impression of excessive drag?<br><br>Anyway, keep up the good work :)<br><br>Now, who was it that said 'holding a drift is impossible' in ODE... hmm... :P <br><br></td></tr></table><br>
<a name="604909"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >stayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#72">[#72]</a></td></tr></table></td></tr><tr ><td class="posttext"> thanks.  yeah there's some drag, working on it.  bit of a balancing act :) <br><br></td></tr></table><br>
<a name="605011"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Chris C</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#73">[#73]</a></td></tr></table></td></tr><tr ><td class="posttext"> quick hack, not sure why some box's are doing random spinny behaviour....<br><br>jvode.bmx<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
SuperStrict

SetGraphicsDriver GLMax2DDriver()
Graphics 800,600,0,0

glMatrixMode(GL_PROJECTION)
glloadidentity
gluPerspective(30.0,800.0/600.0,0.5,1000.0)		' Calculate The Aspect Ratio Of The Window
glMatrixMode(GL_MODELVIEW)

Global jvode:Int=LoadLibraryA( "JV-ODE" )
Global dRegisterODE(key1:Int,key2:Int,key3:Int,key4:Int)"win32"=getprocaddress(jvode,"_odeRegisterODE@16")
Global dWorldCreate:Int()"win32"=getprocaddress(jvode,"_odeWorldCreate@0")
Global dHashSpaceCreate:Int(space:Int)"win32"=getprocaddress(jvode,"_odeHashSpaceCreate@4")
Global dJointGroupCreate:Int(maxsize:Int)"win32"=getprocaddress(jvode,"_odeJointGroupCreate@4")
Global dWorldSetAutoDisableFlag(world:Int,doautodisable:Int)"win32"=getprocaddress(jvode,"_odeWorldSetAutoDisableFlag@8")
Global dWorldSetGravity(world:Int,x#,y#,z#)"win32"=getprocaddress(jvode,"_odeWorldSetGravity@16")
Global dContactSetMode(mode:Int)"win32"=getprocaddress(jvode,"_odeContactSetMode@4")
Global dContactSetBounce(bounce#)"win32"=getprocaddress(jvode,"_odeContactSetBounce@4")
Global dContactSetMu(mu#)"win32"=getprocaddress(jvode,"_odeContactSetMu@4")
Global dSpaceCollide(space:Int,world:Int,group:Int)"win32"=getprocaddress(jvode,"_odeSpaceCollide@12")
Global dWorldQuickStep(world:Int,stepsize#)"win32"=getprocaddress(jvode,"_odeWorldQuickStep@8")
Global dJointGroupEmpty(group:Int)"win32"=getprocaddress(jvode,"_odeJointGroupEmpty@4")
Global dBodyCreate:Int(world:Int)"win32"=getprocaddress(jvode,"_odeBodyCreate@4")
Global dBodySetPosition(body:Int,x#,y#,z#)"win32"=getprocaddress(jvode,"_odeBodySetPosition@16")
Global dBodySetRotation(body:Int,pitch#,yaw#,roll#)"win32"=getprocaddress(jvode,"_odeBodySetRotation@16")
Global dBodySetAutoDisableFlag(body:Int,doautodisable:Int)"win32"=getprocaddress(jvode,"_odeBodySetAutoDisableFlag@8")
Global dCreateBox:Int(space:Int,lx#,ly#,lz#)"win32"=getprocaddress(jvode,"_odeCreateBox@16")
Global dGeomSetBody(geom:Int,body:Int)"win32"=getprocaddress(jvode,"_odeGeomSetBody@8")
Global dBodyIsEnabled:Int(body:Int)"win32"=getprocaddress(jvode,"_odeBodyIsEnabled@4")
Global dGeomGetPositionX#(geom:Int)"win32"=getprocaddress(jvode,"_odeGeomGetPositionX@4")
Global dGeomGetPositionY#(geom:Int)"win32"=getprocaddress(jvode,"_odeGeomGetPositionY@4")
Global dGeomGetPositionZ#(geom:Int)"win32"=getprocaddress(jvode,"_odeGeomGetPositionZ@4")
Global dGeomGetPitch#(geom:Int)"win32"=getprocaddress(jvode,"_odeGeomGetPitch@4")
Global dGeomGetYaw#(geom:Int)"win32"=getprocaddress(jvode,"_odeGeomGetYaw@4")
Global dGeomGetRoll#(geom:Int)"win32"=getprocaddress(jvode,"_odeGeomGetRoll@4")
Global dCreatePlane%(space:Int,a#,b#,c#,d#)"win32"=getprocaddress(jvode,"_odeCreatePlane@20")


Const dContactBounce:Int=$004

Type ODEGeom
	Field body:Int
	Field geom:Int
	Field mesh:Int
	Field r#,g#,b#
End Type

Global obs:ODEGeom[]
Global maxob:Int=0

dRegisterODE($xxxxxxxx,$xxxxxxxx,$xxxxxxxx,$xxxxxxxx)

Global World:Int=dWorldCreate()
Global Space:Int=dHashSpaceCreate(0)
Global ContactGroup:Int=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,-0.98,0)
dContactSetMode(dContactBounce)
dContactSetBounce(0.1)
dContactSetMu(48)
dCreatePlane(Space,0,1,0,0)

Global tim:Int

While Not AppTerminate()

	If MilliSecs()-Tim&gt;700
		AddObject()
		Tim=MilliSecs()
	End If	

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)

	UpdateGeoms()


Wend

Function AddObject()

	maxob:+1
	obs=obs[..maxob+1]
	Local xp#=Rand(-10,10)
	Local zp#=Rand(-10,10)
	obs[maxob]=New ODEGeom
	obs[maxob].body=dBodyCreate(World)
	dBodySetRotation(obs[maxob].body,0,0,0)
	dBodySetPosition(obs[maxob].body,xp,30,zp)
	dBodySetAutoDisableFlag(obs[maxob].body,1)
	obs[maxob].geom=dCreateBox(Space,5,5,5)
	dGeomSetBody(obs[maxob].geom,obs[maxob].body)

	obs[maxob].r=Rnd(0.5,1)
	obs[maxob].g=Rnd(0.5,1)
	obs[maxob].b=Rnd(0.5,1)
End Function

Function UpdateGeoms()
	glclear GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT
	For Local ode:ODEGeom=EachIn obs
			glloadidentity()
			glrotatef 45,1,0,0
			gltranslatef 0,-100,-100

			gltranslatef dGeomGetPositionX#(ode.geom),dGeomGetPositionY#(ode.geom),dGeomGetPositionZ#(ode.geom)
	 		glrotatef dGeomGetPitch#(ode.geom),1,0,0
	 		glrotatef dGeomGetYaw#(ode.geom),0,1,0
	 		glrotatef dGeomGetRoll#(ode.geom),0,0,1
			glcolor3f ode.r,ode.g,ode.b
			drawbox(5,5,5)
	Next
	Flip
End Function

' taken from a nehe tutorial...
Function DrawBox(x#,y#,z#)	
	Local lx:Float = x#*0.5
	Local ly:Float = y#*0.5
	Local lz:Float = z#*0.5

  	glBegin(GL_QUADS)
    '// Back Face
    glNormal3f( 0.0, 0.0,-1.0)';// Normal Pointing Away From Viewer
    glTexCoord2f(1.0, 0.0); glVertex3f(-lx, -ly, -lz)';// Point 1 (Back)
    glTexCoord2f(1.0, 1.0); glVertex3f(-lx,  ly, -lz)';// Point 2 (Back)
    glTexCoord2f(0.0, 1.0); glVertex3f( lx,  ly, -lz)';// Point 3 (Back)
    glTexCoord2f(0.0, 0.0); glVertex3f( lx, -ly, -lz)';// Point 4 (Back)
    '// Top Face
    glNormal3f( 0.0, 1.0, 0.0)';// Normal Pointing Up
    glTexCoord2f(0.0, 1.0); glVertex3f(-lx,  ly, -lz)';// Point 1 (Top)
    glTexCoord2f(0.0, 0.0); glVertex3f(-lx,  ly,  lz)';// Point 2 (Top)
    glTexCoord2f(1.0, 0.0); glVertex3f( lx,  ly,  lz)';// Point 3 (Top)
    glTexCoord2f(1.0, 1.0); glVertex3f( lx,  ly, -lz)';// Point 4 (Top)
    '// Bottom Face
    glNormal3f( 0.0,-1.0, 0.0)';// Normal Pointing Down
    glTexCoord2f(1.0, 1.0); glVertex3f(-lx, -ly, -lz)';// Point 1 (Bottom)
    glTexCoord2f(0.0, 1.0); glVertex3f( lx, -ly, -lz)';// Point 2 (Bottom)
    glTexCoord2f(0.0, 0.0); glVertex3f( lx, -ly,  lz)';// Point 3 (Bottom)
    glTexCoord2f(1.0, 0.0); glVertex3f(-lx, -ly,  lz)';// Point 4 (Bottom)
    '// Right face
    glNormal3f( 1.0, 0.0, 0.0)';// Normal Pointing Right
    glTexCoord2f(1.0, 0.0); glVertex3f( lx, -ly, -lz)';// Point 1 (Right)
    glTexCoord2f(1.0, 1.0); glVertex3f( lx,  ly, -lz)';// Point 2 (Right)
    glTexCoord2f(0.0, 1.0); glVertex3f( lx,  ly,  lz)';// Point 3 (Right)
    glTexCoord2f(0.0, 0.0); glVertex3f( lx, -ly,  lz)';// Point 4 (Right)
    '// Left Face
    glNormal3f(-1.0, 0.0, 0.0)';// Normal Pointing Left
    glTexCoord2f(0.0, 0.0); glVertex3f(-lx, -ly, -lz)';// Point 1 (Left)
    glTexCoord2f(1.0, 0.0); glVertex3f(-lx, -ly,  lz)';// Point 2 (Left)
    glTexCoord2f(1.0, 1.0); glVertex3f(-lx,  ly,  lz)';// Point 3 (Left)
    glTexCoord2f(0.0, 1.0); glVertex3f(-lx,  ly, -lz)';// Point 4 (Left)
   '// Front Face
	glNormal3f( 0.0, 0.0, 1.0)';// Normal Pointing Towards Viewer
   	glTexCoord2f(0.0, 0.0); glVertex3f(-lx, -ly,  lz)';// Point 1 (Front)
   	glTexCoord2f(1.0, 0.0); glVertex3f( lx, -ly,  lz)';// Point 2 (Front)
   	glTexCoord2f(1.0, 1.0); glVertex3f( lx,  ly,  lz)';// Point 3 (Front)
   	glTexCoord2f(0.0, 1.0); glVertex3f(-lx,  ly,  lz)';// Point 4 (Front)
	glend
EndFunction


</textarea> <br><br></td></tr></table><br>
<a name="605014"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Chris C</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#74">[#74]</a></td></tr></table></td></tr><tr ><td class="posttext"> ehem, oops<br>glDepthFunc GL_LEQUAL<br>glEnable GL_DEPTH_TEST<br>after graphics command! <br><br></td></tr></table><br>
<a name="605019"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Chris C</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#75">[#75]</a></td></tr></table></td></tr><tr ><td class="posttext"> hmmm autodisable doesnt seem to work either... <br><br></td></tr></table><br>
<a name="605031"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >OJay</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#76">[#76]</a></td></tr></table></td></tr><tr ><td class="posttext"> ehm...Chris C: this is a <b>Blitz3D</b> forum! i doubt anybody can help you in here with <i>BlitzMax</i>... ;)<br><br>and did you notice the [Edit]-Button in the top right of your posts?!? <br><br></td></tr></table><br>
<a name="605045"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Chris C</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#77">[#77]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah well somone wanted jvode working with max...<br>wish I hadnt bothered now. <br><br></td></tr></table><br>
<a name="605054"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#78">[#78]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm glad you bothered, Chris. I don't think he meant to be offensive. What you posted was pretty cool! <br><br></td></tr></table><br>
<a name="605061"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Chris C</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#79">[#79]</a></td></tr></table></td></tr><tr ><td class="posttext"> interestingly with spheres as well the spheres disable but not the box's... <br><br></td></tr></table><br>
<a name="605089"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >OJay</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#80">[#80]</a></td></tr></table></td></tr><tr ><td class="posttext"> sorry chris, surely didn't want to offend you! i just wanted to say, that someone who looks for ode-stuff for blitzmax, won't look into a blitz3d forum!<br><br>why not open a separate thread in the bmax-forums? <br><br></td></tr></table><br>
<a name="605134"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#81">[#81]</a></td></tr></table></td></tr><tr ><td class="posttext"> Does VIP3R have BlitzMax for development purposes? <br><br></td></tr></table><br>
<a name="605256"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#82">[#82]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nice work Chris and thanks for posting it, I'll take a look at the code and see what I can do to help ;)<br><br>@Shifty: Yep, I've got BlitzMax ;) <br><br></td></tr></table><br>
<a name="605470"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#83">[#83]</a></td></tr></table></td></tr><tr ><td class="posttext"> How does BlitzMax compare at the moment for overall usefulness and reliablility versus Blitz? Not that I'll swuitch on my current project, but I'm interested in how well cross-platform works and whether the better structuring (from what I hear) helps a lot. The lack of a 'proper' default 3D engine and Blitz's wonderfully simple entity system has me thinking it'll be a lot more effort to get the same results. So how does say writing porting an OE project (or writing a similar one) compare? <br><br></td></tr></table><br>
<a name="605804"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#84">[#84]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm...<br><br>In BlitzMax, reliability is no where near the level of Blitz3D yet. The cross platform feature is ok, providing you also have a Mac system and Linux set up. Due to the vastly different code structuring, it's easier to write a BMax project from scratch rather than port older Blitz projects over. (IMO)<br><br>Also, Win32 DLL's (including JV-ODE) won't work on the Mac and Linux platforms. <br><br></td></tr></table><br>
<a name="606039"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Alienforce</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#85">[#85]</a></td></tr></table></td></tr><tr ><td class="posttext"> VIP3R: Is it possible todo a zerogravity simulation with JV-ODE .. I have tried but i cant get it working. Do you have any idea/exemple ?? <br><br></td></tr></table><br>
<a name="606049"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#86">[#86]</a></td></tr></table></td></tr><tr ><td class="posttext"> Set gravity to (0,0,0). Or disable gravity for any objects you don't want affected by gravity. <br><br></td></tr></table><br>
<a name="606108"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Alienforce</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#87">[#87]</a></td></tr></table></td></tr><tr ><td class="posttext"> Doh!!! (smacking the head to keyboard)..<br>I shall try that, thanks Shifty. :) <br><br></td></tr></table><br>
<a name="607563"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Panno</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#88">[#88]</a></td></tr></table></td></tr><tr ><td class="posttext"> vip3r <br>i see a demo with a terrain (blitzterrain i hope) and balls on <a href="http://www.devcode.co.uk/jv-ode.html" target="_blank">http://www.devcode.co.uk/jv-ode.html</a><br><br><br>where is the bb demo ? <br><br></td></tr></table><br>
<a name="607615"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >stayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#89">[#89]</a></td></tr></table></td></tr><tr ><td class="posttext"> new video up.  i can barely drive my own car :)<br><br>www.strafed.net/stuff/dr1ve-2005-12-17-4-divx.avi<br><br>edit: updated video... added (90% finished) manual transmission emulation. <br><br></td></tr></table><br>
<a name="607654"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#90">[#90]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Panno, the terrain is made from a static mesh (ODE TriMesh). It isn't possible to use Blitz terrains directly, but you can generate a static collision mesh from a heightmap easily (see FLE in tools). The TriMesh is only supported in the full version of JV-ODE.<br><br>@markd: Nice video, keep 'em coming ;) <br><br></td></tr></table><br>
<a name="607680"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#91">[#91]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here's a modified car demo capable of much higher speeds. The rear wheels are extremely stable when splitting the physics steps each frame (see the Main Loop), resulting in vastly improved accuracy of the simulation.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #										  JV-ODE Car Demo											#
; #									Code by Jim Williams (VIP3R)									#		#
; #						Feel free to use this code, any credit appreciated							#
; ###################################################################################################

AppTitle "JV-ODE Car Demo - High Speed"

Include "JV-ODE.bb"

Graphics3D 800,600,0,2

Global CMass#=200			; ### Car Mass
Global WMass#=14			; ### Wheel Mass

Global WorldERP#=0.8		; ### World Error Correction
Global WorldFriction#=80	; ### World Friction

Global Torque#=48			; ### Joint Torque
Global SuspensionHS#=0.01	; ### Suspension Hardness/Softness (Higher=Softer - Lower=Harder)

Global Force#=0
Global Steer#=0

Global Car
Global CGeom
Global CMesh

Global CarStartY=4

Dim Wheel(4)
Dim WGeom(4)
Dim Joint(4)

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

; ###################################################################################################

; ### Setup ODE

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,-0.98,0)
dWorldSetERP(World,WorldERP)

dContactSetMode(dContactSlip1)
dContactSetMu(WorldFriction)

; ### Create car body

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
Car=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,0,CarStartY,0)
mass=dMassCreate()
dMassSetBoxTotal(mass,CMass,3,1,4)
dMassTranslate(mass,0,-1,0)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
ode\geom=dCreateBox(Space,3,1,4)
CGeom=ode\geom
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
CMesh=ode\mesh
ScaleMesh ode\mesh,1.5,0.5,2
RotateMesh ode\mesh,0,0,0
PositionMesh ode\mesh,0,0,0
EntityColor ode\mesh,40,80,255
EntityAlpha ode\mesh,1

; ### Create wheels

For count=1 To 4
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	Wheel(count)=ode\body
	dBodySetRotation(ode\body,0,0,0)
	dBodySetPosition(ode\body,0,0,0)
	mass=dMassCreate()
	dMassSetSphereTotal(mass,WMass,0.7)
	dBodySetMass(ode\body,mass)
	dMassDestroy(mass)
	ode\geom=dCreateSphere(Space,0.7)
	WGeom(count)=ode\geom
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder(8)
	ScaleMesh ode\mesh,0.7,0.25,0.7
	RotateMesh ode\mesh,0,0,90
	PositionMesh ode\mesh,0,0,0
	EntityColor ode\mesh,255,255,255
Next

dBodySetPosition(Wheel(1),-2,CarStartY-0.5,+2)
dBodySetPosition(Wheel(2),+2,CarStartY-0.5,+2)
dBodySetPosition(Wheel(3),-2,CarStartY-0.5,-2)
dBodySetPosition(Wheel(4),+2,CarStartY-0.5,-2)

; ### Create some objects

SeedRnd MilliSecs()

For spheres=1 To 40
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	dBodySetRotation(ode\body,0,0,0)
	dBodySetPosition(ode\body,Rnd(-800,800),30,Rnd(-800,800))
	ode\geom=dCreateSphere(Space,4)
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateSphere()
	ScaleMesh ode\mesh,4,4,4
	RotateMesh ode\mesh,0,0,0
	PositionMesh ode\mesh,0,0,0
	EntityColor ode\mesh,Rnd(255),Rnd(255),Rnd(255)
	EntityAlpha ode\mesh,1
	EntityShininess ode\mesh,0.7
Next

For cylinders=1 To 40
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	dBodySetRotation(ode\body,90,0,0)
	dBodySetPosition(ode\body,Rnd(-800,800),30,Rnd(-800,800))
	ode\geom=dCreateCCylinder(Space,1,8)
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder(8)
	ScaleMesh ode\mesh,1,5,1
	RotateMesh ode\mesh,90,0,0	; &lt;&lt;&lt; Mesh X-Axis must be rotated 90 degrees to fix cylinder alignment
	PositionMesh ode\mesh,0,0,0
	EntityColor ode\mesh,Rnd(255),Rnd(255),Rnd(255)
	EntityAlpha ode\mesh,1
	EntityShininess ode\mesh,0.7
Next

; ### Create light

Global Light=CreateLight()

RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera

Global CameraPivot=CreatePivot(CMesh)
PositionEntity CameraPivot,0,2,-7

Global Camera=CreateCamera()
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000

; ### Create plane

dCreatePlane(Space,0,1,0,0)

Plane=CreatePlane()

EntityAlpha Plane,0.8

PlaneTexture=CreateTexture(128,128,9)

ClsColor 0,200,80
Cls

Color 255,255,255

Rect 0,0,64,64,1
Rect 64,64,64,64,1

CopyRect 0,0,128,128,0,0,BackBuffer(),TextureBuffer(PlaneTexture)
ScaleTexture PlaneTexture,20,20
EntityTexture Plane,PlaneTexture,0,0

Mirror=CreateMirror()

; ###################################################################################################

; ### BLITZ STATIC OBJECT (White)

blitzobject=CreateCube()
ScaleMesh blitzobject,1,4,20
RotateMesh blitzobject,-10,8,4
PositionMesh blitzobject,10,5,40

EntityColor blitzobject,255,255,255
EntityAlpha blitzobject,1

; ### ODE STATIC OBJECT (Blue)

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,2,8,40)
dGeomSetRotation(ode\geom,-10,8,4)
dGeomSetPosition(ode\geom,20,5,40)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,1,4,20
RotateMesh ode\mesh,0,0,0
PositionMesh ode\mesh,0,0,0

EntityColor ode\mesh,0,100,200
EntityAlpha ode\mesh,1

; ### ODE STATIC OBJECT (Red)

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,18,0.2,40)
dGeomSetRotation(ode\geom,-14,0,0)
dGeomSetPosition(ode\geom,-20,4.9,40)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,9,0.1,20
RotateMesh ode\mesh,0,0,0
PositionMesh ode\mesh,0,0,0

EntityColor ode\mesh,200,0,100
EntityAlpha ode\mesh,1

; ###################################################################################################

SetupCar()

While Not KeyHit(1)

	UpdateKeys()

	PTime=MilliSecs()

	UpdateCar()

	UpdateGeoms()

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.025)
	dJointGroupEmpty(ContactGroup)

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.025)
	dJointGroupEmpty(ContactGroup)

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.025)
	dJointGroupEmpty(ContactGroup)

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.025)
	dJointGroupEmpty(ContactGroup)

	PhysicsTime#=MilliSecs()-PTime

	UpdateCam()

	UpdateWorld

	RenderWorld

	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime
	Text 0,50,"Force:"+Force
	Text 0,65,"Torque:"+Torque
	Text 640,0,"A - Accelerate"
	Text 640,15,"Z - Brake/Reverse"
	Text 640,30,"Arrows - Steering"
	Text 640,45,"Space - Reset Car"

	Flip

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function SetupCar()

For count=1 To 4
	Joint(count)=dJointCreateHinge2(World,0)
	dJointAttach(Joint(count),Car,Wheel(count))
	dJointSetHinge2Anchor(Joint(count),dBodyGetPositionX(Wheel(count)),dBodyGetPositionY(Wheel(count)),dBodyGetPositionZ(Wheel(count)))
	dJointSetHinge2Axis1(Joint(count),0,1,0)
	dJointSetHinge2Axis2(Joint(count),-1,0,0)
	dJointSetHinge2Param(Joint(count),dParamSuspensionERP,0.8)
	dJointSetHinge2Param(Joint(count),dParamSuspensionCFM,SuspensionHS)
	If count&gt;2
		dJointSetHinge2Param(Joint(count),dParamLoStop,0)
		dJointSetHinge2Param(Joint(count),dParamHiStop,0)
		End If
Next

Force=0

End Function

; ###################################################################################################

Function UpdateKeys()

If KeyDown(30)=1
	Force=Force+0.08
	If Force&gt;140 Then Force=140
	End If

If KeyDown(44)=1
	Force=Force-0.1
	If Force&lt;-10 Then Force=-10
	If Force&gt;0 Then Force=Force*0.97
	End If

If KeyDown(30)=0 And KeyDown(44)=0 Then Force=Force*0.99

If KeyDown(203)=1 Or KeyDown(205)=1
	If KeyDown(203)=1
		Steer=0.5
		Else
		Steer=-0.5
		End If
	Else
	Steer=0
	End If

If KeyHit(57)=1
	Force=0
	dBodySetRotation(Car,dGeomGetPitch#(CGeom),dGeomGetYaw#(CGeom),0)
	End If

End Function

; ###################################################################################################

Function UpdateCar()

For count=1 To 4
	dBodyEnable(Wheel(count))
Next

dBodyEnable(Car)

For count=1 To 4
	dJointSetHinge2Param(Joint(count),dParamVel2,Force)
	dJointSetHinge2Param(Joint(count),dParamFMax2,Torque)
Next

For count=1 To 2
	angle#=Steer-dJointGetHinge2Angle1(Joint(count))
	dJointSetHinge2Param(Joint(count),dParamVel,angle)
	dJointSetHinge2Param(Joint(count),dParamFMax,400)
Next

End Function

; ###################################################################################################

Function UpdateCam()

PositionEntity CameraPivot,0,3,-12

camx#=EntityX(CameraPivot,1)-EntityX(Camera)
camy#=EntityY(CameraPivot,1)-EntityY(Camera)
camz#=EntityZ(CameraPivot,1)-EntityZ(Camera)

TranslateEntity Camera,camx*0.5,camy*0.5,camz*0.5

PointEntity Camera,CMesh

End Function

; ###################################################################################################

Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
	RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
	PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
Next

End Function

; ###################################################################################################
</textarea> <br><br></td></tr></table><br>
<a name="607713"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#92">[#92]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here's a car demo showing Geom Transform of the car body, it's a very good alternative of using mass translate to lower the COG and prevent flipping.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #										  JV-ODE Car Demo											#
; #									Code by Jim Williams (VIP3R)									#		#
; #						Feel free to use this code, any credit appreciated							#
; ###################################################################################################

AppTitle "JV-ODE Car Demo - Geom Transform - Car"

Include "JV-ODE.bb"

Graphics3D 800,600,0,2

Global CMass#=200			; ### Car Mass
Global WMass#=14			; ### Wheel Mass

Global WorldERP#=1			; ### World Error Correction
Global WorldFriction#=140	; ### World Friction

Global Torque#=24			; ### Joint Torque
Global SuspensionHS#=0.01	; ### Suspension Hardness/Softness (Higher=Softer - Lower=Harder)

Global Force#=0
Global Steer#=0

Global Car
Global CGeom
Global CMesh

Global CarStartY=20

Dim Wheel(4)
Dim WGeom(4)
Dim Joint(4)

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

; ###################################################################################################

; ### Setup ODE

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,-0.98,0)
dWorldSetERP(World,WorldERP)

dContactSetMode(dContactSlip1)
dContactSetMu(WorldFriction)

; ### Create car body

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
Car=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,0,CarStartY-1,0)
mass=dMassCreate()
dMassSetBoxTotal(mass,CMass,3,1,4)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
ode\geom=dCreateBox(Space,0,0,0)
CGeom=ode\geom
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
CMesh=ode\mesh
ScaleMesh ode\mesh,1.5,0.5,2
RotateMesh ode\mesh,0,0,0
PositionMesh ode\mesh,0,0,0
EntityColor ode\mesh,255,40,80
EntityAlpha ode\mesh,0.4

TransformGeom=dCreateGeomTransform(Space)
GeomObject=dCreateBox(0,3,1,4)
dGeomSetPosition(GeomObject,0,1,0)
dGeomTransformSetGeom(TransformGeom,GeomObject)
dGeomTransformSetCleanup(TransformGeom,1)
dGeomSetBody(TransformGeom,ode\body)

GeomMesh=CreateCube(ode\mesh)
ScaleMesh GeomMesh,1.5,0.5,2
RotateMesh GeomMesh,0,0,0
PositionMesh GeomMesh,0,1,0
EntityColor GeomMesh,40,80,255
EntityAlpha GeomMesh,0.7
EntityShininess GeomMesh,0.7

; ### Create wheels

For count=1 To 4
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	Wheel(count)=ode\body
	dBodySetRotation(ode\body,0,0,0)
	dBodySetPosition(ode\body,0,0,0)
	mass=dMassCreate()
	dMassSetSphereTotal(mass,WMass,0.7)
	dBodySetMass(ode\body,mass)
	dMassDestroy(mass)
	ode\geom=dCreateSphere(Space,0.7)
	WGeom(count)=ode\geom
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder(8)
	ScaleMesh ode\mesh,0.7,0.25,0.7
	RotateMesh ode\mesh,0,0,90
	PositionMesh ode\mesh,0,0,0
	EntityColor ode\mesh,255,255,255
Next

dBodySetPosition(Wheel(1),-2,CarStartY-0.5,+2)
dBodySetPosition(Wheel(2),+2,CarStartY-0.5,+2)
dBodySetPosition(Wheel(3),-2,CarStartY-0.5,-2)
dBodySetPosition(Wheel(4),+2,CarStartY-0.5,-2)

; ### Create some objects

SeedRnd MilliSecs()

For spheres=1 To 20
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	dBodySetRotation(ode\body,0,0,0)
	dBodySetPosition(ode\body,Rnd(-100,100),30,Rnd(-100,100))
	ode\geom=dCreateSphere(Space,4)
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateSphere()
	ScaleMesh ode\mesh,4,4,4
	RotateMesh ode\mesh,0,0,0
	PositionMesh ode\mesh,0,0,0
	EntityColor ode\mesh,Rnd(255),Rnd(255),Rnd(255)
	EntityAlpha ode\mesh,1
	EntityShininess ode\mesh,0.7
Next

For cylinders=1 To 20
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	dBodySetRotation(ode\body,90,0,0)
	dBodySetPosition(ode\body,Rnd(-100,100),30,Rnd(-100,100))
	ode\geom=dCreateCCylinder(Space,1,8)
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder(8)
	ScaleMesh ode\mesh,1,5,1
	RotateMesh ode\mesh,90,0,0	; &lt;&lt;&lt; Mesh X-Axis must be rotated 90 degrees to fix cylinder alignment
	PositionMesh ode\mesh,0,0,0
	EntityColor ode\mesh,Rnd(255),Rnd(255),Rnd(255)
	EntityAlpha ode\mesh,1
	EntityShininess ode\mesh,0.7
Next

; ### Create light

Global Light=CreateLight()

RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera

Global CameraPivot=CreatePivot(CMesh)
PositionEntity CameraPivot,0,2,-7

Global Camera=CreateCamera()
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000

; ### Create plane

dCreatePlane(Space,0,1,0,0)

Plane=CreatePlane()

EntityAlpha Plane,0.8

PlaneTexture=CreateTexture(128,128,9)

ClsColor 0,200,80
Cls

Color 255,255,255

Rect 0,0,64,64,1
Rect 64,64,64,64,1

CopyRect 0,0,128,128,0,0,BackBuffer(),TextureBuffer(PlaneTexture)
ScaleTexture PlaneTexture,20,20
EntityTexture Plane,PlaneTexture,0,0

Mirror=CreateMirror()

; ###################################################################################################

; ### BLITZ STATIC OBJECT (White)

blitzobject=CreateCube()
ScaleMesh blitzobject,1,4,20
RotateMesh blitzobject,-10,8,4
PositionMesh blitzobject,10,5,40

EntityColor blitzobject,255,255,255
EntityAlpha blitzobject,1

; ### ODE STATIC OBJECT (Blue)

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,2,8,40)
dGeomSetRotation(ode\geom,-10,8,4)
dGeomSetPosition(ode\geom,20,5,40)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,1,4,20
RotateMesh ode\mesh,0,0,0
PositionMesh ode\mesh,0,0,0

EntityColor ode\mesh,0,100,200
EntityAlpha ode\mesh,1

; ### ODE STATIC OBJECT (Red)

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,18,0.2,40)
dGeomSetRotation(ode\geom,-14,0,0)
dGeomSetPosition(ode\geom,-20,4.9,40)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,9,0.1,20
RotateMesh ode\mesh,0,0,0
PositionMesh ode\mesh,0,0,0

EntityColor ode\mesh,200,0,100
EntityAlpha ode\mesh,1

; ###################################################################################################

SetupCar()

While Not KeyHit(1)

	UpdateKeys()

	PTime=MilliSecs()

	UpdateCar()

	UpdateGeoms()

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)

	PhysicsTime#=MilliSecs()-PTime

	UpdateCam()

	UpdateWorld

	RenderWorld

	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime
	Text 0,50,"Force:"+Force
	Text 0,65,"Torque:"+Torque
	Text 0,100,"Blue = Geom Transform"
	Text 0,115,"Red = Body/Mass Position"
	Text 640,0,"A - Accelerate"
	Text 640,15,"Z - Brake/Reverse"
	Text 640,30,"Arrows - Steering"
	Text 640,45,"Space - Reset Car"

	Flip

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function SetupCar()

For count=1 To 4
	Joint(count)=dJointCreateHinge2(World,0)
	dJointAttach(Joint(count),Car,Wheel(count))
	dJointSetHinge2Anchor(Joint(count),dBodyGetPositionX(Wheel(count)),dBodyGetPositionY(Wheel(count)),dBodyGetPositionZ(Wheel(count)))
	dJointSetHinge2Axis1(Joint(count),0,1,0)
	dJointSetHinge2Axis2(Joint(count),-1,0,0)
	dJointSetHinge2Param(Joint(count),dParamSuspensionERP,0.8)
	dJointSetHinge2Param(Joint(count),dParamSuspensionCFM,SuspensionHS)
	If count&gt;2
		dJointSetHinge2Param(Joint(count),dParamLoStop,0)
		dJointSetHinge2Param(Joint(count),dParamHiStop,0)
		End If
Next

Force=0

End Function

; ###################################################################################################

Function UpdateKeys()

If KeyDown(30)=1
	Force=Force+0.08
	If Force&gt;30 Then Force=30
	End If

If KeyDown(44)=1
	Force=Force-0.1
	If Force&lt;-10 Then Force=-10
	If Force&gt;0 Then Force=Force*0.97
	End If

If KeyDown(30)=0 And KeyDown(44)=0 Then Force=Force*0.99

If KeyDown(203)=1 Or KeyDown(205)=1
	If KeyDown(203)=1
		Steer=0.5
		Else
		Steer=-0.5
		End If
	Else
	Steer=0
	End If

If KeyHit(57)=1
	Force=0
	dBodySetRotation(Car,dGeomGetPitch#(CGeom),dGeomGetYaw#(CGeom),0)
	End If

End Function

; ###################################################################################################

Function UpdateCar()

For count=1 To 4
	dBodyEnable(Wheel(count))
Next

dBodyEnable(Car)

For count=1 To 4
	dJointSetHinge2Param(Joint(count),dParamVel2,Force)
	dJointSetHinge2Param(Joint(count),dParamFMax2,Torque)
Next

For count=1 To 2
	angle#=Steer-dJointGetHinge2Angle1(Joint(count))
	dJointSetHinge2Param(Joint(count),dParamVel,angle)
	dJointSetHinge2Param(Joint(count),dParamFMax,400)
Next

End Function

; ###################################################################################################

Function UpdateCam()

PositionEntity CameraPivot,0,3,-12

camx#=EntityX(CameraPivot,1)-EntityX(Camera)
camy#=EntityY(CameraPivot,1)-EntityY(Camera)
camz#=EntityZ(CameraPivot,1)-EntityZ(Camera)

TranslateEntity Camera,camx*0.5,camy*0.5,camz*0.5

PointEntity Camera,CMesh

End Function

; ###################################################################################################

Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
	RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
	PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
Next

End Function

; ###################################################################################################
</textarea> <br><br></td></tr></table><br>
<a name="608134"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#93">[#93]</a></td></tr></table></td></tr><tr ><td class="posttext"> dJointGetHingeAngle() seems to return the same vector values (from dVector..()) as dJointGetHingeAnchor(). I've a seesaw with hinge at (0,20,0) that returns (0,20,0) for both functions, even after it's tipped one way and rotated. Does dJointGetHingeAngle() populate the dVector() values correctly, or is there some other similar bug? <br><br></td></tr></table><br>
<a name="608137"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#94">[#94]</a></td></tr></table></td></tr><tr ><td class="posttext"> dJointGetHingeAngle() isn't a vector function, it returns the angle directly...<br>angle#=dJointGetHingeAngle(joint) ;)<br><br>The dJointGetHingeAnchor() function is a vector function though, it fills dVectorX(), dVectorY() and dVectorZ(). <br><br></td></tr></table><br>
<a name="608154"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#95">[#95]</a></td></tr></table></td></tr><tr ><td class="posttext"> :D <br><br></td></tr></table><br>
<a name="608766"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mark Judd</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#96">[#96]</a></td></tr></table></td></tr><tr ><td class="posttext"> VIP3R,<br><br>Just messing with the friction settings and am trying to get to grips (!) with the mu2 slip2 settings etc.<br><br>Can't seem to find any way of setting the fdir setting though - this is where you specify the contact joint direction and i think it might help with the 'drifting' question that keeps cropping up.<br><br>Is this facility available in JV-ODE or am i missing something ? (again!)<br><br>cheers,<br><br>Mark <br><br></td></tr></table><br>
<a name="608771"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Vorderman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#97">[#97]</a></td></tr></table></td></tr><tr ><td class="posttext"> I believe you're supposed to set fdir to the forward axis of the wheel, then ODE can apply mu1 and mu2 appropriately - no idea how you calculate fdir on the fly though, as I think it's a world vector and not local to the wheels. <br><br></td></tr></table><br>
<a name="608843"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#98">[#98]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>Can't seem to find any way of setting the fdir setting though<br> <br></div><br>The fdir1 vector is currently only accessible internally in the wrapper, it shouldn't be too much trouble to add some new functions for this though.<br><br>I'll add it to the 2do for V1.10 ;) <br><br></td></tr></table><br>
<a name="608864"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mark Judd</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#99">[#99]</a></td></tr></table></td></tr><tr ><td class="posttext"> Vorderman, I was kind of hoping to set the fdir direction to the orientation of the wheel and then use slip2 and mu2 to vary the sideways slide of the wheel.<br>I may have misunderstood the ODE docs though!<br><br>VIP3R, Thats great - thanks very much.<br><br>cheers<br><br>Mark <br><br></td></tr></table><br>
<a name="608886"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Vorderman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#100">[#100]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Vorderman, I was kind of hoping to set the fdir direction to the orientation of the wheel and then use slip2 and mu2 to vary the sideways slide of the wheel. <br></div><br><br>Yeah that's what I said (or at least, what I meant to say :) ) <br><br></td></tr></table><br>
<a name="609573"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#101">[#101]</a></td></tr></table></td></tr><tr ><td class="posttext"> Merry Christmas everyone :)<br><br>I've been experimenting with the new JV-ODE FDir1 (friction direction vector) functions and I'm amazed how much fine control it gives for an objects friction. Friction can be set individually on each axis so you can control sideways friction/slip etc.<br><br>It's perfect for setting up good powersliding conditions in car sims! It also makes good car setups of any kind much easier to achieve.<br><br>Coming very soon in V1.10<br><br>Thanks to Mark Judd for the suggestion ;) <br><br></td></tr></table><br>
<a name="609732"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TWH</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#102">[#102]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br>I'm quite new in JV-ODE and I'm working on a car sim.<br>I have tried to make a restart button, but every time the car gets positioned in it's start track, it continues in the same speed as it was. For example, if I've just gone round a corner and I press restart, the car gets pushed round and lands so its facing the wrong direction. I have tried to use a command which is called "dBodySetForce", but it did not work!<br>Can somebody help me?<br><br>Alan (or TWH...) <br><br></td></tr></table><br>
<a name="609736"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#103">[#103]</a></td></tr></table></td></tr><tr ><td class="posttext"> Are you resetting the speed and torque etc to zero when the restart button is pressed? It sounds like you're still adding power to the wheels after the restart. <br><br></td></tr></table><br>
<a name="609748"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KuRiX</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#104">[#104]</a></td></tr></table></td></tr><tr ><td class="posttext"> you need to use the next functions:<br><br>dbodysetangularvel<br>dbodysetlinearvel<br><br>for every object and set them to zero! <br><br></td></tr></table><br>
<a name="610022"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TWH</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#105">[#105]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks alot!! <br><br></td></tr></table><br>
<a name="610337"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mark Judd</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#106">[#106]</a></td></tr></table></td></tr><tr ><td class="posttext"> TWH,<br><br>Don't forget to re-set the angular and linear velocities on the wheels as well as the car body, as well as their direction when you restart the car.<br><br>I found it useful to do a small loop where the values are re-set several times, this seems to give the simulation time to sort itself out.<br><br>Hey VIP3R !<br><br>Looking forward to 1.10 very much - but don't forget to eat a few mince pies in-between sessions, wouldn't want your sugar levels dropping too low......<br>Looking forward to huge powerslides now !<br><br>cheers<br><br>Mark <br><br></td></tr></table><br>
<a name="610440"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#107">[#107]</a></td></tr></table></td></tr><tr ><td class="posttext"> <b>JV-ODE V1.10 Update Released!</b><br><br>Please check your inbox :)<br><br>The new update includes:<br><br>Added new Friction Direction 1 contact functions...<br><br>dContactSetFDir1(fdir1x#,fdir1y#,fdir1z#)<br>dContactGetFDir1()<br>dGeomContactSetFDir1(geom,fdir1x#,fdir1y#,fdir1z#)<br>dGeomContactGetFDir1(geom)<br><br>Added new demos...<br><br>CarDemo-FrictionDirection1<br>CarDemo-GeomTransform-Car<br>CarDemo-GeomTransform-Cube<br>CarDemo-GeomTransform-Mixed<br>CarDemo-GeomTransform-Sphere<br>CarDemo-HighSpeed<br><br>Don't forget to update your 'JV-ODE.decls' file in the Blitz3D Userlibs folder!<br><br>Please let me know if you experience any problems with the new update.<br><br>Happy New Year  :) <br><br></td></tr></table><br>
<a name="610615"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mustang</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#108">[#108]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks VIP3R! You should add "new years" fireworks demo with particle / physics stuff to the package :P <br><br></td></tr></table><br>
<a name="610651"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mark Judd</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#109">[#109]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks very much - travelling home today so will try this tonight.<br><br>Once more - cheers for all your work,<br><br>Mark <br><br></td></tr></table><br>
<a name="610656"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KuRiX</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#110">[#110]</a></td></tr></table></td></tr><tr ><td class="posttext"> Good Work Viper! Now that you can access fdir1 i have decided to release here the code to make proper wheels friction:<br><br><pre class=code>
	Vector3 front;
	Vector3 up;
	dReal const * vel = dBodyGetLinearVel( wheel );

	int inv = 1;
	//  Compute fDir1 if a wheel
	dReal const * R = dBodyGetRotation( wheel );
	front = Vector3(R[2] * inv,R[6] * inv,R[10] * inv);
	up = Vector3(R[1] * inv,R[5] * inv,R[9] * inv);
		//  Set Slip2
	contact-&gt;surface.mode |= dContactFDir1;
	float v = sqrtf( vel[0]*vel[0] + vel[1]*vel[1] + vel[2]*vel[2] );
	//contact.surface.slip2 = TIRE_SLIP * v;				
	//  re-tweak mu and mu2
	//contact.surface.mu = contact.surface.mu2 = TIRE_MU;
	//  The theory is that it doesn't matter if "front" points "up" 
	//  because we want fdir2 to be orthogonal to "front" and contact 
	//  normal. Of course, if "front" points in the direction of the 
	//  contact, this can be a problem. In that case, choose "up".
	if( fabsf( dDot( contact-&gt;geom.normal, &amp;front.x, 3 ) ) &gt; 0.5f ) 
		{
		((Vector3 &amp;)contact-&gt;fdir1) = up;
		}
	else
		{
		((Vector3 &amp;)contact-&gt;fdir1) = front;
		}
</pre><br><br>Dvector3 is float[3] and dReal is float.<br><br>The code is based on the cardemo of official ode threads, and it is c++, but it should be easy to be included by Viper on the wrapper or by anyone in Blitz3D!<br><br>Happy Holidays Everyone! <br><br></td></tr></table><br>
<a name="610756"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#111">[#111]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is it possible to get trimesh&lt;&gt;trimesh collisions to work as well as trimesh&lt;&gt;geom collisions? Here's a little test program and two simple meshes...<br><br><a href="http://www.davidcoombes.f2s.com/TriMesh.zip" target="_blank">http://www.davidcoombes.f2s.com/TriMesh.zip</a><br><br>Move the Arrowish shape with the cursor keys. You can crash into the boxes well, but when you hit the drum thing, trimeshes often get stuck and spin off crazy-like. Is this unavoidable?<br><br>And when abouts might we get JV-ODE export/Kurix import from [K]ODE? <br><br></td></tr></table><br>
<a name="610760"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KuRiX</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#112">[#112]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, trimesh-trimesh collision has been always a problem in ODE. They exists, but they have well known stuck problems...<br><br>There is some demos in the official ode source that shows the problems...<br><br>About the exporter... Viper... did you look at the code i sent you? <br><br></td></tr></table><br>
<a name="610781"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#113">[#113]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeh, TriMesh to TriMesh is still way too unreliable in the 0.5 build of ODE unfortunately. Maybe they'll have more success when the new Convex Hull stuff is completed.<br><br>Do you mean [K]ODE exporter / JV-ODE importer?<br><br>I'm still looking at the exporter stuff, I'll be contacting Kuri about that as soon as I've decided how best to implement it. <br><br></td></tr></table><br>
<a name="613656"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >EmerGki</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#114">[#114]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Viper, Do you  think about one demo with one Character with Bones to show how to do this with ODE? <br><br></td></tr></table><br>
<a name="613671"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#115">[#115]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi EmerGki, I'm working on one at the moment as it happens, I'll make it available as soon as it's complete.<br><br>Btw, if anyone needs any help with the FDir1 stuff please let me know, there isn't much info available on FDir1 in the ODE manual.<br><br>The 'CarDemo-FrictionDirection1' demo shows the basics of FDir1 using friction 'mu' only, but friction 'mu2' can also be specified separately. If 'mu2' isn't specified then 'mu' will apply to both friction directions (1 and 2).<br><br>To use FDir1, you need to set your friction mu (and mu2 if needed). Remember to add the FDir1 flag in dContactSetMode(dContactFDir1+dContactSlip1). Next you specify how much friction should be applied to each axis using the dContactSetFDir1(fdir1x#,fdir1y#,fdir1z#) function.<br><br>In the FDir1 car demo fdir1x is the forwards/reverse axis (X), fdir1z is the sideways axis (Z). Lowering the fdir1z value will result in the car sliding sideways more. From the tests I've done with FDir1, it seems that the range for fdir1x, fdir1y and fdir1z is 0.0 to 1.0 (1.0 being 100% friction as set with mu or mu2). <br><br></td></tr></table><br>
<a name="613978"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >EmerGki</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#116">[#116]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey Markd, Today I've take some minutes to see your videos, Are Very Nice =). I have one question, About the scenery, What programm you use to make the roads?<br>Have any specific tool? <br><br></td></tr></table><br>
<a name="614067"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >stayne</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#117">[#117]</a></td></tr></table></td></tr><tr ><td class="posttext"> thanks, i haven't messed with it in a week or two.  got sidetracked... short attention span :).  am i the only one with a short attention span here?  seems to run rampant in the dev community lol.<br><br>anyway, i use 3dsmax to build tracks.  lofting works best as it creates the UVs coordinates automatically and you can work with bezier curves, smooth curves, etc.  google "3ds max lofting track tutorial" or something similar (if you have 3ds max that is). <br><br></td></tr></table><br>
<a name="614113"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >EmerGki</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#118">[#118]</a></td></tr></table></td></tr><tr ><td class="posttext"> Markd<br><br>Your cars looks very stable, How you do this? <br><br></td></tr></table><br>
<a name="614147"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >stayne</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#119">[#119]</a></td></tr></table></td></tr><tr ><td class="posttext"> just tweaking the numbers i guess.  they're not 100% stable, but definately stable enough for a semi-realistic driving game.<br><br>i wish someone would make a JV-ODE editor with sliders so you could set the numbers and then export/load. <br><br></td></tr></table><br>
<a name="614263"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#120">[#120]</a></td></tr></table></td></tr><tr ><td class="posttext"> As promised, here's the Zombie RagDoll demo I've been working on recently.<br><br>It still needs some tweaking but it's good enough to show one way of adding ODE physics to a boned animated 3D model.<br><br>How you approach the problem depends on how and where the bones are placed into the model. In the demo model, the zombies arms aren't straight on the vertical (Y-Axis) so it's difficult to align the ODE geometry properly without distorting the mesh. Another possibly easier method would be to use spheres for the arms, legs, feet, hands and each of their joints.<br><br>[edit] New download added below <br><br></td></tr></table><br>
<a name="614277"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >OJay</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#121">[#121]</a></td></tr></table></td></tr><tr ><td class="posttext"> yeah a good start! but the limits are a bit too hard, making the ragdolls moving like pinocchio or something ^^<br><br>human arms and legs are much more flexible!<br><br>but thanks again for your hard work. must've been a pain in the ass setting all these joints by hand! <br><br></td></tr></table><br>
<a name="614281"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#122">[#122]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks OJay<br><br>The joint limits are part of the 'tweaking' I was referring to ;)<br><br>It wasn't too much of a pain setting it up surprisingly, but I'm aiming for a universal system that can be applied to any boned meshes. I'm still experimenting with the methods used, so it'll be a bit pointless tweaking this one to perfection.<br><br>Forget editors, with a universal system you could select the bones to use and the code will do the rest for you automagically :) <br><br></td></tr></table><br>
<a name="614293"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >EmerGki</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#123">[#123]</a></td></tr></table></td></tr><tr ><td class="posttext"> Good Job, this will help-me a lot =).<br>Thanks <br><br></td></tr></table><br>
<a name="614297"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#124">[#124]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks and you're welcome :)<br><br>I've uploaded a new version of the Zombie RagDoll demo with improved joint limits and an optimised UpdateNodes() function...<br><br>[edit] New download added below <br><br></td></tr></table><br>
<a name="614337"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KuRiX</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#125">[#125]</a></td></tr></table></td></tr><tr ><td class="posttext"> Really Great Stuff! I was not able to do skinned meshes with ode...<br><br>How have you set up the model, the bones, etc???<br><br>congratulations viper! <br><br></td></tr></table><br>
<a name="614342"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Alienforce</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#126">[#126]</a></td></tr></table></td></tr><tr ><td class="posttext"> WOW!!! Great Viper!!! <br><br></td></tr></table><br>
<a name="614529"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >EmerGki</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#127">[#127]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm Having trouble with place two or more cars in the ODE, anyone can help-me?<br>I want to create one Function like <br><br>Function CreateCar(Model,PosX,PosY,PosZ). <br><br></td></tr></table><br>
<a name="614654"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#128">[#128]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks both :)<br><br>@Kuri: The demo uses the standard bones which were added by the author of the model (Psionic3D). The code is configured to use only certain bones within the model, then the bone positions and rotations are updated using the ODE geom/joint info.<br><br>@EmerGki: You need to make sure you duplicate each setting the cars use, for example you would use Force(car1), Force(car2), Torque(car1), Torque(car2) etc for all settings. It would be best to post some of your code so that we can help you properly, use the [ codebox ] [ /codebox ] tags without the spaces. <br><br></td></tr></table><br>
<a name="614738"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#129">[#129]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've uploaded a new version of the Zombie RagDoll demo with fixed geometry alignment using Geom Transform and new hand joints/geoms...<br><br>[edit] New download added below <br><br></td></tr></table><br>
<a name="614771"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >EmerGki</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#130">[#130]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Viper, My problems is whit the reposition the car, I tried all "SetPositions" commands, but, not happens :(. What I need to do, to reposition the cars? <br><br></td></tr></table><br>
<a name="614780"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#131">[#131]</a></td></tr></table></td></tr><tr ><td class="posttext"> Don't forget to reposition the wheels too. You should use the dBodySetPosition(ode\body,x,y,z) function when repositioning the car body and the wheels.<br><br>Can you post some example code showing the problem? <br><br></td></tr></table><br>
<a name="614873"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >OJay</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#132">[#132]</a></td></tr></table></td></tr><tr ><td class="posttext"> yeah vip3r, THATS IT! really cool mate :D <br><br></td></tr></table><br>
<a name="614938"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >EmerGki</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#133">[#133]</a></td></tr></table></td></tr><tr ><td class="posttext"> Vip3r, Very Thanks, Now Work Correctly =). <br><br></td></tr></table><br>
<a name="615145"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#134">[#134]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks OJay :)<br><br>You're welcome EmerGki, glad to hear it's working ok now ;) <br><br></td></tr></table><br>
<a name="615444"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#135">[#135]</a></td></tr></table></td></tr><tr ><td class="posttext"> [edit] New download added below <br><br></td></tr></table><br>
<a name="615698"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#136">[#136]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've uploaded -yet- another new version of the Zombie RagDoll demo...<br><br>The new download contains the final version which will be added to the main wrapper download. The horrendous mesh glitches that no-one seemed to notice are now fixed ;) <br><br></td></tr></table><br>
<a name="615770"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Avon</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#137">[#137]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks VIP3R.  I purchased your excellent wrapper a few days ago and am having great fun with it.  Keep up the good work! <br><br></td></tr></table><br>
<a name="617085"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#138">[#138]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm having trouble with object penetration. Consider a seesaw of a plank witha  rotational hinge. Just above one end of the plank is a ragdoll made of blocks. Dropping onto the other end is a cube. The ragdoll blocks are disabled at the beginning of the scene so they don't drop. When the block hits the one of the seesaw, it tips and hits the feet of the ragdoll who is catapulted.<br><br>My problem is that with high friction on the seesaw plank, the ragdoll's feet pass straight through and get caught. Even with a QStepSize of 200 this happens. If the ragdoll is enabled, collisions work much better but of course it drops through gravity.<br><br>Any suggestions to enable a ragdoll to stand upright and get catapulted from a seesaw without getting stuck in it? <br><br></td></tr></table><br>
<a name="617095"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#139">[#139]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Shifty,<br>Would you post that fun example ? <br><br></td></tr></table><br>
<a name="617152"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#140">[#140]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've cobbled together an example, cannabalising the ODE Ragdoll demo. It's using quite different parameters to my engine, different ragdoll, etc. Run this and see it working properly in slow motion...<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #									   JV-ODE - Ragdoll Demo										#
; #									Code by Jim Williams (VIP3R)									#
; ###################################################################################################

AppTitle "JV-ODE - Ragdoll Demo"

Include "JV-ODE.bb"

Graphics3D 800,600,0,2

Global RagDollMax=1

Dim Head(RagDollMax)
Dim BodyU(RagDollMax)
Dim BodyL(RagDollMax)
Dim LArmU(RagDollMax)
Dim LArmL(RagDollMax)
Dim RArmU(RagDollMax)
Dim RArmL(RagDollMax)
Dim LLegU(RagDollMax)
Dim LLegL(RagDollMax)
Dim RLegU(RagDollMax)
Dim RLegL(RagDollMax)
Dim LFoot(RagDollMax)
Dim RFoot(RagDollMax)

Dim RDJoint(RagDollMax,12)

Type ODEGeom
	Field body
	Field geom
	Field mesh
	Field mass
End Type

; ###################################################################################################

; ### Setup ODE

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,-0.5,0)
dContactSetMode(dContactSlip1+dContactBounce)
dContactSetBounce(0.3)
dContactSetMu(48)
dWorldSetQuickStepNumIterations (World,200)	; default 20

; ### Create light

Global Light=CreateLight()

RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera

Global Camera=CreateCamera()
CameraZoom Camera,1.0
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000
PositionEntity Camera,20,20,-10
RotateEntity Camera,5,45,0

; ### Create plane

dCreatePlane(Space,0,1,0,0)

Plane=CreatePlane()

EntityAlpha Plane,0.8

PlaneTexture=CreateTexture(128,128,9)

ClsColor 0,150,80
Cls

Color 200,200,200

Rect 0,0,64,64,1
Rect 64,64,64,64,1

CopyRect 0,0,128,128,0,0,BackBuffer(),TextureBuffer(PlaneTexture)
ScaleTexture PlaneTexture,20,20
EntityTexture Plane,PlaneTexture,0,0

Color 255,255,255

Mirror=CreateMirror()

; ###################################################################################################

CreateRagDoll(count)

block.ODEGeom=New ODEGeom
	x_pos#=-8
	y_pos#=15
	z_pos#=12
	width#=2
	length#=2
	depth#=2
	x_rot#=0
	y_rot#=0
	z_rot#=0
	weight#=100.0
	
	block\body=dBodyCreate(World)
	block\mass=dMassCreate()
	dMassSetBoxTotal(block\mass,weight, width, length, depth)
	dBodySetMass(block\body,block\mass)
	dBodySetPosition(block\body, x_pos, y_pos, z_pos)
	dBodySetRotation(block\body, x_rot, y_rot, z_rot)
	
	block\geom=dCreateBox(Space,width, length, depth)
	dGeomSetBody(block\geom,block\body)
	dGeomContactSetBounce(block\geom,0.5)
	set_object_friction(block,0.5,weight)
	dGeomContactSetMode(block\geom,dContactSlip1+dContactBounce)

	block\mesh=CreateCube()
	ScaleEntity block\mesh,width/2,length/2,depth/2
	
seesaw.ODEGeom=New ODEGeom
	seesaw\mass=dMassCreate()
	x_pos#=-8
	y_pos#=5
	z_pos#=8
	width#=3
	length#=0.5
	depth#=15
	x_rot#=-20
	y_rot#=0
	z_rot#=0
	weight#=2.0
	
	seesaw\body=dBodyCreate(World)
	dMassSetBoxTotal(seesaw\mass,weight, width, length, depth)
	dBodySetMass(seesaw\body,seesaw\mass)
	dBodySetPosition(seesaw\body, x_pos, y_pos, z_pos)
	
	seesaw\geom=dCreateBox(Space,width, length, depth)
	dGeomSetBody(seesaw\geom,seesaw\body)
	dGeomContactSetBounce(seesaw\geom,0.5)
	set_object_friction(seesaw,0.5,weight)
	dGeomContactSetMode(seesaw\geom,dContactSlip1+dContactBounce)

	seesaw\mesh=CreateCube()
	; Blitz box lengths 2x longer than ODE box length
	ScaleEntity seesaw\mesh,width/2,length/2,depth/2
	dBodyDisable(seesaw\body)

	seesaw_joint=dJointCreateHinge(World,0)
	dJointAttach(seesaw_joint, seesaw\body, 0)
	dJointSetHingeAxis(seesaw_joint,1,0,0)
	dJointSetHingeAnchor(seesaw_joint,-8,4,8)
	dJointSetHingeParam(seesaw_joint,dParamLoStop,-dinfinity)
	dJointSetHingeParam(seesaw_joint,dParamHiStop,dinfinity)
	dBodySetRotation(seesaw\body, x_rot, y_rot, z_rot)
	
While Not KeyHit(1)
	UpdateGeoms()

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)

	RenderWorld
	Flip

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function CreateRagDoll(rd)

xp=-8
yp=9
zp=2

; ### RagDoll Dimensions

headrad#=0.4
bodytx#=1.5
bodyty#=1.5
bodytz#=0.5
bodybx#=1.5
bodyby#=0.75
bodybz#=0.5
larmrad#=0.15
larmlen#=0.9
rarmrad#=0.15
rarmlen#=0.9
llegrad#=0.25
lleglen#=0.8
rlegrad#=0.25
rleglen#=0.8
feetx#=0.5
feety#=0.25
feetz#=1.0
weight#=1.0

; ### Create Head

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
Head(rd)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp,yp,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateSphere(Space,headrad)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateSphere()
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,headrad,headrad,headrad
EntityColor ode\mesh,255,255,255
dBodyDisable(ode\body)
; ### Create Body (Upper)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
BodyU(rd)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp,yp-1.25,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateBox(Space,bodytx,bodyty,bodytz)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,bodytx*0.5,bodyty*0.5,bodytz*0.5
EntityColor ode\mesh,0,200,200
dBodyDisable(ode\body)

; ### Create Body (Lower)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
BodyL(rd)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp,yp-2.5,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateBox(Space,bodybx,bodyby,bodybz)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,bodybx*0.5,bodyby*0.5,bodybz*0.5
EntityColor ode\mesh,0,100,100
dBodyDisable(ode\body)

; ### Create Left Arm (Upper)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
LArmU(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp+1,yp-1.25,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateCCylinder(Space,larmrad,larmlen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,larmrad,(larmlen*0.5)+larmrad,larmrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,255,0,0
dBodyDisable(ode\body)

; ### Create Left Arm (Lower)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
LArmL(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp+1,yp-2.5,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateCCylinder(Space,larmrad,larmlen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,larmrad,(larmlen*0.5)+larmrad,larmrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,125,0,0
dBodyDisable(ode\body)

; ### Create Right Arm (Upper)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RArmU(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp-1,yp-1.25,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateCCylinder(Space,rarmrad,rarmlen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,rarmrad,(rarmlen*0.5)+rarmrad,rarmrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,0,255,0
dBodyDisable(ode\body)

; ### Create Right Arm (Lower)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RArmL(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp-1,yp-2.5,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateCCylinder(Space,rarmrad,rarmlen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,rarmrad,(rarmlen*0.5)+rarmrad,rarmrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,0,125,0
dBodyDisable(ode\body)

; ### Create Left Leg (Upper)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
LLegU(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp+0.5,yp-3.6,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateCCylinder(Space,llegrad,lleglen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,llegrad,(lleglen*0.5)+llegrad,llegrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,255,0,0
dBodyDisable(ode\body)

; ### Create Left Leg (Lower)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
LLegL(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp+0.5,yp-4.9,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateCCylinder(Space,llegrad,lleglen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,llegrad,(lleglen*0.5)+llegrad,llegrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,125,0,0
dBodyDisable(ode\body)

; ### Create Right Leg (Upper)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RLegU(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp-0.5,yp-3.6,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateCCylinder(Space,rlegrad,rleglen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,rlegrad,(rleglen*0.5)+rlegrad,rlegrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,0,255,0
dBodyDisable(ode\body)

; ### Create Right Leg (Lower)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RLegL(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp-0.5,yp-4.9,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateCCylinder(Space,rlegrad,rleglen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,rlegrad,(rleglen*0.5)+rlegrad,rlegrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,0,125,0
dBodyDisable(ode\body)

; ### Create Left Foot

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
LFoot(rd)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp+0.5,yp-5.7,zp-0.25)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateBox(Space,feetx,feety,feetz)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,feetx*0.5,feety*0.5,feetz*0.5
EntityColor ode\mesh,200,0,100
dBodyDisable(ode\body)

; ### Create Right Foot

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RFoot(rd)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp-0.5,yp-5.7,zp-0.25)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateBox(Space,feetx,feety,feetz)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,feetx*0.5,feety*0.5,feetz*0.5
EntityColor ode\mesh,100,200,0
dBodyDisable(ode\body)

; ### Static Joint To Head

;RDJoint(rd,0)=dJointCreateBall(World,0)
;dJointAttach(RDJoint(rd,0),0,Head(rd))
;dJointSetBallAnchor(RDJoint(rd,0),xp,yp,zp)

; ### Head To Body (Upper)

RDJoint(rd,1)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,1),Head(rd),BodyU(rd))
dJointSetHingeAxis(RDJoint(rd,1),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,1),xp,yp-0.25,zp)
dJointSetHingeParam(RDJoint(rd,1),dParamLoStop,-0.5)
dJointSetHingeParam(RDJoint(rd,1),dParamHiStop,0.5)

; ### Body (Upper) To Body (Lower)

RDJoint(rd,2)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,2),BodyU(rd),BodyL(rd))
dJointSetHingeAxis(RDJoint(rd,2),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,2),xp,yp-2,zp)
dJointSetHingeParam(RDJoint(rd,2),dParamLoStop,-0.25)
dJointSetHingeParam(RDJoint(rd,2),dParamHiStop,0.25)

; ### Left Arm (Upper) To Body (Upper)

RDJoint(rd,3)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,3),LArmU(rd),BodyU(rd))
dJointSetHingeAxis(RDJoint(rd,3),1,-1,0)
dJointSetHingeAnchor(RDJoint(rd,3),xp+1,yp-0.75,zp)
dJointSetHingeParam(RDJoint(rd,3),dParamLoStop,-2.0)
dJointSetHingeParam(RDJoint(rd,3),dParamHiStop,2.0)

; ### Left Arm (Lower) To Left Arm (Upper)

RDJoint(rd,4)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,4),LArmL(rd),LArmU(rd))
dJointSetHingeAxis(RDJoint(rd,4),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,4),xp+1,yp-2,zp)
dJointSetHingeParam(RDJoint(rd,4),dParamLoStop,0.0)
dJointSetHingeParam(RDJoint(rd,4),dParamHiStop,2.0)

; ### Right Arm (Upper) To Body (Upper)

RDJoint(rd,5)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,5),RArmU(rd),BodyU(rd))
dJointSetHingeAxis(RDJoint(rd,5),1,1,0)
dJointSetHingeAnchor(RDJoint(rd,5),xp-1,yp-0.75,zp)
dJointSetHingeParam(RDJoint(rd,5),dParamLoStop,-2.0)
dJointSetHingeParam(RDJoint(rd,5),dParamHiStop,2.0)

; ### Right Arm (Lower) To Right Arm (Upper)

RDJoint(rd,6)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,6),RArmL(rd),RArmU(rd))
dJointSetHingeAxis(RDJoint(rd,6),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,6),xp-1,yp-2,zp)
dJointSetHingeParam(RDJoint(rd,6),dParamLoStop,0.0)
dJointSetHingeParam(RDJoint(rd,6),dParamHiStop,2.0)

; ### Left Leg (Upper) To Body (Lower)

RDJoint(rd,7)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,7),LLegU(rd),BodyL(rd))
dJointSetHingeAxis(RDJoint(rd,7),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,7),xp+1,yp-2.75,zp)
dJointSetHingeParam(RDJoint(rd,7),dParamLoStop,-1.0)
dJointSetHingeParam(RDJoint(rd,7),dParamHiStop,1.0)

; ### Left Leg (Lower) To Left Leg (Upper)

RDJoint(rd,8)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,8),LLegL(rd),LLegU(rd))
dJointSetHingeAxis(RDJoint(rd,8),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,8),xp+1,yp-4.25,zp)
dJointSetHingeParam(RDJoint(rd,8),dParamLoStop,-2.0)
dJointSetHingeParam(RDJoint(rd,8),dParamHiStop,0.0)

; ### Right Leg (Upper) To Body (Lower)

RDJoint(rd,9)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,9),RLegU(rd),BodyL(rd))
dJointSetHingeAxis(RDJoint(rd,9),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,9),xp-1,yp-2.75,zp)
dJointSetHingeParam(RDJoint(rd,9),dParamLoStop,-1.0)
dJointSetHingeParam(RDJoint(rd,9),dParamHiStop,1.0)

; ### Right Leg (Lower) To Right Leg (Upper)

RDJoint(rd,10)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,10),RLegL(rd),RLegU(rd))
dJointSetHingeAxis(RDJoint(rd,10),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,10),xp-1,yp-4.25,zp)
dJointSetHingeParam(RDJoint(rd,10),dParamLoStop,-2.0)
dJointSetHingeParam(RDJoint(rd,10),dParamHiStop,0.0)

; ### Left Foot To Left Leg (Lower)

RDJoint(rd,11)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,11),LFoot(rd),LLegL(rd))
dJointSetHingeAxis(RDJoint(rd,11),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,11),xp+1,yp-5.5,zp)
dJointSetHingeParam(RDJoint(rd,11),dParamLoStop,-0.25)
dJointSetHingeParam(RDJoint(rd,11),dParamHiStop,0.25)

; ### Right Foot To Right Leg (Lower)

RDJoint(rd,12)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,12),RFoot(rd),RLegL(rd))
dJointSetHingeAxis(RDJoint(rd,12),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,12),xp-1,yp-5.5,zp)
dJointSetHingeParam(RDJoint(rd,12),dParamLoStop,-0.25)
dJointSetHingeParam(RDJoint(rd,12),dParamHiStop,0.25)

End Function
Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
;	If dBodyIsEnabled(ode\body)
		RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
		PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
;		End If
Next

End Function

; ###################################################################################################
Function set_object_friction(obj.ODEGeom,friction#,weight)
	friction=friction/100
	friction=friction
	friction=friction*4
	friction=4-friction
	e#=Log10(weight*10)
	e=e-friction
	e=1*(10^e)
	dGeomContactSetMu(obj\geom,e)
End Function</textarea><br>Now if you increase 	dWorldQuickStep() to speed things up, to say 1.2 you should get passthrough. At least I do! Likewsie changing the gravity to speed things up messes things about. I've found with a few tests that at QStep=1.2, when gravity =0.95 speed is about 'realtime' and the collision works (though with a different result to slowmo mode) but at g=0.94 or 0.96, is bust. dWorldStep() actually performs worse.<br><br>If you remove the first dBodyDisable() in the ragdoll creation, the ragdoll drops due to gravity and the collisions are pretty much problem free at higher speeds. It's like the enabling skips a frame's worth of collision so the second frame after the collision, the objects have already penetrated. <br><br></td></tr></table><br>
<a name="617182"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#141">[#141]</a></td></tr></table></td></tr><tr ><td class="posttext"> wow is that cool or what. checking it out further. <br><br></td></tr></table><br>
<a name="617195"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#142">[#142]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey you need a smaller time step to catch the collision, so try this:<br><br>I changed gravity to:<br>dWorldSetGravity(World,0,-0.98,0)<br><br>and The time step to:<br>	For x=1 To 4<br>		dSpaceCollide(Space,World,ContactGroup)<br>			dWorldQuickStep(World,0.05)<br>		dJointGroupEmpty(ContactGroup)<br>	Next<br><br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #									   JV-ODE - Ragdoll Demo										#
; #									Code by Jim Williams (VIP3R)									#
; ###################################################################################################

AppTitle "JV-ODE - Ragdoll Demo"

Include "JV-ODE.bb"

Graphics3D 800,600,0,2

Global RagDollMax=1

Dim Head(RagDollMax)
Dim BodyU(RagDollMax)
Dim BodyL(RagDollMax)
Dim LArmU(RagDollMax)
Dim LArmL(RagDollMax)
Dim RArmU(RagDollMax)
Dim RArmL(RagDollMax)
Dim LLegU(RagDollMax)
Dim LLegL(RagDollMax)
Dim RLegU(RagDollMax)
Dim RLegL(RagDollMax)
Dim LFoot(RagDollMax)
Dim RFoot(RagDollMax)

Dim RDJoint(RagDollMax,12)

Type ODEGeom
	Field body
	Field geom
	Field mesh
	Field mass
End Type

; ###################################################################################################

; ### Setup ODE

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,-0.98,0)
dContactSetMode(dContactSlip1+dContactBounce)
dContactSetBounce(0.3)
dContactSetMu(48)
dWorldSetQuickStepNumIterations (World,200)	; default 20

; ### Create light

Global Light=CreateLight()

RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera

Global Camera=CreateCamera()
CameraZoom Camera,1.0
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000
PositionEntity Camera,20,20,-10
RotateEntity Camera,5,45,0

; ### Create plane

dCreatePlane(Space,0,1,0,0)

Plane=CreatePlane()

EntityAlpha Plane,0.8

PlaneTexture=CreateTexture(128,128,9)

ClsColor 0,150,80
Cls

Color 200,200,200

Rect 0,0,64,64,1
Rect 64,64,64,64,1

CopyRect 0,0,128,128,0,0,BackBuffer(),TextureBuffer(PlaneTexture)
ScaleTexture PlaneTexture,20,20
EntityTexture Plane,PlaneTexture,0,0

Color 255,255,255

Mirror=CreateMirror()

; ###################################################################################################

CreateRagDoll(count)

block.ODEGeom=New ODEGeom
	x_pos#=-8
	y_pos#=15
	z_pos#=12
	width#=2
	length#=2
	depth#=2
	x_rot#=0
	y_rot#=0
	z_rot#=0
	weight#=100.0
	
	block\body=dBodyCreate(World)
	block\mass=dMassCreate()
	dMassSetBoxTotal(block\mass,weight, width, length, depth)
	dBodySetMass(block\body,block\mass)
	dBodySetPosition(block\body, x_pos, y_pos, z_pos)
	dBodySetRotation(block\body, x_rot, y_rot, z_rot)
	
	block\geom=dCreateBox(Space,width, length, depth)
	dGeomSetBody(block\geom,block\body)
	dGeomContactSetBounce(block\geom,0.5)
	set_object_friction(block,0.5,weight)
	dGeomContactSetMode(block\geom,dContactSlip1+dContactBounce)

	block\mesh=CreateCube()
	ScaleEntity block\mesh,width/2,length/2,depth/2
	
seesaw.ODEGeom=New ODEGeom
	seesaw\mass=dMassCreate()
	x_pos#=-8
	y_pos#=5
	z_pos#=8
	width#=3
	length#=0.5
	depth#=15
	x_rot#=-20
	y_rot#=0
	z_rot#=0
	weight#=2.0
	
	seesaw\body=dBodyCreate(World)
	dMassSetBoxTotal(seesaw\mass,weight, width, length, depth)
	dBodySetMass(seesaw\body,seesaw\mass)
	dBodySetPosition(seesaw\body, x_pos, y_pos, z_pos)
	
	seesaw\geom=dCreateBox(Space,width, length, depth)
	dGeomSetBody(seesaw\geom,seesaw\body)
	dGeomContactSetBounce(seesaw\geom,0.5)
	set_object_friction(seesaw,0.5,weight)
	dGeomContactSetMode(seesaw\geom,dContactSlip1+dContactBounce)

	seesaw\mesh=CreateCube()
	; Blitz box lengths 2x longer than ODE box length
	ScaleEntity seesaw\mesh,width/2,length/2,depth/2
	dBodyDisable(seesaw\body)

	seesaw_joint=dJointCreateHinge(World,0)
	dJointAttach(seesaw_joint, seesaw\body, 0)
	dJointSetHingeAxis(seesaw_joint,1,0,0)
	dJointSetHingeAnchor(seesaw_joint,-8,4,8)
	dJointSetHingeParam(seesaw_joint,dParamLoStop,-dinfinity)
	dJointSetHingeParam(seesaw_joint,dParamHiStop,dinfinity)
	dBodySetRotation(seesaw\body, x_rot, y_rot, z_rot)
	
While Not KeyHit(1)
	UpdateGeoms()
	For x=1 To 4
		dSpaceCollide(Space,World,ContactGroup)
			dWorldQuickStep(World,0.05)
		dJointGroupEmpty(ContactGroup)
	Next
	RenderWorld
	Flip

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function CreateRagDoll(rd)

xp=-8
yp=9
zp=2

; ### RagDoll Dimensions

headrad#=0.4
bodytx#=1.5
bodyty#=1.5
bodytz#=0.5
bodybx#=1.5
bodyby#=0.75
bodybz#=0.5
larmrad#=0.15
larmlen#=0.9
rarmrad#=0.15
rarmlen#=0.9
llegrad#=0.25
lleglen#=0.8
rlegrad#=0.25
rleglen#=0.8
feetx#=0.5
feety#=0.25
feetz#=1.0
weight#=1.0

; ### Create Head

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
Head(rd)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp,yp,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateSphere(Space,headrad)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateSphere()
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,headrad,headrad,headrad
EntityColor ode\mesh,255,255,255
dBodyDisable(ode\body)
; ### Create Body (Upper)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
BodyU(rd)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp,yp-1.25,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateBox(Space,bodytx,bodyty,bodytz)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,bodytx*0.5,bodyty*0.5,bodytz*0.5
EntityColor ode\mesh,0,200,200
dBodyDisable(ode\body)

; ### Create Body (Lower)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
BodyL(rd)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp,yp-2.5,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateBox(Space,bodybx,bodyby,bodybz)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,bodybx*0.5,bodyby*0.5,bodybz*0.5
EntityColor ode\mesh,0,100,100
dBodyDisable(ode\body)

; ### Create Left Arm (Upper)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
LArmU(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp+1,yp-1.25,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateCCylinder(Space,larmrad,larmlen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,larmrad,(larmlen*0.5)+larmrad,larmrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,255,0,0
dBodyDisable(ode\body)

; ### Create Left Arm (Lower)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
LArmL(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp+1,yp-2.5,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateCCylinder(Space,larmrad,larmlen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,larmrad,(larmlen*0.5)+larmrad,larmrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,125,0,0
dBodyDisable(ode\body)

; ### Create Right Arm (Upper)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RArmU(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp-1,yp-1.25,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateCCylinder(Space,rarmrad,rarmlen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,rarmrad,(rarmlen*0.5)+rarmrad,rarmrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,0,255,0
dBodyDisable(ode\body)

; ### Create Right Arm (Lower)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RArmL(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp-1,yp-2.5,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateCCylinder(Space,rarmrad,rarmlen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,rarmrad,(rarmlen*0.5)+rarmrad,rarmrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,0,125,0
dBodyDisable(ode\body)

; ### Create Left Leg (Upper)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
LLegU(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp+0.5,yp-3.6,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateCCylinder(Space,llegrad,lleglen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,llegrad,(lleglen*0.5)+llegrad,llegrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,255,0,0
dBodyDisable(ode\body)

; ### Create Left Leg (Lower)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
LLegL(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp+0.5,yp-4.9,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateCCylinder(Space,llegrad,lleglen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,llegrad,(lleglen*0.5)+llegrad,llegrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,125,0,0
dBodyDisable(ode\body)

; ### Create Right Leg (Upper)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RLegU(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp-0.5,yp-3.6,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateCCylinder(Space,rlegrad,rleglen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,rlegrad,(rleglen*0.5)+rlegrad,rlegrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,0,255,0
dBodyDisable(ode\body)

; ### Create Right Leg (Lower)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RLegL(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp-0.5,yp-4.9,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateCCylinder(Space,rlegrad,rleglen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,rlegrad,(rleglen*0.5)+rlegrad,rlegrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,0,125,0
dBodyDisable(ode\body)

; ### Create Left Foot

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
LFoot(rd)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp+0.5,yp-5.7,zp-0.25)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateBox(Space,feetx,feety,feetz)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,feetx*0.5,feety*0.5,feetz*0.5
EntityColor ode\mesh,200,0,100
dBodyDisable(ode\body)

; ### Create Right Foot

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RFoot(rd)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp-0.5,yp-5.7,zp-0.25)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateBox(Space,feetx,feety,feetz)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,feetx*0.5,feety*0.5,feetz*0.5
EntityColor ode\mesh,100,200,0
dBodyDisable(ode\body)

; ### Static Joint To Head

;RDJoint(rd,0)=dJointCreateBall(World,0)
;dJointAttach(RDJoint(rd,0),0,Head(rd))
;dJointSetBallAnchor(RDJoint(rd,0),xp,yp,zp)

; ### Head To Body (Upper)

RDJoint(rd,1)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,1),Head(rd),BodyU(rd))
dJointSetHingeAxis(RDJoint(rd,1),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,1),xp,yp-0.25,zp)
dJointSetHingeParam(RDJoint(rd,1),dParamLoStop,-0.5)
dJointSetHingeParam(RDJoint(rd,1),dParamHiStop,0.5)

; ### Body (Upper) To Body (Lower)

RDJoint(rd,2)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,2),BodyU(rd),BodyL(rd))
dJointSetHingeAxis(RDJoint(rd,2),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,2),xp,yp-2,zp)
dJointSetHingeParam(RDJoint(rd,2),dParamLoStop,-0.25)
dJointSetHingeParam(RDJoint(rd,2),dParamHiStop,0.25)

; ### Left Arm (Upper) To Body (Upper)

RDJoint(rd,3)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,3),LArmU(rd),BodyU(rd))
dJointSetHingeAxis(RDJoint(rd,3),1,-1,0)
dJointSetHingeAnchor(RDJoint(rd,3),xp+1,yp-0.75,zp)
dJointSetHingeParam(RDJoint(rd,3),dParamLoStop,-2.0)
dJointSetHingeParam(RDJoint(rd,3),dParamHiStop,2.0)

; ### Left Arm (Lower) To Left Arm (Upper)

RDJoint(rd,4)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,4),LArmL(rd),LArmU(rd))
dJointSetHingeAxis(RDJoint(rd,4),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,4),xp+1,yp-2,zp)
dJointSetHingeParam(RDJoint(rd,4),dParamLoStop,0.0)
dJointSetHingeParam(RDJoint(rd,4),dParamHiStop,2.0)

; ### Right Arm (Upper) To Body (Upper)

RDJoint(rd,5)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,5),RArmU(rd),BodyU(rd))
dJointSetHingeAxis(RDJoint(rd,5),1,1,0)
dJointSetHingeAnchor(RDJoint(rd,5),xp-1,yp-0.75,zp)
dJointSetHingeParam(RDJoint(rd,5),dParamLoStop,-2.0)
dJointSetHingeParam(RDJoint(rd,5),dParamHiStop,2.0)

; ### Right Arm (Lower) To Right Arm (Upper)

RDJoint(rd,6)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,6),RArmL(rd),RArmU(rd))
dJointSetHingeAxis(RDJoint(rd,6),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,6),xp-1,yp-2,zp)
dJointSetHingeParam(RDJoint(rd,6),dParamLoStop,0.0)
dJointSetHingeParam(RDJoint(rd,6),dParamHiStop,2.0)

; ### Left Leg (Upper) To Body (Lower)

RDJoint(rd,7)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,7),LLegU(rd),BodyL(rd))
dJointSetHingeAxis(RDJoint(rd,7),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,7),xp+1,yp-2.75,zp)
dJointSetHingeParam(RDJoint(rd,7),dParamLoStop,-1.0)
dJointSetHingeParam(RDJoint(rd,7),dParamHiStop,1.0)

; ### Left Leg (Lower) To Left Leg (Upper)

RDJoint(rd,8)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,8),LLegL(rd),LLegU(rd))
dJointSetHingeAxis(RDJoint(rd,8),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,8),xp+1,yp-4.25,zp)
dJointSetHingeParam(RDJoint(rd,8),dParamLoStop,-2.0)
dJointSetHingeParam(RDJoint(rd,8),dParamHiStop,0.0)

; ### Right Leg (Upper) To Body (Lower)

RDJoint(rd,9)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,9),RLegU(rd),BodyL(rd))
dJointSetHingeAxis(RDJoint(rd,9),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,9),xp-1,yp-2.75,zp)
dJointSetHingeParam(RDJoint(rd,9),dParamLoStop,-1.0)
dJointSetHingeParam(RDJoint(rd,9),dParamHiStop,1.0)

; ### Right Leg (Lower) To Right Leg (Upper)

RDJoint(rd,10)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,10),RLegL(rd),RLegU(rd))
dJointSetHingeAxis(RDJoint(rd,10),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,10),xp-1,yp-4.25,zp)
dJointSetHingeParam(RDJoint(rd,10),dParamLoStop,-2.0)
dJointSetHingeParam(RDJoint(rd,10),dParamHiStop,0.0)

; ### Left Foot To Left Leg (Lower)

RDJoint(rd,11)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,11),LFoot(rd),LLegL(rd))
dJointSetHingeAxis(RDJoint(rd,11),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,11),xp+1,yp-5.5,zp)
dJointSetHingeParam(RDJoint(rd,11),dParamLoStop,-0.25)
dJointSetHingeParam(RDJoint(rd,11),dParamHiStop,0.25)

; ### Right Foot To Right Leg (Lower)

RDJoint(rd,12)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,12),RFoot(rd),RLegL(rd))
dJointSetHingeAxis(RDJoint(rd,12),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,12),xp-1,yp-5.5,zp)
dJointSetHingeParam(RDJoint(rd,12),dParamLoStop,-0.25)
dJointSetHingeParam(RDJoint(rd,12),dParamHiStop,0.25)

End Function
Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
;	If dBodyIsEnabled(ode\body)
		RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
		PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
;		End If
Next

End Function

; ###################################################################################################
Function set_object_friction(obj.ODEGeom,friction#,weight)
	friction=friction/100
	friction=friction
	friction=friction*4
	friction=4-friction
	e#=Log10(weight*10)
	e=e-friction
	e=1*(10^e)
	dGeomContactSetMu(obj\geom,e)
End Function
</textarea> <br><br></td></tr></table><br>
<a name="617339"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#143">[#143]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ragdoll jumper, just for you shifty.<br>Thanks for sharing. -enjoy<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #									   JV-ODE - Ragdoll Jumper Demo										#
; #									Code by Jim Williams (VIP3R)									#
; ###################################################################################################

AppTitle "JV-ODE - Ragdoll Jumper Demo"

Include "JV-ODE.bb"

Graphics3D 800,600,0,2

Global RagDollMax=1

Dim Head(RagDollMax)
Dim BodyU(RagDollMax)
Dim BodyL(RagDollMax)
Dim LArmU(RagDollMax)
Dim LArmL(RagDollMax)
Dim RArmU(RagDollMax)
Dim RArmL(RagDollMax)
Dim LLegU(RagDollMax)
Dim LLegL(RagDollMax)
Dim RLegU(RagDollMax)
Dim RLegL(RagDollMax)
Dim LFoot(RagDollMax)
Dim RFoot(RagDollMax)

Dim RDJoint(RagDollMax,12)

Type ODEGeom
	Field body
	Field geom
	Field mesh
	Field mass
End Type

; ###################################################################################################

; ### Setup ODE

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

Global BigG#=-0.98

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,BigG#,0)
dContactSetMode(dContactSlip1+dContactBounce)
dContactSetBounce(0.3)
dContactSetMu(48)
dWorldSetQuickStepNumIterations (World,200)	; default 20

; ### Create light

Global Light=CreateLight()

RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera

Global Camera=CreateCamera()
CameraZoom Camera,1.0
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000
PositionEntity Camera,20,20,-10
RotateEntity Camera,5,45,0

; ### Create plane

dCreatePlane(Space,0,1,0,0)

Plane=CreatePlane()

EntityAlpha Plane,0.8

PlaneTexture=CreateTexture(128,128,9)

ClsColor 0,150,80
Cls

Color 200,200,200

Rect 0,0,64,64,1
Rect 64,64,64,64,1

CopyRect 0,0,128,128,0,0,BackBuffer(),TextureBuffer(PlaneTexture)
ScaleTexture PlaneTexture,20,20
EntityTexture Plane,PlaneTexture,0,0

Color 255,255,255

Mirror=CreateMirror()

; ###################################################################################################

CreateRagDoll(count)

block.ODEGeom=New ODEGeom
	x_pos#=-8
	y_pos#=15
	z_pos#=12
	width#=2
	length#=2
	depth#=2
	x_rot#=0
	y_rot#=0
	z_rot#=0
	weight#=100.0
	
	block\body=dBodyCreate(World)
	block\mass=dMassCreate()
	dMassSetBoxTotal(block\mass,weight, width, length, depth)
	dBodySetMass(block\body,block\mass)
	dBodySetPosition(block\body, x_pos, y_pos, z_pos)
	dBodySetRotation(block\body, x_rot, y_rot, z_rot)
	
	block\geom=dCreateBox(Space,width, length, depth)
	dGeomSetBody(block\geom,block\body)
	dGeomContactSetBounce(block\geom,0.5)
	set_object_friction(block,0.5,weight)
	dGeomContactSetMode(block\geom,dContactSlip1+dContactBounce)

	block\mesh=CreateCube()
	ScaleEntity block\mesh,width/2,length/2,depth/2
	
	seesaw.ODEGeom=New ODEGeom
	seesaw\mass=dMassCreate()
	x_pos#=-8
	y_pos#=5
	z_pos#=8
	width#=3
	length#=0.5
	depth#=15
	x_rot#=-20
	y_rot#=0
	z_rot#=0
	weight#=2.0
	
	seesaw\body=dBodyCreate(World)
	dMassSetBoxTotal(seesaw\mass,weight, width, length, depth)
	dBodySetMass(seesaw\body,seesaw\mass)
	dBodySetPosition(seesaw\body, x_pos, y_pos, z_pos)
	
	seesaw\geom=dCreateBox(Space,width, length, depth)
	dGeomSetBody(seesaw\geom,seesaw\body)
	dGeomContactSetBounce(seesaw\geom,0.5)
	set_object_friction(seesaw,0.5,weight)
	dGeomContactSetMode(seesaw\geom,dContactSlip1+dContactBounce)

	seesaw\mesh=CreateCube()
	; Blitz box lengths 2x longer than ODE box length
	ScaleEntity seesaw\mesh,width/2,length/2,depth/2
	dBodyDisable(seesaw\body)

	seesaw_joint=dJointCreateHinge(World,0)
	dJointAttach(seesaw_joint, seesaw\body, 0)
	dJointSetHingeAxis(seesaw_joint,1,0,0)
	dJointSetHingeAnchor(seesaw_joint,-8,4,8)
	dJointSetHingeParam(seesaw_joint,dParamLoStop,-dinfinity)
	dJointSetHingeParam(seesaw_joint,dParamHiStop,dinfinity)
	dBodySetRotation(seesaw\body, x_rot, y_rot, z_rot)
	
While Not KeyHit(1)
	UpdateGeoms()
	For x=1 To 4
		dSpaceCollide(Space,World,ContactGroup)
			dWorldQuickStep(World,0.05)
		dJointGroupEmpty(ContactGroup)
	Next
	RenderWorld
	
	Text 0,0,"Gravity="+Str(BigG#)
	Text 0,25,"Adjust Gravity - Mouse wheel"
	Text 0,50,"Space resets"
	Flip

	; Adjust Gravity
	BigG#=BigG#+(MouseZSpeed()/100.0)
	dWorldSetGravity(World,0,BigG#,0)
	
	; Space - Resets See Saw, Jumper, block and drops it.
	If KeyHit(57)
		; See Saw
		x_pos#=-8
		y_pos#=5
		z_pos#=8
		x_rot#=-20
		y_rot#=0
		z_rot#=0
		dBodySetPosition(seesaw\body, x_pos, y_pos, z_pos)
		dBodySetRotation(seesaw\body, x_rot, y_rot, z_rot)
		dBodySetLinearVel(seesaw\body,0,0,0)
		dBodySetAngularVel(seesaw\body,0,0,0)
	 	dBodyDisable(seesaw\body)
		
		
		xp=-8
		yp=9
		zp=2
		; ### Position Head
	
		dBodySetRotation(Head(rd),0,0,0)
		dBodySetPosition(Head(rd),xp,yp,zp)
		dBodySetAutoDisableFlag(Head(rd),1)
		dBodySetLinearVel(Head(rd),0,0,0)
		dBodySetAngularVel(Head(rd),0,0,0)
		dBodyDisable(Head(rd))
		
		; ### Position Body (Upper)
		
		dBodySetRotation(BodyU(rd),0,0,0)
		dBodySetPosition(BodyU(rd),xp,yp-1.25,zp)
		dBodySetAutoDisableFlag(BodyU(rd),1)
		dBodySetLinearVel(BodyU(rd),0,0,0)
		dBodySetAngularVel(BodyU(rd),0,0,0)
		dBodyDisable(BodyU(rd))
		
		; ### Position Body (Lower)
		
		dBodySetRotation(BodyL(rd),0,0,0)
		dBodySetPosition(BodyL(rd),xp,yp-2.5,zp)
		dBodySetAutoDisableFlag(BodyL(rd),1)
		dBodySetLinearVel(BodyL(rd),0,0,0)
		dBodySetAngularVel(BodyL(rd),0,0,0)
		dBodyDisable(BodyL(rd))
		
		; ### Position Left Arm (Upper)
		
		dBodySetRotation(LArmU(rd),90,0,0)
		dBodySetPosition(LArmU(rd),xp+1,yp-1.25,zp)
		dBodySetAutoDisableFlag(LArmU(rd),1)
		dBodySetLinearVel(LArmU(rd),0,0,0)
		dBodySetAngularVel(LArmU(rd),0,0,0)
		dBodyDisable(LArmU(rd))
		
		; ### Position Left Arm (Lower)
		
		dBodySetRotation(LArmL(rd),90,0,0)
		dBodySetPosition(LArmL(rd),xp+1,yp-2.5,zp)
		dBodySetAutoDisableFlag(LArmL(rd),1)
		dBodySetLinearVel(LArmL(rd),0,0,0)
		dBodySetAngularVel(LArmL(rd),0,0,0)
		dBodyDisable(LArmL(rd))
		
		; ### Position Right Arm (Upper)
		
		dBodySetRotation(RArmU(rd),90,0,0)
		dBodySetPosition(RArmU(rd),xp-1,yp-1.25,zp)
		dBodySetAutoDisableFlag(RArmU(rd),1)
		dBodySetLinearVel(RArmU(rd),0,0,0)
		dBodySetAngularVel(RArmU(rd),0,0,0)
		dBodyDisable(RArmU(rd))
		
		; ### Position Right Arm (Lower)
		
		dBodySetRotation(RArmL(rd),90,0,0)
		dBodySetPosition(RArmL(rd),xp-1,yp-2.5,zp)
		dBodySetAutoDisableFlag(RArmL(rd),1)
		dBodySetLinearVel(RArmL(rd),0,0,0)
		dBodySetAngularVel(RArmL(rd),0,0,0)
		dBodyDisable(RArmL(rd))
		
		; ### Position Left Leg (Upper)
		
		dBodySetRotation(LLegU(rd),90,0,0)
		dBodySetPosition(LLegU(rd),xp+0.5,yp-3.6,zp)
		dBodySetAutoDisableFlag(LLegU(rd),1)
		dBodySetLinearVel(LLegU(rd),0,0,0)
		dBodySetAngularVel(LLegU(rd),0,0,0)
		dBodyDisable(LLegU(rd))
		
		; ### Position Left Leg (Lower)
		
		dBodySetRotation(LLegL(rd),90,0,0)
		dBodySetPosition(LLegL(rd),xp+0.5,yp-4.9,zp)
		dBodySetAutoDisableFlag(LLegL(rd),1)
		dBodySetLinearVel(LLegL(rd),0,0,0)
		dBodySetAngularVel(LLegL(rd),0,0,0)
		dBodyDisable(LLegL(rd))
		
		; ### Position Right Leg (Upper)
		
		dBodySetRotation(RLegU(rd),90,0,0)
		dBodySetPosition(RLegU(rd),xp-0.5,yp-3.6,zp)
		dBodySetAutoDisableFlag(RLegU(rd),1)
		dBodySetLinearVel(RLegU(rd),0,0,0)
		dBodySetAngularVel(RLegU(rd),0,0,0)
		dBodyDisable(RLegU(rd))
		
		; ### Position Right Leg (Lower)
		
		dBodySetRotation(RLegL(rd),90,0,0)
		dBodySetPosition(RLegL(rd),xp-0.5,yp-4.9,zp)
		dBodySetAutoDisableFlag(RLegL(rd),1)
		dBodySetLinearVel(RLegL(rd),0,0,0)
		dBodySetAngularVel(RLegL(rd),0,0,0)
		dBodyDisable(RLegL(rd))
		
		; ### Position Left Foot
		
		dBodySetRotation(LFoot(rd),0,0,0)
		dBodySetPosition(LFoot(rd),xp+0.5,yp-5.7,zp-0.25)
		dBodySetAutoDisableFlag(LFoot(rd),1)
		dBodySetLinearVel(LFoot(rd),0,0,0)
		dBodySetAngularVel(LFoot(rd),0,0,0)
		dBodyDisable(LFoot(rd))
		
		; ### Position Right Foot
		
		dBodySetRotation(RFoot(rd),0,0,0)
		dBodySetPosition(RFoot(rd),xp-0.5,yp-5.7,zp-0.25)
		dBodySetAutoDisableFlag(RFoot(rd),1)
		dBodySetLinearVel(RFoot(rd),0,0,0)
		dBodySetAngularVel(RFoot(rd),0,0,0)
		dBodyDisable(RFoot(rd))
	
		x_pos#=-8
		y_pos#=15
		z_pos#=12
		x_rot#=0
		y_rot#=0
		z_rot#=0
		dBodySetPosition(block\body, x_pos, y_pos, z_pos)
		dBodySetRotation(block\body, x_rot, y_rot, z_rot)
		dBodySetLinearVel(block\body,0,0,0)
		dBodySetAngularVel(block\body,0,0,0)
	 	dBodyEnable(block\body)
	End If
Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function CreateRagDoll(rd)

xp=-8
yp=9
zp=2

; ### RagDoll Dimensions

headrad#=0.4
bodytx#=1.5
bodyty#=1.5
bodytz#=0.5
bodybx#=1.5
bodyby#=0.75
bodybz#=0.5
larmrad#=0.15
larmlen#=0.9
rarmrad#=0.15
rarmlen#=0.9
llegrad#=0.25
lleglen#=0.8
rlegrad#=0.25
rleglen#=0.8
feetx#=0.5
feety#=0.25
feetz#=1.0
weight#=1.0

; ### Create Head

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
Head(rd)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp,yp,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateSphere(Space,headrad)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateSphere()
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,headrad,headrad,headrad
EntityColor ode\mesh,255,255,255
dBodyDisable(ode\body)
; ### Create Body (Upper)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
BodyU(rd)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp,yp-1.25,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateBox(Space,bodytx,bodyty,bodytz)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,bodytx*0.5,bodyty*0.5,bodytz*0.5
EntityColor ode\mesh,0,200,200
dBodyDisable(ode\body)

; ### Create Body (Lower)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
BodyL(rd)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp,yp-2.5,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateBox(Space,bodybx,bodyby,bodybz)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,bodybx*0.5,bodyby*0.5,bodybz*0.5
EntityColor ode\mesh,0,100,100
dBodyDisable(ode\body)

; ### Create Left Arm (Upper)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
LArmU(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp+1,yp-1.25,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateCCylinder(Space,larmrad,larmlen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,larmrad,(larmlen*0.5)+larmrad,larmrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,255,0,0
dBodyDisable(ode\body)

; ### Create Left Arm (Lower)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
LArmL(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp+1,yp-2.5,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateCCylinder(Space,larmrad,larmlen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,larmrad,(larmlen*0.5)+larmrad,larmrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,125,0,0
dBodyDisable(ode\body)

; ### Create Right Arm (Upper)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RArmU(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp-1,yp-1.25,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateCCylinder(Space,rarmrad,rarmlen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,rarmrad,(rarmlen*0.5)+rarmrad,rarmrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,0,255,0
dBodyDisable(ode\body)

; ### Create Right Arm (Lower)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RArmL(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp-1,yp-2.5,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateCCylinder(Space,rarmrad,rarmlen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,rarmrad,(rarmlen*0.5)+rarmrad,rarmrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,0,125,0
dBodyDisable(ode\body)

; ### Create Left Leg (Upper)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
LLegU(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp+0.5,yp-3.6,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateCCylinder(Space,llegrad,lleglen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,llegrad,(lleglen*0.5)+llegrad,llegrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,255,0,0
dBodyDisable(ode\body)

; ### Create Left Leg (Lower)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
LLegL(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp+0.5,yp-4.9,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateCCylinder(Space,llegrad,lleglen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,llegrad,(lleglen*0.5)+llegrad,llegrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,125,0,0
dBodyDisable(ode\body)

; ### Create Right Leg (Upper)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RLegU(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp-0.5,yp-3.6,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateCCylinder(Space,rlegrad,rleglen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,rlegrad,(rleglen*0.5)+rlegrad,rlegrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,0,255,0
dBodyDisable(ode\body)

; ### Create Right Leg (Lower)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RLegL(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp-0.5,yp-4.9,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateCCylinder(Space,rlegrad,rleglen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,rlegrad,(rleglen*0.5)+rlegrad,rlegrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,0,125,0
dBodyDisable(ode\body)

; ### Create Left Foot

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
LFoot(rd)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp+0.5,yp-5.7,zp-0.25)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateBox(Space,feetx,feety,feetz)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,feetx*0.5,feety*0.5,feetz*0.5
EntityColor ode\mesh,200,0,100
dBodyDisable(ode\body)

; ### Create Right Foot

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RFoot(rd)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp-0.5,yp-5.7,zp-0.25)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateBox(Space,feetx,feety,feetz)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,feetx*0.5,feety*0.5,feetz*0.5
EntityColor ode\mesh,100,200,0
dBodyDisable(ode\body)

; ### Static Joint To Head

;RDJoint(rd,0)=dJointCreateBall(World,0)
;dJointAttach(RDJoint(rd,0),0,Head(rd))
;dJointSetBallAnchor(RDJoint(rd,0),xp,yp,zp)

; ### Head To Body (Upper)

RDJoint(rd,1)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,1),Head(rd),BodyU(rd))
dJointSetHingeAxis(RDJoint(rd,1),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,1),xp,yp-0.25,zp)
dJointSetHingeParam(RDJoint(rd,1),dParamLoStop,-0.5)
dJointSetHingeParam(RDJoint(rd,1),dParamHiStop,0.5)

; ### Body (Upper) To Body (Lower)

RDJoint(rd,2)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,2),BodyU(rd),BodyL(rd))
dJointSetHingeAxis(RDJoint(rd,2),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,2),xp,yp-2,zp)
dJointSetHingeParam(RDJoint(rd,2),dParamLoStop,-0.25)
dJointSetHingeParam(RDJoint(rd,2),dParamHiStop,0.25)

; ### Left Arm (Upper) To Body (Upper)

RDJoint(rd,3)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,3),LArmU(rd),BodyU(rd))
dJointSetHingeAxis(RDJoint(rd,3),1,-1,0)
dJointSetHingeAnchor(RDJoint(rd,3),xp+1,yp-0.75,zp)
dJointSetHingeParam(RDJoint(rd,3),dParamLoStop,-2.0)
dJointSetHingeParam(RDJoint(rd,3),dParamHiStop,2.0)

; ### Left Arm (Lower) To Left Arm (Upper)

RDJoint(rd,4)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,4),LArmL(rd),LArmU(rd))
dJointSetHingeAxis(RDJoint(rd,4),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,4),xp+1,yp-2,zp)
dJointSetHingeParam(RDJoint(rd,4),dParamLoStop,0.0)
dJointSetHingeParam(RDJoint(rd,4),dParamHiStop,2.0)

; ### Right Arm (Upper) To Body (Upper)

RDJoint(rd,5)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,5),RArmU(rd),BodyU(rd))
dJointSetHingeAxis(RDJoint(rd,5),1,1,0)
dJointSetHingeAnchor(RDJoint(rd,5),xp-1,yp-0.75,zp)
dJointSetHingeParam(RDJoint(rd,5),dParamLoStop,-2.0)
dJointSetHingeParam(RDJoint(rd,5),dParamHiStop,2.0)

; ### Right Arm (Lower) To Right Arm (Upper)

RDJoint(rd,6)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,6),RArmL(rd),RArmU(rd))
dJointSetHingeAxis(RDJoint(rd,6),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,6),xp-1,yp-2,zp)
dJointSetHingeParam(RDJoint(rd,6),dParamLoStop,0.0)
dJointSetHingeParam(RDJoint(rd,6),dParamHiStop,2.0)

; ### Left Leg (Upper) To Body (Lower)

RDJoint(rd,7)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,7),LLegU(rd),BodyL(rd))
dJointSetHingeAxis(RDJoint(rd,7),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,7),xp+1,yp-2.75,zp)
dJointSetHingeParam(RDJoint(rd,7),dParamLoStop,-1.0)
dJointSetHingeParam(RDJoint(rd,7),dParamHiStop,1.0)

; ### Left Leg (Lower) To Left Leg (Upper)

RDJoint(rd,8)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,8),LLegL(rd),LLegU(rd))
dJointSetHingeAxis(RDJoint(rd,8),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,8),xp+1,yp-4.25,zp)
dJointSetHingeParam(RDJoint(rd,8),dParamLoStop,-2.0)
dJointSetHingeParam(RDJoint(rd,8),dParamHiStop,0.0)

; ### Right Leg (Upper) To Body (Lower)

RDJoint(rd,9)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,9),RLegU(rd),BodyL(rd))
dJointSetHingeAxis(RDJoint(rd,9),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,9),xp-1,yp-2.75,zp)
dJointSetHingeParam(RDJoint(rd,9),dParamLoStop,-1.0)
dJointSetHingeParam(RDJoint(rd,9),dParamHiStop,1.0)

; ### Right Leg (Lower) To Right Leg (Upper)

RDJoint(rd,10)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,10),RLegL(rd),RLegU(rd))
dJointSetHingeAxis(RDJoint(rd,10),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,10),xp-1,yp-4.25,zp)
dJointSetHingeParam(RDJoint(rd,10),dParamLoStop,-2.0)
dJointSetHingeParam(RDJoint(rd,10),dParamHiStop,0.0)

; ### Left Foot To Left Leg (Lower)

RDJoint(rd,11)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,11),LFoot(rd),LLegL(rd))
dJointSetHingeAxis(RDJoint(rd,11),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,11),xp+1,yp-5.5,zp)
dJointSetHingeParam(RDJoint(rd,11),dParamLoStop,-0.25)
dJointSetHingeParam(RDJoint(rd,11),dParamHiStop,0.25)

; ### Right Foot To Right Leg (Lower)

RDJoint(rd,12)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,12),RFoot(rd),RLegL(rd))
dJointSetHingeAxis(RDJoint(rd,12),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,12),xp-1,yp-5.5,zp)
dJointSetHingeParam(RDJoint(rd,12),dParamLoStop,-0.25)
dJointSetHingeParam(RDJoint(rd,12),dParamHiStop,0.25)

End Function
Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
;	If dBodyIsEnabled(ode\body)
		RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
		PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
;		End If
Next

End Function

; ###################################################################################################
Function set_object_friction(obj.ODEGeom,friction#,weight)
	friction=friction/100
	friction=friction
	friction=friction*4
	friction=4-friction
	e#=Log10(weight*10)
	e=e-friction
	e=1*(10^e)
	dGeomContactSetMu(obj\geom,e)
End Function
</textarea> <br><br></td></tr></table><br>
<a name="617347"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#144">[#144]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Avon: You're welcome and thanks :)<br><br>@Shifty: Wayne is correct. The problem is the speed of the collision compared to the length of time QuickStep passes. Speeding up the simulation by raising the step time will cause ODE to start skipping the contacts, regardless of the QuickStepNumIterations value. It has to do this to keep the simulation stepping in sync with real time. Also, setting the max contacts to '1' with 'dContactSetMaxContacts(1)' will help stop some of the penetration but not much.<br><br>So, what's the solution? How do we speed up a simulation and still maintain the accuracy? The answer is to perform the 'complete' step process multiple times, so that it doesn't miss any contacts.<br><br>For example, to speed the example up by 100%, you should call the QuickStep twice in the main loop...<br><br><i>dSpaceCollide(Space,World,ContactGroup)<br>dWorldQuickStep(World,0.1)<br>dJointGroupEmpty(ContactGroup)<br><br>dSpaceCollide(Space,World,ContactGroup)<br>dWorldQuickStep(World,0.1)<br>dJointGroupEmpty(ContactGroup)</i><br><br>...and voila, it's twice as fast without penetration.<br><br>If your simulation ever gets penetration, lower the QuickStep value until it's no longer penetrating. Then start adding multiple QuickSteps with the same stable value to speed up the simulation.<br><br>:) <br><br></td></tr></table><br>
<a name="617352"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#145">[#145]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks! I thought that was what the numIterations did, seeing as that's what the name implies. Easy solution though, which is very encouraging! <br><br></td></tr></table><br>
<a name="617353"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#146">[#146]</a></td></tr></table></td></tr><tr ><td class="posttext"> wayne : Thanks for that! Good for playing, and I've found, at least in that example, two iterations is enough.<br><br>VIP3R : What exactly do the numIterations() do then? I can see that that wasn't iterating the collision tests which is where the fault lied. If I drop the numIterations down to 3 the simulation works well, with less variation than using 200 iterations. ODE defaults to 20 but if 3 is enough, isn't 20 wasteful? How much processing overhead does adding iterations have and have does it affect results?<br><br>Edit : Actually I can see instability in the seesaw at lower iterations, so I guess it's accuracy of the resolving that numIterations pertains to. I've also lost my reliable results for no reason! In theory I'd have thought with the same setup, the outcome of the physics solution should be the same for all run-throughs. I've heard one explanation of why this isn't the case that's DirectX changing rounding methods on the fly, but it is odd. <br><br></td></tr></table><br>
<a name="617365"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KuRiX</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#147">[#147]</a></td></tr></table></td></tr><tr ><td class="posttext"> That's it. As Viper says, the best way to achieve fast simulations with great accuracy is multiplying the steps per frame.<br><br>But as the manual says (and i have checked it very well):<br><br>QuickStep(0.2) != QuickStep(0.1) + QuickStep(0.1)<br><br>From what i have tested, doind several the gravity is heavier and the forces too.<br><br>Then you must know that the physicstime will be almost doubled, because the time of the calculation is the same whatever the timestep.<br><br>Anyway, after some tuning, the results are better. <br><br></td></tr></table><br>
<a name="617387"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#148">[#148]</a></td></tr></table></td></tr><tr ><td class="posttext"> I also do a lot of custom collison tests such for magnetism. In theory these ought to be duplicated too per ODE step, but at the moment I'm only applying them once in the first Step and then repeating a couple of Steps on the collisions. Seems okay so far but without extensive testing. I could duplicate the processes but I'm not sure what sort of impact on performance I'd have though. <br><br></td></tr></table><br>
<a name="617476"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#149">[#149]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for sharing Shifty.<br><br>I'm glad I was able to help, as you've found numIterations() controls the accuracy of the simulation, typically 20 is best, but if you want speed at the expense of accuracy then go lower.<br><br>Lots of great support from the rest of the guys too.<br>8) <br><br></td></tr></table><br>
<a name="617578"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#150">[#150]</a></td></tr></table></td></tr><tr ><td class="posttext"> Breakable Joints<br>I was thinking it would be interesting to see breakable joints.<br><br>I thought I could examine the joint forces and break them when desired but the following not supported by JV/ODE:<br>void dJointSetFeedback (dJointID, dJointFeedback *);<br>dJointFeedback *dJointGetFeedback (dJointID);<br><br>I also found this interesting:<br><a href="http://www.q12.org/pipermail/ode/2003-August/009620.html" target="_blank">http://www.q12.org/pipermail/ode/2003-August/009620.html</a><br><br>Comments? <br><br></td></tr></table><br>
<a name="617613"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KuRiX</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#151">[#151]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can break the joint. Just attach it to zero,zero and the joint is broken.<br><br>For example, do it when too much force to the bodies attached to it... <br><br></td></tr></table><br>
<a name="617635"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#152">[#152]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, I think my memory has returned and I should be able to create a nice breakable joint function. let me see now.. <br><br></td></tr></table><br>
<a name="617717"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#153">[#153]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, breaking the joints is simple, but knowing when too much force is applied is more difficult.<br><br>dbodygetforce(), and dbodygettorque() do not work as expected, and joint feedback is not supported.<br><br>I can break joints by examing the magnitudes of linear and angular velocities, but it's the sudden stop that tears body parts off.  <br><br>The breakable joints contribution I posted above is interesting.<br><br>8)<br><br>JV/ODE doesn't support this:<br><br>void dJointSetFeedback (dJointID, dJointFeedback *);<br>dJointFeedback *dJointGetFeedback (dJointID);<br><br>During the world time step, the forces that are applied by each joint are computed. These forces are added directly to the joined bodies, and the user normally has no way of telling which joint contributed how much force.<br><br>If this information is desired then the user can allocate a dJointFeedback structure and pass its pointer to the dJointSetFeedback() function. The feedback information structure is defined as follows:<br><br>typedef struct dJointFeedback {<br>  dVector3 f1;       // force that joint applies to body 1<br>  dVector3 t1;       // torque that joint applies to body 1<br>  dVector3 f2;       // force that joint applies to body 2<br>  dVector3 t2;       // torque that joint applies to body 2<br>} dJointFeedback;<br><br>During the time step any feedback structures that are attached to joints will be filled in with the joint's force and torque information. The dJointGetFeedback() function returns the current feedback structure pointer, or 0 if none is used (this is the default). dJointSetFeedback() can be passed 0 to disable feedback for that joint.<br><br>Now for some API design notes. It might seem strange to require that users perform the allocation of these structures. Why not just store the data statically in each joint? The reason is that not all users will use the feedback information, and even when it is used not all joints will need it. It will waste memory to store it statically, especially as this structure could grow to store a lot of extra information in the future.<br><br>Why not have ODE allocate the structure itself, at the user's request? The reason is that contact joints (which are created and destroyed every time step) would require a lot of time to be spent in memory allocation if feedback is required. Letting the user do the allocation means that a better allocation strategy can be provided, e.g simply allocating them out of a fixed array.<br><br>The alternative to this API is to have a joint-force callback. This would work of course, but it has a few problems. First, callbacks tend to pollute APIs and sometimes require the user to go through unnatural contortions to get the data to the right place. Second, this would expose ODE to being changed in the middle of a step (which would have bad consequences), and there would have to be some kind of guard against this or a debugging check for it - which would complicate things. <br><br></td></tr></table><br>
<a name="617722"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#154">[#154]</a></td></tr></table></td></tr><tr ><td class="posttext"> I managed this fun little creation by watching for sudden changes in linear acceleration.<br><br>Shifty, I hope you don't mind the abuse I'm putting your code thru.<br><br>*currently just supports one body part the head.<br><br>Don't lose your head!<br>8)<br><br>-enjoy<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #									   JV-ODE - Breakable Ragdoll See Saw Demo										#
; #									Code by Jim Williams (VIP3R)									#
; ###################################################################################################

AppTitle "JV-ODE - Breakable Ragdoll See Saw Demo"

Include "JV-ODE.bb"

Graphics3D 800,600,0,2

Global RagDollMax=1

Global LastForce#

Dim Head(RagDollMax)
Dim BodyU(RagDollMax)
Dim BodyL(RagDollMax)
Dim LArmU(RagDollMax)
Dim LArmL(RagDollMax)
Dim RArmU(RagDollMax)
Dim RArmL(RagDollMax)
Dim LLegU(RagDollMax)
Dim LLegL(RagDollMax)
Dim RLegU(RagDollMax)
Dim RLegL(RagDollMax)
Dim LFoot(RagDollMax)
Dim RFoot(RagDollMax)

Dim RDJoint(RagDollMax,12)

Type ODEGeom
	Field body
	Field geom
	Field mesh
	Field mass
End Type

; ###################################################################################################

; ### Setup ODE

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

Global BigG#=-0.98

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,BigG#,0)
dContactSetMode(dContactSlip1+dContactBounce)
dContactSetBounce(0.3)
dContactSetMu(48)
dWorldSetQuickStepNumIterations (World,200)	; default 20

; ### Create light

Global Light=CreateLight()

RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera

Global Camera=CreateCamera()
CameraZoom Camera,1.0
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000
PositionEntity Camera,20,20,-10
RotateEntity Camera,5,45,0

; ### Create plane

dCreatePlane(Space,0,1,0,0)

Plane=CreatePlane()

EntityAlpha Plane,0.8

PlaneTexture=CreateTexture(128,128,9)

ClsColor 0,150,80
Cls

Color 200,200,200

Rect 0,0,64,64,1
Rect 64,64,64,64,1

CopyRect 0,0,128,128,0,0,BackBuffer(),TextureBuffer(PlaneTexture)
ScaleTexture PlaneTexture,20,20
EntityTexture Plane,PlaneTexture,0,0

Color 255,255,255

Mirror=CreateMirror()

; ###################################################################################################

CreateRagDoll(count)

block.ODEGeom=New ODEGeom
	x_pos#=-8
	y_pos#=15
	z_pos#=12
	width#=2
	length#=2
	depth#=2
	x_rot#=0
	y_rot#=0
	z_rot#=0
	weight#=100.0
	
	block\body=dBodyCreate(World)
	block\mass=dMassCreate()
	dMassSetBoxTotal(block\mass,weight, width, length, depth)
	dBodySetMass(block\body,block\mass)
	dBodySetPosition(block\body, x_pos, y_pos, z_pos)
	dBodySetRotation(block\body, x_rot, y_rot, z_rot)
	
	block\geom=dCreateBox(Space,width, length, depth)
	dGeomSetBody(block\geom,block\body)
	dGeomContactSetBounce(block\geom,0.5)
	set_object_friction(block,0.5,weight)
	dGeomContactSetMode(block\geom,dContactSlip1+dContactBounce)

	block\mesh=CreateCube()
	ScaleEntity block\mesh,width/2,length/2,depth/2
	
	seesaw.ODEGeom=New ODEGeom
	seesaw\mass=dMassCreate()
	x_pos#=-8
	y_pos#=5
	z_pos#=8
	width#=3
	length#=0.5
	depth#=15
	x_rot#=-20
	y_rot#=0
	z_rot#=0
	weight#=2.0
	
	seesaw\body=dBodyCreate(World)
	dMassSetBoxTotal(seesaw\mass,weight, width, length, depth)
	dBodySetMass(seesaw\body,seesaw\mass)
	dBodySetPosition(seesaw\body, x_pos, y_pos, z_pos)
	
	seesaw\geom=dCreateBox(Space,width, length, depth)
	dGeomSetBody(seesaw\geom,seesaw\body)
	dGeomContactSetBounce(seesaw\geom,0.5)
	set_object_friction(seesaw,0.5,weight)
	dGeomContactSetMode(seesaw\geom,dContactSlip1+dContactBounce)

	seesaw\mesh=CreateCube()
	; Blitz box lengths 2x longer than ODE box length
	ScaleEntity seesaw\mesh,width/2,length/2,depth/2
	dBodyDisable(seesaw\body)

	seesaw_joint=dJointCreateHinge(World,0)
	dJointAttach(seesaw_joint, seesaw\body, 0)
	dJointSetHingeAxis(seesaw_joint,1,0,0)
	dJointSetHingeAnchor(seesaw_joint,-8,4,8)
	dJointSetHingeParam(seesaw_joint,dParamLoStop,-dinfinity)
	dJointSetHingeParam(seesaw_joint,dParamHiStop,dinfinity)
	dBodySetRotation(seesaw\body, x_rot, y_rot, z_rot)
	
;---------------------------------------------------------------
While Not KeyHit(1)
	UpdateGeoms()
	
	For x=1 To 4
		dSpaceCollide(Space,World,ContactGroup)
			JointLimits(Head(0),3) ; Increase to keep head attached 
			dWorldQuickStep(World,0.05)
		dJointGroupEmpty(ContactGroup)
	Next
	RenderWorld
	
	Text 0,0,"Gravity="+Str(BigG#)
	Text 0,25,"Adjust Gravity - Mouse wheel"
	Text 0,50,"Space resets"
	Flip

	; Adjust Gravity
	BigG#=BigG#+(MouseZSpeed()/100.0)
	dWorldSetGravity(World,0,BigG#,0)
	
	; Space - Resets See Saw, Jumper, block and drops it.
	If KeyHit(57)
	
		; Position See Saw
		x_pos#=-8
		y_pos#=5
		z_pos#=8
		x_rot#=-20
		y_rot#=0
		z_rot#=0
		dBodySetPosition(seesaw\body, x_pos, y_pos, z_pos)
		dBodySetRotation(seesaw\body, x_rot, y_rot, z_rot)
		dBodySetLinearVel(seesaw\body,0,0,0)
		dBodySetAngularVel(seesaw\body,0,0,0)
	 	dBodyDisable(seesaw\body)
		
		
		xp=-8
		yp=9
		zp=2
		; ### Position Head
	
		dBodySetRotation(Head(rd),0,0,0)
		dBodySetPosition(Head(rd),xp,yp,zp)
		dBodySetAutoDisableFlag(Head(rd),1)
		dBodySetLinearVel(Head(rd),0,0,0)
		dBodySetAngularVel(Head(rd),0,0,0)
		dBodyDisable(Head(rd))
		
		; ### Position Body (Upper)
		
		dBodySetRotation(BodyU(rd),0,0,0)
		dBodySetPosition(BodyU(rd),xp,yp-1.25,zp)
		dBodySetAutoDisableFlag(BodyU(rd),1)
		dBodySetLinearVel(BodyU(rd),0,0,0)
		dBodySetAngularVel(BodyU(rd),0,0,0)
		dBodyDisable(BodyU(rd))
		
		; ### Position Body (Lower)
		
		dBodySetRotation(BodyL(rd),0,0,0)
		dBodySetPosition(BodyL(rd),xp,yp-2.5,zp)
		dBodySetAutoDisableFlag(BodyL(rd),1)
		dBodySetLinearVel(BodyL(rd),0,0,0)
		dBodySetAngularVel(BodyL(rd),0,0,0)
		dBodyDisable(BodyL(rd))
		
		; ### Position Left Arm (Upper)
		
		dBodySetRotation(LArmU(rd),90,0,0)
		dBodySetPosition(LArmU(rd),xp+1,yp-1.25,zp)
		dBodySetAutoDisableFlag(LArmU(rd),1)
		dBodySetLinearVel(LArmU(rd),0,0,0)
		dBodySetAngularVel(LArmU(rd),0,0,0)
		dBodyDisable(LArmU(rd))
		
		; ### Position Left Arm (Lower)
		
		dBodySetRotation(LArmL(rd),90,0,0)
		dBodySetPosition(LArmL(rd),xp+1,yp-2.5,zp)
		dBodySetAutoDisableFlag(LArmL(rd),1)
		dBodySetLinearVel(LArmL(rd),0,0,0)
		dBodySetAngularVel(LArmL(rd),0,0,0)
		dBodyDisable(LArmL(rd))
		
		; ### Position Right Arm (Upper)
		
		dBodySetRotation(RArmU(rd),90,0,0)
		dBodySetPosition(RArmU(rd),xp-1,yp-1.25,zp)
		dBodySetAutoDisableFlag(RArmU(rd),1)
		dBodySetLinearVel(RArmU(rd),0,0,0)
		dBodySetAngularVel(RArmU(rd),0,0,0)
		dBodyDisable(RArmU(rd))
		
		; ### Position Right Arm (Lower)
		
		dBodySetRotation(RArmL(rd),90,0,0)
		dBodySetPosition(RArmL(rd),xp-1,yp-2.5,zp)
		dBodySetAutoDisableFlag(RArmL(rd),1)
		dBodySetLinearVel(RArmL(rd),0,0,0)
		dBodySetAngularVel(RArmL(rd),0,0,0)
		dBodyDisable(RArmL(rd))
		
		; ### Position Left Leg (Upper)
		
		dBodySetRotation(LLegU(rd),90,0,0)
		dBodySetPosition(LLegU(rd),xp+0.5,yp-3.6,zp)
		dBodySetAutoDisableFlag(LLegU(rd),1)
		dBodySetLinearVel(LLegU(rd),0,0,0)
		dBodySetAngularVel(LLegU(rd),0,0,0)
		dBodyDisable(LLegU(rd))
		
		; ### Position Left Leg (Lower)
		
		dBodySetRotation(LLegL(rd),90,0,0)
		dBodySetPosition(LLegL(rd),xp+0.5,yp-4.9,zp)
		dBodySetAutoDisableFlag(LLegL(rd),1)
		dBodySetLinearVel(LLegL(rd),0,0,0)
		dBodySetAngularVel(LLegL(rd),0,0,0)
		dBodyDisable(LLegL(rd))
		
		; ### Position Right Leg (Upper)
		
		dBodySetRotation(RLegU(rd),90,0,0)
		dBodySetPosition(RLegU(rd),xp-0.5,yp-3.6,zp)
		dBodySetAutoDisableFlag(RLegU(rd),1)
		dBodySetLinearVel(RLegU(rd),0,0,0)
		dBodySetAngularVel(RLegU(rd),0,0,0)
		dBodyDisable(RLegU(rd))
		
		; ### Position Right Leg (Lower)
		
		dBodySetRotation(RLegL(rd),90,0,0)
		dBodySetPosition(RLegL(rd),xp-0.5,yp-4.9,zp)
		dBodySetAutoDisableFlag(RLegL(rd),1)
		dBodySetLinearVel(RLegL(rd),0,0,0)
		dBodySetAngularVel(RLegL(rd),0,0,0)
		dBodyDisable(RLegL(rd))
		
		; ### Position Left Foot
		
		dBodySetRotation(LFoot(rd),0,0,0)
		dBodySetPosition(LFoot(rd),xp+0.5,yp-5.7,zp-0.25)
		dBodySetAutoDisableFlag(LFoot(rd),1)
		dBodySetLinearVel(LFoot(rd),0,0,0)
		dBodySetAngularVel(LFoot(rd),0,0,0)
		dBodyDisable(LFoot(rd))
		
		; ### Position Right Foot
		
		dBodySetRotation(RFoot(rd),0,0,0)
		dBodySetPosition(RFoot(rd),xp-0.5,yp-5.7,zp-0.25)
		dBodySetAutoDisableFlag(RFoot(rd),1)
		dBodySetLinearVel(RFoot(rd),0,0,0)
		dBodySetAngularVel(RFoot(rd),0,0,0)
		dBodyDisable(RFoot(rd))
	
		x_pos#=-8
		y_pos#=15
		z_pos#=12
		x_rot#=0
		y_rot#=0
		z_rot#=0
		dBodySetPosition(block\body, x_pos, y_pos, z_pos)
		dBodySetRotation(block\body, x_rot, y_rot, z_rot)
		dBodySetLinearVel(block\body,0,0,0)
		dBodySetAngularVel(block\body,0,0,0)
	 	dBodyEnable(block\body)
	
		; Reconnect joints (in case we broke them)
		dJointAttach(RDJoint(rd,1),Head(rd),BodyU(rd))
		
	End If
Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function CreateRagDoll(rd)

xp=-8
yp=9
zp=2

; ### RagDoll Dimensions

headrad#=0.4
bodytx#=1.5
bodyty#=1.5
bodytz#=0.5
bodybx#=1.5
bodyby#=0.75
bodybz#=0.5
larmrad#=0.15
larmlen#=0.9
rarmrad#=0.15
rarmlen#=0.9
llegrad#=0.25
lleglen#=0.8
rlegrad#=0.25
rleglen#=0.8
feetx#=0.5
feety#=0.25
feetz#=1.0
weight#=1.0

; ### Create Head

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
Head(rd)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp,yp,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateSphere(Space,headrad)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateSphere()
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,headrad,headrad,headrad
EntityColor ode\mesh,255,255,255
dBodyDisable(ode\body)
; ### Create Body (Upper)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
BodyU(rd)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp,yp-1.25,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateBox(Space,bodytx,bodyty,bodytz)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,bodytx*0.5,bodyty*0.5,bodytz*0.5
EntityColor ode\mesh,0,200,200
dBodyDisable(ode\body)

; ### Create Body (Lower)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
BodyL(rd)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp,yp-2.5,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateBox(Space,bodybx,bodyby,bodybz)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,bodybx*0.5,bodyby*0.5,bodybz*0.5
EntityColor ode\mesh,0,100,100
dBodyDisable(ode\body)

; ### Create Left Arm (Upper)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
LArmU(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp+1,yp-1.25,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateCCylinder(Space,larmrad,larmlen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,larmrad,(larmlen*0.5)+larmrad,larmrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,255,0,0
dBodyDisable(ode\body)

; ### Create Left Arm (Lower)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
LArmL(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp+1,yp-2.5,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateCCylinder(Space,larmrad,larmlen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,larmrad,(larmlen*0.5)+larmrad,larmrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,125,0,0
dBodyDisable(ode\body)

; ### Create Right Arm (Upper)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RArmU(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp-1,yp-1.25,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateCCylinder(Space,rarmrad,rarmlen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,rarmrad,(rarmlen*0.5)+rarmrad,rarmrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,0,255,0
dBodyDisable(ode\body)

; ### Create Right Arm (Lower)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RArmL(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp-1,yp-2.5,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateCCylinder(Space,rarmrad,rarmlen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,rarmrad,(rarmlen*0.5)+rarmrad,rarmrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,0,125,0
dBodyDisable(ode\body)

; ### Create Left Leg (Upper)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
LLegU(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp+0.5,yp-3.6,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateCCylinder(Space,llegrad,lleglen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,llegrad,(lleglen*0.5)+llegrad,llegrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,255,0,0
dBodyDisable(ode\body)

; ### Create Left Leg (Lower)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
LLegL(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp+0.5,yp-4.9,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateCCylinder(Space,llegrad,lleglen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,llegrad,(lleglen*0.5)+llegrad,llegrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,125,0,0
dBodyDisable(ode\body)

; ### Create Right Leg (Upper)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RLegU(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp-0.5,yp-3.6,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateCCylinder(Space,rlegrad,rleglen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,rlegrad,(rleglen*0.5)+rlegrad,rlegrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,0,255,0
dBodyDisable(ode\body)

; ### Create Right Leg (Lower)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RLegL(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp-0.5,yp-4.9,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateCCylinder(Space,rlegrad,rleglen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,rlegrad,(rleglen*0.5)+rlegrad,rlegrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,0,125,0
dBodyDisable(ode\body)

; ### Create Left Foot

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
LFoot(rd)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp+0.5,yp-5.7,zp-0.25)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateBox(Space,feetx,feety,feetz)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,feetx*0.5,feety*0.5,feetz*0.5
EntityColor ode\mesh,200,0,100
dBodyDisable(ode\body)

; ### Create Right Foot

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RFoot(rd)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp-0.5,yp-5.7,zp-0.25)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateBox(Space,feetx,feety,feetz)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,feetx*0.5,feety*0.5,feetz*0.5
EntityColor ode\mesh,100,200,0
dBodyDisable(ode\body)

; ### Static Joint To Head

;RDJoint(rd,0)=dJointCreateBall(World,0)
;dJointAttach(RDJoint(rd,0),0,Head(rd))
;dJointSetBallAnchor(RDJoint(rd,0),xp,yp,zp)

; ### Head To Body (Upper)

RDJoint(rd,1)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,1),Head(rd),BodyU(rd))
dJointSetHingeAxis(RDJoint(rd,1),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,1),xp,yp-0.25,zp)
dJointSetHingeParam(RDJoint(rd,1),dParamLoStop,-0.5)
dJointSetHingeParam(RDJoint(rd,1),dParamHiStop,0.5)

; ### Body (Upper) To Body (Lower)

RDJoint(rd,2)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,2),BodyU(rd),BodyL(rd))
dJointSetHingeAxis(RDJoint(rd,2),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,2),xp,yp-2,zp)
dJointSetHingeParam(RDJoint(rd,2),dParamLoStop,-0.25)
dJointSetHingeParam(RDJoint(rd,2),dParamHiStop,0.25)

; ### Left Arm (Upper) To Body (Upper)

RDJoint(rd,3)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,3),LArmU(rd),BodyU(rd))
dJointSetHingeAxis(RDJoint(rd,3),1,-1,0)
dJointSetHingeAnchor(RDJoint(rd,3),xp+1,yp-0.75,zp)
dJointSetHingeParam(RDJoint(rd,3),dParamLoStop,-2.0)
dJointSetHingeParam(RDJoint(rd,3),dParamHiStop,2.0)

; ### Left Arm (Lower) To Left Arm (Upper)

RDJoint(rd,4)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,4),LArmL(rd),LArmU(rd))
dJointSetHingeAxis(RDJoint(rd,4),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,4),xp+1,yp-2,zp)
dJointSetHingeParam(RDJoint(rd,4),dParamLoStop,0.0)
dJointSetHingeParam(RDJoint(rd,4),dParamHiStop,2.0)

; ### Right Arm (Upper) To Body (Upper)

RDJoint(rd,5)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,5),RArmU(rd),BodyU(rd))
dJointSetHingeAxis(RDJoint(rd,5),1,1,0)
dJointSetHingeAnchor(RDJoint(rd,5),xp-1,yp-0.75,zp)
dJointSetHingeParam(RDJoint(rd,5),dParamLoStop,-2.0)
dJointSetHingeParam(RDJoint(rd,5),dParamHiStop,2.0)

; ### Right Arm (Lower) To Right Arm (Upper)

RDJoint(rd,6)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,6),RArmL(rd),RArmU(rd))
dJointSetHingeAxis(RDJoint(rd,6),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,6),xp-1,yp-2,zp)
dJointSetHingeParam(RDJoint(rd,6),dParamLoStop,0.0)
dJointSetHingeParam(RDJoint(rd,6),dParamHiStop,2.0)

; ### Left Leg (Upper) To Body (Lower)

RDJoint(rd,7)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,7),LLegU(rd),BodyL(rd))
dJointSetHingeAxis(RDJoint(rd,7),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,7),xp+1,yp-2.75,zp)
dJointSetHingeParam(RDJoint(rd,7),dParamLoStop,-1.0)
dJointSetHingeParam(RDJoint(rd,7),dParamHiStop,1.0)

; ### Left Leg (Lower) To Left Leg (Upper)

RDJoint(rd,8)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,8),LLegL(rd),LLegU(rd))
dJointSetHingeAxis(RDJoint(rd,8),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,8),xp+1,yp-4.25,zp)
dJointSetHingeParam(RDJoint(rd,8),dParamLoStop,-2.0)
dJointSetHingeParam(RDJoint(rd,8),dParamHiStop,0.0)

; ### Right Leg (Upper) To Body (Lower)

RDJoint(rd,9)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,9),RLegU(rd),BodyL(rd))
dJointSetHingeAxis(RDJoint(rd,9),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,9),xp-1,yp-2.75,zp)
dJointSetHingeParam(RDJoint(rd,9),dParamLoStop,-1.0)
dJointSetHingeParam(RDJoint(rd,9),dParamHiStop,1.0)

; ### Right Leg (Lower) To Right Leg (Upper)

RDJoint(rd,10)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,10),RLegL(rd),RLegU(rd))
dJointSetHingeAxis(RDJoint(rd,10),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,10),xp-1,yp-4.25,zp)
dJointSetHingeParam(RDJoint(rd,10),dParamLoStop,-2.0)
dJointSetHingeParam(RDJoint(rd,10),dParamHiStop,0.0)

; ### Left Foot To Left Leg (Lower)

RDJoint(rd,11)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,11),LFoot(rd),LLegL(rd))
dJointSetHingeAxis(RDJoint(rd,11),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,11),xp+1,yp-5.5,zp)
dJointSetHingeParam(RDJoint(rd,11),dParamLoStop,-0.25)
dJointSetHingeParam(RDJoint(rd,11),dParamHiStop,0.25)

; ### Right Foot To Right Leg (Lower)

RDJoint(rd,12)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,12),RFoot(rd),RLegL(rd))
dJointSetHingeAxis(RDJoint(rd,12),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,12),xp-1,yp-5.5,zp)
dJointSetHingeParam(RDJoint(rd,12),dParamLoStop,-0.25)
dJointSetHingeParam(RDJoint(rd,12),dParamHiStop,0.25)

End Function
Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
;	If dBodyIsEnabled(ode\body)
		RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
		PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
;		End If
Next

End Function

; ###################################################################################################
Function set_object_friction(obj.ODEGeom,friction#,weight)
	friction=friction/100
	friction=friction
	friction=friction*4
	friction=4-friction
	e#=Log10(weight*10)
	e=e-friction
	e=1*(10^e)
	dGeomContactSetMu(obj\geom,e)
End Function

; ###################################################################################################

Function JointLimits(body,limit)

For ode.ODEGeom=Each ODEGeom
	If dGeomIsEnabled(ode\geom)
		If body=ode\body
			numjoints=dBodyGetNumJoints(ode\body)
			If numjoints&gt;0 
				For joints=0 To numjoints-1
					joint=dBodyGetJoint(ode\body,joints)
					If dJointGetType(joint)&lt;&gt;dJointTypeContact
						; Get linear velocity vector
				  		ax#=dBodyGetLinearVelX#(ode\body)
				  		ay#=dBodyGetLinearVelY#(ode\body)
					    az#=dBodyGetLinearVelZ#(ode\body)
					
						; Get Angular velocity vector
				  		bx#=dBodyGetAngularVelX#(ode\body)
				  		by#=dBodyGetAngularVelY#(ode\body)
						bz#=dBodyGetAngularVelZ#(ode\body)
						
				  		; Calculate magnitudes
						ForceA#=Sqr(ax*ax+ay*ay+az*az)
						ForceB#=Sqr(bx*bx+by*by+bz*bz)
						
						; Check for sudden deceleration 
						If (LastForce#-forceA#)&gt;limit Then
							dJointAttach(joint,0,0)
						End If
						
						;DebugLog Str(LastForce#-forceA#)
						LastForce#=ForceA#
						
						

					End If
				Next
			End If
		End If
	End If
Next

End Function
</textarea> <br><br></td></tr></table><br>
<a name="617753"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Avon</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#155">[#155]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wayne, I just wanted to say thanks for your various code examples.  They are both fun and educational, and without your input I would not be enjoying JV-ODE as much as I am.  Keep it coming! :) <br><br></td></tr></table><br>
<a name="617756"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#156">[#156]</a></td></tr></table></td></tr><tr ><td class="posttext"> Fantastic stuff. By all means give that ragdoll as much grief as you want! <br><br></td></tr></table><br>
<a name="617791"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#157">[#157]</a></td></tr></table></td></tr><tr ><td class="posttext"> In Seattle we have and American football saying, 'Bring the rain, bring the pain', <br>so with that in mind here is the fully breakable RagDoll ( be gentle now ).<br><br><img src="http://www.bz911.com/postnuke/modules/PNphpBB2/files/pic10.jpg"><br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #									   JV-ODE - Breakable Ragdoll See Saw Demo										#
; #									Code by Jim Williams (VIP3R)									#
; ###################################################################################################

AppTitle "JV-ODE - Breakable Ragdoll See Saw Demo"

Include "JV-ODE.bb"

Graphics3D 800,600,0,1

Global RagDollMax=1

Dim Head(RagDollMax)
Dim BodyU(RagDollMax)
Dim BodyL(RagDollMax)
Dim LArmU(RagDollMax)
Dim LArmL(RagDollMax)
Dim RArmU(RagDollMax)
Dim RArmL(RagDollMax)
Dim LLegU(RagDollMax)
Dim LLegL(RagDollMax)
Dim RLegU(RagDollMax)
Dim RLegL(RagDollMax)
Dim LFoot(RagDollMax)
Dim RFoot(RagDollMax)

Dim RDJoint(RagDollMax,12)

Type ODEGeom
	Field body
	Field geom
	Field mesh
	Field mass
	Field LastForce#
End Type

; ###################################################################################################

; ### Setup ODE

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

Global BigG#=-0.98

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,BigG#,0)
dContactSetMode(dContactSlip1+dContactBounce)
dContactSetBounce(0.3)
dContactSetMu(48)
dWorldSetQuickStepNumIterations (World,40)	; default 20

; ### Create light

Global Light=CreateLight()

RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera

Global Camera=CreateCamera()
CameraZoom Camera,1.0
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000
PositionEntity Camera,20,20,-10
RotateEntity Camera,5,45,0

; ### Create plane

dCreatePlane(Space,0,1,0,0)

Plane=CreatePlane()

EntityAlpha Plane,0.8

PlaneTexture=CreateTexture(128,128,9)

ClsColor 0,150,80
Cls

Color 200,200,200

Rect 0,0,64,64,1
Rect 64,64,64,64,1

CopyRect 0,0,128,128,0,0,BackBuffer(),TextureBuffer(PlaneTexture)
ScaleTexture PlaneTexture,20,20
EntityTexture Plane,PlaneTexture,0,0

Color 255,255,255

Mirror=CreateMirror()

; ###################################################################################################

CreateRagDoll(count)

block.ODEGeom=New ODEGeom
	x_pos#=-8
	y_pos#=15
	z_pos#=12
	width#=2
	length#=2
	depth#=2
	x_rot#=0
	y_rot#=0
	z_rot#=0
	weight#=100.0
	
	block\body=dBodyCreate(World)
	block\mass=dMassCreate()
	dMassSetBoxTotal(block\mass,weight, width, length, depth)
	dBodySetMass(block\body,block\mass)
	dBodySetPosition(block\body, x_pos, y_pos, z_pos)
	dBodySetRotation(block\body, x_rot, y_rot, z_rot)
	
	block\geom=dCreateBox(Space,width, length, depth)
	dGeomSetBody(block\geom,block\body)
	dGeomContactSetBounce(block\geom,0.5)
	set_object_friction(block,0.5,weight)
	dGeomContactSetMode(block\geom,dContactSlip1+dContactBounce)

	block\mesh=CreateCube()
	ScaleEntity block\mesh,width/2,length/2,depth/2
	
	seesaw.ODEGeom=New ODEGeom
	seesaw\mass=dMassCreate()
	x_pos#=-8
	y_pos#=5
	z_pos#=8
	width#=3
	length#=0.5
	depth#=15
	x_rot#=-20
	y_rot#=0
	z_rot#=0
	weight#=2.0
	
	seesaw\body=dBodyCreate(World)
	dMassSetBoxTotal(seesaw\mass,weight, width, length, depth)
	dBodySetMass(seesaw\body,seesaw\mass)
	dBodySetPosition(seesaw\body, x_pos, y_pos, z_pos)
	
	seesaw\geom=dCreateBox(Space,width, length, depth)
	dGeomSetBody(seesaw\geom,seesaw\body)
	dGeomContactSetBounce(seesaw\geom,0.5)
	set_object_friction(seesaw,0.5,weight)
	dGeomContactSetMode(seesaw\geom,dContactSlip1+dContactBounce)

	seesaw\mesh=CreateCube()
	; Blitz box lengths 2x longer than ODE box length
	ScaleEntity seesaw\mesh,width/2,length/2,depth/2
	dBodyDisable(seesaw\body)

	seesaw_joint=dJointCreateHinge(World,0)
	dJointAttach(seesaw_joint, seesaw\body, 0)
	dJointSetHingeAxis(seesaw_joint,1,0,0)
	dJointSetHingeAnchor(seesaw_joint,-8,4,8)
	dJointSetHingeParam(seesaw_joint,dParamLoStop,-dinfinity)
	dJointSetHingeParam(seesaw_joint,dParamHiStop,dinfinity)
	dBodySetRotation(seesaw\body, x_rot, y_rot, z_rot)
	
;---------------------------------------------------------------
While Not KeyHit(1)
	UpdateGeoms()
	
	For x=1 To 4
		dSpaceCollide(Space,World,ContactGroup)
			JointLimits(Head(0),4.8) ; Increase to keep body parts attached 
			dWorldQuickStep(World,0.05)
		dJointGroupEmpty(ContactGroup)
	Next
	RenderWorld
	
	Text 0,0,"Gravity="+Str(BigG#)
	Text 0,25,"Adjust Gravity - Mouse wheel"
	Text 0,50,"Space resets"
	Flip

	; Adjust Gravity
	BigG#=BigG#+(MouseZSpeed()/100.0)
	dWorldSetGravity(World,0,BigG#,0)
	
	; Space - Resets See Saw, Jumper, block and drops it.
	If KeyHit(57)
	
		; Position See Saw
		x_pos#=-8
		y_pos#=5
		z_pos#=8
		x_rot#=-20
		y_rot#=0
		z_rot#=0
		dBodySetPosition(seesaw\body, x_pos, y_pos, z_pos)
		dBodySetRotation(seesaw\body, x_rot, y_rot, z_rot)
		dBodySetLinearVel(seesaw\body,0,0,0)
		dBodySetAngularVel(seesaw\body,0,0,0)
	 	dBodyDisable(seesaw\body)
		
		
		xp=-8
		yp=9
		zp=2
		; ### Position Head
	
		dBodySetRotation(Head(rd),0,0,0)
		dBodySetPosition(Head(rd),xp,yp,zp)
		dBodySetAutoDisableFlag(Head(rd),1)
		dBodySetLinearVel(Head(rd),0,0,0)
		dBodySetAngularVel(Head(rd),0,0,0)
		dBodyDisable(Head(rd))
		
		; ### Position Body (Upper)
		
		dBodySetRotation(BodyU(rd),0,0,0)
		dBodySetPosition(BodyU(rd),xp,yp-1.25,zp)
		dBodySetAutoDisableFlag(BodyU(rd),1)
		dBodySetLinearVel(BodyU(rd),0,0,0)
		dBodySetAngularVel(BodyU(rd),0,0,0)
		dBodyDisable(BodyU(rd))
		
		; ### Position Body (Lower)
		
		dBodySetRotation(BodyL(rd),0,0,0)
		dBodySetPosition(BodyL(rd),xp,yp-2.5,zp)
		dBodySetAutoDisableFlag(BodyL(rd),1)
		dBodySetLinearVel(BodyL(rd),0,0,0)
		dBodySetAngularVel(BodyL(rd),0,0,0)
		dBodyDisable(BodyL(rd))
		
		; ### Position Left Arm (Upper)
		
		dBodySetRotation(LArmU(rd),90,0,0)
		dBodySetPosition(LArmU(rd),xp+1,yp-1.25,zp)
		dBodySetAutoDisableFlag(LArmU(rd),1)
		dBodySetLinearVel(LArmU(rd),0,0,0)
		dBodySetAngularVel(LArmU(rd),0,0,0)
		dBodyDisable(LArmU(rd))
		
		; ### Position Left Arm (Lower)
		
		dBodySetRotation(LArmL(rd),90,0,0)
		dBodySetPosition(LArmL(rd),xp+1,yp-2.5,zp)
		dBodySetAutoDisableFlag(LArmL(rd),1)
		dBodySetLinearVel(LArmL(rd),0,0,0)
		dBodySetAngularVel(LArmL(rd),0,0,0)
		dBodyDisable(LArmL(rd))
		
		; ### Position Right Arm (Upper)
		
		dBodySetRotation(RArmU(rd),90,0,0)
		dBodySetPosition(RArmU(rd),xp-1,yp-1.25,zp)
		dBodySetAutoDisableFlag(RArmU(rd),1)
		dBodySetLinearVel(RArmU(rd),0,0,0)
		dBodySetAngularVel(RArmU(rd),0,0,0)
		dBodyDisable(RArmU(rd))
		
		; ### Position Right Arm (Lower)
		
		dBodySetRotation(RArmL(rd),90,0,0)
		dBodySetPosition(RArmL(rd),xp-1,yp-2.5,zp)
		dBodySetAutoDisableFlag(RArmL(rd),1)
		dBodySetLinearVel(RArmL(rd),0,0,0)
		dBodySetAngularVel(RArmL(rd),0,0,0)
		dBodyDisable(RArmL(rd))
		
		; ### Position Left Leg (Upper)
		
		dBodySetRotation(LLegU(rd),90,0,0)
		dBodySetPosition(LLegU(rd),xp+0.5,yp-3.6,zp)
		dBodySetAutoDisableFlag(LLegU(rd),1)
		dBodySetLinearVel(LLegU(rd),0,0,0)
		dBodySetAngularVel(LLegU(rd),0,0,0)
		dBodyDisable(LLegU(rd))
		
		; ### Position Left Leg (Lower)
		
		dBodySetRotation(LLegL(rd),90,0,0)
		dBodySetPosition(LLegL(rd),xp+0.5,yp-4.9,zp)
		dBodySetAutoDisableFlag(LLegL(rd),1)
		dBodySetLinearVel(LLegL(rd),0,0,0)
		dBodySetAngularVel(LLegL(rd),0,0,0)
		dBodyDisable(LLegL(rd))
		
		; ### Position Right Leg (Upper)
		
		dBodySetRotation(RLegU(rd),90,0,0)
		dBodySetPosition(RLegU(rd),xp-0.5,yp-3.6,zp)
		dBodySetAutoDisableFlag(RLegU(rd),1)
		dBodySetLinearVel(RLegU(rd),0,0,0)
		dBodySetAngularVel(RLegU(rd),0,0,0)
		dBodyDisable(RLegU(rd))
		
		; ### Position Right Leg (Lower)
		
		dBodySetRotation(RLegL(rd),90,0,0)
		dBodySetPosition(RLegL(rd),xp-0.5,yp-4.9,zp)
		dBodySetAutoDisableFlag(RLegL(rd),1)
		dBodySetLinearVel(RLegL(rd),0,0,0)
		dBodySetAngularVel(RLegL(rd),0,0,0)
		dBodyDisable(RLegL(rd))
		
		; ### Position Left Foot
		
		dBodySetRotation(LFoot(rd),0,0,0)
		dBodySetPosition(LFoot(rd),xp+0.5,yp-5.7,zp-0.25)
		dBodySetAutoDisableFlag(LFoot(rd),1)
		dBodySetLinearVel(LFoot(rd),0,0,0)
		dBodySetAngularVel(LFoot(rd),0,0,0)
		dBodyDisable(LFoot(rd))
		
		; ### Position Right Foot
		
		dBodySetRotation(RFoot(rd),0,0,0)
		dBodySetPosition(RFoot(rd),xp-0.5,yp-5.7,zp-0.25)
		dBodySetAutoDisableFlag(RFoot(rd),1)
		dBodySetLinearVel(RFoot(rd),0,0,0)
		dBodySetAngularVel(RFoot(rd),0,0,0)
		dBodyDisable(RFoot(rd))
	
		x_pos#=-8
		y_pos#=15
		z_pos#=12
		x_rot#=0
		y_rot#=0
		z_rot#=0
		dBodySetPosition(block\body, x_pos, y_pos, z_pos)
		dBodySetRotation(block\body, x_rot, y_rot, z_rot)
		dBodySetLinearVel(block\body,0,0,0)
		dBodySetAngularVel(block\body,0,0,0)
	 	dBodyEnable(block\body)
	
		; Reconnect joints (in case we broke them)
		dJointAttach(RDJoint(rd,1),Head(rd),BodyU(rd))
		dJointAttach(RDJoint(rd,2),BodyU(rd),BodyL(rd))
		dJointAttach(RDJoint(rd,3),LArmU(rd),BodyU(rd))
		dJointAttach(RDJoint(rd,4),LArmL(rd),LArmU(rd))
		dJointAttach(RDJoint(rd,5),RArmU(rd),BodyU(rd))
		dJointAttach(RDJoint(rd,6),RArmL(rd),RArmU(rd))
		dJointAttach(RDJoint(rd,7),LLegU(rd),BodyL(rd))
		dJointAttach(RDJoint(rd,8),LLegL(rd),LLegU(rd))
		dJointAttach(RDJoint(rd,9),RLegU(rd),BodyL(rd))
		dJointAttach(RDJoint(rd,10),RLegL(rd),RLegU(rd))
		dJointAttach(RDJoint(rd,11),LFoot(rd),LLegL(rd))
		dJointAttach(RDJoint(rd,12),RFoot(rd),RLegL(rd))

		
	End If
Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function CreateRagDoll(rd)

xp=-8
yp=9
zp=2

; ### RagDoll Dimensions

headrad#=0.4
bodytx#=1.5
bodyty#=1.5
bodytz#=0.5
bodybx#=1.5
bodyby#=0.75
bodybz#=0.5
larmrad#=0.15
larmlen#=0.9
rarmrad#=0.15
rarmlen#=0.9
llegrad#=0.25
lleglen#=0.8
rlegrad#=0.25
rleglen#=0.8
feetx#=0.5
feety#=0.25
feetz#=1.0
weight#=1.0

; ### Create Head

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
Head(rd)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp,yp,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateSphere(Space,headrad)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateSphere()
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,headrad,headrad,headrad
EntityColor ode\mesh,255,255,255
dBodyDisable(ode\body)
; ### Create Body (Upper)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
BodyU(rd)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp,yp-1.25,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateBox(Space,bodytx,bodyty,bodytz)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,bodytx*0.5,bodyty*0.5,bodytz*0.5
EntityColor ode\mesh,0,200,200
dBodyDisable(ode\body)

; ### Create Body (Lower)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
BodyL(rd)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp,yp-2.5,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateBox(Space,bodybx,bodyby,bodybz)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,bodybx*0.5,bodyby*0.5,bodybz*0.5
EntityColor ode\mesh,0,100,100
dBodyDisable(ode\body)

; ### Create Left Arm (Upper)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
LArmU(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp+1,yp-1.25,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateCCylinder(Space,larmrad,larmlen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,larmrad,(larmlen*0.5)+larmrad,larmrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,255,0,0
dBodyDisable(ode\body)

; ### Create Left Arm (Lower)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
LArmL(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp+1,yp-2.5,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateCCylinder(Space,larmrad,larmlen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,larmrad,(larmlen*0.5)+larmrad,larmrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,125,0,0
dBodyDisable(ode\body)

; ### Create Right Arm (Upper)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RArmU(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp-1,yp-1.25,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateCCylinder(Space,rarmrad,rarmlen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,rarmrad,(rarmlen*0.5)+rarmrad,rarmrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,0,255,0
dBodyDisable(ode\body)

; ### Create Right Arm (Lower)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RArmL(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp-1,yp-2.5,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateCCylinder(Space,rarmrad,rarmlen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,rarmrad,(rarmlen*0.5)+rarmrad,rarmrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,0,125,0
dBodyDisable(ode\body)

; ### Create Left Leg (Upper)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
LLegU(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp+0.5,yp-3.6,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateCCylinder(Space,llegrad,lleglen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,llegrad,(lleglen*0.5)+llegrad,llegrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,255,0,0
dBodyDisable(ode\body)

; ### Create Left Leg (Lower)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
LLegL(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp+0.5,yp-4.9,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateCCylinder(Space,llegrad,lleglen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,llegrad,(lleglen*0.5)+llegrad,llegrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,125,0,0
dBodyDisable(ode\body)

; ### Create Right Leg (Upper)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RLegU(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp-0.5,yp-3.6,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateCCylinder(Space,rlegrad,rleglen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,rlegrad,(rleglen*0.5)+rlegrad,rlegrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,0,255,0
dBodyDisable(ode\body)

; ### Create Right Leg (Lower)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RLegL(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp-0.5,yp-4.9,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateCCylinder(Space,rlegrad,rleglen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,rlegrad,(rleglen*0.5)+rlegrad,rlegrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,0,125,0
dBodyDisable(ode\body)

; ### Create Left Foot

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
LFoot(rd)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp+0.5,yp-5.7,zp-0.25)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateBox(Space,feetx,feety,feetz)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,feetx*0.5,feety*0.5,feetz*0.5
EntityColor ode\mesh,200,0,100
dBodyDisable(ode\body)

; ### Create Right Foot

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RFoot(rd)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp-0.5,yp-5.7,zp-0.25)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateBox(Space,feetx,feety,feetz)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,feetx*0.5,feety*0.5,feetz*0.5
EntityColor ode\mesh,100,200,0
dBodyDisable(ode\body)

; ### Static Joint To Head

;RDJoint(rd,0)=dJointCreateBall(World,0)
;dJointAttach(RDJoint(rd,0),0,Head(rd))
;dJointSetBallAnchor(RDJoint(rd,0),xp,yp,zp)

; ### Head To Body (Upper)

RDJoint(rd,1)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,1),Head(rd),BodyU(rd))
dJointSetHingeAxis(RDJoint(rd,1),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,1),xp,yp-0.25,zp)
dJointSetHingeParam(RDJoint(rd,1),dParamLoStop,-0.5)
dJointSetHingeParam(RDJoint(rd,1),dParamHiStop,0.5)

; ### Body (Upper) To Body (Lower)

RDJoint(rd,2)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,2),BodyU(rd),BodyL(rd))
dJointSetHingeAxis(RDJoint(rd,2),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,2),xp,yp-2,zp)
dJointSetHingeParam(RDJoint(rd,2),dParamLoStop,-0.25)
dJointSetHingeParam(RDJoint(rd,2),dParamHiStop,0.25)

; ### Left Arm (Upper) To Body (Upper)

RDJoint(rd,3)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,3),LArmU(rd),BodyU(rd))
dJointSetHingeAxis(RDJoint(rd,3),1,-1,0)
dJointSetHingeAnchor(RDJoint(rd,3),xp+1,yp-0.75,zp)
dJointSetHingeParam(RDJoint(rd,3),dParamLoStop,-2.0)
dJointSetHingeParam(RDJoint(rd,3),dParamHiStop,2.0)

; ### Left Arm (Lower) To Left Arm (Upper)

RDJoint(rd,4)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,4),LArmL(rd),LArmU(rd))
dJointSetHingeAxis(RDJoint(rd,4),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,4),xp+1,yp-2,zp)
dJointSetHingeParam(RDJoint(rd,4),dParamLoStop,0.0)
dJointSetHingeParam(RDJoint(rd,4),dParamHiStop,2.0)

; ### Right Arm (Upper) To Body (Upper)

RDJoint(rd,5)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,5),RArmU(rd),BodyU(rd))
dJointSetHingeAxis(RDJoint(rd,5),1,1,0)
dJointSetHingeAnchor(RDJoint(rd,5),xp-1,yp-0.75,zp)
dJointSetHingeParam(RDJoint(rd,5),dParamLoStop,-2.0)
dJointSetHingeParam(RDJoint(rd,5),dParamHiStop,2.0)

; ### Right Arm (Lower) To Right Arm (Upper)

RDJoint(rd,6)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,6),RArmL(rd),RArmU(rd))
dJointSetHingeAxis(RDJoint(rd,6),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,6),xp-1,yp-2,zp)
dJointSetHingeParam(RDJoint(rd,6),dParamLoStop,0.0)
dJointSetHingeParam(RDJoint(rd,6),dParamHiStop,2.0)

; ### Left Leg (Upper) To Body (Lower)

RDJoint(rd,7)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,7),LLegU(rd),BodyL(rd))
dJointSetHingeAxis(RDJoint(rd,7),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,7),xp+1,yp-2.75,zp)
dJointSetHingeParam(RDJoint(rd,7),dParamLoStop,-1.0)
dJointSetHingeParam(RDJoint(rd,7),dParamHiStop,1.0)

; ### Left Leg (Lower) To Left Leg (Upper)

RDJoint(rd,8)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,8),LLegL(rd),LLegU(rd))
dJointSetHingeAxis(RDJoint(rd,8),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,8),xp+1,yp-4.25,zp)
dJointSetHingeParam(RDJoint(rd,8),dParamLoStop,-2.0)
dJointSetHingeParam(RDJoint(rd,8),dParamHiStop,0.0)

; ### Right Leg (Upper) To Body (Lower)

RDJoint(rd,9)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,9),RLegU(rd),BodyL(rd))
dJointSetHingeAxis(RDJoint(rd,9),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,9),xp-1,yp-2.75,zp)
dJointSetHingeParam(RDJoint(rd,9),dParamLoStop,-1.0)
dJointSetHingeParam(RDJoint(rd,9),dParamHiStop,1.0)

; ### Right Leg (Lower) To Right Leg (Upper)

RDJoint(rd,10)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,10),RLegL(rd),RLegU(rd))
dJointSetHingeAxis(RDJoint(rd,10),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,10),xp-1,yp-4.25,zp)
dJointSetHingeParam(RDJoint(rd,10),dParamLoStop,-2.0)
dJointSetHingeParam(RDJoint(rd,10),dParamHiStop,0.0)

; ### Left Foot To Left Leg (Lower)

RDJoint(rd,11)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,11),LFoot(rd),LLegL(rd))
dJointSetHingeAxis(RDJoint(rd,11),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,11),xp+1,yp-5.5,zp)
dJointSetHingeParam(RDJoint(rd,11),dParamLoStop,-0.25)
dJointSetHingeParam(RDJoint(rd,11),dParamHiStop,0.25)

; ### Right Foot To Right Leg (Lower)

RDJoint(rd,12)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,12),RFoot(rd),RLegL(rd))
dJointSetHingeAxis(RDJoint(rd,12),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,12),xp-1,yp-5.5,zp)
dJointSetHingeParam(RDJoint(rd,12),dParamLoStop,-0.25)
dJointSetHingeParam(RDJoint(rd,12),dParamHiStop,0.25)

End Function
Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
;	If dBodyIsEnabled(ode\body)
		RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
		PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
;		End If
Next

End Function

; ###################################################################################################
Function set_object_friction(obj.ODEGeom,friction#,weight)
	friction=friction/100
	friction=friction
	friction=friction*4
	friction=4-friction
	e#=Log10(weight*10)
	e=e-friction
	e=1*(10^e)
	dGeomContactSetMu(obj\geom,e)
End Function

; ###################################################################################################

Function JointLimits(body,limit)

For ode.ODEGeom=Each ODEGeom
	If dGeomIsEnabled(ode\geom)
		;If body=ode\body  ; specific body parts only
			numjoints=dBodyGetNumJoints(ode\body)
			If numjoints&gt;0 
				For joints=0 To numjoints-1
					joint=dBodyGetJoint(ode\body,joints)
						If joint&lt;&gt;0 ; valid joints only
							If dJointGetType(joint)&lt;&gt;dJointTypeContact
								; Get linear velocity vector
						  		ax#=dBodyGetLinearVelX#(ode\body)
						  		ay#=dBodyGetLinearVelY#(ode\body)
							    az#=dBodyGetLinearVelZ#(ode\body)
							
								; Get Angular velocity vector
						  		bx#=dBodyGetAngularVelX#(ode\body)
						  		by#=dBodyGetAngularVelY#(ode\body)
								bz#=dBodyGetAngularVelZ#(ode\body)
								
						  		; Calculate magnitudes
								ForceA#=Sqr(ax*ax+ay*ay+az*az)
								ForceB#=Sqr(bx*bx+by*by+bz*bz)
								
								; Check for sudden deceleration 
								If Abs((ode\LastForce#-forceA#))&gt;limit Then
									dJointAttach(joint,0,0)
								End If
								
								;DebugLog Str(LastForce#-forceA#)
								ode\LastForce#=ForceA#
						
							End If

					End If
				Next
			End If
		;End If
	End If
Next

End Function
</textarea> <br><br></td></tr></table><br>
<a name="617885"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#158">[#158]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hehe, nice demos there Wayne :)<br><br>Ok, the dBodyGetForce() and dBodyGetTorque() do appear to be working ok.<br><br>[edit] Edited to show correct use<br><br>Add the following code to the main loop of the 'Demo-Rope.bb' demo...<br><br>before the 'dSpaceCollide()' function...<br><i><br>dBodyGetForce(Joint(1)) : JFX#=dVectorX() : JFY#=dVectorY() : JFZ#=dVectorZ()<br>dBodyGetTorque(Joint(1)) : JTX#=dVectorX() : JTY#=dVectorY() : JTZ#=dVectorZ()<br></i><br>before the 'Flip'...<br><i><br>Text 0,50,"Joint Force X:"+JFX<br>Text 0,65,"Joint Force Y:"+JFY<br>Text 0,80,"Joint Force Z:"+JFZ<br><br>Text 0,105,"Joint Torque X:"+JTX<br>Text 0,120,"Joint Torque Y:"+JTY<br>Text 0,135,"Joint Torque Z:"+JTZ<br></i><br>I'm very reluctant to add the contributor (Breakable Joints) code to JV-ODE, doing this could seriously affect reliability of the wrapper (it modifies at least 9 ODE source files). As you've seen in the RagDoll demos it's possible to break a joint anyway.<br><br>I'll look to see if the dJointSetFeedback() / dJointGetFeedback() functions can be added to JV-ODE and let you know my findings. One thing I need to watch for now is how it would affect speed and memory usage.<br><br>Talking of RagDoll demos, here's the latest version of the standard demo which will be included in the next wrapper release. It now includes hand joints and a slightly different joint limit setup (to match the Zombie demo)...<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #									   JV-ODE - RagDoll Demo										#
; #									Code by Jim Williams (VIP3R)									#
; ###################################################################################################

AppTitle "JV-ODE - RagDoll Demo"

Include "JV-ODE.bb"

Graphics3D 800,600,0,2

Global RagDollMax=3
Global ODEJointMax=14

Dim RDBody(RagDollMax,ODEJointMax)
Dim RDJoint(RagDollMax,ODEJointMax)

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

; ###################################################################################################

; ### Setup ODE

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,-0.98,0)
dContactSetMode(dContactSlip1+dContactBounce)
dContactSetBounce(0.4)
dContactSetMu(1)

; ### Create light

Global Light=CreateLight()

RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera

Global Camera=CreateCamera()
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000
PositionEntity Camera,0,9,-5
RotateEntity Camera,30,0,0

; ### Create plane

dCreatePlane(Space,0,1,0,0)

Plane=CreatePlane()

EntityAlpha Plane,0.8

PlaneTexture=CreateTexture(128,128,9)

ClsColor 0,150,80
Cls

Color 200,200,200

Rect 0,0,64,64,1
Rect 64,64,64,64,1

CopyRect 0,0,128,128,0,0,BackBuffer(),TextureBuffer(PlaneTexture)
ScaleTexture PlaneTexture,20,20
EntityTexture Plane,PlaneTexture,0,0

Color 255,255,255

Mirror=CreateMirror()

; ###################################################################################################

; ### Create RagDolls

For count=1 To 3
	CreateRagDoll(count)
Next

; ###################################################################################################

While Not KeyHit(1)

	UpdateControls()

	PTime=MilliSecs()

	UpdateGeoms()

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)

	PhysicsTime#=MilliSecs()-PTime

	UpdateWorld

	RenderWorld

	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime
	Text 300,0,"F1 - Drop RagDoll 1"
	Text 300,15,"F2 - Drop RagDoll 2"
	Text 300,30,"F3 - Drop RagDoll 3"
	Text 300,50,"Space - Throw RagDolls"
	Text 300,65,"Arrow Keys - Move Camera"
	Text 580,0,"F4 - Attach RagDoll 1"
	Text 580,15,"F5 - Attach RagDoll 2"
	Text 580,30,"F6 - Attach RagDoll 3"
	Text 580,50,"L Mouse Button - Push Body"
	Text 580,65,"R Mouse Button - Pull Body"

	Flip

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function CreateRagDoll(rd)

xp#=-8+(rd*4)
yp#=7
zp#=4

; ### RagDoll Dimensions

HeadRad#=0.4
BodyUX#=1.4
BodyUY#=1.5
BodyUZ#=0.5
BodyLX#=1.4
BodyLY#=0.75
BodyLZ#=0.5
ArmURad#=0.18
ArmULen#=1.1
ArmLRad#=0.18
ArmLLen#=1.1
LegURad#=0.25
LegULen#=1.3
LegLRad#=0.25
LegLLen#=1.3
FeetX#=0.5
FeetY#=0.25
FeetZ#=1.0
HandX#=0.1
HandY#=0.4
HandZ#=0.28

; ### Create Head

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RDBody(rd,0)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp,yp,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\geom=dCreateSphere(Space,HeadRad)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateSphere()
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,HeadRad,HeadRad,HeadRad
EntityColor ode\mesh,255,255,255

; ### Create Body (Upper)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RDBody(rd,1)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp,yp-1.25,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\geom=dCreateBox(Space,BodyUX,BodyUY,BodyUZ)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,BodyUX*0.5,BodyUY*0.5,BodyUZ*0.5
EntityColor ode\mesh,0,200,200

; ### Create Body (Lower)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RDBody(rd,2)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp,yp-2.5,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\geom=dCreateBox(Space,BodyLX,BodyLY,BodyLZ)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,BodyLX*0.5,BodyLY*0.5,BodyLZ*0.5
EntityColor ode\mesh,0,100,100

; ### Create Left Arm (Upper)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RDBody(rd,3)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp+0.9,yp-1.25,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\geom=dCreateCylinder(Space,ArmURad,ArmULen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,ArmURad,ArmULen*0.5,ArmURad
EntityColor ode\mesh,255,0,0

; ### Create Left Arm (Lower)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RDBody(rd,4)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp+0.9,yp-2.35,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\geom=dCreateCylinder(Space,ArmLRad,ArmLLen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,ArmLRad,ArmLLen*0.5,ArmLRad
EntityColor ode\mesh,125,0,0

; ### Create Left Hand

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RDBody(rd,5)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp+0.9,yp-3.05,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\geom=dCreateBox(Space,HandX,HandY,HandZ)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,HandX*0.5,HandY*0.5,HandZ*0.5
EntityColor ode\mesh,255,255,255

; ### Create Right Arm (Upper)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RDBody(rd,6)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp-0.9,yp-1.25,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\geom=dCreateCylinder(Space,ArmURad,ArmULen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,ArmURad,ArmULen*0.5,ArmURad
EntityColor ode\mesh,0,255,0

; ### Create Right Arm (Lower)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RDBody(rd,7)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp-0.9,yp-2.35,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\geom=dCreateCylinder(Space,ArmLRad,ArmLLen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,ArmLRad,ArmLLen*0.5,ArmLRad
EntityColor ode\mesh,0,125,0

; ### Create Right Hand

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RDBody(rd,8)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp-0.9,yp-3.05,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\geom=dCreateBox(Space,HandX,HandY,HandZ)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,HandX*0.5,HandY*0.5,HandZ*0.5
EntityColor ode\mesh,255,255,255

; ### Create Left Leg (Upper)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RDBody(rd,9)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp+0.5,yp-3.6,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\geom=dCreateCylinder(Space,LegURad,LegULen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,LegURad,LegULen*0.5,LegURad
EntityColor ode\mesh,255,0,0

; ### Create Left Leg (Lower)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RDBody(rd,10)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp+0.5,yp-4.9,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\geom=dCreateCylinder(Space,LegLRad,LegLLen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,LegLRad,LegLLen*0.5,LegLRad
EntityColor ode\mesh,125,0,0

; ### Create Left Foot

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RDBody(rd,11)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp+0.5,yp-5.7,zp-0.25)
dBodySetAutoDisableFlag(ode\body,1)
ode\geom=dCreateBox(Space,FeetX,FeetY,FeetZ)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,FeetX*0.5,FeetY*0.5,FeetZ*0.5
EntityColor ode\mesh,200,0,100

; ### Create Right Leg (Upper)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RDBody(rd,12)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp-0.5,yp-3.6,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\geom=dCreateCylinder(Space,LegURad,LegULen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,LegURad,LegULen*0.5,LegURad
EntityColor ode\mesh,0,255,0

; ### Create Right Leg (Lower)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RDBody(rd,13)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp-0.5,yp-4.9,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\geom=dCreateCylinder(Space,LegLRad,LegLLen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,LegLRad,LegLLen*0.5,LegLRad
EntityColor ode\mesh,0,125,0

; ### Create Right Foot

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RDBody(rd,14)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp-0.5,yp-5.7,zp-0.25)
dBodySetAutoDisableFlag(ode\body,1)
ode\geom=dCreateBox(Space,FeetX,FeetY,FeetZ)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,FeetX*0.5,FeetY*0.5,FeetZ*0.5
EntityColor ode\mesh,100,200,0

; ### Static Joint To Head

RDJoint(rd,0)=dJointCreateBall(World,0)
dJointAttach(RDJoint(rd,0),0,RDBody(rd,0))
dJointSetBallAnchor(RDJoint(rd,0),xp,yp,zp)

; ### Head To Body (Upper)

RDJoint(rd,1)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,1),RDBody(rd,0),RDBody(rd,1))
dJointSetHingeAxis(RDJoint(rd,1),1,0,1)
dJointSetHingeAnchor(RDJoint(rd,1),xp,yp-0.44,zp)
dJointSetHingeParam(RDJoint(rd,1),dParamLoStop,-0.7)
dJointSetHingeParam(RDJoint(rd,1),dParamHiStop,0.7)

; ### Body (Upper) To Body (Lower)

RDJoint(rd,2)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,2),RDBody(rd,1),RDBody(rd,2))
dJointSetHingeAxis(RDJoint(rd,2),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,2),xp,yp-2.05,zp)
dJointSetHingeParam(RDJoint(rd,2),dParamLoStop,-0.25)
dJointSetHingeParam(RDJoint(rd,2),dParamHiStop,0.25)

; ### Left Arm (Upper) To Body (Upper)

RDJoint(rd,3)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,3),RDBody(rd,3),RDBody(rd,1))
dJointSetHingeAxis(RDJoint(rd,3),1,-1,1)
dJointSetHingeAnchor(RDJoint(rd,3),xp+0.9,yp-0.7,zp)
dJointSetHingeParam(RDJoint(rd,3),dParamLoStop,-1.5)
dJointSetHingeParam(RDJoint(rd,3),dParamHiStop,1.5)

; ### Left Arm (Lower) To Left Arm (Upper)

RDJoint(rd,4)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,4),RDBody(rd,4),RDBody(rd,3))
dJointSetHingeAxis(RDJoint(rd,4),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,4),xp+0.9,yp-1.8,zp)
dJointSetHingeParam(RDJoint(rd,4),dParamLoStop,0.0)
dJointSetHingeParam(RDJoint(rd,4),dParamHiStop,2.0)

; ### Left Hand To Left Arm (Lower)

RDJoint(rd,5)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,5),RDBody(rd,5),RDBody(rd,4))
dJointSetHingeAxis(RDJoint(rd,5),0,0,1)
dJointSetHingeAnchor(RDJoint(rd,5),xp+0.9,yp-2.9,zp)
dJointSetHingeParam(RDJoint(rd,5),dParamLoStop,-0.3)
dJointSetHingeParam(RDJoint(rd,5),dParamHiStop,0.3)

; ### Right Arm (Upper) To Body (Upper)

RDJoint(rd,6)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,6),RDBody(rd,6),RDBody(rd,1))
dJointSetHingeAxis(RDJoint(rd,6),1,1,1)
dJointSetHingeAnchor(RDJoint(rd,6),xp-0.9,yp-0.7,zp)
dJointSetHingeParam(RDJoint(rd,6),dParamLoStop,-1.5)
dJointSetHingeParam(RDJoint(rd,6),dParamHiStop,1.5)

; ### Right Arm (Lower) To Right Arm (Upper)

RDJoint(rd,7)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,7),RDBody(rd,7),RDBody(rd,6))
dJointSetHingeAxis(RDJoint(rd,7),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,7),xp-0.9,yp-1.8,zp)
dJointSetHingeParam(RDJoint(rd,7),dParamLoStop,0.0)
dJointSetHingeParam(RDJoint(rd,7),dParamHiStop,2.0)

; ### Right Hand To Right Arm (Lower)

RDJoint(rd,8)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,8),RDBody(rd,8),RDBody(rd,7))
dJointSetHingeAxis(RDJoint(rd,8),0,0,1)
dJointSetHingeAnchor(RDJoint(rd,8),xp-0.9,yp-2.9,zp)
dJointSetHingeParam(RDJoint(rd,8),dParamLoStop,-0.3)
dJointSetHingeParam(RDJoint(rd,8),dParamHiStop,0.3)

; ### Left Leg (Upper) To Body (Lower)

RDJoint(rd,9)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,9),RDBody(rd,9),RDBody(rd,2))
dJointSetHingeAxis(RDJoint(rd,9),1,0,-1)
dJointSetHingeAnchor(RDJoint(rd,9),xp+0.5,yp-2.9,zp)
dJointSetHingeParam(RDJoint(rd,9),dParamLoStop,-1.0)
dJointSetHingeParam(RDJoint(rd,9),dParamHiStop,1.0)

; ### Left Leg (Lower) To Left Leg (Upper)

RDJoint(rd,10)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,10),RDBody(rd,10),RDBody(rd,9))
dJointSetHingeAxis(RDJoint(rd,10),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,10),xp+0.5,yp-4.25,zp)
dJointSetHingeParam(RDJoint(rd,10),dParamLoStop,-2.0)
dJointSetHingeParam(RDJoint(rd,10),dParamHiStop,0.0)

; ### Left Foot To Left Leg (Lower)

RDJoint(rd,11)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,11),RDBody(rd,11),RDBody(rd,10))
dJointSetHingeAxis(RDJoint(rd,11),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,11),xp+0.5,yp-5.5,zp)
dJointSetHingeParam(RDJoint(rd,11),dParamLoStop,-0.25)
dJointSetHingeParam(RDJoint(rd,11),dParamHiStop,0.25)

; ### Right Leg (Upper) To Body (Lower)

RDJoint(rd,12)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,12),RDBody(rd,12),RDBody(rd,2))
dJointSetHingeAxis(RDJoint(rd,12),1,0,1)
dJointSetHingeAnchor(RDJoint(rd,12),xp-0.5,yp-2.9,zp)
dJointSetHingeParam(RDJoint(rd,12),dParamLoStop,-1.0)
dJointSetHingeParam(RDJoint(rd,12),dParamHiStop,1.0)

; ### Right Leg (Lower) To Right Leg (Upper)

RDJoint(rd,13)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,13),RDBody(rd,13),RDBody(rd,12))
dJointSetHingeAxis(RDJoint(rd,13),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,13),xp-0.5,yp-4.25,zp)
dJointSetHingeParam(RDJoint(rd,13),dParamLoStop,-2.0)
dJointSetHingeParam(RDJoint(rd,13),dParamHiStop,0.0)

; ### Right Foot To Right Leg (Lower)

RDJoint(rd,14)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,14),RDBody(rd,14),RDBody(rd,13))
dJointSetHingeAxis(RDJoint(rd,14),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,14),xp-0.5,yp-5.5,zp)
dJointSetHingeParam(RDJoint(rd,14),dParamLoStop,-0.25)
dJointSetHingeParam(RDJoint(rd,14),dParamHiStop,0.25)

End Function

; ###################################################################################################

Function UpdateControls()

If KeyDown(59)=1 Then dJointAttach(RDJoint(1,0),0,0)
If KeyDown(60)=1 Then dJointAttach(RDJoint(2,0),0,0)
If KeyDown(61)=1 Then dJointAttach(RDJoint(3,0),0,0)

If KeyDown(62)=1 Then dJointAttach(RDJoint(1,0),0,RDBody(1,0))
If KeyDown(63)=1 Then dJointAttach(RDJoint(2,0),0,RDBody(2,0))
If KeyDown(64)=1 Then dJointAttach(RDJoint(3,0),0,RDBody(3,0))

If KeyDown(57)=1
	dBodyAddForce RDBody(1,0),0,20,0
	dBodyAddForce RDBody(2,0),0,20,0
	dBodyAddForce RDBody(3,0),0,20,0
	End If

If KeyDown(200)=1 Then PositionEntity Camera,EntityX(Camera),EntityY(Camera),EntityZ(Camera)+0.3
If KeyDown(208)=1 Then PositionEntity Camera,EntityX(Camera),EntityY(Camera),EntityZ(Camera)-0.3
If KeyDown(203)=1 Then PositionEntity Camera,EntityX(Camera)-0.3,EntityY(Camera),EntityZ(Camera)
If KeyDown(205)=1 Then PositionEntity Camera,EntityX(Camera)+0.3,EntityY(Camera),EntityZ(Camera)

If MouseDown(1)=1
	CameraPick(Camera,MouseX(),MouseY())
	If PickedEntity()
		For ode.ODEGeom=Each ODEGeom
			If ode\mesh=PickedEntity()
				dBodyEnable(ode\body)
				dBodyAddForce ode\body,-20*PickedNX#(),-20*PickedNY#(),-20*PickedNZ#()
				End If
		Next
		End If
	End If

If MouseDown(2)=1
	CameraPick(Camera,MouseX(),MouseY())
	If PickedEntity()
		For ode.ODEGeom=Each ODEGeom
			If ode\mesh=PickedEntity()
				dBodyEnable(ode\body)
				dBodyAddForce ode\body,20*PickedNX#(),20*PickedNY#(),20*PickedNZ#()
				End If
		Next
		End If
	End If

End Function

; ###################################################################################################

Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
	If dBodyIsEnabled(ode\body)
		RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
		PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
		End If
Next

End Function

; ###################################################################################################
</textarea><br>:) <br><br></td></tr></table><br>
<a name="617891"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#159">[#159]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Viper, I had the wrong parameter when I tested dbodygetforce and dbodygettorque, sorry about that.<br><br>I agree with your approach to dJointSetFeedback and ode performace.<br><br>Checking your new ragdoll stuff out. <br><br><br><br>Thanks for the great support. <br><br></td></tr></table><br>
<a name="617935"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#160">[#160]</a></td></tr></table></td></tr><tr ><td class="posttext"> Very fun stuff. What'd be quite cool is a shooting gallery, where you can pop limbs of ragdoll. Perhaps something like clicking left mouse button to fire (apply a  force at the object under the mouse, or at the end of a targetting beam) and using mouse y speed to determine shot velocity.<br><br>I might give this a look, but at the moment my attention's all on work. I'm finally nearing the end of my project! <br><br></td></tr></table><br>
<a name="617949"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#161">[#161]</a></td></tr></table></td></tr><tr ><td class="posttext"> Viper the documentation says:<br><br>const dReal * dBodyGetForce  (dBodyID);<br>const dReal * dBodyGetTorque (dBodyID);<br><br>but you have:<br>dBodyGetForce(Joint(1))<br>dBodyGetTorque(Joint(1))<br><br>Body or joint ? <br><br></td></tr></table><br>
<a name="617951"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#162">[#162]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can use them for both AFAIK :)<br><br>[edit] Ok, you must call dBodyGetForce() and dBodyGetTorque() <b>before</b> dSpaceCollide() in the main loop for the functions to work correctly. The dWorldQuickStep() process will zero their value, so they must be called before it.<br><br>Here's the Rope demo showing dBodyGetForce() and dBodyGetTorque() being used correctly with both the Body ID (rope sphere) and the Joint ID (rope joint)...<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #										 JV-ODE - Rope Demo											#
; #									Code by Jim Williams (VIP3R)									#
; ###################################################################################################

AppTitle "JV-ODE - Rope Demo"

Include "JV-ODE.bb"

Graphics3D 800,600,0,2

Dim Joint(10)
Dim Sphere(10)

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

; ###################################################################################################

; ### Setup ODE

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,-0.98,0)
dContactSetMode(dContactBounce)
dContactSetBounce(0.1)
dContactSetMu(48)

; ### Create Rope

For count=1 To 10
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	Sphere(count)=ode\body
	dBodySetRotation(ode\body,0,0,0)
	dBodySetPosition(ode\body,-30,90-(count*8),0)
	dBodySetAutoDisableFlag(ode\body,1)
	ode\geom=dCreateSphere(Space,4)
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateSphere()
	ScaleMesh ode\mesh,4,4,4
	RotateMesh ode\mesh,0,0,0
	PositionMesh ode\mesh,0,0,0
	EntityColor ode\mesh,Rand(255),Rand(255),Rand(255)
	EntityAlpha ode\mesh,1
	EntityShininess ode\mesh,0.7
	Joint(count)=dJointCreateBall(World,0)
	If count=1
		dJointAttach(Joint(count),0,Sphere(count))
		Else
		dJointAttach(Joint(count),Sphere(count-1),Sphere(count))
		End If
	dJointSetBallAnchor(Joint(count),dBodyGetPositionX(Sphere(count)),dBodyGetPositionY(Sphere(count)),dBodyGetPositionZ(Sphere(count)))
Next

; ### Create light

Global Light=CreateLight()

RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera

Global Camera=CreateCamera()
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000
PositionEntity Camera,0,90,-100
RotateEntity Camera,30,0,0

; ### Create plane

dCreatePlane(Space,0,1,0,0)

Plane=CreatePlane()

EntityAlpha Plane,0.8

PlaneTexture=CreateTexture(128,128,9)

ClsColor 0,200,80
Cls

Color 255,255,255

Rect 0,0,64,64,1
Rect 64,64,64,64,1

CopyRect 0,0,128,128,0,0,BackBuffer(),TextureBuffer(PlaneTexture)
ScaleTexture PlaneTexture,20,20
EntityTexture Plane,PlaneTexture,0,0

Mirror=CreateMirror()

; ###################################################################################################

While Not KeyHit(1)

	UpdateKeys()

	PTime=MilliSecs()

	If MilliSecs()-Timer&gt;700
		AddObject()
		Timer=MilliSecs()
		End If

	UpdateGeoms()

	dBodyGetForce(Joint(1)) : JFX#=dVectorX() : JFY#=dVectorY() : JFZ#=dVectorZ()
	dBodyGetTorque(Joint(1)) : JTX#=dVectorX() : JTY#=dVectorY() : JTZ#=dVectorZ()
	dBodyGetForce(Sphere(10)) : SFX#=dVectorX() : SFY#=dVectorY() : SFZ#=dVectorZ()
	dBodyGetTorque(Sphere(10)) : STX#=dVectorX() : STY#=dVectorY() : STZ#=dVectorZ()

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)

	PhysicsTime#=MilliSecs()-PTime

	UpdateWorld

	RenderWorld

	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime
	Text 640,0,"Add Force To Rope"
	Text 640,15,"Using Arrow Keys"

	Text 0,50,"Joint Force X:"+JFX
	Text 0,65,"Joint Force Y:"+JFY
	Text 0,80,"Joint Force Z:"+JFZ

	Text 0,105,"Joint Torque X:"+JTX
	Text 0,120,"Joint Torque Y:"+JTY
	Text 0,135,"Joint Torque Z:"+JTZ

	Text 0,170,"Sphere Force X:"+SFX
	Text 0,185,"Sphere Force Y:"+SFY
	Text 0,200,"Sphere Force Z:"+SFZ

	Text 0,225,"Sphere Torque X:"+STX
	Text 0,240,"Sphere Torque Y:"+STY
	Text 0,255,"Sphere Torque Z:"+STZ

	Flip

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function AddObject()

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,30,80,0)
dBodySetAutoDisableFlag(ode\body,1)
ode\geom=dCreateBox(Space,10,5,10)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,5,2.5,5
EntityColor ode\mesh,Rand(255),Rand(255),Rand(255)
EntityAlpha ode\mesh,1
EntityShininess ode\mesh,0.7

End Function

; ###################################################################################################

Function UpdateKeys()

If KeyDown(203) Then dBodyAddForce(Sphere(10),-10,0,0)
If KeyDown(205) Then dBodyAddForce(Sphere(10),10,0,0)
If KeyDown(200) Then dBodyAddForce(Sphere(10),0,0,10)
If KeyDown(208) Then dBodyAddForce(Sphere(10),0,0,-10)

End Function

; ###################################################################################################

Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
	If dBodyIsEnabled(ode\body)
		RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
		PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
		End If
Next

End Function

; ###################################################################################################
</textarea> <br><br></td></tr></table><br>
<a name="618067"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#163">[#163]</a></td></tr></table></td></tr><tr ><td class="posttext"> Breakable joints<br><br>I cleaned up the code some, added comments.<br>Features dbodyGetForce, dbodyGetTorque, and timer based physics, mouse look, and rendering.<br><br>This should run at the same speed on most machines.<br>As always many ways to accomplish these things.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #									   JV-ODE - BreakMe Ragdoll Demo										#
; #									Code by Jim Williams (VIP3R)									#
; ###################################################################################################

AppTitle "JV-ODE - BreakMe Ragdoll Demo"

Include "JV-ODE.bb"

Graphics3D 800,600,0,2


Global RagDollMax=1

Dim Head(RagDollMax)
Dim BodyU(RagDollMax)
Dim BodyL(RagDollMax)
Dim LArmU(RagDollMax)
Dim LArmL(RagDollMax)
Dim RArmU(RagDollMax)
Dim RArmL(RagDollMax)
Dim LLegU(RagDollMax)
Dim LLegL(RagDollMax)
Dim RLegU(RagDollMax)
Dim RLegL(RagDollMax)
Dim LFoot(RagDollMax)
Dim RFoot(RagDollMax)

Dim RDJoint(RagDollMax,12)

Type ODEGeom
	Field body
	Field geom
	Field mesh
	Field mass
End Type

; ###################################################################################################

; ### Setup ODE


Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

Global BigG#=-0.98

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,BigG#,0)
dContactSetMode(dContactSlip1+dContactBounce)
dContactSetBounce(0.3)
dContactSetMu(48)
dWorldSetQuickStepNumIterations (World,20)	; default 20

; ### Create light

Global Light=CreateLight()

RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera

Global Camera=CreateCamera()
CameraZoom Camera,1.0
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000
PositionEntity Camera,20,20,-10
RotateEntity Camera,5,45,0


; ### Create plane

dCreatePlane(Space,0,1,0,0)

Plane=CreatePlane()

EntityAlpha Plane,0.8

PlaneTexture=CreateTexture(128,128,9)

ClsColor 0,150,80
Cls

Color 200,200,200

Rect 0,0,64,64,1
Rect 64,64,64,64,1

CopyRect 0,0,128,128,0,0,BackBuffer(),TextureBuffer(PlaneTexture)
ScaleTexture PlaneTexture,20,20
EntityTexture Plane,PlaneTexture,0,0

Color 255,255,255

Mirror=CreateMirror()

; ###################################################################################################

CreateRagDoll(count)

block.ODEGeom=New ODEGeom
	x_pos#=-8
	y_pos#=15
	z_pos#=12
	width#=2
	length#=2
	depth#=2
	x_rot#=0
	y_rot#=0
	z_rot#=0
	weight#=100.0
	
	block\body=dBodyCreate(World)
	block\mass=dMassCreate()
	dMassSetBoxTotal(block\mass,weight, width, length, depth)
	dBodySetMass(block\body,block\mass)
	dBodySetPosition(block\body, x_pos, y_pos, z_pos)
	dBodySetRotation(block\body, x_rot, y_rot, z_rot)
	
	block\geom=dCreateBox(Space,width, length, depth)
	dGeomSetBody(block\geom,block\body)
	dGeomContactSetBounce(block\geom,0.5)
	set_object_friction(block,0.5,weight)
	dGeomContactSetMode(block\geom,dContactSlip1+dContactBounce)

	block\mesh=CreateCube()
	ScaleEntity block\mesh,width/2,length/2,depth/2
	
	seesaw.ODEGeom=New ODEGeom
	seesaw\mass=dMassCreate()
	x_pos#=-8
	y_pos#=5
	z_pos#=8
	width#=3
	length#=0.5
	depth#=15
	x_rot#=-20
	y_rot#=0
	z_rot#=0
	weight#=2.0
	
	seesaw\body=dBodyCreate(World)
	dMassSetBoxTotal(seesaw\mass,weight, width, length, depth)
	dBodySetMass(seesaw\body,seesaw\mass)
	dBodySetPosition(seesaw\body, x_pos, y_pos, z_pos)
	
	seesaw\geom=dCreateBox(Space,width, length, depth)
	dGeomSetBody(seesaw\geom,seesaw\body)
	dGeomContactSetBounce(seesaw\geom,0.5)
	set_object_friction(seesaw,0.5,weight)
	dGeomContactSetMode(seesaw\geom,dContactSlip1+dContactBounce)

	seesaw\mesh=CreateCube()
	; Blitz box lengths 2x longer than ODE box length
	ScaleEntity seesaw\mesh,width/2,length/2,depth/2
	dBodyDisable(seesaw\body)

	seesaw_joint=dJointCreateHinge(World,0)
	dJointAttach(seesaw_joint, seesaw\body, 0)
	dJointSetHingeAxis(seesaw_joint,1,0,0)
	dJointSetHingeAnchor(seesaw_joint,-8,4,8)
	dJointSetHingeParam(seesaw_joint,dParamLoStop,-dinfinity)
	dJointSetHingeParam(seesaw_joint,dParamHiStop,dinfinity)
	dBodySetRotation(seesaw\body, x_rot, y_rot, z_rot)
	

;===============================================================
; Render Loop

While Not KeyHit(1)

	; Calculate Time 
	If T=0 Then T=MilliSecs()
	T=MilliSecs() 
	
	;-----------------------------------------------------------
	; Mouse Look code
	
	; Poll Mouse Movement every 33ms ( 30/sec )
	If T &gt; Time2 + 33 Then
		Time2=T
		mxs#=mxs#+(MouseXSpeed()-mxs#)/3
		mys#=mys#+(MouseYSpeed()-mys#)/3
	
		If MouseDown(2) Then 
			MoveMouse GraphicsWidth()/2,GraphicsHeight()/2
			p1#=p1#-mys#
			y1#=y1#-mxs#
			RotateEntity camera,-p1#,y1#,0
		EndIf
	EndIf	
	
	;----------------------------------------------------------
	; WSAD - Movement

	; W- Forward
	If KeyDown(17) Or KeyDown(200) Then
		MoveEntity camera,0,0,1
	EndIf
	; S- Reverse
	If KeyDown(31) Or KeyDown(208) Then
		MoveEntity camera,0,0,-1
	EndIf
	
	; A- Left
	If KeyDown(30) Or KeyDown(203) Then
		MoveEntity camera,-1,0,0
	EndIf
	; D- Right
	If KeyDown(32) Or KeyDown(205) Then
		MoveEntity camera,1,0,0
	EndIf
	
	
	;-----------------------------------------------
	; Physics
	;
	; Run Physics every 10ms ( 100 Times/sec )
	If T &gt; Time3 + 10 Then
		Time3=T	
		
		PTime=MilliSecs()
	
		UpdateGeoms()
	
		For x=1 To 2 ; Increase to speed up simulation
			dSpaceCollide(Space,World,ContactGroup)
				dWorldQuickStep(World,0.05)
				updatefriction()
			dJointGroupEmpty(ContactGroup)
		Next
	
		PhysicsTime#=MilliSecs()-PTime
		
	End If
    ;-----------------------------------------------
	; render world every 33ms ( 30 FPS )
	If T &gt; Time4 + 33 Then
		Time4=T
	RenderWorld
	EndIf	
	
	
	;-----------------------------------------------
	; Break joints for each body
	
	rd=0 			; Ragdoll id
	Jlimit#=250	; Joint Limit, hand tuned, larger limit resists breakage.
	JointLimits(Head(rd),Jlimit#) 
	JointLimits(BodyU(rd),Jlimit#)
	JointLimits(BodyL(rd),Jlimit#)
	JointLimits(LArmU(rd),Jlimit#)
	JointLimits(LArmL(rd),Jlimit#)
	JointLimits(RArmU(rd),Jlimit#)
	JointLimits(RArmL(rd),Jlimit#)
	JointLimits(LLegU(rd),Jlimit#)
	JointLimits(LLegL(rd),Jlimit#)
	JointLimits(RLegU(rd),Jlimit#)
	JointLimits(RLegL(rd),Jlimit#)
	JointLimits(LFoot(rd),Jlimit#)
	JointLimits(RFoot(rd),Jlimit#)
	
	Text 0,0,"Gravity="+Str(BigG#)
	Text 0,15,"Adjust Gravity - Mouse wheel"
	Text 0,30,"Reset - Space"
	Text 0,45,"Physics Time:"+PhysicsTime
		
	Flip

	; Adjust Gravity - mouse wheel
	BigG#=BigG#+(MouseZSpeed()/100.0)
	dWorldSetGravity(World,0,BigG#,0)
	
	;--------------------------------------------------------
	; Space - Resets See Saw, Jumper, block and drops it.
	If KeyHit(57)
	
		; Position See Saw
		x_pos#=-8
		y_pos#=5
		z_pos#=8
		x_rot#=-20
		y_rot#=0
		z_rot#=0
		dBodySetPosition(seesaw\body, x_pos, y_pos, z_pos)
		dBodySetRotation(seesaw\body, x_rot, y_rot, z_rot)
		dBodySetLinearVel(seesaw\body,0,0,0)
		dBodySetAngularVel(seesaw\body,0,0,0)
	 	dBodyDisable(seesaw\body)
		
		
		xp=-8
		yp=9
		zp=2
		; ### Position Head
	
		dBodySetRotation(Head(rd),0,0,0)
		dBodySetPosition(Head(rd),xp,yp,zp)
		dBodySetAutoDisableFlag(Head(rd),1)
		dBodySetLinearVel(Head(rd),0,0,0)
		dBodySetAngularVel(Head(rd),0,0,0)
		dBodySetForce(Head(rd),0,0,0)
		dBodySetTorque(Head(rd),0,0,0)
		dBodyDisable(Head(rd))
		
		; ### Position Body (Upper)
		
		dBodySetRotation(BodyU(rd),0,0,0)
		dBodySetPosition(BodyU(rd),xp,yp-1.25,zp)
		dBodySetAutoDisableFlag(BodyU(rd),1)
		dBodySetLinearVel(BodyU(rd),0,0,0)
		dBodySetAngularVel(BodyU(rd),0,0,0)
		dBodySetForce(BodyU(rd),0,0,0)
		dBodySetTorque(BodyU(rd),0,0,0)
		dBodyDisable(BodyU(rd))
		
		; ### Position Body (Lower)
		
		dBodySetRotation(BodyL(rd),0,0,0)
		dBodySetPosition(BodyL(rd),xp,yp-2.5,zp)
		dBodySetAutoDisableFlag(BodyL(rd),1)
		dBodySetLinearVel(BodyL(rd),0,0,0)
		dBodySetAngularVel(BodyL(rd),0,0,0)
		dBodySetForce(BodyL(rd),0,0,0)
		dBodySetTorque(BodyL(rd),0,0,0)
		dBodyDisable(BodyL(rd))
		
		; ### Position Left Arm (Upper)
		
		dBodySetRotation(LArmU(rd),90,0,0)
		dBodySetPosition(LArmU(rd),xp+1,yp-1.25,zp)
		dBodySetAutoDisableFlag(LArmU(rd),1)
		dBodySetLinearVel(LArmU(rd),0,0,0)
		dBodySetAngularVel(LArmU(rd),0,0,0)
		dBodySetForce(LArmU(rd),0,0,0)
		dBodySetTorque(LArmU(rd),0,0,0)
		dBodyDisable(LArmU(rd))
		
		; ### Position Left Arm (Lower)
		
		dBodySetRotation(LArmL(rd),90,0,0)
		dBodySetPosition(LArmL(rd),xp+1,yp-2.5,zp)
		dBodySetAutoDisableFlag(LArmL(rd),1)
		dBodySetLinearVel(LArmL(rd),0,0,0)
		dBodySetAngularVel(LArmL(rd),0,0,0)
		dBodySetForce(LArmL(rd),0,0,0)
		dBodySetTorque(LArmL(rd),0,0,0)
		dBodyDisable(LArmL(rd))
		
		; ### Position Right Arm (Upper)
		
		dBodySetRotation(RArmU(rd),90,0,0)
		dBodySetPosition(RArmU(rd),xp-1,yp-1.25,zp)
		dBodySetAutoDisableFlag(RArmU(rd),1)
		dBodySetLinearVel(RArmU(rd),0,0,0)
		dBodySetAngularVel(RArmU(rd),0,0,0)
		dBodySetForce(RArmU(rd),0,0,0)
		dBodySetTorque(RArmU(rd),0,0,0)
		dBodyDisable(RArmU(rd))
		
		; ### Position Right Arm (Lower)
		
		dBodySetRotation(RArmL(rd),90,0,0)
		dBodySetPosition(RArmL(rd),xp-1,yp-2.5,zp)
		dBodySetAutoDisableFlag(RArmL(rd),1)
		dBodySetLinearVel(RArmL(rd),0,0,0)
		dBodySetAngularVel(RArmL(rd),0,0,0)
		dBodySetForce(RArmL(rd),0,0,0)
		dBodySetTorque(RArmL(rd),0,0,0)
		dBodyDisable(RArmL(rd))
		
		; ### Position Left Leg (Upper)
		
		dBodySetRotation(LLegU(rd),90,0,0)
		dBodySetPosition(LLegU(rd),xp+0.5,yp-3.6,zp)
		dBodySetAutoDisableFlag(LLegU(rd),1)
		dBodySetLinearVel(LLegU(rd),0,0,0)
		dBodySetAngularVel(LLegU(rd),0,0,0)
		dBodySetForce(LLegU(rd),0,0,0)
		dBodySetTorque(LLegU(rd),0,0,0)
		dBodyDisable(LLegU(rd))
		
		; ### Position Left Leg (Lower)
		
		dBodySetRotation(LLegL(rd),90,0,0)
		dBodySetPosition(LLegL(rd),xp+0.5,yp-4.9,zp)
		dBodySetAutoDisableFlag(LLegL(rd),1)
		dBodySetLinearVel(LLegL(rd),0,0,0)
		dBodySetAngularVel(LLegL(rd),0,0,0)
		dBodySetForce(LLegL(rd),0,0,0)
		dBodySetTorque(LLegL(rd),0,0,0)
		dBodyDisable(LLegL(rd))
		
		; ### Position Right Leg (Upper)
		
		dBodySetRotation(RLegU(rd),90,0,0)
		dBodySetPosition(RLegU(rd),xp-0.5,yp-3.6,zp)
		dBodySetAutoDisableFlag(RLegU(rd),1)
		dBodySetLinearVel(RLegU(rd),0,0,0)
		dBodySetAngularVel(RLegU(rd),0,0,0)
		dBodySetForce(RLegU(rd),0,0,0)
		dBodySetTorque(RLegU(rd),0,0,0)
		dBodyDisable(RLegU(rd))
		
		; ### Position Right Leg (Lower)
		
		dBodySetRotation(RLegL(rd),90,0,0)
		dBodySetPosition(RLegL(rd),xp-0.5,yp-4.9,zp)
		dBodySetAutoDisableFlag(RLegL(rd),1)
		dBodySetLinearVel(RLegL(rd),0,0,0)
		dBodySetAngularVel(RLegL(rd),0,0,0)
		dBodySetForce(RLegL(rd),0,0,0)
		dBodySetTorque(RLegL(rd),0,0,0)
		dBodyDisable(RLegL(rd))
		
		; ### Position Left Foot
		
		dBodySetRotation(LFoot(rd),0,0,0)
		dBodySetPosition(LFoot(rd),xp+0.5,yp-5.7,zp-0.25)
		dBodySetAutoDisableFlag(LFoot(rd),1)
		dBodySetLinearVel(LFoot(rd),0,0,0)
		dBodySetAngularVel(LFoot(rd),0,0,0)
		dBodySetForce(LFoot(rd),0,0,0)
		dBodySetTorque(LFoot(rd),0,0,0)
		dBodyDisable(LFoot(rd))
		
		; ### Position Right Foot
		
		dBodySetRotation(RFoot(rd),0,0,0)
		dBodySetPosition(RFoot(rd),xp-0.5,yp-5.7,zp-0.25)
		dBodySetAutoDisableFlag(RFoot(rd),1)
		dBodySetLinearVel(RFoot(rd),0,0,0)
		dBodySetAngularVel(RFoot(rd),0,0,0)
		dBodySetForce(RFoot(rd),0,0,0)
		dBodySetTorque(RFoot(rd),0,0,0)
		dBodyDisable(RFoot(rd))
	
		x_pos#=-8
		y_pos#=15
		z_pos#=12
		x_rot#=0
		y_rot#=0
		z_rot#=0
		dBodySetPosition(block\body, x_pos, y_pos, z_pos)
		dBodySetRotation(block\body, x_rot, y_rot, z_rot)
		dBodySetLinearVel(block\body,0,0,0)
		dBodySetAngularVel(block\body,0,0,0)
	 	dBodyEnable(block\body)
	
		; Reconnect joints (in case we broke them)
		dJointAttach(RDJoint(rd,1),Head(rd),BodyU(rd))
		dJointAttach(RDJoint(rd,2),BodyU(rd),BodyL(rd))
		dJointAttach(RDJoint(rd,3),LArmU(rd),BodyU(rd))
		dJointAttach(RDJoint(rd,4),LArmL(rd),LArmU(rd))
		dJointAttach(RDJoint(rd,5),RArmU(rd),BodyU(rd))
		dJointAttach(RDJoint(rd,6),RArmL(rd),RArmU(rd))
		dJointAttach(RDJoint(rd,7),LLegU(rd),BodyL(rd))
		dJointAttach(RDJoint(rd,8),LLegL(rd),LLegU(rd))
		dJointAttach(RDJoint(rd,9),RLegU(rd),BodyL(rd))
		dJointAttach(RDJoint(rd,10),RLegL(rd),RLegU(rd))
		dJointAttach(RDJoint(rd,11),LFoot(rd),LLegL(rd))
		dJointAttach(RDJoint(rd,12),RFoot(rd),RLegL(rd))

		
	End If
Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function CreateRagDoll(rd)

xp=-8
yp=9
zp=2

; ### RagDoll Dimensions

headrad#=0.4
bodytx#=1.5
bodyty#=1.5
bodytz#=0.5
bodybx#=1.5
bodyby#=0.75
bodybz#=0.5
larmrad#=0.15
larmlen#=0.9
rarmrad#=0.15
rarmlen#=0.9
llegrad#=0.25
lleglen#=0.8
rlegrad#=0.25
rleglen#=0.8
feetx#=0.5
feety#=0.25
feetz#=1.0
weight#=1.0

; ### Create Head

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
Head(rd)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp,yp,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateSphere(Space,headrad)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateSphere()
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,headrad,headrad,headrad
EntityColor ode\mesh,255,255,255
dBodyDisable(ode\body)


; ### Create Body (Upper)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
BodyU(rd)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp,yp-1.25,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateBox(Space,bodytx,bodyty,bodytz)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,bodytx*0.5,bodyty*0.5,bodytz*0.5
EntityColor ode\mesh,0,200,200
dBodyDisable(ode\body)

; ### Create Body (Lower)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
BodyL(rd)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp,yp-2.5,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateBox(Space,bodybx,bodyby,bodybz)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,bodybx*0.5,bodyby*0.5,bodybz*0.5
EntityColor ode\mesh,0,100,100
dBodyDisable(ode\body)

; ### Create Left Arm (Upper)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
LArmU(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp+1,yp-1.25,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateCCylinder(Space,larmrad,larmlen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,larmrad,(larmlen*0.5)+larmrad,larmrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,255,0,0
dBodyDisable(ode\body)

; ### Create Left Arm (Lower)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
LArmL(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp+1,yp-2.5,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateCCylinder(Space,larmrad,larmlen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,larmrad,(larmlen*0.5)+larmrad,larmrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,125,0,0
dBodyDisable(ode\body)

; ### Create Right Arm (Upper)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RArmU(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp-1,yp-1.25,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateCCylinder(Space,rarmrad,rarmlen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,rarmrad,(rarmlen*0.5)+rarmrad,rarmrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,0,255,0
dBodyDisable(ode\body)

; ### Create Right Arm (Lower)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RArmL(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp-1,yp-2.5,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateCCylinder(Space,rarmrad,rarmlen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,rarmrad,(rarmlen*0.5)+rarmrad,rarmrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,0,125,0
dBodyDisable(ode\body)

; ### Create Left Leg (Upper)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
LLegU(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp+0.5,yp-3.6,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateCCylinder(Space,llegrad,lleglen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,llegrad,(lleglen*0.5)+llegrad,llegrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,255,0,0
dBodyDisable(ode\body)

; ### Create Left Leg (Lower)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
LLegL(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp+0.5,yp-4.9,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateCCylinder(Space,llegrad,lleglen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,llegrad,(lleglen*0.5)+llegrad,llegrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,125,0,0
dBodyDisable(ode\body)

; ### Create Right Leg (Upper)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RLegU(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp-0.5,yp-3.6,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateCCylinder(Space,rlegrad,rleglen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,rlegrad,(rleglen*0.5)+rlegrad,rlegrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,0,255,0
dBodyDisable(ode\body)

; ### Create Right Leg (Lower)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RLegL(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp-0.5,yp-4.9,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateCCylinder(Space,rlegrad,rleglen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,rlegrad,(rleglen*0.5)+rlegrad,rlegrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,0,125,0
dBodyDisable(ode\body)

; ### Create Left Foot

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
LFoot(rd)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp+0.5,yp-5.7,zp-0.25)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateBox(Space,feetx,feety,feetz)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,feetx*0.5,feety*0.5,feetz*0.5
EntityColor ode\mesh,200,0,100
dBodyDisable(ode\body)

; ### Create Right Foot

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RFoot(rd)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp-0.5,yp-5.7,zp-0.25)
dBodySetAutoDisableFlag(ode\body,1)
ode\mass=dMassCreate()
	dMassSetBoxTotal(ode\mass,weight, width, length, depth)
	dBodySetMass(ode\body,ode\mass)
ode\geom=dCreateBox(Space,feetx,feety,feetz)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,feetx*0.5,feety*0.5,feetz*0.5
EntityColor ode\mesh,100,200,0
dBodyDisable(ode\body)

; ### Static Joint To Head

;RDJoint(rd,0)=dJointCreateBall(World,0)
;dJointAttach(RDJoint(rd,0),0,Head(rd))
;dJointSetBallAnchor(RDJoint(rd,0),xp,yp,zp)

; ### Head To Body (Upper)

RDJoint(rd,1)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,1),Head(rd),BodyU(rd))
dJointSetHingeAxis(RDJoint(rd,1),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,1),xp,yp-0.25,zp)
dJointSetHingeParam(RDJoint(rd,1),dParamLoStop,-0.5)
dJointSetHingeParam(RDJoint(rd,1),dParamHiStop,0.5)

; ### Body (Upper) To Body (Lower)

RDJoint(rd,2)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,2),BodyU(rd),BodyL(rd))
dJointSetHingeAxis(RDJoint(rd,2),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,2),xp,yp-2,zp)
dJointSetHingeParam(RDJoint(rd,2),dParamLoStop,-0.25)
dJointSetHingeParam(RDJoint(rd,2),dParamHiStop,0.25)

; ### Left Arm (Upper) To Body (Upper)

RDJoint(rd,3)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,3),LArmU(rd),BodyU(rd))
dJointSetHingeAxis(RDJoint(rd,3),1,-1,0)
dJointSetHingeAnchor(RDJoint(rd,3),xp+1,yp-0.75,zp)
dJointSetHingeParam(RDJoint(rd,3),dParamLoStop,-2.0)
dJointSetHingeParam(RDJoint(rd,3),dParamHiStop,2.0)

; ### Left Arm (Lower) To Left Arm (Upper)

RDJoint(rd,4)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,4),LArmL(rd),LArmU(rd))
dJointSetHingeAxis(RDJoint(rd,4),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,4),xp+1,yp-2,zp)
dJointSetHingeParam(RDJoint(rd,4),dParamLoStop,0.0)
dJointSetHingeParam(RDJoint(rd,4),dParamHiStop,2.0)

; ### Right Arm (Upper) To Body (Upper)

RDJoint(rd,5)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,5),RArmU(rd),BodyU(rd))
dJointSetHingeAxis(RDJoint(rd,5),1,1,0)
dJointSetHingeAnchor(RDJoint(rd,5),xp-1,yp-0.75,zp)
dJointSetHingeParam(RDJoint(rd,5),dParamLoStop,-2.0)
dJointSetHingeParam(RDJoint(rd,5),dParamHiStop,2.0)

; ### Right Arm (Lower) To Right Arm (Upper)

RDJoint(rd,6)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,6),RArmL(rd),RArmU(rd))
dJointSetHingeAxis(RDJoint(rd,6),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,6),xp-1,yp-2,zp)
dJointSetHingeParam(RDJoint(rd,6),dParamLoStop,0.0)
dJointSetHingeParam(RDJoint(rd,6),dParamHiStop,2.0)

; ### Left Leg (Upper) To Body (Lower)

RDJoint(rd,7)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,7),LLegU(rd),BodyL(rd))
dJointSetHingeAxis(RDJoint(rd,7),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,7),xp+1,yp-2.75,zp)
dJointSetHingeParam(RDJoint(rd,7),dParamLoStop,-1.0)
dJointSetHingeParam(RDJoint(rd,7),dParamHiStop,1.0)

; ### Left Leg (Lower) To Left Leg (Upper)

RDJoint(rd,8)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,8),LLegL(rd),LLegU(rd))
dJointSetHingeAxis(RDJoint(rd,8),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,8),xp+1,yp-4.25,zp)
dJointSetHingeParam(RDJoint(rd,8),dParamLoStop,-2.0)
dJointSetHingeParam(RDJoint(rd,8),dParamHiStop,0.0)

; ### Right Leg (Upper) To Body (Lower)

RDJoint(rd,9)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,9),RLegU(rd),BodyL(rd))
dJointSetHingeAxis(RDJoint(rd,9),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,9),xp-1,yp-2.75,zp)
dJointSetHingeParam(RDJoint(rd,9),dParamLoStop,-1.0)
dJointSetHingeParam(RDJoint(rd,9),dParamHiStop,1.0)

; ### Right Leg (Lower) To Right Leg (Upper)

RDJoint(rd,10)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,10),RLegL(rd),RLegU(rd))
dJointSetHingeAxis(RDJoint(rd,10),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,10),xp-1,yp-4.25,zp)
dJointSetHingeParam(RDJoint(rd,10),dParamLoStop,-2.0)
dJointSetHingeParam(RDJoint(rd,10),dParamHiStop,0.0)

; ### Left Foot To Left Leg (Lower)

RDJoint(rd,11)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,11),LFoot(rd),LLegL(rd))
dJointSetHingeAxis(RDJoint(rd,11),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,11),xp+1,yp-5.5,zp)
dJointSetHingeParam(RDJoint(rd,11),dParamLoStop,-0.25)
dJointSetHingeParam(RDJoint(rd,11),dParamHiStop,0.25)

; ### Right Foot To Right Leg (Lower)

RDJoint(rd,12)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,12),RFoot(rd),RLegL(rd))
dJointSetHingeAxis(RDJoint(rd,12),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,12),xp-1,yp-5.5,zp)
dJointSetHingeParam(RDJoint(rd,12),dParamLoStop,-0.25)
dJointSetHingeParam(RDJoint(rd,12),dParamHiStop,0.25)

End Function
Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
;	If dBodyIsEnabled(ode\body)
		RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
		PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
;		End If
Next

End Function

; ###################################################################################################
Function set_object_friction(obj.ODEGeom,friction#,weight)
	friction=friction/100
	friction=friction
	friction=friction*4
	friction=4-friction
	e#=Log10(weight*10)
	e=e-friction
	e=1*(10^e)
	dGeomContactSetMu(obj\geom,e)
End Function

; ###################################################################################################
Function LinearDamp(body,damp#)
  dBodyAddForce body,dBodyGetLinearVelX(body)*-damp,dBodyGetLinearVelY(body)*-damp,dBodyGetLinearVelZ(body)*-damp
End Function
; ###################################################################################################

Function AngularDamp(body,damp#)
  dBodyAddTorque body,dBodyGetAngularVelX(body)*-damp,dBodyGetAngularVelY(body)*-damp,dBodyGetAngularVelZ(body)*-damp
End Function
; ###################################################################################################
Function JointLimits(body,limit#)

For ode.ODEGeom=Each ODEGeom
	If dGeomIsEnabled(ode\geom)
		If body=ode\body  ; specific body parts only
			numjoints=dBodyGetNumJoints(ode\body)
			If numjoints&gt;0 
				For joints=0 To numjoints-1
					joint=dBodyGetJoint(ode\body,joints)
						If joint&lt;&gt;0 ; valid joints only
							If dJointGetType(joint)&lt;&gt;dJointTypeContact
									; Get Force vector
									dBodyGetForce(joint)
								  	fx#=dVectorX()
								  	fy#=dVectorY()
								    fz#=dVectorZ()
								  	; Calculate magnitude
									ForceF#=Sqr(fx*fx+fy*fy+fz*fz)

								
									; Get Torque vector
									dBodyGetTorque(joint)
								  	fx#=dVectorX()
								  	fy#=dVectorY()
								    fz#=dVectorZ()
									; Calculate magnitude
									ForceT#=Sqr(fx*fx+fy*fy+fz*fz)

								
								; Check to see if joint limit exceeded
								If Abs(ForceF#)&gt;limit Or Abs(ForceT#)&gt;limit Then
									dJointAttach(joint,0,0)
									
									; Reduce body part energy due to break
									If ForceA&gt;.01
										LinearDamp(ode\body,.04)
									End If 
									
									If ForceB&gt;.01
										AngularDamp(ode\body,.04)
									End If
									
								End If
								
			
							End If

					End If
				Next
			End If
		End If
	End If
Next

End Function

; ###################################################################################################

Function UpdateFriction()

For ode.ODEGeom=Each ODEGeom
	; add friction force if body enabled  
	If dBodyIsEnabled(ode\body) And ode\body&lt;&gt;Car
		numjoints=dBodyGetNumJoints(ode\body)
		If numjoints&gt;0 
		;DebugLog "joints=" + Str(joints)
			For joints=0 To numjoints-1
				joint1=dBodyGetJoint(ode\body,joints)
				If dJointGetType(joint1)=dJointTypeContact
					
					; Get linear velocity vector
			  		ax#=dBodyGetLinearVelX#(ode\body)
			  		ay#=dBodyGetLinearVelY#(ode\body)
				    az#=dBodyGetLinearVelZ#(ode\body)
				
					; Get Angular velocity vector
			  		bx#=dBodyGetAngularVelX#(ode\body)
			  		by#=dBodyGetAngularVelY#(ode\body)
					bz#=dBodyGetAngularVelZ#(ode\body)
					
			  		; Calculate magnitudes
					ForceA#=Sqr(ax*ax+ay*ay+az*az)
					ForceB#=Sqr(bx*bx+by*by+bz*bz)
					
					If ForceA&gt;.01
						LinearDamp(ode\body,.04)
					End If
					
					If ForceB&gt;.01
						AngularDamp(ode\body,.04)
					End If
					
						
				End If
			Next
		End If
	End If
Next

End Function
</textarea> <br><br></td></tr></table><br>
<a name="618068"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Alienforce</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#164">[#164]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wow! Great Wayne! <br><br></td></tr></table><br>
<a name="618077"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#165">[#165]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hehe, excellent stuff :)<br><br>Imagine how much fun it would be to line a few of those breakable RagDolls up and blow them all to pieces with some heavy weaponry! <br><br></td></tr></table><br>
<a name="619155"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#166">[#166]</a></td></tr></table></td></tr><tr ><td class="posttext"> Update:<br><br>I've got the dJointSetFeedback() / dJointGetFeedback() functions working well in JV-ODE now. The new functions will return all force and torque data for each axis of a joint via the JV-ODE Vector Functions. Feedback will be enabled on every joint by default, but it can be disabled thus having no impact on speed and memory if joint feedback is not required.<br><br>Coming soon in V1.11 :) <br><br></td></tr></table><br>
<a name="619166"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#167">[#167]</a></td></tr></table></td></tr><tr ><td class="posttext"> wow, great stuff Viper ! <br>I'm looking forward to seeing that addition.<br><br>I would think the default should be 'feedback disabled' and thus not effect any of the demos or current working in progress. Advanced users who need this function could turn it on knowing the memory and speed impact.<br><br>JV-ODE Just gets better every day. Thanks VIP3R! <br><br></td></tr></table><br>
<a name="619285"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#168">[#168]</a></td></tr></table></td></tr><tr ><td class="posttext"> Cheers Wayne :)<br><br>I agree, it might be best to disable joint feedback by default. I'm thinking about adding dJointSetFeedbackMode() and dJointGetFeedbackMode() functions. When set to '0' (disabled - default), no joints will have feedback (as it is now). When set to '1' (enabled), all joints will have feedback by default. If enabled, you would still be able to disable individual joints using the dJointSetFeedback() function. From the testing I've done, the impact on speed and memory would be unnoticeable in most cases, of course it's all relative to the quantity of joints in the simulation.<br><br>:) <br><br></td></tr></table><br>
<a name="619388"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#169">[#169]</a></td></tr></table></td></tr><tr ><td class="posttext"> Update:<br><br>After more testing I've decided to scrap the default joint feedback idea using dJointSetFeedbackMode() and dJointGetFeedbackMode(). It would be much better to enable or disable joint feedback on any individual joint, at any time during the simulation. The new dJointFeedbackEnable(joint) and dJointFeedbackDisable(joint) functions will allow you to retrieve joint feedback as needed.<br><br>I'll also be adding a dJointFeedbackIsEnabled(joint) function to return whether feedback is currently enabled or disabled on an individual joint.<br><br>There will be a modified car demo to show the Joint Feedback functions being used to return force and torque data from the wheel joints. <br><br></td></tr></table><br>
<a name="619391"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#170">[#170]</a></td></tr></table></td></tr><tr ><td class="posttext"> I agree VIP3R as it gives us more control of the simulation.<br>The joint forces should be interesting , i'm looking forward to it. <br><br></td></tr></table><br>
<a name="619462"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ZJP</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#171">[#171]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>Great job Wayne. Now you are ready for a "car crash-test demo". :)<br><br>LOL <br><br></td></tr></table><br>
<a name="621454"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#172">[#172]</a></td></tr></table></td></tr><tr ><td class="posttext"> <b>JV-ODE V1.11 Update Released</b><br><br>Please check your inbox :)<br><br>The new update includes:<br><br>Added new joint feedback functions...<br><br>dJointFeedbackEnable(joint)<br>dJointFeedbackDisable(joint)<br>dJointFeedbackIsEnabled(joint)<br>dJointSetFeedback(joint,feedback)<br>dJointGetFeedbackForce1(joint)<br>dJointGetFeedbackTorque1(joint)<br>dJointGetFeedbackForce2(joint)<br>dJointGetFeedbackTorque2(joint)<br><br>Added new demos...<br><br>Demo-RagDolls (Update)<br>Demo-RagDolls-Zombie<br>CarDemo-JointFeedback<br><br>Don't forget to update your 'JV-ODE.decls' file in the Blitz3D Userlibs folder!<br><br>Please let me know if you experience any problems with the new update.<br><br>:) <br><br></td></tr></table><br>
<a name="621596"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hambone</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#173">[#173]</a></td></tr></table></td></tr><tr ><td class="posttext"> I know JV-ODE is primarily being used in Blitz3d. However, It states on the web page that it can be used with any compiler that supports dll's.<br><br>Anybody try it with iBasic, Purebasic ,Darkbasic or VB6 etc ...?<br><br>I am curious because I need a physics engine for a vb6/truevision3d 6.2 app and if this will work I will buy it asap.  It would be nice to have a one stop for physics regardless of which environment  I am tasked to use :)<br><br>Thanks,<br><br>Allan <br><br></td></tr></table><br>
<a name="621611"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#174">[#174]</a></td></tr></table></td></tr><tr ><td class="posttext"> All functions in JV-ODE use the _stdcall calling convention. Providing that those languages can successfully transfer and handle the data (essentially floats and ints) from the DLL, then JV-ODE should work with them. I do not currently have access to any of the above languages, so it's not something I've tested personally. When JV-ODE was first created, Jedive attempted to create a .dba(?) file for DarkBasic but IIRC he didn't have much spare-time/luck with it.<br><br>To find out if you can use JV-ODE in the desired language, you need to create a function declaration file for the 'demo version' of the DLL (like the .decls file in Blitz3D). If the demo version works, there's no reason why the full version wouldn't. All the info you need to do this should be contained within the 'JV-ODE.decls' file. If the language doesn't use a declaration file like Blitz and DB, you would probably need to use a similar method to the one BlitzMax uses. There's an example of this above (posted by Chris C).<br><br>In the full version, you will of course need to add and convert the 'JV-ODE.bb' include file, especially if you need access to the TriMesh functions.<br><br>I'll help with the technical stuff if anyone would like to take a shot at it. <br><br></td></tr></table><br>
<a name="622405"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ZJP</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#175">[#175]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>To VIP3R. Nothing in my inbox. :-(<br><br><br><br>Zali Jean-Pierre at zali@...<br>Share-it ref : rf. : 33791435 <br><br></td></tr></table><br>
<a name="622414"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#176">[#176]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi ZJP,<br><br>Your email server is refusing to accept it...<br><br><div class="quote"> <br>This message was created automatically by mail delivery software.<br><br>A message that you sent could not be delivered to one or more of<br>its recipients. The following addresses failed:<br><br>  &lt;ZALI...removed&gt;<br><br>SMTP error from remote server in greeting:<br>host mail.cgit.com[194...removed]:<br>501 Le domaine doit tre rsolu<br> <br></div><br>...do you have another address? <br><br></td></tr></table><br>
<a name="622456"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Danny</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#177">[#177]</a></td></tr></table></td></tr><tr ><td class="posttext"> Greetings,<br><br>I got ODE this morning and already forgot about 3 painfull years of tokamak! ;)<br><br>I've been having tremendous success with ODE so far, really cool and quick results!<br><br>Got one problem though (only one?), I'm use a trimesh (to replace my 'StaticMesh') for my static scene. But for some reason I have a problem for bodies to 'come to rest' on it. Most of the time they keep bobbing around, or jittering (millimeters) and most of the time refuse to auto-disable themselves. Especially when I've got e.g. two boxes stacked ontop of each other, they keep bouncing between themselves (very minute). As if they keep trying to sink through the floor.<br><br>I'm using normal scale models (box = 1 cubic unit, mass=1). Got all the bounce parameters to 0.1, world friction to 80, world erp at 0.2. <br>And just like in the CarDemo-TriMesh-Cube.bb. I use two spaces, one for the staticmesh/trimesh's, and one for the objects (simple boxes). But for some reason my boxes won't relax!... :(<br><br>Any hints on what to tweak?<br><br>cheers,<br>Danny <br><br></td></tr></table><br>
<a name="622459"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#178">[#178]</a></td></tr></table></td></tr><tr ><td class="posttext"> Welcome aboard Danny :)<br><br>Try this function after creating your ODE World with dWorldCreate()...<br><br><i>dWorldSetContactSurfaceLayer(World,0.1)</i><br><br>...raising the value will reduce jitters and lowering it will increase jitters (it's 0.0 by default). <br><br></td></tr></table><br>
<a name="622667"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#179">[#179]</a></td></tr></table></td></tr><tr ><td class="posttext"> Welcome Danny,<br>My self I like to take command of the objects with these:<br><br>dWorldSetAutoDisableFlag (World, 1)<br><br><br>dBodySetAutoDisableFlag(ode\body,1)<br><br>; Set the value where you want object to go quiet.<br>dBodySetAutoDisableAngularThreshold(ode\body,.05)<br>dBodySetAutoDisableLinearThreshold(ode\body,.05)<br><br>; Set how fast you want to settle on the threshold 1-Fast, 2-n allow more settle time.<br>dBodySetAutoDisableSteps (ode\body, 1) <br><br></td></tr></table><br>
<a name="622959"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Danny</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#180">[#180]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Wayne &amp; Vip3r,<br><br>Yes I've been playing with those settings as well. With reasonable luck. The SurfaceLayer function Vip3r mentions does sort of work, but seriously (!) eats away accuracy (0.1 would mean I lose 10cm's of detail / objects will sink into the floor comfortably). I can't afford that.<br><br>Also, when using trimesh's I also notice when bodies fall on the (trimesh-)floor, that they easily sink into it for a little bit/intersect as if falling on soft foam before coming back up to their proper level... :(<br><br>But regardless of those settings/functions, I still have trouble to 'relax' bodies that are stacked on top of each other... I'll post a little demo in a minute that I made with broken tables. (I'll use a new thread - I think it's time to put this one to bed (again) ;))<br><br>cheers,<br>Danny <br><br></td></tr></table><br>
<a name="622971"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#181">[#181]</a></td></tr></table></td></tr><tr ><td class="posttext"> The '0.1' was an example figure, you need to gradually increase/test it from '0.0' to get a good compromised value. In the TriMesh-Cube car demo, a value of '0.001' will prevent the jitter effect.<br><br>Regarding the sinking geometry, a few things can cause those kind of problems.<br><br>The usual suspects are:<br><br>The TriMesh triangles are too large (compared to colliding object)<br>Adding too little mass to an object (not enough density)<br>Adding too much mass to an object<br>ERP contact setting<br>CFM contact setting<br>dWorldQuickStep() step size is too large<br><br>You can also try changing the max contacts setting with dContactSetMaxContacts(max) and see if that helps, the default value is 128. <br><br></td></tr></table><br>
<a name="623204"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Danny</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#182">[#182]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for that Vip3r,<br><br>I keep playing and tweaking and slowly things are becomming more clear - and more predictable! There's just too many functions to play with and absorb all at once ;)<br><br>...need to break more tables... <br><br></td></tr></table><br>
<a name="623230"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ZJP</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#183">[#183]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>TO VIP3R ;-)<br>New mail address : prisme99@...<br>Thanks for the release<br><br>Jean-Pierre<br><br>So, any suggestions to drive these models <a href="http://www.3drt.com/3dm/drop-ship/d-ship-shots.htm" target="_blank">http://www.3drt.com/3dm/drop-ship/d-ship-shots.htm</a><br>I'm working on a flying simulator. <br><br></td></tr></table><br>
<a name="623239"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#184">[#184]</a></td></tr></table></td></tr><tr ><td class="posttext"> Email sent and you're welcome :)<br><br>Do you want me to use the new address for future updates? <br><br></td></tr></table><br>
<a name="623693"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ZJP</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#185">[#185]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br>To VIP3R<br><br>Update ok. You can use this address now. Sorry, poor english, french people. ;-)<br><br>JP <br><br></td></tr></table><br>
<a name="624566"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#186">[#186]</a></td></tr></table></td></tr><tr ><td class="posttext"> @ZJP: No problem, your new email address will receive future update notifications :)<br><br><br>Here's a modified car demo which uses Ball/AMotor Joints for the rear wheels. It's another method which can be applied to prevent the infamous wobbly rear wheel problem. In the demo the rear wheels have no suspension when using these two joints, I'm not sure if it's possible without resorting to adding separate suspension units. Most importantly it gives everyone some idea of how the AMotor can be used.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #										  JV-ODE Car Demo											#
; #									Code by Jim Williams (VIP3R)									#		#
; #						Feel free to use this code, any credit appreciated							#
; ###################################################################################################

AppTitle "JV-ODE Car Demo - AMotor"

Include "JV-ODE.bb"

Graphics3D 800,600,0,2

Global CMass#=200			; ### Car Mass
Global WMass#=14			; ### Wheel Mass

Global WorldERP#=0.8		; ### World Error Correction
Global WorldFriction#=70	; ### World Friction

Global Torque#=24			; ### Joint Torque
Global SuspensionHS#=0.01	; ### Suspension Hardness/Softness (Higher=Softer - Lower=Harder)

Global Force#=0
Global Steer#=0

Global Car
Global CGeom
Global CMesh

Global CarStartY=20

Dim Wheel(4)
Dim WGeom(4)
Dim Joint(4)

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

; ###################################################################################################

; ### Setup ODE

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,-0.98,0)
dWorldSetERP(World,WorldERP)

dContactSetMode(dContactSlip1)
dContactSetMu(WorldFriction)

; ### Create car body

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
Car=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,0,CarStartY,0)
mass=dMassCreate()
dMassSetBoxTotal(mass,CMass,3,1,4)
dMassTranslate(mass,0,-1,0)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
ode\geom=dCreateBox(Space,3,1,4)
CGeom=ode\geom
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
CMesh=ode\mesh
ScaleMesh ode\mesh,1.5,0.5,2
RotateMesh ode\mesh,0,0,0
PositionMesh ode\mesh,0,0,0
EntityColor ode\mesh,40,80,255
EntityAlpha ode\mesh,1

; ### Create wheels

For count=1 To 4
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	Wheel(count)=ode\body
	dBodySetRotation(ode\body,0,0,0)
	dBodySetPosition(ode\body,0,0,0)
	mass=dMassCreate()
	dMassSetSphereTotal(mass,WMass,0.7)
	dBodySetMass(ode\body,mass)
	dMassDestroy(mass)
	ode\geom=dCreateSphere(Space,0.7)
	WGeom(count)=ode\geom
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder(8)
	ScaleMesh ode\mesh,0.7,0.25,0.7
	RotateMesh ode\mesh,0,0,90
	PositionMesh ode\mesh,0,0,0
	EntityColor ode\mesh,255,255,255
Next

dBodySetPosition(Wheel(1),-2,CarStartY-0.5,+2)
dBodySetPosition(Wheel(2),+2,CarStartY-0.5,+2)
dBodySetPosition(Wheel(3),-2,CarStartY-0.5,-2)
dBodySetPosition(Wheel(4),+2,CarStartY-0.5,-2)

; ### Create some objects

SeedRnd MilliSecs()

For spheres=1 To 20
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	dBodySetRotation(ode\body,0,0,0)
	dBodySetPosition(ode\body,Rnd(-100,100),30,Rnd(-100,100))
	ode\geom=dCreateSphere(Space,4)
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateSphere()
	ScaleMesh ode\mesh,4,4,4
	RotateMesh ode\mesh,0,0,0
	PositionMesh ode\mesh,0,0,0
	EntityColor ode\mesh,Rnd(255),Rnd(255),Rnd(255)
	EntityAlpha ode\mesh,1
	EntityShininess ode\mesh,0.7
Next

For cylinders=1 To 20
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	dBodySetRotation(ode\body,90,0,0)
	dBodySetPosition(ode\body,Rnd(-100,100),30,Rnd(-100,100))
	ode\geom=dCreateCCylinder(Space,1,8)
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder(8)
	ScaleMesh ode\mesh,1,5,1
	RotateMesh ode\mesh,90,0,0	; &lt;&lt;&lt; Mesh X-Axis must be rotated 90 degrees to fix cylinder alignment
	PositionMesh ode\mesh,0,0,0
	EntityColor ode\mesh,Rnd(255),Rnd(255),Rnd(255)
	EntityAlpha ode\mesh,1
	EntityShininess ode\mesh,0.7
Next

; ### Create light

Global Light=CreateLight()

RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera

Global CameraPivot=CreatePivot(CMesh)
PositionEntity CameraPivot,0,2,-7

Global Camera=CreateCamera()
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000

; ### Create plane

dCreatePlane(Space,0,1,0,0)

Plane=CreatePlane()

EntityAlpha Plane,0.8

PlaneTexture=CreateTexture(128,128,9)

ClsColor 0,200,80
Cls

Color 255,255,255

Rect 0,0,64,64,1
Rect 64,64,64,64,1

CopyRect 0,0,128,128,0,0,BackBuffer(),TextureBuffer(PlaneTexture)
ScaleTexture PlaneTexture,20,20
EntityTexture Plane,PlaneTexture,0,0

Mirror=CreateMirror()

; ###################################################################################################

; ### BLITZ STATIC OBJECT (White)

blitzobject=CreateCube()
ScaleMesh blitzobject,1,4,20
RotateMesh blitzobject,-10,8,4
PositionMesh blitzobject,10,5,40

EntityColor blitzobject,255,255,255
EntityAlpha blitzobject,1

; ### ODE STATIC OBJECT (Blue)

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,2,8,40)
dGeomSetRotation(ode\geom,-10,8,4)
dGeomSetPosition(ode\geom,20,5,40)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,1,4,20
RotateMesh ode\mesh,0,0,0
PositionMesh ode\mesh,0,0,0

EntityColor ode\mesh,0,100,200
EntityAlpha ode\mesh,1

; ### ODE STATIC OBJECT (Red)

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,18,0.2,40)
dGeomSetRotation(ode\geom,-14,0,0)
dGeomSetPosition(ode\geom,-20,4.9,40)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,9,0.1,20
RotateMesh ode\mesh,0,0,0
PositionMesh ode\mesh,0,0,0

EntityColor ode\mesh,200,0,100
EntityAlpha ode\mesh,1

; ###################################################################################################

SetupCar()

While Not KeyHit(1)

	UpdateKeys()

	PTime=MilliSecs()

	UpdateCar()

	UpdateGeoms()

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)

	PhysicsTime#=MilliSecs()-PTime

	UpdateCam()

	UpdateWorld

	RenderWorld

	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime
	Text 0,50,"Force:"+Force
	Text 0,65,"Torque:"+Torque
	Text 640,0,"A - Accelerate"
	Text 640,15,"Z - Brake/Reverse"
	Text 640,30,"Arrows - Steering"
	Text 640,45,"Space - Reset Car"

	Flip

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function SetupCar()

For count=1 To 2
	Joint(count)=dJointCreateHinge2(World,0)
	dJointAttach(Joint(count),Car,Wheel(count))
	dJointSetHinge2Anchor(Joint(count),dBodyGetPositionX(Wheel(count)),dBodyGetPositionY(Wheel(count)),dBodyGetPositionZ(Wheel(count)))
	dJointSetHinge2Axis1(Joint(count),0,1,0)
	dJointSetHinge2Axis2(Joint(count),-1,0,0)
	dJointSetHinge2Param(Joint(count),dParamSuspensionERP,0.8)
	dJointSetHinge2Param(Joint(count),dParamSuspensionCFM,SuspensionHS)
Next

For count=3 To 4
	Joint(count)=dJointCreateBall(World,0)
	dJointAttach(Joint(count),Car,Wheel(count))
	dJointSetBallAnchor(Joint(count),dBodyGetPositionX(Wheel(count)),dBodyGetPositionY(Wheel(count)),dBodyGetPositionZ(Wheel(count)))
	Joint(count)=dJointCreateAMotor(World,0)
	dJointAttach(Joint(count),Car,Wheel(count))
	dJointSetAMotorMode(Joint(count),dAMotorEuler)
	dJointSetAMotorAxis(Joint(count),0,0,0,0,0)
	dJointSetAMotorAxis(Joint(count),1,0,0,0,0)
	dJointSetAMotorAxis(Joint(count),2,0,0,0,1)
	dJointSetAMotorParam(Joint(count),dParamLoStop,-4)
	dJointSetAMotorParam(Joint(count),dParamHiStop,4)
	dJointSetAMotorParam(Joint(count),dParamLoStop2,0)
	dJointSetAMotorParam(Joint(count),dParamHiStop2,0)
	dJointSetAMotorParam(Joint(count),dParamLoStop3,0)
	dJointSetAMotorParam(Joint(count),dParamHiStop3,0)
Next

Force=0

End Function

; ###################################################################################################

Function UpdateKeys()

If KeyDown(30)=1
	Force=Force+0.08
	If Force&gt;70 Then Force=70
	End If

If KeyDown(44)=1
	Force=Force-0.1
	If Force&lt;-10 Then Force=-10
	If Force&gt;0 Then Force=Force*0.97
	End If

If KeyDown(30)=0 And KeyDown(44)=0 Then Force=Force*0.99

If KeyDown(203)=1 Or KeyDown(205)=1
	If KeyDown(203)=1
		Steer=0.5
		Else
		Steer=-0.5
		End If
	Else
	Steer=0
	End If

If KeyHit(57)=1
	Force=0
	dBodySetRotation(Car,dGeomGetPitch#(CGeom),dGeomGetYaw#(CGeom),0)
	End If

End Function

; ###################################################################################################

Function UpdateCar()

For count=1 To 4
	dBodyEnable(Wheel(count))
Next

dBodyEnable(Car)

For count=1 To 2
	dJointSetHinge2Param(Joint(count),dParamVel2,Force)
	dJointSetHinge2Param(Joint(count),dParamFMax2,Torque)
Next

For count=3 To 4
	dJointSetAMotorParam(Joint(count),dParamVel,-Force)
	dJointSetAMotorParam(Joint(count),dParamFMax,Torque)
Next

For count=1 To 2
	angle#=Steer-dJointGetHinge2Angle1(Joint(count))
	dJointSetHinge2Param(Joint(count),dParamVel,angle)
	dJointSetHinge2Param(Joint(count),dParamFMax,400)
Next

End Function

; ###################################################################################################

Function UpdateCam()

PositionEntity CameraPivot,0,3,-12

camx#=EntityX(CameraPivot,1)-EntityX(Camera)
camy#=EntityY(CameraPivot,1)-EntityY(Camera)
camz#=EntityZ(CameraPivot,1)-EntityZ(Camera)

TranslateEntity Camera,camx*0.5,camy*0.5,camz*0.5

PointEntity Camera,CMesh

End Function

; ###################################################################################################

Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
	RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
	PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
Next

End Function

; ###################################################################################################
</textarea> <br><br></td></tr></table><br>
<a name="624586"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ZJP</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#187">[#187]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi everyone,<br><br>Some ideas to "flying" a cube like an elicopter ?<br><br>JP <br><br></td></tr></table><br>
<a name="624630"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#188">[#188]</a></td></tr></table></td></tr><tr ><td class="posttext"> Apply a relative velocity to body pointing in the body's Y direction (or whatever you have as up). Vary the size of the force to vary lift. Tilting the cube will divert some of that force to forward momentum. Just like a real chopper!<br><br>You'd need to add some resistance though so when you start moving forwards, you gradually decelerate when the 'helicopter' is level and the force is only providing lift.<br><br>For controllers, you'll need rotor-speed (force value), pitch, and roll, and maybe yaw if you're feeling adventurous. <br><br></td></tr></table><br>
<a name="624657"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Alienforce</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#189">[#189]</a></td></tr></table></td></tr><tr ><td class="posttext"> Does someone have some JV-ODE code for cardriving like the "VERLE CAR". I think the car demos for JV-ODE is really good for simulation but i dont get the "player/game friendly" feeling. This is no criticism i just need some more "fiendly" code for a kids game. <br><br></td></tr></table><br>
<a name="624740"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#190">[#190]</a></td></tr></table></td></tr><tr ><td class="posttext"> You should be able to setup a JV-ODE car with a very similar feeling. Although, which car do you mean? There are several different cars in the VERLE demo :)<br><br>JV-ODE is not much different to the physics engines in games like GTA3. Endless different types of vehicle handling can be achieved by altering the mass, suspension, wheelbase, grip, torque, gear ratios, FWD/RWD/4WD transmission etc.<br><br>The problem here is perspective, can you describe what aspects of the handling in the VERLE demo you like the feel of? <br><br></td></tr></table><br>
<a name="624752"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Alienforce</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#191">[#191]</a></td></tr></table></td></tr><tr ><td class="posttext"> I will give it one more try and then post my code and maybe get some feedback/help :) <br><br></td></tr></table><br>
<a name="625057"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#192">[#192]</a></td></tr></table></td></tr><tr ><td class="posttext"> Strangely and surprisingly, there appears to be no SetRelativeVelocity for bodies. Is the option to set linear velocity only global? Bit of a pain, but I can (theoretically) transform an absolute force into relative based on the direction the Blitz mesh is pointing.<br><br>Edit : I've just found dBodyVectorToWorld() which does the job, though it is surprising there's no Relative speed option. <br><br></td></tr></table><br>
<a name="625075"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#193">[#193]</a></td></tr></table></td></tr><tr ><td class="posttext"> <b>THREAD 5 IS ABOUT TO CLOSE</b><br><br>Getting a bit long now ;)<br><br>Please continue on the new thread located <a href="/posts.php?topic=56209" target="_blank">here</a><br><br>Thanks :) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
