<!DOCTYPE html><html lang="en" ><head ><title >JV-ODE Physics Wrapper</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >JV-ODE Physics Wrapper</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=94" >Blitz3D Userlibs</a>/<a href="#bottom" >JV-ODE Physics Wrapper</a><br><br>
<a name="487238"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> The JV-ODE user library contains almost all of the ODE functions wrapped inside a DLL.<br><br>The library can be used in any programming language that supports DLL's, including Blitz3D and BlitzPlus. The functions have been adapted to use euler angles (the same coordinate system as Blitz3D), however functions for accessing quaternion angles are also included. The download contains all of the necessary files to get you started, including some simple demos showing various ODE objects and TriMesh collisions.<br><br>To view more information and screenshots <a href="http://www.devcode.co.uk/jv-ode.html" target="_blank">click here</a>.<br><br>Options are now available to purchase the wrapper using either PayPal or Share*it.<br><br>The <b>restricted demo version</b> is now available for download <a href="http://www.devcode.co.uk/dload/JV-ODE-Physics-Demo.zip" target="_blank">here</a>.<br><br>Have Fun :)<br><br>Useful Links: <a href="http://www.ode.org/" target="_blank">ODE.org Website</a> - <a href="http://www.ode.org/ode-latest-userguide.pdf" target="_blank">ODE User Guide (PDF)</a> - <a href="http://www.ode.org/ode-latest-userguide.html" target="_blank">ODE User Guide (HTML)</a> - <a href="http://q12.org/pipermail/ode/" target="_blank">ODE Archives</a> <br><br></td></tr></table><br>
<a name="487255"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'll send out the new wrapper tonight to all existing users in the user list that Jedive sent me.<br>[edit] * New wrappers have now been sent to all users on my user list. Check your inbox :) * <br><br></td></tr></table><br>
<a name="487304"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RepeatUntil</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Could you show some demos?? (with an executable) <br><br></td></tr></table><br>
<a name="487306"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm going to talk with Jedive and see if we can make a restricted dll for demo purposes.<br><br>I've been a bit busy getting the wrapper up to speed lately, so I haven't had chance just yet ;) <br><br></td></tr></table><br>
<a name="487323"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> VIP3R, How about creating a demo package on the web site with the following:<br><br>B3d Demo program sources<br>B3d Demo program executables<br>ode.dll<br><br>That would fit with the license and give people a quick first look. Besides cylinders needs your attention.<br>8) <br><br></td></tr></table><br>
<a name="487328"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JaviCervera</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> The user list I sent you contains all the JediveODE users, so I don't need to send it to anyone else.<br><br>About the demo, I'll contact you this afternoon, Viper (I just have to go to make an exam).<br><br>I'll have a few relaxed days, so I'll add a few things to the lib for the next update. I want to change some things in collision code, so each geom can have it's own bounce, cfm, erp, etc, parameters. <br><br></td></tr></table><br>
<a name="487329"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Jedive: Ok, no problem - Good luck! :)<br><br>@Wayne: Is this a new cylinders issue or a known one? <br><br></td></tr></table><br>
<a name="487339"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Alienforce</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> JEDIVE and VIP3R: Thank you for a great job...<br><br>/Alienforce <br><br></td></tr></table><br>
<a name="487351"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >flying willy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nice ideas jedive :)<br><br>There is a bug though! cubes and trimesh: cubes fall through the trimesh often. The cube parameters are the same as in your other demo....<br><br>Spheres are ok with trimesh. <br><br></td></tr></table><br>
<a name="487358"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Your welcome Alienforce :)<br><br>Thanks for the feedback Flying ;)<br><br>Hint for everyone: look at the known issues at the top of the thread... <br><br></td></tr></table><br>
<a name="487373"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >flying willy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Viper.<br><br>*feature request* it is necessary in a lot of circumstances - such as a snooker game, to get a list of other bodies we have collided with. These could just be the body handles if you like.<br><br>Somehow, you'll need to query a list per object. For example the wrong ball is hit in Pool.<br><br>I have no idea how you'll do this, but you could possibly make this constant by using SetMaxContacts as a guide.<br><br>For example the programmer could then make a bank for each object, and that bank will be filled with a GetCollisions(bank,rigidbody) command...<br><br>And then it will be a list of int handles to each rigid body which collided with us. This is a powerful way to quickly build a list without callbacks. <br><br></td></tr></table><br>
<a name="487385"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JaviCervera</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok flying. As I am extending the collision system, I'll add what you are requesting too, no problem. <br><br></td></tr></table><br>
<a name="487389"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >flying willy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thank you very much :) <br><br></td></tr></table><br>
<a name="487417"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wayne posted a nifty little addition to the UpdateGeoms() function in the old thread which will help optimise it, so I thought I'd pop it in here where it belongs.<br><br>I've had to edit it a little though as it needs to detect enabled geoms not body/meshes.<br><br>Cheers Wayne :)<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
	If dGeomIsEnabled(ode\geom)
		RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
		PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
	End If
Next

End Function
</textarea><br>Don't forget to activate the auto disable feature when using this. <br><br></td></tr></table><br>
<a name="487418"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >flying willy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Have you noticed spheres falling through meshes or behaving weirdly? <br><br></td></tr></table><br>
<a name="487419"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Not falling through meshes, but if they are created 'inside' a TriMesh they will shoot off like a rocket when they collide with it.<br><br>Can you describe the problem you're getting? <br><br></td></tr></table><br>
<a name="487431"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >flying willy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> They tend to fall through it. Or react strangely, but I cannot tell if thats bad ode settings or the wrapper so I'll keep trying in the meantime...<br><br>Also, do you have functions for AngularDampening and Linear Dampening?<br><br>Function LinearDamp(body,damp#)<br>	dBodyAddForce body,dBodyGetLinearVelX(body)*-damp,dBodyGetLinearVelX(body)*-damp,dBodyGetLinearVelX(body)*-damp<br>End Function<br>Thats one I made up, which seems to damp but the result is incorrect as it will eventually go in a straight line!<br><br>Tokamak has angular and linear dampening and I'm wondering how to make this happen in ODE... <br><br></td></tr></table><br>
<a name="487447"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Try playing around with the mass settings of your spheres.<br><br>I've not played around with dampening yet, but I think you can use ERP and CFM to control it on individual bodies in ODE. Check the 'Concepts' chapter of the ODE User Guide for more info about this.<br><br>Jedive is going to add the ability to control these on a per body basis, so you should be able to do this soon.<br><br>Are you designing a snooker/pool game then? <br><br></td></tr></table><br>
<a name="487490"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >flying willy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've done pool/snooker games in Blitz3D before and I want to do it as a learning exercise. Then I'll progress to a puzzle game involving physics that I have in mind. Maybe! :)<br><br>Correct me if I'm mistaken, but CFM and ERP won't enable a ball to roll to a stop. <br><br></td></tr></table><br>
<a name="487520"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> Rolling Friction Or Aerodynamic Drag<br><br><a href="http://q12.org/cgi-bin/wiki.pl?RollingFrictionOrAerodynamicDrag" target="_blank">http://q12.org/cgi-bin/wiki.pl?RollingFrictionOrAerodynamicDrag</a> <br><br></td></tr></table><br>
<a name="487524"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >flying willy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Wayne - thats what my function above is supposed to do but I'm probably missing something ...<br><pre class=code>Function LinearDamp(body,damp#)
dBodyAddForce body,dBodyGetLinearVelX(body)*-damp,dBodyGetLinearVelX(body)*-damp,dBodyGetLinearVelX(body)*-damp
End Function</pre> <br><br></td></tr></table><br>
<a name="487542"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> Willy, I see your cut and pasting is causing you trouble (x,y,z).<br>8)<br><br><pre class=code>
Function LinearDamp(body,damp#)
  dBodyAddForce body,dBodyGetLinearVelX(body)*-damp,dBodyGetLinearVelY(body)*-damp,dBodyGetLinearVelZ(body)*-damp
End Function
</pre><br><br>ps. Thanks for the code assist VIP3R. <br><br></td></tr></table><br>
<a name="487582"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >flying willy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> LMAO HAHAHAHAHA you're RIGHT :)<br><br>Cor.... hows I miss that? <br><br></td></tr></table><br>
<a name="487597"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >flying willy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> Jedive - perhaps the collision stuff should detect geometry collision instead of rigid body (for trimesh as well etc) <br><br></td></tr></table><br>
<a name="487711"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> dBodyGetForce(ode\body) not loading vectors ??<br><br>I'm using the following code snip:<br>Not dampining angular momentum yet.. 8)<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Function UpdateFriction()

For ode.ODEGeom=Each ODEGeom
	If dGeomIsEnabled(ode\geom)
		numjoints=dBodyGetNumJoints(ode\body)
		If numjoints&gt;0 
		DebugLog "joints=" + Str(joints)
			For joints=0 To numjoints-1
				joint=dBodyGetJoint(ode\body,joints)
				If dJointGetType(joint)=dJointTypeContact
					dBodyGetForce(ode\body)
					ax#=dVectorX#()
					ay#=dVectorY#()
					az#=dVectorZ#()
					DebugLog Str(ax#) + Str(ay#) + Str(az#)
					ForceA#=Sqr(ax*ax+ay*ay+az*az)
					DebugLog Str(ForceA)
					If ForceA&gt;.05
						LinearDamp(ode\body,.05)
					End If
				End If
			Next
		End If
	End If
Next

End Function
</textarea> <br><br></td></tr></table><br>
<a name="487713"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here is all the code in context:<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #									   JV-ODE - Spheres Demo										#
; #									Code by Jim Williams (VIP3R)									#
; ###################################################################################################

AppTitle "JV-ODE - Spheres Demo"

Include "ode.bb"

Graphics3D 800,600,0,2

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

; ###################################################################################################

; ### Setup ODE

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetGravity(World,0,-1,0)
dContactSetMode(dContactBounce)
dContactSetMu(48)

; ### Create light

Global Light=CreateLight()

RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera

Global Camera=CreateCamera()
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000
PositionEntity Camera,0,20,-50
RotateEntity Camera,30,0,0

; ### Create plane

dCreatePlane(Space,0,1,0,0)

Plane=CreatePlane()

EntityAlpha Plane,0.8

PlaneTexture=CreateTexture(128,128,9)

ClsColor 0,200,80
Cls

Color 255,255,255

Rect 0,0,64,64,1
Rect 64,64,64,64,1

CopyRect 0,0,128,128,0,0,BackBuffer(),TextureBuffer(PlaneTexture)
ScaleTexture PlaneTexture,20,20
EntityTexture Plane,PlaneTexture,0,0

Mirror=CreateMirror()

; ###################################################################################################

While Not KeyHit(1)

	PTime=MilliSecs()

	dSpaceCollide(Space,World,ContactGroup)
	
	dWorldQuickStep(World,0.1)
	; Simulate friction by dampening linear motion on impacts
	UpdateFriction
	
	dJointGroupEmpty(ContactGroup)

	If MilliSecs()-Timer&gt;700
		AddObject()
		Timer=MilliSecs()
		End If

	UpdateGeoms()

	PhysicsTime#=MilliSecs()-PTime

	UpdateWorld

	RenderWorld

	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime

	Flip

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function AddObject()

xp=Rand(-8,8)
zp=Rand(-8,8)
ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp,30,zp)
ode\geom=dCreateSphere(Space,3)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateSphere()
ScaleMesh ode\mesh,3,3,3
EntityColor ode\mesh,Rand(255),Rand(255),Rand(255)
EntityAlpha ode\mesh,1
EntityShininess ode\mesh,0.7

End Function

; ###################################################################################################

Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
If dGeomIsEnabled(ode\geom)
	RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
	PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
End If
Next

End Function

; ###################################################################################################

Function LinearDamp(body,damp#)
  dBodyAddForce body,dBodyGetLinearVelX(body)*-damp,dBodyGetLinearVelY(body)*-damp,dBodyGetLinearVelZ(body)*-damp
End Function

; ###################################################################################################

Function UpdateFriction()

For ode.ODEGeom=Each ODEGeom
	If dGeomIsEnabled(ode\geom)
		numjoints=dBodyGetNumJoints(ode\body)
		If numjoints&gt;0 
		DebugLog "joints=" + Str(joints)
			For joints=0 To numjoints-1
				joint=dBodyGetJoint(ode\body,joints)
				If dJointGetType(joint)=dJointTypeContact
					dBodyGetForce(ode\body)
					ax#=dVectorX#()
					ay#=dVectorY#()
					az#=dVectorZ#()
					DebugLog Str(ax#) + Str(ay#) + Str(az#)
					ForceA#=Sqr(ax*ax+ay*ay+az*az)
					DebugLog Str(ForceA)
					If ForceA&gt;.05
						LinearDamp(ode\body,.05)
					End If
				End If
			Next
		End If
	End If
Next

End Function
</textarea> <br><br></td></tr></table><br>
<a name="487782"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> This modified sphere Demo shows one way to do linear and angular damping to simulate friction. <br>I'm sure there are other ways to do this too. <br>Some primitive 3d sound concepts commented out. <br><br>enjoy<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #									   JV-ODE - Spheres Demo										#
; #									Code by Jim Williams (VIP3R)									#
; ###################################################################################################

AppTitle "JV-ODE - Spheres Demo"

Global snd1, piv1


Include "ode.bb"

Graphics3D 800,600,0,2

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

; ###################################################################################################

;snd1=Load3DSound("Bounce.wav")
;piv1=CreatePivot()

; ### Setup ODE

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetGravity(World,0,-1,0)
dContactSetMode(dContactBounce)
dContactSetMu(48)

; Add a little bounce
dContactSetBounce(.3)

; ### Create light

Global Light=CreateLight()

RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera

Global Camera=CreateCamera()
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000

;mic1=CreateListener(camera) ; Create listener, make it child of camera 

PositionEntity Camera,0,20,-50
RotateEntity Camera,30,0,0

; ### Create plane

dCreatePlane(Space,0,1,0,0)

Plane=CreatePlane()

EntityAlpha Plane,0.8

PlaneTexture=CreateTexture(128,128,9)

ClsColor 0,200,80
Cls

Color 255,255,255

Rect 0,0,64,64,1
Rect 64,64,64,64,1

CopyRect 0,0,128,128,0,0,BackBuffer(),TextureBuffer(PlaneTexture)
ScaleTexture PlaneTexture,20,20
EntityTexture Plane,PlaneTexture,0,0

Mirror=CreateMirror()

; ###################################################################################################

While Not KeyHit(1)

	PTime=MilliSecs()

	dSpaceCollide(Space,World,ContactGroup)
	
	dWorldQuickStep(World,0.1)
	; Simulate friction by dampening linear and angular motion on impacts
	UpdateFriction
	
	dJointGroupEmpty(ContactGroup)

	If MilliSecs()-Timer&gt;700
		AddObject()
		Timer=MilliSecs()
		End If

	UpdateGeoms()

	PhysicsTime#=MilliSecs()-PTime

	UpdateWorld

	RenderWorld

	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime

	Flip

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function AddObject()

xp=Rand(-8,8)
zp=Rand(-8,8)
ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp,30,zp)
ode\geom=dCreateSphere(Space,3)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateSphere()
ScaleMesh ode\mesh,3,3,3
EntityColor ode\mesh,Rand(255),Rand(255),Rand(255)
EntityAlpha ode\mesh,1
EntityShininess ode\mesh,0.7

End Function

; ###################################################################################################

Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
If dGeomIsEnabled(ode\geom)
	RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
	PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
End If
Next

End Function

; ###################################################################################################

Function AngularDamp(body,damp#)
  dBodyAddTorque body,dBodyGetAngularVelX(body)*-damp,dBodyGetAngularVelY(body)*-damp,dBodyGetAngularVelZ(body)*-damp
End Function

; ###################################################################################################

Function LinearDamp(body,damp#)
  dBodyAddForce body,dBodyGetLinearVelX(body)*-damp,dBodyGetLinearVelY(body)*-damp,dBodyGetLinearVelZ(body)*-damp
End Function

; ###################################################################################################

Function UpdateFriction()

For ode.ODEGeom=Each ODEGeom
	If dGeomIsEnabled(ode\geom)
		numjoints=dBodyGetNumJoints(ode\body)
		If numjoints&gt;0 
		DebugLog "joints=" + Str(joints)
			For joints=0 To numjoints-1
				joint=dBodyGetJoint(ode\body,joints)
				If dJointGetType(joint)=dJointTypeContact
					
					; Get linear velocity vector
			  ax#=dBodyGetLinearVelX#(ode\body)
			  ay#=dBodyGetLinearVelY#(ode\body)
				    az#=dBodyGetLinearVelZ#(ode\body)
					; Get Angular velocity vector
			  bx#=dBodyGetAngularVelX#(ode\body)
			  by#=dBodyGetAngularVelY#(ode\body)
					bz#=dBodyGetAngularVelZ#(ode\body)
			  		; Calculate magnitudes
					ForceA#=Sqr(ax*ax+ay*ay+az*az)
					ForceB#=Sqr(bx*bx+by*by+bz*bz)
					
					If ForceA&gt;.01
						LinearDamp(ode\body,.04)
					End If
					
					;If ForceA&gt;2.5
					;	PositionEntity piv1,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
					;	EmitSound(snd1,piv1)
					;End If



					
					If ForceB&gt;.01
						AngularDamp(ode\body,.06)
					End If
					
				End If
			Next
		End If
	End If
Next

End Function
</textarea> <br><br></td></tr></table><br>
<a name="487801"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> Cheers Wayne, I'll take a look at that code now.<br><br>@Flying: I may be confusing ERP &amp; CFM, they're used for dampening forces on springs mainly. <br><br></td></tr></table><br>
<a name="487813"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PsychicParrot</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just one question .. does it freeze like the previous attempts to do this? I LOVE using ODE and if this is stable it will make my YEAR! :) <br><br></td></tr></table><br>
<a name="487828"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mustang</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> Arkon's wrapper did the freezing thing... this is competely different wrapper done by different ppl. And this one WORKS. <br><br></td></tr></table><br>
<a name="487837"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello PsychicParrot :)<br><br>No freezing in this wrapper you'll be glad to hear ;) <br><br></td></tr></table><br>
<a name="487919"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PsychicParrot</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#32">[#32]</a></td></tr></table></td></tr><tr ><td class="posttext"> Then consider me a customer :D WOOT! <br><br></td></tr></table><br>
<a name="487924"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PsychicParrot</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#33">[#33]</a></td></tr></table></td></tr><tr ><td class="posttext"> In fact .. cha-ching! I AM a customer :p <br><br></td></tr></table><br>
<a name="487936"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >flying willy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#34">[#34]</a></td></tr></table></td></tr><tr ><td class="posttext"> :) Issues I would like to see dealt with:<br><br>* a bank of collisions so we can loop through all the collisions  in a similar format to countcollisions on blitz - returning the GEOM we collided with (as trimesh and others often don't have bodies)<br><br>* per-rigidbody mass and friction settings - including setting the bounce for trimesh SEPERATELY from the bounce of rigidbody to rigidbody.<br><br>The response between 2 rigidbodies will often be very DIFFERENT to the response with trimesh for example.<br><br>ie. pool - the perfect example. The pool table dampens bounce by around 0.6 but ball to ball transfer is more like 0.99 in dampening of the energy transfer (or bounce = .99)<br><br>Therefore for many simulations we'd like a lot more information and feedback. I know that jedive said he was working on this, and that makes this library VERY attractive to buy.<br><br>So if it happens, I'll start really recommending it as it's a lot more extra work for jedive and viper. <br><br></td></tr></table><br>
<a name="487949"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#35">[#35]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>cha-ching!<br> <br></div><br>Nice one PP :)<br><br>@Flying: Per-body mass should already be working, we'll definitely see what we can do for the other bits and bobs too ;) - I'm looking forward to seeing that snooker game btw.<br><br>@Wayne: Thanks for sorting the codebox stuff mate, and nice work with those demos ;) <br><br></td></tr></table><br>
<a name="487990"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#36">[#36]</a></td></tr></table></td></tr><tr ><td class="posttext"> Welcome PP <br><br></td></tr></table><br>
<a name="487999"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >flying willy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#37">[#37]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Viper! I also need to set the bounce of the trimesh seperately from the rigid bodies - is this possible? <br><br></td></tr></table><br>
<a name="488000"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KuRiX</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#38">[#38]</a></td></tr></table></td></tr><tr ><td class="posttext"> i think that the linear and angular dumping is better doing this:<br><br>dumpfactor# = 0.8 ; (value between 0-1)<br>vx# = dbodygetlinearvelx(b)<br>vy# = dbodygetlinearvely(b)<br>vz# = dbodygetlinearvelz(b)<br>dbodysetlinearvel(b,vx#*dampfactor#,vy#*dampfactor#,vz#*dampfactor#)<br><br>And the angular the same but using getangular and setangular...<br><br>I use them in my car demo and then i set the dumpfactor# as i need. <br><br></td></tr></table><br>
<a name="488013"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >flying willy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#39">[#39]</a></td></tr></table></td></tr><tr ><td class="posttext"> The reason ADDVEL is used instead of SETVEL is because setting the velocity or position is considered more unreliable as the simulation is in progress. <br><br></td></tr></table><br>
<a name="488037"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PsychicParrot</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#40">[#40]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks, Wayne!<br><br>Having started with Vodermanns ODE, gone to Tokamak, moved to 'other' ODE then over to this one .. it's getting really hard to keep track of my damping velocities!! I really hope this is the end of my physics journey - so far, so good :) <br><br></td></tr></table><br>
<a name="488041"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#41">[#41]</a></td></tr></table></td></tr><tr ><td class="posttext"> All of those setting velocities directly should note:<br><br>The ODE User Guide specificly states that you should avoid setting velocities directly every time step where possible (except initial setup). You will end up abusing the built in physics model (forcing ODE to do something rather than let it happen naturally).<br><br>If you set everything up properly using force, friction and torque, ODE should do all of the hard work for you.<br><br>For more info on this, read the ODE User Guide (link in top post) Section 12.6.<br><br>Just some food for thought ;) <br><br></td></tr></table><br>
<a name="488062"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#42">[#42]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'd like to see a demo using multiple spaces like talked about in the ODE manual. I've included the section from the manual here:<br><br>A collision detection ``world'' is created by making a space and then adding geoms to that space. At every time step we want to generate a list of contacts for all the geoms that intersect each other. Three functions are used to do this:<br><br>    * dCollide intersects two geoms and generates contact points.<br><br>    * dSpaceCollide determines which pairs of geoms in a space may potentially intersect, and calls a callback function with each candidate pair. This does not generate contact points directly, because the user may want to handle some pairs specially - for example by ignoring them or using different contact generating strategies. Such decisions are made in the callback function, which can choose whether or not to call dCollide for each pair.<br><br>    * dSpaceCollide2 determines which geoms from one space may potentially intersect with geoms from another space, and calls a callback function with each candidate pair. It can also test a single non-space geom against a space. This function is useful when there is a collision hierarchy, i.e. when there are spaces that contain other spaces. <br><br>The collision system has been designed to give the user maximum flexibility to decide which objects will be tested against each other. This is why are there are three collision functions instead of, for example, one function that just generates all the contact points.<br><br>Spaces may contain other spaces. These sub-spaces will typically represent a collection of geoms (or other spaces) that are located near each other. This is useful for gaining extra collision performance by dividing the collision world into hierarchies. Here is an example of where this is useful:<br><br>Suppose you have two cars driving over some terrain. Each car is made up of many geoms. If all these geoms were inserted into the same space, the collision computation time between the two cars would always be proportional to the total number of geoms (or even to the square of this number, depending on which space type is used).<br><br>To speed up collision a separate space is created to represent each car. The car geoms are inserted into the car-spaces, and the car-spaces are inserted into the top level space. At each time step dSpaceCollide is called for the top level space. This will do a single intersection test between the car-spaces (actually between their bounding boxes) and call the callback if they touch. The callback can then test the geoms in the car-spaces against each other using dSpaceCollide2. If the cars are not near each other then the callback is not called and no time is wasted performing unnecessary tests.<br><br>If space hierarchies are being used then the callback function may be called recursively, e.g. if dSpaceCollide calls the callback which in turn calls dSpaceCollide with the same callback function. In this case the user must make sure that the callback function is properly reentrant. <br><br></td></tr></table><br>
<a name="488088"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#43">[#43]</a></td></tr></table></td></tr><tr ><td class="posttext"> Kurix, I like that simple method for some simulations.<br>It's great we have the flexibility to be simple or complicated. I'm playing around with Air, Water, Ground, and Ice to see what kinda MAYHAM I can create.<br><br>*cheers* <br><br></td></tr></table><br>
<a name="488176"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >angel martinez</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#44">[#44]</a></td></tr></table></td></tr><tr ><td class="posttext"> Only a question:Is there any documentation about the commands ?<br>Thanks <br><br></td></tr></table><br>
<a name="488181"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mustang</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#45">[#45]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>Is there any documentation about the commands ? <br> <br></div><br><br><a href="http://ode.org/ode-latest-userguide.html" target="_blank">http://ode.org/ode-latest-userguide.html</a><br><br>PDF:<br><br><a href="http://ode.org/ode-latest-userguide.pdf" target="_blank">http://ode.org/ode-latest-userguide.pdf</a> <br><br></td></tr></table><br>
<a name="488428"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#46">[#46]</a></td></tr></table></td></tr><tr ><td class="posttext"> I learned that one should check collisions before stepping the world. The article is here:<br><a href="http://www.cambrianlabs.com/mattias/DelphiODE/UsingDelphiODE.asp" target="_blank">http://www.cambrianlabs.com/mattias/DelphiODE/UsingDelphiODE.asp</a> <br><br>Revised Spheres Demo to collision check before WorldQuickStep, and add friction on each collision contact. Not sure if autodisable is working for me in this example or not. Nice simulation.<br><br>Lots of new ODE stuff to learn and try.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #									   JV-ODE - Spheres Demo										#
; #									Code by Jim Williams (VIP3R)									#
; ###################################################################################################

AppTitle "JV-ODE - Spheres Demo"

Global snd1, piv1


Include "ode.bb"

Graphics3D 800,600,0,2

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

; ###################################################################################################

;snd1=Load3DSound("Bounce.wav")
;piv1=CreatePivot()

; ### Setup ODE

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetGravity(World,0,-1,0)
dContactSetMode(dContactBounced + ContactSoftERP + dContactSoftCFM)
dContactSetMu(32)

; Increase to make bouncy
dContactSetBounce(0.3)

; Make contact surface soft
;dContactSetSoftERP(0.4)
;dContactSetSoftCFM(0.8)


; ### Create light

Global Light=CreateLight()

RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera

Global Camera=CreateCamera()
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000

;mic1=CreateListener(camera) ; Create listener, make it child of camera 

PositionEntity Camera,0,20,-50
RotateEntity Camera,30,0,0

; ### Create plane

dCreatePlane(Space,0,1,0,0)

Plane=CreatePlane()

EntityAlpha Plane,0.8

PlaneTexture=CreateTexture(128,128,9)

ClsColor 0,200,80
Cls

Color 255,255,255

Rect 0,0,64,64,1
Rect 64,64,64,64,1

CopyRect 0,0,128,128,0,0,BackBuffer(),TextureBuffer(PlaneTexture)
ScaleTexture PlaneTexture,20,20
EntityTexture Plane,PlaneTexture,0,0

Mirror=CreateMirror()

; ###################################################################################################

While Not KeyHit(1)

	PTime=MilliSecs()

	dSpaceCollide(Space,World,ContactGroup)
	UpdateFriction
	
	dWorldQuickStep(World,0.1)
	
	
	dJointGroupEmpty(ContactGroup)

	If MilliSecs()-Timer&gt;700
		AddObject()
		Timer=MilliSecs()
		End If

	UpdateGeoms()

	PhysicsTime#=MilliSecs()-PTime

	UpdateWorld

	RenderWorld

	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime

	Flip

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function AddObject()

xp=Rand(-8,8)
zp=Rand(-8,8)
ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp,30,zp)
ode\geom=dCreateSphere(Space,3)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateSphere()
ScaleMesh ode\mesh,3,3,3
EntityColor ode\mesh,Rand(255),Rand(255),Rand(255)
EntityAlpha ode\mesh,1
EntityShininess ode\mesh,0.7

End Function

; ###################################################################################################

Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
If dGeomIsEnabled(ode\geom)
	RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
	PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
End If
Next

End Function

; ###################################################################################################

Function AngularDamp(body,damp#)
  dBodyAddTorque body,dBodyGetAngularVelX(body)*-damp,dBodyGetAngularVelY(body)*-damp,dBodyGetAngularVelZ(body)*-damp
End Function

; ###################################################################################################

Function LinearDamp(body,damp#)
  dBodyAddForce body,dBodyGetLinearVelX(body)*-damp,dBodyGetLinearVelY(body)*-damp,dBodyGetLinearVelZ(body)*-damp
End Function

; ###################################################################################################

Function UpdateFriction()

For ode.ODEGeom=Each ODEGeom
	If dGeomIsEnabled(ode\geom)
		numjoints=dBodyGetNumJoints(ode\body)
		If numjoints&gt;0 
		DebugLog "joints=" + Str(joints)
			For joints=0 To numjoints-1
				joint=dBodyGetJoint(ode\body,joints)
				If dJointGetType(joint)=dJointTypeContact
					
					; Get linear velocity vector
			  		ax#=dBodyGetLinearVelX#(ode\body)
			  		ay#=dBodyGetLinearVelY#(ode\body)
				    az#=dBodyGetLinearVelZ#(ode\body)
					; Get Angular velocity vector
			  		bx#=dBodyGetAngularVelX#(ode\body)
			  		by#=dBodyGetAngularVelY#(ode\body)
					bz#=dBodyGetAngularVelZ#(ode\body)
			  		; Calculate magnitudes
					ForceA#=Sqr(ax*ax+ay*ay+az*az)
					ForceB#=Sqr(bx*bx+by*by+bz*bz)
					
					
					If ForceA&gt;.01
						LinearDamp(ode\body,.08)
					End If
					
	
					If ForceB&gt;.01
						AngularDamp(ode\body,.08)
					End If
					
				End If
			Next
		End If
	End If
Next

End Function
</textarea> <br><br></td></tr></table><br>
<a name="488435"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#47">[#47]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>Not sure if autodisable is working for me in this example or not.<br> <br></div><br>No, auto disable is turned off by default. It won't be working in the code above as you haven't activated it.<br><br>This will tell you the current state of world auto disable:<br>Text 0,30,"Auto Disable:"+dWorldGetAutoDisableFlag(World)<br><br>You would do this to turn world auto disable on:<br>dWorldSetAutoDisableFlag(World,1) ; &lt;&lt;&lt; 1=On - 0=Off<br><br>[edit] Ooops, forgot to mention these...<br><br>The following will return the current state of a body auto disable:<br>dBodyGetAutoDisableFlag(ode\body)<br><br>You would do this to turn a body auto disable on:<br>dBodySetAutoDisableFlag(ode\body,1) ; &lt;&lt;&lt; 1=On - 0=Off <br><br></td></tr></table><br>
<a name="488441"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RepeatUntil</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#48">[#48]</a></td></tr></table></td></tr><tr ><td class="posttext"> Below, I was proposing that you show a demo version of your wrapper. But I forgot that in this case you have to distribute the dll, and that's obviously not good.<br>So I have another proposition: make a movie of your engine in action, in different situations. With the code that's used for this demo. I think it could be a good replacement... <br><br></td></tr></table><br>
<a name="488452"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#49">[#49]</a></td></tr></table></td></tr><tr ><td class="posttext"> I hope the JV-ODE guys will compile the demo programs and distribute the B3d demo  source, B3d demo exe, and ode.dll.<br><br>This would allow people to see the demo in action and view the source. This would not allow people to compile new stuff because it's sans the decls.<br><br>Distributing the ode.dll is a normal part of distributing your game software. <br><br></td></tr></table><br>
<a name="488479"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#50">[#50]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've already made a restricted demo DLL that works on a time limit, which should be safe to distribute.<br><br>The demo will contain:<br>ode.dll (restricted version)<br>ode.decls (restricted version)<br>ode.bb<br>.bb demos<br><br>I don't think it would be wise to distribute demo exe's, the main reason for this is that the user will have a much larger download to deal with.<br><br>Once Jedive ok's it, I'll release the demo version. <br><br></td></tr></table><br>
<a name="488570"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#51">[#51]</a></td></tr></table></td></tr><tr ><td class="posttext"> <b>Demo Version Now Available!</b><br><br>Ok, Jedive has given the green light for the demo version.<br><br>I've placed a download link in the top post of this thread. <br><br></td></tr></table><br>
<a name="488582"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >polygoon</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#52">[#52]</a></td></tr></table></td></tr><tr ><td class="posttext"> Being a total noob to al this, I'd like to ask one maybe dumb question;<br><br>Could this sort of physics be used to keep a model slot car's guide "in the groove" ?<br><br>I am pondering if a bunch of us could get together and come up with such a system. Be an unusual community learning process I'd imagine.<br><br>Been a long tme since there was a good open source community project for slot cars. Good for model makers and track designers alike too I suspect. <br><br></td></tr></table><br>
<a name="488599"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mido486</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#53">[#53]</a></td></tr></table></td></tr><tr ><td class="posttext"> First off I'd just like to weigh in wih how great this wrapper is! Good Job Jedive and VIP3R.<br><br>I just have a quick question since this problem is starting to drive me crazy!<br><br>Has anyone come up with a good way of modelling the physics of a standard fps or 3d platformer type character using ODE. I've been experimenting using a sphere but I can't stop it from rolling around like a drunk skateboarder :). Any ideas here would do a great deal to preserve my sanity.<br><br>Thanks <br><br></td></tr></table><br>
<a name="488608"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PsychicParrot</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#54">[#54]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think once the bug with cubes/rectangles vs trimeshes is fixed that doing fps/platformer stuff will be very straightforward... the guys have done such a great job with this wrapper and I don't want to hassle 'em, but it is a fairly big ommission.<br><br>Your other option is to keep all platforms as cubes, rectangles or spheres but you'll have to make physics objects for every platform. Once the trimesh&gt;cube stuff is sorted, you'll be able to use an 'collision cube' to just jump and run around a level you make in whatever 3d package.<br><br>They're working on it .. so I will wait quietly. If they've got this far, I'm sure they can sort it out :) <br><br></td></tr></table><br>
<a name="488628"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >flying willy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#55">[#55]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't think ODE will provide a totally stable simulation in this instance as at high speeds it will be dependant on the polygon density of the grooves. Instead I believe you should fake it by a mixture of ode and on-rails code. <br><br></td></tr></table><br>
<a name="488640"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#56">[#56]</a></td></tr></table></td></tr><tr ><td class="posttext"> The theme is make it stop. I made a number of changes to the car trimesh demo including UpdateGeoms(). Now everthing that moves will turn green and when stopped will turn red. This new demo shows friction damping, and use of autodisable with thresholds. <br><br>enjoy<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #									  JV-ODE TriMesh Car Demo										#
; #									Code by Jim Williams (VIP3R)									#		#
; #						Feel free to use this code, any credit appreciated							#
; ###################################################################################################


AppTitle "JV-ODE TriMesh Car Demo"

Include "ode.bb"

Graphics3D 800,600,0,2

Global CMass#=200			; ### Car Mass
Global WMass#=8				; ### Wheel Mass

Global WorldERP#=1			; ### World Error Correction
Global WorldFriction#=64	; ### World Friction
Global HingeTorque#=24		; ### Hinge Torque
Global SuspensionHS#=0.01	; ### Hinge Suspension Hardness/Softness (Higher=Softer - Lower=Harder)

Global Speed#=0
Global Steer#=0

Global Car
Global CGeom
Global CMesh

Global CarStartY=40

Dim Wheel(4)
Dim WGeom(4)
Dim Joint(4)

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

; ###################################################################################################

; ### Setup ODE

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetGravity(World,0,-1,0)
dWorldSetERP(World,WorldERP)

dContactSetMode(dContactSlip1)
dContactSetMu(WorldFriction)

dWorldSetAutoDisableFlag (World, 1)
; ### Create car body

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
Car=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,0,CarStartY,0)
mass=dMassCreate()
dMassSetBox(mass,1,3,1,4)
dMassSetBoxTotal(mass,CMass,3,1,4)
dMassTranslate(mass,0,-1,0)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
ode\geom=dCreateBox(Space,3,1,4)
CGeom=ode\geom
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
CMesh=ode\mesh
ScaleMesh ode\mesh,1.5,0.5,2
RotateMesh ode\mesh,0,0,0
PositionMesh ode\mesh,0,0,0
EntityColor ode\mesh,40,80,255
EntityAlpha ode\mesh,1

;Tell car body to disable at new threshold
	dBodySetAutoDisableFlag(ode\body,1)
	dBodySetAutoDisableAngularThreshold(ode\body,.05)
	dBodySetAutoDisableLinearThreshold(ode\body,.05)
	dBodySetAutoDisableSteps (ode\body, 1)

; ### Create wheels

For count=1 To 4
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	Wheel(count)=ode\body
	dBodySetRotation(ode\body,0,0,0)
	dBodySetPosition(ode\body,0,0,0)
	mass=dMassCreate()
	dMassSetSphere(mass,1,0.7)
	dMassSetSphereTotal(mass,WMass,0.7)
	dBodySetMass(ode\body,mass)
	dMassDestroy(mass)
	ode\geom=dCreateSphere(Space,0.7)
	WGeom(count)=ode\geom
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder(8)
	ScaleMesh ode\mesh,0.7,0.25,0.7
	RotateMesh ode\mesh,0,0,90
	PositionMesh ode\mesh,0,0,0
	EntityColor ode\mesh,255,255,255
	
	dBodySetAutoDisableFlag(ode\body,1)
	dBodySetAutoDisableAngularThreshold(ode\body,.05)
	dBodySetAutoDisableLinearThreshold(ode\body,.05)
	dBodySetAutoDisableSteps (ode\body, 1)
Next

dBodySetPosition(Wheel(1),-2,CarStartY-0.5,+2)
dBodySetPosition(Wheel(2),+2,CarStartY-0.5,+2)
dBodySetPosition(Wheel(3),-2,CarStartY-0.5,-2)
dBodySetPosition(Wheel(4),+2,CarStartY-0.5,-2)

; ### Create some objects

SeedRnd MilliSecs()

For spheres=1 To 20
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	dBodySetRotation(ode\body,0,0,0)
	dBodySetPosition(ode\body,Rnd(-100,100),44,Rnd(-100,100))
	ode\geom=dCreateSphere(Space,4)
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateSphere()
	
	dBodySetAutoDisableFlag(ode\body,1)
	dBodySetAutoDisableAngularThreshold(ode\body,.05)
	dBodySetAutoDisableLinearThreshold(ode\body,.05)
	dBodySetAutoDisableSteps (ode\body, 1)
	
	ScaleMesh ode\mesh,4,4,4
	RotateMesh ode\mesh,0,0,0
	PositionMesh ode\mesh,0,0,0
	EntityColor ode\mesh,Rnd(255),Rnd(255),Rnd(255)
	EntityAlpha ode\mesh,1
	EntityShininess ode\mesh,0.7
Next

; ### Create light

Global Light=CreateLight()

RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera

Global CameraPivot=CreatePivot(CMesh)
PositionEntity CameraPivot,0,2,-7

Global Camera=CreateCamera()
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000

; ### Create plane

dCreatePlane(Space,0,1,0,0)

Plane=CreatePlane()

EntityAlpha Plane,0.8

PlaneTexture=CreateTexture(128,128,9)

ClsColor 0,200,80
Cls

Color 255,255,255

Rect 0,0,64,64,1
Rect 64,64,64,64,1

CopyRect 0,0,128,128,0,0,BackBuffer(),TextureBuffer(PlaneTexture)
ScaleTexture PlaneTexture,20,20
EntityTexture Plane,PlaneTexture,0,0

Mirror=CreateMirror()

; ###################################################################################################

; ### CREATE TRIMESH

demomesh=LoadMesh("media\terrain.b3d")
ScaleMesh demomesh,1,0.7,1
trimesh=CreateTriMesh(demomesh)
dGeomSetRotation(trimesh,0,0,0)
dGeomSetPosition(trimesh,0,0.05,0)
RotateMesh demomesh,0,0,0
PositionMesh demomesh,0,0.05,0

EntityColor demomesh,255,255,255
EntityAlpha demomesh,1

demotexture=LoadTexture("media\terrain.png")
ScaleTexture demotexture,0.08,0.08
EntityTexture demomesh,demotexture

; ###################################################################################################

SetupCar()

While Not KeyHit(1)

	UpdateKeys()

	PTime=MilliSecs()

	UpdateCar()

	UpdateGeoms()

	dSpaceCollide(Space,World,ContactGroup)
	UpdateFriction
	
	dWorldQuickStep(World,0.1)
	
	dJointGroupEmpty(ContactGroup)

	PhysicsTime#=MilliSecs()-PTime

	UpdateCam()

	UpdateWorld

	RenderWorld

	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime
	Text 0,30,"Car Speed:"+Speed
	Text 640,0,"A - Accelerate"
	Text 640,15,"Z - Brake/Reverse"
	Text 640,30,"Arrows - Steering"
	Text 640,45,"Space - Reset Car"

	Flip

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function SetupCar()

For count=1 To 4
	Joint(count)=dJointCreateHinge2(World,0)
	dJointAttach(Joint(count),Car,Wheel(count))
	dJointSetHinge2Anchor(Joint(count),dBodyGetPositionX(Wheel(count)),dBodyGetPositionY(Wheel(count)),dBodyGetPositionZ(Wheel(count)))
	dJointSetHinge2Axis1(Joint(count),0,1,0)
	dJointSetHinge2Axis2(Joint(count),-1,0,0)
	dJointSetHinge2Param(Joint(count),dParamSuspensionERP,0.8)
	dJointSetHinge2Param(Joint(count),dParamSuspensionCFM,SuspensionHS)
	If count&gt;2
		dJointSetHinge2Param(Joint(count),dParamLoStop,0)
		dJointSetHinge2Param(Joint(count),dParamHiStop,0)
		End If
Next

Speed=0

End Function

; ###################################################################################################

Function UpdateKeys()

If KeyDown(30)=1
	Speed=Speed+0.08
	If Speed&gt;30 Then Speed=30
	End If

If KeyDown(44)=1
	Speed=Speed-0.1
	If Speed&lt;-10 Then Speed=-10
	If Speed&gt;0 Then Speed=Speed*0.97
	End If

If KeyDown(30)=0 And KeyDown(44)=0 Then Speed=Speed*0.99

If KeyDown(203)=1 Or KeyDown(205)=1
	If KeyDown(203)=1
		Steer=0.5
		Else
		Steer=-0.5
		End If
	Else
	Steer=0
	End If

If KeyHit(57)=1
	Speed=0
	dBodySetRotation(Car,0,0,0)
	End If

If speed&gt;.01 
	For count=1 To 4
		dBodyEnable(Wheel(count))
	Next

	dBodyEnable(Car)
Else
	speed=0
End If

End Function

; ###################################################################################################

Function UpdateCar()

;For count=1 To 4
;	dBodyEnable(Wheel(count))
;Next

;dBodyEnable(Car)

For count=1 To 4
	dJointSetHinge2Param(Joint(count),dParamVel2,Speed)
	dJointSetHinge2Param(Joint(count),dParamFMax2,HingeTorque)
Next

For count=1 To 2
	angle#=Steer-dJointGetHinge2Angle1(Joint(count))
	dJointSetHinge2Param(Joint(count),dParamVel,angle)
	dJointSetHinge2Param(Joint(count),dParamFMax,400)
Next

End Function

; ###################################################################################################

Function UpdateCam()

PositionEntity CameraPivot,0,3,-12

camx#=EntityX(CameraPivot,1)-EntityX(Camera)
camy#=EntityY(CameraPivot,1)-EntityY(Camera)
camz#=EntityZ(CameraPivot,1)-EntityZ(Camera)

TranslateEntity Camera,camx*0.5,camy*0.5,camz*0.5

PointEntity Camera,CMesh

End Function

; ###################################################################################################

Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
	If dBodyIsEnabled(ode\body)
		RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
		PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
	End If
Next

End Function

; ###################################################################################################

Function CreateTriMesh(mesh)

tricount=0
vertcount=0

For count=1 To CountSurfaces(mesh)
	tricount=tricount+CountTriangles(GetSurface(mesh,count))
	vertcount=vertcount+CountVertices(GetSurface(mesh,count))
Next

tribank=CreateBank(tricount*3*4)
vertbank=CreateBank(vertcount*4*4)

offset=0
trioffset=0
vertoffset=0

For count=1 To CountSurfaces(mesh)
	surface=GetSurface(mesh,count)
	For vert=0 To CountVertices(surface)-1
		PokeFloat(vertbank,offset,VertexX(surface,vert))
		offset=offset+4
		PokeFloat(vertbank,offset,VertexY(surface,vert))
		offset=offset+4
		PokeFloat(vertbank,offset,VertexZ(surface,vert))
		offset=offset+8
	Next
	For tri=0 To CountTriangles(surface)-1
		For corner=0 To 2
			trivert=TriangleVertex(surface,tri,corner)+vertoffset
			PokeInt(tribank,trioffset,trivert)
			trioffset=trioffset+4
		Next
	Next
	vertoffset=vertoffset+CountVertices(surface)
Next

trimeshdata=dGeomTriMeshDataCreate()

dGeomTriMeshDataBuildSimple(trimeshdata,vertbank,vertcount,tribank,tricount*3)

Return dCreateTriMesh(Space,trimeshdata)

End Function

; ###################################################################################################

Function AngularDamp(body,damp#)
  dBodyAddTorque body,dBodyGetAngularVelX(body)*-damp,dBodyGetAngularVelY(body)*-damp,dBodyGetAngularVelZ(body)*-damp
End Function

; ###################################################################################################

Function LinearDamp(body,damp#)
  dBodyAddForce body,dBodyGetLinearVelX(body)*-damp,dBodyGetLinearVelY(body)*-damp,dBodyGetLinearVelZ(body)*-damp
End Function

; ###################################################################################################

Function UpdateFriction()

For ode.ODEGeom=Each ODEGeom
	; color code if body enabled
	If dBodyIsEnabled(ode\body)=0
		EntityColor ode\mesh,255,0,0
	Else
		EntityColor ode\mesh,0,255,0
	End If
	
	; add friction force if body enabled  
	If dBodyIsEnabled(ode\body)
		numjoints=dBodyGetNumJoints(ode\body)
		If numjoints&gt;0 
		DebugLog "joints=" + Str(joints)
			For joints=0 To numjoints-1
				joint1=dBodyGetJoint(ode\body,joints)
				If dJointGetType(joint1)=dJointTypeContact
					
					; Get linear velocity vector
			  		ax#=dBodyGetLinearVelX#(ode\body)
			  		ay#=dBodyGetLinearVelY#(ode\body)
				    az#=dBodyGetLinearVelZ#(ode\body)
				
					; Get Angular velocity vector
			  		bx#=dBodyGetAngularVelX#(ode\body)
			  		by#=dBodyGetAngularVelY#(ode\body)
					bz#=dBodyGetAngularVelZ#(ode\body)
					
			  		; Calculate magnitudes
					ForceA#=Sqr(ax*ax+ay*ay+az*az)
					ForceB#=Sqr(bx*bx+by*by+bz*bz)
					
					If ForceA&gt;.01
						LinearDamp(ode\body,.08)
					End If
					
					;If ForceA&gt;2.5
					;	PositionEntity piv1,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
					;	EmitSound(snd1,piv1)
					;End If
					
					If ForceB&gt;.01
						AngularDamp(ode\body,.08)
					End If
					
				End If
			Next
		End If
	End If
Next

End Function
</textarea> <br><br></td></tr></table><br>
<a name="488702"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >polygoon</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#57">[#57]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Willy, what terms should I search for to learn more of on-rails code? Do you think it's in this vast forum somewhere? I mean I'll try the obvious search terms of course, but if anything particular comes to mind then I'd like to hear about it?<br><br>Would this be true for say a marble running down a channel too? (I'm gussing they are similar, although maybe that's more likely to be slow/dense enough to be ok there?)<br><br>I'm ok with modelling objects but the coding is new for me in this stuff. <br><br></td></tr></table><br>
<a name="488715"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >polygoon</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#58">[#58]</a></td></tr></table></td></tr><tr ><td class="posttext"> Talking of mesh density, how do you go about getting your own externally built mesh to work with ODE?<br><br>Using the slot car analogy I used earlier, I can make a terrain and a slot cut into it and a car with a guide post, but how on earth would you load them up and get ODE to know about it all in the first place?<br><br>And what of hanging the tail out in bends etc? Seems so tantalisingly close yet so far from grasp! <br><br></td></tr></table><br>
<a name="488724"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >flying willy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#59">[#59]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think the best way to do this is build a list of scalectric style track parts in 3D - including grooove, but make the groove twice as deep as it normally is. Then we use the CreateTriMesh code as seen in the examples, toy convert our list of track parts into a single mesh and output the result to ODE.<br><br>Then, you could get away with having a proper car with pin in the groove.<br><br>To this end, you'll need to start playing with the examples.... I think it can be done in ODE if you're careful and you make the slots deeper than they need to be (and pins slightly longer) to give ODE more of a chance to remain stable. <br><br></td></tr></table><br>
<a name="488761"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >polygoon</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#60">[#60]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think I'm now in a bit of a "catch 22" situation, I have been watching the JV-ODE threads with great interest and noted that the tri mesh may still have some issues; and so have held off actually buying into it, but I have last night grabbed the demo, and sadly I can't see if it can do what I'd like before buying into it as far as I can tell. (having said that it is early days still.)<br><br>As for making the track, yes, that's completely trivial for me. As for  depth of slot, then if told the depth to make it, then it wil be that depth. If only I could code well enough and had enough confidence to try that side of it then this could be in the bag.<br><br>I got the impression you have been waiting on this wrapper to get on with your own projects, and as such you'll prbably be very busy about now, but if you or anyone else here feels cosy enough with it to have a go, the I'd be happy to make tracks and cars (which is the really easy bit for me!) I may not be able to contrubute to coding yet, but in the meantime  I can do those bits I really know about.<br><br>BTW, if it were to follow the slots well, then yoiu'd not be limited to "scalextric" types, you could easily make the pro types which can be far more fun to drive. I also suspect that a net play mode would be a total winner too assuming the networking side is up to it (these little cars  can move very quickly indeed when given enough room!)<br><br>Normally you'd have to go split screen, but net play means you could easily race 8 cars at once I'd imagine, as each polayer has their own screen and own camera setup, thus freeing this genre from it's past limitations.<br><br>Sorry, got a bit carried away there, but this represents a bit of a break through for this area of gaming! ;O)<br><br>I'm up for designing custom USB controllers too! ;O) <br><br></td></tr></table><br>
<a name="488772"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >flying willy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#61">[#61]</a></td></tr></table></td></tr><tr ><td class="posttext"> well that sounds very interesting. The pro stuff is brilliant as you can probably set them off on remote and the speed changes... some professional kits hook up to the pc.<br><br>I can't promise I'll get involved though I'd like to look at the basic physics + trimesh thing if I get time. <br><br></td></tr></table><br>
<a name="488864"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#62">[#62]</a></td></tr></table></td></tr><tr ><td class="posttext"> I discovered that boxes and cylinders are not colliding with the trimesh, but spheres are. <br><br>The following car trimesh demo shows the problem.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #									  JV-ODE TriMesh Car Demo										#
; #									Code by Jim Williams (VIP3R)									#		#
; #						Feel free to use this code, any credit appreciated							#
; ###################################################################################################

AppTitle "JV-ODE TriMesh Car Demo"

Include "ode.bb"

Graphics3D 800,600,0,2

Global CMass#=200			; ### Car Mass
Global WMass#=8				; ### Wheel Mass

Global WorldERP#=1			; ### World Error Correction
Global WorldFriction#=64	; ### World Friction
Global HingeTorque#=24		; ### Hinge Torque
Global SuspensionHS#=0.01	; ### Hinge Suspension Hardness/Softness (Higher=Softer - Lower=Harder)

Global Speed#=0
Global Steer#=0

Global Car
Global CGeom
Global CMesh

Global CarStartY=40

Dim Wheel(4)
Dim WGeom(4)
Dim Joint(4)

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

; ###################################################################################################

; ### Setup ODE

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetGravity(World,0,-1,0)
dWorldSetERP(World,WorldERP)

dContactSetMode(dContactSlip1)
dContactSetMu(WorldFriction)

; ### Create car body

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
Car=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,0,CarStartY,0)
mass=dMassCreate()
dMassSetBox(mass,1,3,1,4)
dMassSetBoxTotal(mass,CMass,3,1,4)
dMassTranslate(mass,0,-1,0)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
ode\geom=dCreateBox(Space,3,1,4)
CGeom=ode\geom
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
CMesh=ode\mesh
ScaleMesh ode\mesh,1.5,0.5,2
RotateMesh ode\mesh,0,0,0
PositionMesh ode\mesh,0,0,0
EntityColor ode\mesh,40,80,255
EntityAlpha ode\mesh,1

; ### Create wheels

For count=1 To 4
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	Wheel(count)=ode\body
	dBodySetRotation(ode\body,0,0,0)
	dBodySetPosition(ode\body,0,0,0)
	mass=dMassCreate()
	dMassSetSphere(mass,1,0.7)
	dMassSetSphereTotal(mass,WMass,0.7)
	dBodySetMass(ode\body,mass)
	dMassDestroy(mass)
	ode\geom=dCreateSphere(Space,0.7)
	WGeom(count)=ode\geom
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder(8)
	ScaleMesh ode\mesh,0.7,0.25,0.7
	RotateMesh ode\mesh,0,0,90
	PositionMesh ode\mesh,0,0,0
	EntityColor ode\mesh,255,255,255
Next

dBodySetPosition(Wheel(1),-2,CarStartY-0.5,+2)
dBodySetPosition(Wheel(2),+2,CarStartY-0.5,+2)
dBodySetPosition(Wheel(3),-2,CarStartY-0.5,-2)
dBodySetPosition(Wheel(4),+2,CarStartY-0.5,-2)

; ### Create some objects

SeedRnd MilliSecs()

For spheres=1 To 20
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	dBodySetRotation(ode\body,0,0,0)
	dBodySetPosition(ode\body,Rnd(-100,100),44,Rnd(-100,100))
	ode\geom=dCreateSphere(Space,4)
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateSphere()
	ScaleMesh ode\mesh,4,4,4
	RotateMesh ode\mesh,0,0,0
	PositionMesh ode\mesh,0,0,0
	EntityColor ode\mesh,Rnd(255),Rnd(255),Rnd(255)
	EntityAlpha ode\mesh,1
	EntityShininess ode\mesh,0.7
Next

; ### Create light

Global Light=CreateLight()

RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera

Global CameraPivot=CreatePivot(CMesh)
PositionEntity CameraPivot,0,2,-7

Global Camera=CreateCamera()
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000

; ### Create plane

dCreatePlane(Space,0,1,0,0)

Plane=CreatePlane()

EntityAlpha Plane,0.8

PlaneTexture=CreateTexture(128,128,9)

ClsColor 0,200,80
Cls

Color 255,255,255

Rect 0,0,64,64,1
Rect 64,64,64,64,1

CopyRect 0,0,128,128,0,0,BackBuffer(),TextureBuffer(PlaneTexture)
ScaleTexture PlaneTexture,20,20
EntityTexture Plane,PlaneTexture,0,0

Mirror=CreateMirror()

; ###################################################################################################

; ### CREATE TRIMESH

demomesh=LoadMesh("media\terrain.b3d")
ScaleMesh demomesh,1,0.7,1
trimesh=CreateTriMesh(demomesh)
dGeomSetRotation(trimesh,0,0,0)
dGeomSetPosition(trimesh,0,0.05,0)
RotateMesh demomesh,0,0,0
PositionMesh demomesh,0,0.05,0

EntityColor demomesh,255,255,255
EntityAlpha demomesh,1

demotexture=LoadTexture("media\terrain.png")
ScaleTexture demotexture,0.08,0.08
EntityTexture demomesh,demotexture

; ###################################################################################################

SetupCar()

While Not KeyHit(1)

	UpdateKeys()

	PTime=MilliSecs()

	UpdateCar()

	UpdateGeoms()

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)

	If MilliSecs()-Timer&gt;700
		AddObject()
		Timer=MilliSecs()
	End If
		
	PhysicsTime#=MilliSecs()-PTime

	UpdateCam()

	UpdateWorld

	RenderWorld

	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime
	Text 0,30,"Car Speed:"+Speed
	Text 640,0,"A - Accelerate"
	Text 640,15,"Z - Brake/Reverse"
	Text 640,30,"Arrows - Steering"
	Text 640,45,"Space - Reset Car"

	Flip

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function SetupCar()

For count=1 To 4
	Joint(count)=dJointCreateHinge2(World,0)
	dJointAttach(Joint(count),Car,Wheel(count))
	dJointSetHinge2Anchor(Joint(count),dBodyGetPositionX(Wheel(count)),dBodyGetPositionY(Wheel(count)),dBodyGetPositionZ(Wheel(count)))
	dJointSetHinge2Axis1(Joint(count),0,1,0)
	dJointSetHinge2Axis2(Joint(count),-1,0,0)
	dJointSetHinge2Param(Joint(count),dParamSuspensionERP,0.8)
	dJointSetHinge2Param(Joint(count),dParamSuspensionCFM,SuspensionHS)
	If count&gt;2
		dJointSetHinge2Param(Joint(count),dParamLoStop,0)
		dJointSetHinge2Param(Joint(count),dParamHiStop,0)
		End If
Next

Speed=0

End Function

; ###################################################################################################

Function UpdateKeys()

If KeyDown(30)=1
	Speed=Speed+0.08
	If Speed&gt;30 Then Speed=30
	End If

If KeyDown(44)=1
	Speed=Speed-0.1
	If Speed&lt;-10 Then Speed=-10
	If Speed&gt;0 Then Speed=Speed*0.97
	End If

If KeyDown(30)=0 And KeyDown(44)=0 Then Speed=Speed*0.99

If KeyDown(203)=1 Or KeyDown(205)=1
	If KeyDown(203)=1
		Steer=0.5
		Else
		Steer=-0.5
		End If
	Else
	Steer=0
	End If

If KeyHit(57)=1
	Speed=0
	dBodySetRotation(Car,0,0,0)
	End If

End Function

; ###################################################################################################

Function UpdateCar()

For count=1 To 4
	dBodyEnable(Wheel(count))
Next

dBodyEnable(Car)

For count=1 To 4
	dJointSetHinge2Param(Joint(count),dParamVel2,Speed)
	dJointSetHinge2Param(Joint(count),dParamFMax2,HingeTorque)
Next

For count=1 To 2
	angle#=Steer-dJointGetHinge2Angle1(Joint(count))
	dJointSetHinge2Param(Joint(count),dParamVel,angle)
	dJointSetHinge2Param(Joint(count),dParamFMax,400)
Next

End Function

; ###################################################################################################

Function UpdateCam()

PositionEntity CameraPivot,0,3,-12

camx#=EntityX(CameraPivot,1)-EntityX(Camera)
camy#=EntityY(CameraPivot,1)-EntityY(Camera)
camz#=EntityZ(CameraPivot,1)-EntityZ(Camera)

TranslateEntity Camera,camx*0.5,camy*0.5,camz*0.5

PointEntity Camera,CMesh

End Function

; ###################################################################################################

Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
	RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
	PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
Next

End Function

; ###################################################################################################

Function CreateTriMesh(mesh)

tricount=0
vertcount=0

For count=1 To CountSurfaces(mesh)
	tricount=tricount+CountTriangles(GetSurface(mesh,count))
	vertcount=vertcount+CountVertices(GetSurface(mesh,count))
Next

tribank=CreateBank(tricount*3*4)
vertbank=CreateBank(vertcount*4*4)

offset=0
trioffset=0
vertoffset=0

For count=1 To CountSurfaces(mesh)
	surface=GetSurface(mesh,count)
	For vert=0 To CountVertices(surface)-1
		PokeFloat(vertbank,offset,VertexX(surface,vert))
		offset=offset+4
		PokeFloat(vertbank,offset,VertexY(surface,vert))
		offset=offset+4
		PokeFloat(vertbank,offset,VertexZ(surface,vert))
		offset=offset+8
	Next
	For tri=0 To CountTriangles(surface)-1
		For corner=0 To 2
			trivert=TriangleVertex(surface,tri,corner)+vertoffset
			PokeInt(tribank,trioffset,trivert)
			trioffset=trioffset+4
		Next
	Next
	vertoffset=vertoffset+CountVertices(surface)
Next

trimeshdata=dGeomTriMeshDataCreate()

dGeomTriMeshDataBuildSimple(trimeshdata,vertbank,vertcount,tribank,tricount*3)

Return dCreateTriMesh(Space,trimeshdata)

End Function

; ###################################################################################################

Function AddObject()

xp=Rand(-10,10)
zp=Rand(-10,10)
ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp,30,zp)
ode\geom=dCreateBox(Space,1,7,3)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,0.5,3.5,1.5
EntityColor ode\mesh,Rand(255),Rand(255),Rand(255)
EntityAlpha ode\mesh,1
EntityShininess ode\mesh,0.7

End Function

</textarea> <br><br></td></tr></table><br>
<a name="488877"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >polygoon</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#63">[#63]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Wayne; Thanks for the heads up. Appreciated.<br><br>@Willy; Since there seem to be some issues about whether or not it can work just yet, the best thing I can do to be practical is to get on and make some demo models of track and cars and then watch this space to find out when the trimesh thing gets fixed and then allows further progress.<br><br>I'm not a fan of low poly myself, but do I NEED to be a bit squeamish to get good results with ODE?<br><br>I understand that the slot interiors might benfit from higher poly count from what you said though. I guess the same would go for the guide running in it too?<br><br>Right, now to model "slots" from 30/35 years ago (from memory!) This could prove interesting. Retro leading edge it is then! ;O) <br><br></td></tr></table><br>
<a name="488885"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#64">[#64]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>Wayne: I discovered that boxes and cylinders are not colliding with the trimesh, but spheres are.<br> <br></div><br>These issues were mentioned in the <b>top post of this thread</b> when the wrapper was released.<br>Please read <b>Known Issues In V1.00</b>.<br><br>This isn't a problem with the wrapper itself, the <b>original C++ ODE demos</b> suffer with the exact same issues regarding the TriMesh.<br><br>We are however working very hard on resolving the TriMesh issues.<br><br>I'm gonna make a big flashing neon 'Known Issues' sign first tho... ;) <br><br></td></tr></table><br>
<a name="488892"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >flying willy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#65">[#65]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well I have total confidence that you will be able to solve these issues. Arkon's wrapper allows collision between cylinders, cubes and the trimesh as well so it definately can be achieved.<br><br>I look forwards to your hard work, and given the amount you are both obviously putting into it, I am sure it's worth more.<br><br>My current feature request list is like this:<br><div class="quote"> <br>* cylinder and box to trimesh resolved<br><br>* a countcollisions() sort of thing similar to blitz where the body or geom of my choice will return the collisions with other geometries... I say geometries because you can have collisions with geom without a body (for the level or trimesh etc)... for immovable things.<br><br>* some way of setting the bounce, mass and friction on a per-object basis<br><br>* being able to set an id per tri for trimesh or something... so we can make bits slippery or find out if the player walks on metal for a clanging sound etc... not essential but  nice...<br><br>* different bits of trimesh have different physics? maybe going too far here!<br> <br></div><br>A mate of mine was using trimesh and ode in C++ and he claims that by adding lots of seperate trimeshes, the ode simulation slows down to a crawl. Might be something to consider...<br><br>Anyway good luck with this! <br><br></td></tr></table><br>
<a name="488922"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >{cYan|de}</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#66">[#66]</a></td></tr></table></td></tr><tr ><td class="posttext"> dont you think its a bit cheap to sell a wrapper for something someone else released for free, shouldnt you give the ode guy some with each sale. <br><br></td></tr></table><br>
<a name="488924"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Vorderman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#67">[#67]</a></td></tr></table></td></tr><tr ><td class="posttext"> The directX SDK is available for free, but Blitz3D, effectively a friendly wrapper around DirectX, costs money - you pay for the efforts of the person who wrote it and so you don't have to write it yourself, and in many cases because you couldn't write it if you wanted to. <br><br></td></tr></table><br>
<a name="488976"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#68">[#68]</a></td></tr></table></td></tr><tr ><td class="posttext"> VIP3R, Sorry I missed the known issues DOH!! <br><br></td></tr></table><br>
<a name="489003"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#69">[#69]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you don't want to pay for their work, go ahead and download ODE, and see how easy it is to convert to a DLL yourself.  Or hire someone to do it for you and see how cheap it is. <br><br></td></tr></table><br>
<a name="489014"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >polygoon</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#70">[#70]</a></td></tr></table></td></tr><tr ><td class="posttext"> I got no problem paying what they ask in principal, far from it, I'm dying to use the plastic to both of our good.<br><br>However I have got to wait to see if they fix it up enough so that it does what I want of it before buying into it. I've every confidence that if they got this far they can go the rest of the distance.<br><br>If I don't wait, then experience has taught me there will be some clever so and so pointing out that I should have researched it better before buying and then I'd have known it can't yet do what I want.<br><br>Having said this I do wish it would hurry up and make it clear that it can do what I want it to! ;O) Busting for a proper play with it all! <br><br></td></tr></table><br>
<a name="489142"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >flying willy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#71">[#71]</a></td></tr></table></td></tr><tr ><td class="posttext"> I wish I took polygoon's advice because right now it cannot do what I need. <br><br></td></tr></table><br>
<a name="489165"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >polygoon</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#72">[#72]</a></td></tr></table></td></tr><tr ><td class="posttext"> @ Willy, sorry to hear that; what was it you wanted it to do? <br><br></td></tr></table><br>
<a name="489172"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >flying willy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#73">[#73]</a></td></tr></table></td></tr><tr ><td class="posttext"> most essentially:<br><br>* cylinder and box to trimesh resolved<br><br>* a countcollisions() sort of thing similar to blitz where the body or geom of my choice will return the collisions with other geometries... I say geometries because you can have collisions with geom without a body (for the level or trimesh etc)... for immovable things.<br><br>* some way of setting the bounce, mass and friction on a per-object basis <br><br><br>For example, a snooker ball will bounce off a cushion differently from bouncing off another ball. <br><br>You also need to know when things collide to play sound effects, incur damage and so forth. ODE is fairly useless at the moment for anything but a tech sim. <br><br></td></tr></table><br>
<a name="489177"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#74">[#74]</a></td></tr></table></td></tr><tr ><td class="posttext"> Fellas, it's really disheartening to read this stuff :/<br><br>You know full well we are working hard to add these features you've requested Flying.<br><br>Please try to stay positive and patient while these issues are addressed. <br><br></td></tr></table><br>
<a name="489188"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >flying willy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#75">[#75]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think you're being a little bit sensitive.<br><br>ODE right now isn't suitable for a game, it WILL be of course, but I'm answering his question which was "Willy, sorry to hear that; what was it you wanted it to do?"<br><br>And so I said it's fairly useless at the moment -- bearing in mind I'm talking about my project. I didn't mean to hurt your feelings. <br><br></td></tr></table><br>
<a name="489202"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#76">[#76]</a></td></tr></table></td></tr><tr ><td class="posttext"> Jedive and VIP3R, I wanted to say you guys are doing great!<br>Having purchased early on I understood this work in progress may take some time. I accept that because I strongly believe ODE is the best game in town.<br><br>The added development time gives me the opportunity to learn more about ODE, experiment with the demos, and appreciate physics in general. ODE makes physics fun!<br><br>Thanks guys, you guys have my support and if there is anything I can do to help please let me know. <br><br></td></tr></table><br>
<a name="489219"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#77">[#77]</a></td></tr></table></td></tr><tr ><td class="posttext"> What I suggest is higher standards of support (which they are working on) as well as higher prices. <br><br></td></tr></table><br>
<a name="489231"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#78">[#78]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Wayne, it's good to hear you're having fun playing around with the physics :)<br><br>@Flying: No problem, you didn't hurt my feelings. It's just a little frustrating for me to read that you think in its current form the wrapper is of no use to you for anything other than a tech sim.<br><br>I feel the wrapper is doing its job very well so far, that is to provide access to almost everything the ODE library can offer. It's also important to note that the current TriMesh collision and cylinder issues are due to the original ODE code, not the wrapper itself.<br><br>Speaking of support, I do wish that Jedive would participate in this thread a little more tbh, but I guess he's still too busy with exams at the moment. <br><br></td></tr></table><br>
<a name="489237"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >polygoon</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#79">[#79]</a></td></tr></table></td></tr><tr ><td class="posttext"> @ Willy, yeah, I reckon they will make you smile before you know it. Your best interests are thier best interests after all!<br><br>@Wayne, agreed I'm sure they will get there, they got a track record with this thing after all, and so afr it speaks of overcoming adversities.<br><br>@VIP3R, I know you'll get it, would some nice mesh to play with be a positive enough incentive? I'll do it if it helps. <br><br></td></tr></table><br>
<a name="489238"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >flying willy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#80">[#80]</a></td></tr></table></td></tr><tr ><td class="posttext"> Viper - so you're carrying the can solo? damn man, up the price! <br><br></td></tr></table><br>
<a name="489290"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JaviCervera</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#81">[#81]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi guys.<br><br>I am extremely busy these days with my last exams, and I haven't checked this thread. I will finish them tomorrow, and in two days, I'll post here about how the next update is progressing (the collision stuff flying willy requested and that), and my plans for future updates.<br><br>Except for the box/cylinder to trimesh collision bug, the rest of the stuff is pretty easy to do. I hope that for the end of this week, we can have a new update ready.<br><br>Sorry for all the inconveniences these days, but apart from coding, I also have a job, and am trying to finish my career. Once my exams are finished (this is, tomorrow), getting the next JV-ODE update ready is my first priority.<br><br>More soon! <br><br></td></tr></table><br>
<a name="489300"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#82">[#82]</a></td></tr></table></td></tr><tr ><td class="posttext"> I just bumped  into this proggy (haven't tried it yet):<br><a href="http://odeed.org/" target="_blank">http://odeed.org/</a> <br><br></td></tr></table><br>
<a name="489485"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#83">[#83]</a></td></tr></table></td></tr><tr ><td class="posttext"> @polygoon: Sure, if you want to make a mesh for the TriMesh testing feel free. <br><br></td></tr></table><br>
<a name="489943"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JaviCervera</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#84">[#84]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here I am again.<br><br>Yesterday, I finished my exams. After a long session of sleeping :), I am ready to continue the work on this library!<br><br>In the few time I had these days, I were trying to write a .dba file to use JV-ODE on DarkBASIC Pro, but there seems to be a bug in DBPro when catching a float value returned from a Dll. I'll take a look at it later, but for now, I have other priorities.<br><br>I have currently added the following functions to the library:<br><pre class=code>dGeomContactSetMode(geom,mode):"odeGeomContactSetMode@8"
dGeomContactGetMode%(geom):"odeGeomContactGetMode@4"
dGeomContactSetMu(geom,mu#):"odeGeomContactSetMu@8"
dGeomContactGetMu#(geom):"odeGeomContactGetMu@4"
dGeomContactSetMu2(geom,mu#):"odeGeomContactSetMu2@8"
dGeomContactGetMu2#(geom):"odeGeomContactGetMu2@4"
dGeomContactSetBounce(geom,bounce#):"odeGeomContactSetBounce@8"
dGeomContactGetBounce#(geom):"odeGeomContactGetBounce@4"
dGeomContactSetBounceVel(geom,vel#):"odeGeomContactSetBounceVel@8"
dGeomContactGetBounceVel#(geom):"odeGeomContactGetBounceVel@4"
dGeomContactSetSoftERP(geom,erp#):"odeGeomContactSetSoftERP@8"
dGeomContactGetSoftERP#(geom):"odeGeomContactGetSoftERP@4"
dGeomContactSetSoftCFM(geom,cfm#):"odeGeomContactSetSoftCFM@8"
dGeomContactGetSoftCFM#(geom):"odeGeomContactGetSoftCFM@4"
dGeomContactSetMotion1(geom,motion#):"odeGeomContactSetMotion1@8"
dGeomContactGetMotion1#(geom):"odeGeomContactGetMotion1@4"
dGeomContactSetMotion2(geom,motion#):"odeGeomContactSetMotion2@8"
dGeomContactGetMotion2#(geom):"odeGeomContactGetMotion2@4"
dGeomContactSetSlip1(geom,slip#):"odeGeomContactSetSlip1@8"
dGeomContactGetSlip1#(geom):"odeGeomContactGetSlip1@4"
dGeomContactSetSlip2(geom,slip#):"odeGeomContactSetSlip2@8"
dGeomContactGetSlip2#(geom):"odeGeomContactGetSlip2@4"
dGeomContactSetDefaults(geom):"odeGeomContactSetDefaults@4"</pre><br>This basically allows to define contact parameters for each geom, instead of global ones. So now each geom can have different bounce values, etc.<br><br>After that, I will make each geom store in a list all the collisions detected in the last collision test. You will be able to retrieve the number of collisions for each geom, the geoms it has collided with, and the standard contact point information.<br><br>That's what I am currently busy with, and I don't think it will take much time. I hope we can have a new release this weekend. Once I am done with the new collision commands, I'll try to find out why some geom classes fail when colliding with trimeshes. I'll try to have it fixed for the new update. <br><br></td></tr></table><br>
<a name="489965"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >polygoon</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#85">[#85]</a></td></tr></table></td></tr><tr ><td class="posttext"> Excellent new Jedive, I got a car more or less finished to my satisfaction.<br><br>Next I'll start on the track. Then I'll make the "guide post" for the slot in the track.<br><br>Then we'll be in a postion to out if the  lib can help make multiplayer networked slot car racing a reality!<br><br>I really would like to see it happen as I suspect it could be a lot of fun to play with. <br><br></td></tr></table><br>
<a name="490223"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PsychicParrot</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#86">[#86]</a></td></tr></table></td></tr><tr ><td class="posttext"> Jedive &amp; Viper ..<br><br>The whole reason I bought the lib was because I believe in what you are doing and (thanks to the mighty Vorderman) I love the ODE physics model.<br><br>I don't expect everything to be done overnight and I know that there are projects I can put the lib to good use on, so I'm happy and I'm sure you will get nothing but support from those of us who 'took the plunge'.<br><br>Programming indie style is about having most of the solution, then having to use our imagination to make it good :) <br><br></td></tr></table><br>
<a name="490313"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mustang</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#87">[#87]</a></td></tr></table></td></tr><tr ><td class="posttext"> yup, what PsychicParrot said. I agree 100%... thumbs up! <br><br></td></tr></table><br>
<a name="490408"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#88">[#88]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the support fellas, both Jedive and myself really appreciate it :)<br><br>Here is another little demo to play around with, this one shows a simple rope effect using ball joints. Notice the top sphere joint is attached to '0', which means it's a static joint and won't move from its set position.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #										 JV-ODE - Rope Demo											#
; #									Code by Jim Williams (VIP3R)									#
; ###################################################################################################

AppTitle "JV-ODE - Rope Demo"

Include "ode.bb"

Graphics3D 800,600,0,2

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

Dim Sphere(10)
Dim Joint(10)

; ###################################################################################################

; ### Setup ODE

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetGravity(World,0,-1,0)
dContactSetMode(dContactBounce)
dContactSetMu(48)

; ### Create Rope

For count=1 To 10
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	Sphere(count)=ode\body
	dBodySetRotation(ode\body,0,0,0)
	dBodySetPosition(ode\body,-30,90-(count*8),0)
	ode\geom=dCreateSphere(Space,4)
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateSphere()
	ScaleMesh ode\mesh,4,4,4
	RotateMesh ode\mesh,0,0,0
	PositionMesh ode\mesh,0,0,0
	EntityColor ode\mesh,Rand(255),Rand(255),Rand(255)
	EntityAlpha ode\mesh,1
	EntityShininess ode\mesh,0.7
	Joint(count)=dJointCreateBall(World,0)
	If count=1
		dJointAttach(Joint(count),0,Sphere(count))
		Else
		dJointAttach(Joint(count),Sphere(count-1),Sphere(count))
		End If
	dJointSetBallAnchor(Joint(count),dBodyGetPositionX(Sphere(count)),dBodyGetPositionY(Sphere(count)),dBodyGetPositionZ(Sphere(count)))
Next

; ### Create light

Global Light=CreateLight()

RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera

Global Camera=CreateCamera()
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000
PositionEntity Camera,0,90,-100
RotateEntity Camera,30,0,0

; ### Create plane

dCreatePlane(Space,0,1,0,0)

Plane=CreatePlane()

EntityAlpha Plane,0.8

PlaneTexture=CreateTexture(128,128,9)

ClsColor 0,200,80
Cls

Color 255,255,255

Rect 0,0,64,64,1
Rect 64,64,64,64,1

CopyRect 0,0,128,128,0,0,BackBuffer(),TextureBuffer(PlaneTexture)
ScaleTexture PlaneTexture,20,20
EntityTexture Plane,PlaneTexture,0,0

Mirror=CreateMirror()

; ###################################################################################################

While Not KeyHit(1)

	UpdateKeys()

	PTime=MilliSecs()

	If MilliSecs()-Timer&gt;700
		AddObject()
		Timer=MilliSecs()
		End If

	UpdateGeoms()

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)

	PhysicsTime#=MilliSecs()-PTime

	UpdateWorld

	RenderWorld

	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime
	Text 640,0,"Add Force To Rope"
	Text 640,15,"Using Arrow Keys"

	Flip

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function AddObject()

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,30,80,0)
ode\geom=dCreateBox(Space,10,5,10)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,5,2.5,5
EntityColor ode\mesh,Rand(255),Rand(255),Rand(255)
EntityAlpha ode\mesh,1
EntityShininess ode\mesh,0.7

End Function

; ###################################################################################################

Function UpdateKeys()

If KeyDown(203) Then dBodyAddForce(Sphere(10),-10,0,0)
If KeyDown(205) Then dBodyAddForce(Sphere(10),10,0,0)
If KeyDown(200) Then dBodyAddForce(Sphere(10),0,0,10)
If KeyDown(208) Then dBodyAddForce(Sphere(10),0,0,-10)

End Function

; ###################################################################################################

Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
	RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
	PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
Next

End Function

; ###################################################################################################
</textarea> <br><br></td></tr></table><br>
<a name="490438"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#89">[#89]</a></td></tr></table></td></tr><tr ><td class="posttext"> Added hanging light to end of rope.<br>8)<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #										 JV-ODE - Rope Demo											#
; #									Code by Jim Williams (VIP3R)									#
; ###################################################################################################

AppTitle "JV-ODE - Rope Demo"

Include "ode.bb"

Graphics3D 800,600,0,2

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

Dim Sphere(10)
Dim Joint(10)

; ###################################################################################################

; ### Setup ODE

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetGravity(World,0,-1,0)
dContactSetMode(dContactBounce)
dContactSetMu(48)

; ### Create Rope

For count=1 To 10
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	Sphere(count)=ode\body
	dBodySetRotation(ode\body,0,0,0)
	dBodySetPosition(ode\body,-30,90-(count*8),0)
	ode\geom=dCreateSphere(Space,4)
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateSphere()
		If count=10 Then
			c1=CreateCone(16,0,ode\mesh)
			ScaleEntity c1,5,5,5
			c2=CreateCone(16,0,ode\mesh)
			FlipMesh c2
			ScaleEntity c2,5,5,5
		End If
	ScaleMesh ode\mesh,4,4,4
	RotateMesh ode\mesh,0,0,0
	PositionMesh ode\mesh,0,0,0
	EntityColor ode\mesh,Rand(255),Rand(255),Rand(255)
	EntityAlpha ode\mesh,1
	EntityShininess ode\mesh,0.7
	Joint(count)=dJointCreateBall(World,0)
	If count=1
		dJointAttach(Joint(count),0,Sphere(count))
	Else
		dJointAttach(Joint(count),Sphere(count-1),Sphere(count))
	End If
	dJointSetBallAnchor(Joint(count),dBodyGetPositionX(Sphere(count)),dBodyGetPositionY(Sphere(count)),0)
	
	If count=10 Then
		lgt=CreateLight(3,ode\mesh)
		RotateEntity lgt,90,0,0
		
	End If
Next


; ### Create light

Global Light=CreateLight()

RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera

Global Camera=CreateCamera()
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000
PositionEntity Camera,0,90,-100
RotateEntity Camera,30,0,0

; ### Create plane

dCreatePlane(Space,0,1,0,0)

Plane=CreatePlane()

EntityAlpha Plane,0.8

PlaneTexture=CreateTexture(128,128,9)

ClsColor 0,200,80
Cls

Color 255,255,255

Rect 0,0,64,64,1
Rect 64,64,64,64,1

CopyRect 0,0,128,128,0,0,BackBuffer(),TextureBuffer(PlaneTexture)
ScaleTexture PlaneTexture,20,20
EntityTexture Plane,PlaneTexture,0,0

Mirror=CreateMirror()

; ###################################################################################################

MoveMouse 400,0

While Not KeyHit(1)

	PTime=MilliSecs()

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)

	If KeyDown(203) Then dBodyAddForce(Sphere(10),-10,0,0)
	If KeyDown(205) Then dBodyAddForce(Sphere(10),10,0,0)
	If KeyDown(200) Then dBodyAddForce(Sphere(10),0,0,10)
	If KeyDown(208) Then dBodyAddForce(Sphere(10),0,0,-10)

	If MilliSecs()-Timer&gt;700
		AddObject()
		Timer=MilliSecs()
		End If

	UpdateGeoms()

	PhysicsTime#=MilliSecs()-PTime

	UpdateWorld

	RenderWorld

	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime
	Text 640,0,"Add Force To Rope"
	Text 640,15,"Using Arrow Keys"

	Flip

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function AddObject()

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,30,80,0)
ode\geom=dCreateBox(Space,10,5,10)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,5,2.5,5
EntityColor ode\mesh,Rand(255),Rand(255),Rand(255)
EntityAlpha ode\mesh,1
EntityShininess ode\mesh,0.7

End Function

; ###################################################################################################

Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
	RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
	PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
Next

End Function

; ###################################################################################################
</textarea> <br><br></td></tr></table><br>
<a name="490573"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mustang</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#90">[#90]</a></td></tr></table></td></tr><tr ><td class="posttext"> Cool! <br><br></td></tr></table><br>
<a name="490701"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#91">[#91]</a></td></tr></table></td></tr><tr ><td class="posttext"> New and improved light on rope.<br><br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #										 JV-ODE - Rope Demo											#
; #									Code by Jim Williams (VIP3R)									#
; ###################################################################################################

AppTitle "JV-ODE - Rope Demo"

Include "ode.bb"

Graphics3D 800,600,0,2

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

Dim Sphere(10)
Dim Joint(10)

; ###################################################################################################

; ### Setup ODE

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetGravity(World,0,-1,0)
dContactSetMode(dContactBounce)
dContactSetMu(48)

; ### Create Rope

For count=1 To 10
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	Sphere(count)=ode\body
	dBodySetRotation(ode\body,0,0,0)
	dBodySetPosition(ode\body,-30,90-(count*8),0)
	ode\geom=dCreateSphere(Space,4)
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateSphere()
		If count=10 Then
			c1=CreateCone(16,0,ode\mesh)
			ScaleEntity c1,5,5,5
			
			c2=CreateCone(16,0,ode\mesh)
			FlipMesh c2
			ScaleEntity c2,5,5,5
			
			c3=CreateCone(16,0,ode\mesh)
			ScaleEntity c3,50,50,50
			EntityAlpha c3,.1 
			EntityColor c3,255,255,255
			MoveEntity c3,0,-50,0
			
			c4=CreateCone(16,0,ode\mesh)
			FlipMesh c4
			ScaleEntity c4,50,50,50
			EntityAlpha c4,.1 
			EntityColor c4,255,255,255
			MoveEntity c4,0,-50,0

		End If
	ScaleMesh ode\mesh,4,4,4
	RotateMesh ode\mesh,0,0,0
	PositionMesh ode\mesh,0,0,0
	EntityColor ode\mesh,Rand(255),Rand(255),Rand(255)
	EntityAlpha ode\mesh,1
	EntityShininess ode\mesh,0.7
	Joint(count)=dJointCreateBall(World,0)
	If count=1
		dJointAttach(Joint(count),0,Sphere(count))
	Else
		dJointAttach(Joint(count),Sphere(count-1),Sphere(count))
	End If
	dJointSetBallAnchor(Joint(count),dBodyGetPositionX(Sphere(count)),dBodyGetPositionY(Sphere(count)),0)
	
	If count=10 Then
		lgt=CreateLight(3,ode\mesh)
		RotateEntity lgt,90,0,0
		
	End If
Next


; ### Create light

Global Light=CreateLight()

RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera

Global Camera=CreateCamera()
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000
PositionEntity Camera,0,90,-100
RotateEntity Camera,30,0,0

; ### Create plane

dCreatePlane(Space,0,1,0,0)

Plane=CreatePlane()

EntityAlpha Plane,0.8

PlaneTexture=CreateTexture(128,128,9)

ClsColor 0,200,80
Cls

Color 255,255,255

Rect 0,0,64,64,1
Rect 64,64,64,64,1

CopyRect 0,0,128,128,0,0,BackBuffer(),TextureBuffer(PlaneTexture)
ScaleTexture PlaneTexture,20,20
EntityTexture Plane,PlaneTexture,0,0

Mirror=CreateMirror()

; ###################################################################################################

MoveMouse 400,0

While Not KeyHit(1)

	PTime=MilliSecs()

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)

	If KeyDown(203) Then dBodyAddForce(Sphere(10),-10,0,0)
	If KeyDown(205) Then dBodyAddForce(Sphere(10),10,0,0)
	If KeyDown(200) Then dBodyAddForce(Sphere(10),0,0,10)
	If KeyDown(208) Then dBodyAddForce(Sphere(10),0,0,-10)

	If MilliSecs()-Timer&gt;700
		AddObject()
		Timer=MilliSecs()
		End If

	UpdateGeoms()

	PhysicsTime#=MilliSecs()-PTime

	UpdateWorld

	RenderWorld

	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime
	Text 640,0,"Add Force To Rope"
	Text 640,15,"Using Arrow Keys"

	Flip

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function AddObject()

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,30,80,0)
ode\geom=dCreateBox(Space,10,5,10)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,5,2.5,5
EntityColor ode\mesh,Rand(255),Rand(255),Rand(255)
EntityAlpha ode\mesh,1
EntityShininess ode\mesh,0.7

End Function

; ###################################################################################################

Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
	RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
	PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
Next

End Function

; ###################################################################################################
</textarea> <br><br></td></tr></table><br>
<a name="491053"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#92">[#92]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey, I like that light on a rope idea Wayne, good stuff :)<br><br>I've modified all of the demos slightly to correct the main loop sequence. I thought it would be better to call dWorldQuickStep <b>after</b> UpdateGeoms(), the same as the car demos.<br><br>I've updated the rope demo code above to show this. The key detection routine has also been moved out of the main loop in that demo now. The updated demos should be available in the next update. <br><br></td></tr></table><br>
<a name="491075"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#93">[#93]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm hoping box/cylinder to trimesh collision stuff can be resolved easily. I have a project that could use the box trimesh collision thing the most. <br><br>The additional Jedive functions make it really sweet. I'd like to test changing physics on the fly based on the terrain the body is over. So terrains with water, mud, ice, rock and so on can all play a role in the interactions. <br><br></td></tr></table><br>
<a name="491134"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ryan scott</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#94">[#94]</a></td></tr></table></td></tr><tr ><td class="posttext"> i'm trying to understand this - a little difficult because of lack of docs.<br><br>why in the car demo in UpdateCar() do you do this?<br><br><br>For count=1 To 4<br>	dBodyEnable(Wheel(count))<br>Next<br>dBodyEnable(Car)<br><br>the ode docs claim that unless you disable a body, it is enabled.  what is the purpose of this code, then?<br><br>it works fine without it. <br><br></td></tr></table><br>
<a name="491136"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ryan scott</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#95">[#95]</a></td></tr></table></td></tr><tr ><td class="posttext"> cannot wait for collision detection code!   this silent colliding is creepy!<br><br>just my 2 cents.  i am liking this package, glad i bought it. <br><br></td></tr></table><br>
<a name="491164"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ryan scott</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#96">[#96]</a></td></tr></table></td></tr><tr ><td class="posttext"> i have to ask more questions - before i bother to use physics for everything, the question is - should I?  should i run 30 cars around the screen at once, colliding with each other, using ode, or will it start to get too slow?  should i use physics on the bullets i'm shooting at those cars, or is that taking it too far?<br><br>i have no sense of the impact this engine will have on my game so any insights would be appreciated! <br><br></td></tr></table><br>
<a name="491165"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#97">[#97]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>the ode docs claim that unless you disable a body, it is enabled. what is the purpose of this code, then?<br> <br></div><br>The body enable code was left in so that the car doesn't become disabled if a user decides to activate the auto-disable mode while playing around with the demo.<br><br>Glad to hear you are enjoying the wrapper :) <br><br></td></tr></table><br>
<a name="491168"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#98">[#98]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>i have no sense of the impact this engine will have on my game so any insights would be appreciated!<br> <br></div><br>The best advice I can give you is to experiment with different ideas, there would be no point in using ODE for situations where you don't really need it. Also, if you look at the demos you can see a physics timer in the main loop. You can use this timer to help judge the impact of the physics engine. Try to keep the physics time as small as possible as this will obviously affect the overall speed of the game. <br><br></td></tr></table><br>
<a name="491353"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ryan scott</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#99">[#99]</a></td></tr></table></td></tr><tr ><td class="posttext"> please excuse my beginner questions!  (it seems like we need a multi-threaded group for this wrapper, not just one thread!)<br><br>if i have a level made of various objects, and i want my car to interact with them, i need to make all those objects be handled by ODE, is that not correct? <br><br>is there something in ODE that keeps it from running unecessary collision calculations when objects are nowhere near each other?  i would *assume* so.. <br><br></td></tr></table><br>
<a name="491370"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#100">[#100]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, let ODE handle your objects.<br><br>Yes, there are several somethings in ODE to keep unnessasary  calculations in check.<br><br>; First, inform ODE your going to disable objects once they become idle.<br>dWorldSetAutoDisableFlag (World, 1)<br><br>; Second, inform ODE which bodies will be allowed to auto disable.<br>dBodySetAutoDisableFlag(ode\body,1)<br><br>; Third, optionally define what idle means.<br>dBodySetAutoDisableAngularThreshold(ode\body,.05)<br>dBodySetAutoDisableLinearThreshold(ode\body,.05)<br>dBodySetAutoDisableSteps (ode\body, 1)<br><br>; Lastly,  I modify the B3D routine UpdateGeoms so it doesnt do extra work.<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Function UpdateGeoms()
For ode.ODEGeom=Each ODEGeom
	If dBodyIsEnabled(ode\body)
		RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
		PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
	End If
Next
End Function
</textarea><br><br>The manual covers the topic very well:<br>-------------------------------------------<br><br>6.5. Automatic Enabling and Disabling<br>Every body can be enabled or disabled. Enabled bodies participate in the simulation, while disabled bodies are turned off and do not get updated during a simulation step. New bodies are always created in the enabled state.<br><br>A disabled body that is connected through a joint to an enabled body will be automatically re-enabled at the next simulation step.<br><br>Disabled bodies do not consume CPU time, therefore to speed up the simulation bodies should be disabled when they come to rest. This can be done automatically with the auto-disable feature.<br><br>If a body has its auto-disable flag turned on, it will automatically disable itself when<br><br>   1. It has been idle for a given number of simulation steps.<br>   2. It has also been idle for a given amount of simulation time. <br><br>A body is considered to be idle when the magnitudes of both its linear velocity and angular velocity are below given thresholds.<br><br>Thus, every body has five auto-disable parameters: an enabled flag, a idle step count, an idle time, and linear/angular velocity thresholds. Newly created bodies get these parameters from world.<br><br>The following functions set and get the enable/disable parameters of a body.<br><br>void dBodyEnable (dBodyID);<br>void dBodyDisable (dBodyID);<br><br>Manually enable and disable a body. Note that a disabled body that is connected through a joint to an enabled body will be automatically re-enabled at the next simulation step.<br><br>int dBodyIsEnabled (dBodyID);<br><br>Return 1 if a body is currently enabled or 0 if it is disabled.<br><br>void  dBodySetAutoDisableFlag (dBodyID, int do_auto_disable);<br>int   dBodyGetAutoDisableFlag (dBodyID);<br><br>Set and get the auto-disable flag of a body. If the do_auto_disable is nonzero the body will be automatically disabled when it has been idle for long enough.<br><br>void  dBodySetAutoDisableLinearThreshold (dBodyID, dReal linear_threshold);<br>dReal dBodyGetAutoDisableLinearThreshold (dBodyID);<br><br>Set and get a body's linear velocity threshold for automatic disabling. The body's linear velocity magnitude must be less than this threshold for it to be considered idle. Set the threshold to dInfinity to prevent the linear velocity from being considered.<br><br>void  dBodySetAutoDisableAngularThreshold (dBodyID, dReal angular_threshold);<br>dReal dBodyGetAutoDisableAngularThreshold (dBodyID);<br><br>Set and get a body's angular velocity threshold for automatic disabling. The body's linear angular magnitude must be less than this threshold for it to be considered idle. Set the threshold to dInfinity to prevent the angular velocity from being considered.<br><br>void  dBodySetAutoDisableSteps (dBodyID, int steps);<br>int   dBodyGetAutoDisableSteps (dBodyID);<br><br>Set and get the number of simulation steps that a body must be idle before it is automatically disabled. Set this to zero to disable consideration of the number of steps.<br><br>void  dBodySetAutoDisableTime (dBodyID, dReal time);<br>dReal dBodyGetAutoDisableTime (dBodyID);<br><br>Set and get the amount of simulation time that a body must be idle before it is automatically disabled. Set this to zero to disable consideration of the amount of simulation time.<br><br>void  dBodySetAutoDisableDefaults (dBodyID);<br><br>Set the auto-disable parameters of the body to the default parameters that have been set on the world. <br><br></td></tr></table><br>
<a name="492038"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >CopperCircle</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#101">[#101]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi, just started using this wrapper and it seems very stable :)<br>I wondered if anyone knows a good way to push/pull an ODE object around, I want to be able to slide a rectangle over a plane by pushing/pulling? <br><br></td></tr></table><br>
<a name="492050"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#102">[#102]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi CopperCircle,<br><br>Yeah, you can do that by adding force to the object like so... dBodyAddForce(ode\body,10,0,0). You would also need to set the world friction quite low to stop it dragging too much, which will cause it to roll over.<br><br>There are a number of commands related to moving an object like this:<br>dBodyAddForce(ode\body,fx#,fy#,fz#)<br>dBodyAddTorque(ode\body,fx#,fy#,fz#)<br>dBodyAddRelForce(ode\body,fx#,fy#,fz#)<br>dBodyAddRelTorque(ode\body,fx#,fy#,fz#)<br>dBodyAddForceAtPos(ode\body,fx#,fy#,fz#,px#,py#,pz#)<br>dBodyAddForceAtRelPos(ode\body,fx#,fy#,fz#,px#,py#,pz#)<br>dBodyAddRelForceAtPos(ode\body,fx#,fy#,fz#,px#,py#,pz#)<br>dBodyAddRelForceAtRelPos(ode\body,fx#,fy#,fz#,px#,py#,pz#)<br><br><b>Feedback Needed:</b><br>There have been a small number of reports where users are getting 'userlib function not found' errors on the World=WorldCreate line of the restricted demo version. I'm looking into this, but it would be very helpful if anyone who has experienced this problem could give me some feedback. As soon as I have more info on this, I'll post an update here...<br><br>More soon :) <br><br></td></tr></table><br>
<a name="492308"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JaviCervera</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#103">[#103]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, all the new collision stuff is ready.<br><br>It should have taken less time to finish, but it seems it was a problem with the std::vector object in Dev-C++, which I used to store the list of collision points. Two days ago, a new version of Dev-C++ (4.9.9.2) were released. I installed it and everything compiled fine, so I could finish the functions.<br><br>I have just sent the new update to VIP3R. If he says it is OK to release, I'll make a new .zip file and send it to everyone.<br><br>The list of functions to get detailed collision information is as follows:<br><br><pre class=code>dGeomCountCollisions%(geom)		;Number of collisions the geom got in the last dSpaceCollide()
dGeomCollisionGeom%(geom,index)		;The geom with which this geom has collided. Index starts at '1'
dGeomCollisionX#(geom,index)		;Global X coordinate where the collision occured
dGeomCollisionY#(geom,index)		;Global Y coordinate where the collision occured
dGeomCollisionZ#(geom,index)		;Global Z coordinate where the collision occured
dGeomCollisionNX#(geom,index)		;X component of the collision normal
dGeomCollisionNY#(geom,index)		;Y component of the collision normal
dGeomCollisionNZ#(geom,index)		;Z component of the collision normal
dGeomCollisionDepth#(geom,index)	;Depth of the collision</pre> <br><br></td></tr></table><br>
<a name="492311"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mustang</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#104">[#104]</a></td></tr></table></td></tr><tr ><td class="posttext"> Coolness! Does it include also somekind of a demo-let that shows all these new collision stuff in action? <br><br></td></tr></table><br>
<a name="492352"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#105">[#105]</a></td></tr></table></td></tr><tr ><td class="posttext"> This modified sphere demo lets you push and pull the balls around with the mouse. Also demonstrates the autodisable feature to reduce physics overhead.<br><br>enjoy<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #									   JV-ODE - Spheres Demo										#
; #									Code by Jim Williams (VIP3R)									#
; ###################################################################################################

AppTitle "JV-ODE - Spheres Mouse Shot Demo"

Global snd1, piv1


Include "ode.bb"

Graphics3D 800,600,0,2



Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

; ###################################################################################################

;snd1=Load3DSound("Bounce.wav")
;piv1=CreatePivot()

; ### Setup ODE

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetGravity(World,0,-1,0)
dContactSetMode(dContactBounce + ContactSoftERP + dContactSoftCFM)
dContactSetMu(32)

; Autodisable bodies
dWorldSetAutoDisableFlag (World, 1)

; Increase to make bouncy
dContactSetBounce(0.3)

; Make contact surface soft
;dContactSetSoftERP(0.4)
;dContactSetSoftCFM(0.8)


; ### Create light

ShowPointer

Global Light=CreateLight()

RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera

Global Camera=CreateCamera()
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000

;mic1=CreateListener(camera) ; Create listener, make it child of camera 

PositionEntity Camera,0,20,-50
RotateEntity Camera,30,0,0

; ### Create plane

dCreatePlane(Space,0,1,0,0)

Plane=CreatePlane()

EntityAlpha Plane,0.8

PlaneTexture=CreateTexture(128,128,9)

ClsColor 0,200,80
Cls

Color 255,255,255

Rect 0,0,64,64,1
Rect 64,64,64,64,1

CopyRect 0,0,128,128,0,0,BackBuffer(),TextureBuffer(PlaneTexture)
ScaleTexture PlaneTexture,20,20
EntityTexture Plane,PlaneTexture,0,0

Mirror=CreateMirror()

; ###################################################################################################

While Not KeyHit(1)

	PTime=MilliSecs()

	dSpaceCollide(Space,World,ContactGroup)
	UpdateFriction
	
	dWorldQuickStep(World,0.1)
	
	
	dJointGroupEmpty(ContactGroup)

	If MilliSecs()-Timer&gt;700
		balls=balls+1
		If balls&lt;10 Then
				AddObject()
		End If
		Timer=MilliSecs()
		End If

	UpdateGeoms()

	PhysicsTime#=MilliSecs()-PTime

	UpdateWorld

	RenderWorld

	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime
	Text 0,35,"LM Push: "
	Text 0,50,"RM Pull: "
 


	Flip
	
	
	; Push on the ball based on the entitypicked vector
	If MouseDown(1) Then 
	
		CameraPick(camera, MouseX(), MouseY())
		
		If PickedEntity()&lt;&gt;0 Then
			EntityColor PickedEntity(),0,255,0
			For ode.ODEGeom=Each ODEGeom
				If ode\mesh=PickedEntity()
					dBodyEnable(ode\body) 
					k=-10
					dBodyAddForce ode\body,k*PickedNX#(),k*PickedNY#(),k*PickedNZ#()
					Exit
				End If
			Next
		End If
	End If
	
	; Pull on the ball based on the entitypicked vector
	If MouseDown(2) Then 
	
		CameraPick(camera, MouseX(), MouseY())
		
		If PickedEntity()&lt;&gt;0 Then
			EntityColor PickedEntity(),0,255,0
			For ode.ODEGeom=Each ODEGeom
				If ode\mesh=PickedEntity()
					dBodyEnable(ode\body) 
					k=10
					dBodyAddForce ode\body,k*PickedNX#(),k*PickedNY#(),k*PickedNZ#()
					Exit
				End If
			Next
		End If
	End If

	

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function AddObject()

xp=Rand(-8,8)
zp=Rand(-8,8)
ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp,30,zp)
ode\geom=dCreateSphere(Space,3)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateSphere()
ScaleMesh ode\mesh,3,3,3
EntityColor ode\mesh,Rand(255),Rand(255),Rand(255)
EntityAlpha ode\mesh,1
EntityShininess ode\mesh,0.7

;Set Autodisable parms to your liking
	dBodySetAutoDisableFlag(ode\body,1)
	dBodySetAutoDisableAngularThreshold(ode\body,.05)
	dBodySetAutoDisableLinearThreshold(ode\body,.05)
	dBodySetAutoDisableSteps (ode\body, 1)

;Allow sphere to be picked
EntityPickMode ode\mesh,2

End Function

; ###################################################################################################

Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
If dBodyIsEnabled(ode\body)
	RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
	PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
Else
	EntityColor ode\mesh,255,0,0
End If
Next

End Function

; ###################################################################################################

Function AngularDamp(body,damp#)
  dBodyAddTorque body,dBodyGetAngularVelX(body)*-damp,dBodyGetAngularVelY(body)*-damp,dBodyGetAngularVelZ(body)*-damp
End Function

; ###################################################################################################

Function LinearDamp(body,damp#)
  dBodyAddForce body,dBodyGetLinearVelX(body)*-damp,dBodyGetLinearVelY(body)*-damp,dBodyGetLinearVelZ(body)*-damp
End Function

; ###################################################################################################

Function UpdateFriction()

For ode.ODEGeom=Each ODEGeom
	If dBodyIsEnabled(ode\body)
		numjoints=dBodyGetNumJoints(ode\body)
		If numjoints&gt;0 
		
			For joints=0 To numjoints-1
				joint=dBodyGetJoint(ode\body,joints)
				If dJointGetType(joint)=dJointTypeContact
					
					; Get linear velocity vector
			  		ax#=dBodyGetLinearVelX#(ode\body)
			  		ay#=dBodyGetLinearVelY#(ode\body)
				    az#=dBodyGetLinearVelZ#(ode\body)
					; Get Angular velocity vector
			  		bx#=dBodyGetAngularVelX#(ode\body)
			  		by#=dBodyGetAngularVelY#(ode\body)
					bz#=dBodyGetAngularVelZ#(ode\body)
			  		; Calculate magnitudes
					ForceA#=Sqr(ax*ax+ay*ay+az*az)
					ForceB#=Sqr(bx*bx+by*by+bz*bz)
					
					
					If ForceA&gt;.01
						LinearDamp(ode\body,.08)
					End If
					
	
					If ForceB&gt;.01
						AngularDamp(ode\body,.08)
					End If
					
				End If
			Next
		End If
	End If
Next

End Function
</textarea> <br><br></td></tr></table><br>
<a name="492368"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#106">[#106]</a></td></tr></table></td></tr><tr ><td class="posttext"> Bah, I've downloaded the new C++ compiler and it's broken (the compiler not the wrapper) :/<br><br>As soon as I've got it working again (shouldn't take very long) I'll test the new dll to make sure everything is ok.<br><br>Once I've done this I'll get back to Jedive and give him the green light for release.<br><br>@Mustang: Yeah, we'll be adding some new demos to show the new collision and contact stuff.<br><br>We can either release the update now (once tested) without the new demos, and release the demos in a few days.<br><br>Or...<br><br>We can get the demos ready first, then release the whole thing early next week.<br><br>Whatever you guys are happy with... let us know :) <br><br></td></tr></table><br>
<a name="492372"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#107">[#107]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'll take the code now and demos next week.<br>Keep it flowing man..<br><br>8) <br><br></td></tr></table><br>
<a name="492502"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mustang</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#108">[#108]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah, release the stuff now and add demos later... although I personally would like to get my hands on those contact / collision demos very much since I'd like to see how to do those properly with JV-ODE. <br><br></td></tr></table><br>
<a name="492623"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#109">[#109]</a></td></tr></table></td></tr><tr ><td class="posttext"> SEND THE CODE !<br><br>Collision stuff looks simple to me.<br>8) <br><br></td></tr></table><br>
<a name="492629"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#110">[#110]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, once I'm done testing the new version will be released without the demos initially, as long as Jedive is ok with that.<br><br>I'm still having problems with the compiler at the moment, tried for several hours to get it working last night.<br><br>Hopefully this will be resolved very soon, I'll let you know how it goes later.<br><br>Btw, that pull/push demo is pretty cool Wayne, nice job ;) <br><br></td></tr></table><br>
<a name="492787"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#111">[#111]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry for the delay everyone.<br><br>Well the good news is I've finally managed to fix the broken compiler problem. The updated wrapper was causing a problem with the old compiler initially, so Jedive upgraded his compiler and found it cured the problem and of course advised I did the same. But after I did the upgrade it broke completely, which obviously meant I couldn't compile the new dll and test it. I've spent endless hours trying to sort it out without success, so in desperation I switched back to the old compiler to try and fix the problem Jedive originally had. I've finally figured out how to fix it so I can now test the dll properly. Now I remember why I hate C++ so much ;)<br><br>I've tested the new wrapper briefly and everything is looking great so far. The new collision and contact stuff appears to be working really well, Jedive has done a fantastic job!<br><br>I'm going to finish the testing over the next few hours and if all is well then we can get the new wrapper out sometime later today/tonight.<br><br>The new dll is slightly larger now (739KB) so I may try and compress it some more.<br><br>I'll post here as soon as I'm done... more soon :) <br><br></td></tr></table><br>
<a name="492889"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PsychicParrot</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#112">[#112]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm really excited about the next release :D<br><br>Can't wait!! <br><br></td></tr></table><br>
<a name="492890"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Alienforce</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#113">[#113]</a></td></tr></table></td></tr><tr ><td class="posttext"> Me to :D<br><br>Go VIP3R, Go VIP3R, Go VIP3R, Go Jedive,  Go Jedive ....<br><br>:)<br><br>/Alienforce <br><br></td></tr></table><br>
<a name="492894"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PsychicParrot</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#114">[#114]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, why we're all sitting quietly .. can anyone help me to understand mass settings on a sphere? I confused myself to levels of epic proportions!!<br><br>I got..<br><br>	mass=dMassCreate()<br>	dMassSetSphere(mass,1,0.7)<br>	dMassSetSphereTotal(mass,WMass,0.7)<br>	dBodySetMass(another\body,mass)<br>	dMassDestroy(mass)<br>	<br>I took that ^ from the car demo (one of the wheels) but when I try and pop it into my own game, where I have a sphere on a trimesh, the sphere instantly disappears into oblivion so I can't even see what it's doing! .. how does the dMassSetSphere and dMassSetSphereTotal commands work? What do they want from me? ;)<br><br>I can't seem to find anything in the ODE docs, so I just wonder what the params are .. which ones are weight and which are sizes?? Is that how it works? You create a mass object that you 'build' the same size as your physics obj, then apply the mass obj to the physics obj? :S &lt;pop goes my head&gt;<br><br>Any help anyone can give would be fantastic .. otherwise, I'll just carry on sitting here quietly ;)<br><br>Thanks!<br>Parrot. <br><br></td></tr></table><br>
<a name="492953"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#115">[#115]</a></td></tr></table></td></tr><tr ><td class="posttext"> @PsychicParrot: In the car demo the mass settings are like this...<br><br>dMassSetSphere(mass,1,0.7)<br>Here the '1' is the density of the sphere and the 0.7 is the radius of the sphere (same as the radius of the geom).<br><br>dMassSetSphereTotal(mass,WMass,0.7)<br>Here the 'WMass' is the total mass of the sphere and again the 0.7 is the total radius.<br><br>The only things you would need to adjust are the density, radius and total mass. If the sphere shoots off when hitting the TriMesh, either you have the mass or density set too high or too low. Don't forget the total mass is relative to the mass of all other objects and also relative to the gravity and world settings (including the TriMesh). I'll try and make a demo to explain this better over the coming days :)<br><br><br>I'm building the new update zip now so it should be ready in an hour or so, I'll post here later when it's released... :) <br><br></td></tr></table><br>
<a name="493023"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#116">[#116]</a></td></tr></table></td></tr><tr ><td class="posttext"> <b>JV-ODE Physics Wrapper V1.01 RELEASED!</b><br><br>Please check your inbox  ;)<br><br>I've sent out an email to every user. If for any reason you have not received it, please let me know.<br><br>Have fun :) <br><br></td></tr></table><br>
<a name="493036"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#117">[#117]</a></td></tr></table></td></tr><tr ><td class="posttext"> WooHoo! The list of changes looks great. <br>The demos look nice and clean, great job.<br><br>I'll be hacking on the demos shortly to show off some interesting effects. Also looking forward to cubes and cylinders with trimesh.<br><br>Great going guys, I'm really sold on this purchase and can't imagine anyone not taking advantage of this. I hope this will work with BlitzMax too, or I'll have to buy it again.<br>8)<br><br>I can't wait to try the new stuff. <br><br>Thanks Jedive and Vip3r<br><br><br>Heres a recap of the changes:<br>JV-ODE Physics Wrapper<br><br>Version History<br><br>Note: The current TriMesh/Cylinder issues will be worked on for the next release. With the new collision functions added in V1.01, these issues could be resolved by using a 3rd party collision system if preferred.<br><br>### Version 1.01 ###<br><br>Functions added in V1.01:<br><br>### Wrapper<br>--- Now you can set contact parameters per geom, instead of global ones ---<br>dGeomContactSetMode(geom,mode)<br>dGeomContactGetMode%(geom)<br>dGeomContactSetMu(geom,mu#)<br>dGeomContactGetMu#(geom)<br>dGeomContactSetMu2(geom,mu#)<br>dGeomContactGetMu2#(geom)<br>dGeomContactSetBounce(geom,bounce#)<br>dGeomContactGetBounce#(geom)<br>dGeomContactSetBounceVel(geom,vel#)<br>dGeomContactGetBounceVel#(geom)<br>dGeomContactSetSoftERP(geom,erp#)<br>dGeomContactGetSoftERP#(geom)<br>dGeomContactSetSoftCFM(geom,cfm#)<br>dGeomContactGetSoftCFM#(geom)<br>dGeomContactSetMotion1(geom,motion#)<br>dGeomContactGetMotion1#(geom)<br>dGeomContactSetMotion2(geom,motion#)<br>dGeomContactGetMotion2#(geom)<br>dGeomContactSetSlip1(geom,slip#)<br>dGeomContactGetSlip1#(geom)<br>dGeomContactSetSlip2(geom,slip#)<br>dGeomContactGetSlip2#(geom)<br>dGeomContactSetDefaults(geom)<br><br>--- Added functions to get detailed collision information ---<br>dGeomCountCollisions%(geom)	; # Number of collisions the geom got in the last dSpaceCollide()<br>dGeomCollisionGeom%(geom,index)	; # The geom with which this geom has collided. Index starts at '1'<br>dGeomCollisionX#(geom,index)	; # Global X coordinate where the collision occurred<br>dGeomCollisionY#(geom,index)	; # Global Y coordinate where the collision occurred<br>dGeomCollisionZ#(geom,index)	; # Global Z coordinate where the collision occurred<br>dGeomCollisionNX#(geom,index)	; # X component of the collision normal<br>dGeomCollisionNY#(geom,index)	; # Y component of the collision normal<br>dGeomCollisionNZ#(geom,index)	; # Z component of the collision normal<br>dGeomCollisionDepth#(geom,index)	; # Depth of the collision<br><br>### Blitz Demos<br>Corrected all older demos (bounce / auto disable / main loop)<br>Added new AutoDisable demo<br>Added new BouncyWorld demo<br>Added new CarDemo(AutoD) showing how to add body auto disable when static objects are used<br>Added new CarDemo(CCount) showing basic collision counting of geoms<br>Added new Rope demo<br>Many more demos are planned and will be released shortly...<br><br>### Version 1.00 ###<br><br>Initial Release<br><br><br>Copyright  2005 - Javier San Juan Cervera &amp; Jim Williams <br><br></td></tr></table><br>
<a name="493057"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mustang</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#118">[#118]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wow - cooooooooool! This is looking SO nice update... have to fire up my main PC, I'm on my laptop right now (no email or Blitz in it). This collision stuff is really important, I have many planned uses for it... just have see if those can be done. Great job! <br><br>One thing that's good too IMO about JV-ODE is all those demos; I do use physics engines at work but our coders have smoothed the burden of setting low-level settings and stuff considerably and I usually tweak just very few values / settings via script files... so although I know how physics engines work, JV-ODE is the first time for me when I can / have to do low-level set-ups and such... so good demos are very important to me even if I already have years of "experience" (3DMark2001 car gamelet was my first physics enabled game I have "made"). So please, keep those demos coming, they are very valuable! <br><br></td></tr></table><br>
<a name="493059"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#119">[#119]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wow, this is really good stuff. <br><br></td></tr></table><br>
<a name="493066"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Alienforce</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#120">[#120]</a></td></tr></table></td></tr><tr ><td class="posttext"> Great! wow! This is really looking good..<br><br>/Alienforce <br><br></td></tr></table><br>
<a name="493151"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PsychicParrot</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#121">[#121]</a></td></tr></table></td></tr><tr ><td class="posttext"> Awesome update, guys :) I'm having a blast!<br><br>Thanks for the help on the mass stuff, Viper - I'll have a proper play in a min.<br><br>Keep up the great work! <br><br></td></tr></table><br>
<a name="493172"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Opcode</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#122">[#122]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nice work guys :) downloaded the update this morning thanks.<br><br>cheers,<br>Lee. <br><br></td></tr></table><br>
<a name="493525"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paolo</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#123">[#123]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the demos guys, they seem to be pretty stable.<br><br>You know, I sooo much would like to start a new project.<br>I would like to do a cartoonish game including crazy<br>physic everywhere!, but I must finish my other thing first..<br><br>Do you remember that cartoon taxi car in the Roger Rabbit film? I loved it :)<br>Have a look a this demo, it is a modified version of<br>the car demo, I hope you don't mind guys<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #										  JV-ODE Car Demo											#
; #									Code by Jim Williams (VIP3R)									#		#
; #						Feel free to use this code, any credit appreciated							#
; ###################################################################################################

AppTitle "JV-ODE Car Demo"

Include "ode.bb"

Graphics3D 640,480,16,2

Const FPS=60

Global CMass#=200			; ### Car Mass
Global WMass#=28				; ### Wheel Mass

Global WorldERP#=1			; ### World Error Correction
Global WorldFriction#=64	; ### World Friction
Global HingeTorque#=64		; ### Hinge Torque
Global SuspensionHS#=0.06	; ### Hinge Suspension Hardness/Softness (Higher=Softer - Lower=Harder)

Global Speed#=0
Global Steer#=0

Global Car
Global CGeom
Global CMesh

Global CarStartY=20

Dim Wheel(4)
Dim WGeom(4)
Dim Joint(4)

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

; ###################################################################################################

; ### Setup ODE

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetGravity(World,0,-1,0)
dWorldSetERP(World,WorldERP)

dContactSetMode(dContactSlip1)
dContactSetMu(WorldFriction)

; ### Create car body

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
Car=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,0,CarStartY,0)
mass=dMassCreate()
dMassSetBox(mass,1,3,4,8)
dMassSetBoxTotal(mass,CMass,3,4,8)
dMassTranslate(mass,0,-1,0)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
ode\geom=dCreateBox(Space,3,4,8)
CGeom=ode\geom
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
CMesh=ode\mesh
ScaleMesh ode\mesh,1.5,2,4
RotateMesh ode\mesh,0,0,0
PositionMesh ode\mesh,0,0,0
EntityColor ode\mesh,40,80,255
EntityAlpha ode\mesh,1

; ### Create wheels

For count=1 To 4
ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
		Wheel(count)=ode\body
		dBodySetRotation(ode\body,0,0,0)
		dBodySetPosition(ode\body,0,0,0)
	mass=dMassCreate()
		dMassSetSphere(mass,1,0.7)
		dMassSetSphereTotal(mass,WMass,0.7)
		dBodySetMass(ode\body,mass)
		dMassDestroy(mass)
	ode\geom=dCreateSphere(Space,1.5)
		WGeom(count)=ode\geom
		dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder(8)
		ScaleMesh ode\mesh,1.5,1.25,1.5
		RotateMesh ode\mesh,0,0,90
		PositionMesh ode\mesh,0,0,0
		EntityColor ode\mesh,255,255,255
Next

dBodySetPosition(Wheel(1),-3,CarStartY-2.5,+3)
dBodySetPosition(Wheel(2),+3,CarStartY-2.5,+3)
dBodySetPosition(Wheel(3),-3,CarStartY-2.5,-3)
dBodySetPosition(Wheel(4),+3,CarStartY-2.5,-3)

; ### Create some objects

SeedRnd MilliSecs()

For spheres=1 To 20
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	dBodySetRotation(ode\body,0,0,0)
	dBodySetPosition(ode\body,Rnd(-100,100),30,Rnd(-100,100))
	ode\geom=dCreateSphere(Space,4)
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateSphere()
	ScaleMesh ode\mesh,4,4,4
	RotateMesh ode\mesh,0,0,0
	PositionMesh ode\mesh,0,0,0
	EntityColor ode\mesh,Rnd(255),Rnd(255),Rnd(255)
	EntityAlpha ode\mesh,1
	EntityShininess ode\mesh,0.7
Next

For cylinders=1 To 20
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	dBodySetRotation(ode\body,90,0,0)
	dBodySetPosition(ode\body,Rnd(-100,100),30,Rnd(-100,100))
	ode\geom=dCreateCCylinder(Space,1,8)
	dGeomSetBody(ode\geom,ode\body)

	ode\mesh=CreateCylinder(8)
	ScaleMesh ode\mesh,1,5,1
	RotateMesh ode\mesh,90,0,0	; &lt;&lt;&lt; Mesh X-Axis must be rotated 90 degrees to fix cylinder alignment
	PositionMesh ode\mesh,0,0,0
	EntityColor ode\mesh,Rnd(255),Rnd(255),Rnd(255)
	EntityAlpha ode\mesh,1
	EntityShininess ode\mesh,0.7
Next

; ### Create light

Global Light=CreateLight()

RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera

Global CameraPivot=CreatePivot(CMesh)
PositionEntity CameraPivot,0,2,-7

Global Camera=CreateCamera()
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000

; ### Create plane

dCreatePlane(Space,0,1,0,0)

Plane=CreatePlane()

EntityAlpha Plane,0.8

PlaneTexture=CreateTexture(128,128,9)

ClsColor 0,200,80
Cls

Color 255,255,255

Rect 0,0,64,64,1
Rect 64,64,64,64,1

CopyRect 0,0,128,128,0,0,BackBuffer(),TextureBuffer(PlaneTexture)
ScaleTexture PlaneTexture,20,20
EntityTexture Plane,PlaneTexture,0,0

;Mirror=CreateMirror()

; ###################################################################################################

; ### BLITZ STATIC OBJECT (White)

blitzobject=CreateCube()
ScaleMesh blitzobject,1,4,20
RotateMesh blitzobject,-10,8,4
PositionMesh blitzobject,10,5,40

EntityColor blitzobject,255,255,255
EntityAlpha blitzobject,1

; ### ODE STATIC OBJECT (Blue)

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,2,8,40)
dGeomSetRotation(ode\geom,-10,8,4)
dGeomSetPosition(ode\geom,20,5,40)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,1,4,20
RotateMesh ode\mesh,0,0,0
PositionMesh ode\mesh,0,0,0

EntityColor ode\mesh,0,100,200
EntityAlpha ode\mesh,1

; ### ODE STATIC OBJECT (Red)

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,18,0.2,40)
dGeomSetRotation(ode\geom,-14,0,0)
dGeomSetPosition(ode\geom,-20,4.9,40)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,9,0.1,20
RotateMesh ode\mesh,0,0,0
PositionMesh ode\mesh,0,0,0

EntityColor ode\mesh,200,0,100
EntityAlpha ode\mesh,1

; ###################################################################################################

SetupCar()


period=1000/FPS
time=MilliSecs()-period


While Not KeyHit(1)

Repeat
	elapsed=MilliSecs()-time
Until elapsed

;how many 'frames' have elapsed	
ticks=elapsed/period

;fractional remainder
tween#=Float(elapsed Mod period)/Float(period)

For k=1 To ticks
	time=time+period
	If k=ticks Then CaptureWorld

	UpdateKeys()

	PTime=MilliSecs()

	UpdateCar()

	UpdateGeoms()

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)

	PhysicsTime#=MilliSecs()-PTime

	UpdateCam()

	UpdateWorld
Next

	RenderWorld tween

	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime
	Text 0,30,"Car Speed:"+Speed
	Text 640,0,"A - Accelerate"
	Text 640,15,"Z - Brake/Reverse"
	Text 640,30,"Arrows - Steering"
	Text 640,45,"Space - Reset Car"
	Text 340,0,"Demo Time:"+dDemoTime()
	If dDemoTime()=0 Then Text 240,80,"*** TIME EXPIRED PLEASE RESTART DEMO ***"

	If KeyHit(17) w=Not w WireFrame w
	
	Flip

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

MoveMouse 400,300:End

; ###################################################################################################

Function SetupCar()

For count=1 To 4
	Joint(count)=dJointCreateHinge2(World,0)
	dJointAttach(Joint(count),Car,Wheel(count))
	dJointSetHinge2Anchor(Joint(count),dBodyGetPositionX(Wheel(count)),dBodyGetPositionY(Wheel(count)),dBodyGetPositionZ(Wheel(count)))
	dJointSetHinge2Axis1(Joint(count),0,1,0)
	dJointSetHinge2Axis2(Joint(count),-1,0,0)
	dJointSetHinge2Param(Joint(count),dParamSuspensionERP,0.8)
	dJointSetHinge2Param(Joint(count),dParamSuspensionCFM,SuspensionHS)
	If count&gt;2
		dJointSetHinge2Param(Joint(count),dParamLoStop,0)
		dJointSetHinge2Param(Joint(count),dParamHiStop,0)
	EndIf
Next

Speed=0

End Function

; ###################################################################################################

Function UpdateKeys()

If KeyDown(30)=1
	Speed=Speed+0.08
	If Speed&gt;10 Then Speed=10
EndIf

If KeyDown(44)=1
	Speed=Speed-0.1
	If Speed&lt;-10 Then Speed=-10
	If Speed&gt;0 Then Speed=Speed*0.97
EndIf

If KeyDown(31) ;S
	speed=0
	For count=1 To 2
		dJointSetHinge2Param(Joint(count),dParamVel2,0)
		dJointSetHinge2Param(Joint(count),dParamFMax2,0)
	Next
	For count=1 To 2
		angle#=Steer-dJointGetHinge2Angle1(Joint(count))
		dJointSetHinge2Param(Joint(count),dParamVel,angle)
		dJointSetHinge2Param(Joint(count),dParamFMax,0)
	Next
EndIf

If KeyDown(30)=0 And KeyDown(44)=0 Then Speed=Speed*0.99

If KeyDown(203)=1 Or KeyDown(205)=1
	If KeyDown(203)=1
		Steer=0.5
		Else
		Steer=-0.5
		End If
	Else
	Steer=0
	End If

If KeyHit(57)=1
	Speed=0
	dBodySetRotation Car,0,0,0
	dBodySetTorque Car,0,0,0
EndIf

End Function

; ###################################################################################################

Function UpdateCar()

For count=1 To 4
	dBodyEnable(Wheel(count))
Next

dBodyEnable(Car)

For count=1 To 2
	dJointSetHinge2Param(Joint(count),dParamVel2,Speed)
	dJointSetHinge2Param(Joint(count),dParamFMax2,HingeTorque)
Next

For count=1 To 2
	angle#=Steer-dJointGetHinge2Angle1(Joint(count))
	dJointSetHinge2Param(Joint(count),dParamVel,angle)
	dJointSetHinge2Param(Joint(count),dParamFMax,400)
Next

End Function

; ###################################################################################################

Function UpdateCam()

PositionEntity CameraPivot,0,10,-12

camx#=(EntityX(CameraPivot,1)-EntityX(Camera))/60
camy#=(EntityY(CameraPivot,1)-EntityY(Camera))/60
camz#=(EntityZ(CameraPivot,1)-EntityZ(Camera))/60

TranslateEntity Camera,camx,camy,camz
;PositionEntity camera,10,20,65

PointEntity Camera,CMesh

End Function

; ###################################################################################################

Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
	RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
	PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
Next

End Function

; ###################################################################################################
</textarea> <br><br></td></tr></table><br>
<a name="493968"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DH</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#124">[#124]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Eurythmia <br><br>When you hit the space key on your demo (after the first reset) the car will spin and disassemble itself into nothing. <br><br></td></tr></table><br>
<a name="494106"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >HNPhan</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#125">[#125]</a></td></tr></table></td></tr><tr ><td class="posttext"> when are u guys gonna release a full demo of physics on a static mesh, this will be the crucial factor for me on using this physique module. <br><br></td></tr></table><br>
<a name="494445"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#126">[#126]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Eurythmia: We don't mind you playing around with the demos, that's what they're there for - enjoy ;)<br><br>@TigerZ: There is already a demo showing static mesh collisions, check out the Car Demo of the restricted version.<br><br>If you meant a TriMesh demo, this isn't available in the restricted version. There are no plans to add TriMesh stuff to the restricted version at the moment as this is a more advanced feature. The restricted version is intended to show the basics only.<br><br>Also, there are currently issues related to the TriMesh, take a look at the 'Known Issues' segment in the top post of this thread. <br><br></td></tr></table><br>
<a name="494557"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#127">[#127]</a></td></tr></table></td></tr><tr ><td class="posttext"> *stops counting* 2 minutes 3 seconds for this thread to load...... Time to start a new one? <br><br></td></tr></table><br>
<a name="494872"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#128">[#128]</a></td></tr></table></td></tr><tr ><td class="posttext"> How long? I'm on 56K modem here and it still loads faster than that :)<br><br>I'll create a new thread when this one hits around 140 posts...<br><br>There is now a dedicated forum area for JV-ODE at the Player Factory... thanks to Beaker!<br>Feel free to post anything JV-ODE related over there too.<br><br>You can find the Player Factory forums <a href="http://playerfactory.proboards25.com/index.cgi" target="_blank">here</a>. <br><br></td></tr></table><br>
<a name="494873"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#129">[#129]</a></td></tr></table></td></tr><tr ><td class="posttext"> Must just be the network at work :/ seems okay today, plus i noticed the posty count is only medium-high...<br><br>How long do you think those box&gt;trimesh cylinder&gt;trimesh issues will take to sus out? Im waiting to start Cygnus Car Engine v2. Great bit of work here though! <br><br></td></tr></table><br>
<a name="494876"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#130">[#130]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Cygnus :)<br><br>I'm not sure how long it will take to sort out the TriMesh stuff tbh. Hopefully not too long, I want to use them too ;)<br><br>I'm still working on the new collision/contact demos at the moment, as soon as those are out the way I can concentrate on the TriMesh problem. <br><br></td></tr></table><br>
<a name="494899"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#131">[#131]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okiedokie. I will stick with what ive got for now, and play with the car engine stuff. I Had some major issues with Arkons, seems to be gone here, but it needs a solid test ;)<br><br>Really, really enjoying this! <br><br></td></tr></table><br>
<a name="494998"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >CopperCircle</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#132">[#132]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi, I am loving the wrapper and find it very stable, just a couple of problems:<br> <br>1. When I try to use dWorldSetContactSurfaceLayer I get a Memory Access Violation.<br><br>2. How can I get a value out of dBodyGetForce etc... if I try to put the result into a variable I get Illegal Type Conversion.<br> <br>Cheers, keep up the good work. <br><br></td></tr></table><br>
<a name="495019"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#133">[#133]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi CopperCircle,<br><br>Ok, no problem.<br><br>1) You may be using dWorldSetContactSurfaceLayer incorrectly if it gives you a MAV (see code below)<br><br>2) Good question, dBodyGetForce along with some other functions don't return a value directly which is why you receive an Illegal Type Conversion error. You must call the function like this...<br><br>dBodyGetForce(ode\body)<br><br>Then you call the vector functions to return the value from the dBodyGetForce(ode\body) function...<br><br>forcex#=dVectorX()<br>forcey#=dVectorY()<br>forcez#=dVectorZ()<br><br>It's a little complicated at first, so I've modified the Rope Demo to show both the dWorldSetContactSurfaceLayer  and dBodyGetForce functions in action...<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #										 JV-ODE - Rope Demo											#
; #									Code by Jim Williams (VIP3R)									#
; ###################################################################################################

AppTitle "JV-ODE - Rope Demo"

Include "ode.bb"

Graphics3D 800,600,0,2

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

Dim Sphere(10)
Dim Joint(10)

; ###################################################################################################

; ### Setup ODE

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetContactSurfaceLayer(World,0.001)	; &lt;&lt;&lt; Increase to reduce jittery collisions (0.0=Default)

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,-1,0)
dContactSetMode(dContactBounce)
dContactSetBounce(0.1)
dContactSetMu(48)

; ### Create Rope

For count=1 To 10
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	Sphere(count)=ode\body
	dBodySetRotation(ode\body,0,0,0)
	dBodySetPosition(ode\body,-30,90-(count*8),0)
	dBodySetAutoDisableFlag(ode\body,1)
	ode\geom=dCreateSphere(Space,4)
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateSphere()
	ScaleMesh ode\mesh,4,4,4
	RotateMesh ode\mesh,0,0,0
	PositionMesh ode\mesh,0,0,0
	EntityColor ode\mesh,Rand(255),Rand(255),Rand(255)
	EntityAlpha ode\mesh,1
	EntityShininess ode\mesh,0.7
	Joint(count)=dJointCreateBall(World,0)
	If count=1
		dJointAttach(Joint(count),0,Sphere(count))
		Else
		dJointAttach(Joint(count),Sphere(count-1),Sphere(count))
		End If
	dJointSetBallAnchor(Joint(count),dBodyGetPositionX(Sphere(count)),dBodyGetPositionY(Sphere(count)),dBodyGetPositionZ(Sphere(count)))
Next

; ### Create light

Global Light=CreateLight()

RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera

Global Camera=CreateCamera()
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000
PositionEntity Camera,0,90,-100
RotateEntity Camera,30,0,0

; ### Create plane

dCreatePlane(Space,0,1,0,0)

Plane=CreatePlane()

EntityAlpha Plane,0.8

PlaneTexture=CreateTexture(128,128,9)

ClsColor 0,200,80
Cls

Color 255,255,255

Rect 0,0,64,64,1
Rect 64,64,64,64,1

CopyRect 0,0,128,128,0,0,BackBuffer(),TextureBuffer(PlaneTexture)
ScaleTexture PlaneTexture,20,20
EntityTexture Plane,PlaneTexture,0,0

Mirror=CreateMirror()

; ###################################################################################################

While Not KeyHit(1)

	UpdateKeys()

	dBodyGetForce(Sphere(10))	; &lt;&lt;&lt; Use after applying force and before UpdateGeoms()

	PTime=MilliSecs()

	If MilliSecs()-Timer&gt;700
		AddObject()
		Timer=MilliSecs()
		End If

	UpdateGeoms()

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)

	PhysicsTime#=MilliSecs()-PTime

	UpdateWorld

	RenderWorld

	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime
	Text 640,0,"Add Force To Rope"
	Text 640,15,"Using Arrow Keys"

	Text 0,40,"VectorX:"+dVectorX()		; &lt;&lt;&lt; Returned Vectors from dBodyGetForce()
	Text 0,55,"VectorY:"+dVectorY()
	Text 0,70,"VectorZ:"+dVectorZ()

	Text 0,95,"Contact Surface Layer:"+dWorldGetContactSurfaceLayer(World)

	Flip

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function AddObject()

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,30,80,0)
dBodySetAutoDisableFlag(ode\body,1)
ode\geom=dCreateBox(Space,10,5,10)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,5,2.5,5
EntityColor ode\mesh,Rand(255),Rand(255),Rand(255)
EntityAlpha ode\mesh,1
EntityShininess ode\mesh,0.7

End Function

; ###################################################################################################

Function UpdateKeys()

If KeyDown(203) Then dBodyAddForce(Sphere(10),-10,0,0)
If KeyDown(205) Then dBodyAddForce(Sphere(10),10,0,0)
If KeyDown(200) Then dBodyAddForce(Sphere(10),0,0,10)
If KeyDown(208) Then dBodyAddForce(Sphere(10),0,0,-10)

End Function

; ###################################################################################################

Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
	If dBodyIsEnabled(ode\body)
		RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
		PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
		End If
Next

End Function

; ###################################################################################################
</textarea><br><br>Let me know if you need any more help with this :) <br><br></td></tr></table><br>
<a name="495020"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#134">[#134]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm, i dont know why, but mine is freezing :'(<br><br>Im trying to create a cube, thats all :S <br><br></td></tr></table><br>
<a name="495023"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#135">[#135]</a></td></tr></table></td></tr><tr ><td class="posttext"> ; Retrieve Accumulated Force Vector<br>dbodygetforce(bodyid)<br>Fx#=dVectorX#()<br>Fy#=dVectorY#() <br>Fz#=dVectorZ#() <br><br></td></tr></table><br>
<a name="495025"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#136">[#136]</a></td></tr></table></td></tr><tr ><td class="posttext"> Can you post some code showing the problem Cygnus? <br><br></td></tr></table><br>
<a name="495035"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Chad</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#137">[#137]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey Viper,<br><br>I'm new to all this physics stuff, and I was wondering if you and I could just have a chat some weekday night (or weekend) and you just explain to me what I really need, the important stuff from beginning to finish, and then give me insight on how to set everything up and yadadada.  I just need someone to teach me one on one and answer questions I have.<br><br>If you would be willing to do this, please let me know, I'd really appreciate it, or know of someone who would do this for me.<br><br>Thanks,<br>Chad <br><br></td></tr></table><br>
<a name="495061"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#138">[#138]</a></td></tr></table></td></tr><tr ><td class="posttext"> Vip3r.. It seems to be me creating something wrong. I will look tomorow and update.<br><br>Basically, i upped the worldstep to double (and used proper worldstep) and when the car went upside down after jumping, it hung solid. I had to reboot. Same thing quite a few times.<br><br>i HAVE modified this code though, so before anyone starts thinking his stuffs unstable, its most likely my naff coder skills :P<br><br>All ive done is make a createobject function:<br><div class="quote"> <br>Function <br><br>createObject.ode_object(obtype,x#,y#,z#,Length#,height#,width#,mass#)<br> <br></div><br><br>compatible near enough with the original ode.<br>I make a single cube... and thats when the crashes happen.<br><br>IM using the standard car demo with this. <br><br></td></tr></table><br>
<a name="495081"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#139">[#139]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Chad,<br><br>I can try my best to help answer your questions, no problem. I'm a little too busy for a complete guide to ode at the moment though. Currently I'm working on the new demos and the TriMesh issues, once those are finally sorted out I'm planning on making some sort of beginners tutorial for JV-ODE. But if I can help with any questions in the meantime, feel free to post them here or at the Player Factory. It may also help others too, whereas the one on one tutorial wouldn't. If you haven't read it yet, take a look at the ODE User Guide (link in top post of this thread), it may also help you.<br><br>@Cygnus: dWorldStep() will make Windows curl up and die, I strongly recommend using dWorldQuickStep() instead. I haven't found any benefit from using the former, it just causes memory problems, hence the lock-up you had and it's slower (with only a slight increase in accuracy). <br><br></td></tr></table><br>
<a name="495116"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PsychicParrot</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#140">[#140]</a></td></tr></table></td></tr><tr ><td class="posttext"> * ERASED DUE TO MY OWN STUPIDITY! * <br><br></td></tr></table><br>
<a name="495122"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#141">[#141]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>dWorldStep() will make Windows curl up and die, I strongly recommend using dWorldQuickStep() <br> <br></div><br>with dworldquickstep, everything starts shivering like its got flu or somert :P so i had no choice.<br><br>....okay i just realised something<br><br>With the original ode wrapper i was calling my own update function; updatephysics(1). I assumed i had done it as a simple wrap to worldstep(1). nope.. i was dividing by ten. Thats much better, (update by .2 not 2!!!) :D<br><br>Problem sorted ^.^ <br><br></td></tr></table><br>
<a name="495129"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PsychicParrot</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#142">[#142]</a></td></tr></table></td></tr><tr ><td class="posttext"> Righty .. heres my little key controlled sphere thingy that I thought might be of use to someone :)<br><br>Use the arrow keys to move, space to 'jump'. This could easily be applied to a trimesh perhaps for some kind of physics-powered 3d platform game or similar .. ?? Any offers to do 3d platform game modelling to ... ;)<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; JV-ODE - Key Controlled Sphere Demo
; Code by Jim Williams (VIP3R)
; Arrow key control by Jeff (PsychicParrot)

AppTitle "JV-ODE - Key Controlled Sphere Demo"

Include "ode.bb"

Graphics3D 800,600,0,2

Type ODEGeom

	Field body
	Field geom
	Field mesh
	Field pivot ; To find direction vectors
	Field head  ; Just a stupid head to show which direction it's going in!
	Field inair ; To tell if player is on the ground or not!!
	
End Type

; ### Setup ODE

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,0)
dWorldSetGravity(World,0,-1,0)
dContactSetMode(dContactBounce)
dContactSetBounce(0.2)
dContactSetMu(48)

; ### Create light

Global Light=CreateLight()

RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera

Global Camera=CreateCamera()
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000
PositionEntity Camera,0,20,-50
RotateEntity Camera,30,0,0

; ### Control vars

Global potato#=0 ; y rotation of thingy (rotater,rotato,potato!!)
Global fwd_key
Global back_key
Global left_key
Global right_key
Global jump_key

; ### Create plane

dCreatePlane(Space,0,1,0,0)

Plane=CreatePlane()

EntityAlpha Plane,0.8

PlaneTexture=CreateTexture(128,128,9)

ClsColor 0,200,80
Cls

Color 255,255,255

Rect 0,0,64,64,1
Rect 64,64,64,64,1

CopyRect 0,0,128,128,0,0,BackBuffer(),TextureBuffer(PlaneTexture)
ScaleTexture PlaneTexture,20,20
EntityTexture Plane,PlaneTexture,0,0
EntityPickMode plane,2

Mirror=CreateMirror()

AddObject() ; Add our thingy to the world

While Not KeyHit(1)

	PTime=MilliSecs()

	; Update controls
	
	c.ODEGeom=First ODEGeom
	Getkeys(c)
	movethingy(c)
	lookforground(c)
	
	PointEntity (camera,c\mesh)
	
	UpdateGeoms()

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)

	PhysicsTime#=MilliSecs()-PTime

	UpdateWorld

	RenderWorld

	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime
	Text 0,25,"Player in the air:"+c\inair
	
	Flip

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

Function getkeys(c.ODEGeom)

	fwd_key=False
	back_key=False
	left_key=False
	right_key=False
	jump_key=False

	If c\inair=False Then ; Only let player control 'thrust' when on the ground
	
		If KeyDown(200) Then fwd_key=True
		If KeyDown(208) Then back_key=True

	EndIf
	
		If KeyDown(205) Then left_key=True
		If KeyDown(203) Then right_key=True
		If KeyDown(57) Then jump_key=True

	;EndIf

End Function

Function lookforground(c.ODEGeom)

	If LinePick(EntityX(c\mesh,True),EntityY(c\mesh,True)+1,EntityZ(c\mesh,True),0,-4,0)&lt;&gt;0 Then ; Check for anything 'under' player
		c\inair=False
	  Else
		c\inair=True
	EndIf

End Function

Function movethingy(c.ODEGeom)

	If fwd_key=True Then
		TFormVector 0,0,.8,c\pivot,0
		dBodyAddForce(c\body,TFormedX#(),TFormedY#() ,TFormedZ#() )
	EndIf

	If back_key=True Then
		TFormVector 0,0,-.8,c\pivot,0
		dBodyAddForce(c\body,TFormedX#(),TFormedY#() ,TFormedZ#() )
	EndIf
	
	If left_key=True Then
		potato=potato-2
	End If
	
	If right_key=True Then
		potato=potato+2
	End If

	If jump_key=True And c\inair=False Then		
		dBodyAddForce(c\body,0,16 ,0)		
	End If

End function

Function AddObject()

xp=Rand(-8,8)
zp=Rand(-8,8)
ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp,30,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\geom=dCreateSphere(Space,3)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateSphere()
ScaleMesh ode\mesh,3,3,3
EntityColor ode\mesh,Rand(255),Rand(255),Rand(255)
EntityAlpha ode\mesh,1
EntityShininess ode\mesh,0.7
ode\head=CreateCube()

ScaleMesh ode\head,1.5,1.5,1.5

ode\pivot=CreatePivot() ; Create pivot to get direction vectors

End Function


Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom

	;If dBodyIsEnabled(ode\body)
	
		RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
		PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
		PositionEntity ode\pivot,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
		PositionEntity ode\head,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom)+4.5,dGeomGetPositionZ#(ode\geom)

		RotateEntity ode\pivot,0,potato#,0
		RotateEntity ode\head,0,potato#,0
		
	;End If
	
Next

End Function

</textarea><br><br>Ta daaaa!<br><br>There does seem to be a problem with the autodisable, although it may be something I'm doing wrong. For seemingly no reason, ODE seems to disable to body sometimes, so I commented out the autodisable detect in the updategeoms and set autodisable to 0 in the 'world' settings. <br><br></td></tr></table><br>
<a name="495130"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#143">[#143]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nice one Mr P!<br><br>Marble-Madness 3D Here i come ;)<br><br>For issues with autodisable, set both the angle autodisable and linear autodisable threshhold so that you get full control ;) i have no problems with it :) <br><br></td></tr></table><br>
<a name="495140"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PsychicParrot</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#144">[#144]</a></td></tr></table></td></tr><tr ><td class="posttext"> Feel free to fix my code, mate ;) :p<br><br>Thanks Cy .. I'll attack it in a bit! <br><br></td></tr></table><br>
<a name="495148"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PsychicParrot</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#145">[#145]</a></td></tr></table></td></tr><tr ><td class="posttext"> And now .. a slightly different way of doing things, this time using angular velocities to move the ball around rather than forces. This allows a greater control of the ball.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; JV-ODE - Key Controlled Sphere Demo Using Angular Velocities
; Code by Jim Williams (VIP3R)
; Arrow key control by Jeff (PsychicParrot)

AppTitle "JV-ODE - Key Controlled sphere Demo"

Include "ode.bb"

Graphics3D 800,600,0,2

Type ODEGeom

	Field body
	Field geom
	Field mesh
	Field pivot ; To find direction vectors
	Field head  ; Just a stupid head to show which direction it's going in!
	Field inair ; To tell if player is on the ground or not!!
	
End Type

; ### Setup ODE

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetGravity(World,0,-1,0)
dContactSetMode(dContactBounce)
dContactSetBounce(0.2)
dContactSetMu(38)

; ### Create light

Global Light=CreateLight()

RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera

Global Camera=CreateCamera()
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000
PositionEntity Camera,0,20,-50
RotateEntity Camera,30,0,0

; ### Control vars

Global potato#=0 ; y rotation of thingy (rotater,rotato,potato!!)
Global spud#
Global fwd_key
Global back_key
Global left_key
Global right_key
Global jump_key

; ### Create plane

dCreatePlane(Space,0,1,0,0)

Plane=CreatePlane()

EntityAlpha Plane,0.8

PlaneTexture=CreateTexture(128,128,9)

ClsColor 0,200,80
Cls

Color 255,255,255

Rect 0,0,64,64,1
Rect 64,64,64,64,1

CopyRect 0,0,128,128,0,0,BackBuffer(),TextureBuffer(PlaneTexture)
ScaleTexture PlaneTexture,20,20
EntityTexture Plane,PlaneTexture,0,0
EntityPickMode plane,2

Mirror=CreateMirror()

AddObject() ; Add our thingy to the world

While Not KeyHit(1)

	PTime=MilliSecs()

	; Update controls
	
	c.ODEGeom=First ODEGeom
	Getkeys(c)
	movethingy(c)
	lookforground(c)
	
	PointEntity (camera,c\mesh)
	
	UpdateGeoms()

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.14)
	dJointGroupEmpty(ContactGroup)

	PhysicsTime#=MilliSecs()-PTime

	UpdateWorld

	RenderWorld

	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime

	Flip

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

Function getkeys(c.ODEGeom)

	fwd_key=False
	back_key=False
	left_key=False
	right_key=False
	jump_key=False

	If c\inair=False Then ; Only let player control 'thrust' when on the ground
	
		If KeyDown(200) Then fwd_key=True
		If KeyDown(208) Then back_key=True

	EndIf
	
		If KeyDown(205) Then left_key=True
		If KeyDown(203) Then right_key=True
		If KeyDown(57) Then jump_key=True

	;EndIf

End Function

Function lookforground(c.ODEGeom)

	If LinePick(EntityX(c\mesh,True),EntityY(c\mesh,True)+1,EntityZ(c\mesh,True),0,-4,0)&lt;&gt;0 Then ; Check for anything 'under' player
		c\inair=False
	  Else
		c\inair=True
	EndIf

End Function

Function movethingy(c.ODEGeom)

	If fwd_key=True Then
		spud=spud+.1
	EndIf

	If back_key=True Then
		spud=spud-.1
	EndIf
	
	If left_key=True Then
		potato=potato-2
	End If
	
	If right_key=True Then
		potato=potato+2
	End If

	If jump_key=True And c\inair=False Then		
		dBodyAddForce(c\body,0,16 ,0)		
	End If

	RotateEntity c\head,0,potato#,0
	
	; Add forward force

	TFormVector 0,0,spud,c\head,0
	
	vx# = dbodygetAngularvelx(c\body) + TFormedX()
	vy# = dbodygetAngularvely(c\body) + TFormedY()
	vz# = dbodygetAngularvelz(c\body) + TFormedZ()

	damping#=.8
	dbodysetAngularvel(c\body,vx#*damping#,vy#*damping#,vz#*damping#)

	spud=spud*.9
	
End Function

Function AddObject()

xp=Rand(-8,8)
zp=Rand(-8,8)
ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp,30,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\geom=dCreateSphere(Space,3)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateSphere()
ScaleMesh ode\mesh,3,3,3
EntityColor ode\mesh,Rand(255),Rand(255),Rand(255)
EntityAlpha ode\mesh,1
EntityShininess ode\mesh,0.7
ode\head=CreateCube()

ScaleMesh ode\head,1.5,1.5,1.5

ode\pivot=CreatePivot() ; Create pivot to get direction vectors

End Function


Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
	
		RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
		
		PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
		
		PositionEntity ode\head,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom)+4.5,dGeomGetPositionZ#(ode\geom)
	
Next

End Function
</textarea><br><br>Now using my newfound mega-code ;) I'll go away and make a game!!<br><br>:D<br><br>BTW: Thanks Cy for telling me about codebox :) <br><br></td></tr></table><br>
<a name="495150"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#146">[#146]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you still get problems with it i will be around perhaps on saturay a bit.<br><br>Lookin good there Mr P!<br><br>[edit]<br><br>This is the most amonut of times i've seen you post on this forum so far. you MUST be enjoying yourself!<br><br>[edit]<br>[codebox]<br>[ /codebox] <br><br></td></tr></table><br>
<a name="495214"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PsychicParrot</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#147">[#147]</a></td></tr></table></td></tr><tr ><td class="posttext"> Cy- I'm having a blast, mate! Reminds me of when I started messing around with Vordy's ODE lib .. I spent days watching things fall over then, too :) <br><br></td></tr></table><br>
<a name="495240"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#148">[#148]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>Cygnus: with dworldquickstep, everything starts shivering like its got flu or somert :P so i had no choice<br> <br></div><br>There are ways of preventing the 'jitters', but if you've got it working ok with dCreateWorld() then that's good news. Nice one ;)<br><br>@PsychicParrot: That demo is great! I'll bet that method could be useful in an FPS too :) <br><br></td></tr></table><br>
<a name="495510"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#149">[#149]</a></td></tr></table></td></tr><tr ><td class="posttext"> ....[edit]<br><br>I copied PsychicParrots Actions......... <br><br></td></tr></table><br>
<a name="495526"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#150">[#150]</a></td></tr></table></td></tr><tr ><td class="posttext"> PsychicParrot code updated to use autodisable, and added damping.<br><br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80"> 
; JV-ODE - Key Controlled Sphere Demo
; Code by Jim Williams (VIP3R)
; Arrow key control by Jeff (PsychicParrot)

AppTitle "JV-ODE - Key Controlled Sphere Demo"

Include "ode.bb"

Graphics3D 800,600,0,2

Type ODEGeom

	Field body
	Field geom
	Field mesh
	Field pivot ; To find direction vectors
	Field head  ; Just a stupid head to show which direction it's going in!
	Field inair ; To tell if player is on the ground or not!!
	
End Type

; ### Setup ODE

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,-1,0)
dContactSetMode(dContactBounce)
dContactSetBounce(0.2)
dContactSetMu(48)

; ### Create light

Global Light=CreateLight()

RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera

Global Camera=CreateCamera()
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000
PositionEntity Camera,0,20,-50
RotateEntity Camera,30,0,0

; ### Control vars

Global potato#=0 ; y rotation of thingy (rotater,rotato,potato!!)
Global fwd_key
Global back_key
Global left_key
Global right_key
Global jump_key

; ### Create plane

dCreatePlane(Space,0,1,0,0)

Plane=CreatePlane()

EntityAlpha Plane,0.8

PlaneTexture=CreateTexture(128,128,9)

ClsColor 0,200,80
Cls

Color 255,255,255

Rect 0,0,64,64,1
Rect 64,64,64,64,1

CopyRect 0,0,128,128,0,0,BackBuffer(),TextureBuffer(PlaneTexture)
ScaleTexture PlaneTexture,20,20
EntityTexture Plane,PlaneTexture,0,0
EntityPickMode plane,2

Mirror=CreateMirror()

AddObject() ; Add our thingy to the world

While Not KeyHit(1)

	PTime=MilliSecs()

	; Update controls
	
	c.ODEGeom=First ODEGeom
	Getkeys(c)
	movethingy(c)
	lookforground(c)
	
	PointEntity (camera,c\mesh)
	
	UpdateGeoms()

	dSpaceCollide(Space,World,ContactGroup)
	If Not c\inair updatefriction
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)

	PhysicsTime#=MilliSecs()-PTime

	UpdateWorld

	RenderWorld

	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime
	Text 0,25,"Player in the air:"+c\inair
	
	Flip

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

Function getkeys(c.ODEGeom)

	fwd_key=False
	back_key=False
	left_key=False
	right_key=False
	jump_key=False

	If c\inair=False Then ; Only let player control 'thrust' when on the ground
	
		If KeyDown(200) Then fwd_key=True
		If KeyDown(208) Then back_key=True

	EndIf
	
		If KeyDown(205) Then left_key=True
		If KeyDown(203) Then right_key=True
		If KeyDown(57) Then jump_key=True

	;EndIf

End Function

Function lookforground(c.ODEGeom)

	If LinePick(EntityX(c\mesh,True),EntityY(c\mesh,True)+1,EntityZ(c\mesh,True),0,-4,0)&lt;&gt;0 Then ; Check for anything 'under' player
		c\inair=False
	  Else
		c\inair=True
	EndIf

End Function

Function movethingy(c.ODEGeom)

	If fwd_key=True Then
		TFormVector 0,0,.8,c\pivot,0
		dBodyAddForce(c\body,TFormedX#(),TFormedY#() ,TFormedZ#() )
		dBodyEnable(c\body)
	EndIf

	If back_key=True Then
		TFormVector 0,0,-.8,c\pivot,0
		dBodyAddForce(c\body,TFormedX#(),TFormedY#() ,TFormedZ#() )
		dBodyEnable(c\body)
	EndIf
	
	If left_key=True Then
		potato=potato-2
		dBodyEnable(c\body)
	End If
	
	If right_key=True Then
		potato=potato+2
		dBodyEnable(c\body)
	End If

	If jump_key=True And c\inair=False Then		
		dBodyAddForce(c\body,0,16 ,0)		
		dBodyEnable(c\body)
	End If

End Function

Function AddObject()

xp=Rand(-8,8)
zp=Rand(-8,8)
ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp,30,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\geom=dCreateSphere(Space,3)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateSphere()
ScaleMesh ode\mesh,3,3,3
EntityColor ode\mesh,Rand(255),Rand(255),Rand(255)
EntityAlpha ode\mesh,1
EntityShininess ode\mesh,0.7
ode\head=CreateCube()

ScaleMesh ode\head,1.5,1.5,1.5

ode\pivot=CreatePivot() ; Create pivot to get direction vectors

;Set Autodisable parms to your liking
	dBodySetAutoDisableFlag(ode\body,1)
	dBodySetAutoDisableAngularThreshold(ode\body,.05)
	dBodySetAutoDisableLinearThreshold(ode\body,.05)
	dBodySetAutoDisableSteps (ode\body, 1)
End Function


Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom

	If dBodyIsEnabled(ode\body)
		EntityColor ode\mesh,0,255,0
		RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
		PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
		PositionEntity ode\pivot,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
		PositionEntity ode\head,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom)+4.5,dGeomGetPositionZ#(ode\geom)

		RotateEntity ode\pivot,0,potato#,0
		RotateEntity ode\head,0,potato#,0
		
	Else
		EntityColor ode\mesh,255,0,0
	End If
	
Next

End Function
; ###################################################################################################

Function AngularDamp(body,damp#)
  dBodyAddTorque body,dBodyGetAngularVelX(body)*-damp,dBodyGetAngularVelY(body)*-damp,dBodyGetAngularVelZ(body)*-damp
End Function

; ###################################################################################################

Function LinearDamp(body,damp#)
  dBodyAddForce body,dBodyGetLinearVelX(body)*-damp,dBodyGetLinearVelY(body)*-damp,dBodyGetLinearVelZ(body)*-damp
End Function

; ###################################################################################################

Function UpdateFriction()

For ode.ODEGeom=Each ODEGeom
	If dBodyIsEnabled(ode\body)
		numjoints=dBodyGetNumJoints(ode\body)
		If numjoints&gt;0 
		
			For joints=0 To numjoints-1
				joint=dBodyGetJoint(ode\body,joints)
				If dJointGetType(joint)=dJointTypeContact
					
					; Get linear velocity vector
			  		ax#=dBodyGetLinearVelX#(ode\body)
			  		ay#=dBodyGetLinearVelY#(ode\body)
				    az#=dBodyGetLinearVelZ#(ode\body)
					; Get Angular velocity vector
			  		bx#=dBodyGetAngularVelX#(ode\body)
			  		by#=dBodyGetAngularVelY#(ode\body)
					bz#=dBodyGetAngularVelZ#(ode\body)
			  		; Calculate magnitudes
					ForceA#=Sqr(ax*ax+ay*ay+az*az)
					ForceB#=Sqr(bx*bx+by*by+bz*bz)
					
					
					If ForceA&gt;.01
						LinearDamp(ode\body,.07)
					End If
					
	
					If ForceB&gt;.01
						AngularDamp(ode\body,.07)
					End If
					
				End If
			Next
		End If
	End If
Next

End Function
</textarea> <br><br></td></tr></table><br>
<a name="495532"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#151">[#151]</a></td></tr></table></td></tr><tr ><td class="posttext"> Expanded Spheres Demo<br>Features: Autodisable, Applying forces to push and pull spheres with the mouse, Selecting bodies and creating joints between them, Applying forces to attract and repulse.<br><br>enjoy<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #									   JV-ODE - Spheres Demo										#
; #									Code by Jim Williams (VIP3R)									#
; ###################################################################################################

AppTitle "JV-ODE - Spheres Mouse Shot Demo"

Global snd1, piv1


Include "ode.bb"

Graphics3D 800,600,0,2
;Graphics3D 1024,768,0,2

Dim connect(256) ; joints
Dim Obj(1)
Dim Ent(1)

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

; ###################################################################################################

;snd1=Load3DSound("Bounce.wav")
;piv1=CreatePivot()

; ### Setup ODE

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)
Global p 

p=CreatePivot() ; Pivot at 0,0,0 ( supports Attract, and Explode )

s=0 ; New joint counter

dWorldSetGravity(World,0,-1,0)
dContactSetMode(dContactBounce + ContactSoftERP + dContactSoftCFM)
dContactSetMu(32)

; Autodisable bodies
dWorldSetAutoDisableFlag (World, 1)

; Increase to make bouncy
dContactSetBounce(0.3)

; Make contact surface soft
;dContactSetSoftERP(0.4)
;dContactSetSoftCFM(0.8)

smode=True

; ### Create light

;SetMousePtr()

ShowPointer

Global Light=CreateLight()

RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera

Global Camera=CreateCamera()
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000

;Correct camera distortion
CameraZoom camera, 1.5

;mic1=CreateListener(camera) ; Create listener, make it child of camera 

PositionEntity Camera,0,20,-50
RotateEntity Camera,30,0,0

; ### Create plane

dCreatePlane(Space,0,1,0,0)

Plane=CreatePlane()

EntityAlpha Plane,0.8

PlaneTexture=CreateTexture(128,128,9)

ClsColor 0,200,80
Cls

Color 255,255,255

Rect 0,0,64,64,1
Rect 64,64,64,64,1

CopyRect 0,0,128,128,0,0,BackBuffer(),TextureBuffer(PlaneTexture)
ScaleTexture PlaneTexture,20,20
EntityTexture Plane,PlaneTexture,0,0

Mirror=CreateMirror()

; ###################################################################################################

While Not KeyHit(1)

	PTime=MilliSecs()
	
	
	
	dSpaceCollide(Space,World,ContactGroup)
	
	updatefriction
		
	dWorldQuickStep(World,0.15)
		
	dJointGroupEmpty(ContactGroup)
		
	
		
	If MilliSecs()-Timer&gt;700
		balls=balls+1
		If balls&lt;10 Then
				AddObject()
		End If
		Timer=MilliSecs()
	End If

	UpdateGeoms()

	PhysicsTime#=MilliSecs()-PTime

	UpdateWorld

	RenderWorld

	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime
	Text 0,30,"A:Attract, E:Explode, M: Mode Select"
	
	; M - Selects Mode
	If KeyHit(50)&gt;0 Then
		smode=Not smode
	End If
	
	Select smode
	
		Case True
			Text 0,45,"Mode: Move bodies "
			Text 0,60,"LM:Push, RM:Pull "
	
		Case False
			Text 0,45,"Mode: Select bodies "
			Text 0,60,"LM:SetBallJoint, RM:Select Body"
			Text 0,75,obj(0)
			Text 0,90,obj(1)
	End Select
		
	
	
	Flip
	

Select smode

	Case True
		; Push on the ball based on the entitypicked vector
		If MouseDown(1) Then 
		
			CameraPick(camera, MouseX(), MouseY())
			
			If PickedEntity()&lt;&gt;0 Then
				EntityColor PickedEntity(),0,255,0
				For ode.ODEGeom=Each ODEGeom
					If ode\mesh=PickedEntity()
						dBodyEnable(ode\body) 
						k=-10
						dBodyAddForce ode\body,k*PickedNX#(),k*PickedNY#(),k*PickedNZ#()
						
						Exit
					End If
				Next
			End If
		End If
		
		; Pull on the ball based on the entitypicked vector
		If MouseDown(2) Then 
		
			CameraPick(camera, MouseX(), MouseY())
			
			If PickedEntity()&lt;&gt;0 Then
				EntityColor PickedEntity(),0,255,0
				For ode.ODEGeom=Each ODEGeom
					If ode\mesh=PickedEntity()
						dBodyEnable(ode\body) 
						k=10
						dBodyAddForce ode\body,k*PickedNX#(),k*PickedNY#(),k*PickedNZ#()
						
						Exit
					End If
				Next
			End If
		End If
		
	Case False
			
		If MouseHit(2) Then 
	
			CameraPick(camera, MouseX(), MouseY())
			
			If PickedEntity()&lt;&gt;0 Then
				EntityColor PickedEntity(),0,0,255
				For ode.ODEGeom=Each ODEGeom
					If ode\mesh=PickedEntity()
						ix=Not ix
						obj(ix)=ode\body
						ent(ix)=ode\mesh
						PositionEntity 	p,EntityX(ode\mesh),EntityY(ode\mesh),EntityZ(ode\mesh)
						Exit
					End If
				Next
			End If
		End If
		
		If MouseHit(1) And obj(0)&gt;0 And obj(1)&gt;0 Then 
			s=s+1
			connect(s)=dJointCreateBall (world,0)
			dJointAttach(connect(s),obj(0),obj(1))
			dJointSetBallAnchor(connect(s),dBodyGetPositionX(obj(0)),dBodyGetPositionY(obj(0)),dBodyGetPositionZ(obj(0)))
			dBodyEnable(obj(0))
			dBodyEnable(obj(1))
		End If
		
	
End Select

;(A)ttract 
If KeyDown(30) Then 
	For ode.ODEGeom=Each ODEGeom
		;Calc vector from ball to pivot
		PointEntity ode\mesh,p
		TFormVector 0,0,1,ode\mesh,0
		dBodyEnable(ode\body)
		k=10
		dBodyAddForce ode\body,k*TFormedX#(),k*TFormedY#(),k*TFormedZ#()
		
	Next
End If

;(E)xplode
If KeyDown(18) Then 
	For ode.ODEGeom=Each ODEGeom
		;Calc vector from ball to pivot
		PointEntity ode\mesh,p
		TFormVector 0,0,1,ode\mesh,0
		dBodyEnable(ode\body) 
		k=-10
		dBodyAddForce ode\body,k*TFormedX#(),k*TFormedY#(),k*TFormedZ#()
		
	Next
End If

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function AddObject()

xp=Rand(-8,8)
zp=Rand(-8,8)
ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp,30,zp)
ode\geom=dCreateSphere(Space,3)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateSphere()
ScaleMesh ode\mesh,3,3,3
EntityColor ode\mesh,Rand(255),Rand(255),Rand(255)
EntityAlpha ode\mesh,1
EntityShininess ode\mesh,0.7

;Set Autodisable parms to your liking
	dBodySetAutoDisableFlag(ode\body,1)
	dBodySetAutoDisableAngularThreshold(ode\body,.05)
	dBodySetAutoDisableLinearThreshold(ode\body,.05)
	dBodySetAutoDisableSteps (ode\body, 1)

;Allow sphere to be picked
EntityPickMode ode\mesh,2

End Function

; ###################################################################################################

Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
If dBodyIsEnabled(ode\body)
	RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
	PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
	EntityColor ode\mesh,0,255,0
Else
	EntityColor ode\mesh,255,0,0
End If
Next

End Function

; ###################################################################################################

Function AngularDamp(body,damp#)
  dBodyAddTorque body,dBodyGetAngularVelX(body)*-damp,dBodyGetAngularVelY(body)*-damp,dBodyGetAngularVelZ(body)*-damp
End Function

; ###################################################################################################

Function LinearDamp(body,damp#)
  dBodyAddForce body,dBodyGetLinearVelX(body)*-damp,dBodyGetLinearVelY(body)*-damp,dBodyGetLinearVelZ(body)*-damp
End Function

; ###################################################################################################

Function UpdateFriction()

For ode.ODEGeom=Each ODEGeom
	If dBodyIsEnabled(ode\body)
		numjoints=dBodyGetNumJoints(ode\body)
		If numjoints&gt;0 
		
			For joints=0 To numjoints-1
				joint=dBodyGetJoint(ode\body,joints)
				If dJointGetType(joint)=dJointTypeContact
					
					; Get linear velocity vector
			  		ax#=dBodyGetLinearVelX#(ode\body)
			  		ay#=dBodyGetLinearVelY#(ode\body)
				    az#=dBodyGetLinearVelZ#(ode\body)
					; Get Angular velocity vector
			  		bx#=dBodyGetAngularVelX#(ode\body)
			  		by#=dBodyGetAngularVelY#(ode\body)
					bz#=dBodyGetAngularVelZ#(ode\body)
			  		; Calculate magnitudes
					ForceA#=Sqr(ax*ax+ay*ay+az*az)
					ForceB#=Sqr(bx*bx+by*by+bz*bz)
					
					
					If ForceA&gt;.01
						LinearDamp(ode\body,.07)
					End If
					
	
					If ForceB&gt;.01
						AngularDamp(ode\body,.07)
					End If
					
				End If
			Next
		End If
	End If
Next

End Function

Function SetMousePtr()
MousePtr = LoadImage("c:\pointer.bmp")
MaskImage MousePtr,0,0,0
End Function
</textarea> <br><br></td></tr></table><br>
<a name="495551"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PsychicParrot</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#152">[#152]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nice work, Wayne :D Thanks! <br><br></td></tr></table><br>
<a name="496415"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#153">[#153]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yay.. i got cygnus car engine v2.0 started. very nice! no shaking, no slowdowns.. propper collisions.. SMOOTH :D<br><br>..up to 32 cars on my system without slowdown, and thats cuz of rendering speed not CPU :)<br><br>only up to 12 on my old one! <br><br></td></tr></table><br>
<a name="496576"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#154">[#154]</a></td></tr></table></td></tr><tr ><td class="posttext"> I believe it would be usefull to create a small physics editor. Something that would let us position bodies, set joints, and parameters. Also be nice to run physics simulation in the editor. Output B3d code to initialize these objects in our programs.<br><br>What you guys think ? <br><br></td></tr></table><br>
<a name="496755"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dazman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#155">[#155]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Wayne. That would be awesome, are you offering to write it, or asking someone else to do it? (Not upto the job myself :( ) <br><br></td></tr></table><br>
<a name="496917"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#156">[#156]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'll create some specifications for a small one and post it here. I'll write it. I'll create a new thread for it. <br><br></td></tr></table><br>
<a name="497948"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Barton</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#157">[#157]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for this Great Wrapper VIP3R.<br><br>is it possible importing the Terrain-Geometry Datas in ODE ??  (Terrain created with Create Terrain) <br><br></td></tr></table><br>
<a name="497952"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#158">[#158]</a></td></tr></table></td></tr><tr ><td class="posttext"> Cheers Barton :)<br><br>It isn't possible to use Blitz Terrains directly with ODE as their geometry constantly changes with LOD.<br><br>There is a solution though, you can create a terrain 'mesh' from a heightmap (same as Blitz Terrains) with a utility like FLE. You can then supply this terrain mesh to ODE using the TriMesh functions.<br><br>You can find FLE in the toolbox area of the Blitz website, note that only the full version of JV-ODE supports the ODE TriMesh functionality. <br><br></td></tr></table><br>
<a name="497970"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Barton</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#159">[#159]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks,<br><br>i have yesterday about Shareit buy your ODE Wrapper. :) <br><br></td></tr></table><br>
<a name="500788"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Barton</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#160">[#160]</a></td></tr></table></td></tr><tr ><td class="posttext"> @VIP3R:<br><br>must one initialize ode after every Level restart once more? or only once after start of the EXE ?<br><br>I using the 2. Method (only once start of Exe) and i destroying all Types and Bodys/Geom's manual (after Reload the Level), and recreating new Objects after start new Level.<br><br>is this Right ? (no problems till now)<br><br>or should I delete completely and initialize newly ode every time? (but I then get "Memory Access Error" so. Line dSpaceCollide(ODESpace,ODEWorld,ODEContactGroup))<br><br><br>what is better? <br><br></td></tr></table><br>
<a name="500834"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TheMan</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#161">[#161]</a></td></tr></table></td></tr><tr ><td class="posttext"> I bought your ODE wrapper, so please keep supporting it..<br>Thanks VIP3R <br><br></td></tr></table><br>
<a name="500863"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JaviCervera</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#162">[#162]</a></td></tr></table></td></tr><tr ><td class="posttext"> Barton. Deleting all objects and creating new ones should do fine. Anyway, in the game I am doing with ODE, using the Cipher engine, we are shutting down ODE each time the client exits (at the end of each level), and initializing again when a new level starts. <br><br></td></tr></table><br>
<a name="500865"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#163">[#163]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Barton: You should be able to use either method without problems, both would work equally well really.<br><br>If you're getting MAV errors on that line above, make sure you have destroyed joint/space/world properly before re-initializing ODE...<br><pre class=code>
dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
</pre><br>Let me know if you still get MAV problems and I'll take a closer look at it.<br><br>@HyderMan: Of course, welcome aboard :) <br><br></td></tr></table><br>
<a name="500881"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Barton</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#164">[#164]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have already deleted ode before I have initialized it newly before.<br><br>funny...<br><br><br>[EDIT: i think, is a Bug in DLL] <br><br>MAV Error always on Line: <br>dSpaceCollide(Space,World,ContactGroup))<br><br>although everything is initialized and destroying before.<br>I use also global variables for World, Space and ContactGroup.<br><br>hmmm.... <br><br></td></tr></table><br>
<a name="500913"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JaviCervera</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#165">[#165]</a></td></tr></table></td></tr><tr ><td class="posttext"> Would you make a small source example which reproduces the error? <br><br></td></tr></table><br>
<a name="500923"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Barton</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#166">[#166]</a></td></tr></table></td></tr><tr ><td class="posttext"> look at my example below... <br><br></td></tr></table><br>
<a name="500960"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Barton</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#167">[#167]</a></td></tr></table></td></tr><tr ><td class="posttext"> i have create a sample code with this MAV Error....<br>restart it with SPACE Button and it crashing after reinitialize ode.<br><br>If you use the other Clear_ODE () method (see sample) with destroying bodys and geoms before destroy/close the ode , then crash the sample after many restarts...ca. &gt; 3-20<br><br><br>test it!<br><br>i think, is a Bug in DLL. Leaks in communication with Destroying objects / close ode ?<br><br>only solution short-term: Initializing ode only once and destroy only Types,bodys and geoms. It Works without Problems...but a fault in this nevertheless is.<br><br>With My Method , ode runs very stably without closing ode and new initialization. I Destroy then only the bodys and geoms and creating new Objects. Works fine,  without problems. whether this remains so?<br>50x Reloading the Level and no problems.<br>Here the Working ODE_CLEAR () Function:<br><br>Function ODE_CLEAR ()<br> For ode.ODEGeom=Each ODEGeom<br>  dBodyDestroy(ODE\body)<br>  dGeomDestroy(ODE\geom)<br>  Delete ode<br> Next<br>End Function<br><br><br><pre class=code>
AppTitle "JV-ODE - Cubes Demo"

Include "ode.bb"



Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

; ###################################################################################################

; ### Setup ODE

Global World
Global Space
Global ContactGroup

Global Light
Global Camera



;=============================================
.RESTART


Graphics3D 1280,1024,32,2; 800,600,0,2

INIT_ODE ()

Light=CreateLight()
RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

Camera=CreateCamera()
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000
PositionEntity Camera,0,20,-50
RotateEntity Camera,30,0,0

dCreatePlane(Space,0,1,0,0)
Plane=CreatePlane()
EntityAlpha Plane,0.8
ClsColor 0,0,0
Cls


; ###################################################################################################
Close=0
Cls
FlushKeys

While Close=0

	PTime=MilliSecs()

	If MilliSecs()-Timer&gt;100
		AddObject()
		Timer=MilliSecs()
		End If

	UPDATE_ODE ()

	PhysicsTime#=MilliSecs()-PTime

	UpdateWorld
	RenderWorld

	Text 0,30,"PRESSS SPACE TO RESTART  or  ESC to Quit"

	Flip

	If KeyHit (1) Then Close=1
	If KeyHit (57) Then Close=2
Wend


CLEAR_ODE ()
ClearWorld 1,1,1 

If Close=2 Then
  Goto RESTART
EndIf
End








Function INIT_ODE ()
World=dWorldCreate()
Space=dHashSpaceCreate(0)
ContactGroup=dJointGroupCreate(0)
dWorldSetAutoDisableFlag(World,0)
dWorldSetGravity(World,0,-5,0)
dContactSetMode(dContactBounce)
dContactSetBounce(0.1)
dContactSetMu(48)
dCreatePlane(Space,0,1,0,0)
End Function

;---------------------------------------------------
; ODE Crashing after restarting it 2x
;---------------------------------------------------

Function CLEAR_ODE ()
 dJointGroupDestroy(ContactGroup)
 dSpaceDestroy(Space)
 dWorldDestroy(World)
 dCloseODE()
 For ode.ODEGeom=Each ODEGeom
  Delete ode
 Next
End Function


;-------------------------------------------------------
;Other Clear Method &gt; ODE CRASHING AFTER RESTARTING IT &gt; 3 - 30 (many restarts) 
;-------------------------------------------------------

;Function CLEAR_ODE ()
; For ode.ODEGeom=Each ODEGeom
;  dbodyDestroy(ode\body)
;  dgeomDestroy(ode\geom)
;  Delete ode
; Next
; dJointGroupDestroy(ContactGroup)
; dSpaceDestroy(Space)
; dWorldDestroy(World)
; dCloseODE()
;End Function


Function UPDATE_ODE ()
 UpdateGeoms()
 dSpaceCollide(Space,World,ContactGroup) ;&gt;&gt;&gt;&gt; MAV ERROR LINE 
 dWorldQuickStep(World,0.1)
 dJointGroupEmpty(ContactGroup)
End Function
; ###################################################################################################

Function AddObject()

xp=Rand(-10,10)
zp=Rand(-10,10)
ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp,30,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\geom=dCreateBox(Space,5,5,5)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,2.5,2.5,2.5
EntityColor ode\mesh,Rand(255),Rand(255),Rand(255)
EntityAlpha ode\mesh,1
EntityShininess ode\mesh,0.7

End Function

; ###################################################################################################

Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
	If dBodyIsEnabled(ode\body)
		RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
		PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
		End If
Next

End Function

; ###################################################################################################

</pre> <br><br></td></tr></table><br>
<a name="501077"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Barton</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#168">[#168]</a></td></tr></table></td></tr><tr ><td class="posttext"> has one already tested the code?  :)<br><br><br>----<br><br>i have experiment with Original Freeware ODE Wrapper and Same Sample. Result: it Works !<br><br>Download Same Sample with Original ODE Wrapper:<br><a href="http://racer.bhmotorsports.com/index/Files/C/Same_Sample_Original_B3D_ODE_Wrapper.rar" target="_blank">http://racer.bhmotorsports.com/index/Files/C/Same_Sample_Original_B3D_ODE_Wrapper.rar</a><br><br>Seem to be a fault in your DLL.<br><br>But, your JV-ODE Wrapper is faster and better. :) <br><br></td></tr></table><br>
<a name="501118"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#169">[#169]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Barton,<br><br>I've had a look for you, the problem seems to be caused by the dSpaceDestroy function. This function isn't really necessary here though, because it basically does the same thing as dGeomDestroy does in your CLEAR_ODE() function. Using dGeomDestroy is probably the better way to do it.<br><br>Anyway, try this function and see if it works any better...<br><br><pre class=code>
Function CLEAR_ODE ()
 For ode.ODEGeom=Each ODEGeom
  dBodyDestroy(ode\body)
  dGeomDestroy(ode\geom)
  Delete ode
 Next
 dJointGroupDestroy(ContactGroup)
 dWorldDestroy(World)
 dCloseODE()
End Function
</pre><br>It seems to work fine here, let us know if you still have problems with MAV's at your end ;) <br><br></td></tr></table><br>
<a name="501123"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Barton</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#170">[#170]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for this alternative Solution. It work so without MAV Errors ! (also in my game)<br><br>The dSpaceDestroy works then therefore not correctly.<br>Will soon there be a correction of dSpaceDestroy Function in your DLL ? (actually is no longer necessary)<br><br>the question Which solution is last better,healthier and sure ? which advantage does the new initialization have?<br> - with ODE_INIT/CLOSE<br> - or only destroy bodys and geoms<br><br> ...before reload the Level.<br><br> hmmm,difficult decision. I need advice.<br><br>----<br>JV-ODE ist the Best. :) <br><br></td></tr></table><br>
<a name="501143"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >CopperCircle</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#171">[#171]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have almost finished my first project using your excellent wrapper.<br><br>Do you know of any tips to increase stability &amp; reduce elasticity in large collections of ODE objects?<br><br><a href="http://www.blitzbasic.com/Community/posts.php?topic=45044" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=45044</a><br><br>Thanks. <br><br></td></tr></table><br>
<a name="501170"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#172">[#172]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Barton: The dSpaceDestroy function in the dll uses the original unmodified ode code (ode handles the process internally). It may be that the geoms should be added to the space manually to make this function work correctly? The ODE User Manual will give you some more info on adding geoms to spaces. I'm not sure which way would be best though, that depends on how JV-ODE is being applied to your project. Personally I would build both methods then test them fully to see if there are any issues with each one. Let us know how you get on with it :)<br><br>@CopperCircle: Nice game :) For the elasticity, I would experiment with the new geom contact settings to alter the bounce, erp and cfm etc...<br><br>dGeomContactSetMode(geom,mode)<br>dGeomContactGetMode%(geom)<br>dGeomContactSetMu(geom,mu#)<br>dGeomContactGetMu#(geom)<br>dGeomContactSetMu2(geom,mu#)<br>dGeomContactGetMu2#(geom)<br>dGeomContactSetBounce(geom,bounce#)<br>dGeomContactGetBounce#(geom)<br>dGeomContactSetBounceVel(geom,vel#)<br>dGeomContactGetBounceVel#(geom)<br>dGeomContactSetSoftERP(geom,erp#)<br>dGeomContactGetSoftERP#(geom)<br>dGeomContactSetSoftCFM(geom,cfm#)<br>dGeomContactGetSoftCFM#(geom)<br>dGeomContactSetMotion1(geom,motion#)<br>dGeomContactGetMotion1#(geom)<br>dGeomContactSetMotion2(geom,motion#)<br>dGeomContactGetMotion2#(geom)<br>dGeomContactSetSlip1(geom,slip#)<br>dGeomContactGetSlip1#(geom)<br>dGeomContactSetSlip2(geom,slip#)<br>dGeomContactGetSlip2#(geom)<br>dGeomContactSetDefaults(geom)<br><br>... also you can try changing the mass of the objects and gravity settings.<br><br>To increase stability you can raise the maxcontacts parameter using the dContactSetMaxContacts(max) function. The default is 128, so you could try 256 or 512 or something like that. Don't raise it too high though as this too will make it unstable. You can also reduce the time steps, but this may have an undesirable effect on the overall simulation.<br><br>Time for a new thread I think... :) <br><br></td></tr></table><br>
<a name="501178"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#173">[#173]</a></td></tr></table></td></tr><tr ><td class="posttext"> <b>NEW THREAD</b><br><br>Please continue on the new thread here...<br><a href="http://www.blitzmax.com/Community/posts.php?topic=45048" target="_blank">http://www.blitzmax.com/Community/posts.php?topic=45048</a><br><br>Thanks :) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
