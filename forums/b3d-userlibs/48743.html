<!DOCTYPE html><html lang="en" ><head ><title >JV-ODE Physics Thread 3</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >JV-ODE Physics Thread 3</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=94" >Blitz3D Userlibs</a>/<a href="#bottom" >JV-ODE Physics Thread 3</a><br><br>
<a name="542151"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> The JV-ODE user library contains almost all of the ODE functions wrapped inside a DLL.<br><br>The library can be used in any programming language that supports DLL's, including Blitz3D and BlitzPlus. The functions have been adapted to use euler angles (the same coordinate system as Blitz3D), however functions for accessing quaternion angles are also included. The download contains all of the necessary files to get you started, including some simple demos showing various ODE objects and TriMesh collisions.<br><br>To view more information and screenshots <a href="http://www.devcode.co.uk/jv-ode.html" target="_blank">click here</a>.<br><br>Options are now available to purchase the wrapper using either PayPal or Share*it.<br><br>The <b>restricted demo version</b> is now available for download <a href="http://www.devcode.co.uk/dload/JV-ODE-Physics-Demo.zip" target="_blank">here</a> (222KB)<br><br>Have Fun :)<br><br>Previous JV-ODE Threads: <a href="/posts.php?topic=43653" target="_blank">1</a> <a href="/posts.php?topic=45048" target="_blank">2</a><br>JV-ODE <a href="http://playerfactory.proboards25.com/" target="_blank">Player Factory</a> Forum<br><br>Useful Links: <a href="http://www.ode.org/" target="_blank">ODE.org Website</a> - <a href="http://www.ode.org/ode-latest-userguide.pdf" target="_blank">ODE User Guide (PDF)</a> - <a href="http://www.ode.org/ode-latest-userguide.html" target="_blank">ODE User Guide (HTML)</a> - <a href="http://q12.org/pipermail/ode/" target="_blank">ODE Archives</a> <br><br></td></tr></table><br>
<a name="542156"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> <b>JV-ODE Version 1.04 Released</b><br><br>Please check your inbox :)<br><br>The new update features many new improvements including:<br><br>New optimized DLL<br>Sphere&gt;TriMesh collision improved<br>Cube&gt;TriMesh collision improved<br>CCylinder&gt;TriMesh collision improved<br>QuickStep performance improved<br>Accurate dInfinity value<br>New RagDoll demo<br><br>Version 1.04 is built using the brand new stable ODE CVS updates (released 2 days ago) <br><br></td></tr></table><br>
<a name="542196"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Many thanks, for this and the Trimesh() bounce thing.<br><br>As advice to anyone else, I've found the source of my recent woes. I was testing the restitution and finding geometries with Restitution of 0.0 were colliding and still bouncing a little. This I took to mean the restitution wasn't being set or used correctly.<br><br>I tried the demos and couldn't recreate the problem, except in the Trimesh demo. Setting the Trimesh to zero bounce still had bouncing bojects. As VIP3R points out, this didn't have dContactBounce set as the contact mode.<br><br>So the problem was my code somehow. LOTS of investigation later (I hate, I just HATE debugging :(  ), I finally found the one thing different between my system that didn't work and the demos that did, was the dWorldSetERP() value. I had raised this to 0.5 earlier in the engine build during experiments. Returning it to the default value of 0.2, collisions between geometry of 0.0 restitution are virtually dead stops as they should be.<br><br>The take home advice - the ERP value affects after collision movement and if your objects aren't responding as they should, reacting when they shouldn't, don't overlook the global error rates.<br><br>Obvious really, but when you're new to a library and don't know confidently if you're implementing it right, it's more likely to look for something you're doing wrong in assigning values at the object creation level than those obscure parameters you poked around with earlier and forget about! <br><br></td></tr></table><br>
<a name="542274"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Please can I have a demo of 30 stacked cubes?<br>Thank you <br><br></td></tr></table><br>
<a name="542300"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> No problem Slenkar, here is a demo showing 30 stacked cubes. It's quite tricky to keep them stable, but I would imagine this would reflect reality.<br><br>To improve stability, try reducing the dWorldQuickStep(World,0.05) value. Let me know if you need further assistance ;)<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #										JV-ODE - Cubes Demo											#
; #									Code by Jim Williams (VIP3R)									#
; ###################################################################################################

AppTitle "JV-ODE - Cubes Demo"

Include "JV-ODE.bb"

Graphics3D 800,600,0,2

Global StackY#=2.505

Global BaseCube

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

; ###################################################################################################

; ### Setup ODE

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,-0.98,0)
dWorldSetERP(World,0.4)
dContactSetMode(dContactBounce)
dContactSetBounce(0.0)
dContactSetMu(80)

; ### Create light

Global Light=CreateLight()

RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera

Global Camera=CreateCamera()
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000
PositionEntity Camera,0,140,-120
RotateEntity Camera,30,0,0

; ### Create plane

dCreatePlane(Space,0,1,0,0)

Plane=CreatePlane()

EntityAlpha Plane,0.8

PlaneTexture=CreateTexture(128,128,9)

ClsColor 0,200,80
Cls

Color 255,255,255

Rect 0,0,64,64,1
Rect 64,64,64,64,1

CopyRect 0,0,128,128,0,0,BackBuffer(),TextureBuffer(PlaneTexture)
ScaleTexture PlaneTexture,20,20
EntityTexture Plane,PlaneTexture,0,0

Mirror=CreateMirror()

For count=1 To 30
	AddObject()
Next

; ###################################################################################################

While Not KeyHit(1)

	PTime=MilliSecs()

	If KeyHit(57) Then dBodyAddForce(BaseCube,0,0,8000)

	UpdateGeoms()

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.05)
	dJointGroupEmpty(ContactGroup)

	PhysicsTime#=MilliSecs()-PTime

	UpdateWorld

	RenderWorld

	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime
	Text 240,0,"Press Space to push the base cube"

	Flip

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function AddObject()

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
If StackY&lt;5 Then BaseCube=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,0,StackY,0)
dBodySetAutoDisableFlag(ode\body,1)
mass=dMassCreate()
dMassSetBox(mass,1,5,5,5)
dMassSetBoxTotal(mass,20,5,5,5)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
ode\geom=dCreateBox(Space,5,5,5)
dGeomContactSetMode(ode\geom,dContactBounce)
dGeomContactSetBounce(ode\geom,0.0)
dGeomContactSetSoftERP(ode\geom,0.1)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,2.5,2.5,2.5
EntityColor ode\mesh,Rand(255),Rand(255),Rand(255)
EntityAlpha ode\mesh,1
EntityShininess ode\mesh,0.7

StackY=StackY+5

End Function

; ###################################################################################################

Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
	If dBodyIsEnabled(ode\body)
		RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
		PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
		End If
Next

End Function

; ###################################################################################################
</textarea> <br><br></td></tr></table><br>
<a name="542351"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> excellent thank you <br><br></td></tr></table><br>
<a name="542410"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here's a pyramid:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #										JV-ODE - Pyramid Demo											#
; #									Code by Jim Williams (VIP3R)									#
; ###################################################################################################

AppTitle "JV-ODE - Pyramid Demo"

Include "JV-ODE.bb"

Graphics3D 800,600,0,2


Global BaseCube

Global ElapsedTime
Global LastTime
Global FrameCount
Global Frames
Global Time


Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

; ###################################################################################################

; ### Setup ODE

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,-0.98,0)
dWorldSetERP(World,0.4)
dContactSetMode(dContactBounce)
dContactSetBounce(0.0)
dContactSetMu(80)

; ### Create light

Global Light=CreateLight()

RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera

Global Camera=CreateCamera()
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000
PositionEntity Camera,30,25,-50
RotateEntity Camera,15,0,0

; ### Create plane

dCreatePlane(Space,0,1,0,0)

Plane=CreatePlane()

EntityAlpha Plane,0.8

PlaneTexture=CreateTexture(128,128,9)

ClsColor 0,200,80
Cls

Color 255,255,255

Rect 0,0,64,64,1
Rect 64,64,64,64,1

CopyRect 0,0,128,128,0,0,BackBuffer(),TextureBuffer(PlaneTexture)
ScaleTexture PlaneTexture,20,20
EntityTexture Plane,PlaneTexture,0,0

Mirror=CreateMirror()

; Construct pyramid

Wide=8  ; Number of blocks wide at the base
Gap#=7  ; Gap spacing
RBW#=5  ; Real block width

For j#=wide To 1 Step -1
	For k#=1 To j
		AddObject(k#*Gap+(wide-j#)*Gap/2,RBW/2 + (wide-j#)*RBW)
	Next
Next
		
		

; ###################################################################################################

While Not KeyHit(1)

    UpdateControls()

	PTime=MilliSecs()

	UpdateGeoms()

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)

	PhysicsTime#=MilliSecs()-PTime

	UpdateWorld

	RenderWorld

	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime
	Text 0,30,"FPS:"+Fps()
	Text 240,0,"Push and Pull Cubes: Left/Right Mouse"

	Flip

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function AddObject(x#,height#)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)

dBodySetRotation(ode\body,0,0,0)
;dBodySetPosition(ode\body,0,StackY,0)
dBodySetPosition(ode\body,x,Height,0)

dBodySetAutoDisableFlag(ode\body,1)
mass=dMassCreate()
dMassSetBox(mass,1,5,5,5)
dMassSetBoxTotal(mass,20,5,5,5)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
ode\geom=dCreateBox(Space,5,5,5)
dGeomContactSetMode(ode\geom,dContactBounce)
dGeomContactSetBounce(ode\geom,0.0)
dGeomContactSetSoftERP(ode\geom,0.1)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,2.5,2.5,2.5
EntityColor ode\mesh,Rand(255),Rand(255),Rand(255)
EntityAlpha ode\mesh,1
EntityShininess ode\mesh,0.7

EntityPickMode ode\mesh,2 ; Make pickable

End Function

; ###################################################################################################

Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
	If dBodyIsEnabled(ode\body)
		RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
		PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
		End If
Next

End Function

; ###################################################################################################

Function Fps()
Time=MilliSecs()

ElapsedTime=ElapsedTime+Time-LastTime
LastTime=Time
FrameCount=FrameCount+1

If ElapsedTime&gt;1000
	ElapsedTime=0
	Frames=FrameCount
	FrameCount=0
EndIf
Return Frames
End Function 

; ###################################################################################################

Function UpdateControls()

	If MouseDown(1)=1

	CameraPick(Camera,MouseX(),MouseY())
		If PickedEntity()
			For ode.ODEGeom=Each ODEGeom
				If ode\mesh=PickedEntity()
					dBodyEnable(ode\body)
					dBodyAddForce ode\body,-20*PickedNX#(),-200*PickedNY#(),-200*PickedNZ#()
				End If
			Next
		End If
	End If

	If MouseDown(2)=1
		CameraPick(Camera,MouseX(),MouseY())
		If PickedEntity()
			For ode.ODEGeom=Each ODEGeom
				If ode\mesh=PickedEntity()
					dBodyEnable(ode\body)
					dBodyAddForce ode\body,20*PickedNX#(),200*PickedNY#(),200*PickedNZ#()
				End If
			Next
		End If
	End If
End Function
</textarea> <br><br></td></tr></table><br>
<a name="542426"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> You're welcome Slenkar ;)<br><br>Cool pyramid demo Wayne, how are you finding the new update so far? <br><br></td></tr></table><br>
<a name="542455"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> ** HIGH PERFORMANCE Version of Pyramid Demo **<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #										JV-ODE - Pyramid Demo											#
; #									Code by Jim Williams (VIP3R)									#
; ###################################################################################################

AppTitle "JV-ODE - Pyramid Demo"

Include "JV-ODE.bb"

Graphics3D 800,600,0,2


Global ElapsedTime
Global LastTime
Global FrameCount
Global Frames
Global Time


Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

; ###################################################################################################

; ### Setup ODE

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,-0.98,0)
dWorldSetERP(World,0.4)
dContactSetMode(dContactBounce)
dContactSetBounce(0.0)
dContactSetMu(80)

; High Performance Settings
; Causes objects to settle down and sleep faster
dWorldSetAutoDisableLinearThreshold (World, .05)
dWorldSetAutoDisableAngularThreshold (World, .05)
dWorldSetAutoDisableSteps (World, 3)

; ### Create light

Global Light=CreateLight()

RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera

Global Camera=CreateCamera()
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000
PositionEntity Camera,30,25,-50
RotateEntity Camera,15,0,0

; ### Create plane

dCreatePlane(Space,0,1,0,0)

Plane=CreatePlane()

EntityAlpha Plane,0.8

PlaneTexture=CreateTexture(128,128,9)

ClsColor 0,200,80
Cls

Color 255,255,255

Rect 0,0,64,64,1
Rect 64,64,64,64,1

CopyRect 0,0,128,128,0,0,BackBuffer(),TextureBuffer(PlaneTexture)
ScaleTexture PlaneTexture,20,20
EntityTexture Plane,PlaneTexture,0,0

Mirror=CreateMirror()

; Construct pyramid

Wide=8  ; Number of blocks wide at the base
Gap#=7  ; Gap spacing
RBW#=5  ; Real block width

For j#=wide To 1 Step -1
	For k#=1 To j
		AddObject(k#*Gap+(wide-j#)*Gap/2,RBW/2 + (wide-j#)*RBW)
	Next
Next
		
		

; ###################################################################################################

While Not KeyHit(1)

    UpdateControls()

	PTime=MilliSecs()

	UpdateGeoms()

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)

	PhysicsTime#=MilliSecs()-PTime

	UpdateWorld

	RenderWorld

	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime
	Text 0,30,"FPS:"+Fps()
	Text 240,0,"Push and Pull Cubes: Left/Right Mouse"

	Flip

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function AddObject(x#,height#)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)

dBodySetRotation(ode\body,0,0,0)
;dBodySetPosition(ode\body,0,StackY,0)
dBodySetPosition(ode\body,x,Height,0)

dBodySetAutoDisableFlag(ode\body,1)
mass=dMassCreate()
dMassSetBox(mass,1,5,5,5)
dMassSetBoxTotal(mass,20,5,5,5)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
ode\geom=dCreateBox(Space,5,5,5)
dGeomContactSetMode(ode\geom,dContactBounce)
dGeomContactSetBounce(ode\geom,0.0)
dGeomContactSetSoftERP(ode\geom,0.1)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,2.5,2.5,2.5
EntityColor ode\mesh,Rand(255),Rand(255),Rand(255)
EntityAlpha ode\mesh,1
EntityShininess ode\mesh,0.7

EntityPickMode ode\mesh,2 ; Make pickable

End Function

; ###################################################################################################

Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
	If dBodyIsEnabled(ode\body)
		RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
		PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
		End If
Next

End Function

; ###################################################################################################

Function Fps()
Time=MilliSecs()

ElapsedTime=ElapsedTime+Time-LastTime
LastTime=Time
FrameCount=FrameCount+1

If ElapsedTime&gt;1000
	ElapsedTime=0
	Frames=FrameCount
	FrameCount=0
EndIf
Return Frames
End Function 

; ###################################################################################################

Function UpdateControls()

	If MouseDown(1)=1

	CameraPick(Camera,MouseX(),MouseY())
		If PickedEntity()
			For ode.ODEGeom=Each ODEGeom
				If ode\mesh=PickedEntity()
					dBodyEnable(ode\body)
					dBodyAddForce ode\body,-20*PickedNX#(),-200*PickedNY#(),-200*PickedNZ#()
				End If
			Next
		End If
	End If

	If MouseDown(2)=1
		CameraPick(Camera,MouseX(),MouseY())
		If PickedEntity()
			For ode.ODEGeom=Each ODEGeom
				If ode\mesh=PickedEntity()
					dBodyEnable(ode\body)
					dBodyAddForce ode\body,20*PickedNX#(),200*PickedNY#(),200*PickedNZ#()
				End If
			Next
		End If
	End If
End Function
</textarea> <br><br></td></tr></table><br>
<a name="542468"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> The new UPDATE makes the wrapper worth every penny spent on it! Two words come to mind, "it works".<br><br>I love this wrapper man because it's clean, fast, and followes the ODE documentation. The new commands add control that normally would be reserved for C programmers.<br><br>Keep up the good work VIP3R. <br><br></td></tr></table><br>
<a name="542521"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PsychicParrot</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> I second that. Although I've had virtually no time to play yet, the little I've played with has been just incredible. Finally, anyone can do cool car physics and have nice things to bounce around and crash into ... thank you so much for opening this new world, VIP3R. It rocks! <br><br></td></tr></table><br>
<a name="542527"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> This rocks!! However- Cylinders still seem to jutter around and get flung off- Thats the oly issue i see :)<br><br><br>Other than that, Greeeat :D <br><br></td></tr></table><br>
<a name="542532"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TheMan</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> thanks viper <br><br></td></tr></table><br>
<a name="542568"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well it was real hard work but it was definitely worth it. Thanks for your kind words everyone, it's <b>very</b> much appreciated :)<br><br>Thanks also for all of the emails of support I've received over the last few days, sorry I couldn't reply to all of them individually.<br><br>I'm really looking forward to seeing all of your projects.<br><br>Cheers :)<br><br>@Cygnus: Is that standard cylinders or capped cylinders? Did you add mass to them? Have you set the mass direction correctly? Lots of things can cause those jitters, let me know and I'll take a look at it for you ;) <br><br></td></tr></table><br>
<a name="542584"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> A feature request : cold you provide a different way of handling contact bounce qualities between geometries? The existing mean average of two values isn't accurate.<br><br>eg. Create surface of low bounce (marble)<br>dGeomContactSetBounce(obj\geom,0.2)<br><br>Create surface of very high bounce (bouncy ball)<br>dGeomContactSetBounce(obj\geom,0.95)<br><br>If you've ever bounced a really bouncy ball on a hard marble surface, it bounces very high, but in the ODE wrapper the average = 0.575 is only a moderate bounce.<br><br>Create a bouncy ball of bounciness 1.8 and it bounces well on the marble, but bounces to much off another bouncy ball.<br><br>Could you provide an alternative maybe where contact bounce value is the maximum between the two surfaces? That might make a better approximation. <br><br></td></tr></table><br>
<a name="542589"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> I agree, I think that would be better too. So you want the option of both of these...<br><br>TotalBounce=(Geom1Bounce+Geom2Bounce)/2 &lt;&lt;&lt; Averaged<br><br>TotalBounce=*Geom1Bounce or *Geom2Bounce &lt;&lt;&lt; Maximum<br>[edit] *whichever is higher (sorry misunderstood your request)<br><br>No problem, I'll put it in my todo for the next update ;) <br><br></td></tr></table><br>
<a name="542606"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> I wouldn't use the added value, as 0.9 + 0.9=1.8, where objects would bounce higher than each last bounce!<br><br>I'd use...<br><br>TotalBounce=Max(Geom1Bounce,Geom2Bounce)<br><br>Many thanks for your efforts and the quick updates! <br><br></td></tr></table><br>
<a name="542911"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here's a little game called Pyramid of Destruction.<br>-Enjoy<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #								JV-ODE - Pyramid Destruction Demo											#
; #									Code by Jim Williams (VIP3R)									#
; ###################################################################################################

AppTitle "JV-ODE - Pyramid Destruction"

Include "JV-ODE.bb"

;Graphics3D 800,600,0,2
Graphics3D 1024,768,32,1


Global ElapsedTime
Global LastTime
Global FrameCount
Global Frames
Global Time

Global Proj
Global Projbody

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

; ###################################################################################################

; ### Setup ODE

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,-1,0)
dWorldSetERP(World,0.4)
dContactSetMode(dContactBounce)
dContactSetBounce(0.0)
dContactSetMu(80)

; High Performance Settings
; Causes objects to settle down and sleep faster
dWorldSetAutoDisableLinearThreshold (World, .05)
dWorldSetAutoDisableAngularThreshold (World, .05)
dWorldSetAutoDisableSteps (World, 5)
dContactSetMaxContacts(32)
dWorldSetQuickStepNumIterations (World,20)

; ### Create light

Global Light=CreateLight()

RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera

Global Camera=CreateCamera()
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000
PositionEntity Camera,30,25,-100
RotateEntity Camera,15,0,0

; ### Create plane

dCreatePlane(Space,0,1,0,0)

Plane=CreatePlane()

EntityAlpha Plane,0.8

PlaneTexture=CreateTexture(128,128,9)

ClsColor 0,200,80
Cls

Color 255,255,255

Rect 0,0,64,64,1
Rect 64,64,64,64,1

CopyRect 0,0,128,128,0,0,BackBuffer(),TextureBuffer(PlaneTexture)
ScaleTexture PlaneTexture,20,20
EntityTexture Plane,PlaneTexture,0,0

Mirror=CreateMirror()

; Construct pyramid

Wide=9  ; Number of blocks wide at the base
Gap#=7  ; Gap spacing
RBW#=5  ; Real block width

For j#=wide To 1 Step -1
	For k#=1 To j
		AddObject(k#*Gap+(wide-j#)*Gap/2,RBW/2 + (wide-j#)*RBW)
		bcount=bcount+1
	Next
Next
		
addProjectile(EntityX(camera),EntityY(camera),EntityZ(camera))

		

; ###################################################################################################

While Not KeyHit(1)

    UpdateControls()

; Calculate Time Delta
If T=0 Then T=MilliSecs()
T=MilliSecs() 

; Mouse Look code

; Execute every 25ms ( 40/sec )
If T &gt; Time2 + 25 Then
	Time2=T
	mxs#=mxs#+(MouseXSpeed()-mxs#)/3
	mys#=mys#+(MouseYSpeed()-mys#)/3

	If MouseDown(2) Then 
		MoveMouse GraphicsWidth()/2,GraphicsHeight()/2
		p1#=p1#-mys#
		y1#=y1#-mxs#
		RotateEntity camera,-p1#,y1#,0
	EndIf
EndIf	


	
	PTime=MilliSecs()

	UpdateGeoms()

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	
	dJointGroupEmpty(ContactGroup)

	PhysicsTime#=MilliSecs()-PTime

	UpdateWorld

	RenderWorld

	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime
	Text 0,30,"FPS:"+Fps()
	Text 0,60,"Blocks="+bcount
	Text 0,75,"LM - Pushes Object"
	Text 0,90, "RM - Mouse Look"
	Text 0,105, "R  - Reconstruct Pyramid"
	Text 0,120, "WSAD - Movement"
    Text 0,135, "Space - Shoots"

	Flip  

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function AddObject(x#,height#)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)

dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,x,Height,0)

dBodySetAutoDisableFlag(ode\body,1)
mass=dMassCreate()
dMassSetBox(mass,1,5,5,5)
dMassSetBoxTotal(mass,20,5,5,5)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
ode\geom=dCreateBox(Space,5,5,5)
dGeomContactSetMode(ode\geom,dContactBounce)
dGeomContactSetBounce(ode\geom,0.0)
dGeomContactSetSoftERP(ode\geom,0.1)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,2.5,2.5,2.5
EntityColor ode\mesh,Rand(255),Rand(255),Rand(255)
EntityAlpha ode\mesh,1
EntityShininess ode\mesh,0.7

EntityPickMode ode\mesh,2 ; Make pickable

End Function

; ###################################################################################################

Function PosObject(x#,height#, body)

dBodyDisable(body)
dBodySetRotation(body,0,0,0)
dBodySetPosition(body,x,Height,0)
dBodySetLinearVel  (body, 0,0,0)
dBodySetAngularVel (body, 0,0,0)
dBodyEnable(body)

End Function

; ###################################################################################################

Function AddProjectile(X#,Y#,Z#)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)

dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,x#,Y#,Z#)

dBodySetAutoDisableFlag(ode\body,1)
mass=dMassCreate()
dMassSetBox(mass,1,5,5,5)
dMassSetBoxTotal(mass,20,5,5,5)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
ode\geom=dCreateBox(Space,5,5,5)
dGeomContactSetMode(ode\geom,dContactBounce)
dGeomContactSetBounce(ode\geom,0.0)
dGeomContactSetSoftERP(ode\geom,0.1)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,2.5,2.5,2.5
EntityColor ode\mesh,Rand(255),Rand(255),Rand(255)
EntityAlpha ode\mesh,1
EntityShininess ode\mesh,0.7

proj=ode\mesh ; ENTITY	
projbody=ode\body

End Function
; ###################################################################################################

Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
	If dBodyIsEnabled(ode\body)
		RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
		PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
	End If
Next

End Function

; ###################################################################################################

Function Fps()
Time=MilliSecs()

ElapsedTime=ElapsedTime+Time-LastTime
LastTime=Time
FrameCount=FrameCount+1

If ElapsedTime&gt;1000
	ElapsedTime=0
	Frames=FrameCount
	FrameCount=0
EndIf
Return Frames
End Function 

; ###################################################################################################

Function UpdateControls()

	If MouseDown(1)=1

	CameraPick(Camera,MouseX(),MouseY())
		If PickedEntity()
			For ode.ODEGeom=Each ODEGeom
				If ode\mesh=PickedEntity()
					dBodyEnable(ode\body)
					dBodyAddForce ode\body,-500*PickedNX#(),-500*PickedNY#(),-500*PickedNZ#()
				End If
			Next
		End If
	End If


	; Spacebar - Fire
	If KeyDown(57) Then
		dBodyDisable(Projbody)
		; Set projectile to match camera orientation
		dBodySetRotation(Projbody,EntityPitch(camera),EntityYaw(camera),EntityRoll(camera))
		dBodySetPosition(Projbody,EntityX(camera),EntityY(camera),EntityZ(camera))
		; Set projectile velocity and spin to zero
		dBodySetLinearVel  (Projbody, 0,0,0)
		dBodySetAngularVel (Projbody, 0,0,0)
		
		dBodyEnable(Projbody)
		dBodyAddRelForce(Projbody,0,0,8000)
		
	EndIf
	
	; Reconstruct pyramid
	If KeyDown(19) Then
		ode.ODEGeom=First ODEGeom
		
			; Construct pyramid
	
			Wide=9  ; Number of blocks wide at the base
			Gap#=7  ; Gap spacing
			RBW#=5  ; Real block width
			
			For j#=wide To 1 Step -1
				For k#=1 To j
					PosObject(k#*Gap+(wide-j#)*Gap/2,RBW/2 + (wide-j#)*RBW,ode\body)
					ode = After ode
				Next
			Next
			
		
	End If

; WSAD - Movement

; W- Forward
If KeyDown(17) Then
	MoveEntity camera,0,0,1
EndIf
; S- Reverse
If KeyDown(31) Then
	MoveEntity camera,0,0,-1
EndIf

; W- Left
If KeyDown(30) Then
	MoveEntity camera,-1,0,0
EndIf
; S- Right
If KeyDown(32) Then
	MoveEntity camera,1,0,0
EndIf

End Function
</textarea> <br><br></td></tr></table><br>
<a name="542939"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Pyramid of Destruction II<br>Add your own sounds for that special touch.<br>Select different planets and watch gravity at work.<br>Other features include: Mouse Look, WSAD and arrow keys, Pyramid reconstruction, Mouse pushing, spacebar shooting.<br><br>-enjoy<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #								JV-ODE - Pyramid Destruction Demo											#
; #									Code by Jim Williams (VIP3R)									#
; ###################################################################################################

AppTitle "JV-ODE - Pyramid Destruction II"

Include "JV-ODE.bb"

;Graphics3D 800,600,0,2
Graphics3D 1024,768,32,1


Global ElapsedTime
Global LastTime
Global FrameCount
Global Frames
Global Time

Global Proj
Global Projbody
Global snd1
Global snd2
Global piv1

Global Planet$
Global gx

piv1=CreatePivot()

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

; ###################################################################################################

; ### Setup ODE

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,-1.0,0)
Planet="Earth"

dWorldSetERP(World,0.4)
dContactSetMode(dContactBounce)
dContactSetBounce(0.0)
dContactSetMu(80)

; High Performance Settings
; Causes objects to settle down and sleep faster
dWorldSetAutoDisableLinearThreshold (World, .05)
dWorldSetAutoDisableAngularThreshold (World, .05)
dWorldSetAutoDisableSteps (World, 5)
dContactSetMaxContacts(32)
dWorldSetQuickStepNumIterations (World,20)

; ### Create light

Global Light=CreateLight()

RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera

Global Camera=CreateCamera()
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000
PositionEntity Camera,30,25,-100
RotateEntity Camera,15,0,0

; ### Load sounds
snd1=Load3DSound("media\Impact.wav")
snd2=LoadSound("media\whizz.wav")

SoundVolume snd2,.2

mic1=CreateListener(camera,.3,1,1) ; Create listener, make it child of camera 

; ### Create plane

dCreatePlane(Space,0,1,0,0)

Plane=CreatePlane()

EntityAlpha Plane,0.8

PlaneTexture=CreateTexture(128,128,9)

ClsColor 0,200,80
Cls

Color 255,255,255

Rect 0,0,64,64,1
Rect 64,64,64,64,1

CopyRect 0,0,128,128,0,0,BackBuffer(),TextureBuffer(PlaneTexture)
ScaleTexture PlaneTexture,20,20
EntityTexture Plane,PlaneTexture,0,0

Mirror=CreateMirror()

; Construct pyramid

Wide=9  ; Number of blocks wide at the base
Gap#=7  ; Gap spacing
RBW#=5  ; Real block width

For j#=wide To 1 Step -1
	For k#=1 To j
		AddObject(k#*Gap+(wide-j#)*Gap/2,RBW/2 + (wide-j#)*RBW)
		bcount=bcount+1
	Next
Next
		
addProjectile(EntityX(camera),EntityY(camera),EntityZ(camera))

		

; ###################################################################################################

While Not KeyHit(1)

    UpdateControls()

; Calculate Time Delta
If T=0 Then T=MilliSecs()
T=MilliSecs() 

; Mouse Look code

; Execute every 25ms ( 40/sec )
If T &gt; Time2 + 25 Then
	Time2=T
	mxs#=mxs#+(MouseXSpeed()-mxs#)/3
	mys#=mys#+(MouseYSpeed()-mys#)/3

	If MouseDown(2) Then 
		MoveMouse GraphicsWidth()/2,GraphicsHeight()/2
		p1#=p1#-mys#
		y1#=y1#-mxs#
		RotateEntity camera,-p1#,y1#,0
	EndIf
EndIf	


	
	PTime=MilliSecs()

	UpdateGeoms()
	

	dSpaceCollide(Space,World,ContactGroup)
	
	UpdateSounds()
	
	dWorldQuickStep(World,0.1)
	
	dJointGroupEmpty(ContactGroup)

	PhysicsTime#=MilliSecs()-PTime

	UpdateWorld

	RenderWorld
	
	Color 255,255,255
	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime
	Text 0,30,"FPS:"+Fps()
	Color 255,0,0
	Text 0,60,"P - Planet="+Planet
	Color 255,255,255
	Text 0,75,"LM - Pushes Object"
	Text 0,90, "RM - Mouse Look"
	Text 0,105, "R  - Reconstruct Pyramid"
	Text 0,120, "WSAD - Movement"
    Text 0,135, "Space - Shoots"

	Flip  

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function AddObject(x#,height#)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)

dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,x,Height,0)

dBodySetAutoDisableFlag(ode\body,1)
mass=dMassCreate()
dMassSetBox(mass,1,5,5,5)
dMassSetBoxTotal(mass,20,5,5,5)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
ode\geom=dCreateBox(Space,5,5,5)
dGeomContactSetMode(ode\geom,dContactBounce)
dGeomContactSetBounce(ode\geom,0.0)
dGeomContactSetSoftERP(ode\geom,0.1)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,2.5,2.5,2.5
EntityColor ode\mesh,Rand(255),Rand(255),Rand(255)
EntityAlpha ode\mesh,1
EntityShininess ode\mesh,0.7

EntityPickMode ode\mesh,2 ; Make pickable

End Function

; ###################################################################################################

Function PosObject(x#,height#, body)

dBodyDisable(body)
dBodySetRotation(body,0,0,0)
dBodySetPosition(body,x,Height,0)
dBodySetLinearVel  (body, 0,0,0)
dBodySetAngularVel (body, 0,0,0)
dBodyEnable(body)

End Function

; ###################################################################################################

Function AddProjectile(X#,Y#,Z#)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)

dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,x#,Y#,Z#)

dBodySetAutoDisableFlag(ode\body,1)
mass=dMassCreate()
dMassSetBox(mass,1,5,5,5)
dMassSetBoxTotal(mass,20,5,5,5)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
ode\geom=dCreateBox(Space,5,5,5)
dGeomContactSetMode(ode\geom,dContactBounce)
dGeomContactSetBounce(ode\geom,0.0)
dGeomContactSetSoftERP(ode\geom,0.1)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,2.5,2.5,2.5
EntityColor ode\mesh,Rand(255),Rand(255),Rand(255)
EntityAlpha ode\mesh,1
EntityShininess ode\mesh,0.7

proj=ode\mesh ; ENTITY	
projbody=ode\body

End Function
; ###################################################################################################

Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
	If dBodyIsEnabled(ode\body)
		RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
		PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
	End If
Next

End Function

; ###################################################################################################

Function Fps()
Time=MilliSecs()

ElapsedTime=ElapsedTime+Time-LastTime
LastTime=Time
FrameCount=FrameCount+1

If ElapsedTime&gt;1000
	ElapsedTime=0
	Frames=FrameCount
	FrameCount=0
EndIf
Return Frames
End Function 

; ###################################################################################################

Function UpdateControls()

	If MouseDown(1)=1

	CameraPick(Camera,MouseX(),MouseY())
		If PickedEntity()
			For ode.ODEGeom=Each ODEGeom
				If ode\mesh=PickedEntity()
					dBodyEnable(ode\body)
					dBodyAddForce ode\body,-500*PickedNX#(),-500*PickedNY#(),-500*PickedNZ#()
				End If
			Next
		End If
	End If


	; Spacebar - Fire
	If KeyDown(57) Then
		dBodyDisable(Projbody)
		; Set projectile to match camera orientation
		dBodySetRotation(Projbody,EntityPitch(camera),EntityYaw(camera),EntityRoll(camera))
		dBodySetPosition(Projbody,EntityX(camera),EntityY(camera),EntityZ(camera))
		; Set projectile velocity and spin to zero
		dBodySetLinearVel  (Projbody, 0,0,0)
		dBodySetAngularVel (Projbody, 0,0,0)
		
		dBodyEnable(Projbody)
		dBodyAddRelForce(Projbody,0,0,8000)
		
		PlaySound snd2
	EndIf
	
	; Reconstruct pyramid
	If KeyDown(19) Then
		ode.ODEGeom=First ODEGeom
		
			; Construct pyramid
	
			Wide=9  ; Number of blocks wide at the base
			Gap#=7  ; Gap spacing
			RBW#=5  ; Real block width
			
			For j#=wide To 1 Step -1
				For k#=1 To j
					PosObject(k#*Gap+(wide-j#)*Gap/2,RBW/2 + (wide-j#)*RBW,ode\body)
					ode = After ode
				Next
			Next
			
		
	End If

; WSAD - Movement

; W- Forward
If KeyDown(17) Or KeyDown(200) Then
	MoveEntity camera,0,0,1
EndIf
; S- Reverse
If KeyDown(32) Or KeyDown(208) Then
	MoveEntity camera,0,0,-1
EndIf

; W- Left
If KeyDown(30) Or KeyDown(203) Then
	MoveEntity camera,-1,0,0
EndIf
; S- Right
If KeyDown(32) Or KeyDown(205) Then
	MoveEntity camera,1,0,0
EndIf

; G - Gravity
If KeyHit(25) Then
	gx=gx+1
	If gx&gt;3 Then gx=1
	Select gx
	  Case 1
		Planet="Earth"
		dWorldSetGravity(World,0,-1.0,0)
	
	  Case 2
		Planet="Mars"
		dWorldSetGravity(World,0,-.33333,0)

	  Case 3
		Planet="Moon"
		dWorldSetGravity(World,0,-.16666,0)
		
	End Select
	
EndIf


End Function

; ###################################################################################################

Function UpdateSounds()

For ode.ODEGeom=Each ODEGeom
	If dGeomIsEnabled(ode\geom)
		numjoints=dBodyGetNumJoints(ode\body)
		If numjoints&gt;0 
		
			For joints=0 To numjoints-1
				joint=dBodyGetJoint(ode\body,joints)
				If dJointGetType(joint)=dJointTypeContact
					
					; Get linear velocity vector
			  		ax#=dBodyGetLinearVelX#(ode\body)
			  		ay#=dBodyGetLinearVelY#(ode\body)
				    az#=dBodyGetLinearVelZ#(ode\body)
					; Get Angular velocity vector
			  		bx#=dBodyGetAngularVelX#(ode\body)
			  		by#=dBodyGetAngularVelY#(ode\body)
					bz#=dBodyGetAngularVelZ#(ode\body)
			  		; Calculate magnitudes
					ForceA#=Sqr(ax*ax+ay*ay+az*az)
					ForceB#=Sqr(bx*bx+by*by+bz*bz)
					
					;If ForceA&gt;.01
					;	LinearDamp(ode\body,.04)
					;End If
					
					If ForceA&gt;1.0
						PositionEntity piv1,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
						EmitSound(snd1,piv1)
					End If

					;If ForceB&gt;.01
					;	AngularDamp(ode\body,.06)
					;End If
					
				End If
			Next
		End If
	End If
Next

End Function
</textarea> <br><br></td></tr></table><br>
<a name="543005"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KuRiX</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hehe, very nice. And very good stability for the stack. Congratulations! <br><br></td></tr></table><br>
<a name="543129"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> VERY nice.<br><br>I did similar to this in ODE, but the stability was fecked, so i converted over to Toka. :) <br><br></td></tr></table><br>
<a name="543440"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> Faster, better, stronger<br>Runs Physics 66 times a second.<br><br><br>-enjoy<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #								JV-ODE - Pyramid Destruction III Demo											#
; #									Code by Jim Williams (VIP3R)									#
; ###################################################################################################

AppTitle "JV-ODE - Pyramid Destruction III"

Include "JV-ODE.bb"

Graphics3D 1024,768,32,1


Global ElapsedTime
Global LastTime
Global FrameCount
Global Frames
Global Time

Global Proj
Global Projbody
Global snd1
Global snd2
Global piv1

Global Planet$
Global gx

Global Wide=10  ; Number of blocks wide at the base, default 10
Global Gap#=8  ; Gap spacing, default 8
Global RBW#=5  ; Real block width, default 5
			
piv1=CreatePivot()

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

; ###################################################################################################

; ### Setup ODE

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,-1.0,0)

Planet="Earth"
gx=1

dWorldSetERP(World,0.4)
dContactSetMode(dContactBounce)
dContactSetBounce(0.0)
dContactSetMu(80)

; High Performance Settings
; Causes objects to settle down and sleep faster
dWorldSetAutoDisableLinearThreshold (World, .1)
dWorldSetAutoDisableAngularThreshold (World, .1)
dWorldSetAutoDisableSteps (World,10)
dContactSetMaxContacts(16)
dWorldSetQuickStepNumIterations (World,20) ; default 20

; ### Create light

Global Light=CreateLight()

RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera

Global Camera=CreateCamera()
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000
PositionEntity Camera,30,25,-100
RotateEntity Camera,15,0,0

; ### Load sounds
snd1=Load3DSound("media\Impact.wav")
snd2=LoadSound("media\whizz.wav")

SoundVolume snd2,.2

mic1=CreateListener(camera,.3,1,1) ; Create listener, make it child of camera 

; ### Create plane

dCreatePlane(Space,0,1,0,0)

Plane=CreatePlane()

EntityAlpha Plane,0.8

PlaneTexture=CreateTexture(128,128,9)

ClsColor 0,200,80
Cls

Color 255,255,255

Rect 0,0,64,64,1
Rect 64,64,64,64,1

CopyRect 0,0,128,128,0,0,BackBuffer(),TextureBuffer(PlaneTexture)
ScaleTexture PlaneTexture,20,20
EntityTexture Plane,PlaneTexture,0,0

Mirror=CreateMirror()

; Construct pyramid

For j#=wide To 1 Step -1
	For k#=1 To j
		AddObject(k#*Gap+(wide-j#)*Gap/2,RBW/2 + (wide-j#)*RBW)
		bcount=bcount+1
	Next
Next
		
addProjectile(EntityX(camera),EntityY(camera),EntityZ(camera))

		

; ###################################################################################################

While Not KeyHit(1)

UpdateControls()

; Calculate Time 
If T=0 Then T=MilliSecs()
T=MilliSecs() 

; Mouse Look code

; Poll Mouse Movement every 25ms ( 40/sec )
If T &gt; Time2 + 30 Then
	Time2=T
	mxs#=mxs#+(MouseXSpeed()-mxs#)/3
	mys#=mys#+(MouseYSpeed()-mys#)/3

	If MouseDown(2) Then 
		MoveMouse GraphicsWidth()/2,GraphicsHeight()/2
		p1#=p1#-mys#
		y1#=y1#-mxs#
		RotateEntity camera,-p1#,y1#,0
	EndIf
EndIf	

; Run Physics every 15ms ( 66/sec )
If T &gt; Time3 + 15 Then
	Time3=T	
	
	PTime=MilliSecs()

	UpdateGeoms()
	
	dSpaceCollide(Space,World,ContactGroup)
	
	UpdateSounds()
	
	dWorldQuickStep(World,.2)
	
	dJointGroupEmpty(ContactGroup)

	PhysicsTime#=MilliSecs()-PTime
End If

	UpdateWorld

	RenderWorld
	
	Color 255,255,255
	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime
	Text 0,30,"FPS:"+Fps()
	Color 255,0,0
	Text 0,60,"P - Planet="+Planet
	Color 255,255,255
	Text 0,75,"LM - Pushes Object"
	Text 0,90, "RM - Mouse Look"
	Text 0,105, "R  - Reconstruct Pyramid"
	Text 0,120, "WSAD - Movement"
    Text 0,135, "Space - Shoots"
	
	Flip  

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function AddObject(x#,height#)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)

dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,x,Height,0)

dBodySetAutoDisableFlag(ode\body,1)
mass=dMassCreate()
dMassSetBox(mass,1,5,5,5)
dMassSetBoxTotal(mass,20,5,5,5)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
ode\geom=dCreateBox(Space,5,5,5)
dGeomContactSetMode(ode\geom,dContactBounce)
dGeomContactSetBounce(ode\geom,0.0)
dGeomContactSetSoftERP(ode\geom,0.1)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,2.5,2.5,2.5
EntityColor ode\mesh,Rand(255),Rand(255),Rand(255)
EntityAlpha ode\mesh,1
EntityShininess ode\mesh,0.7

EntityPickMode ode\mesh,2 ; Make pickable

End Function

; ###################################################################################################

Function PosObject(x#,height#, body)

dBodyDisable(body)
dBodySetRotation(body,0,0,0)
dBodySetPosition(body,x,Height,0)
dBodySetLinearVel  (body, 0,0,0)
dBodySetAngularVel (body, 0,0,0)
dBodyEnable(body)

End Function

; ###################################################################################################

Function AddProjectile(X#,Y#,Z#)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)

dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,x#,Y#,Z#)

dBodySetAutoDisableFlag(ode\body,1)
mass=dMassCreate()
dMassSetBox(mass,1,5,5,5)
dMassSetBoxTotal(mass,20,5,5,5)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
ode\geom=dCreateBox(Space,5,5,5)
dGeomContactSetMode(ode\geom,dContactBounce)
dGeomContactSetBounce(ode\geom,0.0)
dGeomContactSetSoftERP(ode\geom,0.1)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,2.5,2.5,2.5
EntityColor ode\mesh,Rand(255),Rand(255),Rand(255)
EntityAlpha ode\mesh,1
EntityShininess ode\mesh,0.7

proj=ode\mesh ; ENTITY	
projbody=ode\body

End Function
; ###################################################################################################

Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
	If dBodyIsEnabled(ode\body)
		RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
		PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
	End If
Next

End Function

; ###################################################################################################

Function Fps()
Time=MilliSecs()

ElapsedTime=ElapsedTime+Time-LastTime
LastTime=Time
FrameCount=FrameCount+1

If ElapsedTime&gt;1000
	ElapsedTime=0
	Frames=FrameCount
	FrameCount=0
EndIf
Return Frames
End Function 

; ###################################################################################################

Function UpdateControls()

	If MouseDown(1)=1

	CameraPick(Camera,MouseX(),MouseY())
		If PickedEntity()
			For ode.ODEGeom=Each ODEGeom
				If ode\mesh=PickedEntity()
					dBodyEnable(ode\body)
					dBodyAddForce ode\body,-300*PickedNX#(),-300*PickedNY#(),-300*PickedNZ#()
				End If
			Next
		End If
	End If


	; Spacebar - Fire
	If KeyHit(57) Then
		dBodyDisable(Projbody)
		; Set projectile to match camera orientation
		dBodySetRotation(Projbody,EntityPitch(camera),EntityYaw(camera),EntityRoll(camera))
		dBodySetPosition(Projbody,EntityX(camera),EntityY(camera),EntityZ(camera))
		; Set projectile velocity and spin to zero
		dBodySetLinearVel  (Projbody, 0,0,0)
		dBodySetAngularVel (Projbody, 0,0,0)
		
		dBodyEnable(Projbody)
		dBodyAddRelForce(Projbody,0,0,2500)
		
		PlaySound snd2
	EndIf
	
	; Reconstruct pyramid
	If KeyDown(19) Then
		ode.ODEGeom=First ODEGeom
		
			; Construct pyramid
	
			For j#=wide To 1 Step -1
				For k#=1 To j
					PosObject(k#*Gap+(wide-j#)*Gap/2,RBW/2 + (wide-j#)*RBW,ode\body)

					ode = After ode
				Next
			Next
			
		
	End If

; WSAD - Movement

; W- Forward
If KeyDown(17) Or KeyDown(200) Then
	MoveEntity camera,0,0,1
EndIf
; S- Reverse
If KeyDown(31) Or KeyDown(208) Then
	MoveEntity camera,0,0,-1
EndIf

; A- Left
If KeyDown(30) Or KeyDown(203) Then
	MoveEntity camera,-1,0,0
EndIf
; D- Right
If KeyDown(32) Or KeyDown(205) Then
	MoveEntity camera,1,0,0
EndIf

; G - Gravity
If KeyHit(25) Then
	gx=gx+1
	If gx&gt;4 Then gx=1
	Select gx
	  Case 1
		Planet="Earth "
		dWorldSetGravity(World,0,-1.0,0)
	
	  Case 2
		Planet="Mars"
		dWorldSetGravity(World,0,-.33333,0)

	  Case 3
		Planet="Moon"
		dWorldSetGravity(World,0,-.16666,0)
		
	  Case 4
		Planet="Space"
		dWorldSetGravity(World,0,0,0)
	End Select
	
EndIf


End Function

; ###################################################################################################

Function UpdateSounds()

For ode.ODEGeom=Each ODEGeom
	If dGeomIsEnabled(ode\geom)
		numjoints=dBodyGetNumJoints(ode\body)
		If numjoints&gt;0 
		
			For joints=0 To numjoints-1
				joint=dBodyGetJoint(ode\body,joints)
				If dJointGetType(joint)=dJointTypeContact
					
					; Get linear velocity vector
			  		ax#=dBodyGetLinearVelX#(ode\body)
			  		ay#=dBodyGetLinearVelY#(ode\body)
				    az#=dBodyGetLinearVelZ#(ode\body)
					; Get Angular velocity vector
			  		bx#=dBodyGetAngularVelX#(ode\body)
			  		by#=dBodyGetAngularVelY#(ode\body)
					bz#=dBodyGetAngularVelZ#(ode\body)
			  		; Calculate magnitudes
					ForceA#=Sqr(ax*ax+ay*ay+az*az)
					ForceB#=Sqr(bx*bx+by*by+bz*bz)
					
					;If ForceA&gt;.01
					;	LinearDamp(ode\body,.04)
					;End If
					
					If ForceA&gt;1.5
						PositionEntity piv1,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
						EmitSound(snd1,piv1)
					End If

					;If ForceB&gt;.01
					;	AngularDamp(ode\body,.06)
					;End If
					
				End If
			Next
		End If
	End If
Next

End Function
</textarea> <br><br></td></tr></table><br>
<a name="543441"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm off to play with spaces, terrains, and jeeps next. Hold on tight while we explore a small multiplayer demolition game. <br><br></td></tr></table><br>
<a name="544468"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> several ode function declarations are not consistant.<br><br>dWorldSetERP(sim,erp#):"odeWorldSetERP@8"<br>dWorldGetERP#(sim):"odeWorldGetERP@4"<br><br>should be:<br><br>dWorldSetERP(world,erp#):"odeWorldSetERP@8"<br>dWorldGetERP#(world):"odeWorldGetERP@4"<br><br>8) <br><br></td></tr></table><br>
<a name="544498"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> Already fixed those in the new V1.05 update to be released very shortly...<br><br>I can't wait to try the multiplayer demolition game btw :)<br><br>[edit] I hope your 'several' refers to 'two' because I haven't spotted any more ;) <br><br></td></tr></table><br>
<a name="544583"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> <b>JV-ODE Version 1.05 Released</b><br><br>Please check your inbox :)<br><br>As requested by Shifty Geezer, new functions have been added to give more control over the contact surface collision responses.<br><br>dSetInternalContactSurfaceMode(mode) - set contact surface mode ( mean / max )<br>dGetInternalContactSurfaceMode%() - get contact surface mode ( 0 = mean   1 = max )<br><br>There are two modes:<br><b>0 = mean</b> - default (the same mode as in V1.04)<br>This mode adds the contact surface values for the two colliding geoms and averages the total value.<br>For example: TotalBounce = (Geom1Bounce + Geom2Bounce) / 2<br><br><b>1 = max</b><br>This mode uses the highest geom contact surface value only and discards the lower value.<br>For example: TotalBounce = *Geom1Bounce <b>or</b> *Geom2Bounce (* = whichever is higher)<br>If both values are equal, the value from Geom 1 is used.<br><br>Version 1.05 also includes an improved ragdoll demo and a bugfix.<br><br>:) <br><br></td></tr></table><br>
<a name="544596"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KuRiX</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> Lot of updates in short time! Keep the good work Viper! <br><br></td></tr></table><br>
<a name="544607"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> how do you create a 'player'<br>e.g. a rigid body that you control,<br>1.stops suddenly when no keys are pressed<br>2.bumps into things with no inertia and doesnt push objects around but has sliding collision with objects <br><br></td></tr></table><br>
<a name="544611"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> Cheers KuRiX ;)<br><br>@Slenkar: create an ODE sphere, then apply force with 'dBodyAddForce()' when keys are pressed. To stop the sphere suddenly, apply an opposite force on the sphere. For the second item, create the other objects with a much higher mass than the sphere and with zero geom friction. <br><br></td></tr></table><br>
<a name="544625"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> thanks, ill try that out<br>EDIT-it accelerates the player forwards,<br>instead of moving forward at a certain rate<br>Is there a way to limit the speed? <br><br></td></tr></table><br>
<a name="544634"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Slenkar: Have you tried Psychic Parrots demo? It uses a slightly different method which also limits the speed of the sphere.<br><br>Here it is...<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; JV-ODE - Key Controlled Sphere Demo Using Angular Velocities
; Code by Jim Williams (VIP3R)
; Arrow key control by Jeff (PsychicParrot)

AppTitle "JV-ODE - Key Controlled sphere Demo"

Include "jv-ode.bb"

Graphics3D 800,600,0,2

Type ODEGeom

	Field body
	Field geom
	Field mesh
	Field pivot ; To find direction vectors
	Field head  ; Just a stupid head to show which direction it's going in!
	Field inair ; To tell if player is on the ground or not!!
	
End Type

; ### Setup ODE

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetGravity(World,0,-1,0)
dContactSetMode(dContactBounce)
dContactSetBounce(0.2)
dContactSetMu(38)

; ### Create light

Global Light=CreateLight()

RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera

Global Camera=CreateCamera()
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000
PositionEntity Camera,0,20,-50
RotateEntity Camera,30,0,0

; ### Control vars

Global potato#=0 ; y rotation of thingy (rotater,rotato,potato!!)
Global spud#
Global fwd_key
Global back_key
Global left_key
Global right_key
Global jump_key

; ### Create plane

dCreatePlane(Space,0,1,0,0)

Plane=CreatePlane()

EntityAlpha Plane,0.8

PlaneTexture=CreateTexture(128,128,9)

ClsColor 0,200,80
Cls

Color 255,255,255

Rect 0,0,64,64,1
Rect 64,64,64,64,1

CopyRect 0,0,128,128,0,0,BackBuffer(),TextureBuffer(PlaneTexture)
ScaleTexture PlaneTexture,20,20
EntityTexture Plane,PlaneTexture,0,0
EntityPickMode plane,2

Mirror=CreateMirror()

AddObject() ; Add our thingy to the world

While Not KeyHit(1)

	PTime=MilliSecs()

	; Update controls
	
	c.ODEGeom=First ODEGeom
	Getkeys(c)
	movethingy(c)
	lookforground(c)
	
	PointEntity (camera,c\mesh)
	
	UpdateGeoms()

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.14)
	dJointGroupEmpty(ContactGroup)

	PhysicsTime#=MilliSecs()-PTime

	UpdateWorld

	RenderWorld

	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime

	Flip

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

Function getkeys(c.ODEGeom)

	fwd_key=False
	back_key=False
	left_key=False
	right_key=False
	jump_key=False

	If c\inair=False Then ; Only let player control 'thrust' when on the ground
	
		If KeyDown(200) Then fwd_key=True
		If KeyDown(208) Then back_key=True

	EndIf
	
		If KeyDown(205) Then left_key=True
		If KeyDown(203) Then right_key=True
		If KeyDown(57) Then jump_key=True

	;EndIf

End Function

Function lookforground(c.ODEGeom)

	If LinePick(EntityX(c\mesh,True),EntityY(c\mesh,True)+1,EntityZ(c\mesh,True),0,-4,0)&lt;&gt;0 Then ; Check for anything 'under' player
		c\inair=False
	  Else
		c\inair=True
	EndIf

End Function

Function movethingy(c.ODEGeom)

	If fwd_key=True Then
		spud=spud+.1
	EndIf

	If back_key=True Then
		spud=spud-.1
	EndIf
	
	If left_key=True Then
		potato=potato-2
	End If
	
	If right_key=True Then
		potato=potato+2
	End If

	If jump_key=True And c\inair=False Then		
		dBodyAddForce(c\body,0,16 ,0)		
	End If

	RotateEntity c\head,0,potato#,0
	
	; Add forward force

	TFormVector 0,0,spud,c\head,0
	
	vx# = dBodyGetAngularVelX(c\body) + TFormedX()
	vy# = dBodyGetAngularVelY(c\body) + TFormedY()
	vz# = dBodyGetAngularVelZ(c\body) + TFormedZ()

	damping#=.8
	dBodySetAngularVel(c\body,vx#*damping#,vy#*damping#,vz#*damping#)

	spud=spud*.9
	
End Function

Function AddObject()

xp=Rand(-8,8)
zp=Rand(-8,8)
ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp,30,zp)
dBodySetAutoDisableFlag(ode\body,0)
ode\geom=dCreateSphere(Space,3)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateSphere()
ScaleMesh ode\mesh,3,3,3
EntityColor ode\mesh,Rand(255),Rand(255),Rand(255)
EntityAlpha ode\mesh,1
EntityShininess ode\mesh,0.7
ode\head=CreateCube()

ScaleMesh ode\head,1.5,1.5,1.5

ode\pivot=CreatePivot() ; Create pivot to get direction vectors

End Function


Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
	
		RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
		
		PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
		
		PositionEntity ode\head,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom)+4.5,dGeomGetPositionZ#(ode\geom)
	
Next

End Function
</textarea> <br><br></td></tr></table><br>
<a name="544668"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PsychicParrot</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#32">[#32]</a></td></tr></table></td></tr><tr ><td class="posttext"> Woohoo! Another update! Thanks, Vip3r. I'm totally pleased with JV-ODE and I totally recommend it to anyone with Blitz .. it's just an essential thing to have in the blitz toolkit IMO, even if it's just for making things roll around in a cool way! <br><br></td></tr></table><br>
<a name="544716"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#33">[#33]</a></td></tr></table></td></tr><tr ><td class="posttext"> thanks,I ordered the wrapper by paypal yesterday so maybe Ill get to try out a few alterations to  the code with relative-forces and a cube which i was having success with in Tokamak except for the acceleration issue. <br><br></td></tr></table><br>
<a name="544860"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#34">[#34]</a></td></tr></table></td></tr><tr ><td class="posttext"> You're welcome PP and thanks :)<br><br>No problem Slenkar, you should receive your wrapper as soon as payment is confirmed. Thanks for your support ;) <br><br></td></tr></table><br>
<a name="544946"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#35">[#35]</a></td></tr></table></td></tr><tr ><td class="posttext"> Many thanks VIP3R. The new system works great - my bouncy balls bounce! <br><br></td></tr></table><br>
<a name="546407"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#36">[#36]</a></td></tr></table></td></tr><tr ><td class="posttext"> Got the wrapper now thanks,<br><br>Can I have a demo of getting collision info for a ray please?<br><br>I need to use a ray to pick an ODE geom and apply a force in the direction of the ray.<br><br>The ragdoll demo used blitz picking commands, in games the ragdolls dont have blitz entities at every joint <br>(I dont think you can pick bones, and they are too small anyway)<br> so those commands cant be used.<br><br>I tried modifying the ragdoll demo to use collision with an ODE ray but I had no luck.<br><br>Also is there a master list of all the commands anywhere?<br>I have the official ODE manual but I need the blitz-equivalents.<br>e.g. dgeomcollisiony#() <br>That command is not in the official ODE manual but it is a command that can be used in blitz.I need the entire list - thank you. <br><br></td></tr></table><br>
<a name="546460"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#37">[#37]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'll look into the ray thing for you. The 'JV-ODE.decls' file lists all of the non-ODE commands towards the base and the 'Version History.txt' file also contains some more info for some of these commands. There isn't a manual for the non-ODE commands yet, but most are self explanatory. Some of the non-ODE commands are shown in the demos too, for example the use of dGeomCollisionY#() is shown in the 'CarDemo-DetailedC.bb' demo. <br><br></td></tr></table><br>
<a name="546576"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#38">[#38]</a></td></tr></table></td></tr><tr ><td class="posttext"> thanks I managed to get all the commands,<br>has anyone managed to construct a ragdoll based on an animated mesh, ?????<br>I think the position of the joints can be found with the position of the bones found with findchild easily enough but then somehow you have to place the rigid bodies between the joints (at global cordinates) blitz can only find the positions of the joints, so I end up putting the geoms and joints in the same place.<br>So the ragdoll ends up looking distorted and moves stiffly. <br><br></td></tr></table><br>
<a name="546591"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >taxlerendiosk</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#39">[#39]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello, I've just got your wrapper and I'm testing it out, nice work. I'm trying to modify the demos to have thin cylinders (like coins) but I'm having some problems, that I'm guessing is to do with ODE itself rather than the Blitz interface.<br><br>One, if I allow them to drop "straight", when two of them hit each other both of them seem to completely disappear. Why is this? If I put a bit of torque on them when they are created this doesn't happen. But when there is a pile of them, they seem to constantly squish up and down a bit oddly, is there a way to make them a bit "harder"? Finally, I tried to set AutoDisableFlag so they would disable, but it didn't seem to work - I tried turning off the bit of torque and it did start to work (but the disappearing problem returned). Even though they seemed to be lying flat, they would never disable, once I re-added the torque.<br><br>I'd really appreciate any help with this :P <br><br></td></tr></table><br>
<a name="546597"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#40">[#40]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>One, if I allow them to drop "straight", when two of them hit each other both of them seem to completely disappear. Why is this? If I put a bit of torque on them when they are created this doesn't happen.<br> <br></div><br>This is a common problem with standard cylinders in ODE. The torque fix is news to me though, good find :)<br><br><div class="quote"> <br>But when there is a pile of them, they seem to constantly squish up and down a bit oddly, is there a way to make them a bit "harder"?<br> <br></div><br>Try altering the Geom ERP and CFM values with these...<br>dGeomContactSetSoftERP(geom,erp#)<br>dGeomContactSetSoftCFM(geom,cfm#)<br><br>or alter the world (global) settings with these...<br>dWorldSetERP(world,erp#)<br>dWorldSetCFM(world,cfm#)<br><br>Also, try adding mass and density.<br><br>If you're still stuggling, can you post your code (or send via email) so that I can take a look for you. <br><br></td></tr></table><br>
<a name="546602"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#41">[#41]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Slenkar: Some of the Ray functions return a vector, maybe that's what you're having problems with. All the Ray functions behave like line pick etc in Blitz with the exception of dGeomRayGetStart(ray) and dGeomRayGetDir(ray) which fill an internal vector.<br><br>To use these two commands you would do something like this...<br>dGeomRayGetStart(ray)<br>raystartx#=dVectorX()<br>raystarty#=dVectorY()<br>raystartz#=dVectorZ()<br><br>dGeomRayGetDir(ray)<br>raydirx#=dVectorX()<br>raydiry#=dVectorY()<br>raydirz#=dVectorZ()<br><br>If you still have problems, post your code (or send it via email) and I'll take a look for you. <br><br></td></tr></table><br>
<a name="546637"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#42">[#42]</a></td></tr></table></td></tr><tr ><td class="posttext"> denzilquixode : Cylinders are bust! That's the long and short of it. Getting coins to work seems a total no-no. Landing on their round sides isn't too bad, but the flat ends of cylinders are erratic and unpredictable.<br><br>The only possible solution is a capped cylinder. Embedded a box or three inside the cylinder to function as the flat edges for collisions, while the round surface will still roll. But it's not a perfect solution. <br><br></td></tr></table><br>
<a name="546681"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ricky Smith</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#43">[#43]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>has anyone managed to construct a ragdoll based on an animated mesh, ?????<br> <br></div><br>This uses the JV-ODE wrapper :<br><br><a href="http://webzoom.freewebs.com/smiff/blitz/rged2.wmv" target="_blank">http://webzoom.freewebs.com/smiff/blitz/rged2.wmv</a><br><a href="http://webzoom.freewebs.com/smiff/blitz/rged3.wmv" target="_blank">http://webzoom.freewebs.com/smiff/blitz/rged3.wmv</a><br><a href="http://webzoom.freewebs.com/smiff/blitz/robot1.wmv" target="_blank">http://webzoom.freewebs.com/smiff/blitz/robot1.wmv</a> <br><br></td></tr></table><br>
<a name="546693"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#44">[#44]</a></td></tr></table></td></tr><tr ><td class="posttext"> Can anyone provide an example of a hinge2 joint?<br>I'm trying to create a ragdoll, based on VIP3R's demo code. I'm replacing the single axis hing of the arms with hinge2, to providea full range of side and forwards/backwards motion, where the hinge arm is limited in how much it can raise up.<br><br>Howver, setting the parameters <br><br>dJointSetHinge2Axis1(RDJoint(rd,3),1,0,0)<br>dJointSetHinge2Axis2(RDJoint(rd,3),0,0,1)<br>dJointSetHinge2Anchor(RDJoint(rd,3),xp+1,yp-0.75,zp)<br>dJointSetHinge2Param(RDJoint(rd,3),dParamLoStop,-0.50)<br>dJointSetHinge2Param(RDJoint(rd,3),dParamHiStop,0.50)<br>dJointSetHinge2Param(RDJoint(rd,3),dParamLoStop2,-0.50)<br>dJointSetHinge2Param(RDJoint(rd,3),dParamHiStop2,0.50)<br><br>is variations of, I can't get the arm to rotate +/- 180 degrees forwards and backwards (z axis I think) and +/- 90 degrees from horizontally outstraight.<br><br>Alternatively a ball and socket joint that could be locked within limits would be ideal, but it appears ball joints are 360 degrees in all directions. <br><br></td></tr></table><br>
<a name="546740"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >taxlerendiosk</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#45">[#45]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for your help on cylinders - I thought it would be like that, cylinders are obviously tricky bastards...<br><br>Right now I'm trying to get the torque of a body, how do I do that? How do I use what dBodyGetTorque returns? <br><br></td></tr></table><br>
<a name="546774"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#46">[#46]</a></td></tr></table></td></tr><tr ><td class="posttext"> thanks for the help Viper Ill check that out.<br><br>Hey Smiff, are we able to get source code with pacemaker? (for ragdoll creation)<br><br>give me a hint, did you use<br>Dcreategeomtransform???<br><br>Believe it or not, I am trying to create the ragdoll for the exact same zombie mesh that was in the video!<br><br>EDIT- I solved the problem by changing the position of the joints to the correct places, i was placing them in the position of the current bone instead of the next bone- which now gives very realistic looking behaviour <br><br></td></tr></table><br>
<a name="546842"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#47">[#47]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Shifty Geezer: The dParamLoStop2 and dParamHiStop2 constants aren't present in the include file, so unless you've set them elsewhere they won't work properly. Here are the correct constants for them...<br>dParamLoStop2=256<br>dParamHiStop2=257<br><br>I'll add these to the include file when a new wrapper version is released.<br><br>@denzilquixode: dBodyGetTorque() fills an internal vector which you can get using dVectorX(), dVectorY() and dVectorZ().<br><br>To use it, first call the get torque function, then return the values with the vector functions. Like this...<br>dBodyGetTorque(body)<br>torquex#=dVectorX()<br>torquey#=dVectorY()<br>torquez#=dVectorZ() <br><br></td></tr></table><br>
<a name="546920"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#48">[#48]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks VIP3R. That's sorted it. Oh, and for those who don't know (like it took me a while to figure!) the degree values for constraints are in radians, not Blitz's standard cartesian degrees.<br><br>Here's code for some wigglier ragdolls that can replace the RagDoll() function in the JV-ODE demo.<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Function CreateRagDoll(rd)

xp=-8+(rd*4)
yp=7
zp=4

; ### RagDoll Dimensions

headrad#=0.4
bodytx#=1.5
bodyty#=1.5
bodytz#=0.5
bodybx#=1.5
bodyby#=0.75
bodybz#=0.5
larmrad#=0.15
larmlen#=0.9
rarmrad#=0.15
rarmlen#=0.9
llegrad#=0.25
lleglen#=0.8
rlegrad#=0.25
rleglen#=0.8
feetx#=0.5
feety#=0.25
feetz#=1.0

; ### Create Head

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
Head(rd)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp,yp,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\geom=dCreateSphere(Space,headrad)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateSphere()
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,headrad,headrad,headrad
EntityColor ode\mesh,255,255,255

; ### Create Body (Upper)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
BodyU(rd)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp,yp-1.25,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\geom=dCreateBox(Space,bodytx,bodyty,bodytz)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,bodytx*0.5,bodyty*0.5,bodytz*0.5
EntityColor ode\mesh,0,200,200

; ### Create Body (Lower)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
BodyL(rd)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp,yp-2.5,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\geom=dCreateBox(Space,bodybx,bodyby,bodybz)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,bodybx*0.5,bodyby*0.5,bodybz*0.5
EntityColor ode\mesh,0,100,100

; ### Create Left Arm (Upper)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
LArmU(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp+1,yp-1.25,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\geom=dCreateCCylinder(Space,larmrad,larmlen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,larmrad,(larmlen*0.5)+larmrad,larmrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,255,0,0

; ### Create Left Arm (Lower)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
LArmL(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp+1,yp-2.5,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\geom=dCreateCCylinder(Space,larmrad,larmlen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,larmrad,(larmlen*0.5)+larmrad,larmrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,125,0,0

; ### Create Right Arm (Upper)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RArmU(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp-1,yp-1.25,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\geom=dCreateCCylinder(Space,rarmrad,rarmlen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,rarmrad,(rarmlen*0.5)+rarmrad,rarmrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,0,255,0

; ### Create Right Arm (Lower)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RArmL(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp-1,yp-2.5,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\geom=dCreateCCylinder(Space,rarmrad,rarmlen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,rarmrad,(rarmlen*0.5)+rarmrad,rarmrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,0,125,0

; ### Create Left Leg (Upper)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
LLegU(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp+0.5,yp-3.6,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\geom=dCreateCCylinder(Space,llegrad,lleglen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,llegrad,(lleglen*0.5)+llegrad,llegrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,255,0,0

; ### Create Left Leg (Lower)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
LLegL(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp+0.5,yp-4.9,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\geom=dCreateCCylinder(Space,llegrad,lleglen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,llegrad,(lleglen*0.5)+llegrad,llegrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,125,0,0

; ### Create Right Leg (Upper)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RLegU(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp-0.5,yp-3.6,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\geom=dCreateCCylinder(Space,rlegrad,rleglen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,rlegrad,(rleglen*0.5)+rlegrad,rlegrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,0,255,0

; ### Create Right Leg (Lower)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RLegL(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp-0.5,yp-4.9,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\geom=dCreateCCylinder(Space,rlegrad,rleglen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,rlegrad,(rleglen*0.5)+rlegrad,rlegrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,0,125,0

; ### Create Left Foot

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
LFoot(rd)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp+0.5,yp-5.7,zp-0.25)
dBodySetAutoDisableFlag(ode\body,1)
ode\geom=dCreateBox(Space,feetx,feety,feetz)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,feetx*0.5,feety*0.5,feetz*0.5
EntityColor ode\mesh,200,0,100

; ### Create Right Foot

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RFoot(rd)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp-0.5,yp-5.7,zp-0.25)
dBodySetAutoDisableFlag(ode\body,1)
ode\geom=dCreateBox(Space,feetx,feety,feetz)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,feetx*0.5,feety*0.5,feetz*0.5
EntityColor ode\mesh,100,200,0

; ### Static Joint To Head

RDJoint(rd,0)=dJointCreateBall(World,0)
dJointAttach(RDJoint(rd,0),0,Head(rd))
dJointSetBallAnchor(RDJoint(rd,0),xp,yp,zp)

; ### Head To Body (Upper)

RDJoint(rd,1)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,1),Head(rd),BodyU(rd))
dJointSetHingeAxis(RDJoint(rd,1),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,1),xp,yp-0.25,zp)
dJointSetHingeParam(RDJoint(rd,1),dParamLoStop,-0.5)
dJointSetHingeParam(RDJoint(rd,1),dParamHiStop,0.5)
dJointSetHingeParam(RDJoint(rd,1),dParamBounce,0.0)

; ### Body (Upper) To Body (Lower)

RDJoint(rd,2)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,2),BodyU(rd),BodyL(rd))
dJointSetHingeAxis(RDJoint(rd,2),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,2),xp,yp-2,zp)
dJointSetHingeParam(RDJoint(rd,2),dParamLoStop,-0.25)
dJointSetHingeParam(RDJoint(rd,2),dParamHiStop,0.25)
dJointSetHingeParam(RDJoint(rd,2),dParamBounce,0.0)

; ### Left Arm (Upper) To Body (Upper)

RDJoint(rd,3)=dJointCreateUniversal(World,0)
dJointAttach(RDJoint(rd,3),LArmU(rd),BodyU(rd))
dJointSetUniversalAxis1(RDJoint(rd,3),1,0,0)
dJointSetUniversalAxis2(RDJoint(rd,3),0,0,1)
dJointSetUniversalAnchor(RDJoint(rd,3),xp+1,yp-0.75,zp)
dJointSetUniversalParam(RDJoint(rd,3),dParamLoStop,-1.141)
dJointSetUniversalParam(RDJoint(rd,3),dParamHiStop,1.141)
dJointSetUniversalParam(RDJoint(rd,3),dParamLoStop2,0.0)
dJointSetUniversalParam(RDJoint(rd,3),dParamHiStop2,3.000)

; ### Left Arm (Lower) To Left Arm (Upper)

RDJoint(rd,4)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,4),LArmL(rd),LArmU(rd))
dJointSetHingeAxis(RDJoint(rd,4),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,4),xp+1,yp-2,zp)
dJointSetHingeParam(RDJoint(rd,4),dParamLoStop,0.0)
dJointSetHingeParam(RDJoint(rd,4),dParamHiStop,2.0)

; ### Right Arm (Upper) To Body (Upper)

RDJoint(rd,5)=dJointCreateUniversal(World,0)
dJointAttach(RDJoint(rd,5),RArmU(rd),BodyU(rd))
dJointSetUniversalAxis1(RDJoint(rd,5),1,0,0)
dJointSetUniversalAxis2(RDJoint(rd,5),0,0,-1)
dJointSetUniversalAnchor(RDJoint(rd,5),xp-1,yp-0.75,zp)
dJointSetUniversalParam(RDJoint(rd,5),dParamLoStop,-1.141)
dJointSetUniversalParam(RDJoint(rd,5),dParamHiStop,1.141)
dJointSetUniversalParam(RDJoint(rd,5),dParamLoStop2,0.0)
dJointSetUniversalParam(RDJoint(rd,5),dParamHiStop2,3.000)

; ### Right Arm (Lower) To Right Arm (Upper)

RDJoint(rd,6)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,6),RArmL(rd),RArmU(rd))
dJointSetHingeAxis(RDJoint(rd,6),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,6),xp-1,yp-2,zp)
dJointSetHingeParam(RDJoint(rd,6),dParamLoStop,0.0)
dJointSetHingeParam(RDJoint(rd,6),dParamHiStop,2.0)

; ### Left Leg (Upper) To Body (Lower)

RDJoint(rd,7)=dJointCreateUniversal(World,0)
dJointAttach(RDJoint(rd,7),LLegU(rd),BodyL(rd))
dJointSetUniversalAxis1(RDJoint(rd,7),1,0,0)
dJointSetUniversalAxis2(RDJoint(rd,7),0,0,1)
dJointSetUniversalAnchor(RDJoint(rd,7),xp+0.7,yp-2.5,zp)
dJointSetUniversalParam(RDJoint(rd,7),dParamLoStop,-1.0)
dJointSetUniversalParam(RDJoint(rd,7),dParamHiStop,1.0)
dJointSetUniversalParam(RDJoint(rd,7),dParamLoStop2,-0.0)
dJointSetUniversalParam(RDJoint(rd,7),dParamHiStop2,1.500)

; ### Left Leg (Lower) To Left Leg (Upper)

RDJoint(rd,8)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,8),LLegL(rd),LLegU(rd))
dJointSetHingeAxis(RDJoint(rd,8),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,8),xp+1,yp-4.25,zp)
dJointSetHingeParam(RDJoint(rd,8),dParamLoStop,-2.0)
dJointSetHingeParam(RDJoint(rd,8),dParamHiStop,0.0)

; ### Right Leg (Upper) To Body (Lower)

RDJoint(rd,9)=dJointCreateUniversal(World,0)
dJointAttach(RDJoint(rd,9),RLegU(rd),BodyL(rd))
dJointSetUniversalAxis1(RDJoint(rd,9),1,0,0)
dJointSetUniversalAxis2(RDJoint(rd,9),0,0,1)
dJointSetUniversalAnchor(RDJoint(rd,9),xp-0.7,yp-2.75,zp)
dJointSetUniversalParam(RDJoint(rd,9),dParamLoStop,-1.0)
dJointSetUniversalParam(RDJoint(rd,9),dParamHiStop,1.0)
dJointSetUniversalParam(RDJoint(rd,9),dParamLoStop2,-0.0)
dJointSetUniversalParam(RDJoint(rd,9),dParamHiStop2,1.500)

; ### Right Leg (Lower) To Right Leg (Upper)

RDJoint(rd,10)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,10),RLegL(rd),RLegU(rd))
dJointSetHingeAxis(RDJoint(rd,10),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,10),xp-1,yp-4.25,zp)
dJointSetHingeParam(RDJoint(rd,10),dParamLoStop,-2.0)
dJointSetHingeParam(RDJoint(rd,10),dParamHiStop,0.0)

; ### Left Foot To Left Leg (Lower)

RDJoint(rd,11)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,11),LFoot(rd),LLegL(rd))
dJointSetHingeAxis(RDJoint(rd,11),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,11),xp+1,yp-5.5,zp)
dJointSetHingeParam(RDJoint(rd,11),dParamLoStop,-0.25)
dJointSetHingeParam(RDJoint(rd,11),dParamHiStop,0.25)

; ### Right Foot To Right Leg (Lower)

RDJoint(rd,12)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,12),RFoot(rd),RLegL(rd))
dJointSetHingeAxis(RDJoint(rd,12),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,12),xp-1,yp-5.5,zp)
dJointSetHingeParam(RDJoint(rd,12),dParamLoStop,-0.25)
dJointSetHingeParam(RDJoint(rd,12),dParamHiStop,0.25)

End Function</textarea><br><br>Morw advice please VIP3R! How can Isave the current postion/states of joints? I've got my 'editor' where I can add objects to a scene and save the data to a file, and I can add a ragdoll. But I can't figure how to run the simulation and pause it halfway and sav the ragdoll data.<br><br>I'm think say add a RagDoll and a chair, and set up the editor to have the RagDoll fall ontot the chair so it's in a sitting position. I then want to save the positon of all the joints. There seems to be no dGetJointPosition() function. The only function that looks like it might be suitable is dGetJointData(), but what does the data hold and how is it structured? <br><br></td></tr></table><br>
<a name="546928"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#49">[#49]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>But I can't figure how to run the simulation and pause it halfway and sav the ragdoll data.<br> <br></div><br>To pause the simulation, do not call these...<br><i>dSpaceCollide(Space,World,ContactGroup)<br>dWorldQuickStep(World,stepsize)<br>dJointGroupEmpty(ContactGroup)</i><br>...in your main loop.<br><br><div class="quote"> <br>There seems to be no dGetJointPosition() function.<br> <br></div><br>To get the coords of a Hinge2 joint you would use the dJointGetHingeAnchor2(joint) function. Any ODE function mentioned in the docs that returns a 'dVector3 result' will fill an internal vector in JV-ODE. To use it, first call the get joint function then return the vector values, like so...<br>dJointGetHingeAnchor2(joint)<br>xposition#=dVectorX()<br>yposition#=dVectorY()<br>zposition#=dVectorZ()<br><br>I'm planning to document the vector and non-ODE functions, so hopefully they'll be a lot clearer for everyone ;) <br><br></td></tr></table><br>
<a name="546932"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#50">[#50]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah, for pausing what I do (in the editor) is disable all bodies, but then I can move them in realtime ;)<br><br>And of course, it's the anchor that defines a joint's position. I'm on the case! <br><br></td></tr></table><br>
<a name="547285"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stellar</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#51">[#51]</a></td></tr></table></td></tr><tr ><td class="posttext"> to VIP3R :<br>i have bought this product,how to remove text JV-ODE V1.05 at left top of the screen?does the consumer allowed to do it?how? <br><br></td></tr></table><br>
<a name="547365"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#52">[#52]</a></td></tr></table></td></tr><tr ><td class="posttext"> Change the text in the demo program from:<br><br>Text 0,0,"JV-ODE Version "+dGetVersion()<br><br>to this:<br><br>Text 0,0,"3ch0 ODE Eggstravaganza" <br><br></td></tr></table><br>
<a name="547544"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ricky Smith</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#53">[#53]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>Hey Smiff, are we able to get source code with pacemaker? (for ragdoll creation)<br> <br></div><br><br>Yes - it generates the source code to recreate the ragdoll. <br><br></td></tr></table><br>
<a name="548009"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#54">[#54]</a></td></tr></table></td></tr><tr ><td class="posttext"> How can we make jointed objects respond correctly with bounces?<br><br>I've got a doll made up of boxes, made of 'rubber', and I drop it onto a boxe made of 'rubber'. Rubber has a restituion of 0.85. If I drop a rubber box onto another rubber box (or any other surface thanks to Bounce=max!) it bounces high.<br><br>However my ragdoll doesn't. I set the bounce for each joint to the same as the bounce of the material the doll is made of, so in this case each joint has bounce=0.85, but it's response is very weak. If I set rubber's restitution to 1.85, the doll responds better but of course all normal bounces are crazy.<br><br>I've just tried setting joint bounce to material bounce * 2 (1.7 in this case) and it looks better. I tried bounce * 3 and the object explodes on impact.<br><br>It looks as though the individual boxes connected by a joint have no bounce of their own, as though adding a joint set a boxes bounce to 0. Even just two boxes connected with a hinge and dropped don't bounce, even though they should respond very similar to a single box of the same material. <br><br></td></tr></table><br>
<a name="548020"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#55">[#55]</a></td></tr></table></td></tr><tr ><td class="posttext"> Could you post some example code showing the problem, I've just tried connecting two cubes with a hinge joint and the bounce works fine here. <br><br></td></tr></table><br>
<a name="548085"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#56">[#56]</a></td></tr></table></td></tr><tr ><td class="posttext"> <textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #									   JV-ODE - Ragdoll Demo										#
; #									Code by Jim Williams (VIP3R)									#
; ###################################################################################################

AppTitle "JV-ODE - Ragdoll Demo"

Include "JV-ODE.bb"

Graphics3D 800,600,0,2

Global RagDollMax=3

Dim Head(RagDollMax)
Dim BodyU(RagDollMax)
Dim BodyL(RagDollMax)
Dim LArmU(RagDollMax)
Dim LArmL(RagDollMax)
Dim RArmU(RagDollMax)
Dim RArmL(RagDollMax)
Dim LLegU(RagDollMax)
Dim LLegL(RagDollMax)
Dim RLegU(RagDollMax)
Dim RLegL(RagDollMax)
Dim LFoot(RagDollMax)
Dim RFoot(RagDollMax)

Dim RDJoint(RagDollMax,12)

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

; ###################################################################################################

; ### Setup ODE

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,-0.98,0)
dContactSetMode(dContactSlip1+dContactBounce)
dContactSetBounce(0.0)
dSetInternalContactSurfaceMode(1)

; ### Create light

Global Light=CreateLight()

RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera

Global Camera=CreateCamera()
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000
PositionEntity Camera,0,20,-50
RotateEntity Camera,20,0,0
CameraZoom Camera,2

; ### Create plane

dCreatePlane(Space,0,1,0,0)

Plane=CreatePlane()

EntityAlpha Plane,0.8

PlaneTexture=CreateTexture(128,128,9)

ClsColor 0,150,80
Cls

Color 200,200,200

Rect 0,0,64,64,1
Rect 64,64,64,64,1

CopyRect 0,0,128,128,0,0,BackBuffer(),TextureBuffer(PlaneTexture)
ScaleTexture PlaneTexture,20,20
EntityTexture Plane,PlaneTexture,0,0

Color 255,255,255

Mirror=CreateMirror()

; ###################################################################################################

CreateRagDoll(count)
; ### Box

cube.ODEGeom=New ODEGeom
cube\geom=dCreateBox(Space,10,2,10)
dGeomSetPosition(cube\geom,0,1,0)
dGeomContactSetBounce(cube\geom,0.80)
dGeomContactSetMu(cube\geom,100)
cube\mesh=CreateCube()
EntityPickMode cube\mesh,2
ScaleMesh cube\mesh,5,1,5
PositionEntity cube\mesh,0,1,0
EntityColor cube\mesh,250,210,0

dBodySetTorque(BodyU(0),50,0,0)

box.ODEGeom=New ODEGeom
box\body=dBodyCreate(World)
dBodySetRotation(box\body,0,0,0)
dBodySetPosition(box\body,-4,20,0)
dBodySetAutoDisableFlag(box\body,1)
box\geom=dCreateBox(Space,2,2,2)
dGeomSetBody(box\geom,box\body)
box\mesh=CreateCube()
EntityPickMode box\mesh,2
ScaleMesh box\mesh,1,1,1

dBodySetTorque(box\body,0,0,0)


While Not KeyHit(1)

	UpdateControls()

	PTime=MilliSecs()

	UpdateGeoms()

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)

	PhysicsTime#=MilliSecs()-PTime

	UpdateWorld

	RenderWorld

	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime
	Text 300,0,"F1 - Drop RagDoll 1"
	Text 300,15,"F2 - Drop RagDoll 2"
	Text 300,30,"F3 - Drop RagDoll 3"
	Text 300,50,"Space - Throw RagDolls"
	Text 300,65,"Arrow Keys - Move Camera"
	Text 580,0,"F4 - Attach RagDoll 1"
	Text 580,15,"F5 - Attach RagDoll 2"
	Text 580,30,"F6 - Attach RagDoll 3"
	Text 580,50,"L Mouse Button - Push Body"
	Text 580,65,"R Mouse Button - Pull Body"

	Flip

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function CreateRagDoll(rd)
xp=0
yp=20
zp=0

; ### RagDoll Dimensions

headrad#=0.4
bodytx#=1.5
bodyty#=1.5
bodytz#=0.5
bodybx#=1.5
bodyby#=0.75
bodybz#=0.5
larmrad#=0.15
larmlen#=0.9
rarmrad#=0.15
rarmlen#=0.9
llegrad#=0.25
lleglen#=0.8
rlegrad#=0.25
rleglen#=0.8
feetx#=0.5
feety#=0.25
feetz#=1.0

; ### Create Head

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
Head(rd)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp,yp,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\geom=dCreateSphere(Space,headrad)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateSphere()
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,headrad,headrad,headrad
EntityColor ode\mesh,255,255,255

; ### Create Body (Upper)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
BodyU(rd)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp,yp-1.25,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\geom=dCreateBox(Space,bodytx,bodyty,bodytz)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,bodytx*0.5,bodyty*0.5,bodytz*0.5
EntityColor ode\mesh,0,200,200

; ### Create Body (Lower)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
BodyL(rd)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp,yp-2.5,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\geom=dCreateBox(Space,bodybx,bodyby,bodybz)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,bodybx*0.5,bodyby*0.5,bodybz*0.5
EntityColor ode\mesh,0,100,100

; ### Create Left Arm (Upper)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
LArmU(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp+1,yp-1.25,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\geom=dCreateCCylinder(Space,larmrad,larmlen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,larmrad,(larmlen*0.5)+larmrad,larmrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,255,0,0

; ### Create Left Arm (Lower)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
LArmL(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp+1,yp-2.5,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\geom=dCreateCCylinder(Space,larmrad,larmlen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,larmrad,(larmlen*0.5)+larmrad,larmrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,125,0,0

; ### Create Right Arm (Upper)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RArmU(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp-1,yp-1.25,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\geom=dCreateCCylinder(Space,rarmrad,rarmlen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,rarmrad,(rarmlen*0.5)+rarmrad,rarmrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,0,255,0

; ### Create Right Arm (Lower)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RArmL(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp-1,yp-2.5,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\geom=dCreateCCylinder(Space,rarmrad,rarmlen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,rarmrad,(rarmlen*0.5)+rarmrad,rarmrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,0,125,0

; ### Create Left Leg (Upper)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
LLegU(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp+0.5,yp-3.6,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\geom=dCreateCCylinder(Space,llegrad,lleglen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,llegrad,(lleglen*0.5)+llegrad,llegrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,255,0,0

; ### Create Left Leg (Lower)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
LLegL(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp+0.5,yp-4.9,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\geom=dCreateCCylinder(Space,llegrad,lleglen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,llegrad,(lleglen*0.5)+llegrad,llegrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,125,0,0

; ### Create Right Leg (Upper)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RLegU(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp-0.5,yp-3.6,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\geom=dCreateCCylinder(Space,rlegrad,rleglen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,rlegrad,(rleglen*0.5)+rlegrad,rlegrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,0,255,0

; ### Create Right Leg (Lower)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RLegL(rd)=ode\body
dBodySetRotation(ode\body,90,0,0)
dBodySetPosition(ode\body,xp-0.5,yp-4.9,zp)
dBodySetAutoDisableFlag(ode\body,1)
ode\geom=dCreateCCylinder(Space,rlegrad,rleglen)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCylinder(8)
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,rlegrad,(rleglen*0.5)+rlegrad,rlegrad
RotateMesh ode\mesh,90,0,0
EntityColor ode\mesh,0,125,0

; ### Create Left Foot

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
LFoot(rd)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp+0.5,yp-5.7,zp-0.25)
dBodySetAutoDisableFlag(ode\body,1)
ode\geom=dCreateBox(Space,feetx,feety,feetz)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,feetx*0.5,feety*0.5,feetz*0.5
EntityColor ode\mesh,200,0,100

; ### Create Right Foot

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
RFoot(rd)=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,xp-0.5,yp-5.7,zp-0.25)
dBodySetAutoDisableFlag(ode\body,1)
ode\geom=dCreateBox(Space,feetx,feety,feetz)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
EntityPickMode ode\mesh,2
ScaleMesh ode\mesh,feetx*0.5,feety*0.5,feetz*0.5
EntityColor ode\mesh,100,200,0

; ***** JOINTS JOINTS JOINTS *****
; ### Head To Body (Upper)

RDJoint(rd,1)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,1),Head(rd),BodyU(rd))
dJointSetHingeAxis(RDJoint(rd,1),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,1),xp,yp-0.25,zp)
dJointSetHingeParam(RDJoint(rd,1),dParamLoStop,-0.5)
dJointSetHingeParam(RDJoint(rd,1),dParamHiStop,0.5)
dJointSetHingeParam(RDJoint(rd,1),dParamBounce,0.0)

; ### Body (Upper) To Body (Lower)

RDJoint(rd,2)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,2),BodyU(rd),BodyL(rd))
dJointSetHingeAxis(RDJoint(rd,2),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,2),xp,yp-2,zp)
dJointSetHingeParam(RDJoint(rd,2),dParamLoStop,-0.25)
dJointSetHingeParam(RDJoint(rd,2),dParamHiStop,0.25)
dJointSetHingeParam(RDJoint(rd,2),dParamBounce,0.0)

; ### Left Arm (Upper) To Body (Upper)

RDJoint(rd,3)=dJointCreateUniversal(World,0)
dJointAttach(RDJoint(rd,3),LArmU(rd),BodyU(rd))
dJointSetUniversalAxis1(RDJoint(rd,3),1,0,0)
dJointSetUniversalAxis2(RDJoint(rd,3),0,0,1)
dJointSetUniversalAnchor(RDJoint(rd,3),xp+1,yp-0.75,zp)
dJointSetUniversalParam(RDJoint(rd,3),dParamLoStop,-1.141)
dJointSetUniversalParam(RDJoint(rd,3),dParamHiStop,1.141)
dJointSetUniversalParam(RDJoint(rd,3),dParamLoStop2,0.0)
dJointSetUniversalParam(RDJoint(rd,3),dParamHiStop2,3.000)

; ### Left Arm (Lower) To Left Arm (Upper)

RDJoint(rd,4)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,4),LArmL(rd),LArmU(rd))
dJointSetHingeAxis(RDJoint(rd,4),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,4),xp+1,yp-2,zp)
dJointSetHingeParam(RDJoint(rd,4),dParamLoStop,0.0)
dJointSetHingeParam(RDJoint(rd,4),dParamHiStop,2.0)

; ### Right Arm (Upper) To Body (Upper)

RDJoint(rd,5)=dJointCreateUniversal(World,0)
dJointAttach(RDJoint(rd,5),RArmU(rd),BodyU(rd))
dJointSetUniversalAxis1(RDJoint(rd,5),1,0,0)
dJointSetUniversalAxis2(RDJoint(rd,5),0,0,-1)
dJointSetUniversalAnchor(RDJoint(rd,5),xp-1,yp-0.75,zp)
dJointSetUniversalParam(RDJoint(rd,5),dParamLoStop,-1.141)
dJointSetUniversalParam(RDJoint(rd,5),dParamHiStop,1.141)
dJointSetUniversalParam(RDJoint(rd,5),dParamLoStop2,0.0)
dJointSetUniversalParam(RDJoint(rd,5),dParamHiStop2,3.000)

; ### Right Arm (Lower) To Right Arm (Upper)

RDJoint(rd,6)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,6),RArmL(rd),RArmU(rd))
dJointSetHingeAxis(RDJoint(rd,6),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,6),xp-1,yp-2,zp)
dJointSetHingeParam(RDJoint(rd,6),dParamLoStop,0.0)
dJointSetHingeParam(RDJoint(rd,6),dParamHiStop,2.0)

; ### Left Leg (Upper) To Body (Lower)

RDJoint(rd,7)=dJointCreateUniversal(World,0)
dJointAttach(RDJoint(rd,7),LLegU(rd),BodyL(rd))
dJointSetUniversalAxis1(RDJoint(rd,7),1,0,0)
dJointSetUniversalAxis2(RDJoint(rd,7),0,0,1)
dJointSetUniversalAnchor(RDJoint(rd,7),xp+0.7,yp-2.5,zp)
dJointSetUniversalParam(RDJoint(rd,7),dParamLoStop,-1.0)
dJointSetUniversalParam(RDJoint(rd,7),dParamHiStop,1.0)
dJointSetUniversalParam(RDJoint(rd,7),dParamLoStop2,-0.0)
dJointSetUniversalParam(RDJoint(rd,7),dParamHiStop2,1.500)

; ### Left Leg (Lower) To Left Leg (Upper)

RDJoint(rd,8)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,8),LLegL(rd),LLegU(rd))
dJointSetHingeAxis(RDJoint(rd,8),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,8),xp+1,yp-4.25,zp)
dJointSetHingeParam(RDJoint(rd,8),dParamLoStop,-2.0)
dJointSetHingeParam(RDJoint(rd,8),dParamHiStop,0.0)

; ### Right Leg (Upper) To Body (Lower)

RDJoint(rd,9)=dJointCreateUniversal(World,0)
dJointAttach(RDJoint(rd,9),RLegU(rd),BodyL(rd))
dJointSetUniversalAxis1(RDJoint(rd,9),1,0,0)
dJointSetUniversalAxis2(RDJoint(rd,9),0,0,1)
dJointSetUniversalAnchor(RDJoint(rd,9),xp-0.7,yp-2.75,zp)
dJointSetUniversalParam(RDJoint(rd,9),dParamLoStop,-1.0)
dJointSetUniversalParam(RDJoint(rd,9),dParamHiStop,1.0)
dJointSetUniversalParam(RDJoint(rd,9),dParamLoStop2,-0.0)
dJointSetUniversalParam(RDJoint(rd,9),dParamHiStop2,1.500)

; ### Right Leg (Lower) To Right Leg (Upper)

RDJoint(rd,10)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,10),RLegL(rd),RLegU(rd))
dJointSetHingeAxis(RDJoint(rd,10),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,10),xp-1,yp-4.25,zp)
dJointSetHingeParam(RDJoint(rd,10),dParamLoStop,-2.0)
dJointSetHingeParam(RDJoint(rd,10),dParamHiStop,0.0)

; ### Left Foot To Left Leg (Lower)

RDJoint(rd,11)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,11),LFoot(rd),LLegL(rd))
dJointSetHingeAxis(RDJoint(rd,11),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,11),xp+1,yp-5.5,zp)
dJointSetHingeParam(RDJoint(rd,11),dParamLoStop,-0.25)
dJointSetHingeParam(RDJoint(rd,11),dParamHiStop,0.25)

; ### Right Foot To Right Leg (Lower)

RDJoint(rd,12)=dJointCreateHinge(World,0)
dJointAttach(RDJoint(rd,12),RFoot(rd),RLegL(rd))
dJointSetHingeAxis(RDJoint(rd,12),1,0,0)
dJointSetHingeAnchor(RDJoint(rd,12),xp-1,yp-5.5,zp)
dJointSetHingeParam(RDJoint(rd,12),dParamLoStop,-0.25)
dJointSetHingeParam(RDJoint(rd,12),dParamHiStop,0.25)

End Function

; ###################################################################################################

Function UpdateControls()

If KeyDown(59)=1 Then dJointAttach(RDJoint(1,0),0,0)
If KeyDown(60)=1 Then dJointAttach(RDJoint(2,0),0,0)
If KeyDown(61)=1 Then dJointAttach(RDJoint(3,0),0,0)

If KeyDown(62)=1 Then dJointAttach(RDJoint(1,0),0,Head(1))
If KeyDown(63)=1 Then dJointAttach(RDJoint(2,0),0,Head(2))
If KeyDown(64)=1 Then dJointAttach(RDJoint(3,0),0,Head(3))

If KeyDown(57)=1
;	dBodyAddForce Head(1),0,20,0
;	dBodyAddForce Head(2),0,20,0
;	dBodyAddForce Head(3),0,20,0
dJointSetBallAnchor(RDJoint(1,0),40,100,10)
;		dBodySetPosition (Head(1),dBodyGetPositionX(Head(1))+1,dBodyGetPositionY(Head(1))+1, dBodyGetPositionZ(Head(1))+1)

	End If

If KeyDown(200)=1 Then PositionEntity Camera,EntityX(Camera),EntityY(Camera),EntityZ(Camera)+0.3
If KeyDown(208)=1 Then PositionEntity Camera,EntityX(Camera),EntityY(Camera),EntityZ(Camera)-0.3
If KeyDown(203)=1 Then PositionEntity Camera,EntityX(Camera)-0.3,EntityY(Camera),EntityZ(Camera)
If KeyDown(205)=1 Then PositionEntity Camera,EntityX(Camera)+0.3,EntityY(Camera),EntityZ(Camera)

If MouseDown(1)=1
	CameraPick(Camera,MouseX(),MouseY())
	If PickedEntity()
		For ode.ODEGeom=Each ODEGeom
			If ode\mesh=PickedEntity()
				dBodyEnable(ode\body)
				dBodyAddForce ode\body,-20*PickedNX#(),-20*PickedNY#(),-20*PickedNZ#()
				End If
		Next
		End If
	End If

If MouseDown(2)=1
	CameraPick(Camera,MouseX(),MouseY())
	If PickedEntity()
		For ode.ODEGeom=Each ODEGeom
			If ode\mesh=PickedEntity()
				dBodyEnable(ode\body)
				dBodyAddForce ode\body,20*PickedNX#(),20*PickedNY#(),20*PickedNZ#()
				End If
		Next
		End If
	End If

End Function

; ###################################################################################################

Function UpdateGeoms()
	For ode.ODEGeom=Each ODEGeom	
		If ode\body
			If dBodyIsEnabled(ode\body)
				RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
				PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
			End If
		EndIf
	Next
End Function

; ###################################################################################################</textarea><br><br>Here's a modifed Ragdoll demo. At this first test it seems simple joined objects work okay. Not sure why my program seemed otherwise - something to look into (maybe to do with mass?).<br>If you comment out all the object creation and joint creation for all limbs, leaving only head, upper and lower bodies, it bounces as high as the cube. As is, when the doll hits, though the bulk of the body hits and looking at it you'd expect a big bounce, the doll lands dead. Up the torque so it lands on it's head and the bounce is still just as limited. <br><br></td></tr></table><br>
<a name="548407"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Stellar</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#57">[#57]</a></td></tr></table></td></tr><tr ><td class="posttext"> Memory access violation?? hmm <br><br></td></tr></table><br>
<a name="550377"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >luggage</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#58">[#58]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi<br><br>I've just purchased it and must say congrats on a really nice piece of work.  I've got a ball rolling around my trimesh but it doesn't collide with all the objects on that mesh.<br><br>I'm using 3ds Max, created a plane with plenty of polys and then put lots of trees on it.  When I export it using the B3DPipeline it looks correct but the ball only collides with the original plane and not the trees.<br><br>Any ideas?<br><br>Thanks<br><br>scott <br><br></td></tr></table><br>
<a name="550441"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KuRiX</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#59">[#59]</a></td></tr></table></td></tr><tr ><td class="posttext"> How are you loading the trimesh? with loadmesh or loadanimmesh? <br><br></td></tr></table><br>
<a name="550496"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >luggage</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#60">[#60]</a></td></tr></table></td></tr><tr ><td class="posttext"> thanks for the reply.<br><br>I'm using loadmesh.  <br><br>demomesh=LoadMesh("media\test.b3d")<br>trimesh=CreateTriMesh(Space,demomesh)<br>dGeomSetRotation(trimesh,0,0,0)<br>dGeomSetPosition(trimesh,0,0,0)<br><br>I've been playing around a little more and it's gets more odd.  One mesh I use kinda works (see above) but when I try another I just fall straight through.  It's the exact same code just a different mesh.  I've stepped into the createtrimesh function and it's getting the correct number of polys and vertices.<br><br>oooh.  There's a thought.  Is there a limit on vertex\poly count for a trimesh? <br><br></td></tr></table><br>
<a name="550504"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KuRiX</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#61">[#61]</a></td></tr></table></td></tr><tr ><td class="posttext"> For what i have tested i have seen no limit for that. The only limitation i have seen is the size of the triangles. Too small Triangles gives you lot of edge collisions, so bouncy results. Too Big triangles gives you penetration through them.<br><br>The only problem you could have is the normals direction, but this depends on the trimesh you are using. Try applying the normal modifier, and if this doesn't work try exporting to 3ds then importing again and then exporting to b3d.<br><br>Cheers, KuRi.<br><br>P.D: You don't need to rotate and position the trimesh to 0,0,0. <br><br></td></tr></table><br>
<a name="550539"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#62">[#62]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the help there KuRiX, much appreciated :)<br><br>@luggage: If you're still having difficulty with your mesh, feel free to email me your code with the bad mesh and I'll take a look at the problem for you (see my profile for the email address). It could possibly be a normals problem as KuRiX pointed out, have you tried UpdateNormals() on your mesh before converting it to a TriMesh? <br><br></td></tr></table><br>
<a name="551605"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Armitage 1982</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#63">[#63]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello,<br>it is possible to achieve this with JV-ODE : <br><br><a href="http://www.mathematik.uni-bielefeld.de/~pserocka/ODE-Plane2D/Plane2D.README" target="_blank">http://www.mathematik.uni-bielefeld.de/~pserocka/ODE-Plane2D/Plane2D.README</a><br><br>I need a full featured single surface physic engine for a "2D-like" simulation. My simulation must work with Trimesh polygons like Soldat (http://www.soldat.prv.pl/) but in a top down way.<br><br>Thanks ;) <br><br></td></tr></table><br>
<a name="551673"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#64">[#64]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Armitage,<br><br>I would be very reluctant to add this kind of patch I'm afraid. The reason being that I would need to manually 'hack' it into the ODE library, possibly affecting the whole physics simulation. The Plane2D patch may not even be compatible with the current version of ODE either, as it's based on version 0.39 of the ODE source (JV-ODE is based on version 0.5). As the readme you've posted suggests, there are other ways of doing this but I don't know how successful they would be. You would need to experiment with those and see what kind of results you get (please let me know if you do this).<br><br>My highest priority is to keep JV-ODE as close to the 'approved' stable source releases of ODE as possible. Doing otherwise may cause complete havok :) <br><br></td></tr></table><br>
<a name="551935"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ricky Smith</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#65">[#65]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>Doing otherwise may cause complete havok :) <br> <br></div><br>That may not be a bad thing - Havoc is a pretty good physics system ;)<br><br>Just want to say that the JV-ODE is the best Blitz related purchase that I have made. Recommend it to anyone looking for a stable, flexible and easy to use Physics library. <br><br></td></tr></table><br>
<a name="552632"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#66">[#66]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wow thanks Smiff, I really appreciate that :)<br><br>Yeh, havok is an awesome physics system. The license cost isn't so awesome though at $65,000 to $75,000 per title... yikes! <br><br></td></tr></table><br>
<a name="552759"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#67">[#67]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah. I agree with smiff. This library has bought life to a dying project (even through a rewrite)-<br><br><br>Hell, I liked it so much, I bought it twice! (Once without even knowing!!!!! ;) ) <br><br></td></tr></table><br>
<a name="553064"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Aymes</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#68">[#68]</a></td></tr></table></td></tr><tr ><td class="posttext"> This lib is great, making very easy work of part of my latest project i was dreading!<br><br>Cygnus: yeah yeah, make fun of me, thinking i dont read these boards :P I didnt read the receipt address! :P <br><br></td></tr></table><br>
<a name="553067"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#69">[#69]</a></td></tr></table></td></tr><tr ><td class="posttext"> Lol, actually, i never meant it to make fun out of you ^.^<br><br>I can't wait to see how it works in your latest project- You know how cool i think it is. ^.^ <br><br></td></tr></table><br>
<a name="553164"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#70">[#70]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm having a little trouble saving the current state of my skeleton. My ragdoll's joint positions are successfully saved to an array, so I can save the current state of my ragdoll and revert to it, with one exception. The angle of the joints isn't saved, so all the limbs (boxes) are NOT rotated to fit the alignment of the different joints.<br><br>The docs mention dGetJointHingeAngle() which returns the current value correctly, but there's some problems.<br><br>1) How can I set the rotation of the joint on creation?<br>2) There is no dGetJointHinge2Angle2() function. How can I record both angles for a Hinge2 joint? <br><br></td></tr></table><br>
<a name="553177"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#71">[#71]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm, I'm not sure that's the correct way to do it tbh.<br><br>When you recreate your skeleton, you need to restore the position and rotation of all the bodies that make up the skeleton using your saved information. Then you use the joint attach functions to connect them all together using the saved joint position information. When the joints are attached the angles should automatically be calculated from the position of the joint to the position/rotation of the bodies.<br><br>I think Smiff has done some work in this area, maybe he knows the correct procedure for this? <br><br></td></tr></table><br>
<a name="553191"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#72">[#72]</a></td></tr></table></td></tr><tr ><td class="posttext"> Maybe yes, I need to restore the rotation of the limb components and the joints are working okay. Only I'm worried about the manual's statement that the angle is set to 0 based on the current position of objects.<br><br>Let's say a worm is made of 5 spheres, each with a hinge2 joint. On creation the worm is vertical in the air, with all joints at 0 degrees. The worm is dropped onto a table where it half hangs over the edge. Joint two is now 90 degrees...<br><br>Start position<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">


        O
        |   - Joint 4
        O
        |   - Joint 3
        O
        |   - Joint 2
        O
        |   - Joint 1
        O

        +---------
        |#TABLE###
        |#########</textarea><br>End position<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">










       +O-O-O
       O+---------
       ||#TABLE###
       O|#########</textarea><br>Saving the data to an array, we can recreate the positon of the worm by positioning the spheres on and by the table, and create joints at the appropriate places between them. BUT when we create joint 2, it's actually at 90 degrees, but the manual suggests this position will be set as 0 degrees.<br><br>Hmmm. Think I'll try a test case with the Rope demo and see what happens... <br><br></td></tr></table><br>
<a name="553215"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#73">[#73]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ah yes, I see what you mean. Joint 2 would set the 90 degree position as zero degrees in your example.<br><br>Ok what about this (using your example above), create the worm in it's starting position (but NOT in the saved location - maybe high up in the air?). Then once the joints have been attached, set the position/rotation of the bodies to the saved location (the end position). <br><br></td></tr></table><br>
<a name="553224"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ricky Smith</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#74">[#74]</a></td></tr></table></td></tr><tr ><td class="posttext"> What VIP3R says is correct - What I do is to have a reference position that is always used to create the joints - once the joints are attached in the reference position ensuring that joint limit angles are correct,you can then rotate/postion the bodies to the desired position with dbodySetRotation/dbodySetPosition.<br> As long as the 'desired' position is not beyond the joint limits it should work fine. If the desired position is beyond a joints limit then the joint will snap to whatever its limit value is.<br><br>The process I use is:<br><br>Create rag-doll using the reference values ( this is usually frame 0 in an animated model.<br><br>Attach joints (except those attached to world)- this makes sure my limits are correct.<br><br>Position and Rotate all geoms/bodies to current position.<br><br>Attach joints fixed to world (if any). <br><br></td></tr></table><br>
<a name="553249"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#75">[#75]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ugh! Thanks for the suggestion. Not an easy solution for my setup. Have to rethink how I store and build the scenes. Still, at least I have a solution ;) <br><br></td></tr></table><br>
<a name="553950"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#76">[#76]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi guys, I need a hand with this one. I'm working with the Trimesh car demo and want to use more than one Trimesh.<br><br>Should I be creating the SPACE, and then creating a new space for each object including trimeshes within that space? <br><br>The demo works fine if I use just one trimesh, but really slows down with more than one. Just wondering how this should be done. Maybe I'm doing something wrong, or need to tell ode not to compare the trimeshes.<br><br>code attached<br><br>All help appreciated, thanks.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #									  JV-ODE TriMesh Car Demo										#
; #									Code by Jim Williams (VIP3R)									#		#
; #						Feel free to use this code, any credit appreciated							#
; ###################################################################################################

AppTitle "ODE MARS Terrain Demo"

Include "JV-ODE.bb"

Graphics3D 800,600,0,2

Global CMass#=200			; ### Car Mass
Global WMass#=8				; ### Wheel Mass

Global WorldERP#=1			; ### World Error Correction
Global WorldFriction#=64	; ### World Friction
Global HingeTorque#=24		; ### Hinge Torque
Global SuspensionHS#=0.01	; ### Hinge Suspension Hardness/Softness (Higher=Softer - Lower=Harder)

Global Speed#=0
Global Steer#=0

Global Car
Global CGeom
Global CMesh

Global CarStartY=40

Dim Wheel(4)
Dim WGeom(4)
Dim Joint(4)

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

; ###################################################################################################

; ### Setup ODE

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,-0.98,0)
dWorldSetERP(World,WorldERP)

dContactSetMode(dContactSlip1)
dContactSetMu(WorldFriction)

; ### Create car body

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
Car=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,0,CarStartY,0)
mass=dMassCreate()
dMassSetBox(mass,1,3,1,4)
dMassSetBoxTotal(mass,CMass,3,1,4)
dMassTranslate(mass,0,-1,0)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
ode\geom=dCreateBox(Space,3,1,4)
CGeom=ode\geom
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
CMesh=ode\mesh
ScaleMesh ode\mesh,1.5,0.5,2
RotateMesh ode\mesh,0,0,0
PositionMesh ode\mesh,0,0,0
EntityColor ode\mesh,40,80,255
EntityAlpha ode\mesh,1

; ### Create wheels

For count=1 To 4
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	Wheel(count)=ode\body
	dBodySetRotation(ode\body,0,0,0)
	dBodySetPosition(ode\body,0,0,0)
	mass=dMassCreate()
	dMassSetSphere(mass,1,0.7)
	dMassSetSphereTotal(mass,WMass,0.7)
	dBodySetMass(ode\body,mass)
	dMassDestroy(mass)
	ode\geom=dCreateSphere(Space,0.7)
	WGeom(count)=ode\geom
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder(8)
	ScaleMesh ode\mesh,0.7,0.25,0.7
	RotateMesh ode\mesh,0,0,90
	PositionMesh ode\mesh,0,0,0
	EntityColor ode\mesh,255,255,255
Next

dBodySetPosition(Wheel(1),-2,CarStartY-0.5,+2)
dBodySetPosition(Wheel(2),+2,CarStartY-0.5,+2)
dBodySetPosition(Wheel(3),-2,CarStartY-0.5,-2)
dBodySetPosition(Wheel(4),+2,CarStartY-0.5,-2)

; ### Create some objects

SeedRnd MilliSecs()

For spheres=1 To 20
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	dBodySetRotation(ode\body,0,0,0)
	dBodySetPosition(ode\body,Rnd(-100,100),44,Rnd(-100,100))
	ode\geom=dCreateSphere(Space,4)
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateSphere()
	ScaleMesh ode\mesh,4,4,4
	RotateMesh ode\mesh,0,0,0
	PositionMesh ode\mesh,0,0,0
	EntityColor ode\mesh,Rnd(255),Rnd(255),Rnd(255)
	EntityAlpha ode\mesh,1
	EntityShininess ode\mesh,0.7
Next

; ### Create light

Global Light=CreateLight()

RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera

Global CameraPivot=CreatePivot(CMesh)
PositionEntity CameraPivot,0,2,-7

Global Camera=CreateCamera()
CameraClsColor Camera,0,0,0
CameraRange Camera,.1,180


;--------------------------------------------------------------
;load terrain 
;--------------------------------------------------------------
Dim map(8,8)
Dim Tm(8,8)
Dim spc(8,8)

dir$=".\"

For b=1 To 8
	For a=1 To 8
		map(a,b)= LoadMesh(dir+"mars("+a+","+b+").b3d")
		correctoffset(map(a,b))
		UpdateNormals map(a,b)
		PositionEntity map(a,b),(a-1)*200,0,(b-1)*200
		EntityType map(a,b),2
		;spc(a,b)=dHashSpaceCreate(space)
		tm(a,b)=CreateTriMesh(space,map(a,b))
	Next
Next


; ###################################################################################################

; ### CREATE TRIMESH

;demomesh=map(1,1)
;ScaleMesh demomesh,1,0.7,1

;trimesh=CreateTriMesh(Space,demomesh)
;dGeomSetRotation(trimesh,0,0,0)
;dGeomSetPosition(trimesh,0,0,0)

;RotateEntity demomesh,0,0,0
;PositionEntity demomesh,0,0,0

;EntityColor demomesh,255,255,255
;EntityAlpha demomesh,1

;demotexture=LoadTexture("media\terrain.png")
;ScaleTexture demotexture,0.08,0.08
;EntityTexture demomesh,demotexture

; ###################################################################################################

SetupCar()

While Not KeyHit(1)

	UpdateKeys()

	PTime=MilliSecs()

	UpdateCar()

	UpdateGeoms()

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)

	PhysicsTime#=MilliSecs()-PTime

	UpdateCam()

	UpdateWorld

	RenderWorld

	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime
	Text 0,30,"Car Speed:"+Speed
	Text 640,0,"A - Accelerate"
	Text 640,15,"Z - Brake/Reverse"
	Text 640,30,"Arrows - Steering"
	Text 640,45,"Space - Reset Car"

	Flip

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function SetupCar()

For count=1 To 4
	Joint(count)=dJointCreateHinge2(World,0)
	dJointAttach(Joint(count),Car,Wheel(count))
	dJointSetHinge2Anchor(Joint(count),dBodyGetPositionX(Wheel(count)),dBodyGetPositionY(Wheel(count)),dBodyGetPositionZ(Wheel(count)))
	dJointSetHinge2Axis1(Joint(count),0,1,0)
	dJointSetHinge2Axis2(Joint(count),-1,0,0)
	dJointSetHinge2Param(Joint(count),dParamSuspensionERP,0.8)
	dJointSetHinge2Param(Joint(count),dParamSuspensionCFM,SuspensionHS)
	If count&gt;2
		dJointSetHinge2Param(Joint(count),dParamLoStop,0)
		dJointSetHinge2Param(Joint(count),dParamHiStop,0)
		End If
Next

Speed=0

End Function

; ###################################################################################################

Function UpdateKeys()

If KeyDown(30)=1
	Speed=Speed+0.08
	If Speed&gt;30 Then Speed=30
	End If

If KeyDown(44)=1
	Speed=Speed-0.1
	If Speed&lt;-10 Then Speed=-10
	If Speed&gt;0 Then Speed=Speed*0.97
	End If

If KeyDown(30)=0 And KeyDown(44)=0 Then Speed=Speed*0.99

If KeyDown(203)=1 Or KeyDown(205)=1
	If KeyDown(203)=1
		Steer=0.5
		Else
		Steer=-0.5
		End If
	Else
	Steer=0
	End If

If KeyHit(57)=1
	Speed=0
	dBodySetRotation(Car,0,0,0)
	End If

End Function

; ###################################################################################################

Function UpdateCar()

For count=1 To 4
	dBodyEnable(Wheel(count))
Next

dBodyEnable(Car)

For count=1 To 4
	dJointSetHinge2Param(Joint(count),dParamVel2,Speed)
	dJointSetHinge2Param(Joint(count),dParamFMax2,HingeTorque)
Next

For count=1 To 2
	angle#=Steer-dJointGetHinge2Angle1(Joint(count))
	dJointSetHinge2Param(Joint(count),dParamVel,angle)
	dJointSetHinge2Param(Joint(count),dParamFMax,400)
Next

End Function

; ###################################################################################################

Function UpdateCam()

PositionEntity CameraPivot,0,3,-12

camx#=EntityX(CameraPivot,1)-EntityX(Camera)
camy#=EntityY(CameraPivot,1)-EntityY(Camera)
camz#=EntityZ(CameraPivot,1)-EntityZ(Camera)

TranslateEntity Camera,camx*0.5,camy*0.5,camz*0.5

PointEntity Camera,CMesh

End Function

; ###################################################################################################

Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
	RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
	PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
Next

End Function

; ###################################################################################################
Function CorrectOffset(mesh,offx#=0,offy#=0,offz#=0)
Local x#,y#,z#, surf,s,v, minx#=100000,miny#=100000,minz#=100000
Local mw#=MeshWidth(mesh), mh#=MeshHeight(mesh), md#=MeshDepth(mesh)
For s=1 To CountSurfaces(mesh)
	surf=GetSurface(mesh,s)
	For v=0 To CountVertices(surf)-1
		x=VertexX(surf,v)
		y=VertexY(surf,v)
		z=VertexZ(surf,v)
		If x&lt;minx Then minx=x
		If y&lt;miny Then miny=y
		If z&lt;minz Then minz=z
	Next
Next
TFormPoint minx+mw*0.5-offx,miny+mh*0.5-offy,minz+md*0.5-offz,mesh,GetParent(mesh)

TranslateEntity mesh,TFormedX(),TFormedY(),TFormedZ()
FitMesh mesh,-mw*0.5+offx,-mh*0.5+offy,-md*0.5+offz,mw,mh,md
End Function

</textarea> <br><br></td></tr></table><br>
<a name="553978"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#77">[#77]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Wayne,<br><br>Do your TriMeshes overlap each other or are they completely separate? (I can't tell without the media)<br><br>It does sound like they overlap, as this would cause severe slowdown. The reason is because lots of contacts are generated between each TriMesh and it takes a long time for ODE to process them each step.<br><br>Create a top level space (Space), then place ALL of the TriMeshes into their own sub-space (TriSpace). Then make sure to disable the internal collide mode with...<br><b>dSetInternalSpaceCollideMode(0)</b><br><br>When you've done this, all objects in any other space will collide with the TriMeshes, but the TriMeshes will not collide with each other (meaning no contacts are generated each step) which should cure any slowdown.<br><br>I've had four TriMeshes in the TriMesh Car Demo running simultaneously without any speed hit whatsoever using this method.<br><br>Also, for best results put the Plane (when used) into the same space as the TriMeshes, as that can also generate lots of contacts. In the TriMesh Car Demos, there is a very small gap between the TriMesh and the plane (your TriMeshes may be in contact with it). <br><br></td></tr></table><br>
<a name="554015"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#78">[#78]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Vip3r, thanks for the reply. I removed the plane so thats out of the equation. I'll go test that. <br><br></td></tr></table><br>
<a name="554067"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#79">[#79]</a></td></tr></table></td></tr><tr ><td class="posttext"> Looks like it's working sweet, I'll post some stuff after I check it out some more to be sure. It's wicked fast! <br><br></td></tr></table><br>
<a name="554131"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#80">[#80]</a></td></tr></table></td></tr><tr ><td class="posttext"> Can you offer a brief example of how to create a top level space and subspaces? I've got inanimate scenery objects, TriMeshes and primitives, that needn't waste time colliding with themselves, so chucking these into their own space would save processor cycles.<br><br>I thought the latest build had a multiple space demo, but I can't find it in my JV-ODE folder. <br><br></td></tr></table><br>
<a name="554143"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#81">[#81]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Wayne: Nice one ;)<br><br>Here you go Shifty Geezer, the CarDemo-MultipleSpace.bb example is still included in the library...<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #										  JV-ODE Car Demo											#
; #									Code by Jim Williams (VIP3R)									#		#
; #						Feel free to use this code, any credit appreciated							#
; ###################################################################################################

AppTitle "JV-ODE Car Demo"

Include "JV-ODE.bb"

Graphics3D 800,600,0,2

Global CMass#=200			; ### Car Mass
Global WMass#=8				; ### Wheel Mass

Global WorldERP#=1			; ### World Error Correction
Global WorldFriction#=64	; ### World Friction
Global HingeTorque#=24		; ### Hinge Torque
Global SuspensionHS#=0.01	; ### Hinge Suspension Hardness/Softness (Higher=Softer - Lower=Harder)

Global Speed#=0
Global Steer#=0

Global Car
Global CGeom
Global CMesh

Global CarStartY=20

Dim Wheel(4)
Dim WGeom(4)
Dim Joint(4)

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

; ###################################################################################################

; ### Setup ODE

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global CarSpace=dHashSpaceCreate(Space)
Global RampSpace=dHashSpaceCreate(Space)
Global SceneSpace=dHashSpaceCreate(Space)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,-0.98,0)
dWorldSetERP(World,WorldERP)

dContactSetMode(dContactSlip1)
dContactSetMu(WorldFriction)

; ### Create car body

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
Car=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,0,CarStartY,0)
mass=dMassCreate()
dMassSetBox(mass,1,3,1,4)
dMassSetBoxTotal(mass,CMass,3,1,4)
dMassTranslate(mass,0,-1,0)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
ode\geom=dCreateBox(CarSpace,3,1,4)
CGeom=ode\geom
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
CMesh=ode\mesh
ScaleMesh ode\mesh,1.5,0.5,2
RotateMesh ode\mesh,0,0,0
PositionMesh ode\mesh,0,0,0
EntityColor ode\mesh,40,80,255
EntityAlpha ode\mesh,1

; ### Create wheels

For count=1 To 4
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	Wheel(count)=ode\body
	dBodySetRotation(ode\body,0,0,0)
	dBodySetPosition(ode\body,0,0,0)
	mass=dMassCreate()
	dMassSetSphere(mass,1,0.7)
	dMassSetSphereTotal(mass,WMass,0.7)
	dBodySetMass(ode\body,mass)
	dMassDestroy(mass)
	ode\geom=dCreateSphere(CarSpace,0.7)
	WGeom(count)=ode\geom
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder(8)
	ScaleMesh ode\mesh,0.7,0.25,0.7
	RotateMesh ode\mesh,0,0,90
	PositionMesh ode\mesh,0,0,0
	EntityColor ode\mesh,255,255,255
Next

dBodySetPosition(Wheel(1),-2,CarStartY-0.5,+2)
dBodySetPosition(Wheel(2),+2,CarStartY-0.5,+2)
dBodySetPosition(Wheel(3),-2,CarStartY-0.5,-2)
dBodySetPosition(Wheel(4),+2,CarStartY-0.5,-2)

; ### Create some objects

SeedRnd MilliSecs()

For spheres=1 To 20
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	dBodySetRotation(ode\body,0,0,0)
	dBodySetPosition(ode\body,Rnd(-100,100),30,Rnd(-100,100))
	ode\geom=dCreateSphere(Space,4)
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateSphere()
	ScaleMesh ode\mesh,4,4,4
	RotateMesh ode\mesh,0,0,0
	PositionMesh ode\mesh,0,0,0
	EntityColor ode\mesh,Rnd(255),Rnd(255),Rnd(255)
	EntityAlpha ode\mesh,1
	EntityShininess ode\mesh,0.7
Next

For cylinders=1 To 20
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	dBodySetRotation(ode\body,90,0,0)
	dBodySetPosition(ode\body,Rnd(-100,100),30,Rnd(-100,100))
	ode\geom=dCreateCCylinder(Space,1,8)
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder(8)
	ScaleMesh ode\mesh,1,5,1
	RotateMesh ode\mesh,90,0,0	; &lt;&lt;&lt; Mesh X-Axis must be rotated 90 degrees to fix cylinder alignment
	PositionMesh ode\mesh,0,0,0
	EntityColor ode\mesh,Rnd(255),Rnd(255),Rnd(255)
	EntityAlpha ode\mesh,1
	EntityShininess ode\mesh,0.7
Next

; ### Create light

Global Light=CreateLight()

RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera

Global CameraPivot=CreatePivot(CMesh)
PositionEntity CameraPivot,0,2,-7

Global Camera=CreateCamera()
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000

; ### Create plane

dCreatePlane(SceneSpace,0,1,0,0)

Plane=CreatePlane()

EntityAlpha Plane,0.8

PlaneTexture=CreateTexture(128,128,9)

ClsColor 0,200,80
Cls

Color 255,255,255

Rect 0,0,64,64,1
Rect 64,64,64,64,1

CopyRect 0,0,128,128,0,0,BackBuffer(),TextureBuffer(PlaneTexture)
ScaleTexture PlaneTexture,20,20
EntityTexture Plane,PlaneTexture,0,0

Mirror=CreateMirror()

; ###################################################################################################

; ### BLITZ STATIC OBJECT (White)

blitzobject=CreateCube()
ScaleMesh blitzobject,1,4,20
RotateMesh blitzobject,-10,8,4
PositionMesh blitzobject,10,5,40

EntityColor blitzobject,255,255,255
EntityAlpha blitzobject,1

; ### ODE STATIC OBJECT (Blue)

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(SceneSpace,2,8,40)
dGeomSetRotation(ode\geom,-10,8,4)
dGeomSetPosition(ode\geom,20,5,40)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,1,4,20
RotateMesh ode\mesh,0,0,0
PositionMesh ode\mesh,0,0,0

EntityColor ode\mesh,0,100,200
EntityAlpha ode\mesh,1

; ### ODE STATIC OBJECT (Red)

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(CarSpace,18,0.2,40)
dGeomSetRotation(ode\geom,-14,0,0)
dGeomSetPosition(ode\geom,-20,4.9,40)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,9,0.1,20
RotateMesh ode\mesh,0,0,0
PositionMesh ode\mesh,0,0,0

EntityColor ode\mesh,200,0,100
EntityAlpha ode\mesh,1

; ### ODE STATIC OBJECT (Green)

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(RampSpace,18,0.2,40)
dGeomSetRotation(ode\geom,-14,0,0)
dGeomSetPosition(ode\geom,-45,4.9,40)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,9,0.1,20
RotateMesh ode\mesh,0,0,0
PositionMesh ode\mesh,0,0,0

EntityColor ode\mesh,0,200,100
EntityAlpha ode\mesh,1

; ###################################################################################################

SetupCar()

While Not KeyHit(1)

	UpdateKeys()

	PTime=MilliSecs()

	UpdateCar()

	UpdateGeoms()

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)

	PhysicsTime#=MilliSecs()-PTime

	UpdateCam()

	UpdateWorld

	RenderWorld

	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime
	Text 0,30,"Car Speed:"+Speed
	Text 0,435,"Object:        In Space (Geoms):"
	Text 0,455,"Car            CarSpace ("+dSpaceGetNumGeoms(CarSpace)+")"
	Text 0,470,"Red Ramp       CarSpace ("+dSpaceGetNumGeoms(CarSpace)+")"
	Text 0,485,"Green Ramp     RampSpace ("+dSpaceGetNumGeoms(RampSpace)+")"
	Text 0,500,"Blue Block     SceneSpace ("+dSpaceGetNumGeoms(SceneSpace)+")"
	Text 0,515,"Ground Plane   SceneSpace ("+dSpaceGetNumGeoms(SceneSpace)+")"
	Text 0,530,"20 Spheres     Space (Top Level - "+dSpaceGetNumGeoms(Space)+")"
	Text 0,545,"20 CCylinders  Space (Top Level - "+dSpaceGetNumGeoms(Space)+")"

	Text 225,0,"F1 - Toggle Internal Space Collide Mode ("+dGetInternalSpaceCollideMode()+")"
	If dGetInternalSpaceCollideMode()=1
		Text 255,20,"ENABLED - Red Ramp &amp; Car DO Collide"
		Else
		Text 235,20,"DISABLED - Red Ramp &amp; Car DO NOT Collide"
		End If

	Text 640,0,"A - Accelerate"
	Text 640,15,"Z - Brake/Reverse"
	Text 640,30,"Arrows - Steering"
	Text 640,45,"Space - Reset Car"

	Flip

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function SetupCar()

For count=1 To 4
	Joint(count)=dJointCreateHinge2(World,0)
	dJointAttach(Joint(count),Car,Wheel(count))
	dJointSetHinge2Anchor(Joint(count),dBodyGetPositionX(Wheel(count)),dBodyGetPositionY(Wheel(count)),dBodyGetPositionZ(Wheel(count)))
	dJointSetHinge2Axis1(Joint(count),0,1,0)
	dJointSetHinge2Axis2(Joint(count),-1,0,0)
	dJointSetHinge2Param(Joint(count),dParamSuspensionERP,0.8)
	dJointSetHinge2Param(Joint(count),dParamSuspensionCFM,SuspensionHS)
	If count&gt;2
		dJointSetHinge2Param(Joint(count),dParamLoStop,0)
		dJointSetHinge2Param(Joint(count),dParamHiStop,0)
		End If
Next

Speed=0

End Function

; ###################################################################################################

Function UpdateKeys()

If KeyDown(30)=1
	Speed=Speed+0.08
	If Speed&gt;30 Then Speed=30
	End If

If KeyDown(44)=1
	Speed=Speed-0.1
	If Speed&lt;-10 Then Speed=-10
	If Speed&gt;0 Then Speed=Speed*0.97
	End If

If KeyDown(30)=0 And KeyDown(44)=0 Then Speed=Speed*0.99

If KeyDown(203)=1 Or KeyDown(205)=1
	If KeyDown(203)=1
		Steer=0.5
		Else
		Steer=-0.5
		End If
	Else
	Steer=0
	End If

If KeyHit(57)=1
	Speed=0
	dBodySetRotation(Car,0,0,0)
	End If

If KeyHit(59)=1 Then dSetInternalSpaceCollideMode(Not dGetInternalSpaceCollideMode())

End Function

; ###################################################################################################

Function UpdateCar()

For count=1 To 4
	dBodyEnable(Wheel(count))
Next

dBodyEnable(Car)

For count=1 To 4
	dJointSetHinge2Param(Joint(count),dParamVel2,Speed)
	dJointSetHinge2Param(Joint(count),dParamFMax2,HingeTorque)
Next

For count=1 To 2
	angle#=Steer-dJointGetHinge2Angle1(Joint(count))
	dJointSetHinge2Param(Joint(count),dParamVel,angle)
	dJointSetHinge2Param(Joint(count),dParamFMax,400)
Next

End Function

; ###################################################################################################

Function UpdateCam()

PositionEntity CameraPivot,0,3,-12

camx#=EntityX(CameraPivot,1)-EntityX(Camera)
camy#=EntityY(CameraPivot,1)-EntityY(Camera)
camz#=EntityZ(CameraPivot,1)-EntityZ(Camera)

TranslateEntity Camera,camx*0.5,camy*0.5,camz*0.5

PointEntity Camera,CMesh

End Function

; ###################################################################################################

Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
	RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
	PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
Next

End Function

; ###################################################################################################
</textarea> <br><br></td></tr></table><br>
<a name="554156"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#82">[#82]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay, I did have it afterall :p<br><br>So dSetInternalSpaceCollideMode() enables/disables all collisions for objects inside that space? And spaces are hierarchical?<br><br>So I could create WorldSpace, PropSpace(worldspace) and ActorsSpace(worldspace). PropSpace and ActorsSpace would be subspaces of WorldSpace. Everything in worldspace, including everything in PropSpace and ActorsSpace, can collide. Let's say I create a dozen boxes in PropSpace and a dozen spheres in ActorsSpace, these could all bash into each other.<br><br>Now to disable the boxes from colliding with each other, but still collide with spheres and allow spheres to collide with spheres, I can use dSetInternalSpaceCollideMode(). But how do I specify which spaces this should apply to? Or does it apply to ALL subspaces of the top-level space, so it would disable all cube&lt;&gt;cube and sphere&lt;&gt;sphere collisions?<br><br>While we're at it, looking for clues in the .decls file, what do...<br><br> dSetInternalContactSurfaceMode(mode):"odeSetInternalContactSurfaceMode@4" and<br> dGetInternalContactSurfaceMode%():"odeGetInternalContactSurfaceMode@0"<br><br>do? Also, does dSpaceAdd(space,geom) duplicate a geom's data into space, or just include in that space along with the geom's creation space, like box=dCreateBox(Space) creates the box geom in Space, would dSpaceAdd(PropSpace,box) just add collision calculations inside PropSpace? Or does that move box into PropSpace so it's collisions internal to PropSpace can be disabled?<br><br>ODE Spaces - the final frontier :D <br><br></td></tr></table><br>
<a name="554189"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#83">[#83]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> So dSetInternalSpaceCollideMode() enables/disables all collisions for objects inside that space? And spaces are hierarchical? <br></div><br>Yep, internal collide mode only applies to the sub-spaces though (not the top level space).<br><br><div class="quote"> So I could create WorldSpace, PropSpace(worldspace) and ActorsSpace(worldspace). PropSpace and ActorsSpace would be subspaces of WorldSpace. Everything in worldspace, including everything in PropSpace and ActorsSpace, can collide. Let's say I create a dozen boxes in PropSpace and a dozen spheres in ActorsSpace, these could all bash into each other. <br></div><br>Yep, the objects within the same sub-spaces will collide with each other unless you disable internal collide mode.<br><br><div class="quote"> Now to disable the boxes from colliding with each other, but still collide with spheres and allow spheres to collide with spheres, I can use dSetInternalSpaceCollideMode(). But how do I specify which spaces this should apply to? Or does it apply to ALL subspaces of the top-level space, so it would disable all cube&lt;&gt;cube and sphere&lt;&gt;sphere collisions? <br></div><br>Disabling the internal collide mode will prevent all collisions of objects within the same sub-space. All objects in the top level space will still collide with all sub-space objects. You would specify which objects collide with other objects by the way you design the sub-spaces. The simplest way to think about it is to put all objects that don't need collision detection between each other into the same sub-space. So, you could have all scene objects (terrain, plane, static scenery objects) into a sub-space of space (PropSpace). With collide mode disabled, if you want your actor objects to collide with each other, then you would put them into the top level space (Space). If not then you could create another sub-space for actor objects (ActorSpace). All objects created in the top level space (Space) will collide with the PropSpace objects and the ActorSpace objects.<br><br><div class="quote"> While we're at it, looking for clues in the .decls file, what do...<br><br>dSetInternalContactSurfaceMode(mode):"odeSetInternalContactSurfaceMode@4" and<br>dGetInternalContactSurfaceMode%():"odeGetInternalContactSurfaceMode@0" <br></div><br>Those are the functions you requested, their functionality is described up there ^^ (See the JV-ODE Version 1.05 Released post)<br><br><div class="quote"> Also, does dSpaceAdd(space,geom) duplicate a geom's data into space, or just include in that space along with the geom's creation space, like box=dCreateBox(Space) creates the box geom in Space, would dSpaceAdd(PropSpace,box) just add collision calculations inside PropSpace? Or does that move box into PropSpace so it's collisions internal to PropSpace can be disabled? <br></div><br>I think it just adds a copy of the geom to the space (duplication), so you would need to use dSpaceRemove(space,geom) to delete the original if required. <br><br></td></tr></table><br>
<a name="554191"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#84">[#84]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> While we're at it, looking for clues in the .decls file, what do...<br><br>dSetInternalContactSurfaceMode(mode):"odeSetInternalContactSurfaceMode@4" and<br>dGetInternalContactSurfaceMode%():"odeGetInternalContactSurfaceMode@0" <br><br><br>Those are the functions you requested, their functionality is described up there ^^ (See the JV-ODE Version 1.05 Released post)<br> <br></div><br>Ha ha! Yeah, I've used them already. For some reason I thought they were part of the Space controls, being 'Internal' in name.<br><br>Thanks for the clarification. I see the top level is for the bulk of objects, with sub-levels for collision optimizations, basically grouping non-colliding objects. Quite an important take-home point for keeping things as fast as possible. <br><br></td></tr></table><br>
<a name="554200"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#85">[#85]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just made the update to my engine. Very simple to implement and very effective. Note to all ODE users - create static scenery objects inside a sub-space and disable internal collisions!! <br><br></td></tr></table><br>
<a name="554225"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#86">[#86]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here is the code shell I used to create ODEMARS.<br>It was easy, I created a huge multimesh terrain (64 trimeshes) using T.ED <a href="http://www.d-grafix.com/softwareted.html" target="_blank">http://www.d-grafix.com/softwareted.html</a><br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #								    JV-ODE Mars Terrain Demo										#
; #									Code by Wayne Gray , Jim Williams (VIP3R)									#		#
; #						 			This code is free, use as you wish.
; ###################################################################################################

AppTitle "ODE MARS Terrain Demo"

Include "JV-ODE.bb"

Graphics3D 800,600,0,2
;Graphics3D 1024,768,32,1
Global CMass#=200			; ### Car Mass
Global WMass#=8				; ### Wheel Mass

Global WorldERP#=1			; ### World Error Correction
Global WorldFriction#=64	; ### World Friction
Global HingeTorque#=24		; ### Hinge Torque
Global SuspensionHS#=0.01	; ### Hinge Suspension Hardness/Softness (Higher=Softer - Lower=Harder)

Global Speed#=0
Global Steer#=0

Global Car
Global CGeom
Global CMesh

Global CarStartY=40

Dim Wheel(4)
Dim WGeom(4)
Dim Joint(4)

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

; ###################################################################################################

; ### Setup ODE

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global TriSpace=dHashSpaceCreate(space)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,1)

dWorldSetERP(World,WorldERP)

dContactSetMode(dContactSlip1)
dContactSetMu(WorldFriction)

; Set Initial World
Global Planet$="Earth"
Global gx=1
dWorldSetGravity(World,0,-0.98,0)


; ### Create car body

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
Car=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,0,CarStartY,0)
mass=dMassCreate()
dMassSetBox(mass,1,3,1,4)
dMassSetBoxTotal(mass,CMass,3,1,4)
dMassTranslate(mass,0,-1,0)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
ode\geom=dCreateBox(Space,3,1,4)
CGeom=ode\geom
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
CMesh=ode\mesh
ScaleMesh ode\mesh,1.5,0.5,2
RotateMesh ode\mesh,0,0,0
PositionMesh ode\mesh,0,0,0
EntityColor ode\mesh,40,80,255
EntityAlpha ode\mesh,1

; ### Create wheels

For count=1 To 4
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	Wheel(count)=ode\body
	dBodySetRotation(ode\body,0,0,0)
	dBodySetPosition(ode\body,0,0,0)
	mass=dMassCreate()
	dMassSetSphere(mass,1,0.7)
	dMassSetSphereTotal(mass,WMass,0.7)
	dBodySetMass(ode\body,mass)
	dMassDestroy(mass)
	ode\geom=dCreateSphere(Space,0.7)
	WGeom(count)=ode\geom
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder(8)
	ScaleMesh ode\mesh,0.7,0.25,0.7
	RotateMesh ode\mesh,0,0,90
	PositionMesh ode\mesh,0,0,0
	EntityColor ode\mesh,255,255,255
Next

dBodySetPosition(Wheel(1),-2,CarStartY-0.5,+2)
dBodySetPosition(Wheel(2),+2,CarStartY-0.5,+2)
dBodySetPosition(Wheel(3),-2,CarStartY-0.5,-2)
dBodySetPosition(Wheel(4),+2,CarStartY-0.5,-2)

; ### Create some objects

SeedRnd MilliSecs()

For spheres=1 To 20
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	dBodySetRotation(ode\body,0,0,0)
	dBodySetPosition(ode\body,Rnd(-100,100),44,Rnd(-100,100))
	ode\geom=dCreateSphere(Space,4)
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateSphere()
	ScaleMesh ode\mesh,4,4,4
	RotateMesh ode\mesh,0,0,0
	PositionMesh ode\mesh,0,0,0
	EntityColor ode\mesh,Rnd(255),Rnd(255),Rnd(255)
	EntityAlpha ode\mesh,1
	EntityShininess ode\mesh,0.7
Next

; ### Create light

Global Light=CreateLight()

RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera

Global CameraPivot=CreatePivot(CMesh)
PositionEntity CameraPivot,0,2,-7

Global Camera=CreateCamera()
CameraClsColor Camera,0,0,0
CameraRange Camera,1,200

Text 0,0,"Loading.. please wait"
Flip

;--------------------------------------------------------------
;load terrain 
;--------------------------------------------------------------
Dim map(8,8)
Dim Tm(8,8)
Dim lm(8,8)

dir$=".\"

For b=1 To 8
	For a=1 To 8
		map(a,b)= LoadMesh(dir+"mars("+a+","+b+").b3d")
		UpdateNormals map(a,b)
		PositionEntity map(a,b),(a-1)*200,0,(b-1)*200
		; Load ODE Trimeshes into trispace
		tm(a,b)=CreateTriMesh(trispace,map(a,b))
		dGeomSetPosition(tm(a,b),(a-1)*200,0,(b-1)*200)
		dGeomSetRotation(tm(a,b),0,0,0)
	Next
Next
; Tell the trispaces not to collide with each other.
dSetInternalSpaceCollideMode(0)

;--------------------------------------------------------------
;load &amp;apply lm to tex layer 1 
;--------------------------------------------------------------
For b=1 To 8
	For a=1 To 8 
		lm(a,b) = LoadTexture(dir+"mars("+a+","+b+")_lm.bmp")
		EntityTexture map(a,b),lm(a,b),0,1
		EntityFX map(a,b),1
	Next
Next	
	
; ###################################################################################################

SetupCar()

While Not KeyHit(1)

	UpdateKeys()

	PTime=MilliSecs()

	UpdateCar()

	UpdateGeoms()

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)

	PhysicsTime#=MilliSecs()-PTime

	UpdateCam()

	UpdateWorld

	RenderWorld

	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime
	Text 0,30,"Car Speed:"+Speed
	Text 640,0,"A - Accelerate"
	Text 640,15,"Z - Brake/Reverse"
	Text 640,30,"Arrows - Steering"
	Text 640,45,"Space - Reset Car"
	Text 640,60,"P - Planet="+Planet

	Flip

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function SetupCar()

For count=1 To 4
	Joint(count)=dJointCreateHinge2(World,0)
	dJointAttach(Joint(count),Car,Wheel(count))
	dJointSetHinge2Anchor(Joint(count),dBodyGetPositionX(Wheel(count)),dBodyGetPositionY(Wheel(count)),dBodyGetPositionZ(Wheel(count)))
	dJointSetHinge2Axis1(Joint(count),0,1,0)
	dJointSetHinge2Axis2(Joint(count),-1,0,0)
	dJointSetHinge2Param(Joint(count),dParamSuspensionERP,0.8)
	dJointSetHinge2Param(Joint(count),dParamSuspensionCFM,SuspensionHS)
	If count&gt;2
		dJointSetHinge2Param(Joint(count),dParamLoStop,0)
		dJointSetHinge2Param(Joint(count),dParamHiStop,0)
		End If
Next

Speed=0

End Function

; ###################################################################################################

Function UpdateKeys()

If KeyDown(30)=1
	Speed=Speed+0.08
	If Speed&gt;30 Then Speed=30
	End If

If KeyDown(44)=1
	Speed=Speed-0.1
	If Speed&lt;-10 Then Speed=-10
	If Speed&gt;0 Then Speed=Speed*0.97
	End If

If KeyDown(30)=0 And KeyDown(44)=0 Then Speed=Speed*0.99

If KeyDown(203)=1 Or KeyDown(205)=1
	If KeyDown(203)=1
		Steer=0.5
		Else
		Steer=-0.5
		End If
	Else
	Steer=0
	End If

If KeyHit(57)=1
	Speed=0
	dBodySetRotation(Car,0,0,0)
	End If

; P - Planet
If KeyHit(25) Then
	gx=gx+1
	If gx&gt;4 Then gx=1
	Select gx
	  Case 1
		Planet="Earth "
		dWorldSetGravity(World,0,-1.0,0)
	
	  Case 2
		Planet="Mars"
		dWorldSetGravity(World,0,-.33333,0)

	  Case 3
		Planet="Moon"
		dWorldSetGravity(World,0,-.16666,0)
		
	  Case 4
		Planet="Space"
		dWorldSetGravity(World,0,0,0)
	End Select
	
EndIf

End Function

; ###################################################################################################

Function UpdateCar()

For count=1 To 4
	dBodyEnable(Wheel(count))
Next

dBodyEnable(Car)

For count=1 To 4
	dJointSetHinge2Param(Joint(count),dParamVel2,Speed)
	dJointSetHinge2Param(Joint(count),dParamFMax2,HingeTorque)
Next

For count=1 To 2
	angle#=Steer-dJointGetHinge2Angle1(Joint(count))
	dJointSetHinge2Param(Joint(count),dParamVel,angle)
	dJointSetHinge2Param(Joint(count),dParamFMax,400)
Next

End Function

; ###################################################################################################

Function UpdateCam()

PositionEntity CameraPivot,0,3,-12

camx#=EntityX(CameraPivot,1)-EntityX(Camera)
camy#=EntityY(CameraPivot,1)-EntityY(Camera)
camz#=EntityZ(CameraPivot,1)-EntityZ(Camera)

TranslateEntity Camera,camx*0.5,camy*1.5,camz*0.5

PointEntity Camera,CMesh

End Function

; ###################################################################################################

Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
	RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
	PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
Next

End Function

; ###################################################################################################
</textarea> <br><br></td></tr></table><br>
<a name="555736"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SillyPutty</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#87">[#87]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey guys just stumbled across this thread, and tried the demos out, amazing stuff ! :)<br><br>I take it the wrapper is under constant developent, I am interested in purchasing this lib. <br><br>Is there documentation for the lib once purchased ? Or does one have to consult the ODE docs ? <br><br></td></tr></table><br>
<a name="555745"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#88">[#88]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Deux,<br><br>Yes, the wrapper will be developed constantly as the ODE library progresses.<br><br>I'm working on a doc for the JV-ODE specific functions, but they are simple enough to use without one. The official ODE docs should be used as a guideline. Shifty Geezer is working on some tutorials and if you need any help, just post here and one of the users (or myself) will help you out ;) <br><br></td></tr></table><br>
<a name="555769"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SillyPutty</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#89">[#89]</a></td></tr></table></td></tr><tr ><td class="posttext"> thanks for the speedy reply !<br><br>I am looking for a viable physics wrapper, and I like what I have seen here, I cannot get tokamak to work (initial setup).<br><br>Just need to make a decision to buy your wrapper or not :) <br><br></td></tr></table><br>
<a name="555805"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#90">[#90]</a></td></tr></table></td></tr><tr ><td class="posttext"> There's a demo avialable to try out. For docs I've got my initial tute which includes a basic primitives setup 'engine'. It'll be a while before more docs appear from me though :(<br><br>The ODE docs provide the glut of info you need. For ODE specifics most been covered here, or just ask. <br><br></td></tr></table><br>
<a name="555927"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SillyPutty</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#91">[#91]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks :)<br><br>I would like to ask how one would go about setting up a level ( .x mesh or instance ) ala FPS shooter, so that all objects would react to it using this physics engine.<br><br>say for instance I have a level more complex than just a cube, a hull I think it is called. <br><br>I wont bother you with code, would just like to know how possible it is. The demos I have seen have all been basic primitives, which is all very well, would just like to know how complex objects work. <br><br></td></tr></table><br>
<a name="555933"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SillyPutty</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#92">[#92]</a></td></tr></table></td></tr><tr ><td class="posttext"> ahh, I take it thats what trimesh is right ? Trying to sift through the threads to find info :) <br><br></td></tr></table><br>
<a name="555936"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#93">[#93]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yep, you've got it :)<br><br>You can create a TriMesh from your .x mesh and then spheres, cubes and capped cylinders will interact with it. The full version contains a few TriMesh demos to get you started. <br><br></td></tr></table><br>
<a name="555938"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SillyPutty</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#94">[#94]</a></td></tr></table></td></tr><tr ><td class="posttext"> oh man, I really want to buy this now, how far can one get with the "lite" version ?<br><br>I guess I pretty much got to get it. <br><br></td></tr></table><br>
<a name="555949"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SillyPutty</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#95">[#95]</a></td></tr></table></td></tr><tr ><td class="posttext"> well I just bought it !! Cant wait to play around with this now ! <br><br></td></tr></table><br>
<a name="555983"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#96">[#96]</a></td></tr></table></td></tr><tr ><td class="posttext"> Also add your static scenery into it's own subspace to keep things running top speed (see thread above to explain) <br><br></td></tr></table><br>
<a name="556019"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#97">[#97]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've just had a mess around and created a primitive 'Pong meets Breakout' in about an hour. It uses my Constructor library that my tute introduced. However, I've found that .pdf is lousy for copy+paste code, so I'll dupe the library here.<br><br>Save this as 'ODE_Object_Library.bb;<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Const RESOLUTION_SPHERE = 12
Const RESOLUTION_CYLINDER = 12

; Enumerated types for materials
Const CON_WOOD=1,CON_GOLD=2,CON_RUBBER=3

; Enumerated Types for geometries
Const GEOM_CUBE=1,GEOM_SPHERE=2,GEOM_CYLINDER=3

; Constants for pointer and forces
Global NUM_OBJECTS
Global mat_wood.material, mat_gold.material, mat_rubber.material

Global ODE_world, ODE_space, ODE_scenery_space, ODE_contactGroup

Type vector
	Field x#
	Field y#
	Field z#
End Type
Type material
	Field index				; Index for determining type of material
	Field density#
	Field friction#
	Field restitution#
End Type
Type ODE_object
	Field body
	Field geom
	Field mesh
	Field mass
	Field mat.material
End Type
Type actor
	Field geom			; index of geometry type
	Field pos.vector
	Field rot.vector
	Field siz.vector
	Field mat				; matieral index
End Type

; Define Material Properties
mat_wood.material=New material
mat_wood\index = CON_WOOD
mat_wood\friction = 10.0
mat_wood\restitution = 0.4
mat_wood\density = 0.9

mat_gold.material=New material
mat_gold\index = CON_GOLD
mat_gold\friction = 3.0
mat_gold\restitution = 0.2
mat_gold\density = 10.0

mat_rubber.material=New material
mat_rubber\index = CON_RUBBER
mat_rubber\friction = 500.0
mat_rubber\restitution = 0.9
mat_rubber\density = 1.5

Function create_Box_Mesh(obj.ODE_object)
	obj\mesh=CreateCube()
	Select obj\mat\index
		Case CON_WOOD
			EntityColor obj\mesh,120,80,40
			EntityShininess obj\mesh,0.2
		Case CON_GOLD
			EntityColor obj\mesh,200,120,40
			EntityShininess obj\mesh,0.95
		Case CON_RUBBER
			EntityColor obj\mesh,70,70,80
			EntityShininess obj\mesh,0.2
	End Select
End Function
Function create_Sphere_Mesh(obj.ODE_object)
	obj\mesh=CreateSphere(RESOLUTION_SPHERE)
	Select obj\mat\index
		Case CON_WOOD
			EntityColor obj\mesh,120,80,40
			EntityShininess obj\mesh,0.2
		Case CON_GOLD
			EntityColor obj\mesh,200,120,40
			EntityShininess obj\mesh,0.95
		Case CON_RUBBER
			EntityColor obj\mesh,70,70,80
			EntityShininess obj\mesh,0.2
	End Select
End Function
Function create_Cylinder_Mesh(obj.ODE_object)
	obj\mesh=CreateCylinder(RESOLUTION_CYLINDER)
	Select obj\mat\index
		Case CON_WOOD
			EntityColor obj\mesh,120,80,40
			EntityShininess obj\mesh,0.2
		Case CON_GOLD
			EntityColor obj\mesh,200,120,40
			EntityShininess obj\mesh,0.95
		Case CON_RUBBER
			EntityColor obj\mesh,70,70,80
			EntityShininess obj\mesh,0.2
	End Select
End Function
			
Function create_Box(obj.ODE_object, x_pos#, y_pos#, z_pos#, width#, length#, depth#, x_rot#, y_rot#, z_rot#)
	obj\body=dBodyCreate(ODE_world)
		
	dMassSetBox(obj\mass,obj\mat\density, width, length, depth)
	dBodySetMass(obj\body,obj\mass)
	
	dBodySetRotation(obj\body, x_rot, y_rot, z_rot)
	dBodySetPosition(obj\body, x_pos, y_pos, z_pos)
	dBodySetAutoDisableFlag(obj\body,1)	
	
	obj\geom=dCreateBox(ODE_space,width, length, depth)
	dGeomSetBody(obj\geom,obj\body)
	dGeomContactSetBounce(obj\geom,obj\mat\restitution)
	dGeomContactSetMu(obj\geom,obj\mat\friction)

	create_Box_Mesh(obj)
	; Blitz box lengths 2x longer than ODE box length
	ScaleMesh obj\mesh,width/2,length/2,depth/2
End Function
Function create_Rigid_Box(obj.ODE_object, x_pos#, y_pos#, z_pos#, width#, length#, depth#, x_rot#, y_rot#, z_rot#)
	obj\geom=dCreateBox(ODE_scenery_space,width, length, depth)
	dGeomSetRotation(obj\geom, x_rot, y_rot, z_rot)
	dGeomSetPosition(obj\geom, x_pos, y_pos, z_pos)
	
	; Blitz box lengths 2x longer than ODE box length
	create_Box_Mesh(obj)
	ScaleMesh obj\mesh,width/2,length/2,depth/2
	
	RotateEntity obj\mesh,dGeomGetPitch#(obj\geom),dGeomGetYaw#(obj\geom),dGeomGetRoll#(obj\geom)
	PositionEntity obj\mesh,dGeomGetPositionX#(obj\geom),dGeomGetPositionY#(obj\geom),dGeomGetPositionZ#(obj\geom)
	
End Function

Function create_Sphere(obj.ODE_object, x_pos#, y_pos#, z_pos#, radius#, x_rot#, y_rot#, z_rot#)
	obj\body=dBodyCreate(ODE_world)
	
	dMassSetSphere(obj\mass,obj\mat\density, radius)
	dBodySetMass(obj\body,obj\mass)
	
	dBodySetRotation(obj\body, x_rot, y_rot, z_rot)
	dBodySetPosition(obj\body, x_pos, y_pos, z_pos)
	dBodySetAutoDisableFlag(obj\body,1)	
	
	obj\geom=dCreateSphere(ODE_space,radius)
	dGeomSetBody(obj\geom,obj\body)
	dGeomContactSetBounce(obj\geom,obj\mat\restitution)
	dGeomContactSetMu(obj\geom,obj\mat\friction)

	create_Sphere_Mesh(obj)
	ScaleMesh obj\mesh,radius,radius,radius
	
End Function
Function create_Rigid_Sphere(obj.ODE_object, x_pos#, y_pos#, z_pos#, radius#, x_rot#, y_rot#, z_rot#)
	obj\geom=dCreateSphere(ODE_scenery_space,radius)
	dGeomSetRotation(obj\geom, x_rot, y_rot, z_rot)
	dGeomSetPosition(obj\geom, x_pos, y_pos, z_pos)
	
	create_Sphere_Mesh(obj)
	ScaleMesh obj\mesh,radius,radius,radius
	
	RotateEntity obj\mesh,dGeomGetPitch#(obj\geom),dGeomGetYaw#(obj\geom),dGeomGetRoll#(obj\geom)
	PositionEntity obj\mesh,dGeomGetPositionX#(obj\geom),dGeomGetPositionY#(obj\geom),dGeomGetPositionZ#(obj\geom)
	
End Function

Function create_Cylinder(obj.ODE_object, x_pos#, y_pos#, z_pos#, radius#, length#, x_rot#, y_rot#, z_rot#)
	obj\body=dBodyCreate(ODE_world)
	
;	dMassSetSphere(v,obj\mat\density, radius)
	dMassSetCylinder(obj\mass,obj\mat\density,1, radius,length)
	dBodySetMass(obj\body,obj\mass)
	
	dBodySetRotation(obj\body, x_rot, y_rot, z_rot)
	dBodySetPosition(obj\body, x_pos, y_pos, z_pos)
	dBodySetAutoDisableFlag(obj\body,1)	
	
	obj\geom=dCreateCylinder(ODE_space,radius,length)
	dGeomSetBody(obj\geom,obj\body)
	dGeomContactSetBounce(obj\geom,obj\mat\restitution)
	dGeomContactSetMu(obj\geom,obj\mat\friction)
	
	; Blitz cylinder mesh is 2x longer than ODE cylinder length
	create_Cylinder_Mesh(obj)
	ScaleMesh obj\mesh,radius,length/2,radius
	
End Function
Function create_Rigid_Cylinder(obj.ODE_object, x_pos#, y_pos#, z_pos#, radius#,length#, x_rot#, y_rot#, z_rot#)
	obj\geom=dCreateCylinder(ODE_scenery_space,radius,length)
	dGeomSetRotation(obj\geom, x_rot, y_rot, z_rot)
	dGeomSetPosition(obj\geom, x_pos, y_pos, z_pos)
	
	; Blitz cylinder mesh is 2x longer than ODE cylinder length
	create_Cylinder_Mesh(obj)
	ScaleMesh obj\mesh,radius,length/2,radius
	
	RotateEntity obj\mesh,dGeomGetPitch#(obj\geom),dGeomGetYaw#(obj\geom),dGeomGetRoll#(obj\geom)
	PositionEntity obj\mesh,dGeomGetPositionX#(obj\geom),dGeomGetPositionY#(obj\geom),dGeomGetPositionZ#(obj\geom)
	
End Function

Function set_material(obj.ODE_object,m.material)
	obj\mat\index = m\index
	obj\mat\friction = m\friction
	obj\mat\density = m\density
	obj\mat\restitution = m\restitution
End Function
</textarea><br><br>And here's the program...<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Include "JV-ode.bb"
Include "ODE_Object_Library.bb"
Graphics3D 800,600,0,0
HidePointer()

Const FPS=60, GRAVITY#=-0.981
Const PERIOD=1000/FPS
Const MAX_OBJECTS=50

index_ball=0				; index for ball
index_paddle1=0		; Index for paddle 1
index_paddle2=0		; index for paddle 2

Dim objects.ODE_object(MAX_OBJECTS)

ODE_world=dWorldCreate()
ODE_space=dHashSpaceCreate(0)
ODE_scenery_space=dHashSpaceCreate(ODE_Space)	; Sub-space for static scenery
ODE_contactGroup=dJointGroupCreate(0)

dSetInternalContactSurfaceMode(1)		; Sets bounce value to Max(a,b) for collisions
dSetInternalSpaceCollideMode(0)		; Turns off internal space collision

; Change Rubber Properties
mat_rubber\friction = 0.0
mat_rubber\restitution = 1.0
mat_rubber\density = 5.0

; Change 'wood' material properties for better racket friction
mat_wood\friction = 40.0
mat_wood\restitution = 1.3	; Adds energy per bounce
mat_wood\density = 0.9

; Change 'gold' material properties for better bricks
mat_gold\friction = 5.0
mat_gold\restitution = 0.2	; Adds energy per bounce
mat_gold\density = 0.1

For n=0 To MAX_OBJECTS
	objects(n) = New ODE_object
	objects(n)\mass=dMassCreate()
	objects(n)\mat.material = New material
Next	; initialise ODE objects array

dWorldSetAutoDisableFlag(ODE_world,1)			; Turn on auto disable
dWorldSetGravity(ODE_world,0,GRAVITY#,0)			; Gravity in m/s/s
dWorldSetERP(ODE_world,0.5)				; Global 'error correction'
dWorldSetCFM(ODE_world,0.000001)
dContactSetMode(dContactBounce+dContactSlip1)
dContactSetBounce(0.2)
dContactSetMu(0.0)

AmbientLight 128,148,168
light1=CreateLight()
TurnEntity light1,45,40,0
LightColor light1,180,160,110
light2=CreateLight()
TurnEntity light2,15,-40,0
LightColor light2,110,160,110

rostrum_pan=CreatePivot()
rostrum_tilt=CreatePivot(rostrum_pan)
camera=CreateCamera(rostrum_tilt)
PointEntity rostrum_pan,camera
PointEntity camera,rostrum_pan
CameraZoom camera,3
PositionEntity camera,0,40,-80
RotateEntity camera,30,0,0
	
SeedRnd(MilliSecs())

; Create Pong 'court'
current_object=Create_Court()

; create Ball
current_object=current_object+1
	pos_x# = 3
	pos_y# = 0.5
	pos_z# = 3
	siz_x# = 0.5
	rot_x# = 0
	rot_y# = 0
	rot_z# = 0

	set_material(objects(current_object),mat_rubber)
	create_Sphere(objects(current_object),pos_x,pos_y,pos_z,siz_x,rot_x,rot_y,rot_z)
	EntityColor objects(current_object)\mesh,220,220,220
	
	; Apply random force to sphere for initial movement
	dBodyAddForce(objects(current_object)\body,150+Rnd(-10,10),0,150+Rnd(-10,10))
	index_ball=current_object
	
; create_paddle_1
current_object=current_object+1
	pos_x# = 0
	pos_y# = 1.5
	pos_z# = -29
	siz_x# = 5
	siz_y# = 2.5
	siz_z# = 2
	rot_x# = 0
	rot_y# = 0
	rot_z# = 0

	set_material(objects(current_object),mat_wood)
	create_Rigid_Box(objects(current_object),pos_x,pos_y,pos_z,siz_x,siz_y,siz_z,rot_x,rot_y,rot_z)
	EntityColor objects(current_object)\mesh,50,50,220
	index_paddle1=current_object

; create_paddle_2
current_object=current_object+1
	pos_x# = 0
	pos_y# = 1.5
	pos_z# = 29
	siz_x# = 5
	siz_y# = 2.5
	siz_z# = 2
	rot_x# = 0
	rot_y# = 0
	rot_z# = 0

	set_material(objects(current_object),mat_wood)
	create_Rigid_Box(objects(current_object),pos_x,pos_y,pos_z,siz_x,siz_y,siz_z,rot_x,rot_y,rot_z)
	EntityColor objects(current_object)\mesh,50,220,50
	index_paddle2=current_object

; Add bricks
current_object=current_object+1
	pos_x# = -9
	pos_y# = 0.6
	pos_z# = 0
	siz_x# = 2
	siz_y# = 1
	siz_z# = 1
	rot_x# = 0
	rot_y# = 0
	rot_z# = 0

	set_material(objects(current_object),mat_gold)
	create_Box(objects(current_object),pos_x,pos_y,pos_z,siz_x,siz_y,siz_z,rot_x,rot_y,rot_z)
	EntityColor objects(current_object)\mesh,220,50,50

current_object=current_object+1
	pos_x# = -6

	set_material(objects(current_object),mat_gold)
	create_Box(objects(current_object),pos_x,pos_y,pos_z,siz_x,siz_y,siz_z,rot_x,rot_y,rot_z)
	EntityColor objects(current_object)\mesh,220,50,50

current_object=current_object+1
	pos_x# = -3

	set_material(objects(current_object),mat_gold)
	create_Box(objects(current_object),pos_x,pos_y,pos_z,siz_x,siz_y,siz_z,rot_x,rot_y,rot_z)
	EntityColor objects(current_object)\mesh,220,50,50

current_object=current_object+1
	pos_x# = 0

	set_material(objects(current_object),mat_gold)
	create_Box(objects(current_object),pos_x,pos_y,pos_z,siz_x,siz_y,siz_z,rot_x,rot_y,rot_z)
	EntityColor objects(current_object)\mesh,220,50,50

current_object=current_object+1
	pos_x# = 3

	set_material(objects(current_object),mat_gold)
	create_Box(objects(current_object),pos_x,pos_y,pos_z,siz_x,siz_y,siz_z,rot_x,rot_y,rot_z)
	EntityColor objects(current_object)\mesh,220,50,50

current_object=current_object+1
	pos_x# = 6

	set_material(objects(current_object),mat_gold)
	create_Box(objects(current_object),pos_x,pos_y,pos_z,siz_x,siz_y,siz_z,rot_x,rot_y,rot_z)
	EntityColor objects(current_object)\mesh,220,50,50

current_object=current_object+1
	pos_x# = 9

	set_material(objects(current_object),mat_gold)
	create_Box(objects(current_object),pos_x,pos_y,pos_z,siz_x,siz_y,siz_z,rot_x,rot_y,rot_z)
	EntityColor objects(current_object)\mesh,220,50,50

current_object=current_object+1
	pos_x# = -7.5
	pos_y# = 1.6

	set_material(objects(current_object),mat_gold)
	create_Box(objects(current_object),pos_x,pos_y,pos_z,siz_x,siz_y,siz_z,rot_x,rot_y,rot_z)
	EntityColor objects(current_object)\mesh,220,50,50

current_object=current_object+1
	pos_x# = -4.5
	pos_y# = 1.6

	set_material(objects(current_object),mat_gold)
	create_Box(objects(current_object),pos_x,pos_y,pos_z,siz_x,siz_y,siz_z,rot_x,rot_y,rot_z)
	EntityColor objects(current_object)\mesh,220,50,50

current_object=current_object+1
	pos_x# = -1.5
	pos_y# = 1.6

	set_material(objects(current_object),mat_gold)
	create_Box(objects(current_object),pos_x,pos_y,pos_z,siz_x,siz_y,siz_z,rot_x,rot_y,rot_z)
	EntityColor objects(current_object)\mesh,220,50,50

current_object=current_object+1
	pos_x# = 1.5
	pos_y# = 1.6

	set_material(objects(current_object),mat_gold)
	create_Box(objects(current_object),pos_x,pos_y,pos_z,siz_x,siz_y,siz_z,rot_x,rot_y,rot_z)
	EntityColor objects(current_object)\mesh,220,50,50

current_object=current_object+1
	pos_x# = 4.5
	pos_y# = 1.6

	set_material(objects(current_object),mat_gold)
	create_Box(objects(current_object),pos_x,pos_y,pos_z,siz_x,siz_y,siz_z,rot_x,rot_y,rot_z)
	EntityColor objects(current_object)\mesh,220,50,50

current_object=current_object+1
	pos_x# = 7.5
	pos_y# = 1.6

	set_material(objects(current_object),mat_gold)
	create_Box(objects(current_object),pos_x,pos_y,pos_z,siz_x,siz_y,siz_z,rot_x,rot_y,rot_z)
	EntityColor objects(current_object)\mesh,220,50,50

NUM_objects=current_object ; Number of ODE objects in our array

Floor.ODE_Object = New ODE_Object
Floor\geom = dCreatePlane(ODE_space,0,1,0,0)
Floor\mesh = CreatePlane()
EntityColor Floor\mesh,120,120,120

MoveMouse GraphicsWidth()/2,GraphicsHeight()/2
player_x=MouseX()

While Not KeyHit(1)

	; Computer controlled paddle
	dGeomSetPosition objects(index_paddle2)\geom, dGeomGetPositionX(objects(index_ball)\geom), 1, 29
	
	; Player controlled paddle
	player_x=MouseX()
	set_paddle_position_from_2D(camera, objects(index_paddle1), MouseX(), 0, 3)
	
	; Update objects
	For n=0 To NUM_OBJECTS
		If objects(n)\geom
			RotateEntity objects(n)\mesh,dGeomGetPitch#(objects(n)\geom),dGeomGetYaw#(objects(n)\geom),dGeomGetRoll#(objects(n)\geom)
			PositionEntity objects(n)\mesh,dGeomGetPositionX#(objects(n)\geom),dGeomGetPositionY#(objects(n)\geom),dGeomGetPositionZ#(objects(n)\geom)
		End If
	Next

	dSpaceCollide(ODE_space,ODE_world,ODE_contactGroup)
	dWorldQuickStep(ODE_world,0.10)
	dJointGroupEmpty(ODE_contactGroup)

	UpdateWorld	
	RenderWorld

	Flip

Wend

dJointGroupDestroy(ODE_contactGroup)
dSpaceDestroy(ODE_space)
dWorldDestroy(ODE_world)
dCloseODE()

End

Function Create_Court()
	; Package court creation into a function to keep the main code tidy

	n=0	; First object - left wall
	
	pos_x# = -20
	pos_y# = 3
	pos_z# = 0
	siz_x# = 3
	siz_y# = 6
	siz_z# = 60
	rot_x# = 0
	rot_y# = 0
	rot_z# = 0

	set_material(objects(n),mat_rubber)
	create_rigid_Box(objects(n),pos_x,pos_y,pos_z,siz_x,siz_y,siz_z,rot_x,rot_y,rot_z)
	EntityColor objects(n)\mesh,155,60,60

	n=n+1	; Second object - right wall
	
	pos_x = 20
	pos_y = 3
	pos_z = 0
	siz_x = 3
	siz_y = 6
	siz_z = 60
	rot_x = 0
	rot_y = 0
	rot_z = 0

	set_material(objects(n),mat_rubber)
	create_rigid_Box(objects(n),pos_x,pos_y,pos_z,siz_x,siz_y,siz_z,rot_x,rot_y,rot_z)
	EntityColor objects(n)\mesh,155,60,60

	n=n+1	; Third object - left back endpiece
	
	pos_x = -15
	pos_y = 3
	pos_z = 31.5
	siz_x = 3
	siz_y = 6
	siz_z = 10
	rot_x = 0
	rot_y = 90
	rot_z = 0

	set_material(objects(n),mat_rubber)
	create_rigid_Box(objects(n),pos_x,pos_y,pos_z,siz_x,siz_y,siz_z,rot_x,rot_y,rot_z)
	EntityColor objects(n)\mesh,60,155,60

	n=n+1	; Fourth object - right back endpiece
	
	pos_x = 15
	pos_y = 3
	pos_z = 31.5
	siz_x = 3
	siz_y = 6
	siz_z = 10
	rot_x = 0
	rot_y = 90
	rot_z = 0

	set_material(objects(n),mat_rubber)
	create_rigid_Box(objects(n),pos_x,pos_y,pos_z,siz_x,siz_y,siz_z,rot_x,rot_y,rot_z)
	EntityColor objects(n)\mesh,60,155,60

	n=n+1	; Fifth object - left back endpiece
	
	pos_x = -15
	pos_y = 3
	pos_z = -31.5
	siz_x = 3
	siz_y = 6
	siz_z = 10
	rot_x = 0
	rot_y = 90
	rot_z = 0

	set_material(objects(n),mat_rubber)
	create_rigid_Box(objects(n),pos_x,pos_y,pos_z,siz_x,siz_y,siz_z,rot_x,rot_y,rot_z)
	EntityColor objects(n)\mesh,60,60,155
	EntityAlpha objects(n)\mesh,0.5
	
	n=n+1	; Sixth object - right back endpiece
	
	pos_x = 15
	pos_y = 3
	pos_z = -31.5
	siz_x = 3
	siz_y = 6
	siz_z = 10
	rot_x = 0
	rot_y = 90
	rot_z = 0

	set_material(objects(n),mat_rubber)
	create_rigid_Box(objects(n),pos_x,pos_y,pos_z,siz_x,siz_y,siz_z,rot_x,rot_y,rot_z)
	EntityColor objects(n)\mesh,60,60,155
	EntityAlpha objects(n)\mesh,0.5
	
	Return n
End Function

Function set_paddle_position_from_2D(usecam, obj.ODE_object, x2d#,  positionGlobal = 0, camZoom# = 1)
	gw = GraphicsWidth ()
	gh = GraphicsHeight ()
	x# = -((gw / 2) - x2d)
	y# = (gh / 2) - y2d
	parent = GetParent (obj\mesh)
	EntityParent obj\mesh, usecam
	z3d# = Abs (EntityZ(obj\mesh))
	div# = (gw / (2 / camZoom)) / z3d
	PositionEntity obj\mesh, x / div, y / div, z3d, positionGlobal
	dGeomSetPosition (obj\geom,EntityX(obj\mesh,1),1, -29)
	EntityParent obj\mesh, parent
End Function
</textarea><br><br>I reuse the material names in the ODE_Object_Lib as I couldn't be bothered to change them, but in a proper program you'd obviously spend a little more time documenting and structuring the program.<br><br>Also note I use an array of objects and store index value to reference different ODE objects. This makes it easy to save and restore level data. I'm sure there's a squillion optimizations and improvements people can make, but it's nice to see how quick and straightforward it is to create a physics based game. There's really no excuse not to include physics in everything!! <br><br></td></tr></table><br>
<a name="556024"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SillyPutty</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#98">[#98]</a></td></tr></table></td></tr><tr ><td class="posttext"> saweet ! Gonna give this a bash when i get home.<br><br>Seeing as all the physics guys are in one place, how important would you think physics is in indie games ? I mean the code above is a perfect example of physics in casual games.<br><br>Ofcourse FPS is a classic example of where one should use physics. <br><br></td></tr></table><br>
<a name="556041"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#99">[#99]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you can put it in, do so I say. It adds a dynamic to arcade games, and a sense of reality to all genres. <br><br></td></tr></table><br>
<a name="557446"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#100">[#100]</a></td></tr></table></td></tr><tr ><td class="posttext"> <b>JV-ODE Version 1.06 Released</b><br><br>Please check your inbox :)<br><br>New functions have been added to get detailed collision information of sub-space geoms when using multiple spaces. The existing detailed collision functions still work the same way and are used for single space simulations. To retrieve detailed collision information for multiple space simulations, use <b>both</b> the existing functions and the new sub-space functions.<br><br>Here is a modified car demo to demonstrate the new functions in use...<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #										  JV-ODE Car Demo											#
; #									Code by Jim Williams (VIP3R)									#		#
; #						Feel free to use this code, any credit appreciated							#
; ###################################################################################################

AppTitle "JV-ODE Car Demo"

Include "JV-ODE.bb"

Graphics3D 800,600,0,2

Global CMass#=200			; ### Car Mass
Global WMass#=8				; ### Wheel Mass

Global WorldERP#=1			; ### World Error Correction
Global WorldFriction#=64	; ### World Friction
Global HingeTorque#=24		; ### Hinge Torque
Global SuspensionHS#=0.01	; ### Hinge Suspension Hardness/Softness (Higher=Softer - Lower=Harder)

Global Speed#=0
Global Steer#=0

Global Car
Global CGeom
Global CMesh

Global CarStartY=20

Global SpaceInfo=0

Global Pointer

Global RampGeom
Global BlueGeom
Global PlaneGeom

Global GeomX$
Global GeomY$
Global GeomZ$
Global GeomGeom$
Global GeomID$
Global GeomFlash

Global SubGeomX$
Global SubGeomY$
Global SubGeomZ$
Global SubGeomGeom$
Global SubGeomID$

Dim WGeomID$(4)
Dim SubWGeomID$(4)

Dim SphereGeom(20)
Dim CCylinderGeom(20)

Dim Wheel(4)
Dim WGeom(4)
Dim Joint(4)

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

; ###################################################################################################

; ### Setup ODE

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global CarSpace=dHashSpaceCreate(Space)
Global ObjSpace=dHashSpaceCreate(Space)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,-0.98,0)
dWorldSetERP(World,WorldERP)

dContactSetMode(dContactSlip1)
dContactSetMu(WorldFriction)

; ### Create car body

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
Car=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,0,CarStartY,0)
mass=dMassCreate()
dMassSetBox(mass,1,3,1,5)
dMassSetBoxTotal(mass,CMass,3,1,5)
dMassTranslate(mass,0,-1,0)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
ode\geom=dCreateBox(CarSpace,3,1,5)
CGeom=ode\geom
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
CMesh=ode\mesh
ScaleMesh ode\mesh,1.5,0.5,2.5
RotateMesh ode\mesh,0,0,0
PositionMesh ode\mesh,0,0,0
EntityColor ode\mesh,40,80,255
EntityAlpha ode\mesh,0.5

; ### Create wheels

For count=1 To 4
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	Wheel(count)=ode\body
	dBodySetRotation(ode\body,0,0,0)
	dBodySetPosition(ode\body,0,0,0)
	mass=dMassCreate()
	dMassSetSphere(mass,1,0.7)
	dMassSetSphereTotal(mass,WMass,0.7)
	dBodySetMass(ode\body,mass)
	dMassDestroy(mass)
	ode\geom=dCreateSphere(CarSpace,0.7)
	WGeom(count)=ode\geom
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder(8)
	ScaleMesh ode\mesh,0.7,0.25,0.7
	RotateMesh ode\mesh,0,0,90
	PositionMesh ode\mesh,0,0,0
	EntityColor ode\mesh,255,255,255
Next

dBodySetPosition(Wheel(1),-2,CarStartY-0.5,+2)
dBodySetPosition(Wheel(2),+2,CarStartY-0.5,+2)
dBodySetPosition(Wheel(3),-2,CarStartY-0.5,-2)
dBodySetPosition(Wheel(4),+2,CarStartY-0.5,-2)

; ### Create some objects

SeedRnd MilliSecs()

For spheres=1 To 20
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	dBodySetRotation(ode\body,0,0,0)
	dBodySetPosition(ode\body,Rnd(-100,100),30,Rnd(-100,100))
	ode\geom=dCreateSphere(Space,4)
	SphereGeom(spheres)=ode\geom
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateSphere()
	ScaleMesh ode\mesh,4,4,4
	RotateMesh ode\mesh,0,0,0
	PositionMesh ode\mesh,0,0,0
	EntityColor ode\mesh,Rnd(255),Rnd(255),Rnd(255)
	EntityAlpha ode\mesh,1
	EntityShininess ode\mesh,0.7
Next

For cylinders=1 To 20
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	dBodySetRotation(ode\body,90,0,0)
	dBodySetPosition(ode\body,Rnd(-100,100),30,Rnd(-100,100))
	ode\geom=dCreateCCylinder(ObjSpace,1,8)
	CCylinderGeom(cylinders)=ode\geom
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder(8)
	ScaleMesh ode\mesh,1,5,1
	RotateMesh ode\mesh,90,0,0	; &lt;&lt;&lt; Mesh X-Axis must be rotated 90 degrees to fix cylinder alignment
	PositionMesh ode\mesh,0,0,0
	EntityColor ode\mesh,Rnd(255),Rnd(255),Rnd(255)
	EntityAlpha ode\mesh,1
	EntityShininess ode\mesh,0.7
Next

; ### Create light

Global Light=CreateLight()

RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera

Global CameraPivot=CreatePivot(CMesh)
PositionEntity CameraPivot,0,2,-7

Global Camera=CreateCamera()
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000

; ### Create plane

PlaneGeom=dCreatePlane(Space,0,1,0,0)

Plane=CreatePlane()

EntityAlpha Plane,0.8

PlaneTexture=CreateTexture(128,128,9)

ClsColor 0,200,80
Cls

Color 255,255,255

Rect 0,0,64,64,1
Rect 64,64,64,64,1

CopyRect 0,0,128,128,0,0,BackBuffer(),TextureBuffer(PlaneTexture)
ScaleTexture PlaneTexture,20,20
EntityTexture Plane,PlaneTexture,0,0

Mirror=CreateMirror()

; ###################################################################################################

; ### ODE STATIC OBJECT (Blue)

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,2,8,40)
dGeomSetRotation(ode\geom,-10,8,4)
dGeomSetPosition(ode\geom,20,5,40)
BlueGeom=ode\geom
ode\mesh=CreateCube()
ScaleMesh ode\mesh,1,4,20
RotateMesh ode\mesh,0,0,0
PositionMesh ode\mesh,0,0,0

EntityColor ode\mesh,0,100,200
EntityAlpha ode\mesh,1

; ### ODE STATIC OBJECT (Red)

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(ObjSpace,18,0.2,40)
dGeomSetRotation(ode\geom,-14,0,0)
dGeomSetPosition(ode\geom,-20,4.9,40)
RampGeom=ode\geom
ode\mesh=CreateCube()
ScaleMesh ode\mesh,9,0.1,20
RotateMesh ode\mesh,0,0,0
PositionMesh ode\mesh,0,0,0

EntityColor ode\mesh,200,0,100
EntityAlpha ode\mesh,1

; ### BLITZ COLLISION OBJECT (Yellow)

Pointer=CreateSphere()
ScaleMesh Pointer,0.5,0.5,0.5

EntityColor Pointer,255,255,100
EntityAlpha Pointer,1

; ###################################################################################################

SetupCar()

While Not KeyHit(1)

	UpdateKeys()

	PTime=MilliSecs()

	UpdateCar()

	UpdateGeoms()

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)

	PhysicsTime#=MilliSecs()-PTime

	UpdateCam()

	UpdateWorld

	RenderWorld

	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime
	Text 0,30,"Car Speed:"+Speed

	Text 220,0,"F1 - Toggle Collision Info (Space - SubSpace)"

	If SpaceInfo=0
		ShowCollisionInfo()
		Else
		ShowSubCollisionInfo()
		End If

	Text 0,480,"Top Level Space (Space):"
	Text 0,495,"Ground Plane - Blue Block - Spheres"

	Text 0,520,"Sub-Space (CarSpace):"
	Text 0,535,"Car Body - Car Wheels"

	Text 0,560,"Sub-Space (ObjSpace):"
	Text 0,575,"Red Ramp - CCylinders"

	Text 640,0,"A - Accelerate"
	Text 640,15,"Z - Brake/Reverse"
	Text 640,30,"Arrows - Steering"
	Text 640,45,"Space - Reset Car"

	Flip

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function SetupCar()

For count=1 To 4
	Joint(count)=dJointCreateHinge2(World,0)
	dJointAttach(Joint(count),Car,Wheel(count))
	dJointSetHinge2Anchor(Joint(count),dBodyGetPositionX(Wheel(count)),dBodyGetPositionY(Wheel(count)),dBodyGetPositionZ(Wheel(count)))
	dJointSetHinge2Axis1(Joint(count),0,1,0)
	dJointSetHinge2Axis2(Joint(count),-1,0,0)
	dJointSetHinge2Param(Joint(count),dParamSuspensionERP,0.8)
	dJointSetHinge2Param(Joint(count),dParamSuspensionCFM,SuspensionHS)
	If count&gt;2
		dJointSetHinge2Param(Joint(count),dParamLoStop,0)
		dJointSetHinge2Param(Joint(count),dParamHiStop,0)
		End If
Next

Speed=0

End Function

; ###################################################################################################

Function ShowCollisionInfo()

If dGeomCountCollisions(CGeom)&gt;0
	GeomX$=dGeomCollisionX#(CGeom,1)
	GeomY$=dGeomCollisionY#(CGeom,1)
	GeomZ$=dGeomCollisionZ#(CGeom,1)
	GeomGeom$=dGeomCollisionGeom(CGeom,1)
	If dGeomCollisionGeom(CGeom,1)=PlaneGeom Then GeomID$=" - Ground Plane"
	If dGeomCollisionGeom(CGeom,1)=RampGeom Then GeomID$=" - Red Ramp"
	If dGeomCollisionGeom(CGeom,1)=BlueGeom Then GeomID$=" - Blue Block"
	For count=1 To 20
		If dGeomCollisionGeom(CGeom,1)=SphereGeom(count) Then GeomID$=" - Sphere "+count
		If dGeomCollisionGeom(CGeom,1)=CCylinderGeom(count) Then GeomID$=" - Capped Cylinder "+count
	Next
	PositionEntity Pointer,dGeomCollisionX#(CGeom,1),dGeomCollisionY#(CGeom,1),dGeomCollisionZ#(CGeom,1)
	End If

For count=1 To 4
	WGeomID$(count)=""
	If dGeomCountCollisions(WGeom(count))&gt;0
		If dGeomCollisionGeom(WGeom(count),1)=PlaneGeom Then WGeomID$(count)=" - Ground Plane"
		If dGeomCollisionGeom(WGeom(count),1)=RampGeom Then WGeomID$(count)=" - Red Ramp"
		If dGeomCollisionGeom(WGeom(count),1)=BlueGeom Then WGeomID$(count)=" - Blue Block"
		For count2=1 To 20
			If dGeomCollisionGeom(WGeom(count),1)=SphereGeom(count2) Then WGeomID$(count)=" - Sphere "+count2
			If dGeomCollisionGeom(WGeom(count),1)=CCylinderGeom(count2) Then WGeomID$(count)=" - Capped Cylinder "+count2
		Next
		End If
Next

GeomFlash=GeomFlash+1
If GeomFlash&gt;100 Then GeomFlash=0
If GeomFlash&lt;30 Then EntityAlpha Pointer,GeomFlash*0.1
If GeomFlash&gt;70 Then EntityAlpha Pointer,(100-GeomFlash)*0.1
ScaleEntity Pointer,0.5+(GeomFlash*0.01),0.5+(GeomFlash*0.01),0.5+(GeomFlash*0.01)
EntityColor Pointer,255,255-(GeomFlash*2),100

Text 0,80,"Car Body Collision Info (CGeom) - Top Level Space"
Text 0,100,"GeomCollisionX:"+GeomX$
Text 0,115,"GeomCollisionY:"+GeomY$
Text 0,130,"GeomCollisionZ:"+GeomZ$
Text 0,150,"GeomCollisionGeom:"+GeomGeom$+GeomID$

Text 0,295,"Car Wheel Collision Info (WGeom) - Top Level Space"
Text 0,315,"Wheel 1 (F/L)"+WGeomID$(1)
Text 0,330,"Wheel 2 (F/R)"+WGeomID$(2)
Text 0,345,"Wheel 3 (R/L)"+WGeomID$(3)
Text 0,360,"Wheel 4 (R/R)"+WGeomID$(4)

End Function

; ###################################################################################################

Function ShowSubCollisionInfo()

If dSubGeomCountCollisions(CGeom)&gt;0
	SubGeomX$=dSubGeomCollisionX#(CGeom,1)
	SubGeomY$=dSubGeomCollisionY#(CGeom,1)
	SubGeomZ$=dSubGeomCollisionZ#(CGeom,1)
	SubGeomGeom$=dSubGeomCollisionGeom(CGeom,1)
	If dSubGeomCollisionGeom(CGeom,1)=PlaneGeom Then SubGeomID$=" - Ground Plane"
	If dSubGeomCollisionGeom(CGeom,1)=RampGeom Then SubGeomID$=" - Red Ramp"
	If dSubGeomCollisionGeom(CGeom,1)=BlueGeom Then SubGeomID$=" - Blue Block"
	For count=1 To 20
		If dSubGeomCollisionGeom(CGeom,1)=SphereGeom(count) Then SubGeomID$=" - Sphere "+count
		If dSubGeomCollisionGeom(CGeom,1)=CCylinderGeom(count) Then SubGeomID$=" - Capped Cylinder "+count
	Next
	PositionEntity Pointer,dSubGeomCollisionX#(CGeom,1),dSubGeomCollisionY#(CGeom,1),dSubGeomCollisionZ#(CGeom,1)
	End If

For count=1 To 4
	SubWGeomID$(count)=""
	If dSubGeomCountCollisions(WGeom(count))&gt;0
		If dSubGeomCollisionGeom(WGeom(count),1)=PlaneGeom Then SubWGeomID$(count)=" - Ground Plane"
		If dSubGeomCollisionGeom(WGeom(count),1)=RampGeom Then SubWGeomID$(count)=" - Red Ramp"
		If dSubGeomCollisionGeom(WGeom(count),1)=BlueGeom Then SubWGeomID$(count)=" - Blue Block"
		For count2=1 To 20
			If dSubGeomCollisionGeom(WGeom(count),1)=SphereGeom(count2) Then SubWGeomID$(count)=" - Sphere "+count2
			If dSubGeomCollisionGeom(WGeom(count),1)=CCylinderGeom(count2) Then SubWGeomID$(count)=" - Capped Cylinder "+count2
		Next
		End If
Next

GeomFlash=GeomFlash+1
If GeomFlash&gt;100 Then GeomFlash=0
If GeomFlash&lt;30 Then EntityAlpha Pointer,GeomFlash*0.1
If GeomFlash&gt;70 Then EntityAlpha Pointer,(100-GeomFlash)*0.1
ScaleEntity Pointer,0.5+(GeomFlash*0.01),0.5+(GeomFlash*0.01),0.5+(GeomFlash*0.01)
EntityColor Pointer,255,255-(GeomFlash*2),100

Text 0,80,"Car Body Collision Info (CGeom) - Sub Space"
Text 0,100,"SubGeomCollisionX:"+SubGeomX$
Text 0,115,"SubGeomCollisionY:"+SubGeomY$
Text 0,130,"SubGeomCollisionZ:"+SubGeomZ$
Text 0,150,"SubGeomCollisionGeom:"+SubGeomGeom$+SubGeomID$

Text 0,295,"Car Wheel Collision Info (WGeom) - Sub Space"
Text 0,315,"Wheel 1 (F/L)"+SubWGeomID$(1)
Text 0,330,"Wheel 2 (F/R)"+SubWGeomID$(2)
Text 0,345,"Wheel 3 (R/L)"+SubWGeomID$(3)
Text 0,360,"Wheel 4 (R/R)"+SubWGeomID$(4)

End Function

; ###################################################################################################

Function UpdateKeys()

If KeyDown(30)=1
	Speed=Speed+0.08
	If Speed&gt;30 Then Speed=30
	End If

If KeyDown(44)=1
	Speed=Speed-0.1
	If Speed&lt;-10 Then Speed=-10
	If Speed&gt;0 Then Speed=Speed*0.97
	End If

If KeyDown(30)=0 And KeyDown(44)=0 Then Speed=Speed*0.99

If KeyDown(203)=1 Or KeyDown(205)=1
	If KeyDown(203)=1
		Steer=0.5
		Else
		Steer=-0.5
		End If
	Else
	Steer=0
	End If

If KeyHit(57)=1
	Speed=0
	dBodySetRotation(Car,0,0,0)
	End If

If KeyHit(59) Then SpaceInfo=Not SpaceInfo

End Function

; ###################################################################################################

Function UpdateCar()

For count=1 To 4
	dBodyEnable(Wheel(count))
Next

dBodyEnable(Car)

For count=1 To 4
	dJointSetHinge2Param(Joint(count),dParamVel2,Speed)
	dJointSetHinge2Param(Joint(count),dParamFMax2,HingeTorque)
Next

For count=1 To 2
	angle#=Steer-dJointGetHinge2Angle1(Joint(count))
	dJointSetHinge2Param(Joint(count),dParamVel,angle)
	dJointSetHinge2Param(Joint(count),dParamFMax,400)
Next

End Function

; ###################################################################################################

Function UpdateCam()

PositionEntity CameraPivot,0,3,-12

camx#=EntityX(CameraPivot,1)-EntityX(Camera)
camy#=EntityY(CameraPivot,1)-EntityY(Camera)
camz#=EntityZ(CameraPivot,1)-EntityZ(Camera)

TranslateEntity Camera,camx*0.5,camy*0.5,camz*0.5

PointEntity Camera,CMesh

End Function

; ###################################################################################################

Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
	RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
	PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
Next

End Function

; ###################################################################################################
</textarea><br>New joint parameters have also been added to the include file.<br><br>Let me know if you have any questions regarding this update.<br><br>Have fun :) <br><br></td></tr></table><br>
<a name="557455"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SillyPutty</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#101">[#101]</a></td></tr></table></td></tr><tr ><td class="posttext"> awsome, thanks Vip3r ! <br><br></td></tr></table><br>
<a name="557938"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PsychicParrot</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#102">[#102]</a></td></tr></table></td></tr><tr ><td class="posttext"> Another FANTASTIC update Vip3r ... thanks again for all your hard work. <br><br></td></tr></table><br>
<a name="557967"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#103">[#103]</a></td></tr></table></td></tr><tr ><td class="posttext"> You're welcome :) <br><br></td></tr></table><br>
<a name="558499"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#104">[#104]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi all,<br><br>I'll be including the new JV-ODE docs in the next release, but I wanted to get some feedback from you beforehand if possible...<br><br>What format would you prefer the JV-ODE docs to be in?<br><br>Word Document (*.doc)<br>HTML Document (*.html)<br>PDF Document (*.pdf)<br><br>Please let me know via email, thanks :) <br><br></td></tr></table><br>
<a name="558505"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sigi</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#105">[#105]</a></td></tr></table></td></tr><tr ><td class="posttext"> (*.chm)  :) or  (*.pdf) .Thank`s <br><br></td></tr></table><br>
<a name="558512"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#106">[#106]</a></td></tr></table></td></tr><tr ><td class="posttext"> Can't do either of those formats tbh, but I might be able to get the doc converted to pdf (hence the pdf option). I'm not buying software to create one doc though, anyone got a chm converter?<br><br>It might be better to email me with your preferred options, otherwise this thread is going to get a bit clogged up  :) <br><br></td></tr></table><br>
<a name="560475"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >seyhajin</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#107">[#107]</a></td></tr></table></td></tr><tr ><td class="posttext"> html or pdf please :) <br><br></td></tr></table><br>
<a name="560493"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#108">[#108]</a></td></tr></table></td></tr><tr ><td class="posttext"> Eyyy :-) So, whats new in the next version? <br><br></td></tr></table><br>
<a name="560567"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#109">[#109]</a></td></tr></table></td></tr><tr ><td class="posttext"> A minor change in the usage of the dGeomPlaneGetParams(plane) function.<br><br>Addition of the new JV-ODE specific docs.<br><br>;) <br><br></td></tr></table><br>
<a name="560880"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#110">[#110]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wahey! We're getting our moneys worth! <br><br></td></tr></table><br>
<a name="563032"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#111">[#111]</a></td></tr></table></td></tr><tr ><td class="posttext"> How can I use collisions when manualling positioning objects? As an example, say I have a cube and a sphere above it. I have my editor that I can click and drag the sphere to position it. With gravity enabled it falls and bounces off the cube. If I turn off gravity and move the sphere down, it penetrats the cube. It's only when a force is applied that the sphere bounces out/'collides'. Can I do a collision test on move and if so, don't move? How would I structure this in code to perform the collision test? <br><br></td></tr></table><br>
<a name="563039"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#112">[#112]</a></td></tr></table></td></tr><tr ><td class="posttext"> It will penetrate the cube because you're forcing the spheres position even if a collision occurs. The collision detection should still be working though, have you tried the detailed collision functions to check for collision count etc? <br><br></td></tr></table><br>
<a name="563055"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#113">[#113]</a></td></tr></table></td></tr><tr ><td class="posttext"> No I haven't. I'm not sure how to. Heck, I'm not even sure what those functions even are!!<br><br>I've looked at the Decls file and spied these likely suspects...<br><br>dGeomCountCollisions%(geom):"odeGeomCountCollisions@4"<br>dGeomCollisionGeom%(geom,index):"odeGeomCollisionGeom@8"<br>dGeomCollisionX#(geom,index):"odeGeomCollisionX@8"<br>dGeomCollisionY#(geom,index):"odeGeomCollisionY@8"<br>dGeomCollisionZ#(geom,index):"odeGeomCollisionZ@8"<br>dGeomCollisionNX#(geom,index):"odeGeomCollisionNX@8"<br>dGeomCollisionNY#(geom,index):"odeGeomCollisionNY@8"<br>dGeomCollisionNZ#(geom,index):"odeGeomCollisionNZ@8"<br>dGeomCollisionDepth#(geom,index):"odeGeomCollisionDepth@8"<br><br>My progam loops through all objects each frame positioning the mesh where the ODE_geom is. If the simulation is active I call an advance_simulation() function that's basically this...<br><br>Function advance_simulation()<br>	dSpaceCollide(ODE_space,ODE_world,ODE_contactGroup)<br>	<br>	dWorldQuickStep(ODE_world,ODE_Resolution#)<br>	dJointGroupEmpty(ODE_contactGroup)<br>End Function<br><br>...with some rotational dampning thrown in. I'm thinking I need to call dSpaceCollide every frame regardless. then I can use a process...<br><br>Record object's current position<br>Move object<br>If object collides then<br>	move object back where it was<br><br>Hmmm. This wouldn't be as accurate as ODE's solving as if I move the object fairly quickly it'll pop back where it was, instead of rest up against the surface it's collided with. Would it be possible to have an object press against and correct itself? That is, if a box is moved into another box at an angle, the box being moved rotates to land on the inclined surface?#<br><br>As you can see I've really got know idea how to tackle the problem. Though I have just suddenly had the quirky idea of using gravity, setting the gravity direction in the direction the object is moved and disabling gravity for all other objects ;) I'll await someone's expert opinion for messing about with my code though. <br><br></td></tr></table><br>
<a name="563100"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#114">[#114]</a></td></tr></table></td></tr><tr ><td class="posttext"> Take a look at the detailed collisions demo to see some of those functions in action.<br><br>I'm -nearly- done on the new 'JV-ODE Function Reference' document which will also help explain some of those functions in more detail. It won't be anywhere near tutorial level, but it will give users a better understanding of the JV-ODE specific functions (like the detailed collision stuff).<br><br>Hopefully that may help with the problem you're having ;) <br><br></td></tr></table><br>
<a name="565532"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#115">[#115]</a></td></tr></table></td></tr><tr ><td class="posttext"> Anyone had any luck with delta-timing on ODE simulations? I've been using a fixed quickStep of 0.15 and locking the program's main loop to screen refresh. Of course on a slower machine this has a slower frame-rate and the simulation runs in slow motion.<br><br>I just tried an implmentation where the QuickStep amount is varied based on time since last update, and the movement is both jerky and not as accurate, with a collision penetrations. A simple test of setting QuickStep to 0.13+rnd(0.4) shows collision responses aren't smooth without a constant Quickstep amount.<br><br>Best I can figure is to set a constant value based on a rough summation of the machine's performance, but i don't know how to best obtain such a metric. Any ideas for keeping simulation rate constant across different spec'd machines? <br><br></td></tr></table><br>
<a name="565539"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#116">[#116]</a></td></tr></table></td></tr><tr ><td class="posttext"> Multiple timing is the key Shifty. Try separating the screen update timing and the physics step timing instead of using the same timing system for both. That way, the refresh rate will never affect the speed of the physics simulation.<br><br>I wish I could help more, but I'm still up to my eyeballs writing the docs. Nearly there now though thank the lord, I -hate- writing docs :S <br><br></td></tr></table><br>
<a name="565545"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#117">[#117]</a></td></tr></table></td></tr><tr ><td class="posttext"> My refresh timing is pretty negligable. The graphics are flat shaded boxes and spheres, 3000 tri's at once on a bad day, 5000 worst day of all, 2 lights and one texture. My code is basically a representation of the physics engine and ODE is the deciding factor. If I chop that bit out I get 60 fps even on a 8 year old PC. Trouble is on slow machines the physics at QuickStep = 0.15 can't be calculated in 1/60th a frame which causes the slow motion. Setting QuickStep=0.25 (or whatever figure I tried) has the slow PCs animation moving at the same speed even at a lower frame rate.<br><br>It's not the end of the world, and it's not a priority. Good docs are a pain to write I know but oh-so very important! They're more needed than this. But it'd be nice if anyone comes up with a solution (and surely people are writing code to work on slower machines too?) it'd be nice to hear how they've solved this. <br><br></td></tr></table><br>
<a name="565569"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#118">[#118]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Shifty,<br>Post the code and I'll take a look at optimizing.<br>8) <br><br></td></tr></table><br>
<a name="565573"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#119">[#119]</a></td></tr></table></td></tr><tr ><td class="posttext"> What the ENTIRE progam?!?! Really what I've got is a setup phase, and then a run simulation phase which is nothing more than ODE's update. I hand over to that. At present I use something like...<br><pre class=code>
Global ODE_Resolution# = 0.15

While Not KeyHit(1)
	frame=advance_simulation(frame)
	For obj.ODE_object=Each ODE_object
		Update_object(obj)
	Next
	UpdateWorld()
	RenderWorld()
	Flip
Wend


Function advance_simulation(t%)
	; Advances the simluation, incrementing frame count
	; Performs friction calculations
	; Disables 'non-existant' objects
	dSpaceCollide(ODE_space,ODE_world,ODE_contactGroup)
	
	;#Region Apply Rotational Friction
	For ode.ODE_object=Each ODE_object
		If ode\body
			If dBodyGetPositionY(ode\body)&lt;-50.0
				dBodyDisable(ode\body)
				HideEntity ode\mesh
				HideEntity ode\outline_mesh
			EndIf
			If dBodyIsEnabled(ode\body)
				numjoints=dBodyGetNumJoints(ode\body)
				If numjoints&gt;0 														; If joined to another body
					For joints=0 To numjoints-1								; for all joints attached to body...
						joint=dBodyGetJoint(ode\body,joints)
						If dJointGetType(joint)=dJointTypeContact		; If joint type is a collision contact
		
							; Get Angular velocity vector
					  		bx#=dBodyGetAngularVelX#(ode\body)
					  		by#=dBodyGetAngularVelY#(ode\body)
							bz#=dBodyGetAngularVelZ#(ode\body)
					  		; Calculate magnitudes
							ForceB#=Sqr(bx*bx+by*by+bz*bz)
							If forceb&gt;.01
								friction#=ode\mat\rotational_friction*-1.0
								dBodyAddTorque ode\body,dBodyGetAngularVelX(ode\body)*friction,dBodyGetAngularVelY(ode\body)*friction,dBodyGetAngularVelZ(ode\body)*friction
							End If

						End If
					Next
				EndIf
			EndIf
		EndIf
	Next

	;#End Region
	dWorldQuickStep(ODE_world,ODE_Resolution#)
	dJointGroupEmpty(ODE_contactGroup)
	Return t+1
End Function

Function update_object(obj.ODE_Object)
	RotateEntity obj\mesh,dGeomGetPitch#(obj\geom),dGeomGetYaw#(obj\geom),dGeomGetRoll#(obj\geom)
	PositionEntity obj\mesh,dGeomGetPositionX#(obj\geom),dGeomGetPositionY#(obj\geom),dGeomGetPositionZ#(obj\geom)
End Function
</pre><br>I will be adding a test each frame along the lines of <br><br>For each object, If Frame = object\Entry_time, object visibile=true, ODE_active=true<br><br>This loop calls the simulation update once per iteration and so that's called 1/60th or 1/75th frame or whatever depending on screen refresh (which is something I'm a little concerned about, but not a great deal), or less than that if the simulation time overruns one frame. Simulations are nothing complex so it's not an issue on most machines but on the test case at say &lt;30 fps main loop update the simulation runs at about half speed. If I change the quickstep value ODE_Resolution to 0.25 the low spec'd machine runs it nicely but of course it's too fast on anything more up to date.<br><br>It's not a time critical system and if the program runs slightly faster or slower on different machines that's fine. However I'd like to be able to offer at least a reasonably realistic speed even on slow machines and I know ODE can handle that if only I could figure how to tweak it. <br><br></td></tr></table><br>
<a name="565687"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#120">[#120]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have a solution to your problem, I'll go get and example.<br>The two examples below are time based and will solve your issues of running too fast on faster machines. <br><br></td></tr></table><br>
<a name="565689"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#121">[#121]</a></td></tr></table></td></tr><tr ><td class="posttext"> <textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #								JV-ODE - Pyramid Destruction IV Demo								#
; #									Jim Williams (VIP3R) and Wayne Gray								#
; ###################################################################################################

AppTitle "JV-ODE - Pyramid Destruction IV"

Include "JV-ODE.bb"

Graphics3D 800,600,32,2
HidePointer


Global ElapsedTime
Global LastTime
Global FrameCount
Global Frames
Global Time

Global cflag
Global Proj
Global Projbody
Global snd1
Global snd2
Global piv1

Global Planet$
Global gx

Global Wide=10  ; Number of blocks wide at the base, default 10
Global Gap#=8  ; Gap spacing, default 8
Global RBW#=5  ; Real block width, default 5
			
piv1=CreatePivot()

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

; create a blank image 
gfxBlank=CreateImage (256,256) 


; ###################################################################################################

; ### Setup ODE

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,-1.0,0)

Planet="Earth"
gx=1

dWorldSetERP(World,0.4)
dContactSetMode(dContactBounce)
dContactSetBounce(0.0)
dContactSetMu(80)

; High Performance Settings
; Causes objects to settle down and sleep faster
dWorldSetAutoDisableLinearThreshold (World, .1)
dWorldSetAutoDisableAngularThreshold (World, .1)
dWorldSetAutoDisableSteps (World,10)
dContactSetMaxContacts(16)
dWorldSetQuickStepNumIterations (World,20) ; default 20

; ### Create light

Global Light=CreateLight()

RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera

Global Camera=CreateCamera()

CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000
PositionEntity Camera,30,25,-100
RotateEntity Camera,15,0,0

; Create first camera 
Global cam1=CreateCamera() 
; Set the first camera's viewport so that it fills the top half of the camera 
CameraViewport cam1,GraphicsWidth()-256,0,256,256 


; ### Load sounds
snd1=Load3DSound("media\Impact.wav")
snd2=LoadSound("media\whizz.wav")

SoundVolume snd2,.2

mic1=CreateListener(camera,.3,1,1) ; Create listener, make it child of camera 

; ### Create plane

dCreatePlane(Space,0,1,0,0)

Plane=CreatePlane()

EntityAlpha Plane,0.8

PlaneTexture=CreateTexture(128,128,9)

ClsColor 0,200,80
Cls

Color 255,255,255

Rect 0,0,64,64,1
Rect 64,64,64,64,1

CopyRect 0,0,128,128,0,0,BackBuffer(),TextureBuffer(PlaneTexture)
ScaleTexture PlaneTexture,20,20
EntityTexture Plane,PlaneTexture,0,0

Mirror=CreateMirror()

; Construct pyramid

For j#=wide To 1 Step -1
	For k#=1 To j
		AddObject(k#*Gap+(wide-j#)*Gap/2,RBW/2 + (wide-j#)*RBW)
		bcount=bcount+1
	Next
Next
		
addProjectile(EntityX(camera),EntityY(camera),EntityZ(camera))

		

; ###################################################################################################

While Not KeyHit(1)

UpdateControls()

; Calculate Time 
If T=0 Then T=MilliSecs()
T=MilliSecs() 

; Mouse Look code

; Poll Mouse Movement every 25ms ( 40/sec )
If T &gt; Time2 + 25 Then
	Time2=T
	mxs#=mxs#+(MouseXSpeed()-mxs#)/3
	mys#=mys#+(MouseYSpeed()-mys#)/3

	If MouseDown(2) Then 
		MoveMouse GraphicsWidth()/2,GraphicsHeight()/2
		p1#=p1#-mys#
		y1#=y1#-mxs#
		RotateEntity camera,-p1#,y1#,0
	EndIf
EndIf	

; Run Physics every 15ms ( 66/sec )
If T &gt; Time3 + 15 Then
	Time3=T	
	
	PTime=MilliSecs()

	UpdateGeoms()
	
	dSpaceCollide(Space,World,ContactGroup)
	
	UpdateSounds()
	
	dWorldQuickStep(World,.2)
	
	dJointGroupEmpty(ContactGroup)

	PhysicsTime#=MilliSecs()-PTime
End If

; Update missle cam image buffer every 66ms ( 15/sec )
If T &gt; Time4 + 66 Then
	Time4=T
	cam1_flag=True
Else
	cam1_flag=False
End If

	
	SetBuffer BackBuffer()
	
	If cam1_flag=False Then
		;Cls
		WireFrame False
		ShowEntity camera
		HideEntity cam1
		RenderWorld
		CopyRect 0,0,256,256,GraphicsWidth()-256,0,ImageBuffer(gfxBlank),BackBuffer()
		
		
	Else
		;save block cam image
		WireFrame False ; true to make wirefram missle cam
		HideEntity camera
		ShowEntity cam1
		RenderWorld
		CopyRect GraphicsWidth()-256,0,256,256,0,0,BackBuffer(),ImageBuffer(gfxBlank) 
		Cls
		ShowEntity camera
		HideEntity cam1
		WireFrame False
		RenderWorld
		CopyRect 0,0,256,256,GraphicsWidth()-256,0,ImageBuffer(gfxBlank),BackBuffer()

	EndIf
	
	Rect GraphicsWidth()-256,0,256,256,0
	
	Color 255,255,255
	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime
	Text 0,30,"FPS:"+Fps()
	Color 255,0,0
	Text 0,60,"P - Planet="+Planet
	Color 255,255,255
	Text 0,75,"LM - Pushes Object"
	Text 0,90, "RM - Mouse Look"
	Text 0,105, "R  - Reconstruct Pyramid"
	Text 0,120, "WSAD - Movement"
    Text 0,135, "K - Missle Cam"
	Text 0,150, "Space - Shoots"
	
	Text GraphicsWidth()/2-1,GraphicsHeight()/2,"[ ]"
	
	Flip  

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function AddObject(x#,height#)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)

dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,x,Height,0)

dBodySetAutoDisableFlag(ode\body,1)
mass=dMassCreate()
dMassSetBox(mass,1,5,5,5)
dMassSetBoxTotal(mass,20,5,5,5)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
ode\geom=dCreateBox(Space,5,5,5)
dGeomContactSetMode(ode\geom,dContactBounce)
dGeomContactSetBounce(ode\geom,0.0)
dGeomContactSetSoftERP(ode\geom,0.1)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,2.5,2.5,2.5
EntityColor ode\mesh,Rand(255),Rand(255),Rand(255)
EntityAlpha ode\mesh,1
EntityShininess ode\mesh,0.7

EntityPickMode ode\mesh,2 ; Make pickable

End Function

; ###################################################################################################

Function PosObject(x#,height#, body)

dBodyDisable(body)
dBodySetRotation(body,0,0,0)
dBodySetPosition(body,x,Height,0)
dBodySetLinearVel  (body, 0,0,0)
dBodySetAngularVel (body, 0,0,0)
dBodyEnable(body)

End Function

; ###################################################################################################

Function AddProjectile(X#,Y#,Z#)

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)

dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,x#,Y#,Z#)

dBodySetAutoDisableFlag(ode\body,1)
mass=dMassCreate()
dMassSetBox(mass,1,5,5,5)
dMassSetBoxTotal(mass,20,5,5,5)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
ode\geom=dCreateBox(Space,5,5,5)
dGeomContactSetMode(ode\geom,dContactBounce)
dGeomContactSetBounce(ode\geom,0.0)
dGeomContactSetSoftERP(ode\geom,0.1)
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,2.5,2.5,2.5
EntityColor ode\mesh,Rand(255),Rand(255),Rand(255)
EntityAlpha ode\mesh,1
EntityShininess ode\mesh,0.7

proj=ode\mesh ; ENTITY	
projbody=ode\body

End Function
; ###################################################################################################

Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
	If dBodyIsEnabled(ode\body)
		RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
		PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
	End If
Next

End Function

; ###################################################################################################

Function Fps()
Time=MilliSecs()

ElapsedTime=ElapsedTime+Time-LastTime
LastTime=Time
FrameCount=FrameCount+1

If ElapsedTime&gt;1000
	ElapsedTime=0
	Frames=FrameCount
	FrameCount=0
EndIf
Return Frames
End Function 

; ###################################################################################################

Function UpdateControls()

	If MouseDown(1)=1

	CameraPick(Camera,MouseX(),MouseY())
		If PickedEntity()
			For ode.ODEGeom=Each ODEGeom
				If ode\mesh=PickedEntity()
					dBodyEnable(ode\body)
					dBodyAddForce ode\body,-300*PickedNX#(),-300*PickedNY#(),-300*PickedNZ#()
				End If
			Next
		End If
	End If


	; Spacebar - Fire
	If KeyHit(57) Then
		dBodyDisable(Projbody)
		; Set projectile to match camera orientation
		dBodySetRotation(Projbody,EntityPitch(camera),EntityYaw(camera),EntityRoll(camera))
		dBodySetPosition(Projbody,EntityX(camera),EntityY(camera),EntityZ(camera))
		; Set projectile velocity and spin to zero
		dBodySetLinearVel  (Projbody, 0,0,0)
		dBodySetAngularVel (Projbody, 0,0,0)
		
		dBodyEnable(Projbody)
		dBodyAddRelForce(Projbody,0,0,2500)
		
		PlaySound snd2
	EndIf
	
	; Reconstruct pyramid
	If KeyDown(19) Then
		ode.ODEGeom=First ODEGeom
		
			; Construct pyramid
	
			For j#=wide To 1 Step -1
				For k#=1 To j
					PosObject(k#*Gap+(wide-j#)*Gap/2,RBW/2 + (wide-j#)*RBW,ode\body)

					ode = After ode
				Next
			Next
			
		
	End If
	
	; (K)amera
	If KeyHit(37) Then
		PositionEntity cam1,EntityX(proj),EntityY(proj),EntityZ(proj)
		RotateEntity cam1,EntityPitch(proj), EntityYaw(proj), EntityRoll(proj)
		EntityParent cam1,proj
	EndIf
	

	
; WSAD - Movement

; W- Forward
If KeyDown(17) Or KeyDown(200) Then
	MoveEntity camera,0,0,1
EndIf
; S- Reverse
If KeyDown(31) Or KeyDown(208) Then
	MoveEntity camera,0,0,-1
EndIf

; A- Left
If KeyDown(30) Or KeyDown(203) Then
	MoveEntity camera,-1,0,0
EndIf
; D- Right
If KeyDown(32) Or KeyDown(205) Then
	MoveEntity camera,1,0,0
EndIf

; G - Gravity
If KeyHit(25) Then
	gx=gx+1
	If gx&gt;4 Then gx=1
	Select gx
	  Case 1
		Planet="Earth "
		dWorldSetGravity(World,0,-1.0,0)
	
	  Case 2
		Planet="Mars"
		dWorldSetGravity(World,0,-.33333,0)

	  Case 3
		Planet="Moon"
		dWorldSetGravity(World,0,-.16666,0)
		
	  Case 4
		Planet="Space"
		dWorldSetGravity(World,0,0,0)
	End Select
	
EndIf


End Function

; ###################################################################################################

Function UpdateSounds()

For ode.ODEGeom=Each ODEGeom
	If dGeomIsEnabled(ode\geom)
		numjoints=dBodyGetNumJoints(ode\body)
		If numjoints&gt;0 
		
			For joints=0 To numjoints-1
				joint=dBodyGetJoint(ode\body,joints)
				If dJointGetType(joint)=dJointTypeContact
					
					; Get linear velocity vector
			  		ax#=dBodyGetLinearVelX#(ode\body)
			  		ay#=dBodyGetLinearVelY#(ode\body)
				    az#=dBodyGetLinearVelZ#(ode\body)
					; Get Angular velocity vector
			  		bx#=dBodyGetAngularVelX#(ode\body)
			  		by#=dBodyGetAngularVelY#(ode\body)
					bz#=dBodyGetAngularVelZ#(ode\body)
			  		; Calculate magnitudes
					ForceA#=Sqr(ax*ax+ay*ay+az*az)
					ForceB#=Sqr(bx*bx+by*by+bz*bz)
					
					;If ForceA&gt;.01
					;	LinearDamp(ode\body,.04)
					;End If
					
					If ForceA&gt;1.5
						PositionEntity piv1,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
						EmitSound(snd1,piv1)
					End If

					;If ForceB&gt;.01
					;	AngularDamp(ode\body,.06)
					;End If
					
				End If
			Next
		End If
	End If
Next

End Function
</textarea> <br><br></td></tr></table><br>
<a name="565690"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#122">[#122]</a></td></tr></table></td></tr><tr ><td class="posttext"> <textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
AppTitle "Time based Mouselook","Exit Program?"

Graphics3D 800,600,32,2

Global mxs#,mys#,p1#,y1# ; Mouselook globals
ShowPointer 

; Initialize Cam
camera=CreateCamera()
CameraZoom camera,1.5  ; Distortion free

; Elevate camera above the plane
MoveEntity camera,0,5,0

; ### Create light
Global Light=CreateLight()
RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; Create cube to view
cube=CreateCube()
EntityColor cube,255,0,0
; Elevate the cube to rest on plane
MoveEntity cube,0,1,0

; Create plane
Plane=CreatePlane()
EntityAlpha Plane,0.8
PlaneTexture=CreateTexture(128,128,9)
ClsColor 0,200,80
Cls
Color 255,255,255
Rect 0,0,64,64,1
Rect 64,64,64,64,1
CopyRect 0,0,128,128,0,0,BackBuffer(),TextureBuffer(PlaneTexture)
ScaleTexture PlaneTexture,20,20
EntityTexture Plane,PlaneTexture,0,0

; 
Mirror=CreateMirror()

; Move it away from camera 
MoveEntity cube,0,0,10

; Point cam at cube
PointEntity camera,cube

;----------------------------
; Game Loop
While Not KeyHit(1)

; Get the timer value
T=MilliSecs() 

; Mouse Look, every 25ms
Time1=mouselook(camera,T,Time1,25)

; Cube movement, every second aka 1000ms
Time2=MoveObj(cube,T,Time2,1000)

; Render the scene
RenderWorld

; Instructions
Text 0,0, "RM - Look"

; Flip frame buffer
Flip

Wend

;--------------------------------------------
; M O U S E L O O K
;
; Parms: 
; Cam   - Camera
; T     - Current timer
; Time1 - Last time event ran
; Freq  - How often in milliseconds this function runs
Function Mouselook(Cam,T,Time1,Freq)

If T &gt; Time1 + Freq Then
	Time1=T
	
	mxs#=mxs#+(MouseXSpeed()-mxs#)/3
	mys#=mys#+(MouseYSpeed()-mys#)/3

	If MouseDown(2) Then 

		MoveMouse GraphicsWidth()/2,GraphicsHeight()/2
		p1#=p1#-mys#
		y1#=y1#-mxs#
		RotateEntity cam,-p1#,y1#,0
	EndIf
EndIf
Return Time1

End Function

;--------------------------------------------
; M O V E O B J
;
; Parms: 
; Ent    - Entity to move forward
; T      - Current timer
; Time1  - Last time event ran
; Freq   - How often in milliseconds this function runs
Function MoveObj(Ent,T,Time1,Freq)

If T &gt; Time1 + Freq Then
	Time1=T
	MoveEntity Ent,0,0,1
EndIf

Return Time1

End Function
</textarea> <br><br></td></tr></table><br>
<a name="566491"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#123">[#123]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the effort Wayne. I'm sidetracked with UI at the moment so haven't had chance to test it on el slowmo' computo though. <br><br></td></tr></table><br>
<a name="566783"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#124">[#124]</a></td></tr></table></td></tr><tr ><td class="posttext"> <b>JV-ODE Physics Wrapper V1.07 Released</b><br><br>Please check your inbox ;)<br><br>Firstly, thanks to all users who took the time to send me their preferred document format choices. For those who are curious, here are the results:<br><br>DOC/RTF: 15 %<br>HTML: 48 %<br>PDF: 25 %<br>CHM: 12 %<br><br>Version 1.07 now includes the 'JV-ODE Function Reference', you will find it in the docs folder. All of the functions available in JV-ODE are now documented. You will still need to use the official ODE documentation for the JV-ODE functions that are identical to their ODE equivalents, but the function reference will help guide you to the correct chapter containing this information. The functions unique to JV-ODE are all explained in more detail, including the JV-ODE vector functions and the ODE functions which are either not documented or differ slightly in use. The reference is completely hyper-linked, so you can click each function to find more information thoughout. I really hope it helps you all because it took many, many hours to build it.<br><br>There has also been a slight change in the dGeomPlaneGetParams() function and a bug fix for the dGeomGetAABBMin() and dGeomGetAABBMax() functions. Check the 'Version History.txt' for more info.<br><br>A new demo has also been added to show detailed collisions when using multiple spaces.<br><br>Don't forget to update your 'JV-ODE.decls' file too!<br><br>Cheers :) <br><br></td></tr></table><br>
<a name="566807"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sigi</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#125">[#125]</a></td></tr></table></td></tr><tr ><td class="posttext"> Great, thank You for the Update. I am really happy that i bought this.<br>Very good Support. <br><br></td></tr></table><br>
<a name="566841"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PsychicParrot</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#126">[#126]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wow! Thats some doc file! I don't envy you having to do all that. Thanks again for your hard work - JV-ODE is well worth the money and, even better, it's great to see you're so 'into' what you're doing here.<br><br>You're obviously completely committed to making a great ODE wrapper and looking after both it and 'us' ... and you're doin' a GREAT job :) <br><br></td></tr></table><br>
<a name="566865"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#127">[#127]</a></td></tr></table></td></tr><tr ><td class="posttext"> You're welcome and thanks to both for the compliments, it really means a lot ;)<br><br>Yeh, I think that's definitely the largest 'doc' I've ever written, it was up to 54 x A4 pages even before adding the html code. I thought it would never end :) <br><br></td></tr></table><br>
<a name="566892"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#128">[#128]</a></td></tr></table></td></tr><tr ><td class="posttext"> You should market this beyond just Blitz.  Go for the DBPro users. <br><br></td></tr></table><br>
<a name="566908"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#129">[#129]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've never used DBPro, Jedive tried to make a .dba(?) file for the DLL when it was at V1.00 but he didn't have much luck IIRC. What's involved and how does DBPro talk to DLLs, any idea? <br><br></td></tr></table><br>
<a name="566945"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SillyPutty</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#130">[#130]</a></td></tr></table></td></tr><tr ><td class="posttext"> great work VIP3R !!!<br><br>As for db pro, there is a Physics Expansion pack coming out for it. Not too sure when though, but soonish. <br><br></td></tr></table><br>
<a name="566961"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mark Judd</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#131">[#131]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks very much for the update.<br><br>Appreciate your hard work.<br><br>Funky Frank <br><br></td></tr></table><br>
<a name="567016"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mustang</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#132">[#132]</a></td></tr></table></td></tr><tr ><td class="posttext"> Grrrreat - thanks a bunch! Like said here before, I'm glad too that I bought this one... updates are "frequent", demos are great - and you even solved the trimesh thingy without giving up like most would have done and just faded away. Good job! I'm at work, but those docs sound like really usable addition. <br><br></td></tr></table><br>
<a name="567128"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#133">[#133]</a></td></tr></table></td></tr><tr ><td class="posttext"> You're welcome and thanks fellas, much appreciated :) <br><br></td></tr></table><br>
<a name="567145"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#134">[#134]</a></td></tr></table></td></tr><tr ><td class="posttext"> Waaaaa HAY! :) You da man! <br><br></td></tr></table><br>
<a name="567173"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#135">[#135]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hehe, cheers Cyg ;) <br><br></td></tr></table><br>
<a name="567333"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ricky Smith</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#136">[#136]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm using JV-ODE in an  application that is quite complex. It (the wrapper - not my app :)) has rock-like stability, is extremely flexible and is easy to implement.<br>Thanks for the update ! <br><br></td></tr></table><br>
<a name="567952"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Barton</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#137">[#137]</a></td></tr></table></td></tr><tr ><td class="posttext"> JV_ODE cannot automatic stoping the rolling Cylinder, although rolling resistance is fixed.<br><br>I have write a Funtion to stopping the rolling Cylinder. but the objects after this, always remain lay in movement and aren't deactivated. AutoDisable is on and Stop Parameter an 1.0 <br><br>why ode doesn't make this automatically if setting the parameter for rolling resistance &amp; mass ?<br><br>In Car-Demo also don't stop the rolling Cylinder . <br><br></td></tr></table><br>
<a name="567976"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#138">[#138]</a></td></tr></table></td></tr><tr ><td class="posttext"> No problem Smiff ;)<br><br>@Barton: It's most likely due to the settings you've applied to the cylinder (mass direction/friction etc). Which Car Demo did you mean? <br><br></td></tr></table><br>
<a name="568035"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Barton</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#139">[#139]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have the problem also without masses &amp; friction setting.<br><br>with Car-Demo I mean the example in JV_ODE. what must I change in Car demo so that the Cylinders stop ? <br><br></td></tr></table><br>
<a name="568086"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#140">[#140]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>I have the problem also without masses &amp; friction setting.<br> <br></div><br>You will, they're both zero by default.<br><br>All of the Car Demos have cylinders, that's why I asked which one you were referring to. Imagine that you have a cylinder made of a hard property (like glass or metal), now imagine your plane as an infinitely flat surface, also made of a hard property. If this cylinder was rolled upon this surface, would it come to a stop in real life? Probably but not for a long while. Now imagine the cylinder is made from a softer rubber, what would happen now when it was rolled? The point is, try to think about how these things would work in reality, after all ODE is a simulation of 'real' physics. The cylinders in the Car Demos can all be considered to have a hard surface, as their contact settings are at default values.<br><br>Besides the mass, try changing the contact friction, contact bounce, contact ERP and CFM values for your cylinder geoms and make their surface softer like rubber. <br><br></td></tr></table><br>
<a name="569560"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#141">[#141]</a></td></tr></table></td></tr><tr ><td class="posttext"> VIP3R,<br>I was simulating a huge pyramid with aprox 2,000 blocks at 20 fps on crap machine with crap video card and wanted to see if I could go higher. I used multipass rendering so I  didn't have blitz entity count slowdowns. When I try to add more I get a stack error. Do you have some stack options in ODE before you compile the DLL ? <br><br>Maybe I should just behave myself, post the mamath, and be content with 2000 physics objects.<br><br>8) <br><br></td></tr></table><br>
<a name="569574"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#142">[#142]</a></td></tr></table></td></tr><tr ><td class="posttext"> 2000 is a lot! I think in the rope demo i was getting maybe 200 with big slowdown. <br><br></td></tr></table><br>
<a name="569612"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Barton</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#143">[#143]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have tested everything now. The Cylinder still infinitely roll further.<br><br>i have set the World ERP/CFM/Mass (Values 0.1-100 tested)<br>where can I adjust the friction?<br><br>i have coded a Funtion to stop the Clinders (LinerAngular - friction#). but this isn't good solution.<br><br>perhaps does anybody have an example? <br><br></td></tr></table><br>
<a name="569653"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#144">[#144]</a></td></tr></table></td></tr><tr ><td class="posttext"> To prevent roll I use Wayne's example for angular friction<br><br><pre class=code>
For ode.ODE_object=Each ODE_object
   If ode\body
      If dBodyIsEnabled(ode\body)
         numjoints=dBodyGetNumJoints(ode\body)
         If numjoints&gt;0      ; If joined to another body
            For joints=0 To numjoints-1
               ; for all joints attached to body...
               joint=dBodyGetJoint(ode\body,joints)
               If dJointGetType(joint)=dJointTypeContact   ; If joint type is a collision contact
                  ; Get Angular velocity vector
                  bx#=dBodyGetAngularVelX#(ode\body)
                  by#=dBodyGetAngularVelY#(ode\body)
                  bz#=dBodyGetAngularVelZ#(ode\body)
                  ; Calculate magnitudes
                  ForceB#=Sqr(bx*bx+by*by+bz*bz)
                  If forceb&gt;.01
                     friction#=ode\mat\rotational_friction*-1.0
                     dBodyAddTorque ode\body,dBodyGetAngularVelX(ode\body)*friction,dBodyGetAngularVelY(ode\body)*friction,dBodyGetAngularVelZ(ode\body)*friction
                  End If
               End If
            Next
         EndIf
      EndIf
   EndIf
Next</pre> <br><br></td></tr></table><br>
<a name="569774"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#145">[#145]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>Do you have some stack options in ODE before you compile the DLL ?<br> <br></div><br>No, the stack size isn't modified. Are you using dWorldQuickStep()? The other function dWorldStep() makes heavy use of the stack and is much more likely to overload it. I'll keep an eye on this though, thanks for the info ;)<br><br><div class="quote"> <br>Maybe I should just behave myself<br> <br></div><br>Hehe, you should indeed :)<br><br><div class="quote"> <br>i have set the World ERP/CFM/Mass (Values 0.1-100 tested)<br>where can I adjust the friction?<br> <br></div><br>Those are the world contact settings which are not the ones I suggested earlier, you should be changing the contact values of the cylinder <b>geoms</b> ;)<br><br>Look at your JV-ODE Function Reference document and read through the 'Unique JV-ODE Functions &gt; Collision Functions' section. You need to use these:<br>dGeomContactSetMode(geom,mode) ; &lt;&lt; You MUST set this for these to work properly<br>dGeomContactSetMu(geom,mu#) ; Friction<br>dGeomContactSetBounce(geom,bounce#) ; Bounce<br>dGeomContactSetSoftERP(geom,erp#) ; ERP<br>dGeomContactSetSoftCFM(geom,cfm#) ; CFM<br><br>Or you can damp the velocity instead like the code snippet above does (thanks Wayne &amp; Shifty). <br><br></td></tr></table><br>
<a name="572841"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#146">[#146]</a></td></tr></table></td></tr><tr ><td class="posttext"> How can I set the mass of an ODE_mass object once created?<br><br>I use ...<br><br>dMassSetBox(obj\mass,obj\mat\density, obj\siz\x, obj\siz\y, obj\siz\z)<br><br>...When I create my box, but I want to be able to change it's weight. I've tried...<br><br>dMassAdjust(obj\mass, 999.0)<br><br>...and ...<br><br>dMassSetBoxTotal(obj\mass,999.0, obj\siz\x, obj\siz\y, obj\siz\z)<br><br>...but object mass remains unchanged. <br><br></td></tr></table><br>
<a name="572874"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#147">[#147]</a></td></tr></table></td></tr><tr ><td class="posttext"> Do you mean you want to change the existing mass of an object?<br><br>If so, have you destroyed the mass structure? If you want to change a mass later on, don't destroy it until access to it is no longer needed. <br><br></td></tr></table><br>
<a name="572913"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#148">[#148]</a></td></tr></table></td></tr><tr ><td class="posttext"> No I haven't tried destroying and replacing. I was imagining I could just change the weight of an already existing ODE mass object.<br><br>There doesn't appear to be a function to delete a mass object (dMassDestroy) either. <br><br></td></tr></table><br>
<a name="572932"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#149">[#149]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can, it would've really helped if I had some code to go on, even just a snippet :)<br><br>I suspect you haven't applied the new mass to the body with the dBodySetMass() function after altering the mass properties.<br><br>Modified Car Demo showing change of existing mass structure...<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #										  JV-ODE Car Demo											#
; #									Code by Jim Williams (VIP3R)									#		#
; #						Feel free to use this code, any credit appreciated							#
; ###################################################################################################

AppTitle "JV-ODE Car Demo"

Include "JV-ODE.bb"

Graphics3D 800,600,0,2

Global CMass#=200			; ### Car Mass
Global CMass2#=2000			; ### Car Mass 2
Global WMass#=8				; ### Wheel Mass

Global MassStructure

Global WorldERP#=1			; ### World Error Correction
Global WorldFriction#=64	; ### World Friction
Global HingeTorque#=24		; ### Hinge Torque
Global SuspensionHS#=0.01	; ### Hinge Suspension Hardness/Softness (Higher=Softer - Lower=Harder)

Global Speed#=0
Global Steer#=0

Global Car
Global CGeom
Global CMesh

Global CarStartY=20

Dim Wheel(4)
Dim WGeom(4)
Dim Joint(4)

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

; ###################################################################################################

; ### Setup ODE

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,-0.98,0)
dWorldSetERP(World,WorldERP)

dContactSetMode(dContactSlip1)
dContactSetMu(WorldFriction)

; ### Create car body

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
Car=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,0,CarStartY,0)
MassStructure=dMassCreate()
dMassSetBox(MassStructure,1,3,1,4)
dMassSetBoxTotal(MassStructure,CMass,3,1,4)
dMassTranslate(MassStructure,0,-1,0)
dBodySetMass(ode\body,MassStructure)
ode\geom=dCreateBox(Space,3,1,4)
CGeom=ode\geom
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
CMesh=ode\mesh
ScaleMesh ode\mesh,1.5,0.5,2
RotateMesh ode\mesh,0,0,0
PositionMesh ode\mesh,0,0,0
EntityColor ode\mesh,40,80,255
EntityAlpha ode\mesh,1

; ### Create wheels

For count=1 To 4
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	Wheel(count)=ode\body
	dBodySetRotation(ode\body,0,0,0)
	dBodySetPosition(ode\body,0,0,0)
	mass=dMassCreate()
	dMassSetSphere(mass,1,0.7)
	dMassSetSphereTotal(mass,WMass,0.7)
	dBodySetMass(ode\body,mass)
	dMassDestroy(mass)
	ode\geom=dCreateSphere(Space,0.7)
	WGeom(count)=ode\geom
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder(8)
	ScaleMesh ode\mesh,0.7,0.25,0.7
	RotateMesh ode\mesh,0,0,90
	PositionMesh ode\mesh,0,0,0
	EntityColor ode\mesh,255,255,255
Next

dBodySetPosition(Wheel(1),-2,CarStartY-0.5,+2)
dBodySetPosition(Wheel(2),+2,CarStartY-0.5,+2)
dBodySetPosition(Wheel(3),-2,CarStartY-0.5,-2)
dBodySetPosition(Wheel(4),+2,CarStartY-0.5,-2)

; ### Create some objects

SeedRnd MilliSecs()

For spheres=1 To 20
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	dBodySetRotation(ode\body,0,0,0)
	dBodySetPosition(ode\body,Rnd(-100,100),30,Rnd(-100,100))
	ode\geom=dCreateSphere(Space,4)
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateSphere()
	ScaleMesh ode\mesh,4,4,4
	RotateMesh ode\mesh,0,0,0
	PositionMesh ode\mesh,0,0,0
	EntityColor ode\mesh,Rnd(255),Rnd(255),Rnd(255)
	EntityAlpha ode\mesh,1
	EntityShininess ode\mesh,0.7
Next

For cylinders=1 To 20
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	dBodySetRotation(ode\body,90,0,0)
	dBodySetPosition(ode\body,Rnd(-100,100),30,Rnd(-100,100))
	ode\geom=dCreateCCylinder(Space,1,8)
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder(8)
	ScaleMesh ode\mesh,1,5,1
	RotateMesh ode\mesh,90,0,0	; &lt;&lt;&lt; Mesh X-Axis must be rotated 90 degrees to fix cylinder alignment
	PositionMesh ode\mesh,0,0,0
	EntityColor ode\mesh,Rnd(255),Rnd(255),Rnd(255)
	EntityAlpha ode\mesh,1
	EntityShininess ode\mesh,0.7
Next

; ### Create light

Global Light=CreateLight()

RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera

Global CameraPivot=CreatePivot(CMesh)
PositionEntity CameraPivot,0,2,-7

Global Camera=CreateCamera()
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000

; ### Create plane

dCreatePlane(Space,0,1,0,0)

Plane=CreatePlane()

EntityAlpha Plane,0.8

PlaneTexture=CreateTexture(128,128,9)

ClsColor 0,200,80
Cls

Color 255,255,255

Rect 0,0,64,64,1
Rect 64,64,64,64,1

CopyRect 0,0,128,128,0,0,BackBuffer(),TextureBuffer(PlaneTexture)
ScaleTexture PlaneTexture,20,20
EntityTexture Plane,PlaneTexture,0,0

Mirror=CreateMirror()

; ###################################################################################################

; ### BLITZ STATIC OBJECT (White)

blitzobject=CreateCube()
ScaleMesh blitzobject,1,4,20
RotateMesh blitzobject,-10,8,4
PositionMesh blitzobject,10,5,40

EntityColor blitzobject,255,255,255
EntityAlpha blitzobject,1

; ### ODE STATIC OBJECT (Blue)

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,2,8,40)
dGeomSetRotation(ode\geom,-10,8,4)
dGeomSetPosition(ode\geom,20,5,40)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,1,4,20
RotateMesh ode\mesh,0,0,0
PositionMesh ode\mesh,0,0,0

EntityColor ode\mesh,0,100,200
EntityAlpha ode\mesh,1

; ### ODE STATIC OBJECT (Red)

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,18,0.2,40)
dGeomSetRotation(ode\geom,-14,0,0)
dGeomSetPosition(ode\geom,-20,4.9,40)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,9,0.1,20
RotateMesh ode\mesh,0,0,0
PositionMesh ode\mesh,0,0,0

EntityColor ode\mesh,200,0,100
EntityAlpha ode\mesh,1

; ###################################################################################################

SetupCar()

While Not KeyHit(1)

	UpdateKeys()

	PTime=MilliSecs()

	UpdateCar()

	UpdateGeoms()

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)

	PhysicsTime#=MilliSecs()-PTime

	UpdateCam()

	UpdateWorld

	RenderWorld

	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime
	Text 0,30,"Car Speed:"+Speed
	Text 640,0,"A - Accelerate"
	Text 640,15,"Z - Brake/Reverse"
	Text 640,30,"Arrows - Steering"
	Text 640,45,"Space - Reset Car"

	Text 0,70,"F1 - Toggle Car Mass"

	If KeyHit(59)
		masschange=Not masschange
		If masschange=0
			dMassAdjust(MassStructure,CMass) ; ### OR dMassSetBoxTotal(MassStructure,CMass,3,1,4)
			dBodySetMass(Car,MassStructure)
			Else
			dMassAdjust(MassStructure,CMass2) ; ### OR dMassSetBoxTotal(MassStructure,CMass2,3,1,4)
			dBodySetMass(Car,MassStructure)
			End If
		End If

	Flip

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function SetupCar()

For count=1 To 4
	Joint(count)=dJointCreateHinge2(World,0)
	dJointAttach(Joint(count),Car,Wheel(count))
	dJointSetHinge2Anchor(Joint(count),dBodyGetPositionX(Wheel(count)),dBodyGetPositionY(Wheel(count)),dBodyGetPositionZ(Wheel(count)))
	dJointSetHinge2Axis1(Joint(count),0,1,0)
	dJointSetHinge2Axis2(Joint(count),-1,0,0)
	dJointSetHinge2Param(Joint(count),dParamSuspensionERP,0.8)
	dJointSetHinge2Param(Joint(count),dParamSuspensionCFM,SuspensionHS)
	If count&gt;2
		dJointSetHinge2Param(Joint(count),dParamLoStop,0)
		dJointSetHinge2Param(Joint(count),dParamHiStop,0)
		End If
Next

Speed=0

End Function

; ###################################################################################################

Function UpdateKeys()

If KeyDown(30)=1
	Speed=Speed+0.08
	If Speed&gt;30 Then Speed=30
	End If

If KeyDown(44)=1
	Speed=Speed-0.1
	If Speed&lt;-10 Then Speed=-10
	If Speed&gt;0 Then Speed=Speed*0.97
	End If

If KeyDown(30)=0 And KeyDown(44)=0 Then Speed=Speed*0.99

If KeyDown(203)=1 Or KeyDown(205)=1
	If KeyDown(203)=1
		Steer=0.5
		Else
		Steer=-0.5
		End If
	Else
	Steer=0
	End If

If KeyHit(57)=1
	Speed=0
	dBodySetRotation(Car,0,0,0)
	End If

End Function

; ###################################################################################################

Function UpdateCar()

For count=1 To 4
	dBodyEnable(Wheel(count))
Next

dBodyEnable(Car)

For count=1 To 4
	dJointSetHinge2Param(Joint(count),dParamVel2,Speed)
	dJointSetHinge2Param(Joint(count),dParamFMax2,HingeTorque)
Next

For count=1 To 2
	angle#=Steer-dJointGetHinge2Angle1(Joint(count))
	dJointSetHinge2Param(Joint(count),dParamVel,angle)
	dJointSetHinge2Param(Joint(count),dParamFMax,400)
Next

End Function

; ###################################################################################################

Function UpdateCam()

PositionEntity CameraPivot,0,3,-12

camx#=EntityX(CameraPivot,1)-EntityX(Camera)
camy#=EntityY(CameraPivot,1)-EntityY(Camera)
camz#=EntityZ(CameraPivot,1)-EntityZ(Camera)

TranslateEntity Camera,camx*0.5,camy*0.5,camz*0.5

PointEntity Camera,CMesh

End Function

; ###################################################################################################

Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
	RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
	PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
Next

End Function

; ###################################################################################################
</textarea><br><br><div class="quote"> <br>There doesn't appear to be a function to delete a mass object (dMassDestroy) either.<br> <br></div><br>There is indeed, not only is it in JV-ODE but it's also described in the new docs ;) <br><br></td></tr></table><br>
<a name="576976"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#150">[#150]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for that VIP3R. Just returned to this after some UI work and I see it's just a matter of reassigning the mass object to the body. <br><br></td></tr></table><br>
<a name="580274"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#151">[#151]</a></td></tr></table></td></tr><tr ><td class="posttext"> What's the best way to disable &amp; enable a geom from being involved in collisions? I've got several objects that I want to introduce into the simulation over time. I'll set the entities to invisible so the inactive objects can't be seen, but I also need to set the bodies as not being collidable. One solution is to only create the collision geometry when I want the object to appear into the simulation. Is another to move the object into different spaces, or is that not possible? I couldn't find any suitable command other than dBodyEnable/Disable which is overridden when another geomertry collides with the disabled geometry.<br><br>checking the docs again, can I use dSpaceRemove and dSpaceAdd without 'damaging' my objects? Can I create my objects in ODE_Space, use dSpaceRemove() to keep the objects but remove them from active ODE_Space, and then when needed just call dSpaceAdd() to place them back into the active space? <br><br></td></tr></table><br>
<a name="580298"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#152">[#152]</a></td></tr></table></td></tr><tr ><td class="posttext"> No worries! I've got that working. I create the simulated objects geom's without assigning them to any space at creation time, and disable gravity for the body. At the appropriate time to introduce an object I simply add it to ODE_Space() and dBodySetGravityMode(body, true). Pretty straightforward. <br><br></td></tr></table><br>
<a name="582220"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#153">[#153]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm told dSubGeomCountCollisions() doesn't exist. It compiles fine but at runtime the userlib function isn't found.<br><br>I'm trying to set up responses between geoms in different spaces using<br><pre class=code>
If dBodyIsEnabled(temp\body)
   numCollisions=dSubGeomCountCollisions(temp\geom)
   If numCollisions&gt;0
      ; For each collision, test if with ground
      For n=1 To numCollisions
         collision_geom=dSubGeomCollisionGeom(temp\geom,n)
         If collision_geom=ODE_object_list\head\geom
            a=ODE_object_list\head\geom
            ; Just a test stop point to check if the collision is being detected correctly
         EndIf
      Next
   EndIf
EndIf</pre> <br><br></td></tr></table><br>
<a name="582422"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#154">[#154]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm, that's an odd one Shifty.<br><br>Can you check to make sure that 'temp\geom' exists and that your 'JV-ODE.decls' file is the most recent, it should be date stamped 07/09/2005 08:40<br><br>Also, can you run the 'CarDemo-DetailedC-MS.bb' demo and see if that works ok.<br><br>Let me know your results, cheers ;) <br><br></td></tr></table><br>
<a name="582631"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#155">[#155]</a></td></tr></table></td></tr><tr ><td class="posttext"> My bad. Hadn't installed the latest JV-ODE! <br><br></td></tr></table><br>
<a name="582828"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#156">[#156]</a></td></tr></table></td></tr><tr ><td class="posttext"> Friction's being very awkward. I've a mesg surface with Mu=100, and a sphere of Mu=10 that rolls down ramp onto the table. <br><br>The ball slides, not rolls to the end of the table. Near the end it starts sliding right over left instead of back over front like a real rolling ball would. When it hits a wall (part of the same table mesh), it spins really quickly almost on the spot. It doesn't get traction with the ground. Setting the sphere's Mu to 100 for MORE friction, when it hits the wall it starts spinning faster and faster and then disappears through the table.<br><br>I can't get a turning sphere to get traction with a table. <br><br></td></tr></table><br>
<a name="583044"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#157">[#157]</a></td></tr></table></td></tr><tr ><td class="posttext"> Currently researching this and I think I see where to fix it. The problem is with masses, and mu needs to be set much higher than mass. 10000x even for perfect friction. The difficulty is in setting partial frictions like 50%, which are logarithmically related to mu.<br><br>In several more hours I'll probably have cracked it. <br><br></td></tr></table><br>
<a name="583086"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#158">[#158]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeh, as you've discovered the mass is extremely important with regards to friction. An object with even an infinite amount of friction will not behave as such if the object has very little or no mass, the two are closely related. You should find that increasing the mass (without increasing the friction) will have a similar effect to increasing the friction (but not the mass), but on a different scale.<br><br>Please post you're findings Shifty, I'm sure it will be very useful and interesting information ;) <br><br></td></tr></table><br>
<a name="583591"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#159">[#159]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay, here's my research so far. Dunno how much use it'll be as it seems much of ODE's use can be applied without using about masses and many people don't bother with them, but here it is none the less.<br><br>As a starting point I took the car demo (which works without any of the complexities of my main program) and grabbed one of it's spheres. I applied rotational velocity to it dBodySetAngularVel() and due to friction it span off into the distance, where I quickly jumped into my virtual motorcar and followed it - whizz!<br><br>I then assigned the sphere some mass (mass=1.0) and it just started spinning on the spot when the rotational velocity was added. Friction was the standard world friction of 64. I dropped the mass weight from 1 to 0.01 and the sphere showed traction, and with more experimenting I found a relationship between mass and friction where for absolute friction, you need a mu of 10000x the mass.<br><br>I changed my code to incorporate this, setting mu to 10000*mass and as I changed the mass from 0.01 to 10, the sphere maintained absolute friction. To make sure my experiments were valid I set the world friction to 0, so the floor had zero friction. (Note that the value of mu for the contact joint is the mean average of the two geoms, so the real value of mu for the joint is half the geom's set mu.)<br><br>Application of Wayne's counter force for slowdown was now working properly (though as implemented it doesn't scale according to energies which is easily fixed), but the problem arises as to how to set an object's friction in terms of something useful? Ideally I'd like a percentage 100% = absolute friction, 0% = no friction. Experiments showed mu=mass*10000 was absolute friction, and mu=mass*1 was no friction. What I took to be half friction was mu=mass*1000, mass*100 was 10% friction, and mass*10 was 1% friction. These aren't accurate figures but just observations. What I eventually worked out was to use logarithms and a gamma curve to specify the relation between a 0-100 range and how much friction changes.<br><br>Here's working code, and it's working just how I wanted.<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Include "JV-ODE.bb"

Graphics3D 800,600,0,2

Global WorldERP#=0.5			; ### World Error Correction
Global WorldFriction#=0			; ### World Friction

Global SpaceInfo=0

Global Pointer
Global PlaneGeom

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

; ###################################################################################################

; ### Setup ODE

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global GroundSpace=dHashSpaceCreate(Space)
Global ObjSpace=dHashSpaceCreate(Space)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,-0.98,0)
dWorldSetERP(World,WorldERP)

dContactSetMode(dContactSlip1)
dContactSetMu(WorldFriction)

; ### Create light
Light=CreateLight()
RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera
Camera=CreateCamera()
PositionEntity Camera,-10,10,-10
RotateEntity Camera,20,0,0
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000

; ### Create plane
PlaneGeom=dCreatePlane(GroundSpace,0,1,0,0)
Plane=CreatePlane()
EntityAlpha Plane,0.8
PlaneTexture=CreateTexture(128,128,9)
ClsColor 0,200,80
Cls
Color 255,255,255
Rect 0,0,64,64,1
Rect 64,64,64,64,1
CopyRect 0,0,128,128,0,0,BackBuffer(),TextureBuffer(PlaneTexture)
ScaleTexture PlaneTexture,20,20
EntityTexture Plane,PlaneTexture,0,0

; ### Create some objects
	GRAVITY_ENABLED=True
	SPHERE_SIZE#=2.0
	SPHERE_MASS#=0.01
	SPHERE_FRICTION#=100
	gamma#=0.5
	
frict#=SPHERE_FRICTION/100
frict=frict^gamma
frict=frict*4
frict=4-frict
e#=Log10(SPHERE_MASS*10000)
e=e-frict

sphere_ode.ODEGeom=New ODEGeom
	sphere_ode\body=dBodyCreate(World)
	dBodySetRotation(sphere_ode\body,0,0,0)
	dBodySetPosition(sphere_ode\body,0,10,10)
	sphere_ode\geom=dCreateSphere(Space,SPHERE_SIZE)
	dGeomSetBody(sphere_ode\geom,sphere_ode\body)
	e=e
	dGeomContactSetMu(sphere_ode\geom,1*(10^e))
	mass=dMassCreate()
		dMassSetSphereTotal(mass,SPHERE_MASS,SPHERE_SIZE)
		dBodySetMass(sphere_ode\body,mass)
		dMassDestroy(mass)
	sphere_ode\mesh=CreateSphere()
	ScaleMesh sphere_ode\mesh,SPHERE_SIZE,SPHERE_SIZE,SPHERE_SIZE
	RotateMesh sphere_ode\mesh,0,0,0
	PositionMesh sphere_ode\mesh,0,0,0
	EntityColor sphere_ode\mesh,255,255,255
	EntityAlpha sphere_ode\mesh,1
	dBodySetGravityMode(sphere_ode\body,GRAVITY_ENABLED)

sphere_ode2.ODEGeom=New ODEGeom
	sphere_ode2\body=dBodyCreate(World)
	dBodySetRotation(sphere_ode2\body,0,0,0)
	dBodySetPosition(sphere_ode2\body,0,10,20)
	sphere_ode2\geom=dCreateSphere(Space,SPHERE_SIZE)
	dGeomSetBody(sphere_ode2\geom,sphere_ode2\body)
	dGeomContactSetMu(sphere_ode2\geom,10)
	mass=dMassCreate()
		dMassSetSphereTotal(mass,SPHERE_MASS,SPHERE_SIZE)
		dBodySetMass(sphere_ode2\body,mass)
		dMassDestroy(mass)
	sphere_ode2\mesh=CreateSphere()
	ScaleMesh sphere_ode2\mesh,SPHERE_SIZE,SPHERE_SIZE,SPHERE_SIZE
	RotateMesh sphere_ode2\mesh,0,0,0
	PositionMesh sphere_ode2\mesh,0,0,0
	EntityColor sphere_ode2\mesh,155,155,155
	EntityAlpha sphere_ode2\mesh,1
	dBodySetGravityMode(sphere_ode2\body,GRAVITY_ENABLED)

box_ode.ODEGeom=New ODEGeom
	box_ode\body=dBodyCreate(World)
	dBodySetPosition(box_ode\body,0,15,10)
	box_ode\geom=dCreateBox(Space,2,1,1)
	dGeomSetBody(box_ode\geom,box_ode\body)
	dGeomContactSetMu(box_ode\geom,100)
	mass=dMassCreate()
		dMassSetBoxTotal(mass,10,2,1,1)
		dBodySetMass(box_ode\body,mass)
		dMassDestroy(mass)
	box_ode\mesh=CreateCube()
	ScaleMesh box_ode\mesh,1,0.5,0.5
	RotateMesh box_ode\mesh,0,0,0
	PositionMesh box_ode\mesh,0,0,0
	EntityColor box_ode\mesh,155,255,155
	dBodySetGravityMode(box_ode\body,0)
	
While Not KeyHit(1)
	If KeyHit(210)	; Hit insert key
		dBodyEnable (sphere_ode\body)
		dBodySetAngularVel(sphere_ode\body,0,0,4)
;		dBodySetLinearVel(sphere_ode\body,-10,0,0)
		dBodyEnable (sphere_ode2\body)
		dBodySetAngularVel(sphere_ode2\body,0,0,4)
;		dBodySetLinearVel(sphere_ode2\body,-10,0,0)
		dBodySetGravityMode(box_ode\body,0)		; Change 0 to 1 to have box drop
		dBodyEnable (box_ode\body)
	EndIf
	
	; SLOW DOWN SPHERE CODE
				If dBodyIsEnabled(sphere_ode\body)
					numCollisions=dSubGeomCountCollisions(sphere_ode\geom)
					If numCollisions&gt;0
						; For each collision, test if with ground
						For n=1 To numCollisions
							collision_geom=dSubGeomCollisionGeom(sphere_ode\geom,n)
							If collision_geom=PlaneGeom
								; If hitting with the Floor
						  		bx#=dBodyGetAngularVelX(sphere_ode\body)
						  		by#=dBodyGetAngularVelY(sphere_ode\body)
								bz#=dBodyGetAngularVelZ(sphere_ode\body)
								dBodyAddRelTorque(sphere_ode\body,bx*-0.5,by*-0.5,bz*-0.5)
							EndIf
						Next
					EndIf
				EndIf
				If dBodyIsEnabled(sphere_ode2\body)
					numCollisions=dSubGeomCountCollisions(sphere_ode2\geom)
					If numCollisions&gt;0
						; For each collision, test if with ground
						For n=1 To numCollisions
							collision_geom=dSubGeomCollisionGeom(sphere_ode2\geom,n)
							If collision_geom=PlaneGeom
								; If hitting with the Floor
						  		bx#=dBodyGetAngularVelX(sphere_ode2\body)
						  		by#=dBodyGetAngularVelY(sphere_ode2\body)
								bz#=dBodyGetAngularVelZ(sphere_ode2\body)
								dBodyAddRelTorque(sphere_ode2\body,bx*-0.5,by*-0.5,bz*-0.5)
							EndIf
						Next
					EndIf
				EndIf
	; END SLOW DOWN SPHERE CODE

	For ode.ODEGeom=Each ODEGeom
		RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
		PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
	Next

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)

	UpdateWorld
	RenderWorld

	y=15
	Text 20,0,frict : y=y+15

	Flip

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End
</textarea><br>There's two spheres and a box. The rear grey sphere shows a fixed friction of 10 (something I used to think was a high value!) and the front white sphere shows mu relative to mass.<br><br>The current values set the sphere's masses low. When you un the program press the INSERT key to apply the rotational velocity. If you run as it is both have friction with the ground and pull away. The resistance forces are quite high in the sphere slowdown code so they come to a stop rather unrealisitically, but it's the friction we're concerned about with this experiment.<br><br>Now if you up the SPHERE_MASS# to 1.0, you see the problem with the grey sphere. It's lost traction. Wheras the white sphere acts exactly as before, only now with superior mass which affects forces and particularly collisions.<br><br>Another thing to change is SPHERE_FRICTION#. Set this to a percentage and the white sphere takes a while to gain traction. You can also apply backspan and see the friction work very realistically. Change the lines 136 and 137 to<br><br>   dBodySetAngularVel(sphere_ode\body,0,0,-4)<br>   dBodySetLinearVel(sphere_ode\body,-1,0,0)<br><br>Now depending on your friction value, the sphere will travel left but gradually slow and accelerate right. This behaviour is uniform regardless of the white sphere's mass because of the calculation for mu.<br><br>The last aspect to play around with is collisions with rigid bodies. Set GRAVITY_ENABLED to false and set lines 133-142 to<br><br><pre class=code>If KeyHit(210)	; Hit insert key
   dBodyEnable (sphere_ode\body)
   dBodySetAngularVel(sphere_ode\body,0,0,4)
  ;dBodySetLinearVel(sphere_ode\body,-1,0,0)
   dBodyEnable (sphere_ode2\body)
   dBodySetAngularVel(sphere_ode2\body,0,0,4)
  ;dBodySetLinearVel(sphere_ode2\body,-10,0,0)
   dBodySetGravityMode(box_ode\body,1)		; Change 0 to 1 to have box drop
   dBodyEnable (box_ode\body)</pre><br><br>Now when the INSERT key is hit, the spheres roll in mid air and the box drops on. By changing the sphere's friction and box's mass you can see how the force of the spinning sphere throws the box.<br><br>I've only tested this for spheres but the same principle should apply to other rigid bodies too. The caluation of mu can be easily ported to a function something like...<br><pre class=code>Function SetSphereFriction(geom.ODE_Geom, mass, friction)
   ; geom.ODE_Object : ODE geometry object
   ; mass : Object's mass
   ; friction : Ojects friction as percentage

   gamma=0.5	; Change for different relationship between percentage and friction
   frict#=SPHERE_FRICTION/100
   frict=frict^gamma
   frict=frict*4
   frict=4-frict
   e#=Log10(SPHERE_MASS*10000)
   e=e-frict
   dGeomContactSetMu(geom,1*(10^e))
End Function</pre><br>Where this solution is incomplete is in specifying the response to two different objects. Consider a sphere which you want to have absolute friction on the ground and a slide down which you'll send the sphere where you want to be able to set the friction. As an exmple the slide could be set to 0 friction so the sphere slides down without turning, but when the sphere hits the floor friction turns forward momentum into rotational velocity. Setting the sphere's friction to 100% will enforce absolute friction in all collisions, so the sphere will roll down the slide, not slip down it. There needs to be a way to set the interaction between objects to specify the result. In some cases we'll want the lowest value for friction to apply to both objects, in others the maximum. Actually I think this only really applies to static and animated objects. Where you have two animated objects the average is probably okay. As my current 'engine' works I have static bodies in their own seperate ODE space and for me I'd like to be able to specify friction response per static object. <br><br>As a final point it might be worth adding some features to the JV-ODE wrapper? For one you could have the friction function as an internal function. Perhaps dGeomSetFriction(geom,mass#,friction#). Dunno if people would find this useful or not. As another perhaps the collision responses could be given options, like the Restitution  was? Perhaps an option per contact joint to use either the lowest, average or highest mu of the two objects?<br><br>Anyhow I'd better finish this epic post at some point, so I'll finish it now! <br><br></td></tr></table><br>
<a name="583794"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#160">[#160]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wow, that's some great info you've posted Shifty, thanks! :)<br><br>It might be better to add the dGeomSetFriction function to the include file (or let the user add it themselves). There wouldn't be any real benefit if it were included inside the dll as the only improvement would be a slight speed gain, which isn't critical during setup of the geoms.<br><br>It shouldn't be much of a problem to add the 'use lowest value' option on the contact joints. I need to be careful though, as adding another option to the contact callback function could slow down the collision checking. I'll look into it for you ;) <br><br></td></tr></table><br>
<a name="583956"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#161">[#161]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nice work shifty. <br><br></td></tr></table><br>
<a name="583972"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#162">[#162]</a></td></tr></table></td></tr><tr ><td class="posttext"> Interestingly (or annoyingly, depending on how you look at it) the equation for determining sphere friction doesn't work for boxes. Where a sphere's friction ranges from 1x mass=0% friction, 10000x mass=100%, friction, for a box I've found 0.001xmass = 0% friction, 10x mass=100% friction. Also the gamma seems different, and a 0.75 value fits more comfortably than the 0.5 for the sphere going by my very rough observations.<br><br>Here's a function for determining and setting a boxes friction.<br><pre class=code>Function SetBoxFriction(geom.ODE_Geom, mass, friction#)
   ; geom.ODE_Object : ODE geometry object
   ; mass : Object's mass
   ; friction : Oject's friction as percentage

   gamma=0.75	; Change for different relationship between percentage and friction
   friction=friction/100
   friction=friction^gamma
   friction=friction*4
   friction=4-friction
   e#=Log10(SPHERE_MASS*10)
   e=e-friction
   dGeomContactSetMu(geom,1*(10^e))
End Function</pre><br>Strangely in testing it worked the same for all masses ranging from 0.001 to 1000, except for mass=100 where the box stopped slightly short! (??) Odd. Maybe this is one of those arbitary DirectX rounding changes in effect.<br><br>VIP3R : The addition to the include file makes sense. It's not a time critical function. Is there any convenient way to switch between two implementations, one with optional friction responses and one with static, short of providing two different .dlls? Otherwise it might be worth keeping a trimmed .dll without the extra functionality if it'll add a performance hit when most people don't need it. <br><br></td></tr></table><br>
<a name="583974"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#163">[#163]</a></td></tr></table></td></tr><tr ><td class="posttext"> I should also add that the slowdown code used on the sphere to stop it rolling forever isn't needed on the box which stops due to conventional friction. Indeed applying the Torque causes all sorts of strange bouncing! Really there's two different behaviours that need to be taken into account for boxes and spheres. Sphere's need rotational dampening per update and a different function for friction than boxes. Cylinders should work the same as spheres at a guess, but I'm not using them and haven't looked into it yet. <br><br></td></tr></table><br>
<a name="583995"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#164">[#164]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, I've worked out a method of doing the max/min/mean contact options without any further speed implications when using the default setting (mean). There will be a slight speed hit when using the max/min settings, but these are much slower anyway due to the amount of calculations performed each time step. The additional overhead by adding the min option shouldn't be noticeable.<br><br>I'll add it to the 2do for V1.08 ;) <br><br></td></tr></table><br>
<a name="585085"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Pax</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#165">[#165]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello, I'm working in a cannon ball simulator (really basic,pretty much to learn ODE commands). The thing I'm stuck with is that I want to be able to preview the path the cannon ball will follow (before shooting), any idea on how to do this? I've seen a pool game that allows previews of the ball trajectory, though not sure if they are just straight lines.<br>Thank you. <br><br></td></tr></table><br>
<a name="585098"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#166">[#166]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Pax, yeh pool games use simple reversed angles which are easy to implement. Working out a cannon ball trajectory is little more tricky, as there are several things to take into consideration like gravity, wind direction, air resistance, cannon balls weight/mass and the force used to shoot it from the cannon. You can work this out using some math, but it may not match exactly to the ODE simulation (which is what you would want ideally).<br><br>For best results, I would use ODE to work out the trajectory. Using this method will ensure that the actual ODE trajectory matches the previewed trajectory correctly.<br><br>What you need to do to achieve this is launch the cannon ball, and track (record) its trajectory/location at several intervals (maybe every 10 world steps?). But do not draw the cannon ball mesh when launching the ball, only track its location. You can use multiple spaces to prevent any collisions during the preview, or fire the cannon ball at a different location in your simulation (out of view).<br><br>Once you have tracked the previewed trajectory, you can use this data to highlight the path by placing spheres (or whatever object) at each location that you've recorded. <br><br></td></tr></table><br>
<a name="585204"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sigi</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#167">[#167]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br>is there a way todo a stretched Sphere for a FPS Game<br>(a small but long Sphere for the Player Collision).<br><br>I can see only one Parameter for: dCreateSphere(Space,0.7)<br>In B3D or the Newton Physic Engine i can use 2 Parameters for a Sphere as dCreateSphere(Space,0.7,1.0)<br><br>Thank You <br><br></td></tr></table><br>
<a name="585206"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KuRiX</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#168">[#168]</a></td></tr></table></td></tr><tr ><td class="posttext"> Not In ODE. You should use two spheres or one dccylinder... <br><br></td></tr></table><br>
<a name="585211"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#169">[#169]</a></td></tr></table></td></tr><tr ><td class="posttext"> A capped cylinder (dCCylinder as KuRiX mentioned) is essentially the same shape as a stretched sphere, its geometry is like a flat ended cylinder with a semi-sphere attached at each end. <br><br></td></tr></table><br>
<a name="585213"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sigi</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#170">[#170]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thank You both, will try it. <br><br></td></tr></table><br>
<a name="585410"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Topknot</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#171">[#171]</a></td></tr></table></td></tr><tr ><td class="posttext"> To VIP3R,<br><br>Thanks a Boat load..!  Purchased your JV-ODE package last night, well early morning lol, and haven't had any sleep due to being able to accomplish stuff I only beat my head against the keyboard before using straight Blitz3D.<br><br>First - off I would recommend this package to anyone wanting to experience a new way of "looking" and programming for Blitz3D.  <br><br>Second - Althou there's not a smooth guide to help someone discover the many facets of this Wrapper, it's still quite exciting.  <br><br>i've been gone from the B3D community for ages due to starting up a Gaming Center here in Florida, and doing Modeling and Coding work for a private gaming company that's creating a mod for Zero Hour.  But past to now and I dug up my B3D and found an old proggy of a acient Moto Bike style idea, but after taking the JV-ODE and spending a solid 16 hours I've now got a really fun to  tinker with beginnings of a MX - ATV style play toy.<br><br>Now to finish off this BOOK of a post, Thank you again for taking your time to actually produce a worth while item that I am happy to purchase.  The support I see seems most excellent and you actually take the time to work with peeps on problems.  To which I'll be jumping in and "pestering" you all soon enuff as things get beyond my grasp. ;)<br><br>Now to start whipping out some models to toss in and get this play toy looking better ;)<br><br>Topknot :) <br><br></td></tr></table><br>
<a name="585510"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#172">[#172]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey VIP3R. Big problematic problem I have encountered, which makes a bit of a mockery of all my friction investigations to date! I've been applying forces to spheres and boxes and getting different results. I've looked more closely and found the dMassSetSphere() and dMassSetSphereTotal() give different results, while setting a sphere's mass seems to set it differently to a box's mass.  Look at the following...<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Include "JV-ODE.bb"

Graphics3D 800,600,0,2

Global WorldERP#=0.8			; ### World Error Correction
Global WorldFriction#=0			; ### World Friction

Global SpaceInfo=0

Global Pointer
Global PlaneGeom

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

; ###################################################################################################

; ### Setup ODE

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global GroundSpace=dHashSpaceCreate(Space)
Global ObjSpace=dHashSpaceCreate(Space)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,-0.98,0)
dWorldSetERP(World,WorldERP)

dContactSetMode(dContactSlip1)
dContactSetMu(WorldFriction)

; ### Create light
Light=CreateLight()
RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera
Camera=CreateCamera()
PositionEntity Camera,-10,10,-10
RotateEntity Camera,20,0,0
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000

; ### Create plane
PlaneGeom=dCreatePlane(GroundSpace,0,1,0,0)
Plane=CreatePlane()
EntityAlpha Plane,0.8
PlaneTexture=CreateTexture(128,128,9)
ClsColor 0,200,80
Cls
Color 255,255,255
Rect 0,0,64,64,1
Rect 64,64,64,64,1
CopyRect 0,0,128,128,0,0,BackBuffer(),TextureBuffer(PlaneTexture)
ScaleTexture PlaneTexture,20,20
EntityTexture Plane,PlaneTexture,0,0

; ### Create some objects
	GRAVITY_ENABLED=True
	SIZE#=2.0
	DENSITY#=1.0
	FRICTION#=100.0
	gamma#=0.5

; Ode1 = Sphere with density based mass
ode1.ODEGeom=New ODEGeom
	ode1\body=dBodyCreate(World)
	dBodySetRotation(ode1\body,0,0,0)
	dBodySetPosition(ode1\body,-25,10,10)
	ode1\geom=dCreateSphere(Space,SIZE)
	dGeomSetBody(ode1\geom,ode1\body)
	dGeomContactSetMu(ode1\geom,0.0)
	mass=dMassCreate()
		dMassSetSphere(mass,DENSITY,SIZE)
		dBodySetMass(ode1\body,mass)
		dMassDestroy(mass)
	ode1\mesh=CreateSphere()
	ScaleMesh ode1\mesh,SIZE,SIZE,SIZE
	RotateMesh ode1\mesh,0,0,0
	PositionMesh ode1\mesh,0,0,0
	EntityColor ode1\mesh,255,255,255
	EntityAlpha ode1\mesh,1
	dBodySetGravityMode(ode1\body,GRAVITY_ENABLED)

; Ode2 = Sphere with total mass
; Mass of sphere = 3/4 Pi.r^3
SPHERE_MASS#=(3.141*(SIZE*SIZE*SIZE)*3)/4
ode2.ODEGeom=New ODEGeom
	ode2\body=dBodyCreate(World)
	dBodySetRotation(ode2\body,0,0,0)
	dBodySetPosition(ode2\body,-15,10,10)
	ode2\geom=dCreateSphere(Space,SIZE)
	dGeomSetBody(ode2\geom,ode2\body)
	dGeomContactSetMu(ode2\geom,0.0)
	mass=dMassCreate()
		dMassSetSphereTotal(mass,SPHERE_MASS,SIZE)
		dBodySetMass(ode2\body,mass)
		dMassDestroy(mass)
	ode2\mesh=CreateSphere()
	ScaleMesh ode2\mesh,SIZE,SIZE,SIZE
	RotateMesh ode2\mesh,0,0,0
	PositionMesh ode2\mesh,0,0,0
	EntityColor ode2\mesh,255,255,255
	EntityAlpha ode2\mesh,1
	dBodySetGravityMode(ode2\body,GRAVITY_ENABLED)

; Change Cube size to match Sphere's volume
SIZE=2.661175
; Ode3 = Cube with density based mass
ode3.ODEGeom=New ODEGeom
	ode3\body=dBodyCreate(World)
	dBodySetRotation(ode3\body,0,0,0)
	dBodySetPosition(ode3\body,-5,10,10)
	ode3\geom=dCreateBox(Space,SIZE,SIZE,SIZE)
	dGeomSetBody(ode3\geom,ode3\body)
	dGeomContactSetMu(ode3\geom,0.0)
	mass=dMassCreate()
		dMassSetBox(mass,DENSITY,SIZE,SIZE,SIZE)
		dBodySetMass(ode3\body,mass)
		dMassDestroy(mass)
	ode3\mesh=CreateCube()
	ScaleMesh ode3\mesh,SIZE/2,SIZE/2,SIZE/2
	RotateMesh ode3\mesh,0,0,0
	PositionMesh ode3\mesh,0,0,0
	EntityColor ode3\mesh,255,255,255
	EntityAlpha ode3\mesh,1
	dBodySetGravityMode(ode3\body,GRAVITY_ENABLED)

; Ode4 = Cube with total mass
; mass=x*y*z*density
CUBE_MASS#=SIZE*SIZE*SIZE*DENSITY

ode4.ODEGeom=New ODEGeom
	ode4\body=dBodyCreate(World)
	dBodySetRotation(ode4\body,0,0,0)
	dBodySetPosition(ode4\body,5,10,10)
	ode4\geom=dCreateBox(Space,SIZE,SIZE,SIZE)
	dGeomSetBody(ode4\geom,ode4\body)
	dGeomContactSetMu(ode4\geom,0.0)
	mass=dMassCreate()
		dMassSetBoxTotal(mass,CUBE_MASS,SIZE,SIZE,SIZE)
		dBodySetMass(ode4\body,mass)
		dMassDestroy(mass)
	ode4\mesh=CreateCube()
	ScaleMesh ode4\mesh,SIZE/2,SIZE/2,SIZE/2
	RotateMesh ode4\mesh,0,0,0
	PositionMesh ode4\mesh,0,0,0
	EntityColor ode4\mesh,255,255,255
	EntityAlpha ode4\mesh,1
	dBodySetGravityMode(ode4\body,GRAVITY_ENABLED)
	
While Not KeyHit(1)
	If KeyHit(210)	; Hit insert key
		dBodyEnable (ode1\body)
		dBodyEnable (ode2\body)
		dBodyEnable (ode3\body)
		dBodyEnable (ode4\body)
		dBodyAddForce(ode1\body,0,0,100)
		dBodyAddForce(ode2\body,0,0,100)
		dBodyAddForce(ode3\body,0,0,100)
		dBodyAddForce(ode4\body,0,0,100)
	EndIf
	
	For ode.ODEGeom=Each ODEGeom
		RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
		PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
	Next

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)

	UpdateWorld
	RenderWorld
	
	y=15
	Text 20,y,SPHERE_MASS : y=y+15
	Text 20,y,CUBE_MASS : y=y+15

	Flip

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End
</textarea><br>Press the insert key to apply a force of (0,0,100) to all four objects. There's no friction and they're all the same volume and the same mass in theory, so they should all move at the same speed.<br><br>Taking the boxes, they both work. They travel at the same speed though one has mass set with Total and the other by density. Looking at the first sphere, who's mass is set by density, it moves slower than the cubes. Thus it appears heavier. Looking at the second sphere who's mass is set by the Total method, it hardly moves at all. Assuming my maths isn't up the swanny and I'm calculating the total mass right<br><br>; Mass of sphere = 3/4 Pi.r^3<br>SPHERE_MASS#=(3.141*(SIZE*SIZE*SIZE)*3)/4<br><br>It should act exactly the same way as the first sphere. And given there's no friction, and all objects are supposed to have the same mass, and they all receive the same force, they should all move at a uniform speed, which means the sphere's should move the same as the cubes.<br><br>To me it looks like the sphere mass calculations are wrong. The SphereMassTotal set's the sphere's mass about 30x greater than it should be. <br><br></td></tr></table><br>
<a name="585652"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#173">[#173]</a></td></tr></table></td></tr><tr ><td class="posttext"> . <br><br></td></tr></table><br>
<a name="585691"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#174">[#174]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey Topknot, thanks for the kind comments it's very much appreciated and welcome back! :)<br><br>[edit] Removed incorrect info to prevent confusion - Use of both the dMassSetSphere() function and the dMassSetSphereTotal() function is not required, only one of these functions needs to be set. This applies to all geom mass set functions. Thanks to Shifty for clearing that up. <br><br></td></tr></table><br>
<a name="585854"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Topknot</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#175">[#175]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks VIP3R,<br><br>Now I would also have a question to all you "smarter than me peeps" ;).<br><br>In working on this little BAJA style proggy to get my hands dirty, I found odd things happen and trying to find answers.<br><br>1 - What I want to do it find the "real" speed or vel of the car instead of just accepting the "KeyDown" Forward results.  Meaning if you press down on the forward key to go forward of course it's gonna increase the Speed# variable no matter if you're in the Air, or spun out and standing still, the value is still maxed out.  What I'm trying to do is find the Actual movement speed of the 'Body' of the car..<br><br>2 - In working with loading up my own somewhat large "land mesh" to incorporate in addition to the "plane" can you only have one "trimesh" working at one given time, or is this an issue where using multi "spaces"/"worlds" comes into view.  Still trying to get my head around that ability from the few demos provided and reading the Forum messages.<br><br>3 - From what I was able to pick up reading thru hours of the ODE manual there Is a known issues when using say a car simulation in that if the whole entity's moving to fast the wheels start to get freaky.  Not I'm not asking to go Speed# = 100 or such, it's maxed out at 20 at the moment just to the point of getting nasty results, anything higher and the car looses stability and if you cut to hard in a turn you get (what should be locked) rear wheels going nutty and turning all over resulting in a very unstable and not to fun simulation lol.<br><br>4 - Sorry forgot one more item, in the Detail Demos you show the ability to "detect" what collision the wheels are at, for example "ground plane" or "red ramp" but what I'm trying to find out is when the entitiys in the "AIR" with no contact with any world items.  Again I am trying like crazy to wrap my head around the ODE doc's but due to it lacking any serious examples that "show" a property in work is frustrating.<br><br>Well there's my major issues and still plugging away on it.  Thanks for any help provided and again thanks VIP3R for a fun new Blitz3D experience to melt my brain on.<br><br>Topknot :) <br><br></td></tr></table><br>
<a name="585859"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#176">[#176]</a></td></tr></table></td></tr><tr ><td class="posttext"> You're welcome ;)<br><br>I can help you with those questions...<br><br>1 - You want the real velocity in 3D space, try this code...<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
; #										  JV-ODE Car Demo											#
; #									Code by Jim Williams (VIP3R)									#		#
; #						Feel free to use this code, any credit appreciated							#
; ###################################################################################################

AppTitle "JV-ODE Car Demo"

Include "JV-ODE.bb"

Graphics3D 800,600,0,2

Global CMass#=200			; ### Car Mass
Global WMass#=8				; ### Wheel Mass

Global WorldERP#=1			; ### World Error Correction
Global WorldFriction#=64	; ### World Friction
Global HingeTorque#=24		; ### Hinge Torque
Global SuspensionHS#=0.01	; ### Hinge Suspension Hardness/Softness (Higher=Softer - Lower=Harder)

Global Speed#=0
Global Steer#=0

Global Car
Global CGeom
Global CMesh

Global PrevPosPivot=CreatePivot()

Global PrevX#=0.0
Global PrevY#=0.0
Global PrevZ#=0.0

Global Velocity#=0.0

Global CarStartY=20

Dim Wheel(4)
Dim WGeom(4)
Dim Joint(4)

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

; ###################################################################################################

; ### Setup ODE

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,-0.98,0)
dWorldSetERP(World,WorldERP)

dContactSetMode(dContactSlip1)
dContactSetMu(WorldFriction)

; ### Create car body

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
Car=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,0,CarStartY,0)
mass=dMassCreate()
dMassSetBox(mass,1,3,1,4)
dMassSetBoxTotal(mass,CMass,3,1,4)
dMassTranslate(mass,0,-1,0)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
ode\geom=dCreateBox(Space,3,1,4)
CGeom=ode\geom
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
CMesh=ode\mesh
ScaleMesh ode\mesh,1.5,0.5,2
RotateMesh ode\mesh,0,0,0
PositionMesh ode\mesh,0,0,0
EntityColor ode\mesh,40,80,255
EntityAlpha ode\mesh,1

; ### Create wheels

For count=1 To 4
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	Wheel(count)=ode\body
	dBodySetRotation(ode\body,0,0,0)
	dBodySetPosition(ode\body,0,0,0)
	mass=dMassCreate()
	dMassSetSphere(mass,1,0.7)
	dMassSetSphereTotal(mass,WMass,0.7)
	dBodySetMass(ode\body,mass)
	dMassDestroy(mass)
	ode\geom=dCreateSphere(Space,0.7)
	WGeom(count)=ode\geom
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder(8)
	ScaleMesh ode\mesh,0.7,0.25,0.7
	RotateMesh ode\mesh,0,0,90
	PositionMesh ode\mesh,0,0,0
	EntityColor ode\mesh,255,255,255
Next

dBodySetPosition(Wheel(1),-2,CarStartY-0.5,+2)
dBodySetPosition(Wheel(2),+2,CarStartY-0.5,+2)
dBodySetPosition(Wheel(3),-2,CarStartY-0.5,-2)
dBodySetPosition(Wheel(4),+2,CarStartY-0.5,-2)

; ### Create some objects

SeedRnd MilliSecs()

For spheres=1 To 20
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	dBodySetRotation(ode\body,0,0,0)
	dBodySetPosition(ode\body,Rnd(-100,100),30,Rnd(-100,100))
	ode\geom=dCreateSphere(Space,4)
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateSphere()
	ScaleMesh ode\mesh,4,4,4
	RotateMesh ode\mesh,0,0,0
	PositionMesh ode\mesh,0,0,0
	EntityColor ode\mesh,Rnd(255),Rnd(255),Rnd(255)
	EntityAlpha ode\mesh,1
	EntityShininess ode\mesh,0.7
Next

For cylinders=1 To 20
	ode.ODEGeom=New ODEGeom
	ode\body=dBodyCreate(World)
	dBodySetRotation(ode\body,90,0,0)
	dBodySetPosition(ode\body,Rnd(-100,100),30,Rnd(-100,100))
	ode\geom=dCreateCCylinder(Space,1,8)
	dGeomSetBody(ode\geom,ode\body)
	ode\mesh=CreateCylinder(8)
	ScaleMesh ode\mesh,1,5,1
	RotateMesh ode\mesh,90,0,0	; &lt;&lt;&lt; Mesh X-Axis must be rotated 90 degrees to fix cylinder alignment
	PositionMesh ode\mesh,0,0,0
	EntityColor ode\mesh,Rnd(255),Rnd(255),Rnd(255)
	EntityAlpha ode\mesh,1
	EntityShininess ode\mesh,0.7
Next

; ### Create light

Global Light=CreateLight()

RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera

Global CameraPivot=CreatePivot(CMesh)
PositionEntity CameraPivot,0,2,-7

Global Camera=CreateCamera()
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000

; ### Create plane

dCreatePlane(Space,0,1,0,0)

Plane=CreatePlane()

EntityAlpha Plane,0.8

PlaneTexture=CreateTexture(128,128,9)

ClsColor 0,200,80
Cls

Color 255,255,255

Rect 0,0,64,64,1
Rect 64,64,64,64,1

CopyRect 0,0,128,128,0,0,BackBuffer(),TextureBuffer(PlaneTexture)
ScaleTexture PlaneTexture,20,20
EntityTexture Plane,PlaneTexture,0,0

Mirror=CreateMirror()

; ###################################################################################################

; ### BLITZ STATIC OBJECT (White)

blitzobject=CreateCube()
ScaleMesh blitzobject,1,4,20
RotateMesh blitzobject,-10,8,4
PositionMesh blitzobject,10,5,40

EntityColor blitzobject,255,255,255
EntityAlpha blitzobject,1

; ### ODE STATIC OBJECT (Blue)

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,2,8,40)
dGeomSetRotation(ode\geom,-10,8,4)
dGeomSetPosition(ode\geom,20,5,40)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,1,4,20
RotateMesh ode\mesh,0,0,0
PositionMesh ode\mesh,0,0,0

EntityColor ode\mesh,0,100,200
EntityAlpha ode\mesh,1

; ### ODE STATIC OBJECT (Red)

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,18,0.2,40)
dGeomSetRotation(ode\geom,-14,0,0)
dGeomSetPosition(ode\geom,-20,4.9,40)
ode\mesh=CreateCube()
ScaleMesh ode\mesh,9,0.1,20
RotateMesh ode\mesh,0,0,0
PositionMesh ode\mesh,0,0,0

EntityColor ode\mesh,200,0,100
EntityAlpha ode\mesh,1

; ###################################################################################################

SetupCar()

While Not KeyHit(1)

	UpdateKeys()

	PTime=MilliSecs()

	UpdateCar()

	UpdateGeoms()

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)

	PhysicsTime#=MilliSecs()-PTime

	UpdateCam()

	UpdateWorld

	RenderWorld

	CalcVelocity()

	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime
	Text 0,30,"Car Speed:"+Speed
	Text 640,0,"A - Accelerate"
	Text 640,15,"Z - Brake/Reverse"
	Text 640,30,"Arrows - Steering"
	Text 640,45,"Space - Reset Car"

	Text 0,100,"Car Velocity:"+Velocity

	Flip

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function SetupCar()

For count=1 To 4
	Joint(count)=dJointCreateHinge2(World,0)
	dJointAttach(Joint(count),Car,Wheel(count))
	dJointSetHinge2Anchor(Joint(count),dBodyGetPositionX(Wheel(count)),dBodyGetPositionY(Wheel(count)),dBodyGetPositionZ(Wheel(count)))
	dJointSetHinge2Axis1(Joint(count),0,1,0)
	dJointSetHinge2Axis2(Joint(count),-1,0,0)
	dJointSetHinge2Param(Joint(count),dParamSuspensionERP,0.8)
	dJointSetHinge2Param(Joint(count),dParamSuspensionCFM,SuspensionHS)
	If count&gt;2
		dJointSetHinge2Param(Joint(count),dParamLoStop,0)
		dJointSetHinge2Param(Joint(count),dParamHiStop,0)
		End If
Next

Speed=0

End Function

; ###################################################################################################

Function CalcVelocity()

PositionEntity PrevPosPivot,PrevX,PrevY,PrevZ

Velocity#=EntityDistance(CMesh,PrevPosPivot)

PrevX#=EntityX(CMesh)
PrevY#=EntityY(CMesh)
PrevZ#=EntityZ(CMesh)

End Function

; ###################################################################################################

Function UpdateKeys()

If KeyDown(30)=1
	Speed=Speed+0.08
	If Speed&gt;30 Then Speed=30
	End If

If KeyDown(44)=1
	Speed=Speed-0.1
	If Speed&lt;-10 Then Speed=-10
	If Speed&gt;0 Then Speed=Speed*0.97
	End If

If KeyDown(30)=0 And KeyDown(44)=0 Then Speed=Speed*0.99

If KeyDown(203)=1 Or KeyDown(205)=1
	If KeyDown(203)=1
		Steer=0.5
		Else
		Steer=-0.5
		End If
	Else
	Steer=0
	End If

If KeyHit(57)=1
	Speed=0
	dBodySetRotation(Car,0,0,0)
	End If

End Function

; ###################################################################################################

Function UpdateCar()

For count=1 To 4
	dBodyEnable(Wheel(count))
Next

dBodyEnable(Car)

For count=1 To 4
	dJointSetHinge2Param(Joint(count),dParamVel2,Speed)
	dJointSetHinge2Param(Joint(count),dParamFMax2,HingeTorque)
Next

For count=1 To 2
	angle#=Steer-dJointGetHinge2Angle1(Joint(count))
	dJointSetHinge2Param(Joint(count),dParamVel,angle)
	dJointSetHinge2Param(Joint(count),dParamFMax,400)
Next

End Function

; ###################################################################################################

Function UpdateCam()

PositionEntity CameraPivot,0,3,-12

camx#=EntityX(CameraPivot,1)-EntityX(Camera)
camy#=EntityY(CameraPivot,1)-EntityY(Camera)
camz#=EntityZ(CameraPivot,1)-EntityZ(Camera)

TranslateEntity Camera,camx*0.5,camy*0.5,camz*0.5

PointEntity Camera,CMesh

End Function

; ###################################################################################################

Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
	RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
	PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
Next

End Function

; ###################################################################################################
</textarea><br>2 - You can use multiple TriMeshes for your terrain etc, to do this you should place all of the TriMeshes into a sub-space (see multiple spaces) and disable internal collisions (to stop the TriMeshes colliding with each other). There's quite a lot of info on this about half way up this thread ^^^<br><br>3 - Yeh, the wonky wheels thing is a known issue in ODE. Too much friction/mass/speed can break the joints causing the wheels to go haywire. I'm hoping to find a decent solution for this, although using spheres for their geometry doesn't help the situation (can't use cylinders due to instability).<br><br>4 - You can use dGeomCountCollisions(geom) for that. When the wheels are not touching anything (in the air), the value returned by this function will be zero. The geom parameter is the wheel geom ID that you wish to detect.<br><br>Hope this helps :) <br><br></td></tr></table><br>
<a name="585881"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Topknot</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#177">[#177]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks yet again VIP3R,<br><br>Your example was perfect, now I have the actual engine and sfx matching the real world driving and strain while Baja'in around ;)<br><br>Will Look into Number 2 and (lost) on number three but I think I have your point.<br><br>If anyone's interested in puttin around with the project so far let me know I'll post WIP links to see.<br><br>Topknot ;) <br><br></td></tr></table><br>
<a name="585911"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#178">[#178]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> @Shifty: dMassSetSphere() and dMassSetSphereTotal() should only be used together. dMassSetSphere() sets <br><br>the density of the object, but not the mass. dMassSetSphereTotal() sets the mass of the object, but not the density. I hope this makes sense :)  <br></div>Not really :p<br><br>First of all looking at the documentation, explaining the Mass creation functions<br><br><div class="quote"> Set the mass parameters to represent a sphere of the given radius and density, with the center of mass<br>at (0,0,0) relative to the body. The first function accepts the density of the sphere, the second accepts<br>the total mass of the sphere. <br></div>...they both set the mass parameters, but one uses a given mass and one uses a total. Looking at the mass structure<br><div class="quote"> typedef struct dMass {<br>dReal mass; // total mass of the rigid body<br>dVector4 c; // center of gravity position in body frame (x,y,z)<br>dMatrix3 I; // 3x3 inertia tensor in body frame, about POR<br>} dMass; <br></div>...there's a field for the total mass, but not one for density. So unless setting the density affects the inertia matrix, which doesn't make any sense to me, there's no field to record the object's density. There's only a mass field, and I'd assume using either dMassSet() or dMassSetTotal() will place a value into this field.<br><br>As I understand it there are two functions to provide different methods for the same solution. Any object has a mass, and this mass can either be given for the object, or determined from a given density and the object's volume. In the case of density I can specify a material, say wood with a denstiy of 0.8, and create objects using the dMassSetxxx() to let the function calculate the object's mass from the volume, saving me the effort. With different sized objects you'll have different masses with the same density. In different circumstances I may want to set the entire object's mass without worrying about what the density is. I might create 3 spheres of radius 2.0, and want them to be of mass 5.0, 10.0 and 15.0 respectively. For these I'd use the dMassSetxxxTotal() function and not worry about working out the required density.<br><br>Now if I'm wrong in my understanding (which wouldn't be the first time!), that means for any object I need to work out mass or density myself. In the above spheres example I would need to calculate object's volume, choose my mass value, and divide that mass by volume and set that to the density.<br><br>I've tried this, following your advice to use both dMassSetSphere() and dMassSetSphereTotal(). In my example program all objects have a volume of 18.846, and with a density of 1.0 and overall mass of 18.846, they should all respond the same to the applied force.<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Include "JV-ODE.bb"

Graphics3D 800,600,0,2

Global WorldERP#=0.8			; ### World Error Correction
Global WorldFriction#=0			; ### World Friction

Global SpaceInfo=0

Global Pointer
Global PlaneGeom

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

; ###################################################################################################

; ### Setup ODE

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global GroundSpace=dHashSpaceCreate(Space)
Global ObjSpace=dHashSpaceCreate(Space)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,-0.98,0)
dWorldSetERP(World,WorldERP)

dContactSetMode(dContactSlip1)
dContactSetMu(WorldFriction)

; ### Create light
Light=CreateLight()
RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera
Camera=CreateCamera()
PositionEntity Camera,-10,10,-10
RotateEntity Camera,20,0,0
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000

; ### Create plane
PlaneGeom=dCreatePlane(GroundSpace,0,1,0,0)
Plane=CreatePlane()
EntityAlpha Plane,0.8
PlaneTexture=CreateTexture(128,128,9)
ClsColor 0,200,80
Cls
Color 255,255,255
Rect 0,0,64,64,1
Rect 64,64,64,64,1
CopyRect 0,0,128,128,0,0,BackBuffer(),TextureBuffer(PlaneTexture)
ScaleTexture PlaneTexture,20,20
EntityTexture Plane,PlaneTexture,0,0

; ### Create some objects
	GRAVITY_ENABLED=True
	SIZE#=2.0
	CYLINDER_RADIUS#=1.7319
	DENSITY#=1.0
;	SPHERE_MASS#=(3.141*(SIZE*SIZE*SIZE)*3)/4
	OBJECT_MASS=18.846
	FRICTION#=100.0
	gamma#=0.5

; Ode1 = Sphere with density based mass
ode1.ODEGeom=New ODEGeom
	ode1\body=dBodyCreate(World)
	dBodySetRotation(ode1\body,0,0,0)
	dBodySetPosition(ode1\body,-25,10,10)
	ode1\geom=dCreateSphere(Space,SIZE)
	dGeomSetBody(ode1\geom,ode1\body)
	dGeomContactSetMu(ode1\geom,0.0)
	mass=dMassCreate()
		dMassSetSphereTotal(mass,OBJECT_MASS,SIZE)
		dMassSetSphere(mass,DENSITY,SIZE)
		dBodySetMass(ode1\body,mass)
		dMassDestroy(mass)
	ode1\mesh=CreateSphere()
	ScaleMesh ode1\mesh,SIZE,SIZE,SIZE

; Ode2 = Sphere with total mass
; Mass of sphere = 3/4 Pi.r^3
ode2.ODEGeom=New ODEGeom
	ode2\body=dBodyCreate(World)
	dBodySetRotation(ode2\body,0,0,0)
	dBodySetPosition(ode2\body,-20,10,10)
	ode2\geom=dCreateSphere(Space,SIZE)
	dGeomSetBody(ode2\geom,ode2\body)
	dGeomContactSetMu(ode2\geom,0.0)
	mass=dMassCreate()
		dMassSetSphere(mass,DENSITY,SIZE)
		dMassSetSphereTotal(mass,OBJECT_MASS,SIZE)
		dBodySetMass(ode2\body,mass)
		dMassDestroy(mass)
	ode2\mesh=CreateSphere()
	ScaleMesh ode2\mesh,SIZE,SIZE,SIZE

; Change Cube size to match Sphere's volume
SIZE=2.661175
; Ode3 = Cube with density based mass
ode3.ODEGeom=New ODEGeom
	ode3\body=dBodyCreate(World)
	dBodySetRotation(ode3\body,0,0,0)
	dBodySetPosition(ode3\body,-15,10,10)
	ode3\geom=dCreateBox(Space,SIZE,SIZE,SIZE)
	dGeomSetBody(ode3\geom,ode3\body)
	dGeomContactSetMu(ode3\geom,0.0)
	mass=dMassCreate()
		dMassSetBoxTotal(mass,CUBE_MASS,SIZE,SIZE,SIZE)
		dMassSetBox(mass,DENSITY,SIZE,SIZE,SIZE)
		dBodySetMass(ode3\body,mass)
		dMassDestroy(mass)
	ode3\mesh=CreateCube()
	ScaleMesh ode3\mesh,SIZE/2,SIZE/2,SIZE/2

; Ode4 = Cube with total mass
; mass=x*y*z*density
;CUBE_MASS#=SIZE*SIZE*SIZE*DENSITY
ode4.ODEGeom=New ODEGeom
	ode4\body=dBodyCreate(World)
	dBodySetRotation(ode4\body,0,0,0)
	dBodySetPosition(ode4\body,-10,10,10)
	ode4\geom=dCreateBox(Space,SIZE,SIZE,SIZE)
	dGeomSetBody(ode4\geom,ode4\body)
	dGeomContactSetMu(ode4\geom,0.0)
	mass=dMassCreate()
		dMassSetBox(mass,DENSITY,SIZE,SIZE,SIZE)
		dMassSetBoxTotal(mass,OBJECT_MASS,SIZE,SIZE,SIZE)
		dBodySetMass(ode4\body,mass)
		dMassDestroy(mass)
	ode4\mesh=CreateCube()
	ScaleMesh ode4\mesh,SIZE/2,SIZE/2,SIZE/2

; Change Cylinder size to match Sphere's volume
SIZE=2
ode5.ODEGeom=New ODEGeom
	ode5\body=dBodyCreate(World)
	dBodySetRotation(ode5\body,90,0,0)
	dBodySetPosition(ode5\body,-5,10,10)
	ode5\geom=dCreateCylinder(Space,CYLINDER_RADIUS,SIZE)
	dGeomSetBody(ode5\geom,ode5\body)
	dGeomContactSetMu(ode5\geom,0.0)
	mass=dMassCreate()
		dMassSetCappedCylinder(mass,DENSITY,2,CYLINDER_RADIUS,SIZE)
		dMassSetCappedCylinderTotal(mass,OBJECT_MASS,2,CYLINDER_RADIUS,SIZE)
		dBodySetMass(ode5\body,mass)
		dMassDestroy(mass)ode5\mesh=CreateCylinder(8)
	ScaleMesh ode5\mesh,CYLINDER_RADIUS/2,SIZE/2,CYLINDER_RADIUS/2

ode6.ODEGeom=New ODEGeom
	ode6\body=dBodyCreate(World)
	dBodySetRotation(ode6\body,90,0,0)
	dBodySetPosition(ode6\body,0,10,10)
	ode6\geom=dCreateCylinder(Space,CYLINDER_RADIUS,SIZE)
	dGeomSetBody(ode6\geom,ode6\body)
	dGeomContactSetMu(ode6\geom,0.0)
	mass=dMassCreate()
		dMassSetCappedCylinderTotal(mass,OBJECT_MASS,2,CYLINDER_RADIUS,SIZE)
		dMassSetCappedCylinder(mass,DENSITY,2,CYLINDER_RADIUS,SIZE)
		dBodySetMass(ode6\body,mass)
		dMassDestroy(mass)ode6\mesh=CreateCylinder(8)
	ScaleMesh ode6\mesh,CYLINDER_RADIUS/2,SIZE/2,CYLINDER_RADIUS/2

While Not KeyHit(1)
	If KeyHit(210)	; Hit insert key
		dBodyEnable (ode1\body)
		dBodyEnable (ode2\body)
		dBodyEnable (ode3\body)
		dBodyEnable (ode4\body)
		dBodyEnable (ode5\body)
		dBodyEnable (ode6\body)
		dBodyAddForce(ode1\body,0,0,100)
		dBodyAddForce(ode2\body,0,0,100)
		dBodyAddForce(ode3\body,0,0,100)
		dBodyAddForce(ode4\body,0,0,100)
		dBodyAddForce(ode5\body,0,0,100)
		dBodyAddForce(ode6\body,0,0,100)
	EndIf
	
	For ode.ODEGeom=Each ODEGeom
		RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
		PositionEntity 

ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
	Next

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)

	UpdateWorld
	RenderWorld
	
	y=15
	Text 20,y,OBJECT_MASS : y=y+15

	Flip

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End
</textarea><br>In the two spheres, for one I use dMassSetSphere() followed by dMassSetSphereTotal(), and in the other I set them the other way around. But the result is the same as only using the last method, the same as I showed previously. Just using dMassSetSphere() has the same result as using dMassSetSphereTotal() followed by dMassSetSphere(). Likewise just using dMassSetSphereTotal() has the same result as using that function along with calling dMassSetSphere() before it. One sphere, the one with SetSphereTotal applied last, is much, much heavier than the other sphere. And both spheres react differently to the applied force than the boxes, despite all parameters being equal. And both boxes work the same whether I apply SetMass, SetMassTotal or both.<br><br>So basically I'm utterly flummoxed what's going wrong! How can I create objects of the same volume, mass and density, no friction, and have them respond the same to a force regardless of shape? It still seems to me ODE doesn't work properly, which I appreciate isn't your fault. <br><br></td></tr></table><br>
<a name="586051"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#179">[#179]</a></td></tr></table></td></tr><tr ><td class="posttext"> [edit] Nevermind, Wayne has found the bug :) <br><br></td></tr></table><br>
<a name="586208"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#180">[#180]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think I found it! <br>I don't necessarly agree with shifty's numbers but I think he's onto something.<br>8)<br><br> After playing with shifty code I believe JV/ODE function: dMassSetSphereTotal is accidentially calling dMassSetSphere but should be calling ode function dMassSetSphereTotal. The following code would seem to  show this.<br><br>* No fool like and old fool, so I hope I'm right ! *<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Include "JV-ODE.bb"

Graphics3D 800,600,0,2

Global WorldERP#=0.8			; ### World Error Correction
Global WorldFriction#=0			; ### World Friction

Global SpaceInfo=0

Global Pointer
Global PlaneGeom

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

; ###################################################################################################

; ### Setup ODE

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)

Global GroundSpace=dHashSpaceCreate(Space)
Global ObjSpace=dHashSpaceCreate(Space)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,-0.98,0)
dWorldSetERP(World,WorldERP)

dContactSetMode(dContactSlip1)
dContactSetMu(WorldFriction)

; ### Create light
Light=CreateLight()
RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera
Camera=CreateCamera()
PositionEntity Camera,-10,10,-10
RotateEntity Camera,20,0,0
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000

; ### Create plane
PlaneGeom=dCreatePlane(GroundSpace,0,1,0,0)
Plane=CreatePlane()
EntityAlpha Plane,0.8
PlaneTexture=CreateTexture(128,128,9)
ClsColor 0,200,80
Cls
Color 255,255,255
Rect 0,0,64,64,1
Rect 64,64,64,64,1
CopyRect 0,0,128,128,0,0,BackBuffer(),TextureBuffer(PlaneTexture)
ScaleTexture PlaneTexture,20,20
EntityTexture Plane,PlaneTexture,0,0

; ### Create some objects
	GRAVITY_ENABLED=True
	SIZE#=2.0
	CYLINDER_RADIUS#=1.7319
	DENSITY#=1.0
	SPHERE_VOL#=4.0 / 3.0 * Pi * SIZE# * SIZE# * SIZE#
	OBJECT_MASS#=4.0 / 3.0 * Pi * SIZE# * SIZE# * SIZE# * DENSITY#
	FRICTION#=100.0
	gamma#=0.5

; Ode1 = Sphere with density based mass
ode1.ODEGeom=New ODEGeom
	ode1\body=dBodyCreate(World)
	dBodySetRotation(ode1\body,0,0,0)
	dBodySetPosition(ode1\body,-25,10,10)
	ode1\geom=dCreateSphere(Space,SIZE)
	dGeomSetBody(ode1\geom,ode1\body)
	dGeomContactSetMu(ode1\geom,0.0)
	mass=dMassCreate()

		;dMassSetSphereTotal(mass,OBJECT_MASS,SIZE)
		dMassSetSphere(mass,DENSITY,SIZE)
		
		dBodySetMass(ode1\body,mass)
		dMassDestroy(mass)
		
	ode1\mesh=CreateSphere()
	ScaleMesh ode1\mesh,SIZE,SIZE,SIZE

; Ode2 = Sphere with total mass
; Mass of sphere = 4/3 x Pi x r^3 x density
ode2.ODEGeom=New ODEGeom
	ode2\body=dBodyCreate(World)
	dBodySetRotation(ode2\body,0,0,0)
	dBodySetPosition(ode2\body,-20,10,10)
	ode2\geom=dCreateSphere(Space,SIZE)
	dGeomSetBody(ode2\geom,ode2\body)
	dGeomContactSetMu(ode2\geom,0.0)
	mass=dMassCreate()
	
		;dMassSetSphere(mass,DENSITY,SIZE)
		;dMassSetSphereTotal(mass,OBJECT_MASS#,SIZE#)
		dMassSetSphereTotal(mass,1,2) ;33.52, 2
	
		dBodySetMass(ode2\body,mass)
		dMassDestroy(mass)
		
	ode2\mesh=CreateSphere()
	ScaleMesh ode2\mesh,SIZE,SIZE,SIZE

; Change Cube size to match Sphere's volume
SIZE#=3.223983

; Ode3 = Cube with density based mass
ode3.ODEGeom=New ODEGeom
	ode3\body=dBodyCreate(World)
	dBodySetRotation(ode3\body,0,0,0)
	dBodySetPosition(ode3\body,-15,10,10)
	ode3\geom=dCreateBox(Space,SIZE,SIZE,SIZE)
	dGeomSetBody(ode3\geom,ode3\body)
	dGeomContactSetMu(ode3\geom,0.0)
	mass=dMassCreate()
	
		;dMassSetBoxTotal(mass,CUBE_MASS,SIZE,SIZE,SIZE)
		dMassSetBox(mass,DENSITY#,SIZE#,SIZE#,SIZE#)
		
		dBodySetMass(ode3\body,mass)
		dMassDestroy(mass)
	ode3\mesh=CreateCube()
	ScaleMesh ode3\mesh,SIZE/2,SIZE/2,SIZE/2

; Ode4 = Cube with total mass
; Mass = Density x Volume
; mass=x*y*z*density
;CUBE_MASS#=SIZE*SIZE*SIZE*DENSITY
ode4.ODEGeom=New ODEGeom
	ode4\body=dBodyCreate(World)
	dBodySetRotation(ode4\body,0,0,0)
	dBodySetPosition(ode4\body,-10,10,10)
	ode4\geom=dCreateBox(Space,SIZE,SIZE,SIZE)
	dGeomSetBody(ode4\geom,ode4\body)
	dGeomContactSetMu(ode4\geom,0.0)
	mass=dMassCreate()
		;dMassSetBox(mass,DENSITY,SIZE,SIZE,SIZE)
		dMassSetBoxTotal(mass,OBJECT_MASS#,SIZE#,SIZE#,SIZE#)
		dBodySetMass(ode4\body,mass)
		dMassDestroy(mass)
	ode4\mesh=CreateCube()
	ScaleMesh ode4\mesh,SIZE/2,SIZE/2,SIZE/2

; Change Cylinder size to match Sphere's volume
SIZE=2
ode5.ODEGeom=New ODEGeom
	ode5\body=dBodyCreate(World)
	dBodySetRotation(ode5\body,90,0,0)
	dBodySetPosition(ode5\body,-5,10,10)
	ode5\geom=dCreateCylinder(Space,CYLINDER_RADIUS,SIZE)
	dGeomSetBody(ode5\geom,ode5\body)
	dGeomContactSetMu(ode5\geom,0.0)
	mass=dMassCreate()
		dMassSetCappedCylinder(mass,DENSITY,2,CYLINDER_RADIUS,SIZE)
		dMassSetCappedCylinderTotal(mass,OBJECT_MASS,2,CYLINDER_RADIUS,SIZE)
		dBodySetMass(ode5\body,mass)
		dMassDestroy(mass)ode5\mesh=CreateCylinder(8)
	ScaleMesh ode5\mesh,CYLINDER_RADIUS/2,SIZE/2,CYLINDER_RADIUS/2

ode6.ODEGeom=New ODEGeom
	ode6\body=dBodyCreate(World)
	dBodySetRotation(ode6\body,90,0,0)
	dBodySetPosition(ode6\body,0,10,10)
	ode6\geom=dCreateCylinder(Space,CYLINDER_RADIUS,SIZE)
	dGeomSetBody(ode6\geom,ode6\body)
	dGeomContactSetMu(ode6\geom,0.0)
	mass=dMassCreate()
		dMassSetCappedCylinderTotal(mass,OBJECT_MASS,2,CYLINDER_RADIUS,SIZE)
		dMassSetCappedCylinder(mass,DENSITY,2,CYLINDER_RADIUS,SIZE)
		dBodySetMass(ode6\body,mass)
		dMassDestroy(mass)ode6\mesh=CreateCylinder(8)
	ScaleMesh ode6\mesh,CYLINDER_RADIUS/2,SIZE/2,CYLINDER_RADIUS/2

While Not KeyHit(1)
	If KeyHit(210)	; Hit insert key
		dBodyEnable (ode1\body)
		dBodyEnable (ode2\body)
		dBodyEnable (ode3\body)
		dBodyEnable (ode4\body)
		dBodyEnable (ode5\body)
		dBodyEnable (ode6\body)
		dBodyAddForce(ode1\body,0,0,100)
		dBodyAddForce(ode2\body,0,0,100)
		dBodyAddForce(ode3\body,0,0,100)
		dBodyAddForce(ode4\body,0,0,100)
		dBodyAddForce(ode5\body,0,0,100)
		dBodyAddForce(ode6\body,0,0,100)
	EndIf
	
	For ode.ODEGeom=Each ODEGeom
		RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
		PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
	Next

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)

	UpdateWorld
	RenderWorld
	
	y=15
	Text 20,y,OBJECT_MASS : y=y+15

	Flip

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End
</textarea> <br><br></td></tr></table><br>
<a name="586220"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#181">[#181]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh crumbs, I can't believe it... you're absolutely right Wayne :O<br><br>Very well spotted!<br><br>The dMassSetSphere() function is indeed being called instead of the dMassSetSphereTotal() function. Looks like the bug has been there since V1.00 of the wrapper.<br><br>Thanks very much Wayne and Shifty for highlighting this problem, it'll be fixed in V1.08 :) <br><br></td></tr></table><br>
<a name="586246"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#182">[#182]</a></td></tr></table></td></tr><tr ><td class="posttext"> Good oh. And yes, i see I was doing 3/4 instead of 4/3 for sphere volume which accounts for the lesser differences. While the 30x greater mass I observed was the fact I used a 30x greater volumet, which I didn't notice because I had this wrong sphere volume calculation. So by pooling all our mistakes we found a solution ;) <br><br></td></tr></table><br>
<a name="586384"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#183">[#183]</a></td></tr></table></td></tr><tr ><td class="posttext"> oh my gawd I was right, let me tell the wife.  hehe<br><br>Thanks to Shifty Geezer and VIP3R for giving me a chance to help out.<br><br>JV/ODE is a sweet product and I can't imagine using B3D with out it. Yes lads, using ODE will make you smarter! <br><br></td></tr></table><br>
<a name="586410"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Topknot</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#184">[#184]</a></td></tr></table></td></tr><tr ><td class="posttext"> I hope that's true Wayne, cause right now I'm feeling stupid, lol.  Trying to get my head around the multi space idea, in that I'm trying to load a land mesh then dup it in a grid like pattern.  VIP3R mentioned multi spaces would enable the usage of multi meshes and everything I'm trying fails.<br><br>The problem I guess is that the examples included do have multi space style code but for basic primatives and not fully loaded meshes, hense I assume I'm stuck using the LoadMesh and TriMesh.<br><br>Here's the reasoning behind this.  Milkshape, (which is my fav proggy for quick stuff, has a really easy Heightmap terrain generator, and the really nice thing is that the mesh is designed so that you can duplicate the mesh and it lines up on any side exact, hense you can "tile" them with perfect edge matching.  Now here's a snipt of the code I thought was to be done for it.<br><br><pre class=code>
;** Globals First **
Global World              = dWorldCreate()
Global Space              = dHashSpaceCreate(0)
Global LandSpace1         = dHashSpaceCreate(Space)
Global LandSpace2         = dHashSpaceCreate(Space)
Global ContactGroup       = dJointGroupCreate(0)

; ###################################################################
; #    Create the Landscape - Using Create TriMesh                  #
; ###################################################################

Global  Dirt     = LoadTexture("dirt1.bmp")
		LandMesh1 = LoadMesh("TestHill.b3d")
		
	 		PositionEntity LandMesh1,0,0,0
			ScaleMesh      LandMesh1,50,2,50
			EntityTexture  LandMesh1,Dirt
			ScaleTexture   Dirt,.05,.05
			EntityColor    LandMesh1,250,0,0

		trimesh = CreateTriMesh(LandSpace1,landMesh1)
			
			dGeomSetRotation(trimesh,0,0,0)
			dGeomSetPosition(trimesh,0,0.05,0)

		RotateEntity   LandMesh1,0,0,0
		PositionEntity LandMesh1,0,0.05,0

; ###################################################################		
		
		LandMesh2 = LoadMesh("TestHill.b3d")
		
			PositionEntity LandMesh2,0,0,0
			ScaleMesh      LandMesh2,10,10,10
			EntityTexture  LandMesh2,Dirt
			ScaleTexture   Dirt,.05,.05
			EntityColor    LandMesh2,0,250,0

		trimesh = CreateTriMesh(LandSpace2,landMesh2)
			
			dGeomSetRotation(trimesh,0,0,0)
			dGeomSetPosition(trimesh,0,0.05,0)

		RotateEntity   LandMesh2,0,0,0
		PositionEntity LandMesh2,3200,0.05,0
</pre><br><br>Now I do get the items and I understand that non-collision is still needed to emulate the checking between the to meshes from eachother, but this just seems to kill the running OR, only the first trimesh works for checking and the second, while there is not able to preform the needed collision checking.<br><br>So any pointers or guides would really be nice.  I did spend the better part of the night reading all the forum postings like VIP3R mentioned and referencing the "Examples" but I truly seem miffed by what's wrong.<br><br>Topknot<br><br>#EDIT#<br><br>Ok breakthru, not sure how it all changes from last night and now but one thing I noticed in the above code was that I didn't have the "Positioning" values matching the actual mesh locations, now went in and poof they are lined up and working for collisions, OHHh one thing VIP3R DID say was to not have them intersecting the PLANE below in that the collision detection would drag and poof spot on, lowered it and now smooth frame rate with no drag and working collisionable meshes that stretch for miles ;)<br><br>Now to figure out turning off collisions between the meshs and eachother. <br><br></td></tr></table><br>
<a name="586457"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wayne</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#185">[#185]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here's a multimesh example I created a month ago using TED to create the landscape, if your interested in seeing it run with media email me. <br><br>I believe the JV/ODE demos include multispace examples too.<br><br>JV/ODE<br><a href="http://www.devcode.co.uk/jv-ode.html" target="_blank">http://www.devcode.co.uk/jv-ode.html</a><br><br>TED<br><a href="http://www.d-grafix.com/softwareted.html#SCR" target="_blank">http://www.d-grafix.com/softwareted.html#SCR</a><br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
; ###################################################################################################
;                             JV-ODE Mars Terrain Demo                              
;                            Code by Wayne Gray , Jim Williams (VIP3R)                              
;                             This code is free, use as you wish.
; ###################################################################################################

AppTitle "ODE MARS Terrain Demo"

Include "JV-ODE.bb"

Graphics3D 800,600,0,2
;Graphics3D 1024,768,32,1
Global CMass#=200         ; ### Car Mass
Global WMass#=8            ; ### Wheel Mass

Global WorldERP#=1         ; ### World Error Correction
Global WorldFriction#=64   ; ### World Friction
Global HingeTorque#=24      ; ### Hinge Torque
Global SuspensionHS#=0.01   ; ### Hinge Suspension Hardness/Softness (Higher=Softer - Lower=Harder)

Global Speed#=0
Global Steer#=0

Global Car
Global CGeom
Global CMesh

Global CarStartY=40

Dim Wheel(4)
Dim WGeom(4)
Dim Joint(4)

Type ODEGeom
   Field body
   Field geom
   Field mesh
End Type

; ###################################################################################################

; ### Setup ODE

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global TriSpace=dHashSpaceCreate(space)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,1)

dWorldSetERP(World,WorldERP)

dContactSetMode(dContactSlip1)
dContactSetMu(WorldFriction)

; Set Initial World
Global Planet$="Earth"
Global gx=1
dWorldSetGravity(World,0,-0.98,0)


; ### Create car body

ode.ODEGeom=New ODEGeom
ode\body=dBodyCreate(World)
Car=ode\body
dBodySetRotation(ode\body,0,0,0)
dBodySetPosition(ode\body,0,CarStartY,0)
mass=dMassCreate()
dMassSetBox(mass,1,3,1,4)
dMassSetBoxTotal(mass,CMass,3,1,4)
dMassTranslate(mass,0,-1,0)
dBodySetMass(ode\body,mass)
dMassDestroy(mass)
ode\geom=dCreateBox(Space,3,1,4)
CGeom=ode\geom
dGeomSetBody(ode\geom,ode\body)
ode\mesh=CreateCube()
CMesh=ode\mesh
ScaleMesh ode\mesh,1.5,0.5,2
RotateMesh ode\mesh,0,0,0
PositionMesh ode\mesh,0,0,0
EntityColor ode\mesh,40,80,255
EntityAlpha ode\mesh,1

; ### Create wheels

For count=1 To 4
   ode.ODEGeom=New ODEGeom
   ode\body=dBodyCreate(World)
   Wheel(count)=ode\body
   dBodySetRotation(ode\body,0,0,0)
   dBodySetPosition(ode\body,0,0,0)
   mass=dMassCreate()
   dMassSetSphere(mass,1,0.7)
   dMassSetSphereTotal(mass,WMass,0.7)
   dBodySetMass(ode\body,mass)
   dMassDestroy(mass)
   ode\geom=dCreateSphere(Space,0.7)
   WGeom(count)=ode\geom
   dGeomSetBody(ode\geom,ode\body)
   ode\mesh=CreateCylinder(8)
   ScaleMesh ode\mesh,0.7,0.25,0.7
   RotateMesh ode\mesh,0,0,90
   PositionMesh ode\mesh,0,0,0
   EntityColor ode\mesh,255,255,255
Next

dBodySetPosition(Wheel(1),-2,CarStartY-0.5,+2)
dBodySetPosition(Wheel(2),+2,CarStartY-0.5,+2)
dBodySetPosition(Wheel(3),-2,CarStartY-0.5,-2)
dBodySetPosition(Wheel(4),+2,CarStartY-0.5,-2)

; ### Create some objects

SeedRnd MilliSecs()

For spheres=1 To 20
   ode.ODEGeom=New ODEGeom
   ode\body=dBodyCreate(World)
   dBodySetRotation(ode\body,0,0,0)
   dBodySetPosition(ode\body,Rnd(-100,100),44,Rnd(-100,100))
   ode\geom=dCreateSphere(Space,4)
   dGeomSetBody(ode\geom,ode\body)
   ode\mesh=CreateSphere()
   ScaleMesh ode\mesh,4,4,4
   RotateMesh ode\mesh,0,0,0
   PositionMesh ode\mesh,0,0,0
   EntityColor ode\mesh,Rnd(255),Rnd(255),Rnd(255)
   EntityAlpha ode\mesh,1
   EntityShininess ode\mesh,0.7
Next

; ### Create light

Global Light=CreateLight()

RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera

Global CameraPivot=CreatePivot(CMesh)
PositionEntity CameraPivot,0,2,-7

Global Camera=CreateCamera()
CameraClsColor Camera,0,0,0
CameraRange Camera,1,200

Text 0,0,"Loading.. please wait"
Flip

;--------------------------------------------------------------
;load terrain
;--------------------------------------------------------------
Dim map(8,8)
Dim Tm(8,8)
Dim lm(8,8)

dir$=".\"

For b=1 To 8
   For a=1 To 8
      map(a,b)= LoadMesh(dir+"mars("+a+","+b+").b3d")
      UpdateNormals map(a,b)
      PositionEntity map(a,b),(a-1)*200,0,(b-1)*200
      ; Load ODE Trimeshes into trispace
      tm(a,b)=CreateTriMesh(trispace,map(a,b))
      dGeomSetPosition(tm(a,b),(a-1)*200,0,(b-1)*200)
      dGeomSetRotation(tm(a,b),0,0,0)
   Next
Next
; Tell the trispaces not to collide with each other.
dSetInternalSpaceCollideMode(0)

;--------------------------------------------------------------
;load &amp;apply lm to tex layer 1
;--------------------------------------------------------------
For b=1 To 8
   For a=1 To 8
      lm(a,b) = LoadTexture(dir+"mars("+a+","+b+")_lm.bmp")
      EntityTexture map(a,b),lm(a,b),0,1
      EntityFX map(a,b),1
   Next
Next   
   
; ###################################################################################################

SetupCar()

While Not KeyHit(1)

   UpdateKeys()

   PTime=MilliSecs()

   UpdateCar()

   UpdateGeoms()

   dSpaceCollide(Space,World,ContactGroup)
   dWorldQuickStep(World,0.1)
   dJointGroupEmpty(ContactGroup)

   PhysicsTime#=MilliSecs()-PTime

   UpdateCam()

   UpdateWorld

   RenderWorld

   Text 0,0,"JV-ODE Version "+dGetVersion()
   Text 0,15,"Physics Time:"+PhysicsTime
   Text 0,30,"Car Speed:"+Speed
   Text 640,0,"A - Accelerate"
   Text 640,15,"Z - Brake/Reverse"
   Text 640,30,"Arrows - Steering"
   Text 640,45,"Space - Reset Car"
   Text 640,60,"P - Planet="+Planet

   Flip

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End

; ###################################################################################################

Function SetupCar()

For count=1 To 4
   Joint(count)=dJointCreateHinge2(World,0)
   dJointAttach(Joint(count),Car,Wheel(count))
   dJointSetHinge2Anchor(Joint(count),dBodyGetPositionX(Wheel(count)),dBodyGetPositionY(Wheel(count)),dBodyGetPositionZ(Wheel(count)))
   dJointSetHinge2Axis1(Joint(count),0,1,0)
   dJointSetHinge2Axis2(Joint(count),-1,0,0)
   dJointSetHinge2Param(Joint(count),dParamSuspensionERP,0.8)
   dJointSetHinge2Param(Joint(count),dParamSuspensionCFM,SuspensionHS)
   If count&gt;2
      dJointSetHinge2Param(Joint(count),dParamLoStop,0)
      dJointSetHinge2Param(Joint(count),dParamHiStop,0)
      End If
Next

Speed=0

End Function

; ###################################################################################################

Function UpdateKeys()

If KeyDown(30)=1
   Speed=Speed+0.08
   If Speed&gt;30 Then Speed=30
   End If

If KeyDown(44)=1
   Speed=Speed-0.1
   If Speed&lt;-10 Then Speed=-10
   If Speed&gt;0 Then Speed=Speed*0.97
   End If

If KeyDown(30)=0 And KeyDown(44)=0 Then Speed=Speed*0.99

If KeyDown(203)=1 Or KeyDown(205)=1
   If KeyDown(203)=1
      Steer=0.5
      Else
      Steer=-0.5
      End If
   Else
   Steer=0
   End If

If KeyHit(57)=1
   Speed=0
   dBodySetRotation(Car,0,0,0)
   End If

; P - Planet
If KeyHit(25) Then
   gx=gx+1
   If gx&gt;4 Then gx=1
   Select gx
     Case 1
      Planet="Earth "
      dWorldSetGravity(World,0,-1.0,0)
   
     Case 2
      Planet="Mars"
      dWorldSetGravity(World,0,-.33333,0)

     Case 3
      Planet="Moon"
      dWorldSetGravity(World,0,-.16666,0)
      
     Case 4
      Planet="Space"
      dWorldSetGravity(World,0,0,0)
   End Select
   
EndIf

End Function

; ###################################################################################################

Function UpdateCar()

For count=1 To 4
   dBodyEnable(Wheel(count))
Next

dBodyEnable(Car)

For count=1 To 4
   dJointSetHinge2Param(Joint(count),dParamVel2,Speed)
   dJointSetHinge2Param(Joint(count),dParamFMax2,HingeTorque)
Next

For count=1 To 2
   angle#=Steer-dJointGetHinge2Angle1(Joint(count))
   dJointSetHinge2Param(Joint(count),dParamVel,angle)
   dJointSetHinge2Param(Joint(count),dParamFMax,400)
Next

End Function

; ###################################################################################################

Function UpdateCam()

PositionEntity CameraPivot,0,3,-12

camx#=EntityX(CameraPivot,1)-EntityX(Camera)
camy#=EntityY(CameraPivot,1)-EntityY(Camera)
camz#=EntityZ(CameraPivot,1)-EntityZ(Camera)

TranslateEntity Camera,camx*0.5,camy*1.5,camz*0.5

PointEntity Camera,CMesh

End Function

; ###################################################################################################

Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
   RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
   PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
Next

End Function

; ###################################################################################################
</textarea> <br><br></td></tr></table><br>
<a name="586458"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#186">[#186]</a></td></tr></table></td></tr><tr ><td class="posttext"> Topknot : A couple of things to look out for. First off both your landscape meshes should occupy your landscape space. There's no need to create another Space that'll probably add overhead. You can just add all you unanimated, static scenery objects into the one subspace. You also want a seperate Geom object for each object so that you can clear them or move them or whatever. At the moment you use the same variable name, Trimesh, for two seperate objects.<br><br>Global Space              = dHashSpaceCreate(0)<br>Global LandSpace       = dHashSpaceCreate(Space)<br>landmesh_geom1 = CreateTriMesh(LandSpace,landMesh1)<br>landmesh_geom2 = CreateTriMesh(LandSpace,landMesh2)<br><br>To disable subspace collisions use dSetInternalSpaceCollideMode(0). <br><br></td></tr></table><br>
<a name="586476"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Topknot</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#187">[#187]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thank you Shifty,<br><br>Just read up on the dSetInternalSpaceCollideMode(0), and it works like a charm.  Got 10 masive test land meshes loaded and runs as smooth as earlier testing with one.<br><br>Not to understanding on the point about using the different named geom's.  Here let me post the code that I'm testing to load in a random series of land meshes to "build" a world.<br><br><pre class=code>
Dim LandMesh(10)
Global Loc = 0

	For HC = 1 To 10
		LPiece = Rnd(1,3)
			LandMesh(HC) = LoadMesh("Hills"+LPiece+".b3d")
		
				ScaleMesh      LandMesh(HC),10,2,10
				EntityTexture  LandMesh(HC),Dirt
				ScaleTexture   Dirt,.05,.05
				EntityColor    LandMesh(HC),Rnd(100,250),Rnd(100,250),Rnd(100,250)

			trimesh = CreateTriMesh(LandSpace1,landMesh(HC))
			
				dGeomSetRotation(trimesh,0,0,0)
				dGeomSetPosition(trimesh,0,0,Loc)

			RotateEntity   LandMesh(HC),0,0,0
			PositionEntity LandMesh(HC),0,0.05,Loc

			Loc = Loc + 640

	Next
</pre><br><br>Now again just testing ideas, but as you can see I only have the "trimesh ='s" in the code and so I'm curious on the reason for making unique names for it.<br><br>If you could expand on that maybe I'm missing a very important point ;)<br><br>Topknot <br><br></td></tr></table><br>
<a name="586485"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#188">[#188]</a></td></tr></table></td></tr><tr ><td class="posttext"> The reason for using unique names for each TriMesh geom is so that you can access each TriMesh individually later on in your simulation. At the moment you can't do this, as once you've created the second TriMesh, you've lost the handle of the first one because you're using the same identifier for all of them (i.e. trimesh=blahblah).<br><br>All you need to do is add this to your code...<br><br><i>Dim TriMeshObject(10)</i><br><br>Then change these lines...<br><br><i>trimesh = CreateTriMesh(LandSpace1,landMesh(HC))<br>dGeomSetRotation(trimesh,0,0,0)<br>dGeomSetPosition(trimesh,0,0,Loc)</i><br><br>To this...<br><br><i>TriMeshObject(HC) = CreateTriMesh(LandSpace1,landMesh(HC))<br>dGeomSetRotation(TriMeshObject(HC),0,0,0)<br>dGeomSetPosition(TriMeshObject(HC),0,0,Loc)</i><br><br>Now if you need to move the fourth TriMesh for example, you can use its unique identifier. Which in this case would be TriMeshObject(4)...<br><br><i>dGeomSetPosition(TriMeshObject(4),NewXPosition,NewYPosition,NewZPosition)<br>PositionEntity LandMesh(4),NewXPosition,NewYPosition,NewZPosition</i> <br><br></td></tr></table><br>
<a name="586494"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Topknot</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#189">[#189]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ahh ok makes better understanding now.  So let me rephrase to see if I grasp it.<br><br>So to be able to go back and say move a "mesh" loaded object it has to have a unique identifier hense the TriMeshObject(HC) needed.  Now if it's a static land mass that 's not going anywhere in the future is there a need for this or is it just better coding to go ahead and plop it in.<br><br>Also question for you all, now that I got something of land masses ploped around, would you recommend using TYPES so that I can pass through a routine to hide and show land meshes based on if they are seen by the camera, hense a cheap LOD style of code.? or can I still cycle thru the Meshes with a simple For Next loop.addressing the LandMesh(HC) and or TriMeshObject(HC).<br><br>Again thanks for the input, it's slowly getting there.<br><br>Topknot ;) <br><br></td></tr></table><br>
<a name="586513"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#190">[#190]</a></td></tr></table></td></tr><tr ><td class="posttext"> There are other advantages for unique identifiers, like detecting/counting collisions on a particular TriMesh for example. It's good practice to use unique identifiers, you may not want to move static objects but you may need to access them for other reasons. If you design your code in this way from the outset, it'll save you a lot of editing later on if you suddenly realize you need to access them.<br><br>Regarding the second question, whether you use an array or types would probably boil down to personal preference and its application. For a LOD system it may be easier using types but you could still use an array if you wanted to. <br><br></td></tr></table><br>
<a name="586561"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#191">[#191]</a></td></tr></table></td></tr><tr ><td class="posttext"> Type are ideal for ODE, as you can package all the related objects together into one type. The standard is to have your Blitz mesh, ODE body and ODE geom objects all in a type...<br><br>TYPE ODE_object<br>Field geom<br>Field body<br>Field mesh<br>END TYPE<br><br>Then you can reference the object for related activities. eg. Turn make an inactive object invisible<br><pre class=code>
Dim Objects.ODE_object(10)

FOR n = 0 TO 10
   IF NOT dBodyIsEnabled(Objects(n)\body)
      HideEntity(Objects(n)\mesh)
   ENDIF
NEXT</pre><br>With all your bodies, geoms and meshes grouped together this way, you can easily reference the different parts to an objects with the same index (if they're in an array). Or as in my case create a linked list where you can add and remove objects at will.<br><br>Without using types you make keeping tabs on your object's activities and making one thing respond to another thing much more complicated IMO. <br><br></td></tr></table><br>
<a name="586614"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Topknot</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#192">[#192]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey guys,<br><br>In the usage of the "dGeomCountCollisions", I have gone over the example included many many times.  I believe it's used to check collision info.<br><br>In the example I was able to add this bit<br><pre class=code>
JumpAir# = dGeomCountCollisions(WGeom(count))
</pre><br><br>So it looks like this in the Example Code<br><pre class=code>
For count=1 To 4
	WGeomID$(count)="AIR AIR"
	TEST# = dGeomCountCollisions(WGeom(count))
	If dGeomCountCollisions(WGeom(count))&gt;0
		If dGeomCollisionGeom(WGeom(count),1)=PlaneGeom Then WGeomID$(count)=" - Ground Plane"
		If dGeomCollisionGeom(WGeom(count),1)=RampGeom Then WGeomID$(count)=" - Red Ramp"
		If dGeomCollisionGeom(WGeom(count),1)=BlueGeom Then WGeomID$(count)=" - Blue Block"
		For count2=1 To 20
			If dGeomCollisionGeom(WGeom(count),1)=SphereGeom(count2) Then WGeomID$(count)=" - Sphere "+count2
			If dGeomCollisionGeom(WGeom(count),1)=CCylinderGeom(count2) Then WGeomID$(count)=" - Capped Cylinder "+count2
		Next
		End If
Next
</pre><br><br>Now I have also duplicated any and all Globals like the example just incase, and yet in the Example code it works fine and reports a "0" when in Air and a "1" when on a collision surface.<br><br>Would having <pre class=code>dSetInternalSpaceCollideMode(0)</pre> in my proggy cause this to missfire and not function right?<br><br>basically here's what I wanted to do.  Seem simple at the time, but I want to Play a Landing Crunching sound when you grab air off a hill or bump and Land.!! Like the struts and springs squeaking and such.  So I figured I needed to first register if in the AIR and then when Back on GROUND to fire off the FX. <br><br></td></tr></table><br>
<a name="586647"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#193">[#193]</a></td></tr></table></td></tr><tr ><td class="posttext"> Using dSetInternalSpaceCollideMode(0) only affects collisions of objects within the same sub-space, so as long as you don't put your vehicles in the same sub-space as the static scenery, the collisions &amp; detection will still work as expected.<br><br>Although using dSetInternalSpaceCollideMode(0) won't affect the collision detection, using multiple spaces <b>does</b>. You need to use both the dGeomCountCollisions(geom) function and also the dSubGeomCountCollisions(geom) function to detect all possible collisions. Check out the 'CarDemo-DetailedC-MS.bb' demo to see this in action.<br><br>Basically, you just need to do this...<br><br>TotalCollisions = dGeomCountCollisions(WGeom(count)) + dSubGeomCountCollisions(WGeom(count))<br><br>You can also find more info about these functions in the JV-ODE Function Reference. <br><br></td></tr></table><br>
<a name="586660"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Topknot</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#194">[#194]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry if all the questions pester you, but learning as I go is the only way without docs or examples from others, but the point of looking into "SUB" spaces was the ticket.  Where as I wasn't acounting for them being in different spaces for the collision reference.  Thanks.<br><br>I keep the JV-ODE Function Reference up on the second monitor while testing and trying to accomplish my step goals, but it doesn't really leave alot of info in example format to assist.  Maybe it's just me but I work best with an example of sorts.  Not your fault but when your new to using this ODE like me it's a bit harder to fully understand their usage until you figure it out. <br><br></td></tr></table><br>
<a name="586663"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#195">[#195]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey no problem Topknot, being pestered is what I'm here for ;)<br><br>Don't worry, the learning curve seems quite steep to begin with, but you'll be surprised how quickly you get to grips with ODE :)<br><br>Keep it up, you're doing very well so far. <br><br></td></tr></table><br>
<a name="586771"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#196">[#196]</a></td></tr></table></td></tr><tr ><td class="posttext"> I agree wtih VIP3R here. Learning how ODE works is quite tricky, but once you get a handle on it it's straight forward to use and understanding then how to reference individual collisions is pretty straightforward too. Just keep reading, writing, getting confused and asking questions 'til you get it! <br><br></td></tr></table><br>
<a name="586826"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Topknot</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#197">[#197]</a></td></tr></table></td></tr><tr ><td class="posttext"> Alrighty,<br><br>To take you all up on your postings.  The collision issue it just out of my grasp.  I've read the Doc's 3x trying to figure out what they mean. and Disected the Car Detailed MC several.  If I do register a collision it crashes, or after test changing it doesn't even show a collision.  <br><br>Ok here's the layout to Try and do this right and understand it.<br><br>First - I have the Car and Wheel Geoms created with CGeom and WGeom(count) "1-4".<br>Second - I have the Plane listed with PlaneGeom.<br><br>Car and Wheels are in the "CarSpace"<br><br>Plane in the "LandSpace1"<br><br>Global are set for:<br><br>Global CarSpace	    = dHashSpaceCreate(Space)<br>Global LandSpace1 = dHashSpaceCreate(Space)<br><br>CGeom, PlaneGeom, GeomGeom$<br><br>Dims are set for:<br><br>WGeom(4) WGeomID$(4)<br><br>Now I assume I want to just check the collision between the two "spaces" i.e. (CarSpace -v- LandSpace1)<br><br>But no matter how hard I try to recreate, copy and paste, or go line by line and read definitions in the JV-ODE Reference, I can't see the error of my ways. <br><br>I tried using a Dummy Object parented to the Cmesh and having it drag under the car to Blitz Collide with the two surfaces.  Works great but it can't seem to "update" or push the triggers until I slow to a craw and then proceed.  Granted it works but only if you want to drive 5 miles an hour....:( <br><br></td></tr></table><br>
<a name="586867"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shifty Geezer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#198">[#198]</a></td></tr></table></td></tr><tr ><td class="posttext"> Probably best you post up a copy of your code. Use the CODEBOX tag instead of the CODE tag so it fits in the window. <br><br></td></tr></table><br>
<a name="586950"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#199">[#199]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Topknot: If you're experiencing crashes, you're probably forgetting to check a collision has occurred beforehand.<br><br>Doing the following will cause ODE to crash if there are no collisions detected...<br><br><i>GeomX=dGeomCollisionX#(CGeom,1)</i><br><br>To solve this you just need to check to make sure a collision has occurred before calling it...<br><br><i>If dGeomCountCollisions(CGeom)&gt;0<br>	GeomX=dGeomCollisionX#(CGeom,1)<br>	End If</i><br><br>This applies to all of the collision functions, including the sub-collision functions.<br><br>If you're still a bit stuck, post your code using the &lt;codebox&gt; &lt;/codebox&gt; tags (change &lt;&gt; for []) as Shifty suggested and we can take a look at it for you. <br><br></td></tr></table><br>
<a name="586964"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Topknot</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#200">[#200]</a></td></tr></table></td></tr><tr ><td class="posttext"> So I assume something like this<br><pre class=code>
	For count=1 To 4
		
		SubWGeomID$(count)=""
		
		If dSubGeomCountCollisions(WGeom(count))&gt;0
		
			If dSubGeomCollisionGeom(WGeom(count),1) = PlaneGeom Then SubWGeomID$(count)=" - Water Plane"
			If dSubGeomCollisionGeom(WGeom(count),1) = GroundGeom  Then SubWGeomID$(count)=" - Ground Plane"
		
		End If
Next
</pre><br><br>This is showing the collision finally after widdling down the Demo Cat MS D example lol.<br><br>On another note, is there a formula for figuring out the car objects dimensions verse what is actually seen.  I read somewhere a 2:1 ratio.  For example I use a custom model mesh for the car's body and of course when it flips it buries itself up to the original sizing of the actual ODE object.  Experminting at the moment with a hugly stripped down "demo example" to test this.<br><br>Read  in the ODE manual :<br><pre class=code>
 dMassSetBox (dMass *, dReal density,  dReal lx, dReal ly, dReal lz);
 dMassSetBoxTotal (dMass *, dReal total_mass,  dReal lx, dReal ly, dReal lz);
</pre><br><br>Wish they would define things like "dReal density, dReal total_mass".  I again am assuming they are absolute values uses in the collision routines...?!<br><br>If you guys got a simple formula or ratio where a person can match a custom object to the actual ODE object dimensions.<br><br>On a brighter point I made of found a nice way to reset the car once it flips without the destroy and rebuild option, so far it's nicer to the end user, will post when I think it's worth you're all inspection ;)<br><br>Topknot ;)<br><br>BTW dying to show you all what it is that I've been pounding out.  granted it's not the fully menu driven, goal playing style yet, but it's hella fun and looks really sharp with my custom models ;) <br><br></td></tr></table><br>
<a name="586984"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#201">[#201]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>So I assume something like this<br> <br></div><br>Yep, exactly like that :)<br><br>Right, the dimensions (using ScaleMesh not ScaleEntity)...<br><br><b>ODE Spheres vs Blitz Spheres - Same</b><br>dCreateSphere(Space,3) &lt;- 1x3=3<br>ScaleMesh mesh,3,3,3<br><br><b>ODE Boxes vs Blitz Cubes - 2x X,Y,Z</b><br>dCreateBox(Space,2,4,10) &lt;- 2x1=2 2x2=4 2x5=10<br>ScaleMesh mesh,1,2,5<br><br><b>ODE Cylinders vs Blitz Cylinders - 1x Radius - 2x Length</b><br>dCreateCylinder(Space,1,10) &lt;- 1x1=1 2x5=10<br>ScaleMesh mesh,1,5,1<br><br><b>ODE Capped Cylinders vs Blitz Cylinders - 1x Radius - 2x Length minus 2x Radius</b><br>dCreateCCylinder(Space,1,8) &lt;- 1x1=1 (2x5)-(2x1)=8<br>ScaleMesh mesh,1,5,1<br><br>You specify the dimensions when creating the ODE object, not in the mass functions. When you do use the mass functions, they should have the same dimensions as the ones you used when creating the ODE object. Btw, dReal just refers to a float value in ODE.<br><br>Looking forward to checking out your demo :) <br><br></td></tr></table><br>
<a name="587036"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Topknot</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#202">[#202]</a></td></tr></table></td></tr><tr ><td class="posttext"> See that's Perfect...!<br><br>That little example formulas was a greater help than you can imaging.  Hard headed peeps like me need simple "english" ;).<br><br>BTW Got the X,Y,Z Sizing "bounding area" issue covered, but what do I need to change to raise or lower the actual Geom, or Body.?  Hense the Car's up on a higher suspension than a normal car I need to raise the (body/Geom) up.<br><br>I see dMassTranslate, and I assume it placed the actual mass of the oject and it's center of gravity at a given point , still hunting and pecking thru the ODE doc's online.<br><br>There's dGeomSetBody, but that get's assigned the Body's values, (i.e. a parenting style link?) <br><br>Then there's <pre class=code>dGeomSetPosition (dGeomID, dReal x, dReal y, dReal z)</pre> For setting the martix's?<br><br>Well still hunting ;) <br><br></td></tr></table><br>
<a name="587049"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >KuRiX</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#203">[#203]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, to raise the suspension you have to consider two things:<br><br>-&gt; The real suspension position must be set BEFORE the joint attachment.<br><br>-&gt; You can fake the geom position relative to the body position using dgeomtransform. Look the ode manual to understand the geomtransform, but basically is a geom that encapsulates other geom, so you move the geom to a position of 0,1,0 and using a geomtransform the geom is at 0,0,0 but moved internally at 0,1,0.<br><br>Good Luck! <br><br></td></tr></table><br>
<a name="587062"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#204">[#204]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>what do I need to change to raise or lower the actual Geom, or Body.? Hense the Car's up on a higher suspension than a normal car I need to raise the (body/Geom) up.<br> <br></div><br>Try changing the following code in the CarDemo.bb...<br><br><i>dBodySetPosition(ode\body,0,CarStartY,0)</i><br><br>To this...<br><br><i>dBodySetPosition(ode\body,0,CarStartY+1,0)</i><br><br><br>Ok, this thread is getting a bit long now...<br><br><b>THIS THREAD IS ABOUT TO CLOSE!!!<br><br>PLEASE USE THE NEW THREAD LOCATED <a href="/posts.php?topic=52572" target="_blank">HERE</a><br><br>THANKS</b> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
