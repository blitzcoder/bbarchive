<!DOCTYPE html><html lang="en" ><head ><title >Tokamak MAV due to FREEing RBs?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Tokamak MAV due to FREEing RBs?</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=94" >Blitz3D Userlibs</a>/<a href="#bottom" >Tokamak MAV due to FREEing RBs?</a><br><br>
<a name="734540"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Vorderman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm messing around with more Tokamak stuff, currently I'm respawning ragdolls in a sort of Operation:Wolf style testbed, but after perhaps 1000 rigid body respawns and deletions I'm getting a MAV on the ADVANCE instruction.<br><br>I've looked it up on the Tokamak forums and it appears to be the stacking bug when deleting rigid-bodies, and I think I've solved it using their method of adding a very small timestep advance before freeing a ragdoll, but can anyone (Sweenie?) explain how many stacked deletions cause it to fall over and if there are other methods of avoiding it?<br><br>I want to try an mimimise the number of extra simulation advances that I need to keep the speed up. <br><br></td></tr></table><br>
<a name="734585"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Vorderman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm, I haven't solved it - it's still MAVing at random on the advance command. Bugger :( <br><br></td></tr></table><br>
<a name="734628"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Vorderman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ah, solved it again - seems there is another bug related to creating and then deleting an RB without advancing the simulation in between, which I was doing by accident. Removing that seems to make it better. Fingers crossed for no more crashes.<br><br>I feel like I'm talking to myself here.... <br><br></td></tr></table><br>
<a name="734744"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sweenie</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I haven't used Tokamak for a long time now but I remember something about crashes when removing bodies.<br>I think you had to make sure that a body hadn't been involved in a collision in the previous timestep before removing it, or something like that. <br><br></td></tr></table><br>
<a name="734803"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paolo</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have a 'big' tokamak system coded in my game.<br>Sweenie, I have to say you did an excellent job with the wrapper, ... you are on my Credits :)<br><br>It has happened a lot of time since I had a toka-bug, and it is working pretty much stable.<br><br>One tip when working with ragdolls (or whenever you use Joints)<br><b><u><br>ALWAYS delete the Joints BEFORE the RigidBodies,<br></u></b><br>the next is INCORRECT:<br><pre class=code>
TOKRB_Free(RB) ;&lt;- this is the RB connected with the joint
TOKJOINT_Free(Joint) 
</pre><br><br>the next is the right way :)<br><pre class=code>
TOKJOINT_Free(Joint)
TOKRB_Free(RB) ;&lt;- this is the RB connected with the joint
</pre><br>But, to make it better, in my code, after freeing the Joints I'm leaving<br>the RBs alive for one more tick, and then I delete them.<br><br>If you free a joint after the RB that are connected to it, sooner or<br>later you will get a MAV at the TOKSIM_Advance().<br><br>This way, I have tested spawning and deleting more than 200 ragdolls and<br>everthing work fine, no memory leak, no MAVs, ... :)<br><br>Hope it helps!<br>Paolo. <br><br></td></tr></table><br>
<a name="734822"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Vorderman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Paolo,<br><br>I am already removing the joints first, but removing the RBs straight after rather than waiting for a while, but I've set it to remove the geoms a little bit before the ragdoll is deleted, thus removing any collisions from all the RBs. This seems to be working OK at the moment.<br><br>Edit : I've just tried your method of removing the joints first, leaving the RBs alive for 1 timestep, and that seems to work also (so far), and is neater than removing the Rbs (which was leading to some dodgy spinning limbs) so I'll leave it that way for the moment. <br><br></td></tr></table><br>
<a name="734825"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Vorderman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nope, it's still MAVing :( <br><br>Back to removing the geoms first then.... <br><br></td></tr></table><br>
<a name="734916"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paolo</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok,<br>I forgot to say that I'm also DEACTIVATING the RBs before delete them... may be that could do the job...<br><br>so basically:<br><br><pre class=code>
TOKJOINT_Free(joint)
TOKRB_ACTIVE rb, FALSE

TOKSIM_ADVANCE()

&gt;&gt; wait 1 tick &lt;&lt;

TOKRB_FREE(rb)
</pre><br><br>Paolo. <br><br></td></tr></table><br>
<a name="734955"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Vorderman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nope, still getting a MAV, this time on the TOKRB_SetLinearDamping command when creating a new RB.<br><br>This is damn annoying, renders Tokamak useless unless you want to create everything at the start - why the hell don't they fix such an obvious fault?<br><br>Looks like I might have to go back to ODE. <br><br></td></tr></table><br>
<a name="734958"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Vorderman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Seems to happen only after a while, not straight away - the program needs to create and remove a total of perhaps 1000 RBs before the MAV occurs, even though they are all being FREEd correctly, almost as if there is some memory limit that can never be reset or exceeded even if everything is deleted.<br><br>Humph, getting fed up with this now &gt;:( <br><br></td></tr></table><br>
<a name="734979"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Vorderman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Doh, a quick check of the number of Rbs revealed that I had managed to create a logic system that allowed a ragdoll TYPE to be removed without removing the RBs associated, leading to a quick increase in the number of RBs active.<br><br>Chanegd the logic and the number of RBs never climbs over 100, which seems to have fixed the crash.<br><br>Silly me :) <br><br></td></tr></table><br>
<a name="735117"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sweenie</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> This is damn annoying, renders Tokamak useless unless you want to create everything at the start - why the hell don't they fix such an obvious fault?<br> <br></div><br><br>I'm pretty sure that won't happen.<br><br>It seems Chris &amp; co abandoned Tokamak a long while ago.<br>If you check the forums it's totally infested with spam.<br><br>I think someone recently wrote a blitz3d-wrapper for Newton.<br>If that one works I would totally recommend it instead. <br><br></td></tr></table><br>
<a name="735122"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Vorderman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah, I've seen the forums, completely hacked.<br><br>Shame really, I have found that generally Tokamak is much nicer to use than ODE. I've just tried Newton and quite frankly the so-called car physics thing is abysmal - a teflon car with teflon wheels driving on ice - woohoo.<br><br>Anyway, seems I have solved the issue with Tokamak which was partly due to my crappy code, so fingers crossed it seems to be working at the moment.<br><br>Sweenie, do you know how I can position a couple of reference objects at a joint's position (parented to the first attached object) to show the axes it works in for the 2 joint-limit parameters? <br><br>I was thinking perhaps of a couple of very thin long cubes to show these axes, but I'm not sure how I would orient them relative to the parent object? <br><br></td></tr></table><br>
<a name="735140"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sweenie</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Normally you would probably just define the joint position and orientation in local space and then transform the position and orientation into the body's global space. This is simple with matrices but how to do it in Blitz3D with pitch, yaw and roll is probably not as easy. :( <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
