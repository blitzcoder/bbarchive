<!DOCTYPE html><html lang="en" ><head ><title >Sswift's Shadow System....</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Sswift's Shadow System....</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=94" >Blitz3D Userlibs</a>/<a href="#bottom" >Sswift's Shadow System....</a><br><br>
<a name="634818"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ICECAP</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, i am in the process of adding shadows to one of my consepts.  I am getting around 150fps before i implement sswift's shadow system but after i add it in i get around 26.<br>I tried running it on a top of the line system and a medium-to-crap system and it runs at the same fps on both machines.<br>In my project i have framelimiting code but it doesnt seem to matter if i take it out or not it still seems to take off around 125 frames.<br>Anyone else had this?  And anyone else fixed it? <br><br></td></tr></table><br>
<a name="634827"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Pongo</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think we might need a bit more info to give an answer for this. I use Sswift's system and I have not seem that sort of performance hit.<br><br>What resolution are you making the shadow maps? Are you using soft shadows? Soft shadows can kill things quickly. How large are the meshes involved? (poly count?) <br><br></td></tr></table><br>
<a name="634837"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> To improve speed:<br><br>1. Reduce shadow resolution. You shouldn't need to go lower than 128x128 though.<br><br>2. Disable shadow blurring.  At 128x128 they'll be blurry enough.<br><br>3. Use fewer shadows by reducing the number of lights, or the number of casters, or reducing the light radius so fewer objects get hit by each light.<br><br>4. Split your level into multiple smaller meshes, and split off portions which don't need to recieve shadows.  This is probably the most important thing.  If you have a terrain with all sorts of foliage for example, not only should that terrain be broken up into smaller sections, but those trees and ferns don't really need to recieve shadows, and allowing them to can kill your framerate.  <br><br>The reason splitting your level up will speed up the shadow system is because the shadow system first checks a bounding sphere for the object to see if the shadow frustrum is intersecting it.  If it isn't all the polygons in that object can be discarded immediately.  If on the other hand your level is one big solid object, then all 65,000 polygons in it have to be checked against the shadow frustums.   And even though I optimized the hell out of that, that's still way too much work to do.<br><br>In most cases, you should have your level split up anyway, because you're throwing away a lot of framerate if you don't.<br><br>One last thing to make sure of.  Make sure you are only running the shadow system once per render!  Mark's demos used updates at fixed intervals, and ran the inner loop multiple times per renderworld if neccessary.  But it is a total waste of time to update the shadows inside those loops.  You only have to update the shadows once before you render each frame. <br><br></td></tr></table><br>
<a name="634855"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ICECAP</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks sswift,<br>I have found that the terrain mesh is the problem... sitting at 130,000polys. :D<br>So i will have a go at splitting it up.<br>Thanks for the advice. <br><br></td></tr></table><br>
<a name="634908"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >OJay</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> using swifts system for terrain-shadows is suboptimal...because you can use pointlights only, there will be a lot of issues, if used with a sunlight...<br><br>or did i miss an update? \o/ <br><br></td></tr></table><br>
<a name="635086"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ojay:<br>Did you try putting the light really far away from the terrain, and then enabling shadows only on objects which are close to the player?  I don't see why that should not work. <br><br></td></tr></table><br>
<a name="635527"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >OJay</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> yep tried that. the problems: shadows get VERY blurry (even with res. 1024, because the caster gets very small on the shadow-tex) and the receiving (visible) terrainmeshes are having still too much polygons to check for... <br><br></td></tr></table><br>
<a name="635541"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> "shadows get VERY blurry (even with res. 1024, because the caster gets very small on the shadow-tex)"<br><br>That doesn't make sense.  The shadow frusum is sized to fit the caster.  It shouldn't matter how far away the light is from the caster.<br><br>Either there's a bug in the shadow system, or you did something funny. <br><br></td></tr></table><br>
<a name="635812"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >OJay</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> hm, cant post code, 'cause removed the system from the terrain-engine already, but i dont think i did something 'funny' o_o<br><br>1. create a pivot at approx. 1000x500x1000<br>2. make a light caster out of it<br>3. add terraintiles to shadow_receivers<br>4. add all staticobjects to shadow_casters<br>5. call update_shadows every loop.<br><br>thats it. nothing fancy about it :/ (of course in the mainloop i did some optimizations e.g. remove non-visible tiles/objects from receivers/casters using delete_shadow_receiver/caster...)<br><br>if i find time, ill try to reproduce a small demo out of it...<br><br>ps:  1.20 is the current version i got over here. is it the latest release? <br><br></td></tr></table><br>
<a name="635841"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, 120 is the latest version.<br><br>Nothing you said there sounds wrong, so I don't know what to tell ya!<br><br>I guess I should ask this... Were your objects parented to anything?  Did you add the parent as well as the children?  When you cast shadows from an object, all children are included in the shadow, which increases the radius, and can potentially reduce the resolution of the shadow. <br><br></td></tr></table><br>
<a name="636184"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> 120 is the latest?<br><br>Uhh then I must have lost that when my mailsystem crashed, still 115 here. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
