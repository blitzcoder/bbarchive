<!DOCTYPE html><html lang="en" ><head ><title >bass.dll + 3D?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >bass.dll + 3D?</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=94" >Blitz3D Userlibs</a>/<a href="#bottom" >bass.dll + 3D?</a><br><br>
<a name="929841"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've succesfully used bass to get the 'level' of a wav file, so I can drive a characters lip-sync. So far so good.<br>But now I would like to attach the sound to a 3D entity like Blitz's EmitSound() command.<br> <br>The bass help file says:<br><br>BOOL WINAPI BASS_Set3DPosition(<br>    BASS_3DVECTOR *pos,<br>    BASS_3DVECTOR *vel,<br>    BASS_3DVECTOR *front<br>    BASS_3DVECTOR *top<br>); <br>Parameters<br>pos The position of the listener... NULL = leave current. <br><br>The position of the listener????<br>Shouldn't that be the position of the Entity?<br>Any help would be appreciated. <br><br></td></tr></table><br>
<a name="930771"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Abrexxes</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> see blitz_bass_Studio_help_funktions.txt for this.<br><br>Note: It is "possible" that also with this you will habe a bug.<br><br>In this case whait for my next version, it will habe a:<br>BASS_Set3DPosition(<br>BASS_3DVECTOR *pos,<br>BASS_3DVECTOR *vel,<br>BASS_3DVECTOR *front<br>BASS_3DVECTOR *top<br>); <br><br>command, but commpatible to older BBS Versions.<br><br>bye <br><br></td></tr></table><br>
<a name="930832"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've not even got that far, though the code is built in.<br><br>Using Leadwerks old code BASS_SamplePlay(sound) works fine but cannot get BASS_SamplePlay3D(sound,pos,rot,vel) used like EmitSound() to make any sound _at all_.<br>The return value is zero.<br>So until it makes a sound there's no point me trying to set a position.<br><br>Actually I've not yet seen _any_ working example of either call, so I'm beginning to think BASS_SamplePlay3D() is broken.<br>- which is a shame because I've managed to finally grab the level and am using it for lip-sync. <br><br></td></tr></table><br>
<a name="930839"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Abrexxes</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I am sorry, but since bass 2.1 BASS_SamplePlay3D no longer exits. You must use a recent Version because the API has changed completely and older versions are not longer supported (since years).<br><br>Download BBS (Signature/Bass 2.3) and try the 3D demo included.<br><br>bye <br><br></td></tr></table><br>
<a name="931059"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for pointing me in the right direction.<br>BASS_Init(-1,44100,BASS_DEVICE_3D,hWnd) needed the BASS_DEVICE_3D flag and now I have 3d playback.<br>Unfortunately level = BASS_ChannelGetLevel(chan) now returns -1 (error).<br>Continuing working on it... <br><br></td></tr></table><br>
<a name="931194"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Abrexxes</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Try the demos (most of them use GetLevel), if there is a Problem, look in your Windows/system32 folder if there is an older bass.dll. ich yes, delete this one.<br><pre class=code>Local vuglobal = BASS_ChannelGetLevel (music);mono
Local vuleft = BASS_MakeLoWord (vuglobal)
Local vuright = BASS_MakeHiWord (vuglobal)
;Stereo</pre><br><br>Else you must give me a "Working Projekt" so i can reproduce this.<br><br>bye <br><br></td></tr></table><br>
<a name="931224"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Abrexxes - thanks, I've realised that I'm using a very old verion of bass and Leadworks old code from 3 years ago.<br><br>I have downloaded the latest veersion of bass, but of course my decls is out of date.<br>Can you point me to the latest decls? <br><br></td></tr></table><br>
<a name="931315"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Update, the latest version of bass.dll with the last known version of the decls causes a Memory Access Violation when running my prog (i.e. loading the dll).<br><br>I would appreciate any help here. <br><br></td></tr></table><br>
<a name="931402"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LineOf7s</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> John, the most recent version of any decls file that works with the latest (or near-latest) version of BASS is Abrexxes' own Blitz Bass Studio.  It's far and away the most well-maintained and complete Blitz3D/BASS solution currently available (and it's freely available from Abrexxes' signature).<br><br>Are you using that?  And if not... are you INSANE?  ;o)<br><br>If you're not, I'd seriously suggest that being your first port of call, rather than faffing about with quite old dribs and drabs of outdated decls and whatnot (and there have been a few - much appreciated - attempts to wrap BASS throughout the years). <br><br></td></tr></table><br>
<a name="931413"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Argghh!<br>LineOf7's - I had already downloaded the zip, didn't find a normal decls, only the mod one, so gave up and went back to the last version.<br><br>I now find the original zip didn't extract properly (-probably my fault, we all know about tiredness here, don't we).<br>So I now have the full package. Whew.<br>Ongoing...<br><br>Thanks for the help.<br>And it's nice that you speak so highly of Abrexxes work. <br><br></td></tr></table><br>
<a name="931431"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LineOf7s</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> The fact that Abrexxes isn't charging for it just shows me that <b>he's</b> insane, but I'll take advantage of that for as long as I can.<br><br>It really is top-notch stuff, and I'm glad my poke was enough of a heads-up for you to realise your extraction had issues (oo-er).  <br><br>Looking forward to your lip-synching technique, btw.  :o) <br><br></td></tr></table><br>
<a name="931484"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Abrexxes</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> First, thanks for this words LineOf7s, realy nice to read this. :)<br><br><div class="quote"> The fact that Abrexxes isn't charging for it just shows me that he's insane <br></div><br><br>I think it is really important for every community if there are peoples who dont ask money for every 10LineCode Wrapper. Bass is from "Ian" and i dont want to have money for "his" great (near fmod the best) audio engine. Dont forget that Bass is only "free" for non-commercial use. If you buy a licence for bass, you have still the best audio engine for a lot of languages (not only Blitz).<br><br><div class="quote"> but I'll take advantage of that for as long as I can. <br></div><br><br>I dont take money for my blitz port, not for BBS (Bass 2.3) and not for updates in the future (Bass 2.4), not today and not tommorow. Just, to clear up this point.<br><br>bye <br><br></td></tr></table><br>
<a name="931500"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't think that there are thanks enough, when someone does months of work and gives it away for free. It's inadequate, but thanks Abrexxes.<br><br>3D movement + Channel level detection (- which should be called 'amplitude') to lip-sync by the end of the day, I hope.<br>I'll post. <br><br></td></tr></table><br>
<a name="931512"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here's my modified Bass 3D demo.<br>1) The sound source position is attached to a moving 'character'.<br>2) Channel level is detected and used to open and close a 'mouth'.<br>I will be using two textures in my engine, one with mouth open, one with mouth closed, using EntityTexture() as appropriate.<br>In an ideal world I would attach a new bone to the neck of my character(s) to animate the jaw, but currently I'm using FPS Creator characters (good quality) and if I attach a new bone at all, even before I try to move it, it screws up the animation of the whole model.(?)<br>So for now I'll just make do with swapping the textures.<br>Thanks to all on this forum for pointing me in the right direction, and once again to Abrexxes for making free his brilliant work.<br>Here's the code:<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Include "bass.bb"

Graphics3D 800,600,32,2
camera=CreateCamera()
PositionEntity camera,0,0,-10
TurnEntity camera,0,0,0
CameraRange camera,0.1,10000
AmbientLight 255,0,0

character = CreateSphere(32)

BASS_Init(-1,44100,BASS_DEVICE_3D,0,BASS_NULL)
file$ = "0.wav" ; &lt;- your file here
; for this demo make sure it's a good 'speaking' file with lots of pauses.
channel = BASS_StreamCreateFile(0,file$,0,0,BASS_SAMPLE_3D)
BASS_ChannelPlay(channel,BASS_TRUE)
; BASS_Set3DFactors(0.9144, -1.0, -1.0) ; don't think this is needed.
BASS_Set3DPositionPos(EntityX(camera),EntityY(camera),EntityZ(camera)) ; set initial Listener pos

Repeat

	; Move the character around the stereo field
	deg# = deg# + 0.5
	If deg# =&gt; 360 Then deg# = 0
	cx# = Sin(deg#) * 7
	cz# = Cos(deg#) * 7
	PositionEntity character,cx#,0,cz#
	UpdateWorld
	RenderWorld

	; Update where the character is speaking from	
	pos=CreateBank(12) : rot=CreateBank(12) : vel=CreateBank(12)
	PokeFloat pos,0,EntityX(character,1) : PokeFloat pos,4,EntityY(character,1) : PokeFloat pos,8,EntityZ(character,1)
	PokeFloat rot,0,0 : PokeFloat rot,4,0 : PokeFloat rot,8,0
	PokeFloat vel,0,0 : PokeFloat vel,4,0 : PokeFloat vel,8,0
	BASS_ChannelSet3DPosition(channel,pos,rot,vel) 
	FreeBank pos : FreeBank rot : FreeBank vel

	; Update the Listener if camera moved.
	If KeyDown(203)
		MoveEntity camera,-0.1,0,0
		BASS_Set3DPositionPos(EntityX(camera),EntityY(camera),EntityZ(camera))
	Else If KeyDown(205)
		MoveEntity camera,0.1,0,0
		BASS_Set3DPositionPos(EntityX(camera),EntityY(camera),EntityZ(camera))
	EndIf
	If KeyDown(200)
		MoveEntity camera,0,0,0.1
		BASS_Set3DPositionPos(EntityX(camera),EntityY(camera),EntityZ(camera))	
	Else If KeyDown(208)
		MoveEntity camera,0,0,-0.1
		BASS_Set3DPositionPos(EntityX(camera),EntityY(camera),EntityZ(camera))	
	EndIf

	If KeyDown(57) Then BASS_ChannelPlay(channel,BASS_TRUE) ; play again

	BASS_Apply3D()

	; Instructions
	Color 255,255,255
	Text 400,600-60,"Press Spacebar to restart sound", True, True
	Text 400,600-40,"Use arrows to slide forward, backward, right, left", True, True
	Text 400,600-20,"Camera "+EntityX(camera)+" "+EntityY(camera)+" "+EntityZ(camera), True, True

	; Get the Level/Amplitude of the channel
	; Maxumum should be 32767 on either left or right
	vumono = BASS_ChannelGetLevel (channel)
	vuleft = BASS_MakeLoWord (vumono)
	vuright = BASS_MakeHiWord (vumono)
	If vuright &lt; 65535
		Text 0,020,"Left channel : "+vuleft
		Rect 0,050,vuleft/100,20,1
		Rect 0,090,vuright/100,20,1
		Text 0,120,"Right channel : "+vuright
	Else
	 vuright = 0 ; ended, so close the mouth.
	EndIf
	
	; Simulated mouth response
	Color 204,127,125
	Rect 600,50,100,50,True
	If vuright &lt; 7500 ; adjust this for the threshold below which it's closed.
		Color 0,0,0
		Rect 605,75,90,1,True
		Color 255,255,255
		Text 600,30,"Closed"
	Else
		Color 255,255,255
		Text 600,30,"Open"
		Rect 610,65,80,20,True
		Color 0,0,0
		Rect 610,70,80,10,True
	EndIf
	
	Flip
Until KeyDown(1)
BASS_Stop()
BASS_Free()
End
</textarea> <br><br></td></tr></table><br>
<a name="931517"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Abrexxes</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> What can i say? I am happy to see that my work helps others. :) <br><br></td></tr></table><br>
<a name="931699"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Err... just one more thing: turning my camera has no effect on the 3D sound.<br><br>Obviously I need something like your BASS_Set3DPositionFront%(X#,Y#,Z#) function.<br>I've fed in the X#,Y#,Z# coords of a target pivot always directly in front of the camera, thus providing orientation, but to no avail.<br><br>Sorry to bother you again Abrexxes, but can you explain how to use this call? <br><br></td></tr></table><br>
<a name="935943"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Abrexxes</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> News:<br><br>About the 3D problem: I am only working an listeners position, all the rest ist well done<br>About the TAG Problems: I will write latter a new "include" for this. (also for Tag 2.4)<br>About Protracker EX: The modinfo that i use will be included in the next version (modinfo 1.5) (but without DRAW3D you will not be able to have the speed that i have in the Pex Demo. 2D..no chance ;) )<br>About CD Playback: Yes there is a bug, dont use "device description (with bass_cd.dll)" at the moment.<br>About the release: I am sorry, i do my best but i have also a RL, i think 15 days from now.<br>AND: Next version will be compatibel to 1.6.1...so no problems (well..maybee the 3D commands,,i will see)<br><br>bye <br><br></td></tr></table><br>
<a name="935977"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Abrexxes, as I said, this is about camera turning, not camera position.<br>As I turn my camera to the left the sound should swing around to the right.<br>Possibly the BASS_Set3DPositionFront%(X#,Y#,Z#) function takes care of this, if you could just explain what x,y,z represent.<br>Thanks for all the work anyway. <br><br></td></tr></table><br>
<a name="936603"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Abrexxes</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> I know, sorry for my bad english. ;) You are right, thats the problem (i know), i will wrapp this (type/pointers) in new functions but i am making some test before to release a "stable" update. Also make the demos, the docs etc etc. <br><br></td></tr></table><br>
<a name="936681"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Blackledge</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well that's the only call I found that needs attention.<br>But new help docs would be nice - thanks. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
