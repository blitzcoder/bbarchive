<!DOCTYPE html><html lang="en" ><head ><title >can someone make any sence of this?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >can someone make any sence of this?</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=94" >Blitz3D Userlibs</a>/<a href="#bottom" >can someone make any sence of this?</a><br><br>
<a name="1053077"></a>

<a name="1053517"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Heliotrope</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> New DLL interface spec<br>----------------------<br><br>1.  There is now a directory in the root blitzpath called 'userlibs'.<br><br>2.  By adding DLLs and '.decls' files to this directory, you can extend blitz's command set.<br><br>3.  DLLs contain actually library code, while .decls files contain 'declarations' to be added to the<br>base command set. These declarations describe the functions contained in the Dll.<br><br><br>Format of decls files<br>---------------------<br><br>4.  Decls files should always start with a '.lib' directive, followed by the quoted name of the DLL to be<br>loaded, eg:<br><br>5.  .lib "mylib.dll"<br><br>6.  Following the .lib is a list of function declarations. The syntax of these is identical to<br>function declarations in Blitz, with the following exceptions:<br><br>7.  * No default parameter values are allowed.<br><br>8.  * If no function return type is specified, the function is a 'void' function - ie: it returns nothing.<br><br>9.  * Instead of object parameters, you can only specify 'void*' parameters using a '*' type tag. Such<br>parameters can be assigned ANY object or bank, so BE CAREFUL!<br><br>10.  * A declaration may be optionally followed by a 'decorated name'. This takes the form of a ':' <br>followed by a quoted string denoting the decorated name, eg:<br><br>11.  MyFunction( text$ ):"_MyFunction@4"<br>MessageBox%( hwnd,text$,title$,style ):"MessageBoxA"<br><br>12.  The decorated name is the name of the function as it appears in the dll, and only needs to be<br>specified if it is different from the actual function name.<br><br><br>Writing DLLs<br>------------<br><br>13.  All functions MUST use the _stdcall calling convention.<br><br>14.  Floats are passed and returned as per standard C/C++ conventions.<br><br>15.  Strings are passed and returned in 'C' format - ie: a pointer to a null-terminated sequence of<br>characters.<br><br>16.  Returned strings must be in a 'static' memory buffer. Once the function returns, this string is<br>immediately copied into an internal Blitz style string, so its OK to share this buffer between<br>multiple functions.<br><br>17.  Both banks and objects can be passed to functions. The value passed is the address of the first byte<br>of storage. No information is sent regarding the size or type of memory passed so, again, BE CAREFUL!<br><br>18.  Neither Banks or objects can be returned from functions.<br><br>19.  Arrays are not supported at all.<br><br>20.  VisualC decorates symbols quite heavily! If you are coding in 'C', the necessary stdcall specifier<br>will cause a '_' to be prepended, and a '@' (followed by the number of bytes passed to the function<br>- ie: number of parameters*4) to be appended. So, something like: 'void _stdcall MyFunc( int x )'<br>will end up as '_MyFunc@4'. In C++, the name decoration is even messier! But you can supress it by <br>using the 'extern "C"' feature (see examples below) so you're just left with the 'C' stdcall mess.<br><br>21.  Other languages such as Delphi and Purebasic don't appear to suffer from this feature, but it can be<br>worthwhile looking through dll symbols if you're having problems. Check out PEview at<br><a href="http://www.magma.ca/~wjr" target="_blank">http://www.magma.ca/~wjr</a>  Open your dll and select 'SECTION .rdata'/'EXPORT address table'<br>to have a look at the exported symbols your compiler has seen fit to bestow upon your dll.<br><br>Example<br>-------<br><br>22.  Ok, here's a little C++ example, as it would appear in VisualC.<br><br>23.  First, we write the DLL:<br><br>24.  //demo.dll<br>//<br>#include &lt;math.h&gt;<br>#include &lt;string.h&gt;<br>#include &lt;stdlib.h&gt;<br><br>25.  #define BBDECL extern "C" _declspec(dllexport)<br>#define BBCALL _stdcall<br><br>26.  //returns a float and has 6 float parameters<br>BBDECL float BBCALL VecDistance( float x1,float y1,float z1,float x2,float y2,float z2 ){<br>	float dx=x1-x2,dy=y1-y2,dz=z1-z2;<br>	return sqrtf( dx*dx+dy*dy+dz*dz );<br>}<br><br>27.  //returns a string and has one string parameter<br>BBDECL const char * BBCALL ShuffleString( const char *str ){<br>	static char *_buf;<br><br>	int sz=strlen(str);<br><br>	delete[] _buf;<br>	_buf=new char[ sz+1 ];<br>	strcpy( _buf,str );<br>	<br>	for( int k=0;k&lt;sz;++k ){<br>		int n=rand()%sz;<br>		int t=_buf[k];_buf[k]=_buf[n];_buf[n]=t;<br>	}<br><br>	return _buf;<br>}<br>28.  After building this, the resultant 'demo.dll' should be placed in the userlibs directory.<br><br>29.  Now, we also need to create a 'demo.decls' file, describing the functions in our dll. This file<br>is also placed in the userlibs directory:<br><br>30.  .lib "demo.dll"<br>VecDistance#( x1#,y1#,z1#,x2#,y2#,z2# ):"_VecDistance@24"<br>ShuffleString$( str$ ):"_ShuffleString@4"<br><br>...Voila! The next time Blitz is started up, the new commands appear within the IDE and can be used.<br><br><font class="tiny">Last edited 2010</font> <br><br></td></tr></table><br>
<a name="1053113"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Those are the instructions from the userlibs folder for creating .decls and .dll files. Except for some reason you've got numbers at the start of each paragraph.<br><br>Which part of it is unclear? It looks pretty straightforward, especially if you don't need to make the .dll yourself. <br><br></td></tr></table><br>
<a name="1053518"></a>

<a name="1053519"></a>

<a name="1053520"></a>

<a name="1053521"></a>

<a name="1053522"></a>

<a name="1053523"></a>

<a name="1053524"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Heliotrope</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> 2. I have not heard of a .decls file, is it .decls, .decl or .dec<br>4. what is lib<br>9. what does this mean in english<br>10-12. I still dont get it<br>13.  what is _stdcall<br>17. what is ment by an object<br><br><font class="tiny">Last edited 2010</font> <br><br></td></tr></table><br>
<a name="1053540"></a>

<a name="1053541"></a>

<a name="1053542"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> OK...<br><br><div class="quote"> 2. I have not heard of a .decls file, is it .decls, .decl or .dec<br> <br></div><br><br>A .decls file is a text file with the extension ".decls". This is the file containing the definitions of functions from your DLL. Wrapper DLLs will come with one or more of these, and they also exist for Windows DLLs (in which case you only need this file, as the DLL is already hanging around). You can create a new one with "New Text Document" and rename it by hand; the actual name of the file isn't important, as long as you can remember what it is.<br><br><div class="quote"> 4. what is lib <br></div><br><br>At the start of the .decls file, there's a directive to tell Blitz which DLL to link to the following function definitions. It takes the following format:<br><br><pre class=code>.lib "nameofmydll.dll"

;Followed here by the definitions</pre><br><br>You can have more than one of these in the same file, if you want to link different functions to different DLLs. Alternatively, some people also link to an empty set of quotes: this causes the default IDE to highlight that function name, so that libraries written in B3D look better - the effect is only aesthetic (and not necessary if using something like IDEal anyway).<br><br><div class="quote"> 9. what does this mean in english <br></div><br><br>If you're not very confident with pointers in C or C++, <b>don't touch this one</b>.<br><br>It means a type instance or a bank can be passed to a DLL in one of these parameters and Blitz3D will dereference the pointer first (i.e. work some magic so that you get a pointer to the actual data in the bank or type instance, not just an int handle). Passing null or any int that doesn't point to a valid bank will crash everything.<br><br><div class="quote"> 10-12. I still dont get it <br></div><br><br>In the definitions section of your .decls file, you define functions from your DLL for use in Blitz3D. This takes the following form:<br><br><pre class=code>myDLLFunction#(a%, b#, c$) : "_myFunction@12"</pre><br><br>On the left is the B3D declaration, showing the name you want to use for it, the return type, and the argument types (and names, so the help bar is useful). This is then followed by a colon. The quoted string after the colon contains the name of the function as it is actually exported by the DLL, which may not necessarily be one you want to use or even a legal B3D function name. Blitz3D now knows to link your references to "myDLLFunction" to the exported function "_myFunction@12".<br><br><div class="quote"> 13. what is _stdcall <br></div><br><br>You don't need to know this unless you're creating a DLL:<br><br>_stdcall is a "calling convention". At the assembly level, things like function calls don't exist; you load up values into registers, jump execution to somewhere else, extend the stack etc. all with separate instructions. A "calling convention" describes the standard order of these operations expected by a function. This is important, because if one function expects to be called with everything already set up, it will break if everything wasn't already set up; similarly if the function calling it expected it to unwind the stack and it didn't, again data will be in the wrong place and things will break.<br><br>Normally you don't need to think about this as all functions written with a single compiler use the same calling convention. However, since the whole point of DLLs is to use code written in another language and another compiler, we need to know that the functions will work together at the machine level. Languages like C let you specify calling conventions manually when defining functions, in order to make sure this works.<br><br>_stdcall therefore is the calling convention that B3D expects DLLs to use in order to work properly, and anything else is asking for trouble. Most C compilers by default use a different convention called _cdecl, so remembering this step is important for DLL writers.<br><br><div class="quote"> 17. what is ment by an object <br></div><br><br>An object is an instance of a reference type. i.e. when you create a new instance of a type:<br><br><pre class=code>Local a.myType, b.myType

a = New myType
b = a</pre><br><br>The data in a can be passed around as a discrete lump and assigned to b, but it's still the same lump of data referenced by a. Because we can throw it around in lumps this way, it can be called an object. If this makes no sense to you, you should read up on B3D's Types first.<br><br><font class="tiny">Last edited 2010</font> <br><br></td></tr></table><br>
<a name="1054302"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Heliotrope</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> cont.<br><br>20. what is decorating.<br>24. is part of the code. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
