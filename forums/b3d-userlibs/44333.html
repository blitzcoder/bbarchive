<!DOCTYPE html><html lang="en" ><head ><title >Blitz3d Internal Structure</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Blitz3d Internal Structure</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=94" >Blitz3D Userlibs</a>/<a href="#bottom" >Blitz3d Internal Structure</a><br><br>
<a name="493648"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Apocalypse</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have been experimenting with passing Blitz3d handles to User Libs and trying to figure out if it is possible to directly manipulate (DataBanks, Image Buffers, etc). I have started with Banks and Images and have found out the following...<br><br>1. A Bank handle passed to a userlib is a pointer to a structure 16 bytes long. <br><br>2. The 2nd WORD of this structure appears to be a valid memory handle, and returns a size 8+bytes more than the Bank Size.<br><br>3. The 3rd WORD of this structure appears to be the size of the Bank.<br><br>I have also passed a handle to an Image and there is a similar underlying structure, however there seems to be more layers of pointers. I assume an Image handle must respresent some form of DirectX7 Surface description but I can't find a C+ declaration to see if there are any similarities.<br><br>Has anyone else done any tinkering with these handles? Can you share any of your findings?<br><br>Thanks<br>-Vince <br><br></td></tr></table><br>
<a name="493657"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hotcakes</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="http://www.blitzbasic.com/archive/posts.php?topic=20361" target="_blank">http://www.blitzbasic.com/archive/posts.php?topic=20361</a><br><br>&lt;lengthy search&gt; How come that's the only relevant result I can find?  There was another thread that brought the concept in the above thread to a much higher level - many people got involved and all sorts of blitz internal structures were given detailed explanations.  But I can't for the life of me find the link.<br><br>Well, the problem is that these structures tend to change from update to update - so the thread I was looking for is no doubt obsolete now anyway.  But it was a good read... <br><br></td></tr></table><br>
<a name="493667"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DJWoodgate</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="http://www.blitzbasic.com/Community/posts.php?topic=34301" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=34301</a><br><br>May be of interest.  Have a look at his demo code for the video memory address of images.  Still works with the latest version of blitz3d.<br><br>Not sure what happened to the other thread, probably posted in a now defunct forum. <br><br></td></tr></table><br>
<a name="493902"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Apocalypse</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I really wouldn't need to do any of this if Blitz3D offered ways of swapping data from RAM(ie.Pointer) to Banks, RAM to Images, and Banks to Images. IMO this would increase the languages power immensly. I would be able to use other languages to do real-time image processing, filtering, even implementing ASM graphics/data routines. <br><br></td></tr></table><br>
<a name="493984"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Picklesworth</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> It would, it would. <br><br></td></tr></table><br>
<a name="494368"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tom</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Apocalypse, here's how you can get an IDirectDrawSurface7 pointer from a Blitz3D texture handle, including anim textures:<br><br>B3D..<br>tex1=LoadTexture("mytex1.jpg")<br>SomeFunction(tex1, 0)<br><br><br>C++<br><pre class=code>
BBDECL HRESULT BBCALL SomeFunction(unsigned int buffer,
         unsigned int srcFrame)
{
  HRESULT hr;
  if(buffer==0) return 1;
  buffer = (unsigned int) *((int*)(buffer));
  buffer = (unsigned int) *((int*)(buffer+12));
  buffer = (unsigned int) *((int*)(buffer+(4 * srcFrame)));
 
  IDirectDrawSurface7 *srcSurf = NULL;
  srcSurf = (IDirectDrawSurface7*) *((int*)(buffer+12));

  ...
</pre><br><br>Testing incoming pointers for texture or image aint reliable, so you best do texture or image specific code. To use images as the source just adjsut the C++ code like so<br><br><pre class=code>
BBDECL HRESULT BBCALL SomeFunction(unsigned int buffer,
         unsigned int srcFrame)
{
  HRESULT hr;
  if(buffer==0) return 1;
  buffer = (unsigned int) *((int*)(buffer+4));
  buffer = (unsigned int) *((int*)(buffer+(4 * srcFrame)));

  IDirectDrawSurface7 *srcSurf = NULL;
  srcSurf = (IDirectDrawSurface7*) *((int*)(buffer+12));
  ...
</pre><br>  <br><br>Tom <br><br></td></tr></table><br>
<a name="494499"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Apocalypse</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't suppose you could show me your examples coded in PowerBasic could you? I hate trying to read C++ code. Are taking the initial pointer value and dereferencing it once, then dereferencing it again with a  +4 to the pointer value, then dereferencing it again with the value+(4*FrameNum), then dereferencing it again and casting it to a DX7 surface? <br><br></td></tr></table><br>
<a name="495660"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Apocalypse</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Much progress has been made thus far. Check it out over in the Worklogs section...<br><br><a href="http://www.blitzbasic.com/logs/userlog.php?user=7138&amp;log=440" target="_blank">http://www.blitzbasic.com/logs/userlog.php?user=7138&amp;log=440</a> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
