<!DOCTYPE html><html lang="en" ><head ><title >Bloomfilter out of alignment</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Bloomfilter out of alignment</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=82" >Blitz3D Programming</a>/<a href="#bottom" >Bloomfilter out of alignment</a><br><br>
<a name="741201"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Leto</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi, I found Bouncer's Bloomfilter code and had a quick try of it but the alignment seems to be really out of whack.  Anyone more familiar with this could point me in the right direction to fix please?<br><br><img src="http://kauler.com/games/explosiverpg/bloomfilter_problem.jpg"> <br><br></td></tr></table><br>
<a name="741230"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Danny</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Reading from Bouncer's code, I'm guessing you either changed the size of the blur texture ("If you adjust the tex size you have to mess with the position values inside blur texture function to get the blur positioned right").<br>OR you're using a different cameraZoom other than 1.0 on your default camera?!<br><br>It doesn't look so from your screenshot but I can imagine if you alter the cameraViewport settings to anything but default you'll get misalignment problems as well?!<br><br>d. <br><br></td></tr></table><br>
<a name="741231"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Leto</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes you're right it seems related to my camera settings (I just assumed Bloomfilter would do some special to align things!) and the angle and zoom are causing problems.  Thanks, Danny. <br><br></td></tr></table><br>
<a name="741236"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Warren</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I just plugged this code into my own project and MY bloom filter window appears as a little postage stamp in the middle of the window.  Is it understood that you'll have to mess with the sprite positioning/scaling on a project by project basis or should it "just work"? <br><br></td></tr></table><br>
<a name="741237"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Leto</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Warren.  Yes I've just investigated more and the "GLsprite" is fixed at a certain location (suitable for CamZoom 1).<br><br>I am fiddling with it now but basically looks like we need to update GLsprite every time the main cam zoom changes.<br><br>In my case I also had to call "InitGlow(cam)" right after my CreateCamera and before some position/angling. <br><br></td></tr></table><br>
<a name="741238"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Danny</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I haven't studied the code, but guessing by both your comments I'd say it doesn't take the cameraZoom into account...<br><br>The effect works amazingly well and fast, so well worth the tinkering to get it right for your settings...<br><br>d. <br><br></td></tr></table><br>
<a name="741241"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Danny</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here's a quick fix for it to take the camera zoom into account; in Bloomfilter.bb add this function:<br><br><pre class=code>Function SetGlowZoom(zoom#)
	if GLSprite &lt;&gt; 0 then ScaleSprite GLsprite, 100.0/zoom#, 100.0/zoom#
End Function</pre>And use it to set/update the glow sprite's size in relation to the current camera zoom. Note: The SetGlowZoom() functions MUST be called AFTER GlowInit().<br><br>have fun,<br><br>D. <br><br></td></tr></table><br>
<a name="741242"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Leto</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> The bloom code just doesn't scale/position the "GLsprite" (sprite showing the bloom texture overlay) when your main camera changes zoom, yeah.<br><br>In InitGlow() there are these two commands<br>&gt; PositionEntity GLsprite,0,0,100<br>&gt; ScaleSprite GLsprite,100,100<br>which seem to align it perfect for default cam zoom.<br><br>I'm unsure how to calculate an appropriate scale/position when the cam changes zoom... <br><br></td></tr></table><br>
<a name="741244"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Danny</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Leto, I think our posts just crossed ;)<br>See above for solution..<br><br>d. <br><br></td></tr></table><br>
<a name="741246"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Leto</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Danny! You champ haha, too easy.  I was on the right track just couldn't work it out myself.  Cheers. <br><br></td></tr></table><br>
<a name="741415"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bouncer</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> The bloomfilter certainly needs some fiddling depending on how you use camera... but glad you got it working. <br><br></td></tr></table><br>
<a name="741565"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Warren</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, this was the key for me:<br><br>"In my case I also had to call "InitGlow(cam)" right after my CreateCamera and before some position/angling."<br><br>Thanks!  If you do anything to the camera before calling InitGlow, you get alignment problems. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
