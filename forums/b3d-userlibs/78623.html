<!DOCTYPE html><html lang="en" ><head ><title >JV-ODE naval simulation</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >JV-ODE naval simulation</h1><a href="forums.php" >Blitz3D Forums</a>/<a href="topics.php?forum=94" >Blitz3D Userlibs</a>/<a href="#bottom" >JV-ODE naval simulation</a><br><br>
<a name="882420"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Santiworld</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> hi, sorry VIP3R if i make many questions...<br>this is another question about conceps of ode physics...<br><br>i make a ship, using the water sample..<br>and i move the ship using...<br><br>dbodyaddtorque and dbodyaddforce<br><br>my cuestion is, there is a best way or a correct method to make a motor ship sail on the wather? <br><br>thanks again... <br><br></td></tr></table><br>
<a name="882446"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> One method is to apply force to the rear/center of the ship using the various force functions, taking into consideration the action of the rudder. Another method would be to add a large sphere to the rear of the ship (half submerged) with a hinge2 joint then rotate the sphere to drive/steer the boat, exactly like the front wheel of the car demos. You might need to give the sphere geom lots of friction for this to be effective (see the Demo-GeomFriction demo).<br><br>Also, experiment with different mass values for the water and the ship.<br><br>Feel free to ask any questions in the JV-ODE thread btw :) <br><br></td></tr></table><br>
<a name="882616"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Santiworld</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> i experiment all day with diferents ways to do this...<br><br>i use for the hull, a sphere, cube and cylinder...<br><br>with the cube i have the best results... <br>changing the friction, mass, and dimencions of cube, i can find diferentes way to move the ship...<br><br>but allways have a problem with this...<br><br>i dont know how tell to ode the fact of my hull, have less longitudinale resistanse less than lateral resistense...<br><br>so, if i have a small resistance, the ship go to the front nicely, but when i turn, the ship slide like if the water was ice...<br><br>but, if i give to much resistense to the hull, and incress the power, i have better result...<br><br><br>so, the question is, how is the best way to do the hull of the ship...<br>using a ode box, sphere, cilinder, a trimesh, or a combination of many of this....<br><br>thanks again, this days i learn many things about ode, i think ode is great, but is obvious, i'm rookie...<br><br>PD. if i use a box, when the ship turns have some problems with reality stability of the ship, that is the major problem when i use a box<br><br><img src="http://www.latatoy.com.ar/screen/example.jpg"><br><br>i make an image to shop the option i try... <br><br></td></tr></table><br>
<a name="882630"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've never tried making a boat/ship simulation, so it's difficult to suggest the best hull design. I wouldn't use a TriMesh, only use primitives. It should be possible to create an accurate hull with several primitives using Geom Offsets.<br><br>If you get stability problems, try adding a heavy body to the lower part of the ship to help stabilise it. Use a fixed joint to attach it to the ship body.<br><br>To help the sliding, try using both friction direction settings (see Friction Direction 1 demo), or increase the friction of the water body. <br><br></td></tr></table><br>
<a name="882775"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Santiworld</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> thanks Vip..<br>in few days i'm going to share all the things i've done with ode about boats and ships...<br><br>i can't find the way to set the longitudinal and lateral friction to an ode object.. i see the friction demo, the boxes with difenent values..<br><br>the only command i find to set friction is this "dGeomContactSetMu(ode\geom,count*0.5)"<br><br>i found in the manual, point "7.3.7 Contact" the things i could use, but i dont understand it yet...  <br><br><br>about the hull, it floats perfectly on the water, but i found that it doesnt matter to dinamycs if the ship is going forward or side...<br><br>i think is because the ode must take all surface under water to make friction. maybe i can find the way to simulate hydrodinamic if i find the way to set friction direction...<br><br>thanks for the help, is good that you are available to discuss these topics...<br><br>im posting a modification of the water demo, to see the thing about friction...<br><br>im a naval technician, in school we calculate all data about ships using the cube of dimension of hull, frontal surface , to hydrodynamic friction, like cars...<br><br><br><pre class=code>; ###################################################################################################
; #										JV-ODE - Water Demo											#
; #									Code by Jim Williams (VIP3R)									#
; #								Devious Codeworks - Copyright © 2007								#
; ###################################################################################################

AppTitle "JV-ODE - Water Demo"

Include "JV-ODE.bb"

Graphics3D 800,600,0,2

Type ODEGeom
	Field body
	Field geom
	Field mesh
End Type

; ###################################################################################################

; ### Setup ODE

Global World=dWorldCreate()
Global Space=dHashSpaceCreate(0)
Global ContactGroup=dJointGroupCreate(0)

dWorldSetAutoDisableFlag(World,1)
dWorldSetGravity(World,0,-0.98,0)
dContactSetMode(dContactSlip1)
dContactSetMu(0.5)

; ### Create light

Global Light=CreateLight()

RotateEntity Light,45,-90,0
LightColor Light,255,255,255
AmbientLight 130,130,130

; ### Create camera

Global Camera=CreateCamera()
CameraClsColor Camera,0,0,0
CameraRange Camera,1,1000
PositionEntity Camera,0,45,-70
RotateEntity Camera,30,0,0

; ### Create plane

dCreatePlane(Space,0,1,0,0)

Plane=CreatePlane()

EntityAlpha Plane,0.8

PlaneTexture=CreateTexture(128,128,9)

ClsColor 0,200,80
Cls

Color 255,255,255

Rect 0,0,64,64,1
Rect 64,64,64,64,1

CopyRect 0,0,128,128,0,0,BackBuffer(),TextureBuffer(PlaneTexture)
ScaleTexture PlaneTexture,20,20
EntityTexture Plane,PlaneTexture,0,0

Mirror=CreateMirror()

; ###################################################################################################

; ### Create water

limite_agua =500

water_friction# = .09 ;  ### Water friction

ode.ODEGeom=New ODEGeom
ode\geom=dCreateBox(Space,limite_agua,15,limite_agua)
dGeomSetRotation(ode\geom,0,0,0)
dGeomSetPosition(ode\geom,0,7.5,0)
dGeomContactSetMode(ode\geom,dContactBounce+dContactSoftCFM)
dGeomContactSetBounce(ode\geom,0.6)		; ### Water bounce
dGeomContactSetSoftCFM(ode\geom,0.8)	; ### Water density
dGeomContactSetMu(ode\geom,water_friction)		
ode\mesh=CreateCube()
ScaleMesh ode\mesh,(limite_agua*.5),7.5,(limite_agua*.5)
EntityColor ode\mesh,0,100,200
EntityAlpha ode\mesh,0.7
EntityShininess ode\mesh,0.7



;Crear objeto de prueba	

	x_ancho# = 5
	x_alto#  = 3
	x_largo# = 20
	x_mass#  = 40
	x_friccion# =10
	
	
	ode.ODEGeom=New ODEGeom
	
	ode\body=dBodyCreate(World)
	dBodySetRotation(ode\body,19,45,0)
	dBodySetPosition(ode\body,0,10,00)
	mass=dMassCreate()
	dMassSetBoxTotal(mass,x_mass#,x_ancho,x_alto,x_largo)
	dBodySetMass(ode\body,mass)
	dMassDestroy(mass)
	
	dBodySetAutoDisableFlag(ode\body,0)
	
  ode\geom=dCreatebox(Space,x_ancho,x_alto,x_largo)
	CGeom=ode\geom
	dGeomSetBody(ode\geom,ode\body)
	dGeomContactSetMu(ode\geom,x_friccion#)
	
	ode\mesh=Createcube()
	scaleentity ode\mesh,x_ancho*.5,x_alto*.5,x_largo *.5
	
	EntityColor ode\mesh,250,100,0
	EntityAlpha ode\mesh,1
	EntityShininess ode\mesh,0.1

   vgiro# = a_timon# = velocidad# = potencia# = a_timon# = 0

; ###################################################################################################

While Not KeyHit(1)

	f#=.34    ; variable to incresse the factor to push
	
	f2#=4   ; factor to incress the turn
	
	
	fx#=sin(entityyaw#(ode\mesh))*potencia*f    ;find vector direction to push the ship
	fz#=-cos(entityyaw#(ode\mesh))*potencia*f
	
	dbodyaddtorque (ode\body,0,-a_timon * f2#,0)  ;apply to turn
	dbodyaddforce (ode\body,fx,0,fz)              ;apply to push the objet
	

   pointentity camera,ode\mesh
   

	if keydown(200) and potencia &lt; 100 then potencia=potencia + 1
	if keydown(208) and potencia &gt; -60 then potencia=potencia - 1
	if keydown(205) and a_timon &gt;-60  then a_timon = a_timon - 1
	if keydown(203) and a_timon &lt; 60  then a_timon = a_timon + 1

   	

	PTime=MilliSecs()
    If MilliSecs()-Timer&gt;700
		Timer=MilliSecs()
		End If

	UpdateGeoms()

	dSpaceCollide(Space,World,ContactGroup)
	dWorldQuickStep(World,0.1)
	dJointGroupEmpty(ContactGroup)

	PhysicsTime#=MilliSecs()-PTime

	UpdateWorld

	RenderWorld

	Text 0,0,"JV-ODE Version "+dGetVersion()
	Text 0,15,"Physics Time:"+PhysicsTime

	text 0,40,"UP &amp; DOWN to go forward."
	text 0,60,"LEFT &amp; RIGHT to turn"

	Flip

Wend

dJointGroupDestroy(ContactGroup)
dSpaceDestroy(Space)
dWorldDestroy(World)
dCloseODE()

End


Function UpdateGeoms()

For ode.ODEGeom=Each ODEGeom
	RotateEntity ode\mesh,dGeomGetPitch#(ode\geom),dGeomGetYaw#(ode\geom),dGeomGetRoll#(ode\geom)
	PositionEntity ode\mesh,dGeomGetPositionX#(ode\geom),dGeomGetPositionY#(ode\geom),dGeomGetPositionZ#(ode\geom)
Next

End Function

</pre><br><br>i going to keep trying to make it work, gladly i'm going to share all things i learn about naval emulation with ode...<br><br>regards..<br>Santiago <br><br></td></tr></table><br>
<a name="882822"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm, maybe the Friction Direction 1 demo probably wasn't the best suggestion as it only uses one friction setting for both directions.<br><br>To use both friction directions individually, add '<i>dContactMu2</i>' and/or '<i>dContactFDir1</i>' to the <i>dContactSetMode()</i> call in your simulation, then use...<br><br><i>dGeomContactSetMu(geom,mu#)</i> and <i>dGeomContactSetMu2(geom,mu#)</i><br><br>to set the friction for each direction and...<br><br><i>dGeomContactSetFDir1(geom,fdir1x#,fdir1y#,fdir1z#)</i><br><br>...if you want to set the orientation of the friction. <br><br></td></tr></table><br>
<a name="882876"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Santiworld</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> :) excelente, i going to try now... Thanks Vip3r!!! <br><br></td></tr></table><br>
<a name="883882"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Santiworld</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> hi, i working in this, i have another question..<br><br>i use dGeomContactSetFDir1(geom,fdir1x#,fdir1y#,fdir1z#)<br>but it seems that give friction in absolute axis x y z of the world...<br>and is not relative to the ode\body, so.. when i turn the ship, the fricction X continius in x word axis, and no turn with the ship... is no relative to object?..<br><br>saludos... <br><br></td></tr></table><br>
<a name="883906"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes that's correct behaviour.<br><br>From the ODE manual...<br><div class="quote"> <br>If set, take fdir1 as friction direction 1, otherwise automatically compute friction direction 1 to be perpendicular to the contact normal (in which case its resulting orientation is unpredictable).<br> <br></div><br>To make it relative to the ship body, you need to constantly update 'fdir1x#,fdir1y#,fdir1z#' with the ships current rotation vector.<br><br>If your ship is heading along the Z axis and you want friction direction 1 to be used for forwards/backwards friction, then you would use 'fdir1x#=0.0 fdir1y#=0.0 fdir1z#=1.0', friction direction 2 would be along the X axis in this instance. Now if you turn the ship 90 degrees to the right, the fdir1 values would be 'fdir1x#=1.0 fdir1y#=0.0 fdir1z#=0.0'. Friction direction 1 is now along the X axis, and friction direction 2 is now along the Z axis.<br><br>There are some topics in the programming forums explaining the maths involved, don't forget that fdir1x/y/z have a range of 0.0 to 1.0 though. <br><br></td></tr></table><br>
<a name="884836"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Santiworld</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> hi vip...<br><br>i just want share the temporal solution i found to the lateral friction...<br><br>i had some problems, with the axis friction, becouse for one reason, the ship try to folow the axis heading, 0 90 180 280...<br>i think is because the friccion brake the ship in the axis with less force, and the other axis with more power, pass the fricttion vector more fast and the ship take a strange heading...<br><br><br>the temporari solution for lateral friction is...<br><br>1.   i use the orientation of the ship.... (rumbo)<br>2.   next, i take the real direction of the ship (direccion)<br>3.   i convert the angles to (0-360)<br>4.   i use (rumbo - direccion) * (velocidad) to set the fricciont of ode\geom<br>5.   reaplace the (speed_object) to new position of ship, and orientation..<br><br>(speed_object)  give the distance(speed) and real direction of ship...<br><br>make a objet, "<br><br><pre class=code>
;this is to place the temp object over the ship 
positionentity speed_object, entityx#(ode\mesh,1),entityy#(ode\mesh,1),entityz#(ode\mesh,1)
	UpdateGeoms()
	positionentity speed_object,entityx#(speed_object),entityy#(ode\mesh,1),entityz#(speed_object)
   pointentity speed_object,ode\mesh

;this is to take the speed and heading and heading 2
rumbo# = entityyaw#(casco,1)
	if rumbo &lt; 0 then rumbo = rumbo + 360
	
	direccion# = entityyaw(speed_object,1)-180
	if direccion# &lt; 0 then direccion = direccion + 360
	
	diferencia# = abs(direccion - rumbo)
	if diferencia# &gt; 180 then diferencia = 180 - (diferencia-180)
	
	diferencia2# = diferencia2# + diferencia# *.1
	diferencia2# = diferencia2# *.95
	
	xvelocidad# = xspeed# * 100
	
	diferencia3# = (diferencia2#*.1) * (.01+(xvelocidad *.03))


	dgeomcontactsetmu(ode\geom,diferencia3#)
</pre><br><br><br>when i learn more of ODE, maibe i find the solution of the friction and axis resulting...<br><br><br>thanks vip, i hope this simple solution it works for anyone else with the same problem...<br><br>saludos.. :)<br>santiago <br><br></td></tr></table><br>
<a name="884935"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VIP3R</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> You're welcome and thanks for the info :) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
