<!DOCTYPE html><html lang="en" ><head ><title >BlitzThreads (Windows only)</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >BlitzThreads (Windows only)</h1><a href="forums.php" >Community Forums</a>/<a href="topics.php?forum=61" >Showcase</a>/<a href="#bottom" >BlitzThreads (Windows only)</a><br><br>
<a name="474107"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AntonyWells</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Blitzthreads lets you spawn windows-driven threads(Including dynamic priority per thread) within bmax.<br>This version is freeware.<br><br>With this you can run functions side by side your main app.<br>You can run upto 2024 threads at once(Although I wouldn't suggest it...:) )<br><br>www.excess.eclipse.co.uk/dreamspace.mod.zip<br><br>It's object driven, although there are function wrappers for those used to that.<br><br>Classes are(There's no docs)<br><br>TThread. <br><br>Global functions(Contained within TThread. I.e TThread.<br><br>Create() )<br>Create( BlitzFunction ) Create a thread and return a TThread object.<br>RunAll() 'Runs all threads<br>PauseAll() 'Pauses all threads<br>StopAll() 'Stops all threads<br><br>Local functions specific to each thread instance,<br><br>Run() 'Runs the function provided when creating the thread, in another thread.<br><br>Priority( Value:Int) 'Set the threads priority, value ranges from 1 to 7. (default = 3, pre-set)<br><br>Pause() 'Pause the thread<br><br>Resume() 'Resume the thread,<br>-<br>Global functions within TThread to allow async data access,<br>All return a TResource object/integer handle.<br><br>ProtectInt( x variable )<br>ProtectFloat( x variable )<br>ProtectBank( Bank:TBank )<br>ProtectStream( Stream:TStream )<br>-<br><br>With the tResource object returned, you can lock access rights to it within your thread,<br><br>Wrapper functions are,<br><br>ThreadHandle =CreateThread( Function )<br>PauseThread( ThreadHandle )<br>ThreadPriority( ThreadHandle,Priority )<br>PauseThread(Threadhandle)<br>ResumeThread(ThreadHandle)<br>StopThread(ThreadHandle)<br>RunThread(ThreadHandle)<br><br>There's also a manual locking system, in addition to protected storage.<br><br>Lock = CreateLock()<br><br>RequestLock(Lock)<br>ReleaseLock(lock)<br><br>which allows you to restrict threads of the same locking patterns to one run at a time.(Prevent deadlocks..if you're lucky :) )<br><br>TestApp<br><br>Simple mode<br><pre class=code>
Update = CreateThread( UpdateVal )
NetWork = CreateThread( PrintVal )
RunThread(Update)
RunThread(NetWork)


Global ourVal

Function updateVal:Int(bb_func:Byte Ptr)

	repeat
		ourVal:+1
	forever
	
End function

Function printVal:Int (bb_func:Byte Ptr)

	repeat
		Print "Val:"+OurVal
		Delay 1000
	forever

End Function 

Print "Thread Handle&gt;"+Res

repeat
	Delay 5000
	Print "Master thread!"
Forever
</pre><br><br>Advanced Mode<br><br><pre class=code>
Update:TThread = TThread.Create( UpdateVal )
NetWork:TThread = TThread.Create( PrintVal )
Update.Run()
Network.Run()


Global ourVal

Function updateVal:Int(bb_func:Byte Ptr)

	repeat
		ourVal:+1
	forever
	
End function

Function printVal:Int (bb_func:Byte Ptr)

	repeat
		Print "Val:"+OurVal
		Delay 1000
	forever

End Function 

Print "Thread Handle&gt;"+Res

repeat
	Delay 5000
	Print "Master thread!"
Forever
</pre><br><br>To install, copy dreamspace.mod folder into your bmax mod folder(Windows only atm) and you're done. <br><br></td></tr></table><br>
<a name="474124"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LarsG</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> First tests work great here.. Nice work, Antony.. :) <br><br></td></tr></table><br>
<a name="474133"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kanati</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> very nice addition to bmax. <br><br></td></tr></table><br>
<a name="474179"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paul "Taiphoz"</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> am I awake ? ..<br><br>ok I have a few questions if you dont mind ant.<br><br>1. Can I start a thread that will play an AVI aka game into and then continue to load my game media ?<br><br>2. Can more than one thread drop stuff to the back buffer ?<br>for example a game I did in Java, I had a "Insert Coin" that flashed on the screen, but the flash was controlled by a thread so it didnt have anything in the main loop telling it to flash. So can this be done ?<br><br>Is it stable enough to put something like AI into a thread and let it mince away on some complex AI choice tree while the rest of the game runs alone as normal, think chess ? <br><br></td></tr></table><br>
<a name="474197"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AntonyWells</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks lars, Kanati.<br><div class="quote"> <br>1. Can I start a thread that will play an AVI aka game into and then continue to load my game media ? <br> <br></div><br>If you can do it in your main game, you can put it in a thread. I think the only thing on windows that doesn't like being threaded is dx stuff. Gl should be fine.<br><br><br><div class="quote"> <br>2. Can more than one thread drop stuff to the back buffer ? <br>for example a game I did in Java, I had a "Insert Coin" that flashed on the screen, but the flash was controlled by a thread so it didnt have anything in the main loop telling it to flash. So can this be done ? <br> <br></div><br><br>Yep. Just create an endless loop in the thread. they don't have to return, whenever you call a thread it returns immediately.<br><br><div class="quote"> <br>Is it stable enough to put something like AI into a thread and let it mince away on some complex AI choice tree while the rest of the game runs alone as normal, think chess ?<br> <br></div><br><br>Yep. <br><br>In the 'next' version, you can specify which processer the thread is executed on, in theory allowing true multi-cpu possibilities. <br><br></td></tr></table><br>
<a name="474206"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AdrianT</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nice one Ant ;) <br><br></td></tr></table><br>
<a name="474215"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Great thing :)<br><br>Now I can start to dream of stuff that I was not capable to create without bad headaches in the past :) <br><br></td></tr></table><br>
<a name="474223"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bot Builder</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wow. It'd be really awesome if some linux and mac people could implement the same functions sets for those platforms, so you can use these on all platforms. <br><br></td></tr></table><br>
<a name="474229"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paul "Taiphoz"</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> WELL all I got left to say is BLOODY well done m8 and where the heck is the download link for it(j/k)<br><br>Hay Any chance you could possibly knock up an example of it in use ? <br><br></td></tr></table><br>
<a name="474233"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paul "Taiphoz"</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> I got a request if thats ok.<br><br>IsThreadActive:Boolean()<br><br>My thoughts are like this.<br><br>initgame()<br>thread -&gt; loadmedia()<br>repeat<br>until IsThreadActive()=false<br>Playegame()<br><br>if thats not clear, we need a way to check if a thread thats loading media for the game is done yet, so we know if its safe to actually start drawing or playing sounds..<br><br>would be a nightmare if on some machines the thread dosent get all the needed media loaded befre the main program gets to a draw command. <br><br></td></tr></table><br>
<a name="474242"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jeroen</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> awesome. it is win32 only? <br><br></td></tr></table><br>
<a name="474262"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tibit</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nice and Impressive Antony! <br><br>Is it planned to make this work crossplatform;MacOs,Linux? <br><br>I haven't programmed with threads before but I can imagine what will be possible =) <br><br></td></tr></table><br>
<a name="474267"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hotcakes</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Awesome work Antony.  Frikkin brilliant.  I second Bot Builders request!  If it's too messy to merge into one module, each platform could have a seperate thread module, so long as eventually somebody makes a fourth 'helper' module that handles all the messiness behind the scenes... <br><br></td></tr></table><br>
<a name="474274"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yavin ...<br>your way of using it makes it useless if you wait until loading is done anyway ... you could just use the normal functionality then ;) <br><br></td></tr></table><br>
<a name="474280"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paul "Taiphoz"</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Dreamora : Wrong.<br> the example I gave was for playing an AVI Game Intro while loading the game media in the background, when the Intro AVI ends you want the game menu to start but there could be a situation where the thread loading all your media behind the avi is not yet finished, so a please wait msg could be displayed intil it is done.<br><br>So like I said Ant the thread god could we get a isitrunning function.<br><br>ta :) <br><br></td></tr></table><br>
<a name="474286"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> thread are really good, thats out of question<br>but can't see your "runs an avi" thing ... you have an init and a thread that is loading and after loading is finished you play the game ... where is there actually the "AVI" part? thats why I meant there is not much use of this construct, sorry. <br><br></td></tr></table><br>
<a name="474328"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xlsior</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> <i>but can't see your "runs an avi" thing ... you have an init and a thread that is loading and after loading is finished you play the game ... where is there actually the "AVI" part? thats why I meant there is not much use of this construct, sorry. </i><br><br>Eh?<br><br>I think he's just talking about the ability to play an animation *while* the necesary sprites, background, music, etc. of your game is being loaded in the background. Which would be quite useful, since it means you don't have to stare at a static screen during the loading period. <br><br></td></tr></table><br>
<a name="474330"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FlameDuck</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Antony. Like Bot Builder, I'd also like to see versions for Linux and Mac.<br><br><div class="quote"> I think he's just talking about the ability to play an animation *while* the necesary sprites, background, music, etc. of your game is being loaded in the background. <br></div>Yeah. Games could learn alot from that. Having 9 or 10 long animations running before the game starts, that you can't even skip past, and then once you've done that, it's "Please wait some more ... Loading". <br><br></td></tr></table><br>
<a name="474346"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AntonyWells</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>I got a request if thats ok. <br><br>IsThreadActive:Boolean() <br><br>My thoughts are like this. <br><br>initgame() <br>thread -&gt; loadmedia() <br>repeat <br>until IsThreadActive()=false <br>Playegame()<br> <br></div><br><br>The 'next' version will spawn threads within a carrier function to allow this. Sadly winAPI doesn't(or at least msdn doesn't document it) have any functions to just check if a thread is running.<br><br>In the mean time, remember threads have the SAME scope as the function would if you called it normally. <br><br>So for now,<br><br><pre class=code>
global MediaLoading = true
function LoadMedia:Int(bb_func:Byte ptr )
  'load media
  MediaLoading = false
end function

CreateThreaad( LoadMedia)

while MediaLoading
wend 'wait for media to finish loading.
</pre><br>---<br><div class="quote"> <br> it is win32 only?<br> <br></div><br><div class="quote"> <br>Is it planned to make this work crossplatform;MacOs,Linux?<br> <br></div><br><br>Win32 for now, mac/Linux versions to come. It will be totally abstracted, so anycode you write in the windows version will eventually work without alteration on other platforms, basically..<br>---<br>Btw, never mentioned it before, but if you guys find any bugs, please report them. <br><br>Ant.<br><br>And on the next version of Arrested Threads, Jobe smuggles himself out of prison and into solitary. "I've made a huge mistake" <br><br></td></tr></table><br>
<a name="474347"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >maximo</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> So now BlitzMax has threads, why do you ask Mark to add it if you can do it this easy ;) <br><br></td></tr></table><br>
<a name="474349"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AntonyWells</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> I thought it would be harder :) <br><br></td></tr></table><br>
<a name="474369"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >flying willy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is his finest hour, he stands among giants. The wind blasts through his heroic mane, and his steely jaw glints and reflects lensflares from the burning sun!<br><br>His threading has caused the mob to hush in awe... Rome is the mob and Antony is the Queen. I mean, erm.<br><br><br>Well done, it's great stuff - how will you do mac and linux? <br><br></td></tr></table><br>
<a name="474376"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skn3</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nice stuff :) I was gonna look into this, but it looks like you have beat me! <br><br>Lets hope BRL see the light. People want power! <br><br></td></tr></table><br>
<a name="474383"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paul "Taiphoz"</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ah cool Ant, I never thought of that, that will solve any problems with the thread taking longer than expected to finish.<br><br><br>LOL and Flameduck, I think its a hell of a lot better to sit and watch some nice wee game intro than to sit looking at a static loading screen..<br><br>I mean if its a simple choice between looking at "Loading please wait ......" or some nice looking logo thing or game intro I know what one Id pick.<br><br>OF course though all loading should be kept to a min to make sure the player gets into the game nice and quick. <br><br></td></tr></table><br>
<a name="474390"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mark Tiffany</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Flameduck, I think its a hell of a lot better to sit and watch some nice wee game intro than to sit looking at a static loading screen.. <br></div><br>I think you misunderstand Flameduck.  He's not advocating static screens over animated screens.  He's advocating that loading should occur DURING the intro animation(s), not AFTER on a static loading screen.  This happens far too often in commercial games and to me smacks of laziness.<br><br>Oh, and well done Antony, looks good! <br><br></td></tr></table><br>
<a name="474396"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paul "Taiphoz"</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah your right Mark.<br><br>I guess I missread that the first time. Soz flameduck and I agree with you 100%.<br><br>I could name a few games as well that hit you with a loading animation and then when its done they load the game media.<br><br>Well thanks to Antony and his thready goodness we wont have to bother waiting around anymore.<br><br>I guess the only question is now, Whos good at making avi intros lol. <br><br></td></tr></table><br>
<a name="474430"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >teamonkey</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I think the only thing on windows that doesn't like being threaded is dx stuff. Gl should be fine.  <br></div><br><br>OpenGL is not thread safe. Everything should be done in the same thread that created the graphics context, unfortunately. It might work on some systems, but not with others. YMMV.<br><br>As a rule of thumb, I'd keep all the graphics commands in the original thread. <br><br></td></tr></table><br>
<a name="474443"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Warren</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> I imagine there's more stuff that isn't thread safe than you would imagine.  I'd be very careful with this stuff, folks.  If BlitzMax doesn't have threads natively, odds are that it wasn't coded in a thread safe, re-entrant manner.<br><br>Be wary.  There may be weird and spooky bugs ahead.  :) <br><br></td></tr></table><br>
<a name="474445"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paul "Taiphoz"</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> I can think of two areas where this is going to really help, the first is as I said above, getting all your media loaded while playing some movie intro at the same time to keep the gamer intrested.<br><br>Then you have AI to think of, AI in games is and has always beena  big bottle neck, the more complex the AI the more cpu time it takes away from your game logic/rendering time. just think how good its going to be when in your main loop, at the start of it you can just fire your AI function off in a thread and then while thats working out its next move your code can then get on with updating vars, or drawing the game to screen.<br><br>The last thing I can think of and probably the first thing I will try is going to be networking. Just think for example if you want to ping a list of servers, to find out if the gameserver is still running or to find out what the ttl is. you will be able to fire off say 20 pings at once in threads at a single time instead of running through each one , one at a time.<br><br>the amount of time this is going to save is .... well a lot. <br><br></td></tr></table><br>
<a name="474454"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Warren</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just to be a slightly soggy blanket here ... threading isn't magic.  It isn't like you're getting another processor installed in your machine or something.  You're still using the same amount of processor each frame, except now you're spreading it over a wider array of tasks.  Things are still going to take the same amount of time to complete (possibly more, in fact), but the main advantage is that they can move forward at the same time rather than in sequence. <br><br></td></tr></table><br>
<a name="474462"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >maximo</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> &gt;the main advantage is that they can move forward at the same time rather than in sequence<br><br>exactly, nothing will be faster, things will be proccessed in sequence and instead of thing A finishing before thing Z, now both things will finish at the same time. <br><br></td></tr></table><br>
<a name="474463"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AntonyWells</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#32">[#32]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can off-load threads onto any cpu, so if you do have a multi-cpu set up, it is like getting another processor, as according to a flameduck(I think) post blitzMax only uses one, no matter how many there are.<br>That may be niche now..but it won't be in two years.(Not at the high end..multi-core will be the new p4. or whatever.)<br>-<br>But saying that, the beauty of threads to me has never been a magical means to speed up existing routines, it's been to open new doors. I just finished adding streaming support to trinity.(Load wise) so can load an entity in about 0.3 secs(On a p2-350 atm..&lt;insert appropriate swear word&gt;) without pausing the app.<br>And in a real time context, reducing a 0.3 second pause per frame to no pause is a quantum leap in performace.<br>-<br><br>Skunk, lay off the..yourself. :)<br><br><div class="quote"> <br>OpenGL is not thread safe. Everything should be done in the same thread that created the graphics context, unfortunately. It might work on some systems, but not with others. YMMV. <br><br>As a rule of thumb, I'd keep all the graphics commands in the original thread. <br> <br></div><br><br>Are you sure? I've seen numerous sites specifically citing speeding up real time apps by threading the 3d engine(I.e the rendering aspect). Though it's not vital anyway, as the cpu intensive stuff is what you want to thread. <br><br></td></tr></table><br>
<a name="474603"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dmoc</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#33">[#33]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's responsiveness not speed that's improved - many people mistakenly mix the two. Re opengl, same thing basically and I would guess mainly offloading non rendering stuff while keeping rendering in same thread. Seperate threads for seperate context's seems a good idea? <br><br></td></tr></table><br>
<a name="474619"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >teamonkey</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#34">[#34]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Are you sure? <br></div><br>Pretty sure. OpenGL is state-based. Mess with anything out of sequence and you're screwed. Not only that, but it's been my experience that just calling an OpenGL function can cause the app to segfault. I don't know why.<br><br>Do you have any links to those sites? <br><br></td></tr></table><br>
<a name="474625"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AntonyWells</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#35">[#35]</a></td></tr></table></td></tr><tr ><td class="posttext"> Not 'on me', it was when I was reading up on threads..So could be any link on google from a "thread tutorial/ C++ Threads" search, was in the sections mentioning the benefits of threads.<br>-<br><br>About being state based, my own solution would be to objectize(ahem) state access throug a wrapper class, and precede every function with a mutex lock request on it's own personal mutex.<br>So if two threads do attempt to change a state at once they'll be denied access.(they'll just queue up in order of request)<br>Plus you can implement a lock/unlock method when you want to prevent any other threads from making changes.<br>The nice thing about a mutex request is it actually stalls the thread on the request until it has the lock, so it prevents multiple threads from accessing any proceding code.<br><br>I believe recent drivers also added support for child Contexts, or shared contexts, which may be a solution to any crashes caused by that.(Not tested.) <br><br></td></tr></table><br>
<a name="474631"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#36">[#36]</a></td></tr></table></td></tr><tr ><td class="posttext"> There is stuff you can do in threads on OpenGL like buffer modifications or display list modifications but I think threading anything out of the "pipe" would totally screw the thing ... <br><br></td></tr></table><br>
<a name="474745"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hotcakes</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#37">[#37]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> So now BlitzMax has threads, why do you ask Mark to add it if you can do it this easy ;) <br></div><br>I think the better question is why hasn't Mark done this since it's so damn easy ;] There may be a very good reason...  but it's -so- -much- more FUN to find out the hard way, innit?  ;]<br><br><div class="quote"> Whos good at making avi intros lol. <br></div><br>It's not too difficult to get your hands on some 'home movie' sorta software for a reasonable price.  Movie Maker if you're -really- desperate (altho then you'd need another proggy to convert the wmv to avi) <br><br></td></tr></table><br>
<a name="474766"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paul "Taiphoz"</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#38">[#38]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> It's not too difficult to get your hands on some 'home movie' sorta software for a reasonable price. Movie Maker if you're -really- desperate (altho then you'd need another proggy to convert the wmv to avi) <br></div><br><br>I use Prem 8 on the PC and some times I edit my TV or cinema trailer stuff on Mac, just recently had to submit two trailers for the movie robocop.<br><br>The Hardware and software aint a problem, I was more thinking along the lines of creating the 3D intro like mby EA's or Capcoms.. something like that. <br><br></td></tr></table><br>
<a name="474938"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >alligator</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#39">[#39]</a></td></tr></table></td></tr><tr ><td class="posttext"> well done, but beware..<br><br><a href="http://home.pacbell.net/ouster/threads.pdf" target="_blank">http://home.pacbell.net/ouster/threads.pdf</a><br><br>an older article but still relavant. <br><br></td></tr></table><br>
<a name="474953"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Warren</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#40">[#40]</a></td></tr></table></td></tr><tr ><td class="posttext"> That's a really good article.  Lays it all out in plain English. <br><br></td></tr></table><br>
<a name="475012"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#41">[#41]</a></td></tr></table></td></tr><tr ><td class="posttext"> This seems like a groovy addition, but I can't myself consider it an `addition to blitzmax` or that `blitzmax now has threads` until it is supported on all the platforms that blitzmax ports to *being purist*. But great job on the `progress` though.<br><br>I also am expecting there must be some areas where, having two parts of a BlitzMax app running simultaneously is likely to not take into account some internal variables which may have no protection from being changed at the wrong time or not being locked, etc... I guess it'll almost be hit and miss as to which parts work together and which dont?<br><br>Still, it's pretty cool and looking forward to seeing it on all platforms. <br><br></td></tr></table><br>
<a name="476389"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AntonyWells</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#42">[#42]</a></td></tr></table></td></tr><tr ><td class="posttext"> Urban legends aside, I've got too much going on project wise to try and implement any sort of multi-platform.<br>So here's the bmax/C++ source used, public domain so hopefully someone else can finish it off for us.(this won't be a commercial product from me. ever.)<br><br>anyway, enough rambling, here's the juice. (This is the latest version btw, I'd nab it if you're using the above. <br>You can now pass a pointer to a thread. (Edit-fixed a bug.)<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Strict

Module PUB.Thread

ModuleInfo "Version: 1.00"
ModuleInfo "Author:Antony Wells"
ModuleInfo "License:Public Domain"
ModuleInfo "Copyright: Public Domain"
ModuleInfo "Modserver: BRL" '(if they want). I doubt it!.

'Note only win32 link is working(Source code below) so this'll crash out on mac/linux atm..if that.
?win32
Import "ThreadLayer.c"
?macOS 
'Import "MacThread.c"
?linux
'Import "LinuxThread.c"
?

Import BRL.LinkedList
Import BRL.Stream
Import BRL.Bank

Type TResource

	Method New()
		
		Mutex = makeMutex()
		
	End Method
	
	Method Delete()
		
		cleanMutex( mutex )
		closeObject( mutex )
		
	End Method
	
	Method Lock()
		
		waitForObject( mutex,0)
		Return 1
			
	End Method
	
	Method Unlock()
	
		cleanMutex( mutex )	
	
	End Method
	
	Method GetInt:Int()
		Return dInt[0]
	End Method
	
	Method getFloat:Float()
		Return dFloat[0]
	End Method
	
	Method getDouble:Double()
		Return dDouble[0]
	End Method
	
	Method getStream:TStream()
		Return dStream
	End Method
	
	Method getBank:TBank()
		Return dBank
	End Method
		
	Method getType:Object()
		Return dObject
	End Method
					
	Field dInt:Int Ptr
	Field dFloat:Float Ptr
	Field dDouble:Double Ptr
	Field dBank:TBank
	Field dObject:Object
	Field dStream:TStream
	Field Mutex:Int

End Type


Type TThread
	
	Function Init()
		
		Threads = CreateList()
		SharedData = CreateList()
	
		
	End Function 
	
	Method New()
		FlagLock = CreateLock()
	End Method
	
	Method Delete()
		
		If handle&lt;&gt;0
			cleanThread(handle)
			closeObject(Handle)
			handle = 0
		End If
		
		
	End Method	
	
	Function ProtectInt:TResource( Resource:Int Var )
	
		Local TRes:TResource = New TResource
		TRes.dInt =Varptr Resource
		Return TRes
	
	End Function
	
	Function ProtectFloat:TResource( Resource:Float Var)
	
		Local TRes:TResource = New TResource
		TRes.dFloat = Varptr Resource
		Return TRes

	End Function
	
	Function ProtectBank:TResource( Resource:TBank )

		Local TRes:TResource = New TResource
		TRes.dBank = Resource
		Return TRes

	End Function
	
	Function ProtectType:TResource( Resource:Object )
		
		Local TRes:TResource = New TResource
		TRes.dObject = Resource
		Return TRes
		
	End Function
	
	Function ProtectStream:TResource( Resource:TStream )
	
		Local TRes:TResource = New TResource
		TRes.dStream = Resource
		Return TRes
		
	End Function	
	
	
	Function Create:TThread( bb_func:Int(tp:Byte Ptr),value:Int=0 )
		
		Local Spawn:TThread = New TThread
		'Spawn.Handle = makeThread( bb_func )
		Spawn.bbfunc = bb_func
		ListAddLast Threads,Spawn
		Spawn.PassValue = New Int[1]
		Spawn.passValue[0] = Value
		Return Spawn
				
	End Function
	
	Method SetParInt(value:Int)
		PassValue[0]=Value
		PassMode = 0
	End Method
	
	
	
	Function RunAll()
		
		For Local Thread:TThread = EachIn Threads
		
			Thread.Pause()
						
		Next
		
	End Function 
	
	
	Function PauseAll()
		
		For Local Thread:TThread = EachIn Threads
		
			If Thread.Handle&lt;&gt;0
				Thread.Pause()
			EndIf 
				
		Next
		
	End Function

	Method Active:Byte()
	'	RequestLock( flagLock )
		Return ActiveFlag	
	'	ReleaseLock( flagLock )
	End Method
	
	Function ResumeAll()
	
		For Local Thread:TThread = EachIn Threads
			
			If Thread.Handle&lt;&gt;0
				Thread.Resume()
			End If
		
		Next
			
	End Function
		
	Method Run()
		
		Handled = makeThreadValue( bbFunc,PassValue)
		
	End Method
	
	Method Pause()
		
		haltThread( Handle )
		
	End Method
	
	Method Resume()
		
		restartThread( Handle )
		
	End Method
			
	Method Stop()
		
		cleanThread( Handle )
		closeObject( Handle )
		Handle = Null
		
	End Method

	Method SetPriority( nPriority:Int )
	
		Assert handle,"Thread not running"
		AlterThreadPriority( handle,nPriority)
	
	End Method
	
	
	
	'Waits for a thread to finish, maxwait defines how long to wait for. 0 = as long as it takes.
	Method Wait(MaxWait:Int=0)
		waitForObject( Handle,MaxWait )		
	End Method
	
	
	Field Handle:Int
	Field ActiveFlag:Byte
	Global Threads:TList
	Global Master:TThread
	Global SharedData:TList
	Field bbfunc:Int(tp:Byte Ptr)
	Field passValue:Int Ptr,PassMode:Short
	Field CapsuleThread:Int,flagLock:Int
End Type

TThread.Init()

Public
?win32
Extern 

	Function makeThread:Int(bb_func:Int(tp:Byte Ptr))
	Function waitForObject( threadHandle:Int,MaxWait:Int )
	Function makeMutex:Int()
	Function cleanMutex(mutex:Int)
	Function closeObject(handle:Int)
	Function cleanThread(handle:Int)
	Function AlterThreadPriority( handle:Int,priority:Int)
	Function haltThread(handle:Int)
	Function restartThread(handle:Int)
	Function makeThreadValue:Int(bb_func:Int(tp:Byte Ptr),value:Int Ptr) 

End Extern
?mac
Throw "DreamSpace - BlitzThreads is not yet supported on Mac. Sorry."
?linux
Throw "DreamSpace - BlitzThreads is not yet Supported on Linux. Sorry."
?

Function CreateThread:TThread( bb_func:Int(tp:Byte Ptr))
	
	Return TThread.Create( bb_func )
	
End Function


Function WaitThread( In:TThread,WaitUntil:Int=0 )

	In.Wait( WaitUntil )

End Function

'Returns immediately
Function RunThread( In:TThread )

	In.Run()	

End Function

Function PauseThread( In:TThread )

	In.Pause()

End Function

Function ResumeThread( In:TThread )
	
	In.Resume()
	
End Function

Function StopThread( In:TThread ) 

	In.Stop()

End Function 

Global ActiveThread:TThread
Global ActiveFunction:Int(BB_Func:Byte Ptr)
Global ActiveMutex = CreateLock()

Function CreateLock:Int()
	Return makeMutex()
End Function 

Function RequestLock:Int(LockID:Int)
	Return waitForObject( LockId,0 )
End Function 

Function ReleaseLock(LockId:Int)
	cleanMutex( lockId   )
End Function

</textarea><br><br>'TheadLayer.c<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
#include &lt;windows.h&gt;



// Thread spawner for 
HANDLE makeThreadValue( int (*function),LPVOID *value){
HANDLE threadHandle;
	threadHandle = CreateThread(NULL, 0, (LPTHREAD_START_ROUTINE)function,value, 0, NULL);
	return threadHandle;
};

HANDLE makeThread(int (*function)){
	HANDLE threadHandle;
	threadHandle = CreateThread(NULL, 0, (LPTHREAD_START_ROUTINE)function,NULL, 0, NULL);
	return threadHandle;
};

void AlterThreadPriority( HANDLE threadHandle,int priority){
	switch(priority){
	case 1:
		priority = THREAD_PRIORITY_IDLE;
		break;
	case 2:
		priority = THREAD_PRIORITY_LOWEST;
		break;
	case 3:
		priority = THREAD_PRIORITY_BELOW_NORMAL;
		break;
	case 4:
		priority = THREAD_PRIORITY_NORMAL;
		break;
	case 5:
		priority = THREAD_PRIORITY_ABOVE_NORMAL;
	case 6:
		priority = THREAD_PRIORITY_HIGHEST;
		break;
	case 7:
		priority = THREAD_PRIORITY_TIME_CRITICAL;
		break;
	}
	SetThreadPriority( threadHandle,priority);
}

void haltThread( HANDLE threadHandle ){
	SuspendThread( threadHandle );
}

void restartThread(HANDLE threadHandle){
	ResumeThread( threadHandle);
}


void waitForObject(HANDLE threadHandle,int wait){
	if(wait&gt;0){
	WaitForSingleObject( threadHandle,wait);
	}else{
	WaitForSingleObject( threadHandle,INFINITE);
	}
}

void closeObject( HANDLE in){
	CloseHandle( in );
};

void cleanThread( HANDLE threadHandle ){
	TerminateThread( threadHandle ,0 );
}

void threadActive( HANDLE threadHandle ){
	
}

HANDLE makeMutex(){
	return CreateMutex(NULL, 0, NULL);
}

void cleanMutex( mutexHandle){
	ReleaseMutex( mutexHandle );
}
</textarea><br><br>Freel free to upload any improvements to this thread..or your own. <br><br></td></tr></table><br>
<a name="476402"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ashmantle</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#43">[#43]</a></td></tr></table></td></tr><tr ><td class="posttext"> Antony, you're a great asset to this community! Thanks alot! <br><br></td></tr></table><br>
<a name="476471"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#44">[#44]</a></td></tr></table></td></tr><tr ><td class="posttext"> Umm,<br><br>Sorry to be a party pooper, but this is pretty much guaranteed to fail sooner or later.<br><br>The likely result of using threads like this is that things will work fine 99% of the time, and every now and then something will mysteriously screw up. <br><br>The problem is that certain runtime operations need 'locks' around them to work properly concurrently, and there is nothing like that in place.<br><br>By all means, use at your own risk - but you've been warned! Threading is something I eventually want to look at, but it's not as simple as it sounds. <br><br></td></tr></table><br>
<a name="476500"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AntonyWells</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#45">[#45]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ash, thanks, I usually hear that in reverse :)<br><br>Mark, locking is in place, so any modules of yours can be manually locked. <br>Custom modules, like mine of course CAN be wrote thread safe from the start, so it's only really true of your modules anyway.<br>Unless your compiler is generating asm which relies on any global areas that other threads could 'mess up' regardless of the modules being used?  <br>I don't see any such code in the asm produced though, though I never looked too hard.<br><br>Would be helpful if you made it clearer to us what to avoid, if I've missed something. -[Edit - Or the usual stonewall of silence..whatever... <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
