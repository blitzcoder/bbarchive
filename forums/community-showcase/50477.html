<!DOCTYPE html><html lang="en" ><head ><title >BlitzThreads Part Duex.</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >BlitzThreads Part Duex.</h1><a href="forums.php" >Community Forums</a>/<a href="topics.php?forum=61" >Showcase</a>/<a href="#bottom" >BlitzThreads Part Duex.</a><br><br>
<a name="561705"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AntonyWells</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="http://www.excess.eclipse.co.uk/dreamspace.mod.zip" target="_blank">http://www.excess.eclipse.co.uk/dreamspace.mod.zip</a><br><br>Well it's the DVD repacking of Part...Un..Une...One...<br><br>Posted it about 8 months ago, or 5 months ago..depending on my ability to read a date correctly.<br>Would be GREEEAT if someone with a mac/linux added Calls for the mac linux.<br><br>You can use the ?mac ?linux ?x86 compiler directives to add this into the same lib.<br><br>It's a module in this form, but it's part C++, so it'll be straight forward. I just have no mac/linux set up to do it.<br><br>You'll all need this come BlitzMaxPs3...:) <br><br></td></tr></table><br>
<a name="561707"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AntonyWells</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> From the original Thread. Just checked the rar and there were no docs/source, just the mod `mam.<br><br><div class="quote"> <br>It's object driven, although there are function wrappers for those used to that.<br><br>Classes are(There's no docs)<br><br>TThread. <br><br>Global functions(Contained within TThread. I.e TThread.<br><br>Create() )<br>Create( BlitzFunction ) Create a thread and return a TThread object.<br>RunAll() 'Runs all threads<br>PauseAll() 'Pauses all threads<br>StopAll() 'Stops all threads<br><br>Local functions specific to each thread instance,<br><br>Run() 'Runs the function provided when creating the thread, in another thread.<br><br>Priority( Value:Int) 'Set the threads priority, value ranges from 1 to 7. (default = 3, pre-set)<br><br>Pause() 'Pause the thread<br><br>Resume() 'Resume the thread,<br>-<br>Global functions within TThread to allow async data access,<br>All return a TResource object/integer handle.<br><br>ProtectInt( x variable )<br>ProtectFloat( x variable )<br>ProtectBank( Bank:TBank )<br>ProtectStream( Stream:TStream )<br>-<br><br>With the tResource object returned, you can lock access rights to it within your thread,<br><br>Wrapper functions are,<br><br>ThreadHandle =CreateThread( Function )<br>PauseThread( ThreadHandle )<br>ThreadPriority( ThreadHandle,Priority )<br>PauseThread(Threadhandle)<br>ResumeThread(ThreadHandle)<br>StopThread(ThreadHandle)<br>RunThread(ThreadHandle)<br><br>There's also a manual locking system, in addition to protected storage.<br><br>Lock = CreateLock()<br><br>RequestLock(Lock)<br>ReleaseLock(lock)<br><br>which allows you to restrict threads of the same locking patterns to one run at a time.(Prevent deadlocks..if you're lucky :) )<br><br>TestApp<br><br>Simple mode<br><br><br>Update = CreateThread( UpdateVal )<br>NetWork = CreateThread( PrintVal )<br>RunThread(Update)<br>RunThread(NetWork)<br><br><br>Global ourVal<br><br>Function updateVal:Int(bb_func:Byte Ptr)<br><br>repeat<br>ourVal:+1<br>forever<br><br>End function<br><br>Function printVal:Int (bb_func:Byte Ptr)<br><br>repeat<br>Print "Val:"+OurVal<br>Delay 1000<br>forever<br><br>End Function <br><br>Print "Thread Handle&gt;"+Res<br><br>repeat<br>Delay 5000<br>Print "Master thread!"<br>Forever<br> <br><br><br>Advanced Mode<br><br><br><br>Update:TThread = TThread.Create( UpdateVal )<br>NetWork:TThread = TThread.Create( PrintVal )<br>Update.Run()<br>Network.Run()<br><br><br>Global ourVal<br><br>Function updateVal:Int(bb_func:Byte Ptr)<br><br>repeat<br>ourVal:+1<br>forever<br><br>End function<br><br>Function printVal:Int (bb_func:Byte Ptr)<br><br>repeat<br>Print "Val:"+OurVal<br>Delay 1000<br>forever<br><br>End Function <br><br>Print "Thread Handle&gt;"+Res<br><br>repeat<br>Delay 5000<br>Print "Master thread!"<br>Forever<br> <br> <br></div><br><br>Install<br><br><div class="quote"> <br>To install, copy dreamspace.mod folder into your bmax mod folder(Windows only atm) and you're done.<br> <br></div><br><br>Source BMX<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Strict

Module PUB.Thread

ModuleInfo "Version: 1.00"
ModuleInfo "Author:Antony Wells"
ModuleInfo "License:Public Domain"
ModuleInfo "Copyright: Public Domain"
ModuleInfo "Modserver: BRL" '(if they want). I doubt it!.

'Note only win32 link is working(Source code below) so this'll crash out on mac/linux atm..if that.
?win32
Import "ThreadLayer.c"
?macOS 
'Import "MacThread.c"
?linux
'Import "LinuxThread.c"
?

Import BRL.LinkedList
Import BRL.Stream
Import BRL.Bank

Type TResource

	Method New()
		
		Mutex = makeMutex()
		
	End Method
	
	Method Delete()
		
		cleanMutex( mutex )
		closeObject( mutex )
		
	End Method
	
	Method Lock()
		
		waitForObject( mutex,0)
		Return 1
			
	End Method
	
	Method Unlock()
	
		cleanMutex( mutex )	
	
	End Method
	
	Method GetInt:Int()
		Return dInt[0]
	End Method
	
	Method getFloat:Float()
		Return dFloat[0]
	End Method
	
	Method getDouble:Double()
		Return dDouble[0]
	End Method
	
	Method getStream:TStream()
		Return dStream
	End Method
	
	Method getBank:TBank()
		Return dBank
	End Method
		
	Method getType:Object()
		Return dObject
	End Method
					
	Field dInt:Int Ptr
	Field dFloat:Float Ptr
	Field dDouble:Double Ptr
	Field dBank:TBank
	Field dObject:Object
	Field dStream:TStream
	Field Mutex:Int

End Type


Type TThread
	
	Function Init()
		
		Threads = CreateList()
		SharedData = CreateList()
	
		
	End Function 
	
	Method New()
		FlagLock = CreateLock()
	End Method
	
	Method Delete()
		
		If handle&lt;&gt;0
			cleanThread(handle)
			closeObject(Handle)
			handle = 0
		End If
		
		
	End Method	
	
	Function ProtectInt:TResource( Resource:Int Var )
	
		Local TRes:TResource = New TResource
		TRes.dInt =Varptr Resource
		Return TRes
	
	End Function
	
	Function ProtectFloat:TResource( Resource:Float Var)
	
		Local TRes:TResource = New TResource
		TRes.dFloat = Varptr Resource
		Return TRes

	End Function
	
	Function ProtectBank:TResource( Resource:TBank )

		Local TRes:TResource = New TResource
		TRes.dBank = Resource
		Return TRes

	End Function
	
	Function ProtectType:TResource( Resource:Object )
		
		Local TRes:TResource = New TResource
		TRes.dObject = Resource
		Return TRes
		
	End Function
	
	Function ProtectStream:TResource( Resource:TStream )
	
		Local TRes:TResource = New TResource
		TRes.dStream = Resource
		Return TRes
		
	End Function	
	
	
	Function Create:TThread( bb_func:Int(tp:Byte Ptr),value:Int=0 )
		
		Local Spawn:TThread = New TThread
		'Spawn.Handle = makeThread( bb_func )
		Spawn.bbfunc = bb_func
		ListAddLast Threads,Spawn
		Spawn.PassValue = New Int[1]
		Spawn.passValue[0] = Value
		Return Spawn
				
	End Function
	
	Method SetParInt(value:Int)
		PassValue[0]=Value
		PassMode = 0
	End Method
	
	
	
	Function RunAll()
		
		For Local Thread:TThread = EachIn Threads
		
			Thread.Pause()
						
		Next
		
	End Function 
	
	
	Function PauseAll()
		
		For Local Thread:TThread = EachIn Threads
		
			If Thread.Handle&lt;&gt;0
				Thread.Pause()
			EndIf 
				
		Next
		
	End Function

	Method Active:Byte()
	'	RequestLock( flagLock )
		Return ActiveFlag	
	'	ReleaseLock( flagLock )
	End Method
	
	Function ResumeAll()
	
		For Local Thread:TThread = EachIn Threads
			
			If Thread.Handle&lt;&gt;0
				Thread.Resume()
			End If
		
		Next
			
	End Function
		
	Method Run()
		
		Handled = makeThreadValue( bbFunc,PassValue)
		
	End Method
	
	Method Pause()
		
		haltThread( Handle )
		
	End Method
	
	Method Resume()
		
		restartThread( Handle )
		
	End Method
			
	Method Stop()
		
		cleanThread( Handle )
		closeObject( Handle )
		Handle = Null
		
	End Method

	Method SetPriority( nPriority:Int )
	
		Assert handle,"Thread not running"
		AlterThreadPriority( handle,nPriority)
	
	End Method
	
	
	
	'Waits for a thread to finish, maxwait defines how long to wait for. 0 = as long as it takes.
	Method Wait(MaxWait:Int=0)
		waitForObject( Handle,MaxWait )		
	End Method
	
	
	Field Handle:Int
	Field ActiveFlag:Byte
	Global Threads:TList
	Global Master:TThread
	Global SharedData:TList
	Field bbfunc:Int(tp:Byte Ptr)
	Field passValue:Int Ptr,PassMode:Short
	Field CapsuleThread:Int,flagLock:Int
End Type

TThread.Init()

Public
?win32
Extern 

	Function makeThread:Int(bb_func:Int(tp:Byte Ptr))
	Function waitForObject( threadHandle:Int,MaxWait:Int )
	Function makeMutex:Int()
	Function cleanMutex(mutex:Int)
	Function closeObject(handle:Int)
	Function cleanThread(handle:Int)
	Function AlterThreadPriority( handle:Int,priority:Int)
	Function haltThread(handle:Int)
	Function restartThread(handle:Int)
	Function makeThreadValue:Int(bb_func:Int(tp:Byte Ptr),value:Int Ptr) 

End Extern
?mac
Throw "DreamSpace - &lt;span style="background-color: #ffff66; color: #000000; font-weight: bold;"&gt;BlitzThreads&lt;/span&gt; is not yet supported on Mac. Sorry."
?linux
Throw "DreamSpace - &lt;span style="background-color: #ffff66; color: #000000; font-weight: bold;"&gt;BlitzThreads&lt;/span&gt; is not yet Supported on Linux. Sorry."
?

Function CreateThread:TThread( bb_func:Int(tp:Byte Ptr))
	
	Return TThread.Create( bb_func )
	
End Function


Function WaitThread( In:TThread,WaitUntil:Int=0 )

	In.Wait( WaitUntil )

End Function

'Returns immediately
Function RunThread( In:TThread )

	In.Run()	

End Function

Function PauseThread( In:TThread )

	In.Pause()

End Function

Function ResumeThread( In:TThread )
	
	In.Resume()
	
End Function

Function StopThread( In:TThread ) 

	In.Stop()

End Function 

Global ActiveThread:TThread
Global ActiveFunction:Int(BB_Func:Byte Ptr)
Global ActiveMutex = CreateLock()

Function CreateLock:Int()
	Return makeMutex()
End Function 

Function RequestLock:Int(LockID:Int)
	Return waitForObject( LockId,0 )
End Function 

Function ReleaseLock(LockId:Int)
	cleanMutex( lockId   )
End Function


</textarea><br><br>C++ (imported by the bmx code, you don't need VC or anything.]<br><br>Call it ThreadLayer.C (Well you don't have it. You do if you want it to work but you don't have to.)<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
#include &lt;windows.h&gt;



// Thread spawner for 
HANDLE makeThreadValue( int (*function),LPVOID *value){
HANDLE threadHandle;
	threadHandle = CreateThread(NULL, 0, (LPTHREAD_START_ROUTINE)function,value, 0, NULL);
	return threadHandle;
};

HANDLE makeThread(int (*function)){
	HANDLE threadHandle;
	threadHandle = CreateThread(NULL, 0, (LPTHREAD_START_ROUTINE)function,NULL, 0, NULL);
	return threadHandle;
};

void AlterThreadPriority( HANDLE threadHandle,int priority){
	switch(priority){
	case 1:
		priority = THREAD_PRIORITY_IDLE;
		break;
	case 2:
		priority = THREAD_PRIORITY_LOWEST;
		break;
	case 3:
		priority = THREAD_PRIORITY_BELOW_NORMAL;
		break;
	case 4:
		priority = THREAD_PRIORITY_NORMAL;
		break;
	case 5:
		priority = THREAD_PRIORITY_ABOVE_NORMAL;
	case 6:
		priority = THREAD_PRIORITY_HIGHEST;
		break;
	case 7:
		priority = THREAD_PRIORITY_TIME_CRITICAL;
		break;
	}
	SetThreadPriority( threadHandle,priority);
}

void haltThread( HANDLE threadHandle ){
	SuspendThread( threadHandle );
}

void restartThread(HANDLE threadHandle){
	ResumeThread( threadHandle);
}


void waitForObject(HANDLE threadHandle,int wait){
	if(wait&gt;0){
	WaitForSingleObject( threadHandle,wait);
	}else{
	WaitForSingleObject( threadHandle,INFINITE);
	}
}

void closeObject( HANDLE in){
	CloseHandle( in );
};

void cleanThread( HANDLE threadHandle ){
	TerminateThread( threadHandle ,0 );
}

void threadActive( HANDLE threadHandle ){
	
}

HANDLE makeMutex(){
	return CreateMutex(NULL, 0, NULL);
}

void cleanMutex( mutexHandle){
	ReleaseMutex( mutexHandle );
}

</textarea> <br><br></td></tr></table><br>
<a name="561719"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Max2D and input handling o not really like this module ...<br>unhandled memory exception error all over without any real reason *at least to me*<br>:-( <br><br></td></tr></table><br>
<a name="561724"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AntonyWells</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah, it's more for custom code then max's in built stuff.<br><br>Your game logic, etc. AI.. BlitzThreads(Whoever's versions.) Should be made official, and blitz made 100% thread safe. Even home pc cpus are multi-core now. <br><br></td></tr></table><br>
<a name="561733"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> even if not multicore, networking singlethread is useless.<br><br>For the rest I'm using "faked" threading (using a own event system with function references etc. results in 1 Million mainloop passes at 60 FPS rendered)<br><br>But for some aspecs an own thread is needed ...<br>Networking is one thing, dynamic media loading another for example ...<br><br>Hopefully it will be added ... because I don't think that a next gen 3D engine can be called as such if it runs single threaded, no mather how many cores. There are things that have to run parallel ... like terrains, physics ... <br><br></td></tr></table><br>
<a name="561734"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> even if not multicore, networking singlethread is quite pointless.<br><br>For the rest I'm using "faked" threading (using a own event system with function references etc. results in 1 Million mainloop passes at 60 FPS rendered)<br><br>But for some aspects an own thread is needed ...<br>Networking is one thing, dynamic media loading another for example ...<br><br>Hopefully it will be added ... because I don't think that a next gen 3D engine can be called as such if it runs single threaded, no mather how many cores. There are things that have to run parallel ... like terrains, physics ... <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
