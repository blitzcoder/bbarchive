<!DOCTYPE html><html lang="en" ><head ><title >Leadwerks Engine - portal system</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Leadwerks Engine - portal system</h1><a href="forums.php" >Community Forums</a>/<a href="topics.php?forum=61" >Showcase</a>/<a href="#bottom" >Leadwerks Engine - portal system</a><br><br>
<a name="670681"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> The last couple of days I was working on a brush slice routine, and cutting brushes up within whichever portalzones they resided in.  The portal system is pretty much like UT2004's.  You can see what UT2004 does if you open the console and type "rmode 1", 2, 3, 4, etc.<br><br>My portal system uses brushes designated as "portalzone" entities.  Brush geometry is cut up and collapsed into single meshes within the portalzone.  If the portalzone is not in the frustum, none of the contained geometry is drawn.  If a portalzone has a portal that lies along any of its surfaces, it is only visible if the portal is visible.  The portalzone is only visible through the visible portal, so all portalzone geometry not visible through the portal is clipped.  All outdoor/non-portalized geometry in the scene is considered to be a part of the default "virtual" portalzone.  I have it set up so the outdoor portalzone will automatically connect to any one-sided portals (a portal only touching one portalzone), which are taken to mean there is a transition from outdoor to indoor areas.<br><br><img src="http://www.leadwerks.com/post/portals20.jpg"><br><br><img src="http://www.leadwerks.com/post/portals21.jpg"><br><br>This room is full of meshes, but most are not visible through the portal in the entrance, so they get hidden.  There are just as many shelves on the right as there are on the left.  Also notice the brushes on the ramp are clipped to the portal edges.  You are viewing in wireframe, so nothing is being obscured from view; the brush geometry is actually clipped.<br><img src="http://www.leadwerks.com/post/portals22.jpg"> <br><br></td></tr></table><br>
<a name="670687"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Erroneouss</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Cool :] <br><br></td></tr></table><br>
<a name="670701"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Amon</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nice. :) <br><br></td></tr></table><br>
<a name="670840"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >puki</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeh - looks good. <br><br></td></tr></table><br>
<a name="670847"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Regular K</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Cool, I assume this is B3D?<br>I was just wondering, does B3D render stuff not remotely visible on the screen (like stuff out of the field of view)? <br><br></td></tr></table><br>
<a name="670852"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Cool, I assume this is B3D? <br></div><br>I'm pretty sure it's his open OpenGL engine.<br><br><div class="quote"> I was just wondering, does B3D render stuff not remotely visible on the screen (like stuff out of the field of view)? <br></div><br>Depends on your definition of remotely visible. It does cull entities but somtimes they can be considerably out of cameraview and still get rendered. IIRC this is because it uses a frustum sphere to determine whether things need to be rendered or not. Fast, but inaccurate. It's better than nothing.<br><br>Anyway, what portals do is hide things that *are* in the field of view but are obscured by other things. It really only suits certain types of games ( first person perspective mainly ) but it's quite effective within those genres. <br><br></td></tr></table><br>
<a name="670857"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> It suits any game with a camera and more polygons in the scene than you want to render each frame.  The portal visibility is recalculated each frame, and takes 0-1 msecs in this scene.<br><br>Culling is precise down to a model's bounding box.  The engine actually creates a hidden brush object (like in 3D World Studio) around each model, and tests it for intersection with the camera frustum (a pyramidal brush with the apex at the camera position).<br><br>Occlusion culling isn't always important for rendering plain triangles.  A lot of graphics cards could handle the non-portalized scene.  Portals do make a huge difference when it comes to updating objects and calculating things like shadows, lighting, physics, etc. <br><br></td></tr></table><br>
<a name="670902"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wiebo</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Looks cool! Are portals still valid with the amount of raw power the current GPO can throw at drawing the polygons? How much do you win with this, Halo? <br><br></td></tr></table><br>
<a name="670992"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, if your card can draw 200,000 polys at 60 FPS, if you have the scene portalized, you can use a 1,000,000-poly scene instead.  There will always be a point where the scene gets too big, and you need to dimiss areas that are offscreen, occluded, or very far away.<br><br>I think current GPU abilities are a little overstated/misunderstood.  They might be able to do x,000,000 polygons per second, but when you add textures and separate objects into the equation, everything slows down.  I don't see portal occlusion going away any time soon.<br><br>There are also a lot of updating routines that are slower than just rendering triangles.  Dynamic lights and shadows are rather expensive routines.  If you can cut the number of faces those need to be performed on by 75%, obviously there will be some speed gains.<br><br>Of course for simple scenes, no portal system is needed.  This is designed to support more demanding scenes. <br><br></td></tr></table><br>
<a name="671036"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Portals don't really require much processing time at all. I don't really see any disadvantages to using them, except from setting them up. As halo says, why draw things that aren't on screen, or really far away. Good work :o) <br><br></td></tr></table><br>
<a name="671059"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >boomboom</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> What si the leadwerks engine? Will it become a 3D module engine for Bmax, or a standalone product? <br><br></td></tr></table><br>
<a name="671088"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Red Ocktober</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> and... the inevitable question... when...<br><br>:)<br><br>--Mike <br><br></td></tr></table><br>
<a name="671147"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> It suits any game with a camera and more polygons in the scene than you want to render each frame. The portal visibility is recalculated each frame, and takes 0-1 msecs in this scene. <br></div><br>Really? Well I'd certainly like to see a demo of it working on a large, complex scene, with outdoor areas. If it could do a good job there, it would certainly be impressive, since all the engines I've seen which use portals are only doing it for relatively simple indoor scenes. <br><br></td></tr></table><br>
<a name="671160"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> The portal visibility is recalculated each frame, and takes 0-1 msecs <br></div><br>That's indeed impressive since the calculation of visibility is a slow process by nature. Personally I was using precalulcated VIS lists for that purpose. I have to say, even with the lists ready, my engine was slower when it used to hide/show the clusters or portals each frame based on the VIS lists, compared to when I simply broke up the map in portals and let blitz cull as good as it gets (camerarange, fustrum culling etc.) <br><br></td></tr></table><br>
<a name="671283"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's fast because you start with the portalzone the camera occupies and work your way outwards in a recursive function.  You can usually only see 1 or 2 portalzones away, so as soon as the portals start coming up as being occluded, the function returns.  I haven't seen a need for any precompiled vis data, other than splitting the geometry up into portalzones.<br><br>Of course, in some situations using portalzone occlusion would actually slow the scene down.  It's all about how you set the portals up, and how many polygons and objects you want the world to consist of.<br><br>3D World Studio 5.47 comes with an example scene of a large warehouse complex.  This is probably the most demanding kind of scene you can render, because it combines large areas of terrain with high-poly interior structures.  I set portalzones up inside all the buildings, and added portals at the building entrances.  Then all the objects inside the warehouse structures only have to be drawn if the entrance to that building is visible.  The speed gains are definitely worthwhile, even when no dynamic lights or shadows are being processed. <br><br></td></tr></table><br>
<a name="671329"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mustang</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>I think current GPU abilities are a little overstated/misunderstood. They might be able to do x,000,000 polygons per second, but when you add textures and separate objects into the equation, everything slows down.<br> <br></div><br><br>Yup. And you can bring down even the fastest cards on the market just with 100 polygons - try to draw them so that every polygon fills the screen and is on top of each other... that will fill the screen 100 times over per frame and as you can guess the fillrate needed is massive and will kill your speed totally. <br><br></td></tr></table><br>
<a name="671756"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> &gt;&gt;...and tests it for intersection with the camera frustum (a pyramidal brush with the apex at the camera position)...&lt;&lt;<br><br>I don't get it. What happens when the object hull is completely encapsuled inside the pyramidrical brush thing?<br><br>and will it be rendered even when it's occluded by a wall that is in front of the camera? <br><br></td></tr></table><br>
<a name="675541"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I don't get it. What happens when the object hull is completely encapsuled inside the pyramidrical brush thing? <br></div><br>If the object bounding box intersects the frustum volume at all, the object is rendered.  My intersection test returns "true" is one volume encapsulates the other one, since they are considered solid objects.<br><br>Most of the time, an object occluded by a wall will not be rendered.  There are portals that you see through, and antiportals that act as occluding objects.  Not every single wall is considered an antiportal; it's easier just to set up a few portals. <br><br></td></tr></table><br>
<a name="675894"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ross C</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah, portals need to be used and set up properly, or else it's more trouble than it's worth. The way i'm setting up my portals, is making small passageways, witha trigger at each end, telling the engine to show hide the other side. <br><br></td></tr></table><br>
<a name="675896"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Picklesworth</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is why I should never do a first-person game...<br><br>This looks like a very smart engine!<br><br>Do you think it could ever be possible for a program like 3dWS to calculate portals automatically? <br><br></td></tr></table><br>
<a name="676245"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> 3DWS will use the same exact engine, so portals can be calculated and displayed in the editor. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
