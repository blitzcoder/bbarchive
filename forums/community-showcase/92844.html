<!DOCTYPE html><html lang="en" ><head ><title >ORCS - Oldschool Roleplay Construction Set</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >ORCS - Oldschool Roleplay Construction Set</h1><a href="forums.php" >Community Forums</a>/<a href="topics.php?forum=61" >Showcase</a>/<a href="#bottom" >ORCS - Oldschool Roleplay Construction Set</a><br><br>
<a name="1059716"></a>

<a name="1059717"></a>

<a name="1059721"></a>

<a name="1059722"></a>

<a name="1059724"></a>

<a name="1059725"></a>

<a name="1059727"></a>

<a name="1059728"></a>

<a name="1059729"></a>

<a name="1059731"></a>

<a name="1059732"></a>

<a name="1059733"></a>

<a name="1059734"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Krischan</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is my latest project, based on my <a href="/posts.php?topic=90144" target="_blank">Khorinis Scenery Demo</a> BSP Loader, still in an early stage but I wanted to share it and get your feedback for it.<br><br><a href="http://www.christianhart.de/bb/orcs/update1/schlosstest_schatzkammer.jpg" target="_blank"><img src="http://www.christianhart.de/bb/orcs/update1/thumbs/schlosstest_schatzkammer.jpg"></a> <a href="http://www.christianhart.de/bb/orcs/update1/schlosstest_eingang.jpg" target="_blank"><img src="http://www.christianhart.de/bb/orcs/update1/thumbs/schlosstest_eingang.jpg"></a> <a href="http://www.christianhart.de/bb/orcs/update1/orcs_blitzsky.jpg" target="_blank"><img src="http://www.christianhart.de/bb/orcs/update1/thumbs/orcs_blitzsky.jpg"></a><br><a href="http://www.christianhart.de/bb/orcs/update1/schloss1_excel.png" target="_blank"><img src="http://www.christianhart.de/bb/orcs/update1/thumbs/schloss1_excel.jpg"></a> <a href="http://www.christianhart.de/bb/orcs/update1/schloss1_radiant.png" target="_blank"><img src="http://www.christianhart.de/bb/orcs/update1/thumbs/schloss1_radiant.jpg"></a> <a href="http://www.christianhart.de/bb/orcs/update1/orcs_schatzkiste.jpg" target="_blank"><img src="http://www.christianhart.de/bb/orcs/update1/thumbs/orcs_schatzkiste.jpg"></a><br><br>If you're older than 30 you remember games like The Bard's Tale, Dungeon Master, Eye of the Beholder or even Legend of Faerghail. First I wanted to create a clone of <a href="http://en.wikipedia.org/wiki/Legend_of_Faerghail" target="_blank">Legend of Faerghail</a> but then I became very interested in creating a standalone engine working together with the <a href="http://dev.alientrap.org/projects/7/wiki" target="_blank">NETradiant</a> mapping tool and lightmapped Quake 3 format BSP files as a map source. The long-term focus is that you simply create a map in NETradiant, render the BSP together with the scripting stuff and external textfiles and let the engine do the rest.<br><br>What has been finished right now? Well there is a nice customized BSP Loader creating the lightmapped mesh out of the BSP directly and it is able to parse the Entities contained in it, too (even custom entities created by yourself). You can walk block by block with a freelook camera, collisions, walk through doors, break doors, open secret doors, display text messages, a simple indoor/outdoor transition together with my <a href="/posts.php?topic=87026" target="_blank">BlitzSky</a> for outdoor scenes, treasure chests, different floor walk sounds, compass, minimap and so on... Oh, and I changed my BlitzSky in this package a little bit so that BlitzSky doesn't create an own camera now and is able to use an existing camera instead.<br><br>Additional, for my Legend of Faerghail (LOF) tests, I wrote a CSV2MAP utility which creates automatically a complete .MAP file out of a CSV file, completely caulked, textured, lights placed, chests placed, doors placed - ready to use. And now please don't laugh - as a 2D Map editor for this I use MS Excel :-D - I export the map to CSV, use CSV2MAP and render the BSP with NETradiant/Q3MAP2. In the folder maps/castle1 you find everything you need to modify the map yourself - it is the representation of the original LOF derelict castle level 1 map (always using 36x36 fields matrix).<br><br>To run my demo just download the first link only, if you want to modify the maps and play around with it you should download NETradiant first (second link), unzip to ex. C:\Netradiant and then execute the my ORCS.exe file (first link) in this folder - this makes Netradiant portable, too. The demo is in the subfolder blitz3d.game/data/demo.bb. Below there are subfolders for maps, textures, models, shaders following the quake3 folder structures (mandatory for Netradiant to work properly!).<br><br>How to play: moving with arrows, TAB switches between oldschool and freelook camera, LMB opens secret doors, RMB switches torch, M switches minimap (castle1 only) and SPACE switches wireframe mode. Oh and in the castle1 demo you can break two doors by running against them, over and over again :-D<br><br>And now have fun with it!<br><br>First Link: <a href="http://www.christianhart.de/bb/orcs/update1/ORCS.exe" target="_blank">Download O.R.C.S.</a><br>Second Link: <a href="http://www.icculus.org/netradiant/files/" target="_blank">Download NETradiant</a><br><br>Please read the credits.txt file for usage rights for some of the used media!<br><br><font class="tiny">Last edited 2010</font> <br><br></td></tr></table><br>
<a name="1059737"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sounds and looks really good. But I never thought that I will ever have to install MS Excel for game design - I hope Open Office works too :°) <br><br></td></tr></table><br>
<a name="1059738"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Krischan</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> &gt; I hope Open Office works too :°)<br><br>Didn't try it but as fallback you're free to create the CSV with notepad :-D <br><br></td></tr></table><br>
<a name="1059745"></a>

<a name="1059747"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SLotman</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Impressive as always :)<br><br>Any chance for a minib3d version?<br><br><font class="tiny">Last edited 2010</font> <br><br></td></tr></table><br>
<a name="1060284"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Zmatrix</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> looks good, :)<br><br>Sam <br><br></td></tr></table><br>
<a name="1060294"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >taumel</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh i would love to try this one out. Sadly there isn't a OSX version. <br><br></td></tr></table><br>
<a name="1145003"></a>

<a name="1145004"></a>

<a name="1145008"></a>

<a name="1145009"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Krischan</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm still playing <a href="http://en.wikipedia.org/wiki/Legend_of_Grimrock" target="_blank">Legend of Grimrock</a> and inspired by it I continued to work on this project. Here are some new screens from my current WIP. A very early (=empty) stage of an indoor level and a outdoor scene using Blitzsky for day/night transitions.<br><br>It is still made with Blitz3D and NetRadiant but I plan to move over to Blitzmax+MiniB3D. Unfortunately I couldn't find a simple solution with shader support to pimp the walls and better lighting using pixelshaders but it does still look nice even with DX7 lighting + lightmaps only.<br><br><a href="http://www.christianhart.de/bb/orcs/new/001.jpg" target="_blank"><img src="http://www.christianhart.de/bb/orcs/new/T001.jpg"></a> <a href="http://www.christianhart.de/bb/orcs/new/002.jpg" target="_blank"><img src="http://www.christianhart.de/bb/orcs/new/T002.jpg"></a> <a href="http://www.christianhart.de/bb/orcs/new/003.jpg" target="_blank"><img src="http://www.christianhart.de/bb/orcs/new/T003.jpg"></a><br><a href="http://www.christianhart.de/bb/orcs/new/004.jpg" target="_blank"><img src="http://www.christianhart.de/bb/orcs/new/T004.jpg"></a> <a href="http://www.christianhart.de/bb/orcs/new/005.jpg" target="_blank"><img src="http://www.christianhart.de/bb/orcs/new/T005.jpg"></a> <a href="http://www.christianhart.de/bb/orcs/new/006.jpg" target="_blank"><img src="http://www.christianhart.de/bb/orcs/new/T006.jpg"></a><br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1145016"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Trinosis</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Krischan.<br><br>Doesn't run for me.<br><br>Extracting the Orcs.exe reveals lots of files and folders but no runable .exe which i was expecting.<br><br>I can compile the demo.bb source file in Blitz3d but i get the error message, 'texture does not exist'.<br><br>Any ideas ?<br><br>Looks really good by the way. <br><br></td></tr></table><br>
<a name="1145020"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Krischan</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Did you update Blitz3D to the latest version? Looks like your version does not yet support DDS textures used in the demo. Here I use 1.106 and it compiles / runs from the start. <br><br></td></tr></table><br>
<a name="1145049"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Trinosis</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, you're right, my version of Blitz3d was out of date.<br><br>I havn't updated it in years.<br><br>That was a fun demo.<br><br>I have a couple of issues though.<br><br>I wasn't keen on the tile movement system.<br>After playing fps games for many years, tile movement feels quite odd and restrictive to me.<br><br>The castle level was pretty dark inside.  On my monitor, a lot of the time it was really too dark to see, even with the torch activated.<br><br>A gamma option would really help here, for users like myself who may have particularly dark monitors.<br><br>I also didn't like the default camera zoom value, which gave that fishbowl lense 3d effect.<br><br>So, i changed it to 'CameraZoom cam , 1.65' which gave a much more natural look.<br><br>Apart from those small niggles i think you have a good foundation here to make a really cool retro style rpg.<br><br>Any plans to make this into a full game ? <br><br></td></tr></table><br>
<a name="1145098"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ginger Tea</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Seeing as he was inspired by grimrock to get back onto this it comes as no surprise that it's old school grid based <br><br></td></tr></table><br>
<a name="1145135"></a>

<a name="1145136"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RemiD</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> I like how you use the flares for the lights, UT style :)<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1156384"></a>

<a name="1156385"></a>

<a name="1156386"></a>

<a name="1156387"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Krischan</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> I made a small demo snapshot from my current outdoor quad engine I'll use for ORCS later - I switched over to BlitzMax and miniB3D now. It is only the outdoor area with dynamic grass and billboard trees which will be sufficient - there are no "real" 3D trees there as I won't make it too complicated. It is looking nice to me even if the trees look weird when you're very close to them. But the ORCS engine uses oldschool block moving later so I don't have to care very much about this issue.<br><br>Use the mouse/arrows to move. Keys 1-3 change the scene time, 4 to 0 show/hide elements and V switches Vsync for FPS tests. Holding LMB elevates and RMB switches torchlight for night mode illumination. Except the sky and background mountains, there are only single surface quads which are updated very fast moving existing vertices only. Hope you like it.<br><br>How fast does it run at your system? Here on my three year old laptop I get up to 200FPS (C2D @ 2.53GHz / GeForce 9600MGT).<br><br><a href="http://www.christianhart.de/bb/orcs/dawn.jpg" target="_blank"><img src="http://www.christianhart.de/bb/orcs/dawn_t.jpg"></a> <a href="http://www.christianhart.de/bb/orcs/day.jpg" target="_blank"><img src="http://www.christianhart.de/bb/orcs/day_t.jpg"></a> <a href="http://www.christianhart.de/bb/orcs/night.jpg" target="_blank"><img src="http://www.christianhart.de/bb/orcs/night_t.jpg"></a><br><br><a href="http://www.christianhart.de/bb/orcs/demo.exe" target="_blank">Download Executable (4.7MB)</a><br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1156408"></a>

<a name="1156409"></a>

<a name="1156410"></a>

<a name="1156411"></a>

<a name="1156412"></a>

<a name="1156414"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hotshot2005</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> That is Excellent and I going download it :)<br><br>Have you heard of Grass party and Tree Party?<br><br>UPDATED: After checking your program...I have notice you used Tree sprites like you see in Doom where dead enemys on the floor and you turn left or right and you will see the enemys sprites move as same as you see the tree move in circle<br><br>I love the grass, trees and sky...<br><br>Well Done Man<br><br>62 FPS on WITHOUT Vsync<br><br>290 FPS ON With Vsync :)<br><br>3GHZ<br>4GB RAM<br>ATI Radeon 5870<br><br><font class="tiny">Last edited 2012</font><br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1156523"></a>

<a name="1156524"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jason W.</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hotshot, <br><br>How is that possible?  vsync on will lock the fps to refresh rate?  Maybe the refresh toggle is opposite.<br><br><br>Jason<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1156529"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Steve Elliott</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Around 56FPS (average).  Great atmosphere though, until you looked up. Kinda looked like there was a hole in the ceiling of a building - so you could see the stars. <br><br></td></tr></table><br>
<a name="1156541"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Krischan</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Steve - I can't reproduce your "problem" - on which GFX card did you test it? I changed the CameraRange and updated the upload - so please test it again. <br><br></td></tr></table><br>
<a name="1156548"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> i tested it on an old intel gfx card, 7 FPS :)<br><br>I had the same thing as steve elliot when i looked up <br><br></td></tr></table><br>
<a name="1156561"></a>

<a name="1156562"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Steve Elliott</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Gonna have to delete the notebook in my sig, then peeps would know lol ;)<br><br>[Edit]<br>I have.<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1156647"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Banshee</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> I tried both demos and I thought both were very cool.  I hope you finish it :) <br><br></td></tr></table><br>
<a name="1177641"></a>

<a name="1177642"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Imperium</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> Uh oh.... Somethings wrong?<br><img src="http://i50.tinypic.com/34s16gz.png"><br><br>Orcs worked just fine though. <br><br></td></tr></table><br>
<a name="1177648"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Krischan</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm looks weird. Anyway - here is the unoptimized code for the billboard scene and an update to ORCS, have fun to play around with it:<br><br><a href="http://www.christianhart.de/bmax/ORCSbillboard.zip" target="_blank">Download ZIP 9.7MB</a><br><br>For the indoor levels I played a little bit with Normalmaps and DOT3 lights but I'm not happy with it yet, I really need shader lighting here for better results. In the first screen I used a model from Oblivion to test my single model dot3 light function, it calculates the vertex colors according the light position and so the normalmap lights the mesh correctly, the diamonds are additional dot3 light sources dummys, the base lighting is done with static lightmaps, all done in vanilla miniB3D without shaders. It doesn't look "flat" anymore but could be much better with shaders.<br><br><a href="http://www.christianhart.de/bmax/dot3orcs1.jpg" target="_blank"><img src="http://www.christianhart.de/bmax/dot3orcs1_t.jpg"></a> <a href="http://www.christianhart.de/bmax/dot3orcs2.jpg" target="_blank"><img src="http://www.christianhart.de/bmax/dot3orcs2_t.jpg"></a> <a href="http://www.christianhart.de/bmax/dot3orcs3.jpg" target="_blank"><img src="http://www.christianhart.de/bmax/dot3orcs3_t.jpg"></a><br><br>Here my "dotlight.bmx" Include which I used for the DOT3 lighting of the model and the level, the B3D model has just the diffusemap applied to it - the texture name gets scanned and the brush will be reorganized with the normalmap which is always [diffusemapname]_n.png here. Please notice that the model should be pickable which I use to check if a model vertex can "see" the light source which is important to keep the dotlight inside rooms. The Lightsource is colored with 255,255,255 and a range of 128. I lose the vertex colors but I apply a single color texture created in CreateBaseTexture to recolor the whole model with a single color simulating colored light. There is only one light source / color possible now.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">' load oblivion well model
Const MINLIGHT:Int=128
Local model:TMesh=LoadAnimMesh("models/well/well.b3d")
EntityFX model,1+2
'EntityColor model,0,0,0
EntityPickMode model,2
EntityType model,2
'UpdateNormals model
ScaleEntity model,210,210,210
PositionEntity model,0,0,-512-64
RotateEntity model,0,180,0
UpdateMesh(model,128,128,MINLIGHT)

' Dot3 Model Lights
Local rgb:Int[]=[160,144,128]
'

RANGE=512
CreateDotLight(Model,False,0,64,-512-64,RANGE,MINLIGHT,rgb[0],rgb[1],rgb[2])

' retexture model with dot3 normal map
For Local s:Int=1 To CountSurfaces(model)

	Local surf:TSurface=GetSurface(model,s)
	Local brush:TBrush=GetSurfaceBrush(surf)
	Local newbrush:TBrush=CreateBrush()

	For Local t:Int=0 To 7

		Local tex:TTexture=Null

		If GetBrushTexture(brush,t) Then

			tex=GetBrushTexture(brush,t)

			Local diffusemap:TTexture=LoadTexture(TextureName(tex))
			Local normalmap:TTexture=LoadTexture(Replace(TextureName(tex),".png","_n.png"))
			Local colormap:TTexture=CreateBaseTexture(32,1,rgb[0],rgb[1],rgb[2])
			Local occlusion:TTexture=LoadTexture(Replace(TextureName(tex),".png","_o.png"))

			TextureBlend normalmap,4
			TextureBlend diffusemap,2
			TextureBlend colormap,5
			TextureBlend occlusion,5

			BrushTexture newbrush,normalmap,0,0
			BrushTexture newbrush,occlusion,0,1
			BrushTexture newbrush,diffusemap,0,2
			BrushTexture newbrush,colormap,0,3

		EndIf

	Next

	PaintSurface(surf,newbrush)

Next</textarea><br><br>dotlight.bmx Include:<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">' ----------------------------------------------------------------------
' Add a new Dot3 Light to a mesh
' ----------------------------------------------------------------------
Function CreateDotLight:TMesh(mesh:TMesh,vischeck:Int=True,x:Float=0.0,y:Float=0.0,z:Float=0.0,range:Float=128.0,minlight:Int=128,r:Int=255,g:Int=255,b:Int=255,dummysize:Int=8,dummyshow:Int=True)

	Local Light:TMesh=CreateSphere(2)
	ScaleEntity Light,dummysize,dummysize,dummysize
	EntityFX Light,1
	EntityColor Light,r,g,b
	PositionEntity Light,x,y,z
	DotLight(mesh,Light,range,minlight,vischeck)

	If dummyshow=False Then FreeEntity Light Else Return Light

End Function

' ----------------------------------------------------------------------------
' lighten up a level or model with a virtual Dot3 light
' ----------------------------------------------------------------------------
Function DotLight(mesh:TMesh,light:TEntity,range:Float=128.0,minlight:Int=128,vischeck:Int=True)

	Local s:Int,v:Int
	Local surf:TSurface

	Local piv:TPivot=CreatePivot()

	Local intensity:Float
	Local d:Float,d1:Float,d2:Float

	Local x:Float,y:Float,z:Float
	Local dx:Float,dy:Float,dz:Float
	Local r:Float,g:Float,b:Float
	Local r1:Float,g1:Float,b1:Float
	Local r2:Float,g2:Float,b2:Float

	Local lx:Float=EntityX(light,1)
	Local ly:Float=EntityY(light,1)
	Local lz:Float=EntityZ(light,1)

	Local vis:Int=False

	' cycle all surfaces
	For s=1 To CountSurfaces(mesh)

		' get current surface
		surf=GetSurface(mesh,s)

		' cycle all vertices
		For v=0 To CountVertices(surf)-1

			' transform vertex coordinates to local coordinates
			TFormPoint VertexX(surf,v),VertexY(surf,v),VertexZ(surf,v),mesh,Null
			x=TFormedX()
			y=TFormedY()
			z=TFormedZ()

			' unflag vertex
			vis=False

			' position helper pivot to vertex position
			' and move it a little bit towards the light source
			PositionEntity piv,x,y,z
			PointEntity piv,light
			MoveEntity piv,0,0,0.1

			' get distance from light to vertex
			d1=EntityDistance(light,piv)

			' vertex within light range?
			If d1&lt;=range And vischeck=True Then

				' do a linepick between light and vertex
				If LinePick(lx,ly,lz,x-lx,y-ly,z-lz) Then

					' flag vertex
					vis=True

					' position helper pivot to picked position
					PositionEntity piv,PickedX(),PickedY(),PickedZ()

					' check distance to picked position from light
					d2=EntityDistance(light,piv)

					' distance too short? unflag vertex = hit something
					If d2&lt;d1 Then vis=False

				EndIf

			EndIf

			' only if vertex is flagged
			If (vis=True Or vischeck=False) And d1&lt;range Then

				' calculate delta vector
				dx=x-lx
				dy=y-ly
				dz=z-lz

				' calculate distance to delta vector
				d=Sqr(dx*dx+dy*dy+dz*dz)

				' calculate light intensity
				intensity=1.0-(d/(range*2))
				If intensity&lt;0.0 Then intensity=0.0

				' transform vertex normal to local coordinates
				TFormNormal VertexNX(surf,v),VertexNY(surf,v),VertexNZ(surf,v),mesh,Null

				' position helper pivot to new coordinates
				PositionEntity piv,TFormedX(),TFormedY(),TFormedZ(),1

				' align helper pivot to vector
				AlignToVector(piv,TFormedX(),TFormedY(),TFormedZ())

				' rotate helper pivot
				RotateEntity piv,EntityPitch(piv,1),EntityYaw(piv,1),0,1

				' transform delta vector to local coordinates			
				TFormNormal dx,dy,dz,light,piv
				x=TFormedX()
				y=TFormedY()
				z=TFormedZ()
				
				' calculate new dot3 colors
				r1=255-((1.0-x)*127.5*intensity)
				g1=255-((1.0-y)*127.5*intensity)
				b1=((1.0-z)*127.5*intensity)

				' lighten dark areas if set
				If b1&lt;minlight Then b1=minlight

				r2=VertexRed(surf,v)
				g2=VertexGreen(surf,v)
				b2=VertexBlue(surf,v)

				r=Overlay(r1,r2)
				g=Overlay(g1,g2)
				b=Overlay(b1,b2)

				' assign new color to vertex
				VertexColor surf,v,r,g,b

			EndIf			

		Next

	Next

End Function

' ----------------------------------------------------------------------------
' create a unicolor base texture for coloring a mesh
' ----------------------------------------------------------------------------
Function CreateBaseTexture:TTexture(size:Int=32,flags:Int=8,r:Int=255,g:Int=255,b:Int=255,a:Float=1.0)
	
	Local x:Int,y:Int
	Local pixmap:TPixmap=CreatePixmap(size,size,PF_RGBA8888)
	
	For x=0 To size-1

		For y=0 To size-1

			WritePixel(pixmap,x,y,CombineARGB(a*255,r,g,b))

		Next

	Next
	
	Return LoadTexturePixmap(pixmap,flags)
		
End Function

' ----------------------------------------------------------------------------
' missing AlignToVector function for miniB3D
' ----------------------------------------------------------------------------
Function AlignToVector(entity:TEntity,x:Float,y:Float,z:Float)
	
	Local yaw:Float,pitch:Float,roll:Float
	Local x1:Float,y1:Float,z1:Float
	Local x2:Float,y2:Float,z2:Float
	Local x3:Float,y3:Float,z3:Float
	
	yaw=-ATan2(x,z)
	
	x1=z*Sin(yaw)+x*Cos(yaw)
	y1=y	
	z1=z*Cos(yaw)-x*Sin(yaw)
	
	pitch=-ATan2(y1,z1)

	x2=x1
	y2=y1*Cos(pitch)-z1*Sin(pitch)
	z2=y1*Sin(pitch)+z1*Cos(pitch)
	
	roll= -ATan2(x2, y2)

	x3=x2*Cos(roll)-y2*Sin(roll)
	y3=x2*Sin(roll)+y2*Cos(roll)
	z3=z2

	If y&lt;0 Then roll:+180
	
	RotateEntity entity,pitch,yaw,roll
	
End Function

' ----------------------------------------------------------------------------
' change mesh Vertex Colors
' ----------------------------------------------------------------------------
Function UpdateMesh(mesh:TMesh,r:Int=255,g:Int=255,b:Int=255,a:Float=-1)
	
	Local v:Int
	Local s:Int
	Local surf:TSurface
	Local alpha:Float

	For s=1 To CountSurfaces(mesh)

		surf=GetSurface(mesh,s)
	
		For v=0 To CountVertices(surf)-1

			If a&lt;0 Then
				alpha=VertexAlpha(surf,v)
			Else
				alpha=a
			EndIf
		
			VertexColor surf,v,r,g,b,alpha
		
		Next

	Next
	
End Function</textarea><br><br>Additional here is the pixmap.bmx include used for LoadTexturePixmap:<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">' ----------------------------------------------------------------------------
' Return A value of a given RGB value
' ----------------------------------------------------------------------------
Function GetA:Int(RGB:Int)
	
	Return RGB Shr 24 &amp; %11111111
	
End Function

' ----------------------------------------------------------------------------
' Return R value of a given RGB value
' ----------------------------------------------------------------------------
Function GetR:Int(RGB:Int)
	
    Return RGB Shr 16 &amp; %11111111
	
End Function

' ----------------------------------------------------------------------------
' Return G value of a given RGB value
' ----------------------------------------------------------------------------
Function GetG:Int(RGB:Int)
	
	Return RGB Shr 8 &amp; %11111111
	
End Function

' ----------------------------------------------------------------------------
' Return B value of a given RGB value
' ----------------------------------------------------------------------------
Function GetB:Int(RGB:Int)
	
	Return RGB &amp; %11111111
	
End Function

' ----------------------------------------------------------------------------
' Return RGB value of given R,G,B single values
' ----------------------------------------------------------------------------
Function CombineRGB:Int(r:Int,g:Int,b:Int)

	Return b | (g Shl 8) | (r Shl 16)
	
End Function

' ----------------------------------------------------------------------------
' Return ARGB value of given R,G,B,A single values
' ----------------------------------------------------------------------------
Function CombineARGB:Int(a:Int,r:Int,g:Int,b:Int)

	Return b | (g Shl 8) | (r Shl 16) | (a Shl 24)
	
End Function

' ----------------------------------------------------------------------------
' Load a pixmap to a brush
' ----------------------------------------------------------------------------
Function LoadBrushPixmap:TBrush(pixmapin:TPixmap,flags:Int=1,u_scale:Float=1.0,v_scale:Float=1.0)

	Return PixTBrush.LoadBrushPixmap(pixmapin,flags,u_scale,v_scale)
	
End Function

' ----------------------------------------------------------------------------
' Load a pixmap to a texture
' ----------------------------------------------------------------------------
Function LoadTexturePixmap:TTexture(pixmapin:TPixmap,flags:Int=1)

	Return PixTTexture.LoadTexturePixmap(pixmapin,flags)
	
End Function

Type PixTBrush Extends TBrush

	Function LoadBrushPixmap:TBrush(pixmapin:TPixmap,flags:Int=1,u_scale:Float=1.0,v_scale:Float=1.0)
	
		Local brush:TBrush=New TBrush
		
		brush.tex[0]=PixTTexture.LoadTexturePixmap:TTexture(pixmapin,flags)
		brush.no_texs=1
		
		brush.tex[0].u_scale#=u_scale#
		brush.tex[0].v_scale#=v_scale#
				
		Return brush
		
	End Function
	
End Type

Type PixTTexture Extends TTexture

	Function LoadTexturePixMap:TTexture(pixmapin:TPixmap,flags:Int=1,tex:TTexture=Null)
	
		Return LoadAnimTexturePixMap:TTexture(pixmapin,flags,0,0,0,1,tex)
		
	End Function

	Function LoadAnimTexturePixMap:TTexture(pixmapin:TPixmap,flags:Int,frame_width:Int,frame_height:Int,first_frame:Int,frame_count:Int,tex:TTexture=Null)
	
		Local pixmapFileName:String="pixmap"+MilliSecs()+Rnd()
		
		If flags&amp;128 Then Return LoadCubeMapTexture(pixmapFileName$,flags,tex)
	
		If tex=Null Then tex:TTexture=New TTexture
		
		tex.file:String=pixmapFileName
		tex.file_abs:String=pixmapFileName
		
		' set tex.flags before TexInList
		tex.flags=flags
		tex.FilterFlags()
		
		' check to see if texture with same properties exists already, if so return existing texture
		Local old_tex:TTexture
		old_tex=tex.TexInList()
		If old_tex&lt;&gt;Null And old_tex&lt;&gt;tex
			Return old_tex
		Else
			If old_tex&lt;&gt;tex
				ListAddLast(tex_list,tex)
			EndIf
		EndIf
	
		' load pixmap
		tex.pixmap = CopyPixmap(pixmapin)
		
		' check to see if pixmap contain alpha layer, set alpha_present to true if so (do this before converting)
		Local alpha_present:Int=False
		If tex.pixmap.format=PF_RGBA8888 Or tex.pixmap.format=PF_BGRA8888 Or tex.pixmap.format=PF_A8 Then alpha_present=True
	
		' convert pixmap to appropriate format
		If tex.pixmap.format&lt;&gt;PF_RGBA8888
			tex.pixmap=tex.pixmap.Convert(PF_RGBA8888)
		EndIf
		
		' if alpha flag is true and pixmap doesn't contain alpha info, apply alpha based on color values
		If tex.flags&amp;2 And alpha_present=False
			tex.pixmap=ApplyAlpha(tex.pixmap)
		EndIf		
	
		' if mask flag is true, mask pixmap
		If tex.flags&amp;4
			tex.pixmap=MaskPixmap(tex.pixmap,0,0,0)
		EndIf
		
		' ---
		
		' if tex not anim tex, get frame width and height
		If frame_width=0 And frame_height=0
			frame_width=tex.pixmap.width
			frame_height=tex.pixmap.height
		EndIf
	
		' ---
		
		tex.no_frames=frame_count
		tex.gltex=tex.gltex[..tex.no_frames]
	
		' ---
		
		' pixmap -&gt; tex
	
		Local xframes:Int=tex.pixmap.width/frame_width
		Local yframes:Int=tex.pixmap.height/frame_height
			
		Local startx:Int=first_frame Mod xframes
		Local starty:Int=(first_frame/yframes) Mod yframes
			
		Local x:Int=startx
		Local y:Int=starty
	
		Local pixmap:TPixmap
	
		For Local i:Int=0 To tex.no_frames-1
	
			' get static pixmap window. when resize pixmap is called new pixmap will be returned.
			pixmap=tex.pixmap.Window(x*frame_width,y*frame_height,frame_width,frame_height)
			x=x+1
			If x&gt;=xframes
				x=0
				y=y+1
			EndIf
		
			' ---
		
			pixmap=AdjustPixmap(pixmap)
			tex.width=pixmap.width
			tex.height=pixmap.height
			Local width:Int=pixmap.width
			Local height:Int=pixmap.height
	
			Local name:Int
			glGenTextures 1,Varptr name
			glBindtexture GL_TEXTURE_2D,name
	
			Local mipmap:Int
			If tex.flags&amp;8 Then mipmap=True
			Local mip_level:Int=0
			Repeat
				glPixelStorei GL_UNPACK_ROW_LENGTH,pixmap.pitch/BytesPerPixel[pixmap.format]
				glTexImage2D GL_TEXTURE_2D,mip_level,GL_RGBA8,width,height,0,GL_RGBA,GL_UNSIGNED_BYTE,pixmap.pixels
				If Not mipmap Then Exit
				If width=1 And height=1 Exit
				If width&gt;1 width:/2
				If height&gt;1 height:/2
	
				pixmap=ResizePixmap(pixmap,width,height)
				mip_level:+1
			Forever
			tex.no_mipmaps=mip_level
	
			tex.gltex[i]=name
	
		Next
				
		Return tex
		
	End Function
	
End Type</textarea> <br><br></td></tr></table><br>
<a name="1177837"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ian Thompson</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> I find a non shader based DOT3 very interesting, its good to see how its done in BMX code. Now if you could show me how to do your own runtime shadow maps that would make my day Krischan! <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
