<!DOCTYPE html><html lang="en" ><head ><title >High speed rendering of distant objects</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >High speed rendering of distant objects</h1><a href="forums.php" >Community Forums</a>/<a href="topics.php?forum=61" >Showcase</a>/<a href="#bottom" >High speed rendering of distant objects</a><br><br>
<a name="246884"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Take a look at this image taken from one of my terrains...<br><br><img src="http://home.earthlink.net/~sswift/screen01.jpg"><br><br>Notice anything funny?<br><br>I'll give you a hint.  That terrain is one kilometer wide.  It is comprised of an 8x8 grid of tiles, each of which has a grid of 32x32 discreet heights, making for a total of 2048 polygons per tile, and 131,072 total polygons.<br><br>There is no level of detail management going on here... distant tiles have the same number of polygons as tiles nearby.  Yet you can clearly see that the polygon counter says that less than 30,000 polygons are visible and the framerate is exceptionally high.<br><br>You might also notice on close inspection that the terrain in the distance appears out of focus.<br><br>What I have done is created a system which can take any 3D  scene, and render the stuff in the distance to textures, which can are then used in place of said objects until such time as they become out of date.<br><br>In other words, you can walk to those mountains in the distance, and there will be no detail popping.  And, because I've gotten rid of level of detail management, all the textures on the ground can be very high-res and use splatting with vertex alpha, which is pretty much impossible to do if you've got  any kind of LOD management on the terrain.  In addition, lighting informantion can be baked into the vertex data instead of requiring a seperate lightmap, and as a result the lighting can be fairly detailed.<br><br>I have not yet implemented any kind of texture splatting, or specialized lighting routines, as I've just gotten the rendering working, and there's still some issues to be ironed out.  Namely a dramatic drop in speed when one actually walks around versus simply looking in any direction.  What I need to do is put in some code to manage the texture rendering so that it doesn't render textures unneccesarily, and some code to blend between updates so that I can update less often than once every four meters.<br><br>But so far it looks really cool and I'm happy with how it's progressing.  I was inspired by Zelda: WInd Waker, Mario Sunshine, and Conker's Bad Fur day, each of which appear to render objects in the distance with a method similar to this, switching to polygons only when you get near enough for it to make a difference.  I may add a heat-shimmer effect as well because that may serve to hide any artifacts which still may be visible, and increase the apparent resolution of the background.... ie, hide pixelation. <br><br></td></tr></table><br>
<a name="246889"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ricky Smith</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Awesome ! <br><br></td></tr></table><br>
<a name="246892"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Binary_Moon</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> AFAIK This is how they done the infinite polygon engine in Republic. I don't think they used a texture but a buffer that didn't get cleared until you move far enough.<br><br><img src="http://www.elixir-studios.co.uk/nonflash/screens_06_03/pop/City4.jpg"><br><br>So is this going to come with your terrain system :) ?<br><br>I think as long as you don't use an insane screen resolution the pixelation of distant terrain won't matter too much anyway. What you show above looks ok. It gives a sort of depth of field effect. <br><br></td></tr></table><br>
<a name="246897"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> "So is this going to come with your terrain system :) ?"<br><br>This is part of a complete rewrite of my terrain system, and I wouldn't hold my breath waiting for it (the new terrain system) because I don't know if I will complete it anytime soon.  When it is completed it will be a seperate product from my current terrain system, leaving the old system obsolete.<br><br>I may license this technology seperately for less, depending on how plug and play it turns out to be.  As it currenty is, it's very simple to use.  You don't even have to pass it a list of entities.<br><br>...<br><br>As for Republic... I dunno.  I don't see much bluriness in that image, so it doesn't really seem like it's using impostors.<br><br>I suspect they are using a combination of models with varying levels of detail, and displacement maps which are used to deform flat surfaces as you approach to make them appear more detailed. <br><br></td></tr></table><br>
<a name="246900"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Binary_Moon</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> "and I wouldn't hold my breath waiting for it"<br><br>As I told you the other day. I am making a top down game next so it wouldn't be much use for me anyway, I just wondered if you would be selling uit or if you were using it in your own game.<br><br>"As it currenty is, it's very simple to use. You don't even have to pass it a list of entities."<br><br>Hows that work then? You're using the camera range to render the distant stuff, and then swapping back to a close range to do the nearby stuff.<br><br>As for Republic... I'm sure its something along those lines, I'm trying to remember where i read the article about it. <br><br></td></tr></table><br>
<a name="246905"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> "Hows that work then?"<br><br>Anchient Chinese secret! <br><br></td></tr></table><br>
<a name="246940"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >CopperCircle</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Looks interesting, id like to see a demo. <br><br></td></tr></table><br>
<a name="246954"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >(tu) ENAY</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> &gt; Anchient Chinese secret! <br><br>Rice? <br><br></td></tr></table><br>
<a name="247052"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Customer:  How do you get your shirts so clean, Mr. Lee?    <br><br>Mr. Lee:  Ancient Chinese Secret.    <br><br>Mrs. Lee  My husband, some hot shot. Here's his ancient Chinese secret. Calgon. Calgon's two water softeners soften wash waters so detergents clean better, In hardest water, Calgon helps detergents get laundry up to 30% cleaner. [yelling] We need more Calgon!    <br><br>Customer: [to Mr. Lee] Ancient Chinese Secret, Huh!    <br><br>Announcer:  Calgon helps detergents get laundry up to 30% cleaner.     <br><br>--1972 Calgon TV Commercial <br><br></td></tr></table><br>
<a name="247057"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Warren</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you have to explain the joke, it isn't worth it. <br><br></td></tr></table><br>
<a name="247065"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> :-) <br><br></td></tr></table><br>
<a name="247072"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MadJack</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> I suspect Swift's rendering with a cam range set to something like 1024 near focus to 2048 far focus, in a reduced window, copying to a sprite, rendering a second cam at fullscreen with the sprite set to entityorder 1, so that it's rendered behind everything else. <br><br></td></tr></table><br>
<a name="247073"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Pepsi</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Pretty impressive sswift... also would like to see a demo of it in action. <br><br></td></tr></table><br>
<a name="247078"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Madjack:<br>You are basically correct, as was binarymoon who suggested something similar.<br><br>What I do is render six images, one for each side of a skybox, with the camera range for the regular camera set to some low set of values, and the camera range for the distant camera set to some range that starts just before the near camera cuts out.<br><br>But I also store the location the image was rendered from, in order to determine how much the image might have changed, so I can render it only when neccessary.<br><br>The sky is included in the distant image, and the new skybox replaces it.  It's entity order is set such that it rendered first, behind everything else.<br><br>I'd post a demo, but I've got most of my web space filled up with stuff I can't delete, and it's not yet ready for prime time because right now it's slow.<br><br>I need to figure out a way to speed it up.  Rendering one side at a time will only help out a little.  I need to find a way to render less than one side each time.  Also, it would be beneficial if when I copied to the texture the alpha information in the image was retained.  It currently is not, and I'm pretty sure that if I tried to copy it manually it would be too slow and would not work well. <br><br></td></tr></table><br>
<a name="247147"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Koriolis</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> It seems good. When I tried to do some exotic tiling terrain system, I used tricks of this way. And in the end I faced the same speed problem as you (as well as problem with the alpha not being retained, knowing that anyway it would maybe not a good idea to rely on the framebuffer having 32 bits of color depth). The main problem in the end for me was the mipmapping: I needed to have mipmap on, but each time I copied from the framebuffer to the texture this damd Blitz recreated the lower mipmap levels, very slowly and not in a way I could hide it (it tends to lock up the rendering). If we could set all the mipmappings levels ourselves, I'm pretty sure the overall system would be fast enough.<br>Anyway, you maybe don't need to have mipmapping on at all for your generated skybox (as its resolution is smaller than the screen resolution, and the maximum angle from which faces are seen shouldn't be too high). So if it's currently on, try to deactivate it and see if it helps. If it's not, well, sorry for this blabla :) <br><br></td></tr></table><br>
<a name="247490"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tom</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> sswift, cool idea.<br><br>Don't you code in C at all? I would have thought someone with your knowledge would, and could put it to use speeding up some of your ideas.<br><br>Tom <br><br></td></tr></table><br>
<a name="247541"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Koriolis:<br>Disabling mipmapping has no effect on the speed.<br><br>Tom:<br>I used to code in C, but I never did like C, and I stopped programming in it years ago.  I looked at getting back into programming in C a few years ago, but in order to do anything in Windows you really need to know C++ since all the example code and documentation refers to C++ stuff.  I like C++ even less than I like C.  So I never got into programming in DirectX in C beyond some very basic example programs.<br><br>I always prepferred Pascal to C, and Blitz is a lot more like Pascal than like C. <br><br></td></tr></table><br>
<a name="248432"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jager</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> looks exciting sswift, good luck. <br><br></td></tr></table><br>
<a name="248479"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >podperson</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Neat stuff Sswift. I'd assume that worst case you need only render three sides of the skybox.<br><br>A simple system for reducing re-rendering. Move the skybox with the character until the character has moved a threshold distance. (Or had you thought of that already?) <br><br></td></tr></table><br>
<a name="248515"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rob Farley</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> Very cool Shawn...<br><br>May I suggest a way of reducing the amount of renders would be to move the skybox as te cam moves it as the cam moves, ie, if you move the cam in a +X direction move the skybox in a -X direction, this way you'll get the background scaling the correct amount and maybe you won't need to render so often. You might have to make the skybox bigger to compensate for it off-setting though.<br><br>And as Podperson suggested you don't need to render behind you. But you already knew that!<br><br>Oh one more thing, you could still do you vertex splatting if you had a fixed LOD if you wanted to reduce the poly count further.<br><br>Just thoughts... looking really good though. <br><br></td></tr></table><br>
<a name="248539"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Koriolis</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> As a skybox, of course it is centered aroudn the camera (if you prefer, it moves with the player). Also the real intent of all this is of course not to render far polygons each frame, but to use a threshold. If the skybox was rendered every frame it would be a real non-sense, as you would in the end render as much as polygons as you would without this system, with the overhead of copying from the frambuffer to the skybox textures, and having mre renderworlds (to create the content of these textures)!<br>So yes, Podperson and Dr Av, it uses a threshold :)<br>Now for the idea of rendering only 3 sides in the worst case, this is maybe a good idea, but I think there are problems with that.<br>To be efficient and not having moments where the game is really slow, the ideal would be no to render more than 1 face by frame (in fact the ideal is to render far less per frame). Meaning at a frame the system could be rendering a face, 5 frames later, another face, and so on. If you only render 3 faces of the skybox, what happens if the player suddenly turns the camera from 180°?<br>1) The system updates the faces in the back, which means it will suddenly be slow and then be smooth again. Not good at all IMHO (and against the idea of the whole system).<br>2) The system keeps working as usual (rendering a face each 'N' frames). So for a while you'll see empty box faces (or rather faces fulled with "garbage" content, which corresponds to the way the world looked the last time you have looked in this direction).<br><br>So even if you don't look back the system should update the back faces along with the others, to be be ready when the user look back suddenly.<br><br>@SSwift: hem, tell me if I'm wrong on something, I'll shut my mouth. These are just my personal thought on the subject, as it's been a while since I'm thinking of doing such a system for taking benefit of frame to frame coherency. <br><br></td></tr></table><br>
<a name="248563"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> "May I suggest a way of reducing the amount of renders would be to move the skybox as te cam moves it as the cam moves, ie, if you move the cam in a +X direction move the skybox in a -X direction, this way you'll get the background scaling the correct amount and maybe you won't need to render so often."<br><br><br>I already tried that, and for some reason it works terribly.  In fact, the rendering seems to go wild and the image on the skybox jumps around like mad.  I don't understand why that was occuring.  I would think it was a bug, but I looked over my code a hundred times and I couldn't figure out what was going wrong.<br><br>What I did was I turned off skybox moving unless the skybox image was updated, and the image was updated evert few meters just as before.  But for some reason when I would walk up hills all of a sudden the sky could turn black or shift downward suddenly.  This happened even if I only moved a little bit away from the point where a render last occured.  I can't for the life of me understand why it would do that.<br><br><br>"And as Podperson suggested you don't need to render behind you. But you already knew that!"<br><br>Well I have not actually implemented code to render only in specific directions mainly because it would still be too slow, so there's no point in optimizing that.<br><br>One method I have been considering is to somehow render smaller slices.  Instead of rendering four sides of a cube, I would instead render the sides of a cylinder, which could have many more sides than the cube, so I could render much smaller sections of distant detailed terrain each frame.<br><br>Also, one thing I might do is combine multiple renders into a single texture building the texture up over time intead of rendering a whole texture at once.  So even if I rendered to an 8 sided cylinder, I could divide that rendering up into an arbitrary number of render slices and render each side texture in 16 thin slices.  Because only the texture needs to be square, not the render window. <br><br></td></tr></table><br>
<a name="248594"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JustLuke</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> Mr. Sswift, you sir are a liar.<br><br>Since I live in China I decided to find out about this "Ancient Chinese Secret" for myself.<br><br>I walked down the road and asked a wrinkly, wise-looking, old Chinese man about the secret of high speed terrain rendering. At first he looked confused by my english questions, so I decided that maybe I needed to talk more slooowly and LOUDLY. This made him angry. I repeated my questions once again, this time accompanied with wild gestures. His anger turned to fear.<br><br>Eventually I gave up, bought a watermelon from his cart and returned home none the wiser. Chinese secret... Yeah, right! <br><br></td></tr></table><br>
<a name="248606"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> Was it one of those cool cubic watermellons like the ones which you can purchase in Japan because they fit in their tiny refrigerators better?<br><br>I want a bicubic watermellon. <br><br></td></tr></table><br>
<a name="248613"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JustLuke</td><td align="right"><font class=tiny>(Posted 2003)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nah, it was a Chinese Watermelon - Covered in spit and with a crispy toxic pesticide coating. Ideal for underpowered Chinese refrigerators that don't keep anything fresh. Frankly, being left to rot away uneaten is the best thing for it.<br><br>Mmm... Hypercubic Watermelon. *drool* <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
