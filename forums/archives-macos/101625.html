<!DOCTYPE html><html lang="en" ><head ><title >HowTo detect CMD + Option + Escape</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >HowTo detect CMD + Option + Escape</h1><a href="forums.php" >Archives Forums</a>/<a href="topics.php?forum=107" >MacOS X Discussion</a>/<a href="#bottom" >HowTo detect CMD + Option + Escape</a><br><br>
<a name="1207662"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ravl</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>On MAC I have to save the game before the app is Force Quit.<br><br>The publishers are testing this by pressing the CMD+OPTION+Esc key in order to bring the TaskManager and then they kill the application.<br><br>I am not able to catch this event it seems, in order to save the game when the combination pressed. I tried with:<br><br><pre class=code>
If KeyDown(KEY_LSYS) and KeyDown(KEY_LALT) And KeyDown(KEY_Scpae)

EndIf
</pre><br>How are <br><br></td></tr></table><br>
<a name="1207672"></a>

<a name="1207676"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's beyond my knowledge, but you need to intercept the SIGTERM signal that your application will receive.<br>Take a look at BlitzMax\mod\pub.mod\freeprocess.mod.<br><br>First of all, are you sure you can't intercept when they do this with AppTerminate() or EVENT_APPTERMINATE?<br><br>A short-term measure is to rather intercept a <b>loss of focus</b> (EVENT_APPSUSPEND) of your program and save the game then - your program will always lose focus before someone terminates it with the Activity Monitor.<br>For this you can add a custom hook to the EmitEventHook ID.<br><br><pre class=code>Function applicationHook:Object( id:Int, data:Object, context:Object )

	Local ev:TEvent=TEvent(data)
	If Not ev Then Return data

	Select ev.id
		Case EVENT_APPSUSPEND
			SaveGame() 'Lost focus, and may be terminated in the future.

		Case EVENT_APPTERMINATE		
			AskToSaveGame()
			End		
	End Select

	Return data

End Function</pre>Adding it with... <br><br>AddHook( EmitEventHook, applicationHook, Null ) <br><br>...at the beginning of your program. <br><br></td></tr></table><br>
<a name="1207673"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xlsior</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'd assume that the task manager would actively send an event to the app to  signal that a force-quit was issued, before it actually kills the task?<br><br>Are you monitoring the eventqueue? <br><br></td></tr></table><br>
<a name="1207683"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Do you really need to do this?  Surely your game is saved automatically at regular intervals throughout the game anyway? <br><br></td></tr></table><br>
<a name="1207696"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ravl</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well... and here it is a big 'Well...':<br><br>@Kryzon: thanks for this answer and for the code. I never used these functions.. (AddHook).<br><br>@xlsior: no!<br><br>@Gfk:<br>yes, this is the main issue. It's no use for me to monitoring this event in particular. the publisher is using this method (also on windows os they choose the app from Task manager and kill it) to test what is happening after thost 60 minutes of demo.<br><br>in my game, if you play for 60 minutes and you are not saving, the game will be close by their program and the user lost all his save data (in demo).<br><br>i am already know when the user is lost the focus of the window, because i am pausing the music, but the idea it's to prevent that program to kill the user experience, so.. i decided to make an auto save every 60 seconds.<br><br>hope that will do the trick <br><br></td></tr></table><br>
<a name="1207717"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Make sure to build your game as a GUI app (it's an option under Program -&gt; Build Options -&gt; Build GUI App in the IDE).<br>It should make a positive difference in how the OS communicates with your application.<br><br>Also, check these:<br><a href="http://stackoverflow.com/questions/4914284/how-do-i-run-code-when-a-user-agent-process-terminates" target="_blank">http://stackoverflow.com/questions/4914284/how-do-i-run-code-when-a-user-agent-process-terminates</a><br><a href="http://stackoverflow.com/questions/12313126/detect-end-process-from-task-manager-in-c-sharp" target="_blank">http://stackoverflow.com/questions/12313126/detect-end-process-from-task-manager-in-c-sharp</a> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
