<!DOCTYPE html><html lang="en" ><head ><title >Can anyone help me with this Objective-C?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Can anyone help me with this Objective-C?</h1><a href="forums.php" >Archives Forums</a>/<a href="topics.php?forum=107" >MacOS X Discussion</a>/<a href="#bottom" >Can anyone help me with this Objective-C?</a><br><br>
<a name="751139"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SebHoll</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>I've been trying to make an equivalent Mac OS X function as alternatives to the <i>ScreenToClient()</i> and <i>ClientToScreen()</i> Windows API functions and am finding it extremely hard picking up the language. Basically what I would like to do is to get the absolute screen co-ordinates of a point when I pass a position within a panel, and vice-verse (i.e. get the relative position of a absolute screen point from a specific panel). <br><br>I've currently got the following...<br><br><b><i>Working Code At Bottom of Thread</i></b><br><br>However as soon as it calls the external function, the program crashes... The code is taken from some sample code around the web where it apparently works.<br><br>Many thanks for all your help,<br><br><br>Seb <br><br></td></tr></table><br>
<a name="751148"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can't return structs to BitzMax as your declaration is expecting a pointer to a blitzmax type not an actual instance of a raw NSPoint.<br><br>You can't return a pointer to the NSPoint because it has been allocated on the stack.<br><br>I would pass an int pointer to the function and write the result there. <br><br></td></tr></table><br>
<a name="751172"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SebHoll</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for replying Skid...<br><br><div class="quote"> I would pass an int pointer to the function and write the result there.  <br></div><br><br>I've had a go, but I can't work out how to return the value of the int pointer in the function properly.<br><br><b><i>Working Code At Bottom of Thread</i></b><br><br>...gives me a compiler error message of "<i>Incompatible type for argument 1 of NSMakePoint</i>". Any ideas?<br><br><br>Cheers<br><br><br>Seb <br><br></td></tr></table><br>
<a name="751256"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Craig Watson</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> You need to dereference the pointers (ie. *x,*y) because NSMakePoint expects plain ints (technically floats.)<br><br>Since you want to return pointer ints you will need to assign them the address of returnPoint.x,y items.<br><br>You should remove :Point from your functions because they don't return a Point.<br><br>You should be able to achieve the same stuff through Carbon/C++ if you'd prefer. <br><br></td></tr></table><br>
<a name="751289"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SebHoll</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Cheers Craig...<br><br><div class="quote"> You need to dereference the pointers (ie. *x,*y) because NSMakePoint expects plain ints (technically floats.) <br></div><br><br>I found a tutorial on pointers in Objective-C <a href="http://www.cocoadev.com/index.pl?HowToUsePointers" target="_blank">here</a>. So I updated the code with the tweaks you mentioned, and it's compiling.<br><br>However it's giving me really strange negative values where 0 is reported when the mouse is moved near the top left corner.<br><br><b><i>Working Code At Bottom of Thread</i></b><br><br>Any more ideas? Thanks<br><br><br>Seb <br><br></td></tr></table><br>
<a name="751318"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Craig Watson</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Instead of using those temporary ints, just dereference x and y directly in NSMakePoint, so NSMakePoint(*x,*y) should work fine.<br><br>I guess I'm not really sure what you're trying to achieve.  The Cocoa coordinate system starts from the bottom left, so the numbers may not be what you expect.<br><br>From what I can tell from your code, the relativeTo function will return the x and y position relative to the whole screen.  The absoluteFrom will return a value telling you how the x and y screen coordinates you give are relative to the view.  The mouse event values you provide therefore are going to look odd, number one because they start in the top-left, and number two because they are window relative.<br><br>Instead of getting mousex and y, try setting a specific screen coordinate (ie. 10,10=bottom left corner) and then using your function, move the window around relative to that and you'll get how it works. <br><br></td></tr></table><br>
<a name="751400"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SebHoll</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Craig...<br><br>I think we've cracked it - I managed to get the absoluteFrom function to work correctly (i.e. returning absolute screen co-ordinates from panel coords). In order to do so, I had to convert the bottom-left coordinate so it's relative to top-left. <br><br>From there, relativeTo function was easy by finding the absolute distance between point 0,0 on the panel and the passed location gives me the relative positions.<br><br>In case anybody is interested. Here's the working program:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">SuperStrict

Import "screenposlib.m"

Extern "macos"

	Function relativeTo(x:Int Ptr, y:Int Ptr, panel:Int)
	Function absoluteFrom(x:Int Ptr, y:Int Ptr, panel:Int)
	
EndExtern

Global wndMain:TGadget = CreateWindow("Test Window",100,100,400,300,Null,15)

	Global gadPanel1:TGadget = CreatePanel(10,10,150,250,wndMain,PANEL_ACTIVE)
	SetPanelColor(gadPanel1,128,255,0)
	Global gadPanel2:TGadget = CreatePanel(160,10,150,250,wndMain,PANEL_ACTIVE)
	SetPanelColor(gadPanel2,255,128,0)
	
Repeat

	Select WaitEvent()
	
		Case EVENT_WINDOWCLOSE;End
		
		Case EVENT_MOUSEMOVE
			
			?MacOs
			
			DebugLog CurrentEvent.ToString$()
			
			Local tmpX% = EventX(),tmpY% = EventY()
			
			absoluteFrom(Varptr(tmpX),Varptr(tmpY),QueryGadget(TGadget(EventSource()),QUERY_NSVIEW_CLIENT))
			
			DebugLog "Screen Mouse x: " + tmpX + " Screen Mouse y: " + tmpY
			
			relativeTo(Varptr(tmpX),Varptr(tmpY),QueryGadget(TGadget(gadPanel2),QUERY_NSVIEW_CLIENT))
			
			DebugLog "Relative to Panel 2 x: " + tmpX + " y: " + tmpY
			
			?
		
	EndSelect
	
Forever</textarea><br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">#include &lt;AppKit/AppKit.h&gt;

#import &lt;brl.mod/system.mod/system.h&gt;

// absoluteFrom
// should convert panel coordinates into top left screen coordinates

void absoluteFrom( int *x,int *y,NSView *panel ){

	NSPoint returnPoint = [[panel window] convertBaseToScreen:[panel convertPoint:NSMakePoint(*x,*y) toView:nil]];
	
	*x=returnPoint.x;
	*y=returnPoint.y;
	
	*y=[[NSScreen deepestScreen] frame].size.height - *y;
	
}

// relativeTo
// should convert top-left screen-coordinates into coords relative to panel 

void relativeTo( int *x,int *y,NSView *panel ){

	int cx = 0;
	int cy = 0;
	
	absoluteFrom( &amp;cx, &amp;cy, panel);
	
	*x = *x - cx;
	*y = *y - cy;
	
}</textarea><br><br>I've removed the previous versions to avoid confusion for any people wanting to use this code.<br><br>Thanks Craig &amp; Skid for all your help,<br><br><br>Seb <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
