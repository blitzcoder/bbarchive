<!DOCTYPE html><html lang="en" ><head ><title >SetChannelPan with DirectSound screwy</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >SetChannelPan with DirectSound screwy</h1><a href="forums.php" >Archives Forums</a>/<a href="topics.php?forum=105" >BlitzMax Bug Reports</a>/<a href="#bottom" >SetChannelPan with DirectSound screwy</a><br><br>
<a name="902248"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tachyon</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> From the examples, with tiny modification....<br><br><pre class=code>
Graphics 640, 480

SetAudioDriver("DirectSound")

channel = AllocChannel ()
sound = LoadSound ("C:\Program Files\BlitzMax\samples\digesteroids\sounds\fire.wav") ' Use a short sample...

Repeat
	If MouseHit(1) PlaySound sound,channel
	
	pan# = MouseX () / (GraphicsWidth () / 2.0) - 1
	vol# = 1 - MouseY () / 480.0
	SetChannelPan channel, pan
	SetChannelVolume channel, vol*2

	Cls
	DrawText "Click to play...", 240, 200
	DrawText "Pan   : " + pan, 240, 220
	DrawText "Volume: " + vol, 240, 240

	Flip
Until KeyHit (KEY_ESCAPE)

End
</pre><br><br>On my machine, any pan above 0.1 or below -0.1 moves the sound *all the way* to the appropriate speaker, not just a 90%/10% balance like it should.<br><br>To hear it correctly, comment out the SetAudioDriver command and use the default driver. It works fine.<br><br>[edit] I am on Vista with a Sound Blaster X-Fi card. All drivers up-to-date. <br><br></td></tr></table><br>
<a name="942845"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tachyon</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry to bump this, but I am having some really bad sound artifacts due to this panning issue. I have updated the example above as I left off the Graphics command, causing an error.<br><br>Note, this has only been observed on Vista. It may work fine on XP for all I know. Although the Default sound driver works, it also produces a horrible delay under Vista which is why I need DirectSound to function properly. <br><br></td></tr></table><br>
<a name="942900"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>Can you confirm DirectSound panning/delay are OK with other apps on your setup? Does the OpenAL driver work? Anyone else?<br><br>MS have royally stuffed up audio in Vista - DirectSound is now apparently emulated, but no one really knows with what. Yet it is the only way you can seem get delay free audio now.<br><br>There are certainly no calls I can make into DirectSound to control 'granularity' of panning or amount of delay or anything...wrong type of device is a possibility I guess, but we did mess with this pretty comprehensively. <br><br></td></tr></table><br>
<a name="942998"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tachyon</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Actually, OpenAL doesn't seem to be panning at all. Can anyone else with Vista/OpenAL confirm this as I want to eliminate my PC as the culprit.<br><br>I assume other DirectSound apps work under Vista- I've never known any game to exhibit odd/extreme panning issues. <br><br></td></tr></table><br>
<a name="943002"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >plash</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> DirectSound and FreeAudio seem to pan as intended (is the pan supposed to be backwards though?)<br><br>OpenAL is not panning for me either.<br>XP2 SP3 <br><br></td></tr></table><br>
<a name="943012"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >REDi</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> AFAIK OpenAL will not do positioning with stereo sounds, should work okay with mono though.<br><br>Not much BRL can do about that one I'm afraid. <br><br></td></tr></table><br>
<a name="943085"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SLotman</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I confirm that on Vista the panning does not sound right... It "sounds" like the values are only -1,0 or 1.<br><br>I took a quick look at the code and it looks right... maybe the problem lies on Vista emulation of directsound? <br><br></td></tr></table><br>
<a name="943097"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>Ok, had a closer listen to this, and think I know what's up.<br><br>Volume in DirectSound is done is a slightly weird way - it's logarithmic, not linear so there's a little tweak done to the value you send SetVolume before it gets passed on to DirectSound.<br><br>I now suspect SetPan needs a similar tweak (actually kind of logical really). Anyway, it should be fixable so please stay 'tuned'! <br><br></td></tr></table><br>
<a name="943098"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok,<br><br>Can someone try sticking this before the SetPan...<br><br>	pan=Sgn(pan) * (1-(1-Abs(pan))^.1)<br><br>...does it sound right?<br><br>Bye!<br>Mark <br><br></td></tr></table><br>
<a name="943103"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >plash</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Volume changes all over the place, but it seems like the panning is right.<br><br>Kind of a bad example of the issue, with all the volume changing.. <br><br></td></tr></table><br>
<a name="943104"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tachyon</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Mark: Yes! I think that is it. MUCH smoother transitioning between left/right panning.<br><br>So, is this something you'll fix under the hood, or do I need to implement your mathematical wizardry to my panning functions whenever I use DirectSound the driver? <br><br></td></tr></table><br>
<a name="943106"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>I'll fix it under the hood for next release. <br><br></td></tr></table><br>
<a name="943184"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SLotman</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here, it does sound better, but now, when clicking all the way to the left, it sounds way lower then clicking all the way to the right... before the all-left or all-right sound had the same volume...<br><br>Was there any change in the volume function as well? <br><br></td></tr></table><br>
<a name="943187"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SLotman</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmmm... I think I found a better fix!<br><br>Keep setpan as it is, but change on the last line from:<br><br>_buf._buffer.SetPan pan * 10000 <br><br>to<br><br>_buf._buffer.SetPan pan * 1000<br><br>Yes, just take one zero out, and it should work ;) <br><br></td></tr></table><br>
<a name="943216"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Why is this better?<br><br>Pan values are supposed to go from -10000 to 10000, so it's no longer using the whole range... <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
