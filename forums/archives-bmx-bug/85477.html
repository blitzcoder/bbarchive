<!DOCTYPE html><html lang="en" ><head ><title >Reflections possible memory leak</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Reflections possible memory leak</h1><a href="forums.php" >Archives Forums</a>/<a href="topics.php?forum=105" >BlitzMax Bug Reports</a>/<a href="#bottom" >Reflections possible memory leak</a><br><br>
<a name="967142"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kernle 32DLL</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm not 100% sure, but is there any reason the method <i>TTypeId.ForObject(Null)</i> should increase the memory used (GCMemAlloced()) by around 30000 Bytes? No? Tought so.<br><br>It gets even stranger by the fact, that this memory increase is only done once, so it does only happen once during runtime.<br><br>Finally, some code (Note that you can simply use TTypeId.ForObject(Null), too, it doesnt matter)<br><br><pre class=code>Type TBlubb
   Field Gaga:Byte
End Type

Local Blubb:TBlubb = New TBlubb

GCCollect()
Print GCMemAlloced()

TTypeId.ForObject(Blubb)

GCCollect()
Print GCMemAlloced()</pre><br><br>So long,<br>Kernle <br><br></td></tr></table><br>
<a name="967152"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Htbaa</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I haven't looked into the source of the reflection module but perhaps it's possible that some static field is being filled with data that increases the memory usage, which doesn't get freed afterwards. Which is understandable if it's a static field (Global). <br><br></td></tr></table><br>
<a name="967154"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Finally, some code <br></div><br>This is not a good example.<br><br>For a proper test you need have it run over a period of time, to allow the memory allocator to balance out.<br><br>You will tend to see the memory increase for a while before it levels off. (If it always increased, no matter what, then yes, I would have to agree that there was a leak).<br><br><pre class=code>
SuperStrict

Type TBlubb
   Field Gaga:Byte
End Type

Const total:Int = 10000
Local count:Int = 0

For Local i:Int = 0 Until 1000000
	Local Blubb:TBlubb = New TBlubb

	TTypeId.ForObject(Blubb)

	count:+ 1
	
	If count = total Then
		count = 0
		
		Print GCMemAlloced()
	End If

	GCCollect()

Next

GCCollect()
Print GCMemAlloced()
</pre> <br><br></td></tr></table><br>
<a name="967229"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tommo</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Type reflection infomation is generated by demand, it will be kept after that. <br><br></td></tr></table><br>
<a name="967311"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kernle 32DLL</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> What kind of reflection data is that supposed to be? And why does it need to be kept in memory? <br><br></td></tr></table><br>
<a name="967313"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >plash</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> And why does it need to be kept in memory? <br></div>So it's faster when you use reflection for stuff later. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
