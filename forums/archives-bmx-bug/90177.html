<!DOCTYPE html><html lang="en" ><head ><title >Joypad functions not working on OS X without...</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Joypad functions not working on OS X without...</h1><a href="forums.php" >Archives Forums</a>/<a href="topics.php?forum=105" >BlitzMax Bug Reports</a>/<a href="#bottom" >Joypad functions not working on OS X without...</a><br><br>
<a name="1024933"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Oddball</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> ...calling <i>JoyCount()</i> first.<br><br>Non of the Joypad functions work at all on Mac OS X without first calling <i>JoyCount()</i>. I have tested this on OS X 10.6.3 with an x360 controller and using BlitzMax v1.39.<br><br><b>Test code:</b><pre class=code>SuperStrict

Graphics 400,300

'JoyCount()
'Uncomment the above line and everything works as normal
'Tested on Mac OS X 10.6.3 with Xbox360 controller and using BlitzMax v1.39

Repeat
	
	Cls
	If JoyDown(0) Then DrawText "Joypad detected",5,5
	Flip
	
Until KeyHit(KEY_ESCAPE) Or AppTerminate()</pre> <br><br></td></tr></table><br>
<a name="1024945"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jkrankie</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Have you installed the mac xbox360 driver? OS X doesn't pick it up by default, likewise with many other console peripherals.<br><br><a href="http://tattiebogle.net/index.php/ProjectRoot/Xbox360Controller/OsxDriver" target="_blank">http://tattiebogle.net/index.php/ProjectRoot/Xbox360Controller/OsxDriver</a><br><br>Cheers<br>Charlie <br><br></td></tr></table><br>
<a name="1024947"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Oddball</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yep, that's the driver I'm using. I'm guessing that you're not experiencing the same thing then? <br><br></td></tr></table><br>
<a name="1024949"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jkrankie</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ah, i didn't read your problem properly. FWIW, i've always found that you need to call Joycount() first, it certainly always has been on OS X as far back a i can remember. Do you not need it on windows?<br><br>Cheers<br>Charlie <br><br></td></tr></table><br>
<a name="1024951"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Oddball</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've never had to call <i>JoyCount()</i> on Windows in the past, but I can't test this on Windows at the moment. I'm pretty sure though that the intended behaviour is to be able to use the other joypad functions without calling <i>JoyCount()</i> first. <br><br></td></tr></table><br>
<a name="1024954"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jkrankie</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well i guess that does makes sense, but presumably when it comes to a game that uses joysticks you'd want to know how many are connected to the system anyway?<br><br>Cheers<br>Charlie <br><br></td></tr></table><br>
<a name="1024956"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Oddball</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't usually iterate controllers unless I'm doing local multiplayer. I just use the controller at port 0 for solo player games, that's how I discovered this quirk. <br><br></td></tr></table><br>
<a name="1024957"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's not surprising really :<br><pre class=code>
int JoyCount()
{
	if (!macjoycount) InitMacJoy();
	return macjoycount;
}
</pre><br>The same applies for the Linux code...  JoyCount() happens to initialise the drivers. You don't need this on Windows because it doesn't require initialisation. <br><br></td></tr></table><br>
<a name="1024963"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Oddball</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I spotted that too Brucey. I've altered the freejoy.macosx.c function ReadJoy to include the line:<pre class=code>	if (!macjoycount) InitMacJoy();</pre>I'm not entirely sure whether that is an appropriate solution. here's the altered function in full.<br><br><b>freejoy.macosx.c - line 340</b><pre class=code>int ReadJoy(int port,int *buttons,float *axis)
{
	if (!macjoycount) InitMacJoy();
	if (port&gt;=0 &amp;&amp; port&lt;macjoycount) readmacjoy(joylist[port],buttons,axis);
	return 0;
}</pre>Does anyone know if this is a sensible solution? <br><br></td></tr></table><br>
<a name="1027020"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>Adding a JoyCount() call somewhere at the top of the .bmx file seems to work OK.<br><br>Any objections...? <br><br></td></tr></table><br>
<a name="1027033"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Oddball</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> No objections really, apart from it not being mentioned anywhere so will likely trip others up too. Is there an issue with checking if the joy functions have been initialised each time ReadJoy is called? It seems to work fine for me, although I haven't tested it a lot, and would make the functions consistent across all OSs. Anyway, just curious as it's not a hardship to add JoyCount at the top of my code. <br><br></td></tr></table><br>
<a name="1027035"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Maybe the joy?dir commands should be removed also, they look kind of undocumented and broken. <br><br></td></tr></table><br>
<a name="1027110"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  Anyway, just curious as it's not a hardship to add JoyCount at the top of my code.  <br></div><br>I think he meant by adding it to the top of the "module" code (which will be run at module initialisation time).<br>Which precludes you from having to change your own code. <br><br></td></tr></table><br>
<a name="1027143"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >plash</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I think he meant by adding it to the top of the "module" code (which will be run at module initialisation time). <br></div>Either adding the JoyCount call, or making a proper function to initialize it (and even then, still calling it). <br><br></td></tr></table><br>
<a name="1027152"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Oddball</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="/Account/showuser.php?id=8077" target="_blank">Brucey</a> wrote:<div class="quote"> I think he meant by adding it to the top of the "module" code (which will be run at module initialisation time).<br>Which precludes you from having to change your own code. <br></div>D'oh! Rereading it again I can see that is exactly what Mark meant. I keep forgetting that module code is executed when imported. Ignore my comments then, as that is a much more sensible solution. Thanks. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
