<!DOCTYPE html><html lang="en" ><head ><title >problem with release command</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >problem with release command</h1><a href="forums.php" >Archives Forums</a>/<a href="topics.php?forum=105" >BlitzMax Bug Reports</a>/<a href="#bottom" >problem with release command</a><br><br>
<a name="1215090"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >yossi</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> when I run the release example:<br><br>Rem<br>Release removes the internal reference caused by creating an integer handle to a type.<br>End Rem<br><br>Type MyType<br>	Field bigmap[1024*1024]<br>End Type<br><br>GCCollect<br>Print GCMemAlloced()<br><br>a=New MyType<br>GCCollect<br>Print GCMemAlloced()<br><br>Release a<br>GCCollect<br>Print GCMemAlloced()<br><br>I get the next output:<br><br>Building .release<br>Compiling:.release.bmx<br>flat assembler  version 1.69.14  (1048575 kilobytes memory)<br>3 passes, 4366 bytes.<br>Linking:.release.debug.exe<br>Executing:.release.debug.exe<br>15204<br>4209544<br>4209544<br><br>Process complete<br><br>from this output it seems that 'release a' doesn't remove the reference of a to the allocated memory for MyType and therefore<br>the last GCCollect doesn't release the memory that was allocated for MyType memory and which was supposed to be free by release a command.<br><br>my OS is windows 8.1. <br><br></td></tr></table><br>
<a name="1215100"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> There's nothing wrong with it, it's just a really badly-written example.<br><br>The problem is that GCCollect doesn't free up the allocated memory in time for the next Print command.  Try the code below - you'll see that after a couple of seconds, memory usage returns to normal.<br><pre class=code>Rem
Release removes the internal reference caused by creating an integer handle to a type.
End Rem

Type MyType
  Field bigmap[1024*1024]
End Type

Graphics 640,480 'need this so we can hit Esc to quit the while/wend loop - makes no difference to the example

GCCollect
Print GCMemAlloced()

a=New MyType
GCCollect
Print GCMemAlloced()

Release a
GCCollect
While Not KeyHit(key_escape)
  Print GCMemAlloced()
Delay 1
Wend
</pre> <br><br></td></tr></table><br>
<a name="1215122"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >yossi</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I am very confused because in the next example the garbage collector free the memory  immediately and doesn't need some seconds or even less to free the memory (it works like it should):<br><br>Type MyType<br>	Field bigmap[1024*1024]<br>End Type<br><br>GCCollect<br>Print GCMemAlloced()<br><br>a:mytype=New MyType<br>GCCollect<br>Print GCMemAlloced()<br><br>a=Null<br>GCCollect<br>Print GCMemAlloced()<br><br>and now the output is correct:<br><br>Building .release<br>Compiling:.release.bmx<br>flat assembler  version 1.69.14  (1048575 kilobytes memory)<br>3 passes, 4309 bytes.<br>Linking:.release.debug.exe<br>Executing:.release.debug.exe<br>15204<br>4209544<br>15204<br><br>Process complete<br><br>it seems that when we put the address of the allocated memory into a variable of the same type (not integer) and free the reference to it by putting a null into it later it works fine but work less well  when we use integer to hold the address and later using release on the integer variable.<br><br>sorry but I steal think there is a problem here because I would expect the 2 methods to work the same. <br><br></td></tr></table><br>
<a name="1215124"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> They do both work the same on my PC - I tested both.  Memory isn't released for at least a couple of seconds. <br><br></td></tr></table><br>
<a name="1215125"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >yossi</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> in my computer on the first method it took the gc some seconds to release the memory but on the second method the gc release the memory <br>immediately .<br><br>why the difference ? <br><br></td></tr></table><br>
<a name="1215126"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Your second bit of code is not the same.<br><br>In your first code:<pre class=code>a=New MyType</pre><br>In your second code:<pre class=code>a:MyType=New MyType</pre><br><br>The first does not work immediately with GC, the second one does. <br><br></td></tr></table><br>
<a name="1215129"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >yossi</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> so can I assume that the second method  of a:MyType=New MyType and a=null is better then the method of a=New Type and release a ? <br><br></td></tr></table><br>
<a name="1215131"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Floyd</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Using integer variables for objects is allowed in order to ease the transition for programmers who already know an earlier Blitz language. But it is a bad practice and you should not do it.<br><br>You should always make variables the appropriate type and forget that you ever saw the Release command. <br><br></td></tr></table><br>
<a name="1215133"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >yossi</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> thank you Floyd.<br>now it is clear. <br><br></td></tr></table><br>
<a name="1215134"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just to add, it's good practice to use "Strict" (or "SuperStrict") at the top of your code.  These two commands force you, to varying levels, to declare variables before you use them.  Pretty sure none of this code would even compile in Strict mode. <br><br></td></tr></table><br>
<a name="1215140"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Use SuperStrict at the top of your code.<br>It *forces* you to define the types of everything - which is not a bad thing. <br><br></td></tr></table><br>
<a name="1215824"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Please don't use 'Release'!<br><br>As Floyd says, it was to make life easier for people coming from Blitz3D etc, but it is slow and makes for ugly code! <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
