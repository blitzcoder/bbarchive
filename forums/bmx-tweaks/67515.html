<!DOCTYPE html><html lang="en" ><head ><title >New audio stuff ][</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >New audio stuff ][</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=110" >BlitzMax Module Tweaks</a>/<a href="#bottom" >New audio stuff ][</a><br><br>
<a name="754145"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>Ok, more new audio stuff now available via syncmods.<br><br>The default audio device is now back to "FreeAudio Default" as it used to be - you'll need to SetAudioDriver() to use anything else.<br><br>Also, since some people seem to be experiencing crashes inside OpenAL, I've added EnableOpenALAudio() which will 'turn on' OpenAL audio. Use this before calling  AudioDrivers() or SetDriver().<br><br>Could those who were experience crashes in openalaudio.bmx please try a quick "Print EnableOpenALAudio()" and let me know if it crashes? <br><br></td></tr></table><br>
<a name="754155"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >REDi</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> All drivers working well here! Thanks!<br><br>Top notch! <br><br></td></tr></table><br>
<a name="754175"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >The r0nin</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks, Mark!  That's fixed my crashing bug... <br><br></td></tr></table><br>
<a name="754187"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tachyon</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just sync'd again and it downloaded a bunch of new audio updates...and now my game just plain crashes with "Unhandled Memory Exception Error". I have no other information to give you because it doesn't tell me anymore than that. I am not setting an audio driver so it should be using the default driver.<br><br>...um, it looks like the debugger is highlighting a "flip" command, as if it is crashing there. ?? <br><br></td></tr></table><br>
<a name="754208"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>Can you try adding a SetAudioDriver "Null" at the top of your program? <br><br></td></tr></table><br>
<a name="754219"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grisu</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Crash bug fixed here:<br><div class="quote"> FreeAudio DirectSound<br>FreeAudio Default<br>Null <br></div><br><br>Mark, can you lock the old topic please. <br><br></td></tr></table><br>
<a name="754224"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Difference</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> My wierd "Full black screen - can't escape" problem has gone away with this syncmods, and now I can run <pre class=code>For Local t$=EachIn AudioDrivers()
   Print  t
Next</pre> It returns:<br>FreeAudio DirectSound<br>FreeAudio Default<br>Null <br><br></td></tr></table><br>
<a name="754260"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tachyon</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Mark: Your suggestion to add <b>SetAudioDriver "null"</b> seems to have fixed it. I'll continue testing.<br><br>Thank you! <br><br></td></tr></table><br>
<a name="754263"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TheSin</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is this for non Mac version only? Because syncmods doesn't load anything new here...<br><br>Edit: nevermind, I just read the old audio thread, seems like it's still Windows only. <br><br></td></tr></table><br>
<a name="754269"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matthew Smith</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Mark,<br><br>Tested under Vista:<br><br>FreeAudio DirectSound  - Great sound, no Delay<br>FreeAudio Default      - Great sound, but Delay (as you pointed out)<br><br>It cetainly sounds a great deal better!! Soundcard is a SoundMax Integrated Digital Audio.<br><br>I haven't tested the OpenAL stuff. <br><br></td></tr></table><br>
<a name="754276"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Barbapapa</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Already mentioned in the old thread, should belong here, since the new sync this morning solved the lua problem. <br><br></td></tr></table><br>
<a name="754278"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >popcade</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> DSound Driver still cracks... but the default one works great. <br><br></td></tr></table><br>
<a name="754311"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> So when can we look forward to this OpenAL support etc going cross-platform to the Mac and Linux?<br><br>And does this include any ability to do streaming audio? <br><br></td></tr></table><br>
<a name="754333"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> DSound Driver still cracks... <br></div>FreeAudio Directsound still crackly here, too.  I'm not sure that's supposed to have been fixed yet, though...?<br><br><div class="quote"> Originally posted in the first thread by Skidracer...<br><br>Can you try changing the #define DSOUNDFRAG 2048 in freeaudio.mod/dsounddevice.cpp to 4096 and building modules? <br></div>Oops sorry, totally forgot to do that until just now!<br><br>I changed it to 4096 and it still crackles but to a lesser extent.  I continued increasing it until the problem went away completely (which was at 16384), but then I get a 0.5s lag when playing sounds. <br><br></td></tr></table><br>
<a name="754365"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tachyon</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Mark: In reference to my two posts above...after using <b>SetAudioDriver "null"</b> my odd crash seemed to be fixed for a while. But now I am getting no sound at all.<br><br>Just rebooted...still no sound.<br><br>Removed <b>SetAudioDriver "null"</b> ... got sound but game crashes.<br><br>Add it back in... no sound again. ?<br><br>I will keep playing around and see if I can pinpoint the problem. :( <br><br></td></tr></table><br>
<a name="754371"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >popcade</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> The higher buffer value makes less crackle, I hope BRL can get a more efficient/common value or another solution tho... :| <br><br></td></tr></table><br>
<a name="754375"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tachyon</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok...<i>this</i> is what is killing my game. For the past 18 months I've had a few functions that would perform a task and play a sound. I've kept all the variables (including the sound sample and the channel) local to these functions and it seemed to work just fine. If the sound duration was long enough, it continued to play even after the system left the function.<br><br>For example, this code crashes on my system but it <i>used to</i> work just fine:<br><br><pre class=code>
SuperStrict
Graphics 640,480

While Not KeyHit( KEY_ESCAPE)
    Play_Local_Sound()
    Delay 100
    Flip
Wend

Function Play_Local_Sound()
    Local Sound:TSound = LoadSound("C:/Program Files/BlitzMax/samples/digesteroids/sounds/teleport.wav")
    Local Channel:TChannel = PlaySound(Sound)
End Function
</pre><br><br>But now, with the new default driver, this trick doesn't work anymore. To make it work I have to make the sample and channel Global:<br><pre class=code>
SuperStrict
Graphics 640,480

Global Sound:TSound = LoadSound("C:/Program Files/BlitzMax/samples/digesteroids/sounds/teleport.wav")
Global Channel:TChannel

While Not KeyHit( KEY_ESCAPE)
    Play_Global_Sound()
    Delay 100
    Flip
Wend

Function Play_Global_Sound()
    Channel = PlaySound(Sound)
End Function
</pre> <br><br></td></tr></table><br>
<a name="754380"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> The higher buffer value makes less crackle, I hope BRL can get a more efficient/common value or another solution tho... :| <br></div>Trouble is, when you increase the buffer size, as the crackle decreases the lag <i>increases</i>.  I'm guessing the solution lies elsewhere. <br><br></td></tr></table><br>
<a name="754382"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bradford6</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Overall, I think the move to OpenAL is going to be awesome. I have been reading some of the documentation and it's integration with OpenGL should make positional 3D sound in miniB3D a snap! not to mention the impressive list of games/apps that use it. <a href="http://www.openal.org/titles.html" target="_blank">http://www.openal.org/titles.html</a><br><br>(well maybe not a snap for you Mark, we DO see how much wrangling you have been going through to get this to work)<br><br><br>anyway, here is another version of the program from yesterday. I have incorporated some of the things you mentioned (setdriver to "null" at program start and check to see if OPENAL fails to load)<br><br>I ran this before and after installing OpenAL on 2 systems and it seems to be accurate.<br><br>Also, if you hit 'D' it *should* open up your browser to download OpenAL if you need it. (I download and install the "OpenAL SDK 1.1 for Windows" for my 3 PC's and it works fine on all 3. One is an old laptop)<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Strict
SetAudioDriver("Null")
Local URL:String="http::www.bmaxbook.com/guitar.ogg"
' Local URL:String="guitar.ogg" ' if you want to download the file for local use
Global SoundBank:TBank=LoadBank(URL)


Local devs$[]=AudioDrivers(),i=-1,channel:TChannel,okay$, OALmsg$=  "OpenAL Disabled"


Graphics 640,480

While Not KeyHit( KEY_ESCAPE )
	
	If KeyHit (KEY_A) And OALmsg$ =  "OpenAL Disabled"

			Local result:Int = EnableOpenALAudio()
			If result = 1
				OALmsg$ = "OpenAL Enabled"
				devs = Null
				devs=AudioDrivers()
				i=-1
			Else
				OALmsg$ = "Failed to Enable OpenAL"

			EndIf
	EndIf
	If KeyHit (KEY_D)
		OpenURL("http://www.openal.org/downloads.html")
	
	
	EndIf
	If KeyHit( KEY_SPACE ) Or i&lt;0
		i:+1
		If i=devs.length i=0
		If channel StopChannel channel
		okay="False"
		channel=Null
		If SetAudioDriver( devs[i] )
			channel=AllocChannel()
			Local sound:TSound = LoadSound(SoundBank)
			PlaySound sound,channel
			okay="True"
		EndIf
	EndIf

	Cls
	SetColor 255,255,0
	DrawText "hit space to switch driver. Hit A to enable OpenAL Audio",20,20
	
	SetColor 0,0,255
	DrawText "Current Driver: "+devs[i]+" (Okay="+okay+")"+" ",20,40
	SetColor 230,0,0
	DrawText OALmsg$,20,60
	DrawText "note: if you do not have OpenAL. hit D to go to Download page",20,420
	Flip

Wend
</textarea><br><br>p.s I REALLY need to change that OGG file. Will upload a new sound when i get home tonight...<br>EDIT: Changed the sound file. <br><br></td></tr></table><br>
<a name="754405"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Tachyon, I was just considering a solution to this problem this morning, hopefully a fix will be available soon, as my game also has been doing some pretty interesting things with looping sounds when the samples themselves have gone out of scope. <br><br></td></tr></table><br>
<a name="754406"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >popcade</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think it's a transition time like the new DX7 renderer introduced... will get sorted eventually.<br><br>However I still hope BRL integrate streaming in... <br><br></td></tr></table><br>
<a name="754410"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tachyon</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> Skid: thanks for the quick response. I'll come up with a few workarounds for now, but a fix would be really wonderful! :) <br><br></td></tr></table><br>
<a name="754444"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>Mark: In reference to my two posts above...after using SetAudioDriver "null" my odd crash seemed to be fixed for a while. But now I am getting no sound at all.<br> <br></div><br>Yep, I was just trying to narrow down the problem.<br><br><div class="quote"> <br>doing some pretty interesting things with looping sounds when the samples themselves have gone out of scope. <br> <br></div><br>Well, openalaudio works - but only because it isn't freeing sounds at all! I've added that now and it should handle this 'deleting a currently playing sound' situation.<br><br>This'll be trickier in freeaudio though - perhaps add a refcount to fasound, bumped when it's played through a channel?<br><br>Also, can anyone who used to get a crash in openalaudio.bmx please confirm that it still crashes when EnableOpenALAudio() is executed? <br><br></td></tr></table><br>
<a name="754514"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Vertex</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is there no way, do bind OpenAL directly with BMax Executables? OpenAL is open source, so i think so(or is it nt allowed by the OpenAL License?)<br><br>And, Ogg/Vorbis can be streamed by using alSourceQueueBuffers. I don't know, if FreeAudio have a mechanism for it, but there are long long loading times for static sounds.<br><br>I'am a german but I don't realize, why you use the name TAudioSample. In my opinion is a sample one value and only a part of a tone, noise or sound.<br><br>cu olli <br><br></td></tr></table><br>
<a name="754516"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Is there no way, do bind OpenAL directly with BMax Executables? <br></div><br>It's LGPL, which means that you can link to shared objects (like .dll / .so / .dylib) but if you wanted to statically link (that is, build their library code into your app) you would have to make the source to your code available either with the app or online somewhere (with directions on how to obtain it with your distribution).<br><br>So unless you want to only make open-source software yourself, it's better to link to the DLLs. <br><br></td></tr></table><br>
<a name="754530"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> To keep to the LGPL, after building your release executable copy the contents of the blitzmax/tmp/ld.tmp file and all the .a files it references into a zip and include it in your distribution. <br><br></td></tr></table><br>
<a name="754578"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >The Caffeine Kid</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> After the syncmods my game is now throwing exceptions at seemingly random intervals while playing samples from inside  my object methods, having a local ch:tchannel variable showing up as null in debug. <br><br></td></tr></table><br>
<a name="754599"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Chris C</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> the whole point of LGPL is it doesn't "infect" other products that happen to use the library<br><br><div class="quote"> 5. A program that contains no derivative of any portion of the Library, but is designed to work with the Library by being compiled or linked with it, is called a "work that uses the Library". Such a work, in isolation, is not a derivative work of the Library, and therefore falls outside the scope of this License.<br> <br></div><br><br>As I see it the binding of the library must be LGPL and BLR must make the code *publicly* available.<br><br>However whether static or dynamically linked it makes no difference. Your code that uses a LGPL library CAN remain closed source <br><br>This is the whole point of LGPL! <br><br></td></tr></table><br>
<a name="754604"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >popcade</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> Rip OpenAL out and improve freeaudio is the solution.<br><br>Streaming Please ... :| <br><br></td></tr></table><br>
<a name="754623"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> So we can still distribute OpenAL with the application/game, so that the user doesn't have to go hunting down an OpanAL driver? <br><br></td></tr></table><br>
<a name="754627"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BlitzSupport</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> All working here, though I notice that OpenAL is very slightly duller/quieter sounding than FreeAudio will bradford6's test. <br><br></td></tr></table><br>
<a name="754657"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bradford6</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#32">[#32]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think you can:<br>Run the Creative OpenAL Installer in silent mode (with the /s option) along with your installer.<br><br>BlitzMax will look for the OpenAL DLL's (in the case of windows...not sure for Linux/Mac)<br><br><br>Anyway. I am liking this OpenAL stuff and I think it will fit nicely witht he other OSS/FOSS libraries that BLitz uses.<br><br>remember that you are free to use the FMOD library that is being developed by some users and the FreeAudio module.  OpenAL will add free/ cross platform audio support to Blitzmax. <br><br></td></tr></table><br>
<a name="754675"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#33">[#33]</a></td></tr></table></td></tr><tr ><td class="posttext"> Jeeze, sorry everyone for the problems with freeaudio. I think I've sorted the main problem, freeaudio is now back to maintaining it's own copy of the sound sample like it use to (which it has it's own reference counting scheme in place) unless the sound is played using a loop count of exactly $80000000 which signifies the sample is a live stream and the blitzmax programmer needs to keep a reference of the sound object alive while it's channel is playing.<br><br>Tachyon, can you try testing with the following fix to pub.freeaudio/freeaudioglue.cpp[124]<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
int BBCALL fa_CreateSound( int length,int bits,int channels,int freq,const char *samples,int loop ){
	sample		*sam;
  
	if (io==0) return 0;
	sam=new sample();
	if (loop==0x80000000){	//dynamic sounds stay in app memory
		sam-&gt;init(length,freq,channels,bits,(void*)samples);
	}else{
		sam-&gt;init(length,freq,channels,bits,0);
		if( samples ) sam-&gt;write((void*)samples,length,0);
	}
	sam-&gt;setloop(loop);
	return (int)sam;
}
</textarea> <br><br></td></tr></table><br>
<a name="754696"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#34">[#34]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>Is there no way, do bind OpenAL directly with BMax Executables? <br> <br></div><br>Not if it's closed source. The LGPL license means that..."it must be possible for the software to be linked with a newer version of the LGPL-covered program". <br><br>In other words, the end user must be able to change the version of OpenAL32.dll used by your app. Statically linking makes this hard/messy, as you'd have to provide the source code to the OpenAL32 module you linked with (so they could 'create a newer version') and a mechanism to rebuild the entire app.<br><br><div class="quote"> <br>As I see it the binding of the library must be LGPL and BLR must make the code *publicly* available.<br> <br></div><br>I don't belive this necessary - although I'm quite happy to make the source to openal.mod public if necessary.<br><br>Since openal uses LoadLibrary/GetProcAddress, the requirement to allow users to upgrade the library is already fulfilled and I don't think we have to do any thing else.<br><br>Actually, this LGPL thing is starting to make sense to me now: They key idea is that it must always be possible to modify the LGPL components of a non-LGPL app. DLL's are just the easiest way to do this for the non-LGPL app author.<br><br><div class="quote"> <br>So we can still distribute OpenAL with the application/game, so that the user doesn't have to go hunting down an OpanAL driver?<br> <br></div><br>The good news on the Mac is that a very up-to-date version of OpenAL comes pre-installed on 10.4!<br><br>There's a separate installer for 10.3, but it's kind of old (2004) and is actually missing quite a few functions (although it still works) so be careful if you're using 'raw' openal on the mac - if you hit a missing function you'll get a 'null function pointer' error. You can test if a function is valid using something like: If alcGetString Print "alcGetString OK!"<br><br>You'll need to ship this installer (or build a 'newer' version from the source) with 10.3 apps that depend on OpenAL. But unless you're using special features of OpenAL, I'd recommend sticking with freeaudio anyway as it works fine on non-windows platforms.<br><br>Linux is another story. I couldn't get OpenAL working at all until I recompiled the whole thing (and on Ubuntu, you have to enable the 'universe' repositories to even find the  packages). Even then, there was a nasty Vista-ish lag in audio. FreeAudio rocks on Linux...<br><br><div class="quote"> <br>Rip OpenAL out and improve freeaudio is the solution.<br> <br></div><br>OpenAL looks like it may be the only sane way to get HW accelerated audio on Vista (esp. 3D), so it's not going anywhere.<br><br>The overall impression I am getting with Vista audio is that Vista really, really doesn't like you doing your own mixing ('port audio' has similar problems...) - which is what freeaudio does. If this is true, then there is a real limit to how much we can 'improve' freeaudio.<br><br>Games with audio that works fine under Vista do so (still guessing here though...) because they DO NOT do their own mixing. We avoided this route with freeaudio to keep the audiodriver as widely compatible as possible - which worked until Vista... <br><br></td></tr></table><br>
<a name="754712"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tachyon</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#35">[#35]</a></td></tr></table></td></tr><tr ><td class="posttext"> Skid: Yep, so far that seems to have fixed the problem! :) I'll keep testing and let you know if anything else pops up.<br><br>Thanks again for the quick fix! <br><br></td></tr></table><br>
<a name="754728"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#36">[#36]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry again for breaking it:) <br><br></td></tr></table><br>
<a name="754739"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#37">[#37]</a></td></tr></table></td></tr><tr ><td class="posttext"> GfK if you have some time could you please test with this new version of dsounddevice.cpp combined with the fix to freeaudioglue.cpp above:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
// dsounddevice.cpp

// changed to 4 x buffer spacing

#include "freeaudio.h"

#define WIN32_LEAN_AND_MEAN
#include &lt;windows.h&gt;
#include &lt;objbase.h&gt;
#include &lt;mmsystem.h&gt;
#include &lt;stdio.h&gt;
#include "dsound.h"

#define DSOUNDFRAG 2048

extern "C" audiodevice *OpenDirectSoundDevice();

struct dsounddevice:audiodevice{

	int	running,playing;	//threadsafe state machine

	int reset(){
		int res;
		
		running=1;
		playing=0;
		mix=new mixer(DSOUNDFRAG*6);
		mix-&gt;freq=44100;
		mix-&gt;channels=2;
		res=initdevice(DSOUNDFRAG);
		if (res) {
			running=0;
		}
		return res;
	}
	
	int close(){	
		int		timeout;
		if (running){
//stop
			running=0;
			timeout=20;	//100ms timeout
			while (timeout-- &amp;&amp; playing) {
				Sleep(5);
			}
			freedevice();
		}
		return 0;
	}

// private

	HINSTANCE dsoundlib;
	HRESULT WINAPI (*DirectSoundCreate)(LPGUID,LPDIRECTSOUND*,LPUNKNOWN);
	
	IDirectSound *directsound;
	IDirectSoundBuffer *primarybuffer;
	IDirectSoundBuffer *soundbuffer;
	IDirectSoundNotify *soundnotify;
	
	HANDLE soundevent;
	HANDLE soundthread;
	DWORD soundthreadid;

	int fragsize;	//in bytes
	int buffersize;	//4*fragsize

	int initdevice(int fragsamples){

		PCMWAVEFORMAT pcmwf; 
		DSBUFFERDESC dsbdesc; 
		DSCAPS dscaps;
		int res;
// init device
		directsound=0;
		primarybuffer=0;
		soundbuffer=0;
		soundnotify=0;		
		dsoundlib=LoadLibraryA("dsound");	
		DirectSoundCreate=(HRESULT WINAPI (*)(LPGUID,LPDIRECTSOUND*,LPUNKNOWN))GetProcAddress(dsoundlib,"DirectSoundCreate");
		res=DirectSoundCreate(0,&amp;directsound,0);
		if (res) return res;		
		res=directsound-&gt;SetCooperativeLevel(GetDesktopWindow(),DSSCL_PRIORITY);
		if (res) return res;	
//		printf("dsoundlib=%d soundcreate=%d res=%d\n",dsoundlib,(int)DirectSoundCreate,res);	
//		fflush(stdout);
		dscaps.dwSize=sizeof(DSCAPS);
		res=directsound-&gt;GetCaps(&amp;dscaps);	
		if (res) return res;	
// set primary buffer format
		memset(&amp;dsbdesc,0,sizeof(DSBUFFERDESC)); 	// Zero it out. 
		dsbdesc.dwSize=sizeof(DSBUFFERDESC); 
		dsbdesc.dwFlags=DSBCAPS_PRIMARYBUFFER;
		res=directsound-&gt;CreateSoundBuffer(&amp;dsbdesc,&amp;primarybuffer,0); 
		if (res) return res;
		memset(&amp;pcmwf, 0, sizeof(PCMWAVEFORMAT)); 
		pcmwf.wf.wFormatTag=WAVE_FORMAT_PCM; 
		pcmwf.wf.nChannels=2;
		pcmwf.wf.nSamplesPerSec=44100;
		pcmwf.wBitsPerSample=16; 
		pcmwf.wf.nBlockAlign=4;
		pcmwf.wf.nAvgBytesPerSec=pcmwf.wf.nSamplesPerSec * pcmwf.wf.nBlockAlign; 
		res=primarybuffer-&gt;SetFormat((LPWAVEFORMATEX)&amp;pcmwf);
		if (res) return res;
// fragment size
		fragsize=fragsamples*4; //stereo 16bit=4 bytes per sample
		buffersize=fragsize*4;	//quad buffered
// format
		memset(&amp;pcmwf, 0, sizeof(PCMWAVEFORMAT)); 
		pcmwf.wf.wFormatTag=WAVE_FORMAT_PCM; 
		pcmwf.wf.nChannels=2;
		pcmwf.wf.nSamplesPerSec=44100;
		pcmwf.wf.nBlockAlign=4;
		pcmwf.wf.nAvgBytesPerSec=pcmwf.wf.nSamplesPerSec * pcmwf.wf.nBlockAlign; 
		pcmwf.wBitsPerSample=16; 
// description	
		memset(&amp;dsbdesc,0,sizeof(DSBUFFERDESC)); 	// Zero it out. 
		dsbdesc.dwSize=sizeof(DSBUFFERDESC); 
		dsbdesc.dwBufferBytes=buffersize;			//1 * pcmwf.wf.nAvgBytesPerSec; 
		dsbdesc.lpwfxFormat=(LPWAVEFORMATEX)&amp;pcmwf; 
		dsbdesc.dwFlags=DSBCAPS_CTRLPOSITIONNOTIFY|DSBCAPS_GETCURRENTPOSITION2|DSBCAPS_GLOBALFOCUS;
// createbuffer
		res=directsound-&gt;CreateSoundBuffer(&amp;dsbdesc,&amp;soundbuffer,0); 
		if (res) return res;
// notifications
		soundevent=CreateEvent(0,0,0,"SOUNDEVENT");
		if (soundevent==0) return res;
		res=soundbuffer-&gt;QueryInterface(IID_IDirectSoundNotify,(void**)&amp;soundnotify); 
		if (res) return res;	
		DSBPOSITIONNOTIFY notif[4];
		int n; 
		for (n=0;n&lt;4;n++){
			notif[n].dwOffset=n*fragsize;
			notif[n].hEventNotify=soundevent;
		}
	 	res=soundnotify-&gt;SetNotificationPositions(4,notif);
		if (res) return res;
// thread
		soundthread=CreateThread(NULL,0,soundproc,this,REALTIME_PRIORITY_CLASS,&amp;soundthreadid);
		return 0;
	}
	
	void freedevice(){
		int res;
		if (primarybuffer){
			res=primarybuffer-&gt;Release();
			primarybuffer=0;
		}		
		if (soundbuffer){
			res=soundbuffer-&gt;Release();
			soundbuffer=0;
		}		
		if(directsound) {
			res=directsound-&gt;Release();
			directsound=0;
		}	
	}

//thread entry point

	DWORD run(){	
		DWORD read,write;
		int lastread,loopcount;
		void *mem1,*mem2;
		DWORD size1,size2;
		int readpos,writepos;
		int res;
		writepos=0;
		lastread=0;
		loopcount=0;
		res=soundbuffer-&gt;Lock(0,4*fragsize,&amp;mem1,&amp;size1,&amp;mem2,&amp;size2,0);
		if (res) return 0;
//		printf("mem1=%d size1=%d mem2=%d size2=%d total=%d\n",mem1,size1,mem2,size2,size1+size2);
//		fflush(stdout);
		if (size1) memset(mem1,0,size1);
		if (size2) memset(mem2,0,size2);
		res=soundbuffer-&gt;Unlock(mem1,size1,mem2,size2);
		if (res) return 0;
// playsound
		soundbuffer-&gt;Play(0,0,DSBPLAY_LOOPING);
		playing=1;
//		printf("running=%d\n",running);
//		fflush(stdout);
		while (running){
			res=soundbuffer-&gt;GetCurrentPosition(&amp;read,&amp;write);
			if (read&lt;lastread) loopcount++;
			lastread=read;
			readpos=loopcount*buffersize+read;
			int count=((readpos+fragsize*2-writepos)/fragsize);
//			printf("read=%d write=%d  %d,%d  count=%d\n",read,write,readpos,writepos,count);
//			fflush(stdout);
			if (count&gt;0){		
				if (count&gt;2) count=2;	//avoid overrun
				res=soundbuffer-&gt;Lock(writepos%buffersize,count*fragsize,&amp;mem1,&amp;size1,&amp;mem2,&amp;size2,0);
				if (res) break;
//				printf("mem1=%d size1=%d mem2=%d size2=%d total=%d\n",mem1,size1,mem2,size2,size1+size2);
//				fflush(stdout);
				if (size1) mix-&gt;mix16((short*)mem1,size1/2);
				if (size2) mix-&gt;mix16((short*)mem2,size2/2);
				res=soundbuffer-&gt;Unlock(mem1,size1,mem2,size2);
				if (res) break;
				writepos+=size1+size2;
			}
			res=WaitForSingleObject(soundevent,1000);
			if (res!=WAIT_OBJECT_0) break;				
		}
		playing=0;
		soundbuffer-&gt;Stop();
//		printf("done...\n");
//		fflush(stdout);
	}
	
	static DWORD WINAPI soundproc(LPVOID lpParam){
		dsounddevice *dsd;
		dsd=(dsounddevice*)lpParam;
		return dsd-&gt;run();
	}
};

audiodevice *OpenDirectSoundDevice(){
	return new dsounddevice();
}
</textarea> <br><br></td></tr></table><br>
<a name="754740"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#38">[#38]</a></td></tr></table></td></tr><tr ><td class="posttext"> Done - its still crackly like before using FreeAudio DirectSound.  No change at all. :/ <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
