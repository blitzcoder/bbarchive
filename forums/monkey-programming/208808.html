<!DOCTYPE html><html lang="en" ><head ><title >DrawPoly Textured</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >DrawPoly Textured</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=507" >Monkey Programming</a>/<a href="#bottom" >DrawPoly Textured</a><br><br>
<a name="2092032"></a>

<a name="2092033"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I know this has been discussed before and I know DrawPoly with a texture is experimental and that it doesn't work in HTML5.<br>But is there any way I can actually use DrawPoly with an image? I load an image and call DrawPoly(tri,myImage) but all I get is a line, which is "sorta" textured.<br><br>This is how it looks: <img src="http://puu.sh/amK8E/c1a7f5b74e.png"><br>If I don't use an image, this is how it looks: <img src="http://puu.sh/amKb2/ae3f7b6533.png"><br><br>I only need it for PC and Android. <br><br></td></tr></table><br>
<a name="2092034"></a>

<a name="2092035"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >programmer</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> <textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">' img is Image

Local imgWidth:Float = img.Width()
Local imgHeight:Float = img.Height()

Local displayWidth:Float = 300.0
Local displayHeight:Float = 300.0

DrawPoly(
	' Vertex Format: (x, y, u, v). UV is not normalized!
	' Triangle 1
	[0.0, 0.0, 0.0, 0.0, ' top-left vertex
	displayWidth, 0.0, imgWidth, 0.0, ' top-right vertex
	0.0, displayHeight, 0.0, imgHeight, ' bottom-left vertex
	' Triangle 2
	displayWidth, 0.0, imgWidth, 0.0, ' top-right vertex
	displayWidth, displayHeight, imgWidth, imgHeight, ' bottom-right vertex
	0.0, displayHeight, 0.0, imgHeight],  ' bottom-left vertex
	img)
</textarea><br><br>P.S. <a href="http://www.monkey-x.com/Community/posts.php?topic=8435&amp;page=1" target="_blank">Mungo</a>'s HTML5 WebGL renderer <a href="http://source.mungo.io/modules/mojo/blob/master/native/mojo.html5.webgl.js#L311" target="_blank">supports</a> textured DrawPoly. <br><br></td></tr></table><br>
<a name="2092043"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raph</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm, I just found that the textured DrawPoly in Mungo is not working for me, actually. I'll post in the Mungo thread about it. <br><br></td></tr></table><br>
<a name="2092071"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >IMMGames</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> After having a look at the DrawPoly2 function, I noticed that you have to specify UV yourself.<br>Thank you "programmer" for the example! <br><br></td></tr></table><br>
<a name="2092072"></a>

<a name="2092073"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> DrawPoly seems to be a bit buggy still.<br>If I don't draw anything else, DrawPoly won't show my picture.<br>But if I draw for example a rectangle before calling DrawPoly, it works just fine!<br>Maybe that's why it's not working in Mungo either? <br><br></td></tr></table><br>
<a name="2092099"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raph</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> devolonter posted in the Mungo thread that DrawPoly2 isn't in the release yet, you need to actually grab it from source. <br><br></td></tr></table><br>
<a name="2092183"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >programmer</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have found that textured DrawPoly uses vertices count to select render mode:<br>1 - point<br>2 - line<br>3 - triangle<br>4 - quad<br>5 and more - triangle fan(!!!)<br><br>i.e. you should call DrawPoly([array with 3 vertices], image) 2 times to draw 2 triangles in one OpenGL draw call.<br><br>Fixed example:<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
' img is Image

Local imgWidth:Float = img.Width()
Local imgHeight:Float = img.Height()

Local displayWidth:Float = 300.0
Local displayHeight:Float = 300.0

' Draw 2 triangles
DrawPoly(
	' Vertex Format: (x, y, u, v). UV is not normalized!
	' Triangle 1
	[0.0, 0.0, 0.0, 0.0, ' top-left vertex
	displayWidth, 0.0, imgWidth, 0.0, ' top-right vertex
	0.0, displayHeight, 0.0, imgHeight], ' bottom-left vertex
	img)
DrawPoly(
	' Triangle 2
	[displayWidth, 0.0, imgWidth, 0.0, ' top-right vertex
	displayWidth, displayHeight, imgWidth, imgHeight, ' bottom-right vertex
	0.0, displayHeight, 0.0, imgHeight],  ' bottom-left vertex
	img)

' Draw quad
DrawPoly(
	[0.0, 0.0, 0.0, 0.0, ' top-left vertex
	displayWidth, 0.0, imgWidth, 0.0, ' top-right vertex
	displayWidth, displayHeight, imgWidth, imgHeight, ' bottom-right vertex
	0.0, displayHeight, 0.0, imgHeight],  ' bottom-left vertex
	img)
</textarea> <br><br></td></tr></table><br>
<a name="2092184"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thank you programmer.<br>Once I realized that you need to pass the UV's yourself, I quickly solved the issue and wrote a function that automatically takes care of the UV's for me, just the way I want. <br><br></td></tr></table><br>
<a name="2092758"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Jeez, been playing around with this and wondering what I'm doing wrong.... then find out that DrawPoly(verts[],image) doesn't even work in HTML5 (and this fact isn't documented anywhere, other than here on the forum).<br><br>Why not?  I thought the idea of "code once, release many" was that all of it worked on all platforms?  Currently using 79e which isn't even classed as 'experimental'.<br><br>That's two things I've tried in Monkey today (any form of accurate collisions, and this), and both have had problems. <br><br></td></tr></table><br>
<a name="2092762"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paul - Taiphoz</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you solve the collision thing let us know. <br><br></td></tr></table><br>
<a name="2092769"></a>

<a name="2092770"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> As mentioned above, Mungo supports textured DrawPolygon in WebGL mode, you can grab it over at <a href="http://mungo.io/" target="_blank">http://mungo.io/</a> but I do agree that Monkey is very badly documented, which is odd cause I thought BlitzMax's documents were just fine. I personally think that there needs to be a Image flag for repeating the texture/image, it'd be perfect combined with DrawPolygon.<br><br>And I think I've seen some collision examples in the Code Archive - <a href="http://www.monkey-x.com/Community/topics.php?forum=212" target="_blank">http://www.monkey-x.com/Community/topics.php?forum=212</a> <br><br></td></tr></table><br>
<a name="2092768"></a>

<a name="2092798"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SLotman</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> I just found this online:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Function textureMap(ctx, texture, pts) {
    var tris = [[0, 1, 2], [2, 3, 0]]; // Split in two triangles
    For (var t=0; t&lt;2; t++) {
        var pp = tris[t];
        var x0 = pts[pp[0]].x, x1 = pts[pp[1]].x, x2 = pts[pp[2]].x;
        var y0 = pts[pp[0]].y, y1 = pts[pp[1]].y, y2 = pts[pp[2]].y;
        var u0 = pts[pp[0]].u, u1 = pts[pp[1]].u, u2 = pts[pp[2]].u;
        var v0 = pts[pp[0]].v, v1 = pts[pp[1]].v, v2 = pts[pp[2]].v;

        // Set clipping area so that only pixels inside the triangle will
        // be affected by the image drawing operation
        ctx.save(); ctx.beginPath(); ctx.moveTo(x0, y0); ctx.lineTo(x1, y1);
        ctx.lineTo(x2, y2); ctx.closePath(); ctx.clip();

        // Compute matrix transform
        var delta = u0*v1 + v0*u2 + u1*v2 - v1*u2 - v0*u1 - u0*v2;
        var delta_a = x0*v1 + v0*x2 + x1*v2 - v1*x2 - v0*x1 - x0*v2;
        var delta_b = u0*x1 + x0*u2 + u1*x2 - x1*u2 - x0*u1 - u0*x2;
        var delta_c = u0*v1*x2 + v0*x1*u2 + x0*u1*v2 - x0*v1*u2
                      - v0*u1*x2 - u0*x1*v2;
        var delta_d = y0*v1 + v0*y2 + y1*v2 - v1*y2 - v0*y1 - y0*v2;
        var delta_e = u0*y1 + y0*u2 + u1*y2 - y1*u2 - y0*u1 - u0*y2;
        var delta_f = u0*v1*y2 + v0*y1*u2 + y0*u1*v2 - y0*v1*u2
                      - v0*u1*y2 - u0*y1*v2;

        // Draw the transformed image
        ctx.transform(delta_a/delta, delta_d/delta,
                      delta_b/delta, delta_e/delta,
                      delta_c/delta, delta_f/delta);
        ctx.drawImage(texture, 0, 0);
        ctx.restore();
    }
</textarea><br>I didn't had the time to test it yet, but maybe it will work for html5... <br><br></td></tr></table><br>
<a name="2092819"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SLotman</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> The code above is *almost* working!<br><br><img src="http://img.photobucket.com/albums/v431/SLotman/almost.png"><br><br>For a quick test, I just replaced mojo's DrawPoly2 with the code below. I don't know why the top of the texture is being cut off a little bit - but other than that it looks pretty similar to what it should be (EDIT: I see now the top right of the image is wrong, don't know why...)<br><br>Note: The function below will only draw a QUAD, not a textured poly - I needed a quad, and just made it like that as a quick way to test it.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
gxtkGraphics.prototype.DrawPoly2=function(pts, texture, srcx, srcy)
{
    for (var t=0; t&lt;2; t++) {
        var x0, y0, x1, y1, x2, y2;
        var u0,u1,u2, v0,v1,v2;
        
        if (t==0)
        {
	        x0 = pts[0]; x1 = pts[4]; x2 = pts[8];
	        y0 = pts[1]; y1 = pts[5]; y2 = pts[9];
	        u0 = pts[2]; u1 = pts[6]; u2 = pts[10];
	        v0 = pts[3]; v1 = pts[7]; v2 = pts[11];
        } else {
	        x0 = pts[08]; x1 = pts[12]; x2 = pts[0];
	        y0 = pts[09]; y1 = pts[13]; y2 = pts[1];        	
	        u0 = pts[10]; u1 = pts[14]; u2 = pts[2];
	        v0 = pts[11]; v1 = pts[15]; v2 = pts[3];
        }

        // Set clipping area so that only pixels inside the triangle will
        // be affected by the image drawing operation
        this.gc.save(); this.gc.beginPath(); 
		  this.gc.moveTo( pts[0],pts[1] );
		  for( var i=4;i&lt;pts.length;i+=4 ){
				this.gc.lineTo( pts[i],pts[i+1] );
	     }
		  this.gc.closePath(); 
		  this.gc.clip();
		  
        // Compute matrix transform
        var delta = u0*v1 + v0*u2 + u1*v2 - v1*u2 - v0*u1 - u0*v2;
        var delta_a = x0*v1 + v0*x2 + x1*v2 - v1*x2 - v0*x1 - x0*v2;
        var delta_b = u0*x1 + x0*u2 + u1*x2 - x1*u2 - x0*u1 - u0*x2;
        var delta_c = u0*v1*x2 + v0*x1*u2 + x0*u1*v2 - x0*v1*u2 - v0*u1*x2 - u0*x1*v2;
        var delta_d = y0*v1 + v0*y2 + y1*v2 - v1*y2 - v0*y1 - y0*v2;
        var delta_e = u0*y1 + y0*u2 + u1*y2 - y1*u2 - y0*u1 - u0*y2;
        var delta_f = u0*v1*y2 + v0*y1*u2 + y0*u1*v2 - y0*v1*u2 - v0*u1*y2 - u0*y1*v2;

        // Draw the transformed image
        this.gc.transform(delta_a/delta, delta_d/delta,
                          delta_b/delta, delta_e/delta,
                          delta_c/delta, delta_f/delta);
                      
        this.gc.drawImage(texture.image, 0,0);
        this.gc.restore();
    }
}
</textarea> <br><br></td></tr></table><br>
<a name="2092818"></a>

<a name="2092820"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SLotman</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes! It works!! The answer is to actually draw the poly triangle by triangle!<br>Maybe now can someone re-write this to actually draw *any* polys...?<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
gxtkGraphics.prototype.DrawPoly2=function(pts, texture, srcx, srcy)
{
// 0,0,0,0, 128,50,128,0, 128,250,128,128, 0,300,0,128
    for (var t=0; t&lt;2; t++) {
        var x0, y0, x1, y1, x2, y2;
        var u0,u1,u2, v0,v1,v2;
        
        if (t==0)
        {
	        x0 = pts[0]; x1 = pts[4]; x2 = pts[8];
	        y0 = pts[1]; y1 = pts[5]; y2 = pts[9];
	        u0 = pts[2]; u1 = pts[6]; u2 = pts[10];
	        v0 = pts[3]; v1 = pts[7]; v2 = pts[11];
        } else {
	        x0 = pts[08]; x1 = pts[12]; x2 = pts[0];
	        y0 = pts[09]; y1 = pts[13]; y2 = pts[1];        	
	        u0 = pts[10]; u1 = pts[14]; u2 = pts[2];
	        v0 = pts[11]; v1 = pts[15]; v2 = pts[3];
        }

        // Set clipping area so that only pixels inside the triangle will
        // be affected by the image drawing operation
        this.gc.save(); 
        this.gc.beginPath(); 

	     this.gc.moveTo(x0,y0);
	     this.gc.lineTo(x1,y1);
	     this.gc.lineTo(x2,y2);
	     this.gc.lineTo(x0,y0);
	     
		  this.gc.closePath(); 
		  this.gc.clip();
		  
        // Compute matrix transform
        var delta = u0*v1 + v0*u2 + u1*v2 - v1*u2 - v0*u1 - u0*v2;
        var delta_a = x0*v1 + v0*x2 + x1*v2 - v1*x2 - v0*x1 - x0*v2;
        var delta_b = u0*x1 + x0*u2 + u1*x2 - x1*u2 - x0*u1 - u0*x2;
        var delta_c = u0*v1*x2 + v0*x1*u2 + x0*u1*v2 - x0*v1*u2 - v0*u1*x2 - u0*x1*v2;
        var delta_d = y0*v1 + v0*y2 + y1*v2 - v1*y2 - v0*y1 - y0*v2;
        var delta_e = u0*y1 + y0*u2 + u1*y2 - y1*u2 - y0*u1 - u0*y2;
        var delta_f = u0*v1*y2 + v0*y1*u2 + y0*u1*v2 - y0*v1*u2 - v0*u1*y2 - u0*y1*v2;

        // Draw the transformed image
        this.gc.transform(delta_a/delta, delta_d/delta,
                          delta_b/delta, delta_e/delta,
                          delta_c/delta, delta_f/delta);
                      
        this.gc.drawImage(texture.image, 0,0);
        this.gc.restore();
    }
}
</textarea> <br><br></td></tr></table><br>
<a name="2092822"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SLotman</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> hmmm... is there a bug in DrawPoly?<br><br>I'm trying it both with my function above in HTML5 as well in Desktop... If I draw some images before calling DrawPoly, the polygons drawn afterwards will appear in the wrong places - If I don't draw any images with DrawImage, or if I draw then *after* DrawPoly, everything works as supposed.<br><br>Even if I surround all the 'DrawImage" calls with PushMatrix() and PopMatrix() the problem endures.<br><br>Edit: If I just call "DrawImage" without passing rotation or scaling parameters, everything works as it should... what could be the problem?!<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Import mojo
Import autofit

#If TARGET="glfw"
	#GLFW_USE_MINGW=True
	#GLFW_WINDOW_TITLE="DrawPoly Test"
	#GLFW_WINDOW_WIDTH=800
	#GLFW_WINDOW_HEIGHT=480
	#GLFW_WINDOW_FULLSCREEN=False
	#MUSIC_FILES="*.wav|*.ogg"
#End

#MOJO_IMAGE_FILTERING_ENABLED=False

Class Game Extends App
	Field img:Image
	
	Method OnCreate()
		SetUpdateRate(60)
		SetVirtualDisplay 800,480
		
		img = LoadImage("wall.png")
	End Method
	
	Method OnRender()
	   UpdateVirtualDisplay(True)
		SetBlend 0
		SetAlpha 1
		Cls

		Local w:Float = img.Width()
		Local h:Float = img.Height()

		SetColor 255,255,255
		DrawImage img, 0,50, 0, 2,2,0
		
		SetColor 128,128,128
		DrawImage img, 320,100, 0, 1.25,1.25,0
		DrawImage img, 320+320,100, 0, 1.25,1.25,0
		
		DrawImage img, 520, 132, 0, 0.75,0.75,0

		
		' Draw quad
		' top-left, top-right, bottom-right, bottom-left
		SetColor 200,200,200
		Local verts:Float[] = [256.0,50.0,0,0,  256+64.0,50+50.0,w,0,  256+64.0,50+256-46.0,w,h, 256.0,50+256.0,0.0,h]
		DrawPoly(verts, img)

		SetColor 64,64,64
		Local pos:Float = 480
		Local verts2:Float[] = [pos,100.0,0.0,0.0, pos+40.0,132.0,w,0,  pos+40.0, 260-32,w,h, pos, 260.0, 0, h]
		DrawPoly(verts2, img)

	End Method
	
	Method OnUpdate()		
		If KeyHit(KEY_ESCAPE) Then Error ""
	End Method
End Class

Function Main()
	New Game()
End Function	
</textarea> <br><br></td></tr></table><br>
<a name="2092823"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SLotman</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Apparently, changing "DrawPoly" in graphics.monkey to this solved the issue:<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Function DrawPoly( verts#[],image:Image,frame:Int=0 )
#If CONFIG="debug"
	DebugRenderDevice
	If frame&lt;0 Or frame&gt;=image.frames.Length Error "Invalid image frame"
#End
	context.Validate '&lt;&lt; added this here
	Local f:=image.frames[frame]
	renderDevice.DrawPoly2 verts,image.surface,f.x,f.y
End
</textarea><br><br>Now to get colors to work with DrawPoly... <br><br></td></tr></table><br>
<a name="2092893"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SLotman</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yay, colors works now too!<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
gxtkGraphics.prototype.DrawPoly2=function(pts, texture, srcx, srcy)
{
// 0,0,0,0, 128,50,128,0, 128,250,128,128, 0,300,0,128
    for (var t=0; t&lt;2; t++) {
        var x0, y0, x1, y1, x2, y2;
        var u0,u1,u2, v0,v1,v2;
        
        if (t==0)
        {
	        x0 = pts[0]; x1 = pts[4]; x2 = pts[8];
	        y0 = pts[1]; y1 = pts[5]; y2 = pts[9];
	        u0 = pts[2]; u1 = pts[6]; u2 = pts[10];
	        v0 = pts[3]; v1 = pts[7]; v2 = pts[11];
        } else {
	        x0 = pts[08]; x1 = pts[12]; x2 = pts[0];
	        y0 = pts[09]; y1 = pts[13]; y2 = pts[1];        	
	        u0 = pts[10]; u1 = pts[14]; u2 = pts[2];
	        v0 = pts[11]; v1 = pts[15]; v2 = pts[3];
        }

        // Set clipping area so that only pixels inside the triangle will
        // be affected by the image drawing operation
        this.gc.save(); 
        this.gc.beginPath(); 

        this.gc.moveTo(x0,y0);
        this.gc.lineTo(x1,y1);
        this.gc.lineTo(x2,y2);
        this.gc.lineTo(x0,y0);
        this.gc.closePath(); 
        this.gc.clip();
		  
        // Compute matrix transform
        var delta = u0*v1 + v0*u2 + u1*v2 - v1*u2 - v0*u1 - u0*v2;
        var delta_a = x0*v1 + v0*x2 + x1*v2 - v1*x2 - v0*x1 - x0*v2;
        var delta_b = u0*x1 + x0*u2 + u1*x2 - x1*u2 - x0*u1 - u0*x2;
        var delta_c = u0*v1*x2 + v0*x1*u2 + x0*u1*v2 - x0*v1*u2 - v0*u1*x2 - u0*x1*v2;
        var delta_d = y0*v1 + v0*y2 + y1*v2 - v1*y2 - v0*y1 - y0*v2;
        var delta_e = u0*y1 + y0*u2 + u1*y2 - y1*u2 - y0*u1 - u0*y2;
        var delta_f = u0*v1*y2 + v0*y1*u2 + y0*u1*v2 - y0*v1*u2 - v0*u1*y2 - u0*y1*v2;

        // Draw the transformed image
        this.gc.transform(delta_a/delta, delta_d/delta,
                          delta_b/delta, delta_e/delta,
                          delta_c/delta, delta_f/delta);
                      
		  if (this.white) 
		  {                    
	        this.gc.drawImage(texture.image, 0,0);
        } else {
			  this.DrawImageTinted( texture.image,0,0,0,0,texture.swidth,texture.sheight );        
		  }
        this.gc.restore();
    }
}

</textarea> <br><br></td></tr></table><br>
<a name="2092824"></a>

<a name="2092831"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nobuyuki</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> submit patch ! <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
