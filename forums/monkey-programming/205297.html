<!DOCTYPE html><html lang="en" ><head ><title >SaveState Function</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >SaveState Function</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=507" >Monkey Programming</a>/<a href="#bottom" >SaveState Function</a><br><br>
<a name="2058747"></a>

<a name="2058748"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Oniric</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello to all <br><br>I am using Monkey since a few months and I'm very comfortable with the language, but there are some things i don't understand yet. <br><br>In our actual project, we are using save states to save the player characteristics, but i only know how to save one variable with "SaveState" Function.<br><br>My question is, how can i save more than one variable using the SaveState Function? <br><br></td></tr></table><br>
<a name="2058752"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MikeHart</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Save everything into one string where you place a special character between each variable. Then when you load it, split the string you get with that special character you have choosen and read the aray of stirngs back into your variables. <br>Attention, don't make your string bigger than 1024 byte. <br><br></td></tr></table><br>
<a name="2058758"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gerry Quinn</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Why the 1024-byte limit? <br><br></td></tr></table><br>
<a name="2058760"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SLotman</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Never heard of it too... my savestate has a few Kbs, so this 1024 string limit doesn't make much sense. <br><br></td></tr></table><br>
<a name="2058776"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MikeHart</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry, not byte. I ment 1 MB. That is what I read somewhere. But hey, maybe I am wrong. <br><br></td></tr></table><br>
<a name="2058781"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Oniric</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for your quick reply. :)<br><br>So i have to parse the array to extract the values, is'n it? There is any example in the forums? <br><br></td></tr></table><br>
<a name="2058784"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gerry Quinn</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, my understanding is that the maximum length of a saved string is platform dependent, but some platforms may be as low as 1 MB.<br><br>I was afraid you meant there was smoothing I should know about slicing strings!<br><br>[Personally I don't slice the string into substrings, I just serialise all saved data sequentially.  Slicing at a certain character means your random data can't use that character, which is not a good thing.] <br><br></td></tr></table><br>
<a name="2058782"></a>

<a name="2058785"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gerry Quinn</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oniric, there are various ways of converting all data into strings which can then be concatenated (in practice you will use string buffers for large files) into a single string.<br><br>I think diddy has some serialisation (saving and loading) code if you want to look at that. <br><br></td></tr></table><br>
<a name="2058872"></a>

<a name="2058873"></a>

<a name="2058874"></a>

<a name="2058875"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dawlane</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oniric you will have to parse it to extract the values. How you do it depends on what you want to store.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">Strict
Import mojo

'Main program entry
Function Main:Int()

	Local str_savestring:String
	Local str_hiname:String[]
	Local int_hiscore:Int[]
	Local int_savescore:Int = 100
	
	'Set up a string for high scores
	For Local i:Int = 0 To 5
		'Dynamically resize the hi score name/ hi score
		str_hiname = str_hiname.Resize(str_hiname.Length + 1)
		int_hiscore = int_hiscore.Resize(int_hiscore.Length + 1)
		
		'Fill in the data
		str_hiname[i] = "player " + i
		int_hiscore[i] = int_savescore + (i * 100)
		str_savestring += str_hiname[i] + "," + int_hiscore[i] + ","
	Next
	
	'Remove the last "," in the string. Read string slicing in Home / Language reference
	str_savestring = str_savestring[ .. str_savestring.Length - 1]
	
	Print str_savestring	'What the string should look like when saved
	Print ""
	SaveState(str_savestring)
	
	'Load the data as a string
	Local str_loadstring:String = LoadState()
	
	'Break the string to get the data and load it into an array using ',' as the separator. Read Home / monkey / lang / String for more about strings. 
	Local str_parse:String[] = str_loadstring.Split(",")
	
	Local int_score:Int[]	'use to hold the hi scores
	Local str_name:String[]	'Use to hald the hi score name
	
	'Extract the data
	For Local i:Int = 0 To(str_parse.Length - 2) Step 2	'Increase in steps of two
		'Dynamically resize the hi score name/ hi score
		str_name = str_name.Resize(str_name.Length + 1)
		int_score = int_score.Resize(int_score.Length + 1)
		
		'Get data from first and second element from the str_parse array
		str_name[str_name.Length - 1] = str_parse[i]
		int_score[int_score.Length - 1] = int(str_parse[i + 1])	'Enforce numerial string to int data type
	Next
	
	'Set up to display the scores 
	Local str_display:String
	Local str_zeros:String = "000000"
	Local str_hi:String
	
	'Print the table
	For Local i:Int = 0 To str_name.Length - 1
		'fix the score with leading zeros
		str_hi = String(int_score[i])	'convert the int score back to a string
		str_display = str_zeros[ .. (str_zeros.Length - str_hi.Length)] + str_hi	'Slice the hi score to the zeros
		Print str_name[i] + " : " + str_display
	Next
	
	Return 0 
End Function</textarea> <br><br></td></tr></table><br>
<a name="2058812"></a>

<a name="2058810"></a>

<a name="2058787"></a>

<a name="2058802"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Oniric</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks a lot Dawlane, the "Split" Method is very usefull to Parse data!<br><br>Only a Question... why "step 2" in this loop?:<br><br><pre class=code>For Local i:Int = 0 To(parse.Length() -2) Step 2</pre> <br><br></td></tr></table><br>
<a name="2058803"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Oniric</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks a lot Dawlane, the "Split" Method is very usefull to Parse data!<br><br>Only a Question about the code... why "step 2" in this loop? i made a test using "Step 1" and some "NaN" texts appears:<br><br><pre class=code>For Local i:Int = 0 To(parse.Length() -2) Step 2</pre> <br><br></td></tr></table><br>
<a name="2058796"></a>

<a name="2058801"></a>

<a name="2058814"></a>

<a name="2058815"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dawlane</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Only a Question about the code... why "step 2" in this loop? i made a test using "Step 1" and some "NaN" texts appears: <br></div>When the string is split you have 2 types of data in the parse array both of which will still be strings.<br>As we're looping through 'parse' array we need to get the first item which is the name (first index 0) and the second which is the score (first index + 1). This would mean that the next hi score would be the third index (first index + 2) so to get the next hi score with name you have to iterate parse in steps of 2 to go through all the data.<br><br>I could have written<pre class=code>For Local i:Int = 0 To(parse.Length() -2) Step 2</pre>as<pre class=code>For Local i:Int = 0 To(parse.Length() -1) Step 2</pre><br>and it would still work as the last item in the array would never be reached.<br>For an experiment try and change the for loop into a while/wend and a repeat/until.<br><br>This bit of code int(parse[i + 1]) is just to let the compiler and anyone reading the code know that we are enforcing the numerical string in to the data type that we want. It shouldn't be necessary if your using Strict mode to do this for default data types. It's also the one that would throw the error when the parse array is iterated in steps of 1 as you would be trying to read past the length of the array.<br><br>Edit: I've updated the code in post <a href="http://www.monkeycoder.co.nz/Community/post.php?topic=5297&amp;post=58812" target="_blank">#9</a> to explain better what I did with a little showing of using string slicing. <br><br></td></tr></table><br>
<a name="2058813"></a>

<a name="2058811"></a>

<a name="2058809"></a>

<a name="2092563"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >APC</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> dawlane,<br><br>what the dots in the Array index does?<br><pre class=code>
str_display = str_zeros[ .. (str_zeros.Length - str_hi.Length)] + str_hi
</pre> <br><br></td></tr></table><br>
<a name="2092564"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >programmer</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="http://www.monkey-x.com/docs/html/Programming_Language%20reference.html" target="_blank">http://www.monkey-x.com/docs/html/Programming_Language%20reference.html</a><br><div class="quote"> Like strings, arrays can also be sliced. The syntax for slicing an array is: ArrayExpression [ StartExpression .. EndExpression ].<br>Slicing an array returns 'sub array' of ArrayExpression starting at index StartExpression and ending at index EndExpression.<br>Both StartExpression and EndExpression are optional. If StartExpression is omitted, it defaults to 0. If EndExpression is omitted, it defaults to the length of the array.<br>StartExpression and EndExpression can also be negative, in which case they refer to offsets from the end of the array. <br></div> <br><br></td></tr></table><br>
<a name="2092611"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dawlane</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> You know I can't remember posting that.<br>@APC; Monkey doesn't have the traditional string functions that you would find in the standard BASIC dialect and a few other languages. As strings in Monkey are basically an array of characters. The double period (..) is use to slice string arrays. Any number before the double period is the start character and any number after would be the end character.<br>A small example of slicing and some of the String Class functions<br><pre class=code>Function Main()
	Local myVar:String="abcdefgh"
	Local myArray:Int[]=[65,98,67,100,69,102,71,104] ' AbCdEfGh
	Local myToArray:Int[]="MONKEY-X".ToChars() ' Convert a string to an array 
	Print "myVar is 'abcdefgh'"
	Print "myArray is [65,98,67,100,69,102,71,104] ' AbCdEfGh"
	Print "myToArray is MONKEY-X"
	Print "String are zero index arrays [0=a,1=b,etc]"
	Print "Print the fourth letter ('d') using String.FromChar(myVar[3]) this would be equivalent to Chr$(numeric value) -&gt; " + String.FromChar(myVar[3])
	Print "Print the ascii character code for the fourth letter ('d') with myVar[3] this would be equivalent the Asc(character_at_variable_index) -&gt; " + myVar[3]
	Print String.FromChar(34)+"A"+String.FromChar(34)+ "[0] would be the same as doing Asc(" + String.FromChar(34) + "A" + String.FromChar(34) + ") -&gt; " + "A"[0] 
	Print "Print the letters 'abcde' using what would be the equivalent of Left(myVar, length) with myVar[..5] -&gt; " + myVar[..5]
	Print "Print the middle letters 'def' using what would be the equivalent of Mid(myVar, start, length) with myVar[3..((myVar.Length+1) - 3)] -&gt; " + myVar[3..((myVar.Length+1) - 3)]	
	Print "Print the last letters 'fgh' using what would be the equivalent of Right(myVar, length from right) with myVar[((myVar.Length) - 3)..] -&gt; " + myVar[((myVar.Length) - 3)..]
	Print "Print the letters 'defgh'. Some languages would use Mid(myVar,start) with myVar[3..] -&gt; " + myVar[3..]
	Print "Convert an array of integer character codes to a string with String.FromChars(myArray) -&gt; " + String.FromChars(myArray)
	Print "'MONKEY-X' that was converted to an array"
	For Local i:Int = 0 To myToArray.Length - 1
		Print "Index = " + i + ": code: " + myToArray[i] + " -&gt; " + String.FromChar(myToArray[i])
	Next	
End Function</pre> <br><br></td></tr></table><br>
<a name="2092610"></a>

<a name="2092609"></a>

<a name="2092577"></a>

<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
