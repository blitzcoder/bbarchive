<!DOCTYPE html><html lang="en" ><head ><title >Different reflection on HTML5 and iOS (XCode 4.5)</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Different reflection on HTML5 and iOS (XCode 4.5)</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=507" >Monkey Programming</a>/<a href="#bottom" >Different reflection on HTML5 and iOS (XCode 4.5)</a><br><br>
<a name="2040324"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Anatol</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>[EDIT] solved, see post <a href="http://www.monkeycoder.co.nz/Community/post.php?topic=3698&amp;post=40323" target="_blank">http://www.monkeycoder.co.nz/Community/post.php?topic=3698&amp;post=40323</a><br><br>Something is wrong that used to work before. I use reflection to cycle through all fields of a few classes in order to save the state of some of these fields.<br><br>I notice now that in my project iOS seems to only detect fields in classes but not in classes that extend other classes. As a result the fields I get through reflection in HTML5 and iOS are different (HTML5 comes up with a lot more from the extending classes).<br><br>I use the same filter for both builds<br>#REFLECTION_FILTER="monkey.map*|book*|pages*"<br><br>This used to work, and I have a hunch that it stopped working since I updated to XCode 4.5 very recently. I tested it with older versions of Monkey of which I am certain that they worked but get the same disappointing result, hence I think it's the updated XCode.<br><br>Some more details about the project setup: the Book Class Extends IntMap&lt;Page&gt; (it's basically a better container for pages); and then there are classes like Page001 Extends Page, Page002 Extends Page, etc.<br><br>So all I get on iOS are Fields from the Page Class, but none from the extending classes Book, Page001, Page002, etc.<br><br>Does anyone have any ideas? I would appreciate any help - I've tried for a couple of hours but to no avail.<br><br>Thanks,<br>Anatol <br><br></td></tr></table><br>
<a name="2039639"></a>

<a name="2039637"></a>

<a name="2039752"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Anatol</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sometimes it helps just to have a weekend and not worry about things for a while - I recommend it.<br><br>My issue above is resolved, but I haven't really changed much. All I did was to build my project with<br>#REFLECTION_FILTER="*"<br>which pointed out some issues in my code (mostly wrong return values of methods that I never call). A great way to double-check code though.<br><br>And I installed Command Line Tools in Xcode (under Xcode &gt; Preferences &gt; Downloads &gt; Components).<br><br>I then tried to build and run in Xcode but due to including everything in the reflection it took probably about 15 minutes to build and didn't run at all in the end. I then reverted to<br>#REFLECTION_FILTER="monkey.map*|book*|pages*"<br>and it all works well just as before.<br><br>I'm not certain what really fixed it, but these two approaches are worth trying for anyone who experiences similar problems. Are Command Line Tools a requirement for Monkey on iOS? <br><br></td></tr></table><br>
<a name="2040264"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Anatol</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hm, I have the same problem now again as described above. The same Monkeycode creates different reflection results in HTML5 and iOS.<br><br>Here's a download link of a very simplified version of the actual project: <a href="http://attic.nugob.org/communities/monkeycoder.co.nz/forum/attachments/reflectionTest.zip" target="_blank">http://attic.nugob.org/communities/monkeycoder.co.nz/forum/attachments/reflectionTest.zip</a><br><br>Code snippet for reflection<br>[monkeycode]<br>Class Book Extends IntMap&lt;Page&gt;<br>	<br>	Field myBookField01:Int<br>	Field myBookField02:Int<br>	<br>	Method AddPage:Void(page:Page)<br>		Set(Count()+1,page)<br>	End<br>	<br>	Method PrintFieldNames:Void()<br>		Local classInfo:=GetClass(Self)<br>		Print("--- CLASS " + classInfo.Name + " ---")<br>		For Local fieldInfo:=Eachin classInfo.GetFields(True)<br>			Print(fieldInfo.Name)<br>		Next<br>		<br>		For Local page:= Eachin Values()<br>			Local classInfo:=GetClass(page)<br>			Print("--- CLASS " + classInfo.Name + " ---")<br>			For Local fieldInfo:=Eachin classInfo.GetFields(True)<br>				Print(fieldInfo.Name)<br>			Next<br>		Next<br>	End<br>	<br>End<br>[/monkeycode]<br><br>(Note that there's also a class EnhancedBook Extends Book)<br><br>Print() results:<br><br>HTML5<br><pre class=code>
--- CLASS book.enhancedBook.EnhancedBook ---
root
myBookField01
myBookField02
myEnhancedBookField01
myEnhancedBookField02
--- CLASS pages.page001.Page001 ---
myPageField01
myPageField02
myPage001Field01
myPage001Field02
</pre><br><br>iOS (Xcode 4.5)<br><pre class=code>
--- CLASS monkey.map.IntMap&lt;book.page.Page&gt; ---
root
--- CLASS pages.page001.Page001 ---
myPageField01
myPageField02
myPage001Field01
myPage001Field02
</pre><br><br>To me HTML5 shows the 'correct' result that I'm after. iOS seems to ignore some class extensions and I think this may be also because extensions aren't necessarily located in the same module or sub-module.<br><br>The project has the following file/module structure:<br><pre class=code>
main.monkey
book
   book.monkey
   enhancedBook.monkey
   page.monkey
pages
   pages.monkey
   page001.monkey
</pre><br><br>I'm just not sure what I'm doing wrong or if it's a Monkey/Xcode issue.<br><br>Also, this definitely used to work and results were identical in HTML5 and iOS; I'm quite certain that it stopped working after an update to Xcode 4.5.<br><br>If anyone has any ideas, please let me know. I spent a lot of time searching for bugs but to no avail. Thank you! <br><br></td></tr></table><br>
<a name="2040263"></a>

<a name="2040323"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Anatol</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> In short and for lack of a better word: AAAAAaaaaaaaahhhhhh!<br><br>In detail: forget all of the posts above. It seems it's neither a Monkey nor a Xcode issue. Something in my project files must have been corrupted. I'm developing on Windows with Jungle IDE and sync everything except the build folder to a Mac via Sugarsync. As a test I copied over the entire project in the traditional way via external HDD, and it worked. Now I resynced the project on the Mac from scratch, and it works just as it should.<br><br>I really have no idea why this happened or where the synced files were different because all changes I made on Windows appeared when running it on the Mac. Just the reflection misbehaved.<br><br>I'm quite relieved about this outcome, but I really wish I hadn't wasted so much time on it. Strange, though, that the simplified sample project that I posted above came up with similar issues, and also only when I synced it. Maybe the reflection module is simply more "sensitive"... <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
