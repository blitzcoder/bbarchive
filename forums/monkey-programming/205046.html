<!DOCTYPE html><html lang="en" ><head ><title >Stack - Removing an entry fast?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Stack - Removing an entry fast?</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=507" >Monkey Programming</a>/<a href="#bottom" >Stack - Removing an entry fast?</a><br><br>
<a name="2055496"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MikeHart</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi folks,<br><br>I am trying to speed up my engine a little. So far I am using Lists because they are easy to maintain and the buildin sorting feature is just priceless. Plus removing an entry via its node is also very very fast. But iterating through a list is slower than a stack. <br><br>But there is no sorting and removing is only possible via its index, push or RemoveEach. As the content of the stack is dynamic, and the stack index of an object WILL change during its lifetime, I see only using RemoveEach to remove it. Or did I miss something?<br><br>Some people say "use arrays". But there are only quicl to iterate. Removeing an entry inbetween or sorting doesn't play well when you have a load of objects that are dynamically created and removed.<br><br>So, I see only stacks here. Or? <br><br></td></tr></table><br>
<a name="2055497"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Xaron</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> You are right. Stack operations are only fast O(1) for the last added element. Removing a deeper element results in copying the other elements.<br><br>You could use maps where the key is the index. They are pretty fast. <br><br></td></tr></table><br>
<a name="2055505"></a>

<a name="2055506"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MikeHart</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Mmmh, my tests show that iterating through a map and removing an item from a map is actually slower than from a list.<br><br>Iterating through a stack is as fast as an array. But removing is damn slow. I wish it had some kind of node to it.<br><br>Will try my own linked object list. <br><br></td></tr></table><br>
<a name="2055508"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gerry Quinn</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> You pays your money and you takes your choice.  The reason all these collection classes exist is that no type is good for everything.<br><br>One option is to use an array or stack, but instead of removing items, just mark them dead.  You can re-use the dead ones (if order doesn't matter) or else just reallocate everything when it grows too large.  In a lot of cases (where objects last a long time and are not frequently added) this can be an effective solution.<br><br>If you intend the stack index of an object to change during its lifetime, you are probably using the wrong type of collection, and a list would be better. <br><br></td></tr></table><br>
<a name="2055509"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MikeHart</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I agree with you but.... the problem is, the order matters.<br><br>It is either lists or running something on my own. <br><br></td></tr></table><br>
<a name="2055510"></a>

<a name="2055511"></a>

<a name="2055512"></a>

<a name="2055513"></a>

<a name="2055514"></a>

<a name="2055515"></a>

<a name="2055516"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AdamRedwoods</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Iterating through a stack is as fast as an array. But removing is damn slow.  <br></div><br>i wonder if you could write a 'stack garbage collector' for the stack. In other words, leave holes in the stack as Null "stack.Set(i,null)", then at the end of a render cycle, go through the stack and add any non-nulls to a new stack. Make sure to use a 'something was removed' flag to prevent iteration each cycle. You could even set a threshold for say, if more than 10 objects were removed. <br><br></td></tr></table><br>
<a name="2055522"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MikeHart</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Not sure if that would help the GC problem on android when you iterate through a collection (list), or? <br><br></td></tr></table><br>
<a name="2055524"></a>

<a name="2055525"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AdamRedwoods</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> well, don't know if iteration creates a lot of GC overhead since Enumerator creates no new objects, but if you want, you could get a little primitive and use nodes to cycle through a list yourself.<br><pre class=code>
Local node:Node&lt;MyClass&gt; = list.FirstNode()

While node
   ''do stuff

   node = node.NextNode()
Wend
</pre> <br><br></td></tr></table><br>
<a name="2055536"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Samah</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> @AdamRedwoods: i wonder if you could write a 'stack garbage collector' for the stack. In other words, leave holes in the stack as Null "stack.Set(i,null)", then at the end of a render cycle, go through the stack and add any non-nulls to a new stack. <br></div><br>Diddy's ArrayPool class already does something similar to this, swapping elements around to fill the holes.  Unfortunately this makes it unordered.<br><br><a href="https://code.google.com/p/diddy/source/browse/src/diddy/collections.monkey" target="_blank">https://code.google.com/p/diddy/source/browse/src/diddy/collections.monkey</a> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
