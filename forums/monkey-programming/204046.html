<!DOCTYPE html><html lang="en" ><head ><title >Corridor Creation in a Roguelike</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Corridor Creation in a Roguelike</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=507" >Monkey Programming</a>/<a href="#bottom" >Corridor Creation in a Roguelike</a><br><br>
<a name="2043356"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Why0Why</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi all,<br><br>I have been working on map generation in a roguelike.  The map is a 2D array of ints.  Currently I am using a panel system where a map of 100,100 is split into 10 vertical and horizontal panels.  The room and door generation is fine and I am going to add more complexity as I go along.  I have done the corridor generation several ways and haven't been happy with any of them.  I have used lists of doors, lists of rooms and even used an astar pathfinder to create corridors between points.  <br><br>I know there are a lot of people on here smarter than me so I would be interested in more suggestions.  I have looked at the one sample in the code section and read a lot of different articles online.  I have even checked out open source code for some popular ones but the code is so long and detailed it is difficult to apply it to my method.<br><br>So basically I need to work form either a list of rooms, doors that are already generated or I am open to changing either if there are some good suggestions.  Thanks for taking the time. <br><br></td></tr></table><br>
<a name="2043359"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kanati</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I was looking into this pretty heavily for quite a while but I think I was using VB.NET at the time for it as I was going to do a true console-based roguelike.  <br><br>I believe what I did was very simple in that I would break my map into panels (maybe like you are doing) by splitting a panel in two either vertically or horizontally to a random size (with a minimum of like 5 blocks in either direction).  I continued to do this until I had reached the minimum "room" size I allowed.  At that point I would knock out random room shapes from a collection of shapes (round, square, rectangle, etc).<br><br>At that point I had all my rooms (which appears to be where you are at).  Where panels touched I would create doors in that side of the room on each panel and create straight corridors from one panel's room to the other panel's room.  This would connect every room to another room. It worked for anything that would look like a dungeon or "built" structure, but if you were wanting more of a cave-like look, then you would need to replace those room "shapes" with more of a fractal room generation that would knock out random shapes in the panel (my room shapes were always smaller than the panel size but "caves" could be as big as the panel, creating it's own potential connections to the panels next to it without doors.)  Then do the same with a random corridor routine.  Say you have one panel above and one below.  Generate a corridor from top to bottom by randomly deciding to go left, right, or down, with a much heavier emphasis on down (like 20% left or right and 60% down).  You introduce a lot more random looking generation there, but you also run the risk of your rooms not joining because of the randomness of the corridor creation.<br><br>I'm no math whiz, which is why I went with the more structured "built" look to my maps, but I think the above techniques might help you some. <br><br></td></tr></table><br>
<a name="2043361"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gerry Quinn</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I mostly use cellular automatons for cave-like systems.  But thinking about rooms, here is what I would try:<br><br>1. Make rooms that are embedded in a fairly dense, not too regular, web of corridors.  (But for a first attempt, the web can be a simple square grid.)<br><br>2. Start randomly removing corridor sections.  If the map becomes disconnnected after one is removed, put it back.<br><br>3. Terminate when the corridors are sparse enough for your liking.<br><br>There should be enough options there for quite a bit of variety.  I implemented something similar though not identical once in C++ and it worked well.  This page has examples and source, and even a Windows .exe for playing with parameters:<br><br><a href="http://newsgroups.derkeiler.com/Archive/Rec/rec.games.roguelike.development/2007-09/msg00042.html" target="_blank">http://newsgroups.derkeiler.com/Archive/Rec/rec.games.roguelike.development/2007-09/msg00042.html</a><br><br>But it may well be that others have created better and simpler methods.  Have you read the articles on Roguebasin? <br><br></td></tr></table><br>
<a name="2043360"></a>

<a name="2043362"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gerry Quinn</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ack!  That code is more complicated than I remember!  But the algorithm is usable.  I wanted to be able to make corridors of variable width.  However the method I described above should be capable of doing that too, without the 'expansion' stage. <br><br></td></tr></table><br>
<a name="2043381"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Why0Why</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the suggestions.  I have read almost everything I could find, especially at roguebasin.  I do intend to have cavelike dungeons and I have looked at cellular automatons for that.<br><br>Kanati, I did look at a BSP method that sounds like what you are referring too.  The problem is that the rooms don't always line up so the corridors can miss the adjacent rooms.  I will look back into this.<br><br>I am still open for more suggestions.  Thanks so far, I appreciate the input. <br><br></td></tr></table><br>
<a name="2043386"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >impixi</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here are the two methods I've used to generate rogue-like dungeons. <br><br>The first, generate a perfect maze, 'clear' out some 'areas', and then add/not add walled perimeters to those areas. There are no 'corridors' in the true sense, but some very interesting and complex maps are generated. I have some code in the Blitzmax code archives demonstrating that approach, but I've not yet ported it to Monkey. Alternatively search for 'perfect maze generation' on Google (there are plenty of examples out there) and then roll your own modifications.<br><br>The second method produces more traditional, rogue-like dungeons, featuring rooms connected by corridors. Simple code for this is in the Monkey archives, so you've probably already seen it. IIRC, this is the procedure.<br>	1. Create a completely filled dungeon.<br>	2. Carve out some non-overlapping, non-adjoining areas at random locations and of random sizes, recording the areas' coodinates and dimensions in a list or array.<br>	3. Carve out a corridor from each area to the next one, in sequence, using the following process: <br>	3a. The starting coordinate of the current corridor is randomly chosen within the current area.<br>	3b. The target coordinate of the current corridor is randomly chosen within the target area.<br>	3c. The corridor may initially proceed vertically or horizontally, depending on the target area's location relative to the current area.<br>	3d. When the corridor reaches the target's vertical/horizontal coordinate, then continue carving at a right angle if necessary until the target coordinate is reached within the target area.<br>	<br>It may appear that some areas are connected by more than one corridor (this is good thing, IMO), because your carving process continues 'through' any areas that are not the target area. <br><br></td></tr></table><br>
<a name="2043385"></a>

<a name="2043387"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Why0Why</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks, Impixi.  I think I will play with method 3 and then I may experiment with creating the maze(corridors) first and then dropping rooms on it.  I will also check out the max archives and take a look at that. <br><br></td></tr></table><br>
<a name="2043388"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >impixi</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> BTW, the real fun with rogue-likes begins with line-of-sight algorithms. ;) <br><br></td></tr></table><br>
<a name="2043390"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Why0Why</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> How do you mean?  For what? <br><br></td></tr></table><br>
<a name="2043397"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >impixi</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, unless you want the player and other creatures to see everything within a specific radius, regardless of walls in the way, you're going to need to take a line-of-sight approach. Most rogue-likes do that, where walls obscure vision. It's more complicated than you might think to achieve 'accurate', 'realistic' results. For me it was, anyway... <br><br></td></tr></table><br>
<a name="2043396"></a>

<a name="2043391"></a>

<a name="2043395"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >maltic</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> My team had to do something similar in the ICFP this year to create test cases so our AI could apply machine learning algorithms. What I did what randomly make a number of seed points and give each a random score. Then I ran a simplified version of a particle swarm optimization algorithm to 'find' the highest scored seed point. If I marked wherever these 'particles' visited as open space, it made a pretty nice looking cave system. You do have to play with the seed generator and number of particles to get it looking right however. The other upside is that it was a really simple algorithm to code. <br><br></td></tr></table><br>
<a name="2043394"></a>

<a name="2043393"></a>

<a name="2043392"></a>

<a name="2043399"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Why0Why</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> @maltic - I used a very similar method to create complete outdoor worlds for a map generator I created years ago in Blitz Basic.  It worked really well.  I am considering using it for this roguelike and having a full outdoor world with towns that are randomly generated and then quests can be picked up at different areas which lead to indoor roguelike dungeons.  I want the dungeons to have a large range of types: caves, towers, crypts, dungeons, etc. <br><br></td></tr></table><br>
<a name="2043400"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gerry Quinn</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Line of sight is not too hard, really.  Just employ Bresenham between centres of squares.<br><br>An option I have found useful is to consider a square adjacent to an empty LOS square to be semi-visible.  You can see what's on it but you can't target it with arrows etc., and it is shown shadowed. <br><br></td></tr></table><br>
<a name="2043405"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >impixi</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>Just employ Bresenham between centres of squares.<br> <br></div><br><br>The technique I employed used a modified Bresenham algorithm, projected into multiple quadrants, or something like that. It was a pain to implement at the time, maybe because the accompanying explanatory text wasn't clear on certain points. <br><br></td></tr></table><br>
<a name="2043425"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Why0Why</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Liking the dialog.  I am open to any other roguelike tips/concerns.  I have played around in Blitz for years and am finally devoting more time to overcoming issues.  Since this is a hobby, I have a tendency to move to something else when I get bogged down.  But I am thinking lately it would be nice to have a good roguelike on my shiny, red Lumia 920. <br><br></td></tr></table><br>
<a name="2043426"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Xaron</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> But I am thinking lately it would be nice to have a good roguelike on my shiny, red Lumia 920.  <br></div><br><br>There will be in a few days/weeks. ;) <br><br></td></tr></table><br>
<a name="2043431"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Why0Why</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh, do tell :)  Thought you were working on a sub game?  Let me know if you need a beta tester! <br><br></td></tr></table><br>
<a name="2043433"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Xaron</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hehe, yes. I usually work on 2 projects the same time. lol.<br><br>Well actually my intention was NOT to demotivate you so sorry for that!<br><br>It will be more a tiny game with a procedural created dungeon... <br><br></td></tr></table><br>
<a name="2043451"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Halfdan</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> About the Line of Sight, <br><br>I once implemented the LOS algorithm mentioned here: <a href="http://www.adamantyr.com/crpg/article_04.htm" target="_blank">http://www.adamantyr.com/crpg/article_04.htm</a><br><br>It's very simple with good results. <br><br></td></tr></table><br>
<a name="2043453"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Why0Why</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> @xaron, no demotivation.  As I said before, this is a hobby.  I have a REALLY ambitious plan that I have been writing a doc for(One Note is awesome by the way and SO cross platform.)  I think the scope is too large for mobile.  I may do a subset for mobile, but if I do everything I want it will have to be PC, Mac and Linux based.  I actually considered writing it in Max because of this, but I think I am going to stick with Monkey.  I purchased Ignition for both Max and Monkey just in case.  Right now I am just writing everything in straight Monkey though.  Just in the initial prototyping stage and experimenting with different types of dungeon generation.<br><br>I have already purchased the music and some of the best pixel art/tiles I have ever seen. The art is stunning.  Unfortunately, it won't be finished for 6-12 months but I am rolling with placeholders and it will take me at least that long to get it all together anyway.<br><br>Everything is going to be random.  Outside world, towns, dungeons of all different types, quests, music is going to be randomly selected from predefined lists based on the scenario.  I have worked out much of the skeleton.  It needs fleshing out, especially the magic system, I can't decide how I want to go there. <br><br></td></tr></table><br>
<a name="2043454"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Xaron</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh well that sounds awesome and is really some classes above what we do. I'll show it as soon as it's done which will be this year. <br><br>Good luck with your project, it sounds really ambitious. <br><br></td></tr></table><br>
<a name="2043477"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tiresius</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is all good stuff.  I've found some helpful articles on GameDev.net as well.  My basic rogue-like game for Monkey Touch was about as basic as you can get.  :-)  I might plan on doing a sequel with more stuff at some point in the future...<br><br>Looking forward to some rogue-likes! <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
