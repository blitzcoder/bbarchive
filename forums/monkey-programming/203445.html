<!DOCTYPE html><html lang="en" ><head ><title >Collisions?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Collisions?</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=507" >Monkey Programming</a>/<a href="#bottom" >Collisions?</a><br><br>
<a name="2036060"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Amon</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> What is everyone else using for collisions? <br><br></td></tr></table><br>
<a name="2036061"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tri|Ga|De</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> fantomEngine works like a charm.<br>And a lot of other stuff. <br><br></td></tr></table><br>
<a name="2036063"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Amon</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> A non framework method would be nice! <br><br></td></tr></table><br>
<a name="2036064"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Mostly rect collisions via hitboxes and ray casting for fast moving objects. <br><br></td></tr></table><br>
<a name="2036065"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Amon</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Example? <br><br></td></tr></table><br>
<a name="2036066"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Check out Diddy's platformer example :P<br><br><a href="http://code.google.com/p/diddy/source/browse/#svn%2Ftrunk%2Fexamples%2FPlatformer" target="_blank">http://code.google.com/p/diddy/source/browse/#svn%2Ftrunk%2Fexamples%2FPlatformer</a> <br><br></td></tr></table><br>
<a name="2036069"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Amon</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Have no idea wots goin on Phil! <br><br></td></tr></table><br>
<a name="2036072"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >NoOdle</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've just implemented SAT Separating Axis Theorem in monkey. Works for all convex shapes including circles. It was fairly easy to implement and is really quick due to the algorithms early exit. I've also implemented AABB Axis Aligned Bounding Box and Orientated Bounding Box OBB for intersection tests. I'll be posting the code soon when I have cleaned it up and made some better examples showing how to use it. I will also make it completely framework independent to allow for easier integration into your projects.<br><br>There is also Box2D, this can be used for collision detection, you don't have to use the physics if you don't wan't to. <br><br></td></tr></table><br>
<a name="2036070"></a>

<a name="2036071"></a>

<a name="2036076"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Heres a really quick ray cast example:<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">Strict

Import mojo

' Store the device width and height
Global SCREEN_WIDTH%
Global SCREEN_HEIGHT%

' Game Width and Height
Const WIDTH#=512
Const HEIGHT#=256

Global game:MyGame

Function Main:Int()
	game = New MyGame
	Return 0
End

Class MyGame Extends App
	Field player:Player
	Field level:Level
	
	Method OnCreate:Int()
		level = New Level()
		player = New Player(level.playerX, level.playerY)
		
		' Store the device width and height
		SCREEN_WIDTH = DeviceWidth()
		SCREEN_HEIGHT = DeviceHeight()
		
		SetUpdateRate(60)
		Return 1
	End
	
	Method OnUpdate:Int()
		player.Update()
		Return 1
	End
	
	Method OnRender:Int()
		Cls
		PushMatrix 
		Scale SCREEN_WIDTH/WIDTH, SCREEN_HEIGHT/HEIGHT
		level.Draw()
		player.Draw()
		PopMatrix
		Return 1
	End
End

Class Level
	Const TILE_SIZE% = 16
	Field map:Tile[][]
	Field width%, height%
	Field playerX%, playerY%
	Field pixelWidth% = 0
	Field pixelHeight% = 0
	
	' 32 across
	Global level1:=[
		150,150,150,150,150,150,150,150,150,150,150,150,150,150,150,150,150,150,150,150,150,150,150,150,150,150,150,150,150,150,150,150,
		150,0,0,0,0,0,0,0,0,0,0,0,0,0,0,124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,150,
		150,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,150,
		150,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,150,
		150,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,150,
		150,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,124,0,0,0,0,0,0,0,0,0,0,0,0,0,150,
		150,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,150,
		150,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,150,
		150,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,150,
		150,0,0,0,0,0,0,0,0,0,0,124,0,0,0,16,124,16,124,16,0,0,0,0,0,0,0,0,0,0,0,150,
		150,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,150,
		150,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,150,
		150,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,150,
		150,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,150,
		150,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,150,
		150,150,150,150,150,150,150,150,150,150,150,150,150,150,150,150,150,150,150,150,150,150,150,150,150,150,150,150,150,150,150,150]
		
	Method New()
		width = 32
		height = 16
		
		pixelWidth = width * TILE_SIZE
		pixelHeight = height * TILE_SIZE
			
		map = TileArray(width, height)
		
		For Local x:Int = 0 To width - 1
			For Local y:Int = 0 To height - 1
				map[x][y] = New Tile((level1 [ x + y * width ] ))
			Next
		Next
		
		playerX = 50
		playerY = 200
	End
	
	Method Draw:Void()
		For Local x% = 0 To width - 1
			For Local y% = 0 To height - 1
				If map[x][y].frame &gt; 0
					SetColor map[x][y].red, map[x][y].green, map[x][y].blue
					DrawRect Int(x * TILE_SIZE), Int(y * TILE_SIZE), TILE_SIZE, TILE_SIZE
				End
			Next
		Next
	End
	
	Method CheckCollision:Int(startX:Float, startY:Float, endX:Float, endY:Float)
		Local x1:Int = startX
		Local y1:Int = startY
		Local x2:Int = endX
		Local y2:Int = endY

		Local deltax:Int = Abs(x2 - x1)
		Local deltay:Int = Abs(y2 - y1)
		
		Local numpixels:Int, d:Int, dinc1:Int, dinc2:Int, xinc1:Int, xinc2:Int, yinc1:Int, yinc2:Int, x:Int, y:Int, i:Int
		Local xx:Int, cx:Int
		Local yy:Int, cy:Int
		Local tile:Int
		
		If deltax &gt;= deltay 
			numpixels = deltax + 1
			d = (2 * deltay) - deltax
			dinc1 = deltay Shl 1
			dinc2 = (deltay - deltax) Shl 1
			xinc1 = 1
			xinc2 = 1
			yinc1 = 0
			yinc2 = 1
		Else 
			numpixels = deltay + 1
			d = (2 * deltax) - deltay
			dinc1 = deltax Shl 1
			dinc2 = (deltax - deltay) Shl 1
			xinc1 = 0
			xinc2 = 1
			yinc1 = 1
			yinc2 = 1
		End
		
		If x1 &gt; x2
			xinc1 = -xinc1
			xinc2 = -xinc2
		End
		
		If y1 &gt; y2 
			yinc1 = -yinc1
			yinc2 = -yinc2
		End
		
		x = x1
		y = y1

		For i = 1 To numpixels
			tile = GetCollisionTile(x, y)

			' exit when we have a collision
			If tile &lt;&gt; 0 Then
				cx = x
				cy = y
				Exit
			End
			
			If d &lt; 0 
				d = d + dinc1
				x = x + xinc1
				y = y + yinc1
			Else
				d = d + dinc2
				x = x + xinc2
				y = y + yinc2
			End
		Next
		Return tile
	End
	
	Method GetCollisionTile:Int(x:Float, y:Float)
		If x &lt; 0 Or x &gt;= pixelWidth Or y &lt; 0 Or y &gt;= pixelHeight Then Return 0
		
		Local xx% = (Floor(x / TILE_SIZE)) 
		Local yy% = (Floor(y / TILE_SIZE))
		
		Return map[xx][yy].frame
	End
End

Class Tile
	Field frame:Int
	Field red%, green%, blue%	
	
	Method New(frame:Int=0)
		Self.frame = frame
		red = 255 - frame
		green = 255 - frame
		blue = 255 - frame
	End
End

Function TileArray:Tile[][](x_size:Int, y_size:Int)
	Local map:Tile[x_size][]
	For Local x:Int=0 Until x_size
	   map[x]=New Tile[y_size]
	Next
	Return map
End

Class Player
	Field x#, y#
	Field dx#, dy#
	Field speedX#, speedY#
	Field width%, height%
	
	Method New(x#, y#)
		Self.x = x
		Self.y = y
		speedX = 4
		speedY = 5
		width = 16
		height = 16
	End
	
	Method Draw:Void()
		SetColor 0,255,0
		DrawRect x - width / 2, y - height / 2, width, height
		SetColor 255, 255, 255
	End
	
	Method Update:Void()
		Local tempx:Float
		Local tempy:Float
		
		If KeyDown(KEY_UP)
			tempy = y - speedY
			If game.level.CheckCollision(x, y - height / 2, x, tempy) = 0
				y = tempy
			End
		Elseif KeyDown(KEY_DOWN)
			tempy = y + speedY
			If game.level.CheckCollision(x, y + height / 2, x, tempy) = 0
				y = tempy
			End
		End
		If KeyDown(KEY_RIGHT)
			tempx = x + speedX
			If game.level.CheckCollision(x + width / 2, y, tempx, y) = 0
				x = tempx
			End
		Elseif KeyDown(KEY_LEFT)
			tempx = x - speedX
			If game.level.CheckCollision(x - width / 2, y, tempx, y) = 0
				x = tempx
			End
		End
	End
End</textarea> <br><br></td></tr></table><br>
<a name="2036074"></a>

<a name="2036073"></a>

<a name="2036075"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nobuyuki</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> AABB collision is pretty straightforward to implement.  If you want a very simple concept of collision to use, circle-to-circle collision is easy.  If the distance between 2 circles is less than their combined radius lengths, then you can assume they're colliding.  It's not the fastest thing in the world but it's easy to implement and can be explained in one sentence.<br><br>You'll need some faster stuff later on, so look into AABB collision.  There are examples for polygon, ray-cast, and pixel-mask collision in the code examples, too, but they're a bit more complicated and cost more per frame to perform checks with. <br><br></td></tr></table><br>
<a name="2036078"></a>

<a name="2036079"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Samah</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> @Nobuyuki: It's not the fastest thing in the world but it's easy to implement and can be explained in one sentence. <br></div><br>How is that not fast?<br>[monkeycode]dx = x1-x2<br>dy = y1-y2<br>r = r1+r2<br>If dx*dx+dy*dy &lt;= r*r Then ' collided[/monkeycode] <br><br></td></tr></table><br>
<a name="2036083"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Amon</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> How come after more than a year we still don't have an official solution regarding collisions for Monkey?<br><br>I know 3rd party methods do the job fine but an official solution would be better. <br><br></td></tr></table><br>
<a name="2036097"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raz</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think collisions are too subjective to be included as a "thing" within Monkey. <br><br></td></tr></table><br>
<a name="2036105"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Amon</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, similar collisions to blitzmax would be welcome. <br><br></td></tr></table><br>
<a name="2036125"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> IMO there are too many different collision routines to be able to add them to Monkey. Use the right tool for the right job.<br><br>For general use rectangles overlap and circle-to-circle collisions should be fine for "most" games, and they are not hard to use and are very quick. <br><br></td></tr></table><br>
<a name="2036129"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Amon</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Without using a framework like diddy or some other, how would I proceed to having these 2 recommended collision routines placed in a module that can be used much like AutoFit or the delta timer?<br><br>Erm! Yes! I need everyone to do it for me because I am lazy. :) <br><br></td></tr></table><br>
<a name="2036135"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> 2 recommended collision routines <br></div><br>I guess you are talking about rectangles overlap and circle-to-circle(?), these are two very simple functions:<br><br>[monkeycode]Function RectsOverlap:Bool(x1#, y1#, w1#, h1#, x2#, y2#, w2#, h2#)<br>    If x1 &gt; (x2 + w2) Or (x1 + w1) &lt; x2 Then Return False<br>    If y1 &gt; (y2 + h2) Or (y1 + h1) &lt; y2 Then Return False<br>    Return True<br>End[/monkeycode]<br><br>[monkeycode]Function CircleOverlap:Bool(x1#, y1#, r1#, x2#, y2#, r2#)<br>    dx = x1-x2<br>    dy = y1-y2<br>    r = r1+r2<br>    If dx*dx+dy*dy &lt;= r*r Then ' collided<br>       Return True <br>    End<br>    Return False<br>End<br>[/monkeycode] <br><br></td></tr></table><br>
<a name="2036136"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Amon</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Dude! Just tested this and it works a treat! :) <br><br></td></tr></table><br>
<a name="2036141"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> And if you want you can do Circle-to-Rects too:<br><br>[monkeycode]Function CircleRectsOverlap:Bool(x1:Float, y1:Float, w1:Float, h1:Float, cx:Float, cy:Float, r:Float)<br>	Local testX:Float = cx<br>	Local testY:Float = cy<br>	If testX &lt; x1 Then testX = x1<br>	If testX &gt; (x1 + w1) Then testX = (x1 + w1)<br>	If testY &lt; y1 Then testY = y1<br>	If testY &gt; (y1 + h1) Then testY = (y1 + h1)<br>	Return ((cx-testX) * (cx-testX) + (cy-testY) * (cy-testY)) &lt; r * r<br>End<br>[/monkeycode] <br><br></td></tr></table><br>
<a name="2036140"></a>

<a name="2036185"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Amon</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> Lovely! Thanks Dude! <br><br></td></tr></table><br>
<a name="2036250"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nobuyuki</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Samah:   Oh, oops.  I guess I could be doing a comparison without a square root operation, huh? <br><br></td></tr></table><br>
<a name="2036274"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Samah</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> @Nobuyuki Oh, oops. I guess I could be doing a comparison without a square root operation, huh? <br></div><br>Sqrt is eeeeeeeeevil! ;-) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
