<!DOCTYPE html><html lang="en" ><head ><title >Array of objects of a subtype not OK?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Array of objects of a subtype not OK?</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=507" >Monkey Programming</a>/<a href="#bottom" >Array of objects of a subtype not OK?</a><br><br>
<a name="2043145"></a>

<a name="2043146"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tibit</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> This does not work:<br>[monkeycode]<br>Class Shape<br>	<br>End<br><br>Class Circle Extends Shape<br>	<br>End<br><br>Class Camera<br>	<br>	Method New(shapes:Shape[])<br>		Print "Length is " + shapes.Length<br>	End<br>End<br><br>Function Main:Int()<br>	<br>	Local circle1:Circle = New Circle<br>	Local circle2:Circle = New Circle<br><br>	Local test:Camera = New Camera([circle1, circle2]) 'Compile error here: <br>': Error : Unable to find overload for new(Circle[]).<br><br><br>End<br>[/monkeycode]<br><br>Can it be done somehow? Or should I use some kind of list? <br><br>I really liked the idea of auto-arrays like this since it is super handy when setting things up. <br><br></td></tr></table><br>
<a name="2043147"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gerry Quinn</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Seems like it should work, but the compiler is not smart enough to figure it out. <br><br></td></tr></table><br>
<a name="2043149"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tibit</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ah cool!<br><br>I added a bug report in case it is unintended. Hoping for the best. <br><br></td></tr></table><br>
<a name="2043161"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>It's by design, basically to avoid the overhead of having to check the actual type of objects assigned to array elements at runtime.<br><br>It means you can't accidentally do this:<br><br><pre class=code>
Class Shape
End

Class Circle Extends Shape
End

Class Square Extends Shape
End

Function Test( shapes:Shapes[] )
   shapes[0]=New Circle   'perfectly valid code...
   shapes[1]=New Square   'ditto
End

Function Main()
   Test( New Shape[2] )   'OK
   Test( New Circle[2] )  'OOPS! Test will put a Square into our Circle array!
   Test( New Square[2] )  'OOPS2!
End
</pre><br><br>If Monkey allowed Circle[]/Square[] to Shape[] conversions like this, then it'd have to perform a runtime check every time an object was written to Shape[] arrays to make sure the type of the object being written was a subclass of the 'real' type of the array.<br><br>Java and C# actually already do this assignment checking, but emulating it in other languages is harder. Apart from the overhead of the checks, it'd also mean object arrays would have to be 'wrapped' to include some runtime type info, so even all reads would be affected by an extra level of indirection.<br><br>BlitzMax (and probably Blitz3D/BlitzPlus) just ignore this issue, so it's actually possible to put a Square into a Circle[] in those languages! But I decided in Monkey to just prohibit implicit array casting like this and see what happened. So far, people seem to have been able to work around it and the issue seldom comes up... <br><br></td></tr></table><br>
<a name="2043168"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tibit</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I agree it is very rare, never encountered it myself, until I got the idea to use arrays more.<br><br>I fear I might misunderstand the bottom line, however in my case above - would it not just be enough if the auto-declared array [] was assumed to be of the assigning type?<br><br>Local a:= [Circle,Circle2]<br>a is a Circle[], as expected<br><br>Local a:Shape[] = [Circle,Circle2]<br>Here since Circle and Circle2 are shapes - which is what we want, can it not be assumed that the autoArray of two Circles actually is a ShapeArray?<br>Could not this pass runtime? Since Circle &amp; Circle2 will always Inherit from Shape, and that won't change runtime at least.<br><br>I 100% agree with the argument to not do a runtime check every time. And I'm pretty fine with not having type-casting on arrays, but letting those correct auto-created arrays [1,2,2,3] trough would be quite useful I think! <br><br></td></tr></table><br>
<a name="2043194"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> No comment. <br><br></td></tr></table><br>
<a name="2043195"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dmaz</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I say ignore the issue and do it like bmax... let the programer be responsible (a compile warning would be cool though). the "work around" add to much more code for what gain?  and they tend to be a little ugly too. <br><br></td></tr></table><br>
<a name="2043196"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I would not make it like BlitzMax (in fact, I would suggest a BlitzMax fix) as having a parent object into an object array is undesirable. That said, allowing a runtime check would be cool as in C# and Java would be cool, but I'm not sure wich performance costs this will add on other targets. <br><br></td></tr></table><br>
<a name="2043200"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gerry Quinn</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've always disliked that in Java you can't just cast anything to anything like in C++.  But given that it's one of the target languages, it seems like it would be inviting trouble to let Monkey cast freely in ways that would work on some targets and not on others.<br><br>I know muddy is thinking of another issue that came up lately in which functions with side effects are getting discarded by the compiler.  But short of adding C++ code for run-time type checking, which would be a lot of work for a small improvement, I think Mark may have the most pragmatic solution here.  <br><br>I could be wrong - I guess whether things like this come up often depends on your programming style, and run-time polymorphism is not a big part of mine. <br><br></td></tr></table><br>
<a name="2043203"></a>

<a name="2043204"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nope. I'm thinking of the fact that this exact same issue has been raised multiple times already and the various demonstrations that spending effort expressing views here is wasted.<br><br>here: <a href="http://www.monkeycoder.co.nz/Community/posts.php?topic=2879#31930" target="_blank">http://www.monkeycoder.co.nz/Community/posts.php?topic=2879#31930</a> <br><br></td></tr></table><br>
<a name="2043202"></a>

<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
