<!DOCTYPE html><html lang="en" ><head ><title >Forcing all derived classes to implement function</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Forcing all derived classes to implement function</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=507" >Monkey Programming</a>/<a href="#bottom" >Forcing all derived classes to implement function</a><br><br>
<a name="2099525"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Peeling</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> An abstract method declaration forces directly derived classes to implement that method. However, indirectly derived classes are NOT obliged to implement that method:<br><br>Class A<br>  Method X() Abstract<br>End<br><br>Class B Extends A<br>  Method X()<br>  End<br>End<br><br>Class C Extends B<br>  'doesn't need to override X<br>End<br><br>It would be incredibly useful to me if there were a way to force a compile error if C does not provide its own unique declaration of X. I doubt it's possible, but I thought I would ask. <br><br></td></tr></table><br>
<a name="2099527"></a>

<a name="2099530"></a>

<a name="2099531"></a>

<a name="2099532"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Samah</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is the intended functionality of abstract methods.  It only needs to be implemented once in the hierarchy.<br>If you need that functionality, it seems to me that you need to rethink your class structure. <br><br></td></tr></table><br>
<a name="2099550"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Peeling</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't think there's anything wrong with the class structure :)<br><br>I appreciate that 'abstract' is working as intended. It would still be useful to enforce implementation in every class in the hierarchy.<br><br>As a fer-instance, suppose you wanted to implement a simple runtime class identifier method without all the overhead of reflection:<br><br>Method ClassName:String()<br>  Return "TheClassName"<br>End<br><br>It would be nice to poke the user with an error if he forgot to implement ClassName in a derived class.<br><br>My interest in the feature is a bit more involved, but that's the basic idea. <br><br></td></tr></table><br>
<a name="2099558"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gerry Quinn</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> It would be incorrect to force C to override X. because B.X is already available to C so it is unnecessary, <br><br></td></tr></table><br>
<a name="2099561"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Peeling</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Certainly it would be incorrect for the 'abstract' keyword to force C to override X, because 'abstract' already has a well-defined function.<br><br>But there's nothing incorrect about having a keyword (eg 'Unique Abstract' or 'Bespoke') that does force C to override X. It would be very useful in cases where it's vital for all derived classes to implement overrides because the parent class's implementation is guaranteed to be undesirable (as in the 'ClassName' example above) <br><br></td></tr></table><br>
<a name="2099564"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Pharmhaus</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> The only thing you can do is to declare the Method in B abstract again. But this is only useful if B's Method X() is never used by anybody.<br><br><pre class=code>
Class B Extends A
    Method X() Abstract
End
</pre><br><br>If your implementation of B needs X() your only chance is to use the decorator pattern and create a Class D which extends B where you define X() as abstract again.<br>e.g.<br><br><pre class=code>
Class B Extends A
    Method X()
    End
End

Class D Extends B
    Method X() Abstract
End
</pre><br><br>All further classes would use D as a starting point. <br><br></td></tr></table><br>
<a name="2099568"></a>

<a name="2099569"></a>

<a name="2099570"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skid</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I try and avoid ever overriding a concrete class.<br><br>If B and C need to share some logic then consider implementing AA an abstract class derived from A containing the common logic allowing you to avoid deriving a class from a concrete class.<br><br>Take for example the class hierachy in biology. Where instances share common traits there is a class hierarchy (all abstract) that contains all shared stuff so that cats never derive from dogs:<br><br><img src="http://upload.wikimedia.org/wikipedia/commons/thumb/a/a5/Biological_classification_L_Pengo_vflip.svg/150px-Biological_classification_L_Pengo_vflip.svg.png"> <br><br></td></tr></table><br>
<a name="2099578"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Samah</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> @skid: I try and avoid ever overriding a concrete class. <br></div><br>I don't avoid it entirely, I just try to design my class structure in such a way that it's unnecessary.<br>As therevills will attest, I love abstract classes and interfaces.  :)<br>It allows you to encapsulate more code by hiding concrete implementations from developers. <br><br></td></tr></table><br>
<a name="2099588"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Peeling</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks all :)<br><br>Pharmhaus: It's a really clever idea! I think the downside is that it imposes a burden on the user almost as onerous as remembering to override the relevant functions, and there's no way to enforce derivation from AA rather than A.<br><br>Also, while it works for the simple "ClassName" example, in my case there are methods where it is mandatory to both override X *and* have the override call the parent class's X, which your solution would not permit.<br><br>skid: Looking through the code, in most cases non-leaf classes ARE abstract, in practice if not in name. Unfortunately, it's in precisely those exceptional cases where classes are derived from other concrete classes where I need to ensure certain functions are overridden. Not only that, but there are functions with bodies in the abstract classes which must be overridden for things to work properly.<br><br>To give you some idea of one of the things I'm doing: I've created a 'shelvable' interface for templated object pooling. Calling 'Shelve' places the object in a resource pool. However, if you forget to implement "Shelve" the parent class's function will place a derived class in the parent class's resource pool, with hilarious consequences next time it gets pulled out for re-use.<br><br>I've also created an interface for Unity-style instantiation of a hierarchy of objects. Here again, forgetting to override a function will result in craziness: an instance of the parent class will be created in the new hierarchy with the relevant values copied across, rather than the derived class :) <br><br></td></tr></table><br>
<a name="2099587"></a>

<a name="2099583"></a>

<a name="2099595"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Samah</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> @Peeling: To give you some idea of one of the things I'm doing: I've created a 'shelvable' interface for templated object pooling. Calling 'Shelve' places the object in a resource pool. However, if you forget to implement "Shelve" the parent class's function will place a derived class in the parent class's resource pool, with hilarious consequences next time it gets pulled out for re-use. <br></div><br>It sounds more like you need to rethink your pooling implementation.  Perhaps look at the way the BRL Pool and Diddy's DiddyPool classes work. <br><br></td></tr></table><br>
<a name="2099621"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gerry Quinn</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Overriding concrete classes can be useful.  For example, MFC (Microsoft Foundation Classes) were a C++ wrapper for the Windows GUI.  A CWnd object was a basic window, and all controls were derived from it, sometimes with a hierarchy of classes, e.g. a CButton derived from CWnd and was a text button, and a CBitmapButton derived from CButton and had an image. <br><br></td></tr></table><br>
<a name="2099630"></a>

<a name="2099632"></a>

<a name="2099636"></a>

<a name="2099638"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skid</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't think CWnd is a good example.<br><br>IMHO MFC would have been better to keep CWnd abstract and provide a concrete "CWindow" class to avoid all derived classes inheriting methods they don't support such as menu and titlebar controls. <br><br></td></tr></table><br>
<a name="2099627"></a>

<a name="2099667"></a>

<a name="2099668"></a>

<a name="2099669"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Samah</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> @skid: ...to avoid all derived classes inheriting methods they don't support such as menu and titlebar controls <br></div><br>Exactly this.  If your design causes classes to inherit things they don't need, you're doing it wrong.<br><br>Edit: If you find code in Diddy that does this, it's because I was being extremely lazy at the time, not being hypocritical. :)<br>Edit 2: Or, I may have had to retrofit stuff to avoid breaking other people's code. <br><br></td></tr></table><br>
<a name="2099715"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Peeling</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi again,<br><br>I've just looked at diddypool (it wasn't in the diddy in my version of Monkey so I didn't know about it - long story; don't worry about it).<br><br>Correct me if I'm wrong, but it looks as though it's necessary to return objects to the pool thus:<br><br><b>myobjectpool.Free(object)</b><br><br>This is fine if the code freeing up the object knows which pool to put it in. If that isn't the case, you would need to provide a wrapper along these lines:<br><br><b>Class MyClass implements FreeSelfInterface<br><br>  global myPool:DiddyPool&lt;MyClass&gt; = new DiddyPool&lt;MyClass&gt;(100)<br><br>  Method FreeSelf()<br>    myPool.Free(Self)<br>  End<br>    <br>End</b><br><br>Since I'm pooling and instancing hierarchies of objects (imagine a simpler version of Unity scene graphs and components), objects need to be able to pool their children without knowing what type they are, which leaves me back where I am now: if I forget to implement 'FreeSelf', the parent class's implementation will get called. I can mitigate this by keeping FreeSelf abstract wherever possible, but I'm still exposed to the same risk with derivations from concrete classes.<br><br>The pooling system I'm using looks like this:<br><b><br>Class AResourcePool&lt;T&gt;<br><br>	Global shelved:T[]<br>	Global shelvedCount:Int = 0<br>	<br>	Function Allocate:T()<br><i>return either New T() or the top of the shelved array (could use a stack instead)</i><br>	End<br>	<br>	Function Shelve:Bool(t:T)<br><i>Put t on the shelf and call reset</i><br>	End<br><br>End<br><br><br>Class ThingToShelve implements Shelvable<br><br>Method Shelve()<br>   AResourcePool&lt;ThingToShelve&gt;.Shelve(Self)<br>End<br><br>Method Reset()<br><i>reset to defaults</i><br>End<br><br>End</b><br><br>So it's pretty similar, although without all the diddy niceties. There's no need to initialise pools manually; you can just call AResourcePool&lt;Blah&gt;.Allocate() and the compiler takes care of generating the relevant global arrays.<br><br>I don't need to keep track of an array of allocated instances for iterating over, because they're already getting plugged into a scene graph.<br><br>The fact that allocated instances can be GC if Shelve isn't called is... meh. On the one hand it's sloppy and could dilute the efficiency of the pool if it happens a lot. On the other hand it's nice to know that it's impossible for some obscure edge case to result in the pool clogging up with orphaned objects when the game is out in the wild :) <br><br></td></tr></table><br>
<a name="2099714"></a>

<a name="2099713"></a>

<a name="2099712"></a>

<a name="2099717"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImmutableOctet(SKNG)</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Peeling: I'm generally against using globals for this; I consider doing something like this to be bad practice if it's not at least abstracted from such a rough back-end.<br><br>Anyway, I'm definitely for an "Unfinished" keyword, or something to that effect. Personally, I wouldn't mind such a feature, but to tell you the truth, you should probably provide/follow documentation regarding implementation details. For example, "requiring" (More so expecting) an inheriting class to "call up" to their super-class's implementation. This is something I've dealt with before, so it would definitely help keep things neat. The name "Unfinished" (As I used as an example) would probably be misleading, as I think this would need to be a "passive" version of 'Abstract'. My thought is that that kind of feature should allow the implementation to be used if the class it's within isn't abstract. If it is abstract, then I think it should be required to override. Just an idea, I thought I'd bring it up. I'd want it to work like this mainly for constructor-styled behavior. The thing is, this isn't really necessary to me. Sure, it would be nice for specific circumstances, but it's not really something to care about. This is really an implementation detail that your own standards or documentation should comment upon. You can't really blame a class for not overriding/displaying what its name is, you can only discourage misleading implementations.<br><br>Also, your idea of providing a problematic implementation, then forcing inheriting classes to re-implement it anyway, is backwards to me. Shouldn't you have a separate method containing such a "faulty" implementation? Or better yet, split it into several methods, then leave usage up to the user. I don't see why you can't make the method abstract, then provide the tools to implement it. <br><br></td></tr></table><br>
<a name="2099722"></a>

<a name="2099723"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Peeling</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> @ImmutableOctet: I can understand not wanting to use globals, but here's the problem:<br><br>1. I have to be able to pool objects without knowing what type they are, therefore:<br>2. The object has to be able to pool itself, which means it has to have access to the pool, which means either:<br>   a global in the AResourcePool<br>  OR<br>   a global in the pooled class<br>  OR<br>   a field in the pooled class that has to be set up every time it is instanced.<br><br>At which point, you have to ask: where is the code calling thePool.Allocate() getting thePool from?<br><br>It's just pushing the sprout around the plate and you end up eating it anyway :)<br><br>As to the "unfinished" keyword - absolutely. It's a 'nice to have in a specific circumstances' only; that's why I was asking if there was such a thing, not FOR it :)<br><br>The last point, about an implementation being problematic but needing to be called anyway - I HAVE gone back and tidied that up, because it was just too ugly. I've split it thus:<br><br>Method MustBeImplementedInEveryDerivedClass()<br>   <i>do the class-specific thing that would break everything if the super class version were called</i><br>    MustBeCalledOnSuperclass()<br>End<br><br>Method MustBeCalledOnSuperclass()<br>   Super.MustBeCalledOnSuperclass()<br>End<br><br>This makes 'MustBeCalledOnSuperclass' optional, which is good if it doesn't need to do anything important. <br><br></td></tr></table><br>
<a name="2099719"></a>

<a name="2099740"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Samah</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> To me this is all stuff that's completely unnecessary with good design.  I've been trying to think of an easier way to implement your solution, but I'm starting to think it's just the wrong way to go about it.<br><br><div class="quote"> @Peeling: It's just pushing the sprout around the plate and you end up eating it anyway :) <br></div><br>I've never heard this phrase before.  The problem is that I'd end up just feeding the sprout to the dog. :) <br><br></td></tr></table><br>
<a name="2099798"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Peeling</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Believe me, I'm under no illusions about the shortcomings of my implementation. But given what it has to do - provide an extensible scene-graph hierarchy supporting abstract pooling and deep cloning in a GC language, I suspect it might be the worst way of doing it apart from all the others, to paraphrase Churchill :) I'm open to suggestions, though.<br><br>I've worked with other scene-graph library source in the past, code that really went out of its way to do things properly, and as a result only two or three people in the company actually understood it well enough to extend its functionality. It also took the original author - who left the company - two years to write, and the 'simple' class declarations were underpinned by layer upon layer of opaque macros. By comparison, the mental load of "Don't forget these three mostly-boilerplate methods" doesn't seem all that onerous. It's not something I'd release as a Monkey library by any means, but I think it meets our needs (factoring in learning curve, dev time, performance on mobile devices etc) appropriately. <br><br></td></tr></table><br>
<a name="2099797"></a>

<a name="2099786"></a>

<a name="2099838"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gerry Quinn</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> In practice, I never had problems due to trying to use a menu in CButton or some such thing.  It's hard to imagine a scenario where one would accidentally do this, or when the head-scratching when it doesn't work is going to be worse than the head-scratching about why one tried to do it in the first place.<br><br>Sometimes the best can be the enemy of the good.<br><br>I think the sin we (probably) all commit of writing really horrible code just to get something up and running can lead to us trying too hard to polish our libraries, even if they are probably not really for the generations anyway. <br><br></td></tr></table><br>
<a name="2099837"></a>

<a name="2099836"></a>

<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
