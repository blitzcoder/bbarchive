<!DOCTYPE html><html lang="en" ><head ><title >Creating the Ultimate Monkey Performance Test?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Creating the Ultimate Monkey Performance Test?</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=507" >Monkey Programming</a>/<a href="#bottom" >Creating the Ultimate Monkey Performance Test?</a><br><br>
<a name="2032186"></a>

<a name="2032187"></a>

<a name="2032188"></a>

<a name="2032189"></a>

<a name="2032190"></a>

<a name="2032191"></a>

<a name="2032192"></a>

<a name="2032193"></a>

<a name="2032194"></a>

<a name="2032195"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tibit</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I feel that at times even the simplest of games can has low FPS in Monkey, or more importantly "spikes" or some kind of sloppiness.<br><br>Notice I used the word <i>"feel"</i>. Might to a big degree be html5 related.<br><br>I want to have facts that answers <b>WHY</b>. <br><br>If there is anyone who manage to create awesome looking high performance 2D games in on targets that Monkey translate too then should not Monkey come very close in terms of performance?<br><br>There are things we cannot change like Hardware &amp; Browers, but we can still measure and compare - the factor we can change is the <b>programming</b>.<br><br>Because Monkey Translates code I can just not buy the "excuse" that Monkey code is worse off - should it not be just as good (or close to) as native code?<br><br>If the "Error" lies in the programmer then I'd love to hear what should be done and what should not be done. I.e. What factors should we look at.<br><br><b>Creating Performance Tests</b><br>I suggest that to find the answer we can create a suit of performance tests.<br><br>Is there a good series of tests can be created to test important performance factors?<br><br>Performance usually goes hand-in-hand with quality - so there needs to be tests for common effects as well. (The only one I can think of is gradual png transparency)<br><br>Creating tests is not as simple as it sounds - we need to find and test factors that matters to gameplay - and be able to measure the point of slowdown or the point when spikes start to occur.<br><br><b>Threads &amp; Links</b><br>Example of a Test: <a href="http://seb.ly/demos/bunnybench/bunnies_canvas.html" target="_blank">The Bunny Test (html5)</a><br>Source Code of Bunny Test on Flash <a href="http://www.iainlobb.com/bunnies/BUNNYMARK.zip" target="_blank">here</a> <br>More info at his <a href="http://blog.iainlobb.com/search?q=bunny" target="_blank">Blog</a>.<br><br>Awesome thread on performance on html5 <a href="http://www.monkeycoder.co.nz/Community/posts.php?topic=1164" target="_blank">here</a><br><br>Nice looking Html5 game with awesome performance: <a href="http://www.phoboslab.org/xtype/" target="_blank">X Type </a> <br>More info in this <a href="http://www.monkeycoder.co.nz/Community/posts.php?topic=3119" target="_blank">monkey thread</a>. They used this <a href="http://impactjs.com/" target="_blank">engine</a> <br><br><b>The main question is, how could such test look like?</b> <br>* Is the bunny test good? <br>* What does it measure?<br>* Any Monkey specific issues?<br>* Any Target specific issues to test or deal with?<br>* Is it "all" about graphics?<br>* What about garbage collection? <br><br></td></tr></table><br>
<a name="2032185"></a>

<a name="2032184"></a>

<a name="2032182"></a>

<a name="2032183"></a>

<a name="2032181"></a>

<a name="2032180"></a>

<a name="2032199"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paul - Taiphoz</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think look at some of the existing bench marking tools, they dont just throw inert objects at the screen they run full physics on a lot of them, just throwing art about is not that big a deal but having objects interact in some way is in terms of cpu time.<br><br>so yeah. make those bunnies bounce off each other, or make them bounce off of something else like a wall or ball the user can move, or that moves around on its own. <br><br></td></tr></table><br>
<a name="2032213"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >matty</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've had no problems with Monkey performance on Android (using Monkey ver 42 - using canvas not GL) as long as the app is written well...I've written a bunch of games for both flash and android with Monkey and performance seems fine.  Using a good approach to managing object creation and removal seems to be the key, as well as the algorithms you choose.<br><br><br>EDIT - what would be the key I think....<br><br>use Arrays of objects rather than lists...choose your algorithms wisely - design well at the outset, ?? <br><br></td></tr></table><br>
<a name="2032212"></a>

<a name="2032214"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paul - Taiphoz</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> do lists really have that much more overhead and if so it might be an idea the write a fake list routine that actually uses arrays while giving you the functionality of a list. <br><br></td></tr></table><br>
<a name="2032226"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> do lists really have that much more overhead  <br></div><br>For Android - Yes!<br><br><div class="quote"> if so it might be an idea the write a fake list routine  <br></div><br>Check out Diddy's ArrayList.<br><br>For "fun" I quickly converted the Bunny demo to Monkey:<br>[monkeycode]Strict<br> <br>Import mojo<br> <br>Function Main:Int()<br>	New MyGame()<br>    Return 0<br>End<br> <br>Class MyGame Extends App<br>	Field numBunnies:Int = 3000<br>	Field gravity:Float = 3<br>	Field bunnies:List&lt;Bunny&gt;<br>	Field maxX:Int = 640<br>	Field minX:Int = 0<br>	Field maxY:Int = 480<br>	Field minY:Int = 0<br>	Field bitmap:Image<br>	Field fpsRate:Int = 30<br><br>	Method OnCreate:Int()<br>		SetUpdateRate(fpsRate)<br><br>		bitmap = LoadImage("wabbit_alpha.png")<br>		<br>		bunnies = New List&lt;Bunny&gt;<br>		Local bunny:Bunny<br>		<br>		For Local i:Int = 0 Until numBunnies<br>			bunny = New Bunny<br>			bunny.image = bitmap<br>			bunny.speedX = Rnd() * 10<br>			bunny.speedY = (Rnd() * 10) - 5<br>				<br>			bunnies.AddLast(bunny)<br>		Next<br>		<br>		Return 0<br>	End<br>    <br>	Method OnUpdate:Int()<br>		For Local bunny:Bunny = Eachin bunnies<br>			bunny.x += bunny.speedX<br>			bunny.y += bunny.speedY<br>			bunny.speedY += gravity<br>			<br>			If bunny.x &gt; maxX<br>				bunny.speedX *= -1<br>				bunny.x = maxX<br>			Else If (bunny.x &lt; minX)<br>				bunny.speedX *= -1<br>				bunny.x = minX<br>			End<br>		<br>			If bunny.y &gt; maxY<br>				bunny.speedY *= -0.8<br>				bunny.y = maxY<br>				If Rnd() &gt; 0.5<br>					bunny.speedY -= Rnd() * 12<br>				End<br>			Else If (bunny.y &lt; minY)<br>				bunny.speedY = 0<br>				bunny.y = minY<br>			End<br>			<br>			bunny.posX = bunny.x<br>			bunny.posY = bunny.y + bunny.z<br>		Next<br>		<br>		If KeyHit(KEY_LEFT)<br>			fpsRate-=5<br>			SetUpdateRate(fpsRate)<br>		End<br>		If KeyHit(KEY_RIGHT)<br>			fpsRate+=5<br>			SetUpdateRate(fpsRate)<br>		End		<br>		Return 0<br>	End<br><br>	Method OnRender:Int()<br>		FPSCounter.Update()<br>		Cls<br>		For Local b:Bunny = Eachin bunnies<br>			DrawImage(b.image, b.posX, b.posY)<br>		Next<br>		FPSCounter.Draw(0,0)<br>		DrawText("FPS Rate: "+fpsRate, 0, 10)<br>		Return 0<br>	End<br>End<br><br>Class Bunny<br>	Field speedX:Float = 0<br>	Field speedY:Float = 0<br>	Field speedZ:Float = 0<br>	Field image:Image<br>	Field x:Float = 0<br>	Field y:Float = 0<br>	Field z:Float = 0<br>	Field posX:Float = 0<br>	Field posY:Float = 0<br>	Field angle:Float = 0<br>	Field speed:Float = 0<br>End<br><br>Class FPSCounter Abstract<br>	Global fpsCount:Int<br>	Global startTime:Int<br>	Global totalFPS:Int<br><br>	Function Update:Void()<br>		If Millisecs() - startTime &gt;= 1000<br>			totalFPS = fpsCount<br>			fpsCount = 0<br>			startTime = Millisecs()<br>		Else<br>			fpsCount+=1<br>		End<br>	End<br><br>	Function Draw:Void(x% = 0, y% = 0, ax# = 0, ay# = 0)<br>		DrawText("FPS: " + totalFPS, x, y, ax, ay)<br>	End<br>End[/monkeycode]<br><br>HTML5 Demo: <a href="http://www.therevillsgames.com/monkey/bunnies/bunniesHTML.html" target="_blank">http://www.therevillsgames.com/monkey/bunnies/bunniesHTML.html</a><br><br>Flash Demo: <a href="http://www.therevillsgames.com/monkey/bunnies/bunnyFlash.html" target="_blank">http://www.therevillsgames.com/monkey/bunnies/bunnyFlash.html</a><br><br>Press Left/Right to change the FPS Rate.<br><br>Using Chrome:<br><br>FPS Rate at 30:<br>HTML5 - 20FPS<br>Flash - 29FPS<br><br>FPS Rate at 60:<br>HTML5 - 19FPS<br>Flash - 51FPS <br><br></td></tr></table><br>
<a name="2032221"></a>

<a name="2032215"></a>

<a name="2032216"></a>

<a name="2032217"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paul - Taiphoz</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> 28 fps @ 60 rate on html<br>and 60 fps @ 60 rate on flahs<br><br>thats the first time I have seen something run faster on flash than html. <br><br></td></tr></table><br>
<a name="2032222"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Strange I always see Flash out perform HTML5... <br><br></td></tr></table><br>
<a name="2032223"></a>

<a name="2032224"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AdamRedwoods</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Bunny  monkey html5 example runs 2 fps on ipad1. 1 fps on new Chrome browser for ipad1.<br>1 fps on Galaxy tab 7.<br><br>Bunny original runs 5 fps on chrome browser. <br><br></td></tr></table><br>
<a name="2032227"></a>

<a name="2032228"></a>

<a name="2032229"></a>

<a name="2032230"></a>

<a name="2032231"></a>

<a name="2032232"></a>

<a name="2032233"></a>

<a name="2032234"></a>

<a name="2032236"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Opps I had 6000 bunnies, there should have only been 3000 (changed now)...<br><br>HTML5 Demo: <a href="http://www.therevillsgames.com/monkey/bunnies/bunniesHTML.html" target="_blank">http://www.therevillsgames.com/monkey/bunnies/bunniesHTML.html</a><br>Flash Demo: <a href="http://www.therevillsgames.com/monkey/bunnies/bunnyFlash.html" target="_blank">http://www.therevillsgames.com/monkey/bunnies/bunnyFlash.html</a><br><br>(Press Left/Right to change the FPS Rate)<br><br>Using Chrome:<br><br>FPS Rate at 30:<br>HTML5 - 30FPS<br>Flash - 30FPS<br><br>FPS Rate at 60:<br>HTML5 - 42FPS<br>Flash - 59FPS<br><br><a href="http://seb.ly/demos/bunnybench/bunnies_canvas.html" target="_blank">Bunny original</a> runs around 50FPS... it <b>hops</b> around a lot (45-52FPS) ;) <br><br></td></tr></table><br>
<a name="2032225"></a>

<a name="2032235"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AdamRedwoods</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Also try adding the (X or $00) trick to speed it up a bit. <br><br></td></tr></table><br>
<a name="2032237"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry, what trick? <br><br></td></tr></table><br>
<a name="2032238"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AdamRedwoods</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="http://www.monkeycoder.co.nz/Community/posts.php?topic=1164" target="_blank">http://www.monkeycoder.co.nz/Community/posts.php?topic=1164</a> <br><br></td></tr></table><br>
<a name="2032239"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shinkiro1</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> The trick is this: Replace on line ~85 the DrawImage part with this:<br>[monkeycode]DrawImage(b.image, ~~(0.5+b.posX), ~~(0.5+b.posY))[/monkeycode]<br>It practically converts the position to an int (and is much faster that using Int(number) )<br><br>The results are amazing (all fps are maximum achieved fps)<br>Safari before hack: 39 fps<br>Safari with hack: 86 fps<br><br>Firefox without hack: 16 fps<br>Firefox with hack: 51 fps<br><br>Interestingly Chrome doesn't seem to care. It stays at 39 fps. <br><br></td></tr></table><br>
<a name="2032240"></a>

<a name="2032241"></a>

<a name="2032242"></a>

<a name="2032243"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yep, just tested it myself - I added this to Mojo's DrawSurface and DrawSurface2:<br>[monkeycode]x = (x + .5) | 0;<br>y = (y + .5) | 0;[/monkeycode]<br>Results:<br><pre class=code>
Browser | Version  | FPS Rate | FPS
--------|----------+----------+-----
 IE9    | Mojo     |       30 |  23
        |          |       60 |  20
        | Hack     |       30 |  30
        |          |       60 |  <u>50</u>
--------|----------+----------+-----
 Chrome | Mojo     |       30 |  29
        |          |       60 |  42
        | Hack     |       30 |  29
        |          |       60 |  41
--------|----------+----------+-----
 FF(13) | Mojo     |       30 |  29
        |          |       60 |  58
        | Hack     |       30 |  30
        |          |       60 |  59

</pre><br>Mojo Version: <a href="http://www.therevillsgames.com/monkey/bunnies/bunniesHTML.html" target="_blank">http://www.therevillsgames.com/monkey/bunnies/bunniesHTML.html</a><br>Hack Version: <a href="http://www.therevillsgames.com/monkey/bunnies/bunnyHTML5.html" target="_blank">http://www.therevillsgames.com/monkey/bunnies/bunnyHTML5.html</a><br><br>From my results the "hack" really helps IE. <br><br></td></tr></table><br>
<a name="2032244"></a>

<a name="2032245"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raz</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> It kind of feels like the only think I go on about on these forums. But if the app you are creating creates garbage, there will be performance issues.<br><br>I found this out when dealing with the Xbox, but I've recently started messing around with Android and while not to the same extent, it is still an issue.<br><br>It seems to me that lists and maps that are iterated through during game time (as in during the level, not during the init) are really not suitable for most targets (because of the garbage creation). On PC it isn't a problem because the GC is so quick but everywhere else, it seems to be a problem.<br><br>Originally I had assumed that if this functionality was available it meant it had been suitably tested. But really I don't think it has (yet). That is: I don't think there's any suitable advice on when you can use such things.<br><br>I stick to arrays (and will be giving ArrayLists a proper look now!), because it's the only way I can iterate without junk.<br><br><div class="quote"> DrawImage(b.image, ~~(0.5+b.posX), ~~(0.5+b.posY)) <br></div><br>This is amazing :) I use Int() for practically every draw command so this I hope will really help.<br><br>Just to be clear though, I love Monkey and am really thankful to have it! <br><br></td></tr></table><br>
<a name="2032250"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shinkiro1</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> @raz<br>Also try therevills version (post #14) as it may even be faster. But I think they should be about the same speed, but more importantly they are much faster than casting to int. <br><br></td></tr></table><br>
<a name="2032252"></a>

<a name="2032253"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Skn3</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Raz,<br><br>Yeah I have even passed on your garbage message to some people! You could say I am a disciple? hah!<br><br>Have you tried iterating over lists manually instead of foreach?<br>(blitzmax: <a href="http://www.blitzbasic.com/Community/posts.php?topic=97352" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=97352</a> )<br><br>I converted to this method in Objecty half way through development and it has definitely improved performance! <br><br></td></tr></table><br>
<a name="2032254"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Performance statements are useless without clear definition of platform and timings.<br><br>Casting to Int in Monkey converts to "((float_val)|0);" in javascript. Is that somehow massively slower than "~~"? Even if it is, how would that relate to the C++ translation, C#, Java or AS3? <br><br>How does any of it actually relate to real usage in a game? Do you seriously think that the issue revealed by the bunnies test is about the cost of converting from a float to an int and not about the underlying rendering engine? <br><br></td></tr></table><br>
<a name="2032258"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shinkiro1</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Html for now, can't use the gpu for floats and that is the reason why ints are faster (from what I've understood).<br>For all other targets you are right, it might be useless. As soon as you have a gpu that can handle floats the advantage of the above method is gone. <br><br></td></tr></table><br>
<a name="2032259"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> You're missing the point. The performance advantage has nothing to do with the cost of converting to an Int, it's just to do with passing an Int to the renderer. Int(float_val+0.5) or your ~~(float_val+0.5) is irrelevant. <br><br></td></tr></table><br>
<a name="2032260"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raz</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> muddy_shoes : I would say it isn't the most substantial issue but clearly it has an impact to Monkey as it is now. Is it acceptable though? Not really. I agree that the "fix" needs to be Monkey base code, not our code. <br><br></td></tr></table><br>
<a name="2032262"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> Chris, I could disagree with people in this thread all day, but if you're not going to replace your int casts on the basis of what's been said then my work is done. <br><br></td></tr></table><br>
<a name="2032263"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raz</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> Skn3 : It's all about the garbage :D<br><br>Muddy_shoes : While as a general fix for all targets it wouldn't be worth it. Does the above example not prove that it's worth having when targeting HTML5 (for Monkey as it is now)? <br><br></td></tr></table><br>
<a name="2032264"></a>

<a name="2032265"></a>

<a name="2032266"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> Which point of view would you rather take? <br><br>If you expect Monkey to protect you from all external forces, then yes. Except it doesn't and couldn't.<br><br>If you want Monkey to support low-level games performance coding then it can't and doesn't.<br><br>In the specific example we're talking about, the difference is due to Javascript engine programming, not Monkey. <br><br></td></tr></table><br>
<a name="2032267"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm with muddy_shoes here. Also, optimizing in order to get better performance on a given browser is not a good idea as all related to html5 is still being heavily optimized on browsers. <br><br></td></tr></table><br>
<a name="2032269"></a>

<a name="2032270"></a>

<a name="2032271"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Skn3</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> I agree too in the long run, it would be nice to have a perfect system that requires only one way of doing things. When it comes to anything running directly in a browser sometimes you are forced to do browser specific optimisation! In the 5 years I did web design/development professionally there was not one site/system I worked on that <i>didn't</i> require some type of browser specific code.<br><br>Just something to bear in mind. <br><br></td></tr></table><br>
<a name="2032274"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> was the flash example compiled with mojo image filtering disabled?<br><br>tested on firefox on linux:<br><br><br>original bunny example<br>no pixel snapping 1FPS<br>pixel snapping 4FPS<br><br>monkeymojo version 1FPS<br>monkeyhack html5 version  2FPS<br><br>monkey flash version 8-10FPS <br><br></td></tr></table><br>
<a name="2032272"></a>

<a name="2032276"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paul - Taiphoz</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think that ANY method of speeding up FPS and performance over all can never be irrelevant, even if it is only one a specific target, or browser, it's still a performance boost and something that does in some situations have value, it would not be the first time I have seen a flash game, or html 5 game that asks nicely , please use FireFox, or please use IE because I assume they have done something similar, and have some enhancement in that browser.<br><br>I think I agree as well that with HTML5 there is such a wide range of results between the different browsers, it will take a little time for it all to settle down and become more standard, which I believe it will in a few months or a years time.<br><br>So. basically, keep this discussion going, keep talking about ways to speed up the performance of our code, because it can only help the community in the long run. <br><br></td></tr></table><br>
<a name="2032283"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gerry Quinn</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> Any time I look I find Flash crushes HTML5 for speed at the moment.<br><br>As for Monkey, it has an added level of indirection from translating to the target languages, so it can be expected to be a little bit slower than code written in the targets.  On the bright side, I suspect that the overhead in translating to Java or Actionscript in particular is very low. It is higher for C++, but then the compiler makes C++ into blindingly fast code, so the end result outpaces anything else.  For Javascript I don't know - I reckon this will always be the slowest but there are so many things making HTML5 slow that this is just one extra. <br><br></td></tr></table><br>
<a name="2032285"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AdamRedwoods</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't know if HTML5 will ever be ideal for games. Has the sound issue been cleared up yet? And the performance is vastly different on mobile since they are not tapping the GPU (except in iPhone5).<br><br>NaCl would be the next step:<br><a href="https://developers.google.com/native-client/" target="_blank">https://developers.google.com/native-client/</a> <br><br></td></tr></table><br>
<a name="2032293"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tibit</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> Awesome discussion :)<br><br>@therevills - Nice!<br><br>Well the Bunny Test Runs really good for me.<br><br>So I'll recap a little. <br><br><b>Performance Factors:</b><br>* <b>Creating objects at runtime</b> - results in garbage which on some platforms may cause lag -- seems this is a big issue on Android, Xbox and html5 in particular<br>* <b>To avoid Garbage</b> - DO NOT use any Monkey standard collections like, List, Map or iterate using EachIn - instead use Arrays or DiddyCollections<br>* <b>Precreate Shots/particles</b> - Objects can be created at level start/game start and then be reused using a push/pop system<br>* There are a few <b>hacks</b> that can increase performance on html5 in particular, required mojo modification - I assume this will be added to mojo in an future update. See below: [monkeycode]'Add this to Mojo's DrawSurface and DrawSurface2:<br>x = (x + .5) | 0;<br>y = (y + .5) | 0;[/monkeycode]Thanks to therevills for testing!<br>* <b>Mobile CPU Limits</b> - Obvious performance tip is to make sure Physics, Collision, Logic, AI and such are optimized based on your specific game play. Ex: Do not check all bullets against all bullets if you do not have too! (However in this regard Monkey should be no different from any other language or engine)<br>* <b>Prioritize optimization</b> - Some optimization factors only apply to one or a few targets, only do such optimizations on targets you plan to release too. Also depending on your game and gameplay, optimizing certain factors such as object creation might be a waste of time. <br><br><b>Questions Remaining</b><br>* <b>Image-maps</b> - How big effect does <b>image-maps</b> have? Do we need them? When do we need them? Performance Difference? What Monkey options are there for image-maps atm? What are there pros/cons?<br>* <b>Loading times</b> - Short loading times is important on both web and mobile. What can be done to reduce them? (Monkey req you to load a lot at App start for example)<br>* <b>Casting</b> - Should we avoid Casting extensively in runtime?<br>* <b>Finding more factors..</b> - What more to consider? Target specific? Monkey specific? <br><br></td></tr></table><br>
<a name="2032292"></a>

<a name="2032291"></a>

<a name="2032290"></a>

<a name="2032289"></a>

<a name="2032297"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raz</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#32">[#32]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I'm with muddy_shoes here. Also, optimizing in order to get better performance on a given browser is not a good idea as all related to html5 is still being heavily optimized on browsers.  <br></div><br><br>To be clear, I agree we shouldn't target specific browsers, but I don't see what's so bad about implementing something that shows it improves monkey's performance on most browsers and at the very least doesn't reduce it on any. <br><br></td></tr></table><br>
<a name="2032296"></a>

<a name="2032317"></a>

<a name="2032318"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#33">[#33]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Image-maps <br></div><br>Using a sprite altas is so much faster as the sprite(s) only share the one image.<br><br><div class="quote"> Casting <br></div><br>Casting should be okay, its boxing you should be careful with. Muddy did an excellent blog post of this: <a href="http://pointlessdiversions.blogspot.co.nz/2012/03/monkey-tip-be-careful-around-unboxing.html" target="_blank">http://pointlessdiversions.blogspot.co.nz/2012/03/monkey-tip-be-careful-around-unboxing.html</a> <br><br></td></tr></table><br>
<a name="2032324"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#34">[#34]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I don't see what's so bad about implementing something that shows it improves monkey's performance on most browsers and at the very least doesn't reduce it on any <br></div><br><br>I didn't say it was bad, although it's an open question whether it is "harmless". Do fractional pixel positions result in smoothing? If so then is it certain that no game would ever want that feature?<br><br>What I was reacting to was the usual result of people searching for performance "tricks" which is that they end up grabbing at easy answers that are wrong. Casting to Int isn't a performance boost on other platforms and ~~ rather than Int() _is_ irrelevant when the issue is actually the rendering speed resulting from using integer positions. It's even more irrelevant when the fact is that Int() is faster than ~~. To pluck the idea from this that you should change all the Int casts in your code is a classic example of how people waste their time on "optimisations" that have no basis in reality. <br><br></td></tr></table><br>
<a name="2032336"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raz</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#35">[#35]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ahh right ok I see. I got the impression from this thread that all draw commands to HTML5 were rounded to Int coordinates anyway.<br><br><div class="quote"> It's even more irrelevant when the fact is that Int() is faster than ~~. <br></div><br> I assumed from the above that ~~ is shown to be faster than Int() for HTML5  though? I suppose I really should check these things out for myself. <br><br></td></tr></table><br>
<a name="2032344"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shinkiro1</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#36">[#36]</a></td></tr></table></td></tr><tr ><td class="posttext"> I would suggest against this 'hack' going in the official monkey version because, as muddy_shoes mentioned, what if someone wants to have pixel smoothing?<br><br>@muddy_shoes<br><div class="quote"> It's even more irrelevant when the fact is that Int() is faster than ~~.  <br></div><br>My test's resulted that when I used Int() conversion the framerate stayed the same as with floats.<br>But I think I know what you are up to. People tend to believe that some 'magic code' will somehow improve performance not really knowing what happens behind the curtains and using absurd test cases. <br><br>Still, at this moment, if you don't need pixel smoothing, I see no reason why not to use this little trick on HTML5.<br>It would also be interesting to know if this hack scales, so when adding other components typically found in a game, if the version with the hack will still be that much faster (in %). <br><br></td></tr></table><br>
<a name="2032359"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gerry Quinn</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#37">[#37]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think you should put the int conversion in your own code rather than in mojo.  it seems to me that there are quite probable situations when you would want to use it on some images and not others.  For example, spaceship sprites might prefer to use ints for various reasons (not just speed but lack of blurring), but if they are moving on a scaled background, the background might well look better with floats. <br><br></td></tr></table><br>
<a name="2032376"></a>

<a name="2032377"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#38">[#38]</a></td></tr></table></td></tr><tr ><td class="posttext"> the ~~ trick should be official, enabled with mojo image filtering disabled<br><br>it has exactly the same graphical effect as the flash version <br><br></td></tr></table><br>
<a name="2032389"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tibit</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#39">[#39]</a></td></tr></table></td></tr><tr ><td class="posttext"> @muddy_shoes - Awesome article on Boxing!<br><br>I can strongly recommend this article for those working on performance and reducing the number of objects created: <a href="http://pointlessdiversions.blogspot.co.nz/2012/03/monkey-tip-be-careful-around-unboxing.html" target="_blank">Monkey Tips Be Careful Around Unboxing</a> <br><br></td></tr></table><br>
<a name="2032393"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tibit</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#40">[#40]</a></td></tr></table></td></tr><tr ><td class="posttext"> From muddy_shoes <a href="http://pointlessdiversions.blogspot.co.nz/2012/06/monkeys-garbage-collection-on-ios.html" target="_blank">Blog</a>:<br><div class="quote"> On iOS that doesn't matter because you pay for every object you have live. What that means is that object pooling or caching strategies will benefit you on Android and actively work against you on iOS <br></div><br>That explains a lot! iOS Lag has less to do with garbage from NEW objects and a lot more to do with Monkey's garbage checking process for live objects!<br><br>So on iOS it seems one needs to reduce the number of objects TOTAL, not the number of objects created in runtime.<br><br>Any more suggestions on how to work with that? <br><br></td></tr></table><br>
<a name="2032392"></a>

<a name="2032391"></a>

<a name="2032399"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#41">[#41]</a></td></tr></table></td></tr><tr ><td class="posttext"> The first question when considering performance issues is "Do you actually have a performance issue?". Fast enough is fast enough. Many games are not going to use large numbers of objects and will never see the iOS GC causing a problem. If your framerate isn't lower than you want then just get on with writing your game and stop worrying about optimisation.<br><br>If there is a performance issue then you move onto the second question: "Where is the time going?". If you don't know how to use a profiler on your target platform then now is a good time to learn. In this case we can assume that you've seen the gc_mark process eating a lot of time so we know that is the culprit.<br><br>As I wrote in the blog post, your choices are now to either reduce your object count or to change the GC.<br><br>It might be that you're in the fortunate position where nearly all your objects are in just a few sub-systems: particles, gamemap etc. You could then maybe change those systems so that they are based on arrays of primitives rather than objects. It's possible that this will be faster across the board (haven't tested so I don't know if it actually plays out that way) and resolve your iOS GC problems.<br><br>On the other hand, your objects might be more spread throughout your code and not so easy to change. In that case warming up your C++ muscles and tinkering with the GC implementation is probably the better option. <br><br></td></tr></table><br>
<a name="2032416"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jesse</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#42">[#42]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br> In that case warming up your C++ muscles...<br> <br></div><br><br>hahaha very funny. <br><br></td></tr></table><br>
<a name="2032439"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#43">[#43]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> On iOS that doesn't matter because you pay for every object you have live. What that means is that object pooling or caching strategies will benefit you on Android and actively work against you on iOS  <br></div><br><br>is this true for both methods of GC?<br><br>(the methods that you can choose in the config file) <br><br></td></tr></table><br>
<a name="2032445"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tibit</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#44">[#44]</a></td></tr></table></td></tr><tr ><td class="posttext"> I did not know you could choose GC actually. Any more info on that? Is it in the docs? <br><br></td></tr></table><br>
<a name="2032447"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#45">[#45]</a></td></tr></table></td></tr><tr ><td class="posttext"> its on the bottom of the page here:<br><a href="http://blitz-wiki.appspot.com/Monkey_Config_settings" target="_blank">http://blitz-wiki.appspot.com/Monkey_Config_settings</a> <br><br></td></tr></table><br>
<a name="2032449"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#46">[#46]</a></td></tr></table></td></tr><tr ><td class="posttext"> I non-incremental GC is worse because it tries to deal with all the objects on every frame. The incremental version spreads the marking phase over several frames. <br><br></td></tr></table><br>
<a name="2068555"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >David Casual Box</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#47">[#47]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi there. This is a very old post but I used it to create my own performance test code. I just added some flags to enable: alpha, setcolor and rotation.<br><br>My result:<br>- Drawing images with the simple prototype "drawimage image,x,y" is much faster than the extended prototype "drawimage, image,x,y, rotation, scalex,scaley,frame". Even if rotation and scale is 0,1,1...<br>- On Mac OS X, Safari is slow and Firefox is awful. Chrome is amazing.<br>- SetColor is forbidden with HTML5 (for those who did not know :))<br>- Something amazing with Safari: use of an alpha &lt; 1 is faster (almost x2 !). So, using SetAlpha(0.99) will double the performances compared to SetAlpha(1)... Weird!!<br><br>I'm going to test this app on a Smart TV soon, that's why I'm preparing the code, wait and see... <br><br></td></tr></table><br>
<a name="2068593"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >programmer</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#48">[#48]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I'm going to test this app on a Smart TV soon, that's why I'm preparing the code, wait and see...  <br></div> SmartTVs are VERY slow. My LG Smart TV 2012 is only able to clean canvas 1280x720 at 2 fps:<br><a href="http://imgur.com/XOyVt9x" target="_blank">http://imgur.com/XOyVt9x</a> <br><br></td></tr></table><br>
<a name="2068733"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >David Casual Box</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#49">[#49]</a></td></tr></table></td></tr><tr ><td class="posttext"> Argggg! <br><br></td></tr></table><br>
<a name="2068736"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >programmer</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#50">[#50]</a></td></tr></table></td></tr><tr ><td class="posttext"> @David Casual Box<br>Will you share the source code of your benchmark? <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
