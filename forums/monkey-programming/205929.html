<!DOCTYPE html><html lang="en" ><head ><title >Math help..</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Math help..</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=507" >Monkey Programming</a>/<a href="#bottom" >Math help..</a><br><br>
<a name="2067648"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paul - Taiphoz</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here is the basic theory, I have a ball moving fast enough that it's current position and then next position are far enough apart that the ball will step over the object of interest.<br><br>The solution I am planning to use is to use Circle to Line intersection to see if the a line drawn from the balls current position to the balls new position intersects with any objects of interest.<br><br>As per the diagram bellow.<br><br><img src="https://dl.dropboxusercontent.com/u/56777267/Art/linecol.png"><br><br>I plan to use 3 lines, one from each side of the ball, points A and B, so my plan is take the center of the ball, get the angle to the balls next position, then use this +/- 90 and push out ball radius to get the x,y of points A and B, then repeat that for the balls new position and I should have the A starting x,y and ending x,y to run my line intersection test on.<br><br>I am wondering if anyone has a better math formula for getting points A,B something better than my method ?<br><br>When an intersection is detected, my plan to get the balls collision position is to use the third lines collision point and then push the ball back until its distance from the object of interest is equal to both their radius.<br><br>So basically just wondering if my approach to this is sound, or if there is a better mathematical way to go about getting some of these values. <br><br></td></tr></table><br>
<a name="2067653"></a>

<a name="2067655"></a>

<a name="2067656"></a>

<a name="2067657"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Markus</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> i believe you can use one line intersect and make the big circle bigger with the radius from ball.<br><br>the line circle intersect tells you the intersect point,with it you <br>have a position , a direction vector and direction * length you can add to the start vector.<br>with the normal vector at collision (direction from middle point to collision point) you can calculate the reflection vector. <br><br></td></tr></table><br>
<a name="2067662"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paul - Taiphoz</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have all the collision response done, this is purely about making sure the ball does not miss something it should be hitting no matter how fast it's moving.<br><br>Not sure how only using one line would work for example ??? <br><br></td></tr></table><br>
<a name="2067664"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Xaron</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> What about Box2d? <br><br></td></tr></table><br>
<a name="2067665"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >programmer</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> What about Box2d?  <br></div> Monkey Box2d port is very slow. <br><br></td></tr></table><br>
<a name="2067667"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm pretty sure it's fast enough to provide for the collision checking being asked about. I suspect Taiphoz would rather roll his own rather than deal with working out how to incorporate Box2D though. <br><br></td></tr></table><br>
<a name="2067671"></a>

<a name="2067672"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gerry Quinn</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> The idea with one line is that if a ball shrinks to a point and the obstacles it collides with get bigger by the radius of the ball, you have the same collisions.<br><br>Imagine the common case where a ball of 1-inch radius bounces around in a square box 12-inches in diameter.<br><br>The bounces will be the same as for an infinitesimally small ball bouncing around in a 10-inch box...<br><br>[Strictly speaking it is the collisions that will be the same - if you are doing complicated bounces involving spin etc. you have to work them out, but you can still use this method to detect the collisions in the first place.) <br><br></td></tr></table><br>
<a name="2067674"></a>

<a name="2067678"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Markus</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> jo, Gerry had explained this :)<br><br>here i draw a pic for my fantasy:<br><a href="https://docs.google.com/file/d/0B942ivL2fTGcbnpHWWk5UDJhZGM/edit?usp=sharing" target="_blank">https://docs.google.com/file/d/0B942ivL2fTGcbnpHWWk5UDJhZGM/edit?usp=sharing</a> <br><br></td></tr></table><br>
<a name="2067675"></a>

<a name="2067676"></a>

<a name="2067677"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AdamRedwoods</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> The idea with one line is that if a ball shrinks to a point and the obstacles it collides with get bigger by the radius of the ball, you have the same collisions. <br></div><br>This.<br><br>In miniB3D, the collisions are all line vs. sphere, or line vs. plane (move the plane out of distance radius). except in the broadphase, i convert the line of motion to a massive sphere, and do a sphere-to-sphere bounds check. then i do the finer checks.<br><br>i'd be surprised if box2D is too slow for most things. <br><br></td></tr></table><br>
<a name="2067680"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paul - Taiphoz</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Id rather not delve into box2D for this, I do plan at some point to use Box2D for something tho.<br><br>Sorry if this sounds really dumb but I don't quite get your one line idea don't suppose you could draw a little pic to illustrate it ? <br><br></td></tr></table><br>
<a name="2067681"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tiresius</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Could you increase the number of times you update physics per step so it is a smaller time slice and less prone to this behavior?  I've done this in the past, just a thought. <br><br></td></tr></table><br>
<a name="2067702"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AdamRedwoods</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> <img src="http://i295.photobucket.com/albums/mm144/adamredwoods/sweep_line_intersection_zps46b36945.png"><br>note: v0=x0,yo ; v1=x1,y1<br><br>the left is circle-circle collision. you could solve this, though it wouldn't be pretty, solving the x^2+y^2=r formulas, etc.<br><br>the right side shows the circle shrinking and the collision time is the same. this will get you the circle's center coordinates at the point of intersection (vi0), but if you have the collision time (time=0.0 to 1.0) then you can solve given your line equation v0 + vf0*t = vi0. (v0, vf0, vi0 are x,y vectors)<br><br>if you need the intersection point, it would be a tad more complex. you would need to create a new line from vi0 to v1 and do a line-line intersection.<br><br>note you'll also get two solutions, so you need to find out which one is smaller (ie. the earlier collision).<br><br>All the math is here:<br><a href="http://paulbourke.net/geometry/circlesphere/" target="_blank">http://paulbourke.net/geometry/circlesphere/</a><br><br>EDIT:edited for clarity <br><br></td></tr></table><br>
<a name="2067692"></a>

<a name="2067693"></a>

<a name="2067695"></a>

<a name="2067696"></a>

<a name="2067700"></a>

<a name="2067701"></a>

<a name="2067694"></a>

<a name="2067697"></a>

<a name="2067698"></a>

<a name="2067699"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AdamRedwoods</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> When an intersection is detected, my plan to get the balls collision position is to use the third lines collision point and then push the ball back until its distance from the object of interest is equal to both their radius. <br></div><br>as tiresius noted, you can also use smaller time steps.<br><br>the way miniB3D does it (collision response) is to create a new starting and finish position and retest for collisions.<br>-new starting would be the point of intersection.<br>-the new end would be the original movement vector projected onto the collision plane plus radius. this way the sliding energy is conserved a bit.<br><br>to do that in 2d, i believe it's just the dot product of a normal onto the movement line (line-segment projection?). <br><br></td></tr></table><br>
<a name="2067704"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paul - Taiphoz</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> thanks for insight guys. gives me something to read over, I will have a bash tomorrow and see where I get with it.. <br><br></td></tr></table><br>
<a name="2067705"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Markus</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> re: you could draw a little pic to illustrate it ? <br>i had edited my entry above with a google link to my image.<br>for a correct collision between a rolling ball and a other ball you need <br>a tube to circle collision. now reduce the tube radius in mind and add it to the<br>circle. this is the one line-circle idee. :)<br>i believe you can better understand if you move the ball in mind or on paper along a line over<br>or beside a obstacle. <br><br></td></tr></table><br>
<a name="2067712"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nobuyuki</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> brilliant on the sweep stuff, guys.  I was thinking of doing it Taiphoz's way;  never thought to increase the radius of everything else and use simple line segments <br><br></td></tr></table><br>
<a name="2067720"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jesse</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is how it's done using dynamic collision.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">

Import mojo

Class Ball
	Field x:Float
	Field y:Float
	
	Field dx:Float
	Field dy:Float
	
	Field vx:Float
	Field vy:Float
	
	Field radius

	Method New(x:Float,y:Float,radius:Float,angle:Float,speed:Float)
		Self.x = x
		Self.y = y
		
		Self.dx = Cos(angle)
		Self.dy = Sin(angle)
		
		Self.vx = Self.dx * speed
		Self.vy = Self.dy * speed
		Self.radius = radius
		
	End Method
	
	
	Method Update:Void()
		x += vx
		y += vy
		
	End Method
	
	
	Method Render:Void()
		DrawLine x,y,x+x1,y+y1
		DrawCircle x+x1,y+y1,radius
		DrawCircle x,y,radius
		
	End Method
	
End Class

Global x1:Float, y1:Float


'resolve position of ball at time of collision using pythagoreans theorem
Function Collided:Bool(ball:Ball,wall:Circle)
	x1 = ball.dx * 800 'dummy code
	y1 = ball.dy * 800 ' dummy code
	'vector distance between center of ball and center of wall
	Local x:Float = wall.x - ball.x
	Local y:Float = wall.y - ball.y

	'closest distance between wall center and ball center at time of collision
	'hypotenus
	Local C:Float = ball.radius + wall.radius
	'opposite side = perpendicular dot product
	Local A:Float = ball.dx * y - ball.dy * x
	If C &lt; Abs(A)
		Return False 'no collision
	Endif
	'dot product: closest distance center of wall to path of ball
	Local dotP:Float = x * ball.dx + y * ball.dy
	
	If dotP &lt; 0 ' ball is moving away from wall
		Return False
	Endif
	 
	'adjacent vector
	Local vx:Float =  ball.dx * dotP
	Local vy:Float =  ball.dy * dotP
	'Adjacent side
	Local B:Float = Sqrt((C*C) - (A*A)) ' pithagoreans theorem
	
	'exact position of ball at time of collision
	vx -= ball.dx * B  
	vy -= ball.dy * B
	
	x1 = vx
	y1 = vy
	Return True
End Function


Class Circle

	Field x:Float
	Field y:Float
	
	Field radius:Float
	
	Method New(x:Float,y:Float,radius:Float)
		Self.x = x
		Self.y = y
		Self.radius = radius
	
	End Method
	
	
	Method Render:Void()
	
		DrawCircle x,y,radius
		
	End Method
	
End Class


Class Game Extends App
	Field ball:Ball
	Field wall:Circle

	Method OnCreate:Int()
		ball = New Ball(100,100,10,45,4)
		wall = New Circle(205,250,30)
	
		SetUpdateRate 90
		Return True
	End Method
	
	
	Method OnUpdate:Int()
		Return True
	End Method
	
	Method OnRender:Int()
		Cls
		ball.x = MouseX()
		ball.y = MouseY()
		ball.Render()
		Collided(ball,wall)
		SetColor 200,0,0
		wall.Render()
		Return True
	
	End Method
	
End Class


Function Main:Int()
	
	New Game
	Return True

End Function
</textarea> <br><br></td></tr></table><br>
<a name="2067717"></a>

<a name="2067718"></a>

<a name="2067719"></a>

<a name="2067715"></a>

<a name="2067716"></a>

<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
