<!DOCTYPE html><html lang="en" ><head ><title >Image alpha masking / clipping composting?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Image alpha masking / clipping composting?</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=507" >Monkey Programming</a>/<a href="#bottom" >Image alpha masking / clipping composting?</a><br><br>
<a name="2040452"></a>

<a name="2040453"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Soap</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> We really need something like this for a project. The alternative is to greatly increase the file size.<br><br>This image illustrates what I need to be able to do: <img src="http://i.imgur.com/BInKL.png"><br><br>Take two images. Draw one image so that its own alpha is composited with another image in the region of where it is being drawn compared to the second image (the clipmap) to make the first image less visible depending on what the alpha is where it is being clipped. <br><br></td></tr></table><br>
<a name="2040466"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >CopperCircle</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Have a look at this post, shows how to do it:<br><br><a href="http://www.monkeycoder.co.nz/Community/posts.php?topic=3495#37194" target="_blank">http://www.monkeycoder.co.nz/Community/posts.php?topic=3495#37194</a> <br><br></td></tr></table><br>
<a name="2040474"></a>

<a name="2040475"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >NoOdle</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> CopperCircle beat me to it. The worms code I posted can be used to do this. Additionally you could store the images as data and load them, saving the need to render to screen and grab using readpixels. <br><br></td></tr></table><br>
<a name="2040494"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Soap</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> What about real time? We are making some tests and seeing what can be usable.<br><br>What we really need for mojo is something like this: <a href="http://www.opengl.org/wiki/Stencil_Mask" target="_blank">http://www.opengl.org/wiki/Stencil_Mask</a> <br><br></td></tr></table><br>
<a name="2040497"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Soap</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> [monkeycode]<br>Strict<br>Import mojo<br><br>Function Main : Int()<br>	New MyApp()<br>	Return 0<br>End Function<br><br>Class MyApp Extends App<br>	<br>	<br>	Method OnCreate : int()<br>		SetUpdateRate( 60 )<br>		Return 0<br>	End Method<br>	<br>	<br>	<br>	Method OnUpdate:Int()<br><br>	Return 0 <br>	End Method<br><br>	Method OnRender : Int() <br><br>	Return 0 <br>	End Method<br><br>End Class<br><br><br>Function CreateCustomImages : Void()<br><br>        '// Create space for tool<br>        Local w : Int = tool.Width()<br>        Local h : Int = tool.Height()<br>        Local pixels : Int[ w * h ]<br>        Local img : Image<br>        <br>        Cls 128, 0, 255<br>        <br>        '// Grab tool sprite and mask background colour<br>        DrawImage tool, 0, 0<br>        ReadPixels( pixels, 0, 0, w, h )<br>        PixelArrayMask( pixels, 128, 0, 255 )<br>        img = CreateImage( w, h, 1, Image.MidHandle )<br>        img.WritePixels( pixels, 0, 0, w, h )<br>        tool = img<br>        toolPixels = pixels<br>        <br>        '// Create space for ground<br>        w = Min( ground.Width(), DeviceWidth() )<br>        h = Min( ground.Height(), DeviceHeight() )<br>        pixels = New Int[ w * h ]<br>        <br>        Cls 128, 0, 255<br>        <br>        '// Grab ground sprite and mask background colour<br>        DrawImage ground, 0, 0<br>        ReadPixels( pixels, 0, 0, w, h )<br>        PixelArrayMask( pixels, 128, 0, 255 )<br>        img = CreateImage( w, h )<br>        img.WritePixels( pixels, 0, 0, w, h )<br>        ground = img<br>        groundPixels = pixels   <br>        <br>End Function<br><br><br><br><br>Global CurrentMask:Image 'Reference to the last mask used, useful for preventing <br>Global Mask:Int[]  'Mask's pixels<br>Global MaskX:Float, MaskY:Float 'Mask's location<br>Global MaskActive:Bool = True <br><br><br>'// Converts Mask Pixel Color to Transparent Pixel<br>Function PixelArrayMask:Void(pixels:Int[], mask_r:Int = 0, mask_g:Int = 0, mask_b:Int = 0 )<br>	For Local i : Int = 0 Until pixels.Length<br>	        Local argb : Int = pixels[ i ]<br>	        Local a : Int = ( argb Shr 24 ) &amp; $ff<br>	        Local r : Int = ( argb Shr 16 ) &amp; $ff<br>	        Local g : Int = ( argb Shr 8 )  &amp; $ff<br>	        Local b : Int = argb &amp; $ff<br>	        If a = 255 And r = mask_r And g = mask_g And b = mask_b<br>	                a = 0<br>	                argb = ( a Shl 24 ) | ( r Shl 16 ) | ( g Shl 8 ) | b<br>	                pixels[ i ] = argb<br>	        Endif<br>	Next<br>End Function<br><br><br>'Sets the global mask location<br>Function SetMask:Void(img:Image, x:Float, y:Float)<br>	CurrentMask = img ; MaskX = x; MaskY = y<br>End Function<br><br>Function SetMask:Void(OnOff:Bool)<br>	MaskActive = OnOff 	<br>End Function<br><br>Function DrawImageMasked:Void(image:Image, x:Float, y:Float)<br>	If MaskActive <br>	'First, determine the rect area we need to blit.  It's the intersection of the mask and the image.<br>	<br>	'Now, pull the pixels from the source image.<br>	<br>	'Run the source pixels through the alpha mask function to mask them.<br>	<br>	'Finally, blit the result pixels to the screen.<br>	<br>	End If <br>End Function<br><br>[/monkeycode]<br><br>What we have so far but can't get it to work. Help?<br><br>A mojo polygon scissor would be a good enough compromise for our needs. <br><br></td></tr></table><br>
<a name="2040496"></a>

<a name="2040495"></a>

<a name="2065960"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >zoqfotpik</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Bumping this.<br><br>I would like to have copper effects running inside of defined areas on a bitmap.  For my purposes there are a number of ways I could fake it including just drawing a rectangular copper field and then rendering a bitmap in front of that with a transparent area cut out of a black rectangle that fully covers the copper field.  But I'd really like to see image scissoring.<br><br>There are probably oodles of other things more important than this.  Which is probably why it hasn't been added.<br><br>One other thing I may do is set up my own low-res pixmap and write color cycling and masking functions for that, then upres it-- this is just for a title screen and doesn't even need to run that fast though the copper cycling should be smooth.<br><br>For those who do not know (ie those born in the last 30 years) copper was a color cycling effect used on Atari STs, Amigas, Commodore 64s and other machines of that vintage to deliver snazzy color effects on extremely substandard hardware.  <br><br><a href="http://www.youtube.com/watch?v=5CUUOlYxlZ8" target="_blank">http://www.youtube.com/watch?v=5CUUOlYxlZ8</a><br><br><a href="http://en.wikipedia.org/wiki/Raster_bar" target="_blank">http://en.wikipedia.org/wiki/Raster_bar</a><br><br>This is a very cool sort of effect and since I am writing retro games it would be nice to include-- but it really requires bitmap masking to work and it's looking like that will require some sort of custom routine.  It should be possible to write a pixelwise search and replace in 320x200 to upscale... <br><br></td></tr></table><br>
<a name="2065946"></a>

<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
