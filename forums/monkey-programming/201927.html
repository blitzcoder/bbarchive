<!DOCTYPE html><html lang="en" ><head ><title >Update V49 now up! [MONKEY NEWS]</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Update V49 now up! [MONKEY NEWS]</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=507" >Monkey Programming</a>/<a href="#bottom" >Update V49 now up! [MONKEY NEWS]</a><br><br>
<a name="2018284"></a>

<a name="2018285"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>Update V49 is now available!<br><br>There are a few bug fixes in there, but the main feature is the addition of an (experimental) incremental garbage collector for the c++ glfw and ios targets. Note that you'll need to enable it via the config.h file in you project's .build dir.<br><br>The incremental GC should reduce GC overhead considerably for most apps, however it also means memory takes longer to be reclaimed so your app's memory footprint will probably be slightly larger when using it. How much larger will depend on the actual app.<br><br><div class="quote"> <br>Modules:<br><br>dom - added skidracer's stylesheet stuff.<br><br>flash mojo - fixed alpha bug introduced by fix for dark rendering.<br><br>monkey.lang, c++ mojos - added tweaks for incremental GC.<br><br><br>Trans (1.26)<br><br>Fixed generic class downcast parsing bug.<br><br>Added check for naughty assignments to indexed string chars.<br><br>Cpp translator now emits incremental gc friendly code - must be enabled via appropriate target config.h file.<br> <br></div> <br><br></td></tr></table><br>
<a name="2018287"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >hardcoal</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> tnx mark <br><br></td></tr></table><br>
<a name="2018296"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Xaron</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Great! Is my Android Bitmap suggestion in there already? <br><br></td></tr></table><br>
<a name="2018312"></a>

<a name="2018313"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >siread</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh man, the new GC increases the performance of my game by 2-3 times on my iPhone. The frame rate fluctuates a lot on the menu screens but it consistently stays above 30fps and the gameplay is now a solid 60fps. Thanks Mark, I can now look forward to submitting my app! :) <br><br></td></tr></table><br>
<a name="2018331"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >benmc</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> For some reason Monk won't start on my Mac in this new version.  The Monkey head shows up in the toolbar at the bottom, but the app never starts. <br><br></td></tr></table><br>
<a name="2018335"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dawlane</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> For some reason Monk won't start on my Mac in this new version. The Monkey head shows up in the toolbar at the bottom, but the app never starts. <br></div>I've only had that type of problem when starting monk by selecting and opening a file. It did this in the last few version of monk. <br><br></td></tr></table><br>
<a name="2018344"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >benmc</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm just starting Monk fresh from the new v47 folder, it shouldn't be trying to open any new files.  Not sure why it's just stalling.<br><br>EDIT: I found that unzipping the package fresh, then manually making edits to Targets worked.  I originally unzipped, edited files on the PC, then copied the targets folder over and it wouldn't open.  Not sure what went on there. <br><br></td></tr></table><br>
<a name="2018336"></a>

<a name="2018341"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nice! It seems a bit faster <br><br></td></tr></table><br>
<a name="2018351"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>&gt; Great! Is my Android Bitmap suggestion in there already? <br><br>Oops, no sorry - next time! <br><br></td></tr></table><br>
<a name="2018357"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Samah</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Mark, can you also add the reflection caching optimisations I suggested a while ago?  It removes all the object creation from onTouchEvent.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">public class MonkeyGame extends Activity{
  Method getPointerCount,getPointerId,getX,getY;
  Object args1[]=new Object[1];
  Class intClass[]=new Class[]{ Integer.TYPE };
  boolean checkedMultiTouch;
  ...
  public boolean onTouchEvent( MotionEvent event ){
    if( app==null ) return false;
    
    if(!checkedMultiTouch) {
      checkedMultiTouch = true;
      try{
        Class cls=event.getClass();
        getPointerCount=cls.getMethod( "getPointerCount" );
        getPointerId=cls.getMethod( "getPointerId",intClass );
        getX=cls.getMethod( "getX",intClass );
        getY=cls.getMethod( "getY",intClass );
      }catch( NoSuchMethodException ex ){}
    }
    
    if(getPointerCount==null) {
      //mono-touch version...
      //
      gxtkInput input=app.input;
      int action=event.getAction();
      
      switch( action ){
      case MotionEvent.ACTION_DOWN:
        input.OnKeyDown( gxtkInput.KEY_TOUCH0 );
        break;
      case MotionEvent.ACTION_UP:
        input.OnKeyUp( gxtkInput.KEY_TOUCH0 );
        break;
      }
      
      input.touchX[0]=event.getX();
      input.touchY[0]=event.getY();
  
      return true;
    }

    try{

      //multi-touch version...
      //
      final int ACTION_DOWN=0;
      final int ACTION_UP=1;
      final int ACTION_POINTER_DOWN=5;
      final int ACTION_POINTER_UP=6;
      final int ACTION_POINTER_ID_SHIFT=8;
      final int ACTION_MASK=255;
      
      gxtkInput input=app.input;
      
      int action=event.getAction();
      int maskedAction=action &amp; ACTION_MASK;
      int pid=0;
      
      if( maskedAction==ACTION_POINTER_DOWN || maskedAction==ACTION_POINTER_UP ){
        args1[0]=Integer.valueOf( action&gt;&gt;ACTION_POINTER_ID_SHIFT );
        pid=((Integer)getPointerId.invoke( event,args1 )).intValue();
      }else{
        args1[0]=Integer.valueOf( 0 );
        pid=((Integer)getPointerId.invoke( event,args1 )).intValue();
      }
      
      switch( maskedAction ){
      case ACTION_DOWN:
      case ACTION_POINTER_DOWN:
        input.OnKeyDown( pid+gxtkInput.KEY_TOUCH0 );
        break;
      case ACTION_UP:
      case ACTION_POINTER_UP:
        input.OnKeyUp( pid+gxtkInput.KEY_TOUCH0 );
        break;
      }
      
      int pointerCount=((Integer)getPointerCount.invoke( event )).intValue();
      
      for( int i=0;i&lt;pointerCount;++i ){
        args1[0]=Integer.valueOf( i );
        int pid2=((Integer)getPointerId.invoke( event,args1 )).intValue();
        input.touchX[pid2]=((Float)getX.invoke( event,args1 )).floatValue();
        input.touchY[pid2]=((Float)getY.invoke( event,args1 )).floatValue();
      }
    }catch( Exception e ){	//what's this for?
    }
    return true;
  }
  ...
}</textarea><br><br>Basically:<br>* Cache the Method objects so that you're not doing four extra reflection calls on every touch event, and only check for them once per application run.<br>* Cache the intClass array since it will never change.<br>* Cache the args1 array.<br>* Use Integer.valueOf instead of new Integer, so that it uses the internal Integer pool. <br><br></td></tr></table><br>
<a name="2018356"></a>

<a name="2018362"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>&gt; Mark, can you also add the reflection caching optimisations I suggested a while ago?<br><br>Will do. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
