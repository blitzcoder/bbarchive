<!DOCTYPE html><html lang="en" ><head ><title >Fog of war / shroud</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Fog of war / shroud</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=507" >Monkey Programming</a>/<a href="#bottom" >Fog of war / shroud</a><br><br>
<a name="2096720"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raz</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi all, just an open question instead of me looking for specific answers.<br><br>How would/do you deal with "fog of war" or shroud in game development?<br><br>I worked on a game recently which is 2d, top down and reveals the level as you walk around (the entire game is on the same screen with no scrolling). I used a 2d array to determine which pixels were visible and should be drawn (yes I was drawing the level on a per pixel basis).<br><br>I know this was a really shoddy and rushed way of doing things.<br><br>So I'm wondering, how have you handled it? <br><br></td></tr></table><br>
<a name="2096729"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> You either need to be constructing a single background image on the fly or revealing that image by altering an obscuring overlay image on the fly. It's a case where even if Monkey's render-to-texture operations are pretty slow they're likely to be far faster than rendering all the separate images every frame.<br><br>An alternative would be to just draw the background image (via writepixels from map data if that's easier) and then render the shroud as a minimal set of rectangles, but that's probably a lot more effort for little return.<br><br>I did take a look at your code to see if I could play around with speeding it up but the zip doesn't seem to contain a working project. <br><br></td></tr></table><br>
<a name="2096732"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gerry Quinn</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Maybe you could use a set of points (perhaps in a hexagonal array or something more randomised) and fix the fog of war according to these.  That way you wouldn't have to save so much data, and you could draw the fog with a limited number of draws, or generate an appropriate polygon and fill it.<br><br>The downside would be that the fog would clear in 'steps', but you could disguise this by fading in changes. <br><br></td></tr></table><br>
<a name="2096740"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raz</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm the source should be valid (just downloaded it and tried it), ld31.monkey is the main file, however, you will need to comment out the following line of GameScreen.OnStart() to, you know... stop the game showing the whole map at the start! (not sure how that was left in the code)<br><br><pre class=code>
GameScreen.ClearShroud(100, 100, 500)
</pre><br><br>The drawing to background idea seems like a great one to me, to be honest I have little to no experience with manipulating images in Monkey, because from the threads I saw it always seemed a bit hit and miss (granted it was a long time ago). I have to say though that loading a level directly from an image was very helpful considering the time constraints.<br><br>I considered the drawing of rectangles idea, but didn't actually get round to it in the end. I've no idea where I'd start with it though.<br><br>Gerry: I think if there was a nice enough looking transition and the shape was a bit more interesting than a simple rectangle, that would actually look quite cool. Your suggestion of a hexagonal array seems fitting to me. Now all I need to do is find the time to do all of this stuff. <br><br></td></tr></table><br>
<a name="2096764"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Looks like I messed up extracting the files somehow before and only got some of the folders.<br><br>Okay, I've had a tinker and uploaded a HTML5 build to here: <a href="http://stickydesigns.com/chrisld31/MonkeyGame.html" target="_blank">http://stickydesigns.com/chrisld31/MonkeyGame.html</a> . It runs okay in Chrome on my laptop so it should be playable for most people. The altered source is in <a href="http://stickydesigns.com/chrisld31/src.zip" target="_blank">http://stickydesigns.com/chrisld31/src.zip</a> .<br><br>Things I did:<br><br>* Performance - Changed the background rendering to write to an image.<br>* Performance - Changed the "mobile" element rendering to use rects instead of the coloured pixel image. If you used a WebGL mojo implementation this would probably not be needed.<br>* Performance - Changed the collision mechanism to use a collision map rather than trawl the active objects list every frame.<br>* Visual - Changed the fog of war to a float array and used a circular reveal with a 30% falloff boundary. Looks nice but is a bit expensive. <br>* Input - Tweaked the key handling code to track new directional inputs and allow the player to override the current direction without lifting off the held direction.<br>* Collision - I changed the way the update and collision checks occur to fix a problem where the player could walk through moving entities.<br><br>Anyway, it was kind of fun to mess about with someone else's code. I hope some of it is useful reference for you. <br><br></td></tr></table><br>
<a name="2096763"></a>

<a name="2096767"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raz</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> That's amazing thank you, I look forward to looking through the code :) <br><br></td></tr></table><br>
<a name="2096770"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> You could "cheat" and use sprites with alpha values. Start them at full visibility and when the player gets close reduce the alpha so it becomes transparent. <br><br></td></tr></table><br>
<a name="2096776"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Fryman</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> in pizza pestz i used a sprite, black square with a transparent circle in the middle to emulate a torch, used drawrect to fill in the gaps<br><br>on my current project im using a custom tile map and have a bool array of the same size as the map to decide weather or not to draw the tile reflecting fogofwar which is essentially the same way you have done it but instead of per pixel its per tile <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
