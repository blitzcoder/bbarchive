<!DOCTYPE html><html lang="en" ><head ><title >Saving out PNGs: pointers appreciated.</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Saving out PNGs: pointers appreciated.</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=507" >Monkey Programming</a>/<a href="#bottom" >Saving out PNGs: pointers appreciated.</a><br><br>
<a name="2097643"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Peeling</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm currently working on an atlasing system which, for various reasons, has to be written in Monkey. I want to be able to spit out the resulting textures as PNGs, but I can't find any support for that. The alternative is to save them as raw data and then post-process in Photoshop, but I'd prefer to avoid the extra step if possible.<br><br>Time is of the essence, too, so if anyone has made progress in this direction and could help me out, that would be much appreciated :)<br><br>Thanks! <br><br></td></tr></table><br>
<a name="2097646"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Pierrou</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> The only bit of code I know allowing to export images is Fred's one, here : <a href="http://www.monkey-x.com/Community/posts.php?topic=5528#61922" target="_blank">http://www.monkey-x.com/Community/posts.php?topic=5528#61922</a> (==&gt; BMP only) <br><br></td></tr></table><br>
<a name="2097676"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >impixi</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> What's your target platform?<br><br>For desktop targets, the "proper" way would be to wrap libpng (and also zlib) but if "time is of the essence" then that is not really an option. <br><br></td></tr></table><br>
<a name="2097679"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nobuyuki</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> internal tool?  Use Imagemagick's convert.exe as a secondary step after exporting pixels using Fred's export function.  Wrapping libpng is probably the way to go in the long run of course.... <br><br></td></tr></table><br>
<a name="2097698"></a>

<a name="2097699"></a>

<a name="2097700"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImmutableOctet(SKNG)</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay, so the first thing you need to do is setup libpng, which <i>should</i> come with the needed zlib code. You'll likely have to build these yourself, and of course move the correct files over. To my knowledge, you don't need to dynamically link to these if you don't want to. Don't quote me on that; you should probably read the licenses. Monkey doesn't use libpng for decoding, it uses stb (On the GLFW targets, anyway), which does not support encoding, therefore, we'll have to use libpng or a similar library. Project files and make-files are already provided by libpng, but if you want to build a different version of zlib, you'll want to grab CMake. Getting CMake is probably a good idea anyway. Library setup is per-compiler, so if you want to use both GCC/MinGW and MSVC, you'll have to set them both up. After that, external C++ code can be used through Monkey on its C++ based targets. MinGW/GCC is currently untested, so if you're using it/them, tell me if it causes major errors. Non-C++ targets are not supported by the code I'm posting (This may change in the future). They likely have their own ways of doing this, to begin with. Anyway, on to the actual code:<br><br><a href="https://github.com/Regal-Internet-Brothers/imageencoder" target="_blank">Here's a repository on GitHub</a>. That code has only been tested with MSVC, at the moment. I'm basically just too lazy to compile zlib and libpng again. This was originally based on <a href="http://www.lemoda.net/c/write-png/" target="_blank">the code provided here</a>. That being said, the original version found on that page is pretty awful, not to mention inefficient.<br><br>I'm not going to do the work for the specific situation you have, but that should allow you to re-save the image-data you retrieve with the 'opengl.gles11' module's 'LoadImageData' command. Array support is on the to-do list, but Monkey's not as open about them. That module was written with somewhat limited knowledge of libpng, so it may be inefficient.<br><br>This put me through way too much hell to implement. Seriously, I went an hour debugging everything, just to find out that I wrote "= NULL" instead of "== NULL". That was it. I can't tell if Monkey's made me pick of bad habits, or I honestly think C++ should use '=' for both assignment and comparison. I got so angry righting this module, you have no idea. AND IT WAS ALL BECAUSE OF ONE MISSING CHARACTER. Not to mention that the documentation for libpng is all over the place, so I had to debug it and make guesses about the names of the proper destruction commands; there shouldn't be any memory leaks now. That module is licensed under the MIT license, so you should be good to use it for commercial projects. Since this is currently C++ only, the targets you have at your disposal are mainly desktop targets (Could be useful for tools). iOS might also work, assuming you can get libpng working on it.<br><br>Well, anyway, I hope this helps. I know this doesn't put several images into an atlas (Something you might want to use an external tool for), but it should prove useful. <br><br></td></tr></table><br>
<a name="2097697"></a>

<a name="2097719"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Peeling</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> That's fantastic, thanks :) I, too, find that a few weeks with Monkey has destroyed 20 years of C++ manners.<br><br>It's purely a tool thing. The only reason I want/need to use Monkey at all is that the atlasing process needs to leverage the UI script parser that's already in the app in order to make automatic decisions about how to group and pack images in different atlases. I'm mainly trying to find out if it's less painful to convince Monkey to save out images, or to port the bits of the parser to another platform :) What you've posted should definitely help me make that decision.<br><br>Cheers! <br><br></td></tr></table><br>
<a name="2097920"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Fred</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Peeling: have a look at the Desktop forum section, not perfect (uncompressed) but it might help... <br><br></td></tr></table><br>
<a name="2097944"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Peeling</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks all. I ended up going for a hybrid approach: get the app to compile and save a 'usage file' to express how and where the images are used in a simpler format, then write an external tool to read that file, create the atlases, and fire out a 'key' file for the game to remap its image references into the atlases. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
