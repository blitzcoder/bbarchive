<!DOCTYPE html><html lang="en" ><head ><title >Delete a instance of class</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Delete a instance of class</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=507" >Monkey Programming</a>/<a href="#bottom" >Delete a instance of class</a><br><br>
<a name="2007191"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xzess</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi there,<br><br>is there a possibility to remove an instance of a class i created with "new" ? <br><br></td></tr></table><br>
<a name="2007194"></a>

<a name="2007195"></a>

<a name="2007196"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Dereference it. Monkey us Garbage collected, no need to manually delete instances fo classes.<br><br><pre class=code>
Class MyClass
End Class

Local var1:= New MyClass 'We create one instance here, pointed by 1 variable
Local var2:=var1 'The same instance is now pointed by 2 variables
var1 = Null 'The same instance is now pointed just by one variable (var2)
var2 = Null 'The instance is not pointed by any variable, so Monkey will free it for you in the background.
</pre><br><br>When a variable runs out of scope it is nullified. All in all, this design makes it very difficult (impossible?) to have memory leaks in code. <br><br></td></tr></table><br>
<a name="2007221"></a>

<a name="2007223"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xzess</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks ziggy, Well plz check it out:<br><a href="Http://www.xzess.org/Webgames/Exhale/" target="_blank">Http://www.xzess.org/Webgames/Exhale/</a><br><br>Obviously i have a memory leak :/<br>Every New map everything Gets reset and nulled. <br><br></td></tr></table><br>
<a name="2007227"></a>

<a name="2007229"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>Why 'obviously'?<br><br>It seems to work fine here, although I'm not sure what I'm supposed to do.<br><br>[edit]<br>It does 'stutter' a bit when a new fleet of rockets is launched, but catches up and smooths out soon after that.<br>[/edit] <br><br></td></tr></table><br>
<a name="2007230"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xzess</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Don't understand me wrong, the problem could lay on my side. I'm just seeking a solution and im trying to find out where the problem is. You are doing a great job Mark!<br>I will take a closer look this evening <br><br></td></tr></table><br>
<a name="2007231"></a>

<a name="2007238"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xzess</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> You have to let it run. After Some minutes memory is about 4gb. On iOS it crashes before the map is over. On android and glftw it crashes immediately on app launch <br><br></td></tr></table><br>
<a name="2007233"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hima</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Instead of creating a new instance of the rocket everytime, I think you should recycle it. The game crash on me when the red planet launch HUGE number of rockets. <br><br>One thing about garbage collect is that most of the time it doesn't delete them right away but sometimes later. So in the long run you don't have to worry about memory but looking at your game it seems like you want the memory as soon as possible for those rockets. In that case, I think you should go with Object Pool design pattern where you recycle an unused object instead of creating a new one everytime. <br><br></td></tr></table><br>
<a name="2007234"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>JavaScript is 100% responsible for memory management so there *shouldn't* be any memory leaks!<br><br>Are you definitely 'releasing' all objects?<br><br>The only thing I can think of is that you've got a bunch of objects sitting in a list/map somewhere you've forgotten about... <br><br></td></tr></table><br>
<a name="2007235"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xzess</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I tried this before v40 and it crashed it much sooner.<br>I will give recycling a chance again. Hopefully that's it. Thanks for pointing out when it crashes <br><br></td></tr></table><br>
<a name="2007236"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xzess</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> In the code of the version I posted in URL it does the first release when a ship arrives it's destination. The ship instance gets nulled, img discard, and removed from the list. <br>On newGame (won/lost/button clicked) all vars get reset and all lists cleared. <br>I will add a check if there are no ships travelling, the list get cleared also <br><br></td></tr></table><br>
<a name="2007237"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>Why are you discarding the image?<br><br>All images should preferably be loaded just once in OnCreate. <br><br></td></tr></table><br>
<a name="2007242"></a>

<a name="2007244"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xzess</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have 2 versions, 1st compiled before release of v40 with object recycling and 4 lists (allships,allplanets,activeships player and same for CPU)<br>So oncreate it preloads 1000 ships + planets + bg, music etc<br>This crashes much sooner as if I do it like in v2 where I dynamically add and release the ships. I have to say that I know that this isn't sweet but it was a try because preload and recycle didn't make it better<br><br>Edit: I will preload those 2 fighter images as i did before so there won't be a need of discarding the image. the memory leak should be then caused by the lists. I will check that <br><br></td></tr></table><br>
<a name="2007247"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>&gt; So oncreate it preloads 1000 ships + planets + bg, music etc<br><br>Why 1000 ships? <br><br>You should be sharing a single global ship image with 1000 ship objects. <br><br></td></tr></table><br>
<a name="2007248"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xzess</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes it's one image but 1000 vars. Just typed wrong sry <br><br></td></tr></table><br>
<a name="2007249"></a>

<a name="2007250"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dima</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's really difficult to tell what's happening without looking at the code. A few things I noticed within the very brief time i spent with it; <br><br>in task manager the instance of chrome browser that uses the game takes between 30-50MB and this number fluctuates meaning SOME memory does get released at some point.<br><br>I was able to get mem usage up to 300MB by spamming the New Map button while many ships are flying about, but then it reset back to 40MB.  BTW, clicking the New Map DOES NOT CLEAR THE SHIPS - they keep flying to empty space where planet used to be in previous map, so if that's not intended maybe you could check that out further.<br><br>After a few New Map clicks i notice that ships appear to come from random places and sometimes in huge numbers, not sure where they are coming from, but my guess is where a planet used to be in prev map.  Are the ships supposed to keep appearing without any interaction? even after pressing New Map?<br><br>Now I got the game to 600MB and it froze, that's after I was typing this and the game ran by itself with ships flying about by themselves.  It seems that not everything is cleared properly at this time.<br><br>i also noticed the debug 'error: delta &lt; 0' im not sure if thats delta time or another delta, but delta time should NEVER be 0 or less.  Also, make sure you are not dividing by 0 ANYWHERE (specially if you're using delta time), that would cause crashes.<br><br>These are just observations, but without source it's very very hard to know.  maybe you could post just a small region of your code where you add objects to lists and where you remove them?<br><br>Cheers,<br>Dima <br><br></td></tr></table><br>
<a name="2007257"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Virtech</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>When a variable runs out of scope it is nullified. All in all, this design makes it very difficult (impossible?) to have memory leaks in code.<br> <br></div><br><br>Does this also apply to stack items that hold pointer to a particular object?<br><br>Usually If I want to remove an object referenced in a stack I do something like this:<br><pre class=code>
' Remove when health=0
For index=0 to asteroids.Length()-1
	Local asteroid:=asteroids.Get(index)
	If asteroid.health&lt;=0
		xplosions.Push New Xplosion( asteroid.x, asteroid.y, (asteroid.s*4) )
		asteroids.Remove(index)
	EndIf
Next
</pre><br><br>As shown above I just use Remove(index) to remove the object reference. I don't set anything to Null.<br><br>Is this method correct, or should I also set the local index variable "asteroid" = Null? <br><br></td></tr></table><br>
<a name="2007258"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Removing the Index, removes the contents of the Stack item, that is, decreases by one the number of references to the given object. If the object is "only" stored in the stack, it'll be free. <br><br></td></tr></table><br>
<a name="2007262"></a>

<a name="2007263"></a>

<a name="2007264"></a>

<a name="2007265"></a>

<a name="2007268"></a>

<a name="2007269"></a>

<a name="2007284"></a>

<a name="2007285"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jesse</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> accord to this:<br><pre class=code>

	Method Remove( index )
		For Local i=index Until length-1
			data[i]=data[i+1]
		Next
		length-=1
	End
</pre><br>if index is the last item in the stack the item is never removed only the stack length variable is decreased.<br>it's the same way "pop" works, only the length variable is decreased but it is over written when  a new object is added to the stack again. so, if your stack gets to be like 1000 objects and the stack gets decreased one at a time, always the last one, until the index is 0 you will have 1000 objects floating around wasting memory until each is over written by inserting or "push"ing 1000 items to the stack again.<br>I think it needs to be something like this:<br><pre class=code>
	Method Remove( index )
		If index = length-1
			data[index] = Null
		Else
			Local i
			For i=index Until length-1
				data[i]=data[i+1]
			Next
			data[i] = Null
		Endif
		length-=1

	End
</pre> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
