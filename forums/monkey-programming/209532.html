<!DOCTYPE html><html lang="en" ><head ><title >excessive RAM usage</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >excessive RAM usage</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=507" >Monkey Programming</a>/<a href="#bottom" >excessive RAM usage</a><br><br>
<a name="2099508"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Duke87</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi guys, i got just a few little questions.<br><br>i wrote a little GalleryView for myself. <br>1. My problem: When i Load the gallery with 10  Files (all about 3,6mb) it uses 71mb RAM,<br>by using 20 Files (6,7mb) its about 109mb, by 40 Files it uses like 400mb.<br>All files are .jpg. <br><br>2. it doesn't load all files. it's like my App Skip's some files. (is it a Fileproblem?)<br><br>Code: Mainfile<br>[CODE]<br>#rem<br>	This Example shows how to use the GalleryViewer.<br>#end<br>Import mojo<br>Import maniac<br>#GLFW_USE_MINGW=True<br>#GLFW_WINDOW_TITLE="GalleryViewer Example"<br>#GLFW_WINDOW_WIDTH=1024<br>#GLFW_WINDOW_HEIGHT=800<br>#GLFW_WINDOW_SAMPLES=0<br>#GLFW_WINDOW_DECORATED=False <br>#GLFW_WINDOW_RESIZABLE=False<br>#GLFW_WINDOW_FULLSCREEN=false  <br>#GLFW_SWAP_INTERVAL=-1<br>#OPENGL_GLES20_ENABLED=false<br>#OPENGL_DEPTH_BUFFER_ENABLED=false<br>#MOJO_AUTO_SUSPEND_ENABLED=True<br>#MOJO_IMAGE_FILTERING_ENABLED=True<br><br>#TEXT_FILES="*.txt|*.xml|*.json"<br>#IMAGE_FILES="*.png|*.jpg"<br>#SOUND_FILES="*.wav|*.ogg"<br>#MUSIC_FILES="*.wav|*.ogg"<br>#BINARY_FILES="*.bin|*.dat"<br><br>Function Main:Int()<br>	New Example							<br>	Return 0<br>End<br><br><br>Class Example Extends App<br>	Field gv:ManiacGallery<br><br>	Method OnCreate:Int()<br>		SetUpdateRate( 60 )<br>		initManiac()<br>		gv = New ManiacGallery(DW*0.1,DH*0.1,DW*0.8,DH*0.7,"monkey://data/GFX/Test/")<br>	End Method<br>	<br>	Method OnUpdate:Int()<br>		maniacUpdate()<br>		gv.Update()<br>	End Method<br>	<br>	Method OnRender:Int()<br>		Cls<br>		gv.Draw()<br>	End Method <br><br>End Class <br>[/CODE]<br><br>ManiacGallery:<br>[CODEBOX]<br>Class ManiacGallery	Implements IOnLoadImageComplete<br>	Global loadedImages:Int =	0<br>	Global l:Int = 0<br>	Field arrImg:Image[500]<br>	Field maniacID:Int <br>	Field X:Float,Y:Float,Width:Float,Height:Float<br>	Field ViewMode:Int = 1<br>	Field dist:Int = 10<br>	Field imgW:Float,imgH:Float <br>	Field BtnRight:ManiacButton<br>	Field BtnLeft:ManiacButton<br>	Field BtnSwitchViewStyle:ManiacButton<br>	Field ScrolledImages:Int = 0<br>	Field tp:Int	= 0<br>	Field lastSwitch:Int <br>	Field switchIntervall:Int = 500<br>	Field Alpha:float<br>	<br>	Method New(_X:Float,_Y:Float,_Width:Float,_Height:Float,_loadPath:String = "GFX/")<br>		X = _X<br>		Y = _Y<br>		Width =_Width<br>		Height = _Height<br>		loadFromPath(_loadPath)<br>		Local bW:Float = DW*0.15<br>		Local bH:Float = DH*0.07<br>		imgW = ll_Width(_Width,3,dist)<br>		imgH = (_Height-bH)/2.5<br>		<br>		<br>		BtnLeft 			=  New ManiacButton(_X + bW/2 + _Width*0.02 ,_Y+_Height-bH/2, bW,	bH," &lt;&lt; ",ALIGNMENT_MIDDLE,COLOR_BLUE,True,1.5)<br>		BtnRight 			=  New ManiacButton(_X + _Width - bW/2 - _Width*0.02 ,_Y+_Height-bH/2, bW,	bH," &gt;&gt; ",ALIGNMENT_MIDDLE,COLOR_BLUE,True,1.5)<br>		BtnSwitchViewStyle 	=  New ManiacButton(_X + _Width*0.5 ,_Y+_Height-bH/2, bW,	bH," Switch ",ALIGNMENT_MIDDLE,COLOR_BLUE,True,1.5)<br>		<br>		<br>	End Method <br>	<br>	Method loadFromPath:Void(_Path:String="monkey://external/" )<br>		Print "Get Folder"<br>		Local arrStr:String[] = GetFolderFiles(_Path)<br>		Print "Found: " + arrStr.Length() + " files"<br>		l = arrStr.Length()<br>		For Local ls:Int = 0 Until l<br>			Print "load " + ls<br>			LoadImageAsync(arrStr[ls], 1, 0, Self)<br>		Next<br>	End Method <br>	<br>	Method Draw()<br>		Drw_Rect(X,Y,Width,Height,3)<br>		SetColor 255,255,255<br>		SetAlpha 1<br>		Select ViewMode<br>			Case 0	'3x2 overview<br>				Local i:Int = 0<br>				For Local x:Int = 0 To 2<br>					For Local y:Int = 0 To 1<br>						Drw_Rect(X+dist+x*(imgW+dist)  , Y+dist+y*(imgH+dist), imgW,imgH,2)<br>						'Print "i: " + i<br>						if arrImg[i+ScrolledImages] = Null <br>							DrawText "No Image",X+dist+x*(imgW+dist)  , Y+dist+y*(imgH+dist)<br>						Else  <br>							DrawImage ( arrImg[i+ScrolledImages] , X+dist+x*(imgW+dist)  , Y+dist+y*(imgH+dist),0, imgW/arrImg[i+ScrolledImages].Width(), imgH/arrImg[i+ScrolledImages].Height() )<br>						Endif <br>						i +=1<br>					Next<br>				Next <br>				<br>			Case 1<br>				If arrImg[tp] &lt;&gt; Null<br>					SetAlpha 1<br>					DrawImage arrImg[tp], X,Y,0,Width*1/arrImg[tp].Width(),Height*0.87/arrImg[tp].Height()<br>				Endif <br>				If arrImg[tp+1] &lt;&gt; Null<br>					SetAlpha Alpha<br>					DrawImage arrImg[tp+1], X,Y,0,Width*1/arrImg[tp+1].Width(),Height*0.87/arrImg[tp+1].Height()<br>				Endif <br>		End Select <br>		<br>		BtnLeft.Draw()<br>		BtnRight.Draw()<br>		BtnSwitchViewStyle.Draw()<br>		<br>		DrawText("Mode: " + ViewMode+ " | View: " + tp + "/"+loadedImages , X +Width*0.5,Y)<br>	End Method <br>	<br>	Method Update:Int()<br>		If BtnLeft.Update() = 101 And gl_mousereleased<br>			if ScrolledImages &lt;= 0<br>			<br>			Else<br>				ScrolledImages -= 1<br>			Endif<br>		Endif <br>		<br>		If BtnRight.Update() = 101 And gl_mousereleased<br>			If (ScrolledImages + 6) &gt;= loadedImages<br>			<br>			else<br>				ScrolledImages += 1<br>			Endif <br>		Endif <br>		<br>		If BtnSwitchViewStyle.Update() = 101 And gl_mousereleased<br>			If ViewMode = 0<br>				ViewMode = 1<br>			Else<br>				ViewMode = 0<br>			Endif <br>		Endif <br>		<br>		Select ViewMode<br>			Case 0<br>			Case 1<br>				If Millisecs() - lastSwitch &gt;= switchIntervall<br>					If (tp + 1) &gt;= loadedImages<br>						tp = 0<br>					else<br>						tp +=1<br>					Endif <br>					Alpha = 0<br>					lastSwitch = Millisecs()<br>				Endif <br>				<br>				Alpha += EqToFPS(1.0/(switchIntervall/1000.0))' 0.02<br>		End Select  <br>	End Method <br>	<br>	Method OnLoadImageComplete:Void(_image:Image, path:String, source:IAsyncEventSource)<br>		If _image &lt;&gt; Null<br>			arrImg[loadedImages] = _image<br>			loadedImages += 1<br>		Else<br>			Print "no image : "+loadedImages<br>		Endif <br><br>	End<br>End Class <br>[/Codebox]<br>UpdateAsyncEvents() is called within the ManiacUpdate() <br><br>GetFolderFiles(_Path) returns all filenames within a folder. (even those, which are not loaded correctly &lt;&lt; so this should not be the error). <br><br>is something wrong with loadFromPath:Void() ,or OnLoadImageComplete:Void()  ? <br>Or is the massiv usage of RAM normal? <br><br></td></tr></table><br>
<a name="2099507"></a>

<a name="2099514"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Midimaster</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> the RAM usage is "normal", because the compressed jpg files become uncompressed images. Maybe you really have a RAM problem.<br><br>I would prefer to scale down each jpg inside your app. After it is loaded grab it to a thumbnail and only keep this in memory. <br><br></td></tr></table><br>
<a name="2099518"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >EdzUp</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> All graphic files are converted to RGBA values so each pixel is four bytes in ram, this makes a simple image that looks like 19kb in file size blow up to massive memory usage when converted to gpu compatible images.<br><br>Also excessive ram usage will kill an app on mobile targets. <br><br></td></tr></table><br>
<a name="2099520"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Duke87</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> thank you for your quick answers.<br>i got just one little question, how do i use GrabImage for rescaling(downsize) an Image?<br><br>i tried (for testing purpose)<br>origImg = LoadImage("monkey://data/GFX/Test/060124_174356.jpg")<br>nImg = origImg.GrabImage( 0, 0, origImg.Width(),origImg.Height(),1,0 )<br><br>how do i downsize nImg? <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
