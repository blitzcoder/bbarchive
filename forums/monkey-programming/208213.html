<!DOCTYPE html><html lang="en" ><head ><title >Delta timing and OnSuspend/OnResume issues</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Delta timing and OnSuspend/OnResume issues</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=507" >Monkey Programming</a>/<a href="#bottom" >Delta timing and OnSuspend/OnResume issues</a><br><br>
<a name="2082626"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sensei</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey guys, <br><br>I wonder if any of you have come across this little problem.<br>I use the Delta timer code from the delta.monkey example and I've just recently noticed that when you have <br><pre class=code>
#MOJO_AUTO_SUSPEND_ENABLED = True
</pre><br><br>In your game and the OnSuspend is called, that it seems to me List objects and other things that use the delta timing continue to update!<br>VIsually the game suspends, but when it gains focus again, the game timer and other things I have used that use the timer are clearly updated as if the delta timer is trying to make up for the gap of time between OnSuspend and OnResume.<br><br>I found the only way to "fix" this is to stop using delta timing, but I don't see this as an option.<br>Normally I wouldn't bother with OnSuspend and OnResume, however since I want to release my game on both browser and Android versions, using delta timing is rather important.<br><br>As a simple example, I will have this snippet<br><pre class=code>
Method OnUpdate:Int()
  dt.UpdateDelta
  ...
</pre><br><br>Then later on in the same OnUpdate method, I have<br><pre class=code>
attacktimer += 1 * dt.delta ' attacktimer is a float, btw
</pre><br><br>When you lose focus, you can visually see the timer (I display it in OnRender) and you would for example lose focus at say 100, then wait a few seconds and return to it and the timer would be on say 200, when it should resume at 101. I've noticed this also happens with List objects that use delta timing. For example, I have a list of enemy ships and in the OnUpdate method I call the Enemy.Update() method and pass the dt.delta value through as the ships movements and bullets all also use delta timing to ensure movement speed remains constant regardless of FPS, for example<br><pre class=code>
For Local i := Eachin enemyList
	i.x += i.hSpeed * timeDilationSpeed * delta
....
Next
</pre><br><br>When I comment out * delta, it suspends correctly, otherwise it just continues to update so that when the game starts rendering again, the ships are already out of the screen or just about (depending on how long you left focus).<br><br>I have tested this on browser, and GLFW and it happens each time.<br><br>From my experience it seems that in the OnSuspend method, you can only call a method once and it runs through it literally only once, so you can't do much during that time to call other methods to do anything of use, like passing a variable to the enemy update method to say don't update if this variable is 1 or something.<br><br>I admit I'm not very experience with this but at the end of the day, I would like to implement my own pause method which is fine, but it will be useless on browser and android/ios systems unless I can somehow use the OnSuspend method with my own pause.<br><br>Any help would be appreciated.<br><br>Thanks,<br>Jaco<br><br>[edit]<br>In fact, I just noticed the exact same thing happens on delta.monkey example. Try it for yourself in the browser. <br><br></td></tr></table><br>
<a name="2082625"></a>

<a name="2082624"></a>

<a name="2082641"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Within the OnResume method you need to reset the delta:<br><br><pre class=code>Method OnResume:Int()
	dt.currentticks = Millisecs()
	dt.lastticks = dt.currentticks
End</pre> <br><br></td></tr></table><br>
<a name="2082650"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MikeHart</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> When you use OnSuspend and OnResume you need to run your own timer. Basicslly what you have described by adding the time difference of each frame to it. The great advantage is that you can multiply this by a defined factor and so speed up your game or slow it down. <br><br></td></tr></table><br>
<a name="2082655"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sensei</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh thanks therevills! I think that is exactly what I need. Wish I'd thought of that!<br>I'll give it a try tonight.. <br><br></td></tr></table><br>
<a name="2082669"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gerry Quinn</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> My usual technique is to read the time on every update, but lock it to a certain range of possibilities, so for example:<br><br>Local millis:Int = Millisecs() - lastMillis<br>lastMillis = Millisecs()<br>Local timePassed:Float = Max( 0.01, Min( millis * 0.001, 0.10 ) )<br>gameTime += timePassed<br><br>This way lags or interruptions get accommodated, but can't really mess up anything. <br><br></td></tr></table><br>
<a name="2082670"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sensei</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks so much guys. These are really useful tips. Would've been nice if they were documented but at least now there are forum threads for it :) <br><br></td></tr></table><br>
<a name="2082716"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sensei</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well @therevills, your code did the trick. Many thanks!<br>@Gerry, I like your idea and I think I'm going to give it a try in my next game as I know so much more now than I did at the start of this game project :) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
