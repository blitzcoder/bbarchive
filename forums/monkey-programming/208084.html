<!DOCTYPE html><html lang="en" ><head ><title >Shadows</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Shadows</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=507" >Monkey Programming</a>/<a href="#bottom" >Shadows</a><br><br>
<a name="2080825"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raz</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Shadows! Would love to hear everyones thoughts on this.<br><br>I am creating a general use 2D isometric world (Zelda 3 view) and I would like to automatically create shadows where required.<br><br><img src="http://chrismingay.co.uk/screenshots/Shadows.png"><br><br>1 - Shows a 3x3 rock formation.<br>2 - Shows the tiles I use to draw said 3x3 rock formation. You can see that I draw columns for each cell.<br>3 - Shows the shadows I would like drawn for said formation<br><br>So, what would you do to implement such a thing? I'm sure there is a really elegant way of doing this, but I've not found it!<br><br>-- BONUS QUESTION --<br><br>4 - Shows a different type of column which is slightly taller than the others.<br>5 - Shows this column at the centre of a 3x3 formation. You will notice it is projecting a shadow on to the "roof" of the shorter items.<br><br>How would you implement this?<br><br>Thanks as always!<br>-Chris <br><br></td></tr></table><br>
<a name="2080838"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gerry Quinn</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you want shadows on the ground only, it's easy.  Just pair every object with an image of its shadow, and draw all the shadows first.<br><br>If you want shadows falling on objects, it's a bit more difficult.  Maybe you need to draw everything in layers from the ground up, and calculate where the shadow of each 'voxel object' hits a lower object.  (E.g. your 3-high columns would each be drawn as 3 blocks, each with its own shadow, starting from the bottom.)<br><br>If the image is complicated with many voxels, I guess you need some clever math to analyse things. <br><br></td></tr></table><br>
<a name="2080839"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nobuyuki</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> In 3d applications, shadows are often created with the help of the stencil buffer and a few cast rays.  For your game, you can use a variation of autotiles instead.  As long as the height of things casting shadows is always constant, a simple mask can be generated from directly underneath all shadow casting objects, and blitted to a special shadow layer at an offset. Basically, a very low-res drop shadow, but with autotiles to 'pretty up' the hard edges.  <br><br>You could also add height map data to the shadow cast objects to change the mask shape but be aware that shadows won't overlap the tiles that cast them.  It might be better to just make static shadow layers yourself using autotiles biased in the direction you want them cast. <br><br></td></tr></table><br>
<a name="2080995"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raz</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Gerry : This is what I had originally done except for the fact I if I "cast" a shadow from each item, there would be lots of overlaps. To combat this I only cast shadows from objects that had no neighbours below them and or to the right of them. This still caused some overlaps, so I had to get cleverer and have the lower items cast a shadow from their bottom edge and have the right hand objects cast a shadow to the right. Objects in the bottom right of the formation cast both sets of shadows.<br><br>While it worked, it didn't feel very elegant to me.<br><br>Nobu : So essentially, render out the shadows per different object and then rerender that shadow when required? I guess creating an image for the whole shadow map would be too much. <br><br></td></tr></table><br>
<a name="2080997"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gerry Quinn</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Of course - I forgot that shadows will be semi-transparent so overlapping them will cause problems. <br><br></td></tr></table><br>
<a name="2080999"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nobuyuki</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Raz:   I hadn't taken into account that you might've wanted dynamic shadows at all.  That's another ball of wax entirely.  If you're gonna do that, you might as well just directly use the stencil buffer to do this.  As long as you stick to OpenGL targets, this is entirely possible with <a href="https://github.com/nobuyukinyuu/nDrawExts2" target="_blank">nDrawExts2</a>.  Use whatever technique you want to blit masking areas to the stencil buffer (heightmaps and all), then render a big black rect at the alpha you want underneath all your sprites inside the stencil mask.  Note that the rendering of the stencil alpha only supports a 1 bit threshold (even though the buffer itself can be 8 bits) -- This is because the pass/fail test is 1-bit, kinda a limitation of the way you can handle the data in OpenGL 1.1, I think, but I'm no expert...... Anyway, the shadows will be "hard", but it's possible to make them completely dynamic this way.. <br><br></td></tr></table><br>
<a name="2081002"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raz</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh no, just to be clear, I don't want dynamic shadows at all. I'm only interested in casting the shadows on these static objects (in as elegant a way as possible).<br><br>Again, that said, the mask rendering does sound exactly like what I'm after! (tis a shame I had hoped to target XNA, but GLFW should work!). Regardless masking sounds like the most elegant way of doing this as it means I don't have to worry at all about shadows overlapping (will check out nDrawExts2 thank you!)<br><br><div class="quote"> Note that the rendering of the stencil alpha only supports a 1 bit threshold <br></div><br>Sorry, are you able to explain what you mean by this? Stencil rendering is either on or off per pixel? <br><br></td></tr></table><br>
<a name="2081004"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raz</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I need to work on the sizes and what not, but Nobu, you're a star :D Stencil shadow drawing works an absolute treat.<br><br><img src="http://chrismingay.co.uk/screenshots/20140305212306421.png"><br><br>The great thing is, I can just edit the shadows as necessary without any major work. I'm doing the following to render the shadow layer, does this look correct?<br><br><pre class=code>ClearStencil()
EnableStencil()
DrawToStencil(True)
shadowLayer.RenderAll()
DrawToStencil(False)
SetColor(0, 0, 0)
SetAlpha(0.5)
DrawRect(0, 0, AppWidth, AppHeight)
DisableStencil()</pre> <br><br></td></tr></table><br>
<a name="2081021"></a>

<a name="2081022"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nobuyuki</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Looks good to me.  Glad it worked out for you :3 <br><br></td></tr></table><br>
<a name="2081066"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paul - Taiphoz</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Raz is that Stencil code the glStencil stuff or something you have written? <br><br></td></tr></table><br>
<a name="2081067"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >k.o.g.</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Raz<br><br>Can you post the Example code for the Community? To show, how you done that? <br><br></td></tr></table><br>
<a name="2081079"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raz</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> OK sure will do later on but really I'm not doing much personally, I'm using Nobu's nDrawExts2 - <a href="https://github.com/nobuyukinyuu/nDrawExts2" target="_blank">https://github.com/nobuyukinyuu/nDrawExts2</a> and building for the Desktop target. The code (taken pretty much directly from the nDrawExts2 example) below is doing all of the clever stuff.<br><br><pre class=code>ClearStencil()
EnableStencil()
DrawToStencil(True)
shadowLayer.RenderAll() ' &lt;-- Drawing the shadows here
DrawToStencil(False)
SetColor(0, 0, 0)
SetAlpha(0.5)
DrawRect(0, 0, AppWidth, AppHeight)
DisableStencil()</pre><br><br>I'm drawing all of the shadows to the stencil, and then rendering a black rectangle that fills the screen based on that stencil. shadowLayer.RenderAll() is just rendering the shadows cast by the objects (which are just images of solid shadows that I've drawn myself).<br><br>Will post again later. <br><br></td></tr></table><br>
<a name="2081083"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gerry Quinn</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> If the objects are static, you have extra options as you can use ReadPixels and WritePixels to make pre-generated images.  So you could deal with overlapping shadows by drawing them as an opaque image, then reading the image and drawing it with some transparency. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
