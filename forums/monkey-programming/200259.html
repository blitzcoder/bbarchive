<!DOCTYPE html><html lang="en" ><head ><title >Handling object deletion...</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Handling object deletion...</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=507" >Monkey Programming</a>/<a href="#bottom" >Handling object deletion...</a><br><br>
<a name="2001631"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> ... on targets that support it.<br><br>When an instance of my class is no longer required, I'll like it to call a method - like finalize() in Java, ~() in C++ and c#...<br><br><br>But I'm not going to hold my breath :-) <br><br></td></tr></table><br>
<a name="2001716"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>No finalizers, sorry.<br><br>For one thing, as you've noted they're not supported on all targets, but they're also IMO evil.<br><br>Here's the main issue: If you have a set of objects that require finalization, what order do you execute finalizers if the objects reference each other?<br><br>Since finalizer code can potentially access other objects also due for finalization (via fields), you need to be careful to call their finalizers in such an order that an object's finalizer code does not 'use' (call methods etc) an already finalized object, eg: if Object A references B and both are due for finalization, you need to call A's finalizer first.<br><br>But if there are cyclic references, then there may be no correct order and the GC must somehow deal with this.<br><br>Hans-boehm GC gets around this by *not* finalizing any such objects - ie: if it detects that a bunch of objects require finalization and are cyclically linked, it wont run any of their finalizers at all. This is IMO the 'correct' solution.<br><br>C#/Java (and BlitzMax now) get around this by 'resurrecting' objects that a finalizer can reach that have already been finalized. This is extremely naughty as it means that methods may be called on an already finalized object! It's even possible for a finalizer to permanently resurrect a finalized object by assigning it to a global or something.<br><br>In most cases, this doesn't happen - but as I discovered with BlitzMax, it does happen, esp. if you use finalizers a lot. All in all, it's impossible to guarantee 'good' behaviour of finalizers without relying on the programmer to know what's going on.<br><br>And of course, all this detection of finalized objects, resurrection etc. is time consuming and adds a lot of complexity.<br><br>My advice is to do the complete opposite - if you've got an object that stores an OS resource or something that requires certain cleanup, give it a Close() method and stick it in a map or list to keep it alive.<br><br>Since the object MUST be closed by the user, having it 'kept alive' doesn't matter - it can remove itself when Close() is called. But you also get the option to close a whole set of such objects at once by closing all objects in the map.<br><br>There's an experimental Resource class in the monkey.resource module that helps with this. It's currently extended by Image and Sound and I will eventually be adding 'DeleteImage', 'DeleteSound', 'DeleteAllImages' and 'DeleteAllSounds' functions. I plan to do the same eventually with files and 'CloseFile' and 'CloseAllFiles'. This worked well in Blitz3D, and I think it'll work well again in Monkey. <br><br></td></tr></table><br>
<a name="2001712"></a>

<a name="2001713"></a>

<a name="2001714"></a>

<a name="2001715"></a>

<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
