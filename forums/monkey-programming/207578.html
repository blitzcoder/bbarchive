<!DOCTYPE html><html lang="en" ><head ><title >DrawImageRect() equivalent in WritePixels()?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >DrawImageRect() equivalent in WritePixels()?</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=507" >Monkey Programming</a>/<a href="#bottom" >DrawImageRect() equivalent in WritePixels()?</a><br><br>
<a name="2073255"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dip</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi all,<br><br>I'm messing around with some simple raycasting and noticing that drawimagerect is just too slow or I'm doing something wrong. I wanted to try writing to an image buffer then putting that on the screen, but when I tried to translate my drawimagerects into writepixels, I kept getting errors about invalid pixel rectangles. I kept reducing the variables in my call until I just had <br>cameraBufferImage.WritePixels(dataWall,1,1,1,1)<br>which worked, but when I ran the program with a simple<br>DrawImage(cameraBufferImage,0,0)<br>at the end just to see if it would work, my FPS dropped from ~50 to 2.<br>That was a real head-scratcher, as I hoped it would at least be equivalent, especially since it was doing less work.<br><br>If someone can give me a straightforward example of how it should be used so I can figure out where I'm going wrong, I'd appreciate it.<br><br>My pixel loading is in a "pregame" state doing this call:<br>Cls 0,0,0<br>DrawImage(imgWall,0,0)<br>dataWall = New Int[64*64]<br>ReadPixels(dataWall,0,0,64,64)<br><br>I'm a bit frustrated that I can't create something that ran on 386's nearly 20 years ago with a decent framerate on today's hardware :)<br><br>I also tried looking at Earok's advanced raycaster for some ideas but it doesn't give the same output on the version of Monkey I'm using. <br><br></td></tr></table><br>
<a name="2073267"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gerry Quinn</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> All the code there looks fine, but you haven't said how you created cameraBufferImage.  Perhaps it is rather large.<br><br>When you use WritePixels to put data into an image, even if the amount of data is tiny, the system is going to push the whole image buffer to graphic memory when you try to draw it (and then it will draw it to the back buffer from graphic memory).  So if cameraBufferImage is 1000x1000, that's the amount of data that is getting pumped to graphic memory every render cycle.  This seems the most likely issue.<br><br>Maybe if you are only changing a small part of the image at a time you can use multiple small buffer images, and only change the ones you want.  Or perhaps you can try to do something in native code that will speed matters up, I'm not sure how but it may be possible, i.e. there may be calls that update only a portion of an image in graphic memory.<br><br>Modern hardware is powerful, but the pipeline may not flow the way you want it to. <br><br></td></tr></table><br>
<a name="2073266"></a>

<a name="2073265"></a>

<a name="2073264"></a>

<a name="2073290"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dip</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm that's a really good idea, Gerry. I'll give that a try.<br>I was using a standard resolution of 800x600 for the screen, and<br>cameraBufferImage = CreateImage(800,600)<br>as a result. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
