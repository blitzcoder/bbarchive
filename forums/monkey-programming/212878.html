<!DOCTYPE html><html lang="en" ><head ><title >Cos Weirdness</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Cos Weirdness</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=507" >Monkey Programming</a>/<a href="#bottom" >Cos Weirdness</a><br><br>
<a name="2127064"></a>

<a name="2127065"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >[VOLOFORCE]</td><td align="right"><font class=tiny>(Posted March)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>there is something weird going on. As far as I can tell from my pathetic math skills, the cos of Angle 90 should be zero. Weirdly when I try this:<br><br><i>Print "WHAT IS COS 90: " + Cos(90) + "WHAT IS SIN 90:" + Sin(90)</i><br><br>creates this output:<br><br><i>WHAT IS COS 90: 1.2167964413833943e-008WHAT IS SIN 90:1.0</i><br><br>I don't really get it... <br><br></td></tr></table><br>
<a name="2127067"></a>

<a name="2127068"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gerry Quinn</td><td align="right"><font class=tiny>(Posted March)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's due to rounding errors.  Your float values must be real floats... what target are you using? On the HTML5 target I get 6.123233995736766e-17, which at least is double-precision.<br><br>Okay, you are using desktop.  You can use double precision values on this by setting the preprocessor value:<br>#CPP_DOUBLE_PRECISION_FLOATS=True<br><br>But see below for an issue.<br><br>THe real problem is that floating point numbers are not exact real values, so they do not always give the precise value you expect.  If your maths will crash if Cos( Pi/2 ) is not exactly zero, you must set it as a constant.  For the same reason, it's generally best to use integers in For.. Next loops.  You'll have the same problem in all languages except maybe some functional languages designed for mathematical calculations.<br><br>I originally thought it might work better using Cosr and giving Pi/2 in radians, but on my system that made no difference.<br><br>EDIT: my guess turned out right when I set the preprocessor value above... Cosr gave double precision result but Cos didn't.  I'll report this as a bug - it looks like Monkey doesn't convert these functions properly.  Use the standard radian versions<br> of trig functions if you want double precision - and don't touch the built-in constants such as PI - they are rounded to float values. <br><br></td></tr></table><br>
<a name="2127073"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >[VOLOFORCE]</td><td align="right"><font class=tiny>(Posted March)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Interesting... thanks. But I wonder - why am I the first to notice? <br><br></td></tr></table><br>
<a name="2127074"></a>

<a name="2127075"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Xaron</td><td align="right"><font class=tiny>(Posted March)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well... many have noticed this. This is a common "problem" since the introduction of floating point numbers (not limited to Monkey). That's why you NEVER ever would compare for equal with a floating point number. Something like If( a = 0.0 ) is a NO NO. ;)<br><br>In the world out there usually some thing like an epsilon is defined so you always compare against that, e.g.:<br><br><pre class=code>
Local eps:Float = 0.00001

If( Abs( a ) &lt; eps )
  'a is zero! Well... Almost
End If
</pre> <br><br></td></tr></table><br>
<a name="2127077"></a>

<a name="2127078"></a>

<a name="2127079"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gerry Quinn</td><td align="right"><font class=tiny>(Posted March)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> As for the degree-based trig functions not honouring the preprocessor command, I suspect that most of those who would have noticed would have been using the radian-based trig functions anyway, if they were doing the sort of math where it mattered.<br><br>But regardless of precision, you have to deal with the rounding errors.  Double precision stores more digits of each floating-point number, so the errors are smaller.  But they will always be there. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
