<!DOCTYPE html><html lang="en" ><head ><title >Array autoboxing</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Array autoboxing</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=507" >Monkey Programming</a>/<a href="#bottom" >Array autoboxing</a><br><br>
<a name="2014334"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Samah</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Mark, can you add this to boxes.monkey please?<br><pre class=code>Class ArrayObject&lt;T&gt;
	Field value:T[]
	
	Method New(value:T[])
		Self.value = value
	End
End</pre><br>I'm not sure how hard it will be to do autoboxing with that (non-trivial, I'd assume), but it'd be nice to have this class as part of the official distribution so we can put arrays in maps and lists without custom wrapper classes. <br><br></td></tr></table><br>
<a name="2014339"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rixarn</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm not 100% sure, but i believe that version 5 of Java and up don't allow generic array creation.. <br><br></td></tr></table><br>
<a name="2014344"></a>

<a name="2014345"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Samah</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I'm not 100% sure, but i believe that version 5 of Java and up don't allow generic array creation.. <br></div><br>It's not creating a generic array; you pass one into the constructor.  It might be a problem for the actual autoboxing, but there's nothing wrong with the code I've provided.<br><br>Also, Java's "generics" are just a dirty hack, really.  You can't instantiate T or an array of T because at runtime, T is indistinguishable from Object.  Type erasure is a nasty thing. <br><br></td></tr></table><br>
<a name="2014388"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>I'll be looking at the generic stuff again soon, but this will not be going into Monkey just yet.<br><br>The main problem is that there is no way to 'cast' arrays in Monkey at the moment, which makes dealing with T[] arrays a bit tricky.<br><br>By rights, since there is no array casting, there should be no way to pass T[] arrays to methods or return them (as they have to be converted to Object[] arrays for the generic class to be able to use them). The fact that you can is really a 'hole' in the generic system that doesn't work well on all targets (try your ArrayObject in C++). <br><br></td></tr></table><br>
<a name="2014390"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Samah</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> That's a pity, because you can in Java. :(<br>I assume that making arrays objects would be a huge undertaking... <br><br></td></tr></table><br>
<a name="2014391"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>&gt; I assume that making arrays objects would be a huge undertaking... <br><br>Well, not that huge...but it's actually a bit more complicated than that with arrays.<br><br>The big issue is that while Java allows you to convert a Derived[] array to a Base[] array, in order for this to work safely Java must check ALL writes to the Base[] array to make sure you aren't writing a non-Derived object.<br><br>Such a 'write barrier' is hard/inefficient to do for all targets. Possible by all means, but I was worried about the overhead involved (esp. for the dynamic languages which don't have 'typed' arrays at all) so decided not to implement it in Monkey, and disallow 'casting' of arrays entirely. Of course, there's also the fact that some of these issues weren't entirely clear to me at the outset either!<br><br>All in all, I think it's best to think of Monkey arrays as being considerably lower level than in other languages. They're designed for speed, not comfort, so are good for behind-the-scenes grunt work, but for higher level tasks you should stick with stacks/vector/arraylists/lists etc built on top of arrays. <br><br>And I don't think that's such a bad approach for a multi-target language as it offers great flexibility over how arrays may be implemented. <br><br></td></tr></table><br>
<a name="2014393"></a>

<a name="2014394"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Samah</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> @marksibly: The big issue is that while Java allows you to convert a Derived[] array to a Base[] array <br></div><br><strike>Uhh.... no you can't.  String[] does not extend Object[].  It does however extend Object (non-array).</strike><br><br>Edit: My bad, apparently you can.  This is news to me... <br><br></td></tr></table><br>
<a name="2014392"></a>

<a name="2014396"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>I sort of knew 'of it'...but the ramifications of it are pretty major, esp. the runtime array write checking. And without being able to cast arrays, as you've/we've found out, using generic arrays is hard/impossible with Java style generics.<br><br>C++ *doesn't* support array upcasts like this, in that it wont implictly convert Derived** to Base** - an age old 'WTF' sort of issue in the C++ world! I guess C# must though, as it uses a similar generic system to Java's.<br><br>I am starting to get very interested in the idea of moving to C++/macro style generics - it solves a TON of problems in one hit, is probably more suited to a multi-target translator where you have limited control over the runtime env, is IMO more in the style of what is supposed to be a 'simple' language (eg: you can 'use' methods when writing the template without having to declare 'T Extends Blah') and should be pretty easy to implement - and would be fully backward compatible.<br><br>However, it would be at the cost of some code bloat, as each generic instantiation would get it's own 'real' class, instead of sharing a single class. Still, Monkey's dead code elimination would help keep this to a minimum, and besides, how many types of List does an app REALLY use anyway?<br><br>I originally went with Java style generics because I assumed it'd produce more optimal (well, smaller) code, and yes, it does. But I didn't really realize how limiting it'd be, and the amount of compiler side effort that'd be required to get any decent mileage out of it. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
