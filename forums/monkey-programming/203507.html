<!DOCTYPE html><html lang="en" ><head ><title >Float and Int Precision After Multiplication</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Float and Int Precision After Multiplication</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=507" >Monkey Programming</a>/<a href="#bottom" >Float and Int Precision After Multiplication</a><br><br>
<a name="2036996"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >c.k.</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've got a float value of 9.2, that when multiplied by a const SCORE_PRECISION, which equals 100000000 (one hundred million), is becoming 919999999.9999999.<br><br>Is there any way to get this to work properly so 9.2 * SCORE_PRECISION becomes 920000000? <br><br></td></tr></table><br>
<a name="2037008"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Cygnus</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is normal behavior with floats.<br><br>If you use int(your_variable+0.5) then it will round the figure to the nearest integer. <br><br></td></tr></table><br>
<a name="2037010"></a>

<a name="2037011"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gerry Quinn</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> And beware when targeting Android, floats are single precision on it (should be an option to use doubles IMO) and such problems will be worse. <br><br></td></tr></table><br>
<a name="2037034"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >c.k.</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I know it's somewhat expected behavior, but is there a work-around? There's got to be a way! :-)<br><br>Cygnus, I don't want to round, because the values are sometimes going to be 7 or 8 decimal places. I need to keep that precision and accuracy.<br><br>Gerry, I think that's true of the HTML5 target as well, which is where I'm experiencing the problem. <br><br></td></tr></table><br>
<a name="2037036"></a>

<a name="2037037"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> If you use int(your_variable+0.5) then it will round the figure to the nearest integer.  <br></div>This is only valid por positive values.<br><pre class=code>Int(your_variable+0.5*Sng(your_variable))</pre>works for both positive and negative numbers. <br><br></td></tr></table><br>
<a name="2037047"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gerry Quinn</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you really have that many digits it's double precision.  Single-precision floats have only about eight decimal digits. <br><br>You don't have to round the float itself: just generate a rounded int and use that for scores or whatever.<br><br>This issue comes with the territory when using floats.  There's no simple fix for it. <br><br></td></tr></table><br>
<a name="2037052"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >c.k.</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> The only thing I can imagine doing is taking the float and assigning it to a string.<br><br>Run this:<br><br>[monkeycode]<br><br>Function multiply:String(f:Float, p:Int)<br>	Local s:String = String(f)<br>	Local d:Int = s.Find(".")<br>	Local sP:String = String(p)<br>	Local pL:Int = sP.Length()<br><br>	Local sZero:String = "0000000000"<br>		<br>	Local mant:String<br>	Local dant:String<br>	<br>	If d &gt; 0 Then ' there's a decimal<br>		mant = s[ .. d]<br>		dant = s[d + 1 ..]<br>	EndIf<br>	<br>	Print "original s: '" + s + "'~nmant: " + mant + ", dant: " + dant<br>	Print "precision: " + pL<br>	<br>	Local x:Int = (mant.Length() +dant.Length()) -pL<br>	Print "x = " + x<br>	If x &lt; 0 Then<br>		dant += sZero[ .. Abs(x)]<br>	Else<br>		<br>	EndIf<br>	<br>	Return mant + dant<br>		<br>End<br><br>Function Main()<br>	Local myFloat:Float = 9.2<br>	Local myString:String = String(myFloat)<br>	Local prec:Int = 100000000<br><br>	Print "From " + myFloat + " -&gt; " + prec<br>	myString = multiply(myFloat, prec)<br>	Print "Stringified: " + myString<br>	Print " multiplied: " + myFloat * prec<br>	<br>End<br>[/monkeycode]<br><br>That works for what I need: it guarantees (somewhat) that my floats will be accurately and precisely multiplied by the size factor. I'm sure it can be done better. There are probably bugs. Maybe even Diddy already has this functionality.<br><br>What do y'all think, though, as a foundation for accurate number manipulation? <br><br></td></tr></table><br>
<a name="2037054"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gerry Quinn</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> What are you trying to achieve exactly?   <br><br>If you want arbitrary precision rationals or decimals, you will have to either find or develop a class of objects to represent them.  If you search you'll find code for this in a variety of languages, which you will be able to adapt to Monkey (assuming nobody already has).  Simple floats and integers in most languages including Monkey have limited precision.  They are designed to fit neatly in the arithmetic registers of computer processors.<br><br>The downside is that arbitrary-precision numbers are much slower to calculate with.  Ask yourself whether your application really needs that much precision. <br><br></td></tr></table><br>
<a name="2037053"></a>

<a name="2037056"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >c.k.</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm keeping track of scores that are very precise, and need to be very precise to determine rank/placement on a leaderboard.<br><br>9.1234567 is a better score than 9.1234566.<br><br>Some platforms can handle greater precision, but for the lowest common denominators, I'm having to truncate/round. I need that to be as accurate as possible.<br><br>Since I'm only doing the calculation once, right after the game is over, it's not a huge deal, thankfully!<br><br>And I don't want a lot of ties on the board. :-) <br><br></td></tr></table><br>
<a name="2037055"></a>

<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
