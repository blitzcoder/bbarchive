<!DOCTYPE html><html lang="en" ><head ><title >Z Ordering</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Z Ordering</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=507" >Monkey Programming</a>/<a href="#bottom" >Z Ordering</a><br><br>
<a name="2020881"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raz</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I am thinking of making a game using an overhead perspective (not top down, slightly at an angle like Zelda 3). I will need to do some sort of Z Ordering, but I am not entirely sure how I would go about doing this with multiple types of object?<br><br>Has anyone tackled this yet? Any thoughts?<br><br>Ta :) <br><br></td></tr></table><br>
<a name="2020882"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raz</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> My initial thought is...<br><br>maybe I can almost scan each row of the game area for all types of object and draw them as required. As I go I could tag each item as drawn. And reset it at the start of each frame. To me this seems like quite of processing, but (as I have done many times before) maybe I am just under estimating just how much processing can be done in a 60th of a second. <br><br></td></tr></table><br>
<a name="2020898"></a>

<a name="2020899"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gerry Quinn</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Do you mean isometric tiles?<br><br>If so, the following may be all you need:<br><br>from bottom to top<br>    from back to front<br>        from left to right<br>            draw tile or object<br>        next<br>    next<br>next<br><br>(assuming view is from overhead, front and right) <br><br></td></tr></table><br>
<a name="2020968"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >siread</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Personally I would add all the objects that you want to draw to a list, then sort the list according to their Y co-ordinates, top to bottom. Finally iterate through the list to draw them. Of course you will need to make sure your hot spots are set to the bottom of the images with SetHandle().<br><br>You are welcome to use this code if you like (it requires the Diddy mod for sorting array lists). All you do is instead of using DrawImage() in your code you use TDrawOb.AddImage() passing the image, co-ords, alpha, scale etc. Then you just call TDrawOb.RenderAll() to sort and draw the images. You can even give the objects height by passing a value for z. Just remember to create a shadow for the object too. ;)<br><br><pre class=code>
Import mojo
Import diddy

Class TDrawOb Implements IComparable
	Global glist:ArrayList&lt;TDrawOb&gt;
	
	Field x:Float, y:Float, z:Float
	Field img:Image
	Field frame:Int
	Field level:Int			' 0 ground, 1 shadows, 2 objects, 3 gui
	Field alph:Float		' Alpha
	Field rot:Int			' Rotation
	Field col:String		' HTML style colour normally white "FFFFFF"
	Field sclx:Float		' Scale
	Field scly:Float
	
	Function AddImage(obimg:Image, obx:Float, oby:Float, obz:Float = 0, frm:Int = 0, lvl:Int = 0, 
alph:Float = 1.0, rot:Int = 0, col:String = "FFFFFF", sclx:Float = 1.0, scly:Float = 1.0)

		If Not glist Then glist = New ArrayList&lt;TDrawOb&gt;
		
		Local ob:TDrawOb = New TDrawOb
		
		ob.x = obx
		ob.y = oby
		ob.z = obz
		ob.img = obimg
		ob.frame = frm
		ob.level = lvl
		ob.alph = alph
		ob.rot = rot
		ob.col = col
		ob.sclx = sclx
		ob.scly = scly
		
		glist.AddLast(ob)
	End
	
	Function RenderAll()
		If Not glist Then Return
		
		glist.Sort()
		
		For Local ob:TDrawOb = EachIn glist
			SetHexColour(ob.col)
			SetAlpha(ob.alph)
			DrawImage(ob.img, ob.x, ob.y-ob.z, ob.rot, ob.sclx, ob.scly, ob.frame)	
		Next
		
		glist.Clear()
		
		SetAlpha(1.0)
		SetColor(255,255,255)
	End
	
	Method Compare:Int(O:Object)
		' Images are initially sorted according to their level (ground, shadows, objects etc)
		If TDrawOb(O).level &lt; level Then Return 1 
		If TDrawOb(O).level &gt; level Then Return -1 
		
		' Then sort them according to their y co-ordinate
		If TDrawOb(O).y &lt; y Then Return 1 
		If TDrawOb(O).y &gt; y Then Return -1
		
		' If y coord is equal then sort by height
		If TDrawOb(O).z &lt; z Then Return 1 
		If TDrawOb(O).z &gt; z Then Return -1
		
		Return 0
	End

End

' Functions for setting colour using HTML style string
Function SetHexColour(col:String)
	If col.Length &lt; 6 Then Return
	
	Local r:Int, g:Int, b:Int
	r = HexToDecimal(col[0..2])
	g = HexToDecimal(col[2..4])
	b = HexToDecimal(col[4..6])
	
	SetColor(r, g, b)
End

Function HexToDecimal:Int(token:String)
	Local val:Int = 0
	Local hex:String = token.ToUpper()
	
	For Local i:Int = 0 Until hex.Length()
		val *=16
		
		If hex[i] &gt;= 48 And hex[i] &lt;= 57
			val += (hex[i]-48)
		Else
			val += (hex[i]-55)
		End
	Next
	
	Return val
End
</pre> <br><br></td></tr></table><br>
<a name="2020967"></a>

<a name="2020966"></a>

<a name="2020965"></a>

<a name="2020964"></a>

<a name="2020963"></a>

<a name="2020962"></a>

<a name="2020961"></a>

<a name="2020960"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >siread</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Personally I would add all the objects that you want to draw to a list, then sort the list according to their Y co-ordinates, top to bottom. Finally iterate through the list to draw them. Of course you will need to make sure your hot spots are set to the bottom of the images with SetHandle().<br><br>You are welcome to use this code if you like (it requires the Diddy mod for IComparable). All you do is instead of using DrawImage() in your code you use TDrawOb.AddImage() passing the image, co-ords, setting alpha, scale etc. Then you just call TDrawOb.RenderAll() to sort and draw the images. You can even give the objects height by passing a value for z. Just remember to create a shadow for the object too. ;)<br><br>[code]<br>Import mojo<br>Import diddy<br><br>Class TDrawOb Implements IComparable<br>	Global glist:ArrayList&lt;TDrawOb&gt;<br>	<br>	Field x:Float, y:Float, z:Float<br>	Field img:Image<br>	Field frame:Int<br>	Field level:Int			' 0 ground, 1 shadows, 2 objects, 3 gui<br>	Field alph:Float		' Alpha<br>	Field rot:Int<br>	Field col:String		' Colour normally white "FFFFFF"<br>	Field sclx:Float		' Scale<br>	Field scly:Float<br>	<br>	Function AddImage(obimg:Image, obx:Float, oby:Float, obz:Float = 0, frm:Int = 0, lvl:Int = 0, <br>alph:Float = 1.0, rot:Int = 0, col:String = "FFFFFF", sclx:Float = 1.0, scly:Float = 1.0)<br><br>		If Not glist Then glist = New ArrayList&lt;TDrawOb&gt;<br>		<br>		Local ob:TDrawOb = New TDrawOb<br>		<br>		ob.x = obx<br>		ob.y = oby<br>		ob.z = obz<br>		ob.img = obimg<br>		ob.frame = frm<br>		ob.level = lvl<br>		ob.alph = alph<br>		ob.rot = rot<br>		ob.col = col<br>		ob.sclx = sclx<br>		ob.scly = scly<br>		<br>		glist.AddLast(ob)<br>	End<br>	<br>	Function RenderAll()<br>		If Not glist Then Return<br>		<br>		glist.Sort()<br>		<br>		For Local ob:TDrawOb = EachIn glist<br>			SetHexColour(ob.col)<br>			SetAlpha(ValidateMinMaxFloat(ob.alph, 0, 1.0))<br>			DrawImage(ob.img, ob.x, ob.y-ob.z, ob.rot, ob.sclx, ob.scly, ob.frame)	<br>		Next<br>		<br>		glist.Clear()<br>		<br>		SetAlpha(1.0)<br>		SetColor(255,255,255)<br>	End<br>	<br>	Method Compare:Int(O:Object)<br>		' Images are initially sorted according to their level (ground, shadows, objects etc)<br>		If TDrawOb(O).level &lt; level Then Return 1 <br>		If TDrawOb(O).level &gt; level Then Return -1 <br>		<br>		' Then sort them according to their y co-ordinate<br>		If TDraw <br><br></td></tr></table><br>
<a name="2020958"></a>

<a name="2020959"></a>

<a name="2020957"></a>

<a name="2020956"></a>

<a name="2020955"></a>

<a name="2020954"></a>

<a name="2020953"></a>

<a name="2020952"></a>

<a name="2021022"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raz</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Siread, that's really helpful :) It sounds very similar to the XNA Spritebatch system. I am hoping sorting this sorting won't become too CPU hungry! <br><br></td></tr></table><br>
<a name="2021025"></a>

<a name="2021028"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >siread</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah, that might be an issue if you are drawing lots of images as the sort is done every render. My game only has 5-10 sprites on screen at once so it's not a problem. <br><br>You could probably separate the sort from the render by doing all of your AddImage commands at the end of OnUpdate and doing just one sort there (remembering to clear the list before you start adding). Then call RenderAll (without the sorting or list clearing) during OnRender. <br><br></td></tr></table><br>
<a name="2021030"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jesse</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't know how Diddy sorting but all of the objects don't need to be sorted every frame. Sort everything only once then just sort only the ones that moved and only from it's current position to where it moved to. Sorting should be minimal and fast once the first sort is done. <br><br></td></tr></table><br>
<a name="2021047"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Samah</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> ArrayList uses quicksort, so yes, sorting a list with minor modifications should be fast. <br><br></td></tr></table><br>
<a name="2078572"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raz</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Dragging up an old thread, but relevant :)<br><br><div class="quote"> ArrayList uses quicksort, so yes, sorting a list with minor modifications should be fast. <br></div><br><br>Are there limits to how big an ArrayList can be? Are there realistic limits to how big a list can be when sorting?<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
'This file was edited with Jungle IDE
Import diddy

Class TestApp Extends DiddyApp

	Field testScreen:TestScreen
	
	Method Create:Void()
	
		SetUpdateRate(60)
		
		testScreen = New TestScreen()
		
		drawFPSOn = True
		
		Start(testScreen)
	
	End
End

Class TestScreen Extends Screen
	
	Field iterateTime:Int
	Field sortTime:Int
	Field drawList:ArrayList&lt;TestItem&gt;
	
	Method New()
	
		name = "Test Screen"
		
		drawList = New ArrayList&lt;TestItem&gt;
		
		For Local x:Int = 0 Until 100
			For Local y:Int = 0 Until 100
				Local tTest:TestItem = New TestItem(x * TestItem.W, y * TestItem.H, Rnd(0, 50))
				drawList.AddLast(tTest)
			Next
		Next
		
		Print "What"
		
	End
	
	Method Start:Void()
	
	End
	
	Method Render:Void()
	
		Cls()
		
		iterateTime = Millisecs()
		For Local tT:TestItem = EachIn drawList
			tT.Render()
		Next
		
		iterateTime = Millisecs() -iterateTime
		
		SetColor(255, 255, 255)
		DrawText("Draw Time  : " + iterateTime, 16, 32)
		DrawText("Sort Time  : " + sortTime, 16, 48)
		
	End
	
	Method Update:Void()
	
		If KeyHit(KEY_SPACE)
			For Local tT:TestItem = EachIn drawList
				If Rnd() &lt; 0.5
					tT.y += TestItem.H
				Else
					tT.y -= TestItem.H
				End
			Next
			
			sortTime = Millisecs()
			drawList.Sort()
			sortTime = Millisecs() -sortTime
			Print sortTime
			
		Else
		
			sortTime = Millisecs()
			drawList.Sort()
			sortTime = Millisecs() -sortTime
			
		End
		
	End

End

Class TestItem Implements IComparable

	Const W:Int = 16
	Const H:Int = 16

	Field x:Int
	Field y:Int
	Field z:Int
	
	Method New(x:Int, y:Int, z:Int)
		Self.x = x
		Self.y = y
		Self.z = z
	End
	
	Method Render:Void()
		If x &gt;= 0 And x &lt; DeviceWidth()
			If y - z &gt;= 0 And y - z &lt; DeviceHeight()
				' Would Normally Draw Here
				SetColor(255, 0, 0)
				DrawRect(x, y - z, W, H)
			EndIf
		EndIf
	End
	
	' return 0 if Self is equal to o, a negative number if Self &lt; o, and a positive number if Self &gt; o
	Method Compare:Int(o:Object)
		Return y - TestItem(o).y
	End
	
	' return true if o is Self, or if Compare(o) would normally return 0
	Method Equals:Bool(o:Object)
		Return o = Self Or y = TestItem(o).y
	End

End

Function Main()
	New TestApp()
End
</textarea><br><br>It appears to me that sorting is taking the same time each frame, regardless of whether there were any changes or not. Am I missing something?<br><br>Ideally I would like to store every drawable item in a list and sort by the Y position to draw the items at the back first.<br><br>Cheers :)<br>-Chris <br><br></td></tr></table><br>
<a name="2078570"></a>

<a name="2078571"></a>

<a name="2078579"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> &gt;Are there limits to how big an ArrayList can be? <br><br>Memory.<br><br>&gt;Are there realistic limits to how big a list can be when sorting?<br><br>Sure. Bigger lists take longer to sort. The realistic limit depends on your application, the sort implementation and your comparison function. Are you really going to have a game with 10,000 objects on screen though? :) <br><br>&gt;It appears to me that sorting is taking the same time each frame, regardless of whether there were any changes or not. Am I missing something?<br><br>Quicksort will end up running over the list whether you've made changes or not. An already sorted list might do a bit less swapping but the cost of the partition/comparison operations may well swamp that. If you want to stick with your current method while avoiding a sort overhead when no changes have occurred then you'll need to only call sort when you've made a change.<br><br>As a side note, from your example it looks like Diddy's quicksort implementation isn't smart about data sets with lots of shared values. This is causing performance to be generally bad for your data because you're setting all the y positions to 16 pixel boundaries. <br><br></td></tr></table><br>
<a name="2078577"></a>

<a name="2078589"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nobuyuki</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you have a really enormous amount of objects to sort, may I be allowed to toot my own horn for a sec and point out that Timsort tends to runs faster on pre-ordered data, and I've ported over a <a href="https://github.com/nobuyukinyuu/monkey-timsort" target="_blank">Monkey implementation</a> of it on straight arrays.  According to the original creator of the implementation:  "It has supernatural performance on many kinds of partially ordered arrays (less than lg(N!) comparisons needed, and as few as N-1), yet as fast as Python's previous highly tuned samplesort hybrid on random arrays."<br><br>Comparing best and worst case performance:<br><pre class=code>
'         Timsort       Quicksort
'Worst:   O(n log n)    O(n^2)
'Best:    O(n)          O(n log n) 
</pre><br><br>Because of the mostly-sorted order advantage, Timsort's ideal for sorting Z-Order data.  You can run this algorithm on every update and have a much faster sort speed than Quicksort, particularly if your objects don't change draw order much between updates (as is the case in the majority of update cycles, even with small changes to a camera rotation). <br><br></td></tr></table><br>
<a name="2078588"></a>

<a name="2078594"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >maltic</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> I would recommend using Timsort too. <br><br>Temporal coherence tends to trigger Quicksort's WORST case performance quite often, but alternatively brings out the best in Timsort. You may also be surprised to find that Insertion Sort will probably be the best for Y-Ordering since it will usually be O(n) with almost no overhead, no auxiliary memory needed, and excellent cache coherence. <br><br></td></tr></table><br>
<a name="2078604"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Not to point out the fly in the punchbowl but I'm not that convinced of TimSort's real advantage here. As I've pointed out to Nobuyuki before, his comparison with Diddy's implementation of quicksort makes his version of TimSort look much better than it would against an implementation without some of the overhead Diddy has.<br><br>I've taken Raz's test code and altered it a little to provide some comparison between TimSort and a tweaked version of Diddy's QuickSort. It's runnable at these links: <a href="http://www.stickydesigns.com/monkey/sorttest/flash/MonkeyGame.html" target="_blank">Flash</a> and <a href="http://www.stickydesigns.com/monkey/sorttest/html5/MonkeyGame.html" target="_blank">HTML5</a><br><br>What I've changed:<br><br>* There are now 20,000 items being sorted, just to get reasonable times.<br>* I altered the render to make the visualisation clearer.<br>* The drawlist is now perturbed on each frame according to two settings:<br>    DisturbRatio dictates the percentage of items that get moved (0-100)<br>    DisturbAmount dictates how much they move on average (1-10)<br>* On alternate frames I switch between sort mechanisms and the displayed time is the average over 10 frames, which means it takes 2secs to get a clear value after changing settings.<br>* Fixed diddy's repeat values problem and made it use generic comparators as TimSort. I didn't put in the switch to Insertion sort based on partition size that often gets added for speed though.<br><br>Up and Down changes the ratio. Left and Right changes the amount.<br><br>So, when it starts with no disturbance you see the huge advantage that TimSort has. Which is great, except that it is pretty trivial to just not sort the list if nothing changes. It's also noticeable that we're sorting 20,000 items and quicksort isn't exactly taking a huge amount of time anyway.<br><br>Now up the ratio and see what happens to that advantage. It basically disappears if anything much moves at all. If stuff moves a lot it's worse.<br><br>I'm not saying that TimSort is useless, but I don't see it offering much here (at least on HTML5 and Flash, other targets may well vary. GLFW quicksort performance is terrible, for example.) <br><br></td></tr></table><br>
<a name="2078603"></a>

<a name="2078599"></a>

<a name="2078600"></a>

<a name="2078597"></a>

<a name="2078598"></a>

<a name="2078606"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >maltic</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> I am seeing Timsort perform a lot better when there is a small amount of change frame-to-frame. As I predicted. I think in most games (except really busy ones) you might have a handful of units moving between frames, and perhaps two or three of them swapping Y positions. Especially in an RPG. As such I think your examples are disingenuous in that they don't reflect reality at all.<br><br>Obviously the more random the movement is, and the more of it there is, the better Quicksort does. But Timsort dominates when there is little change between frames (what I believe would be typical of most RPG games). For my own interest, could you try adding Insertion Sort to your example?<br><br>I think the best option (if possible) is some kind of bucket sort, where you keep an array of entities in every position on the tile map, and draw them in order. <br><br></td></tr></table><br>
<a name="2078605"></a>

<a name="2078602"></a>

<a name="2078611"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't know what browser you're look at but that's not what I see, which is part of the problem with duelling algorithms via big O theorising.<br><br>Disingenuous? I'm reflecting Raz's own test. If you arbitrarily state your "reality" is 100,000 items and 100 move per frame then TimSort has an advantage, so what? Is that any actual game either? Even if it was, would you use any kind of full sweep sort to implement that at all? I hope not.<br><br>I uploaded new versions with 1% disturbance steps so you can find it less "disingenuous" if you like. What's the advantage at 1%? I'm seeing TimSort about 6x faster. Amazing! Except the real world time advantage is 5ms and we're sorting 20,000 objects, which we never would be in any reasonable game. Change it to a thousand items and it's a fraction of a millisecond gap. This is not a meaningful difference.<br><br>And no, I won't be adding an Insertion Sort. Why would you want to see which sort is better on such a ridiculously unrealistic and misleading test anyway? <br><br></td></tr></table><br>
<a name="2078610"></a>

<a name="2078609"></a>

<a name="2078608"></a>

<a name="2078607"></a>

<a name="2078615"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >maltic</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> @muddy_shoes I am using the latest version of Chrome on Windows 8.1.<br><br>You seem to be taking this very personally. Of course my opinions are arbitrary, that's pretty much categorically what opinions are. I made that clear. I also offered some sound reasoning for my opinions: Whether or not you agree is up to you, I offer all my advice without a disclaimer. However you may wish to consider what I am saying instead of taking it as an attack--which it isn't. Sorry if I caused offence :(. I'm just trying to help people by sharing what I think might be useful knowledge. I might be wrong, but I'm not forcing anyone to listen!<br><br><div class="quote"> <b>I think</b> in most games (except really busy ones) you might have a handful of units moving between frames, and perhaps two or three of them swapping Y positions. Especially in an RPG.<br><br>(what <b>I believe</b> would be typical of most RPG games)<br><br>As such <b>I think</b> your examples are disingenuous in that they don't reflect reality at all.<br> <br></div><br><br>In my experience a millisecond or two extra is a huge advantage, given you only get 10-20 per frame. Also, My recommendations are not based on Big Oh notation. In fact I am recommending Insertion Sort, which is worst case O(n^2), because I have gathered from experience and empirical testing  that it works very well in this situation: temporal coherence is king, as I keep saying. <br><br></td></tr></table><br>
<a name="2078614"></a>

<a name="2078613"></a>

<a name="2078618"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm not taking it personally, I'm just annoyed at characterising my input as disingenuous when <i>it's based on what the person asking the question put forward</i> and intentionally allows anyone to derive an understanding of where the real world performance balance lies. I don't generally have a lot of patience for people pushing solutions with little attention paid to the actual problem.<br><br>You feel free to recommend switching to a sort (with what available implementation?) to someone based on what? Not on their question, on their given test code or on knowledge of their actual game, but based on your own assessment that they'll be moving a handful of units in some large total? What is that total to make it a noticeable sort time? 5000 elements takes about a millisecond, and the difference is about 0.6ms in HTML5 on my pitiful laptop. Enough to be worth it? Do you think that's a typical number of game units and a typical platform?<br><br>Let's say you do. Let's say that Raz had even come forward with exactly that number. Let's imagine that his post above was then "I'm moving about 50 units every frame out of 5000 that I keep in a big ArrayList that I sort every frame. When I don't move them the sort seems to still take as long. What's up with that?". Is a reasonable response to that question "You should use TimSort/InsertionSort."? Really?<br><br>If Raz is doing that then I put it to you that the answer, even if you decide not to address his question but to address his entire design, isn't to change sort, it's to change datastructure. The fact is that you don't know what he is doing. He could well be intending to have 500 units and they all move like buggery half the time and all stop dead the other half. You have no idea. He's not writing your RPG. <br><br></td></tr></table><br>
<a name="2078617"></a>

<a name="2078616"></a>

<a name="2078623"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nobuyuki</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry that I wasn't able to figure out how to work the demo to test it myself.  Time target at 60fps is 16.6 ms, right?  Under these test conditions and what you've mentioned earlier, a change ratio of 1% over each frame could shave off ~1ms for a screen containing 4000 objects  (I'm extrapolating from the numbers given in a previous post).  If Timsort's 6x faster than Quicksort under the previous conditions as you say, even if that gap narrows at 4000 objects it is a non-trivial difference.  Order sorting's an expensive operation!  I can reasonably imagine a scenario where 4000 objects needing sorting could be blitted at once, and necessary for a number of frames.  I can even imagine a scenario where 20,000 objects would be sorted -- depending on laziness of culling, even with off-screen culling you could easily find yourself in a situation where you'd need to sort that many objects on an isometric tilemap.  But then I guess that starts getting into speed issues in other places, too.<br><br>But in any case I would say the speed difference is non-trivial, and furthermore with the absence of quicksort from Monkey's standard library I don't see why implementing timsort would be any more difficult than implementing an efficient version of quicksort (which I'm assuming you can't just rip out of diddy and get comparable results to the existing timsort implementation, even now).  You can say that you don't see the advantage, muddy, but you pointed the speed differences out yourself, so there must be some other caveat that I'm not seeing which lends to your skepticism.<br><br>Oh, and if you'd like to lend me some of that code to make it a fairer test than the one I devised, I'd be more than happy to add it to the test examples that come with monkey-timsort. <br><br></td></tr></table><br>
<a name="2078622"></a>

<a name="2078621"></a>

<a name="2078620"></a>

<a name="2078631"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >maltic</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> I answered the question as I read it. I guess your interpretation is more valid than everyone else's, and as a result everything they say doesn't answer the question.<br><br><div class="quote"> I am thinking of making a game using an overhead perspective (not top down, slightly at an angle like Zelda 3) <br></div><br>RPG-like game.<br><div class="quote"> Ideally I would like to store every drawable item in a list and sort by the Y position to draw the items at the back first. <br></div><br>Y-Ordering.<br><br>So when you say "it's based on what the person asking the question put forward". I can honestly say the same thing! I may be wrong in my interpretation, but that only makes my answer as valid or invalid as yours.<br><br>Now, let me dissect your post a little, as I feel you are doing me some small injustice, and spreading some misinformation:<br><br>"I'm not taking it personally, I'm just annoyed at characterising my input as disingenuous when it's based on what the person asking the question put forward and intentionally allows anyone to derive an understanding of where the real world performance balance lies. I don't generally have a lot of patience for people pushing solutions with little attention paid to the actual problem."<br><br>This is you simply making an assertion. I made the assertion that I think real world performance lies with leveraging temporal coherence. Why is it OK for you to deride my opinion, but propound your own? Surely it is more useful for the OP, and anyone else looking for answers, to have both posts available. I don't think there is much value is you arbitrating on whose answer is more valid. Do you think the casual poster doesn't have enough brainpower to decide which answer is most relevant to their needs?<br>I never said your input was disingenuous, I said the test scenario was. I think you are making some useful points, and I also believe you are genuinely trying to spread the truth as you see it.<br><br>"You feel free to recommend switching to a sort (with what available implementation?)"<br>Insertion Sort takes about 5 minutes to implement. Here is my code, feel free to use, break, change, or ignore it as best suits you. It was made just for this post:<br><pre class=code>
Class Sort
	Function InsertionSort:Void(arr:Int[])
		For Local i:= 1 Until arr.Length
			Local v:Int = arr[i]
			Local pos:Int = i
			While pos &gt; 0 And v &lt; arr[pos - 1]
				arr[pos] = arr[pos - 1]
				pos -= 1
			Wend
			arr[pos] = v
		Next
	End
End
</pre><br><br>"and the difference is about 0.6ms in HTML5 on my pitiful laptop"<br>0.6ms is 3.6% of a typical frame. You could probably put a bit more eye candy on screen. Every little bit helps!<br><br>It's also actually a realistic scenario to be Y-ordering 10000+ elements. You could be doing a Sweep and Prune type collision detection. You could have a lot of colliding particles, for example. This kind of analysis and discussion is definitely of value, even if it doesn't directly answer OPs question. As you say though: "You have no idea. He's not writing your RPG." So I may as well post anything I think might help.<br><br>"You should use TimSort/InsertionSort"<br>I remember my posts being a little longer than once sentence. I also remember giving some reasons for my suggestions.<br><br>"it's to change datastructure"<br>I already proposed that.<br><div class="quote"> I think the best option (if possible) is some kind of bucket sort, where you keep an array of entities in every position on the tile map, and draw them in order. <br></div> <br><br></td></tr></table><br>
<a name="2078630"></a>

<a name="2078629"></a>

<a name="2078628"></a>

<a name="2078627"></a>

<a name="2078626"></a>

<a name="2078625"></a>

<a name="2078624"></a>

<a name="2078632"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> Spin all you want, maltic. I addressed the question, which was about quicksort behaviour and then, when TimSort was brought up as some blanket "just do this" solution, actually bothered to test against the provided example. I post runnables that allow looking at a range of possible scenarios and give the damning assessment that "I'm not that convinced of TimSort's real advantage here". For this I'm told I'm being disingenuous (Oh no, the test scenario is, not me? That's not how it works) and have to read how off track my thinking is to doubt you because your RPG is somehow what's under discussion. No thanks - filed under "waste of breath". <br><br></td></tr></table><br>
<a name="2078641"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >maltic</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> Look, you can't make "damning assessments" and expect people not the challenge them. Science wouldn't get anywhere if that were the case. Nobody would get anything out of it. I'm also not making an RPG, by the way. I just assumed the OP might be.<br><br>"Oh no, the test scenario is, not me? That's not how it works"<br>My exact words were,<br><div class="quote">  I think your <b>examples</b> are disingenuous <br></div><br><br>I'm not trying to attack you! I don't even know you outside of a pseudonym! Just calm down and be magnanimous. We're all just trying to help people here. <br><br></td></tr></table><br>
<a name="2078638"></a>

<a name="2078639"></a>

<a name="2078640"></a>

<a name="2078636"></a>

<a name="2078637"></a>

<a name="2078633"></a>

<a name="2078634"></a>

<a name="2078635"></a>

<a name="2078642"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> 1. "Damning assessment". You think I mean that literally? I see why maybe we have a problem.<br>2. I am calm enough. Stop inferring tone.<br>3. Look up the word "disingenuous" and consider how it possibly applies to human communications. Did the examples come from the ether? If you say something and I call it a lie am I somehow only referring to the words and you're completely separate from them? <br><br></td></tr></table><br>
<a name="2078643"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >maltic</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nobody is going to get anything meaningful out of two anonymous people arguing semantics over the internet, and that includes us. Pun not intended. <br><br></td></tr></table><br>
<a name="2078664"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raz</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for everyone's responses, it's interesting to read and I appreciate your time.<br><br>Here's a bit more detail in what I was attempting. While not an RPG game, yes it is THAT style of view. Originally Siread suggested that I add all draw operations to a list that gets sorted, drawn and then cleared each frame. On the logic that Quicksorts are not expensive if there hasn't been much change, I was just considering that I add all potentially drawable objects to a list and go from there. Objects would not be randomly darting around the level, so I figured any changes in position would take minimal effort if I maintained the list compared to reordering a potentially erratic list of draw commands each frame. I would be submitting draw requests from many different lists of items, so I think this would quite easily cause the list to start out considerable jumbled up.<br><br>My example of 10,000 items was to exaggerate for the sake of performance monitoring. <br><br></td></tr></table><br>
<a name="2078669"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SLotman</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> Why would you need Z-Ordering/sorting on a Zelda like map? Have you heard of tilemaps?<br>That's what every 2D zelda game uses, alas, almost every 2D game uses it, and needs no sorting whatsoever.<br><br>You just make a for loop, draw the static tiles (stored on a 2D array), then draw everything that moves on top. Simple as that. <br><br></td></tr></table><br>
<a name="2078671"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raz</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> Slotman : There is a simple element of 3d to it. Like I have tree/rock formation tiles but I want the player to be able to walk behind them. Also I want the active objects to be correctly ordered as well. <br><br></td></tr></table><br>
<a name="2078673"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nobuyuki</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> <b>@Raz   </b><br>thanks for your time.  Also... "Active objects",   I haven't heard that one in a while ;)<br><br><b>@muddy_shoes  </b><br>my offer is still open.  I'm sure people could benefit from a Comparator&lt;T&gt; compatible quicksort, and some people might prefer it anyway, so like I said before I'd be more than happy to include it as a test (or at the very least use it to improve the usefulness of my test)<br><br><b>@SLotman  </b><br>tilemaps bake-in their layering, sure, but this presumes you have an object that you can split up into multiple layers to fake the perspective ordering.  This is annoying at best and not practical at worst.  Ordering of sprites is a different story altogether.  Tilemaps with height data that sprites can use (particularly 3/4 isometric but also with orthagonal maps) require either a sorting algorithm to re-arrange the sprite and tilemap layers around for proper occlusion (particularly between sprites), or a series of occlusion layers at each height to obscure sprites.<br><br><img src="http://i.stack.imgur.com/yyUib.png"> <br><br></td></tr></table><br>
<a name="2078672"></a>

<a name="2078679"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raz</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh wow, I didn't realise you were THAT Nobu :D<br><br>Yup, active objects, background obstacles, quick backgrounds, the lot :) <br><br></td></tr></table><br>
<a name="2078692"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raz</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> For what it's worth, I've been messing around with Siread's original suggestion and am using the equivalent of sprite batches now. Even when rendering around 3000 objects, 50 or which move I am getting really good draw and sort speeds. :) My initial worry way back then was the amount of garbage iterating through lists would create, specifically because I was targeting Xbox but that's irrelevant now, seeing as it's an array list and also, I'm not really too fussed about the Xbox anymore!<br><br>Instead of sorting through layers I am just assigning draw commands to individual layers of my choosing. So right now I've got:<br><br>backgroundLayer<br>foregroundLayer<br>effectsLayer<br>guiLayer<br><br>and on a per layer basis I am saying whether I want the stuff sorted or not (useful for the background tile and gui layers). Thinking about it, I can add other checks to the layers, like whether it scrolls and maybe even set layer scissors as well (does Diddy handle scissor scaling when using a virtual res as well?)<br><br>Thanks again everyone :) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
