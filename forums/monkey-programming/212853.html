<!DOCTYPE html><html lang="en" ><head ><title >Need a faster way of doing this..</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Need a faster way of doing this..</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=507" >Monkey Programming</a>/<a href="#bottom" >Need a faster way of doing this..</a><br><br>
<a name="2126748"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paul - Taiphoz</td><td align="right"><font class=tiny>(Posted March)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> So basically the folder I am looking at gets files logged to it, one for every run, as you can imagine the total number of logs does not take long to swell to really big numbers and when this happens my code hang's or appears to hang and most users dont give it a chance to finish so they just alt&amp;F4 and then complain to me that its crashing :)<br><br>The full filename's contain the date and time they were created and the channel name their logging chat into it, so as an example it might look like this "TheCitadel_20170225_102542.txt" I'm only interested in the most recent file of the given name so as per bellow I loop through the directory listing in reverse and return the first occurrence of the file I am looking for, works a treat but as I said struggles when the folder is packed.<br><br><pre class=code>
	Method FindIntel:String(_channelname:String = "TheCitadel")
		'DebugStop
		Local Dir:String[] = LoadDir(Options.logPath)
		Local total:Int = (Dir.Length - 1)
		For Local index:Int = total To 0 Step - 1
			Local str:String = Dir[index]
			If str[0 .. _channelname.Length()] = _channelname Then Return Dir[index]
		Next
		
		Return "false"
	End
</pre> <br><br></td></tr></table><br>
<a name="2126751"></a>

<a name="2126752"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gerry Quinn</td><td align="right"><font class=tiny>(Posted March)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, you should be able to speed things up straight away by using String.StartsWith() instead of slicing and equality testing. <br><br>Though I can't be certain that the string slicing is the problem - if LoadDir() is too slow you might want to look at having subfolders (e.g. a separate folder for each channel).<br><br>You could also look at adding a progress bar or equivalent, so your users will be more patient.  Even if you speed things up by a factor of ten, you'll still have problems when the folder is ten times bigger! <br><br></td></tr></table><br>
<a name="2126759"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TeaBoy</td><td align="right"><font class=tiny>(Posted March)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> As Gerry Quinn suggested, perhaps use sub folders to split things up abit.<br><br>Perhaps sort your log files into sub folders according to date then each file is sorted in chronological order, you<br>could then use a binary search to traverse through the list.<br><br>You could look into the Boyer-Moore string search algorithm. <br><br></td></tr></table><br>
<a name="2126760"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shinkiro1</td><td align="right"><font class=tiny>(Posted March)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is there any reason you can't log to a single file?<br>Usually you could just append the content. Then you can open the file and pick the last entry. <br><br></td></tr></table><br>
<a name="2126763"></a>

<a name="2126764"></a>

<a name="2126765"></a>

<a name="2126766"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dawlane</td><td align="right"><font class=tiny>(Posted March)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Basically what Shinkiro1 said. The fastest method would be to use an index file system when dealing with large amounts of data, but you would have to have a limit to it's size, say a 60 day limit for each entry. The alternative is to go native and use the target systems own file handling system and look for time stamps. <br><br></td></tr></table><br>
<a name="2126770"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paul - Taiphoz</td><td align="right"><font class=tiny>(Posted March)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> This tool is an intel map for EvE Online an MMO space game full of nerds that like killing each other, the game makes the logs so I have no control over that other than prompting the user to clear his logs if there are to many in the dir.<br><br>Within this game players have chat channels specifically for giving intel, the game makes a fresh log file per login per channel saving logs uniquely via the time/date as part of the log filename, so I parse the dir, find the first occurrence of say SomeIntelChannel_##timeDate##.txt and then start parsing its lines for new intel, as the game feeds new lines of text into the log I grab it and update a map.<br><br><a href="https://taiphoz.itch.io/ember-intel" target="_blank">https://taiphoz.itch.io/ember-intel</a> more info here if any of you are curious.<br><br>String.StartsWith(), does this not just slice anyway ? will take a look at it later. thanks for the suggestions guys, its not a massive issue but it is a bit annoying. <br><br></td></tr></table><br>
<a name="2126773"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gerry Quinn</td><td align="right"><font class=tiny>(Posted March)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I can't be sure of every target, but on desktop StartsWith() will call an efficient C library function that doesn't do any memory allocation, just compares the characters of the two strings directly. <br><br></td></tr></table><br>
<a name="2126780"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paul - Taiphoz</td><td align="right"><font class=tiny>(Posted March)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> not tried it yet but will deff give it a go , any speedup will be good. <br><br></td></tr></table><br>
<a name="2126782"></a>

<a name="2126783"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gerry Quinn</td><td align="right"><font class=tiny>(Posted March)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> The code translates to:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
	bool StartsWith( String sub )const{
		return sub.rep-&gt;length&lt;=rep-&gt;length &amp;&amp; !t_memcmp( rep-&gt;data,sub.rep-&gt;data,sub.rep-&gt;length );
	}
</textarea><br><br>So you won't get much faster than that whatever you do. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
