<!DOCTYPE html><html lang="en" ><head ><title >Making something flash white</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Making something flash white</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=507" >Monkey Programming</a>/<a href="#bottom" >Making something flash white</a><br><br>
<a name="2073928"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi all, I want to make an alien that is hit flash pure white.<br><br>Currently I draw a second image over the top with additive blend set to 1. This makes it brighter but not pure white.<br><br>A dev friend who uses openGL says he does this:<br><br>"I used GL_EXT_secondary_colour for that, and set it to add 255,255,255,0 thus turning every pixel white but leaving alpha alone"<br><br>Does anyone know if it's possible to do that in Monkey without a module tweak? Or do you have an alternative method (I'd rather not a create a pure white image duplicate of every game graphic)?  Or have you made a decent module modification to handle that?<br><br>Many thanks in advance! <br><br></td></tr></table><br>
<a name="2073979"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gerry Quinn</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't believe it is possible in Monkey.  It seems like something that would be system dependent. <br><br></td></tr></table><br>
<a name="2073989"></a>

<a name="2073990"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Could you create the white images on the fly using ReadPixels/WritePixels? <br><br></td></tr></table><br>
<a name="2074013"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SLotman</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> As the prefix says, GL_EXT_secondary_colour is a OpenGL extension, so I doubt it will work on things like HTML5/Flash. iOS/Android/GLFW probably, with tweaks on mojo, or calling opengl directly on your program.<br><br>As any OpenGL extension, you first would have to enumerate all extensions, check if it is available, before using it. If some ugly hardware doesn't support it, then you're out of luck. To see how this is done, you could check miniB3D on BlitzMax, it does extensions enumeration on initialization. <br><br></td></tr></table><br>
<a name="2073991"></a>

<a name="2074015"></a>

<a name="2074016"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Capn Lee</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I had a try at doing this but the problem with using readpixels is you can't read from an image, only from the buffer. InvaderJim made a module that could do this <a href="http://monkeycoder.co.nz/Community/post.php?topic=3482&amp;post=36720" target="_blank">here</a> so it would be pretty simple to do using the module, but it's quite old now and there's always the chance it no longer works.<br><br><br>I don't know if it will work with what you're doing, but you can set color higher than 255, that would white out a lot of the texture but still nothing that is pure black. maybe SetColor(1000,1000,1000) and make all pure blacks dark grey? <br><br></td></tr></table><br>
<a name="2074018"></a>

<a name="2074019"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gerry Quinn</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can draw the image you want to flash in the buffer and read it from there.<br><br>Of course that's not really much different from creating a set of white images. <br><br></td></tr></table><br>
<a name="2074020"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Capn Lee</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> wouldn't that run you in to a problem if the image had any transparencies? it would be fine for pixel art but surely you could only get away with it otherwise by removing all red, green or blue from the image, right? <br><br></td></tr></table><br>
<a name="2074021"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gerry Quinn</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah, you'd need some way to determine transparency. I guess a set of white images is probably the best approach. <br><br></td></tr></table><br>
<a name="2074022"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks all! It's actually for an iOS game that I test on PC, so both are using OpenGL. So in theory a mod tweak would be nice and safe if the target was checked first.<br><br>Set of white sprites is a pretty massive pain to make and doubles memory use unless I find a better texture format on iOS (and that's another hassle in itself).<br><br>I certainly could try using high values for SetColor but I'm not sure if that would work as I assumed that somewhere in the graphics pipeline it would get truncated to 255. <br><br></td></tr></table><br>
<a name="2074024"></a>

<a name="2074025"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gerry Quinn</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> I would think a set of white sprites would be relatively easy, so long as they are in decent size sheets.  In Paint Shop Pro I would just make a completely white image, then copy the sprite-sheet alphas to it.<br><br>[Of course I don't use a texture packer, so maybe that is an issue for you.] <br><br></td></tr></table><br>
<a name="2074033"></a>

<a name="2074034"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nobuyuki</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> I haven't messed around with gles11 much yet, but if it can interact with mojo you can draw the sprite to the stencil buffer and blit a white rect along the sprite's bounding box. <br><br> I also wrote a module to handle this called nDrawExts but it's only been tested on glfw. It might work on iOS but it won't work on anything else right now (and I don't plan on updating it - though it may be rewritten from scratch in purer monkey later on with gles11...) <br><br></td></tr></table><br>
<a name="2074202"></a>

<a name="2074203"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shinkiro1</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> With shaders that would be really easy as you would just set every pixel to white.<br>Except we don't know how long before they get implemented. <br><br></td></tr></table><br>
<a name="2074520"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Shaders+1 <br><br></td></tr></table><br>
<a name="2074530"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just curious, if this is from the TA port, isn't that written via an OpenGL layer? How it is done in the original code should be applicable in Monkey. <br><br></td></tr></table><br>
<a name="2074542"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yep it's for the TA port. I have the original code but I don't want to modify modules ideally. Was just wondering if people had found a cool way to do it in Monkey yet but the answer seems to be no. <br><br></td></tr></table><br>
<a name="2074562"></a>

<a name="2074563"></a>

<a name="2074565"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nobuyuki</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> &gt;Was just wondering if people had found a cool way to do it in Monkey yet but the answer seems to be no. <br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Import mojo
Import opengl.gles11

Function Main:Int()
	New Game()
End Function

Class Game Extends App
	Field img:Image
	Field toggle:Int
	Const alpha_threshold:Float = 0.5
	
	Method OnCreate()
		SetUpdateRate 60
		img = LoadImage("SplashIcon.png")
	End Method
	
	Method OnUpdate()
		
	End Method
	
	Method OnRender()
		Flush()
		glClear(GL_STENCIL_BUFFER_BIT)
		Flush()
		Cls()
		
		toggle = 1 - toggle
		
		If toggle = 1 Then
			DrawImage(img, 8, 8)
		Else
			'Enable the stencil
			Flush()
			glClearStencil(0)
			glEnable(GL_STENCIL_TEST)

			'Draw to the stencil
			SetDrawToStencil(True)
				DrawImage(img, 8, 8)
			SetDrawToStencil(False)
			
			'Draw inside the stencil now.
			DrawRect(8, 8, img.Width, img.Height)
			
			'Disable the stencil
			Flush()
			glStencilOp(GL_KEEP, GL_KEEP, GL_KEEP);
			glDisable(GL_STENCIL_TEST);
		End If
	End Method
	
	'Summary:  Allows blitting directly to the stencil when enabled.
	Function SetDrawToStencil(enabled:Bool)
		If enabled
			glAlphaFunc(GL_GREATER, alpha_threshold)
			glEnable(GL_ALPHA_TEST)
			
			glColorMask(False, False,False,False)
		    glStencilFunc(GL_ALWAYS, 1, 1)
    		glStencilOp(GL_REPLACE, GL_REPLACE, GL_REPLACE)
		Else
			Flush()
			glAlphaFunc(GL_ALWAYS, 0)
			glDisable(GL_ALPHA_TEST)

			glColorMask(True, True, True, True)
		    glStencilFunc(GL_EQUAL, 1, 1)
			glStencilOp(GL_KEEP, GL_KEEP, GL_KEEP)
		End If
	End Function
End Class

'There's probably some way around this but otherwise sorry
Extern
#If LANG="cpp"
	Function Flush:Void() = "bb_graphics_device-&gt;Flush"
#ElseIf LANG="java"
	Function Flush:Void() = "bb_graphics.g_device.Flush"
#EndIf</textarea><br><br>merry xmas :P<br><br><b>Edit:</b>  Works on OpenGL targets only obviously <br><br></td></tr></table><br>
<a name="2074581"></a>

<a name="2074582"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wow awesome thanks! Will try it out. iOS is OpenGL but I wonder which version of Flush it needs. Probably the cpp one.<br><br>Do you know if it's fast or slow btw? <br><br></td></tr></table><br>
<a name="2074649"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nobuyuki</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> No idea of the speed on mobile.  Only ever tried it on GLFW.  Tried it on Android the other day, seemed fast enough although tbqh I didn't measure it. <br><br></td></tr></table><br>
<a name="2074655"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok thx! Well hopefully I'll find out soon. <br><br></td></tr></table><br>
<a name="2074662"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nobuyuki</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> let me know if it's a good speed.  On my Nexus S, changing blend modes seemed to create slowdown after blitting about 30 times a renderloop.  Perhaps alpha testing on the stencil buffer is faster. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
