<!DOCTYPE html><html lang="en" ><head ><title >Avoid copying all data to build folder each time?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Avoid copying all data to build folder each time?</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=507" >Monkey Programming</a>/<a href="#bottom" >Avoid copying all data to build folder each time?</a><br><br>
<a name="2078814"></a>

<a name="2078815"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is there a way to stop Monkey from copying all the data folder contents to the build folder every time I hit compile? It's beginning to slow down my compile process now as I've got &gt;1000 images (yes I know they should be in a texture atlas).  Also I'm paranoid about it wearing out my SSD drive.<br><br>Is there some obvious setting for only overwrite if new or something I can use? Thx.<br><br>I should add that there's a big assumption on my part that this is what is causing the slow down, but it's based on some threads I read quite a while ago and something I heard from another monkey dev about it being slow as the project data grows.  So I could be totally wrong about this and something else is slowing down. <br><br></td></tr></table><br>
<a name="2078818"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MikeHart</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> In one way or the other you would have file access. Being it copying the files or first compare them and only copy them if they have a new time stamp. <br><br>Btw. I never heard about an option to just build the code. <br><br></td></tr></table><br>
<a name="2078820"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Aw shame. <br><br></td></tr></table><br>
<a name="2078829"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Monkey's build mechanism is generally dumb about avoiding redoing bits that don't need it. The whole thing is clunky and needs an overhaul. I wouldn't worry too much about your SSD though. These days all SSDs are rated for tens of gigabytes of data writes a day for years. <br><br></td></tr></table><br>
<a name="2078835"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AdamRedwoods</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>The whole thing is clunky and needs an overhaul. <br></div><br>+1. won't happen until after mojo-x comes out.<br>i would opt for a light interpreter for build scripts, so we wouldn't need to re-build trans every time. somethign like mini-c, but with a monkey syntax.<br><br><div class="quote"> Is there a way to stop Monkey from copying all the data folder contents to the build folder every time I hit compile? <br></div><br>there may be a way for DESKTOP targets. you can point your asset loaders to a folder outside of the .data folder. i think if you use a hard path "c:/assets/image.jpg" monkey should pick it up, and keep your .data folder empty. <br><br></td></tr></table><br>
<a name="2078834"></a>

<a name="2078833"></a>

<a name="2078832"></a>

<a name="2078841"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Aman</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Adam is right but not only desktop targets as LoadImage support loading from a file for the following targets: Android, iOS, Win8, Glfw. For iOS and Android you could even load images from the internet which is also supported in html5.<br><br>Muddy Shoes, I won't be sure about that, monkey does some avoiding redoing which is why we sometimes need to delete the project files every now and then in order to get them to work with the latest version of monkey. <br><br></td></tr></table><br>
<a name="2078845"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> The fact that Monkey is incapable of detecting an old build directory and appropriately regenerating/replacing the base files is part of the clunkiness. I certainly wouldn't call it smart behaviour. Monkey doesn't appear to do any checking for changes in the game/app project files as can be seen if you run something without making any changes. A smart build process would just launch it again, Monkey rebuilds the whole thing. <br><br></td></tr></table><br>
<a name="2078852"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nobuyuki</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> you know, this seems like an easy fix.  We don't care about the security of the implementation, so we could just accept a newer "last modified" date from the filesystem as the criteria for re-copying, no hashing or crc necessary.... <br><br></td></tr></table><br>
<a name="2078872"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yahfree</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> You could modify transcc/builder.monkey and include some sort of "ignore" blacklist of files to not copy. <br><br></td></tr></table><br>
<a name="2079171"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Bumping this in case Mark hasn't seen it.<br><br>I'm compiling 100s times a day a large commercial project and this is driving me a bit nuts. I've got a very fast PC and just upgraded my SSD to an even faster one but the build times are still quite slow especially compare to BlitzMax build times which are lightening fast.<br><br>Would really love it if a simple last modified date check could be added for Desktop apps anyway (as that's the one I think most people use to code and test their apps with before making final builds for other targets).  It could even be controlled with a compiler flag (or option in the IDE) if people were worried about it being always on. <br><br></td></tr></table><br>
<a name="2079928"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> This should be relatively easy to do, will have a look into it soon. <br><br></td></tr></table><br>
<a name="2079938"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> (as that's the one I think most people use to code and test their apps with before making final builds for other targets). <br></div><br>I would think the HTML5 target is the main one people test/develop with as it is super quick to compile and test :) <br><br></td></tr></table><br>
<a name="2079940"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >rIKmAN</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> I use the HTML5 target to to test as like therevills says it's super quick (FastHTML5 posted in a thread on here).<br><br>However even using the "fast" target with the alpha and color changes in my game I have started to use GLFW as it runs like a dog in HTML5 now the project has grown a fair bit. <br><br></td></tr></table><br>
<a name="2080026"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gerry Quinn</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah, I only use GLFW when I need the full debug.  That and Android are the slowest compile. <br><br></td></tr></table><br>
<a name="2080147"></a>

<a name="2080149"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >nikoniko</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> <b>Yahfree wrote:</b><br><div class="quote"> You could modify transcc/builder.monkey and include some sort of "ignore" blacklist of files to not copy. <br></div><br><br>I have changed builder.monkey v1.60 to fix subject.<br>At the begin of method CreateDataDir comment DeleteDir to avoid delete all data folder<br><br><pre class=code>	
Method CreateDataDir:Void( dir:String )
		dir=RealPath( dir )
	
		'DeleteDir dir,True
		CreateDir dir
		</pre><br><br>Add new function <br><pre class=code>Function CopyFileUpdate:Void(p:String, t:string)
  
  If FileTime(p) &gt; FileTime(t) Or FileSize(p) &lt;&gt; FileSize(t)
    CopyFile p,t
  Endif
  
End Function</pre><br><br>and replace in the same method calls CopyFile() function to CopyFileUpdate()<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">Method CreateDataDir:Void( dir:String )
		dir=RealPath( dir )
	
		'DeleteDir dir,True
		CreateDir dir
		
		Local dataPath:=StripExt( tcc.opt_srcpath )+".data"
		
		If FileType( dataPath )=FILETYPE_DIR
		
			Local srcs:=New StringStack
			srcs.Push dataPath
			
			While Not srcs.IsEmpty()
			
				Local src:=srcs.Pop()
				
				For Local f:=Eachin LoadDir( src )
					If f.StartsWith( "." ) Continue

					Local p:=src+"/"+f
					Local r:=p[dataPath.Length+1..]
					Local t:=dir+"/"+r
					
          
					
					Select FileType( p )
					Case FILETYPE_FILE
						If MatchPath( r,DATA_FILES )
              CopyFileUpdate p,t
              dataFiles.Set p,r
						Endif
					Case FILETYPE_DIR
						CreateDir t
						srcs.Push p
					End
				Next 
			
			Wend
		
		Endif
		
		For Local p:=Eachin app.fileImports
			Local r:=StripDir( p )
			Local t:=dir+"/"+r
			If MatchPath( r,DATA_FILES )
				CopyFileUpdate p,t
				dataFiles.Set p,r
			Endif
		Next
		
	End</textarea><br><br>Build it, move to Monkey/bin folder, rename it to transcc_winnt.exe (keep old file of course)<br>Test it with extra jpg files in the data folder - it's fast!<br><br>I use MS VC++2010. Build file is correct for test HTML5. It fails when I try build new version of transcc (GLFW target). <br><br></td></tr></table><br>
<a name="2080043"></a>

<a name="2080099"></a>

<a name="2080100"></a>

<a name="2080101"></a>

<a name="2080102"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, this is now in v78b<br><br>Nice work nikoniko, mine's about the same! I've also added a 'delete dead data' pass, where it goes through the stuff in the target project data dir and makes sure it's meant to be there, deleting it if not.<br><br>This means deleting data from your app .data dir will also remove it from the target .data dir. Ditto, changing data file type filters will update target data dir.<br><br>Should this be optional? It shouldn't add any major overhead, and without it your data dir could end up with junk in it over time... <br><br></td></tr></table><br>
<a name="2080109"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >nikoniko</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> <b>marksibly wrote:</b><br><div class="quote"> This means deleting data from your app .data dir will also remove it from the target .data dir. <br></div><br><br><br>Great! I thought about synchro option when going to sleep :)<br><br>Optional? I am not sure. It's real build speed up feature. Maybe as option to turn off it. <br><br></td></tr></table><br>
<a name="2080145"></a>

<a name="2080146"></a>

<a name="2080148"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bazmonkey</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> (havent tested it yet) but is there an argument for using FileTime( src )&lt;&gt;FileTime( dst ), e.g. when putting an older version of a file back in the data folder you still want it copied across. Also deals with any weird time differences between machines. Bit risky to only copy 'newer' files (?). Or did I miss something - I assume FileTime is modified time. Should be a handy feature though. <br><br></td></tr></table><br>
<a name="2080144"></a>

<a name="2080143"></a>

<a name="2080142"></a>

<a name="2081367"></a>

<a name="2081368"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> @therevills I use GLFW mainly because my games compiled as HTML 5 just run like crap due to Alpha blending and other effects, plus I often need Debug. Oh and I hate the sound delay too. <br><br></td></tr></table><br>
<a name="2081369"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> @GA - What browser do you use? With the latest Chrome version I don't often have an issue with FPS. <br><br></td></tr></table><br>
<a name="2081484"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> Firefox. Perhaps that's why. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
