<!DOCTYPE html><html lang="en" ><head ><title >StringMap&lt;Image&gt; for texture atlas?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >StringMap&lt;Image&gt; for texture atlas?</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=507" >Monkey Programming</a>/<a href="#bottom" >StringMap&lt;Image&gt; for texture atlas?</a><br><br>
<a name="2048241"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nobuyuki</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello,<br><br>I'm afraid I'm a bit unfamiliar with big-O notation, so I don't really have any idea how much slower O(log2) is than a normal direct reference to a variable whose name is known would be.  Is a StringMap&lt;Image&gt; fast enough to be acceptable for use in large texture atlases?  The largest I'd imagine one of these atlases being in theory would be 1024 keypairs, but most likely there will be less than 64 keypairs per atlas.  <br><br>This is for a mobile project, if that helps.  The key lookup would occur every time an Image would be needed for a DrawImage function.  (Would this even negate out the speed advantage from using a texture atlas on mobile devices?)<br><br>Any general advice would be appreciated, especially from anyone who's maybe tested this themselves and/or profiled it... <br><br></td></tr></table><br>
<a name="2048242"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> The key lookup would occur every time an Image would be needed for a DrawImage function. <br></div><br><br>Why do you need to do this? Retrieving a value from a Map isn't a problem, doing it repeatedly when you don't have to may well be. Why do you have to retrieve your images by key on every draw? <br><br></td></tr></table><br>
<a name="2048256"></a>

<a name="2048257"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tibit</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I haven't found the Maps to be slow, even if used a lot every frame.<br><br>You use texture atlases to reduce render calls and minimize memory, so it has little to do with the CPU as far as I know.<br><br>Here is a good video that explains that and shows Texture Packer in use: <a href="http://youtu.be/Qhq4COk_QyU?t=3m23s" target="_blank">http://youtu.be/Qhq4COk_QyU?t=3m23s</a> (3min explination)<br><br>However it is very simple for you to just save a reference to the image, if this would ever be something you measure with a profiler and find to be a concern.<br><br>I'd say watch for creating new objects during gameplay is a bigger thing. Not because is drags performance, but because it can later trigger the garbage collector - that can be seen as noticeable lag.<br><br>Some say Pre-Optimization is the root of all... <br><br></td></tr></table><br>
<a name="2048366"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nobuyuki</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>Why do you need to do this? Retrieving a value from a Map isn't a problem, doing it repeatedly when you don't have to may well be. Why do you have to retrieve your images by key on every draw? <br> <br></div><br><br>I suppose this is true; I could define new Image variables as fields of the object that needs them, and set them to reference the value from the key I want in the object's ctor, but I figured this would negate out some of the convenience of having the texture packer's metadata available, which lends itself well to a Map (specifically, a Map&lt;String,Image&gt; where the string is the name the packer uses to refer to the texture, and the image is a GrabImage of the piece).  Is the extra step of putting the values from a map into design-time Image variables a normal part of picking images out of an image atlas?<br><br><div class="quote"> <br>I'd say watch for creating new objects during gameplay is a bigger thing. Not because is drags performance, but because it can later trigger the garbage collector - that can be seen as noticeable lag.<br> <br></div><br><br>Thanks, I've been keeping an eye out for it, too, since the pitfalls of that are already well-known here.  I've seen topics on aggressive atlassing to reduce GPU thrash on the forums, but since I haven't done lots of DrawImage calls with different textures in my render order, I haven't run into much of a noticeable slowdown (the biggest ones seem to be with blitting large textures in general).  My big concern would be running into a situation where a number of calls to Map.Get become non-negligible in the renderloop. <br><br></td></tr></table><br>
<a name="2048369"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I can't say that I follow where you're getting your concepts of convenience/inconvenience from. <br><br>In my libs I have an ImageAtlas class. This can load a TexturePacker JSON file and internally construct a String-&gt;Image map (there's a bit more to it, but that's mostly what it does). I can then simply call atlas.GetImage("subimagename") and get the relevant subimage.<br><br>However, there's no need to call that retrieval function every time I render the image. Visual elements just get the image references they need, store them in local fields and then use those. I'm not clear on what convenient metadata you think is lost by doing this. <br><br></td></tr></table><br>
<a name="2048445"></a>

<a name="2048446"></a>

<a name="2048447"></a>

<a name="2048448"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nobuyuki</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> You're right, of course.  There's no reason to not just pop the reference into a field variable -- It just took me a while to come to the same conclusion :)<br><br>Now if only there were an overload of GrabImage that let us specify FrameWidth/FrameHeight...... <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
