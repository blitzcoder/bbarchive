<!DOCTYPE html><html lang="en" ><head ><title >STDCPP GC?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >STDCPP GC?</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=507" >Monkey Programming</a>/<a href="#bottom" >STDCPP GC?</a><br><br>
<a name="2097993"></a>

<a name="2097994"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >nullterm</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Quickie, looking at doing a standalone server for multiplayer (linux hosted) and from looking at the forum, it sounds like STDCPP doesn't garbage collect, is that still true?<br><br>Ideally, I'd like to write game logic once in Monkey and have that work both on client and server for simulation and validation.<br><br>Is it possible to manually garbage collect like Blitz did prior? <br><br></td></tr></table><br>
<a name="2097992"></a>

<a name="2098027"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GW_</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Look at the Monkey docs relating to #CPP_GC_MODE. <br><br></td></tr></table><br>
<a name="2098028"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Pharmhaus</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>Quickie, looking at doing a standalone server for multiplayer (linux hosted) and from looking at the forum, it sounds like STDCPP doesn't garbage collect, is that still true?<br> <br></div><br><br>STDCPP uses a different garbage collector as the default (glfw) one but it has a GC as usual.<br><br><div class="quote"> <br>Is it possible to manually garbage collect like Blitz did prior?<br> <br></div><br>Since it's not the same GC as in Blitz freeing resources might be delayed even if you null them.<br>In case you use resources which provide a Discard() method you can try to free resources this may as it is internally implemented and GC unrelated. <br><br></td></tr></table><br>
<a name="2098029"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >nullterm</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks!  Did a test...<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">#CPP_GC_MODE=0

Function Main:Int()
	Local count:Int = 0
	While True
		Print "alloc " + count + " " + count * 4 + "meg"
		Local p:Int[] = New Int[1000000]
		count += 1
	Wend
	Return 0
End</textarea><br><br>#CPP_GC_MODE=0 (no gc) results in a crash after 2 gigs, clearly hitting the 32bit memory limit.<br><br>#CPP_GC_MODE=1 (gc after OnX, doesn't apply to stdcpp) also crashes at 2 gigs.<br><br>#CPP_GC_MODE=2 (gc on New) runs fine. Watching in the Task Manager, it hovers between 8meg and 12meg of memory.<br><br>So <b>#CPP_GC_MODE=2</b> is the way to go for stdcpp targets. <br><br></td></tr></table><br>
<a name="2098030"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, it's explained in documentation. CPP_GC_MODE=1 happens after every OnWhatever (so requires Mojo, and it's after evey OnUpdate, OnRender, etc.) Mode 2 is a regular generational GC for all other kind of tools <br><br></td></tr></table><br>
<a name="2098034"></a>

<a name="2098035"></a>

<a name="2098036"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImmutableOctet(SKNG)</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> The standard C++ target (STDCPP) uses the exact same garbage collector as any other standard C++ based target (GLFW, GLFW3, and from what I remember, iOS), the only difference is the default mode. The garbage collector works fine these days on STDCPP, but back before V71, garbage collection was not an option. This has changed, and it means you can write your own long-running software without any issues. I for one use that target for language tests, debugging, and of course, dedicated servers. It's a great target, and it's used by Monkey's compiler.<br><br>That being said, the garbage collector does not work the same on all targets. Along with the different GC modes for each target, there's also different garbage collectors. For example, the standard Android targets use the system's GC (Dalvik or the new ART platform, depending). The Windows 8/8.1 targets use Microsoft's, which is basically the same as .NET. And of course, the XNA target uses C#'s standard garbage collection (In other words, .NET). There's also Flash, which is generally going to be one of Adobe's implementations. And of course, JavaScript garbage collection is very implementation-oriented. For example, Google's V8's garbage collection is actually pretty nice. That's also system/browser dependent, though. You get the idea; Monkey's underlying GC is target dependent.<br><br>The best thing to do is to understand what you're targeting, and to build your program with that as a guideline. In this case, that's STDCPP (C++ Tool), meaning the garbage collector's the standard Monkey implementation, which is quite fast on most systems. I had no major issues using it, even on embedded systems like the Raspberry Pi. If you're planning on running this server of yours on a system with little memory, then you should probably look into the garbage collection settings. You set the mode, but there's also <a href="https://github.com/blitz-research/monkey/blob/3e3d1418c297b72f3f75d65ca67c5ddd1fc93b4f/VERSIONS.TXT#L599" target="_blank">more-advanced settings for Monkey's standard GC</a> if you're interested. The 'CPP_GC_MAX_LOCALS' ('GC_MODE' must be set to 2 for this; I'd also recommend using mode 2 for this kind of application) and 'CPP_GC_TRIGGER' (Number of bytes to allocate in order to trigger collection) preprocessor variables are very useful for limiting memory consumption.<br><br>As far as memory models go, I wrote <a href="http://www.monkey-x.com/Community/posts.php?topic=9321" target="_blank">some posts on this thread a little while ago</a>, but that'd be more of an interesting read, than anything else to you. That post was also about standard game-oriented development. Servers running with Monkey's standard GC have fewer problems with more drastic memory environments, and your "time-step" / maximum "garbage footprint" is usually a lot less "fixed" (You don't need to render and update an entire scene in the same way). <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
