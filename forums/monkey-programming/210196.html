<!DOCTYPE html><html lang="en" ><head ><title >Can We Determine Where The Bottleneck Is?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Can We Determine Where The Bottleneck Is?</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=507" >Monkey Programming</a>/<a href="#bottom" >Can We Determine Where The Bottleneck Is?</a><br><br>
<a name="2112884"></a>

<a name="2112888"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GarBenjamin</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> <b>THIS HAS BEEN RESOLVED!</b><br><br><br>This issue is present in all 3D rendered games on both my new and old laptop regardless of whether it is a 2D game in Unity, Monkey X or GLBasic. Apparently, it is just a symptom of modern 3D rendering.<br><br>One thing I did resolve was the anti-aliasing that was present on moving objects.<br>@therevills reminded me of the floating point issue (again tied to 3D rendering) so I simply used the same kind of code I had in my Unity projects to set the rendered position to even pixels. In fact, I went one better and did what I should have done originally... multiplied the movement to 2 pixel increments to match the low res display.<br><br>I do wish we could still do true 2D blitting instead of having to do 3D for everything but it is what it is.<br><br>Now I am thinking what would happen if all rendering is done to a target image first then only that single image is rendered to the display?<br><br>This may be a way to achieve a non-blurred display of moving objects. Assuming everything really is rendered in 1 frame (60 FPS or so).<br><br>-----------------------------------------------<br>ORIGINAL POST<br><br>Hey all.<br><br>I am wondering if anyone has any idea why the Monkey X programs are not running at 60 FPS or more. <br><br>I keep thinking we were getting 60 FPS over a decade ago in Blitz on much weaker hardware.<br><br>Does anyone know where the bottleneck is? is it in the graphics rendering or something in the update phase? Normally I'd first suspect the rendering but cannot imagine how that could be possible on these modern machines. Even if the graphics were being entirely software rendered they should be running fast as hell these days.<br><br>I have seen the audio cause delays in some frameworks in the past so perhaps that is something to consider as well.<br><br>So... the question is why are we not getting at least 60 FPS in our 2D Monkey X games (particularly on desktop)? <br><br></td></tr></table><br>
<a name="2112838"></a>

<a name="2112837"></a>

<a name="2112839"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Neuro</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just wondering, what kind of fps you getting? Do you have an nVidia graphics card? <br><br></td></tr></table><br>
<a name="2112856"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GarBenjamin</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just from eyeballing it about 30 fps. Almost seems like it is locked to 30 fps. I will check again after work but I believe every example banana is the same regardless of complexity. Everything has that slight blur when in motion where 60 FPS or more always looks very crisp and clean.<br><br>Yes. My <a href="http://us.msi.com/product/nb/GT70-Dominator-GTX-970M.html" target="_blank">laptop</a> (MSI GT70 Dominator-2295 2.5 GHz, 16 GB RAM, <b>GeForce GTX 970M</b>) is a gaming powerhouse... for a laptop. Obviously not as powerful as a desktop gaming computer but it is quite good. <br><br></td></tr></table><br>
<a name="2112855"></a>

<a name="2112854"></a>

<a name="2112853"></a>

<a name="2112852"></a>

<a name="2112845"></a>

<a name="2112844"></a>

<a name="2112843"></a>

<a name="2112842"></a>

<a name="2112841"></a>

<a name="2112858"></a>

<a name="2112859"></a>

<a name="2112860"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GarBenjamin</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> <b>UPDATE:</b><br><br>I had an idea wondering if perhaps it is not actually running slow (all of the FPS counters in examples and other MX stuff I have tried shows 60 to 61 FPS) and perhaps there is some kind of anti-aliasing going on.<br><br>What I discovered is very interesting! I took a screenshot of my game with the player standing still. Then I took a screenshot with the player moving. In the still shot everything is sharp with 24 total colors as expected. In the shot taken while moving some of the graphics are blurred. Examining it I see the images that are in motion are anti-aliased and the screenshot has 98 colors as a result.<br><br>The really interesting thing is it is only the graphics that are actually moving. The player, spiders and so forth are anti-aliased only when they move.<br><br>Normally I'd expect a screenshot to always be sharp and non anti-aliased regardless of if it is taken from a 30 fps rendering or a 60 fps rendering. So basically something is making these games / examples anti-alias only moving graphics.<br><br><img src="http://garsgames.com/screenshots/FGVDM/NoMotionVsMotion.png"><br><br>It may possibly be some "feature" of my monitor or perhaps the rendering system in Monkey X. Whatever it is this is what makes the stuff appear like it is running at 30 fps. It creates a slight blur effect to the moving objects.<br><br>I will continue to investigate. Also, if someone doesn't mind testing it take a screenshot of one of your Monkey X games with the player standing still and then take one while the player is moving and see if you get the same effect. <br><br></td></tr></table><br>
<a name="2112857"></a>

<a name="2112861"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you are moving via floats you will get that effect.<br><br>Try adding this preprocessor at the top of your main file:<br><pre class=code>#MOJO_IMAGE_FILTERING_ENABLED="false"</pre> <br><br></td></tr></table><br>
<a name="2112862"></a>

<a name="2112863"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GarBenjamin</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> @therevills<br><br>Ah thank you! I actually already had that but that explains it perfectly. I ran into the same thing in Unity. I guess even Monkey X (and probably everything else these days) is ultimately rendering everything in 3D.<br><br>I should have realized that but I kept thinking it was actually doing true 2D blitting for some reason. lol<br><br>I can fix this issue no problem now that I know what it is. Thanks again! <br><br></td></tr></table><br>
<a name="2112864"></a>

<a name="2112865"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GarBenjamin</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Alright that issue is fixed! And indeed now even in motion nothing is anti-aliased.<br><br>Unfortunately, objects still have the blur effect while moving. The faster they are moving the more of a blur they have. Taking a screenshot however revealed there is no anti-aliasing going on to cause it now.<br><br>So now it does seem to indeed be the frame rate. It reminds me so much of seeing games back in the Amiga days running at 30 fps compared to games running at 60 fps. <br><br>I will keep digging into it. I'd like to sort it out before I start on my Christmas game next week. <br><br></td></tr></table><br>
<a name="2112866"></a>

<a name="2112867"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nobuyuki</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> <strike>Try the latest experimental version of Monkey.  There was an issue with polling joysticks which caused the framerates to drop dramatically on some people's machines.</strike><br><br>I saw in the other thread that you tried this already.  Maybe try an Angle build with a Mojo2 project and see if you have the same issue.  Some graphics card drivers aren''t friends with OpenGL... <br><br></td></tr></table><br>
<a name="2112868"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GarBenjamin</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Nobuyuki I can give that a try. I don't know anything about Mojo 2 (or even mojo for that matter other than I import it and the methods are all very familiar because they are the same I was using in Blitz years ago). I'm guessing that will mean just rewriting the rendering piece of my game. There are only two methods in the entire game that actually draw anything so it shouldn't be too much work to convert. I will do that tomorrow. Thanks for the tip! :) <br><br></td></tr></table><br>
<a name="2112869"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Have you outputted the FPS? <br><br></td></tr></table><br>
<a name="2112873"></a>

<a name="2112874"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GarBenjamin</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> @therevills No, I have not. Because the FPS counters in the examples always show 60 to 61 FPS and yet the display does not support that number. When everything is updating in 1 frame the graphics look sharp, there is no blur to moving objects. No stutter, etc.<br><br>@Nobuyuki I had a little time to look into Mojo2 but seems like it is a bit different from Mojo using canvas and no image frame rendering and so forth. Probably not too big of a deal at all but more than I can get into now because I am going to sleep in about 5 minutes.<br><br>However, instead of spending time converting to Mojo2 without knowing if there is any benefit in doing so I decided to simply test the Mojo2 bouncy aliens example.<br>I removed the scaling, rotation and animation so it would be very easy to see.<br><br>I also set the number of aliens to only 25. And they all move with the blur and also have a sort of stutter / jerkiness to them. It seems that on my laptop Mojo 1 actually performs better than Mojo 2.<br><br>That is great to know though so I don't waste time converting over to Mojo 2! I'd have been an unhappy campy if I converted it all over only to find it was worse than Mojo 1! LOL! ;)<br><br>Anyway, thanks guys for throwing out ideas. I appreciate it. I don't know what the issue is. Do you all see crystal clear displays on your computer?<br><br>Like with the Mojo2 Bouncy Aliens if you just use the basic canvas.DrawImage with only the alienframe(0), Int(x), Int(y) and 25 aliens... is it a crisp display with no blur or jerkiness?<br><br>I am just trying to figure out it if it is something with my laptop and Monkey X graphics or if it is something with Monkey X graphics period. <br><br></td></tr></table><br>
<a name="2112870"></a>

<a name="2112871"></a>

<a name="2112872"></a>

<a name="2112875"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmmm... could it be the display on the laptop itself? Do you get it with any "proper" games? <br><br></td></tr></table><br>
<a name="2112877"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bitJericho</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Unfortunately, objects still have the blur effect while moving. The faster they are moving the more of a blur they have.  <br></div><br><br>This is probably your monitor. This is known as "ghosting." This effect is non-existent on CRTs and Plasma displays. If you were to have such a thing lying around you could test it <br><br></td></tr></table><br>
<a name="2112881"></a>

<a name="2112882"></a>

<a name="2112883"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GarBenjamin</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> @bitJericho I wondered about that too. It may well be my new laptop monitor.<br>I am much more likely to notice it in my own stuff. I don't recall seeing the effect in other games though. It's possible it was there and I just paid no mind to it. Probably because I expect better results from myself than things I get. lol<br><br>My next step is to play all of the 2D games I normally do and pay close attention to see if they have the same ghosting while in motion. I noticed it in the GLBasic and Monkey X version of my Mars Explorer test game. However, I started on all of this exploring of other dev kits right at the time I got my new laptop. So there is a definite possibility because I have been so busy developing trying out different languages that it is not these other languages actually causing the blur but my new laptop monitor itself. Which would be idiotic for them to have a monitor do that in my opinion but since everything is geared toward 3D these days and that is not noticeable, at least not nearly to the degree due to the view, in 3D games it is possiible it is a "feature" of the monitor. lol <br><br></td></tr></table><br>
<a name="2112885"></a>

<a name="2112886"></a>

<a name="2112887"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GarBenjamin</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> I tested thoroughly and this issue is present in all 3D rendered games on both my new and old laptop regardless of whether it is a 2D game in Unity, Monkey X or GLBasic. Apparently, it is just a symptom of modern 3D rendering.<br><br>I can live with that as long as it is just the way it is. I thought maybe I was doing something wrong in my code to cause Mojo to do it. One thing was entirely on me the lack of locking the movement to integer pixel boundaries. Updated the original post here. <br><br></td></tr></table><br>
<a name="2112895"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SLotman</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Have you tried to draw your images with a .5 offset?  Something like Drawimage image, Int(x+0.5), Int(y+0.5)<br><br>It could be a subpixel rendering problem... <br><br></td></tr></table><br>
<a name="2112894"></a>

<a name="2112896"></a>

<a name="2112900"></a>

<a name="2112901"></a>

<a name="2112902"></a>

<a name="2112903"></a>

<a name="2112904"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GarBenjamin</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> @SLotman I will give that a try but I don't think it will make any difference because it is not just my games but other people's MX games, Unity 2D games and so forth . I am now using Integer values for all positions and that removed the anti-aliasing. I think it is just the way it is with 3D rendered stuff these days. I've tested on 3 machines now different things in Unity, Monkey X and so forth and they all have the blur. It is probably something most people don't even notice.<br><br>This is a perfect example of how people can get hyper critical of their own stuff then start looking into it and "go down a rabbit hole". I never even noticed that all of the other 2D games whether in GameMaker Studio, Unity or whatever all have that blurred look. I noticed it only in my game and then started paying attention and noticed it in other MX games and demos then in Unity games and basically everything. It is probably directly related to me having used laptops for may years now. Yet in my mind I always remember things being crisp and clean. I would have drove myself insane trying to achieve something that is probably technically impossible in this case. Ha ha ha! ;)<br><br>Anyway glad that's sorted out. I got to start thinking about my Chrstmas game. Want to start on it next week for sure so I have time to do it justice. Thank you all for listening to my crazy rambling and trying to help out. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
