<!DOCTYPE html><html lang="en" ><head ><title >IntMaps creating junk</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >IntMaps creating junk</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=507" >Monkey Programming</a>/<a href="#bottom" >IntMaps creating junk</a><br><br>
<a name="2032107"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raz</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've noticed that through XNA and Android, iterating through an IntMap causes a lot of junk. (I will say though, this is literally the only thing that causes junk when I run my game through XNA, which is pretty damn impressive :)<br><br><pre class=code>
For Local t:Int = EachIn ThisMap.Keys()
    ThisMap.Get(t).Draw(X,Y)
Next
</pre><br><br>Am I right in thinking that I can't really use any list type structures without creating junk?<br><br>Is a 1d array the only real alternative? <br><br></td></tr></table><br>
<a name="2032108"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> You could change the iterator so that you can hold a reference and reset it rather than creating a new one every loop via the EachIn. <br><br></td></tr></table><br>
<a name="2032109"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raz</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ahh so have a field in the parent class that is "ThisMap.Keys" (whatever type of object that is)? <br><br></td></tr></table><br>
<a name="2032112"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> One level down. You'd hold onto a KeyEnumerator returned by ThisMap.Keys().ObjectEnumerator(). You also need to change the KeyEnumerator code so that you can reset it back to the start before using it to loop. The enumerator will have to hold a reference to the map so it can call FirstNode(). <br><br></td></tr></table><br>
<a name="2032114"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raz</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Got ya :) I'll give this a look when I get home thanks! <br><br></td></tr></table><br>
<a name="2032115"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paul - Taiphoz</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> would like to see your code once you figure it out if thats alright. <br><br></td></tr></table><br>
<a name="2032116"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raz</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've been thinking about it actually, and as the list doesn't change its size or order at all during run time, I think I probably only need to use a simple 1d array (that I resize as required during initialisation). As long as no junk gets created during the game, I am not fussed :)<br><br>I just chucked this together quickly to be used with my code when I get home.<br><br>[monkeycode]<br>Import mojo<br><br>Class TestApp Extends App<br><br>	Field NMData:MapUnit[][]<br><br>	Method OnCreate()<br>		SetUpdateRate(5)<br>		NMData = New MapUnit[10][]<br>		For Local y:Int = 0 To 9<br>			NMData[y] = New MapUnit[20]<br>			For Local x:Int = 0 To 19<br>				NMData[y][x] = New MapUnit()<br>				<br>				' Randomly create between 1 and 7 layers<br>				' for this specific map tile<br>				Local Target:Int = Rnd(1,8)<br>				For Local i:Int = 0 To Target<br>					NMData[y][x].SetTile(i,i,i)<br>				Next<br>				<br>			Next<br>		Next<br>		<br>		<br>	End<br>	<br>	Method OnUpdate()<br><br>	End<br>	<br>	Method OnRender()<br>		Cls<br>		For Local y:Int = 0 To 9<br>			For Local x:Int = 0 To 19<br>				SetColor(64,64,64)<br>				DrawRect(x*16,y*16,15,15)<br>				SetColor(255,255,255)<br>				NMData[y][x].Draw(x * 16,y * 16)<br>			Next<br>		Next	<br>	End<br><br>End<br><br>Function Main()<br>	New TestApp<br>End<br><br>Class MapUnit<br><br>	Field MapUnitTiles:MapUnitTile[]<br>	' Is this tile an obstacle or not?<br>	Field IsObstacle:Bool<br>	' The main type this tile is (grass/sand/tress)<br>	Field MainType:Int<br>	' How many tiles are to be drawn for this Map unit?<br>	Field MUTCount:Int<br>	<br>	Method New()<br>		MapUnitTiles = New MapUnitTile[0]<br>		MUTCount = 0<br>		MainType = -1<br>		IsObstacle = False<br>	End<br>	<br>	Method SetTile:Void(tT:Int,tX:Int,tY:Int)<br>	<br>		Local length:Int = MapUnitTiles.Length()<br>		MapUnitTiles = MapUnitTiles.Resize(length + 1)<br>		MapUnitTiles[length] = New MapUnitTile(tX,tY)<br>		MUTCount = length + 1<br>		<br>		If tT &gt; MainType<br>			MainType = tT<br>		End<br>	<br>	End<br>	<br>	Method Draw:Void(X:Int,Y:Int)<br>		For Local i:Int = 0 Until MUTCount<br>			MapUnitTiles[i].Draw(X,Y)<br>		Next<br>	End<br>	<br><br>End<br><br>Class MapUnitTile<br><br>	' Will be used to hold the draw locations on the sprite atlas<br>	Field DX:Int<br>	Field DY:Int<br>	<br>	Method New(tX:Int,tY:Int)<br>	<br>		DX = tX<br>		DY = tY<br>	<br>	End<br>	<br>	Method Draw:Void(X:Int,Y:Int)<br>		' Pixel drawn with an offset to demonstrate multiple layers<br>		DrawRect(X+(DX * 2),Y,1,1)<br>	End<br><br>End<br><br>[/monkeycode] <br><br></td></tr></table><br>
<a name="2032119"></a>

<a name="2032120"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Keeping a local copy of the enumerator will make it impossible to nest for-each loops of the same map. I would not recommend it. Maybe a reusable stack for iterators would be much safer, but a bit more complex <br><br></td></tr></table><br>
<a name="2032168"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raz</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just got it running and for what I am doing a 1D array is absolutely fine :) Glad it was a relatively simple solution.<br><br>Have to admit though, I slightly shamed myself because I then thought I had to do some quite elaborate coding to reverse the order of said arrays to make sure items are drawn correctly..... before realising I could just go through the array backwards... :B<br><br>Very happy to have absolutely no garbage being created which is very important for Xbox releases <br><br></td></tr></table><br>
<a name="2032173"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tibit</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah, Arrays seems to be the way to go to avoid garbage.<br><br> You can of course create your own "List" that wraps the Array to get a more dynamic and robust "ArrayList".<br><br>The Diddy Framework has some great collection classes worth checking out :) <br><br></td></tr></table><br>
<a name="2032174"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raz</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh pants, I forgot about the ArrayList of Diddy!<br><br>I did notice that performance on Android improved when I stopped using IntMaps and assume this is because of the garbage being created. <br><br></td></tr></table><br>
<a name="2032176"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Keeping a local copy of the enumerator will make it impossible to nest for-each loops of the same map. <br></div><br><br>Not at all. You just have another enumerator instance for the nested loop if you need it. <br><br></td></tr></table><br>
<a name="2032177"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shinkiro1</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can also keep the IntMap for quick lookups and use the array for iterating.<br><br>Recently I have thought about replacing Lists with Stacks because they use arrays internally.<br>Also you don't have to use an enumerator because there is the Get(index) method and they resize dynamically. <br><br></td></tr></table><br>
<a name="2032178"></a>

<a name="2032179"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Samah</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> The enumerator for ArrayList lets you go back and forward and has a Reset method. You can call Remove to delete the last call to NextObject or PreviousObject, and it keeps track of the state of the list so that you don't get weird concurrency issues. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
