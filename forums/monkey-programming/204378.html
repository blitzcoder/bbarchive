<!DOCTYPE html><html lang="en" ><head ><title >Converting coordinates between matrix and pixels</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Converting coordinates between matrix and pixels</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=507" >Monkey Programming</a>/<a href="#bottom" >Converting coordinates between matrix and pixels</a><br><br>
<a name="2046607"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I need a way to translate a 2D vector representing a device pixel (x and y) to the current whatever transformed matrix, and a way to calculate backwards too. I need this for JungleGui, so it should be possible to calculate all this without modifing Monkey and in a transparent way. You know, Mojo users that add Jungle Gui should have to be able to use it without having to modify previous code.<br><br>Any suggestions? Am I missing anything? <br><br></td></tr></table><br>
<a name="2046608"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dragon</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> ?<br><br>screen pixel x,y  to  transformed matrix x,y<br>is inversed transformation:<br><a href="http://www.monkeycoder.co.nz/Community/posts.php?topic=1992#39366" target="_blank">http://www.monkeycoder.co.nz/Community/posts.php?topic=1992#39366</a><br><br>backwards what you mean is normal transformaton using normal matrix math (same that use mojo - see SetMatrix() or so) <br><br></td></tr></table><br>
<a name="2046609"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> But how can I get all the matrix that are on the matrix stack? should I loop through them or something? I've been coding for hours so I think I'm missing something damn easy somewhere <br><br></td></tr></table><br>
<a name="2046610"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dragon</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> every transformation is based on prev. transformation (multiplied matrices)<br><br>i do not know how this can be useful - or for what<br>push&amp;pop is a good technique <br><br></td></tr></table><br>
<a name="2046612"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >benmc</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Off Topic: I was trying to buy JungleIDE today, and on the checkout page, even tho I had all the fields filled in, it kept saying that I needed to fill in the red required fields and wouldn't let me buy it :( <br><br></td></tr></table><br>
<a name="2046613"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok so getting latest transformation matrix I cold just multiply somehow the X and Y vector and get the appropriate transformed vector, isn't it?<br><br>@benmc: I don't know what can be happening, it might be an issue with the Avangate checkout page or something? Let me know so I can contact them, if you have more problems <br><br></td></tr></table><br>
<a name="2046615"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Skn3</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Does this help?<br><br><a href="http://www.monkeycoder.co.nz/Community/posts.php?topic=617" target="_blank">http://www.monkeycoder.co.nz/Community/posts.php?topic=617</a> <br><br></td></tr></table><br>
<a name="2046622"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tibit</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I wrote a Transform class that I think might be doing what you want. I use it for my scene-node system that connects to the camera.<br><br>To get the "global" transform I save it in each node.<br><br>Do all transforms for each element, and each children then render. Then save the transform as you render it.<br><br>PushMatrix()<br>Render()<br>GlobalMatrix.transform = GetMatrix() 'GlobalMatrix is of the Transform Class below<br>RenderChildren()<br>PopMatrix()<br><br>To get an object's world location I'd go:<br>myObject.GlobalMatrix.X<br><br>To get an object's world rotation I'd go:<br>myObject.GlobalMatrix.Angle<br><br>To get an object's world scale I'd go:<br>myObject.GlobalMatrix.ScaleX<br><br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Import mojo

'	Function Transform(ix:Float, iy:Float, jx:Float, jy:Float, tx:Float, ty:Float)	
'	ix = scale * rotation cos(a)
'	iy = rotation -sin(a) (* scale)
'	jx = rotation sin(a) (* scale)
'	jy = scale * rotation cos(a)
'	tx = translate x
'	ty = translate y

' Mark's Wisdom:
' I like to think of the transform as a stack of ops, eg:
' translate x, y
' rotate r
' scale h,v
'...means 'scale by h,v' THEN 'rotate by r' THEN 'translate by x,y'.

'Also, image handles add another wrinkle. The 'correct' order of transforms for a rotated/scaled image with a non-0 handle is:
'translate draw_x, draw_y
'rotate draw_rot
'scale draw_scalex,draw_scaley
'translate -handle_x,-handle_y
'...can drawimage 0,0 now...


Class Transformation

Public
	'Const degree:float = 180 / 3.14;
    'Const radian:float = 3.14 / 180;

	Field transform:Float[] =[1.0, 0.0, 0.0, 1.0, 0.0, 0.0] 'SetToIdentityMatrix

	Method SetValues:Void(ix:Float, iy:Float, jx:Float, jy:Float, tx:Float, ty:Float)
		transform[0] = ix
		transform[1] = iy
		transform[2] = jx
		transform[3] = jy
		transform[4] = tx
		transform[5] = ty
	End
	
	Method SetToIdentity:Void()
		SetValues(1.0, 0.0, 0.0, 1.0, 0.0, 0.0)
	End
	
	Method AttachTo:Void(addMatrix:Transformation)
		'	Translate addMatrix.HandleX, addMatrix.HandleY ' Change origin before attaching?
		Multiply(addMatrix.transform) 'Multiply
	End
	
	Method SetProperties:Void(x:Float, y:Float, rotation:Float, scaleX:Float, scaleY:float)
		SetToIdentity 'reset
		Self.Translate x, y
		Self.Rotate rotation
		Self.Scale scaleX, scaleY
	End
	
	'Rotate the Matrix
	Method Rotate:Void(angle:Float)
		Multiply Cos(angle), -Sin(angle), Sin(angle), Cos(angle), 0, 0
	End
	
	Method Translate(x:Float, y:Float)
		Multiply 1, 0, 0, 1, x, y
	End
	
	Method Scale(x:Float, y:Float)
		Multiply x, 0, 0, y, 0, 0
	End
	
	Method Multiply(m:Float[])
		Multiply m[0], m[1], m[2], m[3], m[4], m[5]
	End
	
	Method Multiply(ix:Float, iy:Float, jx:Float, jy:Float, tx:Float, ty:Float)
		Local ix2:Float = ix * transform[0] + iy * transform[2]
		Local iy2:Float = ix * transform[1] + iy * transform[3]
		Local jx2:Float = jx * transform[0] + jy * transform[2]
		Local jy2:Float = jx * transform[1] + jy * transform[3]
		Local tx2:Float = tx * transform[0] + ty * transform[2] + transform[4]
		Local ty2:Float = tx * transform[1] + ty * transform[3] + transform[5]
		SetValues ix2,iy2,jx2,jy2,tx2,ty2
	End	
	
	'ToDo Shearing, Reflection, Orthogonal projection
	
	Method SetMatrix:Void()
		graphics.SetMatrix(transform)
	End
		
	Method Transform:Void()
		graphics.Transform(transform)
	End
	
	Method X:Float() Property
		Return transform[4]
	End
	Method Y:Float() Property
		Return transform[5]
	End
	
	Method X:Void(x:Float) Property
		transform[4] = x
	End
	Method Y:Void(y:Float) Property
		transform[5] = y
	End
	
	Method Angle:Float() Property
		Local angle:Float = ATan2(transform[2], transform[0]);
		If angle &lt; 0 Then angle += 360
		If angle &gt;= 360 Then angle -= 360
		Return angle
	End
	
	Method ScaleX:Float() Property
		Return Sqrt( (transform[0] * transform[0]) + (transform[2] * transform[2]));
	End
	Method ScaleY:Float() Property
		Return Sqrt( (transform[1] * transform[1]) + (transform[3] * transform[3]));
	End
	
End
</textarea><br><br>Took me a while to figure it out. If you can find use for it feel free to use however you like :)<br><br>Let me know if you want the sceneNode and Camera as well. <br><br></td></tr></table><br>
<a name="2046621"></a>

<a name="2046648"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> if you use GetMatrix and save the results to an array<br>you can actually get the x and y coordinates<br><br>I think its local matrix[]:Float =GetMatrix()<br><br>screen_x:Int=matrix[3]<br>screen_y:Int=matrix[4]<br><br>I might have the array indices wrong, you can experiment to get the right ones. <br><br></td></tr></table><br>
<a name="2046651"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tibit</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think it should be:<br><br>screen_x = transform[4]<br>screen_y = transform[5]<br><br>(see my code above, it does exactly that!) <br><br></td></tr></table><br>
<a name="2046675"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> First of all, thanks for all the info, samples and help. It's very apreciated!<br><br><div class="quote"> I think it should be:<br><br>screen_x = transform[4]<br>screen_y = transform[5]<br><br>(see my code above, it does exactly that!)  <br></div><br>As I understand this, this would give the translation coordinates of the current Matrix, won't they? I would also need to take into account rotation and scaling (and shearing if any).<br><br>I think I did not explained properly what I'm after.<br><br>What I do really need (not sure if it was explained properly) is this:<br><br>When a user clicks the mouse on the canvas (or touches it), I want to know WHERE it has been clicked inside the logical transformed coordinates, instead of having the device pixels information. And a way to get calculate back, given a logical location, get the device pixel of this logical location.<br><br>Any help on this? I'm a bit lost as it's been a long time since I used transformation matrixs <br><br></td></tr></table><br>
<a name="2046674"></a>

<a name="2046702"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Samah</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> You need to apply the current transformation matrix to convert world-to-screen.<br><br><a href="http://en.wikipedia.org/wiki/Transformation_matrix" target="_blank">http://en.wikipedia.org/wiki/Transformation_matrix</a><br><br>Try something like this (untested) where sx,sy = screen x,y and wx,wy = world x,y:<br>[monkeycode]Local mat:Float[] = GetMatrix()<br>Local wx:Float = sx * mat[0] + sy * mat[2] + mat[4]<br>Local wy:Float = sx * mat[1] + sy * mat[3] + mat[5][/monkeycode]<br>To convert screen-to-world (which is what you want, I think), you will need to do the same thing, but with the inverse matrix.<br><br><a href="http://stackoverflow.com/questions/12715447/how-to-create-an-inverse-transformation-matrix" target="_blank">http://stackoverflow.com/questions/12715447/how-to-create-an-inverse-transformation-matrix</a><br><a href="https://github.com/libgdx/libgdx/blob/master/gdx/src/com/badlogic/gdx/math/Matrix3.java" target="_blank">https://github.com/libgdx/libgdx/blob/master/gdx/src/com/badlogic/gdx/math/Matrix3.java</a> <br><br></td></tr></table><br>
<a name="2046700"></a>

<a name="2046699"></a>

<a name="2046698"></a>

<a name="2046695"></a>

<a name="2046693"></a>

<a name="2046694"></a>

<a name="2046822"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Samah: It did not work, not sure why, also, I'm not sure if the Monkey matrix is row centric or columnb centric. Whatever, I've realised that Scissor commands are not scaled by the matrix, so my GUI can't be scaled properly without failing on the rendering state, unless I calculate the scrissor scaling and find a magic wey to allow subpixel viewports, wich doesn't exist on OpenGL AFAIK, so JungleGUI will automatically render always at pixel level, no mather what transforms are applied to the world.<br>I'm just adding current matrix to the stack, replacing it with a 1,0,0,1,0,0 matrix, and to the GUI stuff, then remove the matrix from the stack so the process is "transparent" to any program using Jungle Gui.<br><br>That said, I miss a world to device and device to world conversion commands on Mojo. If you want to interact with mouse/touch vectors and world vectors, it is a PITA right now. <br><br></td></tr></table><br>
<a name="2046816"></a>

<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
