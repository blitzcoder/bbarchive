<!DOCTYPE html><html lang="en" ><head ><title >Delegates</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Delegates</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=507" >Monkey Programming</a>/<a href="#bottom" >Delegates</a><br><br>
<a name="2030408"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Anybody else is missing delegates a lot? Without function pointers, this would be a killer feature for me... <br><br></td></tr></table><br>
<a name="2030439"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Samah</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Try using MethodInfo.Invoke(). I plan on using it for scripting in the near future. There's already a thread regarding this. I'll give you a link and a code example when I'm not on the bus. :-)<br><br>Edit: Here's the thread, and the code sample post:<br><a href="http://www.monkeycoder.co.nz/Community/posts.php?topic=2645#26659" target="_blank">http://www.monkeycoder.co.nz/Community/posts.php?topic=2645#26659</a><br><br>Edit 2: Copy pasted the Monkey code:<br>[monkeycode]Class Foo<br>	Method someMethod:Void()<br>		...<br>	End<br>	<br>	Method bar:Void()<br>		' somesel is a selector/fp for the "someMethod" method in class Foo<br>		Local somesel:MethodInfo = GetClass(Self).GetMethod("someMethod", [])<br>		' equivalent to calling: Self.someMethod()<br>		somesel.Invoke(Self, [])<br>	End<br>End[/monkeycode] <br><br></td></tr></table><br>
<a name="2030435"></a>

<a name="2030437"></a>

<a name="2030442"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> But you need to keep a pointer to the class and isn't a invoke function a dispatch-like call that's a lot slower than a regular call? Other than that it might do its job... <br><br></td></tr></table><br>
<a name="2030444"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Samah</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> What do you mean "a pointer to the class"?  Also, reflection in Monkey is very different to most other languages.  Invoke is basically just a wrapper that directly calls the relevant method on the object.  There's no fancy lookups to be done, and it's all precompiled (unlike Java, etc.) <br><br></td></tr></table><br>
<a name="2030456"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> a pointer to the class, sorry... I was refering to a class reference. I didn't know it was a direct call to the class, that's great. Anyway, I'm working on a sort of events system so a reflection based approach can be a valid option as it is not very very imprtant if it is slightly slower than a traditional old-school pointer. <br><br></td></tr></table><br>
<a name="2030455"></a>

<a name="2030631"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tibit</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think I'm on the same line as Ziggy. Reflection works as a hack-around, but had downsides. What I want is a simple event system to loosen coupling in code.<br><br>I want one class to be able to have "output" events/methods/functions/delegates that can be called within that class. Any number of "external" classes can hook/listen to these "events" and the result will be a direct synchronous invocation (normal invocation).<br><br>The only difference from a normal method call is that the event is "hooked" in runtime. This means that no hard depenancy needs to exist between the classes. <br><br>This is a simple language-based workaround to the ObserverPattern - without the downside of having to create a lot of extra classes.<br><br>Delegates are (the way I see it) events but without the "one to many" aspect. Meaning each delegate (function/method pointer) only calls/points to one function/method.<br><br>And with delegates, it would be simple to create fancy, effective and easy to use event systems. And there are also other uses of delegates, though no good example come to mind right now. <br><br></td></tr></table><br>
<a name="2030632"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> And there are also other uses of delegates, though no good example come to mind right now.  <br></div>Very useful on classes design when you want a given class to perform an action depending on its state, you can just modify the address (method pointer) of the given abstracted method. For instance, on lexing designs, it is common to use a delegate to parse "next token" and the address of this method is changed when we're inside a comment, or inside a Extern block, or any other place where code has to be parsed differently, so we do not end with a huge unmanagebla select-case statement, and we can get an easier to maintain class structure that also is much more abstracted and allows additional implementations with easy. <br><br></td></tr></table><br>
<a name="2030634"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tibit</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Events with Interfaces (Working running example)<br>[monkeycode]<br>Function Main:Int()<br>	Local ship:SpaceShip = new SpaceShip<br>	Local fighter:Fighter = new Fighter<br>	ship.Fire = fighter<br>	' Fighter &amp; ship knows about interface OnFireEvent	<br>	<br>	Print "start"<br>	ship.UpdateControls()<br>	Print "end"<br>End<br><br>Interface OnFireEvent<br>	Method OnFire:Void(weapon:string, power:Int)  'If someone binds this - that method will fire<br>End<br><br>Class SpaceShip<br><br>	Field Fire:OnFireEvent 'uses the interface<br><br>	Method UpdateControls:Void()<br>		If True<br>			'Let us fire<br>			Local weapon:String = "Laser"<br>			Local power:Int = 5<br>			Print "Ship: Ready to fire!"<br>			if Fire Then Fire.OnFire(weapon, power)<br>		EndIf<br>	End<br>	<br>End<br><br>Class Fighter implements OnFireEvent 'implements interface<br>	Field Energy:Int = 100<br>	<br>	Method OnFire:Void(weapon:string, power:Int)<br>		If Energy &gt; power<br>			Print "Fighter: Firing " + weapon + " using " + power + " energy."<br>		EndIf<br>	End<br>End[/monkeycode]<br><br>Example how the same code could look using "events or delegates". (Code not runnable, yet)<br>[monkeycode]Function Main:Int()<br>	Local ship:SpaceShip = new SpaceShip<br>	Local fighter:Fighter = new Fighter<br>	ship.Fire = fighter.OnEnemyFire<br>	' Fighter knows nothing about ship<br>	' However once the ship.Fire method is called<br>	' then fighter.OnEnemyFire is called<br>	' if the methods does not match, error when we bind<br>			<br>	Print "start"<br>	ship.UpdateControls()<br>	Print "end"<br>End<br><br>Class SpaceShip<br><br>	Event Method Fire:Void(weapon:String:int, power) ' Many other equivalent forms of syntax possible<br><br>	Method UpdateControls:Void()<br>		If True<br>			'Let us fire<br>			Local weapon:String = "Laser"<br>			Local power:Int = 5<br>			Print "Ship: Ready to fire!"<br>			if Fire Then Fire(weapon, power)<br>		End<br>	End<br>End<br><br>Class Fighter<br>	Field Energy:Int = 100<br>	<br>	' Called upon using Event/Delegate<br>	' Name of this method does not matter<br>	Method OnEnemyFire:Void(weapon:string, power:Int)<br>		If Energy &gt; power<br>			Print "Fighter: Firing " + weapon + " using " + power + " energy."<br>		EndIf<br>	End<br>End[/monkeycode]Is that how you guys see it could work? Any additional differences between interfaces/reflection approach/delegates? <br><br></td></tr></table><br>
<a name="2030639"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tibit</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> EDIT - I got it working using reflection as well:<br>[monkeycode]Import reflection<br><br>Function Main:Int()<br>	Local ship:SpaceShip = new SpaceShip<br>	Local fighter:Fighter = new Fighter<br>	<br>	Print "start"<br>	<br>	'Hook event<br>	Local onFireEvent:MethodInfo = GetClass("Fighter").GetMethod("OnEnemyFire", [StringClass, IntClass, GetClass("WeaponSlot")], false)<br>		<br>	if onFireEvent Then Print "onFireEvent Hooked"<br>	ship.FireMethod = onFireEvent<br>	ship.FireInstance = fighter<br>	' Fighter &amp; ship are unrelated<br>	<br>	ship.UpdateControls()<br>	Print "end"<br>End<br><br><br>Class SpaceShip<br><br>	Field FireMethod:MethodInfo 'uses reflection<br>	Field FireInstance:Object 'also need this for reflection<br><br>	Method UpdateControls:Void()<br>		If True<br>			Print "Ship: Ready to fire!"<br>			if FireMethod And FireInstance<br>				'Let us fire<br>				Local weapon:String = "Laser"<br>				Local power:Int = 5<br>				Local weaponSlot:WeaponSlot = new WeaponSlot<br>				weaponSlot.ID = 101 ' Test<br>				Local argumentsArray:Object[] = [BoxString(weapon), BoxInt(power), weaponSlot]<br>				<br>				FireMethod.Invoke(FireInstance, argumentsArray) ' Call event<br>			else<br>				Print "event not hooked"<br>			End<br>		EndIf<br>	End<br>	<br>End<br>Class WeaponSlot<br>	Field ID:Int = 999<br>End<br><br>Class Fighter<br>	Field Energy:Int = 100<br>	<br>	Method OnEnemyFire:Void(weapon:string, power:Int, weaponSlot:WeaponSlot = null)<br>		If Energy &gt; power<br>			Print "Fighter: Firing " + weapon + " using " + power + " energy."<br>			if weaponSlot Then Print "using slot " + weaponSlot.ID<br>		EndIf<br>	End<br>End[/monkeycode] <br><br></td></tr></table><br>
<a name="2030635"></a>

<a name="2030642"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tibit</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is my attempt, does run, but does not work as expected - something wrong with the reflection hook. <br>[monkeycode]<br>Import reflection<br><br>Function Main:Int()<br>	Local ship:SpaceShip = new SpaceShip<br>	Local fighter:Fighter = new Fighter<br>	<br>	Print "start"<br>	<br>	'Hook event<br>	Local onFireEvent:MethodInfo = GetClass("Fighter").GetMethod("OnEnemyFire", []) 'ERROR<br>	if onFireEvent Then Print "onfireEvent Hooked"<br>	ship.FireMethod = onFireEvent<br>	ship.FireInstance = fighter<br>	' Fighter &amp; ship are unrelated<br>	<br>	ship.UpdateControls()<br>	Print "end"<br>End<br><br><br>Class SpaceShip<br><br>	Field FireMethod:MethodInfo 'uses reflection<br>	Field FireInstance:Object 'also need this for reflection<br><br>	Method UpdateControls:Void()<br>		If True<br>			Print "Ship: Ready to fire!"<br>			if FireMethod And FireInstance<br>				'Let us fire<br>				Local weapon:String = "Laser"<br>				Local power:Int = 5			<br>				Local argumentsArray:Object[] = [BoxString(weapon), BoxInt(power)]<br>				<br>				FireMethod.Invoke(FireInstance, argumentsArray) ' Call event<br>			else<br>				Print "event not hooked"<br>			End<br>		EndIf<br>	End<br>	<br>End<br><br>Class Fighter<br>	Field Energy:Int = 100<br>	<br>	Method OnEnemyFire:Void(weapon:string, power:Int)<br>		If Energy &gt; power<br>			Print "Fighter: Firing " + weapon + " using " + power + " energy."<br>		EndIf<br>	End<br>End[/monkeycode]Can you see what it is?<br><br>EDIT - I found it:<br><br>Error was that <br>Local onFireEvent:MethodInfo = GetClass("Fighter").GetMethod("OnEnemyFire", []) 'ERROR<br><br>Should be:<br>Local onFireEvent:MethodInfo = GetClass("Fighter").GetMethod("OnEnemyFire", [StringClass, IntClass]) <br><br></td></tr></table><br>
<a name="2030636"></a>

<a name="2030646"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have a complete GUI system that implements an event-poll using reflection and it works wonderfuly. i'll release it soon under an open source license.<br>Just a small taste of it:<br><br>[monkeycode]Import junglegui<br>Import reflection<br><br><br>Class EventDelegate<br>	Field control:Control<br>	Field signature:Int<br>	Field methodName:String<br>	Field callBack:MethodInfo <br>	<br>	Method New(form:TopLevelControl, control:Control, signature:Int, methodName:String)<br>		<br>		Local argTypes:=New ClassInfo[2]<br>		argTypes[0] = GetClass(New Control)<br>		argTypes[1] = GetClass(New EventArgs)<br>		Local myclass:=GetClass(form)<br>		callBack = myclass.GetMethod(methodName, argTypes)<br>		self.control = control<br>		Self.signature = signature<br>		Self.methodName = methodName<br>	End<br>	<br>	Method Invoke(form:TopLevelControl, sender:Control, e:EventArgs)<br>		Local arguments:Object[] = New Object[2]<br>		arguments[0] = sender<br>		arguments[1] = e<br>		callBack.Invoke(form,arguments)<br>	End<br>	<br>	Method Match:Bool(control:Control, signature:Int)<br>		if control = Self.control And signature = Self.signature Then Return True Else Return false<br>	End<br>End<br><br>Class EventHandler<br>	Method New(form:TopLevelControl)<br>		_form = form	<br>	End<br>	Method Add:Bool(control:Control, signature:Int, methodName:String)<br>		Local delegate:=New EventDelegate(_form,control,signature,methodName)<br>		if delegate.callBack = null Then Return false<br>		list.AddLast(delegate)<br>	end<br>	Method Remove:Bool(control:Control, signature:Int, methodName:String)<br>		Local remover:EventDelegate = FindSpecific(control,signature,methodName)<br>		if remover&lt;&gt; null Then<br>			list.Remove(remover)<br>			Return true<br>		Else<br>			Return false<br>		EndIf<br>	end<br>	Method FindSpecific:EventDelegate(control:Control, e:EventArgs, methodName:String)<br>		Local result:EventDelegate = null<br>		For Local delegate:EventDelegate = EachIn list<br>			if delegate.control = control And delegate.signature = e.eventSignature  And delegate.methodName = methodName<br>				result = delegate<br>				Exit <br>			end<br>		Next<br>		Return result<br>	end<br>	<br>	Method FindAll:List&lt;EventDelegate&gt;(control:Control, e:EventArgs)<br>		Local result:=New List&lt;EventDelegate&gt;<br>		For Local delegate:EventDelegate = EachIn list<br>			if delegate.control = control And delegate.signature = e.eventSignature <br>				result.AddLast(delegate)<br>				Exit <br>			end<br>		Next<br>		Return result<br>	end<br><br>	<br>	Method Clear()<br>		list.Clear()<br>	End<br>	Private<br>	field _form:TopLevelControl<br>	Field list:=New List&lt;EventDelegate&gt; <br>End[/monkeycode]<br><br>this is a form class using my gui system. the code is pretty self-explanatory:<br>[monkeycode]Class MyForm extends Form<br>	'Buttons:<br>	Field butContinue:Button <br>	Field butExit:Button<br>	Field panel2:Panel<br>	<br>	'Text fields:<br>	Field managedScreen:GuiScreen<br>	Field txtSubjectNumber:TextField<br>	Field txtSesionNumber:TextField<br>	Field txtTypePD:TextField<br>	Field txtSubjectCode:TextField<br>	Field txtOrderOnOff:TextField<br>	Field txtOnOff:TextField<br>	Field txtSex:TextField<br>	Field txtDurationOfDisease:TextField<br>	Field txtDominantHand:TextField<br>	Field txtExperimenterID:TextField<br>	Field txtSite:TextField<br><br>	Method New(gui:Gui)<br>		Self.InitForm(gui)	<br>		SetFormSize()<br>		CreateComponents()<br>		Gui.systemFont.DrawBorder = False<br>		Gui.systemFont.DrawShadow = false<br>	End<br>	<br>	Method SetFormSize()<br>		Position.X = 0<br>		Position.Y = 0<br>		Size.X = DeviceWidth()<br>		Size.Y = DeviceHeight()		<br>	End<br>	<br>	Method CreateComponents()<br>		'''<br>		''' Self<br>		'''<br>		Self.BackgroundColor = SystemColors.ControlFace.Clone()<br>		<br>		'''<br>		''' panel2<br>		'''<br>		panel2 = New Panel()<br>		panel2.Parent = Self<br>		panel2.Position.X = 10<br>		panel2.Position.Y = 10<br>		panel2.Size.X = DeviceWidth - 20<br>		panel2.Size.Y = DeviceHeight - 100<br>		'panel2.BackgroundColor.SetColor(1,255,255,235)<br>		<br>		'''<br>		''' mybutton<br>		'''<br>		butContinue=New Button()<br>		butContinue.Parent = self<br>		butContinue.Text = "Next&gt;&gt;&gt;" <br>		butContinue.Position.X = Size.X - butContinue.Size.X - 20<br>		butContinue.Position.Y = Self.Size.Y - butContinue.Size.Y-20	<br>		Events.Add(butContinue,eEventKinds.CLICK,"ButContinue_Clicked")<br>		<br>		'''<br>		''' But Exit:<br>		'''<br>		butExit=New Button()<br>		butExit.Parent = self<br>		butExit.Text = "Quit" <br>		butExit.Position.X = 20<br>		butExit.Position.Y = butContinue.Position.Y <br>		Events.Add(butExit,eEventKinds.CLICK,"ButExit_Clicked")<br>		<br>		'''<br>		''' text fields:<br>		'''<br>		txtSubjectNumber = AddTextField("Subject number",0,"1")		<br>		txtSesionNumber= AddTextField("Session number",1,"1")<br>		txtTypePD = AddTextField("Type (PD(1)/CTRL(2))",2,"1")<br>		txtSubjectCode = AddTextField("Subject code",3,"1")<br>		txtOrderOnOff = AddTextField("Order (OnOff(1),OffOn(2))",4,"1")<br>		txtOnOff = AddTextField("OnOff(On(1),Off(2))",5,"1")<br>		txtSex = AddTextField("Sex",6,"1")<br>		txtDurationOfDisease = AddTextField("Duration of disease (1 or 2)",7,"1")<br>		txtDominantHand = AddTextField("DominantHand (L/1, R/2)",8,"1")<br>		txtExperimenterID = AddTextField("Experimenter ID",9,"1")<br>		txtSite = AddTextField("Site",10,"1")<br>				<br>	End<br>	<br><br>	Method AddTextField:TextField(labelTxt:String,line:Int,defaultValue:String)	'This is a helper method to fill in the form with text fields.<br>		Const MARGIN:Int = 10<br>		Const CONTROLSIZE:Int = 20<br><br>		'We create the "prompt" label:<br>		Local label:BaseLabel<br>		label = New BaseLabel(panel2,100,20 + line * (CONTROLSIZE +MARGIN ), labelTxt, 200, CONTROLSIZE )<br><br>		'We create the TextField we're going to return:<br>		Local txtField := New TextField()<br>		txtField.Parent = panel2<br>		txtField.Position.X = label.Position.X + label.Size.X + MARGIN <br>		txtField.Position.Y = label.Position.Y<br>		txtField.Text = defaultValue<br>		txtField.AutoAdjustSize = False<br>		txtField.Size.X = 200<br>		txtField.Size.Y = label.Size.Y<br>		Return txtField<br>	End<br>	<br>	Method ButContinue_Clicked(sender:Control, e:EventArgs)<br>		managedScreen.NextScreen = New InitPage2 <br>		managedScreen.SetStatus(eScreenStatus.LOADNEXT )	'We tell the managedScreen that its status is "Load Next screen".<br>	End<br>	Method ButExit_Clicked(sender:Control, e:EventArgs)<br>		managedScreen.SetStatus(eScreenStatus.EXITBROWSER)	'We tell the managedScreen that its status is END execution.<br>	End<br>End[/monkeycode]<br><br>As you can see in this sample, all you have to do is add this on any Top level control (Form):<br>[monkeycode]Events.Add(butExit,eEventKinds.CLICK,"ButExit_Clicked")[/monkeycode]<br>Where the paremters are:<br>1.- The control instance that will trigger the event we sant to handle<br>2.- The event kind. It's a constant.<br>3.- The name of the method we're going to call whever this event is fired. All event-methods have the signature:<br>[monkeycode]MethodName:Int(sender:Control, e:EventArgs)[/monkeycode]Where "sender" is the control that is firing the event, and "e" is an instance of the event itself. Depending on the event kind, it can contain mouse coordinates, the pressed key, etc etc. It's a lot like windows forms in this respect. It does internally use Reflection and I don't see any way it could work properly without it. Events are executed in a true event-queue, so a single event can be handled by as many "delegates" as desired and they're executed "in cascade". <br><br></td></tr></table><br>
<a name="2030645"></a>

<a name="2030644"></a>

<a name="2030643"></a>

<a name="2030640"></a>

<a name="2030638"></a>

<a name="2030658"></a>

<a name="2030659"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tibit</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Looks cool. <br><br>The example I made, how would it look using your reflection Delegates?<br><br>Note: I edited my post about with reflection code and it certainly got a bit messier but also required fewer steps than Interfaces + it also introduced some duck typing (good &amp; bad).<br><br>Here is the code in simpler excerpts using raw REFLECTION:<br><br><b>Hook Event</b>[monkeycode]<br>        'Hook event<br>        Local onFireEvent:MethodInfo = GetClass("Fighter").GetMethod("OnEnemyFire", [StringClass, IntClass])<br>        ship.FireMethod = onFireEvent<br>        ship.FireInstance = fighter<br>[/monkeycode]<br><b>Define Event - in the Class that can Output the event</b>[monkeycode]<br>        Field FireMethod:MethodInfo 'uses reflection<br>        Field FireInstance:Object 'also need this for reflection<br>[/monkeycode]<br><b>Invoke Event - requires we can reach definition of event above</b><br>[monkeycode]<br>	'Event Parameters:<br>	Local weapon:String = "Laser"<br>	Local power:Int = 5<br>	Local argumentsArray:Object[] = [BoxString(weapon), BoxInt(power)]<br>	FireMethod.Invoke(FireInstance, argumentsArray)<br>[/monkeycode] <br><br></td></tr></table><br>
<a name="2030656"></a>

<a name="2030654"></a>

<a name="2030655"></a>

<a name="2030652"></a>

<a name="2030653"></a>

<a name="2030649"></a>

<a name="2030650"></a>

<a name="2030651"></a>

<a name="2030661"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tibit</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> In comparison here is the code in simpler excerpts using INTERFACES:<br><br><b>Hook Event</b>[monkeycode]<br>        'Hook event<br>        ship.Fire = fighter<br>[/monkeycode]<br><b>Declare Event - In any imported Module</b>[monkeycode]<br>Interface OnFireEvent<br>	Method OnFire:Void(weapon:string, power:Int)<br>End<br>[/monkeycode]<br><b>Allow Class to Hook Event - ForEach class that wants to ACT on the event</b>[monkeycode]<br>        Class Fighter implements OnFireEvent<br>[/monkeycode]<br><b>Define Event - in the Class that will Output/Call the event</b>[monkeycode]<br>Field Fire:OnFireEvent<br>[/monkeycode]<br><b>Invoke Event - requires we can reach definition of event above</b>[monkeycode]<br>	'Event Parameters:<br>	Local weapon:String = "Laser"<br>	Local power:Int = 5<br>	Fire.OnFire(weapon, power)<br>[/monkeycode] <br><br></td></tr></table><br>
<a name="2030657"></a>

<a name="2030660"></a>

<a name="2030662"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> But how could you dinamically change from one event-handler to another at runtime? Let's say, in a GUI, I want a button tclick to perform action A, and after changing something in the status of the whole app. I want this button to perform B, and later to perform again A and B, etc.. the way I see it, interfaces are much less dynamic in this respect.<br><br>My example might look similar. What I have anyway is a system that also uses a sort of windows-message approach, so events are called in a top-down from the control that generates the event, to the top-level container, where it can be handled or just ignored. Other than that, it's quite similar. <br><br></td></tr></table><br>
<a name="2030676"></a>

<a name="2030677"></a>

<a name="2030678"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> But how could you dinamically change from one event-handler to another at runtime? <br></div><br><br>You can just change the referenced interface implementation or you can have logic in the implementation that checks the state and acts accordingly. It's not ideal in all circumstances but I'm not convinced the reflection-based method is much of an improvement.<br><br>Not that proper delegates as in C# don't have advantages. I'd be glad to have them. Or functions as objects. In-line declaration would be even better. In fact I'd be happy to get anonymous inner classes or even just inner classes just to be able to declare simple handlers near where they are used and avoid tacking interfaces on classes. And a pony. I want a pony. <br><br></td></tr></table><br>
<a name="2030679"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> You can just change the referenced interface implementation  <br></div>Of course, but that's a bit too much for my taste. I mean, having to implement a new class and class instance for each situation, it's a bit too heavy in my opinion. While the reflection approach is not ideal too, I think it is better in this respect... Anyway, each to their own, I would preffer a 1965 stratocaster than a Pony, but I see your point about the Pony. A pony rocks for sure too, but the Strato sounds a lot better. <br><br></td></tr></table><br>
<a name="2039811"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TheRedFox</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ziggy, is the event system mentioned above available somewhere? I am currently writing such a thing on my own right now but yours seems to be more fully featured. <br><br></td></tr></table><br>
<a name="2039812"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, it's available on the JungleGui source code.<br>You can take a look here: <br><a href="http://code.google.com/p/junglegui/source/browse/eventhandler.monkey" target="_blank">http://code.google.com/p/junglegui/source/browse/eventhandler.monkey</a> <br><br></td></tr></table><br>
<a name="2039814"></a>

<a name="2039815"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TheRedFox</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks! Cloning now :-)<br><br>Wow, Control is *huge* <br><br></td></tr></table><br>
<a name="2039818"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Wow, Control is *huge*  <br></div>Yes, it's big. I wish I could properly spread it on multiple files but  the lack of a "Friend" modifier forces me to put the class: Control, ControlContainer, TopLevelControl and Gui in the same monkey module. Not an issue when using Jungle Ide tho. <br><br></td></tr></table><br>
<a name="2039840"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Samah</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> @ziggy: ...the lack of a "Friend" modifier... <br></div><br>But remember, your friends can see your privates. ;) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
