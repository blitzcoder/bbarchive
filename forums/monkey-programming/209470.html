<!DOCTYPE html><html lang="en" ><head ><title >Best way to do a wavy sinwave underwater fx</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Best way to do a wavy sinwave underwater fx</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=507" >Monkey Programming</a>/<a href="#bottom" >Best way to do a wavy sinwave underwater fx</a><br><br>
<a name="2098405"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Supertino</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> You know that old snes style underwater wavy sin effects that waves the whole screen, whats the best way to do this so that it works in GLFW and Android?<br><br>Thinking I can grab the screen with readpixel, stripe the grabbed image into rows and draw the stripes and apply a sin effect to the parts.  I have yet to try this as I am 99% sure this will be too slow to update 30fps.  I'll proof it tonight.<br><br>Is there a fancy GL command set I can use? <br><br></td></tr></table><br>
<a name="2098406"></a>

<a name="2098409"></a>

<a name="2098410"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >nullterm</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> readpixel is a dead end, atleast as far as being too slow for 30fps.  It'll work, but going back and forth from GPU to main back to GPU memory is going to stall.<br><br>If you go the GLES20 route, you can render to a texture, then use that rendered texture using vertex animation (xyz or uv, cheap n fast) or at the pixel shader level (not as cheap/fast on the GPU, but better visual results).<br><br>If you are already on the GLES20 route, here's another thread about setting up render textures: <a href="http://www.monkey-x.com/Community/posts.php?topic=9270" target="_blank">http://www.monkey-x.com/Community/posts.php?topic=9270</a><br><br>Edit, if you want to "cheat" and not go the GLES20... IF you don't mind doing it with a static image....<br><br>1. draw your scene with mojo<br>2. use ReadPixels once from the screen to an array<br>3. use Image.WritePixels to upload the pixel data<br><br>Then, (in realtime) something like...<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
for local y:Int = 0 until DeviceHeight()
    local x:Int = 4 * Sin(y*4 + Millisecs() * 0.1 )
    DrawImageRect myImg, x, y, 0, y, DeviceWidth(), 1
next
</textarea><br>That's per scanline, might be slightly faster to treat every 4 "y" scanlines as a bar and move them together. <br><br></td></tr></table><br>
<a name="2098417"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Supertino</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks nullterm, that's gives me a starting point, I assumed read pixel would be a dead end and some GL stuff would likely be required.  I'll look over the link you posted.<br><br>If it was a static image I could as you say grab the pixels once and go from there but it's a moving scene with moving objects. <br><br></td></tr></table><br>
<a name="2098445"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >nullterm</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah, then the mojo version won't work if it's all moving in real time.  <br><br>GLES2 render to texture would be the way to go, it's just a bunch of work to setup all the vertex buffers, shaders, etc.<br><br>Once you have it working though, there's all kinds of cool effects you can do with "render to texture" and different vertex/pixel shaders. <br><br></td></tr></table><br>
<a name="2098444"></a>

<a name="2098451"></a>

<a name="2098452"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nobuyuki</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> ReadPixels() could be viable provided the screen didn't scroll too much and the background was mostly static.  You could apply the strip effect to only the background (this was done in some games in the past).  The idea is to reduce the number of ReadPixels() calls as much as possible.  Depending on how you assemble the scene, you could also theoretically achieve the effect by slicing and warping each asset before blitting instead of capturing a portion of the screen afterwards and then slicing that. This potentially increases the number of draw calls quite a bit depending on how many lines of accuracy you were going for, however.  See the following for an example of the latter:<br><br><a href="http://www.monkey-x.com/Community/posts.php?topic=7492&amp;app_id=244" target="_blank">http://www.monkey-x.com/Community/posts.php?topic=7492&amp;app_id=244</a> <br><br></td></tr></table><br>
<a name="2098485"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Supertino</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> That looks nice Nobuyuki ill take a look over that this weekend. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
