<!DOCTYPE html><html lang="en" ><head ><title >To premultiply or not to premultiply alpha</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >To premultiply or not to premultiply alpha</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=507" >Monkey Programming</a>/<a href="#bottom" >To premultiply or not to premultiply alpha</a><br><br>
<a name="2073929"></a>

<a name="2073930"></a>

<a name="2073931"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> OK I'm confused about something...<br><br>Currently all my sprites are normal pngs from photoshop, not pre-multiplied alpha.<br><br>However, when I looked in mojo.glfw and mojo.ios and mojo.android they all use this:<br>	glEnable( GL_BLEND );<br>	glBlendFunc( GL_ONE,GL_ONE_MINUS_SRC_ALPHA );<br><br>As I understand it, that is the blend mode for Pre-multiplied alpha sprites, otherwise it would be (GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA)<br><br>So how come when I view my normal pngs they look fine? If the renderer is expecting pre-multiplied pngs then they should all look wrong shouldn't they?<br><br>Anyway, that aside, as the mojo code is expecting pre-multiplied pngs, should I be doing that via running them through a tool or something (doing at runtime would be slow)?<br><br>To add to the confusion apparently XCode pre-multiplies (and reverses the RGB) of pngs when it builds for iOS, but according to this post it doesn't do it for the data folder: <a href="http://www.monkeycoder.co.nz/Community/posts.php?topic=2464" target="_blank">http://www.monkeycoder.co.nz/Community/posts.php?topic=2464</a> but the article that post refers to seems to infer it happens to everything: <a href="http://iphonedevelopment.blogspot.co.nz/2008/10/iphone-optimized-pngs.html" target="_blank">http://iphonedevelopment.blogspot.co.nz/2008/10/iphone-optimized-pngs.html</a><br><br>So yeah I'm pretty confused right now.  Any experts on this in da house?<br><br>Thanks in advance.<br><br>PS.  I understand what pre-multiplied alpha is and why it's better for most situations, so I don't need an explanation of that. I'm confused as to if I should be doing the pre-multiplication myself for GLFW and iOS, or not. <br><br></td></tr></table><br>
<a name="2073932"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AdamRedwoods</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> it's done at runtime in mojo. iOS doesn't seem to do it, so you are correct on the pre-premultiplying(?).<br><br>you'll find it during the gxtkSurface::SetData in the native GLFW code, or in Android's case at texture bind time (which may explain the slight pause when a new image is drawn on Android). <br><br></td></tr></table><br>
<a name="2073977"></a>

<a name="2073978"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> You don't need to do any alpha pre-multiplication, it's all handled for you behind the scenes.<br><br>On iOS, whether or not the image has been 'optimized', or is in the data folder or whatever doesn't matter - the OS always makes sure it's premultiplied when you load it (I guess optimizing makes this step faster). There is some premultiplication code in iOS mojo, but it's only for 'WritePixels'. <br><br></td></tr></table><br>
<a name="2074023"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the replies guys! Much appreciated.<br><br>I wonder how iOS knows if an image has already been optimised before it loads it? Maybe there's some identifier in the header? <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
