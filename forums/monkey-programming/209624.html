<!DOCTYPE html><html lang="en" ><head ><title >OnCreate problem</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >OnCreate problem</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=507" >Monkey Programming</a>/<a href="#bottom" >OnCreate problem</a><br><br>
<a name="2101089"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >EdzUp</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is there a certain amount of stuff you can do in OnCreate, I ask as my game sets up the rendering system loads some basic images and parses a demo system (2595 bytes). But I always get a MAV when parsing the demo system.<br><br>I have tried outputting the databuffer to a file to make sure its not corrupt, its perfect. Also moving stuff around to no avail. The whole loader fails at random points when parsing the file my only option would be to push the file to OnUpdate and hope it fixes it. If this is the case maybe it should be in the docs somewhere. <br><br></td></tr></table><br>
<a name="2101090"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gerry Quinn</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've never seen any problems.  You can get some systems complaining when OnCreate() takes more than a few seconds, but that's a different error anyway.  Have you tried it in Debug mode, and perhaps on a different target?  Most likely you have a bug somewhere and this may help root it out, <br><br></td></tr></table><br>
<a name="2101093"></a>

<a name="2101094"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >EdzUp</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ive even deleted the build folder, its weird as the exact same code works flawlessly under Linux. All its doing is reading a character from a databuffer with PeekByte converting with String.FromChar and tacking it onto the end of a string. After that is a #10 or #13 is hit I parse the string, it also ignores #9 tabs etc. Running it gives me a MAV at random points in the data this is with monkey 83a.<br><br>Oh and this is all in Debug mode all I get is Memory Access Violation and nothing more. <br><br></td></tr></table><br>
<a name="2101098"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >EdzUp</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I get this:<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
C:/Users/EdzUp/Desktop/Coding/BRL/MonkeyXPro83a/bin/transcc_winnt" -target=Desktop_Game_(Glfw3) -config=Debug -run "C:/Users/EdzUp/Desktop/Coding/BRL/Projects/Star Rogue/Star_Rogue.monkey"
TRANS monkey compiler V1.80
Parsing...
Semanting...
Translating...
Building...
g++  -Wno-free-nonheap-object -I../glfw3/include -I../glfw3/src -I../openal/include -I../stb -I../zlib-1.2.8 -I../lpng1610  -c -o build/Debug/main.o ../main.cpp
g++ -Wl,--subsystem,windows -L../openal/libs/Win32 -L../openal/libs/Win64 -o Debug/MonkeyGame build/Debug/context.o build/Debug/init.o build/Debug/input.o build/Debug/monitor.o build/Debug/wgl_context.o build/Debug/win32_init.o build/Debug/win32_monitor.o build/Debug/win32_time.o build/Debug/win32_tls.o build/Debug/win32_window.o build/Debug/window.o build/Debug/winmm_joystick.o build/Debug/stb_vorbis.o build/Debug/stb_image.o build/Debug/main.o -lgdi32 -lopengl32 -lOpenAL32 -lws2_32
opening openal device
-------------------------------------------
SetDesignScale information
Width:640 Height:480
Pixel Width:1.0  Pixel Height:1.0
-------------------------------------------
OnCreate complete
Loading system...
Loader::LoadSystemData
    &gt;&gt;Checking to see if its created
    Completed
    &gt;&gt;Checking file exists
    &gt;&gt;Unpacking data
    DATA LENGTH:2592
    &gt;&gt;Complete
    &gt;&gt;PARSING DATA
&gt;&gt;&lt;SystemData&gt; [112]
&gt;&gt;Name=Aradis [128]
&gt;&gt;GalaxyX=0 [140]
&gt;&gt;GalaxyY=0 [152]
&gt;&gt;OffsetX=79 [165]
&gt;&gt;OffsetY=34 [178]
&gt;&gt;Owner=Terran confederation [209]
&gt;&gt;Description=Aradis was discovered in 2342 by the Saturn observatory [281]
&gt;&gt;TechLevel=165 [297]
&gt;&gt;&lt;/SystemData&gt; [312]
&gt;&gt;&lt;Sun&gt; [332]
Monkey Runtime Error : Memory access violation
</textarea><br><br>The Monkey Runtime Error : Memory access violation is not very descriptive and happens at random in this function. If it was at the same place or we had some more 'descriptive' error messages it would be easier to debug. I have remmed out some of the code and it still throws a MAV and to be honest its bloody annoying I know the data is fine too. <br><br></td></tr></table><br>
<a name="2101112"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Can you separate the code in different methods which is called by OnCreate so that you can narrow down the issue?<br><br>From your build log, the application compiles fine and is running until you parse the Sun data. <br><br></td></tr></table><br>
<a name="2101115"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nobuyuki</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> are you doing any async loading or using any mojo-specific functionality?  iirc, OnCreate does some stuff before App has a full handle on all contexts, including graphics context, which can cause headaches when loading some assets.  Async loaders may return before graphics context is valid, which can cause this error.  Solution would be to have a state machine delay the loading a few frames (like say in a splash screen).  Very sleepy so apologies if this is completely off <br><br></td></tr></table><br>
<a name="2101120"></a>

<a name="2101121"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >EdzUp</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well all I'm doing is getting a character from a DataBuffer with peekbyte and using String.FromChar( char ) to add it to a string then when chr(10) or chr( 13 ) are hit. It also ignores ; and blank lines.<br><br>Once it hits the characters 10 and 13 I just run through parsing the string seeing what it contains.<br><br>The reason I was asking is it fails at random points in the parser its not always at the same point in the instance above it failed last sun sometimes at stations or planets its completely random.<br><br>Its not async loaded just loading a file into a buffer, unencrypting the buffer and then parsing the buffer to find out what's in the system. <br><br></td></tr></table><br>
<a name="2101134"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gerry Quinn</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Another option is to install MSVC and do a proper debug run. <br><br></td></tr></table><br>
<a name="2101136"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >EdzUp</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm but I use gnu c++ as its easiest to install and setup :/ <br><br></td></tr></table><br>
<a name="2101153"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Richard Betson</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Shot in the dark but sometimes it's possible to have a random error when an asset is not loaded do to misspelling or some such. It would also cause a MAV. <br><br></td></tr></table><br>
<a name="2101154"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >EdzUp</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> We think alike but this system is pure code no assets, all it does is run through the DataBuffer and make the system. I know the DataBuffer is there as the system details are parsed perfectly before the system bodies, sun, planets and moons etc.<br><br>I also know these are created perfectly to as it sometimes gets right up to nebulas before throwing a error, sometimes its the first sun. On the whole the error is very hard to track down and correct if I knew what caused it I would fix it and continue but throwing a random error is just complete nonsense.<br><br>Fwiw I recoded the function so it was laid out completely different with if statements instead of a select...case...end call and it still throws a random error at random points. I also make sure all types are created before use and that would have been a null type problem not a mav.<br><br>Being the error in question even in debug mode shows a complete lack of proper debugging system available, even MSVC 2010 doesn't give a different error I had a hard time getting it to use that as it preferred to use mingw <br><br></td></tr></table><br>
<a name="2101156"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Are you using a static seed or using millisecs or something to make it more random?<br><br>Could you try to find a seed which always reproduces the issue? <br><br></td></tr></table><br>
<a name="2101161"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> The error being printed is effectively Monkey throwing its hands up and saying "something went wrong in a way the language didn't trap". As it's platform specific you're going to struggle to track it at a Monkey level. If you're not comfortable with debugging C++ applications then you may have to bite the bullet and hand the project to someone who is to trace the problem. Mark may well consider any such error being thrown in Debug mode to be a Monkey bug and be willing to look at the problem himself if you report it. <br><br></td></tr></table><br>
<a name="2101163"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Samah</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> What happens if you run it on a different target? ie. HTML5. <br><br></td></tr></table><br>
<a name="2101164"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >EdzUp</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> File loading prevents it all I have is glfw2 and 3 to test with <br><br></td></tr></table><br>
<a name="2101176"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >EdzUp</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> righty after going through LOADS of lines and ludicrous applications of #rem this line<br><pre class=code>
Line += String.FromChar( Char )
</pre><br><br>It seems the FromChar is causing a MAV no matter how I use it <br><br></td></tr></table><br>
<a name="2101187"></a>

<a name="2101189"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skid</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Testing now.. <br><br></td></tr></table><br>
<a name="2101188"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >EdzUp</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> The file is 2595 bytes long and the line is reset when its parsing is complete so no string gets longer than 30-40 bytes. <br><br></td></tr></table><br>
<a name="2101190"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skid</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> How are you testing for end of file? <br><br></td></tr></table><br>
<a name="2101191"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >EdzUp</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well I'm using DataBuffer.load to load it in and checking against its length. <br><br></td></tr></table><br>
<a name="2101193"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you've tracked it down to a single line then it should be easy for you to create a simple example with an embedded string that reproduces the issue. <br><br></td></tr></table><br>
<a name="2101194"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skid</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> I suspect it's the data buffer, usage of which sounds a little like overkill when it comes to reading and parsing a text file. <br><br></td></tr></table><br>
<a name="2101195"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >EdzUp</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> The file is encrypted so the DataBuffer is used for unencryption, with the loading system from the DataBuffer it seemed easier to do it that way.<br><br>As for reproducing the issue I am looking at writing a work around to make sure it doesn't happen again <br><br></td></tr></table><br>
<a name="2101196"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> How does "writing a workaround" stop it from happening again? It might solve your specific issue in your singular project but it does nothing to resolve the problem for Monkey users as a whole if the problem is with Monkey and not an error in your code. <br><br></td></tr></table><br>
<a name="2101197"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >EdzUp</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> I will look to creating a source file that hopefully will demonstrate the issue. <br><br></td></tr></table><br>
<a name="2101244"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >EdzUp</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> After moving the offending functions to a separate source file I cant reproduce the problem, I have checked all variables to make sure they are initialised (coming from c++ its something I always do).<br><br>What I might try is Strict to see if that throws anything, its a weird bug which is why I thought there might be a certain amount of stuff that can be done before monkey throws a error.<br><br>EDIT: Weirdly enough strict didnt throw up anything apart from function return values, I managed to rectify the problem by running from 0-DataBuffer.Length-1 (one line I missed) instead of to the length which seems to fix the problem, it wasnt throwing a error for being out of bounds like it does with arrays just throwing a MAV which seemed a bit harsh. After doing that I also looked at the whole project and decided to convert to using arrays instead of databuffers and this works faster than the databuffers do so for me its a win win :). I had some niggles with converting some of the functions but this has all been sorted now and the system is now back on track. All I have to do now is extract the colours from the values in the data files and then its back to where it was before with encrypted star systems :).<br><br>So I would like to apologise for being a complete douche and not noticing a glaring error in my code, its amazing how a simple error just doesnt appear no matter how hard you look at it. No matter how hard I looked my eyes just couldnt see it but stepping back from the whole thing for a while and then coming back to it allowed me to see I missed one line :s. <br><br></td></tr></table><br>
<a name="2101233"></a>

<a name="2101247"></a>

<a name="2101248"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gerry Quinn</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> I guess the data functions probably use pure pointer arithmetic instead of arrays. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
