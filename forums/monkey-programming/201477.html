<!DOCTYPE html><html lang="en" ><head ><title >SaveState isn't working in Chrome</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >SaveState isn't working in Chrome</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=507" >Monkey Programming</a>/<a href="#bottom" >SaveState isn't working in Chrome</a><br><br>
<a name="2013407"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Not sure if this is a bug, if I'm doing something wrong, or if SaveState is just useless for HTML5.  Simple example<br><pre class=code>
Import mojo

Class myApp Extends App
	Method OnCreate()
		SaveState("Hello.")
	End
End Class

Function Main()
	New myApp
End Function
</pre><br>When I run this (HTML5) and check Chrome's localstorage, I get the following in Local Storage&gt;&gt;localhost:<br>key: .mojostate@...<br>value: Hello.<br><br>If I then completely shut down Chrome, and reopen it, the saved data is gone.  Surely this can't be right???  I'm just installing Visual C++ to see if I fare any better using GLFW target for prototyping but still, I'm not sure this thing with HTML5 is expected behaviour as SaveState really needs to be persistent.  Is that not the whole point of it? <br><br></td></tr></table><br>
<a name="2013408"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Amon</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> You're not clearing cache, temporary files etc. when Shutting down Chrome, either with chromes own built in util or some other 3rd party one used in chrome or on your system?<br><br>Sounds stupid but just thought I'd chime in with the obvious first. <br><br></td></tr></table><br>
<a name="2013410"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nope, that was the first thing I checked. <br><br></td></tr></table><br>
<a name="2013446"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Save/LoadState works fine on Chrome for me. I've been using it for a fair while. <br><br></td></tr></table><br>
<a name="2013450"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> A couple of thoughts.<br><br> * Are you seeing any other local-storage files in your user folder? I have files from various google sites, amazon, twitter, gawker and a bunch of others, so if you regularly browse with Chrome and there's nothing in there then you might want to take another look at what Amon mentioned.<br><br> * Are you testing the Load without restarting the Monkey HTTP server? If you restart the server it will pick a new port to run on and this will change the local storage file that is used. In other words, a save, restart and load won't work. <br><br></td></tr></table><br>
<a name="2013451"></a>

<a name="2013452"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skid</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Dave, I don't see the point of targeting HTML5. Just because Monkey can, doesn't make it a great idea, especially for any kind of commercial reality. <br><br>As a Flash developer your are more likely to earn a living.<br><br>As iOS developer you typically will struggle to ever pay off your hardware investment.<br><br>As an HTML5 developer you have your head in the clouds so not really relevant.<br><br>As an android developer, oh please...<br><br>For anyone trying to do more than one of the above, I would suggest even greater odds of failure rather than success. <br><br></td></tr></table><br>
<a name="2013453"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm not, skid.  I'm working on an iOS version of my game (released today on BFG for PC/Mac) but I can't really get along with programming on a Mac.  I'm trying to do the bulk of it in Windows and JungleIDE, and I'm using HTML5 for that.<br><br>Maybe you're right though, I should just choose a different target for prototyping. <br><br></td></tr></table><br>
<a name="2013454"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skid</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm, it is nice and quick to compile for and would be good to sort out issues with Chrome, and you can always just use a browser that does work... <br><br>If Chrome does save when game is served from file:/// and not <a href="http://localhost" target="_blank">http://localhost</a>  then you can configure trans to not use mserver which can make dev even snappier. The config is in monkey/bin. <br><br></td></tr></table><br>
<a name="2013459"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> and you can always just use a browser that does work...  <br></div>Which one would that be?  I always thought Chrome was the best option for HTML5 stuff. <br><br></td></tr></table><br>
<a name="2013460"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> I would recommend using the flash target. <br><br></td></tr></table><br>
<a name="2013461"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Aye, but then I have to mess about converting all my OGG files to... whatever Flash supports (MP3?). <br><br></td></tr></table><br>
<a name="2013464"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> you can always just use a browser that does work <br></div><br><br>All the major browsers work in my testing on Windows, assuming that you don't have some setting that clears the saved data and that you don't change the URL between runs (e.g. by restarting the HTTP server). <br><br></td></tr></table><br>
<a name="2013463"></a>

<a name="2013465"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>Works OK here.<br><br>Have you 'bypassed' MServer?<br><br>If so, SaveState (and some other features) will not work on some browsers (at least Chrome).<br><br>You must use MServer in order to emulate documents being served from a 'domain' to get full html5 functionality. <br><br></td></tr></table><br>
<a name="2013467"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> I just tested on my laptop and got the same issue there, too.  I've also noticed that LocalStorage&gt;&gt;Localhost seems to be 'per tab'.  I.e. after I run my game, I open a new tab, then developer tools for that tab, and my savestate is not there either.<br><br>And no, there's nothing else in localstorage.<br><br>[edit]<br><div class="quote"> Have you 'bypassed' MServer? <br></div>Um... I'm not even sure what that means so I'll assume not! <br><br></td></tr></table><br>
<a name="2013466"></a>

<a name="2013469"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>Muddy_shoes has a point - each re-run of MServer will create an entirely new 'domain' (as port will be different) that local storage will bind to - ie: shutdown/restart mserver and local storage will probably disappear as the app will be being served from a different domain.<br><br>Also, how do you 'check Chrome's localstorage'? Are you sure this isn't referring to local storage for the current document? <br><br></td></tr></table><br>
<a name="2013474"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, it doesn't disappear from the system, it's just not related to the new domain. Eventually it will result in odd behaviour because the server will return to an old port and pick up an old state string (we possibly need some extra features in the MServer to handle this).<br><br>Judging from what Gfk is saying, he's looking at the local storage through the resources tab in the Chrome dev tools. This works fine for me, even if I switch browser tabs. I really suspect that it's a privacy setting issue (options-&gt;under the bonnet-&gt;content settings) or possibly a Windows permissions issue if Chrome isn't writing a file at all in "C:\Users\&lt;username&gt;\AppData\Local\Google\Chrome\User Data\Default\Local Storage" or whatever the equivalent is in his flavour of Windows. <br><br></td></tr></table><br>
<a name="2013473"></a>

<a name="2013472"></a>

<a name="2013508"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Muddy_shoes has a point - each re-run of MServer will create an entirely new 'domain' (as port will be different) that local storage will bind to - ie:  <br></div>That was it!  It works fine provided I don't change the port number.  Is there any way to force a given port number?  It would be handy for testing.<br><br><div class="quote"> Judging from what Gfk is saying, he's looking at the local storage through the resources tab in the Chrome dev tools <br></div>Yep.  I still don't get why its always empty.  Ho hum...<br><br><div class="quote"> or possibly a Windows permissions issue if Chrome isn't writing a file at all in "C:\Users\&lt;username&gt;\AppData\Local\Google\Chrome\User Data\Default\Local Storage" <br></div>Just checked - the files are there, but they are not what I expected them to contain, as I can't actually see the contents of my saved state anyway as its in some stupid SQLite format.<br><br>Ta for the help! <br><br></td></tr></table><br>
<a name="2013511"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> youre not supposed to close the server app until you are done programming for the day <br><br></td></tr></table><br>
<a name="2013514"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Then what am i meant to do tomorrow? <br><br></td></tr></table><br>
<a name="2013517"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> You could try renaming the file. <br><br></td></tr></table><br>
<a name="2013519"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> Could do but it'd be much simpler if mserver could be set to use a fixed port number. does having it random even serve any useful purpose? <br><br></td></tr></table><br>
<a name="2013530"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dabz</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> Isnt the source inlcuded for mserver?<br><br>Just change the random port setting bit, rebuild in BlitzMax, replace the original binary!<br><br>Dabz <br><br></td></tr></table><br>
<a name="2013531"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> I dunno. easy fix if it is! <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
