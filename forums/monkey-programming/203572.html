<!DOCTYPE html><html lang="en" ><head ><title >my enemies vanished</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >my enemies vanished</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=507" >Monkey Programming</a>/<a href="#bottom" >my enemies vanished</a><br><br>
<a name="2037982"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jeit</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> My enemies have completely vanished off of the face of my game. I was messing with Therevills code for pixel perfect sprite collision, attempting to make it work for the diddy sprite class and the player class I made. I honestly don't think that was the cause of the problem though. One moment they are there and working fine, the next they don't show up at all. They are created, debuglog tells me so, and I know the images are good since they still show up on the sidebar on the edit screen, they simply dont show up in the game window. So I promptly began removing bits and pieces of code I had added to see what caused it, nothing changed it. I reverted the entire game to a previous version that I know worked perfectly fine, they still aren't there. I have no idea what's going on. I have since made sure everything is updated, deleted the build folder, hell I even restarted windows in pure desperation. I don't know what else to try, any suggestions? <br><br></td></tr></table><br>
<a name="2037983"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Are you using the latest version of Diddy? If so, you may need to set visible to true if you are not using the ctor. <br><br></td></tr></table><br>
<a name="2037984"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jeit</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> your a life saver, that was the problem. Thanks once again for your help. Though I am curious, what is ctor? <br><br></td></tr></table><br>
<a name="2037987"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> No problem... maybe we should default visible to be true...<br><br><div class="quote"> Though I am curious, what is ctor?  <br></div><br>Short hand for Constructor, the ctor for Sprite is:<br><br>[monkeycode]Method New(img:GameImage, x:Float, y:Float)<br>	Self.image = img<br>	Self.x = x<br>	Self.y = y<br>	Self.alpha = 1<br>	Self.SetHitBox(-img.image.HandleX(), -img.image.HandleY(), img.w, img.h)<br>	Self.visible = True<br>End[/monkeycode] <br><br></td></tr></table><br>
<a name="2037986"></a>

<a name="2037985"></a>

<a name="2037988"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jeit</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> ohhh, ok, thanks again. <br><br></td></tr></table><br>
<a name="2037989"></a>

<a name="2037990"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> How are you creating your sprites? And I've just defaulted visible to be true. <br><br></td></tr></table><br>
<a name="2037991"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jeit</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I created a new class that extends sprite for my enemies, not much was added to your sprite class, I just needed a few extra bits of information when the enemy was created. On a side note, as I mentioned in the opening post, I'm trying to use your pixel perfect collision within the enemy class, and I believe I'm very nearly there, however I do not understand what exactly readPixels does. I get that it reads the pixels and imports the info into an array, however I'm not sure how I would tell it to read the pixels of a sprite sheet rather then straight from the gamescreen, if that's even what its doing &gt;.&lt;, jumping to definition on that one is a little less then helpful <br><br></td></tr></table><br>
<a name="2037992"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >NoOdle</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> You have a couple of options, images can be loaded, drawn to screen and then the pixels read into a created image. You can then modify and use this with the read/write pixel commands. To avoid having to draw the image to the screen and capture, you could write a simple program that exports the captured sprite sheet to a data file. Loading this image data file straight into a created image can then be done inside OnCreate of your app, bypassing the need to render and capture the sprite sheet. <br><br></td></tr></table><br>
<a name="2037994"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> We have been thinking about adding the read image stuff to Diddy and it shouldnt be too hard, its just on the first frame we would need to draw the images to the screen to capture the pixels. <br><br></td></tr></table><br>
<a name="2037998"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Samah</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> its just on the first frame we would need to draw the images to the screen to capture the pixels. <br></div><br>Which wouldn't work for atlases that are bigger than the screen. <br><br></td></tr></table><br>
<a name="2037999"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay, just added ReadPixelsArray to GameImage. <br><br></td></tr></table><br>
<a name="2038025"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jeit</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for all the help everyone! Especially thank you therevills, you just made this a whole lot easier. <br><br></td></tr></table><br>
<a name="2038045"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> No problem, does it make sense on how to use it? <br><br></td></tr></table><br>
<a name="2038066"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jeit</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Through trial and error I'm getting closer and closer to being able to use it. I had thought it would read the entire sprite atlas at first, loading it in as an animated image though, it only reads one frame at a time. Tried to have it read the sprite's image every time the frame changed, and that didn't work since that image kept appearing in the center of the map surrounded by black for a sec. Currently trying to get it to read the entire sprite atlas again as the program first begins and running into difficulties with loading an animated version and a not animated version of the same atlas, and then difficulties loading the not animated version, having it read that image, then switch the image over to the animated version. <br><br></td></tr></table><br>
<a name="2038083"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've updated the SpriteAtlas demo to show you how I would use it.<br><br><a href="http://code.google.com/p/diddy/source/browse/trunk/examples/SpriteAtlas/spriteAtlas.monkey?spec=svn494&amp;r=494" target="_blank">http://code.google.com/p/diddy/source/browse/trunk/examples/SpriteAtlas/spriteAtlas.monkey?spec=svn494&amp;r=494</a><br><br>Basically:<br>[monkeycode]Class MyGame Extends DiddyApp<br>...<br>  ' 4th parameter = readPixels, so all sprites in the atlas will have their pixels read<br>  images.LoadAtlas("sprites.xml", images.SPARROW_ATLAS, True, True)[/monkeycode]<br><br>[monkeycode]Class GameScreen Extends Screen<br>  Field readComplete:Bool = False<br>...  <br>  Method Render:Void()<br>    ' read the pixels on the first frame<br>    If Not readComplete<br>      game.images.ReadPixelsArray()<br>      readComplete = True<br>    End<br>    ' normal game rendering<br>    Cls<br>...[/monkeycode]<br><br>So now you can get the pixels from each of the images in the atlas like this:<br>[monkeycode]Local gi:GameImage = game.images.Find("longsword")<br>Print "Pixels length = "+gi.Pixels.Length()[/monkeycode]<br>In the SpriteAtlas example I actually create a new image with the pixels array.<br><br>Hope this helps. <br><br></td></tr></table><br>
<a name="2038082"></a>

<a name="2038081"></a>

<a name="2038080"></a>

<a name="2038079"></a>

<a name="2038078"></a>

<a name="2038492"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jeit</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> I am having so much trouble with read pixel array. First question, in the sprite atlas example, why does it work for Find("Axe") and Find("longsword") but it doesn't for any of the other images? For my second question I'm going to do my best to paste all relevant code.<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Strict
Class BaseRobot extends Sprite
	Field _img:GameImage
	Field _mask:GameImage
	Method New(x:Int, y:Int, c:Color, change:Bool = False)
		LoadAnimation()
                Self.image = _img
                Self.SetFrame(0, 7, 100)

        Method LoadAnimation:Void()
		Local gi:Image
		_img = game.images.LoadAnim("robot_dish.png", 44, 44, 8, gi, False, False)
		_mask = game.images.Load("robot_dish_mask.png", "", False, False, True)
	End
        Method Update:Void()
		Self.UpdateAnimation()
		_frame = Self.frame
                SpriteCollide()
        End
	Method Draw:Void()
		Super.Draw()
		If _firstDraw = True
			FillPixels()
			_firstDraw = False
		EndIf
        End
	Method FillPixels:Void()
		_mask.ReadPixelsArray()
		_pixels = _mask.Pixels()
        End
	Method SpriteCollide:Bool()
		Local rect1:Rect = New Rect
		rect1.x = Self.x
		rect1.y = Self.y
		rect1.width = _level._blockSize * 2
		rect1.height = _level._blockSize * 2
		
		Local rect2:Rect = New Rect
		rect2.x = _player.X - _level._blockSize '22 = half of player image width 44
		rect2.y = _player.Y - _level._blockSize
		rect2.width = _level._blockSize * 2 'width of player image
		rect2.height = _level._blockSize * 2'height
		
		If rect1.IntersectWith(rect2)
			collisionRect = rect1.Intersection(rect2)
			If collisionRect &lt;&gt; Null Then
				For Local iy:Int = collisionRect.y Until collisionRect.height + collisionRect.y
					For Local ix:Int = collisionRect.x Until collisionRect.width + collisionRect.x
						Local a1:Int = (Self.GetPixel(ix - rect1.x, iy - rect1.y) Shr 24) &amp; $ff
						Local a2:Int = (_player.GetPixel(ix - rect2.x, iy - rect2.y) Shr 24) &amp; $ff
						
						If a1 &gt; 0 And a2 &gt; 0
						DebugLog "Collision"
							Return True
						End
					Next
				Next
			EndIF
		Else
			collisionRect = Null
		EndIf
		Return False
	End
	
	Method GetPixel:Int(x:Int, y:Int)
		Return _pixels[x + (y * _mask.w) + ( (_frame) * (_level._blockSize * 2))] '352 = imagewidth, 44 = sprite width
	End
End

Class Rect
	Field x:Int
	Field y:Int
	Field width:Int
	Field height:Int
	
	Method New(x:Int, y:Int, width:Int, height:Int)
		Self.x = x
		Self.y = y
		Self.width = width
		Self.height = height
	End
	
	Method IntersectWith:Bool(r:Rect)
		Local tw:Int = Self.width
		Local th:Int = Self.height
		Local rw:Int = r.width
		Local rh:Int = r.height
		If (rw &lt;= 0 Or rh &lt;= 0 Or tw &lt;= 0 Or th &lt;= 0)
	    	Return False
		End
		Local tx:Int = Self.x
		Local ty:Int = Self.y
		Local rx:Int = r.x
		Local ry:Int = r.y
		rw += rx
		rh += ry
		tw += tx
		th += ty

		Return ((rw &lt; rx Or rw &gt; tx) And
				(rh &lt; ry Or rh &gt; ty) And
				(tw &lt; tx Or tw &gt; rx) And
				(th &lt; ty Or th &gt; ry))
	End
	
	Method Intersection:Rect(r:Rect)
		Local tx1:Int = Self.x
		Local ty1:Int = Self.y
		Local rx1:Int = r.x
		Local ry1:Int = r.y
		
		Local tx2:Float = tx1
		Local ty2:Float = ty1
		Local rx2:Float = rx1
		Local ry2:Float = ry1
		
		tx2 += Self.width
		ty2 += Self.height
		rx2 += r.width
		ry2 += r.height
		
		If (tx1 &lt; rx1) Then tx1 = rx1
		If (ty1 &lt; ry1) Then ty1 = ry1
		If (tx2 &gt; rx2) Then tx2 = rx2
		If (ty2 &gt; ry2) Then ty2 = ry2
		tx2 -= tx1
		ty2 -= ty1

		If (tx2 &lt; -2147483648) tx2 = -2147483648
		If (ty2 &lt; -2147483648) ty2 = -2147483648
		Return New Rect(tx1, ty1, Int(tx2), Int(ty2))
	End
	
	Method ToString:String()
		Return x + "," + y + "," + width + "," + height
	End
	
End

</textarea><br><br>I think that's everything outside of the player's getpixel, which is much the same except more images depending on what the player is doing. So my question is, what am I doing wrong? When I did debuglog on a1 in spritecollide all it showed were a few thousand 0's. And if there is any further code I missed or you want to see, let me know, I have hit a brick wall on getting this to work. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
