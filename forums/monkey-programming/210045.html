<!DOCTYPE html><html lang="en" ><head ><title >HTML5 path traversal expansion?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >HTML5 path traversal expansion?</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=507" >Monkey Programming</a>/<a href="#bottom" >HTML5 path traversal expansion?</a><br><br>
<a name="2109600"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nobuyuki</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello,<br><br>The way I've set up my folders in my current project, it makes loading paths with relative locations difficult, but specifically only on html5 because the metadata for some files rely on relative paths containing directory traversal shorthand.  This shorthand is generated by the host application, and seems like really the only "sane" way to handle resources being loaded in a different folder from the file being generated that isn't a subfolder relative to the metadata file.<br><br>The problem manifests when trying to load a resource using one of mojo's built-in functions, like LoadImage().  While relative paths are automatically expanded to their appropriate "monkey://" protocol prefix, path traversal shortcuts are not.  <br><br>What's the best practice for handling this?  brl.FileSystem is not implemented for html5, so I can't get information about the underlying folder structure.<br><br>I'm wondering if there's a good "catch all" way for mojo to handle this automatically (can all files within the data folder be made aware of each other somehow? Maybe coming up with an internal map during the build process? Is that a security risk?), or at least to have a pure Monkey solution, if that's even possible.  But right now, all I can think of are workarounds instead of actual solutions. <br><br></td></tr></table><br>
<a name="2115536"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >daaaan</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have to say that 5 months without even a response is killing any enthusiasm I had for Monkey.. I won't likely be purchasing. <br><br></td></tr></table><br>
<a name="2115552"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImmutableOctet(SKNG)</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> This sounds incoherent. The state of the file you currently have open (Or last opened) should have nothing to do with the "file-system". To begin with, Monkey supports path resolution using its target system, and related code. So, something like Mojo would simply resolve the path and move on. Mojo uses HTML5's DOM types (And similar behavior) for most resources, meaning the protocols and paths supported are equivalent here. The unfortunate thing about Mojo's resource loading is that it depends on the build tool(s) to perform ahead-of-time meta-data collection. So, you can't really load images outside of your data folder, without going native. This is a weird optimization, and it's honestly not too difficult to patch out. On the bright side, normal Monkey games that don't try to load foreign resources are more secure, and quicker at detecting errors, which is nice.<br><br>In addition, Mojo has 'FixDataPath' (From 'mojo.data'), which resolves paths to the proper prefix/parent directory. It essentially adds "monkey://data/" in front of the path if it's local. If you want to use a global path, you'll need to have "/", "monkey://", or "./" at the beginning. Otherwise, you're dealing with a local path, which will get resolved for most things. In particular, <a href="https://github.com/blitz-research/monkey/blob/a254ac3682a453a0a03172fb55a0b9afbce6a0a1/targets/html5/modules/native/html5game.js#L291" target="_blank">Mojo uses this</a> natively for resources. This means you're implicitly using the "data" folder for images and sound files when it gets to the final build. Since we can't use anything else (By default) for resources, anyway, this makes sense. For those curious, <a href="https://www.github.com/blitz-research/monkey/search?l=javascript&amp;q=PathToUrl" target="_blank">here's the current usage in JavaScript</a>.<br><br>The 'FileStream' class is not supported on default HTML5, as it requires a real file-system, something that's not very easy. With that said, however, I have created a <a href="https://github.com/Regal-Internet-Brothers/virtualos" target="_blank">fully working file-system for WebCC</a> ('FileStream' is on the TODO-list), but it's not really meant for this kind of usage. It also requires a number of modifications, so you'd need to use the <a href="https://github.com/Regal-Internet-Brothers/webcc_frontend-target-monkey" target="_blank">WebCC</a> (Requires work) or <a href="https://github.com/Regal-Internet-Brothers/webcc-monkey/tree/master/webcc.data/targets/html5" target="_blank">modified HTML5</a> targets. Those targets would also require the modified <a href="https://github.com/Regal-Internet-Brothers/webcc-monkey/tree/master/webcc.data/modules" target="_blank">modules found here</a>. Needless to say, you're not getting anywhere without some effort. That ecosystem was designed for out-of-project requests and the like, but it's not a cohesive product.<br><br>Where does this leave custom formats? Well, not too far off. It's pretty common to see local paths in file formats, and normally, you'd have enough of a file-system to allow "cd-like" traversal. Monkey doesn't have that by default. That's the unfortunate thing about Mojo's HTML5 backend, and admittedly, it's one of Monkey's worst aspects. There's no official solution at the moment, so you'd basically need to keep track of file paths yourself. <i>However</i>, <a href="https://github.com/Regal-Internet-Brothers/virtualos" target="_blank">my module does handle path semantics</a> on JS targets. Although it's tied to the rest of the code, I could break it up more. This is something I've wanted to do for a while, and I'm not entirely sure how to go about it yet.<br><br>That's the gist of it, though. What's really annoying is the lack of out-of-project image loading in Mojo 1. More secure? Yes, but more effective? Not so much. Other than that, it has the same shortfalls as HTML5 with regular JavaScript. <br><br></td></tr></table><br>
<a name="2115551"></a>

<a name="2115550"></a>

<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
