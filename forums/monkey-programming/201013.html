<!DOCTYPE html><html lang="en" ><head ><title >Batching?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Batching?</h1><a href="forums.php" >Monkey Forums</a>/<a href="topics.php?forum=507" >Monkey Programming</a>/<a href="#bottom" >Batching?</a><br><br>
<a name="2008734"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dom</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi!<br><br>I got a little performance problem with displaying a bit gui and text (using angelfont) already (all platforms at least -50% FPS with gui enabled).<br><br>After browsing the forum I am wondering: <br>1) Are e.g. DrawImage calls somehow batched if they use the same texture or would I have to implement this myself?<br><br>2) Should I maybe even go so far, and merge the static quads to a single mesh or triangle strips?<br><br>Anybody got some experience?<br>I'd be glad for any tips as I really like the idea of the engine...but having to go so low level might be a killer :/ <br><br></td></tr></table><br>
<a name="2008738"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> do you have a lot of empty space in the images? <br><br></td></tr></table><br>
<a name="2008742"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dima</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> it might give you a boost, havent looked deep into target sources, unsure what the current implementation is.  for my current mobile game i prerender static texts into textures and display portions for scrolling. this way effects like dropshadows can be baked in. takes a lot more memory, so best to load these textures on demand and unload unused ones. <br><br></td></tr></table><br>
<a name="2008745"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dom</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Slenkar: I disabled blending, no noteable difference.<br><br><br>The whole situation made me curious and I took a look at the mojo native implementation for android.<br><br>It appears, that if you call e.g. DrawImage with the same texture, it should get batched.<br><br>I assume the following: using diddy-gui, I draw the labels with background (color -&gt; DrawRect) and text per component.<br>Meaning no batching can happen, as it (mojo) flushes as soon as something changes (any tags for code formatting?):<br><br>	void Begin( int type,int count,gxtkSurface surf ){<br>		if( type!=rtype || surf!=rsurf || rcount+count&gt;MAX_VERTICES ){<br>			Flush();<br>			rtype=type;<br>			rsurf=surf;<br>		}<br>		rcount+=count;<br>	}<br><br>So I guess in order to take advantage of batching, I'd need so some how sort the DrawImage/DrawRect calls by material myself...or simply assign all labels etc. the same texture.<br>And draw all text in a separate (batched) pass (don't know if pass is the correct term here).<br><br>I'll try to verify this with perfHud and keep you posted =) <br><br></td></tr></table><br>
<a name="2008752"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >anawiki</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Take a look at my post in iOS section called "Why AngelFont is so slow". To make the story short, I accidentally loaded to many fonts into memory and it slowed the game from 60 to 30 FPS. Maybe it's the same case in your situation. <br><br></td></tr></table><br>
<a name="2008789"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dom</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>thanks for pointing it out!<br>I have read the thread before posting and changed it already though =)<br><br>Didn't have any success with perfHUD yet, but I currently really think this is because of the draw calls and state changes:<br>(FPS on Desire)<br>No gui: ~45 FPS<br>With gui (no text meaning text set to ""): ~35 FPS<br>With gui and text: 8 FPS<br><br>The frame drop vom 45 to 35 is already quite big for a few labels (30-40 piece)...and since it renders label1 background, label1 text, label2 bg, label2 text, etc. this could be the answer =)<br><br>I also see that there is a lot of Push and Pop-Matrix going on...which actually shouldn't be needed for static gui if one pre-bakes the transformaiton and so.<br><br>I'll post my results asap. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
