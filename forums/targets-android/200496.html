<!DOCTYPE html><html lang="en" ><head ><title >Home Menu Back Search buttons</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Home Menu Back Search buttons</h1><a href="forums.php" >Monkey Targets Forums</a>/<a href="topics.php?forum=502" >Android</a>/<a href="#bottom" >Home Menu Back Search buttons</a><br><br>
<a name="2003821"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bremer</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I cannot seem to find out how to check if a user is pressing one of the fixed buttons most Android phones seems to have. I would like to be able to check if the Back button is pressed and have my game return to the main menu selection screen.<br><br>Does anyone know if this is possible and how it is done? I did search for it on the forum but did not find anything specific on this. <br><br></td></tr></table><br>
<a name="2003822"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hima</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> The back button is map to escape button, I think. As for the others, I have no idea :( <br><br></td></tr></table><br>
<a name="2003850"></a>

<a name="2003851"></a>

<a name="2003852"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Virtech</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> This will allow you to exit the app when the back button is hit... <br><br><pre class=code>
	Method OnUpdate ()
	
		' Quit App
		If KeyHit(KEY_ESCAPE)
			Error ""
		EndIf
			
	End
</pre><br><br>I dont think the other adroid buttons are functional in monkey yet. <br><br></td></tr></table><br>
<a name="2003885"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Supertino</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Would love to know what the back button is mapped to... if at all? <br><br></td></tr></table><br>
<a name="2003886"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Supertino - as Hima has said and Virtech has shown the back button is mapped to KEY_ESCAPE <br><br></td></tr></table><br>
<a name="2003906"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Perturbatio</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> The home button should not be overridden, it should allow the user to return to the home screen, this is how they "quit" the app.  <br><br>according to the android docs finish() should be invoked to end your application:<br><br><div class="quote"> <br>public void finish ()<br>Since: API Level 1<br><br>Call this when your activity is done and should be closed. The ActivityResult is propagated back to whoever launched you via onActivityResult().<br> <br></div> <br><br></td></tr></table><br>
<a name="2003911"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Supertino</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> @therevills Sorry meant to say Menu button. <br><br></td></tr></table><br>
<a name="2005089"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Xaron</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I second that. Anyone knows how the Menu button is mapped? <br><br></td></tr></table><br>
<a name="2005091"></a>

<a name="2005092"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmmmm reading this:<br><br><a href="http://developer.android.com/guide/topics/ui/menus.html" target="_blank">http://developer.android.com/guide/topics/ui/menus.html</a><br><br><a href="http://developer.android.com/guide/topics/search/search-dialog.html" target="_blank">http://developer.android.com/guide/topics/search/search-dialog.html</a><br><br>Apart from adding the code directly to the mojo android target, Im not sure if the community can do it by themselves without creating a new Android target.<br><br>I guess we need Mark to add the following commands to mojo:<br><br><pre class=code>
public boolean onSearchRequested()

public boolean onCreateOptionsMenu(Menu menu)
</pre><br><br>And assign them to a keyhit state, like public void onBackPressed():<br><br><pre class=code>
	public void onBackPressed(){
		if( app!=null ){
			app.input.OnKeyDown( 27 );
			app.input.OnKeyUp( 27 );
		}
	}
</pre> <br><br></td></tr></table><br>
<a name="2005093"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just tested and it seems to work:<br><br>Monkey code which flashes the screen and quits when "Escape" is hit:<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Strict

Import mojo

Global myGame:MyGame

Function Main:Int()
	myGame = New MyGame
	Return 0
End Function

Class MyGame Extends App

	Method OnCreate:Int()
		SetUpdateRate 60
		Return 0
	End
	
	Method OnLoading:Int()
		Return 0
	End
	
	Method OnUpdate:Int()
		If KeyHit(KEY_ESCAPE)
			Error ""
		End
		Return 0
	End
	
	Method OnRender:Int()
		Cls(Rnd(255), Rnd(255), Rnd(255))
		Return 0
	End	
End
</textarea><br><br>Adding the following code to mojo.android.java in the MonkeyGame class:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
	public boolean onSearchRequested(){
		if( app!=null ){
			app.input.OnKeyDown( 27 );
			app.input.OnKeyUp( 27 );
		}
		return super.onSearchRequested();
	}
	
	public boolean onCreateOptionsMenu(Menu menu) {
		if( app!=null ){
			app.input.OnKeyDown( 27 );
			app.input.OnKeyUp( 27 );
		}
		return true;
	}
</textarea><br><br>So when running the app on Android, if you now press either the Menu, Back or Search buttons the application will end. <br><br></td></tr></table><br>
<a name="2005110"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Loofadawg</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nice!  Thanks for doing the footwork. <br>Currently I don't suppose there is a way to use the Menu button so we can use it as an actual Menu within app instead of a way to exit? <br><br>Right now Virtech's method is how my app closes.  I plan to write some additional code to bring up a dialog box to verify whether the user really wishes to quit and/or use the Back button as a way to access the app menu. <br><br></td></tr></table><br>
<a name="2005123"></a>

<a name="2005128"></a>

<a name="2005129"></a>

<a name="2005130"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Currently I don't suppose there is a way to use the Menu button so we can use it as an actual Menu within app instead of a way to exit?  <br></div><br><br>I was just testing Escape key with the onSearchRequested and onCreateOptionsMenu commands... to create an actual Android menu, you will have to create an XML file and alter the mojo android java file even more...<br><br>Have a read of this: <a href="http://developer.android.com/guide/topics/ui/menus.html" target="_blank">http://developer.android.com/guide/topics/ui/menus.html</a><br><br>Of course you could alter the key which is "hit" on the buttons and create your own Monkey dialogs:<br><br><pre class=code>
If KeyHit(KEY_ESCAPE) ' Back Button Pressed
	Error ""
End

If KeyHit(KEY_F1) ' Menu Button Pressed
	New MenuDialog()
End

If KeyHit(KEY_F2) ' Search Button Pressed
	New SearchDialog()
End
</pre><br><br>And the Android code:<br><br><pre class=code>
	public boolean onSearchRequested(){
		if( app!=null ){
			app.input.OnKeyDown( 113 ); // F2 Key
			app.input.OnKeyUp( 113 );
		}
		return super.onSearchRequested();
	}
	
	public boolean onCreateOptionsMenu(Menu menu) {
		if( app!=null ){
			app.input.OnKeyDown( 112 ); // F1 Key
			app.input.OnKeyUp( 112 );
		}
		return true;
	}
</pre> <br><br></td></tr></table><br>
<a name="2005121"></a>

<a name="2005175"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >a1programmer</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here's the code for Menu -&gt; Exit.<br><br><br>Java (activity)<br><pre class=code>
	
@Override
public boolean onCreateOptionsMenu(Menu menu) {
	MenuInflater inflater = getMenuInflater();
	inflater.inflate(R.menu.menu, menu);
	return true;
}

@Override
public boolean onOptionsItemSelected(MenuItem item) {
	// Handle item selection
	switch (item.getItemId()) {

	case R.id.exit:
	    this.finish();
	    return true;
	default:
	   return super.onOptionsItemSelected(item);
	}

}
</pre><br><br>/menu/menu.xml<br><pre class=code>
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;menu xmlns:android="http://schemas.android.com/apk/res/android"&gt;
    &lt;item android:id="@+id/exit" android:title="@string/exit" /&gt;
&lt;/menu&gt;

</pre><br><br>/values/strings.xml<br><pre class=code>
 &lt;string name="exit"&gt;Exit&lt;/string&gt;
</pre> <br><br></td></tr></table><br>
<a name="2005197"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Xaron</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks guys, very useful! <br><br></td></tr></table><br>
<a name="2009524"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bladko</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> for me works only first click. Nothing more is displayed and i cannot use this button any more until app is restarted.<br><br><pre class=code>
If KeyHit(KEY_F1) 
	x = x + 1  'works only once
End
</pre><br><br>probably standard menu is created but due to missing buttons we cannot close it, that is why further pressing this key does not work <br><br></td></tr></table><br>
<a name="2009539"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Change the java to return false instead of true - I think this will let you hit the key more than once ;)<br><br><pre class=code>
	public boolean onCreateOptionsMenu(Menu menu) {
		if( app!=null ){
			app.input.OnKeyDown( 112 ); // F1 Key
			app.input.OnKeyUp( 112 );
		}
		return false;
	}

</pre> <br><br></td></tr></table><br>
<a name="2009556"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bladko</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> thanks a lot, this is very helpful <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
