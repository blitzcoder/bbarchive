<!DOCTYPE html><html lang="en" ><head ><title >Read Available for TCPStreams?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Read Available for TCPStreams?</h1><a href="forums.php" >Monkey Targets Forums</a>/<a href="topics.php?forum=502" >Android</a>/<a href="#bottom" >Read Available for TCPStreams?</a><br><br>
<a name="2110382"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yeshu777</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>What's the required method for checking there is data available on a TCP Stream before trying to read it?<br><br>Using Eof always returns 0 even if the stream is unreadable.<br><br>Any pointers?<br><br>Yeshu777 <br><br></td></tr></table><br>
<a name="2110383"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >k.o.g.</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I was trying to implement it.<br>It worked, but to hacky :/ ask mark lovely to implement it :D <br><br></td></tr></table><br>
<a name="2110392"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImmutableOctet(SKNG)</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Getting past the synchronous setup of using a '<a href="http://www.monkey-x.com/docs/html/Modules_brl.tcpstream_TcpStream.html" target="_blank">TcpStream</a>' over a '<a href="http://www.monkey-x.com/docs/html/Modules_brl.socket_Socket.html" target="_blank">Socket</a>', you basically just call '<a href="http://www.monkey-x.com/docs/html/Modules_brl.stream_Stream.html#ReadAll" target="_blank">ReadAll</a>' without caring. But, unless you're looking to read a raw buffer, <b>these will be called for you</b>.<br><br>The point of a '<a href="http://www.monkey-x.com/docs/html/Modules_brl.tcpstream_TcpStream.html" target="_blank">TcpStream</a>' (Currently) is to read <b>synchronously</b> from a TCP connection, meaning it isn't able to perform these operations on other threads. Because of this, '<a href="http://www.monkey-x.com/docs/html/Modules_brl.stream_Stream.html#Eof" target="_blank">Eof</a>' isn't always the most optimal way to check if the connection died. It will work, but not before other operations take place. If the connection was severed, the stream's '<a href="http://www.monkey-x.com/docs/html/Modules_brl.stream_Stream.html#Read" target="_blank">Read</a>' implementation would get a response from the system. It then sees this response, and if it was <i>negative</i>, it sets appropriate variables to ensure '<a href="http://www.monkey-x.com/docs/html/Modules_brl.stream_Stream.html#Eof" target="_blank">Eof</a>' works, then returns.<br><br>If you're manually using '<a href="http://www.monkey-x.com/docs/html/Modules_brl.stream_Stream.html#Read" target="_blank">Read</a>' (Which could cause problems), this would cause the return-value to be 0 or less than 0. No questions asked, now '<a href="http://www.monkey-x.com/docs/html/Modules_brl.stream_Stream.html#Eof" target="_blank">Eof</a>' works as expected, and you can't read from the stream. That being said, <b>most operations performed with a 'Stream' use '<a href="http://www.monkey-x.com/docs/html/Modules_brl.stream_Stream.html#ReadAll" target="_blank">ReadAll</a>'</b>. '<a href="http://www.monkey-x.com/docs/html/Modules_brl.stream_Stream.html#ReadAll" target="_blank">ReadAll</a>' is different, it's a "structured read", meaning it checks if data could be read, and continuously calls '<a href="http://www.monkey-x.com/docs/html/Modules_brl.stream_Stream.html#Read" target="_blank">Read</a>' until the number of bytes requested has been received. Commands like 'ReadInt' use this by default.<br><br>Alright, so the question is: <b><i>"What happens when '<a href="http://www.monkey-x.com/docs/html/Modules_brl.stream_Stream.html#ReadAll" target="_blank">ReadAll</a>' gets an invalid response from '<a href="http://www.monkey-x.com/docs/html/Modules_brl.stream_Stream.html#Read" target="_blank">Read</a>', because we disconnected?"</i></b> - It throws an exception. This is how any stream-related code should handle errors like this. To be more specific, it calls its 'ReadError' method, which throws a '<a href="http://www.monkey-x.com/docs/html/Modules_brl.stream_StreamReadError.html" target="_blank">StreamReadError</a>' exception. After that's been caught, '<a href="http://www.monkey-x.com/docs/html/Modules_brl.stream_Stream.html#Eof" target="_blank">Eof</a>' will work. <b>The stream must still be closed once you are done</b>. Closing the stream also closes the internal socket with it. This will not be done on a timeout/disconnection. You'll need to call '<a href="http://www.monkey-x.com/docs/html/Modules_brl.stream_Stream.html#Close" target="_blank">Close</a>' like every other 'Stream'.<br><br><b><i>"So, how do I check if there's something to read?"</i></b> - The answer is, you don't. There isn't really a standard way of querying the system for this information. You either receive it, or you don't. There's two ways to do what you're asking, but they don't fit the envelope of a 'Stream'. The first is to receive, using the POSIX-standard '<i><a href="http://linux.die.net/man/2/select" target="_blank">select</a></i>' command (Getting in to C territory here). This would be used to stall the current thread like it normally does, but the system would be able to use a timeout you set. The other way is to use another thread. This is possible using a '<a href="http://www.monkey-x.com/docs/html/Modules_brl.socket_Socket.html" target="_blank">Socket</a>' directly, but is not possible with a '<a href="http://www.monkey-x.com/docs/html/Modules_brl.tcpstream_TcpStream.html" target="_blank">TcpStream</a>' (Currently). Basically, you would have a different thread wait, while you perform your usual work on the main thread.<br><br><b>Everything relating to input I just mentioned applies to output as well</b>. <br><br></td></tr></table><br>
<a name="2110389"></a>

<a name="2110390"></a>

<a name="2110391"></a>

<a name="2110388"></a>

<a name="2110386"></a>

<a name="2110387"></a>

<a name="2110385"></a>

<a name="2110384"></a>

<a name="2110393"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yeshu777</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Many thanks for the replies, had guessed as much.<br><br>Basically, I have a small app, connects to an FTP server usingTCP Socket, which is causing problems on V5 Android devices.<br><br>ie, reading the socket when there is nothing to read causes the app to crash / terminate (works fine on V4)<br><br>So, looks like I'll need to implement the same using Async Socket method, thanks for the confirmation.<br><br>Yeshu777 <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
