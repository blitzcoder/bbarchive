<!DOCTYPE html><html lang="en" ><head ><title >REQ: directives for multiple SoundPool allocation</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >REQ: directives for multiple SoundPool allocation</h1><a href="forums.php" >Monkey Targets Forums</a>/<a href="topics.php?forum=502" >Android</a>/<a href="#bottom" >REQ: directives for multiple SoundPool allocation</a><br><br>
<a name="2062733"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nobuyuki</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello,<br><br>This is a feature request specific to Android.  Currently, mojo only allocates one SoundPool resource for all the sound effects in a game.  This is usually not a problem, and probably a good thing for most uses because it minimizes heap allocation, however, as many of us have discovered, Android only allows 1mb of allocation per SoundPool, causing errors like this:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
E/AudioFlinger(   89): not enough memory for AudioTrack size=16960

E/AudioTrack(22269): AudioFlinger could not create track, status: -12

E/SoundPool(22269): Error creating AudioTrack
</textarea><br><br>This happens even on small samples, as you can see, if you have any larger looped samples in memory.  By many estimates on the forums, you can have up to 10 seconds of sound data loaded into memory in total with the current system before this starts to happen.  I've attempted to get around this inside Monkey by using the various Discard() functions and hoping the system would free the memory before I had to allocate more, but still, in my current project, sounds continue to drop out.<br><br>There seem to be many ways to approach this limitation on the native side -- One of the solutions would involve having a custom sound system, but an easier solution would be to hack mojo to allocate multiple SoundPools behind the scenes, hardcoding certain channels to certain SoundPools.  This would be transparent to the monkey coder, but would increase the total heap size necessary to bootstrap a monkey game.<br><br>Instead what I'm requesting is something similar to the above solution, but to be allocated with a preprocessor directive.  The directive would specify either how many SoundPools it would allocate, or how much memory, in multiples of 1mb.  The free channels could either be divvied up between SoundPools (this would be the easier of the two suggestions to implement), or -- perhaps a better longterm solution -- a pool manager to track allocations and assign them dynamically based on the sample's size to the most empty SoundPool could be written.<br><br>I'll update this post to make the case for this (and final remarks) soon, but right now I'm a bit short on time and gotta go.  Throwing this up here, for now!<br><br><br><b>Edit</b>:  Okay, so, I have a bit more time here to explain what's going on in my project.  We have both sound and music in the game, and some samples are short looping types which (for speed purposes) need to be in memory whenever the screen which plays them is active.  As ambient environmental effects, they're in somewhat of a no-man's land between whether they're best suited for MediaPlayer or SoundPool.  However, Monkey only allocates one of each of these, regardless, so I couldn't use the looping samples like "Music" regardless.  <br><br>There appears to be a delay between when my code tells the sounds to be released (between screens) and when they're actually released, causing the re-allocations of sounds on the next screen to fail with the above types of errors.  As I said before, the real limit of SoundPool is 1mb for all allocated sounds, but this wouldn't be so much of a problem if sounds were unloaded when -I- wanted them to be, not when mojo/android/whatever is ready to make that sweep.  If it's not within mojo's control to flush immediately, then a workaround would probably have to be provided.  <br><br>Since we can't force the OS to increase the allocation size of a pool, I figured having multiple ones would be the first place to look... SoundPool may or may not have exclusive access when preparing to play a sample and can't mix multiple allocations, but I'm not sure of this.  <br><br>Anyone else have similar experiences?  Know about SoundPool usage?  Etc?  Please leave comments below :) <br><br></td></tr></table><br>
<a name="2062732"></a>

<a name="2062731"></a>

<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
