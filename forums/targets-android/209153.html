<!DOCTYPE html><html lang="en" ><head ><title >I did a traceview...</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >I did a traceview...</h1><a href="forums.php" >Monkey Targets Forums</a>/<a href="topics.php?forum=502" >Android</a>/<a href="#bottom" >I did a traceview...</a><br><br>
<a name="2095803"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> My game is stuttering at the beginning of a level.<br><br>I tried drawing all images to the screen to prevent this but I think the tablet's graphic memory can't hold all the images.<br><br>here are the methods that take up all the time<br><br>gxtksurface.bind<br> children:<br>           self 44%<br>           java/NIO/ReadWritePixbufferput 44%<br><br>here is the trace file:<br><a href="http://www.mediafire.com/download/b9wc55wcmpmsyf4/calc.trace" target="_blank">http://www.mediafire.com/download/b9wc55wcmpmsyf4/calc.trace</a> <br><br></td></tr></table><br>
<a name="2095892"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SGEM</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Strangely enough I have been doing much the same thing here.  This is exactly the results I would expect to see based on the code.  This is a particular problem for android when onSuspend is sent to the application (due to a popup or interstitial advert etc).  I am in the process of testing my modifications to the android source for mojo to resolve this problem.  <br><br>The current implementation will pad the image (if not power of two) and then convert the pixel format while pre-rending the alpha every time the texture is bound.  This is why all the time is being spent in the Bind() method.<br><br>The solution I'm looking at involves performing all of this work upfront and storing the resultant pixel array.  The downside is increased memory usage, but this does significantly reduce the garbage collection thrashing that I was seeing in my game as there are no allocations during the Bind() phase any more.<br><br>Provisional results look very promising on one of my slower test devices (ZTE Blade), the it took up to 7 seconds for the textures to be prepared after returning from an interstitial advert - i.e. 7 seconds before the UI became responsive again.  After my changes it took less than 0.2 seconds.  This is an absolute game changer in terms of usability.<br><br>If Mark is "listening" I would be very happy to contribute the changes assuming it continues to perform as expected during testing.  The way I have it implemented at the moment its that it can be enabled or disabled through a pre-processor tag so it should be possible to integrate it into the core product without impacting any existing applications. <br><br></td></tr></table><br>
<a name="2095893"></a>

<a name="2095894"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh please share, that would be great!<br><br>Maybe each image could be tagged as important or not important.<br><br><br>At the moment I am drawing each image that is used in a certain level before loading the level. This works for the first 2 but the other 2 are still experiencing stutter problems. <br><br></td></tr></table><br>
<a name="2096084"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SGEM</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have responded via email.  Let me know how you get on. <br><br></td></tr></table><br>
<a name="2096093"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Soap</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Are you using texture atlases? <br><br></td></tr></table><br>
<a name="2096376"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Maybe take a look at this old thread which dealt with both memory usage and speed of the binding operation: <a href="http://www.monkey-x.com/Community/posts.php?topic=2589&amp;page=1" target="_blank">http://www.monkey-x.com/Community/posts.php?topic=2589&amp;page=1</a> . The relevant stuff starts from around post 20. <br><br></td></tr></table><br>
<a name="2096435"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SGEM</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the heads up.  An interesting read.  I've taken a slightly different approach, but maybe a hybrid might provide the right balance.  However I need to get this app launched before I get distracted with profiling again... :) <br><br></td></tr></table><br>
<a name="2097609"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SGEM</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay, I have taken another look at this and I think Mark has already provided the best compromise solution.  Providing you ensure that your images / image atlases are power of 2 sizes, rename the Bind2() function of gxtkSample in the mojo android source to Bind() and rename the existing Bind() function.<br><br>This was you can use Mark's "experimental" code which although very slightly slower than my modifications, consumes far, far less memory and therefore is the better solution.<br><br>Comparative timings below from Hop Or Pop on my test ZTE Blade device, using the three different methods.<br><br>Time taken to bind all GL textures after returning to application (time in seconds)<br><br>Current implementation: 8.4<br>My memory hungry solution: 0.04<br>Mark's Bind2(): 0.43<br><br>In terms of user experience there is no perceptible difference between Mark's solution and mine.<br><br>I hope this helps some of you. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
