<!DOCTYPE html><html lang="en" ><head ><title >Stutter after upgrading to v43</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Stutter after upgrading to v43</h1><a href="forums.php" >Monkey Targets Forums</a>/<a href="topics.php?forum=502" >Android</a>/<a href="#bottom" >Stutter after upgrading to v43</a><br><br>
<a name="2009744"></a>

<a name="2009745"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >devolonter</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> That's strange. After upgrading to v43 my port Impact ( <a href="https://github.com/devolonter/Impact/tree/unstable" target="_blank">https://github.com/devolonter/Impact/tree/unstable</a> ) for Android begin to "stutter" on my Desire Z (Android 2.2). If you have an opportunity please, compare two versions 1.06 and 1.10a of section <a href="https://github.com/devolonter/Impact/downloads" target="_blank">https://github.com/devolonter/Impact/downloads</a> <br><br></td></tr></table><br>
<a name="2009753"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >anawiki</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I noticed the same for my game. It might have something to do with HICOLOR_TEXTURES=true (means using 32 bit textures), but I'm still testing it.<br><br>I am so disappointed with Android devices. Last Friday I checked my game on 4th gen iPod and it worked almost 60 FPS, while Samsung Galaxy Tab p1010 (7") barely gets to 40FPS. <br><br></td></tr></table><br>
<a name="2009755"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >devolonter</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> @anawiki I've tried to set HICOLOR_TEXTURES = false, but this has not led to any changes on my device :( <br><br></td></tr></table><br>
<a name="2009757"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >anawiki</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> on mine too... which makes me very disappointed <br><br></td></tr></table><br>
<a name="2009760"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just tested Impact on my LG Optimus One P500, I would say that the 1.10a runs better than the 1.06. And I saw a stutter on the 1.06... <br><br></td></tr></table><br>
<a name="2009763"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >anawiki</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> don't see a big difference in performance for both versions on galaxy tab. maybe if you had FPS counter displayed would be easier to compare. <br><br></td></tr></table><br>
<a name="2009773"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >anawiki</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Not sure about your but I just installed 2 versions of my game on galaxy tab - one compiled in v42b and one in v43.<br><br>v42b - 32-34 FPS<br>v43  - 16-18 FPS<br><br>What happened? Is that just the fact of using VBO? <br><br></td></tr></table><br>
<a name="2009818"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >arcsrc</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I didn't do any FPS comparison but the first thing i noticed after compiling my game on v43 was the stuttering. I tested on a Galaxy S. <br><br></td></tr></table><br>
<a name="2009823"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> How does Replica Island work for your devices?<br><br><a href="http://code.google.com/p/replicaisland/" target="_blank">http://code.google.com/p/replicaisland/</a><br><br>Replica Island uses VBOs when it can... <br><br></td></tr></table><br>
<a name="2009836"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dave.h</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> plays perfect on my experia x10 <br><br></td></tr></table><br>
<a name="2009846"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >devolonter</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> I spent the whole day testing v43, but unfortunately it did not come to any conclusions. The only thing that I've noticed in v43: my device is noticeably get hot (really a lot), FPS can jump from 20 to a comfortable 55-58 at the same time it's hard to find some kind of dependence ... Perhaps the problem is in high loading CPU? <br><br>@Anawiki I built an application with FPS. On the game screen, I got the following results: v42b - 56-58FPS, v43 - 25-30FPS (sometimes grows to 50). I upload the update to my server - <a href="http://devolonter.ru/impact_fps.zip" target="_blank">http://devolonter.ru/impact_fps.zip</a> Just wanted to know if I could somehow test your game? <br><br>@Therevills Replica Island works fine on my device <br><br></td></tr></table><br>
<a name="2009856"></a>

<a name="2009857"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AdamRedwoods</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> @devolonter:  No stuttering on Galaxy Tab.<br><br>Note to FPS on different devices:<br>Phones and smaller screens have less pixels to update, so you will get better frame rates.<br><br>Here's a site that explains it on iPad:<br><a href="http://www.fabiensanglard.net/fillrate_issues/" target="_blank">http://www.fabiensanglard.net/fillrate_issues/</a> <br><br></td></tr></table><br>
<a name="2009858"></a>

<a name="2009859"></a>

<a name="2009860"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AdamRedwoods</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> The other note about stuttering is be careful how much Object creation/destroying you do, as the garbage collection may slow things down.<br>Try using a pre-allocated pool of objects.<br><br><a href="http://fanitis.com/2011/02/09/android-game-performance-garbage-collection/" target="_blank">http://fanitis.com/2011/02/09/android-game-performance-garbage-collection/</a><br><br>Or Not:<br><a href="http://stackoverflow.com/questions/4900014/is-it-impossible-to-make-an-android-game-stutter-free-i-am-going-crazy-here" target="_blank">http://stackoverflow.com/questions/4900014/is-it-impossible-to-make-an-android-game-stutter-free-i-am-going-crazy-here</a><br><br><br>My last thought is that PHONES will be looking for signals, calls, messages, etc, in the background. This will cause stuttering. Maybe this is why the Galaxy Tab Wifi does not stutter. <br><br></td></tr></table><br>
<a name="2009871"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> @devolonter - just downloaded the fps versions.<br><br><pre class=code>
           | v42b  |  v43
-----------+-------+------
Titlescreen| 24-27 | 46-50
Gamescreen | 55-59 | 23-30
</pre><br><br>At least the titlescreen runs alot better in v43... :/ <br><br></td></tr></table><br>
<a name="2009873"></a>

<a name="2009874"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >anawiki</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Garbage collection is not an issue in my game. Remember, that's the same code, just compiled in two Monkey versions: v42b and v43. When I watch DDMS it shows that GC doesn't kick in more often than once per 2 seconds. There are of course parts in my game where GC kicks in a lot and I don;t get many FPS, but for game screen I had ~36 FPS and now I don't.<br><br>I am compiling in release mode. <br><br></td></tr></table><br>
<a name="2009882"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jowli</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've lost at least 20 FPS as well, which including the FPS lost in previous monkey updates means I am down to my last 5 FPS! <br>It feels like we are missing something here, seems as though most of us are not getting the expected performance boost.<br><br>It would be good to know more about how we should be using the HICOLOR_TEXTURES flag.<br><br>The other odd thing I noticed is that when compiling in eclipse, I get 5 warnings complaining about 'Dead code'. Every one of these relates to a line of code containing the MonkeyData.HICOLOR_TEXTURES flag. e.g.<br><br>if( MonkeyData.HICOLOR_TEXTURES &amp;&amp; hasAlpha ){<br>... <br><br></td></tr></table><br>
<a name="2009885"></a>

<a name="2009886"></a>

<a name="2009887"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >devolonter</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> @therevills It's not so bad:) In most of the tests, I found out 15-20% FPS gain in comparison with the version v42b. So I think V43 is nevertheless faster, it is necessary to understand why it doesn't work in real games. <br><br>As for the stuttering. I have carried out a small test (with a minimum number of objects) which excludes at least some loss of FPS, and have found out that stuttering remain even in this case. Thus, they occur at regular intervals, that suggests about a problem with FPS stabilization. I do not know what mechanism of stabilization is used in mojo, and it seems, it does not work very well for Android, also the same situation was noticed in XNA target, but there it is less expressed.<br><br>Here is a source code of the test. This is a slightly modified code from this post - <a href="http://www.monkeycoder.co.nz/Community/post.php?topic=869&amp;post=7366" target="_blank">http://www.monkeycoder.co.nz/Community/post.php?topic=869&amp;post=7366</a> :<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Import mojo.app
Import mojo.input
Import mojo.graphics

Class Sprite
Private
	Field _image:Image
	Field _xpos#, _ypos#, _angle#
	Field _r#, _g#, _b#, _a#
	Field _speed#
	Field _dx#, _dy#
	
	Method _Move:Void()
		Local x:= _xpos + _dx
		Local y:= _ypos + _dy
		If x &lt; 0 - _image.Width()  Then x = DeviceWidth()
		If x &gt; DeviceWidth() + _image.Width() Then x = 0 - _image.Width()
		If y &lt; 0 - _image.Height() Then y = DeviceHeight()
		If y &gt; DeviceHeight() + _image.Height() Then y = 0 - _image.Height()
		_xpos = x
		_ypos = y
	End
	
Public
	Method New( image:Image )
		_image = image
		_r = 255.0 * Rnd()
		_g = 255.0 * Rnd()
		_b = 255.0 * Rnd()
		_a = Rnd() + 0.5
		_speed = (4.0 * Rnd()) + 1.0
	End
	
	Method SetPosition:Void( xpos#, ypos# )
		_xpos = xpos
		_ypos = ypos
	End
	
	Method SetRotation:Void( angle# )
		_angle = angle
	End

	Method Update:Void()
		_dx = (-Sin(_angle) * _speed)
		_dy = ( Cos(_angle) * _speed)
		_Move
	End

	Method Render:Void()
		SetAlpha _a
		SetColor _r, _g, _b
		DrawImage _image, _xpos, _ypos, _angle, 1, 1
	End
End

Class FPSCounter
	Global fpsCount:Int
	Global startTime:Int
	Global totalFPS:Int

	Function Update:Void()
		If Millisecs() - startTime &gt;= 1000
			totalFPS = fpsCount
			fpsCount = 0
			startTime = Millisecs()
		Else
			fpsCount+=1
		End
	End

	Function Draw:Void(x% = 0, y% = 0)
		DrawText("FPS: " + totalFPS, x, y)
	End
End

Class RenderTest Extends App
Private
	Field _shipList:List&lt;Sprite&gt;

	Field _background:Image, _ship:Image
	
	Field _zoomFactorX:Float
	Field _zoomFactorY:Float
	
	Field _countObjects:Int
	
	Const WIDTH:Float = 480
	Const HEIGHT:Float = 320
	
	Method _AddObjects:Void()
		For Local i:= 0 Until 10
				Local ship:= New Sprite( _ship )
			Local x:= Rnd( DeviceWidth )
			Local y:= Rnd( DeviceHeight )
			ship.SetPosition( x, y )
			ship.SetRotation( 360.0 * Rnd )
			_shipList.AddLast( ship )	
			_countObjects+=1	
		End
	End Method

Public	
	Method OnCreate()
		_ship = LoadImage( "Ship1.png", 1, Image.MidHandle )
		_background = LoadImage( "galaxy2.png" )

		_shipList = New List&lt;Sprite&gt;
		For Local i:= 0 Until 10
			Local ship:= New Sprite( _ship )
			Local x:= Rnd( DeviceWidth )
			Local y:= Rnd( DeviceHeight )
			ship.SetPosition( x, y )
			ship.SetRotation( 360.0 * Rnd )
			_shipList.AddLast( ship )
			_countObjects+=1
		End
		
		SetUpdateRate 60
		_zoomFactorX = Float(DeviceWidth()) / Float(WIDTH)
		_zoomFactorY = Float(DeviceHeight()) / Float(HEIGHT)
	End

	Method OnUpdate()
#If TARGET="android"
		If KeyHit( KEY_ESCAPE ) Then Error ""
#End		
		If (MouseHit()) Then _AddObjects()		
		
		For Local ship:= Eachin _shipList
			ship.Update
		End
	End

	Method OnRender()
		FPSCounter.Update()
	
		Cls '&lt;--- Actually improves fps
		Scale(_zoomFactorX, _zoomFactorY)
		DrawImage _background, 0, 0
		For Local ship:= Eachin _shipList
			ship.Render
		End
		
		SetAlpha 1.0
		SetColor 255,255,255
		FPSCounter.Draw(0,0)
		DrawText ("Objects: " + _countObjects, 0, 10*_zoomFactorY)
	End
End

Function Main()
	New RenderTest
End
</textarea> <br><br></td></tr></table><br>
<a name="2009888"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jowli</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ignore what I said about the 'Dead code', I realised what it is; HICOLOR_TEXTURES is static, so branches of the code will never get called depending on it value. <br><br></td></tr></table><br>
<a name="2009890"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AdamRedwoods</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> devolonter test<br>v42b<br>(with the rocket in bananas folder, and 461x516 png arbitrary galaxy):<br><br>10 objects---<br>I get 37 - 42 fps on the Galaxy Tab Wifi. Almost no stuttering.<br><br>80 objects---<br>22 - 28 fps Galaxy Tab wifi, small amounts of stuttering. <br><br></td></tr></table><br>
<a name="2009902"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >devolonter</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> @AdamRedwoods thanks for testing. It seems all devices behave absolutely  differently ( <br><br></td></tr></table><br>
<a name="2009903"></a>

<a name="2009904"></a>

<a name="2009906"></a>

<a name="2009907"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> @devolonter - just looking thru your Impact code and I do notice that you are not using any sort of delta timing for movement:<br><br>asteroid.monkey:<br><pre class=code>
Method OnUpdate:Void()
	frame += ANIM_SPEED
	If (frame &gt;= FRAMES) Then frame -= FRAMES
	x += dx
	y += dy
	If (x &lt; -32 Or x &gt; Application.WIDTH + 32 Or y &gt; Application.HEIGHT + 32) Then Destroy()
End
</pre><br><br>If you add in delta timing it might help your stuttering.<br><br><pre class=code>
Const FPS:Int = 60
' Used for delta timing movement
Global dt:DeltaTimer = New DeltaTimer(FPS)

Class MyGameApp Extends App
...
	Method OnUpdate:Int()
		dt.UpdateDelta()
...
End

' From James Boyd
Class DeltaTimer
	Field targetfps:Float = 60
	Field currentticks:Float
	Field lastticks:Float
	Field frametime:Float
	Field delta:Float
	
	Method New (fps:Float)
		targetfps = fps
		lastticks = Millisecs()
	End
	
	Method UpdateDelta:Void()
		currentticks = Millisecs()
		frametime = currentticks - lastticks
		delta = frametime / (1000.0 / targetfps)
		lastticks = currentticks
	End
End
</pre><br><br>And use it like this:<br><br><pre class=code>
	x += dx * dt.delta
	y += dy * dt.delta
</pre> <br><br></td></tr></table><br>
<a name="2009905"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> I suggest that you guys start timing the updates and render calls separately. The mojo update loop does not necessarily exhibit a smooth degradation in rendered frames when your game can't keep up with the requested update rate. <br><br></td></tr></table><br>
<a name="2009922"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AdamRedwoods</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> I get a slight drop of 2-4 FPS after updating to v43 with the above demo.<br>Galaxy Tab wifi. <br>Sorry. <br><br></td></tr></table><br>
<a name="2009973"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >devolonter</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> @therevills thank you! I really missed it. I added delta timing locally, this made the movements more smooth, but unfortunately it did not save from the global stuttering :( At some instant time objects begin to move terribly slowly, and then abruptly quickly. It looks like an stuck record... In the near future I'll post a video, that shows it. <br><br></td></tr></table><br>
<a name="2010006"></a>

<a name="2010008"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >devolonter</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> These videos show  stuttering, which I see after upgrade to v43.  I do not see anything like this in v42b.<br><a href="http://www.youtube.com/watch?v=fbWvfFO9AMw" target="_blank">http://www.youtube.com/watch?v=fbWvfFO9AMw</a> (from 00:47 second)<br><a href="http://www.youtube.com/watch?v=CIChaSOY_S0" target="_blank">http://www.youtube.com/watch?v=CIChaSOY_S0</a><br><br>After two days of tests I did not come to any conclusions, and I'm upset  ... While searching for a solution I looked through another open-source game engines for android. And stumbled upon andengine - <a href="http://www.andengine.org/." target="_blank">http://www.andengine.org/.</a> Author uploaded on Android.Market ( <a href="https://market.android.com/details?id=org.anddev.andengine.examples" target="_blank">https://market.android.com/details?id=org.anddev.andengine.examples</a> ) examples, so I had the opportunity to evaluate his work. None of the examples had such stuttering, all object's movements were very smooth. May be one should try to write the mojo alternative with the same interface and architecture based on this framework? <br><br></td></tr></table><br>
<a name="2010015"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MonkeyPig</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> This may or may not help, but I had similar issues with stuttering on Android and figured it was garbage collection. I attached DDM and sure enough in the log I could see significant time being spent in GC every couple of seconds.<br><br>Using the Allocation Tracker in DDM I was able to see where in my code the offending allocations where and removed them until they were all gone (well almost all - I know of a couple that need a little more work to remove).<br><br>There are still many allocations happening as part of the Android system - but none that directly relate to my sloppy Monkey(ing) around.<br><br>Things to be aware of - Strings create allocations. I reworked my HUD to rework stuff like lives:String = m_NumLives. DrawText(lives). The java string builder was creating allocations as a result of this simple Monkey code.<br><br>Avoid using For Eachin because the iterator creates a temp allocation.<br><br>Multiply that by the framerate you're running at and the every couple of seconds the garbage collector cleans up. Slowly.<br><br>NOTE: I'm no android expert - so I may be wrong on this. This was just what I could measure and appear to remedy with the changes I outline above. <br><br></td></tr></table><br>
<a name="2010035"></a>

<a name="2010036"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AdamRedwoods</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry for the messy code, but I wonder if converting to an array instead of a sprite list will remove the stuttering. Seemed to do ok for me.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Import mojo.app
Import mojo.input
Import mojo.graphics


Class Sprite
Private
	Field _image:Image
	Field _xpos#, _ypos#, _angle#
	Field _r#, _g#, _b#, _a#
	Field _speed#
	Field _dx#, _dy#
	
	Method _Move:Void()
		Local x:= _xpos + _dx '* RenderTest.dt.delta
		Local y:= _ypos + _dy '* RenderTest.dt.delta
		If x &lt; 0 - _image.Width()  Then x = DeviceWidth()
		If x &gt; DeviceWidth() + _image.Width() Then x = 0 - _image.Width()
		If y &lt; 0 - _image.Height() Then y = DeviceHeight()
		If y &gt; DeviceHeight() + _image.Height() Then y = 0 - _image.Height()
		_xpos = x
		_ypos = y
	End
	
Public
	Method New( image:Image )
		_image = image
		_r = 255.0 * Rnd()
		_g = 255.0 * Rnd()
		_b = 255.0 * Rnd()
		_a = Rnd() + 0.5
		_speed = (4.0 * Rnd()) + 1.0
	End
	
	Method SetPosition:Void( xpos#, ypos# )
		_xpos = xpos
		_ypos = ypos
	End
	
	Method SetRotation:Void( angle# )
		_angle = angle
	End

	Method Update:Void()
		_dx = (-Sin(_angle) * _speed)
		_dy = ( Cos(_angle) * _speed)
		_Move
	End

	Method Render:Void()
		SetAlpha _a
		SetColor _r, _g, _b
		DrawImage _image, _xpos, _ypos, _angle, 1, 1
	End
End

Class FPSCounter
	Global fpsCount:Int
	Global startTime:Int
	Global totalFPS:Int

	Function Update:Void()
		If Millisecs() - startTime &gt;= 1000
			totalFPS = fpsCount
			fpsCount = 0
			startTime = Millisecs()
		Else
			fpsCount+=1
		End
	End

	Function Draw:Void(x% = 0, y% = 0)
		DrawText("FPS: " + totalFPS, x, y)
	End
End

Class RenderTest Extends App
	Const FPS:Int = 60
' Used for delta timing movement
	Global dt:DeltaTimer
	
Private
	Field _shipList:List&lt;Sprite&gt;

	Field _background:Image, _ship:Image
	
	Field _zoomFactorX:Float
	Field _zoomFactorY:Float
	
	Field _countObjects:Int
	
	Const WIDTH:Float = 480
	Const HEIGHT:Float = 320
	
	Field shipcache:Sprite[] = New Sprite[200]
	Field shiptotal:Int
	
	Method _AddObjects:Void()
		For Local i:= 0 Until 10
				Local ship:= New Sprite( _ship )
			Local x:= Rnd( DeviceWidth )
			Local y:= Rnd( DeviceHeight )
			ship.SetPosition( x, y )
			ship.SetRotation( 360.0 * Rnd )
			_shipList.AddLast( ship )	
			shipcache[shiptotal] =  ship
			_countObjects+=1	
			shiptotal +=1
		End
	End Method

Public	
	Method OnCreate()
		dt = New DeltaTimer(FPS)
		_ship = LoadImage( "ship.png", 1, Image.MidHandle )
		_background = LoadImage( "galaxy.png" )

		_shipList = New List&lt;Sprite&gt;
		For Local i:= 0 Until 10
			Local ship:= New Sprite( _ship )
			Local x:= Rnd( DeviceWidth )
			Local y:= Rnd( DeviceHeight )
			ship.SetPosition( x, y )
			ship.SetRotation( 360.0 * Rnd )
			_shipList.AddLast( ship )
			shipcache[shiptotal] =  ship
			_countObjects+=1
			shiptotal +=1
		End
		
		SetUpdateRate 60
		_zoomFactorX = Float(DeviceWidth()) / Float(WIDTH)
		_zoomFactorY = Float(DeviceHeight()) / Float(HEIGHT)
	End

	Method OnUpdate()
		'dt.UpdateDelta()

#If TARGET="android"
		If KeyHit( KEY_ESCAPE ) Then Error ""
#End		
		If (MouseHit()) Then _AddObjects()		
		
		'Local ship:Sprite[100]
		For Local n:Int= 0 To shiptotal-1
			shipcache[n].Update
		End
	End

	Method OnRender()
		FPSCounter.Update()
	
		Cls '&lt;--- Actually improves fps
		Scale(_zoomFactorX, _zoomFactorY)
		DrawImage _background, 0, 0
		For Local n:Int= 0 To shiptotal-1
			shipcache[n].Render
		End
		
		SetAlpha 1.0
		SetColor 255,255,255
		FPSCounter.Draw(0,0)
		DrawText ("Objects: " + _countObjects, 0, 10*_zoomFactorY)
	End
End

Function Main()
	New RenderTest
End

' From James Boyd
Class DeltaTimer
	Field targetfps:Float = 60
	Field currentticks:Float
	Field lastticks:Float
	Field frametime:Float
	Field delta:Float
	
	Method New (fps:Float)
		targetfps = fps
		lastticks = Millisecs()
	End
	
	Method UpdateDelta:Void()
		currentticks = Millisecs()
		frametime = currentticks - lastticks
		delta = frametime / (1000.0 / targetfps)
		lastticks = currentticks
	End
End
</textarea> <br><br></td></tr></table><br>
<a name="2010120"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >devolonter</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> @AdamRedwoods In my opinion objects move more smoothly<br><br>Today I've experimented directly with mojo code for Android target. I've tried to change the update logic and application rendering based on existing open source frameworks. <br><br>It has gave the results in tests too. I've got smoother objects movement and the problem of sharp loss FPS has gone, but in the game everything hasn't improved considerably, though nevertheless some there was some improvement. <br><br>Unfortunately, I cannot describe all changes that I've made in a mojo code, because there are a lot of them and I can not upload code in open access since it still contains a lot of an original mojo code and I think Mark will disapprove of it. But I can send my mojo.android.java version on email to everyone (please write on mail, not to clutter up theme, in a letter indicate your nickname on the site). I'm curious to know your results. Maybe this will help to solve the problem.<br><br>I have written a small test: <a href="http://devolonter.ru/MonkeyRenderTest.zip" target="_blank">http://devolonter.ru/MonkeyRenderTest.zip</a> All test run in release mode. V43 X - Monkey v43 with my mojo version. <br><br>Solid<br><pre class=code>
         +--------+--------+--------+
 Objects |  V42b  |  V43   |  V43 X |
+--------+--------+--------+--------+
| 10     |   58   |   58   |   58   |
+--------+--------+--------+--------+
| 50     |   58   |   58   |   58   |
+--------+--------+--------+--------+
| 100    |   49   |   58   |   58   |
+--------+--------+--------+--------+
| 150    |   37   |   58   |   58   |
+--------+--------+--------+--------+
| 200    |   29   |  27-30 |   58   |
+--------+--------+--------+--------+
| 250    |   24   |  25-27 |   58   |
+--------+--------+--------+--------+
| 300    |   21   |  25-26 |  57-58 |
+--------+--------+--------+--------+
</pre><br>Alpha<br><pre class=code>
         +--------+--------+--------+
 Objects |  V42b  |  V43   |  V43 X |
+--------+--------+--------+--------+
| 10     |   58   |   58   |   58   |
+--------+--------+--------+--------+
| 50     |   58   |   58   |   58   |
+--------+--------+--------+--------+
| 100    |   49   |   58   |   58   |
+--------+--------+--------+--------+
| 150    |   37   |   58   |   58   |
+--------+--------+--------+--------+
| 200    |   30   |  30-31 |   58   |
+--------+--------+--------+--------+
| 250    |   25   |  28-30 |   58   |
+--------+--------+--------+--------+
| 300    |   21   |  26-29 |  57-58 |
+--------+--------+--------+--------+
</pre><br>Animated<br><pre class=code>
         +--------+--------+--------+
 Objects |  V42b  |  V43   |  V43 X |
+--------+--------+--------+--------+
| 10     |   58   |   58   |   58   |
+--------+--------+--------+--------+
| 50     |   58   |   58   |   58   |
+--------+--------+--------+--------+
| 100    |   48   |   58   |   58   |
+--------+--------+--------+--------+
| 150    |   36   |   58   |   58   |
+--------+--------+--------+--------+
| 200    |  28-29 |  50-52 |   58   |
+--------+--------+--------+--------+
| 250    |  23-24 |  46-48 |   58   |
+--------+--------+--------+--------+
| 300    |  20-21 |  45-48 |  57-58 |
+--------+--------+--------+--------+
</pre><br>Colorize<br><pre class=code>
         +--------+--------+--------+
 Objects |  V42b  |  V43   |  V43 X |
+--------+--------+--------+--------+
| 10     |   58   |   58   |   58   |
+--------+--------+--------+--------+
| 50     |   58   |   58   |   58   |
+--------+--------+--------+--------+
| 100    |   48   |   58   |   58   |
+--------+--------+--------+--------+
| 150    |   36   |   58   |   58   |
+--------+--------+--------+--------+
| 200    |  28-29 |  55-56 |  56-58 |
+--------+--------+--------+--------+
| 250    |  23-24 |  48-49 |  55-56 |
+--------+--------+--------+--------+
| 300    |  20-21 |  40-42 |  51-52 |
+--------+--------+--------+--------+
</pre> <br><br></td></tr></table><br>
<a name="2010119"></a>

<a name="2010118"></a>

<a name="2010122"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wow some serious improvements there!<br><br>Can you describe your improvements and what open source framework did you base it on? <br><br></td></tr></table><br>
<a name="2010127"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >devolonter</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> Major changes: the main loop moved into thread, RenderMode changed to - RENDERMODE_CONTINUOUSLY. This often causes the renderer, but it's worth it. I also modified onTouch method (reduced use of reflection to a minimum), but it does not matter in this test. My version was based on andengine ( <a href="http://www.andengine.org/" target="_blank">http://www.andengine.org/</a> )<br><br>About performance improvement... In some tests original v43 sharply reduced FPS and it's happened several times, so values in the table are much different, in fact I think the real improvement can be seen in the Animated and Colorize tables. What I say for sure - this is a very smooth motion for 58 FPS in my version, so at least this is an improvement :) But we need more tests. If you want I'll send you my version on email. <br><br></td></tr></table><br>
<a name="2010131"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>Looking good! Can you send me the code? <br><br></td></tr></table><br>
<a name="2010149"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#32">[#32]</a></td></tr></table></td></tr><tr ><td class="posttext"> Mark sent me the file:<br><br>S = Solid<br>A = Alpha<br>An = Animated<br>C = Colorize<br><br><pre class=code>
         +--------+--------+--------+--------+++--------+--------+--------+--------+++--------+--------+--------+--------++
 Objects |  V42bS |  V42bA |  V42bAn|  V42bC |||  V43S  |  V43A  |  V43 An|  V43 C |||  V43XS |  V43XA |  V43XAn|  V43XC ||
+--------+--------+--------+--------+--------+++--------+--------+--------+--------+++--------+--------+--------+--------++
| 10     |   59   |   59   |   59   |   59   |||   60   |   60   |   60   |   60   |||   59   |   60   |   60   |   58   ||
+--------+--------+--------+--------+--------+++--------+--------+--------+--------+++--------+--------+--------+--------++
| 50     |   36   |   36   |   35   |   35   |||   59   |   59   |   59   |   59   |||   59   |   59   |   59   |   59   ||
+--------+--------+--------+--------+--------+++--------+--------+--------+--------+++--------+--------+--------+--------++
| 100    |   22   |   22   |   22   |   21   |||   48   |   43   |   43   |   43   |||   44   |   44   |   44   |   44   ||
+--------+--------+--------+--------+--------+++--------+--------+--------+--------+++--------+--------+--------+--------++
| 150    |   15   |   15   |   15   |   15   |||   42   |   43   |   41   |   40   ||| 37-44  |  37-44 |   37   |   42   ||
+--------+--------+--------+--------+--------+++--------+--------+--------+--------+++--------+--------+--------+--------++
| 200    |   12   |  12    |   12   |   11   |||   29   |   30   |   29   |   29   |||   29   |  29    |   29   |   29   ||
+--------+--------+--------+--------+--------+++--------+--------+--------+--------+++--------+--------+--------+--------++
| 250    |   9    |  9     |   9    |   9    |||   27   |   27   |   27   |   27   |||   25   |  26    |   25   |   24   ||
+--------+--------+--------+--------+--------+++--------+--------+--------+--------+++--------+--------+--------+--------++
| 300    |   7    |  7     |   7    |   7    |||   23   |   23   |   23   |   22   |||   22   |  22    |   22   |   21   ||
+--------+--------+--------+--------+--------+++--------+--------+--------+--------+++--------+--------+--------+--------++
</pre><br><br>So the 43X is slightly worse on my phone with that RenderTest. Now testing Pirates...<br><br>Level 1, Hand 1 (30 cards on the game field):<br><pre class=code>
    | FPS
----+---------
42b | 31-35
43  | 22-28
43X | 20-26
</pre> <br><br></td></tr></table><br>
<a name="2010148"></a>

<a name="2010147"></a>

<a name="2010146"></a>

<a name="2010143"></a>

<a name="2010144"></a>

<a name="2010145"></a>

<a name="2010162"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >devolonter</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#33">[#33]</a></td></tr></table></td></tr><tr ><td class="posttext"> @therevills Thanks for testing! It is a pity that the results were not as good as mine. I sent you a new version, it can change something... <br><br></td></tr></table><br>
<a name="2010167"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#34">[#34]</a></td></tr></table></td></tr><tr ><td class="posttext"> No problem - Thanks for helping with this issue.<br><br><pre class=code>
         +--------+--------+--------+--------+
 Objects |  V43X1S|  V43X1A| V43X1An|  V43X1C|
+--------+--------+--------+--------+--------+
| 10     |   59   |   59   |   59   |   59   |
+--------+--------+--------+--------+--------+
| 50     |   59   |   59   |   59   |   59   |
+--------+--------+--------+--------+--------+
| 100    |   44   |   44   |   44   |   44   |
+--------+--------+--------+--------+--------+
| 150    |   39   |   39   |   39   |   38   |
+--------+--------+--------+--------+--------+
| 200    |   31   |   31   |   30   |   30   |
+--------+--------+--------+--------+--------+
| 250    |   26   |   26   |   26   |   26   |
+--------+--------+--------+--------+--------+
| 300    |   22   |   22   |   22   |   22   |
+--------+--------+--------+--------+--------+
</pre><br><br>Pirates now get between 21-26FPS... <br><br></td></tr></table><br>
<a name="2010166"></a>

<a name="2010187"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >devolonter</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#35">[#35]</a></td></tr></table></td></tr><tr ><td class="posttext"> @therevills Thank you! I continue to research andengine code, searching for solution of rendering performance. If there are some results I'll let you know <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
