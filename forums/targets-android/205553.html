<!DOCTYPE html><html lang="en" ><head ><title >Optimization / Speed tip for larger arrays</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Optimization / Speed tip for larger arrays</h1><a href="forums.php" >Monkey Targets Forums</a>/<a href="topics.php?forum=502" >Android</a>/<a href="#bottom" >Optimization / Speed tip for larger arrays</a><br><br>
<a name="2062355"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wylaryzel</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hiho,<br><br>I'm currently in process to develop my next game. The programming in monkey went very well and during the testing in HTML5/GWFL target I didn't care to much on speed. Nevertheless, the main target is aimed for mobile, especially android.<br><br>Yesterday I made some stress tests for the dungeon generation engine and was a bit astonished by the results I obtained (it generates a map sized  90x70 fields randomly). Such a generation takes around 6 seconds but on android it takes around 16 secs.<br><br>I made some further checks and today I made a simple for - next loop to test how long it would may take at least to convert the data into a long string (like to be stored with SaveState).<br><br>to check the performance I used:<br><pre class=code>
local str:string = ""
for local i:int = 0 to 6300
   str += ",1"
next
</pre><br><br>with the above code and according to Dalvik debug monitor it takes around 16secs and the GC activities are incredibly?<br><br>Next I tried a similar function, but this time I used a string[] and after the for/next loop I joined the str. This took maximum 0.011 secs:<br><pre class=code>
local strArray:string[6300]
for local i:int = 0 until 6300
    strArray[i] = "1"
next
local str:string = ","
str = str.Join(strArray)
</pre><br><br>This brings me to my question: as I have to store the state of around 20 dungeons with several additional information,  I will have several conversation operations (from int to string for saving and back to int for loading).<br><br>How to you experts perform that action to write/read the SaveState? And has somebody an technical explanation for a newcomer why the first operation takes so long and invokes the GC like crazy?<br><br>Thx in advance <br><br></td></tr></table><br>
<a name="2062365"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AdamRedwoods</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> strings are immutable in Monkey, so string operations always return a new one.<br><br>that said, monkey translates the<br><pre class=code>
str+=",1"
</pre><br>to<br><pre class=code>
t_str=t_str+",1";
</pre><br>in java.<br><br>so the problem is in java, a common problem, which is explained in stack overflow:<br><a href="http://stackoverflow.com/questions/1532461/stringbuilder-vs-string-concatenation-in-tostring-in-java/1532547#1532547" target="_blank">http://stackoverflow.com/questions/1532461/stringbuilder-vs-string-concatenation-in-tostring-in-java/1532547#1532547</a><br><br>so for performance reasons, in this case, i would use arrays. <br><br></td></tr></table><br>
<a name="2062363"></a>

<a name="2062367"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wylaryzel</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the information and especially the link :-) There are so many information in Goggle ( :-) ) that it's sometimes hard to identify the currect one :)<br><br>So its maybe best to build a string[] and convert it via a string.Join to and resolve it afterwards via a split-string. Looks complicated but knowing this now, I can work with corresponding functions :-) <br><br></td></tr></table><br>
<a name="2062381"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raph</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Aha, I just sped up a text routine by 500% by moving much of it to arrays, and now I think I will move as much as I can! <br><br></td></tr></table><br>
<a name="2062382"></a>

<a name="2062383"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you want to do this and avoid manually handling the arrays there are a few StringBuilder implementations out there. I think Diddy has one and there's one tucked away in my json lib at the top of this file: <a href="https://code.google.com/p/monkey-json/source/browse/jsondata.monkey" target="_blank">https://code.google.com/p/monkey-json/source/browse/jsondata.monkey</a> <br><br></td></tr></table><br>
<a name="2062652"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nobuyuki</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> yes, string immutability means that appending strings a lot and performing operations like this on android means they will be very slow.  One way to deal with it, depending on the data, is to convert it to a char array and then to something like an IntStack to perform operations on it there, then return it all back.  Java provides an object called StringBuilder to deal with this stuff natively;  you can also mess with this if you are OK with working with native routines.  Finally, diddy provides a stringbuilder class which supposedly is fast on Android.  Consider using some of its methods to concat and append strings.... <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
