<!DOCTYPE html><html lang="en" ><head ><title >IAP info pops up under monkeygame</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >IAP info pops up under monkeygame</h1><a href="forums.php" >Monkey Targets Forums</a>/<a href="topics.php?forum=502" >Android</a>/<a href="#bottom" >IAP info pops up under monkeygame</a><br><br>
<a name="2078393"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >pantson</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi<br>I've followed all the guides (and copied code) on the forums.<br>In each case my monkeygame stops responding once you purchase an IAP item. Once I press Yes to close, the Google Wallet popup is beneath the monkeygame app.<br><br>Is this normal behaviour? I dont see anyone else mentioning this.<br><br>I have followed guides by Xaron (many thanks btw) and keep getting the same "feature"<br><br>many thanks <br><br></td></tr></table><br>
<a name="2078391"></a>

<a name="2078561"></a>

<a name="2078562"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Xaron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Could you explain a bit more what you did? The Google Wallet pops up indeed as soon as you do a purchase. It should close after doing (or canceling) the purchase. <br><br></td></tr></table><br>
<a name="2078564"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >pantson</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'll get the relevant code and screenshots up later... ta<br><br>I assume the wallet window appears above the monkeygame and game carries on beneath? <br><br></td></tr></table><br>
<a name="2078677"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >pantson</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi<br>I've finally manged to get an error in the logs<br><pre class=code>I/[Monkey](17709): shop open
E/AndroidRuntime(17709): FATAL EXCEPTION: main
E/AndroidRuntime(17709): java.lang.RuntimeException: Store currently busy
E/AndroidRuntime(17709): 	at com.appytimes.gpcz.bb_std_lang.error(MonkeyGame.java:145)
E/AndroidRuntime(17709): 	at com.appytimes.gpcz.c_MonkeyStore.p_BuyProductAsync(MonkeyGame.java:6831)
E/AndroidRuntime(17709): 	at com.appytimes.gpcz.c_shopper.p_BuyProduct(MonkeyGame.java:5917)
E/AndroidRuntime(17709): 	at com.appytimes.gpcz.c_myApp.p_OnUpdate(MonkeyGame.java:5022)
E/AndroidRuntime(17709): 	at com.appytimes.gpcz.c_GameDelegate.UpdateGame(MonkeyGame.java:5428)
E/AndroidRuntime(17709): 	at com.appytimes.gpcz.BBGame.UpdateGame(MonkeyGame.java:568)
E/AndroidRuntime(17709): 	at com.appytimes.gpcz.BBAndroidGame.UpdateGame(MonkeyGame.java:1271)
E/AndroidRuntime(17709): 	at com.appytimes.gpcz.BBAndroidGame$GameTimer.run(MonkeyGame.java:823)
E/AndroidRuntime(17709): 	at android.os.Handler.handleCallback(Handler.java:730)
E/AndroidRuntime(17709): 	at android.os.Handler.dispatchMessage(Handler.java:92)
E/AndroidRuntime(17709): 	at android.os.Looper.loop(Looper.java:176)
E/AndroidRuntime(17709): 	at android.app.ActivityThread.main(ActivityThread.java:5419)
E/AndroidRuntime(17709): 	at java.lang.reflect.Method.invokeNative(Native Method)
E/AndroidRuntime(17709): 	at java.lang.reflect.Method.invoke(Method.java:525)
E/AndroidRuntime(17709): 	at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:1046)
E/AndroidRuntime(17709): 	at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:862)
E/AndroidRuntime(17709): 	at dalvik.system.NativeStart.main(Native Method)
E/android.os.Debug( 2362): !@Dumpstate &gt; sdumpstate -k -t -z -d -o /data/log/dumpstate_app_error
E/        (17534): Device driver API match
E/        (17534): Device driver API version: 23
E/        (17534): User space API version: 23 
E/        (17534): mali: REVISION=Linux-r3p2-01rel3 BUILD_DATE=Wed Oct  9 21:05:57 KST 2013 
E/Finsky  (17534): [8068] FileBasedKeyValueStore.delete: Attempt to delete 'paramsOUJbxt9ZVx5nRI2zmgrddQ' failed!
E/OpenGLRenderer( 3891): SFEffectCache:clear(), mSize = 0
E/OpenGLRenderer( 3891): SFEffectCache:clear(), mSize = 0
E/OpenGLRenderer( 3891): SFEffectCache:clear(), mSize = 0
E/Watchdog( 2362): !@Sync 850
E/SQLiteLog(18739): (1) duplicate column name: extraData
E/BadgeProvider(18739): onUpgarde :: Trying to add Column :: Exception already exists:duplicate column name: extraData (code 1): , while compiling: ALTER TABLE apps ADD COLUMN extraData TEXT DEFAULT base_extra_badge;
E/ViewRootImpl( 2362): sendUserActionEvent() mView == null
E/EnterpriseContainerManager( 2362): ContainerPolicy Service is not yet ready!!!
E/Watchdog( 2362): !@Sync 851
</pre><br><br>Just trying to read it myself to see what the score is<br>Devices are S3 and Sony Xperia Play <br><br></td></tr></table><br>
<a name="2078680"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >pantson</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> i wonder if it because Ive made my code too complicated.<br>What I have done, is wrapped variations of the iaptest.monkey and your code into another class. so that I can call store = new shopper<br>The shopper class extends the brl instances and not the main game.<br><br>I'm gong to test the simple iaptest and your code on their own to see if its me (and probably is) <br><br></td></tr></table><br>
<a name="2078714"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >pantson</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> found it!<br><pre class=code>
 java.lang.RuntimeException: Store currently busy
</pre><br>It does what it says on the tin ;-)<br><br>Added another if not store.IsBusy() check. All fixed! <br><br></td></tr></table><br>
<a name="2078717"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Added another if not store.IsBusy() check. All fixed! <br></div><br>Hey Rich - where did you add this? <br><br></td></tr></table><br>
<a name="2078731"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >pantson</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> my buyproduct function didn't check to see if the store was busy before buying something.<br>Looks like 2 calls to buyproduct in a row, without completing the first crashed the game<br><br>new code...<br><pre class=code>
Method BuyProduct:Int(product:String)
	If Not IsBusy()
		For Local p:=Eachin store.GetProducts()
			If p.Identifier = product
				store.BuyProductAsync p,Self
				Return True
			End
		Next
	End
	Return False
End
</pre> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
