<!DOCTYPE html><html lang="en" ><head ><title >Speed things up..</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Speed things up..</h1><a href="forums.php" >Monkey Targets Forums</a>/<a href="topics.php?forum=502" >Android</a>/<a href="#bottom" >Speed things up..</a><br><br>
<a name="2074367"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paul - Taiphoz</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wondering what techniques other people use to keep their frame rates as high as possible.. <br><br></td></tr></table><br>
<a name="2074368"></a>

<a name="2074369"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> * Atlases<br>* Pooling Lists<br>* Limited Sounds<br>* Don't use "new" in your main game loop<br>* Precache images<br>* Don't load any new resources in the main loop <br><br></td></tr></table><br>
<a name="2074370"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Amon</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>* Atlases<br>* Pooling Lists<br>* Limited Sounds<br>* Don't use "new" in your main game loop<br>* Precache images<br>* Don't load any new resources in the main loop <br> <br></div><br><br>At least leave some room for others to chime in. :D <br><br></td></tr></table><br>
<a name="2074371"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paul - Taiphoz</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> care to throw some detail in with those buzz words therevills ?.<br><br>Atlases or sheets I use, would be nice to get everything on a single sheet but some times its not practical, does sound really have that big of an impact on frame rate, its not something I have personally noticed.<br><br>Whats your method for not using new in the main loop ? I have a fair guess at what you mean but would love some more info there, I use new any time I create a new effect, explosion, or spawn in new sprites to the level so I probably use new a lot, but then I have not really noticed slow down in relation to these calls, the frame rate drops I see, seem to be coming from me drawing to much to the screen, I tend not to get drops in frames when new stuff is being created. <br><br></td></tr></table><br>
<a name="2074372"></a>

<a name="2074381"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Volker</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Using android:minSdkVersion=9<br>Kicks around 15% of the user but avoids the stuttering because of the old not concurrent garbage collector.<br><br>What's that, where is the preview button? <br><br></td></tr></table><br>
<a name="2074376"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> * Atlases<br>- Try precaching (see below)<br>* Pooling Lists<br>- Create all your objects first and reuse them over the game. For example, say you have a bullet list and you want to create a bullet every time the player fires... you can "guess" how many bullets the player can fire so instead of just calling "new bullet(x,y)", grab one from the pooled list of bullets.<br>* Limited Sounds<br>- Yes I have seen sound affects FPS<br>* Don't use "new" in your main game loop<br>  - Depending on what version of Android you are targeting, in the dark days (1 - 2 years ago, not sure now since Volker's post about the GC - got any info on that?) when you create a new object, it gave the GC a change to kick in and cause a slow down (sometimes). See above with pooling.<br>* Precache images<br>- When loading your images just draw them off screen so they are already on the GPU, so when you go to use them they are ready to go.<br>* Don't load any new resources in the main loop <br>- For example don't load images or sounds - say you create a bullet sprite and just "quickly" load a new image for it, this will cause I/O and hurt your FPS <br><br></td></tr></table><br>
<a name="2074377"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paul - Taiphoz</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks I suspected most of it, never thought about caching the images first tho, I guess thats why I get a stutter when a sprite is drawn for the first time, its not a massive issue really but def worth doing, would I be right in saying that it only needs to be a single sprite from a sheet tho given its on the same image ? or how would grab image be effected would grabbed images from existing sheets need to be cached as well...<br><br>that's given me something to think about, thanks for the info.. anyone got any other ideas ? <br><br></td></tr></table><br>
<a name="2074378"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paul - Taiphoz</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Talking about a bullet as an example, how do you go about it I was thinking giving the class an Active boolean which can be set to true or false when its active and on screen, and then when I shoot a new bullet just look for the first InActive sprite and move it, set its image to the right image and then set it active, or is there a better way ?<br><br>Would it be worth creating a second list for active objects and a list for all InActive objects... I think that might actually cause more overhead tho. <br><br></td></tr></table><br>
<a name="2074379"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paul - Taiphoz</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh talking about pre-caching could you not code that into diddy so that it does a quick offscreen render of all images in its map when the first screen is drawn or something ? <br><br></td></tr></table><br>
<a name="2074380"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Volker</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Garbage collection: <br><a href="http://developer.android.com/about/versions/android-2.3-highlights.html" target="_blank">http://developer.android.com/about/versions/android-2.3-highlights.html</a><br>The new GC is integrated since Android 2.3. <br>So minSdkVersion=9 forces to use the new one.<br><a href="http://developer.android.com/guide/topics/manifest/uses-sdk-element.html" target="_blank">http://developer.android.com/guide/topics/manifest/uses-sdk-element.html</a><br>Under the old GC it could take 30-50 ms to finish which results in stuttering.<br>The new one should be finished under 3 ms.<br><br>I was tired about all the pooling stuff, so I decided to target only the higher versions. <br><br></td></tr></table><br>
<a name="2074383"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paul - Taiphoz</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> My current issue sadly seems not to be tied to the above, I am trying to draw 400+ sprites and I think the hardware just aint liking it, I wonder if I have approached the max a decent phone will play nice with in terms of the total number of sprites being rendered.<br><br>the good thing is that I can cut nearly half of that simply by removing the call to Glow() and can probably reduce it more by not using every single tile space available for a level which is find cos I have a lot of tile room.<br><br>anyway bed time.. gona book mark this thread I wana have a read at that stuff you linked Volker. <br><br></td></tr></table><br>
<a name="2074392"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wylaryzel</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Thanks I suspected most of it, never thought about caching the images first tho, I guess thats why I get a stutter when a sprite is drawn for the first time, its not a massive issue really but def worth doing, would I be right in saying that it only needs to be a single sprite from a sheet tho given its on the same image ? or how would grab image be effected would grabbed images from existing sheets need to be cached as well... <br></div><br><br>At least what I have identified is that it should be sufficient to draw at least one GrabImage from a Atlas to move the whole Atlas to the GPU memory. I had stuttering myself but with drawing one image during the loading screen it went away. <br><br></td></tr></table><br>
<a name="2074400"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gerry Quinn</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Monkey has a Pool class which can help with object re-use if you don't want to manage it yourself. <br><br></td></tr></table><br>
<a name="2074411"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paul - Taiphoz</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> wot......... is there an example of its use some where I didnt know it had that .. not seen it in the doc's although I am gona go look now. <br><br></td></tr></table><br>
<a name="2074474"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gerry Quinn</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just look in brl for pool.monkey.  It's as simple as it could be, really.  Just:<br><br>global thingPool:Pool&lt; Thing &gt; = New Pool&lt; Thing&gt;<br>...<br>' Somewhere in code<br>Local thing:Thing = thingPool.Allocate()<br>thing.Clear()<br>...<br>' Finished with it<br>thingPool.Free( thing )<br><br><br>I just put in a possible Clear() function there to indicate that the object may have been used before and contain old data.  For example a Point object with x:Int and y:Int might not come with zero in x and y.  Obviously you don't have to have a Clear() function, just remember that.<br><br>You can create the pool with any number of objects, depending how many you will need.  Default creates 10 initially. <br><br></td></tr></table><br>
<a name="2074421"></a>

<a name="2074426"></a>

<a name="2074427"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >muddy_shoes</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> The Android dev kit comes with a pretty decent profiler that's easy to use via Eclipse. While all the general advice is fine to bear in mind when you're planning/writing code for Android if you've got running code with performance issues then you should be profiling that code to see what actually is wrong rather than taking informed guesses.<br><br>I'm happy to help you with profiling it via Google Hangout/Skype/IM if you want. Or you could send me the project and I'll profile it and offer advice if I can. <br><br></td></tr></table><br>
<a name="2074436"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paul - Taiphoz</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> muddy_shoes I will deff get you in the monkey hangout and get some help with that after xmas, it's something I don't really know much about, this is the first time its ever really been an issue for me thankfully. <br><br></td></tr></table><br>
<a name="2074467"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Supertino</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> When I switch to using 2 1024x1024 atlas' for my Santa's workshop game from something like 30-40 individual images the speed improvement on my old HTC phone was like night and day, texture swapping where possible should be avoided. <br><br></td></tr></table><br>
<a name="2074500"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bruZard</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> "Don't load any new resources in the main loop "<br>do you load all resources in App::OnCreate() ?!? <br><br></td></tr></table><br>
<a name="2074501"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> do you load all resources in App::OnCreate() ?!?  <br></div><br>Depends on how big the game is... but I actually didn't mean that, I normally load common resources during OnCreate and other resources when loading levels - not in the main game loop (ie when the player is playing...) <br><br></td></tr></table><br>
<a name="2074504"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paul - Taiphoz</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah I have used the loading of levels to switch atlas's a few times, its handy since the player is prepped and prepared to wait during the process its far better doing it then, than trying to do it on the fly. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
