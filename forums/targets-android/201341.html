<!DOCTYPE html><html lang="en" ><head ><title >Developing for Xperia Play Gamepad!</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Developing for Xperia Play Gamepad!</h1><a href="forums.php" >Monkey Targets Forums</a>/<a href="topics.php?forum=502" >Android</a>/<a href="#bottom" >Developing for Xperia Play Gamepad!</a><br><br>
<a name="2012114"></a>

<a name="2012115"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Aman</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I want to take advantage of the gamepad in the Sony Ericsson Xperia Play. I know that monkey does not support it by default but it should not be that hard.<br><br>This is my attempt and I think I am on the right direction. Sadly, I don't have an Xperia Play and cannot verify if this works or not. I have a track pad and was able to test the KEYCODE_DPAD_CENTER which is  triggered when pressing the X button on Xperia Play and it worked!<br><br>Can any body with Xperia Play confirm if this works or not?<br><br>Add this code to mojo.android.java:<br><pre class=code>public boolean onKeyDown(int keyCode, KeyEvent event) { // Attmpt to Handle GamePad &amp; DPad Events
	if( app!=null ){
		switch(keyCode){
			case 23:  // KEYCODE_DPAD_CENTER 'trackpad or X button(Xperia Play) is pressed
				app.input.OnKeyDown( 13 );	  // KEY_ENTER
				break;
			case 4:	 // KEYCODE_BACK 'Back Button or O Button(Xperia Play) is pressed
				app.input.OnKeyDown( 27 );	  // KEY_ESCAPE
				break;
			case 99:  // KEYCODE_BUTTON_X	'Square button(Xperia Play) is pressed
				app.input.OnKeyDown( 88 );	  // KEY_X
				break;
			case 100: // KEYCODE_BUTTON_Y	'Triangle button(Xperia Play) is pressed
				app.input.OnKeyDown( 89 );	  // KEY_Y
				break;
			case 21:						  // KEYCODE_DPAD_LEFT
				app.input.OnKeyDown( 37 );	  // KEY_LEFT
				break;
			case 19:						  // KEYCODE_DPAD_UP
				app.input.OnKeyDown( 38 );	  // KEY_UP
				break;
			case 22:						  // KEYCODE_DPAD_RIGHT
				app.input.OnKeyDown( 39 );	  // KEY_RIGHT
				break;
			case 20:						  // KEYCODE_DPAD_DOWN
				app.input.OnKeyDown( 40 );	  // KEY_DOWN
				break;
			case 102:						  // KEYCODE_BUTTON_L1
				app.input.OnKeyDown( 122 );	  // KEY_F11
				break;
			case 103:						  // KEYCODE_BUTTON_R1
				app.input.OnKeyDown( 123 );	  // KEY_F12
				break;
			case 108:						  // KEYCODE_BUTTON_START
				app.input.OnKeyDown( 8 );	 	  // KEY_BACKSPACE
				break;
			case 109:						  // KEYCODE_BUTTON_SELECT
				app.input.OnKeyDown( 16 );	  // KEY_SHIFT
				break;
		}
	}
    return false;
}
public boolean onKeyUp(int keyCode, KeyEvent event) { // Attmpt to Handle GamePad &amp; DPad Events
	if( app!=null ){
		switch(keyCode){
			case 23:  // KEYCODE_DPAD_CENTER 'trackpad or X button(Xperia Play) is pressed
				app.input.OnKeyUp( 13 );	  // KEY_ENTER
				break;
			case 4:	  // KEYCODE_BACK 'Back Button or O Button(Xperia Play) is pressed
				app.input.OnKeyUp( 27 );	  // KEY_ESCAPE
				break;
			case 99:  // KEYCODE_BUTTON_X	'Square button(Xperia Play) is pressed
				app.input.OnKeyUp( 88 );	  // KEY_X
				break;
			case 100: // KEYCODE_BUTTON_Y	'Triangle button(Xperia Play) is pressed
				app.input.OnKeyUp( 89 );	  // KEY_Y
				break;
			case 21:  // KEYCODE_DPAD_LEFT
				app.input.OnKeyUp( 37 );	  // KEY_LEFT
				break;
			case 19:						  // KEYCODE_DPAD_UP
				app.input.OnKeyUp( 38 );	  // KEY_UP
				break;
			case 22:						  // KEYCODE_DPAD_RIGHT
				app.input.OnKeyUp( 39 );	  // KEY_RIGHT
				break;
			case 20:						  // KEYCODE_DPAD_DOWN
				app.input.OnKeyUp( 40 );	  // KEY_DOWN
				break;
			case 102:						  // KEYCODE_BUTTON_L1
				app.input.OnKeyUp( 122 );	  // KEY_F11
				break;
			case 103:						  // KEYCODE_BUTTON_R1
				app.input.OnKeyUp( 123 );	  // KEY_F12
				break;
			case 108:						  // KEYCODE_BUTTON_START
				app.input.OnKeyUp( 8 );	 	  // KEY_BACKSPACE
				break;
			case 109:						  // KEYCODE_BUTTON_SELECT
				app.input.OnKeyUp( 16 );	  // KEY_SHIFT
				break;
		}
	}
    return false;
}
</pre><br><br>Keymapping:<br>L1 = KEY_F11<br>R1 = KEY_F12<br>o button = KEY_ESCAPE<br>x button = KEY_ENTER<br>square button = KEY_X<br>Triangle button = KEY_Y<br>Start = KEY_BACKSPACE<br>Select = KEY_SHIFT<br><br>If it works I will do something to differentiate between back button and o button. Blame Sony for the confusion. I don't want to invest more time on something I am not sure if it works or not.<br><br>Edit: This will override the onBackPressed() function So I had to implement  KEY_ESCAPE in here as well. Otherwise back button will not function <br><br></td></tr></table><br>
<a name="2012111"></a>

<a name="2012110"></a>

<a name="2012109"></a>

<a name="2012108"></a>

<a name="2012107"></a>

<a name="2012106"></a>

<a name="2012795"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FlameDuck</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Do you have an apk I can simply install that tests this? <br><br></td></tr></table><br>
<a name="2013027"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Amnesia</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I just tested your code on a Xperia Play and it works perfectly. The only problem is that it doesn't make a distinction between the back key and the circle button. So I found this entry on the sony developer blog <a href="http://blogs.sonyericsson.com/wp/2011/02/13/xperia-play-game-keys/" target="_blank">http://blogs.sonyericsson.com/wp/2011/02/13/xperia-play-game-keys/</a> <br>and added the fix to your code:<br><pre class=code>
public boolean onKeyDown(int keyCode, KeyEvent event) { // Attmpt to Handle GamePad &amp; DPad Events
	if( app!=null ){
		switch(keyCode){
			case 23:  // KEYCODE_DPAD_CENTER 'trackpad or X button(Xperia Play) is pressed
				app.input.OnKeyDown( 13 );	  // KEY_ENTER
				break;
			case 4:	 // KEYCODE_BACK 'Back Button or O Button(Xperia Play) is pressed
				if (!event.isAltPressed()) {
					app.input.OnKeyDown( 27 );    //KEY_ESCAPE
				} else {
					app.input.OnKeyDown( 79 );	  // KEY_O
				}
				break;
			case 99:  // KEYCODE_BUTTON_X	'Square button(Xperia Play) is pressed
				app.input.OnKeyDown( 88 );	  // KEY_X
				break;
			case 100: // KEYCODE_BUTTON_Y	'Triangle button(Xperia Play) is pressed
				app.input.OnKeyDown( 89 );	  // KEY_Y
				break;
			case 21:						  // KEYCODE_DPAD_LEFT
				app.input.OnKeyDown( 37 );	  // KEY_LEFT
				break;
			case 19:						  // KEYCODE_DPAD_UP
				app.input.OnKeyDown( 38 );	  // KEY_UP
				break;
			case 22:						  // KEYCODE_DPAD_RIGHT
				app.input.OnKeyDown( 39 );	  // KEY_RIGHT
				break;
			case 20:						  // KEYCODE_DPAD_DOWN
				app.input.OnKeyDown( 40 );	  // KEY_DOWN
				break;
			case 102:						  // KEYCODE_BUTTON_L1
				app.input.OnKeyDown( 122 );	  // KEY_F11
				break;
			case 103:						  // KEYCODE_BUTTON_R1
				app.input.OnKeyDown( 123 );	  // KEY_F12
				break;
			case 108:						  // KEYCODE_BUTTON_START
				app.input.OnKeyDown( 8 );	 	  // KEY_BACKSPACE
				break;
			case 109:						  // KEYCODE_BUTTON_SELECT
				app.input.OnKeyDown( 16 );	  // KEY_SHIFT
				break;
		}
	}
	return false;
}
public boolean onKeyUp(int keyCode, KeyEvent event) { // Attmpt to Handle GamePad &amp; DPad Events
	if( app!=null ){
		switch(keyCode){
			case 23:  // KEYCODE_DPAD_CENTER 'trackpad or X button(Xperia Play) is pressed
				app.input.OnKeyUp( 13 );	  // KEY_ENTER
				break;
			case 4:	  // KEYCODE_BACK 'Back Button or O Button(Xperia Play) is pressed
				if (!event.isAltPressed()) {
					app.input.OnKeyUp( 27 );      // KEY_ESCAPE
				} else {
					app.input.OnKeyUp( 79 );	  // KEY_O
				}
				break;
			case 99:  // KEYCODE_BUTTON_X	'Square button(Xperia Play) is pressed
				app.input.OnKeyUp( 88 );	  // KEY_X
				break;
			case 100: // KEYCODE_BUTTON_Y	'Triangle button(Xperia Play) is pressed
				app.input.OnKeyUp( 89 );	  // KEY_Y
				break;
			case 21:  // KEYCODE_DPAD_LEFT
				app.input.OnKeyUp( 37 );	  // KEY_LEFT
				break;
			case 19:						  // KEYCODE_DPAD_UP
				app.input.OnKeyUp( 38 );	  // KEY_UP
				break;
			case 22:						  // KEYCODE_DPAD_RIGHT
				app.input.OnKeyUp( 39 );	  // KEY_RIGHT
				break;
			case 20:						  // KEYCODE_DPAD_DOWN
				app.input.OnKeyUp( 40 );	  // KEY_DOWN
				break;
			case 102:						  // KEYCODE_BUTTON_L1
				app.input.OnKeyUp( 122 );	  // KEY_F11
				break;
			case 103:						  // KEYCODE_BUTTON_R1
				app.input.OnKeyUp( 123 );	  // KEY_F12
				break;
			case 108:						  // KEYCODE_BUTTON_START
				app.input.OnKeyUp( 8 );	 	  // KEY_BACKSPACE
				break;
			case 109:						  // KEYCODE_BUTTON_SELECT
				app.input.OnKeyUp( 16 );	  // KEY_SHIFT
				break;
		}
	}
	return false;
}
</pre><br><br>And to everyone else, this code has to be added inside the Activity:<br><pre class=code>
public class MonkeyGame extends Activity{
</pre> <br><br></td></tr></table><br>
<a name="2013028"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Amnesia</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I forgot, now the circle button is mapped to KEY_O <br><br></td></tr></table><br>
<a name="2013109"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gary Leeds</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is there not also a key activated when the screen is slid up? If you could read that you could display on screen buttons when the phone is closed (or not an xperia play) and remove the on screen controls when the phone is open <br><br></td></tr></table><br>
<a name="2014193"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Aman</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Amnesia<br><br>I was actually planning to do the fix the same way you did but wanted to make sure it was working. Thanks for testing it and for the fix. <br><br></td></tr></table><br>
<a name="2014196"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Aman</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Gary, I couldn't find anything in sony's documentation that relates to that. Besides, it would not make any sense to play a game that supports the gamepad and decide not to use it.<br><br>Android market now supports adding multiple apk files for the same app but for different devices. I plan to take advantage of that by supporting Apps2SD for newer devices and add an apk for the xperia play. This is also useful for fixing bugs that are hardware specific. <br><br></td></tr></table><br>
<a name="2014681"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gary Leeds</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Aman<br><br>There must be some trigger though for the Play to switch to the different menu as you slide the screen up even if its not documented.<br><br>Might have to have a look and see what I can find <br><br></td></tr></table><br>
<a name="2014870"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FBEpyon</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello,<br><br>Okay instead of doubleposting,<br><br>Has anyone figured out the touchpad settings for the Xperia and getting that to work inside of monkey yet..?<br><br>William Mc. <br><br></td></tr></table><br>
<a name="2014867"></a>

<a name="2014866"></a>

<a name="2014855"></a>

<a name="2089057"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hezkore</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> How would one apply this to the newest version of Monkey X? <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
