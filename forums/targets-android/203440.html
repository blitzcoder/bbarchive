<!DOCTYPE html><html lang="en" ><head ><title >Android Scissor Bug?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Android Scissor Bug?</h1><a href="forums.php" >Monkey Targets Forums</a>/<a href="topics.php?forum=502" >Android</a>/<a href="#bottom" >Android Scissor Bug?</a><br><br>
<a name="2036009"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Midimaster</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm writing a GUI for my Android Apps and after heavy use of scissors I noticed a bug:<br><br>The GUi is based on rectangles(=gadget), which can contain other rectangles. I have a parent rectangle with 10 children rectangles and the textbox. This textbox is a outer rectangle, a inner rectangle and 20 rectangles for the text lines.<br><br>There should be a lot on lines of text on the screen, but some lines are missing, when compiling to android. On the Html5 target everything works fine. This problem is caused by the scissor, which should limit the painting area to the size of the text line.<br><br>If you switch off the scissor in Gadget.DrawOne() you can see all lines. For debug informations the text lines contain the borders of the the scissor, and you can see, that the values are correct and that the scissor should normaly show the text, when switched on.<br><br>I reduced the testcode to the minimum, where i can still notice the bug. The bug only occurs with the other Gadgets. Reducing the amount of other rectangles also reduces the missing lines.<br><br>Can anyboy please confirm the bug or tell me, that it is working fine on his mobil phone? I use Monkey 61b, apache-ant-1.8.4 and tested it on a Samsung GT-S5300 Android 2.3.6<br><br>[monkeycode]Strict<br>Import mojo<br><br>Const ON%=1,OFF%=0<br>Const TEXT_FIELD%=1<br><br>Global Debug$, DebugCount%,MausIn%<br><br>Class Duett Extends App<br>	<br>	Method OnCreate%()<br>			Gadget.XRatio=DeviceWidth()/480.0<br>			Gadget.YRatio=DeviceHeight()/320.0<br>			' id, x, y, b, h, Typ, Parent-ID<br><br>			Gadget.Create 1,0,0,480,320,3,0,"" ' Mutter aller Fenster<br>			Gadget.Create 6,5,265, 230,44,0,1, ""<br>			Gadget.Create 7,85,205, 70,44,0,1,"" <br>			Gadget.Create 8,5,205, 70,44,0,1,""<br>			Gadget.Create 9,385,130, 80,44,0,1,"" <br>			Gadget.Create 15,165,205, 70,44,0,1,"" <br><br><br>			Gadget.Create 10,5,130,358,40,3,1,"" <br>			Gadget.Create 11,-440,3,900,34,3,10,"" <br>			Gadget.Create 12,0,3,470,14,4,11,"" <br>			Gadget.Create 13,470,3,440,14,3,11,"" <br><br>			Gadget.Create 14,245,180,225,133,0,1,""<br><br>			Gadget.Create 20,10,10,460,300,5,1,"" <br>			TextBox.Creates  21,0,0,460,400,5,20,""<br>		SetUpdateRate 15<br>		Return 0<br>	End<br><br><br>	Method OnUpdate%()<br>		If KeyHit(KEY_ESCAPE) Then <br>				Error ""<br>		Endif<br>		Return 0<br>	End<br><br>	<br>	Method OnRender%()<br>		Gadget.Draw<br>		Return 0<br>	End<br>End<br><br><br>Function Main%()<br>	New Duett<br>	New TextBox<br>	Return 0<br>End<br><br><br>Class Gadget<br>	Global Liste: List &lt;Gadget&gt;= New List &lt;Gadget&gt;<br>	Global XRatio#=1,YRatio#=1<br>	<br>	Field Id%,X#,Y#,B#,H#,Typ%,Text$<br><br>	Field Parent:Gadget, Visible%, InnerScale#=1<br>	Field Children:List&lt;Gadget&gt;= New List &lt;Gadget&gt;<br><br><br>	Function Create%(Id%,X%,Y%,B%,H%,Typ%,ElternID%,Text$="")<br>			Local loc:Gadget=New Gadget()<br>			loc.Id=Id<br>			loc.X=X<br>			loc.Y=Y<br>			loc.B=B<br>			loc.H=H<br>			loc.Typ=Typ<br>			loc.Text=Text<br>			loc.Visible=True<br>			If ElternID&gt;0<br>				loc.Parent=Gadget(ElternID)<br>				loc.Parent.Children.AddLast loc<br>			Else<br>				loc.Parent=Null<br>			Endif<br>			Liste.AddLast loc<br>			Return 0<br>	End<br><br><br>	Function Gadget:Gadget(Id%)<br>		For Local loc:Gadget = Eachin Liste<br>			If Id=loc.Id Then Return loc<br>		Next<br>		Return Null<br>	End<br>	<br><br>	Function Draw%()<br>			Scale XRatio,YRatio<br>			Liste.First().DrawOne 0,0,0,0,999,999,1<br>			SetScissor 0,0,DeviceWidth(),DeviceHeight()<br>			Return 0<br>	End Function<br><br><br>	Method DrawOne%(offX%,offY%,sX%,sY%,sX2%,sY2%,faktor#)<br>		Local v%=sY2<br>		If Visible=False Then Return 0<br>		offX=offX+X*faktor<br>		offY=offY+Y*faktor<br>		If offX&gt;sX Then sX=offX<br>		If offY&gt;sY Then sY=offY<br>		<br>		If offX+B*faktor&lt;sX2 Then sX2=offX+B*faktor<br>		If offY+H*faktor&lt;sY2 Then sY2=offY+H*faktor<br>		'<br>'**************************************<br>		SetScissor Int(sX*XRatio) , Int(sY*YRatio) , Int((sX2-sX)*XRatio) , Int((sY2-sY)*YRatio)<br>'****************************************<br><br>		SetFarbe 100+Typ*10<br>		DrawRect X, Y,B,H<br>		SetFarbe 103+Typ*10<br>		If Text&lt;&gt;""<br>			Local T$<br>			T="sX="+sX + " sY="+sY + " sB="+Int((sX2-sX)*XRatio)+ " sH="+Int((sY2-sY)*YRatio) 						DrawGadgetText T, X+5, Y+2,0<br>		Endif<br>		PushMatrix<br>			Translate X+2,Y+2<br>			Scale InnerScale,InnerScale<br>			faktor=faktor*InnerScale<br>			For Local loc:Gadget = Eachin Children<br>				loc.DrawOne (offX+2, offY+2, sX+2, sY+2, sX2-2, sY2-2, faktor)<br>			Next<br>		PopMatrix<br>		Return 0<br>	End	<br><br>	Method DrawGadgetText:Void(T$,X%,Y%,Style%)<br>		PushMatrix()<br>		Translate X,Y<br>		DrawText T, 0, 0,Style<br>		PopMatrix()<br>	End<br><br><br>	Function Check%()<br>		Return 0<br>	End<br>End<br><br><br>Function SetFarbe:Void(FarbTon%)<br>	Select FarbTon<br>		Case 150<br>			SetColor 1,1,1<br>		Case 151<br>			SetColor 1,1,1		<br>		Case 152<br>			SetColor 250,50,70		<br>		Case 153<br>			SetColor 222,222,222<br>		Default<br>			SetColor 0,111,0 <br>	End Select<br>End Function <br><br><br>Class TextBox Extends Gadget<br>	<br>	Function Creates:Void(Id%,X%,Y%,B%,H%,Typ%,Parent_ID%,Text$)<br>		Local i%,Lang%,Zeile$, ZeileH%,Breite%<br><br>		Create Id,X,Y,B,H,Typ,Parent_ID,""<br><br>		ZeileH=40<br>		Breite=B-4<br>		For i=1 To 20<br>				Create Id*100+i,X,Y+i*ZeileH,Breite,ZeileH+2,5,Id,"Zeile " + i<br>		Next<br>	End <br>End[/monkeycode] <br><br></td></tr></table><br>
<a name="2035996"></a>

<a name="2035994"></a>

<a name="2035993"></a>

<a name="2035992"></a>

<a name="2036000"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>I'm getting identical results on Android/html5/XNA - 7 lines of text with a green border. The last 2 numbers on each line are different, I assume because it's to do with scaling.<br><br>With SetScissor commented out, same thing only the bottom edge of the border is missing, and there's an extra border pixel or 3 at the top right. Again, looks the same to me on all targets. <br><br></td></tr></table><br>
<a name="2036010"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Midimaster</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> upps....<br><br>thanks you for this quick answer,...<br><br>You can see all 7 lines? So it is a problem of my Android version or mobile?<br><br>Which version do you use? I forgot to tell, that I set the orientation to "landscape", the resolution of the display is 320x240 and so the YRatio% and YRatio% = 0.667.<br><br>To the text content: <br>the text line only can differ in value "sY=..." . This is the scissor y-value for that line. the other values have to be the same in each line. only the 7th could be a little different, because the bottom of the display reduces the scissors height "sH=....".<br><br>Could you please move this forum thread to "Android", that some more coders will test this behavior on different mobiles? <br><br>thank you <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
