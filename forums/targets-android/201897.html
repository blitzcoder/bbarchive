<!DOCTYPE html><html lang="en" ><head ><title >How to use canvas instead of OpenGL</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >How to use canvas instead of OpenGL</h1><a href="forums.php" >Monkey Targets Forums</a>/<a href="topics.php?forum=502" >Android</a>/<a href="#bottom" >How to use canvas instead of OpenGL</a><br><br>
<a name="2018051"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Xaron</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi all (especially Mark),<br><br>is there a way to use the old canvas style for drawing instead of OpenGL. I have the impression that a lot of these image draw stuttering comes from the OpenGL part. <br><br></td></tr></table><br>
<a name="2018053"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >benmc</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> From my experience, canvas is super slow, but works just fine for a lot of simple games.<br><br>I hope he finds a way to nix the stuttering altogether on Android and keep the OpenGL.  Lots of games use it, there must be a trick or something.<br><br>I need the power of OpenGL for the game I'm writing now, and I'm avoiding the stuttering problem by drawing every single thing off-screen during a loading process.  Still it's only kind-of working unfortunately.<br><br>Hoping someone smarter than me knows a tweak that can be made to the mojo module or something again. <br><br></td></tr></table><br>
<a name="2018055"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Xaron</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> benmc I do this offscreen painting as well but this doesn't work on all devices as I've found out today. Especially when you have a lot of graphics I guess the "oldest" ones are dropped out of the cache again. Well ok I might have to implement some more intelligent caching...<br><br>Actually Android is a horror to develop for, Windows 7 Phone and iPhone are so much easier and straight forward to use without these hacks... <br><br></td></tr></table><br>
<a name="2018059"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >anawiki</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, as a programmer I am shocked that people like Android devices. They are sooo bad compared to iOS devices. I start to wonder if the only reason people like Android devices is the fact that they can easily pirate software. <br><br></td></tr></table><br>
<a name="2018061"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >benmc</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I agree, I am coming across so many problems with Android, and it's getting more and more frustrating.<br><br>I was able to solve the problem of black/pixel lines showing up to the right of my images, but now I'm getting lines on the BOTTOM of the images that I can't figure out how to get rid of - even with pixel padding.<br><br>Then, I am now experiencing what you are Xaron - it seems to "forget" some graphics now that I have a lot to draw.  I'm not sure if I can change something or not regarding how much is cached and for how long.<br><br>Everything works flawlessly on iOS, GLFW, and Flash.  Android is so frustrating.<br><br>Maybe the OP is right, maybe having an option to use the Canvas would help in some ways.  My struggles with Canvas with my pure Java games has been frame rates slowing way down at times, then speeding back up.  Very frustrating. <br><br></td></tr></table><br>
<a name="2018066"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MikeHart</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> If oyu avoid dynamic object creation on Android as much as possible, but Monkey still does it under the hood, then there is nothing we can do. The stuttering comes form the GC. The more dynamic objects are created and released, the more it will affect the game. <br><br></td></tr></table><br>
<a name="2018086"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AdamRedwoods</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Then, I am now experiencing what you are Xaron - it seems to "forget" some graphics now that I have a lot to draw. I'm not sure if I can change something or not regarding how much is cached and for how long. <br></div><br><br>I wonder if you're running into texture limits, which are around 24mb for phones.<br>If you're testing on PowerVR devices, you could try using some of their profiling tools:<br><a href="http://www.imgtec.com/powervr/insider/powervr-utilities.asp" target="_blank">http://www.imgtec.com/powervr/insider/powervr-utilities.asp</a><br><br><br>Monkey isn't doing a whole lot of dynamic object creation behind the scenes, except when loading images. Also note that monkey on android has no hidden GC, it's straight-up java managed GC.<br><br>Also note monkey may not be the problem:<br><a href="http://groups.google.com/group/android-developers/browse_thread/thread/2de64b6ebb98129/eede34e343485313?lnk=gst&amp;q=stuttering#eede34e343485313" target="_blank">http://groups.google.com/group/android-developers/browse_thread/thread/2de64b6ebb98129/eede34e343485313?lnk=gst&amp;q=stuttering#eede34e343485313</a><br><br>Read the bottom note, it says to add gl.glFinish() to your games:<br><a href="http://stackoverflow.com/questions/3706786/htc-desire-specific-opengl-es-1-frame-rate-cant-get-it-right" target="_blank">http://stackoverflow.com/questions/3706786/htc-desire-specific-opengl-es-1-frame-rate-cant-get-it-right</a> <br><br></td></tr></table><br>
<a name="2018308"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Pudsy</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Some method to toggle the "canvas" rendering would DEFINITELY get my vote! :)<br>Or even better, automatically fall-back to it if the current device doesn't support GL properly?<br><br>Ever since Monkey v44 (I believe this is where the change was made) I've been getting all kinds of graphical anomalies, and only on Android... it all works great on every other target!<br><br>All the graphical issues have been discussed in other threads &amp; some are mentioned above... lines on edges of images, completely garbled images, images being swapped around, etc.<br><br>Some of those problems only manifest themselves on certain devices (including various Samsung models, and an HTC in my experience so far). But eg. the lines on image edges seemingly affects every device including the emulator.<br><br>If I build with Monkey v43, although rendering is a little slower, pretty much all of the glitches go away on every device I've tested. <br><br></td></tr></table><br>
<a name="2018739"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >benmc</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> @AdamRedwoods To experiment, I put:<br><br>gl.glFinish(); <br><br>into the function:<br><br>public void onDrawFrame( GL10 gl )<br><br>in the Android mojo native java file, and I think the "stuttering" problem I was having on Android has gone away.<br><br>However, I wouldn't recommend anyone do this because I have no idea what I've done.  Do you or Mark know what's actually happening by doing this?  I'm personally worried that I've opened a bigger can of worms and haven't fixed anything.  I don't know if the app now uses a lot of extra memory, or creates other problems, but in my case, I *think* I'm seeing some improvements in how smoothly my game runs at 45fps on Android by adding that line.<br><br>Any thoughts? <br><br></td></tr></table><br>
<a name="2018885"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AdamRedwoods</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Interesting, but it goes along with other findings in that link I posted above.<br><br>glFinish() waits for the graphics chip to finish before returning to the current process. I feel it's harmless and if anything would create lag. I'll have to try it on some devices.<br><br><br>The android system (GLSurfaceView) is suppose to take care of this, and it may, but it seems there may be something hidden going on beneath the Android layers.<br><br>OTHER THOUGHTS:<br>i wonder if opengl is storing texture calls, so I wonder if it will work just as well putting it at the end of gxtkSurface.Bind() instead. If you move it there and stuttering still goes away then it's the processor storing texture calls that causes the stutter.<br><br>If it doesn't then it may just be the processor storing graphics commands. <br><br></td></tr></table><br>
<a name="2018884"></a>

<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
