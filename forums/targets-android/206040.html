<!DOCTYPE html><html lang="en" ><head ><title >WritePixel - VERY slow on Android ..</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >WritePixel - VERY slow on Android ..</h1><a href="forums.php" >Monkey Targets Forums</a>/<a href="topics.php?forum=502" >Android</a>/<a href="#bottom" >WritePixel - VERY slow on Android ..</a><br><br>
<a name="2069177"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >necky</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi!<br>       I was wondering if anyone can shed some light on why WritePixel is so slow on the Android.<br><br>Here's my test code below. It grabs a 256x256 square in the top left had corner and then draws it back to the screen. At the moment this is running extremely slowly. I'm running on a Samsung Tablet (the latest model) so I was expecting this to be far quicker than it is.<br><br>It's (hopefully) something I've done wrong here :)<br><br>Thanks<br>           Mike<br><br>Strict<br><br>Import mojo<br><br>Const WIDTH:Int=256<br>Const HEIGHT:Int=256<br><br>Function Main:Int()<br>	New Game()<br>	Return 0<br>End<br><br>Class Game Extends App<br><br>	Field Xpos:Float<br>	Field Ypos:Float<br>	Field OldXpos:Float<br>	Field OldYpos:Float<br>	Field Screen:Image<br>	Field ScreenPixels:Int[]<br>	Field image:Image<br>	<br>	Method OnCreate:Int()<br>		ScreenPixels = New Int[WIDTH*HEIGHT]<br>		SetUpdateRate(60)<br>		Screen = CreateImage(WIDTH,HEIGHT)<br>		Xpos = MouseX()<br>		Ypos = MouseY()<br>		OldXpos = MouseX()<br>		OldYpos = MouseY()<br>		image=LoadImage( "King_Head.png",1,Image.MidHandle )<br>		Return 0<br>	End<br>	<br>	Method OnUpdate:Int()<br>		OldXpos = Xpos<br>		OldYpos = Ypos<br>		Xpos = MouseX()<br>		Ypos = MouseY()<br>		Return 0<br>	End<br>	<br>	Method OnRender:Int()<br>		'Cls (0,0,0)<br>		DrawImage (Screen,0,0)<br>		'DrawLine OldXpos,OldYpos,Xpos,Ypos<br>		DrawImage (image,MouseX(),MouseY())<br>		ReadPixels ( ScreenPixels, 0, 0, WIDTH,HEIGHT )<br>		Screen.WritePixels(ScreenPixels, 0, 0, WIDTH,HEIGHT)<br>		Return 0<br>	End<br>End <br><br></td></tr></table><br>
<a name="2069182"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gerry Quinn</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't think you should normally be doing this every frame - I would see WritePixels as more for building composite images that you will then use normally in subsequent frames.  You are pushing pixels around between graphic memory and ordinary RAM which may well be slow.<br><br>That's just my guess. <br><br></td></tr></table><br>
<a name="2069189"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >necky</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Gerry,<br>Thanks for the advice :) I was wondering if there is another way I could tackle what I'm trying to achieve? What I'd like to do is draw to a screen and for it not to clear, like this example does above but far quicker. Can anyone suggest anything?<br>All the best<br>Mike <br><br></td></tr></table><br>
<a name="2069192"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Possible optimizations:<br>1.- Avoid the whole read/write pixels when there are not changes on screen. Don't do it in a per-frame basis!<br>2.- Just write/read into the "screen" Image the portions of the device canvas that have been modified, and only when something has been modified. <br><br></td></tr></table><br>
<a name="2069226"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ElectricBoogaloo</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've found that Android's actually pretty slow at most "Create Image" stuff.  Not only is WritePixels slow, but there's a noticable delay between me loading levels in one of my current projects.  The only thing happening is a loading of different textures.<br>Sure it's only a delay of about half a second, but when you compare it to iOS, GLFW and HTML targets, it's odd that Android would be noticably slower at doing it.<br><br>I'm currently working under the assumption that it's something to do with how Android's handling it's image memory, since drawing rate seems fairly decent.  Something to do with accessing texture memory, or something like that.<br>Where possible, avoid doing it too often.  It's odd to have to cater for quirks like that, but IMO it's all part of the wonderful puzzle that is Coding! <br><br></td></tr></table><br>
<a name="2100170"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ElectricBoogaloo</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Has anybody managed to find a way to speed this up, yet?<br>The bottleneck is almost certainly down to Android moving the image from system memory to gfx memory.<br>It'd be nice if I could do fancy artsy stuff in realtime. <br><br></td></tr></table><br>
<a name="2100172"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Danilo</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> - <a href="http://www.monkey-x.com/Community/posts.php?topic=8505&amp;post=87728&amp;view=all#87728" target="_blank"><u>Plotting Pixels in an Image</u></a><br><div class="quote"> <b>Danilo wrote:</b><br>Yes, changing the magic line 118 in mojo.android.java from Bind() to Bind2() made the FPS jump from 3 to 58 FPS! :D <br></div> <br><br></td></tr></table><br>
<a name="2100778"></a>

<a name="2100779"></a>

<a name="2100780"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Danilo</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> @ElectricBoogaloo:<br>Did it help to speed-up WritePixels stuff? What's your experience? <br><br></td></tr></table><br>
<a name="2100893"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ElectricBoogaloo</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry, got sidetracked by something entirely different.<br>Will get back to this when I attempt my next project.  (About a week or so, I think.. )<br><br>Current project : <a href="http://youtu.be/nOvzVa-4EV4" target="_blank">Invisible Munky 2</a> <br><br></td></tr></table><br>
<a name="2104835"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ElectricBoogaloo</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> .... Eventually...!<br><br>Yes, thank you.  Switching to Bind2 has DRASTICALLY improved image loading and editing speeds.<br>I'm sure there's a reason it's not the default, and that that reason will bite me in the ass.<br>For now, I am un-ass-bitten, and happy with the result.<br><br>.. Now.. How to find "memory available"...  Hmm.... <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
