<!DOCTYPE html><html lang="en" ><head ><title >How to store text for undo?  Strings too short.</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >How to store text for undo?  Strings too short.</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >How to store text for undo?  Strings too short.</a><br><br>
<a name="741773"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> My undo routines were working great until I started editing some large text files.  It looks like strings can only store so many characters before they get cut off.  So how can I quickly transfer the contents of a TextArea gadget into some kind of storage?  It has to be fast, because it happens every time the user hits a key. <br><br></td></tr></table><br>
<a name="741775"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Strings (plural) <br><br></td></tr></table><br>
<a name="741776"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> It seems the problem was actually that I was using SetGadgetText instead of SetTextAreaText, which cuts off the text. <br><br></td></tr></table><br>
<a name="741792"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >klepto2</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> As far as I know you only store the keyhit and the position and this stuff. In short words: Store only the task and if you <br>undo\redo something you have to do the opposite of this task.<br>It is some kind of 'motion capturing' .<br><br>If you would save the whole text then you have a lot of memory usage which is not a good thing.<br>EG: you test is around 10000 chars then<br>you have to save 10000 bytes + the additional info for each char (color,format, etc.) only with the chars the memusage is increased enormous if you have just 500 (1000 at all) undo and redo steps (if I'm correct thats around 9mb).<br><br>Use state constants instead: eg: REMOVECHAR,ADDCHAR and save the position and other needed info of the task in a TList or   similar thing. <br><br></td></tr></table><br>
<a name="741796"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> How are you supposed to get what was typed if EventData() does not return anything on a textarea gadgetaction event? <br><br></td></tr></table><br>
<a name="741798"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >klepto2</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> thats true this very difficult to explain, but maybe you could take a look to the maxide.bmx espacially the types :<br>TDiff and TOpenCode (Methods Redo\Undo\updatecode\calcdiff)<br><br>It works that only the difference between the previous and currentstate is saved and not the whole text.<br><br>PS: my previous post was not directly related to the textarea gadget, sorry. (I'm currently working on my own textarea gadget with predefined undo\redo functions etc. so I was a bit out of this context. <br><br></td></tr></table><br>
<a name="741803"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I got the Windows default undo behavior to work with textareas.  I can't seem to get redo to work, though.<br><br>First set the number of undo levels allowed:<br>SendMessageA(QueryGadget(gadget,QUERY_HWND),1106,100,0)<br><br>Then when you want to undo, use this:<br>hwnd=QueryGadget(gadget,QUERY_HWND)<br>Repeat<br>	If SendMessageA(hwnd,198,0,0)'em_canundo<br>		undoname=SendMessageA(hwnd,1110,0,0)'em_getundoname<br>		SendMessageA(hwnd,199,0,0)'em_undo<br>		If undoname Exit<br>	Else<br>		Exit<br>	EndIf<br>Forever <br><br></td></tr></table><br>
<a name="741812"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Couldnt you just get the text of a text area, store that somewhere and when they undo it restore the old text. Redo is just restoring the text that was there. <br><br></td></tr></table><br>
<a name="742144"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FlameDuck</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> By using the "<a href="http://en.wikipedia.org/wiki/Command_pattern" target="_blank">command</a>" software design pattern. <br><br></td></tr></table><br>
<a name="742272"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> That's actually what I implemented, albeit without so much programmer architecture BS. <br><br></td></tr></table><br>
<a name="742290"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> programming paradigms are no BS, they might look complex and hard at first, but you will learn their Pro very fast. Because their power and long living effect makes the little larger work to understand theory before implementing strange stuff really unimportant.<br>Paradigms thought are mainly for people that want to create bugfree stuff upfront instead of running after them afterwards with trial and error fixing methods :) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
