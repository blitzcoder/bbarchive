<!DOCTYPE html><html lang="en" ><head ><title >MouseHit() does not work sometimes</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >MouseHit() does not work sometimes</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >MouseHit() does not work sometimes</a><br><br>
<a name="653524"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Robert Cummings</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Any clues why MouseHit() isn't reliable on my pc? It's a dual core machine and very fast, however MouseHit often 'misses' or fails to pick up my clicks. I find I need to call it a LOT in order to get some kind of response from it, as in more than once per loop!<br><br>I don't have this problem with keyboard input nor do I have a problem with any other games or applications. <br><br></td></tr></table><br>
<a name="653528"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> What if you use mh1=mousehit(1) once each loop? <br><br></td></tr></table><br>
<a name="653533"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Robert Cummings</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I do this.<br><br>I have also tried directly calling MouseHit(1) several times. Both require being called several times to get a response on this PC. <br><br></td></tr></table><br>
<a name="653535"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> hmm.  In BlitzPlus I got unreliability but this was due me calling it more than once and each call cleans out the buffer (of one hit at least).  So in the end I used TonyG's method of only calling once per loop.  Also have you used flushmouse anywhere in your loop?  If so you might not be giving enough time between the flush and the mousehit for a new hit to be registered.  I did this by accident too and it resulted in unreliable mouse performance. <br><br></td></tr></table><br>
<a name="653536"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >IPete2</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> One Eyed Jack - how are you synching to the vblank?  Maybe the mouse is only polled once a vblank - if you are going two or three flips before a vblank occurs maybe the mouse can miss a call?<br><br>for example the mouse code in the BMax docs is as follows:<br><br><br><pre class=code>
' mousehit.bmx

Graphics 640,480

While Not KeyHit(KEY_ESCAPE)
	Cls
	If MouseHit(1) DrawRect 0,0,200,200
	If MouseHit(2) DrawRect 200,0,200,200
	If MouseHit(3) DrawRect 400,0,200,200
	Flip 
Wend

</pre><br><br><br>if you put a 1 or a 0 after the flip, the mousehit doesnot seem to register all the time and so only occasionally draws the rectangle. Using a -1 seems to get a result  though.<br><br>Just a thought.<br><br>IPete2. <br><br></td></tr></table><br>
<a name="653542"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Robert Cummings</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Grey, no flushmouse.<br><br>IPete2, I am just using Flip without parameters. The game is graphically heavy but there is only one place I call the mouse input gathering routine. I find calling it more often picks up the MouseHit() more frequently.<br><br>Could it be an issue with dual core cpus? <br><br></td></tr></table><br>
<a name="653543"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Could be.<br>Did you install the AMD drivers for powersaving (or something like that) from their page? If this is not installed, there are known issues that can cause quite a lot as the time calculation in running apps is incorrect as the stepping / energy saving stuff does not work as the apps assume it does.<br><br>There is as well a WinXP hotfix that might be needed additionally (although its normally only needed for Intel dualcores). <br><br></td></tr></table><br>
<a name="653544"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Robert Cummings</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have installed the hotfix and power saving. <br><br></td></tr></table><br>
<a name="653547"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Maybe you can post a demo for others to test? <br><br></td></tr></table><br>
<a name="653551"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Robert Cummings</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> I can't post my whole game. <br><br></td></tr></table><br>
<a name="653555"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> What about an .exe (unless it's secret) or a sub section that still shows the symptoms? <br><br></td></tr></table><br>
<a name="653558"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Robert Cummings</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's secret (you know how it is)...<br><br>I have isolated absolutely EVERYTHING! I even removed all the timing code till I had basically Ipete2's code (only it's drawing a lot more) and I'm having this problem with flip 1, 0 or -1...<br><br>I'm getting sparodic inputs from MouseHit (mousedown seems fine, but then it would be hard to tell with mousedown). <br><br></td></tr></table><br>
<a name="653559"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> If your game has a decent framerate, why not jsut use MouseDown once per frame and set a global variable based on the state? <br><br></td></tr></table><br>
<a name="653562"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Robert Cummings</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> I may just have to do this. It's crazy though? I'm pulling my hair out here man! <br><br></td></tr></table><br>
<a name="653575"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> I hate that kinda crazy technical crap.  It drives me mad and wastes soo much time.  That's why most peoples plans go to pot, because they don't put in contingency for sh*t like this. <br><br></td></tr></table><br>
<a name="653689"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Robert Cummings</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok after a lot of fiddling about, and also trying events, I've come to the conclusion that mousehit() seems to clear the backlog every time it's called.<br><br>Thats the problem, I think. <br><br></td></tr></table><br>
<a name="653702"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Robert Cummings</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> OK<br><br>The more I render, the less responsive the mouse gets, despite the framerate being in the high 500's.<br><br>MouseX() and MouseY() respond constantly and fine. It's just a problem with mouse buttons. F@@@@:):):)! thing.<br><br>I'm guessing we'll see more bugs like this as more people make mouse-controlled games. Most people do not make mouse controlled games in Blitzmax presently. <br><br></td></tr></table><br>
<a name="653704"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> oh dear, my next game is mouse controlled.  I'll let you know if it cocks up on mine.  If not, I'll post a beta for testing. <br><br></td></tr></table><br>
<a name="653778"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TartanTangerine (was Indiepath)</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Does it work if your do a PeekEvent? <br><br></td></tr></table><br>
<a name="653784"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> OEJ: Is this perhaps somehow connected to the fake try to get around mouselag? (reinserting a different mouse lag issue)<br><br>Otherwise, you might try one thing:<br><br>Let the user decide the FPS. then do the drawing timed (ie if tdiff &gt; 1000/wished_fps   renderscene() ) This way you get around 20'000 - 100'000 main loop runs which is even higher than the timer precision and thus should be able to get all mouseevents without any problem. <br><br></td></tr></table><br>
<a name="653839"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> OEJ: Is this perhaps somehow connected to the fake try to get around mouselag? (reinserting a different mouse lag issue) <br></div> God I hope not! <br><br></td></tr></table><br>
<a name="653853"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AlexO</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> OK<br><br>The more I render, the less responsive the mouse gets, despite the framerate being in the high 500's.<br> <br></div><br><br>when you say 'render' are you just using basic DrawImage/Text commands? There shouldn't be a reason why it doesn't come out 'sometimes'. I'm currently working on a blitzmax project and I call mousehit() and mousedown() once per loop and it has not been unresponsive, and my render functions have become a bit more complex than the standard blitzmax draws. Try that example that IPete2 posted from the blitzDocs. If that works for you then there's something in your mainloop that is calling mouseHit().<br><br>If you happen to be using IGlass btw and call IGL_RefreshGUI() that would cause even ur single mouseHit() call to not work sometimes, because it calls it inside that function. <br><br></td></tr></table><br>
<a name="653879"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is why i prefer custom input routines. One "Updateinput" command whenever you need to update it. If mousehit is broken, you can use mousedown in a custom routine to detect it.<br><br>On a side note, I'm not having any mousedown problems and i'm rendering pretty intensive 3D.<br><br>[edit] Quckly realised I dont even use the mousehit commands :) <br><br></td></tr></table><br>
<a name="654249"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> Rob, I haven't been able to reproduce your problem here and have double checked module source without any luck.<br><br>I would try adding a PollSystem at the same point you are flushing the graphics pipe with GrabPixmap. If that fails, you might want to consider sending me a build to see if I can reproduce your problem here. <br><br></td></tr></table><br>
<a name="729913"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Digital Anime</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> This topic solved mine issue...<br>I use FlushMouse() to make sure after each loop MouseZ() = 0<br>But I forgot that it had a great effect on all other buttons as well<br>By putting MouseHit() direct above the FlushMouse my game I'm working on works smoothly again <br><br></td></tr></table><br>
<a name="730004"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JazzieB</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> Glad you've solved the issue.  For future reference, and I think that this was pointed out above somewhere, MouseHit() returns the number of times a mouse button has been pressed since the last time that MouseHit() was called.  This count is then reset to 0 (which is why you should only call it once per loop) or when you use FlushMouse. <br><br></td></tr></table><br>
<a name="784304"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >luigikart</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> One time I made a game where you slide the numbers around and put them in order. I called Keyhit by saying for example:<br>If (board(0) = 4) And (KeyHit(203))<br>	board(0) = board(1)<br>	board(1) = 4<br>...<br>EndIf<br>It didn't work.<br>Then I tried saying: If KeyHit(203) Then leftkey = 1<br>My new code:<br>If (board(0) = 4) And (leftkey = 1)<br>	board(0) = board(1)<br>	board(1) = 4<br>...<br>EndIf<br>It worked.<br>(By the way incase you were wondering, if a tile = 4 it is blank in this program.)<br>So instead of calling MouseHit directly, do what I did with KeyHit. It might work. <br><br></td></tr></table><br>
<a name="784310"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Amon</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> ? <br><br></td></tr></table><br>
<a name="784339"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >plash</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> ? <br></div><br><br>I second that.. <br><br></td></tr></table><br>
<a name="784348"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> This one time.... at band camp.... <br><br></td></tr></table><br>
<a name="784503"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TomToad</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Ok after a lot of fiddling about, and also trying events, I've come to the conclusion that mousehit() seems to clear the backlog every time it's called. <br></div><br>Yes it does.  This is the proper behavior.  If you call MouseHit() then click the button 10 times, then call Mousehit() again, it is reset to 0, not 9.<br>If for some reason, there is going to be significant time between Mousehit() calls and its possible for the button to be clicked more than once between calls, then you need to check the value returned to determine the number of times it is hit.  Something like this.<br><pre class=code>
Local NumMouseHits1:Int = 0

...

Local MouseHit1:Int = False
If NumMouseHits 'Check to see if Mousehits still need to be processed
    MouseHit1 = True
   NumMouseHits :- 1
Else
    NumMouseHits = MouseHit(1) 'Store number of times Mouse has been pressed since last call
    If NumMouseHits 'Was the button pressed at least once?
          MouseHit1 = True
          NumMouseHits :- 1
    End If
End If

If MouseHit1
   'Process Mouse Hits here
End If</pre> <br><br></td></tr></table><br>
<a name="784505"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TomToad</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#32">[#32]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> One time I made a game where you slide the numbers around and put them in order. I called Keyhit by saying for example:<br>If (board(0) = 4) And (KeyHit(203))<br>board(0) = board(1)<br>board(1) = 4<br>...<br>EndIf<br>It didn't work.<br>Then I tried saying: If KeyHit(203) Then leftkey = 1<br>My new code:<br>If (board(0) = 4) And (leftkey = 1)<br>board(0) = board(1)<br>board(1) = 4<br>...<br>EndIf<br>It worked.<br> <br></div><br>Actually it would have worked if you had typed<br>If KeyHit(203) And (board(0) = 4)<br><br>You see, if one part of the And is false, then the other part will never get processed, <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
