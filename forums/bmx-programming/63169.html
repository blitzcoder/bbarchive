<!DOCTYPE html><html lang="en" ><head ><title >Mac Screensaver</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Mac Screensaver</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Mac Screensaver</a><br><br>
<a name="705699"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm trying to figure out how to get a BlitzMax screensaver to work on a Mac. I found working Windows code on the forums which is cool but irrelevant to Mac.<br><br>I read a few websites that sort of point the direction but of course mainly in C or Java and with little clue of how to integrate with BlitzMax.<br><br>From what I understand so far, it's not quite the same as on Windows. In Windows our screensaver exe basically can do whatever it likes, it deals with opening its own screen and closing it and setting up its own event handling and basically is just a regular program that gets called with some flags passed to it to select whether to do fullscreen, a preview, or a configuration. Of course the details of the preview window involve interacting with Windows but it appears to work from what I've read. This seems like a pretty simple arrangement.<br><br>On the Mac a screensaver seems to be built around the screensaver/screensaver.h include file which is in something like C, maybe C++ or Objective C. That seems to imply that the screensaver has to be coded IN C, or written in some other language and imported into the C program and compiled within the XCode IDE. It seems that you get given an NSView screen by default which also seems not to be double buffered, and you get this system timer that calls a function for each frame to render. So you need to add any blitz code to get called within that framework which sounds like the reverse of having blitz include the header files.<br><br>So the issue then is how to be calling blitz code from within a C program. This makes it C-centric and not blitz-centric, plus the problem of needing to open a proper OpenGL graphics display or using MaxGUI for configuration (which Mac refers to as a `sheet` which slides into view within the Screensaver preference window. I can see that it would be fairly simple to code a screensaver in C, but how would one go about including BlitzMax routines to do all the graphics? Compiling the default setup for a screensaver in XCode actually does make a working screensaver, except that you basically just have a black screen and nothing to look at.<br><br>One idea I thought is to actually use XCode to compile the exe, and to have BlitzMax's compiler generate linkable files or something that could be linked into the XCode project within the functions that get called. But even if that is possible, how would C then call the appropriate pieces of code, e.g. the config panel, the startup, shutdown, and per-frame-update? It would be much nicer if the whole thing could just be a regular BlitzMax-centric app including any necessary C bits. But I don't know that that would work. It seems that MacOS runs a generic screensaver handler program which then executes the selected screensaver itself... so the screensaver IS just a regular program, but it's a C-based program.<br><br>Has anyone tried to get this working in a Max compatible way? Any code to share? Anyone like to take a stab at coming up with the basic pieces needed to make a Mac screensaver? It looks like the below code is the basic structure of the C screensaver program. I don't understand some parts of it. Any help getting proper screensavers to work on the mac would be much appreciated!<br><br><pre class=code>
#import "MySaverView.h"


@implementation MySaverView

- (id)initWithFrame:(NSRect)frame isPreview:(BOOL)isPreview
{
    self = [super initWithFrame:frame isPreview:isPreview];
    if (self) {
        [self setAnimationTimeInterval:1/30.0];
    }
    return self;
}

- (void)startAnimation
{
    [super startAnimation];
}

- (void)stopAnimation
{
    [super stopAnimation];
}

- (void)drawRect:(NSRect)rect
{
    [super drawRect:rect];
}

- (void)animateOneFrame
{
    return;
}

- (BOOL)hasConfigureSheet
{
    return NO;
}

- (NSWindow*)configureSheet
{
    return nil;
}

@end
</pre> <br><br></td></tr></table><br>
<a name="705926"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> If anything, how would I include and call some blitz code from within this C program ... ie use one blitz program whose functions can be externalized somehow? <br><br></td></tr></table><br>
<a name="705965"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DannyD</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Why not try the Mac forum here ? <br><br></td></tr></table><br>
<a name="705969"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Because nobody looks at it <br><br></td></tr></table><br>
<a name="706000"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Garrett</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I do, but I'm still new to BlitzMax so I'm not a whole lot of help.  I haven't <br>checked into making savers on OS X yet, but it was on my list of "wanna do's".<br><br>-Garrett <br><br></td></tr></table><br>
<a name="706003"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm sure it'd be quite popular if we can get it working. <br><br></td></tr></table><br>
<a name="706010"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoeRetro</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Have a look <a href="http://spazioinwind.libero.it/tpecorella/uselesssoft/software.htm" target="_blank">here.</a><br><br>Links don't work?  Check out the back-up site. <br><br></td></tr></table><br>
<a name="706333"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks I already saw that page. It just shows use of the original Objective-C code from apple with screensaver effects inserted, it doesn't help us to integrate with Blitz. <br><br></td></tr></table><br>
<a name="706389"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Garrett</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> It'd be sweet if it was something similar to windows where we only needed to <br>grab the command line info being sent to our executables.<br><br>I wonder if we can use some of that C or Objective C with BlitzMax?  BlitzMax <br>does allow us to use such code with BlitzMax.<br><br>Unfortunately, I'm only at the tiny tip of learning C.<br><br>-Garrett <br><br></td></tr></table><br>
<a name="706446"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> From what I gather so far, at the given time where there is no keyboard or mouse activity, the o/s calls the screensaver controller program which, based on which screensaver is chosen, runs a given .saver screensaver, which I presume is *probably* just a regular exe file (not sure). It might not be, as I think I read that the saver is actually a whole folder containing several parts as a `bundle`. What I can tell is that the exe file has to usually use the `screensaver framework` which is mainly screensaver/screensaver.h include file, plus some functions which encapsulate certain pieces of code. I'm not sure why those functions have to have certain names - it's almost as if they are called from somewhere else within the app. I think possibly that the header files include the basic routines to a) open an NView single-buffered screen, b) set up a timer which then c) calls the `animateoneframe` function - which you can define the contents of, at the given interval. So I'm thinking that the header file handles opening the display, setting up a frame timer for flipping, and calling the functions to initialize/shutdown and do one frame of animation. The question is, do we even NEED this header to do that for us, if blitz were going to provide ability to handle flipping, graphics set up and other routines. Another point to consider is there is a function referring to whether a configuration panel is defined, and another that actually creates and operates the panel. It seems the panel has to be attached to a `sheet` which I guess is a sliding gui panel that drops down in the system prefs screensaver window. So it looks like you'd have to tap into and use an o/s compatible GUI arrangement - ie wouldn't be able to really use MaxGUI, or be able to integrate MaxGUI with the system prefs.<br><br>Thoughts following this are, maybe we would have to settle for a screensaver that detects the keyboard and allows a given `config` key to be pressed which then displays a graphics-based or popup-maxgui-based config window, but it wouldn't be embedded in the system prefs and presumably might not show in the preview window. The question then leads to - how do we get the preview window working. It seems you have to use the NSView display as given by the o/s in order to have it be scaled down and rendered in the preview. So then - how to integrate the NSView with Max's graphics display so that Max's display shows in the o/s preview window.<br><br>Seems like some complicated stuff that would have to be hacked together at a low level. OR.... use XCode to compile, use the o/s's framework for screensavers, and have the screensaver in Objective C call functions in an included blitz app or .a file or whatever. Who knows.<br><br>An alternative is to bypass the system screensaver altogether, go with the old fashioned screensaver system like `after dark` which monitors key and mouse input and handles the triggering of the saver, which could all be within one blitz app. But it would not be part of the system screensaver prefs - which would've been really nice.<br><br>Unfortunately it is not as simple as windows. You don't get parameters passed to a regular exe file to tell it what to do, and you don't get to open your own screen or handle your own frame timing or use your own gui system or open your own config window in whatever form you like. Windows actually has a lot more freedom that way. Mac being somewhat more proprietary requires that you play nicely with the o/s, which makes it hard for BlitzMax. <br><br></td></tr></table><br>
<a name="706452"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> I did some more investigating.<br><br>A Mac screensaver isn't just one file. It is a `bundle` of files and folders. When the folder is named whatever.saver, it hides the fact that it is a folder and displays as a single file. If you remove .saver from the name, you can see the folder contents.<br><br>Each screensaver comprises a main folder called "Contents". Within that folder are four items: info.plist which seems to be an xml `plist` file that describes some things about the application/bundle etc, pbdevelopment.plist which is another xml file describing some more stuff, a `MacOS` folder containing the actual screensaver itself which appears to show as a console program (non gui app), a `Resources` folder which contains an English.lproj folder which contains two files: ConfigureSheet.nib and Localizable.strings. The localization file appears to contain some localized strings that probably appear within the app as messages to the user. The nib file seems to be an `interface builder` file which when clicked on will launch interface builder, and basically contains the gui configuration sheet that appears when you click `config` in the system screensaver prefs - you can actually edit the interface. I'm not sure, based on Objective C, how the interface events are handled or where or what the result of certain events achieves or where you define that.<br><br>All these files comprise a screensaver - this is taken from the `Amseq` screensaver.<br><br>With this in mind, how much of this and how many of these files can be tailored to work with a Blitzmax screensaver in any way?<br><br>I tried compiling a Blitzmax app as a non-gui app and replacing an existing screensaver exe with it. Although the saver shows as an option in the system prefs, if you select it it tells you the bundle is damaged and cannot load the screensaver. Presumably either some of the file contents conflict or are invalid, or the blitz exe should be making some calls to stuff in the screensaver.h header file to `register` it as a real screensaver or to set it up for being used as one, ie in the preview window etc. Since that is absent from the blitz app I'm thinking it doesn't recognize the exe as a screensaver.<br><br>That aside I tried leaving that screensaver selected anyway. The hotcorner did run the app but the default NSView screen took over so you see nothing and I don't think the blitz app reall executed.<br><br>So either things will have to revolve around getting the c code into blitzmax, or the max code into c. ???? <br><br></td></tr></table><br>
<a name="706454"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Garrett</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> That's exactly how any app is on OS X.  They all have the contents folder, they <br>all have the plist file and the MacOS folder.  Rename any .app file on OS X, and<br>then you access it like any other folder.  So there's no issue there so far.  Now <br>it's just a matter of nailing down how we can communicate with OS X and the <br>Preferences &gt; Screensaver window.<br><br>I bet you right now we could take just about any app and rename it with the <br>.saver extention, that it'll show up in the screen saver list.  Won't have any <br>access to anything else, but I bet if you hit the preview button that it launches<br>whatever we toss in there.<br><br>If you don't play with that anytime soon, I will.  But got some things to do <br>before I can get to doing that.<br><br>Later,<br>-Garrett <br><br></td></tr></table><br>
<a name="706459"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Actually I tried to rename a regular app to .saver and it would not allow it, it converts the name to name.saver.app and will refuse to take the .app off the end.<br><br>I also couldn't find a way to show the .app extension or to remove it. I can add it, but then I think it's really called name.app.app, as osX removes the .app and doesn't seem to let you see the contents of the app. But I'm sure there's a way.<br><br>Not sure what distinguishes an app from a bundle. There must be some differences.<br><br>But I don't really think it will matter. I think we have to look at creating the screensaver at the sourcecode level not at the compiled-file level. I don't think it's as simple as just substituting the saver file, as I did that and it did not work. <br><br></td></tr></table><br>
<a name="706464"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Garrett</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Might have to try the name chanes in a terminal window.<br><br>-Garrett <br><br></td></tr></table><br>
<a name="706466"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> dont know how ;-D <br><br></td></tr></table><br>
<a name="706468"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoeRetro</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here's another link with <a href="http://s.sudre.free.fr/Software/WBSoftware.html" target="_blank">source code</a>.<br><br>Maybe this will be more helpful. <br><br></td></tr></table><br>
<a name="706713"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> The sources are probably interesting but I couldn't get the archives to open, and I am guessing all of these are written in C which really doesn't help us with our blitzmax endeavours. It seems that pretty much all screensavers on the mac are currently written using the screensaver framework in C or Objective C. There isn't anything that these screensaver examples are doing that isn't already being done with the screensaver.h include file, they are just filling in the contents of the functions that display a nice effect on the screen, all the rest is the same. Its the same structure and the same system code.<br><br>I looked through some other screensavers that are already on my computer and they all looked much the same in their basic use of the screensaver framework. I'm not really concerned with what effect the screensaver produces, at this point we're just trying to get anything to work at all using blitz code for the graphics. Thanks for trying though.<br><br>That piece of sourcecode that I posted originally is the same that is being used by all those screensavers, and none of them ever step outside of it. They just put nice graphical effects into the animateoneframe function and that's about it.<br><br>Our question here is how to have blitzmax write the graphics routines and integrate with the configuration and the preview. <br><br></td></tr></table><br>
<a name="707004"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> I tried a simple blitzmax program that I put in the same folder as a real compiled XCode screensaver project, to import PaulSaverView.m and compared to trying to import it as a C file it actually compiled most of the way alright, until the linking phase. I get these errors:<br><br><pre class=code>
Import "PaulSaverView.m"
</pre><br><pre class=code>
Building Blitz
Compiling:PaulSaverView.m
Compiling:Blitz.bmx
Linking:Blitz
ld: Undefined symbols:
.objc_class_name_ScreenSaverView
Build Error: Failed to link /Developer/TestProjects/PaulSaver/Blitz.app/Contents/MacOS/Blitz
Process complete
</pre><br><br>Any ideas? I am also thinking we might have to remove some parts of screensaver.h because it includes everything needed to build an application including the appkit and the foundation framework. But what does this error mean? <br><br></td></tr></table><br>
<a name="708093"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DannyD</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Believe it or not there is a Mac OS X forum here but it's hard to find. I'm trying to get the forum administrator to move the Mac os X forum from the very bottom of the forum lists to the BlitzMax list. Considering the only Blitz product available for Mac os X is BlitzMax it makes sense. Currently Mac topics end up in the general forum and disappear very quickly. I urge all Mac users who would like to see the forum promoted and visible to all to contact the Blitz webmaster using this link <a href="http://www.blitzbasic.com/Contact/_index_.php" target="_blank">http://www.blitzbasic.com/Contact/_index_.php</a> <br><br></td></tr></table><br>
<a name="708120"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> I started asking within that forum and am getting some gradual results <br><br></td></tr></table><br>
<a name="708331"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DannyD</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> Great to hear that. did you contact the webmaster to get the forum promoted to an area where everyone is aware of it? <br><br></td></tr></table><br>
<a name="708336"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> No. I think it has to stay where the other platform-specific areas are, along with the linux and windows forums.<br><br>Good luck on your conquest though. :-) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
