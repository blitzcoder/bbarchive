<!DOCTYPE html><html lang="en" ><head ><title >loading and saving jpegs and pngs</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >loading and saving jpegs and pngs</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >loading and saving jpegs and pngs</a><br><br>
<a name="578528"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Robert Cummings</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi there,<br><br>I want to keep my download sizes really small and I have 2 800x600 pngs. The upper png layer will have an alpha channel too.<br><br>I was thinking: why not make a small utility that takes the lower layer png and compresses it to jpg, then takes the upper layer png and splits it into 2 jpeg files: one for the alpha channel and one for the image.<br><br>This only needs to be on the pc (the standalone utility).<br><br>Then when my game looks for a level, it finds the 3 jpegs and recombines them in memory to be two images, one with an alpha channel. This would need to be cross platform (done in memory).<br><br>Do you think this is feasible?<br><br>Any other ideas? The goal is to reduce download sizes. <br><br></td></tr></table><br>
<a name="578529"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Robert Cummings</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> There will be probably 50 levels like this, so it's really worth trying to nail. <br><br></td></tr></table><br>
<a name="578553"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >taxlerendiosk</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Does using JPEG with alpha ever work? I'm presuming you'd do that layer as monochrome and convert white into full alpha and black into no alpha, or vice-versa. But wouldn't it even then have nasty artifacting? You may have to compress the alpha layer as a PNG. <br><br></td></tr></table><br>
<a name="578574"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> It sounds entirely possible.<br><br>You will get the loss of detail with jpeg, but saving the alpha as grayscale jpeg will cut down some size and then you can just convert the greyscale RGBA data into 256 levels of gray and combine it with your image. <br><br></td></tr></table><br>
<a name="578579"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >taxlerendiosk</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well with JPEG the problem is usually more like <i>added</i> detail instead of loss, nasty blocks of graininess. I suppose it really depends what your alpha map is like,  if it is very complicated JPEG would be fine, but if &gt;90% of it is one extreme or the other then PNG would probably be better. <br><br></td></tr></table><br>
<a name="578608"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Robert Cummings</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi lads,<br><br>I've done an experiment with photoshop - we're looking at 60k for 3 jpgs verses 500k for 2 png's tightly compressed with png gauntlet or png crush.<br><br>File sizes are a bit of a problem as I've been told to keep it circa 10-15 meg when I spoke to the distributors.<br><br>As I have photoshop I think it will be fairly easy to make a batch action that'll do the job for me so that's no worry...<br><br>The real problem is: how do I take a greyscale alpha image, a solid image and recombine them in memory so drawimage actually draws it with alpha? <br><br></td></tr></table><br>
<a name="578613"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >taxlerendiosk</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Something like this (untested):<br><pre class=code>For y = 0 To PixmapHeight(ImagePixmap)-1
	For x = 0 To PixmapWidth(ImagePixmap)-1
		Color = ReadPixel(ImagePixmap,x,y) &amp; $FFFFFF ' RGB from original image
		AlphaValue = ReadPixel(AlphaPixmap,x,y) &amp; $FF ' Only taking one channel
		WritePixel ImagePixmap, Color | (AlphaValue Shl 24)
	Next
Next</pre> <br><br></td></tr></table><br>
<a name="578617"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Robert Cummings</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks :) is that the fastest I can do it? just curious... as it will be performed on load and so I want to keep the speed up. <br><br></td></tr></table><br>
<a name="578618"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >taxlerendiosk</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I suppose you could use byte pointers to the actual pixel data rather than doing it through function calls... other than that, not that I'm aware of. <br><br></td></tr></table><br>
<a name="578627"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> You're entirely assuming there that the pixel format is ARGB which is not necessarily true. On my Mac I usually work in RGBA and OpenGL seems to consider RGBA as fairly standard. You would possibly want to do a ConvertPixmap() to change the format first, or at least to ensure it is the right format. <br><br></td></tr></table><br>
<a name="578640"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Robert Cummings</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Confused now. So openGL is different from DX and Mac is different to pc? <br><br></td></tr></table><br>
<a name="578680"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, all I know is that OpenGL doesn't necessarily assume that the data will be in ARGB format, it has to be specified. I don't know if it has a default, or if its possible to not define the mode that textures are stored in. I just don't think you should be assuming that ARGB is standard everywhere. Are you sure that BlitzMax is going to load the image as ARGB? <br><br></td></tr></table><br>
<a name="578707"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xlsior</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Are you sure that BlitzMax is going to load the image as ARGB?  <br></div><br><br>Might want to check out the 'pixmapformat' command:<br><br><div class="quote"> <br>Function PixmapFormat( pixmap:TPixmap ) Get pixmap format<br>Returns: The format of the pixels stored in pixmap<br><br>The returned value will be one of:<br><br>Format Description <br>PF_RGB888 24 bit big endian RGB <br>PF_BGR888 24 bit little endian RGB <br>PF_RGBA8888 32 bit big endian RGB with alpha <br>PF_BGRA8888 32 bit big endian RGB with alpha <br> <br></div><br><br>which should tell you the format your particular system stores this info in...<br><br>What I did in my crossfading/black &amp; white fading routines (see code archives), was to convert the image to a known format first, do my thing, and convert it back when done:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
orgformat=PixmapFormat(workpix)
If orgformat&lt;&gt;PF_RGB888 Then 
	' if the Pixmap in a different format than these routined expect, then convert:
	workpix:tpixmap=ConvertPixmap:tpixmap(workpix,PF_RGB888)
End If

' blah blah blah, do your thing

If orgformat&lt;&gt;PF_RGB888 Then
	' The pixmap was converted to a different format originally.
	' Now convert it back to what it was.
	workpix:tpixmap=ConvertPixmap:tpixmap(workpix,orgformat)
End If
</textarea><br><br>Since you want to use Alpha info, you would probably want to check for/switch to PF_RGBA8888 instead... And I suppose you could gain some speed by not doing an actual conversion, but actually having several copies of your routines to pick from depending on the input format. <br><br></td></tr></table><br>
<a name="578789"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Robert Cummings</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for that, I think you're really helpful! This is valuable information. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
