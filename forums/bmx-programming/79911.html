<!DOCTYPE html><html lang="en" ><head ><title >Algorithm Help</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Algorithm Help</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Algorithm Help</a><br><br>
<a name="897650"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Macguffin</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey all,<br><br>I'm doing random worldmap generation right now, and am looking for a good algorithm to use as a starting point to solve the problem of creating provinces on the map.  Here's what I've got.<br><br>- a 2d array of map squares<br>- each square knows its own height (the whole map was seeded heights by mid-point displacement - thanks impixi &amp; the other contributors to that code)<br>- a semi-random selection of squares that are also province capitals<br><br>What I'd like to do is have each province capital spread outwards from itself "claiming" land, having its eventual outward movement limited by the advance of neighboring provinces.  I'd also like the ability to make it more difficult to spread from one geographic zone to another - i.e., it's a lot harder to take over the mountain squares from the grasslands than it is to just spread out in the grasslands.<br><br>Thanks for any help you can lend. <br><br></td></tr></table><br>
<a name="897771"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Do a search on Influence Maps. They're used in strategy games but come from Heat Dissipation. Give your capital a heat radius and let it spread and cool gradually. Soon it will meet the 'heat' radius of another capital which will stop it's spreading. To make your regions each square has a temperature, mountains regions are colder than grasslands so it reduces the spread quicker.<br>Hope that makes sense <br><br></td></tr></table><br>
<a name="897813"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Macguffin</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> It does make sense - I'll take a look.  Thanks! <br><br></td></tr></table><br>
<a name="897939"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GW</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can also use a method where you create a polygon web with the capitals in the center of each triangle/poly. [created by Chris Crawford]<br><br><a href="http://www.google.com/url?sa=t&amp;ct=res&amp;cd=1&amp;url=http%3A%2F%2Fbooks.google.com%2Fbooks%3Fid%3DUSBbi1Dyw4sC%26pg%3DPA305%26lpg%3DPA305%26dq%3DChris%2Bcrawford%2Bpolygon%2Bmap%26source%3Dweb%26ots%3D7RdCKSBCVn%26sig%3DN2Q2rIaQWTnt0pv1xxQdLKudxtc%26hl%3Den%26sa%3DX%26oi%3Dbook_result%26resnum%3D1%26ct%3Dresult&amp;ei=1SmvSN_QJJq4sAORutWEAQ&amp;usg=AFQjCNEtD0FZ45xy4WGsFJlbAnnlHCrfIA&amp;sig2=7n68fWAaQy_V226CewxPsg" target="_blank">http://www.google.com/url?sa=t&amp;ct=res&amp;cd=1&amp;url=http%3A%2F%2Fbooks.google.com%2Fbooks%3Fid%3DUSBbi1Dyw4sC%26pg%3DPA305%26lpg%3DPA305%26dq%3DChris%2Bcrawford%2Bpolygon%2Bmap%26source%3Dweb%26ots%3D7RdCKSBCVn%26sig%3DN2Q2rIaQWTnt0pv1xxQdLKudxtc%26hl%3Den%26sa%3DX%26oi%3Dbook_result%26resnum%3D1%26ct%3Dresult&amp;ei=1SmvSN_QJJq4sAORutWEAQ&amp;usg=AFQjCNEtD0FZ45xy4WGsFJlbAnnlHCrfIA&amp;sig2=7n68fWAaQy_V226CewxPsg</a> <br><br></td></tr></table><br>
<a name="897982"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Macguffin</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Huh.  That's really interesting.  Taking a look there, too.  Thanks. <br><br></td></tr></table><br>
<a name="898031"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GW</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Actually the link i posted was wrong, look to page 343 of that book for the formula of dividing up the provinces. <br><br></td></tr></table><br>
<a name="1098232"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Baystep Productions</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I was actually just about to create a thread on this topic. But I'm gonna resurrect this one. Any chance any ones had any luck on any of this? lol.<br><br>Since I'm working on a RTS I'm gonna need procedural generated maps. And I like the idea on displacement with heat. That actually makes a lot of sense to me.  And I read the pages in that google book. There where good ideas but I cant see how I would really implement them.<br><br>Now my first step is to ask. How would I go about generating the terrain part first? Should I look up life-cycle style algorithms? Since this is a top down, its tile-based. So getting map positions should be easy as pie. <br><br></td></tr></table><br>
<a name="1098262"></a>

<a name="1098263"></a>

<a name="1098295"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Warpy</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here you go. I just use perlin noise with a bit of fiddling to generate a heightmap, representing the terrain. Then the provinces randomly pick adjacent points to spread to, with points at a different height harder to spread to.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
' ****************
' create a perlin noise heightmap
' I'm not hugely bothered about the properties of the heightmap, so perlin will do.
' You'll want something a bit less erratic
Function perlin#[,](size,steps=4)
	Local map#[size,size]
	Local tmp#[size,size]
	
	Local tsize,x,y,i,j,u#,v#

	Local f = 1
	For s=1 To steps
		tsize = size/f
		For x=0 To tsize-1
		For y=0 To tsize-1
			tmp[x,y] = Rnd()/steps
		Next
		Next
		For x=0 To tsize-1
		For y=0 To tsize-1
			For i=0 To f-1
			For j=0 To f-1
				u#=Float(i)/f
				v#=Float(j)/f
				map[x*f+i,y*f+j] :+ (1-u)*(1-v)*tmp[x,y]
				If y&lt;size-1 map[x*f+i,y*f+j] :+ (1-u)*v*tmp[x,y+1]
				If x&lt;size-1 map[x*f+i,y*f+j] :+ u*(1-v)*tmp[x+1,y] 
				If y&lt;size-1 And x&lt;size-1 map[x*f+i,y*f+j] :+ u*v*tmp[x+1,y+1]
			Next
			Next
		Next
		Next
		f:*2
	Next
	
	Return map
End Function

Function round(n#)
	If (n Mod 1)&lt;.5 Return Floor(n) Else Return Floor(n)+1
End Function

' round off heights to a certain number of discrete levels, so the map is less smooth
Function stepmap(map#[,],levels)
	Local size = Sqr(Len(map))
	Local x,y
	
	For x=0 To size-1
	For y=0 To size-1
		map[x,y] = round(map[x,y]*levels)/Float(levels)
	Next
	Next
	
End Function

' apply a symmetric exponential function to the heights, to increase the difference between highs and lows
Function curvemap(map#[,],pow#=.5)
	Local size = Sqr(Len(map))
	Local x,y
	Local t#,s
	
	For x=0 To size-1
	For y=0 To size-1
		t#=map[x,y]-.5
		s=Sgn(t)
		t=Abs(t)^pow
		map[x,y] = s*t+.5
	Next
	Next
	
End Function

' create a circular plateau, to make a space that a province can be seen to spread across quickly
Function hill(map#[,],x,y,minr#=.05,maxr#=.2)
	Local size = Sqr(Len(map))
	Local f# = Rnd(minr,maxr)
	Local r# = f*size
	
	
	Local h# = Rnd(0,1)
	
	Local i,j,w,u,v
	For i = -r To r
		u = x+i
		If u&gt;=0 And u&lt;size
			w = Sqr(r*r-i*i)
			For j=-w To w
				v = y+j
				If v&gt;=0 And v&lt;size
					map[u,v] :+ (h-map[u,v])*Rnd(.3,.7)
				EndIf
			Next
		EndIf
	Next
End Function


' end of heightmap functions
' ****

Global provinces:TList=New TList
Type province
	Field r#,g#,b#
	
	Method New()
		'pick a colour to represent this province
		'colours should all be roughly the same brightness, but random hues
		Local t#
		r=Rnd()
		g=Rnd()
		b=Rnd()
		t = (r+g+b)/2
		r :/ t
		g :/ t
		b :/ t
		
		provinces.addlast Self
	End Method

	'randomly pick a point on the map
	'if it belongs to this province, pick a random adjacent point
	'if that's free, probability of taking it over depends on height difference between the picked points.
	'bigger height difference means less likely to take over
	Method seize(control:province[,],map#[,])
		Local x,y,i,j
		Local size = Sqr(Len(map))
		Local g#
		
		x=Rand(0,size-1)
		y=Rand(0,size-1)
		If control[x,y] = Self
			i=x+Rand(-1,1)
			j=y+Rand(-1,1)
			If i&gt;=0 And i&lt;size And j&gt;=0 And j&lt;size And control[i,j]=Null
				g# = Abs(map[x,y]-map[i,j])
				g = Sqr(g)* impediment
				If Rnd(0,g)&lt;.01
					control[i,j] = Self
				Else
				'	Print "no"
				EndIf
			EndIf
		EndIf
	End Method	
End Type

AppTitle="Now spreadable!"
Graphics 512,512,0
SeedRnd MilliSecs()

Global impediment#=20

'generate heightmap
Local size = 64
Local map#[,] = perlin(size,4)				'make some perlin noise
For c=1 To 4
	hill map,Rand(0,size-1),Rand(0,size-1)		'add some plateaux
Next

Local scale = 512/size

' generate control map and provinces
Local control:province[size,size]		'keeps track of who owns which points
Local p:province
For c=1 To 5
	p:province = New province
	

	'pick a starting point for this province	
	x = Rand(0,size-1)
	y = Rand(0,size-1)	
	While control[x,y]
		x = Rand(0,size-1)
		y = Rand(0,size-1)	
	Wend

	control[x,y] = p
	
	'add a plateau for this province, so it can spread quickly initially
	hill map,x,y							
Next

stepmap map,6								'unsmooth the heights
curvemap map,.7							'increase the contrast between highs and lows


While Not (KeyHit(KEY_ESCAPE) Or AppTerminate())

	'draw the map
	For x=0 To size-1
	For y=0 To size-1
		shade# = map[x,y]
		p = control[x,y]
		If p
			shade = (shade+.3)*255/1.3
			SetColor shade*p.r,shade*p.g,shade*p.b
		Else
			shade :* 255*.2
			SetColor shade,shade,shade
		EndIf
		DrawRect x*scale,y*scale,scale,scale
	Next
	Next
	
	'give each province a few chances at taking control of an adjacent point
	For c=1 To 250
		For p=EachIn provinces
			p.seize control,map
		Next
	Next

	Flip
	Cls
Wend
</textarea><br><br><font class="tiny">Last edited 2011</font><br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1098275"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Midimaster</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> @warpy<br>your code does not start! The dimensions of the arrays seem to be to small.<br><br>work-around:<br><pre class=code>...
	Local map#[size+1,size+1]
	Local tmp#[size+1,size+1]
....
Local control:province[size+1,size+1]
....</pre> <br><br></td></tr></table><br>
<a name="1098296"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Warpy</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> That's what I get for not using debug mode! I've fixed the code in my post above. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
