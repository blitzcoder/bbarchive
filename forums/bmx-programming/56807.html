<!DOCTYPE html><html lang="en" ><head ><title >Arrays of Types - Position in Memory?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Arrays of Types - Position in Memory?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Arrays of Types - Position in Memory?</a><br><br>
<a name="631558"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> If I have something like this :<br><br><pre class=code>
Type tMyType
   Field x:Int
   Field y:Int
   Field z:Int
End Type
</pre><br><br>..And I make an array of them, say ten elements long. Can I guarantee that it's all in one contiguous block of memory? In other words, if I want to pass the array to a DLL or Windows API function, I can just point to MyArray[0] and it will find the 120 bytes which make up my array as they should be?<br><br>Is this safe practice or do I need to make a bank and copy the contents of array and fields into that? <br><br></td></tr></table><br>
<a name="631561"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> No this can't be guaranteed, only the pointer references to them are in a continous block.<br><br>If you really need them as one block for some reason, you will need to use banks.<br><br>Using them with external won't work anyway, BM objects have an overhead you do not see in your type declaration (8 bytes if I remember correctly) which is why straight using the array won't be of much use. <br><br></td></tr></table><br>
<a name="631563"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I know there's a header in the type declaration, but I thought that was per type, not per instance. On reflection, I have no idea why I thought that, as it's not very logical. Max's insistence on doing everything in a non-standard way makes it a real pain in the butt to work with other languages. <br><br></td></tr></table><br>
<a name="631565"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Not only with other languages :(<br>Its internal inconsistencies make it even a pain to create modules for itself ... <br><br></td></tr></table><br>
<a name="631576"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Chris C</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Saying its a pain might be over stating it a bit, however it does need its inter-language interfacing beefing up, a great deal of external libraries not to mention os api's use c structs and dealing with them can be a nightmare<br><br>being able to use C objects would be a dream I've lost count of the numbe of times I've had to do loads of tiny seperate get and set functions like this (real tedious work!)<br><pre class=code>
extern "C" int GetSomeParam(aCobject* e, int op, int index)
{
	return e-&gt;GetSomeParam(op, index);
}
</pre> <br><br>I've found the debugger to be fairly poor when dealing with external libs, often showing the error line a random distance from the actual function call that caused the problem, some kind of itergration with gdb would be nice as an alternitive.<br><br>Mark seem to have a pathalogical lothing of including C structs in Max (or at least thats the impression I get) which is a real shame...<br><br>Which is a real shame, not only for us, but for brl sales. <br><br></td></tr></table><br>
<a name="631635"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  Not only with other languages :(<br>Its internal inconsistencies make it even a pain to create modules for itself ...  <br></div><br><br>Yes, I'm sure you're right, though I haven't done so much of that personally.<br><br><br><div class="quote"> Mark seem to have a pathalogical lothing of including C structs in Max (or at least thats the impression I get) which is a real shame... <br></div><br><br>I get the same impression, and I don't understand why. It's common for non-C languages to use standard C Structs for compatiblity with external libraries, WinAPI, mixing languages, etc. PureBasic does it, IBasic does it. And it's even more infuriating since BMax is inherently tied into GCC and allows you to include C code in directly into BMax projects. Neither IB or PB is tied in this way, they just do it make it a more versatile language.<br><br>I find myself doing the same thing with getters and setters, but there's an overhead to doing things this way. I try to hardcode the calls to the getters and setters and combine all fields of a struct into additional full-struct getters and setters to minimize the overhead when all fields are required, but it's still an incredible waste of time having to code it all for every struct and the end result is - no matter how small the margin - slower than it needs to be. <br><br></td></tr></table><br>
<a name="631636"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Didn't Mark already propose an implementation of C structures in BlitzMax and then never do anything about it? <br><br></td></tr></table><br>
<a name="631637"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Can't remember. It was just requested about 50 times now, like full ENUM support as well. <br><br></td></tr></table><br>
<a name="631746"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> You would have an array of MyType pointers, and those pointers would be in sequence in memory, but what they point TO could be totally randomly scattered.<br><br>That is, unless, you create a memory bank, put your data in the bank in sequential order, and then `hardwire` the array to point exactly to the offsets in the bank where each object starts. <br><br></td></tr></table><br>
<a name="631779"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Right, but with an array of ints, I can assume that the ints are all aligned in memory, right? I know that I have to point to the index of the first element in the array, not a variable pointer, but all subsequent elements are aligned after it in a block of contiguous memory, right? <br><br></td></tr></table><br>
<a name="631856"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Chris C</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> using a bank is one method I use, but working out all the correct offsets is a pain<br><br>I end up writing little c functions to calculate it for me, but again, a pain and a needless waste of time, somthing that a pro quality compiler should be able to do automatically<br><br>It would also make using libs less error prone as errors are less likely to creep in<br><br>Maybe when we all get sick of waiting for Mark and one of us gets the time there may be a way of modifying bmk to preprocess code, but then I dont like the idea of using a none standard bmk... <br><br></td></tr></table><br>
<a name="631891"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Who was John Galt?</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  "Mark seem to have a pathalogical lothing of including C structs in Max (or at least thats the impression I get) which is a real shame..."  <br></div><br><br>Me too. Could make life so much simpler, which is what I thought Max was all about. <br><br></td></tr></table><br>
<a name="631950"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Chris C</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> gee mark hope I havent upset you maybe the word pathalogical was a bit strong.... <br><br></td></tr></table><br>
<a name="631994"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> An array of Int's is all aligned in memory, but an array of custom types which have Int fields is not. <br><br></td></tr></table><br>
<a name="633623"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mental Image</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Slightly off topic, but the concept of arrays of types facinates me for one particular aplication.<br><br>I would be *VERY* grateful if some kind soul would show an example of an array definition of a number of instances of the same type, and how to refer to them.<br><br>Thanks <br><br></td></tr></table><br>
<a name="633639"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> <pre class=code>
Strict
Type Ttest
  Field x
  Function create:TTest(x:Int)
    Local my:TTest = New Ttest
    my.x:Int = x
    Return my
  End Function
End Type
Local myarray:TTest[5]
For Local x = 0 To 4
  myarray[x]=Ttest.create(x)
Next
For Local x = 0 To 4
  Print myarray[x].x
Next
</pre> <br><br></td></tr></table><br>
<a name="633640"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mental Image</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks, Tony, once again very prompt and helpful! <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
