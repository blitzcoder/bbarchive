<!DOCTYPE html><html lang="en" ><head ><title >Randomly uneven framerate - &amp; possible solutions?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Randomly uneven framerate - &amp; possible solutions?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Randomly uneven framerate - &amp; possible solutions?</a><br><br>
<a name="1245683"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sokurah</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm having an annoying problem. I'm working on a Windows game (Mac comes later) which runs at a fixed 1024x768 resolution and I'm getting a lot of framerate choppiness and shearing. The backgrounds in this game are fullscreen PNG files.<br><br>Like I said - I'm getting a lot of shearing and choppy movement...but not always. Sometimes - without recompiling - I just exit the game and enter it again and the problem is gone. Or the other way around...and I just can't see what's causing it.<br><br>I've tried on two different computers and with both DirectX and OpenGL, but the results are the same. The same is experienced by the artist. I can only speak for myself, but both of my computers are pretty capable (I can run most new commercial games at 1920x1080) and my graphics drivers are up to date too.<br><br><br>Here's two ideas I'd like your opinions on;<br><br>1).<br>Most of my PNG images are 256 colors, but some are 16mil.<br>Could this mix have anything to do with it and would it make any difference to keep them all the same amount of colors?<br><br>2).<br>My backgrounds are actually drawn at half resolution and scaled up x2 in an artpackage before incbin'ning then into the game.<br>So, my second question is: Do you think it would help if I stored the background images at that half res - 512*384 - instead of twice that - and scale them up ingame using the SETSCALE command instead? <br><br></td></tr></table><br>
<a name="1245684"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you Flip with the vertical blank (Flip, or Flip -1, or perhaps Flip 1), you shouldn't see any shearing.<br><br>Don't use DrawPixmap - which I hope you are not, as it is generally rubbish with most drivers. <br><br></td></tr></table><br>
<a name="1245685"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Scaling the images saves on VRAM as you then let your GPU scale the images.<br><br>Prescaling in the artpackage allows to use more advanced scaling mechanisms (lanczaros etc.).<br><br>Best is to have the real artwork done in a way bigger res so you only scale DOWN.<br><br><br>@tearing<br>check if you set the graphics driver to ignore screen refresh rates ... and if you use flip -1/0/1<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1245713"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> You haven't said what your PC spec is, beyond "pretty capable", which is very much open to interpretation.  I used to do mobile tech support and asked someone how old their PC was - their reply; "oh, it's pretty new, got it about 6 or 7 years ago".  New to them.  To me, obsolete.<br><br>Anyway, from what you've said, and without seeing any code, it sounds to me like your timing code (you have timing code, right?) is screwed somewhere.  Your game is rendering as fast as it will go, then some background task kicks off on your PC and all of a sudden your game can't maintain the framerate for a split second.  It will be massively noticeable. <br><br></td></tr></table><br>
<a name="1245780"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sokurah</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Brucey,<br>If I use Flip 1 or -1 it's the same. Using Flip 0 makes it go blindingly (and unusably) fast (about 4600 fps).<br>And I don't use Pixmaps.<br>The performance I'm describing is in windowed mode btw. It's completely slow and useless when running fullscreen. Very odd, never had that problem before.<br><br><br>Derron,<br>The artwork is made at half res and is designed to be scaled up x2 without any filters - just a simple pixel-resize. I like it that way. Very retro-like. ;-)<br>I'm just using the "normal" Flip (without a number after it), but as you can read above it doesn't make any difference.<br>The graphics driver is not set to ignore screen refresh rates. Well, checking the settings it says "Use 3D-software settings", but there are no settings in that section for BM games.<br><br><br>GfK,<br>My specs are Core i7, 3.40GHz, 8GB RAM, GeForce GTX 560.<br>Certainly enough to run a BlitzMax game. ;-)<br><br><br>So as the game will happily go 4600 fps it's not because it's rendering as fast as it will go.<br>I'm guessing the Flip (which is basically a Flip 1, right?) just syncs it with the screen refresh rate.<br><br>But as you can guess - there is no timing code. I've never had a use for it before. But surely it should be able to keep things smooth when syncing with the screens refresh rate? <br><br></td></tr></table><br>
<a name="1245781"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Could be a memory leak.<br><br>Could be that the garbage collector is getting really busy at times clearing up a lot of objects.<br><br>Difficult to say without knowing more about what you are doing internally. <br><br></td></tr></table><br>
<a name="1245789"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >zoqfotpik</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just throwing it out there: for some reason both Blitz and Monkey seem to be very sensitive to other things running in the background.  Often even Google Chrome will interfere with framerate and it does so in the form of microhitches.  This has been true for me across two radically different machines. <br><br></td></tr></table><br>
<a name="1245803"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Do you have a Delay( 1 ) in the main loop or in CPU intensive areas (where time taken is longer than 1 second), if not windows could be querying your app as it could be maxing out the cpu.<br><br>I always put it at the bottom of the main loop this frees the cpu cycles and can make a choppy game smooth :) <br><br></td></tr></table><br>
<a name="1245807"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matty</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hang on...your statement that flip 0 (which I imagine is without vsync) causes it to go uncontrollably fast suggests you aren't using any timing mechanism at all but rather simply letting it run as fast as the system will allow you....that is a problem right there. <br><br></td></tr></table><br>
<a name="1245816"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> You said you aren't using timing code. your graphics are rendering at 4600 fps - fine, but your logic is also running at 4600 fps. When your PC does something else in the background then your code can no longer execute 4600 times per second, and that's why you're having problems.<br><br>implement timing code to cap your frame rate to 60fps, and you can 99.9% guarantee the game will run a lot better for it.<br><br>there are plenty of timing examples in the code archives. <br><br></td></tr></table><br>
<a name="1245825"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sometimes it also matters if you are running debug or release builds.<br><br>My game is limited to 60fps and 30 updates per second (fixed rate logic + interpolation or extrapolation if needed) ... but when doing debug builds I am not able to have 60fps but it runs slower, 45fps. As in release mode and unlimited fps I have about 200 I think that debug in some cases is not just a bit but way slower. Maybe it collects garbage differently (does more in that case) ... so this will increase "hickup time" even more.<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1245827"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> In debug mode there are *lots* of extra things going on :<br>* Each local block modifies the debug stack - that's two calls at least... one coming in, one going out.<br>* Each statement produces an extra function call.<br><br>It gets busy in debug mode :-) <br><br></td></tr></table><br>
<a name="1245833"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >zoqfotpik</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Sometimes it also matters if you are running debug or release builds. <br></div><br>Oh, a LITTLE.  That's the first thing to check.  Knowing that, I've probably spent a week total trying to figure out why things were running blazingly slow. <br><br></td></tr></table><br>
<a name="1246721"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sokurah</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> You said you aren't using timing code. your graphics are rendering at 4600 fps - fine, but your logic is also running at 4600 fps. When your PC does something else in the background then your code can no longer execute 4600 times per second, and that's why you're having problems.<br><br>implement timing code to cap your frame rate to 60fps, and you can 99.9% guarantee the game will run a lot better for it. <br></div><br><br>Surely the logic isn't running at 4600 fps. It should be limited to the refresh of the screen, which in my case means it's running at (around) 60 fps.<br><br>I've never actually used timing code in any of my games - just designed them to run perfectly at 60 fps, but I supposed it would then run 25% faster for someone with a monitor refresh rate of 75 fps?<br>...not that anyone has ever complained. :-D<br><br><br><div class="quote"> Sometimes it also matters if you are running debug or release builds. <br></div><br><br>I've made many games - most of them in BlitzMax so I've gotten over the "accidentally compiling in debug mode" period a LONG time ago. That's not it. :-D<br><br>It's just that choppy movement has never been an issue before and about 10 of my games are running in 1024x768 without any problems. But then again - none of them has involved as big images/sprites as this one so I was thinking it could somehow be related to that.<br><br><br>Still, perhaps this would be a good time to look into timing code - getting that to work properly would at least eliminate that as a potential problem.<br>...Can anyone direct me to an easy guide/example they know works? ;-) <br><br></td></tr></table><br>
<a name="1246722"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> You will find enough samples when searching "delta timing" or "fixed rate logic".<br><br><br>Maybe you should provide a simple example with slowdown (you can dynamically create images ... so no need to pass assets around for us).<br><br><br>@75hz<br>Yepp, it would run faster for them - if you just do a "move + 1" each "update".<br><br>deltaTime would then do "move + 1 * portionOfSecondGoneSinceLastUpdate"<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1246723"></a>

<a name="1246724"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Surely the logic isn't running at 4600 fps. It should be limited to the refresh of the screen, which in my case means it's running at (around) 60 fps. <br></div>It's just an exaggerated example.<br><br><div class="quote"> I've never actually used timing code in any of my games - just designed them to run perfectly at 60 fps, but I supposed it would then run 25% faster for someone with a monitor refresh rate of 75 fps?<br>...not that anyone has ever complained. :-D <br></div><br><br>Your game might well be running at your monitor refresh rate of 60Hz but on many GPUs it's possible to force override vSync to Off.  In that case, your code will run as fast as the hardware is capable of, be it 60Hz, or 6,000Hz.  Your game would then run unplayably fast as a result, because you aren't using any form of timing beyond what your own hardware is set to.<br><br>By implementing timing code and detaching logic from rendering, your game logic will always run at the same speed, and rendering will take place as and when there's time to do it. <br><br></td></tr></table><br>
<a name="1246989"></a>

<a name="1246990"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Or you BIOS may be incorrectly configured and the video IRQ is shared with something else or your plug'n play is simply disabled. <br><br></td></tr></table><br>
<a name="1247299"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sokurah</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Derron: "Maybe you should provide a simple example with slowdown (you can dynamically create images ... so no need to pass assets around for us)." <br></div><br><br>Okay, I made a stripped down demo that has about 6 screens where you can see the problem in action. The demo is a mere 1.7MB in size.<br><br><a href="https://dl.dropboxusercontent.com/u/2697142/DwWhoDemo.rar" target="_blank">https://dl.dropboxusercontent.com/u/2697142/DwWhoDemo.rar</a><br><br>Here's a picture so you know what you're downloading.<br><br><img src="https://dl.dropboxusercontent.com/u/2697142/DwWhoDemo.jpg"><br><br>All the screens here are among the first I added so they're still at full res - 1024x566 (plus the bottom panel added afterwards). The other 15 screens added (which are not included in this demo) are at half that (512x283) and scaled up...but the problem is still there...although it may be less prominent (but it's pretty random). <br><br></td></tr></table><br>
<a name="1247310"></a>

<a name="1247311"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> With demo I meant:<br><br>- simple sourcecode<br>- basic assets<br><br>Your exe might have a "delay 1000" in it ... we wouldn't see that.<br><br>So if you are able to strip down the whole thing into some sourcecode + media: we could more likely see what the problem might be.<br><br>Maybe it is some eventhandling, some timers, some ...<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1247325"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Pingus</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> Seems working fine here... (60 fps) <br><br></td></tr></table><br>
<a name="1247632"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sokurah</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> With demo I meant:<br><br>- simple sourcecode<br>- basic assets <br></div><br><br>Oh.<br><br>Well, I've stripped the source code completely down to the bare essentials...and the problem is still there.<br><br>Please read the 'readme-first.txt' file before you ask any questions, I may have adressed them there.<br><br><a href="https://dl.dropboxusercontent.com/u/2697142/DrDemo.zip" target="_blank">https://dl.dropboxusercontent.com/u/2697142/DrDemo.zip</a><br><br>This demo is about 1 MB in size and contains source code, assets and an executable.<br><br>I hope there are some among you that can help me with my framerate problem. <br><br></td></tr></table><br>
<a name="1247638"></a>

<a name="1247640"></a>

<a name="1247643"></a>

<a name="1247644"></a>

<a name="1247646"></a>

<a name="1247650"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> First of all:<br><br><pre class=code>
SuperStrict
?Win32
	Import bah.fmod
?Not Win32
	Import "incl\soundwrapper.bmx"
?

'Dirext X
Framework brl.D3D7Max2D
</pre><br><br>Ahh... so when not running "windows", it tries to include a file in "bla\". Also the Framework is limiting to windows already.<br><br>Use "/" if possible, on Linux/Mac this is the default path divider.<br><br>"incl/soundrwapper.bmx":<br>cannot compile it ...maybe using a framework makes it hmm less compatible (you should really use "superstrict" and import things in individually imported files).<br><br>Game needs fmod-module to work.<br><br><br>Code like this:<br><pre class=code>
	If Examining = 0 Then

		If Idle = 0 Then
			If Direction = 0 Then CurrentFrame = Frame + (Direction * 10)	' Right
			If Direction = 1 Then CurrentFrame = 16 - Frame
			DrawImage PlayerGFX, Xpos, Ypos, CurrentFrame
		Else
			If Direction = 0 Then CurrentFrame = 7	' Right
			If Direction = 1 Then CurrentFrame = 19	' Left
			DrawImage PlayerGFX, Xpos, Ypos, CurrentFrame
		End If

	Else
	
		CurrentFrame = 26 + (Examining / 8 Mod 4)
		DrawImage PlayerGFX, Xpos, Ypos, CurrentFrame
		If Examining &gt; 0 Then Examining = Examining - 1
	
	EndIf
</pre><br><br>Why not just:<br><br><pre class=code>
	If Examining = 0 Then
		If Idle = 0 Then
			If Direction = 0 Then CurrentFrame = Frame + (Direction * 10)	' Right
			If Direction = 1 Then CurrentFrame = 16 - Frame
		Else
			If Direction = 0 Then CurrentFrame = 7	' Right
			If Direction = 1 Then CurrentFrame = 19	' Left
		End If
	Else
		CurrentFrame = 26 + (Examining / 8 Mod 4)
	EndIf

	DrawImage PlayerGFX, Xpos, Ypos, CurrentFrame
	If Examining &gt; 0 Then Examining = 1 - Examining
</pre><br><br>Also pay attention to "Examining = Examining - 1" ... if you want an alternation between 0 and 1 you better write "examining = 1 - examining", else a starting value "examining = 0" will lead to "-1" (which then in the next case will lead to "= 1 - -1 = 2"). No true "boolean" values (but of course still working).<br><br>That "drawing" could be done at the end of the function as all other things just calculate the frames. - but that is not the source of the problem.<br><br><br>The problem is: you move at constant "pixel-distances" regardless of the time gone since the last frame.<br><br>You cannot guarantee to have each frame taking exactly 1.0seconds / amountOfFramesPerSecond. So if one takes 16ms, the other takes 18, nother one 15.7 ...<br><br>But each of these frames you let your character move by X pixels. So this makes the whole thing "jitterish".<br><br><br>That is why people use "deltatiming".<br>You wont any longer define "pixels per frame" but "pixels per second". Now for each frame you check the milliseconds gone since last frame... and this is your "deltatime". If your last frame was 17ms ago, your Figure moves then by 0.017 * pixelsPerSecond.<br><br>Of course it also might lead to some kind of "jittering" (because of rounding errors). <br><br><br><br>Another tip is to reorganize a bit of your code.<br><br>"Type Snow" - it could contain "addSnow" and other functions too.<br><br><br>Other thingies:<br><pre class=code>
#IdleWorkingFrameData
DefData 0, 0, 0, 1, 2, 3, 3, 4, 4, 3, 3, 4, 4, 5, 6, 7, 8, 9, 0, 0
Global WorkingFrameSequence:Int[21]
RestoreData IdleWorkingFrameData
For a = 0 To 19
	ReadData b
	WorkingFrameSequence[a] = b
Next
</pre><br><br>Why so complicated?<br><br><pre class=code>
Global WorkingFrameSequence:Int[] = [0, 0, 0, 1, 2, 3, 3, 4, 4, 3, 3, 4, 4, 5, 6, 7, 8, 9, 0, 0]
</pre><br><br><br>Also of interest:<br><pre class=code>
Function ShowItems()
	For Local item:items = EachIn items_list
		f = 0
		If item.Bouncing = 1 Then
			item.bounce:+6
			If item.bounce &gt; 359 Then item.bounce = 0
			f = Sin(item.bounce) * 8
			a = Sin(item.bounce) * 6
			End If
		If item.Screen = Screen Then DrawImage ItemsGFX, item.x, item.y - f, item.whichtype
	Next
End Function
</pre><br>No need to "reset" bounce everytime.<br><br>What happens if your bounce would reach 362? I know, with "+6" you will reach 354 and then 360 ... but you might change the speed and voila...<br>Sinus returns the same value for 180 and 360+180 ... so you could just add 6 ... until not bouncing anylonger.<br>your method might result in a small "hickup": if "bounce" would be 362, then f would be similar to sin(2)*8 - but you set it back to sin(0)*8, which is something different. This might be visible as a small displacement-error (it does not rotate that smooth). <br><br>Is variable "a" even used? seems not... .<br><br><br>Think you should fix that "jiggy" issue first in a small code file ... and extend your code from there ... clean up the structures if you plan to make the game a bit bigger than just 4-5 screens.<br><br>ScreenManager<br>Screens<br>ScreenTransition<br><br>Item with custom functions/information (to handle combine with other items, descriptions, use-with-information).<br><br>AnimationData (which takes care of "animation frame", "next animation data", updating including delays).<br><br>RessourceManager (Loadingscreen, Collection managment, ...)<br>Ressources (Backgrounds, Sounds, ...)<br><br>But first fix the basic engine: rendering and updating.<br><br>Even If you do not split rendering and updating in the loop, try to split in in the classes - you might have to write a bit more code, but all in "render" is then just for displaying, while the checks (eg. collision, interaction ...) is done in "update".<br><br>Benefit: you could even run the game on slower machines (just decrease rendering) while keeping the updates high enough to not miss collision, clicks on items ...).<br><br><br>Also take into consideration to split up controls from logic. So instead of "if keyhit(key_left) then posX :- 1" you should think of "if keyhit(key_left) then Figure.MoveLeft()". This enables eg. the addition of "Joypad support" or other things (if you intend to do that). If not, ignore that paragraph.<br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1247783"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sokurah</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the reply.<br><br>Yeah, not all things are equally good under the hood, lol.<br><br><br>A few comments to your comments...<br><br><br><div class="quote"> "incl/soundrwapper.bmx":<br>cannot compile it ...maybe using a framework makes it hmm less compatible (you should really use "superstrict" and import things in individually imported files). <br></div><br><br>I'm not too worried about the sound code. That's easy to fix (and easy to strip out if there's a problem compiling it). That being said I have a soundwrapper (somewhere) that compiles on OSX - one that doesn't use fmod but allows me to use the same commands and let things work with minimal changes...but I must've gotten the files mixed up somehow. :-/<br><br><div class="quote"> "Type Snow" - it could contain "addSnow" and other functions too. <br></div><br>I do "import things in individually imported files" - but I bunged everything together in this demo to simplify things. My mainfile is closer to 500 lines than the 150 lines in this demo and the rest of the game is spread out over about 30 files in the INCL folder, so everything is neatly categorized - all code handling items in one place, particles, enemies, etc in others. But yes - I probably should make it more OOP in structure. But then again - it works anyway. ;-)<br><br>The 'ShowPlayer' function sucks - I know. I didn't plan things well from the beginning and kept adding to it so I know it's a huge mess. A terrible terrible mess. It's by far the worst bit code in there and I was planning on rewriting it under all circumstances. ;-)<br><br><br><div class="quote"> Why so complicated?<br><br><pre class=code>Global WorkingFrameSequence:Int[] = [0, 0, 0, 1, 2, 3, 3, 4, 4, 3, 3, 4, 4, 5, 6, 7, 8, 9, 0, 0]</pre> <br></div><br><br>About that: Yes, I know my way was too complicated. For some reason I didn't think of your way of doing it the first time I needed it, so I wrote it like this, and just copy/paste/edited it the following times I needed it.<br>Your way is a nice bit of optimization and I'll fix it - AND make sure to do it that way in the future. ;-)<br><br>Now that you mention it the 'ShowItems' code is pretty stupid too. I wonder why I did it like that? ...well, my excuse is 'beer'. :-D I can certainly do better (and have...but in other places apparently). :-D<br><br>The game currently has about 20 screens (aiming for about 60) and loads of puzzles already. I'm happy with most of my stuff. Granted, some portions could do with a serious rewriting and some could do with some optimizing too, but I'm too far ahead to rewrite from the beginning. Still, you've given me some good ideas and I'll see how many I can implement.<br>...I just hope I can fix that annoying jittering too. Perhaps it's time to finally look into that deltatiming-thing. ;-)<br><br>Again, thanks for your comments. <br><br></td></tr></table><br>
<a name="1247847"></a>

<a name="1247850"></a>

<a name="1247851"></a>

<a name="1248053"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >zoqfotpik</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is a very ambitious project.  Ordinarily I'd ask if you might have bitten off more than you could chew but I think you can probably chew it.  With something that big you might want to do your refactoring now rather than later.<br><br>I'm still wondering if you're running something in the background that might be causing slowdown.  My Blitz installation, and Monkey, and other Blitz installations I've had, are surprisingly sensitive to having a number of tabs open in Google Chrome, presumably because of flash but maybe there is some other reason.<br><br>Another point: If you have a particle system, like for snow, you might want to encapsulate that into a manager class that uses an array for internal data representation instead of a list.  Lists in Blitzmax seem to be surprisingly good but you want to minimize use of the garbage collector.  Particle systems are a great use for a stack because you don't have to be constantly garbagecollecting dead nodes, they just sit there in your pool and get reused.  If you really want to go whole hog with arrays, do it the old way with separate arrays for each property of a particle instead of using classes.  Then don't use external functions at all in the particle system manager but do it all with inline code.  For fairly simple particle systems that will work fine and you may see a fairly substantial speedup if you are using lots of particles.  If you aren't using large numbers of particles the speedup isn't worth bothering with. <br><br></td></tr></table><br>
<a name="1252441"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sonic</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> this project looks great. my dad was a scriptwriter who wrote for Tom Baker / Peter Davison era Who (i used to sit on Baker's knee between takes!), and i'm also a massive p'n'c fan, so i heartily approve! <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
